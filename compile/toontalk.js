'use strict';(function(g){var k;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(k={},define(function(){return k})):k="undefined"!==typeof window?window:g:k=exports;(function(a){var d={greatest_common_divisor:function(e,r){if(1===r||1===e)return 1;for(var a;0!==r;){a=r;r=e%r;if(!isFinite(r))return 0;e=a}return e}};d.gcd=d.greatest_common_divisor;d.fromRandom=function(e){return Math.random()*(1<<e)>>>0};d.fromMillitime=function(){return+new Date};d.fromUnixtime=
function(){return.001*d.fromMillitime()|0};"undefined"!==typeof a&&(a.integer=d);(function(e){function r(e,b,d){if(d!==a)return e instanceof r?e:"undefined"===typeof e?c:r.parse(e);for(e=e||[];e.length&&!e[e.length-1];)--e.length;this._d=e;this._s=e.length?b||1:0}var a={};r._construct=function(e,c){return new r(e,c,a)};r.base=1E7;r.base_log10=7;var c=new r([],0,a);r.ZERO=c;var b=new r([1],1,a);r.ONE=b;var d=new r(b._d,-1,a);r.M_ONE=d;r._0=c;r._1=b;r.small=[c,b,new r([2],1,a),new r([3],1,a),new r([4],
1,a),new r([5],1,a),new r([6],1,a),new r([7],1,a),new r([8],1,a),new r([9],1,a),new r([10],1,a),new r([11],1,a),new r([12],1,a),new r([13],1,a),new r([14],1,a),new r([15],1,a),new r([16],1,a),new r([17],1,a),new r([18],1,a),new r([19],1,a),new r([20],1,a),new r([21],1,a),new r([22],1,a),new r([23],1,a),new r([24],1,a),new r([25],1,a),new r([26],1,a),new r([27],1,a),new r([28],1,a),new r([29],1,a),new r([30],1,a),new r([31],1,a),new r([32],1,a),new r([33],1,a),new r([34],1,a),new r([35],1,a),new r([36],
1,a)];r.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");r.prototype.toString=function(e){e=+e||10;if(2>e||36<e)throw Error("illegal radix "+e+".");if(0===this._s)return"0";if(10===e){e=0>this._s?"-":"";e+=this._d[this._d.length-1].toString();for(var a=this._d.length-2;0<=a;a--){for(var c=this._d[a].toString();7>c.length;)c="0"+c;e+=c}return e}a=r.digits;e=r.small[e];for(var c=this._s,b=this.abs(),d=[],h;0!==b._s;)h=b.divRem(e),b=h[0],h=h[1],d.push(a[h.valueOf()]);return(0>c?"-":"")+d.reverse().join("")};
r.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];r.parse=function(e,b){function d(e){e=e.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return e.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(e,a,m,r,c){c=+c;var b=0>c,d=m.length+c;e=(b?m:r).length;c=(c=Math.abs(c))>=e?c-e+b:0;e=Array(c+1).join("0");m+=r;return(a||"")+(b?m=e+m:m+=e).substr(0,d+=b?e.length:0)+(d<m.length?"."+m.substr(d):"")})}e=e.toString();if("undefined"===typeof b||10===+b)e=d(e);var h=(new RegExp("^([+\\-]?)("+("undefined"===
typeof b?"0[xcb]":16==b?"0x":8==b?"0c":2==b?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(e);if(h){var f=h[1]||"+",l=h[2]||"",h=h[3]||"";if("undefined"===typeof b)b="0x"===l||"0X"===l?16:"0c"===l||"0C"===l?8:"0b"===l||"0B"===l?2:10;else if(2>b||36<b)throw Error("Illegal radix "+b+".");b=+b;if(!r.radixRegex[b].test(h))throw Error("Bad digit for radix "+b);h=h.replace(/^0+/,"").split("");if(0===h.length)return c;f="-"===f?-1:1;if(10==b){for(l=[];7<=h.length;)l.push(parseInt(h.splice(h.length-r.base_log10,
r.base_log10).join(""),10));l.push(parseInt(h.join(""),10));return new r(l,f,a)}l=c;b=r.small[b];for(var g=r.small,m=0;m<h.length;m++)l=l.multiply(b).add(g[parseInt(h[m],36)]);return new r(l._d,f,a)}throw Error("Invalid BigInteger format: "+e);};r.prototype.add=function(e){if(0===this._s)return r(e);e=r(e);if(0===e._s)return this;if(this._s!==e._s)return e=e.negate(),this.subtract(e);var c=this._d;e=e._d;for(var b=c.length,d=e.length,h=Array(Math.max(b,d)+1),f=Math.min(b,d),l=0,m=0;m<f;m++)l=c[m]+
e[m]+l,h[m]=l%1E7,l=l/1E7|0;d>b&&(c=e,b=d);for(m=f;l&&m<b;m++)l=c[m]+l,h[m]=l%1E7,l=l/1E7|0;for(l&&(h[m]=l);m<b;m++)h[m]=c[m];return new r(h,this._s,a)};r.prototype.negate=function(){return new r(this._d,-this._s|0,a)};r.prototype.abs=function(){return 0>this._s?this.negate():this};r.prototype.subtract=function(e){if(0===this._s)return r(e).negate();e=r(e);if(0===e._s)return this;if(this._s!==e._s)return e=e.negate(),this.add(e);var b=this;0>this._s&&(b=new r(e._d,1,a),e=new r(this._d,1,a));var d=
b.compareAbs(e);if(0===d)return c;if(0>d){var h=e;e=b;b=h}b=b._d;e=e._d;var h=b.length,f=e.length,l=Array(h),g=0,m,t;for(m=0;m<f;m++)t=b[m]-g-e[m],0>t?(t+=1E7,g=1):g=0,l[m]=t;for(m=f;m<h;m++){t=b[m]-g;if(0>t)t+=1E7;else{l[m++]=t;break}l[m]=t}for(;m<h;m++)l[m]=b[m];return new r(l,d,a)};(function(){function e(c,b){for(var d=c._d,h=d.slice(),f=0;;){var m=(d[f]||0)+1;h[f]=m%1E7;if(9999999>=m)break;++f}return new r(h,b,a)}function c(e,b){for(var d=e._d,h=d.slice(),f=0;;){var m=(d[f]||0)-1;if(0>m)h[f]=
m+1E7;else{h[f]=m;break}++f}return new r(h,b,a)}r.prototype.next=function(){switch(this._s){case 0:return b;case -1:return c(this,-1);default:return e(this,1)}};r.prototype.prev=function(){switch(this._s){case 0:return d;case -1:return e(this,-1);default:return c(this,1)}}})();r.prototype.compareAbs=function(e){if(this===e)return 0;if(!(e instanceof r)){if(!isFinite(e))return isNaN(e)?e:-1;e=r(e)}if(0===this._s)return 0!==e._s?-1:0;if(0===e._s)return 1;var a=this._d.length,c=e._d.length;if(a<c)return-1;
if(a>c)return 1;c=this._d;e=e._d;for(--a;0<=a;a--)if(c[a]!==e[a])return c[a]<e[a]?-1:1;return 0};r.prototype.compare=function(e){if(this===e)return 0;e=r(e);return 0===this._s?-e._s:this._s===e._s?this.compareAbs(e)*this._s:this._s};r.prototype.isUnit=function(){return this===b||this===d||1===this._d.length&&1===this._d[0]};r.prototype.multiply=function(e){if(0===this._s)return c;e=r(e);if(0===e._s)return c;if(this.isUnit())return 0>this._s?e.negate():e;if(e.isUnit())return 0>e._s?this.negate():this;
if(this===e)return this.square();var b=this._d.length>=e._d.length,d=(b?this:e)._d,b=(b?e:this)._d,h=d.length,f=b.length,l=h+f,g=Array(l),m;for(m=0;m<l;m++)g[m]=0;for(m=0;m<f;m++){for(var l=0,t=b[m],n=h+m,k,q=m;q<n;q++)k=g[q]+t*d[q-m]+l,l=k/1E7|0,g[q]=k%1E7|0;l&&(k=g[q]+l,g[q]=k%1E7)}return new r(g,this._s*e._s,a)};r.prototype.multiplySingleDigit=function(e){if(0===e||0===this._s)return c;if(1===e)return this;var b;if(1===this._d.length)return b=this._d[0]*e,1E7<=b?new r([b%1E7|0,b/1E7|0],1,a):new r([b],
1,a);if(2===e)return this.add(this);if(this.isUnit())return new r([e],1,a);var d=this._d,h=d.length;b=h+1;for(var f=Array(b),l=0;l<b;l++)f[l]=0;for(var g=l=0;g<h;g++)b=e*d[g]+l,l=b/1E7|0,f[g]=b%1E7|0;l&&(f[g]=l);return new r(f,1,a)};r.prototype.square=function(){if(0===this._s)return c;if(this.isUnit())return b;var e=this._d,d=e.length,h=Array(d+d+1),f,l,g,n;for(n=0;n<d;n++)g=2*n,f=e[n]*e[n],l=f/1E7|0,h[g]=f%1E7,h[g+1]=l;for(n=0;n<d;n++){l=0;g=2*n+1;for(var m=n+1;m<d;m++,g++)f=e[m]*e[n]*2+h[g]+l,
l=f/1E7|0,h[g]=f%1E7;g=d+n;f=l+h[g];l=f/1E7|0;h[g]=f%1E7;h[g+1]+=l}return new r(h,1,a)};r.prototype.quotient=function(e){return this.divRem(e)[0]};r.prototype.divide=r.prototype.quotient;r.prototype.remainder=function(e){return this.divRem(e)[1]};r.prototype.divRem=function(e){e=r(e);if(0===e._s)throw Error("Divide by zero");if(0===this._s)return[c,c];if(1===e._d.length)return this.divRemSmall(e._s*e._d[0]);switch(this.compareAbs(e)){case 0:return[this._s===e._s?b:d,c];case -1:return[c,this]}var h=
this._s*e._s,f=e.abs(),l=this._d,g=l.length,n=[],k,m=new r([],0,a);for(m._s=1;g;)if(m._d.unshift(l[--g]),0>m.compareAbs(e))n.push(0);else{if(0===m._s)k=0;else{var t=m._d.length;k=f._d.length;t=1E7*m._d[t-1]+m._d[t-2];k=1E7*f._d[k-1]+f._d[k-2];m._d.length>f._d.length&&(t=1E7*(t+1));k=Math.ceil(t/k)}do{t=f.multiplySingleDigit(k);if(0>=t.compareAbs(m))break;k--}while(k);n.push(k);k&&(k=m.subtract(t),m._d=k._d.slice(),0===m._d.length&&(m._s=0))}return[new r(n.reverse(),h,a),new r(m._d,this._s,a)]};r.prototype.divRemSmall=
function(e){e=+e;if(0===e)throw Error("Divide by zero");var b=this._s*(0>e?-1:1);e=Math.abs(e);if(1>e||1E7<=e)throw Error("Argument out of range");if(0===this._s)return[c,c];if(1===e||-1===e)return[1===b?this.abs():new r(this._d,b,a),c];if(1===this._d.length){var d=new r([this._d[0]/e|0],1,a);e=new r([this._d[0]%e|0],1,a);0>b&&(d=d.negate());0>this._s&&(e=e.negate());return[d,e]}for(var h=this._d.slice(),d=Array(h.length),f=0,l=0,g=0,m;h.length;)f=1E7*f+h[h.length-1],f<e?(d[g++]=0,h.pop(),l=1E7*l+
f):(m=0===f?0:f/e|0,l=f-e*m,(d[g++]=m)?(h.pop(),f=l):h.pop());e=new r([l],1,a);0>this._s&&(e=e.negate());return[new r(d.reverse(),b,a),e]};r.prototype.isEven=function(){var e=this._d;return 0===this._s||0===e.length||0===e[0]%2};r.prototype.isOdd=function(){return!this.isEven()};r.prototype.sign=function(){return this._s};r.prototype.isPositive=function(){return 0<this._s};r.prototype.isNegative=function(){return 0>this._s};r.prototype.isZero=function(){return 0===this._s};r.prototype.exp10=function(e){e=
+e;if(0===e)return this;if(Math.abs(e)>Number(h))throw Error("exponent too large in BigInteger.exp10");if(0<e){for(var b=new r(this._d.slice(),this._s,a);7<=e;e-=7)b._d.unshift(0);if(0==e)return b;b._s=1;b=b.multiplySingleDigit(Math.pow(10,e));return 0>this._s?b.negate():b}if(-e>=7*this._d.length)return c;b=new r(this._d.slice(),this._s,a);for(e=-e;7<=e;e-=7)b._d.shift();return 0==e?b:b.divRemSmall(Math.pow(10,e))[0]};r.prototype.pow=function(e){if(this.isUnit())return 0<this._s?this:r(e).isOdd()?
this:this.negate();e=r(e);if(0===e._s)return b;if(0>e._s){if(0===this._s)throw Error("Divide by zero");return c}if(0===this._s)return c;if(e.isUnit())return this;if(0<e.compareAbs(h))throw Error("exponent too large in BigInteger.pow");for(var a=this,d=b,f=r.small[2];e.isPositive()&&(!e.isOdd()||(d=d.multiply(a),!e.isUnit()));)a=a.square(),e=e.quotient(f);return d};r.prototype.modPow=function(e,a){for(var c=b,d=this;e.isPositive();)e.isOdd()&&(c=c.multiply(d).remainder(a)),e=e.quotient(r.small[2]),
e.isPositive()&&(d=d.square().remainder(a));return c};r.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var e=this._d.length;if(30>7*e)return Math.log(this.valueOf());var c=Math.ceil(30/7),b=this._d.slice(e-c);return Math.log((new r(b,1,a)).valueOf())+(e-c)*Math.log(1E7)};r.prototype.valueOf=function(){return parseInt(this.toString(),10)};r.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var h=r(2147483647);r.MAX_EXP=h;(function(){function e(a){return function(e){return a.call(r(e))}}
function a(e){return function(a,c){return e.call(r(a),r(c))}}function c(e){return function(a,c,b){return e.call(r(a),r(c),r(b))}}(function(){var b,d,h="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),f="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),m=["modPow"];for(b=0;b<h.length;b++)d=h[b],r[d]=e(r.prototype[d]);for(b=0;b<f.length;b++)d=f[b],r[d]=a(r.prototype[d]);for(b=0;b<m.length;b++)d=
m[b],r[d]=c(r.prototype[d]);r.exp10=function(e,a){return r(e).exp10(a)}})()})();e.BigInteger=r})("undefined"!==typeof a?a:this);var c={greatest_common_divisor:function(e,a){if(a.isUnit()||e.isUnit())return BigInteger.ONE;for(var b;!a.isZero();)b=a,a=e.remainder(a),e=b;return e},create:function(){return[0]},clone:function(e){for(var a=[],b=0,c=e.length;b<c;b++)a[b]=e[b];return a},copy:function(e,a){e=[];for(var b=0,c=a.length;b<c;b++)e[b]=a[b];return e},abs:function(e,a){e[0]=Math.abs(a[0]);return e},
str:function(e){return e[0].toString()},toInteger:function(e){return out[0]},fromInteger:function(e){return[parseInt(e)]}};c.ZERO=c.fromInteger(0);c.ONE=c.fromInteger(1);"undefined"!==typeof a&&(a.bigint=c);if(!b)var b=Array;if(!l)var l=Math.pow(2,56);if(!g)var g=16777216;var f={EPSILON:2E-16};f.MAX_LOOPS=g;f.create=function(){var e=new b(2);e[0]=0;e[1]=1;return e};f.clone=function(e){var a=new b(2);a[0]=e[0];a[1]=e[1];return a};f.fromValues=function(e,a){var c=new b(2);c[0]=e;c[1]=a;return f.normalize(c,
c)};f.copy=function(e,a){e[0]=a[0];e[1]=a[1];return e};f.set=function(e,a,b){e[0]=a;e[1]=b;return f.normalize(e,e)};f.abs=function(e,a){e[0]=Math.abs(a[0]);e[1]=a[1];return e};f.invert=function(e,a){var b=a[0];e[0]=a[1];e[1]=b;return e};f.reciprocal=f.invert;f.add=function(e,a,b){a[1]===b[1]?(e[0]=a[0]+b[0],e[1]=a[1]):(e[0]=a[0]*b[1]+b[0]*a[1],e[1]=a[1]*b[1]);return f.normalize(e,e)};f.subtract=function(e,a,b){a[1]===b[1]?(e[0]=a[0]-b[0],e[1]=a[1]):(e[0]=a[0]*b[1]-b[0]*a[1],e[1]=a[1]*b[1]);return f.normalize(e,
e)};f.sub=f.subtract;f.multiply=function(e,a,b){e[0]=a[0]*b[0];e[1]=a[1]*b[1];return f.normalize(e,e)};f.mul=f.multiply;f.mediant=function(e,a,b){e[0]=a[0]+b[0];e[1]=a[1]+b[1];return f.normalize(e,e)};f.divide=function(e,a,b){e[0]=a[0]*b[1];e[1]=a[1]*b[0];return f.normalize(e,e)};f.div=f.divide;f.equals=function(e,a){return 0===e[0]&&0===a[0]||0===e[1]&&0===a[1]?!0:e[0]===a[0]&&e[1]===a[1]};f.approximates=function(e,a){if(f.equals(e,a))return!0;var b=f.create();f.sub(b,e,a);f.abs(b,b);return f.isLessThan(b,
f.INFINITESIMAL)};f.isGreaterThan=function(e,a){return f.equals(e,a)?!1:e[0]*a[1]>a[0]*e[1]};f.isLessThan=function(e,a){return f.equals(e,a)?!1:e[0]*a[1]<a[0]*e[1]};f.isNegative=function(e){return 0>e[0]};f.min=function(e,a,b){f.isLessThan(a,b)?(e[0]=a[0],e[1]=a[1]):(e[0]=b[0],e[1]=b[1]);return e};f.max=function(e,a,b){f.isGreaterThan(a,b)?(e[0]=a[0],e[1]=a[1]):(e[0]=b[0],e[1]=b[1]);return e};f.scalar_multiply=function(e,a,b){e[0]=a[0]*b;e[1]=a[1];return f.normalize(e,e)};f.scalar_divide=function(e,
a,b){e[0]=a[0];e[1]=a[1]*b;return f.normalize(e,e)};f.normalize=function(e,a){if(isNaN(a[0])||isNaN(a[1])||0===a[0]&&0===a[1])return e[0]=0,e[1]=0,e;if(0===a[0])return e[0]=0,e[1]=1,e;if(0===a[1])return e[0]=1,e[1]=0,e;if(a[0]===a[1])return e[0]=1,e[1]=1,e;0<a[1]?(e[0]=a[0],e[1]=a[1]):(e[0]=-a[0],e[1]=-a[1]);var b=d.greatest_common_divisor(Math.abs(e[0]),e[1]);1<b&&(e[0]/=b,e[1]/=b);return e};f.opposite=function(e,a){e[0]=-a[0];e[1]=a[1];return e};f.negative=f.opposite;f.neg=f.opposite;f.power=function(e,
a,b){2===b?(e[0]=a[0]*a[0],e[1]=a[1]*a[1]):0<b?(e[0]=Math.pow(a[0],b),e[1]=Math.pow(a[1],b)):0>b?(b=Math.abs(b),e[0]=Math.pow(a[1],b),e[1]=Math.pow(a[0],b)):f.copy(e,f.ONE);return f.normalize(e,e)};f.pow=f.power;f.sqrt=function(e,a){return f.nthRoot(e,a,2)};f.nthRoot=function(e,a,b){if(f.equals(a,f.ZERO))return f.copy(e,f.ZERO);if(f.equals(a,f.ONE))return f.copy(e,f.ONE);if(f.equals(a,f.INFINITY))return f.copy(e,f.INFINITY);if(f.equals(a,f.INFINULL))return f.copy(e,f.INFINULL);var c=f.isNegative(a);
c&&(a[0]=-a[0]);e=f.copy(e,f.ONE);for(var d=[1,0,0,1],h=f.clone(f.ONE),l=f.MAX_LOOPS;!f.approximates(a,h)&&l--;)f.isLessThan(a,h)?(d[0]+=d[1],d[2]+=d[3]):(d[1]+=d[0],d[3]+=d[2]),e[0]=d[0]+d[1],e[1]=d[2]+d[3],f.pow(h,e,b);c&&(a[0]=-a[0],1===b%2&&f.neg(e,e));return e};f.dot=function(e,a){return e[0]*a[0]+e[1]*a[1]};f.str=function(e){return 1===e[1]?e[0].toString():e[0]+"/"+e[1]};f.toDecimal=function(e){return e[0]/e[1]};f.dec=f.toDecimal;f.toInteger=function(e){return Math.round(f.toDecimal(e))};f.round=
f.toInteger;f.floor=function(e){return Math.floor(f.toDecimal(e))};f.ceil=function(e){return Math.ceil(f.toDecimal(e))};f.fromInteger_copy=function(e,a){e[0]=parseInt(a);e[1]=1;return e};f.fromInteger=function(e){return f.fromInteger_copy(f.create(),e)};f.fromIntegerInverse_copy=function(e,a){e[0]=1;e[1]=parseInt(a);0>e[1]&&(e[0]=-e[0],e[1]=-e[1]);return e};f.fromIntegerInverse=function(e){return f.fromIntegerInverse_copy(f.create(),e)};f.fromDecimal=function(e){return f.fromDecimal_copy(f.create(),
e)};f.fromDecimal_copy=function(e,a){a=parseFloat(a);if(isNaN(a))return f.copy(e,f.INFINULL);if(Infinity===a)return f.copy(e,f.INFINITY);if(Math.abs(a)<f.EPSILON)return f.copy(e,f.ZERO);if(Math.abs(a-1)<f.EPSILON)return f.copy(e,f.ONE);if(Math.abs(a%1)<f.EPSILON)return f.fromInteger_copy(e,a);if(Math.abs(1/a%1)<f.EPSILON)return f.fromIntegerInverse_copy(e,Math.round(1/a));f.copy(e,f.ONE);for(var b=[1,0,0,1],c=a,d=1,h=f.MAX_LOOPS;h--&&Math.abs(a-f.toDecimal(e))>f.EPSILON;){d=Math.floor(c);e[0]=d*b[0]+
b[2];e[1]=d*b[1]+b[3];if(c===d)break;c=1/(c-d);b[2]=b[0];b[3]=b[1];b[0]=e[0];b[1]=e[1]}return e};f.fromRandom=function(e){e[0]=0xfffffffffffff*Math.random()<<0;e[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return f.normalize(e,e)};f.sin=function(e,a){if(0===a[1])return f.copy(e,f.ZERO);f.scalar_multiply(e,a,2);var b=f.create();f.pow(b,a,2);f.add(b,b,f.ONE);f.divide(e,e,b);return e};f.cos=function(e,a){if(0===a[1])return f.neg(e,f.ONE);var b=f.create();f.pow(b,a,2);f.sub(e,f.ONE,b);var c=f.create();
f.add(c,f.ONE,b);f.divide(e,e,c);return e};f.tan=function(e,a){f.scalar_multiply(e,a,2);var b=f.create();f.pow(b,a,2);f.scalar_multiply(b,b,2);f.add(e,e,b);f.pow(b,a,4);f.sub(b,f.ONE,b);f.divide(e,e,b);return e};f.toEgyptian=function(e){e=f.clone(e);f.abs(e,e);var a=f.floor(e);a&&f.sub(e,e,f.fromInteger(a));if(!e[0])return a.toString();a||(a="");for(var b=1,c=f.create();1!==e[0];)b++,c=f.fromValues(1,b),f.isGreaterThan(e,c)&&(a&&(a+=" + "),a+=f.str(c),f.sub(e,e,c));return e?a?a+" + "+f.str(e):f.str(e):
a?a:"0"};f.toBabylonian=function(e){var a="",b=f.toDecimal(e);e=parseInt(b);for(var b=b-e,c=0,d=0;0<e;)(c=e%60)&&(a=c+" * 60^"+d+(a?" + ":"")+a),e=(e-c)/60,d++;for(d=-1;0<b;)b*=60,c=parseInt(b+1E-13),b-=c,-1E-13>b||(c&&(a+=(a?" + ":"")+c+" * 60^"+d),d--);return a?a:"0"};f.traceSternBrocot=function(e){var a="";if(f.equals(e,f.ZERO)||f.equals(e,f.ONE)||f.equals(e,f.INFINITY)||f.equals(e,f.INFINULL))return a;e=f.clone(e);f.isNegative(e)&&(e[0]=-e[0]);for(var b=f.clone(f.ONE),c=[1,0,0,1],d=0,h=0,l=f.MAX_LOOPS;!f.approximates(e,
b)&&l--;)f.isLessThan(e,b)?(c[0]+=c[1],c[2]+=c[3],h++,d&&(a+="R",1!==d&&(a+=d),d=0,a+=" ")):(c[1]+=c[0],c[3]+=c[2],d++,h&&(a+="L",1!==h&&(a+=h),h=0,a+=" ")),b[0]=c[0]+c[1],b[1]=c[2]+c[3];h?(a+="L",1!==h&&(a+=h)):d&&(a+="R",1!==d&&(a+=d));0>l&&(a+="...");return a};f.toContinuedFraction=function(e,a){a="undefined"===typeof a?65536:parseInt(a);if(f.equals(e,f.ZERO))return[0];if(f.equals(e,f.ONE))return[1];if(f.equals(e,f.NEGONE))return[-1];if(f.equals(e,f.INFINITY))return[1,0];if(f.equals(e,f.INFINULL))return[0,
0];var b=f.clone(e),c=f.isNegative(b);c&&(b[0]=-b[0]);for(var d=f.clone(f.ONE),h=[1,0,0,1],l=1,g=[0],n=g.length-1;!f.equals(b,d)&&a--;)f.isLessThan(b,d)?(-1===l?g[n]++:(l=-1,g.push(1),n++),h[0]+=h[1],h[2]+=h[3]):(1===l?g[n]++:(l=1,g.push(1),n++),h[1]+=h[0],h[3]+=h[2]),d[0]=h[0]+h[1],d[1]=h[2]+h[3];0>a?g.push(0):g[n]++;if(c)for(var k in g)g[k]=-g[k];return g};f.fromContinuedFraction=function(e,a){f.fromInteger_copy(e,a[a.length-1]);for(var b=a.length-2;-1<b;b--)f.invert(e,e),f.add(e,f.fromInteger(a[b]),
e);return e};f.dump=function(e){f.create();return"rat\t"+f.str(e)+"\n~\t"+f.toDecimal(e)+"\nCF:\t["+f.toContinuedFraction(e)+"]\n"};f.ZERO=f.fromInteger(0);f.ONE=f.fromInteger(1);f.NEGONE=f.fromInteger(-1);f.INFINITY=f.fromValues(1,0);f.INFINULL=f.fromValues(0,0);f.INFINITESIMAL=f.clone([1,l]);f.PI=f.fromValues(1320192667429,420230377710);"undefined"!==typeof a&&(a.rat=f);if(!k)var k=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!p)var p=1073741824;var h={EPSILON:2E-16};h.MAX_LOOPS=p;h.create=
function(){var e=[];e[0]=BigInteger.ZERO;e[1]=BigInteger.ONE;return e};h.clone=function(e){var a=[];a[0]=e[0];a[1]=e[1];return a};h.fromValues=function(e,a){var b=[];b[0]=new BigInteger(e);b[1]=new BigInteger(a);return h.normalize(b,b)};h.copy=function(e,a){e[0]=a[0];e[1]=a[1];return e};h.set=function(e,a,b){e[0]=a;e[1]=b;return h.normalize(e,e)};h.toRat=function(e,a){return f.set(e,a[0].toJSValue(),a[1].toJSValue())};h.fromRat=function(e,a){return h.set(e,BigInteger(a[0]),BigInteger(a[1]))};h.abs=
function(e,a){e[0]=a[0].abs();e[1]=a[1];return e};h.invert=function(e,a){var b=a[0];e[0]=a[1];e[1]=b;return e};h.reciprocal=h.invert;h.add=function(e,a,b){0===a[1].compare(b[1])?(e[0]=a[0].add(b[0]),e[1]=a[1]):(e[0]=a[0].multiply(b[1]).add(b[0].multiply(a[1])),e[1]=a[1].multiply(b[1]));return h.normalize(e,e)};h.subtract=function(e,a,b){0===a[1].compare(b[1])?(e[0]=a[0].subtract(b[0]),e[1]=a[1]):(e[0]=a[0].multiply(b[1]).subtract(b[0].multiply(a[1])),e[1]=a[1].multiply(b[1]));return h.normalize(e,
e)};h.sub=h.subtract;h.multiply=function(e,a,b){e[0]=a[0].multiply(b[0]);e[1]=a[1].multiply(b[1]);return h.normalize(e,e)};h.mul=h.multiply;h.mediant=function(e,a,b){e[0]=a[0].add(b[0]);e[1]=a[1].add(b[1]);return h.normalize(e,e)};h.divide=function(e,a,b){e[0]=a[0].multiply(b[1]);e[1]=a[1].multiply(b[0]);return h.normalize(e,e)};h.div=h.divide;h.equals=function(e,a){return e[0].isZero()&&a[0].isZero()||e[1].isZero()&&a[1].isZero()?!0:0===e[0].compare(a[0])&&0===e[1].compare(a[1])};h.approximates=
function(e,a){if(h.equals(e,a))return!0;var b=h.create();h.sub(b,e,a);h.abs(b,b);return h.isLessThan(b,h.INFINITESIMAL)};h.isGreaterThan=function(e,a){return h.equals(e,a)?!1:0<e[0].multiply(a[1]).compare(a[0].multiply(e[1]))};h.isLessThan=function(e,a){return h.equals(e,a)?!1:0>e[0].multiply(a[1]).compare(a[0].multiply(e[1]))};h.isNegative=function(e){return e[0].isNegative()};h.min=function(e,a,b){h.isLessThan(a,b)?(e[0]=a[0],e[1]=a[1]):(e[0]=b[0],e[1]=b[1]);return e};h.max=function(e,a,b){h.isGreaterThan(a,
b)?(e[0]=a[0],e[1]=a[1]):(e[0]=b[0],e[1]=b[1]);return e};h.scalar_multiply=function(e,a,b){e[0]=a[0].multiply(b);e[1]=a[1];return h.normalize(e,e)};h.scalar_divide=function(e,a,b){e[0]=a[0];e[1]=a[1].multiply(b);return h.normalize(e,e)};h.normalize=function(e,a){if(a[0].isZero()||a[1].isZero())return a;if(0===a[0].compare(a[1]))return h.clone(h.ONE);if(a[1].isNegative())e[0]=a[0].negate(),e[1]=a[1].negate();else if(e[0]=a[0],e[1]=a[1],e[1].isZero())return e;var b=c.greatest_common_divisor(e[0].abs(),
e[1]);0<b.compare(BigInteger.ONE)&&(e[0]=e[0].quotient(b),e[1]=e[1].quotient(b));return e};h.opposite=function(e,a){e[0]=a[0].negate();e[1]=a[1];return e};h.negative=h.opposite;h.neg=h.opposite;h.power=function(e,a,b){2===b?(e[0]=a[0].square(),e[1]=a[1].square()):0<b?(e[0]=a[0].pow(b),e[1]=a[1].pow(b)):0>b?(b=Math.abs(b),e[0]=a[1].pow(b),e[1]=a[0].pow(b)):h.copy(e,h.ONE);return e};h.pow=h.power;h.sqrt=function(e,a){return h.nthRoot(e,a,2)};h.nthRoot=function(e,a,b){if(h.equals(a,h.ZERO))return h.copy(e,
h.ZERO);if(h.equals(a,h.ONE))return h.copy(e,h.ONE);if(h.equals(a,h.INFINITY))return h.copy(e,h.INFINITY);if(h.equals(a,h.INFINULL))return h.copy(e,h.INFINULL);var c=h.isNegative(a);c&&(a[0]=a[0].negate());h.copy(e,h.ONE);for(var d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=h.clone(h.ONE),l=p;!h.approximates(a,f)&&l--;)h.isLessThan(a,f)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3])):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2])),e[0]=d[0].add(d[1]),e[1]=d[2].add(d[3]),h.pow(f,e,b);c&&(a[0]=
a[0].negate(),1===b%2&&h.neg(e,e));return e};h.dot=function(a,b){return a[0].multiply(b[0]).add(a[1].multiply(b[1]))};h.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};h.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};h.dec=h.toDecimal;h.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};h.round=h.toInteger;h.toBigInteger=function(a){return a[0].quotient(a[1])};h.floor=function(a){return Math.floor(h.toDecimal(a))};
h.ceil=function(a){return Math.ceil(h.toDecimal(a))};h.fromInteger_copy=function(a,b){a[0]=BigInteger(b);a[1]=BigInteger.ONE;return a};h.fromInteger=function(a){return h.fromInteger_copy(h.create(),a)};h.fromIntegerInverse_copy=function(a,b){a[0]=BigInteger.ONE;a[1]=BigInteger(b);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};h.fromIntegerInverse=function(a){return h.fromIntegerInverse_copy(h.create(),a)};h.fromDecimal=function(a){return h.fromDecimal_copy(h.create(),a)};h.fromDecimal_copy=
function(a,b){b=parseFloat(b);if(isNaN(b))return h.copy(a,h.INFINULL);if(Infinity===b)return h.copy(a,h.INFINITY);if(Math.abs(b)<h.EPSILON)return h.copy(a,h.ZERO);if(Math.abs(b-1)<h.EPSILON)return h.copy(a,h.ONE);if(Math.abs(b%1)<h.EPSILON)return h.fromInteger_copy(a,b);if(Math.abs(1/b%1)<h.EPSILON)return h.fromIntegerInverse_copy(a,Math.round(1/b));h.copy(a,h.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=b,f=BigInteger(1),l=h.MAX_LOOPS;l--&&Math.abs(b-h.toDecimal(a))>
h.EPSILON;){f=BigInteger(Math.floor(d));a[0]=f.multiply(c[0]).add(c[2]);a[1]=f.multiply(c[1]).add(c[3]);if(f=d-parseInt(f.toString(),10))d=1/f;else{if(b.toString()===h.toDecimal(a))break;d=(c=(b.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;h.add(a,h.fromInteger(c[1]),h.fromValues(c[2],Math.pow(10,d)));break}c[2]=c[0];c[3]=c[1];c[0]=a[0];c[1]=a[1]}return a};h.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return h.normalize(a,a)};h.sin=function(a,b){if(b[1].isZero())return h.copy(a,h.ZERO);h.scalar_multiply(a,b,2);var c=h.create();h.pow(c,b,2);h.add(c,c,h.ONE);h.divide(a,a,c);return a};h.cos=function(a,b){if(b[1].isZero())return h.neg(a,h.ONE);var c=h.create();h.pow(c,b,2);h.sub(a,h.ONE,c);var d=h.create();h.add(d,h.ONE,c);h.divide(a,a,d);return a};h.tan=function(a,b){h.scalar_multiply(a,b,2);var c=h.create();h.pow(c,b,2);h.scalar_multiply(c,c,2);h.add(a,a,c);h.pow(c,b,4);h.sub(c,
h.ONE,c);h.divide(a,a,c);return a};h.toEgyptian=function(a){a=h.clone(a);h.abs(a,a);var b=h.floor(a);b&&h.sub(a,a,h.fromInteger(b));if(!a[0])return b.toString();b||(b="");for(var c=1,d=h.create();1!==a[0];)c++,d=h.fromValues(1,c),h.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=h.str(d),h.sub(a,a,d));return a?b?b+" + "+h.str(a):h.str(a):b?b:"0"};h.toBabylonian=function(a){var b="",c=h.toDecimal(a);a=parseInt(c);for(var c=c-a,d=0,f=0;0<a;)(d=a%60)&&(b=d+" * 60^"+f+(b?" + ":"")+b),a=(a-d)/60,f++;for(f=-1;0<
c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+f),f--);return b?b:"0"};h.traceSternBrocot=function(a){var b="";if(h.equals(a,h.ZERO)||h.equals(a,h.ONE)||h.equals(a,h.INFINITY)||h.equals(a,h.INFINULL))return b;a=h.clone(a);h.isNegative(a)&&(a[0]=a[0].negate());for(var c=h.clone(h.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=0,l=0,g=65536;!h.equals(a,c)&&g--;)h.isLessThan(a,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),l++,f&&(b+="R",1!==f&&(b+=f),f=
0,b+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),f++,l&&(b+="L",1!==l&&(b+=l),l=0,b+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);l?(b+="L",1!==l&&(b+=l)):f&&(b+="R",1!==f&&(b+=f));0>g&&(b+="...");return b};h.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(h.equals(a,h.ZERO))return[0];if(h.equals(a,h.ONE))return[1];if(h.equals(a,h.NEGONE))return[-1];if(h.equals(a,h.INFINITY))return[1,0];if(h.equals(a,h.INFINULL))return[0,0];var c=h.clone(a),d=h.isNegative(c);d&&
(c[0]=c[0].negate());for(var f=h.clone(h.ONE),l=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=1,n=[0],k=n.length-1;!h.equals(c,f)&&b--;)h.isLessThan(c,f)?(-1===g?n[k]++:(g=-1,n.push(1),k++),l[0]=l[0].add(l[1]),l[2]=l[2].add(l[3])):(1===g?n[k]++:(g=1,n.push(1),k++),l[1]=l[1].add(l[0]),l[3]=l[3].add(l[2])),f[0]=l[0].add(l[1]),f[1]=l[2].add(l[3]);0>b?n.push(0):n[k]++;if(d)for(var q in n)n[q]=-n[q];return n};h.fromContinuedFraction=function(a,b){h.fromInteger_copy(a,b[b.length-1]);for(var c=
b.length-2;-1<c;c--)h.invert(a,a),h.add(a,h.fromInteger(b[c]),a);return a};h.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return h.fromInteger_copy(a,factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(h.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)h.scalar_multiply(a,a,++c);return a};h.dump=function(a){return"bigrat\t"+h.str(a)+"\n~\t"+h.toDecimal(a)+"\nCF:\t["+h.toContinuedFraction(a)+"]\n"};h.ZERO=h.fromInteger(0);h.ONE=h.fromInteger(1);h.NEGONE=h.fromInteger(-1);
h.INFINITY=h.fromValues(1,0);h.INFINULL=h.fromValues(0,0);h.INFINITESIMAL=h.clone([new BigInteger(1),k]);h.PI=h.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof a&&(a.bigrat=h);var q=function(a,b){this.a=f.fromValues(parseInt(a),parseInt(b))};q.prototype.toString=function(){return f.str(this.a)};q.prototype.toContinuedFraction=function(a){return f.toContinuedFraction(this.a,a)};q.prototype.invert=function(){return f.invert(this.a)};q.prototype.reciprocal=q.prototype.invert;q.prototype.add=function(a){var b=f.create();f.add(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.plus=q.prototype.add;q.prototype.subtract=function(a){var b=f.create();
f.sub(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.sub=q.prototype.subtract;q.prototype.minus=q.prototype.subtract;q.prototype.multiply=function(a){var b=f.create();f.mul(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.mul=q.prototype.multiply;q.prototype.times=q.prototype.multiply;q.prototype.mediant=function(a){var b=f.create();f.mediant(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.divide=function(a){var b=f.create();f.div(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.div=q.prototype.divide;
q.prototype.divided_by=q.prototype.divide;q.prototype.power=function(a){var b=f.create();f.pow(b,this.a,a);return new q(b[0],b[1])};q.prototype.pow=q.prototype.power;q.prototype.dump=function(){return f.dump(this.a)};q.prototype.toRat=function(){return f.clone(this.a)};q.prototype.toDecimal=function(){return f.toDecimal(this.a)};q.fromRat=function(a){var b=new q;b.a[0]=a[0];b.a[1]=a[1];return b};q.fromInteger=function(a){return q.fromRat(f.fromInteger(a))};q.fromIntegerInverse=function(a){return q.fromRat(f.fromIntegerInverse(a))};
q.fromDecimal=function(a){return q.fromRat(f.fromDecimal(a))};q.fromContinuedFraction=function(a){return q.fromRat(f.fromContinuedFraction(f.create(),a))};"undefined"!==typeof a&&(a.rational=q);var w={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<w.GREEK.length?w.GREEK[this.i++]:"?"}}};"undefined"!==typeof a&&(a.alpha=w);l={};l.FINE_STRUCTURE=h.fromValues(30223,4141639);
l.a=l.FINE_STRUCTURE;l.FINE_STRUCTURE_ALT=h.fromValues(13355891,1830237867);l.PLANK=h.fromValues(662606957,1E42);l.h=l.PLANK;l.hBAR=h.fromValues(1054571726,1E43);l.GRAVITATIONAL=h.fromValues(667384,1E16);l.G=l.GRAVITATIONAL;l.SPEED_OF_LIGHT=h.fromInteger(299792458);l.c=l.SPEED_OF_LIGHT;"undefined"!==typeof a&&(a.physics=l);var u={create:function(){return[[],[]]},fromValues:function(a){var b=u.create();b[0]=a.slice();a=u.countDimensions(b);for(b[1]=Array(a);a--;)b[1][a]=0;return u.normalize(b,b)},
mergeDimension:function(a,b,c){a[0]=[b.slice()];a[1].push(0);for(var d in c)a[0].push(c[d]);return a},evaluate:function(a,b,c){h.copy(a,h.ZERO);var d=u.countDimensions(b);if(0===d)return"0";if(1===d)for(var f in b[0]){if(b[0][f]){var d=h.fromInteger(b[0][f]),l=h.pow(h.create(),h.fromInteger(c[0]),b[1][0]+ +f);h.mul(d,d,l);h.add(a,a,d)}}else if(2===d)for(var g in b[0])for(f in b[0][g]){if(b[0][g][f]){var d=h.fromInteger(b[0][g][f]),l=h.pow(h.create(),h.fromInteger(c[0]),b[1][1]+ +f),n=h.pow(h.create(),
h.fromInteger(c[1]),b[1][0]+ +g);h.mul(d,d,l);h.mul(d,d,n);h.add(a,a,d)}}else if(3===d)for(var k in b[0])for(g in b[0][k])for(f in b[0][k][g]){if(b[0][k][g][f]){var d=h.fromInteger(b[0][k][g][f]),l=h.pow(h.create(),h.fromInteger(c[0]),b[1][2]+ +f),n=h.pow(h.create(),h.fromInteger(c[1]),b[1][1]+ +g),q=h.pow(h.create(),h.fromInteger(c[1]),b[1][0]+ +k);h.mul(d,d,l);h.mul(d,d,n);h.mul(d,d,q);h.add(a,a,d)}}else alert("unsupported dimension "+d);return a},derivatives:function(a){return[]},forEachNonZeroElement:function(a,
b){for(var c=a.slice(),d=0;"object"===typeof c[0];)c=c[0].slice(),d++;for(var h=d+1;0<h;--h){print(Array(h).join("[0]"));var c=eval("(a"+Array(h).join("[0]")+")"),f;for(f in c)for(var l=d+2;0<l;--l)print(c[f])}return""},str:function(a){var b="",c=new w.iterator,d=c.next(),h=c.next(),c=c.next(),f=u.countDimensions(a);if(0===f)b+=a.toString();else if(1===f)for(var l in a[0]){if(a[0][l]){b?b+=" "+(0>a[0][l]?"-":"+")+" ":0>a[0][l]&&(b+="-");var f=Math.abs(a[0][l]),g=a[1][0]+ +l;if(1!==f||0===g)b+=f;0!==
g&&(b+=d+(1===g?"":"<sup>"+g+"</sup>"))}}else if(2===f)for(var n in a[0])for(l in a[0][n]){if(a[0][n][l]){b?b+=" "+(0>a[0][n][l]?"-":"+")+" ":0>a[0][n][l]&&(b+="-");var f=Math.abs(a[0][n][l]),g=a[1][1]+ +l,k=a[1][0]+ +n;if(1!==f||0===k&&0===g)b+=f;0!==g&&(b+=d+(1===g?"":"<sup>"+g+"</sup>"));0!==k&&(b+=h+(1===k?"":"<sup>"+k+"</sup>"))}}else if(3===f)for(var q in a[0])for(n in a[0][q])for(l in a[0][q][n]){if(a[0][q][n][l]){b?b+=" "+(0>a[0][q][n][l]?"-":"+")+" ":0>a[0][q][n][l]&&(b+="-");var f=Math.abs(a[0][q][n][l]),
g=a[1][2]+ +l,k=a[1][1]+ +n,v=a[1][0]+ +q;if(1!==f||0===v&&0===k&&0===g)b+=f;0!==g&&(b+=d+(1===g?"":"<sup>"+g+"</sup>"));0!==k&&(b+=h+(1===k?"":"<sup>"+k+"</sup>"));0!==v&&(b+=c+(1===v?"":"<sup>"+v+"</sup>"))}}else alert("unsupported dimension "+f);""===b&&(b="0");return b},getJSFormula:function(a){var b="",c=u.countDimensions(a);if(0===c)return"0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d],c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var f in a[0])for(d in a[0][f]){if(a[0][f][d]){b&&
(b+="+");var b=b+a[0][f][d],c=a[1][1]+ +d,h=a[1][0]+ +f;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==h&&(b=1===h?b+"*m[1]":b+("*Math.pow(m[1],"+h+")"))}}else if(3===c)for(var l in a[0])for(f in a[0][l])for(d in a[0][l][f]){if(a[0][l][f][d]){b&&(b+="+");var b=b+a[0][l][f][d],c=a[1][2]+ +d,h=a[1][1]+ +f,g=a[1][0]+ +l;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==h&&(b=1===h?b+"*m[1]":b+("*Math.pow(m[1],"+h+")"));0!==g&&(b=1===g?b+"*m[2]":b+("*Math.pow(m[2],"+g+")"))}}else alert("unsupported dimension "+
c);""===b&&(b="0");return b}};String.prototype.repeat=function(a){return Array(a+1).join(this)};u.getGLSLFormula=function(a){var b="",c=u.countDimensions(a);if(0===c)return"0.0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d]+".0",c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var f in a[0])for(d in a[0][f]){if(a[0][f][d]){b&&(b+="+");var b=b+(a[0][f][d]+".0"),c=a[1][1]+ +d,h=a[1][0]+ +f;0!==c&&(b=1===
c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==h&&(b=1===h?b+"*m_1":1<h?b+"*m_1".repeat(h):b+("*pow(1.0"+"*m_1".repeat(Math.abs(h))+",-1.0)"))}}else alert("unsupported dimension "+c);""===b&&(b="0.0");return b};u.toJSON=function(a){return JSON.stringify(a)};u.fromJSON=function(a){return JSON.parse(a)};u.normalize=function(a,b){return b};u.binary_operation=function(a,b,c,d){a=u.create();var f=u.countDimensions(b),h=u.countDimensions(c);b[1][l]!==c[1][l]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===f&&1===h){for(var l in b[0])a[0][l]="undefined"===typeof c[0][l]?b[0][l]:d(b[0][l],c[0][l]);for(l in c[0])"undefined"===typeof b[0][l]&&(a[0][l]=c[0][l]);for(l in a[0])"undefined"===typeof b[0][l]&&"undefined"===typeof c[0][l]&&(a[0][l]=null)}else alert("unsupported dimension "+f);for(l=f;l--;)a[1][l]=b[1][l];return a};u.add=function(a,b,c){return u.binary_operation(a,b,c,function(a,b){return a+b})};u.subtract=function(a,
b,c){return u.binary_operation(a,b,c,function(a,b){return a-b})};u.sub=u.subtract;u.multiply=function(a,b,c){return a};u.mul=u.multiply;u.divide=function(a,b,c){return a};u.div=u.divide;u.equals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};u.countDimensions=function(a){return"object"===typeof a[0]?u._countDimensions(a[0],1):0};u._countDimensions=function(a,b){return"object"===typeof a[0]?u._countDimensions(a[0],++b):b};u.ZERO=u.fromValues([0]);u.IDENTITY=u.fromValues([1]);u.ONE=u.IDENTITY;"undefined"!==
typeof a&&(a.polyrat=u)})(k)})(this);/*
   Copyright 2008-2014 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
*/
(function(g,k,a){(function(a){"function"===typeof define&&define.amd?define("datatables",["jquery"],a):"object"===typeof exports?a(require("jquery")):jQuery&&!jQuery.fn.dataTable&&a(jQuery)})(function(d){function c(a){var b,e,m={};d.each(a,function(d,f){(b=d.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(b[1]+" ")&&(e=d.replace(b[0],b[2].toLowerCase()),m[e]=d,"o"===b[1]&&c(a[d]))});a._hungarianMap=m}function b(U,e,m){U._hungarianMap||c(U);var f;d.each(e,function(c,h){f=U._hungarianMap[c];
f===a||!m&&e[f]!==a||("o"===f.charAt(0)?(e[f]||(e[f]={}),d.extend(!0,e[f],e[c]),b(U[f],e[f],m)):e[f]=e[c])})}function l(a){var b=z.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&c&&"No data available in table"===b.sEmptyTable&&ga(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&c&&"Loading..."===b.sLoadingRecords&&ga(a,a,"sZeroRecords","sLoadingRecords");a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&bb(a)}function n(a){aa(a,"ordering","bSort");aa(a,"orderMulti","bSortMulti");
aa(a,"orderClasses","bSortClasses");aa(a,"orderCellsTop","bSortCellsTop");aa(a,"order","aaSorting");aa(a,"orderFixed","aaSortingFixed");aa(a,"paging","bPaginate");aa(a,"pagingType","sPaginationType");aa(a,"pageLength","iDisplayLength");aa(a,"searching","bFilter");if(a=a.aoSearchCols)for(var c=0,e=a.length;c<e;c++)a[c]&&b(z.models.oSearch,a[c])}function f(a){aa(a,"orderable","bSortable");aa(a,"orderData","aDataSort");aa(a,"orderSequence","asSorting");aa(a,"orderDataType","sortDataType")}function v(a){a=
a.oBrowser;var b=d("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(d("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(d('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body"),c=b.find(".test");a.bScrollOversize=100===c[0].offsetWidth;a.bScrollbarLeft=1!==c.offset().left;b.remove()}function p(b,c,e,d,m,f){var h,l=!1;e!==a&&(h=e,l=!0);for(;d!==m;)b.hasOwnProperty(d)&&(h=l?c(h,b[d],d,b):b[d],l=!0,d+=f);return h}
function h(a,b){var c=z.defaults.column,e=a.aoColumns.length,c=d.extend({},z.models.oColumn,c,{nTh:b?b:k.createElement("th"),sTitle:c.sTitle?c.sTitle:b?b.innerHTML:"",aDataSort:c.aDataSort?c.aDataSort:[e],mData:c.mData?c.mData:e,idx:e});a.aoColumns.push(c);c=a.aoPreSearchCols;c[e]=d.extend({},z.models.oSearch,c[e]);q(a,e,null)}function q(c,e,m){e=c.aoColumns[e];var h=c.oClasses,l=d(e.nTh);if(!e.sWidthOrig){e.sWidthOrig=l.attr("width")||null;var g=(l.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);
g&&(e.sWidthOrig=g[1])}m!==a&&null!==m&&(f(m),b(z.defaults.column,m),m.mDataProp===a||m.mData||(m.mData=m.mDataProp),m.sType&&(e._sManualType=m.sType),m.className&&!m.sClass&&(m.sClass=m.className),d.extend(e,m),ga(e,m,"sWidth","sWidthOrig"),"number"===typeof m.iDataSort&&(e.aDataSort=[m.iDataSort]),ga(e,m,"aDataSort"));var n=e.mData,t=D(n),k=e.mRender?D(e.mRender):null;m=function(a){return"string"===typeof a&&-1!==a.indexOf("@")};e._bAttrSrc=d.isPlainObject(n)&&(m(n.sort)||m(n.type)||m(n.filter));
e.fnGetData=function(b,c,e){var U=t(b,c,a,e);return k&&c?k(U,c,b,e):U};e.fnSetData=function(a,b,c){return K(n)(a,b,c)};"number"!==typeof n&&(c._rowReadObject=!0);c.oFeatures.bSort||(e.bSortable=!1,l.addClass(h.sSortableNone));c=-1!==d.inArray("asc",e.asSorting);m=-1!==d.inArray("desc",e.asSorting);e.bSortable&&(c||m)?c&&!m?(e.sSortingClass=h.sSortableAsc,e.sSortingClassJUI=h.sSortJUIAscAllowed):!c&&m?(e.sSortingClass=h.sSortableDesc,e.sSortingClassJUI=h.sSortJUIDescAllowed):(e.sSortingClass=h.sSortable,
e.sSortingClassJUI=h.sSortJUI):(e.sSortingClass=h.sSortableNone,e.sSortingClassJUI="")}function w(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Ka(a);for(var c=0,e=b.length;c<e;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;""===b.sY&&""===b.sX||sa(a);T(a,null,"column-sizing",[a])}function u(a,b){var c=A(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function e(a,b){var c=A(a,"bVisible"),c=d.inArray(b,c);return-1!==c?c:null}function r(a){return A(a,"bVisible").length}function A(a,b){var c=
[];d.map(a.aoColumns,function(a,e){a[b]&&c.push(e)});return c}function F(b){var c=b.aoColumns,e=b.aoData,d=z.ext.type.detect,m,f,h,l,g,n,t,k,x;m=0;for(f=c.length;m<f;m++)if(t=c[m],x=[],!t.sType&&t._sManualType)t.sType=t._sManualType;else if(!t.sType){h=0;for(l=d.length;h<l;h++){g=0;for(n=e.length;g<n;g++){x[g]===a&&(x[g]=B(b,g,m,"type"));k=d[h](x[g],b);if(!k&&h!==d.length-1)break;if("html"===k)break}if(k){t.sType=k;break}}t.sType||(t.sType="string")}}function G(b,c,e,m){var f,l,g,n,t,k,x=b.aoColumns;
if(c)for(f=c.length-1;0<=f;f--){k=c[f];var q=k.targets!==a?k.targets:k.aTargets;d.isArray(q)||(q=[q]);l=0;for(g=q.length;l<g;l++)if("number"===typeof q[l]&&0<=q[l]){for(;x.length<=q[l];)h(b);m(q[l],k)}else if("number"===typeof q[l]&&0>q[l])m(x.length+q[l],k);else if("string"===typeof q[l])for(n=0,t=x.length;n<t;n++)("_all"==q[l]||d(x[n].nTh).hasClass(q[l]))&&m(n,k)}if(e)for(f=0,b=e.length;f<b;f++)m(f,e[f])}function y(a,b,c,e){var m=a.aoData.length,f=d.extend(!0,{},z.models.oRow,{src:c?"dom":"data"});
f._aData=b;a.aoData.push(f);b=a.aoColumns;for(var f=0,h=b.length;f<h;f++)c&&C(a,m,f,B(a,m,f)),b[f].sType=null;a.aiDisplayMaster.push(m);!c&&a.oFeatures.bDeferRender||J(a,m,c,e);return m}function H(a,b){var c;b instanceof d||(b=d(b));return b.map(function(b,e){c=x(a,e);return y(a,c.data,e,c.cells)})}function B(b,c,e,d){var m=b.iDraw,f=b.aoColumns[e],h=b.aoData[c]._aData,l=f.sDefaultContent;e=f.fnGetData(h,d,{settings:b,row:c,col:e});if(e===a)return b.iDrawError!=m&&null===l&&(ma(b,0,"Requested unknown parameter "+
("function"==typeof f.mData?"{function}":"'"+f.mData+"'")+" for row "+c,4),b.iDrawError=m),l;if((e===h||null===e)&&null!==l)e=l;else if("function"===typeof e)return e.call(h);return null===e&&"display"==d?"":e}function C(a,b,c,e){a.aoColumns[c].fnSetData(a.aoData[b]._aData,e,{settings:a,row:b,col:c})}function E(a){return d.map(a.match(/(\\.|[^\.])+/g),function(a){return a.replace(/\\./g,".")})}function D(b){if(d.isPlainObject(b)){var c={};d.each(b,function(a,b){b&&(c[a]=D(b))});return function(b,
e,d,U){var m=c[e]||c._;return m!==a?m(b,e,d,U):b}}if(null===b)return function(a){return a};if("function"===typeof b)return function(a,c,e,d){return b(a,c,e,d)};if("string"!==typeof b||-1===b.indexOf(".")&&-1===b.indexOf("[")&&-1===b.indexOf("("))return function(a,c){return a[b]};var e=function(b,c,d){var U,m;if(""!==d){m=E(d);for(var f=0,h=m.length;f<h;f++){d=m[f].match(ta);U=m[f].match(na);if(d){m[f]=m[f].replace(ta,"");""!==m[f]&&(b=b[m[f]]);U=[];m.splice(0,f+1);m=m.join(".");f=0;for(h=b.length;f<
h;f++)U.push(e(b[f],c,m));b=d[0].substring(1,d[0].length-1);b=""===b?U:U.join(b);break}else if(U){m[f]=m[f].replace(na,"");b=b[m[f]]();continue}if(null===b||b[m[f]]===a)return a;b=b[m[f]]}}return b};return function(a,c){return e(a,c,b)}}function K(b){if(d.isPlainObject(b))return K(b._);if(null===b)return function(){};if("function"===typeof b)return function(a,c,e){b(a,"set",c,e)};if("string"!==typeof b||-1===b.indexOf(".")&&-1===b.indexOf("[")&&-1===b.indexOf("("))return function(a,c){a[b]=c};var c=
function(b,e,d){d=E(d);var m;m=d[d.length-1];for(var U,f,h=0,l=d.length-1;h<l;h++){U=d[h].match(ta);f=d[h].match(na);if(U){d[h]=d[h].replace(ta,"");b[d[h]]=[];m=d.slice();m.splice(0,h+1);U=m.join(".");f=0;for(l=e.length;f<l;f++)m={},c(m,e[f],U),b[d[h]].push(m);return}f&&(d[h]=d[h].replace(na,""),b=b[d[h]](e));if(null===b[d[h]]||b[d[h]]===a)b[d[h]]={};b=b[d[h]]}if(m.match(na))b[m.replace(na,"")](e);else b[m.replace(ta,"")]=e};return function(a,e){return c(a,e,b)}}function L(a){return fa(a.aoData,"_aData")}
function P(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0}function m(b,c,e){for(var d=-1,m=0,f=b.length;m<f;m++)b[m]==c?d=m:b[m]>c&&b[m]--; -1!=d&&e===a&&b.splice(d,1)}function t(b,c,e,d){var m=b.aoData[c],f,h=function(a,e){for(;a.childNodes.length;)a.removeChild(a.firstChild);a.innerHTML=B(b,c,e,"display")};if("dom"!==e&&(e&&"auto"!==e||"dom"!==m.src)){var l=m.anCells;if(l)if(d!==a)h(l[d],d);else for(e=0,f=l.length;e<f;e++)h(l[e],e)}else m._aData=x(b,m,d,d===a?a:m._aData).data;
m._aSortData=null;m._aFilterData=null;h=b.aoColumns;if(d!==a)h[d].sType=null;else{e=0;for(f=h.length;e<f;e++)h[e].sType=null;S(m)}}function x(b,c,e,m){var f=[],h=c.firstChild,l,g=0,n,t=b.aoColumns,k=b._rowReadObject;m=m||k?{}:[];var x=function(a,b){if("string"===typeof a){var c=a.indexOf("@");-1!==c&&(c=a.substring(c+1),K(a)(m,b.getAttribute(c)))}};b=function(b){if(e===a||e===g)l=t[g],n=d.trim(b.innerHTML),l&&l._bAttrSrc?(K(l.mData._)(m,n),x(l.mData.sort,b),x(l.mData.type,b),x(l.mData.filter,b)):
k?(l._setter||(l._setter=K(l.mData)),l._setter(m,n)):m[g]=n;g++};if(h)for(;h;){c=h.nodeName.toUpperCase();if("TD"==c||"TH"==c)b(h),f.push(h);h=h.nextSibling}else for(f=c.anCells,h=0,c=f.length;h<c;h++)b(f[h]);return{data:m,cells:f}}function J(a,b,c,e){var d=a.aoData[b],m=d._aData,f=[],h,l,g,n,t;if(null===d.nTr){h=c||k.createElement("tr");d.nTr=h;d.anCells=f;h._DT_RowIndex=b;S(d);n=0;for(t=a.aoColumns.length;n<t;n++){g=a.aoColumns[n];l=c?e[n]:k.createElement(g.sCellType);f.push(l);if(!c||g.mRender||
g.mData!==n)l.innerHTML=B(a,b,n,"display");g.sClass&&(l.className+=" "+g.sClass);g.bVisible&&!c?h.appendChild(l):!g.bVisible&&c&&l.parentNode.removeChild(l);g.fnCreatedCell&&g.fnCreatedCell.call(a.oInstance,l,B(a,b,n),m,b,n)}T(a,"aoRowCreatedCallback",null,[h,m,b])}d.nTr.setAttribute("role","row")}function S(a){var b=a.nTr,c=a._aData;if(b){c.DT_RowId&&(b.id=c.DT_RowId);if(c.DT_RowClass){var e=c.DT_RowClass.split(" ");a.__rowc=a.__rowc?La(a.__rowc.concat(e)):e;d(b).removeClass(a.__rowc.join(" ")).addClass(c.DT_RowClass)}c.DT_RowData&&
d(b).data(c.DT_RowData)}}function R(a){var b,c,e,m,f,h=a.nTHead,l=a.nTFoot,g=0===d("th, td",h).length,n=a.oClasses,t=a.aoColumns;g&&(m=d("<tr/>").appendTo(h));b=0;for(c=t.length;b<c;b++)f=t[b],e=d(f.nTh).addClass(f.sClass),g&&e.appendTo(m),a.oFeatures.bSort&&(e.addClass(f.sSortingClass),!1!==f.bSortable&&(e.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Ma(a,f.nTh,b))),f.sTitle!=e.html()&&e.html(f.sTitle),Na(a,"header")(a,e,f,n);g&&da(a.aoHeader,h);d(h).find(">tr").attr("role","row");
d(h).find(">tr>th, >tr>td").addClass(n.sHeaderTH);d(l).find(">tr>th, >tr>td").addClass(n.sFooterTH);if(null!==l)for(a=a.aoFooter[0],b=0,c=a.length;b<c;b++)f=t[b],f.nTf=a[b].cell,f.sClass&&d(f.nTf).addClass(f.sClass)}function N(b,c,e){var m,f,h,l=[],g=[],n=b.aoColumns.length,t;if(c){e===a&&(e=!1);m=0;for(f=c.length;m<f;m++){l[m]=c[m].slice();l[m].nTr=c[m].nTr;for(h=n-1;0<=h;h--)b.aoColumns[h].bVisible||e||l[m].splice(h,1);g.push([])}m=0;for(f=l.length;m<f;m++){if(b=l[m].nTr)for(;h=b.firstChild;)b.removeChild(h);
h=0;for(c=l[m].length;h<c;h++)if(t=n=1,g[m][h]===a){b.appendChild(l[m][h].cell);for(g[m][h]=1;l[m+n]!==a&&l[m][h].cell==l[m+n][h].cell;)g[m+n][h]=1,n++;for(;l[m][h+t]!==a&&l[m][h].cell==l[m][h+t].cell;){for(e=0;e<n;e++)g[m+e][h+t]=1;t++}d(l[m][h].cell).attr("rowspan",n).attr("colspan",t)}}}}function W(b){var c=T(b,"aoPreDrawCallback","preDraw",[b]);if(-1!==d.inArray(!1,c))ea(b,!1);else{var c=[],e=0,m=b.asStripeClasses,f=m.length,h=b.oLanguage,l=b.iInitDisplayStart,g="ssp"==ba(b),n=b.aiDisplay;b.bDrawing=
!0;l!==a&&-1!==l&&(b._iDisplayStart=g?l:l>=b.fnRecordsDisplay()?0:l,b.iInitDisplayStart=-1);var l=b._iDisplayStart,t=b.fnDisplayEnd();if(b.bDeferLoading)b.bDeferLoading=!1,b.iDraw++,ea(b,!1);else if(!g)b.iDraw++;else if(!b.bDestroying&&!oa(b))return;if(0!==n.length)for(h=g?b.aoData.length:t,g=g?0:l;g<h;g++){var k=n[g],x=b.aoData[k];null===x.nTr&&J(b,k);k=x.nTr;if(0!==f){var q=m[e%f];x._sRowStripe!=q&&(d(k).removeClass(x._sRowStripe).addClass(q),x._sRowStripe=q)}T(b,"aoRowCallback",null,[k,x._aData,
e,g]);c.push(k);e++}else e=h.sZeroRecords,1==b.iDraw&&"ajax"==ba(b)?e=h.sLoadingRecords:h.sEmptyTable&&0===b.fnRecordsTotal()&&(e=h.sEmptyTable),c[0]=d("<tr/>",{"class":f?m[0]:""}).append(d("<td />",{valign:"top",colSpan:r(b),"class":b.oClasses.sRowEmpty}).html(e))[0];T(b,"aoHeaderCallback","header",[d(b.nTHead).children("tr")[0],L(b),l,t,n]);T(b,"aoFooterCallback","footer",[d(b.nTFoot).children("tr")[0],L(b),l,t,n]);m=d(b.nTBody);m.children().detach();m.append(d(c));T(b,"aoDrawCallback","draw",[b]);
b.bSorted=!1;b.bFiltered=!1;b.bDrawing=!1}}function Z(a,b){var c=a.oFeatures,e=c.bFilter;c.bSort&&cb(a);e?la(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;W(a);a._drawHold=!1}function ca(a){var b=a.oClasses,c=d(a.nTable),c=d("<div/>").insertBefore(c),e=a.oFeatures,m=d("<div/>",{id:a.sTableId+"_wrapper","class":b.sWrapper+(a.nTFoot?"":" "+b.sNoFooter)});a.nHolding=c[0];a.nTableWrapper=m[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var f=
a.sDom.split(""),h,l,g,n,t,k,x=0;x<f.length;x++){h=null;l=f[x];if("<"==l){g=d("<div/>")[0];n=f[x+1];if("'"==n||'"'==n){t="";for(k=2;f[x+k]!=n;)t+=f[x+k],k++;"H"==t?t=b.sJUIHeader:"F"==t&&(t=b.sJUIFooter);-1!=t.indexOf(".")?(n=t.split("."),g.id=n[0].substr(1,n[0].length-1),g.className=n[1]):"#"==t.charAt(0)?g.id=t.substr(1,t.length-1):g.className=t;x+=k}m.append(g);m=d(g)}else if(">"==l)m=m.parent();else if("l"==l&&e.bPaginate&&e.bLengthChange)h=db(a);else if("f"==l&&e.bFilter)h=wa(a);else if("r"==
l&&e.bProcessing)h=eb(a);else if("t"==l)h=fb(a);else if("i"==l&&e.bInfo)h=gb(a);else if("p"==l&&e.bPaginate)h=hb(a);else if(0!==z.ext.feature.length)for(g=z.ext.feature,k=0,n=g.length;k<n;k++)if(l==g[k].cFeature){h=g[k].fnInit(a);break}h&&(g=a.aanFeatures,g[l]||(g[l]=[]),g[l].push(h),m.append(h))}c.replaceWith(m)}function da(a,b){var c=d(b).children("tr"),e,m,h,f,l,g,n,t,k,x;a.splice(0,a.length);h=0;for(g=c.length;h<g;h++)a.push([]);h=0;for(g=c.length;h<g;h++)for(e=c[h],m=e.firstChild;m;){if("TD"==
m.nodeName.toUpperCase()||"TH"==m.nodeName.toUpperCase()){t=1*m.getAttribute("colspan");k=1*m.getAttribute("rowspan");t=t&&0!==t&&1!==t?t:1;k=k&&0!==k&&1!==k?k:1;f=0;for(l=a[h];l[f];)f++;n=f;x=1===t?!0:!1;for(l=0;l<t;l++)for(f=0;f<k;f++)a[h+f][n+l]={cell:m,unique:x},a[h+f].nTr=e}m=m.nextSibling}}function ja(a,b,c){var e=[];c||(c=a.aoHeader,b&&(c=[],da(c,b)));b=0;for(var m=c.length;b<m;b++)for(var d=0,h=c[b].length;d<h;d++)!c[b][d].unique||e[d]&&a.bSortCellsTop||(e[d]=c[b][d].cell);return e}function ka(a,
b,c){T(a,"aoServerParams","serverParams",[b]);if(b&&d.isArray(b)){var e={},m=/(.*?)\[\]$/;d.each(b,function(a,b){var c=b.name.match(m);c?(c=c[0],e[c]||(e[c]=[]),e[c].push(b.value)):e[b.name]=b.value});b=e}var h,f=a.ajax,l=a.oInstance;if(d.isPlainObject(f)&&f.data){h=f.data;var g=d.isFunction(h)?h(b):h;b=d.isFunction(h)&&g?g:d.extend(!0,b,g);delete f.data}g={data:b,success:function(b){var e=b.error||b.sError;e&&a.oApi._fnLog(a,0,e);a.json=b;T(a,null,"xhr",[a,b]);c(b)},dataType:"json",cache:!1,type:a.sServerMethod,
error:function(b,c,e){e=a.oApi._fnLog;"parsererror"==c?e(a,0,"Invalid JSON response",1):4===b.readyState&&e(a,0,"Ajax error",7);ea(a,!1)}};a.oAjaxData=b;T(a,null,"preXhr",[a,b]);a.fnServerData?a.fnServerData.call(l,a.sAjaxSource,d.map(b,function(a,b){return{name:b,value:a}}),c,a):a.sAjaxSource||"string"===typeof f?a.jqXHR=d.ajax(d.extend(g,{url:f||a.sAjaxSource})):d.isFunction(f)?a.jqXHR=f.call(l,b,c,a):(a.jqXHR=d.ajax(d.extend(g,f)),f.data=h)}function oa(a){return a.bAjaxDataGet?(a.iDraw++,ea(a,
!0),ka(a,xa(a),function(b){ya(a,b)}),!1):!0}function xa(a){var b=a.aoColumns,c=b.length,e=a.oFeatures,m=a.oPreviousSearch,h=a.aoPreSearchCols,f,l=[],g,n,t,k=pa(a);f=a._iDisplayStart;g=!1!==e.bPaginate?a._iDisplayLength:-1;var x=function(a,b){l.push({name:a,value:b})};x("sEcho",a.iDraw);x("iColumns",c);x("sColumns",fa(b,"sName").join(","));x("iDisplayStart",f);x("iDisplayLength",g);var q={draw:a.iDraw,columns:[],order:[],start:f,length:g,search:{value:m.sSearch,regex:m.bRegex}};for(f=0;f<c;f++)n=b[f],
t=h[f],g="function"==typeof n.mData?"function":n.mData,q.columns.push({data:g,name:n.sName,searchable:n.bSearchable,orderable:n.bSortable,search:{value:t.sSearch,regex:t.bRegex}}),x("mDataProp_"+f,g),e.bFilter&&(x("sSearch_"+f,t.sSearch),x("bRegex_"+f,t.bRegex),x("bSearchable_"+f,n.bSearchable)),e.bSort&&x("bSortable_"+f,n.bSortable);e.bFilter&&(x("sSearch",m.sSearch),x("bRegex",m.bRegex));e.bSort&&(d.each(k,function(a,b){q.order.push({column:b.col,dir:b.dir});x("iSortCol_"+a,b.col);x("sSortDir_"+
a,b.dir)}),x("iSortingCols",k.length));b=z.ext.legacy.ajax;return null===b?a.sAjaxSource?l:q:b?l:q}function ya(b,c){var e=function(b,e){return c[b]!==a?c[b]:c[e]},m=e("sEcho","draw"),d=e("iTotalRecords","recordsTotal"),e=e("iTotalDisplayRecords","recordsFiltered");if(m){if(1*m<b.iDraw)return;b.iDraw=1*m}P(b);b._iRecordsTotal=parseInt(d,10);b._iRecordsDisplay=parseInt(e,10);m=qa(b,c);d=0;for(e=m.length;d<e;d++)y(b,m[d]);b.aiDisplay=b.aiDisplayMaster.slice();b.bAjaxDataGet=!1;W(b);b._bInitComplete||
za(b,c);b.bAjaxDataGet=!0;ea(b,!1)}function qa(b,c){var e=d.isPlainObject(b.ajax)&&b.ajax.dataSrc!==a?b.ajax.dataSrc:b.sAjaxDataProp;return"data"===e?c.aaData||c[e]:""!==e?D(e)(c):c}function wa(a){var b=a.oClasses,c=a.sTableId,e=a.oLanguage,m=a.oPreviousSearch,f=a.aanFeatures,h='<input type="search" class="'+b.sFilterInput+'"/>',l=e.sSearch,l=l.match(/_INPUT_/)?l.replace("_INPUT_",h):l+h,b=d("<div/>",{id:f.f?null:c+"_filter","class":b.sFilter}).append(d("<label/>").append(l)),f=function(){var b=this.value?
this.value:"";b!=m.sSearch&&(la(a,{sSearch:b,bRegex:m.bRegex,bSmart:m.bSmart,bCaseInsensitive:m.bCaseInsensitive}),a._iDisplayStart=0,W(a))},h=null!==a.searchDelay?a.searchDelay:"ssp"===ba(a)?400:0,g=d("input",b).val(m.sSearch).attr("placeholder",e.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",h?Aa(f,h):f).bind("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",c);d(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{g[0]!==k.activeElement&&g.val(m.sSearch)}catch(e){}});
return b[0]}function la(b,c,e){var m=b.oPreviousSearch,d=b.aoPreSearchCols,f=function(a){m.sSearch=a.sSearch;m.bRegex=a.bRegex;m.bSmart=a.bSmart;m.bCaseInsensitive=a.bCaseInsensitive},h=function(b){return b.bEscapeRegex!==a?!b.bEscapeRegex:b.bRegex};F(b);if("ssp"!=ba(b)){ib(b,c.sSearch,e,h(c),c.bSmart,c.bCaseInsensitive);f(c);for(c=0;c<d.length;c++)jb(b,d[c].sSearch,c,h(d[c]),d[c].bSmart,d[c].bCaseInsensitive);Ba(b)}else f(c);b.bFiltered=!0;T(b,null,"search",[b])}function Ba(a){for(var b=z.ext.search,
c=a.aiDisplay,e,m,d=0,f=b.length;d<f;d++){for(var h=[],l=0,g=c.length;l<g;l++)m=c[l],e=a.aoData[m],b[d](a,e._aFilterData,m,e._aData,l)&&h.push(m);c.length=0;c.push.apply(c,h)}}function jb(a,b,c,e,m,d){if(""!==b){var f=a.aiDisplay;e=Oa(b,e,m,d);for(m=f.length-1;0<=m;m--)b=a.aoData[f[m]]._aFilterData[c],e.test(b)||f.splice(m,1)}}function ib(a,b,c,e,m,d){e=Oa(b,e,m,d);m=a.oPreviousSearch.sSearch;d=a.aiDisplayMaster;var f;0!==z.ext.search.length&&(c=!0);f=kb(a);if(0>=b.length)a.aiDisplay=d.slice();else{if(f||
c||m.length>b.length||0!==b.indexOf(m)||a.bSorted)a.aiDisplay=d.slice();b=a.aiDisplay;for(c=b.length-1;0<=c;c--)e.test(a.aoData[b[c]]._sFilterRow)||b.splice(c,1)}}function Oa(a,b,c,e){a=b?a:Ca(a);c&&(a="^(?=.*?"+d.map(a.match(/"[^"]+"|[^ ]+/g)||"",function(a){if('"'===a.charAt(0)){var b=a.match(/^"(.*)"$/);a=b?b[1]:a}return a.replace('"',"")}).join(")(?=.*?")+").*$");return new RegExp(a,e?"i":"")}function Ca(a){return a.replace(Jb,"\\$1")}function kb(a){var b=a.aoColumns,c,e,m,d,f,h,l,g,n=z.ext.type.search;
c=!1;e=0;for(d=a.aoData.length;e<d;e++)if(g=a.aoData[e],!g._aFilterData){h=[];m=0;for(f=b.length;m<f;m++)c=b[m],c.bSearchable?(l=B(a,e,m,"filter"),n[c.sType]&&(l=n[c.sType](l)),null===l&&(l=""),"string"!==typeof l&&l.toString&&(l=l.toString())):l="",l.indexOf&&-1!==l.indexOf("&")&&(Da.innerHTML=l,l=Kb?Da.textContent:Da.innerText),l.replace&&(l=l.replace(/[\r\n]/g,"")),h.push(l);g._aFilterData=h;g._sFilterRow=h.join("  ");c=!0}return c}function lb(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,
caseInsensitive:a.bCaseInsensitive}}function mb(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function gb(a){var b=a.sTableId,c=a.aanFeatures.i,e=d("<div/>",{"class":a.oClasses.sInfo,id:c?null:b+"_info"});c||(a.aoDrawCallback.push({fn:nb,sName:"information"}),e.attr("role","status").attr("aria-live","polite"),d(a.nTable).attr("aria-describedby",b+"_info"));return e[0]}function nb(a){var b=a.aanFeatures.i;if(0!==b.length){var c=a.oLanguage,e=a._iDisplayStart+
1,m=a.fnDisplayEnd(),f=a.fnRecordsTotal(),h=a.fnRecordsDisplay(),l=h?c.sInfo:c.sInfoEmpty;h!==f&&(l+=" "+c.sInfoFiltered);l+=c.sInfoPostFix;l=ob(a,l);c=c.fnInfoCallback;null!==c&&(l=c.call(a.oInstance,a,e,m,f,h,l));d(b).html(l)}}function ob(a,b){var c=a.fnFormatNumber,e=a._iDisplayStart+1,m=a._iDisplayLength,d=a.fnRecordsDisplay(),f=-1===m;return b.replace(/_START_/g,c.call(a,e)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,
d)).replace(/_PAGE_/g,c.call(a,f?1:Math.ceil(e/m))).replace(/_PAGES_/g,c.call(a,f?1:Math.ceil(d/m)))}function ua(a){var b,c,e=a.iInitDisplayStart,m=a.aoColumns,d;c=a.oFeatures;if(a.bInitialised){ca(a);R(a);N(a,a.aoHeader);N(a,a.aoFooter);ea(a,!0);c.bAutoWidth&&Ka(a);b=0;for(c=m.length;b<c;b++)d=m[b],d.sWidth&&(d.nTh.style.width=M(d.sWidth));Z(a);m=ba(a);"ssp"!=m&&("ajax"==m?ka(a,[],function(c){var m=qa(a,c);for(b=0;b<m.length;b++)y(a,m[b]);a.iInitDisplayStart=e;Z(a);ea(a,!1);za(a,c)},a):(ea(a,!1),
za(a)))}else setTimeout(function(){ua(a)},200)}function za(a,b){a._bInitComplete=!0;b&&w(a);T(a,"aoInitComplete","init",[a,b])}function Pa(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Qa(a);T(a,null,"length",[a,c])}function db(a){for(var b=a.oClasses,c=a.sTableId,e=a.aLengthMenu,m=d.isArray(e[0]),f=m?e[0]:e,e=m?e[1]:e,m=d("<select/>",{name:c+"_length","aria-controls":c,"class":b.sLengthSelect}),h=0,l=f.length;h<l;h++)m[0][h]=new Option(e[h],f[h]);var g=d("<div><label/></div>").addClass(b.sLength);
a.aanFeatures.l||(g[0].id=c+"_length");g.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",m[0].outerHTML));d("select",g).val(a._iDisplayLength).bind("change.DT",function(b){Pa(a,d(this).val());W(a)});d(a.nTable).bind("length.dt.DT",function(b,c,e){a===c&&d("select",g).val(e)});return g[0]}function hb(a){var b=a.sPaginationType,c=z.ext.pager[b],e="function"===typeof c,m=function(a){W(a)},b=d("<div/>").addClass(a.oClasses.sPaging+b)[0],f=a.aanFeatures;e||c.fnInit(a,b,m);f.p||(b.id=a.sTableId+
"_paginate",a.aoDrawCallback.push({fn:function(a){if(e){var b=a._iDisplayStart,d=a._iDisplayLength,h=a.fnRecordsDisplay(),l=-1===d,b=l?0:Math.ceil(b/d),d=l?1:Math.ceil(h/d),h=c(b,d),g,l=0;for(g=f.p.length;l<g;l++)Na(a,"pageButton")(a,f.p[l],l,h,b,d)}else c.fnUpdate(a,m)},sName:"pagination"}));return b}function Ra(a,b,c){var e=a._iDisplayStart,m=a._iDisplayLength,d=a.fnRecordsDisplay();0===d||-1===m?e=0:"number"===typeof b?(e=b*m,e>d&&(e=0)):"first"==b?e=0:"previous"==b?(e=0<=m?e-m:0,0>e&&(e=0)):"next"==
b?e+m<d&&(e+=m):"last"==b?e=Math.floor((d-1)/m)*m:ma(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==e;a._iDisplayStart=e;b&&(T(a,null,"page",[a]),c&&W(a));return b}function eb(a){return d("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function ea(a,b){a.oFeatures.bProcessing&&d(a.aanFeatures.r).css("display",b?"block":"none");T(a,null,"processing",[a,b])}function fb(a){var b=d(a.nTable);b.attr("role",
"grid");var c=a.oScroll;if(""===c.sX&&""===c.sY)return a.nTable;var e=c.sX,m=c.sY,f=a.oClasses,h=b.children("caption"),l=h.length?h[0]._captionSide:null,g=d(b[0].cloneNode(!1)),n=d(b[0].cloneNode(!1)),t=b.children("tfoot");c.sX&&"100%"===b.attr("width")&&b.removeAttr("width");t.length||(t=null);c=d("<div/>",{"class":f.sScrollWrapper}).append(d("<div/>",{"class":f.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:e?e?M(e):null:"100%"}).append(d("<div/>",{"class":f.sScrollHeadInner}).css({"box-sizing":"content-box",
width:c.sXInner||"100%"}).append(g.removeAttr("id").css("margin-left",0).append("top"===l?h:null).append(b.children("thead"))))).append(d("<div/>",{"class":f.sScrollBody}).css({overflow:"auto",height:m?M(m):null,width:e?M(e):null}).append(b));t&&c.append(d("<div/>",{"class":f.sScrollFoot}).css({overflow:"hidden",border:0,width:e?e?M(e):null:"100%"}).append(d("<div/>",{"class":f.sScrollFootInner}).append(n.removeAttr("id").css("margin-left",0).append("bottom"===l?h:null).append(b.children("tfoot")))));
var b=c.children(),k=b[0],f=b[1],x=t?b[2]:null;e&&d(f).scroll(function(a){a=this.scrollLeft;k.scrollLeft=a;t&&(x.scrollLeft=a)});a.nScrollHead=k;a.nScrollBody=f;a.nScrollFoot=x;a.aoDrawCallback.push({fn:sa,sName:"scrolling"});return c[0]}function sa(a){var b=a.oScroll,c=b.sX,e=b.sXInner,m=b.sY,f=b.iBarWidth,h=d(a.nScrollHead),l=h[0].style,g=h.children("div"),n=g[0].style,t=g.children("table"),g=a.nScrollBody,k=d(g),x=g.style,q=d(a.nScrollFoot).children("div"),w=q.children("table"),J=d(a.nTHead),v=
d(a.nTable),E=v[0],r=E.style,p=a.nTFoot?d(a.nTFoot):null,N=a.oBrowser,S=N.bScrollOversize,F,D,C,R,G,K=[],W=[],y=[],L,A=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};v.children("thead, tfoot").remove();G=J.clone().prependTo(v);F=J.find("tr");C=G.find("tr");G.find("th, td").removeAttr("tabindex");p&&(R=p.clone().prependTo(v),D=p.find("tr"),R=R.find("tr"));c||(x.width="100%",h[0].style.width="100%");d.each(ja(a,G),function(b,c){L=
u(a,b);c.style.width=a.aoColumns[L].sWidth});p&&ha(function(a){a.style.width=""},R);b.bCollapse&&""!==m&&(x.height=k[0].offsetHeight+J[0].offsetHeight+"px");h=v.outerWidth();""===c?(r.width="100%",S&&(v.find("tbody").height()>g.offsetHeight||"scroll"==k.css("overflow-y"))&&(r.width=M(v.outerWidth()-f))):""!==e?r.width=M(e):h==k.width()&&k.height()<v.height()?(r.width=M(h-f),v.outerWidth()>h-f&&(r.width=M(h))):r.width=M(h);h=v.outerWidth();ha(A,C);ha(function(a){y.push(a.innerHTML);K.push(M(d(a).css("width")))},
C);ha(function(a,b){a.style.width=K[b]},F);d(C).height(0);p&&(ha(A,R),ha(function(a){W.push(M(d(a).css("width")))},R),ha(function(a,b){a.style.width=W[b]},D),d(R).height(0));ha(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+y[b]+"</div>";a.style.width=K[b]},C);p&&ha(function(a,b){a.innerHTML="";a.style.width=W[b]},R);v.outerWidth()<h?(D=g.scrollHeight>g.offsetHeight||"scroll"==k.css("overflow-y")?h+f:h,S&&(g.scrollHeight>g.offsetHeight||"scroll"==k.css("overflow-y"))&&
(r.width=M(D-f)),""!==c&&""===e||ma(a,1,"Possible column misalignment",6)):D="100%";x.width=M(D);l.width=M(D);p&&(a.nScrollFoot.style.width=M(D));!m&&S&&(x.height=M(E.offsetHeight+f));m&&b.bCollapse&&(x.height=M(m),b=c&&E.offsetWidth>g.offsetWidth?f:0,E.offsetHeight<g.offsetHeight&&(x.height=M(E.offsetHeight+b)));b=v.outerWidth();t[0].style.width=M(b);n.width=M(b);t=v.height()>g.clientHeight||"scroll"==k.css("overflow-y");N="padding"+(N.bScrollbarLeft?"Left":"Right");n[N]=t?f+"px":"0px";p&&(w[0].style.width=
M(b),q[0].style.width=M(b),q[0].style[N]=t?f+"px":"0px");k.scroll();!a.bSorted&&!a.bFiltered||a._drawHold||(g.scrollTop=0)}function ha(a,b,c){for(var e=0,m=0,d=b.length,f,h;m<d;){f=b[m].firstChild;for(h=c?c[m].firstChild:null;f;)1===f.nodeType&&(c?a(f,h,e):a(f,e),e++),f=f.nextSibling,h=c?h.nextSibling:null;m++}}function Ka(a){var b=a.nTable,c=a.aoColumns,e=a.oScroll,m=e.sY,f=e.sX,h=e.sXInner,l=c.length,e=A(a,"bVisible"),n=d("th",a.nTHead),t=b.getAttribute("width"),k=b.parentNode,x=!1,q,u;for(q=0;q<
e.length;q++)u=c[e[q]],null!==u.sWidth&&(u.sWidth=pb(u.sWidthOrig,k),x=!0);if(x||f||m||l!=r(a)||l!=n.length){l=d(b).clone().empty().css("visibility","hidden").removeAttr("id").append(d(a.nTHead).clone(!1)).append(d(a.nTFoot).clone(!1)).append(d("<tbody><tr/></tbody>"));l.find("tfoot th, tfoot td").css("width","");var J=l.find("tbody tr"),n=ja(a,l.find("thead")[0]);for(q=0;q<e.length;q++)u=c[e[q]],n[q].style.width=null!==u.sWidthOrig&&""!==u.sWidthOrig?M(u.sWidthOrig):"";if(a.aoData.length)for(q=0;q<
e.length;q++)x=e[q],u=c[x],d(qb(a,x)).clone(!1).append(u.sContentPadding).appendTo(J);l.appendTo(k);f&&h?l.width(h):f?(l.css("width","auto"),l.width()<k.offsetWidth&&l.width(k.offsetWidth)):m?l.width(k.offsetWidth):t&&l.width(t);rb(a,l[0]);if(f){for(q=h=0;q<e.length;q++)u=c[e[q]],m=d(n[q]).outerWidth(),h+=null===u.sWidthOrig?m:parseInt(u.sWidth,10)+m-d(n[q]).width();l.width(M(h));b.style.width=M(h)}for(q=0;q<e.length;q++)if(u=c[e[q]],m=d(n[q]).width())u.sWidth=M(m);b.style.width=M(l.css("width"));
l.remove()}else for(q=0;q<l;q++)c[q].sWidth=M(n.eq(q).width());t&&(b.style.width=M(t));!t&&!f||a._reszEvt||(d(g).bind("resize.DT-"+a.sInstance,Aa(function(){w(a)})),a._reszEvt=!0)}function Aa(b,c){var e=c!==a?c:200,m,d;return function(){var c=this,f=+new Date,h=arguments;m&&f<m+e?(clearTimeout(d),d=setTimeout(function(){m=a;b.apply(c,h)},e)):m?(m=f,b.apply(c,h)):m=f}}function pb(a,b){if(!a)return 0;var c=d("<div/>").css("width",M(a)).appendTo(b||k.body),e=c[0].offsetWidth;c.remove();return e}function rb(a,
b){var c=a.oScroll;if(c.sX||c.sY)c=c.sX?0:c.iBarWidth,b.style.width=M(d(b).outerWidth()-c)}function qb(a,b){var c=sb(a,b);if(0>c)return null;var e=a.aoData[c];return e.nTr?e.anCells[b]:d("<td/>").html(B(a,c,b,"display"))[0]}function sb(a,b){for(var c,e=-1,m=-1,d=0,f=a.aoData.length;d<f;d++)c=B(a,d,b,"display")+"",c=c.replace(Lb,""),c.length>e&&(e=c.length,m=d);return m}function M(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function tb(){if(!z.__scrollbarWidth){var a=
d("<p/>").css({width:"100%",height:200,padding:0})[0],b=d("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(a).appendTo("body"),c=a.offsetWidth;b.css("overflow","scroll");a=a.offsetWidth;c===a&&(a=b[0].clientWidth);b.remove();z.__scrollbarWidth=c-a}return z.__scrollbarWidth}function pa(b){var c,e,m=[],f=b.aoColumns,h,l,g,n;c=b.aaSortingFixed;e=d.isPlainObject(c);var t=[];h=function(a){a.length&&!d.isArray(a[0])?t.push(a):
t.push.apply(t,a)};d.isArray(c)&&h(c);e&&c.pre&&h(c.pre);h(b.aaSorting);e&&c.post&&h(c.post);for(b=0;b<t.length;b++)for(n=t[b][0],h=f[n].aDataSort,c=0,e=h.length;c<e;c++)l=h[c],g=f[l].sType||"string",t[b]._idx===a&&(t[b]._idx=d.inArray(t[b][1],f[l].asSorting)),m.push({src:n,col:l,dir:t[b][1],index:t[b]._idx,type:g,formatter:z.ext.type.order[g+"-pre"]});return m}function cb(a){var b,c,e=[],m=z.ext.type.order,d=a.aoData,f=0,h,l=a.aiDisplayMaster,g;F(a);g=pa(a);b=0;for(c=g.length;b<c;b++)h=g[b],h.formatter&&
f++,ub(a,h.col);if("ssp"!=ba(a)&&0!==g.length){b=0;for(c=l.length;b<c;b++)e[l[b]]=b;f===g.length?l.sort(function(a,b){var c,m,f,h,l=g.length,n=d[a]._aSortData,t=d[b]._aSortData;for(f=0;f<l;f++)if(h=g[f],c=n[h.col],m=t[h.col],c=c<m?-1:c>m?1:0,0!==c)return"asc"===h.dir?c:-c;c=e[a];m=e[b];return c<m?-1:c>m?1:0}):l.sort(function(a,b){var c,f,h,l,n=g.length,t=d[a]._aSortData,k=d[b]._aSortData;for(h=0;h<n;h++)if(l=g[h],c=t[l.col],f=k[l.col],l=m[l.type+"-"+l.dir]||m["string-"+l.dir],c=l(c,f),0!==c)return c;
c=e[a];f=e[b];return c<f?-1:c>f?1:0})}a.bSorted=!0}function vb(a){var b,c,e=a.aoColumns,m=pa(a);a=a.oLanguage.oAria;for(var d=0,f=e.length;d<f;d++){c=e[d];var h=c.asSorting;b=c.sTitle.replace(/<.*?>/g,"");var l=c.nTh;l.removeAttribute("aria-sort");c.bSortable&&(0<m.length&&m[0].col==d?(l.setAttribute("aria-sort","asc"==m[0].dir?"ascending":"descending"),c=h[m[0].index+1]||h[0]):c=h[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);l.setAttribute("aria-label",b)}}function Sa(b,c,e,m){var f=b.aaSorting,
h=b.aoColumns[c].asSorting,l=function(b,c){var e=b._idx;e===a&&(e=d.inArray(b[1],h));return e+1<h.length?e+1:c?null:0};"number"===typeof f[0]&&(f=b.aaSorting=[f]);e&&b.oFeatures.bSortMulti?(e=d.inArray(c,fa(f,"0")),-1!==e?(c=l(f[e],!0),null===c?f.splice(e,1):(f[e][1]=h[c],f[e]._idx=c)):(f.push([c,h[0],0]),f[f.length-1]._idx=0)):f.length&&f[0][0]==c?(c=l(f[0]),f.length=1,f[0][1]=h[c],f[0]._idx=c):(f.length=0,f.push([c,h[0]]),f[0]._idx=0);Z(b);"function"==typeof m&&m(b)}function Ma(a,b,c,e){var m=a.aoColumns[c];
Ta(b,{},function(b){!1!==m.bSortable&&(a.oFeatures.bProcessing?(ea(a,!0),setTimeout(function(){Sa(a,c,b.shiftKey,e);"ssp"!==ba(a)&&ea(a,!1)},0)):Sa(a,c,b.shiftKey,e))})}function Ea(a){var b=a.aLastSort,c=a.oClasses.sSortColumn,e=pa(a),m=a.oFeatures,f,h;if(m.bSort&&m.bSortClasses){m=0;for(f=b.length;m<f;m++)h=b[m].src,d(fa(a.aoData,"anCells",h)).removeClass(c+(2>m?m+1:3));m=0;for(f=e.length;m<f;m++)h=e[m].src,d(fa(a.aoData,"anCells",h)).addClass(c+(2>m?m+1:3))}a.aLastSort=e}function ub(a,b){var c=
a.aoColumns[b],m=z.ext.order[c.sSortDataType],f;m&&(f=m.call(a.oInstance,a,b,e(a,b)));for(var d,h=z.ext.type.order[c.sType+"-pre"],l=0,g=a.aoData.length;l<g;l++)if(c=a.aoData[l],c._aSortData||(c._aSortData=[]),!c._aSortData[b]||m)d=m?f[l]:B(a,l,b,"sort"),c._aSortData[b]=h?h(d):d}function Fa(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var b={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:d.extend(!0,[],a.aaSorting),search:lb(a.oPreviousSearch),columns:d.map(a.aoColumns,function(b,
c){return{visible:b.bVisible,search:lb(a.aoPreSearchCols[c])}})};T(a,"aoStateSaveParams","stateSaveParams",[a,b]);a.oSavedState=b;a.fnStateSaveCallback.call(a.oInstance,a,b)}}function wb(a,b){var c,e,m=a.aoColumns;if(a.oFeatures.bStateSave){var f=a.fnStateLoadCallback.call(a.oInstance,a);if(f&&f.time&&(c=T(a,"aoStateLoadParams","stateLoadParams",[a,f]),-1===d.inArray(!1,c)&&(c=a.iStateDuration,!(0<c&&f.time<+new Date-1E3*c)&&m.length===f.columns.length))){a.oLoadedState=d.extend(!0,{},f);a._iDisplayStart=
f.start;a.iInitDisplayStart=f.start;a._iDisplayLength=f.length;a.aaSorting=[];d.each(f.order,function(b,c){a.aaSorting.push(c[0]>=m.length?[0,c[1]]:c)});d.extend(a.oPreviousSearch,mb(f.search));c=0;for(e=f.columns.length;c<e;c++){var h=f.columns[c];m[c].bVisible=h.visible;d.extend(a.aoPreSearchCols[c],mb(h.search))}T(a,"aoStateLoaded","stateLoaded",[a,f])}}}function Ga(a){var b=z.settings;a=d.inArray(a,fa(b,"nTable"));return-1!==a?b[a]:null}function ma(a,b,c,e){c="DataTables warning: "+(null!==a?
"table id="+a.sTableId+" - ":"")+c;e&&(c+=". For more information about this error, please see http://datatables.net/tn/"+e);if(b)g.console&&console.log&&console.log(c);else if(a=z.ext,"alert"==(a.sErrMode||a.errMode))alert(c);else throw Error(c);}function ga(b,c,e,m){d.isArray(e)?d.each(e,function(a,e){d.isArray(e)?ga(b,c,e[0],e[1]):ga(b,c,e)}):(m===a&&(m=e),c[e]!==a&&(b[m]=c[e]))}function xb(a,b,c){var e,m;for(m in b)b.hasOwnProperty(m)&&(e=b[m],d.isPlainObject(e)?(d.isPlainObject(a[m])||(a[m]=
{}),d.extend(!0,a[m],e)):c&&"data"!==m&&"aaData"!==m&&d.isArray(e)?a[m]=e.slice():a[m]=e);return a}function Ta(a,b,c){d(a).bind("click.DT",b,function(b){a.blur();c(b)}).bind("keypress.DT",b,function(a){13===a.which&&(a.preventDefault(),c(a))}).bind("selectstart.DT",function(){return!1})}function Y(a,b,c,e){c&&a[b].push({fn:c,sName:e})}function T(a,b,c,e){var m=[];b&&(m=d.map(a[b].slice().reverse(),function(b,c){return b.fn.apply(a.oInstance,e)}));null!==c&&d(a.nTable).trigger(c+".dt",e);return m}
function Qa(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),e=a._iDisplayLength;b>=c&&(b=c-e);b-=b%e;if(-1===e||0>b)b=0;a._iDisplayStart=b}function Na(a,b){var c=a.renderer,e=z.ext.renderer[b];return d.isPlainObject(c)&&c[b]?e[c[b]]||e._:"string"===typeof c?e[c]||e._:e._}function ba(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function Ua(a,b){var c=[],c=yb.numbers_length,e=Math.floor(c/2);b<=c?c=ra(0,b):a<=e?(c=ra(0,c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-e?c=ra(b-
(c-2),b):(c=ra(a-1,a+2),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function bb(a){d.each({num:function(b){return Ha(b,a)},"num-fmt":function(b){return Ha(b,a,Va)},"html-num":function(b){return Ha(b,a,Ia)},"html-num-fmt":function(b){return Ha(b,a,Ia,Va)}},function(b,c){V.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(V.type.search[b+a]=V.type.search.html)})}function zb(a){return function(){var b=[Ga(this[z.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));
return z.ext.internal[a].apply(this,b)}}var z,V,O,I,Q,Wa={},Ab=/[\r\n]/g,Ia=/<.*?>/g,Mb=/^[\w\+\-]/,Nb=/[\w\+\-]$/,Jb=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\|\$|\^|\-)/g,Va=/[',$\u00a3\u20ac\u00a5%\u2009\u202F]/g,ia=function(a){return a&&!0!==a&&"-"!==a?!1:!0},Bb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Cb=function(a,b){Wa[b]||(Wa[b]=new RegExp(Ca(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(Wa[b],"."):a},Xa=function(a,b,c){var e="string"===
typeof a;b&&e&&(a=Cb(a,b));c&&e&&(a=a.replace(Va,""));return ia(a)||!isNaN(parseFloat(a))&&isFinite(a)},Db=function(a,b,c){return ia(a)?!0:ia(a)||"string"===typeof a?Xa(a.replace(Ia,""),b,c)?!0:null:null},fa=function(b,c,e){var m=[],f=0,d=b.length;if(e!==a)for(;f<d;f++)b[f]&&b[f][c]&&m.push(b[f][c][e]);else for(;f<d;f++)b[f]&&m.push(b[f][c]);return m},va=function(b,c,e,m){var f=[],d=0,h=c.length;if(m!==a)for(;d<h;d++)b[c[d]][e]&&f.push(b[c[d]][e][m]);else for(;d<h;d++)f.push(b[c[d]][e]);return f},
ra=function(b,c){var e=[],m;c===a?(c=0,m=b):(m=c,c=b);for(var f=c;f<m;f++)e.push(f);return e},Eb=function(a){for(var b=[],c=0,e=a.length;c<e;c++)a[c]&&b.push(a[c]);return b},La=function(a){var b=[],c,e,m=a.length,f,d=0;e=0;a:for(;e<m;e++){c=a[e];for(f=0;f<d;f++)if(b[f]===c)continue a;b.push(c);d++}return b},aa=function(b,c,e){b[c]!==a&&(b[e]=b[c])},ta=/\[.*?\]$/,na=/\(\)$/,Da=d("<div>")[0],Kb=Da.textContent!==a,Lb=/<.*?>/g;z=function(c){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,
b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new O(Ga(this[V.iApiIndex])):new O(this)};this.fnAddData=function(b,c){var e=this.api(!0),m=d.isArray(b)&&(d.isArray(b[0])||d.isPlainObject(b[0]))?e.rows.add(b):e.row.add(b);(c===a||c)&&e.draw();return m.flatten().toArray()};this.fnAdjustColumnSizing=function(b){var c=this.api(!0).columns.adjust(),e=c.settings()[0],m=e.oScroll;b===a||b?c.draw(!1):""===m.sX&&""===m.sY||sa(e)};this.fnClearTable=function(b){var c=this.api(!0).clear();
(b===a||b)&&c.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(b,c,e){var m=this.api(!0);b=m.rows(b);var f=b.settings()[0],d=f.aoData[b[0][0]];b.remove();c&&c.call(this,f,d);(e===a||e)&&m.draw();return d};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(!a)};this.fnFilter=function(b,c,e,m,f,d){f=this.api(!0);null===c||c===a?f.search(b,e,m,d):f.column(c).search(b,e,m,d);f.draw()};this.fnGetData=function(b,c){var e=
this.api(!0);if(b!==a){var m=b.nodeName?b.nodeName.toLowerCase():"";return c!==a||"td"==m||"th"==m?e.cell(b,c).data():e.row(b).data()||null}return e.data().toArray()};this.fnGetNodes=function(b){var c=this.api(!0);return b!==a?c.row(b).node():c.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};
this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(b,c){var e=this.api(!0).page(b);(c===a||c)&&e.draw(!1)};this.fnSetColumnVis=function(b,c,e){b=this.api(!0).column(b).visible(c);(e===a||e)&&b.columns.adjust().draw()};this.fnSettings=function(){return Ga(this[V.iApiIndex])};this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(b,c,e,m,f){var d=
this.api(!0);e===a||null===e?d.row(c).data(b):d.cell(c,e).data(b);(f===a||f)&&d.columns.adjust();(m===a||m)&&d.draw();return 0};this.fnVersionCheck=V.fnVersionCheck;var e=this,m=c===a,g=this.length;m&&(c={});this.oApi=this.internal=V.internal;for(var t in z.ext.internal)t&&(this[t]=zb(t));this.each(function(){var t={},t=1<g?xb(t,c,!0):c,k=0,u,w=this.getAttribute("id"),J=!1,r=z.defaults;if("table"!=this.nodeName.toLowerCase())ma(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{n(r);
f(r.column);b(r,r,!0);b(r.column,r.column,!0);b(r,t);var E=z.settings,k=0;for(u=E.length;k<u;k++){if(E[k].nTable==this){u=t.bRetrieve!==a?t.bRetrieve:r.bRetrieve;if(m||u)return E[k].oInstance;if(t.bDestroy!==a?t.bDestroy:r.bDestroy){E[k].oInstance.fnDestroy();break}else{ma(E[k],0,"Cannot reinitialise DataTable",3);return}}if(E[k].sTableId==this.id){E.splice(k,1);break}}if(null===w||""===w)this.id=w="DataTables_Table_"+z.ext._unique++;var p=d.extend(!0,{},z.models.oSettings,{nTable:this,oApi:e.internal,
oInit:t,sDestroyWidth:d(this)[0].style.width,sInstance:w,sTableId:w});E.push(p);p.oInstance=1===e.length?e:d(this).dataTable();n(t);t.oLanguage&&l(t.oLanguage);t.aLengthMenu&&!t.iDisplayLength&&(t.iDisplayLength=d.isArray(t.aLengthMenu[0])?t.aLengthMenu[0][0]:t.aLengthMenu[0]);t=xb(d.extend(!0,{},r),t);ga(p.oFeatures,t,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));ga(p,t,["asStripeClasses","ajax","fnServerData","fnFormatNumber",
"sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);ga(p.oScroll,t,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);
ga(p.oLanguage,t,"fnInfoCallback");Y(p,"aoDrawCallback",t.fnDrawCallback,"user");Y(p,"aoServerParams",t.fnServerParams,"user");Y(p,"aoStateSaveParams",t.fnStateSaveParams,"user");Y(p,"aoStateLoadParams",t.fnStateLoadParams,"user");Y(p,"aoStateLoaded",t.fnStateLoaded,"user");Y(p,"aoRowCallback",t.fnRowCallback,"user");Y(p,"aoRowCreatedCallback",t.fnCreatedRow,"user");Y(p,"aoHeaderCallback",t.fnHeaderCallback,"user");Y(p,"aoFooterCallback",t.fnFooterCallback,"user");Y(p,"aoInitComplete",t.fnInitComplete,
"user");Y(p,"aoPreDrawCallback",t.fnPreDrawCallback,"user");w=p.oClasses;t.bJQueryUI?(d.extend(w,z.ext.oJUIClasses,t.oClasses),t.sDom===r.sDom&&"lfrtip"===r.sDom&&(p.sDom='<"H"lfr>t<"F"ip>'),p.renderer)?d.isPlainObject(p.renderer)&&!p.renderer.header&&(p.renderer.header="jqueryui"):p.renderer="jqueryui":d.extend(w,z.ext.classes,t.oClasses);d(this).addClass(w.sTable);if(""!==p.oScroll.sX||""!==p.oScroll.sY)p.oScroll.iBarWidth=tb();!0===p.oScroll.sX&&(p.oScroll.sX="100%");p.iInitDisplayStart===a&&(p.iInitDisplayStart=
t.iDisplayStart,p._iDisplayStart=t.iDisplayStart);null!==t.iDeferLoading&&(p.bDeferLoading=!0,k=d.isArray(t.iDeferLoading),p._iRecordsDisplay=k?t.iDeferLoading[0]:t.iDeferLoading,p._iRecordsTotal=k?t.iDeferLoading[1]:t.iDeferLoading);var N=p.oLanguage;d.extend(!0,N,t.oLanguage);""!==N.sUrl&&(d.ajax({dataType:"json",url:N.sUrl,success:function(a){l(a);b(r.oLanguage,a);d.extend(!0,N,a);ua(p)},error:function(){ua(p)}}),J=!0);null===t.asStripeClasses&&(p.asStripeClasses=[w.sStripeOdd,w.sStripeEven]);
var k=p.asStripeClasses,S=d("tbody tr:eq(0)",this);-1!==d.inArray(!0,d.map(k,function(a,b){return S.hasClass(a)}))&&(d("tbody tr",this).removeClass(k.join(" ")),p.asDestroyStripes=k.slice());var E=[],F,k=this.getElementsByTagName("thead");0!==k.length&&(da(p.aoHeader,k[0]),E=ja(p));if(null===t.aoColumns)for(F=[],k=0,u=E.length;k<u;k++)F.push(null);else F=t.aoColumns;k=0;for(u=F.length;k<u;k++)h(p,E?E[k]:null);G(p,t.aoColumnDefs,F,function(a,b){q(p,a,b)});if(S.length){var D=function(a,b){return a.getAttribute("data-"+
b)?b:null};d.each(x(p,S[0]).cells,function(b,c){var e=p.aoColumns[b];if(e.mData===b){var m=D(c,"sort")||D(c,"order"),f=D(c,"filter")||D(c,"search");if(null!==m||null!==f)e.mData={_:b+".display",sort:null!==m?b+".@data-"+m:a,type:null!==m?b+".@data-"+m:a,filter:null!==f?b+".@data-"+f:a},q(p,b)}})}var C=p.oFeatures;t.bStateSave&&(C.bStateSave=!0,wb(p,t),Y(p,"aoDrawCallback",Fa,"state_save"));if(t.aaSorting===a)for(E=p.aaSorting,k=0,u=E.length;k<u;k++)E[k][1]=p.aoColumns[k].asSorting[0];Ea(p);C.bSort&&
Y(p,"aoDrawCallback",function(){if(p.bSorted){var a=pa(p),b={};d.each(a,function(a,c){b[c.src]=c.dir});T(p,null,"order",[p,a,b]);vb(p)}});Y(p,"aoDrawCallback",function(){(p.bSorted||"ssp"===ba(p)||C.bDeferRender)&&Ea(p)},"sc");v(p);k=d(this).children("caption").each(function(){this._captionSide=d(this).css("caption-side")});u=d(this).children("thead");0===u.length&&(u=d("<thead/>").appendTo(this));p.nTHead=u[0];u=d(this).children("tbody");0===u.length&&(u=d("<tbody/>").appendTo(this));p.nTBody=u[0];
u=d(this).children("tfoot");0===u.length&&0<k.length&&(""!==p.oScroll.sX||""!==p.oScroll.sY)&&(u=d("<tfoot/>").appendTo(this));0===u.length||0===u.children().length?d(this).addClass(w.sNoFooter):0<u.length&&(p.nTFoot=u[0],da(p.aoFooter,p.nTFoot));if(t.aaData)for(k=0;k<t.aaData.length;k++)y(p,t.aaData[k]);else(p.bDeferLoading||"dom"==ba(p))&&H(p,d(p.nTBody).children("tr"));p.aiDisplay=p.aiDisplayMaster.slice();p.bInitialised=!0;!1===J&&ua(p)}});e=null;return this};var Fb=[],X=Array.prototype,Ob=function(a){var b,
c,e=z.settings,m=d.map(e,function(a,b){return a.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return b=d.inArray(a,m),-1!==b?[e[b]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?c=d(a):a instanceof d&&(c=a)}else return[];if(c)return c.map(function(a){b=d.inArray(this,m);return-1!==b?e[b]:null}).toArray()};O=function(a,b){if(!this instanceof O)throw"DT API must be constructed as a new object";var c=[],e=
function(a){(a=Ob(a))&&c.push.apply(c,a)};if(d.isArray(a))for(var m=0,f=a.length;m<f;m++)e(a[m]);else e(a);this.context=La(c);b&&this.push.apply(this,b.toArray?b.toArray():b);this.selector={rows:null,cols:null,opts:null};O.extend(this,this,Fb)};z.Api=O;O.prototype={concat:X.concat,context:[],each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new O(b[a],this[a]):null},filter:function(a){var b=[];if(X.filter)b=
X.filter.call(this,a,this);else for(var c=0,e=this.length;c<e;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new O(this.context,b)},flatten:function(){var a=[];return new O(this.context,a.concat.apply(a,this.toArray()))},join:X.join,indexOf:X.indexOf||function(a,b){for(var c=b||0,e=this.length;c<e;c++)if(this[c]===a)return c;return-1},iterator:function(b,c,e,m){var f=[],d,h,l,g,t,n=this.context,k,x,q=this.selector;"string"===typeof b&&(m=e,e=c,c=b,b=!1);h=0;for(l=n.length;h<l;h++){var u=
new O(n[h]);if("table"===c)d=e.call(u,n[h],h),d!==a&&f.push(d);else if("columns"===c||"rows"===c)d=e.call(u,n[h],this[h],h),d!==a&&f.push(d);else if("column"===c||"column-rows"===c||"row"===c||"cell"===c)for(x=this[h],"column-rows"===c&&(k=Ja(n[h],q.opts)),g=0,t=x.length;g<t;g++)d=x[g],d="cell"===c?e.call(u,n[h],d.row,d.column,h,g):e.call(u,n[h],d,h,g,k),d!==a&&f.push(d)}return f.length||m?(b=new O(n,b?f.concat.apply([],f):f),c=b.selector,c.rows=q.rows,c.cols=q.cols,c.opts=q.opts,b):this},lastIndexOf:X.lastIndexOf||
function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(X.map)b=X.map.call(this,a,this);else for(var c=0,e=this.length;c<e;c++)b.push(a.call(this,this[c],c));return new O(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},pop:X.pop,push:X.push,reduce:X.reduce||function(a,b){return p(this,a,b,0,this.length,1)},reduceRight:X.reduceRight||function(a,b){return p(this,a,b,this.length-1,-1,-1)},reverse:X.reverse,selector:null,
shift:X.shift,sort:X.sort,splice:X.splice,toArray:function(){return X.slice.call(this)},to$:function(){return d(this)},toJQuery:function(){return d(this)},unique:function(){return new O(this.context,La(this))},unshift:X.unshift};O.extend=function(a,b,c){if(b&&(b instanceof O||b.__dt_wrapper)){var e,m,f,h=function(a,b,c){return function(){var e=b.apply(a,arguments);O.extend(e,e,c.methodExt);return e}};e=0;for(m=c.length;e<m;e++)f=c[e],b[f.name]="function"===typeof f.val?h(a,f.val,f):d.isPlainObject(f.val)?
{}:f.val,b[f.name].__dt_wrapper=!0,O.extend(a,b[f.name],f.propExt)}};O.register=I=function(a,b){if(d.isArray(a))for(var c=0,e=a.length;c<e;c++)O.register(a[c],b);else for(var m=a.split("."),f=Fb,h,l,c=0,e=m.length;c<e;c++){h=(l=-1!==m[c].indexOf("()"))?m[c].replace("()",""):m[c];var g;a:{g=0;for(var t=f.length;g<t;g++)if(f[g].name===h){g=f[g];break a}g=null}g||(g={name:h,val:{},methodExt:[],propExt:[]},f.push(g));c===e-1?g.val=b:f=l?g.methodExt:g.propExt}};O.registerPlural=Q=function(b,c,e){O.register(b,
e);O.register(c,function(){var b=e.apply(this,arguments);return b===this?this:b instanceof O?b.length?d.isArray(b[0])?new O(b.context,b[0]):b[0]:a:b})};var Pb=function(a,b){if("number"===typeof a)return[b[a]];var c=d.map(b,function(a,b){return a.nTable});return d(c).filter(a).map(function(a){a=d.inArray(this,c);return b[a]}).toArray()};I("tables()",function(a){return a?new O(Pb(a,this.context)):this});I("table()",function(a){a=this.tables(a);var b=a.context;return b.length?new O(b[0]):a});Q("tables().nodes()",
"table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});Q("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});Q("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});Q("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});Q("tables().containers()","table().container()",function(){return this.iterator("table",
function(a){return a.nTableWrapper},1)});I("draw()",function(a){return this.iterator("table",function(b){Z(b,!1===a)})});I("page()",function(b){return b===a?this.page.info().page:this.iterator("table",function(a){Ra(a,b)})});I("page.info()",function(b){if(0===this.context.length)return a;b=this.context[0];var c=b._iDisplayStart,e=b._iDisplayLength,m=b.fnRecordsDisplay(),f=-1===e;return{page:f?0:Math.floor(c/e),pages:f?1:Math.ceil(m/e),start:c,end:b.fnDisplayEnd(),length:e,recordsTotal:b.fnRecordsTotal(),
recordsDisplay:m}});I("page.len()",function(b){return b===a?0!==this.context.length?this.context[0]._iDisplayLength:a:this.iterator("table",function(a){Pa(a,b)})});var Gb=function(a,b,c){"ssp"==ba(a)?Z(a,b):(ea(a,!0),ka(a,[],function(c){P(a);c=qa(a,c);for(var e=0,m=c.length;e<m;e++)y(a,c[e]);Z(a,b);ea(a,!1)}));if(c){var e=new O(a);e.one("draw",function(){c(e.ajax.json())})}};I("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});I("ajax.params()",function(){var a=this.context;
if(0<a.length)return a[0].oAjaxData});I("ajax.reload()",function(a,b){return this.iterator("table",function(c){Gb(c,!1===b,a)})});I("ajax.url()",function(b){var c=this.context;if(b===a){if(0===c.length)return a;c=c[0];return c.ajax?d.isPlainObject(c.ajax)?c.ajax.url:c.ajax:c.sAjaxSource}return this.iterator("table",function(a){d.isPlainObject(a.ajax)?a.ajax.url=b:a.ajax=b})});I("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Gb(c,!1===b,a)})});var Ya=function(b,c){var e=
[],m,f,h,l,g,t;m=typeof b;b&&"string"!==m&&"function"!==m&&b.length!==a||(b=[b]);h=0;for(l=b.length;h<l;h++)for(f=b[h]&&b[h].split?b[h].split(","):[b[h]],g=0,t=f.length;g<t;g++)(m=c("string"===typeof f[g]?d.trim(f[g]):f[g]))&&m.length&&e.push.apply(e,m);return e},Za=function(a){a||(a={});a.filter&&!a.search&&(a.search=a.filter);return{search:a.search||"none",order:a.order||"current",page:a.page||"all"}},$a=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a.length=1,a.context=
[a.context[b]],a;a.length=0;return a},Ja=function(a,b){var c,e,m,f=[],h=a.aiDisplay;c=a.aiDisplayMaster;var l=b.search;e=b.order;m=b.page;if("ssp"==ba(a))return"removed"===l?[]:ra(0,c.length);if("current"==m)for(c=a._iDisplayStart,e=a.fnDisplayEnd();c<e;c++)f.push(h[c]);else if("current"==e||"applied"==e)f="none"==l?c.slice():"applied"==l?h.slice():d.map(c,function(a,b){return-1===d.inArray(a,h)?a:null});else if("index"==e||"original"==e)for(c=0,e=a.aoData.length;c<e;c++)"none"==l?f.push(c):(m=d.inArray(c,
h),(-1===m&&"removed"==l||0<=m&&"applied"==l)&&f.push(c));return f},Qb=function(a,b,c){return Ya(b,function(b){var e=Bb(b);if(null!==e&&!c)return[e];var m=Ja(a,c);if(null!==e&&-1!==d.inArray(e,m))return[e];if(!b)return m;if("function"===typeof b)return d.map(m,function(c){var e=a.aoData[c];return b(c,e._aData,e.nTr)?c:null});e=Eb(va(a.aoData,m,"nTr"));return b.nodeName&&-1!==d.inArray(b,e)?[b._DT_RowIndex]:d(e).filter(b).map(function(){return this._DT_RowIndex}).toArray()})};I("rows()",function(b,
c){b===a?b="":d.isPlainObject(b)&&(c=b,b="");c=Za(c);var e=this.iterator("table",function(a){return Qb(a,b,c)},1);e.selector.rows=b;e.selector.opts=c;return e});I("rows().nodes()",function(){return this.iterator("row",function(b,c){return b.aoData[c].nTr||a},1)});I("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return va(a.aoData,b,"_aData")},1)});Q("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var e=b.aoData[c];return"search"===a?e._aFilterData:
e._aSortData},1)});Q("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){t(b,c,a)})});Q("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,b){return b},1)});Q("rows().remove()","row().remove()",function(){var a=this;return this.iterator("row",function(b,c,e){var f=b.aoData;f.splice(c,1);for(var h=0,l=f.length;h<l;h++)null!==f[h].nTr&&(f[h].nTr._DT_RowIndex=h);d.inArray(c,b.aiDisplay);m(b.aiDisplayMaster,c);m(b.aiDisplay,
c);m(a[e],c,!1);Qa(b)})});I("rows.add()",function(a){var b=this.iterator("table",function(b){var c,e,m,f=[];e=0;for(m=a.length;e<m;e++)c=a[e],c.nodeName&&"TR"===c.nodeName.toUpperCase()?f.push(H(b,c)[0]):f.push(y(b,c));return f},1),c=this.rows(-1);c.pop();c.push.apply(c,b.toArray());return c});I("row()",function(a,b){return $a(this.rows(a,b))});I("row().data()",function(b){var c=this.context;if(b===a)return c.length&&this.length?c[0].aoData[this[0]]._aData:a;c[0].aoData[this[0]]._aData=b;t(c[0],this[0],
"data");return this});I("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});I("row.add()",function(a){a instanceof d&&a.length&&(a=a[0]);var b=this.iterator("table",function(b){return a.nodeName&&"TR"===a.nodeName.toUpperCase()?H(b,a)[0]:y(b,a)});return this.row(b[0])});var Rb=function(a,b,c,e){var m=[],f=function(b,c){if(b.nodeName&&"tr"===b.nodeName.toLowerCase())m.push(b);else{var e=d("<tr><td/></tr>").addClass(c);d("td",e).addClass(c).html(b)[0].colSpan=
r(a);m.push(e[0])}};if(d.isArray(c)||c instanceof d)for(var h=0,l=c.length;h<l;h++)f(c[h],e);else f(c,e);b._details&&b._details.remove();b._details=d(m);b._detailsShow&&b._details.insertAfter(b.nTr)},ab=function(b,c){var e=b.context;e.length&&(e=e[0].aoData[c!==a?c:b[0]],e._details&&(e._details.remove(),e._detailsShow=a,e._details=a))},Hb=function(a,b){var c=a.context;if(c.length&&a.length){var e=c[0].aoData[a[0]];e._details&&((e._detailsShow=b)?e._details.insertAfter(e.nTr):e._details.detach(),Sb(c[0]))}},
Sb=function(a){var b=new O(a),c=a.aoData;b.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<fa(c,"_details").length&&(b.on("draw.dt.DT_details",function(e,m){a===m&&b.rows({page:"current"}).eq(0).each(function(a){a=c[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),b.on("column-visibility.dt.DT_details",function(b,e,m,f){if(a===e)for(e=r(e),m=0,f=c.length;m<f;m++)b=c[m],b._details&&b._details.children("td[colspan]").attr("colspan",e)}),b.on("destroy.dt.DT_details",
function(e,m){if(a===m)for(var f=0,d=c.length;f<d;f++)c[f]._details&&ab(b,f)}))};I("row().child()",function(b,c){var e=this.context;if(b===a)return e.length&&this.length?e[0].aoData[this[0]]._details:a;!0===b?this.child.show():!1===b?ab(this):e.length&&this.length&&Rb(e[0],e[0].aoData[this[0]],b,c);return this});I(["row().child.show()","row().child().show()"],function(a){Hb(this,!0);return this});I(["row().child.hide()","row().child().hide()"],function(){Hb(this,!1);return this});I(["row().child.remove()",
"row().child().remove()"],function(){ab(this);return this});I("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Tb=/^(.+):(name|visIdx|visible)$/,Ib=function(a,b,c,e,m){c=[];e=0;for(var f=m.length;e<f;e++)c.push(B(a,m[e],b));return c},Ub=function(a,b,c){var e=a.aoColumns,m=fa(e,"sName"),f=fa(e,"nTh");return Ya(b,function(b){var h=Bb(b);if(""===b)return ra(e.length);if(null!==h)return[0<=h?h:e.length+h];if("function"===
typeof b){var l=Ja(a,c);return d.map(e,function(c,e){return b(e,Ib(a,e,0,0,l),f[e])?e:null})}var g="string"===typeof b?b.match(Tb):"";if(g)switch(g[2]){case "visIdx":case "visible":h=parseInt(g[1],10);if(0>h){var t=d.map(e,function(a,b){return a.bVisible?b:null});return[t[t.length+h]]}return[u(a,h)];case "name":return d.map(m,function(a,b){return a===g[1]?b:null})}else return d(f).filter(b).map(function(){return d.inArray(this,f)}).toArray()})};I("columns()",function(b,c){b===a?b="":d.isPlainObject(b)&&
(c=b,b="");c=Za(c);var e=this.iterator("table",function(a){return Ub(a,b,c)},1);e.selector.cols=b;e.selector.opts=c;return e});Q("columns().header()","column().header()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});Q("columns().footer()","column().footer()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});Q("columns().data()","column().data()",function(){return this.iterator("column-rows",Ib,1)});Q("columns().dataSrc()",
"column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});Q("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,e,m,f){return va(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});Q("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,e,m){return va(a.aoData,m,"anCells",b)},1)});Q("columns().visible()","column().visible()",function(b,c){return this.iterator("column",
function(e,m){if(b===a)return e.aoColumns[m].bVisible;var f=e.aoColumns,h=f[m],l=e.aoData,g,t,n;if(b!==a&&h.bVisible!==b){if(b){var k=d.inArray(!0,fa(f,"bVisible"),m+1);g=0;for(t=l.length;g<t;g++)n=l[g].nTr,f=l[g].anCells,n&&n.insertBefore(f[m],f[k]||null)}else d(fa(e.aoData,"anCells",m)).detach();h.bVisible=b;N(e,e.aoHeader);N(e,e.aoFooter);if(c===a||c)w(e),(e.oScroll.sX||e.oScroll.sY)&&sa(e);T(e,null,"column-visibility",[e,m,b]);Fa(e)}})});Q("columns().indexes()","column().index()",function(a){return this.iterator("column",
function(b,c){return"visible"===a?e(b,c):c},1)});I("columns.adjust()",function(){return this.iterator("table",function(a){w(a)},1)});I("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return u(c,b);if("fromData"===a||"toVisible"===a)return e(c,b)}});I("column()",function(a,b){return $a(this.columns(a,b))});var Vb=function(b,c,e){var m=b.aoData,f=Ja(b,e);e=Eb(va(m,f,"anCells"));var h=d([].concat.apply([],e)),l,g=b.aoColumns.length,
t,n,k,x,q,u;return Ya(c,function(c){var e="function"===typeof c;if(null===c||c===a||e){t=[];n=0;for(k=f.length;n<k;n++)for(l=f[n],x=0;x<g;x++)q={row:l,column:x},e?(u=b.aoData[l],c(q,B(b,l,x),u.anCells[x])&&t.push(q)):t.push(q);return t}return d.isPlainObject(c)?[c]:h.filter(c).map(function(a,b){l=b.parentNode._DT_RowIndex;return{row:l,column:d.inArray(b,m[l].anCells)}}).toArray()})};I("cells()",function(b,c,e){d.isPlainObject(b)&&(typeof b.row!==a?(e=c,c=null):(e=b,b=null));d.isPlainObject(c)&&(e=
c,c=null);if(null===c||c===a)return this.iterator("table",function(a){return Vb(a,b,Za(e))});var m=this.columns(c,e),f=this.rows(b,e),h,l,g,t,n,k=this.iterator("table",function(a,b){h=[];l=0;for(g=f[b].length;l<g;l++)for(t=0,n=m[b].length;t<n;t++)h.push({row:f[b][l],column:m[b][t]});return h},1);d.extend(k.selector,{cols:c,rows:b,opts:e});return k});Q("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(b,c,e){return(b=b.aoData[c].anCells)?b[e]:a},1)});I("cells().data()",
function(){return this.iterator("cell",function(a,b,c){return B(a,b,c)},1)});Q("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,e){return b.aoData[c][a][e]},1)});Q("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,e){return B(b,c,e,a)},1)});Q("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,b,c){return{row:b,column:c,columnVisible:e(a,c)}},
1)});Q("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,e){t(b,c,a,e)})});I("cell()",function(a,b,c){return $a(this.cells(a,b,c))});I("cell().data()",function(b){var c=this.context,e=this[0];if(b===a)return c.length&&e.length?B(c[0],e[0].row,e[0].column):a;C(c[0],e[0].row,e[0].column,b);t(c[0],e[0].row,"data",e[0].column);return this});I("order()",function(b,c){var e=this.context;if(b===a)return 0!==e.length?e[0].aaSorting:a;"number"===typeof b?b=[[b,
c]]:d.isArray(b[0])||(b=Array.prototype.slice.call(arguments));return this.iterator("table",function(a){a.aaSorting=b.slice()})});I("order.listener()",function(a,b,c){return this.iterator("table",function(e){Ma(e,a,b,c)})});I(["columns().order()","column().order()"],function(a){var b=this;return this.iterator("table",function(c,e){var m=[];d.each(b[e],function(b,c){m.push([c,a])});c.aaSorting=m})});I("search()",function(b,c,e,m){var f=this.context;return b===a?0!==f.length?f[0].oPreviousSearch.sSearch:
a:this.iterator("table",function(a){a.oFeatures.bFilter&&la(a,d.extend({},a.oPreviousSearch,{sSearch:b+"",bRegex:null===c?!1:c,bSmart:null===e?!0:e,bCaseInsensitive:null===m?!0:m}),1)})});Q("columns().search()","column().search()",function(b,c,e,m){return this.iterator("column",function(f,h){var l=f.aoPreSearchCols;if(b===a)return l[h].sSearch;f.oFeatures.bFilter&&(d.extend(l[h],{sSearch:b+"",bRegex:null===c?!1:c,bSmart:null===e?!0:e,bCaseInsensitive:null===m?!0:m}),la(f,f.oPreviousSearch,1))})});
I("state()",function(){return this.context.length?this.context[0].oSavedState:null});I("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});I("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null});I("state.save()",function(){return this.iterator("table",function(a){Fa(a)})});z.versionCheck=z.fnVersionCheck=function(a){var b=z.version.split(".");a=a.split(".");for(var c,e,m=0,f=a.length;m<f;m++)if(c=
parseInt(b[m],10)||0,e=parseInt(a[m],10)||0,c!==e)return c>e;return!0};z.isDataTable=z.fnIsDataTable=function(a){var b=d(a).get(0),c=!1;d.each(z.settings,function(a,e){if(e.nTable===b||e.nScrollHead===b||e.nScrollFoot===b)c=!0});return c};z.tables=z.fnTables=function(a){return d.map(z.settings,function(b){if(!a||a&&d(b.nTable).is(":visible"))return b.nTable})};z.util={throttle:Aa,escapeRegex:Ca};z.camelToHungarian=b;I("$()",function(a,b){var c=this.rows(b).nodes(),c=d(c);return d([].concat(c.filter(a).toArray(),
c.find(a).toArray()))});d.each(["on","one","off"],function(a,b){I(b+"()",function(){var a=Array.prototype.slice.call(arguments);a[0].match(/\.dt\b/)||(a[0]+=".dt");var c=d(this.tables().nodes());c[b].apply(c,a);return this})});I("clear()",function(){return this.iterator("table",function(a){P(a)})});I("settings()",function(){return new O(this.context,this.context)});I("data()",function(){return this.iterator("table",function(a){return fa(a.aoData,"_aData")}).flatten()});I("destroy()",function(a){a=
a||!1;return this.iterator("table",function(b){var c=b.nTableWrapper.parentNode,e=b.oClasses,m=b.nTable,f=b.nTBody,h=b.nTHead,l=b.nTFoot,t=d(m),f=d(f),n=d(b.nTableWrapper),k=d.map(b.aoData,function(a){return a.nTr}),x;b.bDestroying=!0;T(b,"aoDestroyCallback","destroy",[b]);a||(new O(b)).columns().visible(!0);n.unbind(".DT").find(":not(tbody *)").unbind(".DT");d(g).unbind(".DT-"+b.sInstance);m!=h.parentNode&&(t.children("thead").detach(),t.append(h));l&&m!=l.parentNode&&(t.children("tfoot").detach(),
t.append(l));t.detach();n.detach();b.aaSorting=[];b.aaSortingFixed=[];Ea(b);d(k).removeClass(b.asStripeClasses.join(" "));d("th, td",h).removeClass(e.sSortable+" "+e.sSortableAsc+" "+e.sSortableDesc+" "+e.sSortableNone);b.bJUI&&(d("th span."+e.sSortIcon+", td span."+e.sSortIcon,h).detach(),d("th, td",h).each(function(){var a=d("div."+e.sSortJUIWrapper,this);d(this).append(a.contents());a.detach()}));!a&&c&&c.insertBefore(m,b.nTableReinsertBefore);f.children().detach();f.append(k);t.css("width",b.sDestroyWidth).removeClass(e.sTable);
(x=b.asDestroyStripes.length)&&f.children().each(function(a){d(this).addClass(b.asDestroyStripes[a%x])});c=d.inArray(b,z.settings);-1!==c&&z.settings.splice(c,1)})});z.version="1.10.4";z.settings=[];z.models={};z.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};z.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null};z.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,
_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};z.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,
bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,
fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,
oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",
sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:d.extend({},z.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null};c(z.defaults);z.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,
sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};c(z.defaults.column);z.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1},
ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,
bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:a,oAjaxData:a,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,
bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==ba(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ba(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,e=this.aiDisplay.length,m=this.oFeatures,f=m.bPaginate;return m.bServerSide?!1===f||-1===a?b+e:Math.min(b+a,this._iRecordsDisplay):!f||c>e||-1===a?e:c},oInstance:null,sInstance:null,
iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}};z.ext=V={classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:z.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:z.version};d.extend(V,{afnFiltering:V.search,aTypes:V.type.detect,ofnSearch:V.type.search,oSort:V.type.order,afnSortData:V.order,aoFeatures:V.feature,oApi:V.internal,oStdClasses:V.classes,
oPagination:V.pager});d.extend(z.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",
sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",
sJUIHeader:"",sJUIFooter:""});(function(){var a="",a="",b=a+"ui-state-default",c=a+"css_right ui-icon ui-icon-",a=a+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";d.extend(z.ext.oJUIClasses,z.ext.classes,{sPageButton:"fg-button ui-button "+b,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:b+" sorting_asc",sSortDesc:b+" sorting_desc",sSortable:b+
" sorting",sSortableAsc:b+" sorting_asc_disabled",sSortableDesc:b+" sorting_desc_disabled",sSortableNone:b+" sorting_disabled",sSortJUIAsc:c+"triangle-1-n",sSortJUIDesc:c+"triangle-1-s",sSortJUI:c+"carat-2-n-s",sSortJUIAscAllowed:c+"carat-1-n",sSortJUIDescAllowed:c+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+b,sScrollFoot:"dataTables_scrollFoot "+b,sHeaderTH:b,sFooterTH:b,sJUIHeader:a+" ui-corner-tl ui-corner-tr",sJUIFooter:a+
" ui-corner-bl ui-corner-br"})})();var yb=z.ext.pager;d.extend(yb,{simple:function(a,b){return["previous","next"]},full:function(a,b){return["first","previous","next","last"]},simple_numbers:function(a,b){return["previous",Ua(a,b),"next"]},full_numbers:function(a,b){return["first","previous",Ua(a,b),"next","last"]},_numbers:Ua,numbers_length:7});d.extend(!0,z.ext.renderer,{pageButton:{_:function(a,b,c,e,m,f){var h=a.oClasses,l=a.oLanguage.oPaginate,g,t,n=0,x=function(b,e){var k,q,u,w,p=function(b){Ra(a,
b.data.action,!0)};k=0;for(q=e.length;k<q;k++)if(w=e[k],d.isArray(w))u=d("<"+(w.DT_el||"div")+"/>").appendTo(b),x(u,w);else{t=g="";switch(w){case "ellipsis":b.append("<span>&hellip;</span>");break;case "first":g=l.sFirst;t=w+(0<m?"":" "+h.sPageButtonDisabled);break;case "previous":g=l.sPrevious;t=w+(0<m?"":" "+h.sPageButtonDisabled);break;case "next":g=l.sNext;t=w+(m<f-1?"":" "+h.sPageButtonDisabled);break;case "last":g=l.sLast;t=w+(m<f-1?"":" "+h.sPageButtonDisabled);break;default:g=w+1,t=m===w?
h.sPageButtonActive:""}g&&(u=d("<a>",{"class":h.sPageButton+" "+t,"aria-controls":a.sTableId,"data-dt-idx":n,tabindex:a.iTabIndex,id:0===c&&"string"===typeof w?a.sTableId+"_"+w:null}).html(g).appendTo(b),Ta(u,{action:w},p),n++)}};try{var q=d(k.activeElement).data("dt-idx");x(d(b).empty(),e);null!==q&&d(b).find("[data-dt-idx="+q+"]").focus()}catch(u){}}}});d.extend(z.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return Xa(a,c)?"num"+c:null},function(a,b){if(!(!a||a instanceof Date||Mb.test(a)&&
Nb.test(a)))return null;var c=Date.parse(a);return null!==c&&!isNaN(c)||ia(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return Xa(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Db(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Db(a,c,!0)?"html-num-fmt"+c:null},function(a,b){return ia(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);d.extend(z.ext.type.search,{html:function(a){return ia(a)?a:"string"===typeof a?a.replace(Ab,
" ").replace(Ia,""):""},string:function(a){return ia(a)?a:"string"===typeof a?a.replace(Ab," "):a}});var Ha=function(a,b,c,e){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Cb(a,b));a.replace&&(c&&(a=a.replace(c,"")),e&&(a=a.replace(e,"")));return 1*a};d.extend(V.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return ia(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return ia(a)?"":"string"===typeof a?a.toLowerCase():a.toString?
a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});bb("");d.extend(!0,z.ext.renderer,{header:{_:function(a,b,c,e){d(a.nTable).on("order.dt.DT",function(m,f,h,d){a===f&&(m=c.idx,b.removeClass(c.sSortingClass+" "+e.sSortAsc+" "+e.sSortDesc).addClass("asc"==d[m]?e.sSortAsc:"desc"==d[m]?e.sSortDesc:c.sSortingClass))})},jqueryui:function(a,b,c,e){d("<div/>").addClass(e.sSortJUIWrapper).append(b.contents()).append(d("<span/>").addClass(e.sSortIcon+
" "+c.sSortingClassJUI)).appendTo(b);d(a.nTable).on("order.dt.DT",function(m,f,h,d){a===f&&(m=c.idx,b.removeClass(e.sSortAsc+" "+e.sSortDesc).addClass("asc"==d[m]?e.sSortAsc:"desc"==d[m]?e.sSortDesc:c.sSortingClass),b.find("span."+e.sSortIcon).removeClass(e.sSortJUIAsc+" "+e.sSortJUIDesc+" "+e.sSortJUI+" "+e.sSortJUIAscAllowed+" "+e.sSortJUIDescAllowed).addClass("asc"==d[m]?e.sSortJUIAsc:"desc"==d[m]?e.sSortJUIDesc:c.sSortingClassJUI))})}}});z.render={number:function(a,b,c,e){return{display:function(m){var f=
0>m?"-":"";m=Math.abs(parseFloat(m));var h=parseInt(m,10);m=c?b+(m-h).toFixed(c).substring(2):"";return f+(e||"")+h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+m}}}};d.extend(z.ext.internal,{_fnExternApiFunc:zb,_fnBuildAjax:ka,_fnAjaxUpdate:oa,_fnAjaxParameters:xa,_fnAjaxUpdateDraw:ya,_fnAjaxDataSrc:qa,_fnAddColumn:h,_fnColumnOptions:q,_fnAdjustColumnSizing:w,_fnVisibleToColumnIndex:u,_fnColumnIndexToVisible:e,_fnVisbleColumns:r,_fnGetColumns:A,_fnColumnTypes:F,_fnApplyColumnDefs:G,_fnHungarianMap:c,
_fnCamelToHungarian:b,_fnLanguageCompat:l,_fnBrowserDetect:v,_fnAddData:y,_fnAddTr:H,_fnNodeToDataIndex:function(b,c){return c._DT_RowIndex!==a?c._DT_RowIndex:null},_fnNodeToColumnIndex:function(a,b,c){return d.inArray(c,a.aoData[b].anCells)},_fnGetCellData:B,_fnSetCellData:C,_fnSplitObjNotation:E,_fnGetObjectDataFn:D,_fnSetObjectDataFn:K,_fnGetDataMaster:L,_fnClearTable:P,_fnDeleteIndex:m,_fnInvalidate:t,_fnGetRowElements:x,_fnCreateTr:J,_fnBuildHead:R,_fnDrawHead:N,_fnDraw:W,_fnReDraw:Z,_fnAddOptionsHtml:ca,
_fnDetectHeader:da,_fnGetUniqueThs:ja,_fnFeatureHtmlFilter:wa,_fnFilterComplete:la,_fnFilterCustom:Ba,_fnFilterColumn:jb,_fnFilter:ib,_fnFilterCreateSearch:Oa,_fnEscapeRegex:Ca,_fnFilterData:kb,_fnFeatureHtmlInfo:gb,_fnUpdateInfo:nb,_fnInfoMacros:ob,_fnInitialise:ua,_fnInitComplete:za,_fnLengthChange:Pa,_fnFeatureHtmlLength:db,_fnFeatureHtmlPaginate:hb,_fnPageChange:Ra,_fnFeatureHtmlProcessing:eb,_fnProcessingDisplay:ea,_fnFeatureHtmlTable:fb,_fnScrollDraw:sa,_fnApplyToChildren:ha,_fnCalculateColumnWidths:Ka,
_fnThrottle:Aa,_fnConvertToWidth:pb,_fnScrollingWidthAdjust:rb,_fnGetWidestNode:qb,_fnGetMaxLenString:sb,_fnStringToCss:M,_fnScrollBarWidth:tb,_fnSortFlatten:pa,_fnSort:cb,_fnSortAria:vb,_fnSortListener:Sa,_fnSortAttachListener:Ma,_fnSortingClasses:Ea,_fnSortData:ub,_fnSaveState:Fa,_fnLoadState:wb,_fnSettingsFromNode:Ga,_fnLog:ma,_fnMap:ga,_fnBindAction:Ta,_fnCallbackReg:Y,_fnCallbackFire:T,_fnLengthOverflow:Qa,_fnRenderer:Na,_fnDataSource:ba,_fnRowAttributes:S,_fnCalculateEnd:function(){}});d.fn.dataTable=
z;d.fn.dataTableSettings=z.settings;d.fn.dataTableExt=z.ext;d.fn.DataTable=function(a){return d(this).dataTable(a).api()};d.each(z,function(a,b){d.fn.DataTable[a]=b});return d.fn.dataTable})})(window,document);window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(g){return function(){var k={};return{check_message:function(a){var d;if(a.is_box())if(d=a.get_size(),1>d)g.UTILITIES.display_message("Function birds can only respond to boxes with holes.");else if(a=a.get_hole_contents(0)){if(a.is_bird())return{box_size:d,bird:a};g.UTILITIES.display_message("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+g.UTILITIES.add_a_or_an(a.get_type_name()+"."))}else g.UTILITIES.display_message("Function birds can only respond to boxes with something in the first hole.");
else g.UTILITIES.display_message("Function birds can only respond to boxes. One was given "+g.UTILITIES.add_a_or_an(a.get_type_name()))},process_response:function(a,d,c,b,l){a&&d.widget_dropped_on_me(a,!1,void 0,l,!0,!0);c.remove(void 0,!0)},process_message:function(a,d,c,b){var l=this.check_message(a);if(l)return d=d(l.bird,l.box_size),this.process_response(d,l.bird,a,c,b),d},type_check:function(a,d,c,b){if(!a)return!0;if(!d)return g.UTILITIES.display_message("Birds for the "+c+" function can only respond to boxes with "+
g.UTILITIES.add_a_or_an(a)+" in the "+g.UTILITIES.ordinal(b)+" hole. The "+g.UTILITIES.ordinal(b)+" hole is empty."),!1;if(d.dereference().is_of_type(a))return!0;if(d.is_nest())throw{wait_for_nest_to_receive_something:d};g.UTILITIES.display_message("Birds for the "+c+" function can only respond to boxes with "+g.UTILITIES.add_a_or_an(a)+" in the "+g.UTILITIES.ordinal(b)+" hole. The "+g.UTILITIES.ordinal(b)+" hole contains "+g.UTILITIES.add_a_or_an(d.get_type_name()+"."));return!1},number_check:function(a,
d,c){return this.type_check("number",a,d,c)},n_ary_widget_function:function(a,d,c,b,l,g){var f=function(f,l){var h,g,n,k;if(1===l)return d();g=1;n=a.get_hole_contents(g).dereference();if(k=this.number_check(n,b,g)){for(g++;g<l;){h=a.get_hole_contents(g).dereference();k=this.number_check(h,b,g);if(!k)return;c.call(n,h);g++}return n}}.bind(this);return this.process_message(a,f,l,g)},n_ary_function:function(a,d,c,b,l,n){var f=function(f,l){var h,n,k,u;if(l<c+1)g.UTILITIES.display_message("Birds for the "+
b+" function can only respond to boxes with at least "+(c+1)+" holes. Not "+l+" holes.");else{k=[];for(n=1;n<l;){h=a.get_hole_contents(n).dereference();u=this.number_check(h,b,n);if(!u)return;k.push(h.get_value());n++}return d.apply(null,k)}}.bind(this);return this.process_message(a,f,l,n)},typed_bird_function:function(a,d,c,b,l,n,f){var k=function(f,h){var n,k,u,e;if(0<=b&&h!=b+1)g.UTILITIES.display_message("Birds for the "+l+" function can only respond to boxes with "+(b+1)+" holes. Not "+h+" holes.");
else{u=[];for(k=1;k<h;){n=a.get_hole_contents(k).dereference();k<=c.length&&(e=c[k-1]);if(!this.type_check(e,n,l,k))return;u.push(n);k++}return d.apply(null,u)}}.bind(this);return this.process_message(a,k,n,f)},numeric_javascript_function_to_widget_function:function(a,d,c){return function(){var b=g.number.ZERO(g.number.function_bird_results_default_format);b.set_value_from_decimal(a.apply(null,g.UTILITIES.map_arguments(arguments,c||bigrat.toDecimal)));d&&b.set_approximate(!0);return b}},bigrat_function_to_widget_function:function(a,
d){return function(){var c=g.number.create_from_bigrat(a.apply(null,arguments));d&&c.set_approximate(!0);return c}},add_function_object:function(a,d,c,b,l){k[a]={name:a,short_name:b||a,respond_to_message:d,get_description:l?1===l.length?function(){return"If you give me a box with another bird and "+g.UTILITIES.add_a_or_an(l[0])+" then "+g.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+
g.UTILITIES.conjunction(l,!0)+" then "+g.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+g.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."},toString:function(){return g.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:c}},get_function_table:function(){return k}}}}(window.TOONTALK);window.TOONTALK.widget=function(g){var k=function(a){if(a=this.get_frontside&&this.get_frontside(a))return a.get_element()};g.creators_from_json.top_level=function(a){a=g.widget.create_top_level_widget(a.settings);$(a.get_backside(!0).get_element()).addClass("toontalk-top-level-backside");a.get_backside().update_flag_and_sign_position();return a};return{add_standard_widget_functionality:function(a){var d=function(){return!1},c;this.add_sides_functionality(a);this.runnable(a);this.stackable(a);this.animatable(a);
this.has_title(a);this.has_parent(a);this.has_backside_widgets(a);this.has_description(a);this.has_listeners(a);this.droppable(a);this.erasable(a);a.this_and_walk_children=function(b){b(a)&&a.walk_children&&a.walk_children(b)};a.top_level_widget=function(){var a;if(c)return c;if(this.is_top_level())return this;if(c=g.UTILITIES.widget_from_jquery($(this.get_frontside_element()).closest(".toontalk-top-level-backside")))return c;if(a=this.get_parent_of_frontside()||this.get_parent_of_backside())return c=
a.get_widget().top_level_widget();a=$(".toontalk-top-level-backside");if(0<a.length)return 1<a.length&&console.log("Cannot find the top-level widget of "+this+" but found "+a.length+" top-level backsides so picked one."),c=g.UTILITIES.widget_from_jquery(a);console.log("Could not find top_level_widget of "+this+". Created one instead");return c=this.create_top_level_widget()};a.is_of_type||(a.is_of_type=function(a){return this.get_type_name()===a});a.dereference||(a.dereference=function(){return this});
a.is_number||(a.is_number=d);a.is_box||(a.is_box=d);a.is_empty_hole||(a.is_empty_hole=d);a.is_hole||(a.is_hole=d);a.is_scale||(a.is_scale=d);a.is_bird||(a.is_bird=d);a.is_nest||(a.is_nest=d);a.is_robot||(a.is_robot=d);a.is_element||(a.is_element=d);a.is_sensor||(a.is_sensor=d);a.is_function_nest||(a.is_function_nest=d);a.is_plain_text_element||(a.is_plain_text_element=d);a.is_attribute_widget||(a.is_attribute_widget=d);a.maintain_proportional_dimensions||(a.maintain_proportional_dimensions=d);a.ok_to_set_dimensions=
function(){return!this.is_plain_text_element()};a.set_name&&(a.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});!g.debugging&&!g.logging||a.to_debug_string||(a.to_debug_string=function(){var a=this.get_parent_widget_of_frontside(),c=this._debug_id,d=this.get_description(),d=d?d+" ":"";c||(c=a&&a.id?"id of parent is "+a.id:"");return this.toString({plain_text:!0})+" ("+d+" "+(this.get_name&&this.get_name()+" "||"")+c+")"});a.is_top_level=
d;a.is_widget=!0},erasable:function(a){var d;a.get_erased||(a.get_erased=function(){return d});a.set_erased||(a.set_erased=function(a,b){d=a;b&&this.rerender()})},add_sides_functionality:function(a){var d,c;a.get_frontside||(a.get_frontside=function(b){b&&!d&&(d=g.frontside.create(a));return d},a.save_dimensions=function(){return this.save_dimensions_of(this)},a.save_dimensions_of=function(a){var c;if(a.is_element()){if(!this.get_original_width())return;c=a.get_attribute("width");a=a.get_attribute("height")}else a=
a.get_frontside_element(),c=$(a).width(),a=$(a).height();0<c&&(this.saved_width=c);0<a&&(this.saved_height=a);return!0},a.restore_dimensions=function(){var a,c;0<this.saved_width&&(a=this.get_frontside_element(),this.use_scaling_transform?this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.ok_to_set_dimensions()?this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):g.UTILITIES.set_css(a,{width:this.saved_width,height:this.saved_height}):
(c={width:"",height:""},g.UTILITIES.set_css_transform(c,""),g.UTILITIES.set_css(a,c)),this.saved_height=this.saved_width=void 0)});a.get_backside||(a.get_backside=function(a){a&&!c&&(c=this.create_backside(),this.backside_widgets_json_views&&(c.add_backside_widgets(this.get_backside_widgets(),this.backside_widgets_json_views),this.backside_widgets_json_views=void 0));return c});a.set_backside||(a.set_backside=function(a){c=a;c.update_flag_and_sign_position()});a.forget_backside||(a.forget_backside=
function(){var a;if(c){if(a=c.get_element())$(a).remove(),a.toontalk_widget=void 0;c=void 0}});a.create_backside||(a.create_backside=function(){return g.backside.create(a)})},runnable:function(a){var d=!1,c=!1;a.get_running||(a.get_running=function(a){var c=!1;if(a)return d;if(d)if(a=this.get_backside_widgets(),0===a.length)d=!1;else for(a.some(function(a){if(a&&(a=a.get_widget(),a.get_running()))return c=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);
if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return c});a.is_ok_to_run||(a.is_ok_to_run=function(){return c},a.set_ok_to_run=function(a){c=a});a.set_running||(a.set_running=function(b,l){var g=d===b,f,k;c=b;f=this.get_backside_widgets();d=b;this.get_backside()&&this.get_backside().run_status_changed(d);f.forEach(function(c){c&&(k=c.get_widget(),c.is_backside()&&0<=this.get_backside_widgets().indexOf(k)||(!k.is_robot()||k.being_trained||k.get_body().is_empty()?k.set_running&&
(!l&&c.is_backside()&&"top-level"!==a.get_type_name()?k.set_running(b,a):k.set_running(b)):(d?(k.set_stopped(!1),k.run(a,l),k.set_ok_to_run(!0)):(k.set_stopped(!0),k.set_running(!1)),k.rerender())))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(d);return!0});this.is_robot()&&(d?a.get_parent_of_backside()&&(this.set_stopped(!1),this.run(a.get_parent_of_backside().get_widget(),l)):this.set_stopped(!0));g||this.rerender()})},droppable:function(a){a.drop_on||
(a.drop_on=function(a,c,b,l){if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,c,b,l);console.log("No handler for drop of '"+this+"' on '"+a+"'")})},stackable:function(a){var d=!1;a.get_infinite_stack||(a.get_infinite_stack=function(){return d});a.set_infinite_stack||(a.set_infinite_stack=function(c){var b=a.get_backside_element(),l=a.get_frontside_element();d=c;b&&$(b).find(".toontalk-infinite-stack-check-box").prop("checked",c);l&&(c?$(l).addClass("toontalk-infinite-stack"):$(l).removeClass("toontalk-infinite-stack"))})},
animatable:function(a){var d;a.animate_to_widget||(d=function(a){var b=a.get_element();b&&(a.is_backside()||g.UTILITIES.visible_element(b))||(b=g.UTILITIES.find_resource_equal_to_widget(a));return b},a.animate_to_widget=function(a,b,l,g,f,k,p){var h=function(){this.animate_to_element(d(a),b,l,g,f,k,p&&Math.max(0,p-100));this.rerender()}.bind(this);0===p?h():setTimeout(h,100)});a.animate_to_element||(a.animate_to_element=function(a,b,d,n,f,k,p){var h=$(a).offset(),q=$(this.get_frontside_element()),
w=$(a).is(".toontalk-backside");if(a&&g.UTILITIES.visible_element(a)){if("number"===typeof a.animation_left_offset)n=a.animation_left_offset;else if("undefined"===typeof n||w)n=($(a).width()-q.width())*Math.random();if("number"===typeof a.animation_top_offset)f=a.animation_top_offset;else if("undefined"===typeof f||w)f=($(a).height()-q.height())*Math.random();h?(h.left+=n,h.top+=f):h={left:0,top:0};this.animate_to_absolute_position(h,b,d,k,p)}else b&&b()});a.animate_to_absolute_position||(a.animate_to_absolute_position=
function(a,b,d,n,f){g.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),a,b,d,n,f)})},has_title:function(a){a.get_title||(a.get_title=function(){var a=this.get_type_name(),c=this.get_backside(),b=this.get_frontside_element(),l=this.get_description(),n="";$(b).is(".toontalk-top-level-resource")?n=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":
c&&c.get_element()&&g.UTILITIES.visible_element(c.get_element())||(n=this.can_run&&this.can_run()?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my back side and then click the green flag "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
".":"Click to see my back side.");l&&(l="I'm "+l,n=n?l+"\n"+n:l);if(this.get_erased())return this.get_title_of_erased_widget();n=this.get_custom_title_prefix&&!$(b).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+n:"I'm "+g.UTILITIES.add_a_or_an(a)+". "+n;n=n.trim();0>".?!".indexOf(n[n.length-1])&&(n+=".");return n});a.update_title=function(){g.UTILITIES.give_tooltip(this.get_frontside_element(),this.get_title())}},get_title_of_erased_widget:function(){var a=this.get_frontside_element(),
d=this.get_type_name();return a&&$(a).closest(".toontalk-conditions-contents-container").is("*")?"I'm an erased "+d+".\nI'll match with any other "+d+".":"I'm an erased "+d+".\nDusty the Vacuum can restore me to normal."},has_parent:function(a){var d=[],c,b,l,n;a.get_parent_of_frontside=function(){return l&&c?c.get_backside(!0):c};a.get_parent_widget_of_frontside=function(){return c};a.parent_of_frontside_is_backside=function(){return l};a.set_parent_of_frontside=function(a,b,g){var h=c;l=b;c!==a&&
(c=a,h&&!g&&!b&&h.is_backside()&&h.get_widget().remove_backside_widget(this,!1,!0),d.forEach(function(a){a(h,c)}))};a.add_parent_of_frontside_change_listener=function(a){d.push(a)};a.remove_parent_of_frontside_change_listener=function(a){a=d.indexOf(a);0<=a&&d.splice(a,1)};a.get_parent_of_backside=function(){return n&&b?b.get_backside(!0):b};a.set_parent_of_backside=function(a,c,d){void 0===a&&!d&&n&&b.get_widget().remove_backside_widget(this,!0,!0);b=a;n=c};a.parent_of_backside_is_backside=function(){return n};
a.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};a.closest_visible_ancestor_or_frontside=function(){for(var a=this,b;a&&!g.UTILITIES.visible_element(a.get_frontside_element());)b=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=b.get_widget()):a=a.get_parent_of_frontside();return a||this};a.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():
b.get_parent_of_frontside();return b};a.has_ancestor=function(a){for(var b=this;b;){if(a===b)return!0;b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside()}return!1};a.remove_from_parent_of_frontside=function(a){c&&(c.is_backside()?c.remove_backside_widget(this,!1,!a):c.removed_from_container&&(l?c.remove_backside_widget(this):c.removed_from_container(this,!1,a,void 0,!0)))}},has_description:function(a){var d;a.get_description||(a.get_description=function(){return d});
a.set_description||(a.set_description=function(a,b){if(d===a||!d&&""===a)return!1;d=a;b&&this.rerender();return!0});a.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},has_name:function(a){var d;a.get_name||(a.get_name=function(){"string"!==typeof d&&a.generate_name&&(d=a.generate_name());return d});a.set_name||(a.set_name=function(a,b){if(d===a||"string"!==typeof a)return!1;d=a;b&&this.rerender();return!0})},has_listeners:function(a){var d=
{};a.add_listener||(a.add_listener=function(a,b){var l=d[a];l?0>l.indexOf(b)&&l.push(b):d[a]=[b]});a.remove_listener||(a.remove_listener=function(a,b,l){if(a=d[a])if(b=a.indexOf(b),0<=b){a.splice(b,1);return}!l&&g.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});a.get_listeners||(a.get_listeners=function(a){return d[a]})},get_full_description:function(a){var d;if(this.get_erased&&this.get_erased())return a&&"conditions"===a.role?"any "+this.get_type_name():"erased "+
this.get_type_name();d=this.get_description(a);a=this.toString(a);return d?a+" ("+d+")":a},remove:function(a,d){var c=this.get_backside(),b=this.get_frontside(),l=this.get_parent_of_frontside();this.get_parent_of_backside();c&&c.hide_backside();b&&b.remove();l&&this.remove_from_parent_of_frontside(a);this.set_running(!1);this.set_visible(!1);this.walk_children&&!d&&this.walk_children(function(a){a.remove&&a.remove();return!0})},get_frontside_element:k,get_element:k,get_backside_element:function(a){if(a=
this.get_backside&&this.get_backside(a))return a.get_element()},add_to_json:function(a,d){var c,b,l,n,f;if(a){a.view?(b=a,c=a.view,a=a.semantic):(c={},b={semantic:a,view:c});b.version=1;this.get_erased&&this.get_erased()&&(a.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(a.infinite_stack=!0);this.get_running&&this.get_running()&&(a.running=!0);if(!this.get_parent_widget_of_frontside()||this.parent_of_frontside_is_backside())if(l=this.get_frontside_element&&this.get_frontside_element())n=
$(l).width(),$(l).is(".toontalk-plain-text-element")||0===n||(c.frontside_width=$(l).width(),c.frontside_height=$(l).height()),0!==n&&(c.frontside_left=g.UTILITIES.get_style_numeric_property(l,"left"),c.frontside_top=g.UTILITIES.get_style_numeric_property(l,"top"));if(n=this.get_backside()){if(f=n.get_element())c.backside_width=$(f).width(),c.backside_height=$(f).height(),c.backside_left||(l=$(f).position(),c.backside_left=l.left,c.backside_top=l.top,"&lt;"===$(f).find(".toontalk-settings-backside-button").html()&&
(c.advanced_settings_open=!0));n.get_backside_dimensions()&&(c.backside_geometry=n.get_backside_dimensions())}!c.backside_geometry&&this.backside_geometry&&(c.backside_geometry=this.backside_geometry);a.description=this.get_description&&this.get_description();c.saved_width=this.saved_width;c.saved_height=this.saved_height;return b}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(a,d){var c=this.get_backside_widgets(),b;0<c.length&&(a.semantic.backside_widgets=g.UTILITIES.get_json_of_array(c,
d),(c=this.get_backside_widgets_json_views())&&c.forEach(function(c,g){var f;if(b=a.semantic.backside_widgets[g]){if(0<=b.widget.shared_widget_index){f=d.widgets_encountered.indexOf(d.shared_widgets[b.widget.shared_widget_index]);if(!d.json_of_widgets_encountered[f])return;f=d.json_of_widgets_encountered[f].view}else f=b.widget.view;b.is_backside?c.backside_left&&(f.backside_left=c.backside_left,f.backside_top=c.backside_top):c.frontside_left&&(f.frontside_left=c.frontside_left,f.frontside_top=c.frontside_top)}}))},
has_backside_widgets:function(a){var d=[];a.get_backside_widgets=function(){return d};a.add_backside_widget=function(a,b){var l=this.get_backside(!0),n=b?a.get_backside():a;g.debugging&&a===this?g.UTILITIES.report_internal_error("Adding a widget to a list of its backside widgets!"):(d?0>d.indexOf(n)&&(d.push(n),g.logging&&0<=g.logging.indexOf("backside-widgets")&&console.log("Added "+n+" to backside widgets of "+this+". Number of backside widgets is "+d.length)):d=[n],b?a.set_parent_of_backside(this,
!0):a.set_parent_of_frontside(this,!0),l.visible()&&(n.set_visible(!0),a.render()))};a.remove_all_backside_widgets=function(){if(d)for(;0<d.length;)d[0].remove()};a.remove_backside_widget=function(a,b,l){var n=b?a.get_backside(!0):a,f=d.indexOf(n);0>f?l?g.debugging&&console.log("Warning: Probable redundant call to remove_backside_widget"):g.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+n.get_widget()+" ("+n.get_widget()._debug_id+")"):(d.splice(f,1),
g.logging&&0<=g.logging.indexOf("backside-widgets")&&console.log("Removed "+a+" from backside widgets of "+this+". Number of backside widgets is "+d.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(f,1),b?(b=a.get_parent_of_backside())&&b.get_widget()===this&&a.set_parent_of_backside(void 0,!0,!0):(b=a.get_parent_of_frontside())&&b.get_widget()===this&&a.set_parent_of_frontside(void 0,void 0,!0),n.set_visible(!1))};a.set_backside_widgets=function(a,b){var l=this.get_backside(),
g=l&&l.visible();d=a;0<d.length&&(this.get_backside()?this.get_backside().add_backside_widgets(d,b):this.backside_widgets_json_views=b,d.forEach(function(a){a&&(a.is_backside()?a.get_widget().set_parent_of_backside(this,!0):a.get_widget().set_parent_of_frontside(this,!0),a.set_visible(g))}.bind(this)))}},get_backside_widgets_json_views:function(a){!this.backside_widgets_json_views&&a&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var a=!1,d;this.get_backside_widgets().some(function(c){if(!c)return!1;
d=c.get_widget();if(d.get_body&&!d.get_body().is_empty()||d.can_run())return a=!0});return a},add_to_copy:function(a,d){var c;this.get_erased&&this.get_erased()&&(a.set_erased||g.widget.erasable(a),a.set_erased(this.get_erased()));d&&d.just_value||(c=this.get_backside_widgets(),0<c.length&&a.set_backside_widgets(g.UTILITIES.copy_widget_sides(c,d),this.get_backside_widgets_json_views()));a.set_visible(this.visible());a.set_running(this.get_running());return a},get_type_name:function(){return""},copy:function(){console.assert(!1,
"copy not implemented")},add_copy_to_container:function(a,d,c){var b=this.visible(),l,n,f,k,p;a||(a=this.copy({}));l=this.get_frontside_element(b);n=a.get_frontside_element(b);f=$(l).closest(".toontalk-backside");k=a.ok_to_set_dimensions();0===f.length&&(f=$(".toontalk-backside"));p=g.UTILITIES.widget_from_jquery(f);b&&("undefined"===typeof d&&(d=30),"undefined"===typeof c&&(c=30),b=g.UTILITIES.relative_position(l,f.get(0)),f.get(0).appendChild(n),g.UTILITIES.set_css(n,{width:k?$(l).width():"",height:k?
$(l).height():"",left:b.left+d,top:b.top+c,"z-index":g.UTILITIES.next_z_index()}));p&&p.add_backside_widget(a);this.robot_in_training()&&this.robot_in_training().copied(this,a,!1);return a},visible:function(){var a;if(!document.hidden)return(a=this.get_frontside())?a.visible():!1},set_visible:function(a){var d=this.get_frontside(a);d&&d.set_visible(a)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},drag_started:function(a,d){this.robot_in_training()&&
this.robot_in_training().picked_up(this,a,d)},match:function(a){console.assert(!1,"match not implemented for "+a.toString())},removed:function(a){g.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(a){var d=this.get_backside(),c,b,l,n,f,k,p,h,q,w,u;if(d&&$(d.get_element()).is(":visible"))$(d.get_element()).css({opacity:1}),c&&c();else if(c=a&&function(){setTimeout(a)},b=function(a,b){g.UTILITIES.set_timeout(function(){$(a).addClass("toontalk-side-appearing");
g.UTILITIES.add_one_shot_event_handler(a,"transitionend",2500,function(){$(a).removeClass("toontalk-side-appearing");c&&c()});$(a).css({left:p,top:h,opacity:b});this.apply_backside_geometry()}.bind(this))}.bind(this),n=this.get_frontside_element(),f=$(n).parent(),d=$(n),d.is(".toontalk-top-level-resource"))c&&c();else{for(;0<f.length&&!f.is(".toontalk-backside");)d=f,f=f.parent();d.get(0);d=this.get_backside(!0);l=d.get_element();l.toontalk_widget=this;q=$(n).offset();w=f.offset();u=f.width();w||
(w={left:0,top:0});$(l).css({left:q.left-w.left,top:q.top-w.top,opacity:.01});f.append(l);(f=g.UTILITIES.widget_from_jquery(f))&&f.add_backside_widget(this,!0);f=this.is_element()?this.get_attribute("height"):$(n).height();n=$(l).width();p=q.left-w.left;p+n>u&&(p=Math.max(0,u-n));h=q.top-w.top+f+34;this.is_box()&&(h+=28);b(l,"inherit");d.set_visible(!0);d.render();k=this.get_backside_widgets();0<k.length&&k.forEach(function(a){a.is_backside()&&0<=k.indexOf(a.get_widget())?a.hide_backside():(a.set_visible(!0),
a.render(),l.appendChild(a.get_frontside_element(!0)))}.bind(this));d.update_flag_and_sign_position();return d}},hide_backside:function(){var a=this.get_backside();a&&a.hide_backside()},apply_backside_geometry:function(){var a=this.get_backside(!0),d=a.get_element();this.backside_geometry&&d&&(g.backside.scale_backside($(d),this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),a.set_dimensions(this.backside_geometry))},
robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(a){this.top_level_widget().robot_started_training(a)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},backup_all:function(a){var d=this.top_level_widget();d&&d.save(a)},render:function(){g.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&
this.render()},hide:function(){$(this.get_frontside_element()).hide()},location_constrained_by_container:function(){var a=this.get_parent_of_frontside();return a&&a.is_hole()?!0:!1},close_button_ok:function(a){return"top-level"!==this.get_type_name()&&!$(a).is(".toontalk-top-level-resource")&&!$(a).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(a,d){var c=this.top_level_widget(),b=a.get_frontside_element(!0);c.add_backside_widget(a);
c.get_backside_element().appendChild(b);a.render();d&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,c);return b},create_top_level_widget:function(a){var d=Object.create(g.widget),c=[],b=function(){return!1};a||(a={});d.is_top_level=function(){return!0};d.is_number=b;d.is_box=b;d.is_empty_hole=b;d.is_scale=b;d.is_bird=b;d.is_nest=b;d.is_robot=b;d.is_element=b;d.is_sensor=b;d.is_function_nest=b;d.is_hole=b;d.is_plain_text_element=b;d.is_attribute_widget=b;d.ok_to_set_dimensions=b;
d.get_json=function(b){b=this.get_backside(!0).get_element();b=document.defaultView.getComputedStyle(b,null).getPropertyValue("background-color");return{semantic:{type:"top_level",settings:a},view:{background_color:b}}};d.get_type_name=function(){return"top-level"};d.is_of_type=function(a){return"top-level"===a};d.toString=function(){return"top level widget"};d.get_description=function(){};d.match=function(){return"matched"};d.update_display=function(){this.get_backside_widgets()&&this.get_backside_widgets().forEach(function(a){a&&
a.visible()&&a.update_display()})};d.copy=function(){return this};d.visible=function(){return!0};d.get_parent_of_frontside=function(){};d.get_parent_of_backside=function(){};d.closest_visible_ancestor=function(){return this};d.get_infinite_stack=function(){return!1};d.top_level_widget=function(){return this};if(g.debugging||g.logging)d.to_debug_string=function(){var a=$(this.get_backside_element()).offset();return"top-level widget at "+Math.round(a.left)+", "+Math.round(a.top)};d.add_sides_functionality(d);
d.runnable(d);d.has_parent(d);d.has_backside_widgets(d);d.removed_from_container=function(a,b,c,d,g){this.robot_in_training()||this.remove_backside_widget(a,b,g)};d.widget_dropped_on_me=function(a,b,c,d,g){return this.get_backside().widget_dropped_on_me(a,b,c,d,g)};d.get_element=function(){return this.get_backside().get_element()};d.get_setting=function(b,c){"undefined"!==typeof a[b]||c||(a[b]=g.DEFAULT_SETTINGS&&g.DEFAULT_SETTINGS[b]);return a[b]};d.set_setting=function(b,c){a[b]=c};d.open_settings=
function(){g.SETTINGS.open(d)};d.robot_in_training=function(){if(0<c.length)return c[c.length-1]};d.robot_training_this_robot=function(){if(1<c.length)return c[c.length-2]};d.robot_started_training=function(a){c.push(a)};d.robot_finished_training=function(){c.pop()};d.save=function(a,b,c){var d=this.get_setting("program_name",!0),k;d&&(b||(b={}),"undefined"===typeof b.google_drive&&(b.google_drive=g.google_drive&&this.get_setting("auto_save_to_google_drive")),"undefined"===typeof b.local_storage&&
(b.local_storage=this.get_setting("auto_save_to_local_storage")),a?(b.google_drive&&!this.get_setting("google_drive_unavailable")&&(k=g.UTILITIES.get_json_top_level(this),a=g.google_drive.get_status(),"Ready"===a?(g.google_drive.upload_file(d,"json",JSON.stringify(k,g.UTILITIES.clean_JSON),c),c=void 0):g.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===a?(g.UTILITIES.display_message_if_new("Unable to save to your Google Drive because you need to log in. Click on the settings icon "+
g.UTILITIES.encode_HTML_for_title("<span class='toontalk-settings-icon'></span>")+" to log in."),g.UTILITIES.display_tooltip($(".toontalk-settings-button"))):console.log("Unable to save to Google Drive because: "+a))),b.local_storage&&(k||(k=g.UTILITIES.get_json_top_level(this)),this.save_to_local_storage(k)),c&&c()):setTimeout(function(){this.save(!0,b,c)}.bind(this),100))};d.publish=function(a,b){g.publish.publish_widget(this.get_setting("program_name"),this,b,a)};d.save_to_local_storage=function(a,
b){var c=this.get_setting("program_name"),d=g.UTILITIES.local_storage_program_key(c),k=g.UTILITIES.local_storage_program_meta_data_key(c),h,q,w;b||(b=Date.now());try{q=(q=window.localStorage.getItem(k))?JSON.parse(q):{created:b},q.last_modified=b,w=JSON.stringify(a,g.UTILITIES.clean_json),q.file_size=w.length,window.localStorage.setItem(k,JSON.stringify(q)),window.localStorage.setItem(d,w),window.localStorage.setItem("toontalk-last-key",d),h=g.UTILITIES.get_all_locally_stored_program_names(),0>h.indexOf(c)&&
(h.push(c),g.UTILITIES.set_all_locally_stored_program_names(h))}catch(u){c=w?"Failed to save state to local storage since it requires "+w.length+" bytes. Error message is "+u:"Error while saving to local storage. Error message is "+u,g.UTILITIES.is_internet_explorer()?console.error(c):g.UTILITIES.display_message(c),this.last_local_storage_error=c}};d.load=function(a,b,c){var k=this.get_setting("program_name"),p=k+".json",h=g.UTILITIES.local_storage_program_key(k),q=function(a){var e;if(a)try{e=JSON.parse(a),
d.remove_all_backside_widgets(),g.UTILITIES.add_backside_widgets_from_json(d,e.semantic.backside_widgets,{json_of_shared_widgets:e.shared_widgets,shared_widgets:[],shared_html:e.shared_html}),b&&b()}catch(h){g.UTILITIES.display_message("Error encountered loading "+k+" : "+h)}else c&&c()},w=function(a){a?g.google_drive.download_file(a,q):q(window.localStorage.getItem(h))};a&&g.google_drive&&"Ready"===g.google_drive.get_status()?g.google_drive.get_toontalk_program_file(p,w):q(window.localStorage.getItem(h))};
d.walk_children=function(){};d.render=function(){};d.location_constrained_by_container=function(){return!1};d.is_widget=!0;d.get_backside(!0).set_visible(!0);g.debugging&&(d._debug_id=g.UTILITIES.generate_unique_id(),d.debug_string="Top-level widget");return d}}}(window.TOONTALK);window.TOONTALK.backside=function(g){return{create:function(k){var a=Object.create(this),d=document.createElement("div"),c=$(d),b=1,l=1,n=document.createElement("div"),f=document.createElement("div"),v=k.get_help_URL&&k.get_help_URL(),p,h,q,w,u,e,r,A,F,G,y,H=function(a){a?($(n).addClass("toontalk-green-flag-active").removeClass("toontalk-green-flag-inactive"),$(f).addClass("toontalk-stop-sign-inactive").removeClass("toontalk-stop-sign-active")):($(n).addClass("toontalk-green-flag-inactive").removeClass("toontalk-green-flag-active"),
$(f).addClass("toontalk-stop-sign-active").removeClass("toontalk-stop-sign-inactive"))};A=this.create_description_label(a,k);var B=function(){var a;a=k.get_running()?"To stop this click on the stop sign "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):k.can_run()?"Click this to start this running.":"There is nothing to run on this.";g.UTILITIES.give_tooltip(n,a)},C=function(){var a;a=k.get_running()?"Click to stop this from running.":k.can_run()?"This has stopped. Click on the flag "+
g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";g.UTILITIES.give_tooltip(f,a)},E,D,K,L,P;g.TRANSLATION_ENABLED&&(v=g.UTILITIES.add_URL_parameter(v,"translate","1"));k.close_button_ok(d)&&(D=function(b){var e=function(){a.hide_backside(b);k.robot_in_training()&&k.robot_in_training()!==k&&k.robot_in_training().backside_closed(k)},f,h;k.get_running()?(f=k.get_backside_widgets(),f.some(function(a){a=a.get_widget();
if(a.is_robot())return a.finish_cycle_immediately(e),h=a,!0}),h?(h.add_body_finished_listener(function(){h.visible()?c.css({opacity:1}):(k.forget_backside(),g.DEFAULT_QUEUE.start());e()}),a.set_visible(!1)):e(),c.css({opacity:1}),c.addClass("toontalk-animating-element"),c.css({opacity:0})):e();b.stopPropagation()},E=(E=k.get_description())?"the "+k.get_type_name()+" who "+E:"the "+k.get_type_name(),r=g.UTILITIES.create_close_button(D,"Click to hide this back side of "+E+"."),d.appendChild(r));$(n).addClass("toontalk-green-flag toontalk-green-flag-inactive").click(function(a){k.can_run()?
(H(!0),k.set_running(!0),C(),g.DEFAULT_QUEUE.start()):k.is_top_level()?g.UTILITIES.display_message("There is nothing to run."):g.UTILITIES.display_message("This "+k.get_type_name()+" has nothing to run. Add some robots on the back.");k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-green-flag",k);a.stopPropagation()}).on("mouseenter",C);$(f).addClass("toontalk-stop-sign toontalk-stop-sign-active").click(function(a){H(!1);k.set_running(!1);B();k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-stop-sign",
k);a.stopPropagation()}).on("mouseenter",B);d.appendChild(n);d.appendChild(f);g.UTILITIES.use_custom_tooltip(n);g.UTILITIES.use_custom_tooltip(f);v&&(P=0>v.indexOf("://"),F=document.createElement(P?"div":"a"),$(F).addClass("toontalk-help-button notranslate toontalk-widget-help-button").click(function(a){P?(G=document.createElement("iframe"),$(G).addClass("toontalk-help-frame"),G.src=v,document.body.appendChild(y),document.body.appendChild(G),a.stopPropagation()):(F.href=v,F.target="_blank")}),F.innerHTML=
"i",F.translate=!1,g.UTILITIES.give_tooltip(F,"Click to learn more about "+k.get_type_name(!0,!0)+"."),y=document.createElement("div"),$(y).addClass("toontalk-close-help-frame-button").button().click(function(a){$(G).remove();$(y).remove();a.stopPropagation()}),y.innerHTML="Return to ToonTalk",d.appendChild(F));A&&d.appendChild(A);k.is_top_level()&&(p=document.createElement("div"),$(p).addClass("toontalk-settings-button").click(function(a){k.open_settings();a.stopPropagation()}),d.appendChild(p),
g.UTILITIES.give_tooltip(p,"Click to change settings or open a different program."));c.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+k.get_type_name());c.css({"z-index":g.UTILITIES.next_z_index()});a.get_element=function(){return d};a.get_backside_element=function(){return d};a.get_widget=function(){return k};a.visible=function(){return h};a.set_visible=function(a){var b=this.get_widget().get_backside_widgets();h=a;b.forEach(function(b){b&&(b.set_visible(a),a&&b.render())})};k.get_backside||
(k.get_backside=function(){return a});a.get_parent_of_backside=function(){return k.get_parent_of_backside()};a.get_parent_of_frontside=function(){return k.get_parent_of_frontside()};a.is_parent_backside=function(){return k.is_parent_backside()};a.get_frontside=function(){return k.get_frontside()};a.get_frontside_element=function(){return k.get_frontside_element()};a.get_description_text_area=function(){return K};a.set_description_text_area=function(a){K=a};a.get_name_text_input=function(){return L};
a.set_name_text_input=function(a){L=a};k.removed_from_container||(k.removed_from_container=function(a,b,c,e,f){k.robot_in_training()||this.remove_backside_widget(a,b,f)});a.widget_dropped_on_me=function(a,b,e,f,h){var d,l,n;this.visible()&&(g.sounds&&e&&g.sounds.drop.play(),b?(d=a.get_backside(this.visible()),l=d.get_element(),d.rerender()):(d=a.get_frontside(this.visible()),l=d.get_element(),a.rerender()),d=$(l),c.append(d),g.UTILITIES.set_position_is_absolute(l,!0,e));this.get_widget().is_top_level()&&
f&&!f.visible()&&d.addClass("toontalk-widget-added-to-backside-by-unwatched-robot");k.robot_in_training()&&!h&&e&&setTimeout(function(){k.robot_in_training().dropped_on(a,this,e)}.bind(this));b&&"top-level"!=this.get_widget().get_type_name()&&(n=a.get_backside(),a.forget_backside(),a.remove(e),a.set_backside(n));this.add_backside_widget(a,b);a.dropped_on_other&&a.dropped_on_other(this.get_widget(),!0,e,f);e&&a.get_body&&a.get_body().is_empty()&&!a.being_trained&&setTimeout(function(){(n=a.open_backside())&&
$(n.get_element()).find(".toontalk-train-backside-button").click()});e&&a.get_widget().backup_all();a.is_robot()&&this.get_widget().get_running()&&this.get_widget().set_running(!0);return!0};a.add_backside_widget=function(a,b){return this.get_widget().add_backside_widget(a,b)};a.add_backside_widgets=function(a,b){var c;0!==a.length&&(c=a.slice(),g.UTILITIES.set_timeout(function(){var a=this.visible(),e=this.get_element(),m,f,h,d;c.forEach(function(c,l){if(c){if(m=c.get_element(a))if(a&&!m.parentElement&&
e.appendChild(m),m.toontalk_widget=c.get_widget(),b&&(h=b[l]))c.is_backside()?(f=c.get_widget().get_backside(!0),d={left:h.backside_left,top:h.backside_top,width:h.backside_width,height:h.backside_height},c.get_widget().apply_backside_geometry(),h.advanced_settings_open&&f.set_advanced_settings_showing(!0,f.get_element())):(0===h.frontside_width&&(h.frontside_width=""),0===h.frontside_height&&(h.frontside_height=""),d={left:h.frontside_left||0,top:h.frontside_top||0,width:h.frontside_width||h.saved_width,
height:h.frontside_height||h.saved_height}),g.UTILITIES.constrain_css_to_fit_inside(e,d),$(m).css(d);c.set_visible(a);c.get_widget().rerender()}})}.bind(this),100))};a.get_backside_dimensions=function(){if(1!==b||1!==l)return{x_scale:b,y_scale:l,original_width:q,original_height:w}};a.set_dimensions=function(a){b=a.x_scale;l=a.y_scale;q=a.original_width;w=a.original_height};a.scale_to_fit=function(a,c){var e;!q&&this.get_widget().backside_geometry&&(q=this.get_widget().backside_geometry.original_width,
w=this.get_widget().backside_geometry.original_height);e=g.UTILITIES.scale_to_fit(a,c,q,w);b=e.x_scale;l=e.y_scale};a.run_status_changed=function(a){H(a)};a.update_flag_and_sign_position=function(a){var b,e,h,l;TOONTALK.UTILITIES.visible_element(d)?(c.width(),c.height(),b=$(f).width(),e=(e=$(r).width())?e+14:0,$(f).css({right:e}),$(n).css({right:e+b+6}),h=$(n).width(),F&&$(F).css({right:e+b+h+12}),p&&(l=$(F).width()||0,$(p).css({right:e+b+h+l+12}))):(void 0===a&&(a=1),100>a&&setTimeout(function(){this.update_flag_and_sign_position(a+
1)}.bind(this),100))};if(g.debugging||g.logging)a.to_debug_string=function(){return"backside of "+this.get_widget().to_debug_string()};d.toontalk_widget=k;g.UTILITIES.drag_and_drop(d);c.resizable({start:function(){u=c.width();e=c.height();q||(q=u);w||(w=e)},resize:function(a,f){var h=f.size.width,d=f.size.height;c.is(".toontalk-top-level-backside")||(b*=h/u,l*=d/e,u=h,e=d,g.backside.scale_backside(c,b,l,q,w))},handles:"e,s,se"});d.addEventListener("mouseenter",function(a){a=k.get_frontside();var b=
k.get_parent_of_backside();!a||b&&!b.get_widget().is_top_level()||g.UTILITIES.highlight_element(a.get_element())});d.addEventListener("mouseleave",function(a){k.is_top_level()||g.UTILITIES.remove_highlight()});a.update_display=function(){var b=this.get_description_text_area(),c=this.get_name_text_input(),e;b&&(e=this.get_widget().get_description())&&(b.button.value=e);c&&(c.button.value=this.get_widget().get_name());a.update_flag_and_sign_position();a.display_updated()};a.display_updated=function(){var a=
$(this.get_element());q||(q=a.width());w||(w=a.height())};k.get_backside_widgets&&(A=k.get_backside_widgets(),a.add_backside_widgets(A,k.get_backside_widgets_json_views()));g.debugging&&(d.id=k.debug_id);return a},toString:function(){return"backside of "+this.get_widget()},remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(k,a){var d=g.UTILITIES.create_check_box(a.get_infinite_stack(),"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+
a.get_type_name()+" to be copied instead of moved.");$(d.button).click(function(c){var b=d.button.checked,l;a.set_infinite_stack(b);a.robot_in_training()&&(l=b?"change dragging to make a copy of ":"change dragging back to moving for ",a.robot_in_training().edited(a,{setter_name:"set_infinite_stack",argument_1:b,toString:l,button_selector:".toontalk-infinite-stack-check-box"}));c.stopPropagation()});return d},create_description_label:function(k,a){var d=a.get_description();if(d)return g.UTILITIES.create_text_element("I'm the back side of a "+
a.get_type_name()+" that is "+d)},add_advanced_settings:function(k){var a=this.get_widget(),d=this.create_infinite_stack_check_box(this,a),c=a.get_type_name(),b=g.UTILITIES.create_text_area(a.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+c+".",function(b){(b=g.UTILITIES.input_area_drop_handler(b,a.receive_description_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(b,a,{area_selector:".toontalk-description-input",
setter:"receive_description_from_dropped",toString:"for a widget's description"})}),l=$("<button>Make a sensor nest</button>").button(),n=$("<button>Make a function bird</button>").button(),f=function(){var e=b.button.value.trim();a.set_description(e,!0)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_description",argument_1:e,toString:"change the description to '"+e+"'' of the "+c,button_selector:".toontalk-description-input"})},v=document.createElement("table"),p=this.get_element(),
h=function(b,c){var f=a.get_parent_of_frontside(),h=b.get_frontside_element(!0),d;f&&f.add_backside_widget&&!f.get_widget().is_top_level()?(f.add_backside_widget(b),d=f.get_element(),d.appendChild(h),f=$(d).offset(),f.top+=.6*$(d).height()):(a.add_to_top_level_backside(b,!1),f=c.offset(),f.left-=120,0>f.left&&(f.left=0));g.UTILITIES.set_absolute_position($(h),f)},q=$(p).find(".toontalk-settings-backside-button").get(0),w,u;a.set_name&&(u=function(b){(b=a.receive_name_from_dropped&&g.UTILITIES.input_area_drop_handler(b,
a.receive_name_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(b,a,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})},w=g.UTILITIES.create_text_input(a.get_name(),"toontalk-name-input",a.get_name_input_label?a.get_name_input_label():"My name is ",a.get_name_input_title?a.get_name_input_title():"Edit the name of this "+c+". There is not much room so keep it short.",void 0,"text",u),u=function(){var b=
w.button.value.trim();a.set_name(b,!0)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_name",argument_1:b,toString:"change the name to '"+b+"'' of the "+c,button_selector:".toontalk-name-input"})},w.button.addEventListener("change",u),w.button.addEventListener("mouseout",u),this.set_name_text_input(w));$(v).addClass("toontalk-advanced-setting");$(b.button).val(a.get_description());b.button.addEventListener("change",f);b.button.addEventListener("mouseout",f);this.set_description_text_area(b);
l.addClass("toontalk-make-sensor_nest_button").click(function(b){var c=g.sensor.create("click","which",void 0,void 0,!0,a);h(c,l);a.robot_in_training()&&a.robot_in_training().created_widget(c,a,".toontalk-make-sensor_nest_button");b.stopPropagation()});l.attr("title","Click to create a nest which receives messages when events happen to this "+a.get_type_name()+".");n.addClass("toontalk-make-function_bird_button").click(function(b){var f=a.get_function_type&&a.get_function_type(),f=g.bird.create_function(f||
c);h(f,n);a.robot_in_training()&&a.robot_in_training().created_widget(f,a,".toontalk-make-function_bird_button");b.stopPropagation()});a.is_number()||a.is_box()?n.attr("title","Click to get a bird that flies to functions of "+a.get_type_name(!0)+"."):(n.attr("title","There are no functions that operate on "+a.get_type_name(!0)+" (yet)."),n.button("option","disabled",!0));k||v.appendChild(g.UTILITIES.create_row(b.container));if(1<arguments.length)for(f=1;f<arguments.length;f++)v.appendChild(arguments[f]);
w&&!k&&v.appendChild(g.UTILITIES.create_row(w.container));v.appendChild(g.UTILITIES.create_row(l.get(0),n.get(0),d.container));k&&(p.insertBefore(g.UTILITIES.create_row(b.container),q),w&&p.insertBefore(g.UTILITIES.create_row(w.container),q));p.appendChild(v);$(p).find(".toontalk-advanced-setting").hide()},get_type_name:function(){return"the backside of "+g.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(k){var a,d,c,b,l,n,f,v;if(this.visible()&&(a=this.get_widget(),
d=a.get_frontside_element(!0),c=$(a.get_backside_element()),b=c.position(),l=c.parent().closest(".toontalk-backside"),n=function(a){var b=$(d).position(),c=function(){a.remove()};a.is(":visible")&&("0"===a.css("opacity")?(a.removeClass("toontalk-animating-element"),a.remove()):(a.addClass("toontalk-side-appearing"),g.UTILITIES.add_one_shot_event_handler(a.get(0),"transitionend",2500,c),g.UTILITIES.set_css(a,{left:b.left,top:b.top,opacity:.1})))},f=function(){var b=a.get_backside_widgets(),f=a.get_backside_widgets_json_views(!0);
this.get_backside_dimensions();var d;b.forEach(function(a,b){a.get_widget();var e;if(d=a.get_element())f[b]||(f[b]={}),a.start_position?(e=a.start_position,a.start_position=void 0):e=$(d).position(),a.is_backside()?(f[b].backside_left=g.UTILITIES.left_as_percent(e.left,d),f[b].backside_top=g.UTILITIES.top_as_percent(e.top,d)):(f[b].frontside_left=g.UTILITIES.left_as_percent(e.left,d,c.get(0)),f[b].frontside_top=g.UTILITIES.top_as_percent(e.top,d,c.get(0)))})}.bind(this),v=a.get_parent_of_backside(),
g.UTILITIES.remove_highlight(),f(),a.backside_geometry=this.get_backside_dimensions(),v&&(v.is_backside()?a.set_parent_of_backside(void 0,!0):v.removed_from_container(a,!0,k,void 0,!0),a.forget_backside&&a.forget_backside()),n(c),this.set_visible(!1),k&&!g.UTILITIES.visible_element(d)&&(b&&g.UTILITIES.set_css(d,{left:b.left,top:b.top}),k=g.UTILITIES.widget_from_jquery(l))&&(k.widget_dropped_on_me(a),a.render()),a.get_backside_widgets()&&a.get_backside_widgets().forEach(function(a){a.set_visible(!1)}),
a.on_backside_hidden))a.on_backside_hidden()},create_advanced_settings_button:function(k,a){var d=document.createElement("div"),c=$(d),b=!1;d.innerHTML="&gt;";c.addClass("toontalk-settings-backside-button");c.css({"z-index":g.UTILITIES.next_z_index()});c.click(function(d){b=!b;this.set_advanced_settings_showing(b,k.get_element(),c);d.stopPropagation();a.robot_in_training()&&a.robot_in_training().button_clicked(".toontalk-settings-backside-button",k)}.bind(this));g.UTILITIES.give_tooltip(c.get(0),
"Click to see the advanced settings of this "+a.get_type_name()+".");return c.get(0)},set_advanced_settings_showing:function(k,a,d){a||(a=this.get_element());d||(d=$(a).children(".toontalk-settings-backside-button"));k?($(a).children(".toontalk-advanced-setting").show(),d.html("<"),g.UTILITIES.give_tooltip(d.get(0),"Click to hide the advanced settings.")):($(a).children(".toontalk-advanced-setting").hide(),d.html(">"),g.UTILITIES.give_tooltip(d.get(0),"Click to show the advanced settings."))},get_widgets:function(){var g=
[];$(this.get_element()).children().each(function(a,d){var c=d.toontalk_widget;c&&0>g.indexOf(c)&&g.push(c)});return g},scale_backside:function(k,a,d,c,b){var l=Math.min(1,a,d);1===a&&1===d?g.UTILITIES.set_css(k,{width:"",height:""}):g.UTILITIES.set_css(k,{transform:"scale("+l+", "+l+")","transform-origin":"left top",width:c*a/l,height:b*d/l})},render:function(){g.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&g.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(g,
a,d){return this.get_widget().remove_backside_widget(g,a,d)},remove:function(){this.get_widget().remove()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},is_of_type:function(g){return this.get_widget().is_of_type(g)},is_hole:function(){return!1},save_dimensions:function(){return!1}}}(window.TOONTALK);window.TOONTALK.frontside=function(g){return{create:function(k){var a=Object.create(this),d=document.createElement("div"),c=$(d),b=function(a){if(!$(a.target).is(".ui-resizable-handle")&&("click"!==a.type||1===a.which)){if(c.is(".toontalk-top-level-resource"))k.set_running(!k.get_running());else if(!k.get_running()||k.robot_in_training())k.open_backside(),k.robot_in_training()&&k.robot_in_training().backside_opened(k);a.stopPropagation()}},l;$(d).addClass("toontalk-frontside toontalk-side");d.toontalk_widget=
k;g.UTILITIES.drag_and_drop(d);a.get_element=function(){return d};a.get_widget=function(){return k};a.visible=function(){return l};a.set_visible=function(a){var b;l!==a&&(l=a,b=this.get_widget(),b.walk_children&&b.walk_children(function(b){b.set_visible(a);return!0}))};d.addEventListener("click",b);d.addEventListener("touchstart",b);d.addEventListener("mouseenter",function(a){var b=k.get_backside(),c=(k.is_empty_hole()?wiget.get_parent_of_frontside():k).get_frontside_element();b&&g.UTILITIES.highlight_element(b.get_element());
$(".toontalk-wiggle").removeClass("toontalk-wiggle");$(c).is(".toontalk-top-level-resource")||$(c).addClass("toontalk-wiggle");a.stopPropagation()});d.addEventListener("mouseleave",function(a){a=k.get_backside();var b=k.is_empty_hole()?wiget.get_parent_of_frontside():k;a&&g.UTILITIES.remove_highlight();$(b.get_frontside_element()).removeClass("toontalk-wiggle")});g.debugging&&(d.id=k.debug_id);return a},update_display:function(){return this.get_widget().update_display()},remove:function(){var g=this.get_element();
$(g).remove();g.toontalk_widget=null}}}(window.TOONTALK);(function(g){var k=180/Math.PI,a=Math.log(10),d=bigrat.fromInteger(10),c=bigrat.fromValues(1,2),b=bigrat.fromValues(-1,2),l=bigrat.fromInteger(360),n=bigrat.fromDecimal(2*Math.PI),f=Math.log10?Math.log10:function(b){return Math.log(b)/a},v=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},p=function(a){var b=v(a),c=g.number.ZERO(g.number.function_bird_results_default_format),f=g.number.ZERO(g.number.function_bird_results_default_format);
c.set_value(b.integer_part);f.set_value(b.fractional_part);return g.box.create(2,!0,[c,f],"The integer and fraction parts of "+a.toString().replace(",","/"))},h=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),f=v(c);return bigrat.multiply(c,f.fractional_part,b)},q=function(a){a=v(a);return bigrat.isLessThan(a.fractional_part,b)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.isLessThan(a.fractional_part,c)?a.integer_part:bigrat.add(a.integer_part,
a.integer_part,bigrat.ONE)},w=function(a){a=v(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},u=function(a){a=v(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(g.widget),b=function(a,b,c,e){var f="",m=100;c=50/c;b/=1+b;if(e)for(e=0;m>=c&&
e<a.length;)f=f+"<span class='toontalk-digit' style='font-size:"+m+"%'>"+a[e]+"</span>",e+=1,"-"!==a[e]&&(m*=b);else for(e=a.length-1;m>=c&&0<e;)f="<span class='toontalk-digit' style='font-size:"+m+"%'>"+a[e]+"</span>"+f,--e,"-"!==a[e]&&(m*=b);return f},c=function(a,b){var c=a/(1+a);return Math.ceil(Math.log(.5/b)/Math.log(c))},h=function(a,c,e){if(a.length<=Math.round(c))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>c)return"";if(5>c)return"<span style='font-size: 80%'>"+
h(a,1.25*c,.8*e)+"</span>";c=c/2-1;return b(a,c,e,!0)+b(a,c,e,!1)},l=function(a,b){bigrat.isNegative(a)&&bigrat.abs(a,a);var c;a:{c=bigrat.fromValues(a[0],1);var e=bigrat.fromValues(a[1],1),f="",m=bigrat.create(),h=bigrat.create(),l=bigrat.create();for(bigrat.multiply(c,c,d);b>f.length;){if(bigrat.isLessThan(c,e))f+="0";else if(bigrat.divide(m,c,e),h=bigrat.toBigInteger(m),f+=h.toString(),bigrat.subtract(l,m,bigrat.fromValues(h,1)),bigrat.multiply(c,l,e),bigrat.equals(c,bigrat.ZERO)){c=f=k(f);break a}bigrat.multiply(c,
c,d)}c=f}return c},k=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?k(a.substring(0,a.length-1)):a},n=function(a,b){var c=Math.min(b,a/2);return a-(c+1)},q=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},u=function(a){switch(a){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return g.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";a.create=function(b,c,f,h,d,m){var l=Object.create(a),k=q(b,c);f||(f="+");l.is_number=function(){return!0};l.set_value=function(a,b){if(b||
!bigrat.equals(k,a))return this.fire_value_change_listeners(k,a),k=a,this.rerender(),g.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&g.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),this};l.set_value_from_sub_classes=l.set_value;l.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),e;c&&(e={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(e)}))};
l.get_value=function(){return k};l.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));g.debugging&&"0,0"===this.get_value().toString()&&g.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};l.copy=function(b){return this.add_to_copy(a.create(k[0],k[1],f,h,d,m),b)};l.get_format=function(){return h||a.default_format};l.set_format=function(a,b){h=a;b&&this.rerender();return this};l.get_operator=function(){return f};l.set_operator=function(a,b){f=a;b&&this.rerender();
return this};l.get_approximate=function(){return m};l.set_approximate=function(a,b){m=a;b&&this.rerender();return this};a.add_standard_widget_functionality(l);l.set_description(d);g.debugging&&(l._debug_string=l.toString(),l._debug_id=g.UTILITIES.generate_unique_id(),k._debug_id_new=l._debug_id);return l};a.create_from_bigrat=function(a){var b=g.number.ZERO();b.set_value(a);return b};a.create_backside=function(){return g.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(q(a,
b))};a.set_numerator=function(a){return this.set_value(q(a,this.get_value()[1].toString()))};a.set_denominator=function(a){return this.set_value(q(this.get_value()[0].toString(),a))};a.ONE=function(){return g.number.create(1)};a.ZERO=function(a){return g.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};
a.compare_with_number=function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),b=28,c,e,f,m;g.logging&&0<=g.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());a=a.get_element();$(a).is(".toontalk-conditions-contents")?c=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json")?(c=$(a),m=!0):c=$(a).parent().is(".toontalk-scale-half")?$(a):
$(a).parent();0===c.length&&(e=this.get_parent_of_frontside())&&(e.get_widget().is_hole()&&(e=e.get_parent_of_frontside()),c=$(e.get_frontside_element()));if($(a).is(".toontalk-carried-by-bird"))f=e=100;else if($(a).is(".toontalk-element-attribute"))e=200,f=32;else if(m&&(a===c.get(0)||c.is(".toontalk-top-level-resource")))e=$(a).width(),f=$(a).height(),e&&f||(e=76,f=55,$(a).css({width:e,height:f}));else{if(!g.UTILITIES.visible_element(c.get(0))){g.logging&&0<=g.logging.indexOf("display")&&console.log("Container not visible so no display of "+
this.to_debug_string());return}e=c.width();f=c.height();if(0===e||0===f){g.logging&&0<=g.logging.indexOf("display")&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());setTimeout(this.update_display.bind(this),100);return}c.is(".toontalk-nest")&&(e*=g.nest.CONTENTS_WIDTH_FACTOR,f*=g.nest.CONTENTS_HEIGHT_FACTOR)}$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");
b=this.get_border_size(e,f);4===b?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):8===b?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):16===b?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number");b=f-2*b;m=this.to_HTML(e/(.64*b),b,this.get_format(),!0,this.get_operator(),m);g.UTILITIES.on_a_nest_in_a_box(a)&&(e="width:"+e+"px;",b=m.indexOf('style="'),m=0<=b?m.substring(0,b+7)+e+
m.substring(b+7):m);e=$(a).children(".toontalk-widget");e.is("*")?e=e.get(0):(e=document.createElement("div"),a.appendChild(e));e.innerHTML=m;e.translate=!1;$(e).addClass("toontalk-widget notranslate");c.is(".toontalk-box-hole")&&$(a).css({width:"",height:""});g.UTILITIES.give_tooltip(a,this.get_title())};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};a.to_HTML=function(a,e,k,q,w,m){var t,x,J,p,v,N,y=!1!==q?" toontalk-top-level-number":"";v=4;this.is_attribute_widget&&
this.is_attribute_widget()?y+=" toontalk-attribute-number":this.get_approximate()&&(y+=" toontalk-approximate-number");m&&(y+=" toontalk-number-size-unconstrained-by-container");J=w?u(w):"";a||(a=4);e||(e=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+y+'" style="font-size: '+e+'px;"></div>';0<J.length&&(--a,2>a&&(e*=Math.max(1,a)/2,a=2));if(this.is_integer()&&"scientific_notation"!==k){try{t=bigrat.toBigInteger(this.get_value()).toString()}catch(B){g.UTILITIES.report_internal_error("Error converting number to a string: "+
B),t="0"}q=t.length;0<J.length&&q++;4>a&&q>a&&(k=Math.min(4,q),e*=a/k,a=k);return'<div class="toontalk-number toontalk-integer'+y+'" style="font-size: '+e+'px;">'+J+h(t,a,e)+"</div>"}if(this.get_approximate()||this.is_attribute_widget())if("decimal"===k?x=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===k&&(x=bigrat.toDecimal(this.get_value()).toExponential(),t=x.indexOf("e"),0<=t&&(p=x.substring(t+1),x=x.substring(0,t))),x)return q=x.length,0<J.length&&q++,p&&(a-=3+p.length/
2),"scientific_notation"===k&&(v+=2),a<v&&q>a&&(k=Math.min(v,q),e=0>=a?e*(Math.max(1,a)/k):e*(Math.max(2,a)/k),a=k),p=p?'&times;10<sup style="font-size: '+e/2+'px;">'+p+"</sup>":"",'<div class="toontalk-number toontalk-approximate-number'+y+'" style="font-size: '+e+'px;">'+J+b(x,a,e,!0)+p+"</div>";x=' style="font-size:'+.4*e+'px;"';if("improper_fraction"===k||!k)return e='<table class="toontalk-number toontalk-improper-fraction'+y+'"'+x+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+
h(this.numerator_string(),2*a,e)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+h(this.denominator_string(),2*a,e)+"</td></tr></table>",""===J?e:"<table class='toontalk-operator-and-fraction'"+x+"><tr><td>"+J+"</td><td>"+e+"</td></tr></table>";if("mixed_number"===k||"proper_fraction"===k){J=this.integer_part();if(J.is_zero())return this.to_HTML(a,
e,"improper_fraction",q,w);p=this.copy({just_value:!0}).subtract(J).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+y+'"'+x+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+J.to_HTML(a/2,e,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+p.to_HTML(a/2,e,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===k)return 4>a&&(e*=Math.max(1,a)/4,a=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+
y+'" style="font-size: '+e+'px;">'+J+this.decimal_string(a,e)+"</div>";if("scientific_notation"===k){t=bigrat.isNegative(this.get_value());p=this.get_value();v=bigrat.abs(bigrat.create(),p);p=bigrat.isLessThan(v,bigrat.ONE);v=(p?bigrat.toBigInteger(bigrat.divide(bigrat.create(),bigrat.ONE,v)):bigrat.toBigInteger(v)).toString();p=p?-v.length:v.length-1;v=bigrat.power(bigrat.create(),d,p+1);N=bigrat.divide(bigrat.create(),this.get_value(),v);v=6+(0===p?1:Math.ceil(f(Math.abs(p)))/2);t&&v++;if(a<v+1)return this.to_HTML(v+
1,e*a/(v+1),k,q,w,m);k=c(n(a,v),e);k=l(N,k);q=t?"-"+k.substring(0,1):k.substring(0,1);k=k.substring(1);a=b(k,a*(1-v/a),e,!0);0<a.length&&(a="<span class='toontalk-decimal-point'>.</span>"+a);return'<table class="toontalk-number toontalk-scientific_notation'+y+'"'+x+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+y+'" style="font-size: '+.9*e+'px;">'+J+q+a+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+
e+'px;"> &times;10<sup style="font-size: '+e/2+'px;">'+p+"</sup></div></td></tr></table>"}};a.drop_on=function(a,b,c,e){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b,c,e),!0;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,b,c,e);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,b,c,e){var f,m,h,d;if(a.visible()&&(c||e)){if(e){if(!e.animate_consequences_of_actions())return a.remove(),this.number_dropped_on_me_semantics(a,c,
e);a.robot_waiting_before_next_step=e}f=document.createElement("div");$(f).addClass("toontalk-bammer-down");m=$(this.get_frontside_element()).closest(".toontalk-top-level-backside");f.style.left="-10px";f.style.top=m.height()+"px";m.append(f);b=this.get_frontside_element();h=$(b).offset();h.left-=.75*$(f).width();h.left+=.5*$(b).width()+.1*$(f).width();h.top-=.5*$(b).height()+.4*$(f).height();b=function(){g.sounds&&g.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,c,e)&&e&&e.run_next_step();
c&&this.backup_all();$(f).removeClass("toontalk-bammer-down");g.UTILITIES.set_timeout(function(){var a=m.offset();a||(a={left:0,top:0});$(f).addClass("toontalk-bammer-away");h.left=a.left+m.width()-100;h.top=a.top+m.height()+100;d=function(){$(f).remove()};g.UTILITIES.animate_to_absolute_position(f,h,d,e&&e.transform_animation_speed(g.UTILITIES.default_animation_speed));$(f).css({opacity:.01})})}.bind(this);g.UTILITIES.animate_to_absolute_position(f,h,b,e&&e.transform_animation_speed(g.UTILITIES.default_animation_speed));
$(f).css({opacity:1,"z-index":g.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c,e)};a.number_dropped_on_me_semantics=function(a,b,c){b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove();switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "=":return this.set_value(a.get_value());
case "^":return this.power(a);default:g.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_dropped_on_me=function(a,b,c,e){return a.number_dropped_on_me?this.number_dropped_on_me(a,b,c,e):!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),
this.get_value(),a.get_value()),!0);return this};a.divide=function(a){this.set_value(bigrat.divide(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),
!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};a.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(){return this.get_erased()?"erased number":("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};a.operator_word=function(a){switch(this.get_operator()){case "+":return"add "+a+" to";case "-":return"subtract "+
a+" from";case "*":return"multiply "+a+" with";case "/":return"divide "+a+" into"}};a.get_text=function(){return this.is_integer()||"improper_fraction"===this.get_format()?this.toString():bigrat.toDecimal(this.get_value()).toString()};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};a.get_json=function(){return{type:"number",operator:this.get_operator(),numerator:this.numerator_string(),
denominator:this.denominator_string(),format:this.get_format(),approximate:this.get_approximate()}};g.creators_from_json.number=function(b){return a.create(b.numerator,b.denominator,b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();
return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};a.decimal_string=function(f,d){var g,k,q,m,t;if(this.is_integer())return this.numerator_string();g=this.get_value();k=a.create(g[0],g[1]);q=k.integer_part();g=q.toString();"0"===g&&this.is_negative()&&(g="-"+g);k=k.get_value();bigrat.subtract(k,k,q.get_value());
m=n(f,g.length);t=c(m,d);q=Math.min(g.length,f/2);k=l(k,t);k=k.length<m?k:b(k,m,d,!0);return h(g,q,d)+"<span class='toontalk-decimal-point'>.</span>"+k};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_number)return a.match_with_any_number();this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this))return"matched";
a.last_match=this;return a};a.get_custom_title_prefix=function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"Drop me on another number and I'll "+this.operator_word("myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+g.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=function(){return{create:function(a){var b=g.backside.create(a),c=
b.get_element(),f=document.createElement("div"),h=a.numerator_string(),d=a.denominator_string(),l=g.UTILITIES.create_text_area(h,"toontalk-numerator-input","","Type here to edit the numerator",void 0,"number"),k=g.UTILITIES.create_text_area(d,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),n=g.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal."),q=g.UTILITIES.create_radio_button("number_format",
"proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction."),u=g.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction."),w=g.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power."),
p=g.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on."),v=g.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on."),m=g.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on."),t=g.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","Divide me into what I'm dropped on."),
x=g.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value."),J=function(b){var c=l.button.value.trim(),m=k.button.value.trim(),f=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:f(a,b).replacement};a=f(a.substring(1,a.length),b,!0);a.message||(a.replacement=
"-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,"")}},t;if(c!==h||m!==d)t=f(c,"numerator"),t.message&&(g.UTILITIES.display_message(t.message),c=t.replacement),"0"===m?(g.UTILITIES.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1."),m="1"):(t=f(m,"denominator"),t.message&&(g.UTILITIES.display_message(t.message),m=t.replacement)),
a.set_from_values(c,m)&&(h=c,d=m,a.robot_in_training()&&(b=b.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:"set_denominator",argument_1:m,toString:"by changing the value of the denominator to "+m,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:"set_numerator",argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+b})),a.rerender())},S=function(){var b=g.UTILITIES.selected_radio_button(n.button,
q.button,u.button,w.button),c=b.value;a.set_format(c,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_format",argument_1:c,toString:"by changing the format to "+c+" of the number",button_selector:"."+b.className.split(" ",1)[0]});a.rerender()},R=function(){var b=g.UTILITIES.selected_radio_button(p.button,v.button,m.button,t.button,x.button),c=b.value;a.set_operator(c,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_operator",argument_1:c,toString:"by changing the operator to "+
c+" of the number",button_selector:"."+b.className.split(" ",1)[0]})},N=g.UTILITIES.create_horizontal_table(l.container,f,k.container),W=$(g.UTILITIES.create_horizontal_table(n.container,q.container,u.container,w.container)).buttonset().get(0),Z=$(g.UTILITIES.create_horizontal_table(p.container,v.container,m.container,t.container,x.container)).buttonset().get(0),ca=g.backside.create_advanced_settings_button(b,a),da=b.update_display.bind(b);f.innerHTML="/";$(f).addClass("ui-widget");c.appendChild(N);
c.appendChild(ca);l.button.addEventListener("change",J);l.button.addEventListener("mouseout",J);l.button.addEventListener("mouseenter",function(){h=l.button.value.trim()});k.button.addEventListener("change",J);k.button.addEventListener("mouseout",J);k.button.addEventListener("mouseenter",function(){d=k.button.value.trim()});n.button.addEventListener("change",S);q.button.addEventListener("change",S);u.button.addEventListener("change",S);w.button.addEventListener("change",S);switch(a.get_format()){case "decimal":g.UTILITIES.check_radio_button(n);
break;case "improper_fraction":g.UTILITIES.check_radio_button(u);break;case "mixed_number":case "proper_fraction":g.UTILITIES.check_radio_button(q);break;case "scientific_format":g.UTILITIES.check_radio_button(w)}switch(a.get_operator()){case "+":g.UTILITIES.check_radio_button(p);break;case "-":g.UTILITIES.check_radio_button(v);break;case "*":g.UTILITIES.check_radio_button(m);break;case "/":g.UTILITIES.check_radio_button(t);break;case "=":g.UTILITIES.check_radio_button(x)}p.button.addEventListener("change",
R);v.button.addEventListener("change",R);m.button.addEventListener("change",R);t.button.addEventListener("change",R);x.button.addEventListener("change",R);b.update_display=function(){$(l.button).val(a.numerator_string());$(k.button).val(a.denominator_string());da()};$(W).addClass("toontalk-advanced-setting");$(Z).addClass("toontalk-advanced-setting");c.appendChild(W);c.appendChild(Z);b.add_advanced_settings();return b}}}();window.TOONTALK.number.function=function(){var a=g.create_function_table(),
b=function(a){return bigrat.toDecimal(h(a,l))},c=function(a){return bigrat.toDecimal(h(a,n))};a.add_function_object("sum",function(b,c,f){return a.n_ary_widget_function(b,g.number.ZERO,g.number.add,"sum",c,f)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",function(b,c,f){return a.n_ary_widget_function(b,g.number.ZERO,g.number.subtract,"difference",c,f)},"The bird will return with the result of subtracting the numbers in the box from the first number.",
"-");a.add_function_object("product",function(b,c,f){return a.n_ary_widget_function(b,g.number.ONE,g.number.multiply,"product",c,f)},"The bird will return with the product of the numbers in the box.","\u00d7");a.add_function_object("division",function(b,c,f){return a.n_ary_widget_function(b,g.number.ONE,g.number.divide,"division",c,f)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00f7");a.add_function_object("modulo",function(b,c,f){return a.n_ary_function(b,
a.bigrat_function_to_widget_function(h),2,"modulo",c,f)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(b,c,f){return a.n_ary_widget_function(b,g.number.ONE,g.number.minimum,"minimum",c,f)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(b,c,f){return a.n_ary_widget_function(b,g.number.ONE,g.number.maximum,
"maximum",c,f)},"The bird will return with the largest of the numbers in the box.","max");a.add_function_object("absolute value",function(b,c,f){return a.n_ary_function(b,function(a){var c=g.number.ZERO(b.get_hole_contents(1).get_format());bigrat.abs(c.get_value(),a);return c},1,"absolute value",c,f)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(function(a,b){var c=
bigrat.power(bigrat.create(),a,b[0].valueOf()),e=b[1].valueOf();return 1===e?c:bigrat.nthRoot(c,c,e)},!0),2,"power",c,f)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},!0),1,"logarithm",c,f)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).",
"log");a.add_function_object("random",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c,f)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.",
"rand");a.add_function_object("round",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(q),1,"round",c,f)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(w),1,"floor",c,f)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(u),
1,"ceiling",c,f)},"The bird will return the smallest integer greater than or equal to the number.","ceil");a.add_function_object("delay",function(b,c,f){var h=Date.now(),d=a.check_message(b),l;if(d)if(2>d.size)g.UTILITIES.display_message("Delay function birds need a number in the second hole.");else return l=b.get_hole_contents(1).to_float(),setTimeout(function(){var l=g.number.ZERO(g.number.function_bird_results_default_format);l.set_value_from_decimal((Date.now()-h)/1E3);l.set_approximate(!0);a.process_response(l,
d.bird,b,c,f)},1E3*l),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");a.add_function_object("integer and fraction parts",function(b,c,f){return a.n_ary_function(b,p,1,"integer and fraction parts",c,f)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(c,f,h){return a.n_ary_function(c,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/
k)},!0,b),1,"sine",f,h)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",function(c,f,h){return a.n_ary_function(c,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/k)},!0,b),1,"cosine",f,h)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return k*
Math.atan(a)},!0),1,"arc tangent",c,f)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.","atan");a.add_function_object("arc tangent of y and x",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return k*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c,f)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.",
"atan2");a.add_function_object("sine (in radians)",function(b,f,h){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,!0,c),1,"sine (in radians)",f,h)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,f,h){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,c),1,"cosine (in radians)",f,h)},"The bird will return with an approximation of the cosine of the number (in radians).",
"cos rad");a.add_function_object("arc tangent (in radians)",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,!0),1,"arc tangent (in radians)",c,f)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",
c,f)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.","atan2 rad");return a.get_function_table()}()})(window.TOONTALK);(function(g){var k=function(a,d,c,b){var l;a&&0<=c&&a.maintain_proportional_dimensions()&&a.get_default_width?(l=a.get_default_width(),a=a.get_default_height(),c/l>=b/a?(l=l*b/a,c={left:(c-l)/2,top:0,width:l,height:b}):(l=a*c/l,c={left:0,top:(b-l)/2,width:c,height:l})):c={left:0,top:0};g.UTILITIES.set_css(d,c)};window.TOONTALK.box=function(a){var d=Object.create(a.widget);d.create=function(c,b,l,g,f){var v=Object.create(d),p=[];"undefined"===typeof b&&(b=!0);v.is_box=function(){return!0};v.get_horizontal=
function(){return b};v.set_horizontal=function(a,c){b=a;c&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());return this};v.get_hole=function(a){return p[a]};v.get_hole_contents=function(a){return p[a].get_contents()};v.set_hole=function(b,c,f){var d;p[b].set_contents(c);if(f){c&&c.save_dimensions();f=this.get_frontside_element();b=$(f).children(".toontalk-hole-number-"+b);b.empty();if(!c)return;d=this.get_hole_dimensions();f=c.get_frontside_element(!0);b.append(f);
k(c,f,d.width,d.height);c.rerender()}this.rerender();a.debugging&&(this._debug_string=this.to_debug_string())};v.get_holes=function(){return p};v.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=void 0}.bind(this)};v.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};
v.set_contents=function(a){a.forEach(function(a,b){p[b].set_contents(a)})};v.get_size=function(){return c};v.set_size=function(b,f){var d,l;if(c===b||0>b||isNaN(b))return!1;l=this.visible();p.length=b;if(b>c)for(d=c;d<b;d++)p[d]=a.box_hole.create(d),p[d].set_parent_of_frontside(v),p[d].set_visible(l);c=b;f&&this.rerender();a.debugging&&(this._debug_string=this.to_debug_string());return!0};v.get_hole_dimensions=function(){var f=this.get_frontside_element(),d=$(f).width()||a.box.get_default_width(),
f=$(f).height()||a.box.get_default_height();return b?{width:d/c,height:f}:{width:d,height:f/c}};v.receive_size_from_dropped=function(b,c){var f;if(b.is_number())return f=a.number.create(this.get_size()),f.number_dropped_on_me_semantics(b),f=Math.max(0,Math.round(f.to_float())),this.set_size(f),f.toString()};v.copy=function(a){var f;a||(a={});f=p.map(function(b){if(b=b.get_contents())return b.copy(a)});f=d.create(c,b,f,this.get_description(),this.get_name());return this.add_to_copy(f,a)};v.generate_name=
function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};v.add_standard_widget_functionality(v);v.has_name(v);v.set_name(f);for(f=0;f<c;f++)p[f]=a.box_hole.create(f),p[f].set_parent_of_frontside(v);v.set_description(g);l&&v.set_contents(l);a.debugging&&(v._debug_id=a.UTILITIES.generate_unique_id(),v._debug_string=v.to_debug_string());return v};d.create_backside=function(){return a.box_backside.create(this)};d.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&
a.equals_box(this)};d.equals_box=function(a){var b=this.get_size(),d,g,f;if(b!==a.get_size())return!1;for(d=0;d<b;d++)if(g=this.get_hole_contents(d),f=a.get_hole_contents(d),!g&&f||g&&!f||g&&f&&(!g.equals||!g.equals(f)))return!1;return!0};d.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};d.compare_with_box=function(a){var b=this.get_size(),d=a.get_size(),g,f;if(b>d)return 1;if(b<d)return-1;for(d=0;d<b;d++){g=this.get_hole_contents(d);f=a.get_hole_contents(d);if(g&&
!f)return 1;if(!g&&f)return-1;if(g&&f)if(g.compare_with){if(g=g.compare_with(f),1===g||-1===g)return g}else return}return 0};d.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_box)return a.match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=a,this)};d.match_with_any_box=function(){return"matched"};d.match_with_this_box=function(c){var b=this.get_size(),d=[],g,f,k;if(b!==c.get_size())return c.last_match=
this,c;for(g=0;g<b;g++)if(k=c.get_hole_contents(g))if(f=this.get_hole_contents(g)){f=a.UTILITIES.match(k,f);if(f.is_widget)return f;"matched"!==f&&(d=0===d.length?f:d.concat(f))}else if(f=this.get_contents_temporarily_removed(g))d.push(f);else return c.last_match=this,c;return 0<d.length?d:"matched"};d.toString=function(a){var b="",d=this.get_size(),g,f,k=this.get_type_name()+" that looks like ";for(g=0;g<d;g++)f=this.get_hole(g),b+=f.get_full_description(a),g<d-1&&(b+=" | ");return k+"["+b.replace(k,
"")+"]"};d.get_type_name=function(a){return a?"boxes":"box"};d.get_help_URL=function(){return"docs/manual/boxes.html"};d.get_json=function(c){var b=[],d=this.get_size(),g;for(g=0;g<d;g++)this.get_hole_contents(g)?b[g]=a.UTILITIES.get_json(this.get_hole_contents(g),c):b[g]=null;return{type:"box",size:d,contents:b,horizontal:this.get_horizontal(),name:this.get_name()}};d.walk_children=function(a){var b=this.get_size(),d;for(d=0;d<b&&a(this.get_hole(d));d++);};a.creators_from_json.box=function(c,b){return d.create(c.size,
c.horizontal,a.UTILITIES.create_array_from_json(c.contents,b),c.description,c.name)};d.update_display=function(){var c=this.get_frontside(!0).get_element(),b=this.get_size(),d=function(c,f,d){var h=f.get_contents(),l=(h||f).get_frontside_element(!0),w=$(c).parents(".toontalk-box-hole"),p=function(){$(c).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(K/=a.nest.CONTENTS_WIDTH_FACTOR,L/=a.nest.CONTENTS_HEIGHT_FACTOR)},E,D,K,L;g?(D=0,0<w.length?(K=q-2*r/b,L=u-2*r):(K=q,L=u),p(),E=
K*d,1<d&&(E+=r*(d-1))):(E=0,0<w.length?(K=q-2*r,L=u-2*r/b):(K=q,L=u),p(),D=L*d,1<d&&(D+=r*(d-1)));a.UTILITIES.set_css(c,{left:E,top:D,width:K,height:L});v[d]&&c.setAttribute("toontalk_name",v[d]);!a.UTILITIES.has_animating_image(l)&&0<d&&($(c).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(c).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),
g?$(c).addClass(e+"-left"):$(c).addClass(e+"-top"));c!==l&&(k(h,l,K,L),c.appendChild(l),f.get_contents().rerender());f.is_element()&&(f=f.get_contents(),f.set_size_attributes(K,L,!0))},g=this.get_horizontal();$(c).is(".toontalk-box");var f=function(){var e=$(c).children(".toontalk-box-hole");e.length===b?e.each(function(a,b){var c=this.get_hole(a);c&&d(b,c,a)}.bind(this)):(e.remove(),this.get_holes().forEach(function(a,b){p=a.get_element();$(p).addClass("toontalk-hole-number-"+b);d(p,a,b);c.appendChild(p)}));
$(c).parent(".toontalk-conditions-contents-container").is("*")||($(c).parent(".toontalk-box-hole").is("*")?a.UTILITIES.set_css(c,{width:"",height:""}):a.UTILITIES.set_css(c,{width:h,height:w}))}.bind(this),v=this.get_name().split(";"),p,h,q,w,u,e,r;a.logging&&0<=a.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(c).addClass("toontalk-box");$(c).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");
a.UTILITIES.give_tooltip(c,this.get_title());a.debugging&&(this._debug_string=this.to_debug_string());this.get_erased()?($(c).addClass("toontalk-box-erased"),$(c).children(".toontalk-side").remove()):($(c).removeClass("toontalk-box-erased"),h=0===b?0:$(c).width()||a.box.get_default_width(),w=$(c).height()||a.box.get_default_height(),g?(q=0===b?0:h/b,u=w):(q=h,u=w/b),r=this.get_border_size(q,u),e=4===r?"toontalk-box-eighth-size-border":8===r?"toontalk-box-quarter-size-border":16===r?"toontalk-box-half-size-border":
"toontalk-box-full-size-border",g?q-=(b-1)*r/b:u-=(b-1)*r/b,$(c).addClass(e),a.UTILITIES.set_timeout(f))};d.get_default_width=function(){return 164};d.get_default_height=function(){return 68};d.get_border_size=function(a,b){var d;if(0===a)return d=$(this.get_frontside_element()).width(),16>=d?4:32>=d?8:64>=d?16:32;a||(a=$(this.get_frontside_element()).width());b||(b=$(this.get_frontside_element()).height());return 32>=a||32>=b?4:64>=a||64>=b?8:128>=a||128>=b?16:32};d.get_name_input_label=function(){return"The labels of my holes are"};
d.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};d.drop_on=function(a,b,d,g){if(a.box_dropped_on_me)return b=a.box_dropped_on_me(this,d,g),d&&a.rerender(),b&&this.remove(),b;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,b,d,g);console.log("No handler for drop of "+this+" on "+a)};d.box_dropped_on_me=function(a,b){console.log("box on box not yet implemented");return!1};d.widget_dropped_on_me=function(c,
b,d,g){var f=this.which_hole(d),k;if(0<=f)return k=this.get_hole(f),(f=k.get_contents())?c.drop_on(f,b,d,g):k.widget_dropped_on_me(c,b,d,g);a.UTILITIES.report_internal_error(c+" dropped on "+this+" but no event was provided.")};d.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};d.removed_from_container=function(c,b,d,g,f){b=!!d;"undefined"===typeof g&&(g=this.get_index_of(c));0<=g?(this.set_hole(g,void 0,b),
b&&(this.rerender(),c.restore_dimensions())):f&&a.UTILITIES.report_internal_error("Attempted to remove "+c+" from "+this+" but not found.")};d.get_path_to=function(c,b){var d=this.get_size(),g,f;if("empty hole"===c.get_type_name()){d=c.get_parent_of_frontside();f=a.box.path.create(c.get_index());if(d===this)return f;d=this.get_path_to(d);if(!d)return;d.next=f;return d}for(g=0;g<d;g++)if(f=this.get_hole_contents(g)||this.get_contents_temporarily_removed(g)){if(c===f||f.top_contents_is&&f.top_contents_is(c))return a.box.path.create(g);
if(f.get_path_to&&(f=f.get_path_to(c,b)))return d=a.box.path.create(g),d.next=f,d}};d.element_to_highlight=function(a){a=this.which_hole(a,!0);var b;if(0>a||0===this.get_size())return this.get_frontside_element();a=this.get_hole(a);return(b=a.get_contents())?b.get_frontside_element():a.get_frontside_element()};d.which_hole=function(a){var b=this.get_horizontal(),d=this.get_frontside_element(),g=this.get_size(),f,k;if(0!==g&&(f=$(d).offset(),d=b?$(d).width()/g:$(d).height()/g,k=b?f.left:f.top,a))for(f=
0;f<g;f++)if(k+=d,(b?a.pageX<=k:a.pageY<=k)||f+1===g)return f};d.dereference_path=function(c,b,d){var g,f;if(c){g=c.get_index&&c.get_index();if(!a.debugging||"number"===typeof g){if(f=this.get_hole_contents(g)){if(f.dereference_contents&&!c.not_to_be_dereferenced)return f.dereference_contents(c.next||c,b,d);if(c.next){if(f.dereference_path)return f.dereference_path(c.next,b,d);a.UTILITIES.report_internal_error("Expected to refer to a part of "+f+" but it lacks a method to obtain "+a.path.toString(c.next))}c.removing_widget&&
("empty hole"===f.get_type_name()?a.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):f.get_infinite_stack()||d.remove_from_container(f,this));return f}return this.get_hole(g)}a.UTILITIES.report_internal_error(this+" unable to dereference the path: "+a.path.toString(c))}else return this};d.path={create:function(c){return{get_index:function(){return c},toString:function(){return"scale"===this.true_type?0===c?"the left pan ":"the right pan ":"the "+a.UTILITIES.ordinal(c)+
" hole "},get_json:function(a){return{type:"box_path",index:c,true_type:this.true_type,next:this.next&&this.next.get_json(a)}}}}};d.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};a.creators_from_json.box_path=function(c,b){var l=d.path.create(c.index);c.next&&(l.next=a.UTILITIES.create_from_json(c.next,b));c.true_type&&(l.true_type=c.true_type);return l};return d}(window.TOONTALK);window.TOONTALK.box_backside=function(a){return{create:function(d){var c=a.backside.create(d),
b=a.UTILITIES.create_text_input(d.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(b){if(b=a.UTILITIES.input_area_drop_handler(b,d.receive_size_from_dropped.bind(d),d))d.rerender(),d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(b,d,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),l=a.UTILITIES.create_radio_button("box_orientation","horizontal",
"toontalk-horizontal-radio-button","Left to right","Show box horizontally."),g=a.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-vertical-radio-button","Top to bottom","Show box vertically."),f=function(){var a=parseInt(b.button.value.trim(),10);d.set_size(a,!0)&&d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_size",argument_1:a,toString:"by changing the number of holes to "+a+" of the box",button_selector:".toontalk-box-size-input"})},k=function(){var b=
a.UTILITIES.selected_radio_button(l.button,g.button),c=b.value,e="horizontal"===c;d.set_horizontal(e,!0);d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_horizontal",argument_1:e,toString:"by changing the orientation to "+c+" of the box",button_selector:"."+b.className.split(" ",1)[0]})},p=c.get_element(),h=a.backside.create_advanced_settings_button(c,d),q=c.update_display.bind(c);b.button.addEventListener("change",f);b.button.addEventListener("mouseout",f);l.button.addEventListener("change",
k);g.button.addEventListener("change",k);c.update_display=function(){b.button.value=d.get_size().toString();d.get_horizontal()?a.UTILITIES.check_radio_button(l):a.UTILITIES.check_radio_button(g);q()};p.appendChild(b.container);p.appendChild($(a.UTILITIES.create_horizontal_table(l.container,g.container)).buttonset().get(0));p.appendChild(h);c.add_advanced_settings();c.rerender();return c}}}(window.TOONTALK);window.TOONTALK.box_hole=function(a){return{create:function(d){var c=Object.create(this),b,
l,g;c.is_hole=function(){return!0};c.is_empty_hole=function(){return!b};c.location_constrained_by_container=function(){return!1};c.get_element=function(){g||(g=document.createElement("div"),g.className="toontalk-box-hole toontalk-frontside toontalk-side",g.toontalk_widget=c);return g};c.get_frontside=function(a){return b?b.get_frontside(a):this.get_element()};c.get_frontside_element=function(a){return this.get_element()};c.get_frontside=function(){return this};c.widget_dropped_on_me=function(b,c,
d,h){var l=this.get_parent_of_frontside(),g,k,e;b.dropped_on_other&&b.dropped_on_other(this,!1,d,h);d?(a.sounds&&a.sounds.fall_inside.play(),c=this.get_element(),h=b.is_plain_text_element(),e=b.get_element(),$(e).css({"z-index":a.UTILITIES.next_z_index()}),k=$(e.parentElement).offset(),g=$(c).offset(),h||(e.style.left=d.pageX-k.left+"px",e.style.top=d.pageY-k.top+"px",$(e).addClass("toontalk-animating-element")),e.style.width=c.style.width,e.style.height=c.style.height,e.style.left=g.left-k.left+
"px",e.style.top=g.top-k.top+"px",d=function(){$(e).removeClass("toontalk-animating-element");l.render();this.set_contents(b)}.bind(this),setTimeout(d,h||a.UTILITIES.has_animating_image(e)?0:1200),l.robot_in_training()&&l.robot_in_training().dropped_on(b,this),b.save_dimensions&&b.set_size_attributes&&b.set_size_attributes($(c).width(),$(c).height())):(l.rerender(),this.set_contents(b));return!0};c.get_json=function(){return null};c.add_to_json=function(a){return a};c.copy=function(b){return a.box_hole.create(d)};
c.match=function(){return"matched"};c.get_type_name=function(a){return b?b.get_type_name(a):a?"empty holes":"empty hole"};c.is_of_type=function(a){return b?b.is_of_type(a):"empty hole"===a};c.get_box=function(){return this.get_parent_of_frontside()};c.update_display=function(){var a;b&&(a=this.get_frontside_element(),k(b,b.get_frontside_element(),$(a).width(),$(a).height()))};c.dereference=function(){return b?b.dereference():this};c.get_index=function(){return d};c.get_contents=function(){return b};
c.set_contents=function(c){var d=this.get_listeners("value_changed");d&&(b!==c&&d.forEach(function(a){a({type:"value_changed",old_value:b,new_value:c})}),b&&d.forEach(function(a){b.remove_listener("value_changed",a,!0)}),c&&d.forEach(function(a){c.add_listener("value_changed",a)}));b&&b.set_parent_of_frontside(void 0);(b=c)?(b.set_parent_of_frontside(this),a.debugging&&(this._debug_string="A hole containing "+b.to_debug_string()),b.set_visible(l)):a.debugging&&(this._debug_string=this.to_debug_string())};
c.visible=function(){return this.get_parent_of_frontside().visible()};c.set_visible=function(a){l=a;b&&b.set_visible(a)};c.remove=function(){b&&b.remove()};c.render=function(){b&&a.DISPLAY_UPDATES.pending_update(this)};c.rerender=function(){if(b&&this.visible())return this.render()};c.set_running=function(a){b&&b.set_running(a)};c.maintain_proportional_dimensions=function(){if(b)return b.maintain_proportional_dimensions()};c.removed_from_container=function(c,d,l,h,g){b?(l&&b.restore_dimensions(),
this.set_contents(void 0),l&&this.get_parent_of_frontside().render()):g&&a.UTILITIES.report_internal_error("Holes can't be removed from containers.")};c.temporarily_remove_contents=function(a,c){if(b)return this.get_parent_of_frontside().temporarily_remove_contents(a,c)};c.toString=function(){return b?b.toString():"_"};c.get_description=function(){return b?b.get_description():"_"};c.get_full_description=function(a){return b?b.get_full_description(a):"_"};c.is_backside=function(){return!1};c.get_widget=
function(){return this.get_parent_of_frontside()};c.is_number=function(){return b?b.is_number():!1};c.is_box=function(){return b?b.is_box():!1};c.is_scale=function(){return b?b.is_scale():!1};c.is_bird=function(){return b?b.is_bird():!1};c.is_nest=function(){return b?b.is_nest():!1};c.is_robot=function(){return b?b.is_robot():!1};c.is_element=function(){return b?b.is_element():!1};c.is_sensor=function(){return b?b.is_sensor():!1};c.is_top_level=function(){return!1};c.is_plain_text_element=function(){return!1};
a.widget.has_parent(c);a.widget.has_listeners(c);if(a.debugging||a.logging)c.to_debug_string=function(){var c="the "+a.UTILITIES.ordinal(d)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box");return b?c+" which contains "+b.to_debug_string():c+" which is empty"},c._debug_string=c.to_debug_string();return c}}}(window.TOONTALK);window.TOONTALK.box.function=function(){var a=g.create_function_table();a.add_function_object("box hole",
function(d,c,b){return a.typed_bird_function(d,function(a,b){var c=Math.round(a.to_float());if(1>c)g.UTILITIES.display_message("The box hole function bird cannot accept "+a+". She only accepts positive numbers.");else if(c>b.get_size())g.UTILITIES.display_message("The box hole function bird cannot accept "+a+". The box only has "+b.get_size()+" holes.");else return b.get_hole_contents(c-1)},["number","box"],2,"box hole",c,b)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. 1 for the first hole.",
"hole",["number","box"]);a.add_function_object("count holes",function(d,c,b){return a.typed_bird_function(d,function(a){return g.number.create(a.get_size())},["box"],1,"count holes",c,b)},"The bird will return with the number of holes the box has.","count holes",["box"]);a.add_function_object("fill hole",function(d,c,b){return a.typed_bird_function(d,function(a,b,c){var d=Math.round(a.to_float());if(1>d)g.UTILITIES.display_message("The fill hole function bird cannot accept "+a+". She only accepts positive numbers.");
else return d>b.get_size()&&b.set_size(d),b.set_hole(d-1,c),b},["number","box",void 0],3,"fill hole",c,b)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);a.add_function_object("split box",function(d,c,b){return a.typed_bird_function(d,function(a,b){var c=Math.round(a.to_float()),d=b.get_size();if(0>c)g.UTILITIES.display_message("The box split function bird cannot accept "+
a+". She only accepts zero or positive numbers.");else if(c>d)g.UTILITIES.display_message("The box split function bird cannot accept "+a+". The box only has "+d+" holes.");else{b.get_holes();var d=d-c,k=g.box.create(d),h;for(h=0;h<d;h++)k.set_hole(h,b.get_hole_contents(h+c));b.set_size(c);return g.box.create(2,!1,[b,k])}},["number","box"],2,"split box",c,b)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.",
"split",["number","box"]);a.add_function_object("merge boxes",function(d,c,b){return a.typed_bird_function(d,function(){var a=0,b,c,d,k;if(0===arguments.length)return g.box.create(0);c=arguments[0];for(b=0;b<arguments.length;b++)a+=arguments[b].get_size();d=c.get_size();c.set_size(a);for(b=1;b<arguments.length;b++)for(k=arguments[b].get_size(),a=0;a<k;a++)c.set_hole(d,arguments[b].get_hole_contents(a)),d++;return c},["box"],void 0,"merge boxes",c,b)},"The bird will return with a box that joins together all the boxes.",
"merge",["any number of boxes"]);return a.get_function_table()}()})(window.TOONTALK);(function(){var g,k,a,d,c;window.TOONTALK.bird=function(a){var d=Object.create(a.widget),n=function(c,d,g){var h=c.get_function_type();c=c.get_function_object();var l=Object.keys(TOONTALK[h]["function"]),k=l.map(function(a){return TOONTALK[h]["function"][a].title}),l=a.UTILITIES.create_select_menu("functions",l,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",k);d=d.get_element();c&&(l.menu.value=c.name);l.menu.addEventListener("change",
function(a){g.set_function_name(a.target.value)});d.insertBefore(l.container,d.firstChild)};d.create=function(f,v){var p=Object.create(d),h=[],q=[];g=function(a){f=a};p.is_bird=function(){return!0};p.widget_dropped_on_me=function(c,d,e,h,g,l){var k=d?c.get_backside():c,n,q;if(f){if(f.has_ancestor(c))return a.UTILITIES.display_message("Bird can't take its nest to its nest!"),!1;!(f.visible()||this.visible()||f.any_nest_copies_visible())||h&&h.visible()&&!h.animate_consequences_of_actions()?(f.add_to_contents(k,
e,h),h&&h===k.robot_waiting_before_next_step&&(k.robot_waiting_before_next_step=void 0,h.run_next_step())):(l||c.save_dimensions(),n=this.get_frontside_element(),setTimeout(function(){$(n).removeClass("toontalk-bird-gimme").addClass(this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside().rerender()}.bind(this)),c.set_visible(f.visible()),h&&!g&&(c.robot_waiting_before_next_step=h,c.remove_from_parent_of_frontside(),h.run_next_step&&(q=function(){k.robot_waiting_before_next_step=
void 0;h.run_next_step()})),f.animate_bird_delivery(k,this,q,e,h))}else console.log("TODO: handle drop on a nestless bird -- just removes other?");e&&this.robot_in_training()&&this.robot_in_training().dropped_on(c,this);return!0};p.animate_delivery_to=function(c,d,e,g,l,k,n,p){var v=!!e,B=this.get_parent_of_frontside(),C=this.get_frontside_element(!0);$(C).width();var E=this.closest_visible_ancestor_or_frontside(),D=$(E.get_frontside_element()).offset(),K=function(){var c=$(J).offset(),e;a.sounds&&
a.sounds.bird_fly.pause();v?this.remove():this.visible()&&(e=function(){$(C).removeClass("toontalk-bird-morph-to-static");$(C).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));B&&B.get_widget().rerender()}.bind(this),C.style.position=S,c&&(D.left-=c.left,D.top-=c.top),a.UTILITIES.set_css(C,D),J&&J.appendChild(C),B&&(B.get_widget().is_top_level()?this.rerender():B.get_widget().rerender()),W&&(ja.remove_backside_widget(this,!1,!0),W(),h&&(c=h,h=[],q=[],c.forEach(function(a){a()}))),
a.UTILITIES.add_animation_class(C,"toontalk-bird-morph-to-static"),a.UTILITIES.add_one_shot_event_handler(C,"animationend",1E3,e));k&&k()}.bind(this),L=function(){try{e.add_to_contents(c,n,p,this,!0)}catch(d){if(d.wait_for_nest_to_receive_something){d.wait_for_nest_to_receive_something.run_when_non_empty(L,this);k&&(k(),k=void 0);return}console.error(d.stack);throw d;}m($(C).offset());a.UTILITIES.set_timeout(function(){this.fly_to(D,K,p)}.bind(this))}.bind(this),P=function(c,e){c.width_before_carry=
$(c).width();c.height_before_carry=$(c).height();this.element_to_display_when_flying=c;e&&(this.update_display(),setTimeout(function(){e.update_display()}));$(this.element_to_display_when_flying).addClass("toontalk-carried-by-bird");a.UTILITIES.set_timeout(function(){var d={left:"",top:"",position:""};e&&!e.use_scaling_transform&&(d.width="",d.height="");a.UTILITIES.set_css(c,d);this.update_display()}.bind(this))}.bind(this),m=function(e){this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),
e?(a.UTILITIES.set_css(this.element_to_display_when_flying,{width:this.element_to_display_when_flying.width_before_carry||"",height:this.element_to_display_when_flying.height_before_carry||"","z-index":a.UTILITIES.next_z_index()}),a.UTILITIES.set_absolute_position($(this.element_to_display_when_flying),e),(e=c.get_parent_of_frontside())&&!e.is_backside()?e.rerender():c.rerender()):$(this.element_to_display_when_flying).remove(),this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),
t,x,J,S,R,N,W,Z,ca,da,ja;e||(e=f);da=c.get_element(!0);P(da,c);d.is_function_nest()||(x=d.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!d.visible()&&!this.visible()||!d.is_function_nest()&&!a.UTILITIES.visible_element(x))e.add_to_contents(c,n,p,this,!0);else if(a.sounds&&a.sounds.bird_fly.play(),$(C).removeClass("toontalk-bird-static"),d.is_function_nest()||(x=d.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element(),
t=$(x).offset(),N=$(e.get_frontside_element()).closest(".toontalk-top-level-backside")),N&&N.is("*")||(N=$(this.get_frontside_element()).closest(".toontalk-top-level-backside")),(d=N.offset())||(d={left:0,top:0}),g?D={left:g+d.left,top:l+d.top}:0===D.left&&0===D.top&&(D={left:-da.clientWidth,top:d.top+N.height()/2}),t||(t={left:-2*da.clientWidth,top:d.top+N.height()/2}),J=C.parentElement,E=$(C).width(),R=$(C).height(),S=C.style.position,C.style.position="absolute",ja=this.top_level_widget(),B&&B.temporarily_remove_contents&&
(W=B.temporarily_remove_contents(this,!0))&&ja.add_to_top_level_backside(this),N.append(C),a.UTILITIES.set_css(C,{left:g||D.left-d.left,top:l||D.top-d.top,width:E,height:R}),a.logging&&0<=a.logging.indexOf("bird")&&console.log(this.to_debug_string()+" from "+(g||D.left-d.left)+", "+(l||D.top-d.top)+" to "+t.left+", "+t.top),(Z=e.get_contents_frontside_element&&e.get_contents_frontside_element())&&e.visible()&&(!p||p.animate_consequences_of_actions())){g=$(x).width();l=$(x).height();ca=$(x).offset();
d.max_left=d.left+N.width();d.max_top=d.top+N.height();t.left+=g;t.top+=l;var ka={left:Math.min(ca.left+g,d.max_left-g),top:Math.min(ca.top+l,d.max_top-l)},oa={left:Math.max(ca.left-g,d.left),top:Math.max(ca.top-l,d.top)};t=function(){var a=function(){e.visible()?(e.set_locked(!0),this.fly_to(ca,xa,p,300)):(e.add_to_contents(c,n,p,this,!0),k&&(k(),k=void 0))}.bind(this);m(ka);e.get_locked()?e.run_when_unlocked(a):a()}.bind(this);var xa=function(){P(Z);this.fly_to(oa,ya,p,300)}.bind(this),ya=function(){m(oa);
this.fly_to(ka,qa,p,300)}.bind(this),qa=function(){P(da,c);this.fly_to(ca,wa,p,300)}.bind(this),wa=function(){var d=e.get_contents_dimensions();m(ca);a.UTILITIES.set_css(c.get_frontside_element(),d);this.fly_to(oa,la,p,300)}.bind(this),la=function(){P(Z);this.fly_to(ca,Ba,p,300)}.bind(this),Ba=function(){e.set_locked(!1);m();e.update_display();L()}.bind(this);this.fly_to(ka,t,p,300)}else this.fly_to(t,L,p,300)};p.get_json=function(c){return{type:"bird",nest:f&&a.UTILITIES.get_json(f,c)}};p.copy=function(a){var b,
e,d;if(a)if(a.just_value)b=this.create(void 0,this.get_description());else{if((d=f.get_guid())&&a.nests_copied&&a.nests_copied[d]){b=a.nests_copied[d][0];c.call(b);for(e=1;e<a.nests_copied[d].length;e++)k.call(a.nests_copied[d][e],b);b=this.create(b,this.get_description())}else b=this.create(f,this.get_description());a.birds_copied||(a.birds_copied={});d&&(a.birds_copied[d]||(a.birds_copied[d]=[]),a.birds_copied[d].push(b))}else b=f&&f.is_function_nest()?this.create(f.copy(),this.get_description()):
this.create(f,this.get_description());return this.add_to_copy(b,a)};p.run_when_non_empty=function(a,b){0>q.indexOf(b)&&(h.push(a),q.push(b))};p.create_backside=function(){var c=a.bird_backside.create(this);f&&f.is_function_nest()&&n(f,c,this);return c};p.get_help_URL=function(){return f&&f.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};p.is_function_bird=function(){return f&&f.is_function_nest()};p.get_custom_title_prefix=function(){var a;return f?f.is_function_nest()&&
(a=f.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":"This bird no longer knows where her nest is. She'll get rid of anything you give her."};p.toString=function(a){return f?f.is_function_nest()?f.get_function_object().toString():"a bird":a&&"conditions"===a.role?"any bird":"a bird without a nest"};p.update_display=function(){var c=this.get_frontside(!0);this.get_backside();var d;d=c.get_element();f&&d.setAttribute("toontalk_name",f.get_name());a.UTILITIES.give_tooltip(d,
this.get_title());$(d).is(".toontalk-bird, .toontalk-side-animating")||($(d).addClass(this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),d.addEventListener("dragenter",function(c){0<=d.className.indexOf("toontalk-bird-static")&&($(d).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),a.UTILITIES.add_animation_class(d,"toontalk-bird-gimme"))}.bind(this)),d.addEventListener("dragleave",function(a){$(d).is(".toontalk-bird-gimme")&&($(d).addClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?d.appendChild(this.element_to_display_when_flying):$(d).children(".toontalk-side").remove()};p.set_function_name=function(a){f&&f.is_function_nest()&&f.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+
a+"'",button_selector:".toontalk-select-function"}))};p.get_class_name_with_color=function(a){return f&&f.get_class_name_with_color?f.get_class_name_with_color(a):a};p.get_name=function(){return f&&f.get_name()};f&&f.set_name&&(p.set_name=function(a,b){return f.set_name(a,b)});p.add_standard_widget_functionality(p);p.set_description(v);a.debugging&&(p._debug_id=a.UTILITIES.generate_unique_id(),p._debug_string=p.to_debug_string());return p};d.create_function=function(c,g,k){return d.create(a.nest.create_function(g,
c,k||a.UTILITIES.get_first_property(a[c].function)))};d.match=function(a){if(a.match_with_any_bird)return a.match_with_any_bird(this);this.last_match=a;return this};d.match_with_any_bird=function(){return"matched"};d.fly_to=function(c,d,g,h){var l=this.get_frontside_element(),k=$(l).offset(),k=Math.atan2(c.top-k.top,c.left-k.left),n="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*
(k/Math.PI+1))%8];$(l).position();var e=function(){$(l).removeClass(n);h?setTimeout(d,g?g.transform_step_duration(h):h):d()}.bind(this);setTimeout(function(){$(l).removeClass("toontalk-bird-static");a.UTILITIES.add_animation_class(l,n);this.animate_to_absolute_position(c,e,g&&g.transform_animation_speed(a.UTILITIES.default_animation_speed))}.bind(this),1)};d.get_type_name=function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};d.maintain_proportional_dimensions=function(){return!0};
d.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};d.drop_on=function(a,b,c,d){if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,!1,c,d)};a.creators_from_json.bird=function(c,d){return a.bird.create(a.UTILITIES.create_from_json(c.nest,d),c.description)};return d}(window.TOONTALK);window.TOONTALK.bird_backside=function(a){return{create:function(c){var d=a.backside.create(c);d.get_element().appendChild(a.backside.create_advanced_settings_button(d,
c));d.add_advanced_settings(!0);return d}}}(window.TOONTALK);window.TOONTALK.nest=function(b){var l=Object.create(b.widget),n,f=0,v=0;l.default_maximum_capacity=10;l.maximum_capacity=l.default_maximum_capacity;l.create=function(p,h,q,w,u,e){var r=Object.create(l),A=[],F=[],G=[],y,H,B;h||(h=[]);u||(f++,u=f);k=function(b){w&&d.call(w,this);w=b;q=b.get_guid();a.call(b,this)};c=function(){w&&d.call(w,this);w=void 0;q=b.UTILITIES.generate_unique_id()};a=function(a){n||(n=b.UTILITIES.generate_unique_id());
this[n](a)};d=function(a){n||(n=b.UTILITIES.generate_unique_id());this[n](a,!0)};r.is_nest=function(){return!0};r.get_guid=function(){return q};r.matched_by=function(a){return 0<h.length?b.UTILITIES.match(a,h[0].get_widget()):[[this,a]]};r.run_when_non_empty=function(a,b){0<h.length?a(h[0]):0>G.indexOf(b)&&(A.push(a),G.push(b))};r.dereference=function(){return 0<h.length?h[0]:this};r.match=function(a){if(0<h.length)return h[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);
this.last_match=a;return this};r.add_to_contents=function(a,c,e,d,f){var g;g=h.push(a);var m=this.visible();g>l.maximum_capacity&&e&&!e.visible()&&!m&&(b.logging&&0<=b.logging.indexOf("nest")&&console.log(this.to_debug_string()+" postponing addition of "+a.to_debug_string()+" by "+e.to_debug_string()+". Stack is "+h.length+" long. "+F.length+" previously postponed."),e.add_body_finished_listener(function(a,b,c){e.set_stopped(!0);F.push(function(){e.set_stopped(!1);e.run_actions(a,b,c)})}));b.logging&&
0<=b.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+a.to_debug_string()+" nest now contains "+h.length+" widgets.");1===g?(0<A.length&&(g=A,A=[],G=[],g.forEach(function(b){b(a)})),a.set_visible(m),m||a.get_widget().hide()):(a.get_widget().hide(),a.set_visible(!1));a.is_backside()?a.get_widget().set_parent_of_backside(this):a.get_widget().set_parent_of_frontside(this);y&&!f&&(d?y.forEach(function(m){m.has_ancestor(a.get_widget())||m.animate_bird_delivery(b.UTILITIES.copy_side(a),
d,void 0,c,e)}):y.forEach(function(d){d.has_ancestor(a.get_widget())||d.add_to_contents(b.UTILITIES.copy_side(a,!1,!0),c,e)}));this.rerender()};r.animate_bird_delivery=function(a,c,e,d,f){var h,m,g;void 0===this.get_parent_of_frontside()?(a.remove(),e&&e()):(c.animate_delivery_to(a,this,void 0,void 0,void 0,e,d,f),y&&(h=$(c.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),m=c.get_parent_of_frontside().get_element(),g=this.visible(),y.forEach(function(e){var l=
b.UTILITIES.copy_side(a,!1,g),k,n;e.has_ancestor(a.get_widget())||(h&&(e.visible()||g)?(k=c.copy({just_value:!0}),n=k.get_frontside_element(!0),$(m).append(n),k.animate_delivery_to(l,e,e,h.left,h.top,void 0,d,f)):e.add_to_contents(l,void 0,f))})))};r.get_contents_frontside_element=function(){if(0<h.length)return h[0].get_widget().get_frontside_element()};r.get_locked=function(){return this.locked_for_animating_deliveries};r.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&
0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};r.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};r.removed_from_container=function(a,c,e,d,f){a=h.shift();b.logging&&0<=b.logging.indexOf("nest")&&console.log(this.to_debug_string()+" removed "+a.to_debug_string()+" remaining widgets is "+h.length);if(a)return a.is_backside()?a.get_widget().set_parent_of_backside(void 0):a.get_widget().set_parent_of_frontside(void 0),
this.visible()&&(a.get_widget().restore_dimensions(),0<h.length&&(h[0].set_visible(!0),$(h[0].get_element()).show()),this.render()),h.length<l.maximum_capacity&&0<F.length&&(b.logging&&0<=b.logging.indexOf("nest")&&console.log(this.to_debug_string()+" running "+F.length+" postponed additions. Stack is "+h.length+" long."),l.maximum_capacity=Number.MAX_VALUE,F.forEach(function(a){a()}),l.maximum_capacity=l.default_maximum_capacity,F=[]),a;f&&b.UTILITIES.report_internal_error("Nothing removed from nest!")};
r.dereference_path=function(a,c,e){if(0===h.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(h)return h[0].dereference_path(a,c,e);b.UTILITIES.display_message("Robot expected to find a nest something that it could get "+b.path.toString(a)+". But the nest is empty.");return this};r.dereference_contents=function(a,c,e){var d,f,g,m;return 0===h.length?{wait_until_this_nest_receives_something:this}:a.removing_widget?(a=h[0],e.remove_from_container(a,this),this.visible()&&
(g=this.get_frontside_element(),e=$(g).offset(),c=$(g).closest(".toontalk-backside-of-top-level"),(d=c.offset())||(d={left:0,top:0}),f=a.get_frontside_element(!0),m=$(g).width(),g=$(g).height(),b.UTILITIES.set_css(f,{left:.1*m+e.left-d.left,top:.1*g+e.top-d.top,width:m*b.nest.CONTENTS_WIDTH_FACTOR,height:g*b.nest.CONTENTS_HEIGHT_FACTOR}),c.append(f)),a):a.next?h[0].get_widget().dereference_path(a.next,c,e):h[0].get_widget()};r.get_json=function(a){return{type:"nest",contents:b.UTILITIES.get_json_of_array(h,
a),guid:q,original_nest:w&&b.UTILITIES.get_json(w,a),serial_number:u,name:this.get_name()}};r.copy=function(a){var c,e,d,f;if(a&&a.just_value){if(0<h.length&&(c=h[0].get_widget().copy(a),!a.copy_covered_nests))return c;e=b.nest.create(this.get_description(),[],"in a robot's condition",void 0,u,this.get_name());c&&e.add_to_contents(c);return e}c=b.UTILITIES.copy_widget_sides(h,a);a?a.fresh_copy?e=b.nest.create(this.get_description(),c,q&&b.UTILITIES.generate_unique_id()):(d=w||this,a.birds_copied&&
a.birds_copied[q]?(f=d.get_guid(),a.nests_copied&&a.nests_copied[f]?(e=a.nests_copied[f][0].copy(),a.nests_copied[f].forEach(function(a){k.call(a,e)})):e=b.nest.create(this.get_description(),c,b.UTILITIES.generate_unique_id()),a.birds_copied[q].forEach(function(a){g.call(a,e)})):e=b.nest.create(this.get_description(),c,q,d,u,this.get_name()),a.nests_copied||(a.nests_copied={}),a.nests_copied[d]?a.nests_copied[f].push(e):a.nests_copied[f]=[e]):e=b.nest.create(this.get_description(),c,q,w||this,u,this.get_name());
return this.add_to_copy(e,a)};r.has_contents=function(){return 0<h.length};r.dropped_on_other=function(a,c,e,d){var f,h,m,g,l,k,n;if(!q){q=b.UTILITIES.generate_unique_id();b.debugging&&(this._debug_string=this.to_debug_string());f=b.bird.create(this);if(d){d.add_newly_created_widget(f);if(!this.visible())return;this.robot_waiting_before_next_step=d}e&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(f);b.sounds&&setTimeout(function(){b.sounds.hatching.play()},1E3);this.rerender();
h=this.get_frontside_element(!0);b.UTILITIES.add_animation_class(h,"toontalk-hatch-egg");l=function(){var l,x,q;if(c)l=a.get_backside();else if((q=b.UTILITIES.widget_from_jquery($(h).closest(".toontalk-top-level-backside")))||(q=b.UTILITIES.widget_from_jquery($(a.get_widget().get_frontside_element(!0)).closest(".toontalk-top-level-backside"))),q)l=q.get_backside();else{b.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");return}x=l.get_element();q=$(x).offset();
m=f.get_frontside_element(!0);$(m).removeClass(this.get_class_name_with_color("toontalk-bird-static"));b.UTILITIES.add_animation_class(m,"toontalk-fly-southwest");g=b.UTILITIES.relative_position(h,x);b.UTILITIES.set_css(m,{left:g.left,top:g.top});e&&this.robot_in_training()?l.widget_dropped_on_me(f,!1,e,void 0,!0):l.widget_dropped_on_me(f,!1,e);$(h).removeClass("toontalk-hatch-egg").addClass(this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",height:""});this.get_parent_of_frontside().get_widget().is_top_level()&&
b.UTILITIES.set_css(h,{left:g.left-5,top:g.top+45});this.get_parent_of_frontside().render();n=function(){$(m).removeClass("toontalk-fly-southwest");b.UTILITIES.set_timeout(function(){b.UTILITIES.add_animation_class(m,"toontalk-fly-down");$(m).removeClass(this.get_class_name_with_color("toontalk-bird-static"));k=function(){var a=function(){$(m).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass(this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);$(m).removeClass("toontalk-fly-down");
b.UTILITIES.add_animation_class(m,"toontalk-bird-morph-to-static");b.UTILITIES.add_one_shot_event_handler(m,"animationend",1E3,a);d&&(this.robot_waiting_before_next_step=void 0,d.run_next_step());f.update_display()}.bind(this);b.UTILITIES.add_one_shot_event_handler(h,"animationend",1E3,k)}.bind(this))}.bind(this);$(m).removeClass(this.get_class_name_with_color("toontalk-bird-static"));l=Math.max(10,g.left-70);x=Math.max(10,g.top+70);f.animate_to_absolute_position({left:l+q.left,top:x+q.top},n,d&&
d.transform_animation_speed(b.UTILITIES.default_animation_speed));this.rerender()}.bind(this);b.UTILITIES.add_one_shot_event_handler(h,"animationend",2E3,l)}return!0};r.widget_dropped_on_me=function(a,b,c,e){c&&a.save_dimensions&&a.save_dimensions();0===h.length?(this.add_to_contents(b?a.get_backside():a,c,e),a.dropped_on_other?a.dropped_on_other(this,b,c,e):c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(h[0].get_widget(),b,c,e);return!0};r.drop_on=function(a,
b,c,e){return a.widget_dropped_on_me?(a.widget_dropped_on_me(this,!1,c,e),!0):!1};r.element_to_highlight=function(){return 0===h.length?this.get_frontside_element():h[0].get_frontside_element()};r.update_display=function(){var a=this.get_frontside(!0),c=this.get_backside(),e,d,f,g,m,a=a.get_element();a.setAttribute("toontalk_name",this.get_name());0<h.length?(e=h[0].get_widget(),h[0].is_backside()?(g=e.get_backside(!0),m=g.get_element(!0),g.update_display(),g.scale_to_fit(m,a)):(e.render(),m=h[0].get_element(!0),
$(m).show()),d=$(a).width(),f=$(a).height(),0<d&&0<f&&b.UTILITIES.set_timeout(function(){var a=this.get_contents_dimensions();a&&(b.UTILITIES.set_css(m,{width:a.width,height:a.height,left:.1*d,top:.1*f}),e.set_size_attributes&&e.set_size_attributes(a.width,a.height))}.bind(this),2),a.appendChild(m),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest")),h[0].is_backside()?e.set_parent_of_backside(this):e.set_parent_of_frontside(this)):(b.UTILITIES.give_tooltip(a,this.get_title()),q?($(a).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),
$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest"))):b.UTILITIES.add_animation_class(a,this.get_class_name_with_color("toontalk-nest-with-egg")));$(a).addClass("toontalk-nest");c&&c.rerender()};n||(n=b.UTILITIES.generate_unique_id());r[n]=function(a,b){if(!y){if(b)return;y=[]}b?y.splice(y.indexOf(a),1):y.push(a)};r.get_contents_dimensions=function(){var a=this.get_frontside_element(),c=$(a).width(),a=$(a).height(),c=b.nest.CONTENTS_WIDTH_FACTOR*c,a=b.nest.CONTENTS_HEIGHT_FACTOR*a,
e=h[0],d;if(e)return d=e.is_box()?1:2,e=e.get_border_size?d*e.get_border_size(c,a):0,{width:c-e,height:a-e}};r.get_path_to=function(a,c){var e,d;if(0<h.length){e=h[0].get_widget();if(e===a)return b.path.to_widget_on_nest();if(e.get_path_to&&(d=b.path.to_widget_on_nest(),e=e.get_path_to(a,c)))return d.next=e,d}};r.walk_children=function(a){if(0<h.length)return a(h[0])};r.top_contents_is=function(a){return 0<h.length&&h[0].get_widget()===a};r.any_nest_copies_visible=function(){var a=!1;if(!y)return!1;
y.some(function(b){b.visible()&&(a=!0)});return a};r.compare_with=function(a){if(0<h.length)return h[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};r.compare_with_nest=function(a){return 0===h.length?0:1};r.compare_with_number=function(a){return 0<h.length?h[0].compare_with(a):-1};r.get_class_name_with_color=function(a){return u?a+["","-magenta","-yellow"][u%3]:a};r.generate_name=function(){v++;return"#"+v.toString()};r.has_name(r);H=r.set_name;r.set_name=function(a,
c){var e=this.get_name();if(!H.call(this,a,c))return!1;c&&$(".toontalk-bird").each(function(){this.getAttribute("toontalk_name")===e&&b.UTILITIES.widget_of_element(this).rerender()})};r.set_name(e);r.compare_with_box=r.compare_with_number;r.compare_with_scale=r.compare_with_number;r.add_standard_widget_functionality(r);B=r.set_visible;r.set_visible=function(a){B.call(this,a);a||this.set_locked(!1)};r.set_description(p);b.debugging&&(r._debug_id=b.UTILITIES.generate_unique_id(),r._debug_string=r.to_debug_string());
w&&q&&(n||(n=b.UTILITIES.generate_unique_id()),w[n](r));return r};l.create_function=function(a,c,d){var f=function(){return!1},g=b[c]&&b[c].function&&b[c].function[d],f={get_function_type:function(){return c},get_function_object:function(){return g},set_function_name:function(a){if(d===a)return!1;d=a;g=b[c]&&b[c].function&&b[c].function[d];this.add_to_contents=g.respond_to_message;return!0},is_function_nest:function(){return!0},copy:function(){return b.nest.create_function(a,c,d)},animate_bird_delivery:function(a,
b,c,d,f){b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,f)},get_json:function(a){return{type:"function_nest",function_type:c,function_name:g?g.name:b.UTILITIES.get_first_property(b[c].function)}},add_to_json:b.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return g.short_name},has_ancestor:f,visible:f,any_nest_copies_visible:f,is_backside:f};b.widget.has_parent(f);b.widget.has_description(f);b.widget.add_sides_functionality(f);f.set_description(a);
g?(f.add_to_contents=g.respond_to_message,b.debugging&&(f._debug_id=b.UTILITIES.generate_unique_id(),f._debug_string="a function nest that "+g.toString())):b.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+c+"."+d+" is not defined.");return f};b.creators_from_json.function_nest=function(a,c){return b.nest.create_function(a.description,a.function_type,a.function_name)};l.create_backside=function(){return b.nest_backside.create(this)};l.match_nest_with_nest=function(a){return"matched"};
l.toString=function(){return"a nest"};l.get_help_URL=function(){return"docs/manual/birds-nests.html"};l.get_type_name=function(a){return a?"nests":"nest"};l.maintain_proportional_dimensions=function(){return!0};l.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};l.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};b.creators_from_json.nest=function(a,c){var d=!a.original_nest&&a.guid&&c&&c.guid_to_nest_table&&
c.guid_to_nest_table[a.guid];d||(d=b.nest.create(a.description,b.UTILITIES.create_array_from_json(a.contents,c),a.guid,a.original_nest&&b.UTILITIES.create_from_json(a.original_nest,c),a.serial_number,a.name),c.guid_to_nest_table[a.guid]=d);return d};l.CONTENTS_WIDTH_FACTOR=.8;l.CONTENTS_HEIGHT_FACTOR=.8;return l}(window.TOONTALK);window.TOONTALK.nest_backside=function(a){return{create:function(c){var d=a.backside.create(c);d.get_element().appendChild(a.backside.create_advanced_settings_button(d,c));
d.add_advanced_settings(!0);return d}}}(window.TOONTALK)})();window.TOONTALK.scale=function(g){var k=Object.create(g.widget);k.create=function(a,d,c,b,l){var k=function(){c.rerender()},f,v,p;c||(c=g.box.create(2,void 0,a,d,l||""));f=c.get_json;v=c.copy;p=c.get_path_to;c.is_scale=function(){return!0};c.copy=function(a){var b,d=this.get_name();a||(a={});b=v.call(this,a);b=g.scale.create(void 0,void 0,b,a.just_value&&this.get_state());b.set_name(d);return c.add_to_copy(b,a)};c.get_json=function(a){a=f.call(this,a);a.type="scale";a.inactive_state=this.get_inactive_state();
return a};c.get_path_to=function(a,b){var c=p.call(this,a,b);c&&(c.true_type="scale");return c};c.drop_on=function(a,b,c,d){if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,b,c,d)};c.widget_dropped_on_me=function(a,b,c,d){var e=this.get_hole_contents(0),f=this.get_hole_contents(1),g;a.dropped_on_other&&a.dropped_on_other(this,!1,c,d);if(e&&!f)return this.get_hole(1).widget_dropped_on_me(a,b,c,d),!0;if(!e&&(f||!c))return this.get_hole(0).widget_dropped_on_me(a,b,c,d),!0;g=this.which_hole(c,
!1);if(0===g){if(e){if(e.drop_on)return a.drop_on(e,b,c,d);return}}else if(f){if(f.drop_on)return a.drop_on(f,b,c,d);return}this.get_hole(g).widget_dropped_on_me(a,b,c,d);return!0};c.which_hole=function(a,b){var d=$(c.get_frontside_element()),f=d.offset(),d=d.width(),f=a.clientX-(f.left+d/2),d=b?d/10:0;return-f>d?0:f>d?1:-1};c.get_inactive_state=function(){return b};c.update_display=function(){var a=this.get_frontside_element(!0),b=$(a),c=$(a).children(".toontalk-scale-half"),d=$(a).parent(),d=d.is(".toontalk-backside")?
a:d.get(0),e=$(d).width(),f=$(d).height(),l=function(a,b,c){var d=b.get_contents(),h=(d||b).get_frontside_element(!0),g=c*e*.5,l=.5*e,k=f;b=b.get_contents();$(a).css({left:g,top:0,width:l,height:k});a!==h&&(g=0===c?-.05*e:.15*e,c="toontalk-scale-balanced"===n?.1*f:0===c&&"toontalk-scale-left_heavier"===n||1===c&&"toontalk-scale-right_heavier"===n?.25*f:1===c&&"toontalk-scale-left_heavier"===n||0===c&&"toontalk-scale-right_heavier"===n?-.1*f:.2*f,l=.4*e,k=.4*f,$(h).css({left:g,top:c,width:l,height:k}),
b&&(b.set_location_attributes&&b.set_location_attributes(g,c),b.set_size_attributes&&b.set_size_attributes(l,k)),a.appendChild(h),d.rerender())},k,n;b.is(".toontalk-top-level-resource")?n="toontalk-scale-balanced":(k=this.get_state(),n="undefined"===typeof k?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][k+1]);b.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");
b.addClass(n);b.addClass("toontalk-scale");b=g.UTILITIES.scale_to_fit(a,d,123,91);0===e&&(e=1);0===f&&(f=1);e/=b.x_scale;f/=b.y_scale;2===c.length?c.each(function(a,b){g.UTILITIES.set_timeout(function(){l(b,this.get_hole(a),a)}.bind(this))}.bind(this)):this.get_holes().forEach(function(b,c){var e=b.get_element();0===c?$(e).addClass("toontalk-left_scale  toontalk-scale-half"):$(e).addClass("toontalk-right_scale toontalk-scale-half");l(e,b,c);a.appendChild(e)});g.UTILITIES.give_tooltip(a,this.get_title());
g.debugging&&(this._debug_string=this.to_debug_string())};c.render=function(){g.DISPLAY_UPDATES.pending_update(this)};c.get_type_name=function(a){return a?"scales":"scale"};c.get_help_URL=function(){return"docs/manual/scales.html"};c.toString=function(){var a=this.get_hole_contents(0),b=this.get_hole_contents(1),c,d,e;switch(this.get_state()){case -1:c="scale leaning to the right";break;case 1:c="scale leaning to the left";break;case 0:c="balanced scale";break;default:if(c="unbalanced scale",!d&&
!e)return c}d=a?"contains "+g.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";e=b?"contains "+g.UTILITIES.add_a_or_an(b.get_full_description()):"is empty";return c+" and the left pan "+d+" and the right pan "+e};c.create_backside=function(){return g.scale_backside.create(this)};c.get_state=function(){var a=this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);b=this.get_hole_contents(1);if(a||b)if(a){if(!b)return 1;if(a.compare_with)return a.compare_with(b)}else return-1};
c.match=function(a){if(a.match_with_scale)return a.match_with_scale(this);this.last_match=a;return this};c.match_with_scale=function(a){return this.get_state()===a.get_state()?"matched":a};c.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};c.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};c.get_name_input_label=void 0;c.generate_name=function(){return""};c.get_hole(0).add_listener("value_changed",k);
c.get_hole(1).add_listener("value_changed",k);c.get_hole_contents(0)&&c.get_hole_contents(0).add_listener("value_changed",k);c.get_hole_contents(1)&&c.get_hole_contents(1).add_listener("value_changed",k);c.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+
" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};g.debugging&&(c._debug_id=g.UTILITIES.generate_unique_id(),c._debug_string=c.to_debug_string());return c};g.creators_from_json.scale=function(a,d){return k.create(g.UTILITIES.create_array_from_json(a.contents,d),a.description,void 0,a.inactive_state,a.name)};return k}(window.TOONTALK);
window.TOONTALK.scale_backside=function(g){return{create:function(k){var a=g.backside.create(k);a.get_element().appendChild(g.backside.create_advanced_settings_button(a,k));a.add_advanced_settings(!0);return a}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(g){var k=function(a,b,d,k,f){var v;d.current_action_name=b;(a=g.path.get_path_to(a,d))?(k||(k={}),v=Date.now(),k.time=v-d.time_of_last_step,d.time_of_last_step=v,d.add_step(g.robot_action.create(a,b,k),f)):console.log("No path found for "+b);d.current_action_name=void 0},a=Object.create(g.widget),d=0;a.create=function(c,b,d,k,f,v,p,h,q){var w=Object.create(a),u,e,r,A=[],F=[],G,y,H,B,C;d||(d=g.actions.create());u||(u=w);c&&c.set_parent_of_frontside(w);w.is_robot=
function(){return!0};w.get_frontside_conditions=function(){return c};w.set_frontside_conditions=function(a){c=a;c.set_parent_of_frontside(this)};w.get_backside_matched_widgets=function(){return C};w.set_backside_matched_widgets=function(a){C=a};w.get_matched_backside_widget=function(a){if(C)return C[this.get_training_context().get_backside_widgets().indexOf(a)]};w.get_backside_widget_of_type=function(a,b){var c,e;if(C)return C[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&
0>this.get_newly_created_widgets().indexOf(b))return e=b,!0}.bind(this)),e};w.get_backside_conditions=function(){return b};w.set_backside_conditions=function(a){$.isArray(a)?b=a.map(function(a){return a.is_nest()?a.dereference().copy():a}):(b=[],g.UTILITIES.available_types.forEach(function(c){a[c]&&b.push(a[c])}));b&&b.forEach(function(a){g.widget.erasable(a);a.set_parent_of_frontside(this)}.bind(this))};b&&w.set_backside_conditions(b);w.initialize_backside_conditions=function(){var a=this.get_training_context();
B=g.UTILITIES.copy_widget_sides(a.get_backside_widgets(),{just_value:!0});this.set_backside_conditions([])};w.add_to_backside_conditions=function(a){var c;0<=this.get_newly_created_widgets().indexOf(a)||(b||(b=[]),a=this.get_training_context().get_backside_widgets().indexOf(a),0<=a&&(c=B[a]),c&&0>b.indexOf(c)&&(b.push(c),g.widget.erasable(c)))};w.get_backside_condition_index=function(a){a=this.get_training_context().get_backside_widgets().indexOf(a);if(0<=a)return b.indexOf(B[a])};w.get_body=function(){return d};
w.set_body=function(a){d=a};w.get_running=function(){return y||this.is_ok_to_run()};w.running_or_in_run_queue=function(){return y};w.set_running_or_in_run_queue=function(a){y=a};w.stopped=function(){return H};w.set_stopped=function(a){if(H=a)this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.drop_thing_in_hand(),this.rerender()),y=!1;this.get_next_robot()&&this.get_next_robot().set_stopped(a)};w.drop_thing_in_hand=function(){f&&(f.drop_on(this.top_level_widget(),
!1,void 0,this),this.set_thing_in_hand(void 0))};w.finish_cycle_immediately=function(a){var b=r,c=function(){r=b;this.set_visible(!1);a&&a()}.bind(this);r=0;this.add_body_finished_listener(c)};w.get_maximum_step_duration=function(){return r};w.get_context=function(){return G};w.set_context=function(a){G=a};w.animate_consequences_of_actions=function(){return this.visible()&&0!==r};w.transform_step_duration=function(a){return void 0===a&&0===r?0:q&&a?a/q:"number"===typeof r?Math.min(a,r):a};w.transform_original_step_duration=
function(a){if(G&&!G.get_backside())return 0;if(!q)return a};w.transform_animation_speed=function(a){return G&&!G.get_backside()?0:q?a*q:a};w.set_animating=function(a,b){var c=this.get_frontside_element();a?(b||(b=$(c).offset()),$(c).addClass("toontalk-robot-animating toontalk-side-animating"),$(c).css({width:"",height:"","z-index":g.UTILITIES.next_z_index()}),g.UTILITIES.set_position_relative_to_top_level_backside($(c),b),$(c).closest(".toontalk-top-level-backside").append(c)):$(c).removeClass("toontalk-robot-animating toontalk-side-animating")};
w.add_body_finished_listener=function(a){A.push(a)};w.run_body_finished_listeners=function(a,b,c){A.forEach(function(e){e(a,b,c)});A=[]};w.add_watched_step_end_listeners=function(a){F.push(a)};w.run_watched_step_end_listeners=function(){F.forEach(function(a){a()});F=[]};w.get_thing_in_hand=function(){return f};w.set_thing_in_hand=function(a){if(g.debugging){if(a&&"empty hole"===a.get_type_name()){g.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");return}g.logging&&0<=g.logging.indexOf("thing_in_hand")&&
console.log(this.to_debug_string()+" now has in his hand "+(a?a.to_debug_string():"nothing"))}f=a};w.get_next_robot=function(){return p};w.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());!a&&p&&(p.set_first_in_team(p),p.set_previous_robot(void 0));(p=a)&&p.set_previous_robot(this);b&&(a=a?"When the robot can't run then this one will try: ":window.TOONTALK.robot.empty_drop_area_instructions,$(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=
a)};w.get_previous_robot=function(){return e};w.set_previous_robot=function(a){e=a};w.get_first_in_team=function(){return u};w.set_first_in_team=function(a){u=a;p&&p.set_first_in_team(a)};w.walk_children=function(a){var b;p&&!a(p)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};w.get_run_once=function(){return v};w.set_run_once=function(a){v=a;this.update_title();return!0};w.get_watched_speed=function(){return q};w.set_watched_speed=function(a){q=a;return!0};w.can_run=function(){return this.get_frontside_conditions()&&
this.get_frontside_conditions().is_top_level()||g.widget.can_run.call(this)};w.training_started=function(a){var b=this.get_training_context();b?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(b.copy({just_value:!0})),this.initialize_backside_conditions(),a||($("*").css({cursor:"url("+g.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),this.update_title(),
a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):g.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};w.training_finished=function(){if(this.being_trained){var a,b,c;a=this.get_body().get_newly_created_widgets();for(b=0;b<a.length;b++)c=a[b],"drop it on top-level"!==c.last_action&&"copy"!==c.last_action||this.add_step(g.robot_action.create(g.newly_created_widgets_path.create(b),
"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):$("*").css({cursor:""})}};if(g.debugging||g.logging)w.to_debug_string=function(){var a=this.get_frontside_conditions();return"Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(a?
g.UTILITIES.add_a_or_an(a.toString()):"anything")};p&&w.set_next_robot(p);w.add_standard_widget_functionality(w);w.has_name(w);w.set_name(h);w.set_description(k);g.debugging&&(w._debug_id=g.UTILITIES.generate_unique_id(),w._debug_string=w.to_debug_string());return w};a.create_backside=function(){return g.robot_backside.create(this)};a.copy=function(a){var b=this.get_frontside_conditions(),d=this.get_backside_conditions(),b=b?b.copy({just_value:!0}):void 0,k=this.get_next_robot(),k=k?k.copy(a):void 0,
f;d&&(f=g.UTILITIES.copy_widgets(d,{just_value:!0}));d=this.create(b,f,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),k,(!a||!a.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(d,a)};a.match=function(a){var b,d;if(a.is_robot()&&(b=this.get_body().is_empty(),d=a.get_body().is_empty(),b===d))return"matched";this.last_match=a;return this};a.generate_name=function(){d++;return"#"+d.toString()};a.run=function(a,b,d){var k=this.get_frontside_conditions(),
f,v,p,h,q;if(this.being_trained||this.running_or_in_run_queue())return this;(q=this.get_backside())&&q.visible()&&(p=function(a){$(a.get_frontside_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},p(k),this.rerender());this.match_status=g.UTILITIES.match(k,a);"matched"===this.match_status&&(h=[],(k=this.get_backside_conditions())&&
0<k.length&&((f=a.get_backside_widgets())&&k.some(function(a){var b,c;a.matching_widget&&a.matching_widget.get_parent_widget_of_frontside()&&(b=g.UTILITIES.match(a,a.matching_widget),"matched"===b&&(h.push(a.matching_widget),c=b));c||f.some(function(d){b=void 0;if(!(0<=h.indexOf(d)||d.is_backside())){p&&p(d);b=g.UTILITIES.match(a,d);if("matched"===b)return h.push(d),c=b,a.matching_widget=d,!0;if(!b.is_widget)c=b;else if(!c||c.is_widget)c=b}}.bind(this));if("matched"!==c)return this.match_status=c,
!0}.bind(this)),"matched"!==this.match_status&&(h=void 0),this.set_backside_matched_widgets(h)));if("matched"===this.match_status)return d||(d=g.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),this.set_context(a),d.enqueue({robot:this,top_level_context:b,queue:d}),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),this.rerender(),this.get_next_robot()?this.get_next_robot().run(a,b,d):this.match_status;
this.match_status.forEach(function(a){a[1]&&$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){k=this.get_next_robot().run(a,b,d);if("matched"===k)return k;k.is_widget||k.forEach(function(a){0>this.match_status.indexOf(a)&&this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(v=function(){this.set_waiting(!1);this.run(a,b,d)}.bind(this),this.match_status.forEach(function(a){a[0]?a[0].run_when_non_empty(v,this):a.run_when_non_empty(v,
this)}.bind(this)),this.set_waiting(!0));return this.match_status};a.set_waiting=function(a){var b=this.get_frontside_element();b&&(a?this.visible()&&(g.UTILITIES.add_animation_class(b,"toontalk-robot-waiting"),g.UTILITIES.give_tooltip(b,"This robot is waiting for a bird to deliver something.")):($(b).removeClass("toontalk-robot-waiting"),g.UTILITIES.give_tooltip(b,this.get_title())))};a.run_actions=function(a,b,d){return this.stopped()?(this.get_first_in_team().set_running(!1),!1):this.visible()?
this.get_body().run_watched(a,b,d,this):this.get_body().run_unwatched(a,b,d,this)};a.drop_from_data_transfer=function(a,b){var d;a.is_top_level&&a.is_top_level()?(d=a.get_backside_widgets().slice(),setTimeout(function(){d.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=1E3;this.dropped_on(a,b.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};a.picked_up=function(a,b,d){var k,f;if(this!==a&&!(a.is_top_level()||b&&b.view.backside))return a.get_infinite_stack&&
a.get_infinite_stack()?this.current_action_name="pick up a copy of":this.current_action_name="pick up",d?(f=a,b=a.copy({fresh_copy:!0}),b=g.path.get_path_to_resource(b)):b=g.path.get_path_to(a,this),b&&(d=Date.now(),k={time:d-this.time_of_last_step},this.time_of_last_step=d,k=g.robot_action.create(b,this.current_action_name,k),this.add_step(k,f)),a.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(a),k};a.dropped_on=function(a,b){var d,k,f,v,p;if(this!==a&&
(!this.get_parent_of_frontside()||this.get_parent_of_frontside().get_widget()!==a)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(d=g.path.get_path_to(b,this))b.is_backside()?(f=$(b.get_element()),k=f.offset(),v=f.width(),p=f.height(),f=$(a.get_frontside_element()).offset(),v=(f.left-k.left)/v,k=(f.top-k.top)/p,v=Math.max(0,Math.min(1,v)),k=Math.max(0,Math.min(1,k)),k={left_offset_fraction:v,
top_offset_fraction:k}):k={},f=Date.now(),k.time=f-this.time_of_last_step,this.time_of_last_step=f,d=g.robot_action.create(d,this.current_action_name,k),this.add_step(d);a.last_action=this.current_action_name+" "+b.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};a.dropped_on_text_area=function(a,b,d){k(a,"drop it on the text area of",this,d);a.last_action="drop it on the text area of "+b.get_type_name();this.set_thing_in_hand(void 0)};a.copied=function(a,b,d){d=d?
"pick up a copy of":"copy";k(a,d,this,void 0,b);b.last_action=d};a.removed=function(a){var b;this.get_parent_of_frontside()&&(b=this.get_parent_of_frontside().get_widget());k(a,"remove",this);a.last_action="remove";b===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};a.edited=function(a,b){k(a,"edit",this,b)};a.erased_widget=function(a){k(a,"change whether erased",this)};a.resized_widget=function(a,b,d,g,f){b===g&&d===f||k(a,
"change size of",this,{x_factor:g/b,y_factor:f/d})};a.started_training_another=function(a){k(a,"start training",this)};a.finished_training_another=function(a){k(a,"stop training",this)};a.trained=function(a,b){k(a,"train",this,{step:b})};a.backside_opened=function(a){k(a,"open the backside",this)};a.backside_closed=function(a){k(a,"close the backside",this)};a.button_clicked=function(a,b){k(b.get_widget(),"click the button of",this,{button_selector:a})};a.created_widget=function(a,b,d){this.add_newly_created_widget(a);
this.add_to_top_level_backside(a,!1);this.add_step(g.robot_action.create(g.path.get_path_to_resource(a.copy()),"add a new widget to the work space",{button_selector:d,path_to_source:g.path.get_path_to(b,this)}))};a.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};a.remove_from_container=function(a,b){var d=b.get_index_of&&a.get_parent_of_frontside()&&b.get_index_of(a),g=function(){b.removed_from_container(a,!1,!0,d,!1)};this.animate_consequences_of_actions()?
this.add_watched_step_end_listeners(g):g();this.add_newly_created_widget_if_new(a)};a.get_training_context=function(){var a=this.get_frontside_element(),b=$(a).parent(),a=g.UTILITIES.widget_from_jquery(b);return!a&&(b=g.UTILITIES.widget_from_jquery(b.closest(".toontalk-backside-of-robot")))?b.get_training_context():a};a.add_step=function(a,b){this.get_body().add_step(a,b);this.update_title();"train"!==a.get_action_name()&&"start training"!==a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,
a)};a.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var b=this.get_thing_in_hand(),d,k;g.debugging&&(this._debug_string=this.to_debug_string());d=a.get_element();b&&(k=b.get_frontside_element());!k&&this.carrying_tool&&(k=document.createElement("div"),$(k).addClass(this.carrying_tool));g.UTILITIES.give_tooltip(d,this.get_title());$(d).addClass("toontalk-robot");$(d).children(".toontalk-side, .toontalk-held-by-robot").remove();k&&d.appendChild(k);this.match_status&&(this.match_status.is_widget?
$(d).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(d).removeClass("toontalk-robot-not-matched"));d.setAttribute("toontalk_name",this.get_name());g.UTILITIES.set_timeout(function(){var a,c,g,h,q;k&&(q={position:"absolute"},$(k).addClass("toontalk-held-by-robot"),a=$(k).width(),$(k).height(),g=$(d).width(),h=$(d).height(),b&&0===a&&(a=b.get_default_width?b.get_default_width():2*g,c=b.get_default_height?b.get_default_height():h/2,q.width=a,q.height=c),q.left=(g-a)/2,q.top=h/4,$(k).css(q),
b&&b.rerender())})};a.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};a.add_newly_created_widget_if_new=function(a){if(a!==this.get_training_context()&&this!==a)return this.get_body().add_newly_created_widget_if_new(a)};a.is_newly_created=function(a){return this.get_body().is_newly_created(a)};a.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-1]};a.get_title=function(){var a=this.get_description();
if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?"Drag this robot to a work area.":this.toString()};a.toString=function(a){var b,d,k,f,v,p,h,q,w,u,e,r,A;if(a&&"conditions"===a.role)return"any robot";b=this.get_frontside_conditions();if(!b)return"an untrained robot";h=b.is_top_level();a||(a={});e=a.person;if(a&&a.resource){if(this.get_description())return'"'+this.get_description()+'"';a.person=
"third"}d=this.get_backside_conditions();f=this.get_body();p=v="";w=this.get_next_robot();h?u="When the workspace's green flag "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" is pressed":(q=g.UTILITIES.add_a_or_an(b.get_full_description({role:"conditions"})),u="When working on something that matches "+q);d&&(d.forEach(function(a){a&&(u+=" and\nif on the"+(h?" work area ":" back ")+" is "+g.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),k=
!0)}),k&&(u+="\n"));if(this.being_trained){if(f.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";v="is being trained.\n";p="\n..."}f=v+u+(a&&"third"===a.person?" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(f.toString({robot:this})||"do nothing")+p;if(a&&a.resource)return a.person=e,f.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(A=b.is_top_level()?"the work area I'm running on":"the "+b.get_type_name()+
" I'm on the back of",this.match_status===b?r=A:this.match_status.has_ancestor(b)?r="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+A:(b.is_top_level()||(A="the "+this.match_status.get_type_name()+" on "+A),d.some(function(a){if(this.match_status===a)return r="any "+a.get_type_name(!0)+" on ",b.is_top_level()||(r+="the back of "),r+=A,!0;if(this.match_status.has_ancestor(a))return r="any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+
" on the back of "+A,!0}.bind(this))),f="I'm not running because the "+this.match_status+" (highlighted in red on my backside) that I'm expecting doesn't match "+r+". Perhaps editing my conditions will help.\n"+f):"matched"!==this.match_status&&(f="I'm waiting for something to be delivered to the nest that matches the "+this.match_status[0][1]+" in my conditions (highlighted in yellow on my backside).\n"+f));w&&(f+="\nIf it doesn't match then the next robot will try to run.\n"+w.toString());return f};
a.get_type_name=function(a){return a?"robots":"robot"};a.maintain_proportional_dimensions=function(){return!0};a.matching_resource=function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&this.get_body().is_empty()&&a.get_body().is_empty()};a.get_top_level_context_description=function(a){var b=this.get_frontside_conditions().get_type_name();return"top-level"===b?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+b+" he's working on":
"the "+b+" I'm working on"};a.get_help_URL=function(){return"docs/manual/robots.html"};a.get_json=function(a){var b=this.get_frontside_conditions(),d=this.get_backside_conditions(),k,f,v;b&&(k=b.is_top_level()?{type:"top_level"}:g.UTILITIES.get_json(b,a));d&&(f=g.UTILITIES.get_json_of_array(d,a));this.get_next_robot()&&(v=g.UTILITIES.get_json(this.get_next_robot(),a));return{type:"robot",frontside_conditions:k,backside_conditions:f,body:this.get_body().get_json(a),run_once:this.get_run_once(),next_robot:v,
name:this.get_name(),speed:this.get_watched_speed()}};g.creators_from_json.robot=function(a,b){var d,k,f,v,p;a.thing_in_hand&&(k=g.UTILITIES.create_from_json(a.thing_in_hand,b));a.next_robot&&(d=g.UTILITIES.create_from_json(a.next_robot,b));a.backside_conditions&&($.isArray(a.backside_conditions)?v=g.UTILITIES.create_array_from_json(a.backside_conditions,b):a.semantic&&g.UTILITIES.available_types.forEach(function(b){a.semantic.backside_conditions[b]&&v.push(g.UTILITIES.get_json(a.semantic.backside_conditions[b],
json_history))}));f=g.UTILITIES.create_from_json(a.frontside_conditions||a.bubble,b);p=g.robot.create(f,v,void 0,a.description,k,a.run_once,d,a.name,a.speed);b||(b={});b.robot=p;p.set_body(g.UTILITIES.create_from_json(a.body,b));setTimeout(function(){p.visible()&&(v&&v.forEach(function(a){a.set_visible(!0);a.render()}),f&&(f.set_visible(!0),f.render()))},1E3);return p};a.find_conditions_path=function(a,b,d){var k=b.get_frontside_conditions(),f=k===a?"entire_condition":k.get_path_to&&k.get_path_to(a,
d),k=g.path.get_path_to(b,d),v;f||(b=b.get_backside_conditions(),b.some(function(b){b&&(f=b.get_path_to(a,d))&&(v=b)}));if(f)return g.robot.create_conditions_path(f,k,v);g.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};a.create_conditions_path=function(a,b,d){"string"===typeof d&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===d)return d=a,!0});return{dereference_path:function(k,f,v){k=g.path.dereference_path(b,k,
f,v);k=d?d:k.get_frontside_conditions();return"entire_condition"===a?k:g.path.dereference_path(a,k,f,v)},toString:function(){var k="entire_condition"===a?"the ":g.path.toString(a)+" of the ";return d?k+d.toString()+" backside condition of "+g.path.toString(b):k+" front side condition of "+g.path.toString(b)},get_json:function(k){return{type:"path_to_robot_conditions",backside_condition:d&&g.UTILITIES.get_json(d,k),path_to_robot:b.get_json(),path_within_conditions:"entire_condition"===a?"entire_condition":
a.get_json()}}}};g.creators_from_json.path_to_robot_conditions=function(a){var b=g.UTILITIES.create_from_json(a.path_to_robot),d="entire_condition"===a.path_within_conditions?a.path_within_conditions:g.UTILITIES.create_from_json(a.path_within_conditions);a=a.backside_condition&&g.UTILITIES.create_from_json(a.backside_condition);return g.robot.create_conditions_path(d,b,a)};return a}(window.TOONTALK);window.TOONTALK.robot_backside=function(g){var k=function(a,c,b,l){a=g.UTILITIES.create_text_element(a);
var k=c.get_frontside_element(!0),f=document.createElement("div");$(k).addClass("toontalk-conditions-contents "+l);g.UTILITIES.set_timeout(function(){$(k).parent().addClass("toontalk-conditions-contents-container");$(k).css({left:"inherit",width:"inherit",height:"inherit"});c.rerender()});b.match_status&&(b.match_status.is_widget?$(b.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==b.match_status&&b.match_status.forEach(function(a){$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")}));
f.appendChild(k);b=g.UTILITIES.create_horizontal_table(a,f);$(b).addClass("toontalk-conditions-panel");return b},a=function(a,c){var b=c.get_frontside_conditions(),l=c.get_backside_conditions(),n=c.visible(),f;b&&(b.is_top_level()?0>a.firstChild.textContent.indexOf("I always run when the green flag")&&a.insertBefore(g.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),a.firstChild):0===$(a).find(".toontalk-frontside-conditions-area").length&&
a.insertBefore(k("I run only if the thing I'm on the back of matches: ",b,c,"toontalk-frontside-conditions-area"),a.firstChild),b.set_visible(n),b.rerender());l&&l.forEach(function(b){var l;b&&(l=b.get_type_name(),f="toontalk-backside-"+l+"-conditions-area",l="bird"===l?g.UTILITIES.create_text_element("And there is a bird on the back."):k("And if "+g.UTILITIES.add_a_or_an(l)+" matches: ",b,c,f),a.insertBefore(l,a.firstChild.nextSibling),b.set_visible(n),b.rerender())})};return{create:function(d){var c=
g.backside.create(d),b=c.get_element(),l=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},k=g.UTILITIES.create_check_box(!d.get_run_once(),"toontalk-run-once-check-box","When finished start again",l(d.get_run_once())),f="normal;original;double;half;very fast;very slow".split(";"),v=[1,void 0,2,.5,10,.25],p=function(a){a=f.indexOf(a);return v[a]},
h=g.UTILITIES.create_select_menu("robot_speed",f,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),q=g.UTILITIES.create_drop_area(window.TOONTALK.robot.empty_drop_area_instructions),w=d.get_next_robot(),u=g.backside.create_advanced_settings_button(c,
d),e=c.update_display.bind(c),r=function(a,b){setTimeout(function(){var c=a.get_frontside_element(!0),e,d;a.get_default_width&&(e=a.get_default_width(),d=a.get_default_height(),$(c).css({left:"",top:"",width:e,height:d}));b.appendChild(c)})},A=c.hide_backside;c.hide_backside=function(a){A.call(this,a);d.being_trained&&d.training_finished()};q.data("drop_area_owner",d);$(k.button).click(function(a){var b=k.button.checked;d.set_run_once(!b);g.UTILITIES.give_tooltip(k.container,l(!b));d.robot_in_training()&&
d.robot_in_training().edited(d,{setter_name:"set_run_once",argument_1:!b,toString:"change to "+(b?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});a.stopPropagation()});h.menu.value=function(a){a=a?v.indexOf(a):1;return f[a]}(d.get_watched_speed());h.menu.addEventListener("change",function(a){d.set_watched_speed(p(a.target.value))});w&&r(w,q.get(0));q.get(0).addEventListener("drop",function(a){a=g.UTILITIES.get_dragee();(a=g.UTILITIES.widget_from_jquery(a))&&
a.is_robot()&&(a.get_body().is_empty()?(a=a.open_backside(),$(a.get_element()).find(".toontalk-train-backside-button").click()):(r(a,q.get(0)),d.set_next_robot(a)))});c.update_display=function(){var a=d.get_frontside_element();a&&g.UTILITIES.give_tooltip(a,d.get_title());e()};b.appendChild(this.create_train_button(c,d));b.appendChild(u);$(k.container).addClass("toontalk-advanced-setting");$(h.container).addClass("toontalk-advanced-setting");q.addClass("toontalk-advanced-setting");b.appendChild(k.container);
b.appendChild(h.container);b.appendChild(q.get(0));a(b,d);c.add_advanced_settings();return c},create_train_button:function(d,c){var b=d.get_element();$(b);var l=$("<button>Train</button>").button();l.addClass("toontalk-train-backside-button");var k=!1;d.change_label_and_title_of_train_button=function(d){d?(l.button("option","label","Stop training "+c.get_name()),g.UTILITIES.give_tooltip(l.get(0),"Click to stop training this robot.")):c.get_body().is_empty()?(l.button("option","label","Train"),g.UTILITIES.give_tooltip(l.get(0),
"Click to start training this robot.")):(l.button("option","label","Re-train "+c.get_name()),g.UTILITIES.give_tooltip(l.get(0),"Click to start training this robot all over again."));g.UTILITIES.visible_element(b)&&a(b,c)};d.change_label_and_title_of_train_button(k);l.click(function(a){k=!k;d.change_label_and_title_of_train_button(k);k?(c.initialize_backside_conditions(),c.get_body().reset_steps(),c.robot_started_training(c),c.training_started()):c.training_finished();a.stopPropagation()});return l.get(0)}}}(window.TOONTALK);
window.TOONTALK.robot.empty_drop_area_instructions="Drop a robot here who will try to run when I can't."})();(function(){var g=function(a){return"rotate"===a||"skewX"===a||"skewY"===a||"transform-origin-x"===a||"transform-origin-y"===a},k=function(a){return"transform-origin-x"===a||"transform-origin-y"===a?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+a:g(a)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+a:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+a};window.TOONTALK.element=function(a){var d=["left","top","width","height"],c=Object.create(a.widget),b=
function(a,b){var c,d;if(!a)return 0;"number"===typeof a&&(d=a);0===a.length&&(d=0);if("undefined"===typeof d&&(c=a.substring(a.length-1),0<="0123456789x".indexOf(c)&&(d=parseFloat(a),isNaN(d))))return;c=d;0<=["rotate","skewX","skewY"].indexOf(b)&&(c%=360,0>c&&(c+=360));return c};c.create=function(b,d,f,k,p,h,q,w){var u=Object.create(c),e=a.UTILITIES.generate_unique_id(),r=u.drag_started,A={},F={},G,y,H,B,C,E,D,K,L,P,m,t,x,J,S,R;d||(d=["left","top","width","height"]);u.is_element=function(){return!0};
u.get_HTML=function(){return B};u.get_guid=function(){return e};u.get_text=function(){var a,b;return void 0===C&&((a=this.get_frontside_element())?C=a.textContent:(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),C=a.textContent,$(a).remove()):C=b,""===C&&a&&(this.update_display(),C=a.textContent),""===C)?this.get_HTML():C};u.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,e;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>
c)break;b+=3;e=a.indexOf("target='_blank'",b);if(0>e||e>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(B===a)return!1;B=c(a);if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element()?b.innerHTML=B.replace(/ /g,"&nbsp;"):b.innerHTML=B;E&&this.compute_original_dimensions(!0);
return!0};u.set_HTML_from_sub_classes=u.set_HTML;u.set_text=function(a){var b=this.get_frontside_element(),c=function(b){$(b).contents().each(function(){this.nodeType==Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};u.get_style_attributes=function(){return d};u.set_style_attributes=function(a){d=a};u.get_attribute_widgets_in_backside_table=function(){return A};
u.set_attribute_widgets_in_backside_table=function(a){A=a};u.get_original_copies=function(){return F};u.get_pending_css=function(){return m};u.get_transform_css=function(){return t};u.add_to_css=function(a,b){g(a)?(t||(t={}),t[a]=b):(m||(m={}),m[a]=b)};u.apply_css=function(b){var c="",e,d,f,h,g,l,k;(m||t)&&(e=this.get_frontside_element())&&!$(e).is(".toontalk-not-observable")&&($(e).is(":visible")?(l=function(a){if(a.left||a.top)if(g=this.get_parent_of_frontside())a.left&&(d=$(g.get_element()),f=
d.width(),void 0!==L&&(f-=L),a.left=(a.left%f+f)%f),a.top&&(d||(d=$(g.get_element())),h=d.height(),void 0!==P&&(h-=P),a.top=(a.top%h+h)%h)}.bind(this),m?(m.width&&(L=m.width),m.height&&(P=m.height)):m={},t&&("number"===typeof t.rotate&&(c+="rotate("+t.rotate+"deg)"),"number"===typeof t.skewX&&(c+="skewX("+t.skewX+"deg)"),"number"===typeof t.skewY&&(c+="skewY("+t.skewY+"deg)"),"number"===typeof t["transform-origin-x"]||"number"===typeof t["transform-origin-y"])&&(m["transform-origin"]=(t["transform-origin-x"]||
0)+" "+(t["transform-origin-y"]||0)),L||P?(J&&J.css({width:D,height:K}),this.is_plain_text_element()&&this.plain_text_dimensions(),$(e).css({width:"",height:""}),k=m,a.UTILITIES.run_when_dimensions_known(e,function(b){var d=this.get_parent_of_frontside();l(k);a.UTILITIES.scale_element(e,L,P,D,K,c,k,b,!d||!d.is_backside&&d.is_element());m=void 0}.bind(this))):(l(m),a.UTILITIES.add_transform_to_css(c,"",m,0>e.parentElement.className.indexOf("toontalk-box-hole")),$(e).css(m),m=void 0)):(b?b++:b=1,100>
b&&a.UTILITIES.set_timeout(function(){this.apply_css(b)}.bind(this),100)))};u.on_update_display=function(a){x?x.push(a):x=[a]};u.fire_on_update_display_handlers=function(){x&&a.UTILITIES.set_timeout(function(){x.forEach(function(a,b){a()||x.splice(b,1)})})};u.get_image_element=function(){return J};u.set_image_element=function(a,b){J=$(a).find("img");0===J.length?J=void 0:($(b).width(J.width()),$(b).height(J.height()))};u.get_additional_classes=function(){return w};u.set_additional_classes=function(a){w=
a};u.get_children=function(){return k};u.set_sound_effect=function(b){G=b;G.volume=a.UTILITIES.get_audio_volume(G)};u.get_sound_effect=function(){return G};u.get_video_object=function(){var a;y||(a=this.get_frontside_element())&&(y=a.getElementsByTagName("video")[0]);return y};u.set_video_object=function(a){y=a};u.get_ignore_pointer_events=function(){return q};u.set_ignore_pointer_events=function(a){q=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":
"auto"})};u.get_source_URL=function(){return H};u.set_source_URL=function(a){if(H!==a)return H=a,this.refresh(),!0};u.use_scaling_transform=function(b){""===b.width&&(b.width=void 0);""===b.height&&(b.height=void 0);a.UTILITIES.scale_element(this.get_frontside_element(),b.width,b.height,D,K,void 0,b)};u.add_standard_widget_functionality(u);S=u.set_running.bind(u);u.set_running=function(a,b){S(a,b);Object.keys(A).forEach(function(c){A[c].set_running(a,b)});!a&&this.visible()&&(d.forEach(function(a){this.add_to_css(a,
this.get_attribute(a))}.bind(this)),this.rerender());k.forEach(function(c){c.set_running(a,b)})};R=u.can_run.bind(u);u.can_run=function(){var a;if(R())return!0;Object.keys(A).some(function(b){if(A[b].can_run())return a=!0});if(a)return a;k.some(function(b){if(b.can_run())return a=!0});return a};u.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;r.call(this,a,b)};u.update_display=function(){var b=this.get_frontside_element(!0);this.get_backside();
var c=function(a){return this.get_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged)if(this.get_erased()){var e;e=$(b).parent(".toontalk-backside").is("*")?c="":c="100%";this.save_dimensions();$(b).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:c,height:e,transform:""});$(b).parent(".toontalk-conditions-contents-container").is("*")?a.UTILITIES.give_tooltip(b,"This is an element that has been erased. It will match any element."):
a.UTILITIES.give_tooltip(b,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(b).is(".toontalk-erased-element")&&($(b).removeClass("toontalk-erased-element"),this.restore_dimensions()),this.initialize_element(),a.UTILITIES.on_a_nest_in_a_box(b)&&(this.set_attribute("width",$(b).closest(".toontalk-box-hole").width(),!1),this.set_attribute("height",$(b).closest(".toontalk-box-hole").height(),!1)),"undefined"===typeof D&&b.parentElement&&this.compute_original_dimensions(),
this.apply_css(),k?k.forEach(function(a){b.appendChild(a.get_frontside_element(!0));a.set_visible(!0);a.update_display()}):k=[],this.fire_on_update_display_handlers(),a.UTILITIES.give_tooltip(b,"Click to see the backside where you can place robots or change the style of this "+c(b)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};u.initialize_element=function(){var a,b;!E&&(a=this.get_frontside_element())&&($(a).children(".ui-resizable-handle"),B=this.get_HTML(),b=this.is_plain_text_element(),
a.innerHTML=b?B.replace(/ /g,"&nbsp;"):B,$(a).addClass("toontalk-element-frontside"),b?((b=this.get_additional_classes())&&$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.plain_text_dimensions()):$(a).addClass("toontalk-non-plain-text-element"),E=!0)};u.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};u.plain_text_dimensions=function(){D=9*this.get_HTML().length;K=24};u.compute_original_dimensions=function(b){a.UTILITIES.original_dimensions(this,
function(a,b){var c=this.get_parent_of_frontside();D=a;K=b;c&&c.get_box?c.get_box().rerender():(d.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),b)};u.get_attribute_from_current_css=function(b){var c,e;if("width"===b&&(L||D))return L||D;if("height"===b&&(P||K))return P||K;c=this.get_frontside_element(!0);e=a.UTILITIES.get_style_numeric_property(c,b);""===e&&(e=$(c).css(b));if(!e)return 0;if("number"===typeof e){if(D&&P){if("left"===b)return e+
(D-L)/2;if("top"===b)return e+(K-P)/2}return e}return"%"!==e.charAt(e.length-1)||"left"!==b&&"top"!==b?e:$(c).offset()[b]};u.get_original_width=function(){return D};u.get_original_height=function(){return K};u.increment_width=function(a){this.set_attribute("width",(L||D)+a)};u.increment_height=function(a){this.set_attribute("height",(P||K)+a)};u.add_child=function(b){var c=$(b.get_frontside_element(!0)),e=$(this.get_frontside_element(!0));k.push(b);b.set_parent_of_frontside(this);c=a.UTILITIES.set_position_relative_to_element(c,
e,c.offset(),!0);b.is_element()&&b.set_location_attributes(c.left,c.top)};u.removed_from_container=function(a,b,c,e,d){e=k.indexOf(a);0<=e&&k.splice(e,1)};u.set_HTML(b.toString());u.set_description(f);p&&("string"===typeof p?u.set_sound_effect(new Audio(p)):u.set_sound_effect(p));h&&("string"===typeof h?b="<video src='"+h+"' alt='"+h+"'/>":y=h);a.debugging&&(u._debug_id=a.UTILITIES.generate_unique_id(),u._debug_string=u.to_debug_string());k?k.forEach(function(a){a.set_parent_of_frontside(u)}):k=[];
return u};c.copy=function(b){var d=this.get_style_attributes(),f=c.create(this.get_HTML(),d.slice(),this.get_description(),a.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),g=this.get_attribute_widgets_in_backside_table(),k={},h=f.get_backside(this.visible());f.set_source_URL(this.get_source_URL());b&&(b.elements_copied||(b.elements_copied={}),b.elements_copied[this.get_guid()]=f);Object.keys(g).forEach(function(a){k[a]=
g[a].copy(b);k[a].set_parent_of_frontside(h,!1,!0);f.set_attribute(a,this.get_attribute(a))}.bind(this));f.set_attribute_widgets_in_backside_table(k);return this.add_to_copy(f,b)};c.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};c.match_with_any_element=function(){return"matched"};c.match_with_another_element_widget=
function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};c.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};c.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};c.widget_dropped_on_me=function(a,b,c,d){this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):
(this.add_child(a),this.rerender());return!0};c.create_backside=function(){return a.element_backside.create(this)};c.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};c.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a);return"undefined"!==typeof b&&"auto"!=b?b:this.get_attribute_from_current_css(a)};c.set_attribute=function(a,c,d,g){var k,h;if(!this.get_frontside(!0).get_element())return!1;k=this.get_attribute_from_pending_css(a);
if(k===c||"undefined"===typeof k&&(k=this.get_attribute_from_current_css(a),k===c))return!1;h=b(c,a);if("number"===typeof h){if(k==h)return!1;c=h}d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:a,argument_2:c,toString:"change the '"+a+"' style to "+c+" of",button_selector:".toontalk-element-"+a+"-attribute-input"});this.add_to_css(a,c);g&&(c=this.get_style_attributes(),0>c.indexOf(a)&&c.push(a));this.rerender();return!0};c.dropped_on_style_attribute=
function(a,b,c,d){var g,h,k;if(a){g=a.toString();if(a.is_number()){h=this.get_attribute(b);if("number"===typeof h)k=h;else if("auto"===h)switch(b){case "left":k=$(this.get_frontside_element()).offset().left;break;case "top":k=$(this.get_frontside_element()).offset().top;break;default:k=0}else k=parseFloat(h);h=a.to_float();switch(g.substring(0,1)){case "-":g=k-h;break;case "*":g=k*h;break;case "/":g=k/h;break;case "^":g=Math.pow(k,h);break;default:g=k+h}this.set_attribute(b,g,!1);(c||d&&d.visible())&&
this.get_backside().render()}a.get_infinite_stack()||a.remove();c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};c.get_attribute_widget_in_backside_table=function(a,b,c){var d=this.get_attribute_widgets_in_backside_table()[a];d||b||(d=this.create_attribute_widget(a,c),this.get_attribute_widgets_in_backside_table()[a]=d);return d};c.create_attribute_widget=function(b,c){var f=".toontalk-element-"+b+"-attribute-input",g=this.get_backside_element(),
p=this.get_attribute(b),h=this,q=function(b,c){var e=c.toString,d=c.equals,f=c.remove;F=c.update_display;c.element_widget=this;c.attribute=b;c.get_type_name=function(a){return a?"element attributes":"element attribute"};c.toString=function(){return e.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};c.get_custom_title_prefix=function(){return"I'm the '"+this.attribute+"' attribute of "+this.get_attribute_owner()+".\nDrop a number on me or edit my back side to change my value. My back side has an info button to learn more."};
c.equals=function(a){return b===a.attribute?this.equals(a.element_widget):d.call(this,a)};c.update_display=function(){var a;this.get_erased()||(a=this.get_attribute_owner().get_attribute(this.attribute),A(a));F.call(this)};r=c.copy.bind(c);c.copy=function(a){var c;if(a){if(a.just_value)return r(a);a.elements_copied&&(c=a.elements_copied[h.get_guid()])}return this.add_to_copy((c||h).create_attribute_widget(b),a)};c.get_json=function(c){return{type:"attribute_widget",attribute_name:b,element:a.UTILITIES.get_json(h,
c)}};c.get_original_attribute_widget=function(){var a=h.get_original_copies()[b];return a&&a[0]};c.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():h;if(!b.get_widget().is_element())return h;b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=b.get_parent_of_backside();
return b};c.remove=function(a,c){var e=h.get_original_copies()[b],d=e&&e.indexOf(this);0<=d&&e.splice(d,1);f.call(this,a,c)};c.get_help_URL=function(){return k(b)}}.bind(this),w=function(b,c){var e=a.number.create(0,1);q(b,e);e.set_value_from_decimal(c);e.set_format("decimal");e.set_value=function(c){try{var e=h.get_original_copies()[b],d=bigrat.toDecimal(c),f=bigrat.fromDecimal(d);this.get_attribute_owner().set_attribute(this.attribute,d)&&e.forEach(function(a,b){a.set_value_from_sub_classes(f,!0)});
return this.set_value_from_sub_classes(f,!1)}catch(m){return a.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+m),!1}};e.is_attribute_widget=function(){return!0};e.get_function_type=function(){return"number"};return e}.bind(this),u=function(b,c){var e=a.element.create(c);q(b,e);e.set_HTML=function(a){var c=h.get_original_copies()[b],e;this.get_attribute_owner().set_attribute(this.attribute,a)&&c.forEach(function(b,c){e=b.set_HTML_from_sub_classes(a)});return e};
e.get_function_type=function(){return"element"};e.set_additional_classes("toontalk-string-attribute-widget");return e}.bind(this),e;e=0<=["background-color","color"].indexOf(b)?"string":"number";var r,A,F,G,y;g&&(f=$(g).find(f),0<f.length&&(f.get(0).toontalk_widget=this));if("number"===e){if(G=w(b,p),A=G.set_value_from_decimal.bind(G),0<=d.indexOf(b)&&(this.on_update_display(function(){G.rerender();return!0}),"left"===b||"top"===b)){var H;c&&c.to_be_on_backside_of&&(H=c.to_be_on_backside_of[0]);H||
(H=G.get_attribute_owner());y=function(a){var c,e;a.currentTarget.toontalk_widget===G.get_attribute_owner()&&(c=$(H.get_frontside_element()).closest(".toontalk-top-level-backside").offset(),c||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),c={left:0,top:0}),e=a.pageX-c.left-(H.drag_x_offset||0),c=a.pageY-c.top-(H.drag_y_offset||0),"left"===b?(a=e,H.set_attribute("top",c)):(a=c,H.set_attribute("left",e)),G.set_value_from_decimal(a),
F.call(G))};G.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",y);b&&b.get_widget().is_element()&&b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",y)})}}else if("string"===e)G=u(b,p),A=G.set_HTML.bind(G);else{a.UTILITIES.report_internal_error("Unrecognized attribute type: "+e+" for "+b);return}(p=this.get_original_copies()[b])?p.push(G):this.get_original_copies()[b]=[G];return G};
a.creators_from_json.attribute_widget=function(b,c){return a.UTILITIES.create_from_json(b.element,c).create_attribute_widget(b.attribute_name,c)};a.creators_from_json.attribute_number=a.creators_from_json.attribute_widget;c.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};c.toString=function(a){var b;if(a)if("conditions"===a.role||a.plain_text)b='"'+this.get_text()+'"';else{if(a.for_json_div)return""}else a=
this.get_HTML(),1<a.length&&"<"===a.charAt(0)?(b=a.indexOf(" "),b=a.substring(0,b+1)+"style='width: 50px; height: 30px;'"+a.substring(b)):b='"'+a+'"';return"the element "+b};c.get_type_name=function(a){return a?"elements":"element"};c.get_help_URL=function(){return"docs/manual/elements.html"};c.get_json=function(b){var c=this.get_style_attributes(),d=[],g=a.UTILITIES.remove_z_index(this.get_HTML()),k=encodeURIComponent(g);100<=g.length&&(b.shared_html||(b.shared_html=[]),g=b.shared_html.indexOf(k),
0>g&&(g=b.shared_html.push(k)-1),k={shared_html_index:g});c.forEach(function(a){d.push(a)});return{type:"element",html:k,attributes:d,attribute_values:d.map(this.get_attribute.bind(this)),attributes_backsides:d.map(function(c){if(c=this.get_attribute_widget_in_backside_table(c,!0))return a.UTILITIES.get_json_of_array(c.get_backside_widgets(),b)}.bind(this)),additional_classes:this.get_additional_classes(),children:0<this.get_children().length&&a.UTILITIES.get_json_of_array(this.get_children(),b),
sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()}};a.creators_from_json.element=function(d,g){var f=decodeURIComponent("string"===typeof d.html?d.html:g.shared_html[d.html.shared_html_index]),k,p,h,q;d.children&&(p=g.is_child,g.is_child=!0,k=a.UTILITIES.create_array_from_json(d.children,g),g.is_child=p);q=c.create(f,d.attributes,
d.description,k,d.sound_effect,d.video,d.ignore_pointer_events);h=g&&g.event?["left","top"]:[];d.attribute_values.forEach(function(c,f){var e=d.attributes[f],k=d.attributes_backsides&&d.attributes_backsides[f];(g.is_child||0>h.indexOf(e))&&(0!==c||"width"!==e&&"height"!==e)&&q.add_to_css(e,b(c)||c);k&&(e=q.get_attribute_widget_in_backside_table(e,!1,g),a.UTILITIES.add_backside_widgets_from_json(e,k,g))}.bind(this));d.additional_classes&&q.set_additional_classes(d.additional_classes);d.source_URL&&
(q.set_source_URL(d.source_URL),q.refresh());return q};c.create_attribute_path=function(b,c){var d=a.path.get_path_to(b.element_widget,c);return this.extend_attribute_path(d,b.attribute)};c.refresh=function(){this.get_source_URL()&&a.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};c.extend_attribute_path=function(a,b){return{dereference_path:function(c,d,g){return a.dereference_path(d||c,void 0,g).get_attribute_widget_in_backside_table(b)},
toString:function(){return"the '"+b+"' property of "+a},get_json:function(){return{type:"path_to_style_attribute",attribute:b,element_widget_path:a.get_json()}}}};a.creators_from_json.path_to_style_attribute=function(b){var d=a.UTILITIES.create_from_json(b.element_widget_path);return c.extend_attribute_path(d,b.attribute)};c.set_size_attributes=function(b,c,d){d?(this.add_to_css("width",b),this.add_to_css("height",c)):(this.set_attribute("width",b),this.set_attribute("height",c));a.UTILITIES.set_timeout(function(){this.rerender()}.bind(this))};
c.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};c.receive_HTML_from_dropped=function(a){a=a.get_text&&a.get_text();if(this.set_HTML(a))return this.get_text()};c.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};c.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),$(a).on("drag",function(a){var b=this.get_backside_element(!0),
c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):"top"===a&&(a=this.get_frontside_element(),$(a).on("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};c.remove_style_attribute=function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());
return!0};return c}(window.TOONTALK);window.TOONTALK.element_backside=function(a){var d=function(b,c,d){var f;d.visible()&&(f=c.get_style_attributes(),c.get_frontside_element(),$(b).empty(),f.forEach(function(f){c.get_attribute(f);var g=document.createElement("tr"),h=document.createElement("td"),k=c.get_attribute_widget_in_backside_table(f),w=k.get_frontside_element(!0);k.set_parent_of_frontside(d,!1,!0);k.set_infinite_stack(!0);b.appendChild(g);g.appendChild(h);h.appendChild(a.UTILITIES.create_text_element(f));
h=document.createElement("td");g.appendChild(h);k.set_visible(!0);$(w).addClass("toontalk-element-attribute");h.appendChild(w);k.render()}))},c=function(b,c){var d=$("<button>Add or remove my style attributes</button>").button();d.addClass("toontalk-show-attributes-chooser-button");d.click(function(f){$(b).is(":visible")?($(b).hide(),d.button("option","label","Add or remove my style attributes"),a.UTILITIES.give_tooltip(d.get(0),"Click to add widgets for my style attributes.")):($(b).show(),d.button("option",
"label","Hide my style attributes list"),a.UTILITIES.give_tooltip(d.get(0),"Click to hide my list of attributes that can be added or removed."));c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",c)});a.UTILITIES.give_tooltip(d.get(0),"Click to add widgets for my style attributes.");return d.get(0)};return{create:function(b){var g=a.backside.create(b),n=g.get_element();b.get_HTML();var f=document.createElement("table"),v=document.createElement("div"),
p=c(v,b),h=a.backside.create_advanced_settings_button(g,b),q=a.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked."),w=a.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),u=w?"get_HTML":"get_text",e=g.update_display.bind(g),r,A,F,G,y,H,B,C,E,D;b.initialize_element();r=b[u]().trim();0<r.length&&!b.get_image_element()&&(F=function(c){(c=a.UTILITIES.input_area_drop_handler(c,
b.receive_HTML_from_dropped.bind(b),b))&&b.robot_in_training()&&b.robot_in_training().dropped_on_text_area(c,b,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},A=a.UTILITIES.create_text_area(r,"toontalk-html-input","My HTML is","Type here to edit the text.",F),r=function(a){a=A.button.value.trim().replace(/\xA0/g," ");b.get_frontside_element();var c=w?"set_HTML":"set_text";b[c](a)&&b.robot_in_training()&&b.robot_in_training().edited(b,{setter_name:c,
argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(A.container).css({width:"100%"}),$(A.button).css({width:"100%"}),A.button.addEventListener("change",r),A.button.addEventListener("mouseout",r),b.is_plain_text_element()&&n.appendChild(A.container),b.get_source_URL()&&(F=function(c){var e=a.UTILITIES.input_area_drop_handler(c,b.receive_URL_from_dropped.bind(b),b);e&&b.robot_in_training()&&b.robot_in_training().dropped_on_text_area(e,b,{area_selector:".toontalk-URL-input",
setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});c.stopPropagation()},r=function(a){a=G.button.value.trim().replace(/\xA0/g," ");b.get_frontside_element();b.set_source_URL(a)&&b.robot_in_training()&&b.robot_in_training().edited(b,{setter_name:"set_source_URL",argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},G=a.UTILITIES.create_text_input(b.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",
void 0,void 0,F),G.button.addEventListener("change",r),G.button.addEventListener("mouseout",r),n.appendChild(G.container)));g.update_style_attribute_chooser=function(){var c=function(b,c,e){var g=0<=e.get_style_attributes().indexOf(b),h=a.UTILITIES.create_check_box(g,"toontalk-style-attribute-check-box",b+"&nbsp;","Click to add or remove the '"+b+"' style attribute from my backside."),l="toontalk-style-attribute-check-box-for-"+b,g=a.UTILITIES.create_anchor_element("i",k(b)),q=document.createElement("li");
$(g).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(g).css({color:"white"});g.translate=!1;g.lang="en";h.container.appendChild(g);$(h.button).addClass(l);h.button.addEventListener("click",function(a){h.button.checked?e.add_style_attribute(b):e.remove_style_attribute(b);d(f,e,e.get_backside());e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:h.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:b,toString:(h.button.checked?"add":
"remove")+" a widget for the "+b+" attribute of",button_selector:"."+l})});q.appendChild(h.container);c.appendChild(q)},e=function(a,b,d){var f,g;"string"===typeof a?c(a,b,d):a.label?(f=document.createElement("h3"),f.textContent=a.label,g=document.createElement("ul"),b.appendChild(f),b.appendChild(g),e(a.sub_menus,g,d)):a.forEach(function(a){e(a,b,d)})};$(v).is(".ui-accordion")&&$(v).accordion("destroy");$(v).empty();e([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},
{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],v,b);$(v).accordion({active:0,heightStyle:"content"});return v};g.get_attributes_chooser=function(){return v};b.get_sound_effect()?(B=b.get_sound_effect(),C=function(){g.visible()&&(B.paused?(a.UTILITIES.give_tooltip(y.get(0),
"Click to begin playing this sound."),y.button("option","label","Play sound")):(a.UTILITIES.give_tooltip(y.get(0),"Click to pause this sound."),y.button("option","label","Pause sound")))},y=$("<button>Play sound</button>").button(),y.addClass("toontalk-play-sound-effect-button"),y.click(function(c){B.paused?(a.UTILITIES.play_audio(B),B.addEventListener("ended",C)):B.pause();C();b.robot_in_training()&&b.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",b)}),C(),n.appendChild(y.get(0))):
$(b.get_frontside_element()).find("video").is("*")&&(E=b.get_video_object(),D=function(){g.visible()&&(E.paused?(a.UTILITIES.give_tooltip(H.get(0),"Click to begin playing this video."),H.button("option","label","Play video")):(a.UTILITIES.give_tooltip(H.get(0),"Click to pause this video."),H.button("option","label","Pause video")))},H=$("<button>Play video</button>").button(),H.addClass("toontalk-play-video-button"),H.click(function(a){E.paused?(E.play(),E.addEventListener("ended",D)):E.pause();D();
b.robot_in_training()&&b.robot_in_training().button_clicked(".toontalk-play-video-button",b)}),D(),n.appendChild(H.get(0)));g.update_style_attribute_chooser();d(f,b,g);n.appendChild(f);n.appendChild(h);$(v).hide();$(v).addClass("toontalk-attributes-chooser");g.update_display=function(){A&&$(A.button).val(b[u]());d(f,b,g);$(v).is(":visible")&&g.update_style_attribute_chooser();b.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});e()};$(n).find(".toontalk-hide-backside-button").click(function(a){$(v).hide()});
q.button.checked=!b.get_ignore_pointer_events();q.button.addEventListener("click",function(a){b.set_ignore_pointer_events(!q.button.checked)});b.is_plain_text_element()?g.add_advanced_settings(!1,q.container):g.add_advanced_settings(!1,A.container,q.container);$(n).children(".toontalk-advanced-setting").append(v,p);return g}}}(window.TOONTALK)})();window.TOONTALK.sensor=function(g){var k=Object.create(g.widget),a=function(a,c){"element"===a.get_type_name()&&(a.set_additional_classes("toontalk-string-value-from-sensor"),c.visible()&&a.rerender())};k.create=function(d,c,b,l,n,f,v){var p=g.nest.create(b,l,"sensor",void 0,void 0,v||"sensor"),h=p.get_json,q=p.update_display,w=p.copy,u=c.split(" "),e=function(a){return u.map(function(b){var c=a[b];if("keyCode"===b){if(16===c)return;c=String.fromCharCode(c);a.shiftKey||(c=c.toLowerCase())}else"undefined"===
typeof c&&(c="No "+b+" in event "+a+" of sensor "+k,g.UTILITIES.display_message(c));return c})},r=function(b){var c;switch(typeof b){case "number":c=g.number.create(Math.round(b),1);break;case "string":c=g.element.create(b,void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");a(c,p);break;case "boolean":c=g.element.create(b.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor"),a(c,p)}return c},A=function(a){var b,c;if(p.get_active()){b=e(a);c=p.visible();
a=$(p.get_frontside_element()).closest(".toontalk-top-level-backside");if(1===b.length){if(b=r(b[0]),"undefined"===typeof b)return}else b=g.box.create(b.length,!0,b.map(r),"the values of the "+g.UTILITIES.conjunction(u)+" attributes of "+g.UTILITIES.add_a_or_an(d)+" event.",u.join(";"));c?(c=g.bird.create(p),p.add_to_top_level_backside(c),b.render(),c.animate_delivery_to(b,p,p,a.width()/2,a.height())):p.add_to_contents(b)}}.bind(this);p.is_sensor=function(){return!0};p.copy=function(a){var c;if(a&&
a.just_value&&this.has_contents())return w.call(this,a);c=a?g.sensor.create(d,this.get_attributes_string(),b,void 0,a.copying_resource||n,f,this.get_name()):g.sensor.create(d,this.get_attributes_string(),b,void 0,n,f,this.get_name());return p.add_to_copy(c,a)};p.get_json=function(a){var b=h.call(this,a);b.type="sensor";b.event_name=d;b.attribute=this.get_attributes_string();b.active=n;b.sensor_of=f&&g.UTILITIES.get_json(f,a);return b};p.update_display=function(){var a=$(this.get_frontside_element());
q.call(this);n||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):(a.addClass("toontalk-sensor-inactive-nest"),a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};p.get_type_name=function(a){return a?"sensors":"sensor"};p.get_help_URL=function(){return"docs/manual/sensors.html"};p.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+d+" events"};p.get_class_name_with_color=
function(a){return a};p.get_active=function(){return!0===n};p.restore_active=function(){"temporarily false"===n&&this.set_active(!0)};p.set_active=function(a,b){if(n!==a||b)!0===a?f?f.get_frontside_element(!0).addEventListener(d,A):window.addEventListener(d,A):f?f.get_frontside_element(!0).removeEventListener(d,A):window.removeEventListener(d,A),n=a};p.set_running=function(a){this.set_active(a)};p.set_active(n,!0);p.create_backside=function(){return g.sensor_backside.create(this)};p.get_event_name=
function(){return d};p.set_event_name=function(a){var b=n;d&&n&&this.set_active(!1);d=a;b&&this.set_active(!0)};p.get_attributes=function(){return u};p.set_attributes=function(a){u=a.split(" ")};p.get_attributes_string=function(){return u.join(" ")};p.match=function(a){this.last_match=a;return this};p.set_sensor_of=function(a){f=a};p.get_custom_title_prefix=function(){var a="When a '"+d+"' event occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";n?this.get_backside()||
(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the 'Listening to events' check box on my back is ticked.";return a};return p};g.creators_from_json.sensor=function(d,c){var b=g.UTILITIES.create_array_from_json(d.contents,c),k=g.sensor.create(d.event_name,d.attribute,d.description,b,!1,void 0,d.name);d.sensor_of?g.UTILITIES.set_timeout(function(){k.set_sensor_of(g.UTILITIES.create_from_json(d.sensor_of,c));k.set_active(d.active)}):
k.set_active(d.active);0<b.length&&setTimeout(function(){b.forEach(function(b){a(b.get_widget(),k)})},500);return k};return k}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(g){return{create:function(k){var a=g.UTILITIES.create_text_input(k.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+k.get_event_name()),d=g.UTILITIES.create_text_input(k.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
c=g.UTILITIES.create_check_box(k.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),b=g.nest_backside.create(k),l=b.get_element();$(l).find(".toontalk-settings-backside-button").get(0);a.button.addEventListener("change",function(){k.set_event_name(a.button.value.trim())});d.button.addEventListener("change",function(){k.set_attributes(d.button.value.trim())});$(c.button).click(function(a){var b=c.button.checked;k.set_active(b);
k.robot_in_training()&&k.robot_in_training().edited(robot,{setter_name:"set_active",argument_1:b,toString:"change to "+(b?"active":"inactive")+" of the "+k,button_selector:".toontalk-sensor-active-check-box"});k.render();a.stopPropagation()});$(l).find(".toontalk-advanced-setting").append(a.container,d.container,c.container);return b}}}(window.TOONTALK);window.TOONTALK.tool=function(g){document.addEventListener("mousemove",function(k){g.tool.pageX=k.pageX;g.tool.pageY=k.pageY});return{add_listeners:function(k,a){var d,c,b,l,n,f=function(f){var q=k.getBoundingClientRect();a.set_held&&a.set_held(!0);l=q.height;f&&f.preventDefault();setTimeout(function(){a.held&&!a.held()||$(k).addClass("toontalk-tool-held")},200);d=$(k).offset();document.addEventListener("mousemove",p);document.addEventListener("touchmove",p);document.addEventListener("mouseup",h);
document.addEventListener("touchend",h);g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\nmouse_down at "+Date.now());b=c=0;$(".ui-tooltip").each(function(){$(this).hide()})},v=function(d){var h=k.getBoundingClientRect();a.held&&a.held()||f(d);c=g.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",d)-h.left;b=g.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",d)-h.top},p=function(a){var d=g.UTILITIES.find_widget_on_page(a,k,c,b-l/2),e,f,h;a.preventDefault();$(".ui-tooltip").each(function(){$(this).hide()});
f=q(a);h=g.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",a)-f.deltaX-c;a=g.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",a)-f.deltaY-b;k.style.left=h+"px";k.style.top=a+"px";g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\nmouse_move at "+Date.now()+" now at "+k.style.left+", "+k.style.top);if(d&&d.is_top_level())n&&(g.UTILITIES.remove_highlight(),n=void 0);else{if(d&&(e=d.get_frontside_element(),e===n))return;n=e;g.UTILITIES.highlight_element(n)}},h=function(f){var q=
g.UTILITIES.find_widget_on_page(f,k,c,b-l/2),e;f.preventDefault();a.set_held&&a.set_held(!1);n&&g.UTILITIES.remove_highlight();q&&q.top_level_widget&&(e=q.top_level_widget(),a.apply_tool(q,f),e.backup_all());!q&&a.nothing_under_tool&&a.nothing_under_tool();$(k).removeClass("toontalk-tool-held");$(k).addClass("toontalk-tool-returning");g.UTILITIES.add_one_shot_event_handler(k,"transitionend",1E3,function(){$(k).removeClass("toontalk-tool-returning")});g.UTILITIES.set_timeout(function(){k.style.left=
d.left+"px";k.style.top=d.top+"px"});document.removeEventListener("mousemove",p);document.removeEventListener("touchmove",p);document.removeEventListener("mouseup",h);document.removeEventListener("touchend",h);g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\nmouse_up at "+Date.now(),alert(g.debugging),g.debugging="touch")},q=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,
deltaY:c}};k.addEventListener("mousedown",v);k.addEventListener("touchstart",v);return f}}}(window.TOONTALK);window.TOONTALK.vacuum=function(g){var k=Object.create(null),a={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},d={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},c={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},b=!1,l;k.create=function(){var n,f,v,p=[],h=function(a){v!==a&&(v=a,g.sounds&&g.sounds.click.play(),$(n).removeClass(f),
f=d[v],$(n).addClass(f),q())},q=function(){"restore"===v&&0===p.length?g.UTILITIES.give_tooltip(n,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):g.UTILITIES.give_tooltip(n,a[v])};document.addEventListener("keyup",function(a){var b=String.fromCharCode(a.keyCode);a.altKey&&(n||(k.the_vacuum.get_element(),$(n).css({left:g.tool.pageX,top:g.tool.pageY}),document.body.appendChild(n)),l());k.the_vacuum.held()&&("s"===b||"S"===b?h("suck"):"e"===b||"E"===
b?h("erase"):"r"===b||"R"===b?h("restore"):"a"===b||"A"===b?h("suck_all"):g.sounds&&g.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){k.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});g.vacuum.the_vacuum={apply_tool:function(a,b){var c=a.get_widget(),d=function(a){var d;a.is_backside()?a.hide_backside():(b&&c.robot_in_training()&&c.robot_in_training().removed(a),a===c.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):
(c.is_bird()&&g.sounds&&g.sounds.bird_fly.pause(),d=a.copy(),d.save_dimensions_of(a),d.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0}),p.push(d),a.set_running&&a.set_running(!1),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove(b)))},f,h,k;"suck"===v?a.remove&&"top-level"!==a.get_type_name()&&(d(a),g.sounds&&g.sounds.vacuum_suck.play()):"erase"===v||"restore"===v&&a.get_erased&&a.get_erased()?
"top-level"!==a.get_type_name()&&(f=!a.get_erased(),g.sounds&&(f?g.sounds.vacuum_suck.play():g.sounds.vacuum_spit.play()),a.set_erased(f,!0),b&&c.robot_in_training()&&c.robot_in_training().erased_widget(a,f)):"restore"===v?0<p.length&&(f=p.pop(),f.restore_dimensions(),k=a.add_to_top_level_backside(f,!0),h=$(n).offset(),h.left-=$(k).width(),g.UTILITIES.set_absolute_position($(k),h),f.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),g.sounds&&g.sounds.vacuum_spit.play()):
"suck_all"===v&&(f=a.top_level_widget(),h=f.get_backside_widgets().slice(),0<h.length&&g.sounds&&(g.sounds.vacuum_suck.play(),g.sounds.bird_fly.pause()),h.forEach(function(a){a&&c!==c.robot_in_training()&&d(a)}),f.set_backside_widgets([]))},nothing_under_tool:function(){h(c[v])},get_element:function(){n||(n=document.createElement("div"),$(n).addClass("toontalk-vacuum"),l=g.tool.add_listeners(n,this),h("suck"),q());return n},held:function(){return b},set_held:function(a){b=a}};return g.vacuum.the_vacuum};
g.creators_from_json.vacuum=function(a,b){var c=g.vacuum.create();a.mode&&g.UTILITIES.set_timeout(function(){c.set_mode(a.mode)});return c};return k}(window.TOONTALK);window.TOONTALK.wand=function(g){var k=Object.create(null);k.create=function(){var a;return{apply_tool:function(a){"top-level"!==a.get_type_name()&&(g.sounds&&g.sounds.magic.play(),a.add_copy_to_container())},get_element:function(){a||(a=document.createElement("div"),$(a).addClass("toontalk-wand"),g.UTILITIES.give_tooltip(a,"I'm a magic wand. Drag me over the thing you want me to copy."),g.tool.add_listeners(a,this));return a}}};g.creators_from_json.wand=function(){return g.wand.create()};return k}(window.TOONTALK);window.TOONTALK.SETTINGS=function(g){var k=[],a=function(a,l,n){var f=[],v=g.UTILITIES.create_local_files_table(),p=function(c,f){var k=function(a){a||f.newPanel.appendChild(g.UTILITIES.create_text_element("Error connecting to cloud"))},l=f.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();f.newPanel.is(".toontalk-programs-in-cloud-table")?l?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):d(f.newPanel,"program",a,n,k):f.newPanel.is(".toontalk-pages-in-cloud-table")?
l?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):d(f.newPanel,"page",a,n,k):($("#tab-0_info").show(),$("#tab-0_wrapper").show())};f[0]="Programs stored in browser";k[0]=v;l?(f[1]="Programs in cloud",k[1]=g.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),f[2]="Published pages",k[2]=g.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table"),l=g.UTILITIES.create_tabs(f,k),n.appendChild(l),$(l).on("tabsactivate",p)):n.appendChild(g.UTILITIES.create_tabs(f,k));c(a,v,
!0,n);$(v).on("draw.dt",function(){c(a,v,!1,n)})},d=function(a,d,k,f,v){g.google_drive.get_toontalk_files(!1,d,function(p){var h;"string"===typeof p?h=p:p.error&&(h=p.error.message);h?"Need to authorize"===h||"Login Required"===h?g.google_drive.authorize(v):(console.log(h),console.log("Google drive status: "+g.google_drive.get_status()),v(null)):(h="program"===d&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",g.UTILITIES.become_file_data_table(a,p.items,!0,h),a.on("draw.dt",
function(){c(k,a.get(0),!0,f)}),v(a.get(0)))})},c=function(a,c,d,f){$(c).find(".toontalk-file-load-button-without-click-handler").click(function(c){var g=function(){$(f).remove()},h=function(){a.set_setting("program_name",c.target.textContent);a.load(d,g)}.bind(this);a.save(!0,void 0,h)}).removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(b){var c=document.createElement("div"),d=b.get_backside_element(),f=b.get_setting("program_name"),k=g.UTILITIES.create_text_input(f,
"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),p=g.UTILITIES.create_close_button(function(){$(c).remove()},"Click to close the settings panel."),h=g.UTILITIES.create_text_element("How should your program be saved?"),q=g.UTILITIES.create_check_box(b.get_setting("auto_save_to_google_drive"),"toontalk-save-setting","Save automatically to my Google Drive",'Check this if you want your programs automatically saved to a "ToonTalk Programs" folder in your Google Drive.'),
w=g.UTILITIES.create_check_box(b.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage","Check this if you want your programs automatically saved in this browser's local storage."),u=g.UTILITIES.create_button("Save to Google Drive now","toontalk-save-button","Click to save your program now to your Google Drive account.",function(){b.save(!0,{google_drive:!0})}),e=g.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button",
"Click to save your program now to this browser's local storage.",function(){b.save(!0,{local_storage:!0})}),r=g.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){g.google_drive.authorize(function(){$(r).remove()})}),A=g.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){g.UTILITIES.display_message("Creating your web page...");
b.publish(G,F.button.checked)}),F=g.UTILITIES.create_check_box(b.get_setting("publish_as_workspace"),"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),G=function(a,c){var e=document.createElement("span"),d=g.google_drive.google_drive_url(a.id);g.TRANSLATION_ENABLED&&(d=g.UTILITIES.add_URL_parameter(d,"translate","1"));e.innerHTML="Published: <a href='"+d+"' target='_blank'>"+b.get_setting("program_name")+
"</a>";g.UTILITIES.display_message("Your web page is ready for you to edit. Just click on the link.");$(k.container).children("tr").append(g.UTILITIES.create_table_entry(e))},y=document.createElement("div"),H=g.google_drive&&"undefined"!==typeof gapi?g.google_drive.get_status():"Google Drive API not loaded",B=!0,C=g.UTILITIES.create_vertical_table(A,F.container);$(c).addClass("toontalk-settings-panel").css({width:$(d).width()+29,height:$(d).height()+50,left:-2,top:-25,"z-index":g.UTILITIES.next_z_index()});
c.appendChild(p);k.button.addEventListener("change",function(){var a=k.button.value.trim();f!==a&&b.save(!0,void 0,function(){f=a;b.set_setting("program_name",a);b.load(!0,function(){setTimeout(function(){$(c).css({"z-index":g.UTILITIES.next_z_index()})},500)},function(){b.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();g.UTILITIES.display_message("Your program was copied and the new copy's name is '"+b.get_setting("program_name")+"'.")})})})});q.button.addEventListener("click",function(a){b.save(!0,
{auto_save_to_google_drive:w.button.checked,gooogle_drive:!0});b.set_setting("auto_save_to_google_drive",q.button.checked);q.button.checked?$(u).hide():$(u).show()});w.button.addEventListener("click",function(a){b.save(!0,{auto_save_to_local_storage:w.button.checked,local_storage:!0});b.set_setting("auto_save_to_local_storage",w.button.checked);w.button.checked?$(e).hide():$(e).show()});F.button.addEventListener("click",function(a){b.set_setting("publish_as_workspace",F.button.checked)});c.appendChild(y);
$(h).css({"font-weight":"bold","font-size":24,color:"navy"});y.appendChild(h);y.appendChild(k.container);y.appendChild(q.container);y.appendChild(w.container);q.container.appendChild(g.UTILITIES.create_space());q.container.appendChild(u);b.get_setting("auto_save_to_google_drive")&&$(u).hide();w.container.appendChild(g.UTILITIES.create_space());w.container.appendChild(e);b.get_setting("auto_save_to_local_storage")&&$(e).hide();"Need to authorize"===H?(q.container.appendChild(g.UTILITIES.create_space()),
q.container.appendChild(r)):"Authorized"!==H&&"Ready"!==H&&"Authorized but not yet ready"!==H&&(B=!1,b.set_setting("google_drive_unavailable",!0),setTimeout(function(){q.button.disabled=!0;$(A).button("option","disabled",!0);$(u).button("option","disabled",!0);g.UTILITIES.give_tooltip(q.container,"Inactivated because attempt to connect to Google Drive returned: "+H);A.title=q.container.title;u.title=q.container.title},1));$(k.container).children("tr").append(g.UTILITIES.create_table_entry(C));a(b,
B,c);d.appendChild(c)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",auto_save_to_google_drive:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(g){var k=[],a=0,d=!1,c=!1;return{pending_update:function(a){0<=k.indexOf(a)||(k.push(a),this.update_display())},update_display:function(){var b;c||document.hidden||0===k.length||(b=Date.now(),b<a?(c=!0,setTimeout(this.update_display_workhorse.bind(this),a-b)):d||(c=!0,setTimeout(function(){this.update_display_workhorse(b)}.bind(this))))},update_display_workhorse:function(b){var l=k,n=function(a,b){$(a).children().each(function(a,c){$(c).css({"z-index":b+1});
n(c,b+1)})};k=[];d=!0;c=!1;a=(b|Date.now())+50;l.forEach(function(a){var b=a.get_frontside_element&&a.get_frontside_element(),c,d,k;a.update_display();a.get_backside&&(d=a.get_backside())&&d.visible()&&d.update_display();setTimeout(function(){g.UTILITIES.use_custom_tooltip(b)});c=$(b).parent().closest(".toontalk-side");c.is("*")&&0===c.find(".toontalk-side-animating, .toontalk-side-appearing").length&&(d=g.UTILITIES.get_style_numeric_property(b,"z-index"),k=g.UTILITIES.get_style_numeric_property(c.get(0),
"z-index"),k||(k=g.UTILITIES.next_z_index(),c.css({"z-index":k})),!d||c.is(".toontalk-top-level-backside")?(d=g.UTILITIES.next_z_index(),$(b).css({"z-index":d})):d>=k&&(d=k+1,$(b).css({"z-index":d})),n(b,d));b&&!$(b).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&g.UTILITIES.set_timeout(function(){c.is(".toontalk-box-hole")?$(b).is(".ui-resizable")&&
$(b).resizable("destroy"):$(b).is(".ui-resizable")||g.UTILITIES.make_resizable($(b),a)})});d=!1;0<k.length&&(c=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(g){g.creators_from_json.body=function(k,a){var d=g.actions.create();a.body=d;d.initialise_steps(g.UTILITIES.create_array_from_json(k.steps,a));return d};return{create:function(k){var a=Object.create(this),d=[];k||(k=[]);a.copy=function(){return g.actions.create(g.UTILITIES.copy_array(k))};a.get_steps=function(){return k};a.initialise_steps=function(a){k=a};a.is_empty=function(){return 0===k.length};a.reset_steps=function(){k=[];this.reset_newly_created_widgets()};
a.reset_newly_created_widgets=function(){g.logging&&0<=g.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+d.length);d=[]};a.add_step=function(a,b){k.push(a);b&&this.add_newly_created_widget_if_new(b)};a.add_newly_created_widget_if_new=function(a){0<=d.indexOf(a)||this.add_newly_created_widget(a)};a.add_newly_created_widget=function(a){g.debugging&&0<=d.indexOf(a)?console.log("add_newly_created_widget called with not new widget."):(d.push(a),g.logging&&0<=g.logging.indexOf("newly-created")&&
console.log("Added "+a.to_debug_string()+" to list of newly_created_widgets. Length is "+d.length))};a.is_newly_created=function(a){return 0<=d.indexOf(a)};a.get_newly_created_widgets=function(){return d};a.get_path_to=function(a,b){var k,n;d.some(function(d,v){if(d===a)return k=g.newly_created_widgets_path.create(v),!0;if(d.get_path_to&&(n=d.get_path_to(a,b)))return k=g.newly_created_widgets_path.create(v),k.next=n,!0});return k};a.dereference_path=function(a){g.debugging&&!d[a]&&g.UTILITIES.report_internal_error("Expected to find the "+
g.UTILITIES.ordinal(a)+" newly created widget.");return d[a]};return a},run_unwatched:function(k,a,d,c,b){var l=this.get_steps();g.logging&&0<=g.logging.indexOf("run")&&console.log(c.to_debug_string()+" running unwatched");b||(b=0);c.run_next_step=function(){if(b<l.length){var n=l[b];b++;g.logging&&0<=g.logging.indexOf("event")&&console.log(n.get_action_name()+" (unwatched)");n.run_unwatched(k,a,c)}else c.set_running_or_in_run_queue(!1),c.run_body_finished_listeners(k,a,d),c.get_run_once()?c.get_first_in_team().set_running(!1):
c.get_first_in_team().run(k,a,d)};c.run_next_step()},run_watched:function(k,a,d,c){var b=this.get_steps(),l=c.get_frontside_element(),n,f,v=l.parentElement,p=function(){var b=c.visible()&&0!==c.get_maximum_step_duration()&&c.get_first_in_team()===c,e=function(){b&&(v&&v.appendChild(l),c.set_animating(!1));c.get_run_once()?c.get_first_in_team().set_running(!1):c.stopped()||c.get_first_in_team().run(k,a,d);c.get_first_in_team()===c&&g.UTILITIES.set_absolute_position($(l),q);c.rerender()};b?(l.parentElement||
c.get_parent_of_frontside().get_frontside_element().appendChild(l),g.UTILITIES.animate_to_absolute_position(l,q,e,c&&c.transform_animation_speed(g.UTILITIES.default_animation_speed))):(c.set_animating(!1),e(),k.add_backside_widget(c),$(c.get_frontside_element()).remove())},h=0,q=$(l).offset(),w=$(l).position(),u=$(l).width(),e=$(l).height(),r=$(l).closest(".toontalk-backside"),A=$(l).closest(".toontalk-top-level-backside").offset(),F=k.get_backside();g.logging&&0<=g.logging.indexOf("run")&&console.log(c.to_debug_string()+
" running watched");c.get_parent_of_frontside()||(f=c.get_previous_robot(),f.open_backside(),f.get_backside().set_advanced_settings_showing(!0),(n=l.parentElement)||(n=$(f.get_backside_element()).find(".toontalk-drop-area").get(0)),k.get_backside_element().appendChild(l),k.add_backside_widget(c),c.update_display(),c.add_body_finished_listener(function(){n&&n.appendChild(l);k.remove_backside_widget(c);c.set_visible(!0);$(l).css({left:"",top:""})}));0===u&&($(l).css({width:"",height:""}),u=$(l).width(),
e=$(l).height());A||(A={left:0,top:0});0<r.length&&(f=r.get(0).getBoundingClientRect(),q.left<f.left-A.left||q.top<f.top-A.top||q.left+u>f.right+A.left||q.top+e>f.bottom+A.top)&&(q=r.offset(),q.left+=r.width()/2,q.top+=r.height()-e);c.start_position=w;c.run_next_step=function(){F&&(F.visible()||g.UTILITIES.visible_element(F.get_element()))?setTimeout(function(){c.run_watched_step_end_listeners();if(h<b.length&&!c.stopped()){var e=b[h];h++;g.logging&&0<=g.logging.indexOf("event")&&console.log(e.get_action_name()+
" (watched)");e.run_watched(k,a,c);c.get_thing_in_hand()&&(c.get_thing_in_hand().save_dimensions(),c.rerender())}else c.set_running_or_in_run_queue(!1),p(),c.run_body_finished_listeners()},c.transform_step_duration(50)):(c.set_running_or_in_run_queue(!1),c.set_animating(!1),$(l).css({width:"",height:""}),l.style.transitionDuration="",v&&v.appendChild(l),l.style.left=w.left+"px",l.style.top=w.top+"px",this.run_unwatched(k,a,d,c,h))}.bind(this);c.set_animating(!0,q);c.run_next_step();return!0},toString:function(g){for(var a=
"",d=this.get_steps().map(function(a){return a&&a.toString(g)});""===d[d.length-1];)d.pop();d.forEach(function(c,b){c&&(a+=c,a=b===d.length-2?a+" and \n":b<d.length-2?a+", \n":a+".")});return a},get_json:function(k){return{type:"body",steps:g.UTILITIES.get_json_of_array(this.get_steps(),k)}}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(g){g.creators_from_json.newly_created_widgets_path=function(k){return g.newly_created_widgets_path.create(k.index)};return{create:function(k){return{dereference_path:function(a,d,c){a=c.get_body().dereference_path(k);if(this.next)return g.path.dereference_path(this.next,a,d,c);this.removing_widget&&(d=a.get_parent_of_frontside())&&d.removed_from_container&&c.remove_from_container(a,d);return a},toString:function(){return"the "+g.UTILITIES.ordinal(k)+
" new widget"},get_json:function(){return{type:"newly_created_widgets_path",index:k}}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(g){var k={copy:function(a,b,c,d){d.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b,c,d){d.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b,c,d){a=a.copy();d.add_newly_created_widget(a);d.set_thing_in_hand(a);return!0},"drop it on":function(a,b,c,d,e){if(a)if(b=d.get_thing_in_hand()){if(b.drop_on)return g.debugging&&b===a&&g.UTILITIES.report_internal_error("Dropping something on itself! "+a),b.drop_on(a,!1,void 0,d),d.set_thing_in_hand(void 0),
a.rerender(),b.robot_waiting_before_next_step===d?(e&&e.running_watched||(b.robot_waiting_before_next_step=void 0),!1):!0;g.UTILITIES.report_internal_error("Thing in robot's hand ("+b+") doesn't handle 'drop_on'. Robot that "+d)}else d.being_trained||g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing drop_on but has nothing in its hand.");else g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},
"drop it on the text area of":function(a,b,c,d,e){if(a){if(b=d.get_thing_in_hand())return d.set_thing_in_hand(void 0),a[e.setter](b),!0;g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},remove:function(a,b,c,d){a.remove();a===d&&d.set_stopped(!0);return!0},"change whether erased":function(a,
b,c,d,e){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;g.UTILITIES.display_message("Robot is unable to erase "+a)},edit:function(a,b,c,d,e){if(a[e.setter_name])return e.argument_2?a[e.setter_name].call(a,e.argument_1,e.argument_2,a.visible()):a[e.setter_name].call(a,e.argument_1,a.visible()),!0;g.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c,d,e){return!0},"add to the top-level backside":function(a,b,c,d,e){d.visible()||(e=a.get_frontside_element(!0),
c=$(b.get_frontside_element()).position(),b=$(b.get_frontside_element()).closest(".toontalk-top-level-backside").get(0)||$(e).closest(".toontalk-top-level-backside").get(0),$(e).css({left:c.left,top:c.top}),b.appendChild(e),b.toontalk_widget.add_backside_widget(a),a.animate_to_element(b,void 0,d.transform_animation_speed(g.UTILITIES.default_animation_speed)));return!0},"add a new widget to the work space":function(a,b,c,d,e){b.is_top_level()?(b=d.add_to_top_level_backside(a),d=$(d.get_frontside_element()).offset(),
a.update_display(),g.UTILITIES.set_position_relative_to_top_level_backside($(b),d,!0)):a.drop_on(b.get_backside(),!1,void 0,d,!0);return!0},"start training":function(a,b,c,d,e){a.training_started(d);return!0},"stop training":function(a,b,c,d,e){a.training_finished();return!0},train:function(a,b,c,d,e){a.add_step(e.step)},"open the backside":function(){return!0},"close the backside":function(){return!0},"click the button of":function(){return!0}},a=function(a,b,c,d){var e=b.get_thing_in_hand(),f=b.get_frontside_element(),
k=a.get_element(),l=$(k).width(),n=$(k).height(),p,v,B,C,E,D;d&&d.left_offset_fraction?(b.original_animation_left_offset||(b.original_animation_left_offset=[]),b.original_animation_top_offset||(b.original_animation_top_offset=[]),B=d.left_offset_fraction*l,C=d.top_offset_fraction*n,e&&(E=e.get_element(),g.UTILITIES.visible_element(E)&&(D=$(E).offset(),f=$(f).offset(),B-=D.left-f.left,C-=D.top-f.top)),e&&0<=b.original_animation_left_offset.indexOf(B)&&0<=b.original_animation_top_offset.indexOf(C)?
(B=b.animation_left_offset+b.last_thing_in_hand_width,C=b.animation_top_offset,B>=l&&(B=0,C+=b.max_thing_in_hand_height,C>=n&&(C=0)),b.last_thing_in_hand_width=$(E).width(),"undefined"===typeof b.max_thing_in_hand_height&&(b.max_thing_in_hand_height=0),b.max_thing_in_hand_height=Math.max(b.max_thing_in_hand_height,$(E).height())):(b.original_animation_left_offset.push(B),b.original_animation_top_offset.push(C),b.last_thing_in_hand_width=$(E).width(),b.max_thing_in_hand_height=$(E).height()),k.animation_left_offset=
B,k.animation_top_offset=C,b.animation_left_offset=B,b.animation_top_offset=C):(p=l/2,v=n/2);b.animate_to_widget(a,c,b.transform_animation_speed(.25),p,v,!0,b.transform_original_step_duration(d&&d.time))},d=function(b,c,d,f){a(b,c,function(){b.open_backside(d);v(b,c)},f)},c=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},b=function(a,b,d,f,e,k,l,n){var p=c(a,k);f.get_frontside_element();var y=p&&$(p).is(":visible"),H=function(){e(p);$(p).addClass("ui-state-active");if(".toontalk-select-function"===
k||".toontalk-box-size-input"===k)p.value=l.argument_1;setTimeout(function(){$(p).removeClass("ui-state-active");!y&&a.get_backside()&&f.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()});f.run_next_step()},n)};b=function(){!g.UTILITIES.visible_element(p)&&B&&B.set_advanced_settings_showing(!0,B.get_element());f.animate_to_element(p,H,f.transform_animation_speed(g.UTILITIES.default_animation_speed/2),0,0,!0)};var B;!y&&a.open_backside&&f.animate_consequences_of_actions()?
(a.open_backside(b),v(a,f)):b()},l=function(a,b,c,d,e,f,k){k=$("."+k).get(0);var l=function(){n(a,b,c,d,e,f)};k&&d.animate_consequences_of_actions()?d.animate_to_element(k,l,d.transform_animation_speed(g.UTILITIES.default_animation_speed),0,0,!0):l()},n=function(a,b,c,d,e,f){d.get_frontside_element();b=function(){d.carrying_tool=void 0;d.update_display();e();d.run_next_step()};d.animate_consequences_of_actions()?(d.carrying_tool=f,d.update_display(),d.animate_to_element(a.get_frontside_element(),
b,d.transform_animation_speed(g.UTILITIES.default_animation_speed/2),0,0,!0)):(e(),d.run_next_step())},f=function(a,b,c,d,e){var f=a.get_parent_of_frontside();l(a,b,c,d,function(){e();f&&"top-level"!==f.get_widget().get_type_name()&&f.update_display&&f.update_display();a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")},v=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},p={copy:function(a,b,c,d,e){l(a,b,c,d,function(){e();a.add_copy_to_container(d.get_recently_created_widget())},
"toontalk-wand-small","toontalk-wand")},"pick up":function(b,c,d,f,e,k){b.get_frontside_element();c=function(){e();f.animate_consequences_of_actions()&&f.update_display();f.run_next_step()};"empty hole"===b.get_type_name()?g.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):b.save_dimensions()&&f.animate_consequences_of_actions()?a(b,f,c,k):c()},"pick up a copy of":function(b,c,d,f,e,k){a(b,f,function(){var a;e();f.animate_consequences_of_actions()&&(a=f.get_recently_created_widget())&&
(a.set_visible(!0),g.UTILITIES.copy_frontside_dimensions(b,a),f.update_display());f.run_next_step()},k)},"drop it on":function(b,c,f,k,e,l){var n=k.get_thing_in_hand(),p;n?(g.debugging&&n===b&&g.UTILITIES.report_internal_error("Dropping something on itself!"),p=$(n.get_frontside_element(!0)),n.set_visible(!0),n.rerender(),c=function(){var a=p.offset(),b;p.removeClass("toontalk-held-by-robot");e();n.drop_on&&(k.animate_consequences_of_actions()&&(g.UTILITIES.visible_element(p.get(0))||(b=$(k.get_frontside_element()).closest(".toontalk-top-level-backside"),
b.append(p.get(0))),g.UTILITIES.set_absolute_position(p,a),n.restore_dimensions()),n.robot_waiting_before_next_step!==k&&(k.set_thing_in_hand(void 0),k.run_next_step()),k.rerender())},b.is_backside()&&!g.UTILITIES.visible_element(b.get_element())?d(b.get_widget(),k,c,l):a(b,k,c,l)):(g.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+k),a(b,k,e,l))},"drop it on the text area of":function(b,c,f,k,e,l){var n=k.get_thing_in_hand(),p,v,y,H;n?(p=
$(n.get_frontside_element()),v=function(){p.offset();var a;p.removeClass("toontalk-held-by-robot");e();n.remove();a=b.get_parent_of_frontside().get_widget();a.is_hole()&&(a=a.get_parent_of_frontside());a.is_top_level()?b.render():a.render();k.set_thing_in_hand(void 0);k.run_next_step()},y=function(){return $(b.get_backside_element()).find(l.area_selector).get(0)},k.rerender(),g.UTILITIES.visible_element(b.get_backside_element())?(H=y(),k.animate_to_element(H,v,k.transform_animation_speed(g.UTILITIES.default_animation_speed/
2),0,0,!0)):d(b,k,function(){H=y();k.animate_to_element(H,v,k.transform_animation_speed(g.UTILITIES.default_animation_speed/2),0,0,!0)},l)):(g.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+k),a(b,k,e,l))},remove:f,"change whether erased":f,edit:function(a,c,d,f,e,g){b(a,c,d,f,function(){a.get_backside()&&a.get_backside().update_display();e()},g.button_selector,g,1E3)},"change size of":function(a,b,c,d,e,f){var k=a.get_frontside_element();
d.animate_to_element(k,function(){var b=$(k).width(),c=$(k).height(),b=b*f.x_factor,c=c*f.y_factor,g=d.transform_step_duration(1E3);$(k).addClass("toontalk-animating-element");k.style.transitionDuration=g+"ms";k.style.width=b+"px";k.style.height=c+"px";setTimeout(function(){$(k).removeClass("toontalk-animating-element");k.style.transitionDuration="";e();a.render();d.run_next_step()},g)},d.transform_animation_speed(g.UTILITIES.default_animation_speed),0,0,!0)},"add to the top-level backside":function(a,
b,c,d,e){e();d.run_next_step()},"add a new widget to the work space":function(a,c,d,f,e,k){k&&k.button_selector?(a=g.path.dereference_path(k.path_to_source,c,d,f),b(a,c,d,f,e,k.button_selector,k,3E3)):(e(),f.run_next_step())},"start training":function(a,b,c,d,e){b=a.open_backside();a=a.get_frontside_element();e();b&&$(b.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by={element:d.get_frontside_element(),
left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();d.run_next_step()},"stop training":function(a,c,d,f,e,k){var l=a.get_frontside_element();b(a,c,d,f,function(){var b=function(){l.toontalk_return_to=void 0;a.get_backside().change_label_and_title_of_train_button(!1);$(l).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");l.toontalk_followed_by=void 0;setTimeout(e,1500)};l.toontalk_return_to?g.UTILITIES.animate_to_absolute_position(l,l.toontalk_return_to,b,
f.transform_animation_speed(g.UTILITIES.default_animation_speed)):b()},".toontalk-train-backside-button",k,1E3)},train:function(a,b,c,d,e,f){b=function(){e();d.run_next_step()};(f=f.step.run_watched)?(a.run_next_step=b,f(a.get_parent_of_frontside().get_widget(),c,a)):b()},"open the backside":function(a,b,c,d,e){a.open_backside(function(){e();d.run_next_step()});v(a,d)},"close the backside":function(a,b,c,d,e,f){b=d.transform_original_step_duration(f&&f.time);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();
e();d.run_next_step()},b)},"click the button of":function(a,c,d,f,e,g){b(a,c,d,f,function(a){$(a).click();e()},g.button_selector)}};g.creators_from_json.robot_action=function(a,b){return a.additional_info?g.robot_action.create(g.path.create_from_json(a.path,b),a.action_name,g.UTILITIES.create_keys_from_json(a.additional_info,b)):g.robot_action.create(g.path.create_from_json(a.path,b),a.action_name)};return{create:function(a,b,c){var d=Object.create(this),e=k[b],f=p[b];if(f)return a||g.UTILITIES.report_internal_error("path undefined in "+
b+" action"),e||g.UTILITIES.report_internal_error("no run_function for "+b),d.get_action_name=function(){return b},d.get_additional_info=function(){return c},d.run_unwatched=function(b,d,f){var k=g.path.dereference_path(a,b,d,f);if(!k)return g.UTILITIES.report_internal_error("Unable to dereference path: "+g.path.toString(a)+" in context: "+b.toString()),!1;g.logging&&0<=g.logging.indexOf("event")&&(k.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+
k.wait_until_this_nest_receives_something.to_debug_string()+"("+g.path.toString(a)+") by unwatched "+f.to_debug_string()):console.log("   "+k.to_debug_string()+" ("+g.path.toString(a)+" "+k.to_debug_string()+" by unwatched "+f.to_debug_string()));k.wait_until_this_nest_receives_something?k.wait_until_this_nest_receives_something.run_when_non_empty(function(){this.run_unwatched(b,d,f)}.bind(this),f):e(k,b,d,f,c)&&f.run_next_step()},d.run_watched=function(b,d,k){var l=g.path.dereference_path(a,b,d,
k),n=function(){if(!k.stopped()||k.being_trained)c||(c={}),c.running_watched=!0,e(l,b,d,k,c)};l?(g.logging&&0<=g.logging.indexOf("event")&&console.log("   "+l+" ("+g.path.toString(a)+" "+l.to_debug_string()+" by watched "+k.to_debug_string()+(k.animate_consequences_of_actions()?"":" finishing instantly")),l.wait_until_this_nest_receives_something?(l.wait_until_this_nest_receives_something.run_when_non_empty(function(){k.set_waiting(!1);this.run_watched(b,d,k)}.bind(this),k),k.set_waiting(!0),TOONTALK.UTILITIES.visible_element(b.get_backside_element())||
k.get_frontside().remove()):(l.set_visible(!0),f(l,b,d,k,n,c))):g.UTILITIES.report_internal_error("Unable to dereference the path: "+g.path.toString(a)+" in context: "+b.toString())},d.toString=function(d){var e="",f="",k=b,l;if("open the backside"===b||"close the backside"===b)return"";if("click the button of"===b)switch(c.button_selector){case ".toontalk-green-flag":k="click the green flag "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" of";break;case ".toontalk-stop-sign":k=
"click the stop sign "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":k="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":k="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":k="click the button to add or remove attributes of ";break;default:k="click a button of"}if("add a new widget to the work space"===b)return b.replace("a new widget",g.path.toString(a));
if("add to the top-level backside"===b)return"";d||(d={});l=g.path.toString(a,d);if("edit"===b||"drop it on the text area of"===b)e=" ("+c.toString+")";else if("train"===b){e=c.step.toString({person:"third"});if(""===e)return e;e=" to "+e;f="- ";d&&d.robot_being_trained_description&&(l=d.robot_being_trained_description)}else"start training"===b?d&&(d.robot_being_trained_description="it"):"stop training"===b&&(l=d.robot_being_trained_description,d.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(b)){if(0<=
l.indexOf("hole of"))return f+k+" what is in "+l+e;if(0===l.indexOf("a When"))return l=l.substring(3),l=g.UTILITIES.remove_encoded_HTML(l),l=g.UTILITIES.elide(l,80,1),"."===l[l.length-1]&&(l=l.substring(0,l.length-1)),f+k+" a robot who w"+l+e+"\n"}return f+k+" "+l+e},d.get_json=function(d){return{type:"robot_action",action_name:b,path:g.path.get_json(a,d),additional_info:c&&g.UTILITIES.get_json_of_keys(c,["running_watched"])}},d;g.UTILITIES.report_internal_error("No watched function for "+b)}}}(window.TOONTALK);window.TOONTALK.queue=function(g){var k={create:function(){var a=Object.create(this);a.to_run=g.UTILITIES.create_queue();a.run_function=a.run.bind(a);return a},enqueue:function(a){a.robot.running_or_in_run_queue()||(a.robot.set_running_or_in_run_queue(!0),this.to_run.enqueue(a)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var a,d;this.running=!0;for(a=Date.now()+k.maximum_run;!this.to_run.isEmpty()&&
!this.paused&&Date.now()<a;)d=this.to_run.dequeue(),d.robot.run_actions(d.robot.get_context(),d.top_level_context,d.queue);this.to_run.isEmpty()?this.running=!1:g.UTILITIES.set_timeout(this.run_function)}};return k}(window.TOONTALK);window.TOONTALK.path=function(g){var k;g.creators_from_json["path.to_entire_context"]=function(){return g.path.to_entire_context()};g.creators_from_json["path.to_widget_on_nest"]=function(){return g.path.to_widget_on_nest()};g.creators_from_json["path.top_level_backside"]=function(){return g.path.top_level_backside};g.creators_from_json["path.to_backside_widget_of_context"]=function(a,d){return"undefined"===typeof a.backside_index?g.path.get_path_to_backside_widget_of_context(a.type_name,d&&d.robot):
g.path.get_path_to_backside_index_of_context(a.backside_index,a.type_name,d&&d.robot)};g.creators_from_json["path.to_resource"]=function(a,d){return g.path.get_path_to_resource(g.UTILITIES.create_from_json(a.resource,d))};return{get_path_to:function(a,d){var c=function(a,c){var d=c.get_training_context(),f=c.get_body(),k,p,h;a.is_backside()&&(h=!0,a=a.get_widget());if(d===a)return k=g.path.to_entire_context(),k.is_backside=h,k;p=a.get_type_name();if("top-level"===p)return g.path.top_level_backside;
if(k=f.get_path_to(a,c))return k.is_backside=h,k;if("element attribute"===p&&a.get_original_attribute_widget()===a)return k=g.element.create_attribute_path(a,c),k.is_backside=h,k;if(g.debugging&&!d)g.UTILITIES.report_internal_error("No context to compute the path");else{if(d.get_path_to&&(f=d.get_path_to(a,c)))return f.is_backside=h,k=g.path.to_entire_context(),k.next=f,k;d.get_backside_widgets().some(function(d){d=d.get_widget();var f;if(d===a||d.top_contents_is&&d.top_contents_is(a))return c.add_to_backside_conditions(d),
k=g.path.get_path_to_backside_widget_of_context(d,c),k.is_backside=h,!0;if(d.get_path_to&&(f=d.get_path_to(a,c)))return f.is_backside=h,c.add_to_backside_conditions(d),k=g.path.get_path_to_backside_widget_of_context(d,c),k.next=f,!0});if(k)return k.is_backside=h,k;if(d=a.ancestor_of_type("robot"))return g.robot.find_conditions_path(a,d,c);k=g.path.get_path_to_resource(a.copy());k.is_backside=h;return k}}(a,d);c&&a.dereference_contents&&(g.path.path_end(c).not_to_be_dereferenced=!0);!c||"pick up"!==
d.current_action_name&&"remove"!==d.current_action_name||(g.path.path_end(c).removing_widget=!0);return c},path_end:function(a){for(;a.next;)a=a.next;return a},dereference_path:function(a,d,c,b){var g;a?a.dereference_path?g=a.dereference_path(d,c,b):d.dereference_path&&(g=d.dereference_path(a,c,b)):g=d;return g&&a&&a.is_backside?g.get_backside(!0):g},continue_dereferencing_path:function(a,d,c,b){return a.next?d.dereference_contents&&!a.next.not_to_be_dereferenced?(d=d.dereference_contents(a.next,
c,b))&&a.is_backside?d.get_backside(!0):d:(d=d.dereference_path(a.next,c,b))&&a.next.is_backside?d.get_backside(!0):d:d.dereference_contents&&!a.not_to_be_dereferenced?(d=d.dereference_contents(a,c,b))&&a.is_backside?d.get_backside(!0):d:d},toString:function(a,d){var c="",b;if(!a)return"undefined path";a.is_backside&&(c="the backside of ");d||(d={});b=d.resource;d.resource=!0;a.next?(g.path.toString(a.next,d),c=c+g.path.toString(a.next,d).trim()+" of "+a.toString(d)):c+=a.toString(d);d.resource=b;
return c},get_json:function(a,d){var c;if(!a.get_json)return a;c=a.get_json(d);a.is_widget&&a.add_to_json(c,d);a.next&&(c.next_path=g.path.get_json(a.next,d));a.removing_widget&&(c.removing_widget=!0);a.not_to_be_dereferenced&&(c.not_to_be_dereferenced=!0);a.is_backside&&(c.is_backside=!0);return c},to_entire_context:function(a){return{dereference_path:function(a,c,b){return g.path.continue_dereferencing_path(this,a,c,b)},toString:function(a){return a&&a.robot?a.robot.get_top_level_context_description(a):
a&&"third"===a.person?"what he's working on":"what I'm working on"},get_json:function(){return{type:"path.to_entire_context"}}}},to_widget_on_nest:function(){return{dereference_path:function(a,d,c){return g.path.continue_dereferencing_path(this,a,d,c)},toString:function(){return"what is on the nest"},get_json:function(){return{type:"path.to_widget_on_nest"}}}},get_path_to_resource:function(a){a||console.error("Widget missing in get_path_to_resource.");a=a.get_widget();return{dereference_path:function(d,
c,b){d=a.copy({copying_resource:!0});var k,n,f;b.add_newly_created_widget(d);b.visible()&&(k=g.UTILITIES.find_resource_equal_to_widget(a))&&(d.save_dimensions_of(g.UTILITIES.widget_of_element(k)),f=d.get_frontside_element(),n=$(k).position(),g.UTILITIES.set_timeout(function(){$(f).css({left:n.left,top:n.top,width:$(k).width(),height:$(k).height()})}));return d},toString:function(d){return g.UTILITIES.add_a_or_an(a.toString(d))},get_json:function(){return{type:"path.to_resource",resource:g.path.get_json(a,
g.UTILITIES.fresh_json_history())}}}},get_path_to_backside_widget_of_context:function(a,d){return"string"===typeof a?{dereference_path:function(c,b,d){var k=d.get_backside_widget_of_type(a,c);k||c.get_backside_widgets().some(function(b){if(b.get_widget().is_of_type(a)&&!d.is_newly_created(b.get_widget()))return k=b.get_widget(),!0});if(k)return g.path.continue_dereferencing_path(this,k,b,d)},toString:function(c){c=(c&&c.robot&&c.robot.get_backside_conditions()?c.robot.get_backside_conditions()[a]:
g.UTILITIES.add_a_or_an(a))+" on the back of what I'm working on";return this.removing_widget?"what is on "+c:c},get_json:function(){return{type:"path.to_backside_widget_of_context",type_name:a}}}:this.get_path_to_backside_index_of_context(d.get_backside_condition_index(a),a.get_type_name(),d)},get_path_to_backside_index_of_context:function(a,d,c){return{dereference_path:function(b,c,d){if(b=d.get_backside_matched_widgets()[a])return g.path.continue_dereferencing_path(this,b,c,d);g.debugging&&console.log("can this happen?")},
toString:function(a){a=c.get_frontside_conditions().is_top_level()?"work area":"back of what";a=g.UTILITIES.add_a_or_an(d||"thing")+" on the "+a+" I'm working on";return this.removing_widget?"what is on "+a:a},get_json:function(b){return{type:"path.to_backside_widget_of_context",type_name:d,backside_index:a}}}},create_from_json:function(a,d){var c=g.UTILITIES.create_from_json(a,d);a.next_path&&(c.next=this.create_from_json(a.next_path,d));a.removing_widget&&(c.removing_widget=!0);a.not_to_be_dereferenced&&
(c.not_to_be_dereferenced=!0);a.is_backside&&(c.is_backside=!0);return c},top_level_backside:{dereference_path:function(a,d,c){if(a=a.ancestor_of_type("top-level"))return a;k||(k=g.widget.create_top_level_widget());return k},toString:function(){return"the top-level backside"},get_json:function(){return{type:"path.top_level_backside"}}}}}(window.TOONTALK);window.TOONTALK.publish=function(g){var k=function(a,d,c){var b='<!DOCTYPE html>\n<html>\n<head>\n<link rel="stylesheet" media="all" href="https://toontalk.github.io/ToonTalk/toontalk.css">\n<link href="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/css/font-awesome.min.css" rel="stylesheet" type="text/css" />\n<link href="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/css/froala_editor.min.css" rel="stylesheet" type="text/css" />\n<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">\x3c/script><script src="https://toontalk.github.io/ToonTalk/compile/toontalk.js">\x3c/script>\n<script src="https://toontalk.github.io/ToonTalk/libraries/jquery-ui-1.11.2.custom/jquery-ui.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/froala_editor.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/block_styles.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/colors.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/font_family.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/font_size.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/lists.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/tables.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/video.min.js">\x3c/script>\n<title>\n'+
a+'</title>\n<link rel="shortcut icon" href="favicon.ico" />\n</head>\n<body>\n';d.forEach(function(a,d){b+='<div class="toontalk-edit" name="content">\n'+a+"\n</div>\n";c[d]&&(b+=c[d])});return b+='<script src="https://toontalk.github.io/ToonTalk/support/published_support.js">\x3c/script>\n</body>\n</html>\n'};return{publish_widget:function(a,d,c,b){var l=g.google_drive.get_status(),n=["Edit this. Select text for formatting.","And edit this."],f=function(c){(c=c&&c.items&&0<c.items.length&&c.items[0])?
b(c,h):(c=k(a,n,h),g.google_drive.upload_file(v,"html",c,b))},v,p,h;"Ready"===l?(v=d.get_setting("program_name"),c?(p=g.UTILITIES.get_json_top_level(d),d.set_setting("program_name",v+" (published version)"),h=[g.UTILITIES.toontalk_json_div(p,d)],d.set_setting("program_name",v)):(d=d.get_backside_widgets(),h=[],d.forEach(function(a,b){a.visible()&&(p=g.UTILITIES.get_json_top_level(a),h.push(g.UTILITIES.toontalk_json_div(p,a.get_widget())),1<b&&(n[b]=n[1]))}),n.push(n[1])),g.google_drive.get_toontalk_files(g.google_drive.full_file_name(v,
"page"),"page",f)):(console.log("Unable to publish to Google Drive because: "+l),b(null))},republish:function(a){g.google_drive.insert_or_update_file(void 0,a.file_id,"page",k(a.title,a.editable_contents,a.widgets_json),function(){console.log("Published page '"+a.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(g){var k=g.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",a=g.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",d="Need to authorize",c,b;return{handle_client_load:function(b){0>window.location.href.indexOf(a)?(d="Connections to Google Drive are configured for the following domain only: "+a+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",b&&
b(d)):setTimeout(function(){g.google_drive.check_authorization(b)})},check_authorization:function(a){d="Awaiting authorization";gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(b){g.google_drive.handle_authorization_result(b,a)})},handle_authorization_result:function(a,b){a&&!a.error?(d="Authorized but not yet ready",gapi.client.load("drive","v2",function(){g.google_drive.get_folder_ids(function(){d="Ready"})}),b&&b()):(d="Need to authorize",b&&
b(d))},authorize:function(a){gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(b){g.google_drive.handle_authorization_result(b,a)})},get_folder_ids:function(a){g.google_drive.get_folder_id(!0,function(d){c=d;g.google_drive.get_folder_id(!1,function(c){b=c;a()})})},get_folder_id:function(a,d){var f=a?"ToonTalk Programs":"ToonTalk Pages",k=function(b){var c=function(a){a&&a.id?d(a.id):console.error("Failure to create folder '"+f+"'. Response was "+
a)};(b=b&&b.items&&0<b.items.length&&b.items[0].id)?d(b):a?g.google_drive.create_folder("ToonTalk Programs",!1,c):g.google_drive.create_folder("ToonTalk Pages",!0,c)};a&&c?d(c):!a&&b?d(b):g.google_drive.fetch_folder_id(f,k)},get_status:function(){return d},connection_to_google_drive_possible:function(){return 0!==d.indexOf("Connections to Google Drive are configured for the following domain only: ")},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",params:a}).execute(b)},
fetch_folder_id:function(a,b){g.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},b)},get_toontalk_files:function(a,b,c){"undefined"===typeof gapi?c("Google Drive API not available."):(b="properties has {key='ToonTalkType' and value='"+b+"' and visibility='PUBLIC'} and trashed = false",a&&(b+=" and title='"+a+"'"),g.google_drive.list_files({q:b},c))},get_toontalk_program_file:function(a,b){g.google_drive.list_files({q:"'"+c+"' in parents and trashed = false and title='"+
a+"'"},function(a){a&&a.items&&0<a.items.length?b(a.items[0]):b(null)})},upload_file:function(a,b,c,d){var k="json"===b?"program":"page",h=a+"."+b;g.google_drive.get_toontalk_files(h,k,function(a){gapi.client.load("drive","v2",function(){var b=a&&a.items&&0<a.items.length&&a.items[0].id;d||(d=function(a){a.error&&(console.log("Google drive status: "+g.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message));console.log("File "+a.title+" ("+a.id+") "+(b?"updated":
"created"))});b?g.google_drive.insert_or_update_file(void 0,b,k,c,d):g.google_drive.insert_or_update_file(h,void 0,k,c,d)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(a,d,f,k,p){var h={title:a,mimeType:"text/html"};h.parents=[{kind:"drive#fileLink",id:"program"===f?c:b}];k="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(h)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
k+"\r\n---------314159265358979323846--";a?(a="/upload/drive/v2/files",h="POST"):(a="/upload/drive/v2/files/"+d,h="PUT");gapi.client.request({path:a,method:h,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:k}).execute(function(a){d||g.google_drive.insert_property(a.id,"ToonTalkType",f,"PUBLIC");p&&p(a)})},create_folder:function(a,b,c){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){c(a)})}:c)},download_file:function(a,b){if(a.downloadUrl){var c=gapi.auth.getToken().access_token,d=new XMLHttpRequest;d.open("GET",a.downloadUrl);d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=function(){b(null)};d.send()}else b(null)},google_drive_url:function(a){return"https://googledrive.com/host/"+a+"/"},insert_property:function(a,
b,c,d){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:c,visibility:d}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(g){var k={},a,d=100,c=(new Date).getTime(),b=[],l=[],n,f=function(a){var b=a.indexOf("<div style='display:none;'>{"),b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},v=function(b,c){var d=$(c).closest(".toontalk-side"),e=k.get_mouse_or_first_touch_event_attribute("clientX",b),f=k.get_mouse_or_first_touch_event_attribute("clientY",b),g,h,l;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(b.dataTransfer&&
b.dataTransfer.getData("text")&&0<b.dataTransfer.getData("text").length)){a=d||$(c);h=k.widget_from_jquery(a);if(!h){h=k.widget_of_element(c);k.report_internal_error("Possible bug that "+a+" doesn't have a known owner.");if(!h){k.report_internal_error("The element doesn't have an owner either.");return}a=$(c)}h.set_stopped&&h.set_stopped(!0);!h.save_dimensions||h.get_parent_of_frontside()&&!h.get_parent_of_frontside().get_widget().is_top_level()||h.save_dimensions();h.being_dragged=!0;g=a.get(0).getBoundingClientRect();
l=a.is(".toontalk-top-level-resource");$(c).removeClass("toontalk-wiggle");h.get_json&&(d=k.get_json_top_level(h),d.view.drag_x_offset=e-g.left,d.view.drag_y_offset=f-g.top,!d.view.frontside_width&&a.parent().is(".toontalk-backside")&&(d.view.frontside_width=a.width(),d.view.frontside_height=a.height()),a.is(".toontalk-backside")&&(d.view.backside=!0),a.data("json",d),b.dataTransfer&&(e=k.toontalk_json_div(d,h),b.dataTransfer.effectAllowed=l?"copy":"move",b.dataTransfer.setData("text",e),k.is_internet_explorer()||
b.dataTransfer.setData("text/html",e)),h.drag_started(d,l));a.addClass("toontalk-being-dragged");b.stopPropagation()}},p=function(b){var c;a||(a=$(b.target).closest(".toontalk-side"));if(c=k.widget_from_jquery(a))c.being_dragged=void 0;a.is(".toontalk-frontside")&&(a.parent().is(".toontalk-backside")?(c=a.data("json"))&&k.set_css(a,{width:c.view.frontside_width,height:c.view.frontside_height}):a.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||a.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||
k.has_animating_image(a.get(0))||k.set_css(a,{width:"100%",height:"100%"}));H();b.stopPropagation()},h=function(b){if(a)return k.widget_from_jquery(a);if(b)return b=k.data_transfer_json_object(b),k.create_from_json(b)},q=function(b,c){var d=k.data_transfer_json_object(b),f,h,l,n,p,q,u,v,w,y;!d&&a&&(d=a.data("json"));a&&a.data("json","");f=a;H();if(f||d||b.dataTransfer.files||E(b)){if($(b.target).is(".toontalk-drop-area-instructions"))l=$(b.target).parent();else if($(b.target).is(".toontalk-element-attribute-input")){if(l=
$(b.target).closest(".toontalk-side"),n=k.widget_from_jquery(l)){h=f?k.widget_from_jquery(f):k.create_from_json(d);k.restore_resource(f,h);n.dropped_on_style_attribute(h,b.target.name,b);b.stopPropagation();return}}else if($(b.target).is(".toontalk-drop-area"))l=$(b.target);else{if(d&&$(b.currentTarget).is(".froala-element")){u=d;l=k.create_from_json(u);n=document.createElement("div");u=u.view.backside?l.get_backside_element(!0):l.get_frontside_element(!0);d=$(c).closest(".toontalk-edit");f=g.published_support.create_editable_text();
h=b.target;$(n).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");$(u).addClass("toontalk-top-level-resource").css({position:"relative"});u.toontalk_widget=l;n.toontalk_widget=l;n.appendChild(u);for($(n).insertAfter(d);h.nextSibling;)$(f).children(".froala-element").get(0).appendChild(h.nextSibling);$(f).insertAfter(n);l.update_display();return}l=$(b.target).closest(".toontalk-side")}if(0!==l.length&&!l.is(".toontalk-top-level-resource")){u=l.offset();k.remove_highlight();
n=k.widget_from_jquery(l);if(f&&0<f.length&&!(n&&n.get_infinite_stack&&n.get_infinite_stack())&&(f.get(0)===l.get(0)||jQuery.contains(f.get(0),l.get(0)))){if(f.is(".toontalk-top-level-backside"))return;l.hide();h=k.get_mouse_or_first_touch_event_attribute("pageX",b);p=k.get_mouse_or_first_touch_event_attribute("pageY",b);h=document.elementFromPoint(h-window.pageXOffset,p-window.pageYOffset);l.show();h&&(l=$(h).closest(".toontalk-side"),u=l.offset(),n=k.widget_from_jquery(l))}d&&d.view&&d.view.drag_x_offset?
(p=d.view.drag_x_offset,q=d.view.drag_y_offset):q=p=0;if(f&&0<f.length){if(!(n&&n.get_infinite_stack&&n.get_infinite_stack()||f.get(0)!==l.get(0)&&!jQuery.contains(f.get(0),l.get(0)))){k.set_css(f,{left:f.get(0).offsetLeft+(b.layerX-p),top:f.get(0).offsetTop+(b.layerY-q)});b.stopPropagation();return}v=f.is(".toontalk-backside");h=k.widget_from_jquery(f);f.parent().is(".toontalk-drop-area")?(f.removeClass("toontalk-widget-in-drop_area"),f.parent().data("drop_area_owner").set_next_robot(void 0)):(w=
f.parents(".toontalk-side:first"),(y=k.widget_from_jquery(w))?!v&&h.get_infinite_stack&&h.get_infinite_stack()?(w=h.saved_width,y=h.saved_height,h=h.copy(),h.saved_width=w,h.saved_height=y,w=f.width(),y=f.height(),f=$(h.get_frontside_element(!0)),l.is(".toontalk-backside")&&k.set_css(f,{width:d.view.frontside_width||w,height:d.view.frontside_height||y})):y.removed_from_container&&(w.is(".toontalk-backside")?y.remove_backside_widget(h,v,!0):(y.removed_from_container(h,v,b,void 0,!0),h.restore_dimensions&&
!y.is_empty_hole()&&h.restore_dimensions())):k.restore_resource(f,h),h.robot_in_training()&&h.robot_in_training().add_newly_created_widget_if_new(h))}else{if(0<b.dataTransfer.files.length){for(d=0;d<b.dataTransfer.files.length;d++)r(b.dataTransfer.files[d],l,n,u,b);b.stopPropagation();return}if(E(b)){A(b.dataTransfer.getData("URL"),l,n,u,b);b.stopPropagation();return}h=k.create_from_json(d,{event:b});if(!h){d?k.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):g.debugging&&
console.log("No data transfer in drop.");b.stopPropagation();return}h.robot_in_training()&&h.robot_in_training().drop_from_data_transfer(h);(v=d.view.backside)?(f=$(h.get_backside_element()),k.set_css(f,{width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width}),h.apply_backside_geometry()):f=$(h.get_frontside_element())}h!==n&&e(l,f,h,n,u,b,d,p,q,v)}}else b.dataTransfer?k.report_internal_error("Drop failed since unable to parse as JSON."):
k.report_internal_error("Drop failed since there is no event.dataTransfer"),b.stopPropagation()},w=function(a,b){a.addEventListener("drop",function(a){var c=h(a);k.restore_resource(k.get_dragee(),c);b(a)})},u=function(a,b){var c;c=$(b).closest(".toontalk-side");var d=k.get_dragee();c=!c.is("*")||c.is(".toontalk-top-level-backside")||c.closest(".toontalk-top-level-resource").is("*")||c.is(".toontalk-being-dragged")||d&&B(c.get(0),d.get(0))?void 0:c;if(c)return k.highlight_element(c.get(0),a),c.get(0)},
e=function(a,b,c,d,e,f,h,l,n,p){var q=k.get_mouse_or_first_touch_event_attribute("pageX",f),r=k.get_mouse_or_first_touch_event_attribute("pageY",f),u,v,w,y;c.set_visible(!0);if(a.is(".toontalk-backside")){if(c.is_top_level()){u=h.semantic.backside_widgets;v=h.shared_widgets;w=a.get(0);(p=d.robot_in_training())&&p.drop_from_data_transfer(c,d);p=c.get_backside_widgets().slice();p.forEach(function(a,b){var e=a.get_widget(),f,m,g,h,l,t,n;c.remove_backside_widget(e,a.is_backside());f=0<=u[b].widget.shared_widget_index?
v[u[b].widget.shared_widget_index].view:u[b].widget.view;a.is_backside()?(m=e.get_backside_element(!0),g=f.backside_left,h=f.backside_top,l=f.backside_width,t=f.backside_height):(m=e.get_frontside_element(!0),g=f.frontside_left,h=f.frontside_top,l=f.frontside_width,t=f.frontside_height);d.add_backside_widget(e,a.is_backside());w.appendChild(m);n=$(m).position();y={left:n.left+g,top:n.top+h,width:l,height:t};k.constrain_css_to_fit_inside(w,y);k.set_css(m,y);c.set_location_attributes&&e.set_location_attributes(y.left,
y.top);a.is_backside()&&(e.backside_geometry=f.backside_geometry,e.apply_backside_geometry())}.bind(this));return}if(!d){k.report_internal_error("No target_widget");return}c?d.get_backside().widget_dropped_on_me(c,p,f):k.report_internal_error("No source_widget");f=q-(e.left+(l||0));n=r-(e.top+(n||0));k.set_css(b,{left:g.UTILITIES.left_as_percent(f,b.get(0)),top:g.UTILITIES.top_as_percent(n,b.get(0))});!p&&c.set_location_attributes&&c.set_location_attributes(f,n);h&&h.semantic.running&&!k.get_dragee()&&
c.set_running(!0)}else if(a.is(".toontalk-drop-area"))b.addClass("toontalk-widget-in-drop_area"),a.append(b.get(0)),b.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(k.widget_from_jquery(b));else{if(b.is(".toontalk-backside-of-top-level"))return;if(d||f.changedTouches){w=a.closest(".toontalk-top-level-backside").get(0);!w&&f.changedTouches&&(h=document.elementFromPoint(q-window.pageXOffset,r-window.pageYOffset),(w=$(h).is(".toontalk-top-level-backside")?h:$(h).closest(".toontalk-top-level-backside").get(0))||
(w=$(".toontalk-top-level-backside").get(0)),d=k.widget_of_element(w).get_backside());if(!w)return;w.appendChild(b.get(0));h=$(w).offset();k.set_css(b,{left:q-(h.left+l),top:r-(h.top+n)});c.drop_on&&c.drop_on(d,p,f)||d.widget_dropped_on_me&&d.widget_dropped_on_me(c,p,f)||(b=a.closest(".toontalk-top-level-backside"),0<b.length&&(d=k.widget_from_jquery(b))&&d.get_backside().widget_dropped_on_me(c,p,f))}else{k.report_internal_error("target widget missing");return}}k.remove_highlight()},r=function(a,
b,c,d,h){var l=new FileReader,n=0===a.type.indexOf("image"),p=0===a.type.indexOf("audio"),q=0===a.type.indexOf("video"),r,u,v;l.onloadend=function(){if(n)r=g.element.create("<img src='"+l.result+"' alt='"+a.name+"'/>");else if(p)r=g.element.create(a.name+" sound"),r.set_sound_effect(new Audio(l.result));else if(q)r=g.element.create("<video src='"+l.result+"' alt='"+a.name+"'/>");else{if(u=f(l.result))try{v=JSON.parse(u),r=k.create_from_json(v)}catch(w){}r||(r=g.element.create(l.result))}r&&r.robot_in_training()&&
r.robot_in_training().drop_from_data_transfer(r,c);e(b,$(r.get_frontside_element(!0)),r,c,d,h,v)};n||p||q?l.readAsDataURL(a):l.readAsText(a)},A=function(a,b,c,d,f){var h=function(a,b,c,d,f){var m=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,c),e(b,$(a.get_frontside_element(!0)),a,c,d,f))};k.create_widget_from_URL(a,m,function(b){var c=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");c?m(g.element.create(c)):(k.display_message("Error: "+
b+". When trying to fetch "+a),console.log(b))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&h(a,b,c,d,f)})},F=function(a,b){var c=$("<div class='"+a+"'>");k.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},G=function(){var a=k.get_path_to_toontalk_folder()+"sounds/",b=function(b){b=new Audio(a+b);b.volume=k.get_audio_volume(b);return b};g.sounds={hatching:b("SPARROW.mp3"),bird_fly:b("PIGEON.mp3"),
bammer_hammer:b("POP.mp3"),vacuum_spit:b("SPIT.mp3"),vacuum_suck:b("DUSTBUST.mp3"),drop:b("BOOK_DROP.mp3"),magic:b("MAGIC.mp3"),fall_inside:b("FALL_INSIDE.mp3"),click:b("TYPE.mp3"),event_ignored:b("PLOP.mp3")};g.sounds.bird_fly.loop=!0},y=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},H=function(){a&&(a.removeClass("toontalk-being-dragged"),k.set_timeout(function(){a=void 0}))},B=function(a,b){if(a===b)return!0;if(a.parentNode)return B(a.parentNode,b)},C=
function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",h,l;if(0>f)return a;for(;0<=f;){h=f+d.length;l=a.indexOf(e,h);if(0>l)return k.report_internal_error("Expected title to have matching pairs of "+d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(h,l));c=l+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},E=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>
a.indexOf("data:")},D=[],K=[],L,P;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window?(a.stopPropagation(),0<D.length&&D.shift()()):a.data.editable_contents&&g.publish.republish(a.data)},!1);document.addEventListener("DOMContentLoaded",function(){var a;g.debugging=k.get_current_url_parameter("debugging");g.logging=k.get_current_url_parameter("log");0<k.get_current_url_numeric_parameter("volume",10)&&G();k.process_json_elements();$(document).click(function(a){$(".toontalk-top-level-resource-container").each(function(a,
b){var c=b.toontalk_widget;c&&c.set_running&&c.set_running(!1)})});g.DEFAULT_QUEUE=window.TOONTALK.queue.create();g.DEFAULT_QUEUE.start();window.addEventListener("beforeunload",function(a){try{k.backup_all_top_level_widgets(!0)}catch(b){g.UTILITIES.report_internal_error(b)}});g.TRANSLATION_ENABLED=k.get_current_url_boolean_parameter("translate",!1);g.TRANSLATION_ENABLED?($("a").each(function(a,b){b.href=k.add_URL_parameter(b.href,"translate","1")}),$("#google_translate_element").is("*")||(a=document.createElement("div"),
a.id="google_translate_element",document.body.insertBefore(a,document.body.firstChild)),document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]),y("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit")):$("#google_translate_element").remove();g.vacuum.the_vacuum||g.vacuum.create();k.add_test_all_button();F("toontalk-robot",g.robot);F("toontalk-empty-nest",g.nest);F("toontalk-bird-static",
g.bird);$("[title]").each(function(a,b){window.TOONTALK.UTILITIES.use_custom_tooltip(b)});document.addEventListener("visibilitychange",function(){document.hidden?k.mute_audio_objects_playing():(k.rerender_all(),k.restore_audio_volumes())});setTimeout(function(){g.DISPLAY_UPDATES.update_display()},100)});k.available_types="number box element robot nest sensor top-level".split(" ");k.create_from_json=function(a,b,c){var d=function(a,b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&
(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},e,f,h,l;if(a){b||(b={});b.guid_to_nest_table||(b.guid_to_nest_table={});a.shared_widgets&&(b.json_of_shared_widgets=a.shared_widgets,b.shared_widgets=[]);a.shared_html&&(b.shared_html=a.shared_html);if(a.widget)return(e=k.create_from_json(a.widget,b))&&a.is_backside?e.get_backside(!0):e;if(b&&b.shared_widgets&&0<=a.shared_widget_index){if(c=b.shared_widgets[a.shared_widget_index])return c;c=b.json_of_shared_widgets[a.shared_widget_index];
e=k.create_from_json(c,b,!0);return d(e,b,a.shared_widget_index)}(h=a.semantic)||(h=a);a=a.view;if(0<=h.shared_widget_index){if(!b.json_of_shared_widgets){k.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}e=k.create_from_json(b.json_of_shared_widgets[h.shared_widget_index],b,!0);return d(e,b,h.shared_widget_index)}if(g.creators_from_json[h.type]){b||(b={});a?b.json_view=a:a=b.json_view;try{e=g.creators_from_json[h.type](h,b)}catch(n){console.error(n.stack),
k.report_internal_error("Unable to recreate a "+h.type+". Error is "+n)}if(e&&e.get_backside){h.erased&&(g.widget.erasable(e),e.set_erased(h.erased));h.infinite_stack&&e.set_infinite_stack(h.infinite_stack);if(a){if(a.frontside_width)if(f=a.backside?e.get_backside(!0).get_element():e.get_frontside_element()){if(e.ok_to_set_dimensions())if(l={width:a.frontside_width,height:a.frontside_height},"element"===h.type)e.on_update_display(function(){k.set_css(f,l)});else k.set_css(f,l)}else a.saved_width||
(e.saved_width=a.frontside_width,e.saved_height=a.frontside_height);a.saved_width&&(e.saved_width=a.saved_width,e.saved_height=a.saved_height);a.backside_geometry&&(e.backside_geometry=a.backside_geometry)}h.backside_widgets&&(c?e.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(e,h.backside_widgets,b)}.bind(this):this.add_backside_widgets_from_json(e,h.backside_widgets,b))}return e}k.report_internal_error("JSON type '"+h.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};
k.add_backside_widgets_from_json=function(a,b,c){var d;b&&(a.is_top_level()||(c.to_be_on_backside_of?c.to_be_on_backside_of.push(a):c.to_be_on_backside_of=[a]),d=this.create_array_from_json(b,c),a.set_backside_widgets(d,b.map(function(a){return a?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a})),a.is_top_level()||c.to_be_on_backside_of.pop())};k.create_array_from_json=function(a,b){var c=
[];a.forEach(function(a,d){c[d]=a?k.create_from_json(a,b):a});return c};k.get_json_of_array=function(a,b){var c=[];a.forEach(function(a,d){if(a)try{a.is_backside&&a.is_backside()?c[d]={widget:k.get_json(a.get_widget(),b),is_backside:!0}:c[d]=a.get_type_name?{widget:k.get_json(a,b)}:a.get_json(b)}catch(e){k.report_internal_error("Error trying to save "+a)}});return c};k.fresh_json_history=function(){return{widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]}};k.get_json_top_level=
function(a){var b=this.fresh_json_history(),c=k.get_json(a,b);0<b.shared_widgets.length&&(c.shared_widgets=b.shared_widgets.map(function(d,e){var f=function(a){a=b.widgets_encountered.indexOf(a);return b.json_of_widgets_encountered[a]},g=function(a){return f(b.shared_widgets[a])},h=f(d);a===d?(h={semantic:h.semantic,view:h.view,version:h.version},c.semantic={shared_widget_index:e}):k.tree_replace_once(c.semantic,h,{shared_widget_index:e},g,k.generate_unique_id());return h}));c.shared_html=b.shared_html;
return c};k.get_json=function(a,b){var c,d,e;g.debugging&&!b&&k.report_internal_error("no json_history");c=b.shared_widgets.indexOf(a);if(0<=c)return{shared_widget_index:c};c=b.widgets_encountered.indexOf(a);if(0<=c)return c=k.insert_ancestors_last(a,b.shared_widgets),{shared_widget_index:c};c=b.widgets_encountered.push(a)-1;e=a.is_backside();a=a.get_widget();d=a.get_json(b);d=a.add_to_json(d,b);d.view.backside=e;b.json_of_widgets_encountered[c]=d;a.add_backside_widgets_to_json&&a.add_backside_widgets_to_json(d,
b);return d};k.get_json_of_keys=function(a,b){var c;b||(b=[]);Object.keys(a).forEach(function(d){0>b.indexOf(d)&&(c||(c={}),c[d]=a[d].get_json?{json:a[d].get_json()}:a[d])});return c};k.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?k.create_from_json(a[d].json,b):a[d]});return c};k.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).forEach(function(g){if(f=a[g]){if(f===
b)return a[g]=c,!0;if("shared_widget_index"===g){if(this.tree_replace_once(d(f),b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};k.insert_ancestors_last=function(a,b){var c=-1;b.some(function(b,d){if(a.has_ancestor(b))return c=d,!0});0>c&&(c=b.length);b.splice(c,0,a);return c};k.toontalk_json_div=function(a,b){var c=a.view.backside,d=b.get_backside_widgets(),e=b.get_type_name(),
f=b.toString({for_json_div:!0});"top-level"===e?c?(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),L=d.length,d.forEach(function(a){L--;e+=k.add_a_or_an(a.get_type_name());1===L?e+=", and ":1<L&&(e+=", ")}))):e="a top-level widget":(e=k.add_a_or_an(e),c&&(e="the back of "+e));f&&(c=f.indexOf("data:image/"),0<c&&(d=f.indexOf("alt=",c),0>d&&(d=f.indexOf(">",c)),f=f.substring(0,c+20)+" ... "+f.substring(d)));
return"<div class='toontalk-json'>\nThis will be replaced by "+e+".\n"+(f?f+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,k.clean_json,"  ")+"</div></div>"};k.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};k.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:b};k.create_widget_from_URL=function(a,b,c){var d=function(f){try{var k=
this.getResponseHeader("content-type"),h;if(!k){c&&c("Could not determine the contents type of the url");e.removeEventListener("readystatechange",d);return}0===k.indexOf("audio")?(h=g.element.create(a),h.set_sound_effect(new Audio(a))):0===k.indexOf("image")?h=g.element.create("<img src='"+a+"'>"):0===k.indexOf("video")?h=g.element.create("<video src='"+a+" ' width='320' height='240'>"):0===k.indexOf("text")&&0>k.indexOf("text/html")?this.responseText&&(h=g.element.create(this.responseText),h.set_source_URL(a)):
h=g.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");h&&b(h)}catch(l){c&&c(l),b()}e.removeEventListener("readystatechange",d)},e=new XMLHttpRequest;e.addEventListener("readystatechange",d);e.open("GET",a,!0);try{e.send()}catch(f){c?c(f):(k.display_message("Error trying to GET "+a+" "+f),console.error(f.stack))}};k.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};k.copy_widget_sides=function(a,
b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};k.copy_array=function(a){return a.slice()};k.generate_unique_id=function(){c+=1;return"toontalk_id_"+c};k.get_style_property=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)};k.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;return"string"===
typeof c?(d=c.indexOf("px"),0<=d&&(c=c.substring(0,d)),"auto"===c?"left"===b?$(a).position().left:"top"===b?$(a).position().top:c:parseInt(c,10)):c};k.data_transfer_json_object=function(a){var b;if(a.dataTransfer&&!(0<a.dataTransfer.files.length||E(a))){try{b=a.dataTransfer.getData("text/html")}catch(c){b=a.dataTransfer.getData("text")}if(!b||b.match(/[\u3400-\u9FBF]/))b=a.dataTransfer.getData("text");if(b){a=f(b);if(!a)return k.get_json_top_level(g.element.create(b));try{return JSON.parse(a)}catch(d){k.report_internal_error("Exception parsing "+
a+"\n"+d.toString())}}}};k.drag_and_drop=function(a){var b;k.draggable(a);k.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,k.enable_touch_events(a,b))};k.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){v(b,a)});a.addEventListener("dragend",function(b){p(b,a)})};k.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",
function(b){b.preventDefault();q(b,a);b.stopPropagation()});a.addEventListener("dragenter",function(c){var d=u(c,a);d&&b!==d&&k.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!k.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(k.remove_highlight(b),b=void 0);a.stopPropagation()})};k.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");
c.addClass("toontalk-drop-area");c.append(d);k.can_receive_drops(b);return c};k.process_json_elements=function(){$(".toontalk-json").each(function(a,b){var c=b.textContent,d,e,f,h;if(c){c=c.substring(c.indexOf("{"),c.lastIndexOf("}")+1);d=JSON.parse(c);if(d.semantic&&"top_level"===d.semantic.type&&!g.no_local_storage&&!k.get_current_url_boolean_parameter("reset",!1)){if(d.load_most_recent_program)try{(h=window.localStorage.getItem("toontalk-last-key"))&&(f=window.localStorage.getItem(h))}catch(l){h=
"Error reading previous state. Error message is "+l,k.is_internet_explorer()?console.error(h):k.display_message(h)}f&&(d=JSON.parse(f),e=k.create_from_json(d))}e||(e=k.create_from_json(d));if(e){b.textContent="";if(e.get_type_name)if(e.is_top_level())c=e.get_backside(!0),c=c.get_element(),$(b).replaceWith(c),$(c).css({width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width});else{if($(b).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),
c=e.get_frontside_element(!0))$(c).addClass("toontalk-top-level-resource").css({position:"relative"}),b.toontalk_widget=e,b.appendChild(c)}else b.appendChild(e.get_element());e.set_active&&e.set_active(!1);e.set_visible&&e.set_visible(!0);setTimeout(function(){e.update_display&&e.update_display();d.semantic.running&&e.set_running(!0)},1)}else k.report_internal_error("Could not recreate a widget from this JSON: "+c)}})};k.set_absolute_position=function(a,b){for(var c=a.parent(),d=b.left,e=b.top,f;c.is("*")&&
!c.is("html");)f=c.position(),d-=f.left,e-=f.top,c=c.parent();k.set_css(a,{left:d,top:e,position:"absolute"});a.is(".toontalk-side-animating")&&(a.get(0).style.left=d+"px",a.get(0).style.top=e+"px")};k.set_position_relative_to_top_level_backside=function(a,b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-top-level-backside"),b,c)};k.set_position_relative_to_element=function(a,b,c,d){var e=b.offset(),f,g;e||(e={left:0,top:0});f=c.left-e.left;c=c.top-e.top;d&&(d=a.width(),e=
a.height(),g=b.width(),b=b.height(),f>g-d&&(f=g-d),0>f&&(f=0),c>b-e&&(c=b-e),0>c&&(c=0));b={left:f,top:c,position:"absolute"};k.set_css(a,b);a.is(".toontalk-side-animating")&&(a.get(0).style.left=f+"px",a.get(0).style.top=c+"px",k.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=""}));return b};k.restore_resource=function(a,b){var c,d;a&&a.is(".toontalk-top-level-resource")&&(c=b.copy({fresh_copy:!0}),d=c.get_frontside_element(!0),
k.set_css(d,{width:a.width(),height:a.height()}),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(d).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),a.css({position:"absolute"}),a.get(0).parentElement.appendChild(d),g.DISPLAY_UPDATES.pending_update(c),b.set_active&&(b.set_active(!0),c.set_active(!1)))};k.find_resource_equal_to_widget=
function(a){var b;$(".toontalk-top-level-resource.toontalk-side").each(function(c,d){var e=k.widget_from_jquery($(d));if(e&&(a.equals&&a.equals(e)||a.matching_resource&&a.matching_resource(e)||"matched"===a.match(e))&&(a.is_hole()||e.get_backside_widgets().length===a.get_backside_widgets().length))return b=d,!1});return b};k.set_position_is_absolute=function(a,b,c){var d,e;b?(b=k.get_style_numeric_property(a,"left"),d=k.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===
b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===d&&(d=c.pageY-e.top,d-=90)),k.set_css(a,{left:k.left_as_percent(b,a),top:k.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};k.left_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:k.adjust_left_if_scaled(a,b);return 100*($(c).offset().left-window.pageXOffset+a-d.left)/d.width+"%"};k.top_as_percent=function(a,b,c){var d;if(!b||!c)return a;
d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:k.adjust_top_if_scaled(a,b);return 100*($(c).offset().top+-window.pageYOffset+a-d.top)/d.height+"%"};k.adjust_left_if_scaled=function(a,b){var c=k.widget_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())?a-(d-c.get_attribute("width"))/2:a};k.adjust_top_if_scaled=function(a,b){var c=k.widget_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())?a-(d-c.get_attribute("height"))/2:a};k.ordinal=
function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};k.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};k.give_tooltip=function(a,b){a.title=b;k.use_custom_tooltip(a)};k.use_custom_tooltip=
function(a){var b=$(a),c;b.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,d){var e;0>a.top&&(a.top=0,e=b.offset(),e.left<$(window).width()/2?a.left=e.left+b.width()+10:(a.left=0,c=e.left-40));"bottom"===d.vertical?(b.is(".toontalk-robot")?a.top-=30:b.is(".toontalk-number")?a.top-=30:b.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);k.set_css(this,
a)}},open:function(b,d){var e=d.tooltip.get(0).textContent.length,f=d.tooltip.get(0),h;f.innerHTML=C(d.tooltip.get(0).textContent.replace(/(\r\n|\n|\r)/g,"<br>"),decodeURIComponent);100<e&&(h=Math.min(800,c||$(window).width()-100),$(f).position(),d.tooltip.css({maxWidth:h}));P&&P.remove();P=d.tooltip;setTimeout(function(){d.tooltip.remove();$(f).data("ui-tooltip")&&($(f).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),k.use_custom_tooltip(a));P=void 0},e*(g.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||
100))},close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),k.use_custom_tooltip(a));P=void 0}})};k.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate'>decodeURIComponent"+a+"decodeURIComponent</span>")};k.remove_encoded_HTML=function(a){return C(a,function(){return""})};k.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||
f()},c)};k.default_animation_speed=.5;k.animate_to_absolute_position=function(a,b,c,d,e,f){var g=$(a).offset(),h=$(a).position(),l=k.distance(b,g);0===f?(k.set_absolute_position($(a),b),c&&c()):($(a).css({"z-index":k.next_z_index()}),f||(f=Math.round(l/(d||k.default_animation_speed))),$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=f+"ms",l=h.left+(b.left-g.left),g=h.top+(b.top-g.top),a.style.left=l+"px",a.style.top=g+"px",a.toontalk_followed_by&&(b.left+=a.toontalk_followed_by.left_offset,
b.top+=a.toontalk_followed_by.top_offset,k.animate_to_absolute_position(a.toontalk_followed_by.element,b,void 0,d,e)),e?setTimeout(c,f):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";c&&c()},f))};k.distance=function(a,b){var c=a.left-b.left,d=a.top-b.top;return Math.sqrt(c*c+d*d)};k.highlight_element=function(a,b,c){var d;if(a){k.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=k.widget_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),
!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){k.remove_highlight(a)},c))}};k.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};k.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};k.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};k.constrain_css_to_fit_inside=function(a,
b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=k.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,0),d):(c=k.extract_percentage_from_string(b.top),"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};k.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,
a.length-1))}catch(b){}};k.next_z_index=function(){d++;return d};k.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b).click(d);k.give_tooltip(a.get(0),c);return a.get(0)};k.create_close_button=function(a,b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button");$(c).click(a);k.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};k.check_radio_button=function(a){$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};
k.create_button_set=function(){var a=document.createElement("div"),b,c;for(b=0;b<arguments.length;b++)if(0<=arguments[b].length)for(c=0;c<arguments[b].length;c++)a.appendChild(arguments[b][c]);else a.appendChild(arguments[b]);$(a).buttonset();return a};k.create_alert_element=function(a){a=k.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};k.create_text_element=function(a){var b=document.createElement("div");b.innerHTML=a;$(b).addClass("ui-widget");return b};k.create_space=
function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};k.create_anchor_element=function(a,b){var c=document.createElement("a");c.innerHTML=a;g.TRANSLATION_ENABLED&&(b=k.add_URL_parameter(b,"translate","1"));c.href=b;c.target="_blank";return c};k.create_text_input=function(a,b,c,d,e,f,g){var h=document.createElement("input"),l;h.type="text";h.className=b;h.value=a;k.give_tooltip(h,d);f&&(h.type=f);c?(a=document.createElement("label"),a.innerHTML=c,
h.id=k.generate_unique_id(),a.htmlFor=h.id,e&&(l=k.create_anchor_element("i",e),$(l).addClass("toontalk-help-button notranslate"),l.translate=!1),c=k.create_horizontal_table(a,h,l),$(a).addClass("ui-widget")):c=h;$(h).button().addClass("toontalk-text-input").css({"background-color":"white"});h.addEventListener("touchstart",function(){$(h).select()});g&&w(h,g);k.use_custom_tooltip(h);return{container:c,button:h}};k.create_text_area=function(a,b,c,d,e,f){var g=document.createElement("textarea");g.className=
b;g.value=a;k.give_tooltip(g,d);a=document.createElement("label");a.innerHTML=c;g.id=k.generate_unique_id();a.htmlFor=g.id;c=k.create_horizontal_table(a,g);$(g).button().addClass("toontalk-text-area").css({background:"white"});g.addEventListener("touchstart",function(){$(g).select()});e&&w(g,e);$(a).addClass("ui-widget");k.use_custom_tooltip(g);return{container:c,button:g}};k.input_area_drop_handler=function(a,b,c){var d,e;a.preventDefault();(d=h(a))&&d!==c&&(e=b(d,a))&&($(a.currentTarget).trigger("change"),
a.currentTarget.value=e,d.remove(),a.stopPropagation());return"string"===typeof e&&d};k.create_radio_button=function(a,b,c,d,e){var f=document.createElement("div"),g=document.createElement("input"),h=document.createElement("label");g.type="radio";g.className=c;g.name=a;g.value=b;h.innerHTML=d;g.id=k.generate_unique_id();h.htmlFor=g.id;f.appendChild(g);f.appendChild(h);k.give_tooltip(f,e);$(g).button();k.use_custom_tooltip(g);return{container:f,button:g,label:h}};k.create_select_menu=function(a,b,
c,d,e,f){var g=document.createElement("div"),h=document.createElement("select"),l=document.createElement("label");h.className=c;h.name=a;h.id=k.generate_unique_id();l.innerHTML=d;l.htmlFor=h.id;g.appendChild(l);g.appendChild(h);k.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&(k.give_tooltip(c,f[b]),k.use_custom_tooltip(c));h.appendChild(c)});$(h).addClass("ui-widget");$(l).addClass("ui-widget");k.use_custom_tooltip(h);return{container:g,
menu:h,label:l}};k.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b;f.checked=a;g.innerHTML=c;f.id=k.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);k.give_tooltip(e,d);k.use_custom_tooltip(f);return{container:e,button:f,label:g}};k.create_horizontal_table=function(){var a=document.createElement("table"),b,c,d;c=document.createElement("tr");
a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),d.appendChild(arguments[b]));return a};k.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=k.create_row(arguments[b]),a.appendChild(c));return a};k.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)a.appendChild(arguments[c]);b.appendChild(a);return a};
k.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};k.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if(arguments[a].checked)return arguments[a]};k.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+a},c.addEventListener("error",d));return c};k.create_tabs=function(a,b){var c=
document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};
k.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');a&&b.addClass(a);return b.get(0)};k.become_file_data_table=function(a,b,c,d){$(a).DataTable({data:b,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,b,e,f){a=c?a.substring(0,a.length-5):a;b=c?g.google_drive.google_drive_url(e.id):"Click to load this program.";if(d)return"<div class='"+d+"' title='"+b+"'id='"+e.id+"'>"+a+"</div>";g.TRANSLATION_ENABLED&&(b=
k.add_URL_parameter(b,"translate","1"));return"<a href='"+b+"'target='_blank' title='Click to open published page.'>"+a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};k.get_local_files_data=function(){return k.get_all_locally_stored_program_names().map(function(a){var b=
k.get_local_storage_meta_data(a);if(b)return{title:a,modifiedDate:b.last_modified,createdDate:b.created,fileSize:b.file_size}})};k.create_local_files_table=function(){var a=k.get_local_files_data(),b=k.create_file_data_table();setTimeout(function(){k.become_file_data_table(b,a,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});return b};k.get_dragee=function(){return a};k.add_URL_parameter=function(a,b,c){a=k.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?"&":"?";
return a+d+b+"="+c};k.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};k.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||
0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};k.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};k.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};k.backup_all_top_level_widgets=function(a){$(".toontalk-top-level-backside").each(function(b,c){k.widget_of_element(c).save(a)})};k.make_resizable=function(a,b){var c,d;a.resizable({start:function(a,
b){c=b.originalSize.width;d=b.originalSize.height},resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},handles:"n,e,s,w"})};k.match=function(a,b){var c=a.match(b);return c.is_widget&&b.matched_by?b.matched_by(a):
c};k.current_URL=function(){return window.location.pathname};k.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};k.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&k.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};k.copy_frontside_dimensions=function(a,b){var c=a.get_widget().get_frontside_element(),d;c&&(d=b.get_frontside_element(!0))&&k.set_css(d,{width:$(c).width(),height:$(c).height()})};
k.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?k.scale_element(a,c,d,c,d):k.scale_element(a,$(b).width(),$(b).height(),c,d)};k.scale_element=function(a,b,c,d,e,f,g,h,l){var n,p;d||(d=$(a).width());e||(e=$(a).height());n=b&&0!==d?b/d:1;p=c&&0!==e?c/e:1;0===n&&(n=1);0===p&&(p=1);h=(h=h&&h!==document.body?h:a.parentElement)&&0>h.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var q="";g||(g={});"number"===typeof g.left&&(g.left-=(d-b)/2,l=!0);"number"===
typeof g.top&&(g.top-=(e-c)/2,l=!0);!l&&h&&(b&&(q+="translateX("+(b-d)/2+"px) "),c&&(q+="translateY("+(c-e)/2+"px) "));k.add_transform_to_css((f||"")+" scale("+n+", "+p+")",q,g,h);g.width=d;g.height=e;k.set_css(a,g);return{x_scale:n,y_scale:p}};k.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),k.set_css_transform(c,b+a))};k.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=
b;a["o-transform"]=b;a.transform=b};k.run_when_dimensions_known=function(a,b,c){var d=a.parentElement,e=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")},f;!c&&$(a).width()&&e(d)?setTimeout(function(){b(d)}):(f=function(c){setTimeout(function(){var g=$(a).width(),h=$(a).height();g&&h?e(a.parentElement)?(b(d),d?d.appendChild(a):a.parentElement===document.body&&$(a).remove(),$(a).removeClass("toontalk-not-observable")):k.run_when_dimensions_known(a,b,!0):setTimeout(function(){k.widget_of_element(a);
1E4>c&&f(2*c)},c)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),c&&k.set_css(a,{width:"",height:"",transform:""}),f(1))};k.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&k.run_when_dimensions_known(d,function(){b($(d).width(),$(d).height())},c)};k.relative_position=function(a,b){var c=$(a).offset(),d;b&&(d=$(b).offset(),c.left-=d.left,c.top-=d.top);return c};k.add_animation_class=function(a,b){k.set_css(a,{width:"",height:""});
$(a).addClass(b)};k.widget_from_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget};k.widget_of_element=function(a){return a.toontalk_widget};k.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};k.display_message_if_new=function(a){0>K.indexOf(a)&&(k.display_message(a),K.push(a))};k.display_message=function(a){var b=k.create_alert_element(a);$(".toontalk-alert-element").remove();
console.log(a);console.trace();document.body.insertBefore(b,document.body.firstChild);setTimeout(function(){$(b).remove()},Math.max(2E3,a.length*(g.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)))};k.display_tooltip=function(a){k.use_custom_tooltip(a.get(0));a.tooltip("open")};k.report_internal_error=function(a){console.log(a);console.trace();g.debugging&&k.display_message("Error: "+a)};k.get_current_url_boolean_parameter=function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+
"=1")?!0:!1};k.get_current_url_numeric_parameter=function(a,b){var c=k.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};k.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>d&&(d=window.location.href.length);return window.location.href.substring(c,d)};k.get_path_to_toontalk_folder=function(){var a;if("string"===typeof n)return n;n="";
a=window.location.href.indexOf("/ToonTalk/");if(0>a)return n;for(a+=9;;){a=window.location.href.indexOf("/",a+1);if(0>a)return n;n+="../"}};k.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};k.is_internet_explorer=function(){return k.is_browser_of_type("MSIE")||k.is_browser_of_type("Trident")};k.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};k.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};k.remove_z_index=function(a){if(0===
a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$(a);a.attr("z-index","");return a.html()};k.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b;if(0!==a.length){a.button();b=a.get(0);b.innerHTML="Run all tests";var c=!1;a.click(function(a){c?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),b.innerHTML="Run all tests",k.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&
$(this).click()}),b.innerHTML="Stop all tests");c=!c})}};k.set_timeout=function(a,b){b?setTimeout(a,b):(D.push(a),window.postMessage("zero-timeout-message","*"))};k.get_first_property=function(a){return Object.keys(a)[0]};k.get_all_locally_stored_program_names=function(){var a=window.localStorage.getItem("toontalk-all-program-names");return a?JSON.parse(a):[]};k.set_all_locally_stored_program_names=function(a){window.localStorage.setItem("toontalk-all-program-names",JSON.stringify(a))};k.get_local_storage_meta_data=
function(a){a=k.local_storage_program_meta_data_key(a);var b;try{if(b=window.localStorage.getItem(a))return JSON.parse(b)}catch(c){}};k.local_storage_program_key=function(a){return"toontalk-json: "+a};k.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};k.enable_editor=function(a,b,c,d){(function(a,b){var c=function(a){a.data.editor_enabled_for&&a.data.editor_enabled_for===b&&(e=!0,window.removeEventListener("message",c))},d=function(a,b){e||setTimeout(function(){a();
d(a,b)},500)},e=!1;window.addEventListener("message",c);d(a,b)})(function(){a.postMessage({save_edits_to:window.location.href,file_id:c,widgets_json:d},"*")},c)};k.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};k.enable_touch_events=function(a,b){var c=a,d=function(b){var d;b.stopPropagation();b.preventDefault();e?(e=!1,p(b,a),d=k.widget_of_element(a),g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ndrag ended"),d&&(q(b,a),g.logging&&0===g.logging.indexOf("touch")&&
(g.debugging+="\ndrop happened")),g.logging&&0===g.logging.indexOf("touch")&&(alert(g.debugging),g.debugging="touch")):f=!0;a=c},e=!1,f=!1,h=0,l=0,n;a.addEventListener("touchstart",function(c){g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch start");c.preventDefault();"TEXTAREA"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||$(c.srcElement).is(".ui-resizable-handle")?g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch start ignored due to tag name or class"):
(c.stopPropagation(),k.set_timeout(function(){var b=c.changedTouches[0],d,n,p;f?(f=!1,d=document.createEvent("MouseEvent"),d.initMouseEvent("click",!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(d),g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch end treated as click",alert(g.debugging),g.debugging="touch")):(e=!0,(d=k.widget_of_element(a))&&d.get_infinite_stack()?(n=d.copy(),d.add_copy_to_container(n,0,0),d.set_infinite_stack(!1),
n.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(n=d.copy(),d.add_copy_to_container(n,0,0),p=$(a).offset(),a=n.get_frontside_element(!0)),p||(p=$(a).offset()),v(c,a),h=b.clientX-p.left,l=b.clientY-p.top,g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ndrag started"))},b))},!0);a.addEventListener("touchmove",function(b){var c;b.preventDefault();if(e){c=b.changedTouches[0];k.set_absolute_position($(a),{left:c.pageX-h,top:c.pageY-l});b=k.find_widget_on_page(c,a,0,0);if(n&&
n!==b){var d=n.get_frontside_element();k.remove_highlight(d);n=void 0}b&&(u(c,b.get_frontside_element()),n=b);g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ndragged to "+(c.pageX-h)+", "+(c.pageY-l))}else g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch move ignored since drag_started not yet set. "+Date.now())},!0);a.addEventListener("touchend",d,!0);a.addEventListener("touchcancel",d,!0)};k.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?
b.changedTouches[0][a]:b[a]};k.find_widget_on_page=function(a,b,c,d){var e=k.get_mouse_or_first_touch_event_attribute("pageX",a);a=k.get_mouse_or_first_touch_event_attribute("pageY",a);var f;$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for($(b).show();c&&!c.toontalk_widget&&(!$(c).is(".toontalk-backside")||$(c).is(".toontalk-top-level-backside"));)c=c.parentNode;c&&(f=c.toontalk_widget);if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),
b=f.get_type_name(),f&&"empty hole"===b?f.get_parent_of_frontside():f};k.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-top-level-backside").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return k.widget_of_element(c)};k.set_css=function(a,b){var c;if(b){if(c=k.widget_of_element(a))c.location_constrained_by_container()?(b.left="",b.top=""):c.is_plain_text_element()&&(b.width="",b.height="");!b.transform&&
void 0!==b.width&&void 0!==b.height&&c&&c.use_scaling_transform&&!$(a).is(".toontalk-backside")?c.use_scaling_transform(b):$(a).css(b)}};k.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};k.conjunction=function(a,b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?k.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};k.insert_function_bird_documentation=function(a){var b=TOONTALK[a]["function"],
c=Object.keys(b),d="<table class='toontalk-function-bird-documentation-table'>";c.forEach(function(a,c){d+="<tr><td><div id='bird_id_"+c+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+b[a].title+"</td></tr>"});d+="</table>";document.write(d);c.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));
e.id=encodeURIComponent(b)})};k.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=k.widget_of_element(b);c&&c.rerender()})};k.visible_element=function(a){a=$(a);return a.is(":visible")&&"0"!==a.css("opacity")};k.get_audio_volume=function(a){var c=document.hidden?0:k.get_current_url_numeric_parameter("volume",10)/100;0===c&&b.push({audio_object:a,volume:a.volume});return c};k.play_audio=function(a){a.play();l.push(a);a.addEventListener("ended",function(){var b=l.indexOf(a);0<=b&&
l.splice(b,1)})};k.mute_audio_objects_playing=function(){l.forEach(function(a){b.push({audio_object:a,volume:a.volume});a.volume=0});l=[]};k.restore_audio_volumes=function(){b.forEach(function(a){a.audio_object.volume=a.volume;l.push(a.audio_object)});b=[]};k.create_queue=function(){var a=[],b=0;return{getLength:function(){return a.length-b},isEmpty:function(){return 0==a.length},enqueue:function(b){var c=0==a.length;a.push(b);return c},dequeue:function(){var c;if(0!=a.length)return c=a[b],2*++b>=
a.length&&(a=a.slice(b),b=0),c},peek:function(){return 0<a.length?a[b]:void 0},does_any_item_satisfy:function(c){var d;for(d=b;d<a.length;d++)if(c(a[d]))return!0;return!1}}};return k}(window.TOONTALK);
