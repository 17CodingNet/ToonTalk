'use strict';(function(g){var k;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(k={},define(function(){return k})):k="undefined"!==typeof window?window:g:k=exports;(function(a){var d={greatest_common_divisor:function(c,q){if(1===q||1===c)return 1;for(var a;0!==q;){a=q;q=c%q;if(!isFinite(q))return 0;c=a}return c}};d.gcd=d.greatest_common_divisor;d.fromRandom=function(c){return Math.random()*(1<<c)>>>0};d.fromMillitime=function(){return+new Date};d.fromUnixtime=
function(){return.001*d.fromMillitime()|0};"undefined"!==typeof a&&(a.integer=d);(function(c){function q(c,d,e){if(e!==a)return c instanceof q?c:"undefined"===typeof c?b:q.parse(c);for(c=c||[];c.length&&!c[c.length-1];)--c.length;this._d=c;this._s=c.length?d||1:0}var a={};q._construct=function(c,b){return new q(c,b,a)};q.base=1E7;q.base_log10=7;var b=new q([],0,a);q.ZERO=b;var d=new q([1],1,a);q.ONE=d;var e=new q(d._d,-1,a);q.M_ONE=e;q._0=b;q._1=d;q.small=[b,d,new q([2],1,a),new q([3],1,a),new q([4],
1,a),new q([5],1,a),new q([6],1,a),new q([7],1,a),new q([8],1,a),new q([9],1,a),new q([10],1,a),new q([11],1,a),new q([12],1,a),new q([13],1,a),new q([14],1,a),new q([15],1,a),new q([16],1,a),new q([17],1,a),new q([18],1,a),new q([19],1,a),new q([20],1,a),new q([21],1,a),new q([22],1,a),new q([23],1,a),new q([24],1,a),new q([25],1,a),new q([26],1,a),new q([27],1,a),new q([28],1,a),new q([29],1,a),new q([30],1,a),new q([31],1,a),new q([32],1,a),new q([33],1,a),new q([34],1,a),new q([35],1,a),new q([36],
1,a)];q.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");q.prototype.toString=function(c){c=+c||10;if(2>c||36<c)throw Error("illegal radix "+c+".");if(0===this._s)return"0";if(10===c){c=0>this._s?"-":"";c+=this._d[this._d.length-1].toString();for(var a=this._d.length-2;0<=a;a--){for(var b=this._d[a].toString();7>b.length;)b="0"+b;c+=b}return c}a=q.digits;c=q.small[c];for(var b=this._s,d=this.abs(),e=[],h;0!==d._s;)h=d.divRem(c),d=h[0],h=h[1],e.push(a[h.valueOf()]);return(0>b?"-":"")+e.reverse().join("")};
q.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];q.parse=function(c,d){function e(c){c=c.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return c.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(c,a,q,l,b){b=+b;var d=0>b,e=q.length+b;c=(d?q:l).length;b=(b=Math.abs(b))>=c?b-c+d:0;c=Array(b+1).join("0");q+=l;return(a||"")+(d?q=c+q:q+=c).substr(0,e+=d?c.length:0)+(e<q.length?"."+q.substr(e):"")})}c=c.toString();if("undefined"===typeof d||10===+d)c=e(c);var h=RegExp("^([+\\-]?)("+("undefined"===
typeof d?"0[xcb]":16==d?"0x":8==d?"0c":2==d?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i").exec(c);if(h){var f=h[1]||"+",m=h[2]||"",h=h[3]||"";if("undefined"===typeof d)d="0x"===m||"0X"===m?16:"0c"===m||"0C"===m?8:"0b"===m||"0B"===m?2:10;else if(2>d||36<d)throw Error("Illegal radix "+d+".");d=+d;if(!q.radixRegex[d].test(h))throw Error("Bad digit for radix "+d);h=h.replace(/^0+/,"").split("");if(0===h.length)return b;f="-"===f?-1:1;if(10==d){for(m=[];7<=h.length;)m.push(parseInt(h.splice(h.length-q.base_log10,
q.base_log10).join(""),10));m.push(parseInt(h.join(""),10));return new q(m,f,a)}m=b;d=q.small[d];for(var g=q.small,l=0;l<h.length;l++)m=m.multiply(d).add(g[parseInt(h[l],36)]);return new q(m._d,f,a)}throw Error("Invalid BigInteger format: "+c);};q.prototype.add=function(c){if(0===this._s)return q(c);c=q(c);if(0===c._s)return this;if(this._s!==c._s)return c=c.negate(),this.subtract(c);var b=this._d;c=c._d;for(var d=b.length,e=c.length,h=Array(Math.max(d,e)+1),f=Math.min(d,e),m=0,l=0;l<f;l++)m=b[l]+
c[l]+m,h[l]=m%1E7,m=m/1E7|0;e>d&&(b=c,d=e);for(l=f;m&&l<d;l++)m=b[l]+m,h[l]=m%1E7,m=m/1E7|0;for(m&&(h[l]=m);l<d;l++)h[l]=b[l];return new q(h,this._s,a)};q.prototype.negate=function(){return new q(this._d,-this._s|0,a)};q.prototype.abs=function(){return 0>this._s?this.negate():this};q.prototype.subtract=function(c){if(0===this._s)return q(c).negate();c=q(c);if(0===c._s)return this;if(this._s!==c._s)return c=c.negate(),this.add(c);var d=this;0>this._s&&(d=new q(c._d,1,a),c=new q(this._d,1,a));var e=
d.compareAbs(c);if(0===e)return b;if(0>e){var h=c;c=d;d=h}d=d._d;c=c._d;var h=d.length,f=c.length,m=Array(h),g=0,l,n;for(l=0;l<f;l++)n=d[l]-g-c[l],0>n?(n+=1E7,g=1):g=0,m[l]=n;for(l=f;l<h;l++){n=d[l]-g;if(0>n)n+=1E7;else{m[l++]=n;break}m[l]=n}for(;l<h;l++)m[l]=d[l];return new q(m,e,a)};(function(){function c(b,d){for(var e=b._d,h=e.slice(),m=0;;){var l=(e[m]||0)+1;h[m]=l%1E7;if(9999999>=l)break;++m}return new q(h,d,a)}function b(c,d){for(var e=c._d,h=e.slice(),m=0;;){var l=(e[m]||0)-1;if(0>l)h[m]=
l+1E7;else{h[m]=l;break}++m}return new q(h,d,a)}q.prototype.next=function(){switch(this._s){case 0:return d;case -1:return b(this,-1);default:return c(this,1)}};q.prototype.prev=function(){switch(this._s){case 0:return e;case -1:return c(this,-1);default:return b(this,1)}}})();q.prototype.compareAbs=function(c){if(this===c)return 0;if(!(c instanceof q)){if(!isFinite(c))return isNaN(c)?c:-1;c=q(c)}if(0===this._s)return 0!==c._s?-1:0;if(0===c._s)return 1;var a=this._d.length,b=c._d.length;if(a<b)return-1;
if(a>b)return 1;b=this._d;c=c._d;for(--a;0<=a;a--)if(b[a]!==c[a])return b[a]<c[a]?-1:1;return 0};q.prototype.compare=function(c){if(this===c)return 0;c=q(c);return 0===this._s?-c._s:this._s===c._s?this.compareAbs(c)*this._s:this._s};q.prototype.isUnit=function(){return this===d||this===e||1===this._d.length&&1===this._d[0]};q.prototype.multiply=function(c){if(0===this._s)return b;c=q(c);if(0===c._s)return b;if(this.isUnit())return 0>this._s?c.negate():c;if(c.isUnit())return 0>c._s?this.negate():this;
if(this===c)return this.square();var d=this._d.length>=c._d.length,e=(d?this:c)._d,d=(d?c:this)._d,h=e.length,m=d.length,f=h+m,g=Array(f),l;for(l=0;l<f;l++)g[l]=0;for(l=0;l<m;l++){for(var f=0,n=d[l],k=h+l,y,r=l;r<k;r++)y=g[r]+n*e[r-l]+f,f=y/1E7|0,g[r]=y%1E7|0;f&&(y=g[r]+f,g[r]=y%1E7)}return new q(g,this._s*c._s,a)};q.prototype.multiplySingleDigit=function(c){if(0===c||0===this._s)return b;if(1===c)return this;var d;if(1===this._d.length)return d=this._d[0]*c,1E7<=d?new q([d%1E7|0,d/1E7|0],1,a):new q([d],
1,a);if(2===c)return this.add(this);if(this.isUnit())return new q([c],1,a);var e=this._d,h=e.length;d=h+1;for(var m=Array(d),f=0;f<d;f++)m[f]=0;for(var g=f=0;g<h;g++)d=c*e[g]+f,f=d/1E7|0,m[g]=d%1E7|0;f&&(m[g]=f);return new q(m,1,a)};q.prototype.square=function(){if(0===this._s)return b;if(this.isUnit())return d;var c=this._d,e=c.length,h=Array(e+e+1),m,f,g,n;for(n=0;n<e;n++)g=2*n,m=c[n]*c[n],f=m/1E7|0,h[g]=m%1E7,h[g+1]=f;for(n=0;n<e;n++){f=0;g=2*n+1;for(var l=n+1;l<e;l++,g++)m=c[l]*c[n]*2+h[g]+f,
f=m/1E7|0,h[g]=m%1E7;g=e+n;m=f+h[g];f=m/1E7|0;h[g]=m%1E7;h[g+1]+=f}return new q(h,1,a)};q.prototype.quotient=function(c){return this.divRem(c)[0]};q.prototype.divide=q.prototype.quotient;q.prototype.remainder=function(c){return this.divRem(c)[1]};q.prototype.divRem=function(c){c=q(c);if(0===c._s)throw Error("Divide by zero");if(0===this._s)return[b,b];if(1===c._d.length)return this.divRemSmall(c._s*c._d[0]);switch(this.compareAbs(c)){case 0:return[this._s===c._s?d:e,b];case -1:return[b,this]}var h=
this._s*c._s,m=c.abs(),f=this._d,g=f.length,n=[],k,l=new q([],0,a);for(l._s=1;g;)if(l._d.unshift(f[--g]),0>l.compareAbs(c))n.push(0);else{if(0===l._s)k=0;else{var u=l._d.length;k=m._d.length;u=1E7*l._d[u-1]+l._d[u-2];k=1E7*m._d[k-1]+m._d[k-2];l._d.length>m._d.length&&(u=1E7*(u+1));k=Math.ceil(u/k)}do{u=m.multiplySingleDigit(k);if(0>=u.compareAbs(l))break;k--}while(k);n.push(k);k&&(k=l.subtract(u),l._d=k._d.slice(),0===l._d.length&&(l._s=0))}return[new q(n.reverse(),h,a),new q(l._d,this._s,a)]};q.prototype.divRemSmall=
function(c){c=+c;if(0===c)throw Error("Divide by zero");var d=this._s*(0>c?-1:1);c=Math.abs(c);if(1>c||1E7<=c)throw Error("Argument out of range");if(0===this._s)return[b,b];if(1===c||-1===c)return[1===d?this.abs():new q(this._d,d,a),b];if(1===this._d.length){var e=new q([this._d[0]/c|0],1,a);c=new q([this._d[0]%c|0],1,a);0>d&&(e=e.negate());0>this._s&&(c=c.negate());return[e,c]}for(var h=this._d.slice(),e=Array(h.length),m=0,f=0,g=0,l;h.length;)m=1E7*m+h[h.length-1],m<c?(e[g++]=0,h.pop(),f=1E7*f+
m):(l=0===m?0:m/c|0,f=m-c*l,(e[g++]=l)?(h.pop(),m=f):h.pop());c=new q([f],1,a);0>this._s&&(c=c.negate());return[new q(e.reverse(),d,a),c]};q.prototype.isEven=function(){var c=this._d;return 0===this._s||0===c.length||0===c[0]%2};q.prototype.isOdd=function(){return!this.isEven()};q.prototype.sign=function(){return this._s};q.prototype.isPositive=function(){return 0<this._s};q.prototype.isNegative=function(){return 0>this._s};q.prototype.isZero=function(){return 0===this._s};q.prototype.exp10=function(c){c=
+c;if(0===c)return this;if(Math.abs(c)>Number(h))throw Error("exponent too large in BigInteger.exp10");if(0<c){for(var d=new q(this._d.slice(),this._s,a);7<=c;c-=7)d._d.unshift(0);if(0==c)return d;d._s=1;d=d.multiplySingleDigit(Math.pow(10,c));return 0>this._s?d.negate():d}if(-c>=7*this._d.length)return b;d=new q(this._d.slice(),this._s,a);for(c=-c;7<=c;c-=7)d._d.shift();return 0==c?d:d.divRemSmall(Math.pow(10,c))[0]};q.prototype.pow=function(c){if(this.isUnit())return 0<this._s?this:q(c).isOdd()?
this:this.negate();c=q(c);if(0===c._s)return d;if(0>c._s){if(0===this._s)throw Error("Divide by zero");return b}if(0===this._s)return b;if(c.isUnit())return this;if(0<c.compareAbs(h))throw Error("exponent too large in BigInteger.pow");for(var a=this,e=d,m=q.small[2];c.isPositive()&&(!c.isOdd()||(e=e.multiply(a),!c.isUnit()));)a=a.square(),c=c.quotient(m);return e};q.prototype.modPow=function(c,a){for(var b=d,e=this;c.isPositive();)c.isOdd()&&(b=b.multiply(e).remainder(a)),c=c.quotient(q.small[2]),
c.isPositive()&&(e=e.square().remainder(a));return b};q.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var c=this._d.length;if(30>7*c)return Math.log(this.valueOf());var d=Math.ceil(30/7),b=this._d.slice(c-d);return Math.log((new q(b,1,a)).valueOf())+(c-d)*Math.log(1E7)};q.prototype.valueOf=function(){return parseInt(this.toString(),10)};q.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var h=q(2147483647);q.MAX_EXP=h;(function(){function c(a){return function(c){return a.call(q(c))}}
function a(c){return function(a,d){return c.call(q(a),q(d))}}function d(c){return function(a,d,b){return c.call(q(a),q(d),q(b))}}(function(){var b,e,h="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),m="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),l=["modPow"];for(b=0;b<h.length;b++)e=h[b],q[e]=c(q.prototype[e]);for(b=0;b<m.length;b++)e=m[b],q[e]=a(q.prototype[e]);for(b=0;b<l.length;b++)e=
l[b],q[e]=d(q.prototype[e]);q.exp10=function(c,a){return q(c).exp10(a)}})()})();c.BigInteger=q})("undefined"!==typeof a?a:this);var b={greatest_common_divisor:function(c,a){if(a.isUnit()||c.isUnit())return BigInteger.ONE;for(var b;!a.isZero();)b=a,a=c.remainder(a),c=b;return c},create:function(){return[0]},clone:function(c){for(var a=[],b=0,d=c.length;b<d;b++)a[b]=c[b];return a},copy:function(c,a){c=[];for(var b=0,d=a.length;b<d;b++)c[b]=a[b];return c},abs:function(c,a){c[0]=Math.abs(a[0]);return c},
str:function(c){return c[0].toString()},toInteger:function(c){return out[0]},fromInteger:function(c){return[parseInt(c)]}};b.ZERO=b.fromInteger(0);b.ONE=b.fromInteger(1);"undefined"!==typeof a&&(a.bigint=b);if(!e)var e=Array;if(!h)var h=Math.pow(2,56);if(!g)var g=16777216;var f={EPSILON:2E-16};f.MAX_LOOPS=g;f.create=function(){var c=new e(2);c[0]=0;c[1]=1;return c};f.clone=function(c){var a=new e(2);a[0]=c[0];a[1]=c[1];return a};f.fromValues=function(c,a){var b=new e(2);b[0]=c;b[1]=a;return f.normalize(b,
b)};f.copy=function(c,a){c[0]=a[0];c[1]=a[1];return c};f.set=function(c,a,b){c[0]=a;c[1]=b;return f.normalize(c,c)};f.abs=function(c,a){c[0]=Math.abs(a[0]);c[1]=a[1];return c};f.invert=function(c,a){var b=a[0];c[0]=a[1];c[1]=b;return c};f.reciprocal=f.invert;f.add=function(c,a,b){a[1]===b[1]?(c[0]=a[0]+b[0],c[1]=a[1]):(c[0]=a[0]*b[1]+b[0]*a[1],c[1]=a[1]*b[1]);return f.normalize(c,c)};f.subtract=function(c,a,b){a[1]===b[1]?(c[0]=a[0]-b[0],c[1]=a[1]):(c[0]=a[0]*b[1]-b[0]*a[1],c[1]=a[1]*b[1]);return f.normalize(c,
c)};f.sub=f.subtract;f.multiply=function(c,a,b){c[0]=a[0]*b[0];c[1]=a[1]*b[1];return f.normalize(c,c)};f.mul=f.multiply;f.mediant=function(c,a,b){c[0]=a[0]+b[0];c[1]=a[1]+b[1];return f.normalize(c,c)};f.divide=function(c,a,b){c[0]=a[0]*b[1];c[1]=a[1]*b[0];return f.normalize(c,c)};f.div=f.divide;f.equals=function(c,a){return 0===c[0]&&0===a[0]||0===c[1]&&0===a[1]?!0:c[0]===a[0]&&c[1]===a[1]};f.approximates=function(c,a){if(f.equals(c,a))return!0;var b=f.create();f.sub(b,c,a);f.abs(b,b);return f.isLessThan(b,
f.INFINITESIMAL)};f.isGreaterThan=function(c,a){return f.equals(c,a)?!1:c[0]*a[1]>a[0]*c[1]};f.isLessThan=function(c,a){return f.equals(c,a)?!1:c[0]*a[1]<a[0]*c[1]};f.isNegative=function(c){return 0>c[0]};f.min=function(c,a,b){f.isLessThan(a,b)?(c[0]=a[0],c[1]=a[1]):(c[0]=b[0],c[1]=b[1]);return c};f.max=function(c,a,b){f.isGreaterThan(a,b)?(c[0]=a[0],c[1]=a[1]):(c[0]=b[0],c[1]=b[1]);return c};f.scalar_multiply=function(c,a,b){c[0]=a[0]*b;c[1]=a[1];return f.normalize(c,c)};f.scalar_divide=function(c,
a,b){c[0]=a[0];c[1]=a[1]*b;return f.normalize(c,c)};f.normalize=function(c,a){if(isNaN(a[0])||isNaN(a[1])||0===a[0]&&0===a[1])return c[0]=0,c[1]=0,c;if(0===a[0])return c[0]=0,c[1]=1,c;if(0===a[1])return c[0]=1,c[1]=0,c;if(a[0]===a[1])return c[0]=1,c[1]=1,c;0<a[1]?(c[0]=a[0],c[1]=a[1]):(c[0]=-a[0],c[1]=-a[1]);var b=d.greatest_common_divisor(Math.abs(c[0]),c[1]);1<b&&(c[0]/=b,c[1]/=b);return c};f.opposite=function(c,a){c[0]=-a[0];c[1]=a[1];return c};f.negative=f.opposite;f.neg=f.opposite;f.power=function(c,
a,b){2===b?(c[0]=a[0]*a[0],c[1]=a[1]*a[1]):0<b?(c[0]=Math.pow(a[0],b),c[1]=Math.pow(a[1],b)):0>b?(b=Math.abs(b),c[0]=Math.pow(a[1],b),c[1]=Math.pow(a[0],b)):f.copy(c,f.ONE);return f.normalize(c,c)};f.pow=f.power;f.sqrt=function(c,a){return f.nthRoot(c,a,2)};f.nthRoot=function(c,a,b){if(f.equals(a,f.ZERO))return f.copy(c,f.ZERO);if(f.equals(a,f.ONE))return f.copy(c,f.ONE);if(f.equals(a,f.INFINITY))return f.copy(c,f.INFINITY);if(f.equals(a,f.INFINULL))return f.copy(c,f.INFINULL);var d=f.isNegative(a);
d&&(a[0]=-a[0]);c=f.copy(c,f.ONE);for(var e=[1,0,0,1],h=f.clone(f.ONE),m=f.MAX_LOOPS;!f.approximates(a,h)&&m--;)f.isLessThan(a,h)?(e[0]+=e[1],e[2]+=e[3]):(e[1]+=e[0],e[3]+=e[2]),c[0]=e[0]+e[1],c[1]=e[2]+e[3],f.pow(h,c,b);d&&(a[0]=-a[0],1===b%2&&f.neg(c,c));return c};f.dot=function(c,a){return c[0]*a[0]+c[1]*a[1]};f.str=function(c){return 1===c[1]?c[0].toString():c[0]+"/"+c[1]};f.toDecimal=function(c){return c[0]/c[1]};f.dec=f.toDecimal;f.toInteger=function(c){return Math.round(f.toDecimal(c))};f.round=
f.toInteger;f.floor=function(c){return Math.floor(f.toDecimal(c))};f.ceil=function(c){return Math.ceil(f.toDecimal(c))};f.fromInteger_copy=function(c,a){c[0]=parseInt(a);c[1]=1;return c};f.fromInteger=function(c){return f.fromInteger_copy(f.create(),c)};f.fromIntegerInverse_copy=function(c,a){c[0]=1;c[1]=parseInt(a);0>c[1]&&(c[0]=-c[0],c[1]=-c[1]);return c};f.fromIntegerInverse=function(c){return f.fromIntegerInverse_copy(f.create(),c)};f.fromDecimal=function(c){return f.fromDecimal_copy(f.create(),
c)};f.fromDecimal_copy=function(c,a){a=parseFloat(a);if(isNaN(a))return f.copy(c,f.INFINULL);if(Infinity===a)return f.copy(c,f.INFINITY);if(Math.abs(a)<f.EPSILON)return f.copy(c,f.ZERO);if(Math.abs(a-1)<f.EPSILON)return f.copy(c,f.ONE);if(Math.abs(a%1)<f.EPSILON)return f.fromInteger_copy(c,a);if(Math.abs(1/a%1)<f.EPSILON)return f.fromIntegerInverse_copy(c,Math.round(1/a));f.copy(c,f.ONE);for(var b=[1,0,0,1],d=a,e=1,h=f.MAX_LOOPS;h--&&Math.abs(a-f.toDecimal(c))>f.EPSILON;)e=Math.floor(d),c[0]=e*b[0]+
b[2],c[1]=e*b[1]+b[3],d=1/(d-e),b[2]=b[0],b[3]=b[1],b[0]=c[0],b[1]=c[1];return c};f.fromRandom=function(c){c[0]=0xfffffffffffff*Math.random()<<0;c[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return f.normalize(c,c)};f.sin=function(c,a){if(0===a[1])return f.copy(c,f.ZERO);f.scalar_multiply(c,a,2);var b=f.create();f.pow(b,a,2);f.add(b,b,f.ONE);f.divide(c,c,b);return c};f.cos=function(c,a){if(0===a[1])return f.neg(c,f.ONE);var b=f.create();f.pow(b,a,2);f.sub(c,f.ONE,b);var d=f.create();f.add(d,f.ONE,
b);f.divide(c,c,d);return c};f.tan=function(c,a){f.scalar_multiply(c,a,2);var b=f.create();f.pow(b,a,2);f.scalar_multiply(b,b,2);f.add(c,c,b);f.pow(b,a,4);f.sub(b,f.ONE,b);f.divide(c,c,b);return c};f.toEgyptian=function(c){c=f.clone(c);f.abs(c,c);var a=f.floor(c);a&&f.sub(c,c,f.fromInteger(a));if(!c[0])return a.toString();a||(a="");for(var b=1,d=f.create();1!==c[0];)b++,d=f.fromValues(1,b),f.isGreaterThan(c,d)&&(a&&(a+=" + "),a+=f.str(d),f.sub(c,c,d));return c?a?a+" + "+f.str(c):f.str(c):a?a:"0"};
f.toBabylonian=function(c){var a="",b=f.toDecimal(c);c=parseInt(b);for(var b=b-c,d=0,e=0;0<c;)(d=c%60)&&(a=d+" * 60^"+e+(a?" + ":"")+a),c=(c-d)/60,e++;for(e=-1;0<b;)b*=60,d=parseInt(b+1E-13),b-=d,-1E-13>b||(d&&(a+=(a?" + ":"")+d+" * 60^"+e),e--);return a?a:"0"};f.traceSternBrocot=function(c){var a="";if(f.equals(c,f.ZERO)||f.equals(c,f.ONE)||f.equals(c,f.INFINITY)||f.equals(c,f.INFINULL))return a;if(f.equals(c,f.ZERO))return f.copy(out,f.ZERO);if(f.equals(c,f.ONE))return f.copy(out,f.ONE);if(f.equals(c,
f.INFINITY))return f.copy(out,f.INFINITY);if(f.equals(c,f.INFINULL))return f.copy(out,f.INFINULL);c=f.clone(c);f.isNegative(c)&&(c[0]=-c[0]);for(var b=f.clone(f.ONE),d=[1,0,0,1],e=0,h=0,m=f.MAX_LOOPS;!f.approximates(c,b)&&m--;)f.isLessThan(c,b)?(d[0]+=d[1],d[2]+=d[3],h++,e&&(a+="R",1!==e&&(a+=e),e=0,a+=" ")):(d[1]+=d[0],d[3]+=d[2],e++,h&&(a+="L",1!==h&&(a+=h),h=0,a+=" ")),b[0]=d[0]+d[1],b[1]=d[2]+d[3];h?(a+="L",1!==h&&(a+=h)):e&&(a+="R",1!==e&&(a+=e));0>m&&(a+="...");return a};f.toContinuedFraction=
function(c,a){a="undefined"===typeof a?65536:parseInt(a);if(f.equals(c,f.ZERO))return[0];if(f.equals(c,f.ONE))return[1];if(f.equals(c,f.NEGONE))return[-1];if(f.equals(c,f.INFINITY))return[1,0];if(f.equals(c,f.INFINULL))return[0,0];var b=f.clone(c),d=f.isNegative(b);d&&(b[0]=-b[0]);for(var e=f.clone(f.ONE),h=[1,0,0,1],m=1,g=[0],n=g.length-1;!f.equals(b,e)&&a--;)f.isLessThan(b,e)?(-1===m?g[n]++:(m=-1,g.push(1),n++),h[0]+=h[1],h[2]+=h[3]):(1===m?g[n]++:(m=1,g.push(1),n++),h[1]+=h[0],h[3]+=h[2]),e[0]=
h[0]+h[1],e[1]=h[2]+h[3];0>a?g.push(0):g[n]++;if(d)for(var k in g)g[k]=-g[k];return g};f.fromContinuedFraction=function(c,a){f.fromInteger_copy(c,a[a.length-1]);for(var b=a.length-2;-1<b;b--)f.invert(c,c),f.add(c,f.fromInteger(a[b]),c);return c};f.dump=function(c){f.create();return"rat\t"+f.str(c)+"\n~\t"+f.toDecimal(c)+"\nCF:\t["+f.toContinuedFraction(c)+"]\n"};f.ZERO=f.fromInteger(0);f.ONE=f.fromInteger(1);f.NEGONE=f.fromInteger(-1);f.INFINITY=f.fromValues(1,0);f.INFINULL=f.fromValues(0,0);f.INFINITESIMAL=
f.clone([1,h]);f.PI=f.fromValues(1320192667429,420230377710);"undefined"!==typeof a&&(a.rat=f);if(!k)var k=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!p)var p=1073741824;var m={EPSILON:2E-16};m.MAX_LOOPS=p;m.create=function(){var c=[];c[0]=BigInteger.ZERO;c[1]=BigInteger.ONE;return c};m.clone=function(c){var a=[];a[0]=c[0];a[1]=c[1];return a};m.fromValues=function(c,a){var b=[];b[0]=new BigInteger(c);b[1]=new BigInteger(a);return m.normalize(b,b)};m.copy=function(c,a){c[0]=a[0];c[1]=
a[1];return c};m.set=function(c,a,b){c[0]=a;c[1]=b;return m.normalize(c,c)};m.toRat=function(c,a){return f.set(c,a[0].toJSValue(),a[1].toJSValue())};m.fromRat=function(c,a){return m.set(c,BigInteger(a[0]),BigInteger(a[1]))};m.abs=function(c,a){c[0]=a[0].abs();c[1]=a[1];return c};m.invert=function(c,a){var b=a[0];c[0]=a[1];c[1]=b;return c};m.reciprocal=m.invert;m.add=function(c,a,b){0===a[1].compare(b[1])?(c[0]=a[0].add(b[0]),c[1]=a[1]):(c[0]=a[0].multiply(b[1]).add(b[0].multiply(a[1])),c[1]=a[1].multiply(b[1]));
return m.normalize(c,c)};m.subtract=function(c,a,b){0===a[1].compare(b[1])?(c[0]=a[0].subtract(b[0]),c[1]=a[1]):(c[0]=a[0].multiply(b[1]).subtract(b[0].multiply(a[1])),c[1]=a[1].multiply(b[1]));return m.normalize(c,c)};m.sub=m.subtract;m.multiply=function(c,a,b){c[0]=a[0].multiply(b[0]);c[1]=a[1].multiply(b[1]);return m.normalize(c,c)};m.mul=m.multiply;m.mediant=function(c,a,b){c[0]=a[0].add(b[0]);c[1]=a[1].add(b[1]);return m.normalize(c,c)};m.divide=function(c,a,b){c[0]=a[0].multiply(b[1]);c[1]=
a[1].multiply(b[0]);return m.normalize(c,c)};m.div=m.divide;m.equals=function(c,a){return c[0].isZero()&&a[0].isZero()||c[1].isZero()&&a[1].isZero()?!0:0===c[0].compare(a[0])&&0===c[1].compare(a[1])};m.approximates=function(c,a){if(m.equals(c,a))return!0;var b=m.create();m.sub(b,c,a);m.abs(b,b);return m.isLessThan(b,m.INFINITESIMAL)};m.isGreaterThan=function(c,a){return m.equals(c,a)?!1:0<c[0].multiply(a[1]).compare(a[0].multiply(c[1]))};m.isLessThan=function(c,a){return m.equals(c,a)?!1:0>c[0].multiply(a[1]).compare(a[0].multiply(c[1]))};
m.isNegative=function(c){return c[0].isNegative()};m.min=function(c,a,b){m.isLessThan(a,b)?(c[0]=a[0],c[1]=a[1]):(c[0]=b[0],c[1]=b[1]);return c};m.max=function(c,a,b){m.isGreaterThan(a,b)?(c[0]=a[0],c[1]=a[1]):(c[0]=b[0],c[1]=b[1]);return c};m.scalar_multiply=function(c,a,b){c[0]=a[0].multiply(b);c[1]=a[1];return m.normalize(c,c)};m.scalar_divide=function(c,a,b){c[0]=a[0];c[1]=a[1].multiply(b);return m.normalize(c,c)};m.normalize=function(c,a){if(a[0].isZero()||a[1].isZero())return a;if(0===a[0].compare(a[1]))return m.clone(m.ONE);
if(a[1].isNegative())c[0]=a[0].negate(),c[1]=a[1].negate();else if(c[0]=a[0],c[1]=a[1],c[1].isZero())return c;var d=b.greatest_common_divisor(c[0].abs(),c[1]);0<d.compare(BigInteger.ONE)&&(c[0]=c[0].quotient(d),c[1]=c[1].quotient(d));return c};m.opposite=function(a,b){a[0]=b[0].negate();a[1]=b[1];return a};m.negative=m.opposite;m.neg=m.opposite;m.power=function(a,b,d){2===d?(a[0]=b[0].square(),a[1]=b[1].square()):0<d?(a[0]=b[0].pow(d),a[1]=b[1].pow(d)):0>d?(d=Math.abs(d),a[0]=b[1].pow(d),a[1]=b[0].pow(d)):
m.copy(a,m.ONE);return a};m.pow=m.power;m.sqrt=function(a,b){return m.nthRoot(a,b,2)};m.nthRoot=function(a,b,d){if(m.equals(b,m.ZERO))return m.copy(a,m.ZERO);if(m.equals(b,m.ONE))return m.copy(a,m.ONE);if(m.equals(b,m.INFINITY))return m.copy(a,m.INFINITY);if(m.equals(b,m.INFINULL))return m.copy(a,m.INFINULL);var e=m.isNegative(b);e&&(b[0]=b[0].negate());m.copy(a,m.ONE);for(var h=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=m.clone(m.ONE),g=p;!m.approximates(b,f)&&g--;)m.isLessThan(b,
f)?(h[0]=h[0].add(h[1]),h[2]=h[2].add(h[3])):(h[1]=h[1].add(h[0]),h[3]=h[3].add(h[2])),a[0]=h[0].add(h[1]),a[1]=h[2].add(h[3]),m.pow(f,a,d);e&&(b[0]=b[0].negate(),1===d%2&&m.neg(a,a));return a};m.dot=function(a,b){return a[0].multiply(b[0]).add(a[1].multiply(b[1]))};m.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};m.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};m.dec=m.toDecimal;m.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};
m.round=m.toInteger;m.toBigInteger=function(a){return a[0].quotient(a[1])};m.floor=function(a){return Math.floor(m.toDecimal(a))};m.ceil=function(a){return Math.ceil(m.toDecimal(a))};m.fromInteger_copy=function(a,b){a[0]=BigInteger(b);a[1]=BigInteger.ONE;return a};m.fromInteger=function(a){return m.fromInteger_copy(m.create(),a)};m.fromIntegerInverse_copy=function(a,b){a[0]=BigInteger.ONE;a[1]=BigInteger(b);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};m.fromIntegerInverse=
function(a){return m.fromIntegerInverse_copy(m.create(),a)};m.fromDecimal=function(a){return m.fromDecimal_copy(m.create(),a)};m.fromDecimal_copy=function(a,b){b=parseFloat(b);if(isNaN(b))return m.copy(a,m.INFINULL);if(Infinity===b)return m.copy(a,m.INFINITY);if(Math.abs(b)<m.EPSILON)return m.copy(a,m.ZERO);if(Math.abs(b-1)<m.EPSILON)return m.copy(a,m.ONE);if(Math.abs(b%1)<m.EPSILON)return m.fromInteger_copy(a,b);if(Math.abs(1/b%1)<m.EPSILON)return m.fromIntegerInverse_copy(a,Math.round(1/b));m.copy(a,
m.ONE);for(var d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=b,h=1,f=m.MAX_LOOPS;f--&&Math.abs(b-m.toDecimal(a))>m.EPSILON;)h=Math.floor(e),a[0]=BigInteger(h*d[0]+d[2]),a[1]=BigInteger(h*d[1]+d[3]),e=1/(e-h),d[2]=d[0],d[3]=d[1],d[0]=a[0],d[1]=a[1];return a};m.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*Math.random()<<0));return m.normalize(a,a)};m.sin=function(a,b){if(b[1].isZero())return m.copy(a,m.ZERO);m.scalar_multiply(a,
b,2);var d=m.create();m.pow(d,b,2);m.add(d,d,m.ONE);m.divide(a,a,d);return a};m.cos=function(a,b){if(b[1].isZero())return m.neg(a,m.ONE);var d=m.create();m.pow(d,b,2);m.sub(a,m.ONE,d);var e=m.create();m.add(e,m.ONE,d);m.divide(a,a,e);return a};m.tan=function(a,b){m.scalar_multiply(a,b,2);var d=m.create();m.pow(d,b,2);m.scalar_multiply(d,d,2);m.add(a,a,d);m.pow(d,b,4);m.sub(d,m.ONE,d);m.divide(a,a,d);return a};m.toEgyptian=function(a){a=m.clone(a);m.abs(a,a);var b=m.floor(a);b&&m.sub(a,a,m.fromInteger(b));
if(!a[0])return b.toString();b||(b="");for(var d=1,e=m.create();1!==a[0];)d++,e=m.fromValues(1,d),m.isGreaterThan(a,e)&&(b&&(b+=" + "),b+=m.str(e),m.sub(a,a,e));return a?b?b+" + "+m.str(a):m.str(a):b?b:"0"};m.toBabylonian=function(a){var b="",d=m.toDecimal(a);a=parseInt(d);for(var d=d-a,e=0,h=0;0<a;)(e=a%60)&&(b=e+" * 60^"+h+(b?" + ":"")+b),a=(a-e)/60,h++;for(h=-1;0<d;)d*=60,e=parseInt(d+1E-13),d-=e,-1E-13>d||(e&&(b+=(b?" + ":"")+e+" * 60^"+h),h--);return b?b:"0"};m.traceSternBrocot=function(a){var b=
"";if(m.equals(a,m.ZERO)||m.equals(a,m.ONE)||m.equals(a,m.INFINITY)||m.equals(a,m.INFINULL))return b;a=m.clone(a);m.isNegative(a)&&(a[0]=a[0].negate());for(var d=m.clone(m.ONE),e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],h=0,f=0,g=65536;!m.equals(a,d)&&g--;)m.isLessThan(a,d)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3]),f++,h&&(b+="R",1!==h&&(b+=h),h=0,b+=" ")):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2]),h++,f&&(b+="L",1!==f&&(b+=f),f=0,b+=" ")),d[0]=e[0].add(e[1]),d[1]=e[2].add(e[3]);f?(b+=
"L",1!==f&&(b+=f)):h&&(b+="R",1!==h&&(b+=h));0>g&&(b+="...");return b};m.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(m.equals(a,m.ZERO))return[0];if(m.equals(a,m.ONE))return[1];if(m.equals(a,m.NEGONE))return[-1];if(m.equals(a,m.INFINITY))return[1,0];if(m.equals(a,m.INFINULL))return[0,0];var d=m.clone(a),e=m.isNegative(d);e&&(d[0]=d[0].negate());for(var h=m.clone(m.ONE),f=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=1,n=[0],k=n.length-1;!m.equals(d,
h)&&b--;)m.isLessThan(d,h)?(-1===g?n[k]++:(g=-1,n.push(1),k++),f[0]=f[0].add(f[1]),f[2]=f[2].add(f[3])):(1===g?n[k]++:(g=1,n.push(1),k++),f[1]=f[1].add(f[0]),f[3]=f[3].add(f[2])),h[0]=f[0].add(f[1]),h[1]=f[2].add(f[3]);0>b?n.push(0):n[k]++;if(e)for(var r in n)n[r]=-n[r];return n};m.fromContinuedFraction=function(a,b){m.fromInteger_copy(a,b[b.length-1]);for(var d=b.length-2;-1<d;d--)m.invert(a,a),m.add(a,m.fromInteger(b[d]),a);return a};m.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return m.fromInteger_copy(a,
factorial.PREPARED[b]);var d=factorial.PREPARED.length-1;for(m.fromInteger_copy(a,factorial.PREPARED[d]);d<b;)m.scalar_multiply(a,a,++d);return a};m.dump=function(a){return"bigrat\t"+m.str(a)+"\n~\t"+m.toDecimal(a)+"\nCF:\t["+m.toContinuedFraction(a)+"]\n"};m.ZERO=m.fromInteger(0);m.ONE=m.fromInteger(1);m.NEGONE=m.fromInteger(-1);m.INFINITY=m.fromValues(1,0);m.INFINULL=m.fromValues(0,0);m.INFINITESIMAL=m.clone([new BigInteger(1),k]);m.PI=m.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587",
"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");"undefined"!==typeof a&&(a.bigrat=m);var r=function(a,b){this.a=f.fromValues(parseInt(a),parseInt(b))};r.prototype.toString=function(){return f.str(this.a)};r.prototype.toContinuedFraction=function(a){return f.toContinuedFraction(this.a,
a)};r.prototype.invert=function(){return f.invert(this.a)};r.prototype.reciprocal=r.prototype.invert;r.prototype.add=function(a){var b=f.create();f.add(b,this.a,a.a);return new r(b[0],b[1])};r.prototype.plus=r.prototype.add;r.prototype.subtract=function(a){var b=f.create();f.sub(b,this.a,a.a);return new r(b[0],b[1])};r.prototype.sub=r.prototype.subtract;r.prototype.minus=r.prototype.subtract;r.prototype.multiply=function(a){var b=f.create();f.mul(b,this.a,a.a);return new r(b[0],b[1])};r.prototype.mul=
r.prototype.multiply;r.prototype.times=r.prototype.multiply;r.prototype.mediant=function(a){var b=f.create();f.mediant(b,this.a,a.a);return new r(b[0],b[1])};r.prototype.divide=function(a){var b=f.create();f.div(b,this.a,a.a);return new r(b[0],b[1])};r.prototype.div=r.prototype.divide;r.prototype.divided_by=r.prototype.divide;r.prototype.power=function(a){var b=f.create();f.pow(b,this.a,a);return new r(b[0],b[1])};r.prototype.pow=r.prototype.power;r.prototype.dump=function(){return f.dump(this.a)};
r.prototype.toRat=function(){return f.clone(this.a)};r.prototype.toDecimal=function(){return f.toDecimal(this.a)};r.fromRat=function(a){var b=new r;b.a[0]=a[0];b.a[1]=a[1];return b};r.fromInteger=function(a){return r.fromRat(f.fromInteger(a))};r.fromIntegerInverse=function(a){return r.fromRat(f.fromIntegerInverse(a))};r.fromDecimal=function(a){return r.fromRat(f.fromDecimal(a))};r.fromContinuedFraction=function(a){return r.fromRat(f.fromContinuedFraction(f.create(),a))};"undefined"!==typeof a&&(a.rational=
r)})(k)})(this);/*
   Copyright 2008-2014 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
*/
(function(g,k,a){(function(a){"function"===typeof define&&define.amd?define("datatables",["jquery"],a):"object"===typeof exports?a(require("jquery")):jQuery&&!jQuery.fn.dataTable&&a(jQuery)})(function(d){function b(a){var c,e,l={};d.each(a,function(d,h){(c=d.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(c[1]+" ")&&(e=d.replace(c[0],c[2].toLowerCase()),l[e]=d,"o"===c[1]&&b(a[d]))});a._hungarianMap=l}function e(L,c,l){L._hungarianMap||b(L);var h;d.each(c,function(b,f){h=L._hungarianMap[b];
h===a||!l&&c[h]!==a||("o"===h.charAt(0)?(c[h]||(c[h]={}),d.extend(!0,c[h],c[b]),e(L[h],c[h],l)):c[h]=c[b])})}function h(a){var b=B.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&c&&"No data available in table"===b.sEmptyTable&&ga(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&c&&"Loading..."===b.sLoadingRecords&&ga(a,a,"sZeroRecords","sLoadingRecords");a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&bb(a)}function n(a){aa(a,"ordering","bSort");aa(a,"orderMulti","bSortMulti");
aa(a,"orderClasses","bSortClasses");aa(a,"orderCellsTop","bSortCellsTop");aa(a,"order","aaSorting");aa(a,"orderFixed","aaSortingFixed");aa(a,"paging","bPaginate");aa(a,"pagingType","sPaginationType");aa(a,"pageLength","iDisplayLength");aa(a,"searching","bFilter");if(a=a.aoSearchCols)for(var b=0,c=a.length;b<c;b++)a[b]&&e(B.models.oSearch,a[b])}function f(a){aa(a,"orderable","bSortable");aa(a,"orderData","aDataSort");aa(a,"orderSequence","asSorting");aa(a,"orderDataType","sortDataType")}function t(a){a=
a.oBrowser;var b=d("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(d("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(d('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body"),c=b.find(".test");a.bScrollOversize=100===c[0].offsetWidth;a.bScrollbarLeft=1!==c.offset().left;b.remove()}function p(b,c,d,e,l,h){var f,m=!1;d!==a&&(f=d,m=!0);for(;e!==l;)b.hasOwnProperty(e)&&(f=m?c(f,b[e],e,b):b[e],m=!0,e+=h);return f}
function m(a,b){var c=B.defaults.column,e=a.aoColumns.length,c=d.extend({},B.models.oColumn,c,{nTh:b?b:k.createElement("th"),sTitle:c.sTitle?c.sTitle:b?b.innerHTML:"",aDataSort:c.aDataSort?c.aDataSort:[e],mData:c.mData?c.mData:e,idx:e});a.aoColumns.push(c);c=a.aoPreSearchCols;c[e]=d.extend({},B.models.oSearch,c[e]);r(a,e,null)}function r(b,c,l){c=b.aoColumns[c];var h=b.oClasses,m=d(c.nTh);if(!c.sWidthOrig){c.sWidthOrig=m.attr("width")||null;var g=(m.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);
g&&(c.sWidthOrig=g[1])}l!==a&&null!==l&&(f(l),e(B.defaults.column,l),l.mDataProp===a||l.mData||(l.mData=l.mDataProp),l.sType&&(c._sManualType=l.sType),l.className&&!l.sClass&&(l.sClass=l.className),d.extend(c,l),ga(c,l,"sWidth","sWidthOrig"),"number"===typeof l.iDataSort&&(c.aDataSort=[l.iDataSort]),ga(c,l,"aDataSort"));var n=c.mData,u=F(n),k=c.mRender?F(c.mRender):null;l=function(a){return"string"===typeof a&&-1!==a.indexOf("@")};c._bAttrSrc=d.isPlainObject(n)&&(l(n.sort)||l(n.type)||l(n.filter));
c.fnGetData=function(b,c,L){var d=u(b,c,a,L);return k&&c?k(d,c,b,L):d};c.fnSetData=function(a,b,c){return K(n)(a,b,c)};"number"!==typeof n&&(b._rowReadObject=!0);b.oFeatures.bSort||(c.bSortable=!1,m.addClass(h.sSortableNone));b=-1!==d.inArray("asc",c.asSorting);l=-1!==d.inArray("desc",c.asSorting);c.bSortable&&(b||l)?b&&!l?(c.sSortingClass=h.sSortableAsc,c.sSortingClassJUI=h.sSortJUIAscAllowed):!b&&l?(c.sSortingClass=h.sSortableDesc,c.sSortingClassJUI=h.sSortJUIDescAllowed):(c.sSortingClass=h.sSortable,
c.sSortingClassJUI=h.sSortJUI):(c.sSortingClass=h.sSortableNone,c.sSortingClassJUI="")}function c(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Ka(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;""===b.sY&&""===b.sX||sa(a);R(a,null,"column-sizing",[a])}function q(a,b){var c=D(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function w(a,b){var c=D(a,"bVisible"),c=d.inArray(b,c);return-1!==c?c:null}function v(a){return D(a,"bVisible").length}function D(a,b){var c=
[];d.map(a.aoColumns,function(a,L){a[b]&&c.push(L)});return c}function H(b){var c=b.aoColumns,d=b.aoData,l=B.ext.type.detect,e,h,f,m,g,n,u,k,q;e=0;for(h=c.length;e<h;e++)if(u=c[e],q=[],!u.sType&&u._sManualType)u.sType=u._sManualType;else if(!u.sType){f=0;for(m=l.length;f<m;f++){g=0;for(n=d.length;g<n;g++){q[g]===a&&(q[g]=C(b,g,e,"type"));k=l[f](q[g],b);if(!k&&f!==l.length-1)break;if("html"===k)break}if(k){u.sType=k;break}}u.sType||(u.sType="string")}}function I(b,c,l,e){var h,f,g,n,u,k,q=b.aoColumns;
if(c)for(h=c.length-1;0<=h;h--){k=c[h];var x=k.targets!==a?k.targets:k.aTargets;d.isArray(x)||(x=[x]);f=0;for(g=x.length;f<g;f++)if("number"===typeof x[f]&&0<=x[f]){for(;q.length<=x[f];)m(b);e(x[f],k)}else if("number"===typeof x[f]&&0>x[f])e(q.length+x[f],k);else if("string"===typeof x[f])for(n=0,u=q.length;n<u;n++)("_all"==x[f]||d(q[n].nTh).hasClass(x[f]))&&e(n,k)}if(l)for(h=0,b=l.length;h<b;h++)e(h,l[h])}function A(a,b,c,l){var e=a.aoData.length,h=d.extend(!0,{},B.models.oRow,{src:c?"dom":"data"});
h._aData=b;a.aoData.push(h);b=a.aoColumns;for(var h=0,f=b.length;h<f;h++)c&&z(a,e,h,C(a,e,h)),b[h].sType=null;a.aiDisplayMaster.push(e);!c&&a.oFeatures.bDeferRender||S(a,e,c,l);return e}function G(a,b){var c;b instanceof d||(b=d(b));return b.map(function(b,d){c=Q(a,d);return A(a,c.data,d,c.cells)})}function C(b,c,d,l){var e=b.iDraw,h=b.aoColumns[d],f=b.aoData[c]._aData,m=h.sDefaultContent;d=h.fnGetData(f,l,{settings:b,row:c,col:d});if(d===a)return b.iDrawError!=e&&null===m&&(ma(b,0,"Requested unknown parameter "+
("function"==typeof h.mData?"{function}":"'"+h.mData+"'")+" for row "+c,4),b.iDrawError=e),m;if((d===f||null===d)&&null!==m)d=m;else if("function"===typeof d)return d.call(f);return null===d&&"display"==l?"":d}function z(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d,{settings:a,row:b,col:c})}function E(a){return d.map(a.match(/(\\.|[^\.])+/g),function(a){return a.replace(/\\./g,".")})}function F(b){if(d.isPlainObject(b)){var c={};d.each(b,function(a,b){b&&(c[a]=F(b))});return function(b,
d,L,l){var e=c[d]||c._;return e!==a?e(b,d,L,l):b}}if(null===b)return function(a){return a};if("function"===typeof b)return function(a,c,d,l){return b(a,c,d,l)};if("string"!==typeof b||-1===b.indexOf(".")&&-1===b.indexOf("[")&&-1===b.indexOf("("))return function(a,c){return a[b]};var l=function(b,c,d){var L,e;if(""!==d){e=E(d);for(var h=0,f=e.length;h<f;h++){d=e[h].match(ta);L=e[h].match(na);if(d){e[h]=e[h].replace(ta,"");""!==e[h]&&(b=b[e[h]]);L=[];e.splice(0,h+1);e=e.join(".");h=0;for(f=b.length;h<
f;h++)L.push(l(b[h],c,e));b=d[0].substring(1,d[0].length-1);b=""===b?L:L.join(b);break}else if(L){e[h]=e[h].replace(na,"");b=b[e[h]]();continue}if(null===b||b[e[h]]===a)return a;b=b[e[h]]}}return b};return function(a,c){return l(a,c,b)}}function K(b){if(d.isPlainObject(b))return K(b._);if(null===b)return function(){};if("function"===typeof b)return function(a,c,d){b(a,"set",c,d)};if("string"!==typeof b||-1===b.indexOf(".")&&-1===b.indexOf("[")&&-1===b.indexOf("("))return function(a,c){a[b]=c};var c=
function(b,d,L){L=E(L);var e;e=L[L.length-1];for(var l,h,f=0,m=L.length-1;f<m;f++){l=L[f].match(ta);h=L[f].match(na);if(l){L[f]=L[f].replace(ta,"");b[L[f]]=[];e=L.slice();e.splice(0,f+1);l=e.join(".");h=0;for(m=d.length;h<m;h++)e={},c(e,d[h],l),b[L[f]].push(e);return}h&&(L[f]=L[f].replace(na,""),b=b[L[f]](d));if(null===b[L[f]]||b[L[f]]===a)b[L[f]]={};b=b[L[f]]}if(e.match(na))b[e.replace(na,"")](d);else b[e.replace(ta,"")]=d};return function(a,d){return c(a,d,b)}}function l(a){return fa(a.aoData,"_aData")}
function u(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0}function x(b,c,d){for(var e=-1,l=0,h=b.length;l<h;l++)b[l]==c?e=l:b[l]>c&&b[l]--; -1!=e&&d===a&&b.splice(e,1)}function y(b,c,d,e){var l=b.aoData[c],h,f=function(a,d){for(;a.childNodes.length;)a.removeChild(a.firstChild);a.innerHTML=C(b,c,d,"display")};if("dom"!==d&&(d&&"auto"!==d||"dom"!==l.src)){var m=l.anCells;if(m)if(e!==a)f(m[e],e);else for(d=0,h=m.length;d<h;d++)f(m[d],d)}else l._aData=Q(b,l,e,e===a?a:l._aData).data;
l._aSortData=null;l._aFilterData=null;f=b.aoColumns;if(e!==a)f[e].sType=null;else{d=0;for(h=f.length;d<h;d++)f[d].sType=null;T(l)}}function Q(b,c,e,l){var h=[],f=c.firstChild,m,g=0,n,u=b.aoColumns,k=b._rowReadObject;l=l||k?{}:[];var q=function(a,b){if("string"===typeof a){var c=a.indexOf("@");-1!==c&&(c=a.substring(c+1),K(a)(l,b.getAttribute(c)))}};b=function(b){if(e===a||e===g)m=u[g],n=d.trim(b.innerHTML),m&&m._bAttrSrc?(K(m.mData._)(l,n),q(m.mData.sort,b),q(m.mData.type,b),q(m.mData.filter,b)):
k?(m._setter||(m._setter=K(m.mData)),m._setter(l,n)):l[g]=n;g++};if(f)for(;f;){c=f.nodeName.toUpperCase();if("TD"==c||"TH"==c)b(f),h.push(f);f=f.nextSibling}else for(h=c.anCells,f=0,c=h.length;f<c;f++)b(h[f]);return{data:l,cells:h}}function S(a,b,c,d){var e=a.aoData[b],l=e._aData,h=[],f,m,g,n,u;if(null===e.nTr){f=c||k.createElement("tr");e.nTr=f;e.anCells=h;f._DT_RowIndex=b;T(e);n=0;for(u=a.aoColumns.length;n<u;n++){g=a.aoColumns[n];m=c?d[n]:k.createElement(g.sCellType);h.push(m);if(!c||g.mRender||
g.mData!==n)m.innerHTML=C(a,b,n,"display");g.sClass&&(m.className+=" "+g.sClass);g.bVisible&&!c?f.appendChild(m):!g.bVisible&&c&&m.parentNode.removeChild(m);g.fnCreatedCell&&g.fnCreatedCell.call(a.oInstance,m,C(a,b,n),l,b,n)}R(a,"aoRowCreatedCallback",null,[f,l,b])}e.nTr.setAttribute("role","row")}function T(a){var b=a.nTr,c=a._aData;if(b){c.DT_RowId&&(b.id=c.DT_RowId);if(c.DT_RowClass){var e=c.DT_RowClass.split(" ");a.__rowc=a.__rowc?La(a.__rowc.concat(e)):e;d(b).removeClass(a.__rowc.join(" ")).addClass(c.DT_RowClass)}c.DT_RowData&&
d(b).data(c.DT_RowData)}}function Z(a){var b,c,e,l,h,f=a.nTHead,m=a.nTFoot,g=0===d("th, td",f).length,n=a.oClasses,u=a.aoColumns;g&&(l=d("<tr/>").appendTo(f));b=0;for(c=u.length;b<c;b++)h=u[b],e=d(h.nTh).addClass(h.sClass),g&&e.appendTo(l),a.oFeatures.bSort&&(e.addClass(h.sSortingClass),!1!==h.bSortable&&(e.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Ma(a,h.nTh,b))),h.sTitle!=e.html()&&e.html(h.sTitle),Na(a,"header")(a,e,h,n);g&&da(a.aoHeader,f);d(f).find(">tr").attr("role","row");
d(f).find(">tr>th, >tr>td").addClass(n.sHeaderTH);d(m).find(">tr>th, >tr>td").addClass(n.sFooterTH);if(null!==m)for(a=a.aoFooter[0],b=0,c=a.length;b<c;b++)h=u[b],h.nTf=a[b].cell,h.sClass&&d(h.nTf).addClass(h.sClass)}function V(b,c,e){var l,h,f,m=[],g=[],n=b.aoColumns.length,u;if(c){e===a&&(e=!1);l=0;for(h=c.length;l<h;l++){m[l]=c[l].slice();m[l].nTr=c[l].nTr;for(f=n-1;0<=f;f--)b.aoColumns[f].bVisible||e||m[l].splice(f,1);g.push([])}l=0;for(h=m.length;l<h;l++){if(b=m[l].nTr)for(;f=b.firstChild;)b.removeChild(f);
f=0;for(c=m[l].length;f<c;f++)if(u=n=1,g[l][f]===a){b.appendChild(m[l][f].cell);for(g[l][f]=1;m[l+n]!==a&&m[l][f].cell==m[l+n][f].cell;)g[l+n][f]=1,n++;for(;m[l][f+u]!==a&&m[l][f].cell==m[l][f+u].cell;){for(e=0;e<n;e++)g[l+e][f+u]=1;u++}d(m[l][f].cell).attr("rowspan",n).attr("colspan",u)}}}}function N(b){var c=R(b,"aoPreDrawCallback","preDraw",[b]);if(-1!==d.inArray(!1,c))ea(b,!1);else{var c=[],e=0,h=b.asStripeClasses,f=h.length,m=b.oLanguage,g=b.iInitDisplayStart,n="ssp"==ba(b),u=b.aiDisplay;b.bDrawing=
!0;g!==a&&-1!==g&&(b._iDisplayStart=n?g:g>=b.fnRecordsDisplay()?0:g,b.iInitDisplayStart=-1);var g=b._iDisplayStart,k=b.fnDisplayEnd();if(b.bDeferLoading)b.bDeferLoading=!1,b.iDraw++,ea(b,!1);else if(!n)b.iDraw++;else if(!b.bDestroying&&!oa(b))return;if(0!==u.length)for(m=n?b.aoData.length:k,n=n?0:g;n<m;n++){var q=u[n],x=b.aoData[q];null===x.nTr&&S(b,q);q=x.nTr;if(0!==f){var y=h[e%f];x._sRowStripe!=y&&(d(q).removeClass(x._sRowStripe).addClass(y),x._sRowStripe=y)}R(b,"aoRowCallback",null,[q,x._aData,
e,n]);c.push(q);e++}else e=m.sZeroRecords,1==b.iDraw&&"ajax"==ba(b)?e=m.sLoadingRecords:m.sEmptyTable&&0===b.fnRecordsTotal()&&(e=m.sEmptyTable),c[0]=d("<tr/>",{"class":f?h[0]:""}).append(d("<td />",{valign:"top",colSpan:v(b),"class":b.oClasses.sRowEmpty}).html(e))[0];R(b,"aoHeaderCallback","header",[d(b.nTHead).children("tr")[0],l(b),g,k,u]);R(b,"aoFooterCallback","footer",[d(b.nTFoot).children("tr")[0],l(b),g,k,u]);h=d(b.nTBody);h.children().detach();h.append(d(c));R(b,"aoDrawCallback","draw",[b]);
b.bSorted=!1;b.bFiltered=!1;b.bDrawing=!1}}function X(a,b){var c=a.oFeatures,d=c.bFilter;c.bSort&&cb(a);d?la(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;N(a);a._drawHold=!1}function ca(a){var b=a.oClasses,c=d(a.nTable),c=d("<div/>").insertBefore(c),e=a.oFeatures,l=d("<div/>",{id:a.sTableId+"_wrapper","class":b.sWrapper+(a.nTFoot?"":" "+b.sNoFooter)});a.nHolding=c[0];a.nTableWrapper=l[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var h=
a.sDom.split(""),f,m,g,n,u,k,q=0;q<h.length;q++){f=null;m=h[q];if("<"==m){g=d("<div/>")[0];n=h[q+1];if("'"==n||'"'==n){u="";for(k=2;h[q+k]!=n;)u+=h[q+k],k++;"H"==u?u=b.sJUIHeader:"F"==u&&(u=b.sJUIFooter);-1!=u.indexOf(".")?(n=u.split("."),g.id=n[0].substr(1,n[0].length-1),g.className=n[1]):"#"==u.charAt(0)?g.id=u.substr(1,u.length-1):g.className=u;q+=k}l.append(g);l=d(g)}else if(">"==m)l=l.parent();else if("l"==m&&e.bPaginate&&e.bLengthChange)f=db(a);else if("f"==m&&e.bFilter)f=wa(a);else if("r"==
m&&e.bProcessing)f=eb(a);else if("t"==m)f=fb(a);else if("i"==m&&e.bInfo)f=gb(a);else if("p"==m&&e.bPaginate)f=hb(a);else if(0!==B.ext.feature.length)for(g=B.ext.feature,k=0,n=g.length;k<n;k++)if(m==g[k].cFeature){f=g[k].fnInit(a);break}f&&(g=a.aanFeatures,g[m]||(g[m]=[]),g[m].push(f),l.append(f))}c.replaceWith(l)}function da(a,b){var c=d(b).children("tr"),e,l,h,f,m,g,n,u,k,q;a.splice(0,a.length);h=0;for(g=c.length;h<g;h++)a.push([]);h=0;for(g=c.length;h<g;h++)for(e=c[h],l=e.firstChild;l;){if("TD"==
l.nodeName.toUpperCase()||"TH"==l.nodeName.toUpperCase()){u=1*l.getAttribute("colspan");k=1*l.getAttribute("rowspan");u=u&&0!==u&&1!==u?u:1;k=k&&0!==k&&1!==k?k:1;f=0;for(m=a[h];m[f];)f++;n=f;q=1===u?!0:!1;for(m=0;m<u;m++)for(f=0;f<k;f++)a[h+f][n+m]={cell:l,unique:q},a[h+f].nTr=e}l=l.nextSibling}}function ja(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],da(c,b)));b=0;for(var e=c.length;b<e;b++)for(var l=0,h=c[b].length;l<h;l++)!c[b][l].unique||d[l]&&a.bSortCellsTop||(d[l]=c[b][l].cell);return d}function ka(a,
b,c){R(a,"aoServerParams","serverParams",[b]);if(b&&d.isArray(b)){var l={},e=/(.*?)\[\]$/;d.each(b,function(a,b){var c=b.name.match(e);c?(c=c[0],l[c]||(l[c]=[]),l[c].push(b.value)):l[b.name]=b.value});b=l}var h,f=a.ajax,m=a.oInstance;if(d.isPlainObject(f)&&f.data){h=f.data;var g=d.isFunction(h)?h(b):h;b=d.isFunction(h)&&g?g:d.extend(!0,b,g);delete f.data}g={data:b,success:function(b){var d=b.error||b.sError;d&&a.oApi._fnLog(a,0,d);a.json=b;R(a,null,"xhr",[a,b]);c(b)},dataType:"json",cache:!1,type:a.sServerMethod,
error:function(b,c,d){d=a.oApi._fnLog;"parsererror"==c?d(a,0,"Invalid JSON response",1):4===b.readyState&&d(a,0,"Ajax error",7);ea(a,!1)}};a.oAjaxData=b;R(a,null,"preXhr",[a,b]);a.fnServerData?a.fnServerData.call(m,a.sAjaxSource,d.map(b,function(a,b){return{name:b,value:a}}),c,a):a.sAjaxSource||"string"===typeof f?a.jqXHR=d.ajax(d.extend(g,{url:f||a.sAjaxSource})):d.isFunction(f)?a.jqXHR=f.call(m,b,c,a):(a.jqXHR=d.ajax(d.extend(g,f)),f.data=h)}function oa(a){return a.bAjaxDataGet?(a.iDraw++,ea(a,
!0),ka(a,xa(a),function(b){ya(a,b)}),!1):!0}function xa(a){var b=a.aoColumns,c=b.length,l=a.oFeatures,e=a.oPreviousSearch,h=a.aoPreSearchCols,f,m=[],g,n,u,k=pa(a);f=a._iDisplayStart;g=!1!==l.bPaginate?a._iDisplayLength:-1;var q=function(a,b){m.push({name:a,value:b})};q("sEcho",a.iDraw);q("iColumns",c);q("sColumns",fa(b,"sName").join(","));q("iDisplayStart",f);q("iDisplayLength",g);var x={draw:a.iDraw,columns:[],order:[],start:f,length:g,search:{value:e.sSearch,regex:e.bRegex}};for(f=0;f<c;f++)n=b[f],
u=h[f],g="function"==typeof n.mData?"function":n.mData,x.columns.push({data:g,name:n.sName,searchable:n.bSearchable,orderable:n.bSortable,search:{value:u.sSearch,regex:u.bRegex}}),q("mDataProp_"+f,g),l.bFilter&&(q("sSearch_"+f,u.sSearch),q("bRegex_"+f,u.bRegex),q("bSearchable_"+f,n.bSearchable)),l.bSort&&q("bSortable_"+f,n.bSortable);l.bFilter&&(q("sSearch",e.sSearch),q("bRegex",e.bRegex));l.bSort&&(d.each(k,function(a,b){x.order.push({column:b.col,dir:b.dir});q("iSortCol_"+a,b.col);q("sSortDir_"+
a,b.dir)}),q("iSortingCols",k.length));b=B.ext.legacy.ajax;return null===b?a.sAjaxSource?m:x:b?m:x}function ya(b,c){var d=function(b,d){return c[b]!==a?c[b]:c[d]},l=d("sEcho","draw"),e=d("iTotalRecords","recordsTotal"),d=d("iTotalDisplayRecords","recordsFiltered");if(l){if(1*l<b.iDraw)return;b.iDraw=1*l}u(b);b._iRecordsTotal=parseInt(e,10);b._iRecordsDisplay=parseInt(d,10);l=qa(b,c);e=0;for(d=l.length;e<d;e++)A(b,l[e]);b.aiDisplay=b.aiDisplayMaster.slice();b.bAjaxDataGet=!1;N(b);b._bInitComplete||
za(b,c);b.bAjaxDataGet=!0;ea(b,!1)}function qa(b,c){var l=d.isPlainObject(b.ajax)&&b.ajax.dataSrc!==a?b.ajax.dataSrc:b.sAjaxDataProp;return"data"===l?c.aaData||c[l]:""!==l?F(l)(c):c}function wa(a){var b=a.oClasses,c=a.sTableId,l=a.oLanguage,e=a.oPreviousSearch,h=a.aanFeatures,f='<input type="search" class="'+b.sFilterInput+'"/>',m=l.sSearch,m=m.match(/_INPUT_/)?m.replace("_INPUT_",f):m+f,b=d("<div/>",{id:h.f?null:c+"_filter","class":b.sFilter}).append(d("<label/>").append(m)),h=function(){var b=this.value?
this.value:"";b!=e.sSearch&&(la(a,{sSearch:b,bRegex:e.bRegex,bSmart:e.bSmart,bCaseInsensitive:e.bCaseInsensitive}),a._iDisplayStart=0,N(a))},f=null!==a.searchDelay?a.searchDelay:"ssp"===ba(a)?400:0,g=d("input",b).val(e.sSearch).attr("placeholder",l.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",f?Aa(h,f):h).bind("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",c);d(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{g[0]!==k.activeElement&&g.val(e.sSearch)}catch(d){}});
return b[0]}function la(b,c,d){var l=b.oPreviousSearch,e=b.aoPreSearchCols,h=function(a){l.sSearch=a.sSearch;l.bRegex=a.bRegex;l.bSmart=a.bSmart;l.bCaseInsensitive=a.bCaseInsensitive},f=function(b){return b.bEscapeRegex!==a?!b.bEscapeRegex:b.bRegex};H(b);if("ssp"!=ba(b)){ib(b,c.sSearch,d,f(c),c.bSmart,c.bCaseInsensitive);h(c);for(c=0;c<e.length;c++)jb(b,e[c].sSearch,c,f(e[c]),e[c].bSmart,e[c].bCaseInsensitive);Ba(b)}else h(c);b.bFiltered=!0;R(b,null,"search",[b])}function Ba(a){for(var b=B.ext.search,
c=a.aiDisplay,d,l,e=0,h=b.length;e<h;e++){for(var f=[],m=0,g=c.length;m<g;m++)l=c[m],d=a.aoData[l],b[e](a,d._aFilterData,l,d._aData,m)&&f.push(l);c.length=0;c.push.apply(c,f)}}function jb(a,b,c,d,l,e){if(""!==b){var h=a.aiDisplay;d=Oa(b,d,l,e);for(l=h.length-1;0<=l;l--)b=a.aoData[h[l]]._aFilterData[c],d.test(b)||h.splice(l,1)}}function ib(a,b,c,d,l,e){d=Oa(b,d,l,e);l=a.oPreviousSearch.sSearch;e=a.aiDisplayMaster;var h;0!==B.ext.search.length&&(c=!0);h=kb(a);if(0>=b.length)a.aiDisplay=e.slice();else{if(h||
c||l.length>b.length||0!==b.indexOf(l)||a.bSorted)a.aiDisplay=e.slice();b=a.aiDisplay;for(c=b.length-1;0<=c;c--)d.test(a.aoData[b[c]]._sFilterRow)||b.splice(c,1)}}function Oa(a,b,c,l){a=b?a:Ca(a);c&&(a="^(?=.*?"+d.map(a.match(/"[^"]+"|[^ ]+/g)||"",function(a){if('"'===a.charAt(0)){var b=a.match(/^"(.*)"$/);a=b?b[1]:a}return a.replace('"',"")}).join(")(?=.*?")+").*$");return new RegExp(a,l?"i":"")}function Ca(a){return a.replace(Jb,"\\$1")}function kb(a){var b=a.aoColumns,c,d,l,e,h,f,m,g,n=B.ext.type.search;
c=!1;d=0;for(e=a.aoData.length;d<e;d++)if(g=a.aoData[d],!g._aFilterData){f=[];l=0;for(h=b.length;l<h;l++)c=b[l],c.bSearchable?(m=C(a,d,l,"filter"),n[c.sType]&&(m=n[c.sType](m)),null===m&&(m=""),"string"!==typeof m&&m.toString&&(m=m.toString())):m="",m.indexOf&&-1!==m.indexOf("&")&&(Da.innerHTML=m,m=Kb?Da.textContent:Da.innerText),m.replace&&(m=m.replace(/[\r\n]/g,"")),f.push(m);g._aFilterData=f;g._sFilterRow=f.join("  ");c=!0}return c}function lb(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,
caseInsensitive:a.bCaseInsensitive}}function mb(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function gb(a){var b=a.sTableId,c=a.aanFeatures.i,l=d("<div/>",{"class":a.oClasses.sInfo,id:c?null:b+"_info"});c||(a.aoDrawCallback.push({fn:nb,sName:"information"}),l.attr("role","status").attr("aria-live","polite"),d(a.nTable).attr("aria-describedby",b+"_info"));return l[0]}function nb(a){var b=a.aanFeatures.i;if(0!==b.length){var c=a.oLanguage,l=a._iDisplayStart+
1,e=a.fnDisplayEnd(),h=a.fnRecordsTotal(),f=a.fnRecordsDisplay(),m=f?c.sInfo:c.sInfoEmpty;f!==h&&(m+=" "+c.sInfoFiltered);m+=c.sInfoPostFix;m=ob(a,m);c=c.fnInfoCallback;null!==c&&(m=c.call(a.oInstance,a,l,e,h,f,m));d(b).html(m)}}function ob(a,b){var c=a.fnFormatNumber,l=a._iDisplayStart+1,d=a._iDisplayLength,e=a.fnRecordsDisplay(),h=-1===d;return b.replace(/_START_/g,c.call(a,l)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,
e)).replace(/_PAGE_/g,c.call(a,h?1:Math.ceil(l/d))).replace(/_PAGES_/g,c.call(a,h?1:Math.ceil(e/d)))}function ua(a){var b,c,l=a.iInitDisplayStart,d=a.aoColumns,e;c=a.oFeatures;if(a.bInitialised){ca(a);Z(a);V(a,a.aoHeader);V(a,a.aoFooter);ea(a,!0);c.bAutoWidth&&Ka(a);b=0;for(c=d.length;b<c;b++)e=d[b],e.sWidth&&(e.nTh.style.width=M(e.sWidth));X(a);d=ba(a);"ssp"!=d&&("ajax"==d?ka(a,[],function(c){var d=qa(a,c);for(b=0;b<d.length;b++)A(a,d[b]);a.iInitDisplayStart=l;X(a);ea(a,!1);za(a,c)},a):(ea(a,!1),
za(a)))}else setTimeout(function(){ua(a)},200)}function za(a,b){a._bInitComplete=!0;b&&c(a);R(a,"aoInitComplete","init",[a,b])}function Pa(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Qa(a);R(a,null,"length",[a,c])}function db(a){for(var b=a.oClasses,c=a.sTableId,l=a.aLengthMenu,e=d.isArray(l[0]),h=e?l[0]:l,l=e?l[1]:l,e=d("<select/>",{name:c+"_length","aria-controls":c,"class":b.sLengthSelect}),f=0,m=h.length;f<m;f++)e[0][f]=new Option(l[f],h[f]);var g=d("<div><label/></div>").addClass(b.sLength);
a.aanFeatures.l||(g[0].id=c+"_length");g.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",e[0].outerHTML));d("select",g).val(a._iDisplayLength).bind("change.DT",function(b){Pa(a,d(this).val());N(a)});d(a.nTable).bind("length.dt.DT",function(b,c,l){a===c&&d("select",g).val(l)});return g[0]}function hb(a){var b=a.sPaginationType,c=B.ext.pager[b],l="function"===typeof c,e=function(a){N(a)},b=d("<div/>").addClass(a.oClasses.sPaging+b)[0],h=a.aanFeatures;l||c.fnInit(a,b,e);h.p||(b.id=a.sTableId+
"_paginate",a.aoDrawCallback.push({fn:function(a){if(l){var b=a._iDisplayStart,d=a._iDisplayLength,f=a.fnRecordsDisplay(),m=-1===d,b=m?0:Math.ceil(b/d),d=m?1:Math.ceil(f/d),f=c(b,d),g,m=0;for(g=h.p.length;m<g;m++)Na(a,"pageButton")(a,h.p[m],m,f,b,d)}else c.fnUpdate(a,e)},sName:"pagination"}));return b}function Ra(a,b,c){var l=a._iDisplayStart,d=a._iDisplayLength,e=a.fnRecordsDisplay();0===e||-1===d?l=0:"number"===typeof b?(l=b*d,l>e&&(l=0)):"first"==b?l=0:"previous"==b?(l=0<=d?l-d:0,0>l&&(l=0)):"next"==
b?l+d<e&&(l+=d):"last"==b?l=Math.floor((e-1)/d)*d:ma(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==l;a._iDisplayStart=l;b&&(R(a,null,"page",[a]),c&&N(a));return b}function eb(a){return d("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function ea(a,b){a.oFeatures.bProcessing&&d(a.aanFeatures.r).css("display",b?"block":"none");R(a,null,"processing",[a,b])}function fb(a){var b=d(a.nTable);b.attr("role",
"grid");var c=a.oScroll;if(""===c.sX&&""===c.sY)return a.nTable;var l=c.sX,e=c.sY,h=a.oClasses,f=b.children("caption"),m=f.length?f[0]._captionSide:null,g=d(b[0].cloneNode(!1)),n=d(b[0].cloneNode(!1)),u=b.children("tfoot");c.sX&&"100%"===b.attr("width")&&b.removeAttr("width");u.length||(u=null);c=d("<div/>",{"class":h.sScrollWrapper}).append(d("<div/>",{"class":h.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:l?l?M(l):null:"100%"}).append(d("<div/>",{"class":h.sScrollHeadInner}).css({"box-sizing":"content-box",
width:c.sXInner||"100%"}).append(g.removeAttr("id").css("margin-left",0).append("top"===m?f:null).append(b.children("thead"))))).append(d("<div/>",{"class":h.sScrollBody}).css({overflow:"auto",height:e?M(e):null,width:l?M(l):null}).append(b));u&&c.append(d("<div/>",{"class":h.sScrollFoot}).css({overflow:"hidden",border:0,width:l?l?M(l):null:"100%"}).append(d("<div/>",{"class":h.sScrollFootInner}).append(n.removeAttr("id").css("margin-left",0).append("bottom"===m?f:null).append(b.children("tfoot")))));
var b=c.children(),k=b[0],h=b[1],q=u?b[2]:null;l&&d(h).scroll(function(a){a=this.scrollLeft;k.scrollLeft=a;u&&(q.scrollLeft=a)});a.nScrollHead=k;a.nScrollBody=h;a.nScrollFoot=q;a.aoDrawCallback.push({fn:sa,sName:"scrolling"});return c[0]}function sa(a){var b=a.oScroll,c=b.sX,l=b.sXInner,e=b.sY,h=b.iBarWidth,f=d(a.nScrollHead),m=f[0].style,g=f.children("div"),n=g[0].style,u=g.children("table"),g=a.nScrollBody,k=d(g),x=g.style,y=d(a.nScrollFoot).children("div"),r=y.children("table"),w=d(a.nTHead),t=
d(a.nTable),E=t[0],Q=E.style,p=a.nTFoot?d(a.nTFoot):null,z=a.oBrowser,T=z.bScrollOversize,S,v,H,F,D,I=[],A=[],K=[],Z,N=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};t.children("thead, tfoot").remove();D=w.clone().prependTo(t);S=w.find("tr");H=D.find("tr");D.find("th, td").removeAttr("tabindex");p&&(F=p.clone().prependTo(t),v=p.find("tr"),F=F.find("tr"));c||(x.width="100%",f[0].style.width="100%");d.each(ja(a,D),function(b,c){Z=
q(a,b);c.style.width=a.aoColumns[Z].sWidth});p&&ha(function(a){a.style.width=""},F);b.bCollapse&&""!==e&&(x.height=k[0].offsetHeight+w[0].offsetHeight+"px");f=t.outerWidth();""===c?(Q.width="100%",T&&(t.find("tbody").height()>g.offsetHeight||"scroll"==k.css("overflow-y"))&&(Q.width=M(t.outerWidth()-h))):""!==l?Q.width=M(l):f==k.width()&&k.height()<t.height()?(Q.width=M(f-h),t.outerWidth()>f-h&&(Q.width=M(f))):Q.width=M(f);f=t.outerWidth();ha(N,H);ha(function(a){K.push(a.innerHTML);I.push(M(d(a).css("width")))},
H);ha(function(a,b){a.style.width=I[b]},S);d(H).height(0);p&&(ha(N,F),ha(function(a){A.push(M(d(a).css("width")))},F),ha(function(a,b){a.style.width=A[b]},v),d(F).height(0));ha(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+K[b]+"</div>";a.style.width=I[b]},H);p&&ha(function(a,b){a.innerHTML="";a.style.width=A[b]},F);t.outerWidth()<f?(v=g.scrollHeight>g.offsetHeight||"scroll"==k.css("overflow-y")?f+h:f,T&&(g.scrollHeight>g.offsetHeight||"scroll"==k.css("overflow-y"))&&
(Q.width=M(v-h)),""!==c&&""===l||ma(a,1,"Possible column misalignment",6)):v="100%";x.width=M(v);m.width=M(v);p&&(a.nScrollFoot.style.width=M(v));!e&&T&&(x.height=M(E.offsetHeight+h));e&&b.bCollapse&&(x.height=M(e),b=c&&E.offsetWidth>g.offsetWidth?h:0,E.offsetHeight<g.offsetHeight&&(x.height=M(E.offsetHeight+b)));b=t.outerWidth();u[0].style.width=M(b);n.width=M(b);u=t.height()>g.clientHeight||"scroll"==k.css("overflow-y");z="padding"+(z.bScrollbarLeft?"Left":"Right");n[z]=u?h+"px":"0px";p&&(r[0].style.width=
M(b),y[0].style.width=M(b),y[0].style[z]=u?h+"px":"0px");k.scroll();!a.bSorted&&!a.bFiltered||a._drawHold||(g.scrollTop=0)}function ha(a,b,c){for(var l=0,d=0,e=b.length,h,f;d<e;){h=b[d].firstChild;for(f=c?c[d].firstChild:null;h;)1===h.nodeType&&(c?a(h,f,l):a(h,l),l++),h=h.nextSibling,f=c?f.nextSibling:null;d++}}function Ka(a){var b=a.nTable,l=a.aoColumns,e=a.oScroll,h=e.sY,f=e.sX,m=e.sXInner,n=l.length,e=D(a,"bVisible"),u=d("th",a.nTHead),k=b.getAttribute("width"),q=b.parentNode,x=!1,y,r;for(y=0;y<
e.length;y++)r=l[e[y]],null!==r.sWidth&&(r.sWidth=pb(r.sWidthOrig,q),x=!0);if(x||f||h||n!=v(a)||n!=u.length){n=d(b).clone().empty().css("visibility","hidden").removeAttr("id").append(d(a.nTHead).clone(!1)).append(d(a.nTFoot).clone(!1)).append(d("<tbody><tr/></tbody>"));n.find("tfoot th, tfoot td").css("width","");var w=n.find("tbody tr"),u=ja(a,n.find("thead")[0]);for(y=0;y<e.length;y++)r=l[e[y]],u[y].style.width=null!==r.sWidthOrig&&""!==r.sWidthOrig?M(r.sWidthOrig):"";if(a.aoData.length)for(y=0;y<
e.length;y++)x=e[y],r=l[x],d(qb(a,x)).clone(!1).append(r.sContentPadding).appendTo(w);n.appendTo(q);f&&m?n.width(m):f?(n.css("width","auto"),n.width()<q.offsetWidth&&n.width(q.offsetWidth)):h?n.width(q.offsetWidth):k&&n.width(k);rb(a,n[0]);if(f){for(y=m=0;y<e.length;y++)r=l[e[y]],h=d(u[y]).outerWidth(),m+=null===r.sWidthOrig?h:parseInt(r.sWidth,10)+h-d(u[y]).width();n.width(M(m));b.style.width=M(m)}for(y=0;y<e.length;y++)if(r=l[e[y]],h=d(u[y]).width())r.sWidth=M(h);b.style.width=M(n.css("width"));
n.remove()}else for(y=0;y<n;y++)l[y].sWidth=M(u.eq(y).width());k&&(b.style.width=M(k));!k&&!f||a._reszEvt||(d(g).bind("resize.DT-"+a.sInstance,Aa(function(){c(a)})),a._reszEvt=!0)}function Aa(b,c){var l=c!==a?c:200,d,e;return function(){var c=this,h=+new Date,f=arguments;d&&h<d+l?(clearTimeout(e),e=setTimeout(function(){d=a;b.apply(c,f)},l)):d?(d=h,b.apply(c,f)):d=h}}function pb(a,b){if(!a)return 0;var c=d("<div/>").css("width",M(a)).appendTo(b||k.body),l=c[0].offsetWidth;c.remove();return l}function rb(a,
b){var c=a.oScroll;if(c.sX||c.sY)c=c.sX?0:c.iBarWidth,b.style.width=M(d(b).outerWidth()-c)}function qb(a,b){var c=sb(a,b);if(0>c)return null;var l=a.aoData[c];return l.nTr?l.anCells[b]:d("<td/>").html(C(a,c,b,"display"))[0]}function sb(a,b){for(var c,l=-1,d=-1,e=0,h=a.aoData.length;e<h;e++)c=C(a,e,b,"display")+"",c=c.replace(Lb,""),c.length>l&&(l=c.length,d=e);return d}function M(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function tb(){if(!B.__scrollbarWidth){var a=
d("<p/>").css({width:"100%",height:200,padding:0})[0],b=d("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(a).appendTo("body"),c=a.offsetWidth;b.css("overflow","scroll");a=a.offsetWidth;c===a&&(a=b[0].clientWidth);b.remove();B.__scrollbarWidth=c-a}return B.__scrollbarWidth}function pa(b){var c,l,e=[],h=b.aoColumns,f,m,g,n;c=b.aaSortingFixed;l=d.isPlainObject(c);var u=[];f=function(a){a.length&&!d.isArray(a[0])?u.push(a):
u.push.apply(u,a)};d.isArray(c)&&f(c);l&&c.pre&&f(c.pre);f(b.aaSorting);l&&c.post&&f(c.post);for(b=0;b<u.length;b++)for(n=u[b][0],f=h[n].aDataSort,c=0,l=f.length;c<l;c++)m=f[c],g=h[m].sType||"string",u[b]._idx===a&&(u[b]._idx=d.inArray(u[b][1],h[m].asSorting)),e.push({src:n,col:m,dir:u[b][1],index:u[b]._idx,type:g,formatter:B.ext.type.order[g+"-pre"]});return e}function cb(a){var b,c,l=[],d=B.ext.type.order,e=a.aoData,h=0,f,m=a.aiDisplayMaster,g;H(a);g=pa(a);b=0;for(c=g.length;b<c;b++)f=g[b],f.formatter&&
h++,ub(a,f.col);if("ssp"!=ba(a)&&0!==g.length){b=0;for(c=m.length;b<c;b++)l[m[b]]=b;h===g.length?m.sort(function(a,b){var c,d,h,f,m=g.length,n=e[a]._aSortData,u=e[b]._aSortData;for(h=0;h<m;h++)if(f=g[h],c=n[f.col],d=u[f.col],c=c<d?-1:c>d?1:0,0!==c)return"asc"===f.dir?c:-c;c=l[a];d=l[b];return c<d?-1:c>d?1:0}):m.sort(function(a,b){var c,h,f,m,n=g.length,u=e[a]._aSortData,k=e[b]._aSortData;for(f=0;f<n;f++)if(m=g[f],c=u[m.col],h=k[m.col],m=d[m.type+"-"+m.dir]||d["string-"+m.dir],c=m(c,h),0!==c)return c;
c=l[a];h=l[b];return c<h?-1:c>h?1:0})}a.bSorted=!0}function vb(a){var b,c,l=a.aoColumns,d=pa(a);a=a.oLanguage.oAria;for(var e=0,h=l.length;e<h;e++){c=l[e];var f=c.asSorting;b=c.sTitle.replace(/<.*?>/g,"");var m=c.nTh;m.removeAttribute("aria-sort");c.bSortable&&(0<d.length&&d[0].col==e?(m.setAttribute("aria-sort","asc"==d[0].dir?"ascending":"descending"),c=f[d[0].index+1]||f[0]):c=f[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);m.setAttribute("aria-label",b)}}function Sa(b,c,l,e){var h=b.aaSorting,
f=b.aoColumns[c].asSorting,m=function(b,c){var l=b._idx;l===a&&(l=d.inArray(b[1],f));return l+1<f.length?l+1:c?null:0};"number"===typeof h[0]&&(h=b.aaSorting=[h]);l&&b.oFeatures.bSortMulti?(l=d.inArray(c,fa(h,"0")),-1!==l?(c=m(h[l],!0),null===c?h.splice(l,1):(h[l][1]=f[c],h[l]._idx=c)):(h.push([c,f[0],0]),h[h.length-1]._idx=0)):h.length&&h[0][0]==c?(c=m(h[0]),h.length=1,h[0][1]=f[c],h[0]._idx=c):(h.length=0,h.push([c,f[0]]),h[0]._idx=0);X(b);"function"==typeof e&&e(b)}function Ma(a,b,c,l){var d=a.aoColumns[c];
Ta(b,{},function(b){!1!==d.bSortable&&(a.oFeatures.bProcessing?(ea(a,!0),setTimeout(function(){Sa(a,c,b.shiftKey,l);"ssp"!==ba(a)&&ea(a,!1)},0)):Sa(a,c,b.shiftKey,l))})}function Ea(a){var b=a.aLastSort,c=a.oClasses.sSortColumn,l=pa(a),e=a.oFeatures,h,f;if(e.bSort&&e.bSortClasses){e=0;for(h=b.length;e<h;e++)f=b[e].src,d(fa(a.aoData,"anCells",f)).removeClass(c+(2>e?e+1:3));e=0;for(h=l.length;e<h;e++)f=l[e].src,d(fa(a.aoData,"anCells",f)).addClass(c+(2>e?e+1:3))}a.aLastSort=l}function ub(a,b){var c=
a.aoColumns[b],l=B.ext.order[c.sSortDataType],e;l&&(e=l.call(a.oInstance,a,b,w(a,b)));for(var d,h=B.ext.type.order[c.sType+"-pre"],f=0,m=a.aoData.length;f<m;f++)if(c=a.aoData[f],c._aSortData||(c._aSortData=[]),!c._aSortData[b]||l)d=l?e[f]:C(a,f,b,"sort"),c._aSortData[b]=h?h(d):d}function Fa(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var b={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:d.extend(!0,[],a.aaSorting),search:lb(a.oPreviousSearch),columns:d.map(a.aoColumns,function(b,
c){return{visible:b.bVisible,search:lb(a.aoPreSearchCols[c])}})};R(a,"aoStateSaveParams","stateSaveParams",[a,b]);a.oSavedState=b;a.fnStateSaveCallback.call(a.oInstance,a,b)}}function wb(a,b){var c,l,e=a.aoColumns;if(a.oFeatures.bStateSave){var h=a.fnStateLoadCallback.call(a.oInstance,a);if(h&&h.time&&(c=R(a,"aoStateLoadParams","stateLoadParams",[a,h]),-1===d.inArray(!1,c)&&(c=a.iStateDuration,!(0<c&&h.time<+new Date-1E3*c)&&e.length===h.columns.length))){a.oLoadedState=d.extend(!0,{},h);a._iDisplayStart=
h.start;a.iInitDisplayStart=h.start;a._iDisplayLength=h.length;a.aaSorting=[];d.each(h.order,function(b,c){a.aaSorting.push(c[0]>=e.length?[0,c[1]]:c)});d.extend(a.oPreviousSearch,mb(h.search));c=0;for(l=h.columns.length;c<l;c++){var f=h.columns[c];e[c].bVisible=f.visible;d.extend(a.aoPreSearchCols[c],mb(f.search))}R(a,"aoStateLoaded","stateLoaded",[a,h])}}}function Ga(a){var b=B.settings;a=d.inArray(a,fa(b,"nTable"));return-1!==a?b[a]:null}function ma(a,b,c,l){c="DataTables warning: "+(null!==a?
"table id="+a.sTableId+" - ":"")+c;l&&(c+=". For more information about this error, please see http://datatables.net/tn/"+l);if(b)g.console&&console.log&&console.log(c);else if(a=B.ext,"alert"==(a.sErrMode||a.errMode))alert(c);else throw Error(c);}function ga(b,c,l,e){d.isArray(l)?d.each(l,function(a,l){d.isArray(l)?ga(b,c,l[0],l[1]):ga(b,c,l)}):(e===a&&(e=l),c[l]!==a&&(b[e]=c[l]))}function xb(a,b,c){var l,e;for(e in b)b.hasOwnProperty(e)&&(l=b[e],d.isPlainObject(l)?(d.isPlainObject(a[e])||(a[e]=
{}),d.extend(!0,a[e],l)):c&&"data"!==e&&"aaData"!==e&&d.isArray(l)?a[e]=l.slice():a[e]=l);return a}function Ta(a,b,c){d(a).bind("click.DT",b,function(b){a.blur();c(b)}).bind("keypress.DT",b,function(a){13===a.which&&(a.preventDefault(),c(a))}).bind("selectstart.DT",function(){return!1})}function Y(a,b,c,l){c&&a[b].push({fn:c,sName:l})}function R(a,b,c,l){var e=[];b&&(e=d.map(a[b].slice().reverse(),function(b,c){return b.fn.apply(a.oInstance,l)}));null!==c&&d(a.nTable).trigger(c+".dt",l);return e}
function Qa(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),l=a._iDisplayLength;b>=c&&(b=c-l);b-=b%l;if(-1===l||0>b)b=0;a._iDisplayStart=b}function Na(a,b){var c=a.renderer,l=B.ext.renderer[b];return d.isPlainObject(c)&&c[b]?l[c[b]]||l._:"string"===typeof c?l[c]||l._:l._}function ba(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function Ua(a,b){var c=[],c=yb.numbers_length,l=Math.floor(c/2);b<=c?c=ra(0,b):a<=l?(c=ra(0,c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-l?c=ra(b-
(c-2),b):(c=ra(a-1,a+2),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function bb(a){d.each({num:function(b){return Ha(b,a)},"num-fmt":function(b){return Ha(b,a,Va)},"html-num":function(b){return Ha(b,a,Ia)},"html-num-fmt":function(b){return Ha(b,a,Ia,Va)}},function(b,c){U.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(U.type.search[b+a]=U.type.search.html)})}function zb(a){return function(){var b=[Ga(this[B.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));
return B.ext.internal[a].apply(this,b)}}var B,U,O,J,P,Wa={},Ab=/[\r\n]/g,Ia=/<.*?>/g,Mb=/^[\w\+\-]/,Nb=/[\w\+\-]$/,Jb=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\|\$|\^|\-)/g,Va=/[',$\u00a3\u20ac\u00a5%\u2009\u202F]/g,ia=function(a){return a&&!0!==a&&"-"!==a?!1:!0},Bb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Cb=function(a,b){Wa[b]||(Wa[b]=new RegExp(Ca(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(Wa[b],"."):a},Xa=function(a,b,c){var l="string"===
typeof a;b&&l&&(a=Cb(a,b));c&&l&&(a=a.replace(Va,""));return ia(a)||!isNaN(parseFloat(a))&&isFinite(a)},Db=function(a,b,c){return ia(a)?!0:ia(a)||"string"===typeof a?Xa(a.replace(Ia,""),b,c)?!0:null:null},fa=function(b,c,l){var e=[],d=0,h=b.length;if(l!==a)for(;d<h;d++)b[d]&&b[d][c]&&e.push(b[d][c][l]);else for(;d<h;d++)b[d]&&e.push(b[d][c]);return e},va=function(b,c,l,e){var d=[],h=0,f=c.length;if(e!==a)for(;h<f;h++)b[c[h]][l]&&d.push(b[c[h]][l][e]);else for(;h<f;h++)d.push(b[c[h]][l]);return d},
ra=function(b,c){var l=[],e;c===a?(c=0,e=b):(e=c,c=b);for(var d=c;d<e;d++)l.push(d);return l},Eb=function(a){for(var b=[],c=0,l=a.length;c<l;c++)a[c]&&b.push(a[c]);return b},La=function(a){var b=[],c,l,e=a.length,d,h=0;l=0;a:for(;l<e;l++){c=a[l];for(d=0;d<h;d++)if(b[d]===c)continue a;b.push(c);h++}return b},aa=function(b,c,l){b[c]!==a&&(b[l]=b[c])},ta=/\[.*?\]$/,na=/\(\)$/,Da=d("<div>")[0],Kb=Da.textContent!==a,Lb=/<.*?>/g;B=function(b){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,
b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new O(Ga(this[U.iApiIndex])):new O(this)};this.fnAddData=function(b,c){var l=this.api(!0),e=d.isArray(b)&&(d.isArray(b[0])||d.isPlainObject(b[0]))?l.rows.add(b):l.row.add(b);(c===a||c)&&l.draw();return e.flatten().toArray()};this.fnAdjustColumnSizing=function(b){var c=this.api(!0).columns.adjust(),l=c.settings()[0],e=l.oScroll;b===a||b?c.draw(!1):""===e.sX&&""===e.sY||sa(l)};this.fnClearTable=function(b){var c=this.api(!0).clear();
(b===a||b)&&c.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(b,c,l){var e=this.api(!0);b=e.rows(b);var d=b.settings()[0],h=d.aoData[b[0][0]];b.remove();c&&c.call(this,d,h);(l===a||l)&&e.draw();return h};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(!a)};this.fnFilter=function(b,c,l,e,d,h){d=this.api(!0);null===c||c===a?d.search(b,l,e,h):d.column(c).search(b,l,e,h);d.draw()};this.fnGetData=function(b,c){var l=
this.api(!0);if(b!==a){var e=b.nodeName?b.nodeName.toLowerCase():"";return c!==a||"td"==e||"th"==e?l.cell(b,c).data():l.row(b).data()||null}return l.data().toArray()};this.fnGetNodes=function(b){var c=this.api(!0);return b!==a?c.row(b).node():c.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};
this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(b,c){var l=this.api(!0).page(b);(c===a||c)&&l.draw(!1)};this.fnSetColumnVis=function(b,c,l){b=this.api(!0).column(b).visible(c);(l===a||l)&&b.columns.adjust().draw()};this.fnSettings=function(){return Ga(this[U.iApiIndex])};this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(b,c,l,e,d){var h=
this.api(!0);l===a||null===l?h.row(c).data(b):h.cell(c,l).data(b);(d===a||d)&&h.columns.adjust();(e===a||e)&&h.draw();return 0};this.fnVersionCheck=U.fnVersionCheck;var c=this,l=b===a,g=this.length;l&&(b={});this.oApi=this.internal=U.internal;for(var u in B.ext.internal)u&&(this[u]=zb(u));this.each(function(){var u={},u=1<g?xb(u,b,!0):b,k=0,q,x=this.getAttribute("id"),y=!1,w=B.defaults;if("table"!=this.nodeName.toLowerCase())ma(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{n(w);
f(w.column);e(w,w,!0);e(w.column,w.column,!0);e(w,u);var E=B.settings,k=0;for(q=E.length;k<q;k++){if(E[k].nTable==this){q=u.bRetrieve!==a?u.bRetrieve:w.bRetrieve;if(l||q)return E[k].oInstance;if(u.bDestroy!==a?u.bDestroy:w.bDestroy){E[k].oInstance.fnDestroy();break}else{ma(E[k],0,"Cannot reinitialise DataTable",3);return}}if(E[k].sTableId==this.id){E.splice(k,1);break}}if(null===x||""===x)this.id=x="DataTables_Table_"+B.ext._unique++;var p=d.extend(!0,{},B.models.oSettings,{nTable:this,oApi:c.internal,
oInit:u,sDestroyWidth:d(this)[0].style.width,sInstance:x,sTableId:x});E.push(p);p.oInstance=1===c.length?c:d(this).dataTable();n(u);u.oLanguage&&h(u.oLanguage);u.aLengthMenu&&!u.iDisplayLength&&(u.iDisplayLength=d.isArray(u.aLengthMenu[0])?u.aLengthMenu[0][0]:u.aLengthMenu[0]);u=xb(d.extend(!0,{},w),u);ga(p.oFeatures,u,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));ga(p,u,["asStripeClasses","ajax","fnServerData","fnFormatNumber",
"sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);ga(p.oScroll,u,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);
ga(p.oLanguage,u,"fnInfoCallback");Y(p,"aoDrawCallback",u.fnDrawCallback,"user");Y(p,"aoServerParams",u.fnServerParams,"user");Y(p,"aoStateSaveParams",u.fnStateSaveParams,"user");Y(p,"aoStateLoadParams",u.fnStateLoadParams,"user");Y(p,"aoStateLoaded",u.fnStateLoaded,"user");Y(p,"aoRowCallback",u.fnRowCallback,"user");Y(p,"aoRowCreatedCallback",u.fnCreatedRow,"user");Y(p,"aoHeaderCallback",u.fnHeaderCallback,"user");Y(p,"aoFooterCallback",u.fnFooterCallback,"user");Y(p,"aoInitComplete",u.fnInitComplete,
"user");Y(p,"aoPreDrawCallback",u.fnPreDrawCallback,"user");x=p.oClasses;u.bJQueryUI?(d.extend(x,B.ext.oJUIClasses,u.oClasses),u.sDom===w.sDom&&"lfrtip"===w.sDom&&(p.sDom='<"H"lfr>t<"F"ip>'),p.renderer)?d.isPlainObject(p.renderer)&&!p.renderer.header&&(p.renderer.header="jqueryui"):p.renderer="jqueryui":d.extend(x,B.ext.classes,u.oClasses);d(this).addClass(x.sTable);if(""!==p.oScroll.sX||""!==p.oScroll.sY)p.oScroll.iBarWidth=tb();!0===p.oScroll.sX&&(p.oScroll.sX="100%");p.iInitDisplayStart===a&&(p.iInitDisplayStart=
u.iDisplayStart,p._iDisplayStart=u.iDisplayStart);null!==u.iDeferLoading&&(p.bDeferLoading=!0,k=d.isArray(u.iDeferLoading),p._iRecordsDisplay=k?u.iDeferLoading[0]:u.iDeferLoading,p._iRecordsTotal=k?u.iDeferLoading[1]:u.iDeferLoading);var z=p.oLanguage;d.extend(!0,z,u.oLanguage);""!==z.sUrl&&(d.ajax({dataType:"json",url:z.sUrl,success:function(a){h(a);e(w.oLanguage,a);d.extend(!0,z,a);ua(p)},error:function(){ua(p)}}),y=!0);null===u.asStripeClasses&&(p.asStripeClasses=[x.sStripeOdd,x.sStripeEven]);
var k=p.asStripeClasses,T=d("tbody tr:eq(0)",this);-1!==d.inArray(!0,d.map(k,function(a,b){return T.hasClass(a)}))&&(d("tbody tr",this).removeClass(k.join(" ")),p.asDestroyStripes=k.slice());var E=[],S,k=this.getElementsByTagName("thead");0!==k.length&&(da(p.aoHeader,k[0]),E=ja(p));if(null===u.aoColumns)for(S=[],k=0,q=E.length;k<q;k++)S.push(null);else S=u.aoColumns;k=0;for(q=S.length;k<q;k++)m(p,E?E[k]:null);I(p,u.aoColumnDefs,S,function(a,b){r(p,a,b)});if(T.length){var v=function(a,b){return a.getAttribute("data-"+
b)?b:null};d.each(Q(p,T[0]).cells,function(b,c){var l=p.aoColumns[b];if(l.mData===b){var e=v(c,"sort")||v(c,"order"),d=v(c,"filter")||v(c,"search");if(null!==e||null!==d)l.mData={_:b+".display",sort:null!==e?b+".@data-"+e:a,type:null!==e?b+".@data-"+e:a,filter:null!==d?b+".@data-"+d:a},r(p,b)}})}var F=p.oFeatures;u.bStateSave&&(F.bStateSave=!0,wb(p,u),Y(p,"aoDrawCallback",Fa,"state_save"));if(u.aaSorting===a)for(E=p.aaSorting,k=0,q=E.length;k<q;k++)E[k][1]=p.aoColumns[k].asSorting[0];Ea(p);F.bSort&&
Y(p,"aoDrawCallback",function(){if(p.bSorted){var a=pa(p),b={};d.each(a,function(a,c){b[c.src]=c.dir});R(p,null,"order",[p,a,b]);vb(p)}});Y(p,"aoDrawCallback",function(){(p.bSorted||"ssp"===ba(p)||F.bDeferRender)&&Ea(p)},"sc");t(p);k=d(this).children("caption").each(function(){this._captionSide=d(this).css("caption-side")});q=d(this).children("thead");0===q.length&&(q=d("<thead/>").appendTo(this));p.nTHead=q[0];q=d(this).children("tbody");0===q.length&&(q=d("<tbody/>").appendTo(this));p.nTBody=q[0];
q=d(this).children("tfoot");0===q.length&&0<k.length&&(""!==p.oScroll.sX||""!==p.oScroll.sY)&&(q=d("<tfoot/>").appendTo(this));0===q.length||0===q.children().length?d(this).addClass(x.sNoFooter):0<q.length&&(p.nTFoot=q[0],da(p.aoFooter,p.nTFoot));if(u.aaData)for(k=0;k<u.aaData.length;k++)A(p,u.aaData[k]);else(p.bDeferLoading||"dom"==ba(p))&&G(p,d(p.nTBody).children("tr"));p.aiDisplay=p.aiDisplayMaster.slice();p.bInitialised=!0;!1===y&&ua(p)}});c=null;return this};var Fb=[],W=Array.prototype,Ob=function(a){var b,
c,l=B.settings,e=d.map(l,function(a,b){return a.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return b=d.inArray(a,e),-1!==b?[l[b]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?c=d(a):a instanceof d&&(c=a)}else return[];if(c)return c.map(function(a){b=d.inArray(this,e);return-1!==b?l[b]:null}).toArray()};O=function(a,b){if(!this instanceof O)throw"DT API must be constructed as a new object";var c=[],l=
function(a){(a=Ob(a))&&c.push.apply(c,a)};if(d.isArray(a))for(var e=0,h=a.length;e<h;e++)l(a[e]);else l(a);this.context=La(c);b&&this.push.apply(this,b.toArray?b.toArray():b);this.selector={rows:null,cols:null,opts:null};O.extend(this,this,Fb)};B.Api=O;O.prototype={concat:W.concat,context:[],each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new O(b[a],this[a]):null},filter:function(a){var b=[];if(W.filter)b=
W.filter.call(this,a,this);else for(var c=0,l=this.length;c<l;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new O(this.context,b)},flatten:function(){var a=[];return new O(this.context,a.concat.apply(a,this.toArray()))},join:W.join,indexOf:W.indexOf||function(a,b){for(var c=b||0,l=this.length;c<l;c++)if(this[c]===a)return c;return-1},iterator:function(b,c,l,e){var d=[],h,f,m,g,n,u=this.context,k,q,x=this.selector;"string"===typeof b&&(e=l,l=c,c=b,b=!1);f=0;for(m=u.length;f<m;f++){var y=
new O(u[f]);if("table"===c)h=l.call(y,u[f],f),h!==a&&d.push(h);else if("columns"===c||"rows"===c)h=l.call(y,u[f],this[f],f),h!==a&&d.push(h);else if("column"===c||"column-rows"===c||"row"===c||"cell"===c)for(q=this[f],"column-rows"===c&&(k=Ja(u[f],x.opts)),g=0,n=q.length;g<n;g++)h=q[g],h="cell"===c?l.call(y,u[f],h.row,h.column,f,g):l.call(y,u[f],h,f,g,k),h!==a&&d.push(h)}return d.length||e?(b=new O(u,b?d.concat.apply([],d):d),c=b.selector,c.rows=x.rows,c.cols=x.cols,c.opts=x.opts,b):this},lastIndexOf:W.lastIndexOf||
function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(W.map)b=W.map.call(this,a,this);else for(var c=0,l=this.length;c<l;c++)b.push(a.call(this,this[c],c));return new O(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},pop:W.pop,push:W.push,reduce:W.reduce||function(a,b){return p(this,a,b,0,this.length,1)},reduceRight:W.reduceRight||function(a,b){return p(this,a,b,this.length-1,-1,-1)},reverse:W.reverse,selector:null,
shift:W.shift,sort:W.sort,splice:W.splice,toArray:function(){return W.slice.call(this)},to$:function(){return d(this)},toJQuery:function(){return d(this)},unique:function(){return new O(this.context,La(this))},unshift:W.unshift};O.extend=function(a,b,c){if(b&&(b instanceof O||b.__dt_wrapper)){var l,e,h,f=function(a,b,c){return function(){var l=b.apply(a,arguments);O.extend(l,l,c.methodExt);return l}};l=0;for(e=c.length;l<e;l++)h=c[l],b[h.name]="function"===typeof h.val?f(a,h.val,h):d.isPlainObject(h.val)?
{}:h.val,b[h.name].__dt_wrapper=!0,O.extend(a,b[h.name],h.propExt)}};O.register=J=function(a,b){if(d.isArray(a))for(var c=0,l=a.length;c<l;c++)O.register(a[c],b);else for(var e=a.split("."),h=Fb,f,m,c=0,l=e.length;c<l;c++){f=(m=-1!==e[c].indexOf("()"))?e[c].replace("()",""):e[c];var g;a:{g=0;for(var n=h.length;g<n;g++)if(h[g].name===f){g=h[g];break a}g=null}g||(g={name:f,val:{},methodExt:[],propExt:[]},h.push(g));c===l-1?g.val=b:h=m?g.methodExt:g.propExt}};O.registerPlural=P=function(b,c,l){O.register(b,
l);O.register(c,function(){var b=l.apply(this,arguments);return b===this?this:b instanceof O?b.length?d.isArray(b[0])?new O(b.context,b[0]):b[0]:a:b})};var Pb=function(a,b){if("number"===typeof a)return[b[a]];var c=d.map(b,function(a,b){return a.nTable});return d(c).filter(a).map(function(a){a=d.inArray(this,c);return b[a]}).toArray()};J("tables()",function(a){return a?new O(Pb(a,this.context)):this});J("table()",function(a){a=this.tables(a);var b=a.context;return b.length?new O(b[0]):a});P("tables().nodes()",
"table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});P("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});P("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});P("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});P("tables().containers()","table().container()",function(){return this.iterator("table",
function(a){return a.nTableWrapper},1)});J("draw()",function(a){return this.iterator("table",function(b){X(b,!1===a)})});J("page()",function(b){return b===a?this.page.info().page:this.iterator("table",function(a){Ra(a,b)})});J("page.info()",function(b){if(0===this.context.length)return a;b=this.context[0];var c=b._iDisplayStart,l=b._iDisplayLength,e=b.fnRecordsDisplay(),d=-1===l;return{page:d?0:Math.floor(c/l),pages:d?1:Math.ceil(e/l),start:c,end:b.fnDisplayEnd(),length:l,recordsTotal:b.fnRecordsTotal(),
recordsDisplay:e}});J("page.len()",function(b){return b===a?0!==this.context.length?this.context[0]._iDisplayLength:a:this.iterator("table",function(a){Pa(a,b)})});var Gb=function(a,b,c){"ssp"==ba(a)?X(a,b):(ea(a,!0),ka(a,[],function(c){u(a);c=qa(a,c);for(var l=0,e=c.length;l<e;l++)A(a,c[l]);X(a,b);ea(a,!1)}));if(c){var l=new O(a);l.one("draw",function(){c(l.ajax.json())})}};J("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});J("ajax.params()",function(){var a=this.context;
if(0<a.length)return a[0].oAjaxData});J("ajax.reload()",function(a,b){return this.iterator("table",function(c){Gb(c,!1===b,a)})});J("ajax.url()",function(b){var c=this.context;if(b===a){if(0===c.length)return a;c=c[0];return c.ajax?d.isPlainObject(c.ajax)?c.ajax.url:c.ajax:c.sAjaxSource}return this.iterator("table",function(a){d.isPlainObject(a.ajax)?a.ajax.url=b:a.ajax=b})});J("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Gb(c,!1===b,a)})});var Ya=function(b,c){var l=
[],e,h,f,m,g,n;e=typeof b;b&&"string"!==e&&"function"!==e&&b.length!==a||(b=[b]);f=0;for(m=b.length;f<m;f++)for(h=b[f]&&b[f].split?b[f].split(","):[b[f]],g=0,n=h.length;g<n;g++)(e=c("string"===typeof h[g]?d.trim(h[g]):h[g]))&&e.length&&l.push.apply(l,e);return l},Za=function(a){a||(a={});a.filter&&!a.search&&(a.search=a.filter);return{search:a.search||"none",order:a.order||"current",page:a.page||"all"}},$a=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a.length=1,a.context=
[a.context[b]],a;a.length=0;return a},Ja=function(a,b){var c,l,e,h=[],f=a.aiDisplay;c=a.aiDisplayMaster;var m=b.search;l=b.order;e=b.page;if("ssp"==ba(a))return"removed"===m?[]:ra(0,c.length);if("current"==e)for(c=a._iDisplayStart,l=a.fnDisplayEnd();c<l;c++)h.push(f[c]);else if("current"==l||"applied"==l)h="none"==m?c.slice():"applied"==m?f.slice():d.map(c,function(a,b){return-1===d.inArray(a,f)?a:null});else if("index"==l||"original"==l)for(c=0,l=a.aoData.length;c<l;c++)"none"==m?h.push(c):(e=d.inArray(c,
f),(-1===e&&"removed"==m||0<=e&&"applied"==m)&&h.push(c));return h},Qb=function(a,b,c){return Ya(b,function(b){var l=Bb(b);if(null!==l&&!c)return[l];var e=Ja(a,c);if(null!==l&&-1!==d.inArray(l,e))return[l];if(!b)return e;if("function"===typeof b)return d.map(e,function(c){var l=a.aoData[c];return b(c,l._aData,l.nTr)?c:null});l=Eb(va(a.aoData,e,"nTr"));return b.nodeName&&-1!==d.inArray(b,l)?[b._DT_RowIndex]:d(l).filter(b).map(function(){return this._DT_RowIndex}).toArray()})};J("rows()",function(b,
c){b===a?b="":d.isPlainObject(b)&&(c=b,b="");c=Za(c);var l=this.iterator("table",function(a){return Qb(a,b,c)},1);l.selector.rows=b;l.selector.opts=c;return l});J("rows().nodes()",function(){return this.iterator("row",function(b,c){return b.aoData[c].nTr||a},1)});J("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return va(a.aoData,b,"_aData")},1)});P("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var l=b.aoData[c];return"search"===a?l._aFilterData:
l._aSortData},1)});P("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){y(b,c,a)})});P("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,b){return b},1)});P("rows().remove()","row().remove()",function(){var a=this;return this.iterator("row",function(b,c,l){var e=b.aoData;e.splice(c,1);for(var h=0,f=e.length;h<f;h++)null!==e[h].nTr&&(e[h].nTr._DT_RowIndex=h);d.inArray(c,b.aiDisplay);x(b.aiDisplayMaster,c);x(b.aiDisplay,
c);x(a[l],c,!1);Qa(b)})});J("rows.add()",function(a){var b=this.iterator("table",function(b){var c,l,e,h=[];l=0;for(e=a.length;l<e;l++)c=a[l],c.nodeName&&"TR"===c.nodeName.toUpperCase()?h.push(G(b,c)[0]):h.push(A(b,c));return h},1),c=this.rows(-1);c.pop();c.push.apply(c,b.toArray());return c});J("row()",function(a,b){return $a(this.rows(a,b))});J("row().data()",function(b){var c=this.context;if(b===a)return c.length&&this.length?c[0].aoData[this[0]]._aData:a;c[0].aoData[this[0]]._aData=b;y(c[0],this[0],
"data");return this});J("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});J("row.add()",function(a){a instanceof d&&a.length&&(a=a[0]);var b=this.iterator("table",function(b){return a.nodeName&&"TR"===a.nodeName.toUpperCase()?G(b,a)[0]:A(b,a)});return this.row(b[0])});var Rb=function(a,b,c,l){var e=[],h=function(b,c){if(b.nodeName&&"tr"===b.nodeName.toLowerCase())e.push(b);else{var l=d("<tr><td/></tr>").addClass(c);d("td",l).addClass(c).html(b)[0].colSpan=
v(a);e.push(l[0])}};if(d.isArray(c)||c instanceof d)for(var f=0,m=c.length;f<m;f++)h(c[f],l);else h(c,l);b._details&&b._details.remove();b._details=d(e);b._detailsShow&&b._details.insertAfter(b.nTr)},ab=function(b,c){var l=b.context;l.length&&(l=l[0].aoData[c!==a?c:b[0]],l._details&&(l._details.remove(),l._detailsShow=a,l._details=a))},Hb=function(a,b){var c=a.context;if(c.length&&a.length){var l=c[0].aoData[a[0]];l._details&&((l._detailsShow=b)?l._details.insertAfter(l.nTr):l._details.detach(),Sb(c[0]))}},
Sb=function(a){var b=new O(a),c=a.aoData;b.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<fa(c,"_details").length&&(b.on("draw.dt.DT_details",function(l,e){a===e&&b.rows({page:"current"}).eq(0).each(function(a){a=c[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),b.on("column-visibility.dt.DT_details",function(b,l,e,h){if(a===l)for(l=v(l),e=0,h=c.length;e<h;e++)b=c[e],b._details&&b._details.children("td[colspan]").attr("colspan",l)}),b.on("destroy.dt.DT_details",
function(l,e){if(a===e)for(var h=0,d=c.length;h<d;h++)c[h]._details&&ab(b,h)}))};J("row().child()",function(b,c){var l=this.context;if(b===a)return l.length&&this.length?l[0].aoData[this[0]]._details:a;!0===b?this.child.show():!1===b?ab(this):l.length&&this.length&&Rb(l[0],l[0].aoData[this[0]],b,c);return this});J(["row().child.show()","row().child().show()"],function(a){Hb(this,!0);return this});J(["row().child.hide()","row().child().hide()"],function(){Hb(this,!1);return this});J(["row().child.remove()",
"row().child().remove()"],function(){ab(this);return this});J("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Tb=/^(.+):(name|visIdx|visible)$/,Ib=function(a,b,c,l,e){c=[];l=0;for(var h=e.length;l<h;l++)c.push(C(a,e[l],b));return c},Ub=function(a,b,c){var l=a.aoColumns,e=fa(l,"sName"),h=fa(l,"nTh");return Ya(b,function(b){var f=Bb(b);if(""===b)return ra(l.length);if(null!==f)return[0<=f?f:l.length+f];if("function"===
typeof b){var m=Ja(a,c);return d.map(l,function(c,l){return b(l,Ib(a,l,0,0,m),h[l])?l:null})}var g="string"===typeof b?b.match(Tb):"";if(g)switch(g[2]){case "visIdx":case "visible":f=parseInt(g[1],10);if(0>f){var n=d.map(l,function(a,b){return a.bVisible?b:null});return[n[n.length+f]]}return[q(a,f)];case "name":return d.map(e,function(a,b){return a===g[1]?b:null})}else return d(h).filter(b).map(function(){return d.inArray(this,h)}).toArray()})};J("columns()",function(b,c){b===a?b="":d.isPlainObject(b)&&
(c=b,b="");c=Za(c);var l=this.iterator("table",function(a){return Ub(a,b,c)},1);l.selector.cols=b;l.selector.opts=c;return l});P("columns().header()","column().header()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});P("columns().footer()","column().footer()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});P("columns().data()","column().data()",function(){return this.iterator("column-rows",Ib,1)});P("columns().dataSrc()",
"column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});P("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,l,e,h){return va(b.aoData,h,"search"===a?"_aFilterData":"_aSortData",c)},1)});P("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,l,e){return va(a.aoData,e,"anCells",b)},1)});P("columns().visible()","column().visible()",function(b,l){return this.iterator("column",
function(e,h){if(b===a)return e.aoColumns[h].bVisible;var f=e.aoColumns,m=f[h],g=e.aoData,n,u,k;if(b!==a&&m.bVisible!==b){if(b){var q=d.inArray(!0,fa(f,"bVisible"),h+1);n=0;for(u=g.length;n<u;n++)k=g[n].nTr,f=g[n].anCells,k&&k.insertBefore(f[h],f[q]||null)}else d(fa(e.aoData,"anCells",h)).detach();m.bVisible=b;V(e,e.aoHeader);V(e,e.aoFooter);if(l===a||l)c(e),(e.oScroll.sX||e.oScroll.sY)&&sa(e);R(e,null,"column-visibility",[e,h,b]);Fa(e)}})});P("columns().indexes()","column().index()",function(a){return this.iterator("column",
function(b,c){return"visible"===a?w(b,c):c},1)});J("columns.adjust()",function(){return this.iterator("table",function(a){c(a)},1)});J("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return q(c,b);if("fromData"===a||"toVisible"===a)return w(c,b)}});J("column()",function(a,b){return $a(this.columns(a,b))});var Vb=function(b,c,l){var e=b.aoData,h=Ja(b,l);l=Eb(va(e,h,"anCells"));var f=d([].concat.apply([],l)),m,g=b.aoColumns.length,
n,u,k,q,x,y;return Ya(c,function(c){var l="function"===typeof c;if(null===c||c===a||l){n=[];u=0;for(k=h.length;u<k;u++)for(m=h[u],q=0;q<g;q++)x={row:m,column:q},l?(y=b.aoData[m],c(x,C(b,m,q),y.anCells[q])&&n.push(x)):n.push(x);return n}return d.isPlainObject(c)?[c]:f.filter(c).map(function(a,b){m=b.parentNode._DT_RowIndex;return{row:m,column:d.inArray(b,e[m].anCells)}}).toArray()})};J("cells()",function(b,c,l){d.isPlainObject(b)&&(typeof b.row!==a?(l=c,c=null):(l=b,b=null));d.isPlainObject(c)&&(l=
c,c=null);if(null===c||c===a)return this.iterator("table",function(a){return Vb(a,b,Za(l))});var e=this.columns(c,l),h=this.rows(b,l),f,m,g,n,u,k=this.iterator("table",function(a,b){f=[];m=0;for(g=h[b].length;m<g;m++)for(n=0,u=e[b].length;n<u;n++)f.push({row:h[b][m],column:e[b][n]});return f},1);d.extend(k.selector,{cols:c,rows:b,opts:l});return k});P("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(b,c,l){return(b=b.aoData[c].anCells)?b[l]:a},1)});J("cells().data()",
function(){return this.iterator("cell",function(a,b,c){return C(a,b,c)},1)});P("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,l){return b.aoData[c][a][l]},1)});P("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,l){return C(b,c,l,a)},1)});P("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,b,c){return{row:b,column:c,columnVisible:w(a,c)}},
1)});P("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,l){y(b,c,a,l)})});J("cell()",function(a,b,c){return $a(this.cells(a,b,c))});J("cell().data()",function(b){var c=this.context,l=this[0];if(b===a)return c.length&&l.length?C(c[0],l[0].row,l[0].column):a;z(c[0],l[0].row,l[0].column,b);y(c[0],l[0].row,"data",l[0].column);return this});J("order()",function(b,c){var l=this.context;if(b===a)return 0!==l.length?l[0].aaSorting:a;"number"===typeof b?b=[[b,
c]]:d.isArray(b[0])||(b=Array.prototype.slice.call(arguments));return this.iterator("table",function(a){a.aaSorting=b.slice()})});J("order.listener()",function(a,b,c){return this.iterator("table",function(l){Ma(l,a,b,c)})});J(["columns().order()","column().order()"],function(a){var b=this;return this.iterator("table",function(c,l){var e=[];d.each(b[l],function(b,c){e.push([c,a])});c.aaSorting=e})});J("search()",function(b,c,l,e){var h=this.context;return b===a?0!==h.length?h[0].oPreviousSearch.sSearch:
a:this.iterator("table",function(a){a.oFeatures.bFilter&&la(a,d.extend({},a.oPreviousSearch,{sSearch:b+"",bRegex:null===c?!1:c,bSmart:null===l?!0:l,bCaseInsensitive:null===e?!0:e}),1)})});P("columns().search()","column().search()",function(b,c,l,e){return this.iterator("column",function(h,f){var m=h.aoPreSearchCols;if(b===a)return m[f].sSearch;h.oFeatures.bFilter&&(d.extend(m[f],{sSearch:b+"",bRegex:null===c?!1:c,bSmart:null===l?!0:l,bCaseInsensitive:null===e?!0:e}),la(h,h.oPreviousSearch,1))})});
J("state()",function(){return this.context.length?this.context[0].oSavedState:null});J("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});J("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null});J("state.save()",function(){return this.iterator("table",function(a){Fa(a)})});B.versionCheck=B.fnVersionCheck=function(a){var b=B.version.split(".");a=a.split(".");for(var c,l,e=0,h=a.length;e<h;e++)if(c=
parseInt(b[e],10)||0,l=parseInt(a[e],10)||0,c!==l)return c>l;return!0};B.isDataTable=B.fnIsDataTable=function(a){var b=d(a).get(0),c=!1;d.each(B.settings,function(a,l){if(l.nTable===b||l.nScrollHead===b||l.nScrollFoot===b)c=!0});return c};B.tables=B.fnTables=function(a){return d.map(B.settings,function(b){if(!a||a&&d(b.nTable).is(":visible"))return b.nTable})};B.util={throttle:Aa,escapeRegex:Ca};B.camelToHungarian=e;J("$()",function(a,b){var c=this.rows(b).nodes(),c=d(c);return d([].concat(c.filter(a).toArray(),
c.find(a).toArray()))});d.each(["on","one","off"],function(a,b){J(b+"()",function(){var a=Array.prototype.slice.call(arguments);a[0].match(/\.dt\b/)||(a[0]+=".dt");var c=d(this.tables().nodes());c[b].apply(c,a);return this})});J("clear()",function(){return this.iterator("table",function(a){u(a)})});J("settings()",function(){return new O(this.context,this.context)});J("data()",function(){return this.iterator("table",function(a){return fa(a.aoData,"_aData")}).flatten()});J("destroy()",function(a){a=
a||!1;return this.iterator("table",function(b){var c=b.nTableWrapper.parentNode,l=b.oClasses,e=b.nTable,h=b.nTBody,f=b.nTHead,m=b.nTFoot,n=d(e),h=d(h),u=d(b.nTableWrapper),k=d.map(b.aoData,function(a){return a.nTr}),q;b.bDestroying=!0;R(b,"aoDestroyCallback","destroy",[b]);a||(new O(b)).columns().visible(!0);u.unbind(".DT").find(":not(tbody *)").unbind(".DT");d(g).unbind(".DT-"+b.sInstance);e!=f.parentNode&&(n.children("thead").detach(),n.append(f));m&&e!=m.parentNode&&(n.children("tfoot").detach(),
n.append(m));n.detach();u.detach();b.aaSorting=[];b.aaSortingFixed=[];Ea(b);d(k).removeClass(b.asStripeClasses.join(" "));d("th, td",f).removeClass(l.sSortable+" "+l.sSortableAsc+" "+l.sSortableDesc+" "+l.sSortableNone);b.bJUI&&(d("th span."+l.sSortIcon+", td span."+l.sSortIcon,f).detach(),d("th, td",f).each(function(){var a=d("div."+l.sSortJUIWrapper,this);d(this).append(a.contents());a.detach()}));!a&&c&&c.insertBefore(e,b.nTableReinsertBefore);h.children().detach();h.append(k);n.css("width",b.sDestroyWidth).removeClass(l.sTable);
(q=b.asDestroyStripes.length)&&h.children().each(function(a){d(this).addClass(b.asDestroyStripes[a%q])});c=d.inArray(b,B.settings);-1!==c&&B.settings.splice(c,1)})});B.version="1.10.4";B.settings=[];B.models={};B.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};B.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null};B.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,
_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};B.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,
bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,
fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,
oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",
sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:d.extend({},B.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null};b(B.defaults);B.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,
sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};b(B.defaults.column);B.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1},
ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,
bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:a,oAjaxData:a,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,
bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==ba(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ba(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,l=this.aiDisplay.length,e=this.oFeatures,h=e.bPaginate;return e.bServerSide?!1===h||-1===a?b+l:Math.min(b+a,this._iRecordsDisplay):!h||c>l||-1===a?l:c},oInstance:null,sInstance:null,
iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}};B.ext=U={classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:B.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:B.version};d.extend(U,{afnFiltering:U.search,aTypes:U.type.detect,ofnSearch:U.type.search,oSort:U.type.order,afnSortData:U.order,aoFeatures:U.feature,oApi:U.internal,oStdClasses:U.classes,
oPagination:U.pager});d.extend(B.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",
sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",
sJUIHeader:"",sJUIFooter:""});(function(){var a="",a="",b=a+"ui-state-default",c=a+"css_right ui-icon ui-icon-",a=a+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";d.extend(B.ext.oJUIClasses,B.ext.classes,{sPageButton:"fg-button ui-button "+b,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:b+" sorting_asc",sSortDesc:b+" sorting_desc",sSortable:b+
" sorting",sSortableAsc:b+" sorting_asc_disabled",sSortableDesc:b+" sorting_desc_disabled",sSortableNone:b+" sorting_disabled",sSortJUIAsc:c+"triangle-1-n",sSortJUIDesc:c+"triangle-1-s",sSortJUI:c+"carat-2-n-s",sSortJUIAscAllowed:c+"carat-1-n",sSortJUIDescAllowed:c+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+b,sScrollFoot:"dataTables_scrollFoot "+b,sHeaderTH:b,sFooterTH:b,sJUIHeader:a+" ui-corner-tl ui-corner-tr",sJUIFooter:a+
" ui-corner-bl ui-corner-br"})})();var yb=B.ext.pager;d.extend(yb,{simple:function(a,b){return["previous","next"]},full:function(a,b){return["first","previous","next","last"]},simple_numbers:function(a,b){return["previous",Ua(a,b),"next"]},full_numbers:function(a,b){return["first","previous",Ua(a,b),"next","last"]},_numbers:Ua,numbers_length:7});d.extend(!0,B.ext.renderer,{pageButton:{_:function(a,b,c,l,e,h){var f=a.oClasses,m=a.oLanguage.oPaginate,g,n,u=0,q=function(b,l){var k,x,y,r,w=function(b){Ra(a,
b.data.action,!0)};k=0;for(x=l.length;k<x;k++)if(r=l[k],d.isArray(r))y=d("<"+(r.DT_el||"div")+"/>").appendTo(b),q(y,r);else{n=g="";switch(r){case "ellipsis":b.append("<span>&hellip;</span>");break;case "first":g=m.sFirst;n=r+(0<e?"":" "+f.sPageButtonDisabled);break;case "previous":g=m.sPrevious;n=r+(0<e?"":" "+f.sPageButtonDisabled);break;case "next":g=m.sNext;n=r+(e<h-1?"":" "+f.sPageButtonDisabled);break;case "last":g=m.sLast;n=r+(e<h-1?"":" "+f.sPageButtonDisabled);break;default:g=r+1,n=e===r?
f.sPageButtonActive:""}g&&(y=d("<a>",{"class":f.sPageButton+" "+n,"aria-controls":a.sTableId,"data-dt-idx":u,tabindex:a.iTabIndex,id:0===c&&"string"===typeof r?a.sTableId+"_"+r:null}).html(g).appendTo(b),Ta(y,{action:r},w),u++)}};try{var x=d(k.activeElement).data("dt-idx");q(d(b).empty(),l);null!==x&&d(b).find("[data-dt-idx="+x+"]").focus()}catch(y){}}}});d.extend(B.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return Xa(a,c)?"num"+c:null},function(a,b){if(!(!a||a instanceof Date||Mb.test(a)&&
Nb.test(a)))return null;var c=Date.parse(a);return null!==c&&!isNaN(c)||ia(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return Xa(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Db(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Db(a,c,!0)?"html-num-fmt"+c:null},function(a,b){return ia(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);d.extend(B.ext.type.search,{html:function(a){return ia(a)?a:"string"===typeof a?a.replace(Ab,
" ").replace(Ia,""):""},string:function(a){return ia(a)?a:"string"===typeof a?a.replace(Ab," "):a}});var Ha=function(a,b,c,l){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Cb(a,b));a.replace&&(c&&(a=a.replace(c,"")),l&&(a=a.replace(l,"")));return 1*a};d.extend(U.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return ia(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return ia(a)?"":"string"===typeof a?a.toLowerCase():a.toString?
a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});bb("");d.extend(!0,B.ext.renderer,{header:{_:function(a,b,c,l){d(a.nTable).on("order.dt.DT",function(e,h,d,f){a===h&&(e=c.idx,b.removeClass(c.sSortingClass+" "+l.sSortAsc+" "+l.sSortDesc).addClass("asc"==f[e]?l.sSortAsc:"desc"==f[e]?l.sSortDesc:c.sSortingClass))})},jqueryui:function(a,b,c,l){d("<div/>").addClass(l.sSortJUIWrapper).append(b.contents()).append(d("<span/>").addClass(l.sSortIcon+
" "+c.sSortingClassJUI)).appendTo(b);d(a.nTable).on("order.dt.DT",function(e,h,d,f){a===h&&(e=c.idx,b.removeClass(l.sSortAsc+" "+l.sSortDesc).addClass("asc"==f[e]?l.sSortAsc:"desc"==f[e]?l.sSortDesc:c.sSortingClass),b.find("span."+l.sSortIcon).removeClass(l.sSortJUIAsc+" "+l.sSortJUIDesc+" "+l.sSortJUI+" "+l.sSortJUIAscAllowed+" "+l.sSortJUIDescAllowed).addClass("asc"==f[e]?l.sSortJUIAsc:"desc"==f[e]?l.sSortJUIDesc:c.sSortingClassJUI))})}}});B.render={number:function(a,b,c,l){return{display:function(e){var h=
0>e?"-":"";e=Math.abs(parseFloat(e));var d=parseInt(e,10);e=c?b+(e-d).toFixed(c).substring(2):"";return h+(l||"")+d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+e}}}};d.extend(B.ext.internal,{_fnExternApiFunc:zb,_fnBuildAjax:ka,_fnAjaxUpdate:oa,_fnAjaxParameters:xa,_fnAjaxUpdateDraw:ya,_fnAjaxDataSrc:qa,_fnAddColumn:m,_fnColumnOptions:r,_fnAdjustColumnSizing:c,_fnVisibleToColumnIndex:q,_fnColumnIndexToVisible:w,_fnVisbleColumns:v,_fnGetColumns:D,_fnColumnTypes:H,_fnApplyColumnDefs:I,_fnHungarianMap:b,
_fnCamelToHungarian:e,_fnLanguageCompat:h,_fnBrowserDetect:t,_fnAddData:A,_fnAddTr:G,_fnNodeToDataIndex:function(b,c){return c._DT_RowIndex!==a?c._DT_RowIndex:null},_fnNodeToColumnIndex:function(a,b,c){return d.inArray(c,a.aoData[b].anCells)},_fnGetCellData:C,_fnSetCellData:z,_fnSplitObjNotation:E,_fnGetObjectDataFn:F,_fnSetObjectDataFn:K,_fnGetDataMaster:l,_fnClearTable:u,_fnDeleteIndex:x,_fnInvalidate:y,_fnGetRowElements:Q,_fnCreateTr:S,_fnBuildHead:Z,_fnDrawHead:V,_fnDraw:N,_fnReDraw:X,_fnAddOptionsHtml:ca,
_fnDetectHeader:da,_fnGetUniqueThs:ja,_fnFeatureHtmlFilter:wa,_fnFilterComplete:la,_fnFilterCustom:Ba,_fnFilterColumn:jb,_fnFilter:ib,_fnFilterCreateSearch:Oa,_fnEscapeRegex:Ca,_fnFilterData:kb,_fnFeatureHtmlInfo:gb,_fnUpdateInfo:nb,_fnInfoMacros:ob,_fnInitialise:ua,_fnInitComplete:za,_fnLengthChange:Pa,_fnFeatureHtmlLength:db,_fnFeatureHtmlPaginate:hb,_fnPageChange:Ra,_fnFeatureHtmlProcessing:eb,_fnProcessingDisplay:ea,_fnFeatureHtmlTable:fb,_fnScrollDraw:sa,_fnApplyToChildren:ha,_fnCalculateColumnWidths:Ka,
_fnThrottle:Aa,_fnConvertToWidth:pb,_fnScrollingWidthAdjust:rb,_fnGetWidestNode:qb,_fnGetMaxLenString:sb,_fnStringToCss:M,_fnScrollBarWidth:tb,_fnSortFlatten:pa,_fnSort:cb,_fnSortAria:vb,_fnSortListener:Sa,_fnSortAttachListener:Ma,_fnSortingClasses:Ea,_fnSortData:ub,_fnSaveState:Fa,_fnLoadState:wb,_fnSettingsFromNode:Ga,_fnLog:ma,_fnMap:ga,_fnBindAction:Ta,_fnCallbackReg:Y,_fnCallbackFire:R,_fnLengthOverflow:Qa,_fnRenderer:Na,_fnDataSource:ba,_fnRowAttributes:T,_fnCalculateEnd:function(){}});d.fn.dataTable=
B;d.fn.dataTableSettings=B.settings;d.fn.dataTableExt=B.ext;d.fn.DataTable=function(a){return d(this).dataTable(a).api()};d.each(B,function(a,b){d.fn.DataTable[a]=b});return d.fn.dataTable})})(window,document);window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(g){return function(){var k={};return{check_message:function(a){var d;if(a.is_box())if(d=a.get_size(),1>d)g.UTILITIES.display_message("Function birds can only respond to boxes with holes.");else if(a=a.get_hole_contents(0)){if(a.is_bird())return{box_size:d,bird:a};g.UTILITIES.display_message("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+g.UTILITIES.add_a_or_an(a.get_type_name()+"."))}else g.UTILITIES.display_message("Function birds can only respond to boxes with something in the first hole.");
else g.UTILITIES.display_message("Function birds can only respond to boxes. One was given "+g.UTILITIES.add_a_or_an(a.get_type_name()))},process_response:function(a,d,b,e,h){a&&d.widget_dropped_on_me(a,!1,void 0,h,!0,!0);b.remove(void 0,!0)},process_message:function(a,d,b,e){var h=this.check_message(a);if(h)return d=d(h.bird,h.box_size),this.process_response(d,h.bird,a,b,e),d},type_check:function(a,d,b,e){if(!a)return!0;if(!d)return g.UTILITIES.display_message("Birds for the "+b+" function can only respond to boxes with "+
g.UTILITIES.add_a_or_an(a)+" in the "+g.UTILITIES.ordinal(e)+" hole. The "+g.UTILITIES.ordinal(e)+" hole is empty."),!1;if(d.dereference().is_of_type(a))return!0;if(d.is_nest())throw{wait_for_nest_to_receive_something:d};g.UTILITIES.display_message("Birds for the "+b+" function can only respond to boxes with "+g.UTILITIES.add_a_or_an(a)+" in the "+g.UTILITIES.ordinal(e)+" hole. The "+g.UTILITIES.ordinal(e)+" hole contains "+g.UTILITIES.add_a_or_an(d.get_type_name()+"."));return!1},number_check:function(a,
d,b){return this.type_check("number",a,d,b)},n_ary_widget_function:function(a,d,b,e,h,g){var f=function(h,f){var m,g,c,n;if(1===f)return d();g=1;c=a.get_hole_contents(g).dereference();if(n=this.number_check(c,e,g)){for(g++;g<f;){m=a.get_hole_contents(g).dereference();n=this.number_check(m,e,g);if(!n)return;b.call(c,m);g++}return c}}.bind(this);return this.process_message(a,f,h,g)},n_ary_function:function(a,d,b,e,h,n){var f=function(h,f){var m,n,c,k;if(f<b+1)g.UTILITIES.display_message("Birds for the "+
e+" function can only respond to boxes with at least "+(b+1)+" holes. Not "+f+" holes.");else{c=[];for(n=1;n<f;){m=a.get_hole_contents(n).dereference();k=this.number_check(m,e,n);if(!k)return;c.push(m.get_value());n++}return d.apply(null,c)}}.bind(this);return this.process_message(a,f,h,n)},typed_bird_function:function(a,d,b,e,h,n,f){var k=function(f,m){var n,c,k,w;if(0<=e&&m!=e+1)g.UTILITIES.display_message("Birds for the "+h+" function can only respond to boxes with "+(e+1)+" holes. Not "+m+" holes.");
else{k=[];for(c=1;c<m;){n=a.get_hole_contents(c).dereference();c<=b.length&&(w=b[c-1]);if(!this.type_check(w,n,h,c))return;k.push(n);c++}return d.apply(null,k)}}.bind(this);return this.process_message(a,k,n,f)},numeric_javascript_function_to_widget_function:function(a,d,b){return function(){var e=g.number.ZERO(g.number.function_bird_results_default_format);e.set_value_from_decimal(a.apply(null,g.UTILITIES.map_arguments(arguments,b||bigrat.toDecimal)));d&&e.set_approximate(!0);return e}},bigrat_function_to_widget_function:function(a,
d){return function(){var b=g.number.create_from_bigrat(a.apply(null,arguments));d&&b.set_approximate(!0);return b}},add_function_object:function(a,d,b,e,h){k[a]={name:a,short_name:e||a,respond_to_message:d,get_description:h?1===h.length?function(){return"If you give me a box with another bird and "+g.UTILITIES.add_a_or_an(h[0])+" then "+g.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+
g.UTILITIES.conjunction(h,!0)+" then "+g.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+g.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."},toString:function(){return g.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:b}},get_function_table:function(){return k}}}}(window.TOONTALK);window.TOONTALK.widget=function(g){var k=function(a){var d=this.get_frontside&&this.get_frontside(!0);if(d)return a&&this.rerender(),d.get_element()};g.creators_from_json.top_level=function(a){a=g.widget.create_top_level_widget(a.settings);$(a.get_backside(!0).get_element()).addClass("toontalk-top-level-backside");return a};return{add_standard_widget_functionality:function(a){var d=function(){return!1},b;this.add_sides_functionality(a);this.runnable(a);this.stackable(a);this.animatable(a);this.has_title(a);
this.has_parent(a);this.has_description(a);this.has_listeners(a);this.droppable(a);this.erasable(a);a.this_and_walk_children=function(b){b(a)&&a.walk_children&&a.walk_children(b)};a.top_level_widget=function(){var a;if(b)return b;if(this.is_top_level())return this;if(b=g.UTILITIES.widget_from_jquery($(this.get_frontside_element()).closest(".toontalk-top-level-backside")))return b;if(a=this.get_parent_of_frontside()||this.get_parent_of_backside())return b=a.get_widget().top_level_widget();a=$(".toontalk-top-level-backside");
if(0<a.length)return 1<a.length&&console.log("Cannot find the top-level widget of "+this+" but found "+a.length+" top-level backsides so picked one."),b=g.UTILITIES.widget_from_jquery(a);console.log("Could not find top_level_widget of "+this+". Created one instead");return b=this.create_top_level_widget()};a.is_of_type||(a.is_of_type=function(a){return this.get_type_name()===a});a.dereference||(a.dereference=function(){return this});a.is_number||(a.is_number=d);a.is_box||(a.is_box=d);a.is_empty_hole||
(a.is_empty_hole=d);a.is_hole||(a.is_hole=d);a.is_scale||(a.is_scale=d);a.is_bird||(a.is_bird=d);a.is_nest||(a.is_nest=d);a.is_robot||(a.is_robot=d);a.is_element||(a.is_element=d);a.is_sensor||(a.is_sensor=d);a.is_function_nest||(a.is_function_nest=d);a.is_plain_text_element||(a.is_plain_text_element=d);a.is_attribute_widget||(a.is_attribute_widget=d);a.maintain_proportional_dimensions||(a.maintain_proportional_dimensions=d);a.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};a.set_name&&
(a.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});!g.debugging&&!g.logging||a.to_debug_string||(a.to_debug_string=function(){var a=this.get_parent_of_frontside(),b=this._debug_id,d=this.get_description(),d=d?d+" ":"";b||(b=a&&a.id?"id of parent is "+a.id:"");return this.toString({plain_text:!0})+" ("+d+" "+(this.get_name&&this.get_name()+" "||"")+b+")"});a.is_top_level=d;a.is_widget=!0;return a},erasable:function(a){var d;a.get_erased||
(a.get_erased=function(){return d});a.set_erased||(a.set_erased=function(a,e){d=a;e&&this.rerender()});return a},add_sides_functionality:function(a){var d,b;a.get_frontside||(a.get_frontside=function(b){b&&!d&&(d=g.frontside.create(a));return d},a.save_dimensions=function(){return this.save_dimensions_of(this)},a.save_dimensions_of=function(a){var b;if(a.is_element()){if(!this.get_original_width())return;b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),
a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0},a.restore_dimensions=function(){var a,b;0<this.saved_width&&(a=this.get_frontside_element(),this.use_scaling_transform?this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.ok_to_set_dimensions()?this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):g.UTILITIES.set_css(a,{width:this.saved_width,height:this.saved_height}):(b={width:"",height:""},g.UTILITIES.set_css_transform(b,
""),g.UTILITIES.set_css(a,b)),this.saved_height=this.saved_width=void 0)});a.get_backside||(a.get_backside=function(a){a&&!b&&(b=this.create_backside());return b});a.set_backside||(a.set_backside=function(a){b=a});a.forget_backside||(a.forget_backside=function(){b=void 0});a.create_backside||(a.create_backside=function(){return g.backside.create(a)});return a},runnable:function(a){var d=!1,b=!1;a.get_running||(a.get_running=function(){var a=!1,b;d&&(b=this.get_backside_widgets(),0===b.length?d=!1:
b.some(function(b){if(b.get_widget().get_running())return a=!0}));return a});a.is_ok_to_run||(a.is_ok_to_run=function(){return b},a.set_ok_to_run=function(a){b=a});a.set_running||(a.set_running=function(e,h){var g=d===e,f,k;b=e;f=this.get_backside_widgets();d=e;this.get_backside()&&this.get_backside().run_status_changed(d);f.forEach(function(b){k=b.get_widget();b.is_backside()&&0<=this.backside_widgets.indexOf(k)||(k.is_robot()&&!k.being_trained?(d?(k.set_stopped(!1),k.run(a,h),k.set_ok_to_run(!0)):
(k.set_stopped(!0),k.set_running(!1)),k.rerender()):k.set_running&&(!h&&b.is_backside()&&"top-level"!==a.get_type_name()?k.set_running(e,a):k.set_running(e)))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(d);return!0});this.is_robot()&&(d?a.get_parent_of_backside()&&(this.set_stopped(!1),this.run(a.get_parent_of_backside().get_widget(),h)):this.set_stopped(!0));g||this.rerender()});return a},droppable:function(a){a.drop_on||(a.drop_on=function(a,b,e,
h){if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,b,e,h);console.log("No handler for drop of '"+this+"' on '"+a+"'")})},stackable:function(a){var d=!1;a.get_infinite_stack||(a.get_infinite_stack=function(){return d});a.set_infinite_stack||(a.set_infinite_stack=function(b){var e=a.get_backside_element(),h=a.get_frontside_element();d=b;e&&$(e).find(".toontalk-infinite-stack-check-box").prop("checked",b);h&&(b?$(h).addClass("toontalk-infinite-stack"):$(h).removeClass("toontalk-infinite-stack"))});
return a},animatable:function(a){var d;a.animate_to_widget||(d=function(a){var e=a.get_element();e&&(a.is_backside()||g.UTILITIES.visible_element(e))||(e=g.UTILITIES.find_resource_equal_to_widget(a));return e},a.animate_to_widget=function(a,e,h,g,f,k,p){var m=function(){this.animate_to_element(d(a),e,h,g,f,k,p&&Math.max(0,p-100));this.render()}.bind(this);0===p?m():setTimeout(m,100)});a.animate_to_element||(a.animate_to_element=function(a,e,h,d,f,k,p){var m=$(a).offset(),r=$(this.get_frontside_element()),
c=$(a).is(".toontalk-backside");if(a&&g.UTILITIES.visible_element(a)){if("number"===typeof a.animation_left_offset)d=a.animation_left_offset;else if("undefined"===typeof d||c)d=($(a).width()-r.width())*Math.random();if("number"===typeof a.animation_top_offset)f=a.animation_top_offset;else if("undefined"===typeof f||c)f=($(a).height()-r.height())*Math.random();m?(m.left+=d,m.top+=f):m={left:0,top:0};this.animate_to_absolute_position(m,e,h,k,p)}else e&&e()});a.animate_to_absolute_position||(a.animate_to_absolute_position=
function(a,e,h,d,f){g.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),a,e,h,d,f)});return a},has_title:function(a){a.get_title||(a.get_title=function(){var a=this.get_type_name(),b=this.get_backside(),e=this.get_frontside_element(),h=this.get_description(),n="";$(e).is(".toontalk-top-level-resource")?n=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":
"Drag me to a work area.":b&&b.get_element()&&g.UTILITIES.visible_element(b.get_element())||(n=this.can_run&&this.can_run()?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my back side and then click the green flag "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
".":"Click to see my back side.");h&&(h="I'm "+h,n=n?h+"\n"+n:h);if(this.get_erased())return this.get_title_of_erased_widget();n=this.get_custom_title_prefix&&!$(e).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+n:"I'm "+g.UTILITIES.add_a_or_an(a)+". "+n;n=n.trim();0>".?!".indexOf(n[n.length-1])&&(n+=".");return n});a.update_title=function(){g.UTILITIES.give_tooltip(this.get_frontside_element(),this.get_title())};return a},get_title_of_erased_widget:function(){var a=this.get_frontside_element(),
d=this.get_type_name();return a&&$(a).closest(".toontalk-conditions-contents-container").is("*")?"I'm an erased "+d+".\nI'll match with any other "+d+".":"I'm an erased "+d+".\nDusty the Vacuum can restore me to normal."},has_parent:function(a){var d=[],b,e;a.get_parent_of_frontside=function(){return b};a.get_parent_of_backside=function(){return e};a.set_parent_of_frontside=function(a,e,f){var g=b;a&&e&&(a=a.get_backside(!0));if(b===a)return;b=a;g&&!f&&!e&&g.is_backside()&&g.get_widget().remove_backside_widget(this,
!1,!0);d.forEach(function(a){a(g,b)})};a.add_parent_of_frontside_change_listener=function(a){d.push(a)};a.remove_parent_of_frontside_change_listener=function(a){a=d.indexOf(a);0<=a&&d.splice(a,1)};a.set_parent_of_backside=function(a,b,d){e&&!d&&e.is_backside()&&e.get_widget().remove_backside_widget(this,!0,!0);e=a&&b?a.get_backside(!0):a};a.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};a.closest_visible_ancestor_or_frontside=
function(){for(var a=this,b;a&&!g.UTILITIES.visible_element(a.get_frontside_element());)b=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=b.get_widget()):a=a.get_parent_of_frontside();return a||this};a.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};a.has_ancestor=function(a){for(var b=this;b;){if(a===b)return!0;b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside()}return!1};
a.remove_from_parent_of_frontside=function(a){b&&(b.is_backside()?b.remove_backside_widget(this,!1,!a):b.removed_from_container&&b.removed_from_container(this,!1,a,void 0,!0))};return a},has_description:function(a){var d;a.get_description||(a.get_description=function(){return d});a.set_description||(a.set_description=function(a,e){if(d===a||!d&&""===a)return!1;d=a;e&&this.rerender();return!0});a.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},
has_name:function(a){var d;a.get_name||(a.get_name=function(){"string"!==typeof d&&a.generate_name&&(d=a.generate_name());return d});a.set_name||(a.set_name=function(a,e){if(d===a||"string"!==typeof a)return!1;d=a;e&&this.rerender();return!0})},has_listeners:function(a){var d={};a.add_listener||(a.add_listener=function(a,e){var h=d[a];h?0>h.indexOf(e)&&h.push(e):d[a]=[e]});a.remove_listener||(a.remove_listener=function(a,e,h){if(a=d[a])if(e=a.indexOf(e),0<=e){a.splice(e,1);return}!h&&g.debugging&&
console.log("Listener of type "+type_name+" could not be removed.")});a.get_listeners||(a.get_listeners=function(a){return d[a]})},get_full_description:function(a){var d;if(this.get_erased&&this.get_erased())return a&&"conditions"===a.role?"any "+this.get_type_name():"erased "+this.get_type_name();d=this.get_description(a);a=this.toString(a);return d?a+" ("+d+")":a},remove:function(a,d){var b=this.get_backside(),e=this.get_frontside(),h=this.get_parent_of_frontside();this.get_parent_of_backside();
b&&b.hide_backside();e&&(e.remove(),h&&this.remove_from_parent_of_frontside(a));this.set_running(!1);this.set_visible(!1);this.walk_children&&!d&&this.walk_children(function(a){a.remove&&a.remove();return!0})},get_frontside_element:k,get_element:k,get_backside_element:function(a){if(a=this.get_backside&&this.get_backside(a))return a.get_element()},add_to_json:function(a,d){var b,e,h,n,f;if(a){a.view?(e=a,b=a.view,a=a.semantic):(b={},e={semantic:a,view:b});e.version=1;this.get_erased&&this.get_erased()&&
(a.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(a.infinite_stack=!0);this.get_running&&this.get_running()&&(a.running=!0);if(!this.get_parent_of_frontside()||this.get_parent_of_frontside().is_backside())if(h=this.get_frontside_element&&this.get_frontside_element())n=$(h).width(),$(h).is(".toontalk-plain-text-element")||0===n||(b.frontside_width=$(h).width(),b.frontside_height=$(h).height()),0!==n&&(b.frontside_left=g.UTILITIES.get_style_numeric_property(h,"left"),b.frontside_top=
g.UTILITIES.get_style_numeric_property(h,"top"));if(n=this.get_backside()){if(f=n.get_element())b.backside_width=$(f).width(),b.backside_height=$(f).height(),b.backside_left||(h=$(f).position(),b.backside_left=h.left,b.backside_top=h.top,"&lt;"===$(f).find(".toontalk-settings-backside-button").html()&&(b.advanced_settings_open=!0));n.get_backside_dimensions()&&(b.backside_geometry=n.get_backside_dimensions())}!b.backside_geometry&&this.backside_geometry&&(b.backside_geometry=this.backside_geometry);
a.description=this.get_description&&this.get_description();b.saved_width=this.saved_width;b.saved_height=this.saved_height;return e}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(a,d){var b=this.get_backside_widgets(),e;0<b.length&&(a.semantic.backside_widgets=g.UTILITIES.get_json_of_array(b,d),(b=this.get_backside_widgets_json_views())&&b.forEach(function(b,g){var f;if(e=a.semantic.backside_widgets[g]){if(0<=e.widget.shared_widget_index){f=d.widgets_encountered.indexOf(d.shared_widgets[e.widget.shared_widget_index]);
if(!d.json_of_widgets_encountered[f])return;f=d.json_of_widgets_encountered[f].view}else f=e.widget.view;e.is_backside?b.backside_left&&(f.backside_left=b.backside_left,f.backside_top=b.backside_top):b.frontside_left&&(f.frontside_left=b.frontside_left,f.frontside_top=b.frontside_top)}}))},get_backside_widgets:function(){return this.backside_widgets||[]},add_backside_widget:function(a,d){var b=this.get_backside(!0),e=d?a.get_backside():a;g.debugging&&a===this?g.UTILITIES.report_internal_error("Adding a widget to a list of its backside widgets!"):
(this.backside_widgets?0>this.backside_widgets.indexOf(e)&&this.backside_widgets.push(e):this.backside_widgets=[e],d?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),b.visible()&&(e.set_visible(!0),a.render()))},remove_all_backside_widgets:function(){if(this.backside_widgets)for(;0<this.backside_widgets.length;)this.backside_widgets[0].remove()},remove_backside_widget:function(a,d,b){this.get_backside();var e=d?a.get_backside(!0):a,h;this.backside_widgets?(h=this.backside_widgets.indexOf(e),
0>h?b?g.debugging&&console.log("Warning: Probable redundant call to remove_backside_widget"):g.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+e.get_widget()+" ("+e.get_widget()._debug_id+")"):(this.backside_widgets.splice(h,1),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(h,1),d?(d=a.get_parent_of_backside())&&d.get_widget()===this&&a.set_parent_of_backside(void 0,!0,!0):(d=a.get_parent_of_frontside())&&d.get_widget()===this&&
a.set_parent_of_frontside(void 0,void 0,!0),e.set_visible(!1))):b?g.debugging&&console.log("remove_backside_widget called and there are no backside_widgets"):g.UTILITIES.report_internal_error("Couldn't remove a widget from backside widgets.")},set_backside_widget_sides:function(a,d){var b=this.get_backside(),e=b&&b.visible();this.backside_widgets=a;0<a.length&&(this.get_backside()?this.get_backside().add_backside_widgets(a,d):this.backside_widgets_json_views=d,a.forEach(function(a){a&&(a.is_backside()?
a.get_widget().set_parent_of_backside(this,!0):a.get_widget().set_parent_of_frontside(this,!0),a.set_visible(e))}.bind(this)))},get_backside_widgets_json_views:function(a){!this.backside_widgets_json_views&&a&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var a=!1,d;this.get_backside_widgets().some(function(b){if(!b)return!1;d=b.get_widget();if(d.get_body&&!d.get_body().is_empty()||d.can_run())return a=!0});return a},add_to_copy:function(a,d){var b;
this.get_erased&&this.get_erased()&&(a.set_erased||g.widget.erasable(a),a.set_erased(this.get_erased()));d&&d.just_value||(b=this.get_backside_widgets(),0<b.length&&a.set_backside_widget_sides(g.UTILITIES.copy_widget_sides(b,d),this.get_backside_widgets_json_views()));a.set_visible(this.visible());return a},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(a,d,b){a||(a=this.copy({}));var e=this.get_frontside_element(),h=a.get_frontside_element(),
n=$(e).closest(".toontalk-backside"),f=a.ok_to_set_dimensions(),k,p;0===n.length&&(n=$(".toontalk-backside"));"undefined"===typeof d&&(d=30);"undefined"===typeof b&&(b=30);k=g.UTILITIES.relative_position(e,n.get(0));p=g.UTILITIES.widget_from_jquery(n);g.UTILITIES.set_css(h,{width:f?$(e).width():"",height:f?$(e).height():"",left:k.left+d,top:k.top+b,"z-index":g.UTILITIES.next_z_index()});n.get(0).appendChild(h);p&&p.add_backside_widget(a);this.robot_in_training()&&this.robot_in_training().copied(this,
a,!1);return a},visible:function(){var a;if(!document.hidden)return(a=this.get_frontside())?a.visible():!1},set_visible:function(a){var d=this.get_frontside(a);d&&d.set_visible(a)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},drag_started:function(a,d){this.robot_in_training()&&this.robot_in_training().picked_up(this,a,d)},match:function(a){console.assert(!1,"match not implemented for "+a.toString())},removed:function(a){g.UTILITIES.report_internal_error("removed not implemented")},
equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(a){var d=this.get_backside(),b=a&&function(){setTimeout(a)},e=function(a,c){g.UTILITIES.set_timeout(function(){$(a).addClass("toontalk-side-appearing");g.UTILITIES.add_one_shot_event_handler(a,"transitionend",2500,function(){$(a).removeClass("toontalk-side-appearing");b&&b()});g.UTILITIES.set_css(a,{left:k,top:p,opacity:c});this.apply_backside_geometry()}.bind(this))}.bind(this),h,n,f,k,p,m,r,c;if(d){h=d.get_element();
if(g.UTILITIES.visible_element(h))return g.UTILITIES.highlight_element(h,void 0,1E3),b&&b(),d;if((d=this.get_parent_of_backside())&&d.is_backside())return d.get_widget().open_backside(a)}n=this.get_frontside_element();f=$(n).parent();d=$(n);if(d.is(".toontalk-top-level-resource"))b&&b();else{for(;0<f.length&&!f.is(".toontalk-backside");)d=f,f=f.parent();d.get(0);d=this.get_backside(!0);h=d.get_element();h.toontalk_widget=this;m=$(n).offset();r=f.offset();c=f.width();r||(r={left:0,top:0});g.UTILITIES.set_css(h,
{left:m.left-r.left,top:m.top-r.top,opacity:.01});f.append(h);(f=g.UTILITIES.widget_from_jquery(f))&&f.add_backside_widget(this,!0);f=this.is_element()?this.get_attribute("height"):$(n).height();n=$(h).width();k=m.left-r.left;k+n>c&&(k=Math.max(0,c-n));p=m.top-r.top+f+34;this.is_box()&&(p+=28);e(h,"inherit");d.render();this.backside_widgets&&this.backside_widgets.forEach(function(a){a.is_backside()&&0<=this.backside_widgets.indexOf(a.get_widget())?a.hide_backside():(a.render(),a.set_visible(!0))}.bind(this));
return d}},hide_backside:function(){var a=this.get_backside();a&&a.hide_backside()},apply_backside_geometry:function(){var a=this.get_backside(!0),d=a.get_element();this.backside_geometry&&d&&(g.backside.scale_backside($(d),this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),a.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},
robot_started_training:function(a){this.top_level_widget().robot_started_training(a)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},backup_all:function(a){var d=this.top_level_widget();d&&d.save(a)},render:function(){g.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},location_constrained_by_container:function(){var a=this.get_parent_of_frontside();return a&&a.is_hole()?
!0:!1},close_button_ok:function(a){return"top-level"!==this.get_type_name()&&!$(a).is(".toontalk-top-level-resource")&&!$(a).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(a,d){var b=this.top_level_widget(),e=a.get_frontside_element(!0);b.add_backside_widget(a);b.get_backside_element().appendChild(e);a.render();d&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,b);return e},create_top_level_widget:function(a){var d=
Object.create(g.widget),b=[],e=function(){return!1};a||(a={});d.is_top_level=function(){return!0};d.is_number=e;d.is_box=e;d.is_empty_hole=e;d.is_scale=e;d.is_bird=e;d.is_nest=e;d.is_robot=e;d.is_element=e;d.is_sensor=e;d.is_function_nest=e;d.is_hole=e;d.is_plain_text_element=e;d.is_attribute_widget=e;d.ok_to_set_dimensions=e;d.get_json=function(b){b=this.get_backside(!0).get_element();b=document.defaultView.getComputedStyle(b,null).getPropertyValue("background-color");return{semantic:{type:"top_level",
settings:a},view:{background_color:b}}};d.get_type_name=function(){return"top-level"};d.is_of_type=function(a){return"top-level"===a};d.toString=function(){return"top level widget"};d.get_description=function(){};d.match=function(){return"matched"};d.update_display=function(){this.backside_widgets&&this.backside_widgets.forEach(function(a){a&&a.visible()&&a.update_display()})};d.copy=function(){return this};d.visible=function(){return!0};d.get_parent_of_frontside=function(){};d.get_parent_of_backside=
function(){};d.closest_visible_ancestor=function(){return this};d.get_infinite_stack=function(){return!1};d.top_level_widget=function(){return this};if(g.debugging||g.logging)d.to_debug_string=function(){var a=$(this.get_backside_element()).offset();return"top-level widget at "+Math.round(a.left)+", "+Math.round(a.top)};d=d.add_sides_functionality(d);d=d.runnable(d);d=d.has_parent(d);d.removed_from_container=function(a,b,e,d,g){this.robot_in_training()||this.remove_backside_widget(a,b,g)};d.widget_dropped_on_me=
function(a,b,e,d,g){return this.get_backside().widget_dropped_on_me(a,b,e,d,g)};d.get_element=function(){return this.get_backside().get_element()};d.get_setting=function(b,e){"undefined"!==typeof a[b]||e||(a[b]=g.DEFAULT_SETTINGS&&g.DEFAULT_SETTINGS[b]);return a[b]};d.set_setting=function(b,e){a[b]=e};d.open_settings=function(){g.SETTINGS.open(d)};d.robot_in_training=function(){if(0<b.length)return b[b.length-1]};d.robot_training_this_robot=function(){if(1<b.length)return b[b.length-2]};d.robot_started_training=
function(a){b.push(a)};d.robot_finished_training=function(){b.pop()};d.save=function(a,b,e){var d=this.get_setting("program_name",!0),k;d&&(b||(b={}),"undefined"===typeof b.google_drive&&(b.google_drive=g.google_drive&&this.get_setting("auto_save_to_google_drive")),"undefined"===typeof b.local_storage&&(b.local_storage=this.get_setting("auto_save_to_local_storage")),a?(b.google_drive&&!this.get_setting("google_drive_unavailable")&&(k=g.UTILITIES.get_json_top_level(this),a=g.google_drive.get_status(),
"Ready"===a?(g.google_drive.upload_file(d,"json",JSON.stringify(k,g.UTILITIES.clean_JSON),e),e=void 0):g.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===a?(g.UTILITIES.display_message_if_new("Unable to save to your Google Drive because you need to log in. Click on the settings icon "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-settings-icon'></span>")+" to log in."),g.UTILITIES.display_tooltip($(".toontalk-settings-button"))):console.log("Unable to save to Google Drive because: "+
a))),b.local_storage&&(k||(k=g.UTILITIES.get_json_top_level(this)),this.save_to_local_storage(k)),e&&e()):setTimeout(function(){this.save(!0,b,e)}.bind(this),100))};d.publish=function(a,b){g.publish.publish_widget(this.get_setting("program_name"),this,b,a)};d.save_to_local_storage=function(a,b){var e=this.get_setting("program_name"),d=g.UTILITIES.local_storage_program_key(e),k=g.UTILITIES.local_storage_program_meta_data_key(e),m,r,c;b||(b=Date.now());try{r=(r=window.localStorage.getItem(k))?JSON.parse(r):
{created:b},r.last_modified=b,c=JSON.stringify(a,g.UTILITIES.clean_json),r.file_size=c.length,window.localStorage.setItem(k,JSON.stringify(r)),window.localStorage.setItem(d,c),window.localStorage.setItem("toontalk-last-key",d),m=g.UTILITIES.get_all_locally_stored_program_names(),0>m.indexOf(e)&&(m.push(e),g.UTILITIES.set_all_locally_stored_program_names(m))}catch(q){e=c?"Failed to save state to local storage since it requires "+c.length+" bytes. Error message is "+q:"Error while saving to local storage. Error message is "+
q,g.UTILITIES.is_internet_explorer()?console.error(e):g.UTILITIES.display_message(e),this.last_local_storage_error=e}};d.load=function(a,b,e){var k=this.get_setting("program_name"),p=k+".json",m=g.UTILITIES.local_storage_program_key(k),r=function(a){var c;if(a)try{c=JSON.parse(a),d.remove_all_backside_widgets(),g.UTILITIES.add_backside_widgets_from_json(d,c.semantic.backside_widgets,{json_of_shared_widgets:c.shared_widgets,shared_widgets:[],shared_html:c.shared_html}),b&&b()}catch(h){g.UTILITIES.display_message("Error encountered loading "+
k+" : "+h)}else e&&e()},c=function(a){a?g.google_drive.download_file(a,r):r(window.localStorage.getItem(m))};a&&g.google_drive&&"Ready"===g.google_drive.get_status()?g.google_drive.get_toontalk_program_file(p,c):r(window.localStorage.getItem(m))};d.walk_children=function(){};d.render=function(){};d.location_constrained_by_container=function(){return!1};d.is_widget=!0;d.get_backside(!0).set_visible(!0);g.debugging&&(d._debug_id=g.UTILITIES.generate_unique_id(),d.debug_string="Top-level widget");return d}}}(window.TOONTALK);window.TOONTALK.backside=function(g){return{create:function(k){var a=Object.create(this),d=document.createElement("div"),b=$(d),e=1,h=1,n=document.createElement("div"),f=document.createElement("div"),t=k.get_help_URL&&k.get_help_URL(),p,m,r,c,q,w,v,D,H,I,A,G=function(a){a?($(n).addClass("toontalk-green-flag-active").removeClass("toontalk-green-flag-inactive"),$(f).addClass("toontalk-stop-sign-inactive").removeClass("toontalk-stop-sign-active")):($(n).addClass("toontalk-green-flag-inactive").removeClass("toontalk-green-flag-active"),
$(f).addClass("toontalk-stop-sign-active").removeClass("toontalk-stop-sign-inactive"))},C=function(){var a=b.width();b.height();var c,l,e;0===a?setTimeout(C,100):(a=$(f).width(),c=(c=$(v).width())?c+14:0,$(f).css({right:c}),$(n).css({right:c+a+6}),l=$(n).width(),H&&$(H).css({right:c+a+l+12}),p&&(e=$(H).width()||0,$(p).css({right:c+a+l+e+12})))};D=this.create_description_label(a,k);var z=function(){var a;a=k.get_running()?"To stop this click on the stop sign "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):
k.can_run()?"Click this to start this running.":"There is nothing to run on this.";g.UTILITIES.give_tooltip(n,a)},E=function(){var a;a=k.get_running()?"Click to stop this from running.":k.can_run()?"This has stopped. Click on the flag "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";g.UTILITIES.give_tooltip(f,a)},F,K,l,u,x;g.TRANSLATION_ENABLED&&(t=g.UTILITIES.add_URL_parameter(t,"translate","1"));k.close_button_ok(d)&&
(K=function(c){var l=function(){a.hide_backside(c);k.robot_in_training()&&k.robot_in_training()!==k&&k.robot_in_training().backside_closed(k)},e,d;k.get_running()?(e=k.get_backside_widgets(),e.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(l),d=a,!0}),d?d.add_body_finished_listener(function(){b.css({opacity:1});l()}):l(),b.css({opacity:1}),b.addClass("toontalk-animating-element"),b.css({opacity:0})):l();c.stopPropagation()},F=(F=k.get_description())?"the "+k.get_type_name()+
" who "+F:"the "+k.get_type_name(),v=g.UTILITIES.create_close_button(K,"Click to hide this back side of "+F+"."),d.appendChild(v));$(n).addClass("toontalk-green-flag toontalk-green-flag-inactive").click(function(a){k.can_run()?(G(!0),k.set_running(!0),E()):k.is_top_level()?g.UTILITIES.display_message("There is nothing to run."):g.UTILITIES.display_message("This "+k.get_type_name()+" has nothing to run. Add some robots on the back.");k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-green-flag",
k);a.stopPropagation()}).on("mouseenter",E);$(f).addClass("toontalk-stop-sign toontalk-stop-sign-active").click(function(a){G(!1);k.set_running(!1);z();k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-stop-sign",k);a.stopPropagation()}).on("mouseenter",z);d.appendChild(n);d.appendChild(f);g.UTILITIES.use_custom_tooltip(n);g.UTILITIES.use_custom_tooltip(f);t&&(x=0>t.indexOf("://"),H=document.createElement(x?"div":"a"),$(H).addClass("toontalk-help-button notranslate toontalk-widget-help-button").click(function(a){x?
(I=document.createElement("iframe"),$(I).addClass("toontalk-help-frame"),I.src=t,document.body.appendChild(A),document.body.appendChild(I),a.stopPropagation()):(H.href=t,H.target="_blank")}),H.innerHTML="i",H.translate=!1,g.UTILITIES.give_tooltip(H,"Click to learn more about "+k.get_type_name(!0,!0)+"."),A=document.createElement("div"),$(A).addClass("toontalk-close-help-frame-button").button().click(function(a){$(I).remove();$(A).remove();a.stopPropagation()}),A.innerHTML="Return to ToonTalk",d.appendChild(H));
D&&d.appendChild(D);k.is_top_level()&&(p=document.createElement("div"),$(p).addClass("toontalk-settings-button").click(function(a){k.open_settings();a.stopPropagation()}),d.appendChild(p),g.UTILITIES.give_tooltip(p,"Click to change settings or open a different program."));g.UTILITIES.set_timeout(C);b.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+k.get_type_name());b.css({"z-index":g.UTILITIES.next_z_index()});a.get_element=function(){return d};a.get_backside_element=function(){return d};
a.get_widget=function(){return k};a.visible=function(){return m};a.set_visible=function(a){var b=this.get_widget().get_backside_widgets();m=a;b.forEach(function(b){b&&(b.set_visible(a),a&&b.render())})};k.get_backside||(k.get_backside=function(){return a});a.get_parent_of_backside=function(){return k.get_parent_of_backside()};a.get_parent_of_frontside=function(){return k.get_parent_of_frontside()};a.get_frontside=function(){return k.get_frontside()};a.get_frontside_element=function(){return k.get_frontside_element()};
a.get_description_text_area=function(){return l};a.set_description_text_area=function(a){l=a};a.get_name_text_input=function(){return u};a.set_name_text_input=function(a){u=a};k.removed_from_container||(k.removed_from_container=function(a,b,c,l,e){k.robot_in_training()||this.remove_backside_widget(a,b,e)});a.widget_dropped_on_me=function(a,c,l,e,d){var h,f,m;g.sounds&&l&&g.sounds.drop.play();c?(h=a.get_backside(!0),f=h.get_element(),h.rerender()):(h=a.get_frontside(!0),f=h.get_element(),a.rerender());
h=$(f);b.append(h);this.get_widget().is_top_level()&&e&&!e.visible()&&h.addClass("toontalk-widget-added-to-backside-by-unwatched-robot");g.UTILITIES.set_position_is_absolute(f,!0,l);k.robot_in_training()&&!d&&l&&setTimeout(function(){k.robot_in_training().dropped_on(a,this,l)}.bind(this));c&&"top-level"!=this.get_widget().get_type_name()&&(m=a.get_backside(),a.forget_backside(),a.remove(l),a.set_backside(m));this.add_backside_widget(a,c);a.dropped_on_other&&a.dropped_on_other(this.get_widget(),!0,
l,e);l&&a.get_body&&a.get_body().is_empty()&&!a.being_trained&&setTimeout(function(){(m=a.open_backside())&&$(m.get_element()).find(".toontalk-train-backside-button").click()});l&&a.get_widget().backup_all();return!0};a.add_backside_widget=function(a,b){return this.get_widget().add_backside_widget(a,b)};a.add_backside_widgets=function(a,c){0!==a.length&&g.UTILITIES.set_timeout(function(){var l=this.visible(),e,h,f;a.forEach(function(a,m){if(a){var u=a.get_widget().get_backside();e=a.get_element();
e.toontalk_widget=a.get_widget();c&&(h=c[m])&&(a.is_backside()?(f={left:h.backside_left,top:h.backside_top,width:h.backside_width,height:h.backside_height},a.get_widget().apply_backside_geometry(),h.advanced_settings_open&&u.set_advanced_settings_showing(!0,u.get_element())):(0===h.frontside_width&&(h.frontside_width=""),0===h.frontside_height&&(h.frontside_height=""),f={left:h.frontside_left,top:h.frontside_top,width:h.frontside_width,height:h.frontside_height}),g.UTILITIES.constrain_css_to_fit_inside(d,
f),$(e).css(f));b.append(e);a.set_visible(l);a.get_widget().rerender()}})}.bind(this),100)};a.get_backside_dimensions=function(){if(1!==e||1!==h)return{x_scale:e,y_scale:h,original_width:r,original_height:c}};a.set_dimensions=function(a){e=a.x_scale;h=a.y_scale;r=a.original_width;c=a.original_height};a.scale_to_fit=function(a,b){var l;!r&&this.get_widget().backside_geometry&&(r=this.get_widget().backside_geometry.original_width,c=this.get_widget().backside_geometry.original_height);l=g.UTILITIES.scale_to_fit(a,
b,r,c);e=l.x_scale;h=l.y_scale};a.run_status_changed=function(a){G(a)};if(g.debugging||g.logging)a.to_debug_string=function(){return"backside of "+this.get_widget().to_debug_string()};d.toontalk_widget=k;g.UTILITIES.drag_and_drop(d);b.resizable({start:function(){q=b.width();w=b.height();r||(r=q);c||(c=w)},resize:function(a,l){var d=l.size.width,f=l.size.height;b.is(".toontalk-top-level-backside")||(e*=d/q,h*=f/w,q=d,w=f,g.backside.scale_backside(b,e,h,r,c))},handles:"e,s,se"});d.addEventListener("mouseenter",
function(a){a=k.get_frontside();var b=k.get_parent_of_backside();!a||b&&!b.get_widget().is_top_level()||g.UTILITIES.highlight_element(a.get_element())});d.addEventListener("mouseleave",function(a){k.is_top_level()||g.UTILITIES.remove_highlight()});a.update_display=function(){var b=this.get_description_text_area(),c=this.get_name_text_input(),l;b&&(l=this.get_widget().get_description())&&(b.button.value=l);c&&(c.button.value=this.get_widget().get_name());a.display_updated()};a.display_updated=function(){var a=
$(this.get_element());r||(r=a.width());c||(c=a.height())};k.get_backside_widgets&&(D=k.get_backside_widgets(),a.add_backside_widgets(D,k.get_backside_widgets_json_views()));g.debugging&&(d.id=k.debug_id);return a},toString:function(){return"backside of "+this.get_widget()},remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(k,a){var d=g.UTILITIES.create_check_box(a.get_infinite_stack(),"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+
a.get_type_name()+" to be copied instead of moved.");$(d.button).click(function(b){var e=d.button.checked,h;a.set_infinite_stack(e);a.robot_in_training()&&(h=e?"change dragging to make a copy of ":"change dragging back to moving for ",a.robot_in_training().edited(a,{setter_name:"set_infinite_stack",argument_1:e,toString:h,button_selector:".toontalk-infinite-stack-check-box"}));b.stopPropagation()});return d},create_description_label:function(k,a){var d=a.get_description();if(d)return g.UTILITIES.create_text_element("I'm the back side of a "+
a.get_type_name()+" that is "+d)},add_advanced_settings:function(k){var a=this.get_widget(),d=this.create_infinite_stack_check_box(this,a),b=a.get_type_name(),e=g.UTILITIES.create_text_area(a.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+b+".",function(b){(b=g.UTILITIES.input_area_drop_handler(b,a.receive_description_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(b,a,{area_selector:".toontalk-description-input",
setter:"receive_description_from_dropped",toString:"for a widget's description"})}),h=$("<button>Make a sensor nest</button>").button(),n=$("<button>Make a function bird</button>").button(),f=function(){var c=e.button.value.trim();a.set_description(c,!0)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_description",argument_1:c,toString:"change the description to '"+c+"'' of the "+b,button_selector:".toontalk-description-input"})},t=document.createElement("table"),p=this.get_element(),
m=function(b,c){var e=a.get_parent_of_frontside(),d=b.get_frontside_element(!0),h;e&&e.add_backside_widget&&!e.get_widget().is_top_level()?(e.add_backside_widget(b),h=e.get_element(),h.appendChild(d),e=$(h).offset(),e.top+=.6*$(h).height()):(a.add_to_top_level_backside(b,!1),e=c.offset(),e.left-=120,0>e.left&&(e.left=0));g.UTILITIES.set_absolute_position($(d),e)},r=$(p).find(".toontalk-settings-backside-button").get(0),c,q;a.set_name&&(q=function(b){(b=a.receive_name_from_dropped&&g.UTILITIES.input_area_drop_handler(b,
a.receive_name_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(b,a,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})},c=g.UTILITIES.create_text_input(a.get_name(),"toontalk-name-input",a.get_name_input_label?a.get_name_input_label():"My name is ",a.get_name_input_title?a.get_name_input_title():"Edit the name of this "+b+". There is not much room so keep it short.",void 0,"text",q),q=function(){var e=
c.button.value.trim();a.set_name(e,!0)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_name",argument_1:e,toString:"change the name to '"+e+"'' of the "+b,button_selector:".toontalk-name-input"})},c.button.addEventListener("change",q),c.button.addEventListener("mouseout",q),this.set_name_text_input(c));$(t).addClass("toontalk-advanced-setting");$(e.button).val(a.get_description());e.button.addEventListener("change",f);e.button.addEventListener("mouseout",f);this.set_description_text_area(e);
h.addClass("toontalk-make-sensor_nest_button").click(function(b){var c=g.sensor.create("click","which",void 0,void 0,!0,a);m(c,h);a.robot_in_training()&&a.robot_in_training().created_widget(c,a,".toontalk-make-sensor_nest_button");b.stopPropagation()});h.attr("title","Click to create a nest which receives messages when events happen to this "+a.get_type_name()+".");n.addClass("toontalk-make-function_bird_button").click(function(c){var e=a.get_function_type&&a.get_function_type(),e=g.bird.create_function(e||
b);m(e,n);a.robot_in_training()&&a.robot_in_training().created_widget(e,a,".toontalk-make-function_bird_button");c.stopPropagation()});a.is_number()||a.is_box()?n.attr("title","Click to get a bird that flies to functions of "+a.get_type_name(!0)+"."):(n.attr("title","There are no functions that operate on "+a.get_type_name(!0)+" (yet)."),n.button("option","disabled",!0));k||t.appendChild(g.UTILITIES.create_row(e.container));if(1<arguments.length)for(f=1;f<arguments.length;f++)t.appendChild(arguments[f]);
c&&!k&&t.appendChild(g.UTILITIES.create_row(c.container));t.appendChild(g.UTILITIES.create_row(h.get(0),n.get(0),d.container));k&&(p.insertBefore(g.UTILITIES.create_row(e.container),r),c&&p.insertBefore(g.UTILITIES.create_row(c.container),r));p.appendChild(t);$(p).find(".toontalk-advanced-setting").hide()},get_type_name:function(){return"the backside of "+g.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(k){var a=this.get_widget(),d=a.get_frontside_element(),b=$(a.get_backside_element()),
e=b.position(),h=b.parent().closest(".toontalk-backside"),n=function(){var b=a.get_backside_widgets(),e=a.get_backside_widgets_json_views(!0);this.get_backside_dimensions();var d;b.forEach(function(a,b){a.get_widget();var h;if(d=a.get_element())e[b]||(e[b]={}),a.start_position?(h=a.start_position,a.start_position=void 0):h=$(d).position(),a.is_backside()?(e[b].backside_left=g.UTILITIES.left_as_percent(h.left,d),e[b].backside_top=g.UTILITIES.top_as_percent(h.top,d)):(e[b].frontside_left=g.UTILITIES.left_as_percent(h.left,
d),e[b].frontside_top=g.UTILITIES.top_as_percent(h.top,d))})}.bind(this),f=a.get_parent_of_backside();g.UTILITIES.remove_highlight();n();a.backside_geometry=this.get_backside_dimensions();f&&(f.is_backside()?a.set_parent_of_backside(void 0,!0):f.removed_from_container(a,!0,k,void 0,!0),a.forget_backside&&a.forget_backside());(function(a){var b=$(d).offset(),e=h.position(),f=function(){a.remove()};a.is(":visible")&&("0"===a.css("opacity")?(a.removeClass("toontalk-animating-element"),a.remove()):(a.addClass("toontalk-side-appearing"),
g.UTILITIES.add_one_shot_event_handler(a.get(0),"transitionend",2500,f),e||(e={left:0,top:0}),g.UTILITIES.set_css(a,{left:b.left-e.left,top:b.top-e.top,opacity:.1})))})(b);this.set_visible(!1);k&&!g.UTILITIES.visible_element(d)&&(e&&g.UTILITIES.set_css(d,{left:e.left,top:e.top}),k=g.UTILITIES.widget_from_jquery(h))&&(k.add_backside_widget(a),h.append(d),a.render());a.backside_widgets&&a.backside_widgets.forEach(function(a){a.set_visible(!1)});if(a.on_backside_hidden)a.on_backside_hidden()},create_advanced_settings_button:function(k,
a){var d=document.createElement("div"),b=$(d),e=!1;d.innerHTML="&gt;";b.addClass("toontalk-settings-backside-button");b.css({"z-index":g.UTILITIES.next_z_index()});b.click(function(d){e=!e;this.set_advanced_settings_showing(e,k.get_element(),b);d.stopPropagation();a.robot_in_training()&&a.robot_in_training().button_clicked(".toontalk-settings-backside-button",k)}.bind(this));g.UTILITIES.give_tooltip(b.get(0),"Click to see the advanced settings of this "+a.get_type_name()+".");return b.get(0)},set_advanced_settings_showing:function(k,
a,d){a||(a=this.get_element());d||(d=$(a).find(".toontalk-settings-backside-button"));k?($(a).find(".toontalk-advanced-setting").show(),d.html("<"),g.UTILITIES.give_tooltip(d.get(0),"Click to hide the advanced settings.")):($(a).find(".toontalk-advanced-setting").hide(),d.html(">"),g.UTILITIES.give_tooltip(d.get(0),"Click to show the advanced settings."))},get_widgets:function(){var g=[];$(this.get_element()).children().each(function(a,d){var b=d.toontalk_widget;b&&0>g.indexOf(b)&&g.push(b)});return g},
scale_backside:function(k,a,d,b,e){var h=Math.min(1,a,d);1===a&&1===d?g.UTILITIES.set_css(k,{width:"",height:""}):g.UTILITIES.set_css(k,{transform:"scale("+h+", "+h+")","transform-origin":"left top",width:b*a/h,height:e*d/h})},render:function(){g.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&g.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(g,a,d){return this.get_widget().remove_backside_widget(g,a,d)},remove:function(){this.get_widget().remove()},
is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},is_of_type:function(g){return this.get_widget().is_of_type(g)},is_hole:function(){return!1},save_dimensions:function(){return!1}}}(window.TOONTALK);window.TOONTALK.frontside=function(g){return{create:function(k){var a=Object.create(this),d=document.createElement("div"),b=$(d),e=function(a){if(!$(a.target).is(".ui-resizable-handle")&&("click"!==a.type||1===a.which)){if(b.is(".toontalk-top-level-resource"))k.set_running(!k.get_running());else if(!k.get_running()||k.robot_in_training())k.open_backside(),k.robot_in_training()&&k.robot_in_training().backside_opened(k);a.stopPropagation()}},h;$(d).addClass("toontalk-frontside toontalk-side");d.toontalk_widget=
k;g.UTILITIES.drag_and_drop(d);a.get_element=function(){return d};a.get_widget=function(){return k};a.visible=function(){return h};a.set_visible=function(a){var b;h!==a&&(h=a,b=this.get_widget(),b.walk_children&&b.walk_children(function(b){b.set_visible(a);return!0}))};d.addEventListener("click",e);d.addEventListener("touchstart",e);d.addEventListener("mouseenter",function(a){var b=k.get_backside(),e=(k.is_empty_hole()?wiget.get_parent_of_frontside():k).get_frontside_element();b&&g.UTILITIES.highlight_element(b.get_element());
$(".toontalk-wiggle").removeClass("toontalk-wiggle");$(e).is(".toontalk-top-level-resource")||$(e).addClass("toontalk-wiggle");a.stopPropagation()});d.addEventListener("mouseleave",function(a){a=k.get_backside();var b=k.is_empty_hole()?wiget.get_parent_of_frontside():k;a&&g.UTILITIES.remove_highlight();$(b.get_frontside_element()).removeClass("toontalk-wiggle")});g.debugging&&(d.id=k.debug_id);return a},update_display:function(){return this.get_widget().update_display()},remove:function(){$(this.get_element()).remove()}}}(window.TOONTALK);(function(g){var k=180/Math.PI,a=Math.log(10),d=bigrat.fromInteger(10),b=bigrat.fromValues(1,2),e=bigrat.fromValues(-1,2),h=bigrat.fromInteger(360),n=bigrat.fromDecimal(2*Math.PI),f=Math.log10?Math.log10:function(b){return Math.log(b)/a},t=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},p=function(a){var b=t(a),c=g.number.ZERO(g.number.function_bird_results_default_format),e=g.number.ZERO(g.number.function_bird_results_default_format);
c.set_value(b.integer_part);e.set_value(b.fractional_part);return g.box.create(2,!0,[c,e],"The integer and fraction parts of "+a.toString().replace(",","/"))},m=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),e=t(c);return bigrat.multiply(c,e.fractional_part,b)},r=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,e)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.isLessThan(a.fractional_part,b)?a.integer_part:bigrat.add(a.integer_part,
a.integer_part,bigrat.ONE)},c=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},q=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(g.widget),b=function(a,b,c,l){var e="",d=100;c=50/c;b/=1+b;if(l)for(l=0;d>=c&&
l<a.length;)e=e+"<span class='toontalk-digit' style='font-size:"+d+"%'>"+a[l]+"</span>",l+=1,"-"!==a[l]&&(d*=b);else for(l=a.length-1;d>=c&&0<l;)e="<span class='toontalk-digit' style='font-size:"+d+"%'>"+a[l]+"</span>"+e,--l,"-"!==a[l]&&(d*=b);return e},c=function(a,b){var c=a/(1+a);return Math.ceil(Math.log(.5/b)/Math.log(c))},e=function(a,c,d){if(a.length<=Math.round(c))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>c)return"";if(5>c)return"<span style='font-size: 80%'>"+
e(a,1.25*c,.8*d)+"</span>";c=c/2-1;return b(a,c,d,!0)+b(a,c,d,!1)},h=function(a,b){bigrat.isNegative(a)&&bigrat.abs(a,a);var c;a:{c=bigrat.fromValues(a[0],1);var l=bigrat.fromValues(a[1],1),e="",h=bigrat.create(),f=bigrat.create(),g=bigrat.create();for(bigrat.multiply(c,c,d);b>e.length;){if(bigrat.isLessThan(c,l))e+="0";else if(bigrat.divide(h,c,l),f=bigrat.toBigInteger(h),e+=f.toString(),bigrat.subtract(g,h,bigrat.fromValues(f,1)),bigrat.multiply(c,g,l),bigrat.equals(c,bigrat.ZERO)){c=e=m(e);break a}bigrat.multiply(c,
c,d)}c=e}return c},m=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?m(a.substring(0,a.length-1)):a},k=function(a,b){var c=Math.min(b,a/2);return a-(c+1)},n=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},q=function(a){switch(a){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return g.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";a.create=function(b,c,e,l,d,h){var f=Object.create(a),m=n(b,c);e||(e="+");f.is_number=function(){return!0};f.set_value=function(a,b){if(b||
!bigrat.equals(m,a))return this.fire_value_change_listeners(m,a),m=a,this.rerender(),g.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&g.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),this};f.set_value_from_sub_classes=f.set_value;f.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),l;c&&(l={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(l)}))};
f.get_value=function(){return m};f.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));g.debugging&&"0,0"===this.get_value().toString()&&g.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};f.copy=function(b){return this.add_to_copy(a.create(m[0],m[1],e,l,d,h),b)};f.get_format=function(){return l||a.default_format};f.set_format=function(a,b){l=a;b&&this.rerender();return this};f.get_operator=function(){return e};f.set_operator=function(a,b){e=a;b&&this.rerender();
return this};f.get_approximate=function(){return h};f.set_approximate=function(a,b){h=a;b&&this.rerender();return this};f=a.add_standard_widget_functionality(f);f.set_description(d);g.debugging&&(f._debug_string=f.toString(),f._debug_id=g.UTILITIES.generate_unique_id(),m._debug_id_new=f._debug_id);return f};a.create_from_bigrat=function(a){var b=g.number.ZERO();b.set_value(a);return b};a.create_backside=function(){return g.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(n(a,
b))};a.set_numerator=function(a){return this.set_value(n(a,this.get_value()[1].toString()))};a.set_denominator=function(a){return this.set_value(n(this.get_value()[0].toString(),a))};a.ONE=function(){return g.number.create(1)};a.ZERO=function(a){return g.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};
a.compare_with_number=function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),b=28,c,l,e,d;g.logging&&0<=g.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());a=a.get_element();$(a).is(".toontalk-conditions-contents")?c=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json")?(c=$(a),d=!0):c=$(a).parent().is(".toontalk-scale-half")?$(a):
$(a).parent();0===c.length&&(l=this.get_parent_of_frontside())&&(l.get_widget().is_hole()&&(l=l.get_parent_of_frontside()),c=$(l.get_frontside_element()));if($(a).is(".toontalk-carried-by-bird"))e=l=100;else if($(a).is(".toontalk-element-attribute"))l=200,e=32;else{if(!g.UTILITIES.visible_element(c.get(0))){g.logging&&0<=g.logging.indexOf("display")&&console.log("Container not visible so no display of "+this.to_debug_string());return}l=c.width();e=c.height();if(0===l||0===e){g.logging&&0<=g.logging.indexOf("display")&&
console.log("Container has zero dimensions so no display of "+this.to_debug_string());return}c.is(".toontalk-nest")&&(l*=g.nest.CONTENTS_WIDTH_FACTOR,e*=g.nest.CONTENTS_HEIGHT_FACTOR)}$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");b=this.get_border_size(l,e);4===b?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):8===b?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):
16===b?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number");b=e-2*b;d=this.to_HTML(l/(.64*b),b,this.get_format(),!0,this.get_operator(),d);g.UTILITIES.on_a_nest_in_a_box(a)&&(l="width:"+l+"px;",b=d.indexOf('style="'),d=0<=b?d.substring(0,b+7)+l+d.substring(b+7):d);l=$(a).children(".toontalk-widget");l.is("*")?l=l.get(0):(l=document.createElement("div"),a.appendChild(l));l.innerHTML=d;l.translate=!1;$(l).addClass("toontalk-widget notranslate");
c.is(".toontalk-box-hole")&&$(a).css({width:"",height:""});g.UTILITIES.give_tooltip(a,this.get_title())};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};a.to_HTML=function(a,m,n,l,u,x){var r,p,t,w,A,C,N=!1!==l?" toontalk-top-level-number":"";this.is_attribute_widget&&this.is_attribute_widget()?N+=" toontalk-attribute-number":this.get_approximate()&&(N+=" toontalk-approximate-number");x&&(N+=" toontalk-number-size-unconstrained-by-container");p=u?q(u):"";
a||(a=4);m||(m=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+N+'" style="font-size: '+m+'px;"></div>';0<p.length&&(--a,2>a&&(m*=Math.max(1,a)/2,a=2));if(this.is_integer()&&"scientific_notation"!==n){try{r=bigrat.toBigInteger(this.get_value()).toString()}catch(X){g.UTILITIES.report_internal_error("Error converting number to a string: "+X),r="0"}l=r.length;0<p.length&&l++;4>a&&l>a&&(l=Math.min(4,l),m*=a/l,a=l);return'<div class="toontalk-number toontalk-integer'+
N+'" style="font-size: '+m+'px;">'+p+e(r,a,m)+"</div>"}r=' style="font-size:'+.4*m+'px;"';if("improper_fraction"===n||!n)return m='<table class="toontalk-number toontalk-improper-fraction'+N+'"'+r+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+e(this.numerator_string(),2*a,m)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+
e(this.denominator_string(),2*a,m)+"</td></tr></table>",""===p?m:"<table class='toontalk-operator-and-fraction'"+r+"><tr><td>"+p+"</td><td>"+m+"</td></tr></table>";if("mixed_number"===n||"proper_fraction"===n){p=this.integer_part();if(p.is_zero())return this.to_HTML(a,m,"improper_fraction",l,u);l=this.copy({just_value:!0}).subtract(p).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+N+'"'+r+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+p.to_HTML(a/
2,m,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+l.to_HTML(a/2,m,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===n)return 4>a&&(m*=Math.max(1,a)/4,a=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+N+'" style="font-size: '+m+'px;">'+p+this.decimal_string(a,m)+"</div>";if("scientific_notation"===n){C=bigrat.isNegative(this.get_value());t=this.get_value();w=bigrat.abs(bigrat.create(),t);t=bigrat.isLessThan(w,
bigrat.ONE);w=(t?bigrat.toBigInteger(bigrat.divide(bigrat.create(),bigrat.ONE,w)):bigrat.toBigInteger(w)).toString();t=t?-w.length:w.length-1;w=bigrat.power(bigrat.create(),d,t+1);A=bigrat.divide(bigrat.create(),this.get_value(),w);w=6+(0===t?1:Math.ceil(f(Math.abs(t)))/2);C&&w++;if(a<w+1)return this.to_HTML(w+1,m*a/(w+1),n,l,u,x);l=c(k(a,w),m);l=h(A,l);u=C?"-"+l.substring(0,1):l.substring(0,1);l=l.substring(1);a=b(l,a*(1-w/a),m,!0);0<a.length&&(a="<span class='toontalk-decimal-point'>.</span>"+a);
return'<table class="toontalk-number toontalk-scientific_notation'+N+'"'+r+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+N+'" style="font-size: '+.9*m+'px;">'+p+u+a+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+m+'px;"> &times;10<sup style="font-size: '+m/2+'px;">'+t+"</sup></div></td></tr></table>"}};a.drop_on=function(a,b,c,l){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,
b,c,l),!0;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,b,c,l);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,b,c,l){var e,d,h,f;if(a.visible()&&(c||l)){if(l){if(!l.animate_consequences_of_actions())return a.remove(),this.number_dropped_on_me_semantics(a,c,l);a.robot_waiting_before_next_step=l}e=document.createElement("div");$(e).addClass("toontalk-bammer-down");d=$(this.get_frontside_element()).closest(".toontalk-top-level-backside");
e.style.left="-10px";e.style.top=d.height()+"px";d.append(e);b=this.get_frontside_element();h=$(b).offset();h.left-=.75*$(e).width();h.left+=.5*$(b).width()+.1*$(e).width();h.top-=.5*$(b).height()+.4*$(e).height();b=function(){g.sounds&&g.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,c,l)&&l&&l.run_next_step();c&&this.backup_all();$(e).removeClass("toontalk-bammer-down");g.UTILITIES.set_timeout(function(){var a=d.offset();a||(a={left:0,top:0});$(e).addClass("toontalk-bammer-away");
h.left=a.left+d.width()-100;h.top=a.top+d.height()+100;f=function(){$(e).remove()};g.UTILITIES.animate_to_absolute_position(e,h,f,l&&l.transform_animation_speed(g.UTILITIES.default_animation_speed));$(e).css({opacity:.01})})}.bind(this);g.UTILITIES.animate_to_absolute_position(e,h,b,l&&l.transform_animation_speed(g.UTILITIES.default_animation_speed));$(e).css({opacity:1,"z-index":g.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c,l)};a.number_dropped_on_me_semantics=
function(a,b,c){b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove();switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "=":return this.set_value(a.get_value());case "^":return this.power(a);default:g.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_dropped_on_me=
function(a,b,c,l){return a.number_dropped_on_me?this.number_dropped_on_me(a,b,c,l):!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.divide=function(a){this.set_value(bigrat.divide(this.get_value(),
this.get_value(),a.get_value()),!0);return this};a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);
return this};a.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(){return this.get_erased()?"erased number":("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};a.operator_word=function(a){switch(this.get_operator()){case "+":return"add "+a+" to";case "-":return"subtract "+a+" from";case "*":return"multiply "+a+" with";case "/":return"divide "+a+" into"}};a.get_text=
function(){return this.is_integer()||"improper_fraction"===this.get_format()?this.toString():bigrat.toDecimal(this.get_value()).toString()};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};a.get_json=function(){return{type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string(),format:this.get_format(),approximate:this.get_approximate()}};
g.creators_from_json.number=function(b){return a.create(b.numerator,b.denominator,b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};
a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};a.decimal_string=function(d,f){if(this.is_integer())return this.numerator_string();var m=this.get_value(),l=a.create(m[0],m[1]),g=l.integer_part(),m=g.toString();"0"===m&&this.is_negative()&&(m="-"+m);l=l.get_value();bigrat.subtract(l,l,g.get_value());var n=k(d,m.length),q=c(n,f),g=Math.min(m.length,d/2),l=h(l,q),l=l.length<n?l:b(l,n,f,!0);return e(m,g,f)+"<span class='toontalk-decimal-point'>.</span>"+
l};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_number)return a.match_with_any_number();this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this))return"matched";a.last_match=this;return a};a.get_custom_title_prefix=function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":
"Drop me on another number and I'll "+this.operator_word("myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+g.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=function(){return{create:function(a){var b=g.backside.create(a),c=b.get_element(),e=document.createElement("div"),d=a.numerator_string(),h=a.denominator_string(),f=g.UTILITIES.create_text_area(d,"toontalk-numerator-input",
"","Type here to edit the numerator",void 0,"number"),m=g.UTILITIES.create_text_area(h,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),n=g.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal."),k=g.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction."),q=g.UTILITIES.create_radio_button("number_format",
"improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction."),r=g.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power."),l=g.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on."),u=g.UTILITIES.create_radio_button("operator",
"-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on."),x=g.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on."),y=g.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","Divide me into what I'm dropped on."),p=g.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value."),t=function(b){var c=f.button.value.trim(),
l=m.button.value.trim(),e=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:e(a,b).replacement};a=e(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,"")}},
n;if(c!==d||l!==h)n=e(c,"numerator"),n.message&&(g.UTILITIES.display_message(n.message),c=n.replacement),"0"===l?(g.UTILITIES.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1."),l="1"):(n=e(l,"denominator"),n.message&&(g.UTILITIES.display_message(n.message),l=n.replacement)),a.set_from_values(c,l)&&(d=c,h=l,a.robot_in_training()&&(b=b.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:"set_denominator",
argument_1:l,toString:"by changing the value of the denominator to "+l,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:"set_numerator",argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+b})),a.rerender())},T=function(){var b=g.UTILITIES.selected_radio_button(n.button,k.button,q.button,r.button),c=b.value;a.set_format(c,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_format",argument_1:c,toString:"by changing the format to "+
c+" of the number",button_selector:"."+b.className.split(" ",1)[0]});a.rerender()},Z=function(){var b=g.UTILITIES.selected_radio_button(l.button,u.button,x.button,y.button,p.button),c=b.value;a.set_operator(c,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_operator",argument_1:c,toString:"by changing the operator to "+c+" of the number",button_selector:"."+b.className.split(" ",1)[0]})},V=g.UTILITIES.create_horizontal_table(f.container,e,m.container),N=$(g.UTILITIES.create_horizontal_table(n.container,
k.container,q.container,r.container)).buttonset().get(0),X=$(g.UTILITIES.create_horizontal_table(l.container,u.container,x.container,y.container,p.container)).buttonset().get(0),ca=g.backside.create_advanced_settings_button(b,a),da=b.update_display.bind(b);e.innerHTML="/";$(e).addClass("ui-widget");c.appendChild(V);c.appendChild(ca);f.button.addEventListener("change",t);f.button.addEventListener("mouseout",t);f.button.addEventListener("mouseenter",function(){d=f.button.value.trim()});m.button.addEventListener("change",
t);m.button.addEventListener("mouseout",t);m.button.addEventListener("mouseenter",function(){h=m.button.value.trim()});n.button.addEventListener("change",T);k.button.addEventListener("change",T);q.button.addEventListener("change",T);r.button.addEventListener("change",T);switch(a.get_format()){case "decimal":g.UTILITIES.check_radio_button(n);break;case "improper_fraction":g.UTILITIES.check_radio_button(q);break;case "mixed_number":case "proper_fraction":g.UTILITIES.check_radio_button(k);break;case "scientific_format":g.UTILITIES.check_radio_button(r)}switch(a.get_operator()){case "+":g.UTILITIES.check_radio_button(l);
break;case "-":g.UTILITIES.check_radio_button(u);break;case "*":g.UTILITIES.check_radio_button(x);break;case "/":g.UTILITIES.check_radio_button(y);break;case "=":g.UTILITIES.check_radio_button(p)}l.button.addEventListener("change",Z);u.button.addEventListener("change",Z);x.button.addEventListener("change",Z);y.button.addEventListener("change",Z);p.button.addEventListener("change",Z);b.update_display=function(){$(f.button).val(a.numerator_string());$(m.button).val(a.denominator_string());da()};$(N).addClass("toontalk-advanced-setting");
$(X).addClass("toontalk-advanced-setting");c.appendChild(N);c.appendChild(X);b.add_advanced_settings();return b}}}();window.TOONTALK.number.function=function(){var a=g.create_function_table(),b=function(a){return bigrat.toDecimal(m(a,h))},e=function(a){return bigrat.toDecimal(m(a,n))};a.add_function_object("sum",function(b,c,e){return a.n_ary_widget_function(b,g.number.ZERO,g.number.add,"sum",c,e)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",
function(b,c,e){return a.n_ary_widget_function(b,g.number.ZERO,g.number.subtract,"difference",c,e)},"The bird will return with the result of subtracting the numbers in the box from the first number.","-");a.add_function_object("product",function(b,c,e){return a.n_ary_widget_function(b,g.number.ONE,g.number.multiply,"product",c,e)},"The bird will return with the product of the numbers in the box.","\u00d7");a.add_function_object("division",function(b,c,e){return a.n_ary_widget_function(b,g.number.ONE,
g.number.divide,"division",c,e)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00f7");a.add_function_object("modulo",function(b,c,e){return a.n_ary_function(b,a.bigrat_function_to_widget_function(m),2,"modulo",c,e)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(b,c,e){return a.n_ary_widget_function(b,g.number.ONE,
g.number.minimum,"minimum",c,e)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(b,c,e){return a.n_ary_widget_function(b,g.number.ONE,g.number.maximum,"maximum",c,e)},"The bird will return with the largest of the numbers in the box.","max");a.add_function_object("absolute value",function(b,c,e){return a.n_ary_function(b,function(a){var c=g.number.ZERO(b.get_hole_contents(1).get_format());bigrat.abs(c.get_value(),a);return c},1,"absolute value",
c,e)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c,e){return a.n_ary_function(b,a.bigrat_function_to_widget_function(function(a,b){var c=bigrat.power(bigrat.create(),a,b[0].valueOf()),e=b[1].valueOf();return 1===e?c:bigrat.nthRoot(c,c,e)},!0),2,"power",c,e)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===
arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},!0),1,"logarithm",c,e)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).","log");a.add_function_object("random",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?
Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c,e)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.","rand");a.add_function_object("round",function(b,
c,e){return a.n_ary_function(b,a.bigrat_function_to_widget_function(r),1,"round",c,e)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,e,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(c),1,"floor",e,d)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c,e){return a.n_ary_function(b,a.bigrat_function_to_widget_function(q),1,"ceiling",c,e)},"The bird will return the smallest integer greater than or equal to the number.",
"ceil");a.add_function_object("delay",function(b,c,e){var d=Date.now(),h=a.check_message(b),f;if(h)if(2>h.size)g.UTILITIES.display_message("Delay function birds need a number in the second hole.");else return f=b.get_hole_contents(1).to_float(),setTimeout(function(){var f=g.number.ZERO(g.number.function_bird_results_default_format);f.set_value_from_decimal((Date.now()-d)/1E3);f.set_approximate(!0);a.process_response(f,h.bird,b,c,e)},1E3*f),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");
a.add_function_object("integer and fraction parts",function(b,c,e){return a.n_ary_function(b,p,1,"integer and fraction parts",c,e)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(c,e,d){return a.n_ary_function(c,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/k)},!0,b),1,"sine",e,d)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",
function(c,e,d){return a.n_ary_function(c,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/k)},!0,b),1,"cosine",e,d)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return k*Math.atan(a)},!0),1,"arc tangent",c,e)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.",
"atan");a.add_function_object("arc tangent of y and x",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return k*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c,e)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.","atan2");a.add_function_object("sine (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,
!0,e),1,"sine (in radians)",c,d)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,e),1,"cosine (in radians)",c,d)},"The bird will return with an approximation of the cosine of the number (in radians).","cos rad");a.add_function_object("arc tangent (in radians)",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,
!0),1,"arc tangent (in radians)",c,e)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",c,e)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.",
"atan2 rad");return a.get_function_table()}()})(window.TOONTALK);(function(g){var k=function(a,d,b,e){var h;a&&0<=b&&a.maintain_proportional_dimensions()&&a.get_default_width?(h=a.get_default_width(),a=a.get_default_height(),b/h>=e/a?(h=h*e/a,b={left:(b-h)/2,top:0,width:h,height:e}):(h=a*b/h,b={left:0,top:(e-h)/2,width:b,height:h})):b={left:0,top:0};g.UTILITIES.set_css(d,b)};window.TOONTALK.box=function(a){var d=Object.create(a.widget);d.create=function(b,e,h,g,f){var t=Object.create(d),p=[];"undefined"===typeof e&&(e=!0);t.is_box=function(){return!0};t.get_horizontal=
function(){return e};t.set_horizontal=function(a,b){e=a;b&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());return this};t.get_hole=function(a){return p[a]};t.get_hole_contents=function(a){return p[a].get_contents()};t.set_hole=function(b,e,c){var d;p[b].set_contents(e);if(c){e&&e.save_dimensions();c=this.get_frontside_element();b=$(c).children(".toontalk-hole-number-"+b);b.empty();if(!e)return;d=this.get_hole_dimensions();c=e.get_frontside_element(!0);b.append(c);
k(e,c,d.width,d.height);e.rerender()}this.rerender();a.debugging&&(this._debug_string=this.to_debug_string())};t.get_holes=function(){return p};t.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=void 0}.bind(this)};t.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};
t.set_contents=function(a){a.forEach(function(a,b){p[b].set_contents(a)})};t.get_size=function(){return b};t.set_size=function(e,d){var c,h;if(b===e||0>e||isNaN(e))return!1;h=this.visible();p.length=e;if(e>b)for(c=b;c<e;c++)p[c]=a.box_hole.create(c),p[c].set_parent_of_frontside(t),p[c].set_visible(h);b=e;d&&this.rerender();a.debugging&&(this._debug_string=this.to_debug_string());return!0};t.get_hole_dimensions=function(){var d=this.get_frontside_element(),h=$(d).width()||a.box.get_default_width(),
d=$(d).height()||a.box.get_default_height();return e?{width:h/b,height:d}:{width:h,height:d/b}};t.receive_size_from_dropped=function(b,e){var c;if(b.is_number())return c=a.number.create(this.get_size()),c.number_dropped_on_me_semantics(b),c=Math.max(0,Math.round(c.to_float())),this.set_size(c),c.toString()};t.copy=function(a){var h;a||(a={});h=p.map(function(b){if(b=b.get_contents())return b.copy(a)});h=d.create(b,e,h,this.get_description(),this.get_name());return this.add_to_copy(h,a)};t.generate_name=
function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};t.add_standard_widget_functionality(t);t.has_name(t);t.set_name(f);for(f=0;f<b;f++)p[f]=a.box_hole.create(f),p[f].set_parent_of_frontside(t);t.set_description(g);h&&t.set_contents(h);a.debugging&&(t._debug_id=a.UTILITIES.generate_unique_id(),t._debug_string=t.to_debug_string());return t};d.create_backside=function(){return a.box_backside.create(this)};d.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&
a.equals_box(this)};d.equals_box=function(a){var e=this.get_size(),d,g,f;if(e!==a.get_size())return!1;for(d=0;d<e;d++)if(g=this.get_hole_contents(d),f=a.get_hole_contents(d),!g&&f||g&&!f||g&&f&&(!g.equals||!g.equals(f)))return!1;return!0};d.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};d.compare_with_box=function(a){var e=this.get_size(),d=a.get_size(),g,f;if(e>d)return 1;if(e<d)return-1;for(d=0;d<e;d++){g=this.get_hole_contents(d);f=a.get_hole_contents(d);if(g&&
!f)return 1;if(!g&&f)return-1;if(g&&f)if(g.compare_with){if(g=g.compare_with(f),1===g||-1===g)return g}else return}return 0};d.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_box)return a.match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=a,this)};d.match_with_any_box=function(){return"matched"};d.match_with_this_box=function(b){var e=this.get_size(),d=[],g,f,k;if(e!==b.get_size())return b.last_match=
this,b;for(g=0;g<e;g++)if(k=b.get_hole_contents(g))if(f=this.get_hole_contents(g)){f=a.UTILITIES.match(k,f);if(f.is_widget)return f;"matched"!==f&&(d=0===d.length?f:d.concat(f))}else if(f=this.get_contents_temporarily_removed(g))d.push(f);else return b.last_match=this,b;return 0<d.length?d:"matched"};d.toString=function(a){var e="",d=this.get_size(),g,f,k=this.get_type_name()+" that looks like ";for(g=0;g<d;g++)f=this.get_hole(g),e+=f.get_full_description(a),g<d-1&&(e+=" | ");return k+"["+e.replace(k,
"")+"]"};d.get_type_name=function(a){return a?"boxes":"box"};d.get_help_URL=function(){return"docs/manual/boxes.html"};d.get_json=function(b){var e=[],d=this.get_size(),g;for(g=0;g<d;g++)this.get_hole_contents(g)?e[g]=a.UTILITIES.get_json(this.get_hole_contents(g),b):e[g]=null;return{type:"box",size:d,contents:e,horizontal:this.get_horizontal(),name:this.get_name()}};d.walk_children=function(a){var e=this.get_size(),d;for(d=0;d<e&&a(this.get_hole(d));d++);};a.creators_from_json.box=function(b,e){return d.create(b.size,
b.horizontal,a.UTILITIES.create_array_from_json(b.contents,e),b.description,b.name)};d.update_display=function(){var b=this.get_frontside(!0).get_element(),e=this.get_size(),d=function(b,c,d){var h=c.get_contents(),f=(h||c).get_frontside_element(!0),m=$(b).parents(".toontalk-box-hole"),p=function(){$(b).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(K/=a.nest.CONTENTS_WIDTH_FACTOR,l/=a.nest.CONTENTS_HEIGHT_FACTOR)},E,F,K,l;g?(F=0,0<m.length?(K=r-2*v/e,l=q-2*v):(K=r,l=q),p(),E=
K*d,1<d&&(E+=v*(d-1))):(E=0,0<m.length?(K=r-2*v,l=q-2*v/e):(K=r,l=q),p(),F=l*d,1<d&&(F+=v*(d-1)));a.UTILITIES.set_css(b,{left:E,top:F,width:K,height:l});t[d]&&b.setAttribute("toontalk_name",t[d]);!a.UTILITIES.has_animating_image(f)&&0<d&&($(b).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(b).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),
g?$(b).addClass(w+"-left"):$(b).addClass(w+"-top"));b!==f&&(k(h,f,K,l),b.appendChild(f),c.get_contents().update_display());c.is_element()&&(c=c.get_contents(),c.set_size_attributes(K,l,!0))},g=this.get_horizontal();$(b).is(".toontalk-box");var f=function(){var f=$(b).children(".toontalk-box-hole");f.length===e?f.each(function(a,b){var c=this.get_hole(a);c&&d(b,c,a)}.bind(this)):(f.remove(),this.get_holes().forEach(function(a,c){p=a.get_element();$(p).addClass("toontalk-hole-number-"+c);d(p,a,c);b.appendChild(p)}));
$(b).parent(".toontalk-conditions-contents-container").is("*")||($(b).parent(".toontalk-box-hole").is("*")?a.UTILITIES.set_css(b,{width:"",height:""}):a.UTILITIES.set_css(b,{width:m,height:c}))}.bind(this),t=this.get_name().split(";"),p,m,r,c,q,w,v;a.logging&&0<=a.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(b).addClass("toontalk-box");$(b).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");
a.UTILITIES.give_tooltip(b,this.get_title());a.debugging&&(this._debug_string=this.to_debug_string());this.get_erased()?($(b).addClass("toontalk-box-erased"),$(b).children(".toontalk-side").remove()):($(b).removeClass("toontalk-box-erased"),m=0===e?0:$(b).width()||a.box.get_default_width(),c=$(b).height()||a.box.get_default_height(),g?(r=0===e?0:m/e,q=c):(r=m,q=c/e),v=this.get_border_size(r,q),w=4===v?"toontalk-box-eighth-size-border":8===v?"toontalk-box-quarter-size-border":16===v?"toontalk-box-half-size-border":
"toontalk-box-full-size-border",g?r-=(e-1)*v/e:q-=(e-1)*v/e,$(b).addClass(w),a.UTILITIES.set_timeout(f))};d.get_default_width=function(){return 164};d.get_default_height=function(){return 68};d.get_border_size=function(a,e){var d;if(0===a)return d=$(this.get_frontside_element()).width(),16>=d?4:32>=d?8:64>=d?16:32;a||(a=$(this.get_frontside_element()).width());e||(e=$(this.get_frontside_element()).height());return 32>=a||32>=e?4:64>=a||64>=e?8:128>=a||128>=e?16:32};d.get_name_input_label=function(){return"The labels of my holes are"};
d.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};d.drop_on=function(a,e,d,g){if(a.box_dropped_on_me)return e=a.box_dropped_on_me(this,d,g),d&&a.rerender(),e&&this.remove(),e;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,e,d,g);console.log("No handler for drop of "+this+" on "+a)};d.box_dropped_on_me=function(a,e){console.log("box on box not yet implemented");return!1};d.widget_dropped_on_me=function(b,
e,d,g){var f=this.which_hole(d),k;if(0<=f)return k=this.get_hole(f),(f=k.get_contents())?b.drop_on(f,e,d,g):k.widget_dropped_on_me(b,e,d,g);a.UTILITIES.report_internal_error(b+" dropped on "+this+" but no event was provided.")};d.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};d.removed_from_container=function(b,e,d,g,f){e=!!d;"undefined"===typeof g&&(g=this.get_index_of(b));0<=g?(this.set_hole(g,void 0,e),
e&&(this.rerender(),b.restore_dimensions())):f&&a.UTILITIES.report_internal_error("Attempted to remove "+b+" from "+this+" but not found.")};d.get_path_to=function(b,e){var d=this.get_size(),g,f;if("empty hole"===b.get_type_name()){d=b.get_parent_of_frontside();f=a.box.path.create(b.get_index());if(d===this)return f;d=this.get_path_to(d);if(!d)return;d.next=f;return d}for(g=0;g<d;g++)if(f=this.get_hole_contents(g)||this.get_contents_temporarily_removed(g)){if(b===f||f.top_contents_is&&f.top_contents_is(b))return a.box.path.create(g);
if(f.get_path_to&&(f=f.get_path_to(b,e)))return d=a.box.path.create(g),d.next=f,d}};d.element_to_highlight=function(a){a=this.which_hole(a,!0);var e;if(0>a||0===this.get_size())return this.get_frontside_element();a=this.get_hole(a);return(e=a.get_contents())?e.get_frontside_element():a.get_frontside_element()};d.which_hole=function(a){var e=this.get_horizontal(),d=this.get_frontside_element(),g=this.get_size(),f,k;if(0!==g&&(f=$(d).offset(),d=e?$(d).width()/g:$(d).height()/g,k=e?f.left:f.top,a))for(f=
0;f<g;f++)if(k+=d,(e?a.pageX<=k:a.pageY<=k)||f+1===g)return f};d.dereference_path=function(b,e,d){var g,f;if(b){g=b.get_index&&b.get_index();if(!a.debugging||"number"===typeof g){if(f=this.get_hole_contents(g)){if(f.dereference_contents&&!b.not_to_be_dereferenced)return f.dereference_contents(b.next||b,e,d);if(b.next){if(f.dereference_path)return f.dereference_path(b.next,e,d);a.UTILITIES.report_internal_error("Expected to refer to a part of "+f+" but it lacks a method to obtain "+a.path.toString(b.next))}b.removing_widget&&
("empty hole"===f.get_type_name()?a.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):f.get_infinite_stack()||d.remove_from_container(f,this));return f}return this.get_hole(g)}a.UTILITIES.report_internal_error(this+" unable to dereference the path: "+a.path.toString(b))}else return this};d.path={create:function(b){return{get_index:function(){return b},toString:function(){return"scale"===this.true_type?0===b?"the left pan ":"the right pan ":"the "+a.UTILITIES.ordinal(b)+
" hole "},get_json:function(a){return{type:"box_path",index:b,true_type:this.true_type,next:this.next&&this.next.get_json(a)}}}}};d.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};a.creators_from_json.box_path=function(b,e){var h=d.path.create(b.index);b.next&&(h.next=a.UTILITIES.create_from_json(b.next,e));b.true_type&&(h.true_type=b.true_type);return h};return d}(window.TOONTALK);window.TOONTALK.box_backside=function(a){return{create:function(d){var b=a.backside.create(d),
e=a.UTILITIES.create_text_input(d.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(b){if(b=a.UTILITIES.input_area_drop_handler(b,d.receive_size_from_dropped.bind(d),d))d.rerender(),d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(b,d,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),h=a.UTILITIES.create_radio_button("box_orientation","horizontal",
"toontalk-horizontal-radio-button","Left to right","Show box horizontally."),g=a.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-vertical-radio-button","Top to bottom","Show box vertically."),f=function(){var a=parseInt(e.button.value.trim(),10);d.set_size(a,!0)&&d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_size",argument_1:a,toString:"by changing the number of holes to "+a+" of the box",button_selector:".toontalk-box-size-input"})},k=function(){var b=
a.UTILITIES.selected_radio_button(h.button,g.button),e=b.value,f="horizontal"===e;d.set_horizontal(f,!0);d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_horizontal",argument_1:f,toString:"by changing the orientation to "+e+" of the box",button_selector:"."+b.className.split(" ",1)[0]})},p=b.get_element(),m=a.backside.create_advanced_settings_button(b,d),r=b.update_display.bind(b);e.button.addEventListener("change",f);e.button.addEventListener("mouseout",f);h.button.addEventListener("change",
k);g.button.addEventListener("change",k);b.update_display=function(){e.button.value=d.get_size().toString();d.get_horizontal()?a.UTILITIES.check_radio_button(h):a.UTILITIES.check_radio_button(g);r()};p.appendChild(e.container);p.appendChild($(a.UTILITIES.create_horizontal_table(h.container,g.container)).buttonset().get(0));p.appendChild(m);b.add_advanced_settings();b.rerender();return b}}}(window.TOONTALK);window.TOONTALK.box_hole=function(a){return{create:function(d){var b=Object.create(this),e,
h,g;b.is_hole=function(){return!0};b.is_empty_hole=function(){return!e};b.location_constrained_by_container=function(){return!1};b.get_element=function(){g||(g=document.createElement("div"),g.className="toontalk-box-hole toontalk-frontside toontalk-side",g.toontalk_widget=b);return g};b.get_frontside=function(a){return e?e.get_frontside(a):this.get_element()};b.get_frontside_element=function(a){return this.get_element()};b.get_frontside=function(){return this};b.widget_dropped_on_me=function(b,e,
d,h){var g=this.get_parent_of_frontside(),c,k,n;b.dropped_on_other&&b.dropped_on_other(this,!1,d,h);d?(a.sounds&&a.sounds.fall_inside.play(),e=this.get_element(),h=b.is_plain_text_element(),n=b.get_element(),$(n).css({"z-index":a.UTILITIES.next_z_index()}),k=$(n.parentElement).offset(),c=$(e).offset(),h||(n.style.left=d.pageX-k.left+"px",n.style.top=d.pageY-k.top+"px",$(n).addClass("toontalk-animating-element")),n.style.width=e.style.width,n.style.height=e.style.height,n.style.left=c.left-k.left+
"px",n.style.top=c.top-k.top+"px",d=function(){$(n).removeClass("toontalk-animating-element");g.render();this.set_contents(b)}.bind(this),setTimeout(d,h||a.UTILITIES.has_animating_image(n)?0:1200),g.robot_in_training()&&g.robot_in_training().dropped_on(b,this),b.save_dimensions&&b.set_size_attributes&&b.set_size_attributes($(e).width(),$(e).height())):(g.render(),this.set_contents(b));return!0};b.get_json=function(){return null};b.add_to_json=function(a){return a};b.copy=function(b){return a.box_hole.create(d)};
b.match=function(){return"matched"};b.get_type_name=function(a){return e?e.get_type_name(a):a?"empty holes":"empty hole"};b.is_of_type=function(a){return e?e.is_of_type(a):"empty hole"===a};b.get_box=function(){return this.get_parent_of_frontside()};b.update_display=function(){var a;e&&(a=this.get_frontside_element(),k(e,e.get_frontside_element(),$(a).width(),$(a).height()))};b.dereference=function(){return e?e.dereference():this};b.get_index=function(){return d};b.get_contents=function(){return e};
b.set_contents=function(b){var d=this.get_listeners("value_changed");d&&(e!==b&&d.forEach(function(a){a({type:"value_changed",old_value:e,new_value:b})}),e&&d.forEach(function(a){e.remove_listener("value_changed",a,!0)}),b&&d.forEach(function(a){b.add_listener("value_changed",a)}));e&&e.set_parent_of_frontside(void 0);(e=b)?(e.set_parent_of_frontside(this),a.debugging&&(this._debug_string="A hole containing "+e.to_debug_string()),e.set_visible(h)):a.debugging&&(this._debug_string=this.to_debug_string())};
b.visible=function(){return this.get_parent_of_frontside().visible()};b.set_visible=function(a){h=a;e&&e.set_visible(a)};b.remove=function(){e&&e.remove()};b.render=function(){e&&a.DISPLAY_UPDATES.pending_update(this)};b.rerender=function(){if(e&&e.visible())return this.render()};b.set_running=function(a){e&&e.set_running(a)};b.maintain_proportional_dimensions=function(){if(e)return e.maintain_proportional_dimensions()};b.removed_from_container=function(b,d,h,g,k){e?(h&&e.restore_dimensions(),this.set_contents(void 0),
h&&this.get_parent_of_frontside().render()):k&&a.UTILITIES.report_internal_error("Holes can't be removed from containers.")};b.temporarily_remove_contents=function(a,b){if(e)return this.get_parent_of_frontside().temporarily_remove_contents(a,b)};b.toString=function(){return e?e.toString():"_"};b.get_description=function(){return e?e.get_description():"_"};b.get_full_description=function(a){return e?e.get_full_description(a):"_"};b.is_backside=function(){return!1};b.get_widget=function(){return this.get_parent_of_frontside()};
b.is_number=function(){return e?e.is_number():!1};b.is_box=function(){return e?e.is_box():!1};b.is_scale=function(){return e?e.is_scale():!1};b.is_bird=function(){return e?e.is_bird():!1};b.is_nest=function(){return e?e.is_nest():!1};b.is_robot=function(){return e?e.is_robot():!1};b.is_element=function(){return e?e.is_element():!1};b.is_sensor=function(){return e?e.is_sensor():!1};b.is_top_level=function(){return!1};a.widget.has_parent(b);a.widget.has_listeners(b);if(a.debugging||a.logging)b.to_debug_string=
function(){var b="the "+a.UTILITIES.ordinal(d)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box");return e?b+" which contains "+e.to_debug_string():b+" which is empty"},b._debug_string=b.to_debug_string();return b}}}(window.TOONTALK);window.TOONTALK.box.function=function(){var a=g.create_function_table();a.add_function_object("box hole",function(d,b,e){return a.typed_bird_function(d,function(a,b){var e=Math.round(a.to_float());if(1>
e)g.UTILITIES.display_message("The box hole function bird cannot accept "+a+". She only accepts positive numbers.");else if(e>b.get_size())g.UTILITIES.display_message("The box hole function bird cannot accept "+a+". The box only has "+b.get_size()+" holes.");else return b.get_hole_contents(e-1)},["number","box"],2,"box hole",b,e)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. 1 for the first hole.","hole",["number","box"]);a.add_function_object("count holes",
function(d,b,e){return a.typed_bird_function(d,function(a){return g.number.create(a.get_size())},["box"],1,"count holes",b,e)},"The bird will return with the number of holes the box has.","count holes",["box"]);a.add_function_object("fill hole",function(d,b,e){return a.typed_bird_function(d,function(a,b,e){var d=Math.round(a.to_float());if(1>d)g.UTILITIES.display_message("The fill hole function bird cannot accept "+a+". She only accepts positive numbers.");else return d>b.get_size()&&b.set_size(d),
b.set_hole(d-1,e),b},["number","box",void 0],3,"fill hole",b,e)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);a.add_function_object("split box",function(d,b,e){return a.typed_bird_function(d,function(a,b){var e=Math.round(a.to_float()),d=b.get_size();if(0>e)g.UTILITIES.display_message("The box split function bird cannot accept "+
a+". She only accepts zero or positive numbers.");else if(e>d)g.UTILITIES.display_message("The box split function bird cannot accept "+a+". The box only has "+d+" holes.");else{b.get_holes();var d=d-e,k=g.box.create(d),m;for(m=0;m<d;m++)k.set_hole(m,b.get_hole_contents(m+e));b.set_size(e);return g.box.create(2,!1,[b,k])}},["number","box"],2,"split box",b,e)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.",
"split",["number","box"]);a.add_function_object("merge boxes",function(d,b,e){return a.typed_bird_function(d,function(){var a=0,b,e,d,k;if(0===arguments.length)return g.box.create(0);e=arguments[0];for(b=0;b<arguments.length;b++)a+=arguments[b].get_size();d=e.get_size();e.set_size(a);for(b=1;b<arguments.length;b++)for(k=arguments[b].get_size(),a=0;a<k;a++)e.set_hole(d,arguments[b].get_hole_contents(a)),d++;return e},["box"],void 0,"merge boxes",b,e)},"The bird will return with a box that joins together all the boxes.",
"merge",["any number of boxes"]);return a.get_function_table()}()})(window.TOONTALK);(function(){var g,k,a,d,b;window.TOONTALK.bird=function(a){var d=Object.create(a.widget),n=function(b,d,h){var g=b.get_function_type();b=b.get_function_object();var k=Object.keys(TOONTALK[g]["function"]),c=k.map(function(a){return TOONTALK[g]["function"][a].title}),k=a.UTILITIES.create_select_menu("functions",k,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",c);d=d.get_element();b&&(k.menu.value=b.name);k.menu.addEventListener("change",
function(a){h.set_function_name(a.target.value)});d.insertBefore(k.container,d.firstChild)};d.create=function(f,t){var p=Object.create(d),m=[],r=[];g=function(a){f=a};p.is_bird=function(){return!0};p.widget_dropped_on_me=function(b,d,h,g,m,k){var n=d?b.get_backside():b,r,p;if(f){if(f.has_ancestor(b))return a.UTILITIES.display_message("Bird can't take its nest to its nest!"),!1;!(f.visible()||this.visible()||f.any_nest_copies_visible())||g&&g.visible()&&!g.animate_consequences_of_actions()?(f.add_to_contents(n,
h,g),g&&g===n.robot_waiting_before_next_step&&(n.robot_waiting_before_next_step=void 0,g.run_next_step())):(k||b.save_dimensions(),r=this.get_frontside_element(),setTimeout(function(){$(r).removeClass("toontalk-bird-gimme").addClass(this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside().rerender()}.bind(this)),b.set_visible(!0),g&&!m&&(b.robot_waiting_before_next_step=g,b.remove_from_parent_of_frontside(),g.run_next_step&&(p=function(){n.robot_waiting_before_next_step=
void 0;g.run_next_step()})),f.animate_bird_delivery(n,this,p,h,g))}else console.log("TODO: handle drop on a nestless bird -- just removes other?");h&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,this);return!0};p.animate_delivery_to=function(b,d,h,g,k,n,p,t){var G=!!h,C=this.get_parent_of_frontside(),z=this.get_frontside_element();$(z).width();var E=this.closest_visible_ancestor_or_frontside(),F=$(E.get_frontside_element()).offset(),K=function(){var b=$(S).offset(),c;a.sounds&&
a.sounds.bird_fly.pause();G?this.remove():this.visible()&&(c=function(){$(z).removeClass("toontalk-bird-morph-to-static");$(z).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));C&&C.get_widget().rerender()}.bind(this),z.style.position=T,b&&(F.left-=b.left,F.top-=b.top),a.UTILITIES.set_css(z,F),S&&S.appendChild(z),C&&(C.get_widget().is_top_level()?this.rerender():C.get_widget().rerender()),N&&(ja.remove_backside_widget(this,!1,!0),N(),m&&(b=m,m=[],r=[],b.forEach(function(a){a()}))),
a.UTILITIES.add_animation_class(z,"toontalk-bird-morph-to-static"),a.UTILITIES.add_one_shot_event_handler(z,"animationend",1E3,c));n&&n()}.bind(this),l=function(){try{h.add_to_contents(b,p,t,this,!0)}catch(d){if(d.wait_for_nest_to_receive_something){d.wait_for_nest_to_receive_something.run_when_non_empty(l,this);n&&(n(),n=void 0);return}console.error(d.stack);throw d;}x($(z).offset());a.UTILITIES.set_timeout(function(){this.fly_to(F,K,t)}.bind(this))}.bind(this),u=function(b,c){b.width_before_carry=
$(b).width();b.height_before_carry=$(b).height();this.element_to_display_when_flying=b;c&&(this.update_display(),setTimeout(function(){c.update_display()}));$(this.element_to_display_when_flying).addClass("toontalk-carried-by-bird");a.UTILITIES.set_timeout(function(){var b={left:"",top:"",position:""};c&&!c.use_scaling_transform&&(b.width="",b.height="");a.UTILITIES.set_css(this.element_to_display_when_flying,b);this.update_display()}.bind(this))}.bind(this),x=function(l){this.element_to_display_when_flying&&
($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),l?(a.UTILITIES.set_css(this.element_to_display_when_flying,{width:this.element_to_display_when_flying.width_before_carry||"",height:this.element_to_display_when_flying.height_before_carry||"","z-index":a.UTILITIES.next_z_index()}),$(z).closest(".toontalk-top-level-backside").append(this.element_to_display_when_flying),a.UTILITIES.set_absolute_position($(this.element_to_display_when_flying),l),(l=b.get_parent_of_frontside())&&
!l.is_backside()?l.rerender():b.rerender()):$(this.element_to_display_when_flying).remove(),this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),y,Q,S,T,Z,V,N,X,ca,da,ja;h||(h=f);da=b.get_element();u(da,b);d.is_function_nest()||(Q=d.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!d.visible()&&!this.visible()||!d.is_function_nest()&&!a.UTILITIES.visible_element(Q))h.add_to_contents(b,p,t,this,!0);else if(a.sounds&&a.sounds.bird_fly.play(),
$(z).removeClass("toontalk-bird-static"),d.is_function_nest()||(Q=d.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element(),y=$(Q).offset(),V=$(h.get_frontside_element()).closest(".toontalk-top-level-backside")),V&&V.is("*")||(V=$(this.get_frontside_element()).closest(".toontalk-top-level-backside")),(d=V.offset())||(d={left:0,top:0}),g?F={left:g+d.left,top:k+d.top}:0===F.left&&0===F.top&&(F={left:-da.clientWidth,top:d.top+V.height()/2}),y||(y={left:-2*da.clientWidth,
top:d.top+V.height()/2}),S=z.parentElement,E=$(z).width(),Z=$(z).height(),T=z.style.position,z.style.position="absolute",ja=this.top_level_widget(),C&&C.temporarily_remove_contents&&(N=C.temporarily_remove_contents(this,!0))&&ja.add_to_top_level_backside(this),V.append(z),a.UTILITIES.set_css(z,{left:g||F.left-d.left,top:k||F.top-d.top,width:E,height:Z}),a.logging&&0<=a.logging.indexOf("bird")&&console.log(this.to_debug_string()+" from "+(g||F.left-d.left)+", "+(k||F.top-d.top)+" to "+y.left+", "+
y.top),(X=h.get_contents_frontside_element&&h.get_contents_frontside_element())&&h.visible()&&(!t||t.animate_consequences_of_actions())){g=$(Q).width();k=$(Q).height();ca=$(Q).offset();d.max_left=d.left+V.width();d.max_top=d.top+V.height();y.left+=g;y.top+=k;var ka={left:Math.min(ca.left+g,d.max_left-g),top:Math.min(ca.top+k,d.max_top-k)},oa={left:Math.max(ca.left-g,d.left),top:Math.max(ca.top-k,d.top)};y=function(){var a=function(){h.visible()?(h.set_locked(!0),this.fly_to(ca,xa,t,300)):(h.add_to_contents(b,
p,t,this,!0),n&&(n(),n=void 0))}.bind(this);x(ka);h.get_locked()?h.run_when_unlocked(a):a()}.bind(this);var xa=function(){u(X);this.fly_to(oa,ya,t,300)}.bind(this),ya=function(){x(oa);this.fly_to(ka,qa,t,300)}.bind(this),qa=function(){u(da,b);this.fly_to(ca,wa,t,300)}.bind(this),wa=function(){var l=h.get_contents_dimensions();x(ca);a.UTILITIES.set_css(b.get_frontside_element(),l);this.fly_to(oa,la,t,300)}.bind(this),la=function(){u(X);this.fly_to(ca,Ba,t,300)}.bind(this),Ba=function(){h.set_locked(!1);
x();h.update_display();l()}.bind(this);this.fly_to(ka,y,t,300)}else this.fly_to(y,l,t,300)};p.get_json=function(b){return{type:"bird",nest:f&&a.UTILITIES.get_json(f,b)}};p.copy=function(a){var e,d,h;if(a)if(a.just_value)e=this.create(void 0,this.get_description());else{if((h=f.get_guid())&&a.nests_copied&&a.nests_copied[h]){e=a.nests_copied[h][0];b.call(e);for(d=1;d<a.nests_copied[h].length;d++)k.call(a.nests_copied[h][d],e);e=this.create(e,this.get_description())}else e=this.create(f,this.get_description());
a.birds_copied||(a.birds_copied={});h&&(a.birds_copied[h]||(a.birds_copied[h]=[]),a.birds_copied[h].push(e))}else e=f&&f.is_function_nest()?this.create(f.copy(),this.get_description()):this.create(f,this.get_description());return this.add_to_copy(e,a)};p.run_when_non_empty=function(a,b){0>r.indexOf(b)&&(m.push(a),r.push(b))};p.create_backside=function(){var b=a.bird_backside.create(this);f&&f.is_function_nest()&&n(f,b,this);return b};p.get_help_URL=function(){return f&&f.is_function_nest()?"docs/manual/function-birds.html":
"docs/manual/birds-nests.html"};p.is_function_bird=function(){return f&&f.is_function_nest()};p.get_custom_title_prefix=function(){var a;return f?f.is_function_nest()&&(a=f.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":"This bird no longer knows where her nest is. She'll get rid of anything you give her."};p.toString=function(a){return f?f.is_function_nest()?f.get_function_object().toString():"a bird":a&&"conditions"===a.role?"any bird":"a bird without a nest"};
p.update_display=function(){var b=this.get_frontside(!0);this.get_backside();var d;d=b.get_element();f&&d.setAttribute("toontalk_name",f.get_name());a.UTILITIES.give_tooltip(d,this.get_title());$(d).is(".toontalk-bird, .toontalk-side-animating")||($(d).addClass(this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),d.addEventListener("dragenter",function(b){0<=d.className.indexOf("toontalk-bird-static")&&($(d).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),
a.UTILITIES.add_animation_class(d,"toontalk-bird-gimme"))}.bind(this)),d.addEventListener("dragleave",function(a){$(d).is(".toontalk-bird-gimme")&&($(d).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?d.appendChild(this.element_to_display_when_flying):$(d).children(".toontalk-side").remove()};p.set_function_name=function(a){f&&f.is_function_nest()&&
f.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};p.get_class_name_with_color=function(a){return f&&f.get_class_name_with_color?f.get_class_name_with_color(a):a};p.get_name=function(){return f&&f.get_name()};f&&f.set_name&&(p.set_name=function(a,b){return f.set_name(a,b)});p=p.add_standard_widget_functionality(p);
p.set_description(t);a.debugging&&(p._debug_id=a.UTILITIES.generate_unique_id(),p._debug_string=p.to_debug_string());return p};d.create_function=function(b,g,k){return d.create(a.nest.create_function(g,b,k||a.UTILITIES.get_first_property(a[b].function)))};d.match=function(a){if(a.match_with_any_bird)return a.match_with_any_bird(this);this.last_match=a;return this};d.match_with_any_bird=function(){return"matched"};d.fly_to=function(b,d,h,g){var k=this.get_frontside_element(),c=$(k).offset(),c=Math.atan2(b.top-
c.top,b.left-c.left),n="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*(c/Math.PI+1))%8];$(k).position();c=function(){$(k).removeClass(n);g?setTimeout(d,h?h.transform_step_duration(g):g):d()}.bind(this);a.UTILITIES.add_animation_class(k,n);$(k).removeClass($(k).removeClass(this.get_class_name_with_color("toontalk-bird-static")));this.animate_to_absolute_position(b,
c,h&&h.transform_animation_speed(a.UTILITIES.default_animation_speed))};d.get_type_name=function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};d.maintain_proportional_dimensions=function(){return!0};d.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};d.drop_on=function(a,b,e,d){if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,!1,e,d)};a.creators_from_json.bird=function(b,d){return a.bird.create(a.UTILITIES.create_from_json(b.nest,
d),b.description)};return d}(window.TOONTALK);window.TOONTALK.bird_backside=function(a){return{create:function(b){var d=a.backside.create(b);d.get_element().appendChild(a.backside.create_advanced_settings_button(d,b));d.add_advanced_settings(!0);return d}}}(window.TOONTALK);window.TOONTALK.nest=function(e){var h=Object.create(e.widget),n,f=0,t=0;h.default_maximum_capacity=10;h.maximum_capacity=h.default_maximum_capacity;h.create=function(p,m,r,c,q,w){var v=Object.create(h),D=[],H=[],I=[],A,G,C;m||
(m=[]);q||(f++,q=f);k=function(b){c&&d.call(c,this);c=b;r=b.get_guid();a.call(b,this)};b=function(){c&&d.call(c,this);c=void 0;r=e.UTILITIES.generate_unique_id()};a=function(a){n||(n=e.UTILITIES.generate_unique_id());this[n](a)};d=function(a){n||(n=e.UTILITIES.generate_unique_id());this[n](a,!0)};v.is_nest=function(){return!0};v.get_guid=function(){return r};v.matched_by=function(a){return 0<m.length?e.UTILITIES.match(a,m[0].get_widget()):[[this,a]]};v.run_when_non_empty=function(a,b){0<m.length?
a(m[0]):0>I.indexOf(b)&&(D.push(a),I.push(b))};v.dereference=function(){return 0<m.length?m[0]:this};v.match=function(a){if(0<m.length)return m[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};v.add_to_contents=function(a,b,c,d,l){var f;f=m.push(a);f>h.maximum_capacity&&c&&!c.visible()&&!this.visible()&&(e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string()+" postponing addition of "+a.to_debug_string()+" by "+c.to_debug_string()+
". Stack is "+m.length+" long. "+H.length+" previously postponed."),c.add_body_finished_listener(function(a,b,l){c.set_stopped(!0);H.push(function(){c.set_stopped(!1);c.run_actions(a,b,l)})}));e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+a.to_debug_string()+" nest now contains "+m.length+" widgets.");1===f?(0<D.length&&(f=D,D=[],I=[],f.forEach(function(b){b(a)})),a.set_visible(this.visible())):(a.get_widget().hide(),a.set_visible(!1));a.is_backside()?a.get_widget().set_parent_of_backside(this):
a.get_widget().set_parent_of_frontside(this);A&&!l&&(d?A.forEach(function(l){l.has_ancestor(a.get_widget())||l.animate_bird_delivery(e.UTILITIES.copy_side(a),d,void 0,b,c)}):A.forEach(function(l){l.has_ancestor(a.get_widget())||l.add_to_contents(e.UTILITIES.copy_side(a,!1,!0),b,c)}));this.rerender()};v.animate_bird_delivery=function(a,b,c,d,l){var h,f,g;void 0===this.get_parent_of_frontside()?(a.remove(),c&&c()):(b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,l),A&&(h=$(b.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),
f=b.get_parent_of_frontside().get_element(),g=this.visible(),A.forEach(function(c){var m=e.UTILITIES.copy_side(a,!1,g),k,n;c.has_ancestor(a.get_widget())||(h&&(c.visible()||g)?(k=b.copy({just_value:!0}),n=k.get_frontside_element(!0),$(f).append(n),k.animate_delivery_to(m,c,c,h.left,h.top,void 0,d,l)):c.add_to_contents(m,void 0,l))})))};v.get_contents_frontside_element=function(){if(0<m.length)return m[0].get_widget().get_frontside_element()};v.get_locked=function(){return this.locked_for_animating_deliveries};
v.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};v.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};v.removed_from_container=function(a,b,c,d,l){a=m.shift();e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string()+" removed "+a.to_debug_string()+" remaining widgets is "+m.length);if(a)return a.is_backside()?
a.get_widget().set_parent_of_backside(void 0):a.get_widget().set_parent_of_frontside(void 0),this.visible()&&(a.get_widget().restore_dimensions(),0<m.length&&(m[0].set_visible(!0),$(m[0].get_element()).show()),this.render()),m.length<h.maximum_capacity&&0<H.length&&(e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string()+" running "+H.length+" postponed additions. Stack is "+m.length+" long."),h.maximum_capacity=Number.MAX_VALUE,H.forEach(function(a){a()}),h.maximum_capacity=h.default_maximum_capacity,
H=[]),a;l&&e.UTILITIES.report_internal_error("Nothing removed from nest!")};v.dereference_path=function(a,b,c){if(0===m.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(m)return m[0].dereference_path(a,b,c);e.UTILITIES.display_message("Robot expected to find a nest something that it could get "+e.path.toString(a)+". But the nest is empty.");return this};v.dereference_contents=function(a,b,c){var d,l,h,f;return 0===m.length?{wait_until_this_nest_receives_something:this}:
a.removing_widget?(a=m[0],c.remove_from_container(a,this),this.visible()&&(h=this.get_frontside_element(),c=$(h).offset(),b=$(h).closest(".toontalk-backside-of-top-level"),(d=b.offset())||(d={left:0,top:0}),l=a.get_frontside_element(),f=$(h).width(),h=$(h).height(),e.UTILITIES.set_css(l,{left:.1*f+c.left-d.left,top:.1*h+c.top-d.top,width:f*e.nest.CONTENTS_WIDTH_FACTOR,height:h*e.nest.CONTENTS_HEIGHT_FACTOR}),b.append(l)),a):a.next?m[0].get_widget().dereference_path(a.next,b,c):m[0].get_widget()};
v.get_json=function(a){return{type:"nest",contents:e.UTILITIES.get_json_of_array(m,a),guid:r,original_nest:c&&e.UTILITIES.get_json(c,a),serial_number:q,name:this.get_name()}};v.copy=function(a){var b,d,h,l;if(a&&a.just_value){if(0<m.length&&(b=m[0].get_widget().copy(a),!a.copy_covered_nests))return b;d=e.nest.create(this.get_description(),[],"in a robot's condition",void 0,q,this.get_name());b&&d.add_to_contents(b);return d}b=e.UTILITIES.copy_widget_sides(m,a);a?a.fresh_copy?d=e.nest.create(this.get_description(),
b,r&&e.UTILITIES.generate_unique_id()):(h=c||this,a.birds_copied&&a.birds_copied[r]?(l=h.get_guid(),a.nests_copied&&a.nests_copied[l]?(d=a.nests_copied[l][0].copy(),a.nests_copied[l].forEach(function(a){k.call(a,d)})):d=e.nest.create(this.get_description(),b,e.UTILITIES.generate_unique_id()),a.birds_copied[r].forEach(function(a){g.call(a,d)})):d=e.nest.create(this.get_description(),b,r,h,q,this.get_name()),a.nests_copied||(a.nests_copied={}),a.nests_copied[h]?a.nests_copied[l].push(d):a.nests_copied[l]=
[d]):d=e.nest.create(this.get_description(),b,r,c||this,q,this.get_name());return this.add_to_copy(d,a)};v.has_contents=function(){return 0<m.length};v.dropped_on_other=function(a,b,c,d){var l,h,f,g,m,k,n;if(!r){r=e.UTILITIES.generate_unique_id();e.debugging&&(this._debug_string=this.to_debug_string());l=e.bird.create(this);if(d){d.add_newly_created_widget(l);if(!this.visible())return;this.robot_waiting_before_next_step=d}c&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(l);
e.sounds&&setTimeout(function(){e.sounds.hatching.play()},1E3);this.rerender();h=this.get_frontside_element(!0);e.UTILITIES.add_animation_class(h,"toontalk-hatch-egg");m=function(){var m,q,r;if(b)m=a.get_backside();else if((r=e.UTILITIES.widget_from_jquery($(h).closest(".toontalk-top-level-backside")))||(r=e.UTILITIES.widget_from_jquery($(a.get_widget().get_frontside_element(!0)).closest(".toontalk-top-level-backside"))),r)m=r.get_backside();else{e.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");
return}q=m.get_element();r=$(q).offset();f=l.get_frontside_element(!0);$(f).removeClass(this.get_class_name_with_color("toontalk-bird-static"));e.UTILITIES.add_animation_class(f,"toontalk-fly-southwest");g=e.UTILITIES.relative_position(h,q);e.UTILITIES.set_css(f,{left:g.left,top:g.top});c&&this.robot_in_training()?m.widget_dropped_on_me(l,!1,c,void 0,!0):m.widget_dropped_on_me(l,!1,c);$(h).removeClass("toontalk-hatch-egg").addClass(this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",
height:""});this.get_parent_of_frontside().get_widget().is_top_level()&&e.UTILITIES.set_css(h,{left:g.left-5,top:g.top+45});this.get_parent_of_frontside().render();n=function(){$(f).removeClass("toontalk-fly-southwest");e.UTILITIES.set_timeout(function(){e.UTILITIES.add_animation_class(f,"toontalk-fly-down");$(f).removeClass(this.get_class_name_with_color("toontalk-bird-static"));k=function(){var a=function(){$(f).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass(this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);
$(f).removeClass("toontalk-fly-down");e.UTILITIES.add_animation_class(f,"toontalk-bird-morph-to-static");e.UTILITIES.add_one_shot_event_handler(f,"animationend",1E3,a);d&&(this.robot_waiting_before_next_step=void 0,d.run_next_step());l.update_display()}.bind(this);e.UTILITIES.add_one_shot_event_handler(h,"animationend",1E3,k)}.bind(this))}.bind(this);$(f).removeClass(this.get_class_name_with_color("toontalk-bird-static"));m=Math.max(10,g.left-70);q=Math.max(10,g.top+70);l.animate_to_absolute_position({left:m+
r.left,top:q+r.top},n,d&&d.transform_animation_speed(e.UTILITIES.default_animation_speed));this.rerender()}.bind(this);e.UTILITIES.add_one_shot_event_handler(h,"animationend",2E3,m)}return!0};v.widget_dropped_on_me=function(a,b,c,d){c&&a.save_dimensions&&a.save_dimensions();0===m.length?(this.add_to_contents(b?a.get_backside():a,c,d),a.dropped_on_other?a.dropped_on_other(this,b,c,d):c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(m[0].get_widget(),b,c,d);return!0};
v.drop_on=function(a,b,c,d){return a.widget_dropped_on_me?(a.widget_dropped_on_me(this,!1,c,d),!0):!1};v.element_to_highlight=function(){return 0===m.length?this.get_frontside_element():m[0].get_frontside_element()};v.update_display=function(){var a=this.get_frontside(!0),b=this.get_backside(),c,d,l,h,f,a=a.get_element();a.setAttribute("toontalk_name",this.get_name());0<m.length?(c=m[0].get_widget(),m[0].is_backside()?(h=c.get_backside(!0),f=h.get_element(),h.update_display(),h.scale_to_fit(f,a)):
(c.render(),f=m[0].get_element(),$(f).show()),d=$(a).width(),l=$(a).height(),0<d&&0<l&&e.UTILITIES.set_timeout(function(){var a=this.get_contents_dimensions();a&&(e.UTILITIES.set_css(f,{width:a.width,height:a.height,left:.1*d,top:.1*l}),c.set_size_attributes&&c.set_size_attributes(a.width,a.height))}.bind(this),2),a.appendChild(f),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest")),m[0].is_backside()?c.set_parent_of_backside(this):c.set_parent_of_frontside(this)):(e.UTILITIES.give_tooltip(a,
this.get_title()),r?($(a).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest"))):e.UTILITIES.add_animation_class(a,this.get_class_name_with_color("toontalk-nest-with-egg")));$(a).addClass("toontalk-nest");b&&b.rerender()};n||(n=e.UTILITIES.generate_unique_id());v[n]=function(a,b){if(!A){if(b)return;A=[]}b?A.splice(A.indexOf(a),1):A.push(a)};v.get_contents_dimensions=function(){var a=this.get_frontside_element(),b=
$(a).width(),a=$(a).height(),b=e.nest.CONTENTS_WIDTH_FACTOR*b,a=e.nest.CONTENTS_HEIGHT_FACTOR*a,c=m[0],d;if(c)return d=c.is_box()?1:2,c=c.get_border_size?d*c.get_border_size(b,a):0,{width:b-c,height:a-c}};v.get_path_to=function(a,b){var c,d;if(0<m.length){c=m[0].get_widget();if(c===a)return e.path.to_widget_on_nest();if(c.get_path_to&&(d=e.path.to_widget_on_nest(),c=c.get_path_to(a,b)))return d.next=c,d}};v.walk_children=function(a){if(0<m.length)return a(m[0])};v.top_contents_is=function(a){return 0<
m.length&&m[0].get_widget()===a};v.any_nest_copies_visible=function(){var a=!1;if(!A)return!1;A.some(function(b){b.visible()&&(a=!0)});return a};v.compare_with=function(a){if(0<m.length)return m[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};v.compare_with_nest=function(a){return 0===m.length?0:1};v.compare_with_number=function(a){return 0<m.length?m[0].compare_with(a):-1};v.get_class_name_with_color=function(a){return q?a+["","-magenta","-yellow"][q%3]:a};v.generate_name=
function(){t++;return"#"+t.toString()};v.has_name(v);G=v.set_name;v.set_name=function(a,b){var c=this.get_name();if(!G.call(this,a,b))return!1;b&&$(".toontalk-bird").each(function(){this.getAttribute("toontalk_name")===c&&e.UTILITIES.widget_of_element(this).rerender()})};v.set_name(w);v.compare_with_box=v.compare_with_number;v.compare_with_scale=v.compare_with_number;v.add_standard_widget_functionality(v);C=v.set_visible;v.set_visible=function(a){C.call(this,a);a||this.set_locked(!1)};v.set_description(p);
e.debugging&&(v._debug_id=e.UTILITIES.generate_unique_id(),v._debug_string=v.to_debug_string());c&&r&&(n||(n=e.UTILITIES.generate_unique_id()),c[n](v));return v};h.create_function=function(a,b,d){var c=function(){return!1},h=e[b]&&e[b].function&&e[b].function[d],c={get_function_type:function(){return b},get_function_object:function(){return h},set_function_name:function(a){if(d===a)return!1;d=a;h=e[b]&&e[b].function&&e[b].function[d];this.add_to_contents=h.respond_to_message;return!0},is_function_nest:function(){return!0},
copy:function(){return e.nest.create_function(a,b,d)},animate_bird_delivery:function(a,b,c,d,e){b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,e)},get_json:function(a){return{type:"function_nest",function_type:b,function_name:h?h.name:e.UTILITIES.get_first_property(e[b].function)}},add_to_json:e.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return h.short_name},has_ancestor:c,visible:c,any_nest_copies_visible:c,is_backside:c};e.widget.has_parent(c);
e.widget.has_description(c);e.widget.add_sides_functionality(c);c.set_description(a);h?(c.add_to_contents=h.respond_to_message,e.debugging&&(c._debug_id=e.UTILITIES.generate_unique_id(),c._debug_string="a function nest that "+h.toString())):e.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+b+"."+d+" is not defined.");return c};e.creators_from_json.function_nest=function(a,b){return e.nest.create_function(a.description,a.function_type,a.function_name)};h.create_backside=
function(){return e.nest_backside.create(this)};h.match_nest_with_nest=function(a){return"matched"};h.toString=function(){return"a nest"};h.get_help_URL=function(){return"docs/manual/birds-nests.html"};h.get_type_name=function(a){return a?"nests":"nest"};h.maintain_proportional_dimensions=function(){return!0};h.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};h.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};
e.creators_from_json.nest=function(a,b){var d=!a.original_nest&&a.guid&&b&&b.guid_to_nest_table&&b.guid_to_nest_table[a.guid];d||(d=e.nest.create(a.description,e.UTILITIES.create_array_from_json(a.contents,b),a.guid,a.original_nest&&e.UTILITIES.create_from_json(a.original_nest,b),a.serial_number,a.name),b.guid_to_nest_table[a.guid]=d);return d};h.CONTENTS_WIDTH_FACTOR=.8;h.CONTENTS_HEIGHT_FACTOR=.8;return h}(window.TOONTALK);window.TOONTALK.nest_backside=function(a){return{create:function(b){var d=
a.backside.create(b);d.get_element().appendChild(a.backside.create_advanced_settings_button(d,b));d.add_advanced_settings(!0);return d}}}(window.TOONTALK)})();window.TOONTALK.scale=function(g){var k=Object.create(g.widget);k.create=function(a,d,b,e,h){var k=function(){b.rerender()},f,t,p;b||(b=g.box.create(2,void 0,a,d,h||""));f=b.get_json;t=b.copy;p=b.get_path_to;b.is_scale=function(){return!0};b.copy=function(a){var d,c=this.get_name();a||(a={});d=t.call(this,a);d=g.scale.create(void 0,void 0,d,a.just_value&&this.get_state());d.set_name(c);return b.add_to_copy(d,a)};b.get_json=function(a){a=f.call(this,a);a.type="scale";a.inactive_state=this.get_inactive_state();
return a};b.get_path_to=function(a,b){var c=p.call(this,a,b);c&&(c.true_type="scale");return c};b.drop_on=function(a,b,c,d){if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,b,c,d)};b.widget_dropped_on_me=function(a,b,c,d){var e=this.get_hole_contents(0),h=this.get_hole_contents(1),f;a.dropped_on_other&&a.dropped_on_other(this,!1,c,d);if(e&&!h)return this.get_hole(1).widget_dropped_on_me(a,b,c,d),!0;if(!e&&(h||!c))return this.get_hole(0).widget_dropped_on_me(a,b,c,d),!0;f=this.which_hole(c,
!1);if(0===f){if(e){if(e.drop_on)return a.drop_on(e,b,c,d);return}}else if(h){if(h.drop_on)return a.drop_on(h,b,c,d);return}this.get_hole(f).widget_dropped_on_me(a,b,c,d);return!0};b.which_hole=function(a,d){var c=$(b.get_frontside_element()),e=c.offset(),c=c.width(),e=a.clientX-(e.left+c/2),c=d?c/10:0;return-e>c?0:e>c?1:-1};b.get_inactive_state=function(){return e};b.update_display=function(){var a=this.get_frontside_element(),b=$(a),c=$(a).children(".toontalk-scale-half"),d=$(a).parent(),d=d.is(".toontalk-backside")?
a:d.get(0),e=$(d).width(),h=$(d).height(),f=function(a,b,c){var d=(b.get_contents()||b).get_frontside_element(!0),f=c*e*.5,g=.5*e,m=h;b=b.get_contents();$(a).css({left:f,top:0,width:g,height:m});a!==d&&(f=0===c?-.05*e:.15*e,c="toontalk-scale-balanced"===n?.1*h:0===c&&"toontalk-scale-left_heavier"===n||1===c&&"toontalk-scale-right_heavier"===n?.25*h:1===c&&"toontalk-scale-left_heavier"===n||0===c&&"toontalk-scale-right_heavier"===n?-.1*h:.2*h,g=.4*e,m=.4*h,$(d).css({left:f,top:c,width:g,height:m}),
b&&(b.set_location_attributes&&b.set_location_attributes(f,c),b.set_size_attributes&&b.set_size_attributes(g,m)),a.appendChild(d))},k,n;b.is(".toontalk-top-level-resource")?n="toontalk-scale-balanced":(k=this.get_state(),n="undefined"===typeof k?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][k+1]);b.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");b.addClass(n);
b.addClass("toontalk-scale");b=g.UTILITIES.scale_to_fit(a,d,123,91);0===e&&(e=1);0===h&&(h=1);e/=b.x_scale;h/=b.y_scale;2===c.length?c.each(function(a,b){g.UTILITIES.set_timeout(function(){f(b,this.get_hole(a),a)}.bind(this))}.bind(this)):this.get_holes().forEach(function(b,c){var d=b.get_element();0===c?$(d).addClass("toontalk-left_scale  toontalk-scale-half"):$(d).addClass("toontalk-right_scale toontalk-scale-half");f(d,b,c);a.appendChild(d)});g.UTILITIES.give_tooltip(a,this.get_title());g.debugging&&
(this._debug_string=this.to_debug_string())};b.render=function(){g.DISPLAY_UPDATES.pending_update(this)};b.get_type_name=function(a){return a?"scales":"scale"};b.get_help_URL=function(){return"docs/manual/scales.html"};b.toString=function(){var a=this.get_hole_contents(0),b=this.get_hole_contents(1),c,d,e;switch(this.get_state()){case -1:c="scale leaning to the right";break;case 1:c="scale leaning to the left";break;case 0:c="balanced scale";break;default:if(c="unbalanced scale",!d&&!e)return c}d=
a?"contains "+g.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";e=b?"contains "+g.UTILITIES.add_a_or_an(b.get_full_description()):"is empty";return c+" and the left pan "+d+" and the right pan "+e};b.create_backside=function(){return g.scale_backside.create(this)};b.get_state=function(){var a=this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);b=this.get_hole_contents(1);if(a||b)if(a){if(!b)return 1;if(a.compare_with)return a.compare_with(b)}else return-1};b.match=function(a){if(a.match_with_scale)return a.match_with_scale(this);
this.last_match=a;return this};b.match_with_scale=function(a){return this.get_state()===a.get_state()?"matched":a};b.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};b.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};b.get_name_input_label=void 0;b.generate_name=function(){return""};b.get_hole(0).add_listener("value_changed",k);b.get_hole(1).add_listener("value_changed",k);b.get_hole_contents(0)&&b.get_hole_contents(0).add_listener("value_changed",
k);b.get_hole_contents(1)&&b.get_hole_contents(1).add_listener("value_changed",k);b.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};g.debugging&&(b._debug_id=
g.UTILITIES.generate_unique_id(),b._debug_string=b.to_debug_string());return b};g.creators_from_json.scale=function(a,d){return k.create(g.UTILITIES.create_array_from_json(a.contents,d),a.description,void 0,a.inactive_state,a.name)};return k}(window.TOONTALK);window.TOONTALK.scale_backside=function(g){return{create:function(k){var a=g.backside.create(k);a.get_element().appendChild(g.backside.create_advanced_settings_button(a,k));a.add_advanced_settings(!0);return a}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(g){var k=function(a,d,h,k,f){var t;h.current_action_name=d;(a=g.path.get_path_to(a,h))?(k||(k={}),t=Date.now(),k.time=t-h.time_of_last_step,h.time_of_last_step=t,h.add_step(g.robot_action.create(a,d,k),f)):console.log("No path found for "+d);h.current_action_name=void 0},a=Object.create(g.widget),d=0;a.create=function(b,d,h,k,f,t,p,m,r){var c=Object.create(a),q,w,v,D=[],H=[],I,A,G,C;h||(h=g.actions.create());q||(q=c);c.is_robot=function(){return!0};c.get_frontside_conditions=
function(){return b};c.set_frontside_conditions=function(a){b=a;b.set_parent_of_frontside(this)};b&&b.set_parent_of_frontside(c);c.get_backside_conditions=function(){return d};c.get_backside_matched_widgets=function(){return C};c.set_backside_matched_widgets=function(a){C=a};c.get_matched_backside_widget=function(a){if(C)return C[this.get_context().get_backside_widgets().indexOf(a)]};c.get_backside_widget_of_type=function(a,b){var c,d;if(C)return C[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&
0>this.get_newly_created_widgets().indexOf(b))return d=b,!0}.bind(this)),d};c.set_backside_conditions=function(a){$.isArray(a)?d=a.map(function(a){return a.is_nest()?a.dereference().copy():a}):(d=[],g.UTILITIES.available_types.forEach(function(b){a[b]&&d.push(a[b])}));d&&d.forEach(function(a){g.widget.erasable(a);a.set_parent_of_frontside(this)}.bind(this))};d&&c.set_backside_conditions(d);c.initialize_backside_conditions=function(){var a=this.get_context();G=g.UTILITIES.copy_widget_sides(a.get_backside_widgets(),
{just_value:!0});a.get_backside_widgets().forEach(function(a){a.is_backside()||(a.is_nest()&&a.dereference()!==a?this.add_to_backside_conditions(a):a.walk_children&&a.walk_children(function(b){return b.is_nest()&&!b.is_hole()&&b.dereference()!==b?(this.add_to_backside_conditions(a),!1):!0}.bind(this)))}.bind(this))};c.add_to_backside_conditions=function(a){var b;0<=this.get_newly_created_widgets().indexOf(a)||(d||(d=[]),a=this.get_context().get_backside_widgets().indexOf(a),0<=a&&(b=G[a]),b&&0>d.indexOf(b)&&
(d.push(b),g.widget.erasable(b)))};c.get_backside_condition_index=function(a){a=this.get_context().get_backside_widgets().indexOf(a);if(0<=a)return d.indexOf(G[a])};c.get_body=function(){return h};c.set_body=function(a){h=a};c.get_running=function(){return I||this.is_ok_to_run()};c.running_or_in_run_queue=function(){return I};c.set_running_or_in_run_queue=function(a){I=a};c.stopped=function(){return A};c.set_stopped=function(a){if(A=a)this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),
this.drop_thing_in_hand(),this.rerender()),I=!1;this.get_next_robot()&&this.get_next_robot().set_stopped(a)};c.drop_thing_in_hand=function(){f&&(f.drop_on(this.top_level_widget(),!1,void 0,this),this.set_thing_in_hand(void 0))};c.finish_cycle_immediately=function(a){var b=v,c=function(){v=b;this.set_visible(!1);a&&a()}.bind(this);v=0;this.add_body_finished_listener(c)};c.get_maximum_step_duration=function(){return v};c.animate_consequences_of_actions=function(){return this.visible()&&0!==v};c.transform_step_duration=
function(a){return void 0===a&&0===v?0:r&&a?a/r:"number"===typeof v?Math.min(a,v):a};c.transform_original_step_duration=function(a){if(!r)return a};c.transform_animation_speed=function(a){return r?a*r:a};c.set_animating=function(a,b){var c=this.get_frontside_element();a?(b||(b=$(c).offset()),$(c).addClass("toontalk-robot-animating toontalk-side-animating"),$(c).css({width:"",height:"","z-index":g.UTILITIES.next_z_index()}),g.UTILITIES.set_position_relative_to_top_level_backside($(c),b),$(c).closest(".toontalk-top-level-backside").append(c)):
$(c).removeClass("toontalk-robot-animating toontalk-side-animating")};c.add_body_finished_listener=function(a){D.push(a)};c.run_body_finished_listeners=function(a,b,c){D.forEach(function(d){d(a,b,c)});D=[]};c.add_watched_step_end_listeners=function(a){H.push(a)};c.run_watched_step_end_listeners=function(){H.forEach(function(a){a()});H=[]};c.get_thing_in_hand=function(){return f};c.set_thing_in_hand=function(a){if(g.debugging){if(a&&"empty hole"===a.get_type_name()){g.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");
return}g.logging&&0<=g.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string()+" now has in his hand "+(a?a.to_debug_string():"nothing"))}f=a};c.get_next_robot=function(){return p};c.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());!a&&p&&(p.set_first_in_team(p),p.set_previous_robot(void 0));(p=a)&&p.set_previous_robot(this);b&&(a=a?"When the robot can't run then this one will try: ":window.TOONTALK.robot.empty_drop_area_instructions,
$(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=a)};c.get_previous_robot=function(){return w};c.set_previous_robot=function(a){w=a};c.get_first_in_team=function(){return q};c.set_first_in_team=function(a){q=a;p&&p.set_first_in_team(a)};c.walk_children=function(a){var b;p&&!a(p)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};c.get_run_once=function(){return t};c.set_run_once=function(a){t=a;this.update_title();return!0};c.get_watched_speed=function(){return r};c.set_watched_speed=
function(a){r=a;return!0};c.can_run=function(){return this.get_frontside_conditions()&&this.get_frontside_conditions().is_top_level()||g.widget.can_run.call(this)};c.training_started=function(a){var b=this.get_context();b?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(b.copy({just_value:!0})),this.initialize_backside_conditions(),a||($("*").css({cursor:"url("+g.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),
this.update_title(),a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):g.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};c.training_finished=function(){if(this.being_trained){var a,b,c;a=this.get_body().get_newly_created_widgets();for(b=0;b<a.length;b++)c=a[b],"drop it on top-level"!==c.last_action&&"copy"!==c.last_action||this.add_step(g.robot_action.create(g.newly_created_widgets_path.create(b),
"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):$("*").css({cursor:""})}};if(g.debugging||g.logging)c.to_debug_string=function(){var a=this.get_frontside_conditions();return"Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(a?
g.UTILITIES.add_a_or_an(a.toString()):"anything")};p&&c.set_next_robot(p);c=c.add_standard_widget_functionality(c);c.has_name(c);c.set_name(m);c.set_description(k);g.debugging&&(c._debug_id=g.UTILITIES.generate_unique_id(),c._debug_string=c.to_debug_string());return c};a.create_backside=function(){return g.robot_backside.create(this)};a.copy=function(a){var d=this.get_frontside_conditions(),h=this.get_backside_conditions(),d=d?d.copy({just_value:!0}):void 0,k=this.get_next_robot(),k=k?k.copy(a):void 0,
f;h&&(f=g.UTILITIES.copy_widgets(h,{just_value:!0}));h=this.create(d,f,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),k,(!a||!a.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(h,a)};a.match=function(a){var d,h;if(a.is_robot()&&(d=this.get_body().is_empty(),h=a.get_body().is_empty(),d===h))return"matched";this.last_match=a;return this};a.generate_name=function(){d++;return"#"+d.toString()};a.run=function(a,d,h){var k=this.get_frontside_conditions(),
f,t,p,m,r,c;if(this.being_trained||this.running_or_in_run_queue())return this;c=(r=this.get_backside())&&r.visible();p=function(a){$(a.get_frontside_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")};c&&p(k);this.rerender();this.match_status=g.UTILITIES.match(k,a);"matched"===this.match_status&&(m=[],k=this.get_backside_conditions())&&
((f=a.get_backside_widgets())&&k.some(function(a){var b,d;a.matching_widget&&a.matching_widget.get_parent_of_frontside()&&(b=g.UTILITIES.match(a,a.matching_widget),"matched"===b&&(m.push(a.matching_widget),d=b));d||f.some(function(e){b=void 0;if(!(0<=m.indexOf(e)||e.is_backside())){c&&p(e);b=g.UTILITIES.match(a,e);if("matched"===b)return m.push(e),d=b,a.matching_widget=e,!0;if(!b.is_widget)d=b;else if(!d||d.is_widget)d=b}}.bind(this));if("matched"!==d)return this.match_status=d,!0}.bind(this)),"matched"!==
this.match_status&&(m=void 0),this.set_backside_matched_widgets(m));if("matched"===this.match_status)return h||(h=g.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),h.enqueue({robot:this,context:a,top_level_context:d,queue:h}),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),this.rerender(),this.get_next_robot()?this.get_next_robot().run(a,d,h):this.match_status;this.match_status.forEach(function(a){a[1]&&
$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){k=this.get_next_robot().run(a,d,h);if("matched"===k)return k;k.is_widget||k.forEach(function(a){0>this.match_status.indexOf(a)&&this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(t=function(){this.set_waiting(!1);this.run(a,d,h)}.bind(this),this.match_status.forEach(function(a){a[0]?a[0].run_when_non_empty(t,this):a.run_when_non_empty(t,this)}.bind(this)),this.set_waiting(!0));
return this.match_status};a.set_waiting=function(a){var d=this.get_frontside_element();a?(g.UTILITIES.add_animation_class(d,"toontalk-robot-waiting"),g.UTILITIES.give_tooltip(d,"This robot is waiting for a bird to deliver something.")):($(d).removeClass("toontalk-robot-waiting"),g.UTILITIES.give_tooltip(d,this.get_title()))};a.run_actions=function(a,d,h){return this.stopped()?(this.get_first_in_team().set_running(!1),!1):this.visible()?this.get_body().run_watched(a,d,h,this):this.get_body().run_unwatched(a,
d,h,this)};a.drop_from_data_transfer=function(a,d){var h;a.is_top_level&&a.is_top_level()?(h=a.get_backside_widgets().slice(),setTimeout(function(){h.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=1E3;this.dropped_on(a,d.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};a.picked_up=function(a,d,h){var k,f;if(this!==a&&!(a.is_top_level()||d&&d.view.backside))return a.get_infinite_stack&&a.get_infinite_stack()?this.current_action_name=
"pick up a copy of":this.current_action_name="pick up",h?(f=a,d=a.copy({fresh_copy:!0}),d=g.path.get_path_to_resource(d)):d=g.path.get_path_to(a,this),d&&(h=Date.now(),k={time:h-this.time_of_last_step},this.time_of_last_step=h,k=g.robot_action.create(d,this.current_action_name,k),this.add_step(k,f)),a.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(a),k};a.dropped_on=function(a,d){var h,k,f,t,p;if(this!==a&&(!this.get_parent_of_frontside()||this.get_parent_of_frontside().get_widget()!==
a)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(h=g.path.get_path_to(d,this))d.is_backside()?(f=$(d.get_element()),k=f.offset(),t=f.width(),p=f.height(),f=$(a.get_frontside_element()).offset(),t=(f.left-k.left)/t,k=(f.top-k.top)/p,t=Math.max(0,Math.min(1,t)),k=Math.max(0,Math.min(1,k)),k={left_offset_fraction:t,top_offset_fraction:k}):k={},f=Date.now(),k.time=f-this.time_of_last_step,
this.time_of_last_step=f,h=g.robot_action.create(h,this.current_action_name,k),this.add_step(h);a.last_action=this.current_action_name+" "+d.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};a.dropped_on_text_area=function(a,d,h){k(a,"drop it on the text area of",this,h);a.last_action="drop it on the text area of "+d.get_type_name();this.set_thing_in_hand(void 0)};a.copied=function(a,d,h){h=h?"pick up a copy of":"copy";k(a,h,this,void 0,d);d.last_action=h};a.removed=
function(a){var d;this.get_parent_of_frontside()&&(d=this.get_parent_of_frontside().get_widget());k(a,"remove",this);a.last_action="remove";d===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};a.edited=function(a,d){k(a,"edit",this,d)};a.erased_widget=function(a){k(a,"change whether erased",this)};a.resized_widget=function(a,d,h,g,f){d===g&&h===f||k(a,"change size of",this,{x_factor:g/d,y_factor:f/h})};a.started_training_another=
function(a){k(a,"start training",this)};a.finished_training_another=function(a){k(a,"stop training",this)};a.trained=function(a,d){k(a,"train",this,{step:d})};a.backside_opened=function(a){k(a,"open the backside",this)};a.backside_closed=function(a){k(a,"close the backside",this)};a.button_clicked=function(a,d){k(d.get_widget(),"click the button of",this,{button_selector:a})};a.created_widget=function(a,d,h){this.add_newly_created_widget(a);this.add_to_top_level_backside(a,!1);this.add_step(g.robot_action.create(g.path.get_path_to_resource(a.copy()),
"add a new widget to the work space",{button_selector:h,path_to_source:g.path.get_path_to(d,this)}))};a.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};a.remove_from_container=function(a,d){var h=d.get_index_of&&a.get_parent_of_frontside()&&d.get_index_of(a),g=function(){d.removed_from_container(a,!1,!0,h,!1)};this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(g):g();this.add_newly_created_widget_if_new(a)};a.add_step=function(a,d){this.get_body().add_step(a,
d);this.update_title();"train"!==a.get_action_name()&&"start training"!==a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,a)};a.get_context=function(){var a=this.get_frontside_element(),d=$(a).parent(),a=g.UTILITIES.widget_from_jquery(d);return!a&&(d=g.UTILITIES.widget_from_jquery(d.closest(".toontalk-backside-of-robot")))?d.get_context():a};a.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var d=this.get_thing_in_hand(),
h,k;g.debugging&&(this._debug_string=this.to_debug_string());h=a.get_element();d&&(k=d.get_frontside_element());!k&&this.carrying_tool&&(k=document.createElement("div"),$(k).addClass(this.carrying_tool));g.UTILITIES.give_tooltip(h,this.get_title());$(h).addClass("toontalk-robot");$(h).children(".toontalk-side, .toontalk-held-by-robot").remove();k&&h.appendChild(k);this.match_status&&(this.match_status.is_widget?$(h).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(h).removeClass("toontalk-robot-not-matched"));
h.setAttribute("toontalk_name",this.get_name());g.UTILITIES.set_timeout(function(){var a,b,g,m,r;k&&(r={position:"absolute"},$(k).addClass("toontalk-held-by-robot"),a=$(k).width(),$(k).height(),g=$(h).width(),m=$(h).height(),d&&0===a&&(a=d.get_default_width?d.get_default_width():2*g,b=d.get_default_height?d.get_default_height():m/2,r.width=a,r.height=b),r.left=(g-a)/2,r.top=m/4,$(k).css(r),d&&d.render())})};a.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};
a.add_newly_created_widget_if_new=function(a){if(a!==this.get_context()&&this!==a)return this.get_body().add_newly_created_widget_if_new(a)};a.is_newly_created=function(a){return this.get_body().is_newly_created(a)};a.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-1]};a.get_title=function(){var a=this.get_description();if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?
"Drag this robot to a work area.":this.toString()};a.toString=function(a){var d,h,k,f,t,p,m,r,c,q,w,v,D;if(a&&"conditions"===a.role)return"any robot";d=this.get_frontside_conditions();if(!d)return"an untrained robot";m=d.is_top_level();a||(a={});w=a.person;if(a&&a.resource){if(this.get_description())return'"'+this.get_description()+'"';a.person="third"}h=this.get_backside_conditions();f=this.get_body();p=t="";c=this.get_next_robot();m?q="When the workspace's green flag "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
" is pressed":(r=g.UTILITIES.add_a_or_an(d.get_full_description({role:"conditions"})),q="When working on something that matches "+r);h&&(h.forEach(function(a){a&&(q+=" and\nif on the"+(m?" work area ":" back ")+" is "+g.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),k=!0)}),k&&(q+="\n"));if(this.being_trained){if(f.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";t="is being trained.\n";p="\n..."}f=t+q+(a&&"third"===a.person?
" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(f.toString({robot:this})||"do nothing")+p;if(a&&a.resource)return a.person=w,f.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(D=d.is_top_level()?"the work area I'm running on":"the "+d.get_type_name()+" I'm on the back of",this.match_status===d?v=D:this.match_status.has_ancestor(d)?v="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+D:(d.is_top_level()||(D="the "+
this.match_status.get_type_name()+" on "+D),h.some(function(a){if(this.match_status===a)return v="any "+a.get_type_name(!0)+" on ",d.is_top_level()||(v+="the back of "),v+=D,!0;if(this.match_status.has_ancestor(a))return v="any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+D,!0}.bind(this))),f="I'm not running because the "+this.match_status+" (highlighted in red on my backside) that I'm expecting doesn't match "+v+". Perhaps editing my conditions will help.\n"+
f):"matched"!==this.match_status&&(f="I'm waiting for something to be delivered to the nest that matches the "+this.match_status[0][1]+" in my conditions (highlighted in yellow on my backside).\n"+f));c&&(f+="\nIf it doesn't match then the next robot will try to run.\n"+c.toString());return f};a.get_type_name=function(a){return a?"robots":"robot"};a.maintain_proportional_dimensions=function(){return!0};a.matching_resource=function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&
this.get_body().is_empty()&&a.get_body().is_empty()};a.get_top_level_context_description=function(a){var d=this.get_frontside_conditions().get_type_name();return"top-level"===d?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+d+" he's working on":"the "+d+" I'm working on"};a.get_help_URL=function(){return"docs/manual/robots.html"};a.get_json=function(a){var d=this.get_frontside_conditions(),h=this.get_backside_conditions(),k,f,t;d&&(k=d.is_top_level()?{type:"top_level"}:
g.UTILITIES.get_json(d,a));h&&(f=g.UTILITIES.get_json_of_array(h,a));this.get_next_robot()&&(t=g.UTILITIES.get_json(this.get_next_robot(),a));return{type:"robot",frontside_conditions:k,backside_conditions:f,body:this.get_body().get_json(a),run_once:this.get_run_once(),next_robot:t,name:this.get_name(),speed:this.get_watched_speed()}};g.creators_from_json.robot=function(a,d){var h,k,f,t,p;a.thing_in_hand&&(k=g.UTILITIES.create_from_json(a.thing_in_hand,d));a.next_robot&&(h=g.UTILITIES.create_from_json(a.next_robot,
d));a.backside_conditions&&($.isArray(a.backside_conditions)?t=g.UTILITIES.create_array_from_json(a.backside_conditions,d):a.semantic&&g.UTILITIES.available_types.forEach(function(d){a.semantic.backside_conditions[d]&&t.push(g.UTILITIES.get_json(a.semantic.backside_conditions[d],json_history))}));f=g.UTILITIES.create_from_json(a.frontside_conditions||a.bubble,d);p=g.robot.create(f,t,void 0,a.description,k,a.run_once,h,a.name,a.speed);d||(d={});d.robot=p;p.set_body(g.UTILITIES.create_from_json(a.body,
d));setTimeout(function(){p.visible()&&(t&&t.forEach(function(a){a.set_visible(!0);a.render()}),f&&(f.set_visible(!0),f.render()))},1E3);return p};a.find_conditions_path=function(a,d,h){var k=d.get_frontside_conditions(),f=k===a?"entire_condition":k.get_path_to&&k.get_path_to(a,h),k=g.path.get_path_to(d,h),t;f||(d=d.get_backside_conditions(),d.some(function(d){d&&(f=d.get_path_to(a,h))&&(t=d)}));if(f)return g.robot.create_conditions_path(f,k,t);g.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};
a.create_conditions_path=function(a,d,h){"string"===typeof h&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===h)return h=a,!0});return{dereference_path:function(k,f,t){k=g.path.dereference_path(d,k,f,t);k=h?h:k.get_frontside_conditions();return"entire_condition"===a?k:g.path.dereference_path(a,k,f,t)},toString:function(){var k="entire_condition"===a?"the ":g.path.toString(a)+" of the ";return h?k+h.toString()+" backside condition of "+g.path.toString(d):k+" front side condition of "+
g.path.toString(d)},get_json:function(){return{type:"path_to_robot_conditions",backside_condition:g.UTILITIES.get_json(h),path_to_robot:d.get_json(),path_within_conditions:"entire_condition"===a?"entire_condition":a.get_json()}}}};g.creators_from_json.path_to_robot_conditions=function(a){var d=g.UTILITIES.create_from_json(a.path_to_robot),h="entire_condition"===a.path_within_conditions?a.path_within_conditions:g.UTILITIES.create_from_json(a.path_within_conditions);a=a.backside_condition?g.UTILITIES.create_from_json(a.backside_condition):
a.backside_condition_type;return g.robot.create_conditions_path(h,d,a)};return a}(window.TOONTALK);window.TOONTALK.robot_backside=function(g){var k=function(a,b,e,h){a=g.UTILITIES.create_text_element(a);var k=b.get_frontside_element(!0),f=document.createElement("div");$(k).addClass("toontalk-conditions-contents "+h);g.UTILITIES.set_timeout(function(){$(k).parent().addClass("toontalk-conditions-contents-container");$(k).css({left:"inherit",width:"inherit",height:"inherit"});b.rerender()});e.match_status&&
(e.match_status.is_widget?$(e.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==e.match_status&&e.match_status.forEach(function(a){$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")}));f.appendChild(k);e=g.UTILITIES.create_horizontal_table(a,f);$(e).addClass("toontalk-conditions-panel");return e},a=function(a,b){var e=b.get_frontside_conditions(),h=b.get_backside_conditions(),n=b.visible(),f;e&&(e.is_top_level()?0>a.firstChild.textContent.indexOf("I always run when the green flag")&&
a.insertBefore(g.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),a.firstChild):0===$(a).find(".toontalk-frontside-conditions-area").length&&a.insertBefore(k("I run only if the thing I'm on the back of matches: ",e,b,"toontalk-frontside-conditions-area"),a.firstChild),e.set_visible(n),e.rerender());h&&h.forEach(function(e){var h;e&&(h=e.get_type_name(),f="toontalk-backside-"+h+"-conditions-area",h="bird"===h?g.UTILITIES.create_text_element("And there is a bird on the back."):
k("And if "+g.UTILITIES.add_a_or_an(h)+" matches: ",e,b,f),a.insertBefore(h,a.firstChild.nextSibling),e.set_visible(n),e.rerender())})};return{create:function(d){var b=g.backside.create(d),e=b.get_element(),h=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},k=g.UTILITIES.create_check_box(!d.get_run_once(),"toontalk-run-once-check-box","When finished start again",
h(d.get_run_once())),f="normal;original;double;half;very fast;very slow".split(";"),t=[1,void 0,2,.5,10,.25],p=function(a){a=f.indexOf(a);return t[a]},m=g.UTILITIES.create_select_menu("robot_speed",f,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),
r=g.UTILITIES.create_drop_area(window.TOONTALK.robot.empty_drop_area_instructions),c=d.get_next_robot(),q=g.backside.create_advanced_settings_button(b,d),w=b.update_display.bind(b),v=function(a,b){setTimeout(function(){var c=a.get_frontside_element(d.visible()),e,h;a.get_default_width&&(e=a.get_default_width(),h=a.get_default_height(),$(c).css({left:"",top:"",width:e,height:h}));b.appendChild(c)})};r.data("drop_area_owner",d);$(k.button).click(function(a){var b=k.button.checked;d.set_run_once(!b);
g.UTILITIES.give_tooltip(k.container,h(!b));d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_run_once",argument_1:!b,toString:"change to "+(b?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});a.stopPropagation()});m.menu.value=function(a){a=a?t.indexOf(a):1;return f[a]}(d.get_watched_speed());m.menu.addEventListener("change",function(a){d.set_watched_speed(p(a.target.value))});c&&v(c,r.get(0));r.get(0).addEventListener("drop",function(a){a=
g.UTILITIES.get_dragee();(a=g.UTILITIES.widget_from_jquery(a))&&a.is_robot()&&(a.get_body().is_empty()?(a=a.open_backside(),$(a.get_element()).find(".toontalk-train-backside-button").click()):(v(a,r.get(0)),d.set_next_robot(a)))});b.update_display=function(){var a=d.get_frontside_element();a&&g.UTILITIES.give_tooltip(a,d.get_title());w()};e.appendChild(this.create_train_button(b,d));e.appendChild(q);$(k.container).addClass("toontalk-advanced-setting");$(m.container).addClass("toontalk-advanced-setting");
r.addClass("toontalk-advanced-setting");e.appendChild(k.container);e.appendChild(m.container);e.appendChild(r.get(0));a(e,d);b.add_advanced_settings();return b},create_train_button:function(d,b){var e=d.get_element();$(e);var h=$("<button>Train</button>").button();h.addClass("toontalk-train-backside-button");var k=!1;d.change_label_and_title_of_train_button=function(d){d?(h.button("option","label","Stop training "+b.get_name()),g.UTILITIES.give_tooltip(h.get(0),"Click to stop training this robot.")):
b.get_body().is_empty()?(h.button("option","label","Train"),g.UTILITIES.give_tooltip(h.get(0),"Click to start training this robot.")):(h.button("option","label","Re-train "+b.get_name()),g.UTILITIES.give_tooltip(h.get(0),"Click to start training this robot all over again."));g.UTILITIES.visible_element(e)&&a(e,b)};d.change_label_and_title_of_train_button(k);h.click(function(a){k=!k;d.change_label_and_title_of_train_button(k);k?(b.get_body().reset_steps(),b.robot_started_training(b),b.training_started()):
b.training_finished();a.stopPropagation()});return h.get(0)}}}(window.TOONTALK);window.TOONTALK.robot.empty_drop_area_instructions="Drop a robot here who will try to run when I can't."})();(function(){var g=function(a){return"rotate"===a||"skewX"===a||"skewY"===a||"transform-origin-x"===a||"transform-origin-y"===a},k=function(a){return"transform-origin-x"===a||"transform-origin-y"===a?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+a:g(a)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+a:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+a};window.TOONTALK.element=function(a){var d=["left","top","width","height"],b=Object.create(a.widget),e=
function(a,b){var d,e;if(!a)return 0;"number"===typeof a&&(e=a);0===a.length&&(e=0);if("undefined"===typeof e&&(d=a.substring(a.length-1),0<="0123456789x".indexOf(d)&&(e=parseFloat(a),isNaN(e))))return;d=e;0<=["rotate","skewX","skewY"].indexOf(b)&&(d%=360,0>d&&(d+=360));return d};b.create=function(d,e,f,k,p,m,r){var c=Object.create(b),q=a.UTILITIES.generate_unique_id(),w=c.drag_started,v={},D={},H,I,A,G,C,z,E,F,K,l,u,x,y,Q,S;e||(e=["left","top","width","height"]);k&&(H="string"===typeof k?new Audio(k):
k);p&&("string"===typeof p?d="<video src='"+p+"' alt='"+p+"'/>":I=p);c.is_element=function(){return!0};c.get_HTML=function(){return G};c.get_guid=function(){return q};c.get_text=function(){var a=this.get_frontside_element().textContent;""===a&&(this.update_display(),a=this.get_frontside_element().textContent);return""===a?this.get_HTML():a};c.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>c)break;b+=
3;d=a.indexOf("target='_blank'",b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(!b||G===a)return!1;G=c(a);$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element()?b.innerHTML=G.replace(/ /g,"&nbsp;"):b.innerHTML=G;C&&this.compute_original_dimensions(!0);return!0};c.set_HTML_from_sub_classes=
c.set_HTML;c.set_text=function(a){var b=this.get_frontside_element(),c=function(b){$(b).contents().each(function(){this.nodeType==Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};c.get_style_attributes=function(){return e};c.set_style_attributes=function(a){e=a};c.get_attribute_widgets_in_backside_table=function(){return v};c.get_original_copies=function(){return D};
c.get_pending_css=function(){return l};c.get_transform_css=function(){return u};c.add_to_css=function(a,b){g(a)?(u||(u={}),u[a]=b):(l||(l={}),l[a]=b)};c.apply_css=function(){var b="",c,d,e,h;if((l||u)&&(c=this.get_frontside_element())&&!$(c).is(".toontalk-not-observable"))if($(c).is(":visible")){l?(l.width&&(F=l.width),l.height&&(K=l.height)):l={};u&&("number"===typeof u.rotate&&(b+="rotate("+u.rotate+"deg)"),"number"===typeof u.skewX&&(b+="skewX("+u.skewX+"deg)"),"number"===typeof u.skewY&&(b+="skewY("+
u.skewY+"deg)"),"number"===typeof u["transform-origin-x"]||"number"===typeof u["transform-origin-y"])&&(l["transform-origin"]=(u["transform-origin-x"]||0)+" "+(u["transform-origin-y"]||0));if(l.left||l.top)if(h=this.get_parent_of_frontside())l.left&&(d=$(h.get_element()),e=d.width(),l.left=(l.left%e+e)%e),l.top&&(d||(d=$(h.get_element())),d=d.height(),l.top=(l.top%d+d)%d);F||K?(y&&y.css({width:z,height:E}),this.is_plain_text_element()&&this.plain_text_dimensions(),$(c).css({width:"",height:""}),a.UTILITIES.run_when_dimensions_known(c,
function(d){a.UTILITIES.scale_element(c,F,K,z,E,b,l,d);l=void 0})):(a.UTILITIES.add_transform_to_css(b,"",l,0>c.parentElement.className.indexOf("toontalk-box-hole")),$(c).css(l),l=void 0)}else a.UTILITIES.set_timeout(function(){this.apply_css()}.bind(this),100)};c.on_update_display=function(a){x?x.push(a):x=[a]};c.fire_on_update_display_handlers=function(){x&&a.UTILITIES.set_timeout(function(){x.forEach(function(a,b){a()||x.splice(b,1)})})};c.get_image_element=function(){return y};c.set_image_element=
function(a,b){y=$(a).find("img");0===y.length?y=void 0:($(b).width(y.width()),$(b).height(y.height()))};c.get_additional_classes=function(){return r};c.set_additional_classes=function(a){r=a};c.set_sound_effect=function(a){H=a};c.get_sound_effect=function(){return H};c.get_video_object=function(){I||(I=this.get_frontside_element().getElementsByTagName("video")[0]);return I};c.set_video_object=function(a){I=a};c.get_ignore_pointer_events=function(){return m};c.set_ignore_pointer_events=function(a){m=
a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":"auto"})};c.get_source_URL=function(){return A};c.set_source_URL=function(a){if(A!==a)return A=a,this.refresh(),!0};c.use_scaling_transform=function(b){""===b.width&&(b.width=void 0);""===b.height&&(b.height=void 0);a.UTILITIES.scale_element(this.get_frontside_element(),b.width,b.height,z,E,void 0,b)};c=c.add_standard_widget_functionality(c);Q=c.set_running.bind(c);c.set_running=function(a,b){Q(a,b);
Object.keys(v).forEach(function(c){v[c].set_running(a,b)});!a&&this.visible()&&(e.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())};S=c.can_run.bind(c);c.can_run=function(){var a;if(S())return!0;Object.keys(v).some(function(b){if(v[b].can_run())return a=!0});return a};c.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;w.call(this,a,b)};c.update_display=function(){var b=this.get_frontside_element();
this.get_backside();var c=function(a){return this.get_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged)if(this.get_erased()){var d;d=$(b).parent(".toontalk-backside").is("*")?c="":c="100%";this.save_dimensions();$(b).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:c,height:d,transform:""});$(b).parent(".toontalk-conditions-contents-container").is("*")?a.UTILITIES.give_tooltip(b,"This is an element that has been erased. It will match any element."):
a.UTILITIES.give_tooltip(b,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(b).is(".toontalk-erased-element")&&($(b).removeClass("toontalk-erased-element"),this.restore_dimensions()),this.initialize_element(),a.UTILITIES.on_a_nest_in_a_box(b)&&(this.set_attribute("width",$(b).closest(".toontalk-box-hole").width(),!1),this.set_attribute("height",$(b).closest(".toontalk-box-hole").height(),!1)),"undefined"===typeof z&&b.parentElement&&this.compute_original_dimensions(),
this.apply_css(),this.fire_on_update_display_handlers(),a.UTILITIES.give_tooltip(b,"Click to see the backside where you can place robots or change the style of this "+c(b)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};c.initialize_element=function(){var a=this.get_frontside_element();$(a).children(".ui-resizable-handle");var b;C||(G=this.get_HTML(),b=this.is_plain_text_element(),a.innerHTML=b?G.replace(/ /g,"&nbsp;"):G,$(a).addClass("toontalk-element-frontside"),b&&((b=this.get_additional_classes())&&
$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.plain_text_dimensions()),C=!0)};c.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};c.plain_text_dimensions=function(){z=9*this.get_HTML().length;E=24};c.compute_original_dimensions=function(b){a.UTILITIES.original_dimensions(this,function(a,b){var c=this.get_parent_of_frontside();z=a;E=b;c&&c.get_box?c.get_box().rerender():(e.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),
this.rerender())}.bind(this),b)};c.get_attribute_from_current_css=function(b){var c,d;if("width"===b&&(F||z))return F||z;if("height"===b&&(K||E))return K||E;c=this.get_frontside_element();d=a.UTILITIES.get_style_numeric_property(c,b);""===d&&(d=$(c).css(b));if(!d)return 0;if("number"===typeof d){if(z&&K){if("left"===b)return d+(z-F)/2;if("top"===b)return d+(E-K)/2}return d}return"%"!==d.charAt(d.length-1)||"left"!==b&&"top"!==b?d:$(c).offset()[b]};c.get_original_width=function(){return z};c.get_original_height=
function(){return E};c.increment_width=function(a){this.set_attribute("width",(F||z)+a)};c.increment_height=function(a){this.set_attribute("height",(K||E)+a)};c.set_HTML(d.toString());c.set_description(f);a.debugging&&(c._debug_id=a.UTILITIES.generate_unique_id(),c._debug_string=c.to_debug_string());return c};b.copy=function(a){var d=this.get_style_attributes(),e=b.create(this.get_HTML(),d.slice(),this.get_description(),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events());
e.set_source_URL(this.get_source_URL());a&&(a.elements_copied||(a.elements_copied={}),a.elements_copied[this.get_guid()]=e);d.forEach(function(a){e.set_attribute(a,this.get_attribute(a))}.bind(this));return this.add_to_copy(e,a)};b.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};b.match_with_any_element=
function(){return"matched"};b.match_with_another_element_widget=function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};b.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};b.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};b.widget_dropped_on_me=function(a,b,d,e){if(this.get_erased()&&a.get_HTML)return this.set_HTML(a.get_HTML()),
this.set_erased(!1),a.remove(),!0;console.log("Dropping widgets on un-erased elements does nothing (but may someday)")};b.create_backside=function(){return a.element_backside.create(this)};b.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};b.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a);return"undefined"!==typeof b&&"auto"!=b?b:this.get_attribute_from_current_css(a)};b.set_attribute=function(a,
b,d,g){var k,m;if(!this.get_frontside(!0).get_element())return!1;k=this.get_attribute_from_pending_css(a);if(k===b||"undefined"===typeof k&&(k=this.get_attribute_from_current_css(a),k===b))return!1;m=e(b,a);if("number"===typeof m){if(k==m)return!1;b=m}d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:a,argument_2:b,toString:"change the '"+a+"' style to "+b+" of",button_selector:".toontalk-element-"+a+"-attribute-input"});this.add_to_css(a,b);
g&&(b=this.get_style_attributes(),0>b.indexOf(a)&&b.push(a));this.rerender();return!0};b.dropped_on_style_attribute=function(a,b,d,e){var g,m,k;if(a){g=a.toString();if(a.is_number()){m=this.get_attribute(b);if("number"===typeof m)k=m;else if("auto"===m)switch(b){case "left":k=$(this.get_frontside_element()).offset().left;break;case "top":k=$(this.get_frontside_element()).offset().top;break;default:k=0}else k=parseFloat(m);m=a.to_float();switch(g.substring(0,1)){case "-":g=k-m;break;case "*":g=k*m;
break;case "/":g=k/m;break;case "^":g=Math.pow(k,m);break;default:g=k+m}this.set_attribute(b,g,!1);(d||e&&e.visible())&&this.get_backside().render()}a.get_infinite_stack()||a.remove();d&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};b.get_attribute_widget_in_backside_table=function(a,b,d){var e=this.get_attribute_widgets_in_backside_table()[a];e||b||(e=this.create_attribute_widget(a,d),this.get_attribute_widgets_in_backside_table()[a]=e);return e};
b.create_attribute_widget=function(b,e){var f=".toontalk-element-"+b+"-attribute-input",g=this.get_backside_element(),p=this.get_attribute(b),m=this,r=function(b,c){var d=c.toString,e=c.equals;H=c.update_display;c.element_widget=this;c.attribute=b;c.get_type_name=function(a){return a?"element attributes":"element attribute"};c.toString=function(){return d.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};c.get_custom_title_prefix=function(){return"I'm the '"+this.attribute+"' attribute of "+
this.get_attribute_owner()+".\nDrop a number on me or edit my back side to change my value. My back side has an info button to learn more."};c.equals=function(a){return b===a.attribute?this.equals(a.element_widget):e.call(this,a)};c.update_display=function(){var a;this.get_erased()||(a=this.get_attribute_owner().get_attribute(this.attribute),D(a));H.call(this)};v=c.copy.bind(c);c.copy=function(a){var c;if(a){if(a.just_value)return v(a);a.elements_copied&&(c=a.elements_copied[m.get_guid()])}return this.add_to_copy((c||
m).create_attribute_widget(b),a)};c.get_json=function(c){return{type:"attribute_widget",attribute_name:b,element:a.UTILITIES.get_json(m,c)}};c.get_original_attribute_widget=function(){var a=m.get_original_copies()[b];return a&&a[0]};c.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():m;if(!b.get_widget().is_element())return m;
b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=b.get_parent_of_backside();return b};c.get_help_URL=function(){return k(b)}}.bind(this),c=function(b,c){var d=a.number.create(0,1);r(b,d);d.set_value_from_decimal(c);d.set_format("decimal");d.set_value=function(a){var c=m.get_original_copies()[b];a=bigrat.toDecimal(a);var d=bigrat.fromDecimal(a);this.get_attribute_owner().set_attribute(this.attribute,a)&&c.forEach(function(a,b){a.set_value_from_sub_classes(d,
!0)});return this.set_value_from_sub_classes(d,!1)};d.is_attribute_widget=function(){return!0};d.get_function_type=function(){return"number"};return d}.bind(this),q=function(b,c){var d=a.element.create(c);r(b,d);d.set_HTML=function(a){var c=m.get_original_copies()[b],d;this.get_attribute_owner().set_attribute(this.attribute,a)&&c.forEach(function(b,c){d=b.set_HTML_from_sub_classes(a)});return d};d.get_function_type=function(){return"element"};d.set_additional_classes("toontalk-string-attribute-widget");
return d}.bind(this),w;w=0<=["background-color","color"].indexOf(b)?"string":"number";var v,D,H,I,A;g&&(f=$(g).find(f),0<f.length&&(f.get(0).toontalk_widget=this));if("number"===w){if(I=c(b,p),D=I.set_value_from_decimal.bind(I),0<=d.indexOf(b)&&(this.on_update_display(function(){I.rerender();return!0}),"left"===b||"top"===b)){var G;e&&e.to_be_on_backside_of&&(G=e.to_be_on_backside_of[0]);G||(G=I.get_attribute_owner());A=function(a){var c,d;a.currentTarget.toontalk_widget===I.get_attribute_owner()&&
(c=$(G.get_frontside_element()).closest(".toontalk-top-level-backside").offset(),c||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),c={left:0,top:0}),d=a.pageX-c.left-(G.drag_x_offset||0),c=a.pageY-c.top-(G.drag_y_offset||0),"left"===b?(a=d,G.set_attribute("top",c)):(a=c,G.set_attribute("left",d)),I.set_value_from_decimal(a),H.call(I))};I.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",
A);b&&b.get_widget().is_element()&&b.get_frontside_element().addEventListener("drag",A)})}}else if("string"===w)I=q(b,p),D=I.set_HTML.bind(I);else{a.UTILITIES.report_internal_error("Unrecognized attribute type: "+w+" for "+b);return}(p=this.get_original_copies()[b])?p.push(I):this.get_original_copies()[b]=[I];return I};a.creators_from_json.attribute_widget=function(b,d){return a.UTILITIES.create_from_json(b.element,d).create_attribute_widget(b.attribute_name,d)};a.creators_from_json.attribute_number=
a.creators_from_json.attribute_widget;b.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};b.toString=function(a){var b;if(a)if("conditions"===a.role||a.plain_text)b='"'+this.get_text()+'"';else{if(a.for_json_div)return""}else a=this.get_HTML(),1<a.length&&"<"===a.charAt(0)?(b=a.indexOf(" "),b=a.substring(0,b+1)+"style='width: 50px; height: 30px;'"+a.substring(b)):b='"'+a+'"';return"the element "+
b};b.get_type_name=function(a){return a?"elements":"element"};b.get_help_URL=function(){return"docs/manual/elements.html"};b.get_json=function(b){var d=this.get_style_attributes(),e=[],g=a.UTILITIES.remove_z_index(this.get_HTML()),k=encodeURIComponent(g);0===g.indexOf("<img src='data:image/")&&(b.shared_html||(b.shared_html=[]),g=b.shared_html.indexOf(k),0>g&&(g=b.shared_html.push(k)-1),k={shared_html_index:g});d.forEach(function(a){e.push(a)});return{type:"element",html:k,attributes:e,attribute_values:e.map(this.get_attribute.bind(this)),
attributes_backsides:e.map(function(d){if(d=this.get_attribute_widget_in_backside_table(d,!0))return a.UTILITIES.get_json_of_array(d.get_backside_widgets(),b)}.bind(this)),additional_classes:this.get_additional_classes(),sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()}};a.creators_from_json.element=function(d,g){var f=decodeURIComponent("string"===
typeof d.html?d.html:g.shared_html[d.html.shared_html_index]),k=b.create(f,d.attributes,d.description,d.sound_effect,d.video,d.ignore_pointer_events),p;p=g&&g.event?["left","top"]:[];d.attribute_values.forEach(function(b,f){var c=d.attributes[f],q=d.attributes_backsides&&d.attributes_backsides[f];0>p.indexOf(c)&&(0!==b||"width"!==c&&"height"!==c)&&k.add_to_css(c,e(b)||b);q&&(c=k.get_attribute_widget_in_backside_table(c,!1,g),a.UTILITIES.add_backside_widgets_from_json(c,q,g))}.bind(this));d.additional_classes&&
k.set_additional_classes(d.additional_classes);d.source_URL&&(k.set_source_URL(d.source_URL),k.refresh());return k};b.create_attribute_path=function(b,d){var e=a.path.get_path_to(b.element_widget,d);return this.extend_attribute_path(e,b.attribute)};b.refresh=function(){this.get_source_URL()&&a.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};b.extend_attribute_path=function(a,b){return{dereference_path:function(d,e,g){return a.dereference_path(e||
d,void 0,g).get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+b+"' property of "+a},get_json:function(){return{type:"path_to_style_attribute",attribute:b,element_widget_path:a.get_json()}}}};a.creators_from_json.path_to_style_attribute=function(d){var e=a.UTILITIES.create_from_json(d.element_widget_path);return b.extend_attribute_path(e,d.attribute)};b.set_size_attributes=function(b,d,e){e?(this.add_to_css("width",b),this.add_to_css("height",d)):(this.set_attribute("width",
b),this.set_attribute("height",d));a.UTILITIES.set_timeout(function(){this.rerender()}.bind(this))};b.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};b.receive_HTML_from_dropped=function(a){a=a.get_text&&a.get_text();if(this.set_HTML(a))return this.get_text()};b.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};b.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&
(b.push(a),"left"===a?(a=this.get_frontside_element(),$(a).on("drag",function(a){var b=this.get_backside_element(!0),d=this.get_frontside_element();b&&d&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):"top"===a&&(a=this.get_frontside_element(),$(a).on("drag",function(a){var b=this.get_backside_element(!0),d=this.get_frontside_element();b&&d&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};b.remove_style_attribute=
function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return b}(window.TOONTALK);window.TOONTALK.element_backside=function(a){var d=function(b,d,g){if(g.visible()){var f=d.get_style_attributes();d.get_frontside_element();$(b).empty();f.forEach(function(f){d.get_attribute(f);var k=document.createElement("tr"),m=document.createElement("td"),r=d.get_attribute_widget_in_backside_table(f),c=r.get_frontside_element();
r.set_parent_of_frontside(g,!1,!0);r.set_infinite_stack(!0);b.appendChild(k);k.appendChild(m);m.appendChild(a.UTILITIES.create_text_element(f));m=document.createElement("td");k.appendChild(m);r.set_visible(!0);$(c).addClass("toontalk-element-attribute");m.appendChild(c);r.render()})}},b=function(b,d){var g=$("<button>Add or remove my style attributes</button>").button();g.addClass("toontalk-show-attributes-chooser-button");g.click(function(f){$(b).is(":visible")?($(b).hide(),g.button("option","label",
"Add or remove my style attributes"),a.UTILITIES.give_tooltip(g.get(0),"Click to add widgets for my style attributes.")):($(b).show(),g.button("option","label","Hide my style attributes list"),a.UTILITIES.give_tooltip(g.get(0),"Click to hide my list of attributes that can be added or removed."));d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",d)});a.UTILITIES.give_tooltip(g.get(0),"Click to add widgets for my style attributes.");return g.get(0)};
return{create:function(e){var g=a.backside.create(e),n=g.get_element();e.get_HTML();var f=document.createElement("table"),t=document.createElement("div"),p=b(t,e),m=a.backside.create_advanced_settings_button(g,e),r=a.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked."),c=a.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),q=c?"get_HTML":"get_text",w=g.update_display.bind(g),
v,D,H,I,A,G,C,z,E,F;e.initialize_element();v=e[q]().trim();0<v.length&&!e.get_image_element()&&(H=function(b){(b=a.UTILITIES.input_area_drop_handler(b,e.receive_HTML_from_dropped.bind(e),e))&&e.robot_in_training()&&e.robot_in_training().dropped_on_text_area(b,e,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},D=a.UTILITIES.create_text_area(v,"toontalk-html-input","My HTML is","Type here to edit the text.",H),v=function(a){a=D.button.value.trim().replace(/\xA0/g,
" ");e.get_frontside_element();var b=c?"set_HTML":"set_text";e[b](a)&&e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:b,argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(D.container).css({width:"100%"}),$(D.button).css({width:"100%"}),D.button.addEventListener("change",v),D.button.addEventListener("mouseout",v),e.is_plain_text_element()&&n.appendChild(D.container),e.get_source_URL()&&(H=function(b){var c=a.UTILITIES.input_area_drop_handler(b,
e.receive_URL_from_dropped.bind(e),e);c&&e.robot_in_training()&&e.robot_in_training().dropped_on_text_area(c,e,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});b.stopPropagation()},v=function(a){a=I.button.value.trim().replace(/\xA0/g," ");e.get_frontside_element();e.set_source_URL(a)&&e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:"set_source_URL",argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},
I=a.UTILITIES.create_text_input(e.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,H),I.button.addEventListener("change",v),I.button.addEventListener("mouseout",v),n.appendChild(I.container)));g.update_style_attribute_chooser=function(){var b=function(b,c,l){var e=0<=l.get_style_attributes().indexOf(b),g=a.UTILITIES.create_check_box(e,"toontalk-style-attribute-check-box",b+"&nbsp;","Click to add or remove the '"+b+"' style attribute from my backside."),
h="toontalk-style-attribute-check-box-for-"+b,e=a.UTILITIES.create_anchor_element("i",k(b)),m=document.createElement("li");$(e).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(e).css({color:"white"});e.translate=!1;e.lang="en";g.container.appendChild(e);$(g.button).addClass(h);g.button.addEventListener("click",function(a){g.button.checked?l.add_style_attribute(b):l.remove_style_attribute(b);d(f,l,l.get_backside());l.robot_in_training()&&l.robot_in_training().edited(l,
{setter_name:g.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:b,toString:(g.button.checked?"add":"remove")+" a widget for the "+b+" attribute of",button_selector:"."+h})});m.appendChild(g.container);c.appendChild(m)},c=function(a,d,e){var g,f;"string"===typeof a?b(a,d,e):a.label?(g=document.createElement("h3"),g.textContent=a.label,f=document.createElement("ul"),d.appendChild(g),d.appendChild(f),c(a.sub_menus,f,e)):a.forEach(function(a){c(a,d,e)})};$(t).is(".ui-accordion")&&
$(t).accordion("destroy");$(t).empty();c([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],t,e);$(t).accordion({active:0,heightStyle:"content"});
return t};g.get_attributes_chooser=function(){return t};e.get_sound_effect()?(C=e.get_sound_effect(),z=function(){g.visible()&&(C.paused?(a.UTILITIES.give_tooltip(A.get(0),"Click to begin playing this sound."),A.button("option","label","Play sound")):(a.UTILITIES.give_tooltip(A.get(0),"Click to pause this sound."),A.button("option","label","Pause sound")))},A=$("<button>Play sound</button>").button(),A.addClass("toontalk-play-sound-effect-button"),A.click(function(a){C.paused?(C.play(),C.addEventListener("ended",
z)):C.pause();z();e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",e)}),z(),n.appendChild(A.get(0))):$(e.get_frontside_element()).find("video").is("*")&&(E=e.get_video_object(),F=function(){g.visible()&&(E.paused?(a.UTILITIES.give_tooltip(G.get(0),"Click to begin playing this video."),G.button("option","label","Play video")):(a.UTILITIES.give_tooltip(G.get(0),"Click to pause this video."),G.button("option","label","Pause video")))},G=$("<button>Play video</button>").button(),
G.addClass("toontalk-play-video-button"),G.click(function(a){E.paused?(E.play(),E.addEventListener("ended",F)):E.pause();F();e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-play-video-button",e)}),F(),n.appendChild(G.get(0)));g.update_style_attribute_chooser();d(f,e,g);n.appendChild(f);n.appendChild(m);$(t).hide();$(t).addClass("toontalk-attributes-chooser");g.update_display=function(){D&&$(D.button).val(e[q]());d(f,e,g);$(t).is(":visible")&&g.update_style_attribute_chooser();
e.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});w()};$(n).find(".toontalk-hide-backside-button").click(function(a){$(t).hide()});r.button.checked=!e.get_ignore_pointer_events();r.button.addEventListener("click",function(a){e.set_ignore_pointer_events(!r.button.checked)});e.is_plain_text_element()?g.add_advanced_settings(!1,r.container):g.add_advanced_settings(!1,D.container,r.container);g.add_advanced_settings(!1,t,p);return g}}}(window.TOONTALK)})();window.TOONTALK.sensor=function(g){var k=Object.create(g.widget),a=function(a,b){"element"===a.get_type_name()&&(a.set_additional_classes("toontalk-string-value-from-sensor"),b.visible()&&a.rerender())};k.create=function(d,b,e,h,n,f,t){var p=g.nest.create(e,h,"sensor",void 0,void 0,t||"sensor"),m=p.get_json,r=p.update_display,c=p.copy,q=b.split(" "),w=function(a){return q.map(function(b){var c=a[b];if("keyCode"===b){if(16===c)return;c=String.fromCharCode(c);a.shiftKey||(c=c.toLowerCase())}else"undefined"===
typeof c&&(c="No "+b+" in event "+a+" of sensor "+k,g.UTILITIES.display_message(c));return c})},v=function(b){var c;switch(typeof b){case "number":c=g.number.create(Math.round(b),1);break;case "string":c=g.element.create(b,void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");a(c,p);break;case "boolean":c=g.element.create(b.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor"),a(c,p)}return c},D=function(a){var b,c;if(p.get_active()){b=w(a);c=p.visible();
a=$(p.get_frontside_element()).closest(".toontalk-top-level-backside");if(1===b.length){if(b=v(b[0]),"undefined"===typeof b)return}else b=g.box.create(b.length,!0,b.map(v),"the values of the "+g.UTILITIES.conjunction(q)+" attributes of "+g.UTILITIES.add_a_or_an(d)+" event.",q.join(";"));c?(c=g.bird.create(p),p.add_to_top_level_backside(c),b.render(),c.animate_delivery_to(b,p,p,a.width()/2,a.height())):p.add_to_contents(b)}}.bind(this);p.is_sensor=function(){return!0};p.copy=function(a){var b;if(a&&
a.just_value&&this.has_contents())return c.call(this,a);b=a?g.sensor.create(d,this.get_attributes_string(),e,void 0,a.copying_resource||n,f,this.get_name()):g.sensor.create(d,this.get_attributes_string(),e,void 0,n,f,this.get_name());return p.add_to_copy(b,a)};p.get_json=function(a){var b=m.call(this,a);b.type="sensor";b.event_name=d;b.attribute=this.get_attributes_string();b.active=n;b.sensor_of=f&&g.UTILITIES.get_json(f,a);return b};p.update_display=function(){var a=$(this.get_frontside_element());
r.call(this);n||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):(a.addClass("toontalk-sensor-inactive-nest"),a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};p.get_type_name=function(a){return a?"sensors":"sensor"};p.get_help_URL=function(){return"docs/manual/sensors.html"};p.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+d+" events"};p.get_class_name_with_color=
function(a){return a};p.get_active=function(){return!0===n};p.restore_active=function(){"temporarily false"===n&&this.set_active(!0)};p.set_active=function(a,b){if(n!==a||b)!0===a?f?f.get_frontside_element().addEventListener(d,D):window.addEventListener(d,D):f?f.get_frontside_element().removeEventListener(d,D):window.removeEventListener(d,D),n=a};p.set_running=function(a){this.set_active(a)};p.set_active(n,!0);p.create_backside=function(){return g.sensor_backside.create(this)};p.get_event_name=function(){return d};
p.set_event_name=function(a){var b=n;d&&n&&this.set_active(!1);d=a;b&&this.set_active(!0)};p.get_attributes=function(){return q};p.set_attributes=function(a){q=a.split(" ")};p.get_attributes_string=function(){return q.join(" ")};p.match=function(a){this.last_match=a;return this};p.set_sensor_of=function(a){f=a};p.get_custom_title_prefix=function(){var a="When a '"+d+"' event occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";n?this.get_backside()||(a+=" On my back you can change which kind of events and attributes I receive."):
a+=" But I'm deactivated and can't receive anything until the 'Listening to events' check box on my back is ticked.";return a};return p};g.creators_from_json.sensor=function(d,b){var e=g.UTILITIES.create_array_from_json(d.contents,b),h=g.sensor.create(d.event_name,d.attribute,d.description,e,!1,void 0,d.name);d.sensor_of?g.UTILITIES.set_timeout(function(){h.set_sensor_of(g.UTILITIES.create_from_json(d.sensor_of,b));h.set_active(d.active)}):h.set_active(d.active);0<e.length&&setTimeout(function(){e.forEach(function(b){a(b.get_widget(),
h)})},500);return h};return k}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(g){return{create:function(k){var a=g.UTILITIES.create_text_input(k.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+k.get_event_name()),d=g.UTILITIES.create_text_input(k.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
b=g.UTILITIES.create_check_box(k.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),e=g.nest_backside.create(k),h=e.get_element();$(h).find(".toontalk-settings-backside-button").get(0);a.button.addEventListener("change",function(){k.set_event_name(a.button.value.trim())});d.button.addEventListener("change",function(){k.set_attributes(d.button.value.trim())});$(b.button).click(function(a){var d=b.button.checked;k.set_active(d);
k.robot_in_training()&&k.robot_in_training().edited(robot,{setter_name:"set_active",argument_1:d,toString:"change to "+(d?"active":"inactive")+" of the "+k,button_selector:".toontalk-sensor-active-check-box"});k.render();a.stopPropagation()});$(h).find(".toontalk-advanced-setting").append(a.container,d.container,b.container);return e}}}(window.TOONTALK);window.TOONTALK.tool=function(g){document.addEventListener("mousemove",function(k){g.tool.pageX=k.pageX;g.tool.pageY=k.pageY});return{add_listeners:function(k,a){var d,b,e,h,n,f=function(c){var f=k.getBoundingClientRect();a.set_held&&a.set_held(!0);h=f.height;c&&c.preventDefault();setTimeout(function(){a.held&&!a.held()||$(k).addClass("toontalk-tool-held")},200);d=$(k).offset();document.addEventListener("mousemove",p);document.addEventListener("touchmove",p);document.addEventListener("mouseup",m);
document.addEventListener("touchend",m);g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\nmouse_down at "+Date.now());e=b=0;$(".ui-tooltip").each(function(){$(this).hide()})},t=function(c){var d=k.getBoundingClientRect();a.held&&a.held()||f(c);b=g.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",c)-d.left;e=g.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",c)-d.top},p=function(a){var d=g.UTILITIES.find_widget_on_page(a,k,b,e-h/2),f,m,p;a.preventDefault();$(".ui-tooltip").each(function(){$(this).hide()});
m=r(a);p=g.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",a)-m.deltaX-b;a=g.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",a)-m.deltaY-e;k.style.left=p+"px";k.style.top=a+"px";g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\nmouse_move at "+Date.now()+" now at "+k.style.left+", "+k.style.top);if(d&&d.is_top_level())n&&(g.UTILITIES.remove_highlight(),n=void 0);else{if(d&&(f=d.get_frontside_element(),f===n))return;n=f;g.UTILITIES.highlight_element(n)}},m=function(c){var f=
g.UTILITIES.find_widget_on_page(c,k,b,e-h/2),r;c.preventDefault();a.set_held&&a.set_held(!1);n&&g.UTILITIES.remove_highlight();f&&f.top_level_widget&&(r=f.top_level_widget(),a.apply_tool(f,c),r.backup_all());!f&&a.nothing_under_tool&&a.nothing_under_tool();$(k).removeClass("toontalk-tool-held");$(k).addClass("toontalk-tool-returning");g.UTILITIES.add_one_shot_event_handler(k,"transitionend",1E3,function(){$(k).removeClass("toontalk-tool-returning")});g.UTILITIES.set_timeout(function(){k.style.left=
d.left+"px";k.style.top=d.top+"px"});document.removeEventListener("mousemove",p);document.removeEventListener("touchmove",p);document.removeEventListener("mouseup",m);document.removeEventListener("touchend",m);g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\nmouse_up at "+Date.now(),alert(g.debugging),g.debugging="touch")},r=function(a){var b=0,d=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?d=-20:a.clientY+20>window.innerHeight&&(d=20);window.scrollBy(b,d);return{deltaX:b,
deltaY:d}};k.addEventListener("mousedown",t);k.addEventListener("touchstart",t);return f}}}(window.TOONTALK);window.TOONTALK.vacuum=function(g){var k=Object.create(null),a={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},d={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},b={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},e=!1,h;k.create=function(){var n,f,t,p=[],m=function(a){t!==a&&(t=a,g.sounds&&g.sounds.click.play(),$(n).removeClass(f),
f=d[t],$(n).addClass(f),r())},r=function(){"restore"===t&&0===p.length?g.UTILITIES.give_tooltip(n,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):g.UTILITIES.give_tooltip(n,a[t])};document.addEventListener("keyup",function(a){var b=String.fromCharCode(a.keyCode);a.altKey&&(n||(k.the_vacuum.get_element(),$(n).css({left:g.tool.pageX,top:g.tool.pageY}),document.body.appendChild(n)),h());k.the_vacuum.held()&&("s"===b||"S"===b?m("suck"):"e"===b||"E"===
b?m("erase"):"r"===b||"R"===b?m("restore"):"a"===b||"A"===b?m("suck_all"):g.sounds&&g.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){k.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});g.vacuum.the_vacuum={apply_tool:function(a,b){var d=a.get_widget(),e=function(a){var c;a.is_backside()?a.hide_backside():(b&&d.robot_in_training()&&d.robot_in_training().removed(a),a===d.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):
(d.is_bird()&&g.sounds&&g.sounds.bird_fly.pause(),c=a.copy(),c.save_dimensions_of(a),c.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0}),p.push(c),a.set_running&&a.set_running(!1),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove(b)))},f,h,m;"suck"===t?a.remove&&"top-level"!==a.get_type_name()&&(e(a),g.sounds&&g.sounds.vacuum_suck.play()):"erase"===t||"restore"===t&&a.get_erased&&a.get_erased()?
"top-level"!==a.get_type_name()&&(f=!a.get_erased(),g.sounds&&(f?g.sounds.vacuum_suck.play():g.sounds.vacuum_spit.play()),a.set_erased(f,!0),b&&d.robot_in_training()&&d.robot_in_training().erased_widget(a,f)):"restore"===t?0<p.length&&(f=p.pop(),f.restore_dimensions(),m=a.add_to_top_level_backside(f,!0),h=$(n).offset(),h.left-=$(m).width(),g.UTILITIES.set_absolute_position($(m),h),f.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),g.sounds&&g.sounds.vacuum_spit.play()):
"suck_all"===t&&(f=a.top_level_widget(),f=f.get_backside_widgets().slice(),0<f.length&&g.sounds&&(g.sounds.vacuum_suck.play(),g.sounds.bird_fly.pause()),f.forEach(function(a){a&&d!==d.robot_in_training()&&e(a)}))},nothing_under_tool:function(){m(b[t])},get_element:function(){n||(n=document.createElement("div"),$(n).addClass("toontalk-vacuum"),h=g.tool.add_listeners(n,this),m("suck"),r());return n},held:function(){return e},set_held:function(a){e=a}};return g.vacuum.the_vacuum};g.creators_from_json.vacuum=
function(a,b){var d=g.vacuum.create();a.mode&&g.UTILITIES.set_timeout(function(){d.set_mode(a.mode)});return d};return k}(window.TOONTALK);window.TOONTALK.wand=function(g){var k=Object.create(null);k.create=function(){var a;return{apply_tool:function(a){"top-level"!==a.get_type_name()&&(g.sounds&&g.sounds.magic.play(),a.add_copy_to_container())},get_element:function(){a||(a=document.createElement("div"),$(a).addClass("toontalk-wand"),g.UTILITIES.give_tooltip(a,"I'm a magic wand. Drag me over the thing you want me to copy."),g.tool.add_listeners(a,this));return a}}};g.creators_from_json.wand=function(){return g.wand.create()};return k}(window.TOONTALK);window.TOONTALK.SETTINGS=function(g){var k=[],a=function(a,h,n){var f=[],t=g.UTILITIES.create_local_files_table(),p=function(b,f){var c=function(a){a||f.newPanel.appendChild(g.UTILITIES.create_text_element("Error connecting to cloud"))},h=f.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();f.newPanel.is(".toontalk-programs-in-cloud-table")?h?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):d(f.newPanel,"program",a,n,c):f.newPanel.is(".toontalk-pages-in-cloud-table")?
h?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):d(f.newPanel,"page",a,n,c):($("#tab-0_info").show(),$("#tab-0_wrapper").show())};f[0]="Programs stored in browser";k[0]=t;h?(f[1]="Programs in cloud",k[1]=g.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),f[2]="Published pages",k[2]=g.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table"),h=g.UTILITIES.create_tabs(f,k),n.appendChild(h),$(h).on("tabsactivate",p)):n.appendChild(g.UTILITIES.create_tabs(f,k));b(a,t,
!0,n);$(t).on("draw.dt",function(){b(a,t,!1,n)})},d=function(a,d,k,f,t){g.google_drive.get_toontalk_files(!1,d,function(p){var m;"string"===typeof p?m=p:p.error&&(m=p.error.message);m?"Need to authorize"===m||"Login Required"===m?g.google_drive.authorize(t):(console.log(m),console.log("Google drive status: "+g.google_drive.get_status()),t(null)):(m="program"===d&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",g.UTILITIES.become_file_data_table(a,p.items,!0,m),a.on("draw.dt",
function(){b(k,a.get(0),!0,f)}),t(a.get(0)))})},b=function(a,b,d,g){$(b).find(".toontalk-file-load-button-without-click-handler").click(function(b){var h=function(){$(g).remove()},m=function(){a.set_setting("program_name",b.target.textContent);a.load(d,h)}.bind(this);a.save(!0,void 0,m)}).removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(b){var d=document.createElement("div"),k=b.get_backside_element(),f=b.get_setting("program_name"),t=g.UTILITIES.create_text_input(f,
"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),p=g.UTILITIES.create_close_button(function(){$(d).remove()},"Click to close the settings panel."),m=g.UTILITIES.create_text_element("How should your program be saved?"),r=g.UTILITIES.create_check_box(b.get_setting("auto_save_to_google_drive"),"toontalk-save-setting","Save automatically to my Google Drive",'Check this if you want your programs automatically saved to a "ToonTalk Programs" folder in your Google Drive.'),
c=g.UTILITIES.create_check_box(b.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage","Check this if you want your programs automatically saved in this browser's local storage."),q=g.UTILITIES.create_button("Save to Google Drive now","toontalk-save-button","Click to save your program now to your Google Drive account.",function(){b.save(!0,{google_drive:!0})}),w=g.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button",
"Click to save your program now to this browser's local storage.",function(){b.save(!0,{local_storage:!0})}),v=g.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){g.google_drive.authorize(function(){$(v).remove()})}),D=g.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){g.UTILITIES.display_message("Creating your web page...");
b.publish(I,H.button.checked)}),H=g.UTILITIES.create_check_box(b.get_setting("publish_as_workspace"),"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),I=function(a,c){var d=document.createElement("span"),l=g.google_drive.google_drive_url(a.id);g.TRANSLATION_ENABLED&&(l=g.UTILITIES.add_URL_parameter(l,"translate","1"));d.innerHTML="Published: <a href='"+l+"' target='_blank'>"+b.get_setting("program_name")+
"</a>";g.UTILITIES.display_message("Your web page is ready for you to edit. Just click on the link.");$(t.container).children("tr").append(g.UTILITIES.create_table_entry(d))},A=document.createElement("div"),G=g.google_drive&&"undefined"!==typeof gapi?g.google_drive.get_status():"Google Drive API not loaded",C=!0,z=g.UTILITIES.create_vertical_table(D,H.container);$(d).addClass("toontalk-settings-panel").css({width:$(k).width()+29,height:$(k).height()+50,left:-2,top:-25,"z-index":g.UTILITIES.next_z_index()});
d.appendChild(p);t.button.addEventListener("change",function(){var a=t.button.value.trim();f!==a&&b.save(!0,void 0,function(){f=a;b.set_setting("program_name",a);b.load(!0,function(){setTimeout(function(){$(d).css({"z-index":g.UTILITIES.next_z_index()})},500)},function(){b.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();g.UTILITIES.display_message("Your program was copied and the new copy's name is '"+b.get_setting("program_name")+"'.")})})})});r.button.addEventListener("click",function(a){b.save(!0,
{auto_save_to_google_drive:c.button.checked,gooogle_drive:!0});b.set_setting("auto_save_to_google_drive",r.button.checked);r.button.checked?$(q).hide():$(q).show()});c.button.addEventListener("click",function(a){b.save(!0,{auto_save_to_local_storage:c.button.checked,local_storage:!0});b.set_setting("auto_save_to_local_storage",c.button.checked);c.button.checked?$(w).hide():$(w).show()});H.button.addEventListener("click",function(a){b.set_setting("publish_as_workspace",H.button.checked)});d.appendChild(A);
$(m).css({"font-weight":"bold","font-size":24,color:"navy"});A.appendChild(m);A.appendChild(t.container);A.appendChild(r.container);A.appendChild(c.container);r.container.appendChild(g.UTILITIES.create_space());r.container.appendChild(q);b.get_setting("auto_save_to_google_drive")&&$(q).hide();c.container.appendChild(g.UTILITIES.create_space());c.container.appendChild(w);b.get_setting("auto_save_to_local_storage")&&$(w).hide();"Need to authorize"===G?(r.container.appendChild(g.UTILITIES.create_space()),
r.container.appendChild(v)):"Authorized"!==G&&"Ready"!==G&&"Authorized but not yet ready"!==G&&(C=!1,b.set_setting("google_drive_unavailable",!0),setTimeout(function(){r.button.disabled=!0;$(D).button("option","disabled",!0);$(q).button("option","disabled",!0);g.UTILITIES.give_tooltip(r.container,"Inactivated because attempt to connect to Google Drive returned: "+G);D.title=r.container.title;q.title=r.container.title},1));$(t.container).children("tr").append(g.UTILITIES.create_table_entry(z));a(b,
C,d);k.appendChild(d)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",auto_save_to_google_drive:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(g){var k=[];return{pending_update:function(a){0<=k.indexOf(a)||k.push(a)},update_display:function(){var a,d;0!==k.length&&(a=k,d=function(a,e){$(a).children().each(function(a,b){$(b).css({"z-index":e+1});d(b,e+1)})},k=[],a.forEach(function(a){var e=a.get_frontside_element&&a.get_frontside_element(),h,k,f;a.update_display();a.get_backside&&(k=a.get_backside())&&k.update_display();setTimeout(function(){g.UTILITIES.use_custom_tooltip(e)});h=$(e).parent().closest(".toontalk-side");
h.is("*")&&0===h.find(".toontalk-side-animating, .toontalk-side-appearing").length&&(k=g.UTILITIES.get_style_numeric_property(e,"z-index"),f=g.UTILITIES.get_style_numeric_property(h.get(0),"z-index"),f||(f=g.UTILITIES.next_z_index(),h.css({"z-index":f})),!k||h.is(".toontalk-top-level-backside")?(k=g.UTILITIES.next_z_index(),$(e).css({"z-index":k})):k>=f&&(k=f+1,$(e).css({"z-index":k})),d(e,k));e&&!$(e).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&
g.UTILITIES.set_timeout(function(){h.is(".toontalk-box-hole")?$(e).is(".ui-resizable")&&$(e).resizable("destroy"):$(e).is(".ui-resizable")||g.UTILITIES.make_resizable($(e),a)})}))},run_cycle_is_over:function(){this.update_display()}}}(window.TOONTALK);window.TOONTALK.actions=function(g){g.creators_from_json.body=function(k,a){var d=g.actions.create();a.body=d;d.initialise_steps(g.UTILITIES.create_array_from_json(k.steps,a));return d};return{create:function(k){var a=Object.create(this),d=[];k||(k=[]);a.copy=function(){return g.actions.create(g.UTILITIES.copy_array(k))};a.get_steps=function(){return k};a.initialise_steps=function(a){k=a};a.is_empty=function(){return 0===k.length};a.reset_steps=function(){k=[];this.reset_newly_created_widgets()};
a.reset_newly_created_widgets=function(){d=[]};a.add_step=function(a,d){k.push(a);d&&this.add_newly_created_widget_if_new(d)};a.add_newly_created_widget_if_new=function(a){0<=d.indexOf(a)||this.add_newly_created_widget(a)};a.add_newly_created_widget=function(a){g.debugging&&0<=d.indexOf(a)?console.log("add_newly_created_widget called with not new widget."):(d.push(a),g.logging&&0<=g.logging.indexOf("newly-created")&&console.log("Added "+a.to_debug_string()+" to list of newly_created_widgets. Length is "+
d.length))};a.is_newly_created=function(a){return 0<=d.indexOf(a)};a.get_newly_created_widgets=function(){return d};a.get_path_to=function(a,e){var h,k;d.some(function(d,t){if(d===a)return h=g.newly_created_widgets_path.create(t),!0;if(d.get_path_to&&(k=d.get_path_to(a,e)))return h=g.newly_created_widgets_path.create(t),h.next=k,!0});return h};a.dereference_path=function(a){g.debugging&&!d[a]&&g.UTILITIES.report_internal_error("Expected to find the "+g.UTILITIES.ordinal(a)+" newly created widget.");
return d[a]};return a},run_unwatched:function(k,a,d,b,e){var h=this.get_steps();g.logging&&0<=g.logging.indexOf("run")&&console.log(b.to_debug_string()+" running unwatched");e||(e=0);b.run_next_step=function(){if(e<h.length){var n=h[e];e++;g.logging&&0<=g.logging.indexOf("event")&&console.log(n.get_action_name()+" (unwatched)");n.run_unwatched(k,a,b)}else b.set_running_or_in_run_queue(!1),b.run_body_finished_listeners(k,a,d),b.get_run_once()?b.get_first_in_team().set_running(!1):b.get_first_in_team().run(k,
a,d)};b.run_next_step()},run_watched:function(k,a,d,b){var e=this.get_steps(),h=b.get_frontside_element(),n,f,t=h.parentElement,p=function(){var c=b.visible()&&0!==b.get_maximum_step_duration()&&b.get_first_in_team()===b,e=function(){c&&(t&&t.appendChild(h),b.set_animating(!1));b.get_run_once()?b.get_first_in_team().set_running(!1):b.stopped()||b.get_first_in_team().run(k,a,d);b.get_first_in_team()===b&&g.UTILITIES.set_absolute_position($(h),r);b.rerender()};c?(h.parentElement||b.get_parent_of_frontside().get_frontside_element().appendChild(h),
g.UTILITIES.animate_to_absolute_position(h,r,e,b&&b.transform_animation_speed(g.UTILITIES.default_animation_speed))):(b.set_animating(!1),e(),k.add_backside_widget(b),$(b.get_frontside_element()).remove())},m=0,r=$(h).offset(),c=$(h).position(),q=$(h).width(),w=$(h).height(),v=$(h).closest(".toontalk-backside"),D=$(h).closest(".toontalk-top-level-backside").offset(),H=k.get_backside();g.logging&&0<=g.logging.indexOf("run")&&console.log(b.to_debug_string()+" running watched");b.get_parent_of_frontside()||
(f=b.get_previous_robot(),f.open_backside(),f.get_backside().set_advanced_settings_showing(!0),(n=h.parentElement)||(n=$(f.get_backside_element()).find(".toontalk-drop-area").get(0)),k.get_backside_element().appendChild(h),k.add_backside_widget(b),b.update_display(),b.add_body_finished_listener(function(){n&&n.appendChild(h);k.remove_backside_widget(b);b.set_visible(!0);$(h).css({left:"",top:""})}));0===q&&($(h).css({width:"",height:""}),q=$(h).width(),w=$(h).height());D||(D={left:0,top:0});0<v.length&&
(f=v.get(0).getBoundingClientRect(),r.left<f.left-D.left||r.top<f.top-D.top||r.left+q>f.right+D.left||r.top+w>f.bottom+D.top)&&(r=v.offset(),r.left+=v.width()/2,r.top+=v.height()-w);b.start_position=c;b.run_next_step=function(){H&&(H.visible()||g.UTILITIES.visible_element(H.get_element()))?setTimeout(function(){b.run_watched_step_end_listeners();if(m<e.length&&!b.stopped()){var c=e[m];m++;g.logging&&0<=g.logging.indexOf("event")&&console.log(c.get_action_name()+" (watched)");c.run_watched(k,a,b);
b.get_thing_in_hand()&&(b.get_thing_in_hand().save_dimensions(),b.render())}else b.set_running_or_in_run_queue(!1),p(),b.run_body_finished_listeners()},b.transform_step_duration(50)):(b.set_running_or_in_run_queue(!1),b.set_animating(!1),$(h).css({width:"",height:""}),h.style.left=c.left+"px",h.style.top=c.top+"px",t.appendChild(h),this.run_unwatched(k,a,d,b,m))}.bind(this);b.set_animating(!0,r);b.run_next_step();return!0},toString:function(g){for(var a="",d=this.get_steps().map(function(a){return a&&
a.toString(g)});""===d[d.length-1];)d.pop();d.forEach(function(b,e){b&&(a+=b,a=e===d.length-2?a+" and \n":e<d.length-2?a+", \n":a+".")});return a},get_json:function(k){return{type:"body",steps:g.UTILITIES.get_json_of_array(this.get_steps(),k)}}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(g){g.creators_from_json.newly_created_widgets_path=function(k){return g.newly_created_widgets_path.create(k.index)};return{create:function(k){return{dereference_path:function(a,d,b){a=b.get_body().dereference_path(k);if(this.next)return g.path.dereference_path(this.next,a,d,b);this.removing_widget&&(d=a.get_parent_of_frontside())&&d.removed_from_container&&b.remove_from_container(a,d);return a},toString:function(){return"the "+g.UTILITIES.ordinal(k)+
" new widget"},get_json:function(){return{type:"newly_created_widgets_path",index:k}}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(g){var k={copy:function(a,b,c,d){d.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b,c,d){d.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b,c,d){a=a.copy();d.add_newly_created_widget(a);d.set_thing_in_hand(a);return!0},"drop it on":function(a,b,c,d,e){if(a)if(b=d.get_thing_in_hand()){if(b.drop_on)return g.debugging&&b===a&&g.UTILITIES.report_internal_error("Dropping something on itself! "+a),b.drop_on(a,!1,void 0,d),d.set_thing_in_hand(void 0),
a.rerender(),b.robot_waiting_before_next_step===d?(e&&e.running_watched||(b.robot_waiting_before_next_step=void 0),!1):!0;g.UTILITIES.report_internal_error("Thing in robot's hand ("+b+") doesn't handle 'drop_on'. Robot that "+d)}else g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing drop_on but has nothing in its hand.");else g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},
"drop it on the text area of":function(a,b,c,d,e){if(a){if(b=d.get_thing_in_hand())return d.set_thing_in_hand(void 0),a[e.setter](b),!0;g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else g.UTILITIES.report_internal_error("The robot that '"+d.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},remove:function(a,b,c,d){a.remove();a===d&&d.set_stopped(!0);return!0},"change whether erased":function(a,
b,c,d,e){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;g.UTILITIES.display_message("Robot is unable to erase "+a)},edit:function(a,b,c,d,e){if(a[e.setter_name])return e.argument_2?a[e.setter_name].call(a,e.argument_1,e.argument_2,a.visible()):a[e.setter_name].call(a,e.argument_1,a.visible()),!0;g.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c,d,e){return!0},"add to the top-level backside":function(a,b,c,d,e){d.visible()||(e=a.get_frontside_element(!0),
c=$(b.get_frontside_element()).position(),b=$(b.get_frontside_element()).closest(".toontalk-top-level-backside").get(0)||$(e).closest(".toontalk-top-level-backside").get(0),$(e).css({left:c.left,top:c.top}),b.appendChild(e),b.toontalk_widget.add_backside_widget(a),a.animate_to_element(b,void 0,d.transform_animation_speed(g.UTILITIES.default_animation_speed)));return!0},"add a new widget to the work space":function(a,b,c,d,e){b.is_top_level()?(b=d.add_to_top_level_backside(a),d=$(d.get_frontside_element()).offset(),
a.update_display(),g.UTILITIES.set_position_relative_to_top_level_backside($(b),d,!0)):a.drop_on(b.get_backside(),!1,void 0,d,!0);return!0},"start training":function(a,b,c,d,e){a.training_started(d);return!0},"stop training":function(a,b,c,d,e){a.training_finished();return!0},train:function(a,b,c,d,e){a.add_step(e.step)},"open the backside":function(){return!0},"close the backside":function(){return!0},"click the button of":function(){return!0}},a=function(a,b,c,d){var e=b.get_thing_in_hand(),f=b.get_frontside_element(),
h=a.get_element(),k=$(h).width(),n=$(h).height(),p,t,C,z,E,F;d&&d.left_offset_fraction?(b.original_animation_left_offset||(b.original_animation_left_offset=[]),b.original_animation_top_offset||(b.original_animation_top_offset=[]),C=d.left_offset_fraction*k,z=d.top_offset_fraction*n,e&&(E=e.get_element(),g.UTILITIES.visible_element(E)&&(F=$(E).offset(),f=$(f).offset(),C-=F.left-f.left,z-=F.top-f.top)),e&&0<=b.original_animation_left_offset.indexOf(C)&&0<=b.original_animation_top_offset.indexOf(z)?
(C=b.animation_left_offset+b.last_thing_in_hand_width,z=b.animation_top_offset,C>=k&&(C=0,z+=b.max_thing_in_hand_height,z>=n&&(z=0)),b.last_thing_in_hand_width=$(E).width(),"undefined"===typeof b.max_thing_in_hand_height&&(b.max_thing_in_hand_height=0),b.max_thing_in_hand_height=Math.max(b.max_thing_in_hand_height,$(E).height())):(b.original_animation_left_offset.push(C),b.original_animation_top_offset.push(z),b.last_thing_in_hand_width=$(E).width(),b.max_thing_in_hand_height=$(E).height()),h.animation_left_offset=
C,h.animation_top_offset=z,b.animation_left_offset=C,b.animation_top_offset=z):(p=k/2,t=n/2);b.animate_to_widget(a,c,b.transform_animation_speed(.25),p,t,!0,b.transform_original_step_duration(d&&d.time))},d=function(b,d,c,e){a(b,d,function(){b.open_backside(c);t(b,d)},e)},b=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},e=function(a,d,c,e,f,h,k,n){var p=b(a,h);e.get_frontside_element();var A=p&&$(p).is(":visible"),G=function(){f(p);$(p).addClass("ui-state-active");if(".toontalk-select-function"===
h||".toontalk-box-size-input"===h)p.value=k.argument_1;setTimeout(function(){$(p).removeClass("ui-state-active");!A&&a.get_backside()&&e.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()});e.run_next_step()},n)};d=function(){!g.UTILITIES.visible_element(p)&&C&&C.set_advanced_settings_showing(!0,C.get_element());e.animate_to_element(p,G,e.transform_animation_speed(g.UTILITIES.default_animation_speed/2),0,0,!0)};var C;!A&&a.open_backside&&e.animate_consequences_of_actions()?
(a.open_backside(d),t(a,e)):d()},h=function(a,b,c,d,e,f,h){h=$("."+h).get(0);var k=function(){n(a,b,c,d,e,f)};h&&d.animate_consequences_of_actions()?d.animate_to_element(h,k,d.transform_animation_speed(g.UTILITIES.default_animation_speed),0,0,!0):k()},n=function(a,b,c,d,e,f){d.get_frontside_element();b=function(){d.carrying_tool=void 0;d.update_display();e();d.run_next_step()};d.animate_consequences_of_actions()?(d.carrying_tool=f,d.update_display(),d.animate_to_element(a.get_frontside_element(),
b,d.transform_animation_speed(g.UTILITIES.default_animation_speed/2),0,0,!0)):(e(),d.run_next_step())},f=function(a,b,c,d,e){var g=a.get_parent_of_frontside();h(a,b,c,d,function(){e();g&&"top-level"!==g.get_widget().get_type_name()&&g.update_display&&g.update_display();a.render()},"toontalk-vacuum-ready-small","toontalk-vacuum")},t=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},p={copy:function(a,b,c,d,e){h(a,b,c,d,function(){e();a.add_copy_to_container(d.get_recently_created_widget())},
"toontalk-wand-small","toontalk-wand")},"pick up":function(b,d,c,e,f,h){b.get_frontside_element();d=function(){f();e.animate_consequences_of_actions()&&e.update_display();e.run_next_step()};"empty hole"===b.get_type_name()?g.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):b.save_dimensions()&&e.animate_consequences_of_actions()?a(b,e,d,h):d()},"pick up a copy of":function(b,d,c,e,f,h){a(b,e,function(){var a;f();e.animate_consequences_of_actions()&&(a=e.get_recently_created_widget())&&
(a.set_visible(!0),g.UTILITIES.copy_frontside_dimensions(b,a),e.update_display());e.run_next_step()},h)},"drop it on":function(b,e,c,f,h,k){var n=f.get_thing_in_hand(),p;n?(g.debugging&&n===b&&g.UTILITIES.report_internal_error("Dropping something on itself!"),p=$(n.get_frontside_element()),e=function(){var a=p.offset(),b;p.removeClass("toontalk-held-by-robot");h();n.drop_on&&(f.animate_consequences_of_actions()&&(g.UTILITIES.visible_element(p.get(0))||(b=$(f.get_frontside_element()).closest(".toontalk-top-level-backside"),
b.append(p.get(0))),g.UTILITIES.set_absolute_position(p,a),n.restore_dimensions()),n.robot_waiting_before_next_step!==f&&(f.set_thing_in_hand(void 0),f.run_next_step()),f.rerender())},b.is_backside()&&!g.UTILITIES.visible_element(b.get_element())?d(b.get_widget(),f,e,k):a(b,f,e,k)):(g.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+f),a(b,f,h,k))},"drop it on the text area of":function(b,e,c,f,h,k){var n=f.get_thing_in_hand(),p,t,A,G;n?(p=
$(n.get_frontside_element()),t=function(){p.offset();var a;p.removeClass("toontalk-held-by-robot");h();n.remove();a=b.get_parent_of_frontside().get_widget();a.is_hole()&&(a=a.get_parent_of_frontside());a.is_top_level()?b.render():a.render();f.set_thing_in_hand(void 0);f.run_next_step()},A=function(){return $(b.get_backside_element()).find(k.area_selector).get(0)},f.rerender(),g.UTILITIES.visible_element(b.get_backside_element())?(G=A(),f.animate_to_element(G,t,f.transform_animation_speed(g.UTILITIES.default_animation_speed/
2),0,0,!0)):d(b,f,function(){G=A();f.animate_to_element(G,t,f.transform_animation_speed(g.UTILITIES.default_animation_speed/2),0,0,!0)},k)):(g.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+f),a(b,f,h,k))},remove:f,"change whether erased":f,edit:function(a,b,c,d,g,f){e(a,b,c,d,function(){a.get_backside()&&a.get_backside().update_display();g()},f.button_selector,f,1E3)},"change size of":function(a,b,c,d,e,f){var h=a.get_frontside_element();
d.animate_to_element(h,function(){var b=$(h).width(),c=$(h).height(),b=b*f.x_factor,c=c*f.y_factor,g=d.transform_step_duration(1E3);$(h).addClass("toontalk-animating-element");h.style.transitionDuration=g+"ms";h.style.width=b+"px";h.style.height=c+"px";setTimeout(function(){e();a.render();d.run_next_step()},g)},d.transform_animation_speed(g.UTILITIES.default_animation_speed),0,0,!0)},"add to the top-level backside":function(a,b,c,d,e){e();d.run_next_step()},"add a new widget to the work space":function(a,
b,c,d,f,h){h&&h.button_selector?(a=g.path.dereference_path(h.path_to_source,b,c,d),e(a,b,c,d,f,h.button_selector,h,3E3)):(f(),d.run_next_step())},"start training":function(a,b,c,d,e){b=a.open_backside();a=a.get_frontside_element();e();b&&$(b.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by={element:d.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();
d.run_next_step()},"stop training":function(a,b,c,d,f,h){var k=a.get_frontside_element();e(a,b,c,d,function(){var b=function(){k.toontalk_return_to=void 0;a.get_backside().change_label_and_title_of_train_button(!1);$(k).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");k.toontalk_followed_by=void 0;setTimeout(f,1500)};k.toontalk_return_to?g.UTILITIES.animate_to_absolute_position(k,k.toontalk_return_to,b,d.transform_animation_speed(g.UTILITIES.default_animation_speed)):
b()},".toontalk-train-backside-button",h,1E3)},train:function(a,b,c,d,e,f){b=function(){e();d.run_next_step()};(f=f.step.run_watched)?(a.run_next_step=b,f(a.get_parent_of_frontside().get_widget(),c,a)):b()},"open the backside":function(a,b,c,d,e){a.open_backside(function(){e();d.run_next_step()});t(a,d)},"close the backside":function(a,b,c,d,e,f){b=d.transform_original_step_duration(f&&f.time);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();e();d.run_next_step()},
b)},"click the button of":function(a,b,c,d,f,g){e(a,b,c,d,function(a){$(a).click();f()},g.button_selector)}};g.creators_from_json.robot_action=function(a,b){return a.additional_info?g.robot_action.create(g.path.create_from_json(a.path,b),a.action_name,g.UTILITIES.create_keys_from_json(a.additional_info,b)):g.robot_action.create(g.path.create_from_json(a.path,b),a.action_name)};return{create:function(a,b,c){var d=Object.create(this),e=k[b],f=p[b];if(f)return a||g.UTILITIES.report_internal_error("path undefined in "+
b+" action"),e||g.UTILITIES.report_internal_error("no run_function for "+b),d.get_action_name=function(){return b},d.get_additional_info=function(){return c},d.run_unwatched=function(b,d,f){var h=g.path.dereference_path(a,b,d,f);if(!h)return g.UTILITIES.report_internal_error("Unable to dereference path: "+g.path.toString(a)+" in context: "+b.toString()),!1;g.logging&&0<=g.logging.indexOf("event")&&(h.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+
h.wait_until_this_nest_receives_something.to_debug_string()+"("+g.path.toString(a)+") by unwatched "+f.to_debug_string()):console.log("   "+h.to_debug_string()+" ("+g.path.toString(a)+" "+h.to_debug_string()+" by unwatched "+f.to_debug_string()));h.wait_until_this_nest_receives_something?h.wait_until_this_nest_receives_something.run_when_non_empty(function(){this.run_unwatched(b,d,f)}.bind(this),f):e(h,b,d,f,c)&&f.run_next_step()},d.run_watched=function(b,d,h){var k=g.path.dereference_path(a,b,d,
h),n=function(){h.stopped()||(c||(c={}),c.running_watched=!0,e(k,b,d,h,c))};k?(g.logging&&0<=g.logging.indexOf("event")&&console.log("   "+k+" ("+g.path.toString(a)+" "+k.to_debug_string()+" by watched "+h.to_debug_string()+(h.animate_consequences_of_actions()?"":" finishing instantly")),k.wait_until_this_nest_receives_something?(k.wait_until_this_nest_receives_something.run_when_non_empty(function(){h.set_waiting(!1);this.run_watched(b,d,h)}.bind(this),h),h.set_waiting(!0),TOONTALK.UTILITIES.visible_element(b.get_backside_element())||
h.get_frontside().remove()):(k.set_visible(!0),f(k,b,d,h,n,c))):g.UTILITIES.report_internal_error("Unable to dereference the path: "+g.path.toString(a)+" in context: "+b.toString())},d.toString=function(d){var e="",f="",h=b,k;if("open the backside"===b||"close the backside"===b)return"";if("click the button of"===b)switch(c.button_selector){case ".toontalk-green-flag":h="click the green flag "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" of";break;case ".toontalk-stop-sign":h=
"click the stop sign "+g.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":h="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":h="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":h="click the button to add or remove attributes of ";break;default:h="click a button of"}if("add a new widget to the work space"===b)return b.replace("a new widget",g.path.toString(a));
if("add to the top-level backside"===b)return"";d||(d={});k=g.path.toString(a,d);if("edit"===b||"drop it on the text area of"===b)e=" ("+c.toString+")";else if("train"===b){e=c.step.toString({person:"third"});if(""===e)return e;e=" to "+e;f="- ";d&&d.robot_being_trained_description&&(k=d.robot_being_trained_description)}else"start training"===b?d&&(d.robot_being_trained_description="it"):"stop training"===b&&(k=d.robot_being_trained_description,d.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(b)){if(0<=
k.indexOf("hole of"))return f+h+" what is in "+k+e;if(0===k.indexOf("a When"))return k=k.substring(3),k=g.UTILITIES.remove_encoded_HTML(k),k=g.UTILITIES.elide(k,80,1),"."===k[k.length-1]&&(k=k.substring(0,k.length-1)),f+h+" a robot who w"+k+e+"\n"}return f+h+" "+k+e},d.get_json=function(d){return{type:"robot_action",action_name:b,path:g.path.get_json(a,d),additional_info:c&&g.UTILITIES.get_json_of_keys(c,["running_watched"])}},d;g.UTILITIES.report_internal_error("No watched function for "+b)}}}(window.TOONTALK);window.TOONTALK.queue=function(g){return{create:function(){var k=Object.create(this);k.to_run=g.UTILITIES.create_queue();return k},enqueue:function(g){if(!g.robot.running_or_in_run_queue())return g.robot.set_running_or_in_run_queue(!0),this.to_run.enqueue(g)},maximum_run:50,paused:!1,run:function(){for(var k,a=Date.now()+this.maximum_run;!(this.to_run.isEmpty()||this.paused||Date.now()>=a);)k=this.to_run.dequeue(),k.robot.run_actions(k.context,k.top_level_context,k.queue);g.DISPLAY_UPDATES.run_cycle_is_over();
g.UTILITIES.set_timeout(function(){this.run()}.bind(this),this.to_run.isEmpty()?this.maximum_run:0)}}}(window.TOONTALK);window.TOONTALK.path=function(g){var k;g.creators_from_json["path.to_entire_context"]=function(){return g.path.to_entire_context()};g.creators_from_json["path.to_widget_on_nest"]=function(){return g.path.to_widget_on_nest()};g.creators_from_json["path.top_level_backside"]=function(){return g.path.top_level_backside};g.creators_from_json["path.to_backside_widget_of_context"]=function(a,d){return"undefined"===typeof a.backside_index?g.path.get_path_to_backside_widget_of_context(a.type_name,d&&d.robot):
g.path.get_path_to_backside_index_of_context(a.backside_index,a.type_name,d&&d.robot)};g.creators_from_json["path.to_resource"]=function(a,d){return g.path.get_path_to_resource(g.UTILITIES.create_from_json(a.resource,d))};return{get_path_to:function(a,d){var b=function(a,b){var d=b.get_context(),f=b.get_body(),k,p,m;a.is_backside()&&(m=!0,a=a.get_widget());if(d===a)return k=g.path.to_entire_context(),k.is_backside=m,k;p=a.get_type_name();if("top-level"===p)return g.path.top_level_backside;if(k=f.get_path_to(a,
b))return k.is_backside=m,k;if("element attribute"===p&&a.get_original_attribute_widget()===a)return k=g.element.create_attribute_path(a,b),k.is_backside=m,k;if(g.debugging&&!d)g.UTILITIES.report_internal_error("No context to compute the path");else{if(d.get_path_to&&(f=d.get_path_to(a,b)))return f.is_backside=m,k=g.path.to_entire_context(),k.next=f,k;d.backside_widgets.some(function(d){d=d.get_widget();var c;if(d===a||d.top_contents_is&&d.top_contents_is(a))return b.add_to_backside_conditions(d),
k=g.path.get_path_to_backside_widget_of_context(d,b),k.is_backside=m,!0;if(d.get_path_to&&(c=d.get_path_to(a,b)))return c.is_backside=m,b.add_to_backside_conditions(d),k=g.path.get_path_to_backside_widget_of_context(d,b),k.next=c,!0});if(k)return k.is_backside=m,k;if(d=a.ancestor_of_type("robot"))return g.robot.find_conditions_path(a,d,b);k=g.path.get_path_to_resource(a.copy());k.is_backside=m;return k}}(a,d);b&&a.dereference_contents&&(g.path.path_end(b).not_to_be_dereferenced=!0);!b||"pick up"!==
d.current_action_name&&"remove"!==d.current_action_name||(g.path.path_end(b).removing_widget=!0);return b},path_end:function(a){for(;a.next;)a=a.next;return a},dereference_path:function(a,d,b,e){var g;a?a.dereference_path?g=a.dereference_path(d,b,e):d.dereference_path&&(g=d.dereference_path(a,b,e)):g=d;return g&&a&&a.is_backside?g.get_backside(!0):g},continue_dereferencing_path:function(a,d,b,e){return a.next?d.dereference_contents&&!a.next.not_to_be_dereferenced?(d=d.dereference_contents(a.next,
b,e))&&a.is_backside?d.get_backside(!0):d:(d=d.dereference_path(a.next,b,e))&&a.next.is_backside?d.get_backside(!0):d:d.dereference_contents&&!a.not_to_be_dereferenced?(d=d.dereference_contents(a,b,e))&&a.is_backside?d.get_backside(!0):d:d},toString:function(a,d){var b="",e;if(!a)return"undefined path";a.is_backside&&(b="the backside of ");d||(d={});e=d.resource;d.resource=!0;a.next?(g.path.toString(a.next,d),b=b+g.path.toString(a.next,d).trim()+" of "+a.toString(d)):b+=a.toString(d);d.resource=e;
return b},get_json:function(a,d){var b;if(!a.get_json)return a;b=a.get_json(d);a.is_widget&&a.add_to_json(b,d);a.next&&(b.next_path=g.path.get_json(a.next,d));a.removing_widget&&(b.removing_widget=!0);a.not_to_be_dereferenced&&(b.not_to_be_dereferenced=!0);a.is_backside&&(b.is_backside=!0);return b},to_entire_context:function(a){return{dereference_path:function(a,b,e){return g.path.continue_dereferencing_path(this,a,b,e)},toString:function(a){return a&&a.robot?a.robot.get_top_level_context_description(a):
a&&"third"===a.person?"what he's working on":"what I'm working on"},get_json:function(){return{type:"path.to_entire_context"}}}},to_widget_on_nest:function(){return{dereference_path:function(a,d,b){return g.path.continue_dereferencing_path(this,a,d,b)},toString:function(){return"what is on the nest"},get_json:function(){return{type:"path.to_widget_on_nest"}}}},get_path_to_resource:function(a){a||console.error("Widget missing in get_path_to_resource.");a=a.get_widget();return{dereference_path:function(d,
b,e){d=a.copy({copying_resource:!0});var h,k,f;e.add_newly_created_widget(d);e.visible()&&(h=g.UTILITIES.find_resource_equal_to_widget(a))&&(d.save_dimensions_of(g.UTILITIES.widget_of_element(h)),f=d.get_frontside_element(),k=$(h).position(),g.UTILITIES.set_timeout(function(){$(f).css({left:k.left,top:k.top,width:$(h).width(),height:$(h).height()})}));return d},toString:function(d){return g.UTILITIES.add_a_or_an(a.toString(d))},get_json:function(){return{type:"path.to_resource",resource:g.path.get_json(a,
g.UTILITIES.fresh_json_history())}}}},get_path_to_backside_widget_of_context:function(a,d){return"string"===typeof a?{dereference_path:function(b,d,h){var k=h.get_backside_widget_of_type(a,b);k||b.backside_widgets.some(function(b){if(b.get_widget().is_of_type(a)&&!h.is_newly_created(b.get_widget()))return k=b.get_widget(),!0});if(k)return g.path.continue_dereferencing_path(this,k,d,h)},toString:function(b){b=(b&&b.robot&&b.robot.get_backside_conditions()?b.robot.get_backside_conditions()[a]:g.UTILITIES.add_a_or_an(a))+
" on the back of what I'm working on";return this.removing_widget?"what is on "+b:b},get_json:function(){return{type:"path.to_backside_widget_of_context",type_name:a}}}:this.get_path_to_backside_index_of_context(d.get_backside_condition_index(a),a.get_type_name(),d)},get_path_to_backside_index_of_context:function(a,d,b){return{dereference_path:function(b,d,k){if(b=k.get_backside_matched_widgets()[a])return g.path.continue_dereferencing_path(this,b,d,k);g.debugging&&console.log("can this happen?")},
toString:function(a){a=b.get_frontside_conditions().is_top_level()?"work area":"back of what";a=g.UTILITIES.add_a_or_an(d||"thing")+" on the "+a+" I'm working on";return this.removing_widget?"what is on "+a:a},get_json:function(b){return{type:"path.to_backside_widget_of_context",type_name:d,backside_index:a}}}},create_from_json:function(a,d){var b=g.UTILITIES.create_from_json(a,d);a.next_path&&(b.next=this.create_from_json(a.next_path,d));a.removing_widget&&(b.removing_widget=!0);a.not_to_be_dereferenced&&
(b.not_to_be_dereferenced=!0);a.is_backside&&(b.is_backside=!0);return b},top_level_backside:{dereference_path:function(a,d,b){if(a=a.ancestor_of_type("top-level"))return a;k||(k=g.widget.create_top_level_widget());return k},toString:function(){return"the top-level backside"},get_json:function(){return{type:"path.top_level_backside"}}}}}(window.TOONTALK);window.TOONTALK.publish=function(g){var k=function(a,d,b){var e='<!DOCTYPE html>\n<html>\n<head>\n<link rel="stylesheet" media="all" href="https://toontalk.github.io/ToonTalk/toontalk.css">\n<link href="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/css/font-awesome.min.css" rel="stylesheet" type="text/css" />\n<link href="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/css/froala_editor.min.css" rel="stylesheet" type="text/css" />\n<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">\x3c/script><script src="https://toontalk.github.io/ToonTalk/compile/toontalk.js">\x3c/script>\n<script src="https://toontalk.github.io/ToonTalk/libraries/jquery-ui-1.11.2.custom/jquery-ui.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/froala_editor.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/block_styles.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/colors.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/font_family.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/font_size.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/lists.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/tables.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/video.min.js">\x3c/script>\n<title>\n'+
a+'</title>\n<link rel="shortcut icon" href="favicon.ico" />\n</head>\n<body>\n';d.forEach(function(a,d){e+='<div class="toontalk-edit" name="content">\n'+a+"\n</div>\n";b[d]&&(e+=b[d])});return e+='<script src="https://toontalk.github.io/ToonTalk/support/published_support.js">\x3c/script>\n</body>\n</html>\n'};return{publish_widget:function(a,d,b,e){var h=g.google_drive.get_status(),n=["Edit this. Select text for formatting.","And edit this."],f=function(b){(b=b&&b.items&&0<b.items.length&&b.items[0])?
e(b,m):(b=k(a,n,m),g.google_drive.upload_file(t,"html",b,e))},t,p,m;"Ready"===h?(t=d.get_setting("program_name"),b?(p=g.UTILITIES.get_json_top_level(d),d.set_setting("program_name",t+" (published version)"),m=[g.UTILITIES.toontalk_json_div(p,d)],d.set_setting("program_name",t)):(d=d.get_backside_widgets(),m=[],d.forEach(function(a,b){a.visible()&&(p=g.UTILITIES.get_json_top_level(a),m.push(g.UTILITIES.toontalk_json_div(p,a.get_widget())),1<b&&(n[b]=n[1]))}),n.push(n[1])),g.google_drive.get_toontalk_files(g.google_drive.full_file_name(t,
"page"),"page",f)):(console.log("Unable to publish to Google Drive because: "+h),e(null))},republish:function(a){g.google_drive.insert_or_update_file(void 0,a.file_id,"page",k(a.title,a.editable_contents,a.widgets_json),function(){console.log("Published page '"+a.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(g){var k=g.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",a=g.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",d="Need to authorize",b,e;return{handle_client_load:function(b){0>window.location.href.indexOf(a)?(d="Connections to Google Drive are configured for the following domain only: "+a+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",b&&
b(d)):setTimeout(function(){g.google_drive.check_authorization(b)})},check_authorization:function(a){d="Awaiting authorization";gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(b){g.google_drive.handle_authorization_result(b,a)})},handle_authorization_result:function(a,b){a&&!a.error?(d="Authorized but not yet ready",gapi.client.load("drive","v2",function(){g.google_drive.get_folder_ids(function(){d="Ready"})}),b&&b()):(d="Need to authorize",b&&
b(d))},authorize:function(a){gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(b){g.google_drive.handle_authorization_result(b,a)})},get_folder_ids:function(a){g.google_drive.get_folder_id(!0,function(d){b=d;g.google_drive.get_folder_id(!1,function(b){e=b;a()})})},get_folder_id:function(a,d){var f=a?"ToonTalk Programs":"ToonTalk Pages",k=function(b){var e=function(a){a&&a.id?d(a.id):console.error("Failure to create folder '"+f+"'. Response was "+
a)};(b=b&&b.items&&0<b.items.length&&b.items[0].id)?d(b):a?g.google_drive.create_folder("ToonTalk Programs",!1,e):g.google_drive.create_folder("ToonTalk Pages",!0,e)};a&&b?d(b):!a&&e?d(e):g.google_drive.fetch_folder_id(f,k)},get_status:function(){return d},connection_to_google_drive_possible:function(){return 0!==d.indexOf("Connections to Google Drive are configured for the following domain only: ")},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",params:a}).execute(b)},
fetch_folder_id:function(a,b){g.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},b)},get_toontalk_files:function(a,b,d){"undefined"===typeof gapi?d("Google Drive API not available."):(b="properties has {key='ToonTalkType' and value='"+b+"' and visibility='PUBLIC'} and trashed = false",a&&(b+=" and title='"+a+"'"),g.google_drive.list_files({q:b},d))},get_toontalk_program_file:function(a,d){g.google_drive.list_files({q:"'"+b+"' in parents and trashed = false and title='"+
a+"'"},function(a){a&&a.items&&0<a.items.length?d(a.items[0]):d(null)})},upload_file:function(a,b,d,e){var k="json"===b?"program":"page",m=a+"."+b;g.google_drive.get_toontalk_files(m,k,function(a){gapi.client.load("drive","v2",function(){var b=a&&a.items&&0<a.items.length&&a.items[0].id;e||(e=function(a){a.error&&(console.log("Google drive status: "+g.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message));console.log("File "+a.title+" ("+a.id+") "+(b?"updated":
"created"))});b?g.google_drive.insert_or_update_file(void 0,b,k,d,e):g.google_drive.insert_or_update_file(m,void 0,k,d,e)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(a,d,f,k,p){var m={title:a,mimeType:"text/html"};m.parents=[{kind:"drive#fileLink",id:"program"===f?b:e}];k="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(m)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
k+"\r\n---------314159265358979323846--";a?(a="/upload/drive/v2/files",m="POST"):(a="/upload/drive/v2/files/"+d,m="PUT");gapi.client.request({path:a,method:m,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:k}).execute(function(a){d||g.google_drive.insert_property(a.id,"ToonTalkType",f,"PUBLIC");p&&p(a)})},create_folder:function(a,b,d){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){d(a)})}:d)},download_file:function(a,b){if(a.downloadUrl){var d=gapi.auth.getToken().access_token,e=new XMLHttpRequest;e.open("GET",a.downloadUrl);e.setRequestHeader("Authorization","Bearer "+d);e.onload=function(){b(e.responseText)};e.onerror=function(){b(null)};e.send()}else b(null)},google_drive_url:function(a){return"https://googledrive.com/host/"+a+"/"},insert_property:function(a,
b,d,e){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:d,visibility:e}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(g){var k={},a,d=100,b=(new Date).getTime(),e,h=function(a){var b=a.indexOf("<div style='display:none;'>{"),b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},n=function(b,c){var d=$(c).closest(".toontalk-side"),e=k.get_mouse_or_first_touch_event_attribute("clientX",b),g=k.get_mouse_or_first_touch_event_attribute("clientY",b),f,h,m;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");b.dataTransfer&&
b.dataTransfer.getData("text")&&0<b.dataTransfer.getData("text").length||(a=d||$(c),h=k.widget_from_jquery(a),h||(h=k.widget_of_element(c),k.report_internal_error("Possible bug that "+a+" doesn't have a known owner."),a=$(c)),h.set_stopped&&h.set_stopped(!0),!h.save_dimensions||h.get_parent_of_frontside()&&!h.get_parent_of_frontside().get_widget().is_top_level()||h.save_dimensions(),h.being_dragged=!0,f=a.get(0).getBoundingClientRect(),m=a.is(".toontalk-top-level-resource"),$(c).removeClass("toontalk-wiggle"),
h.get_json&&(d=k.get_json_top_level(h),d.view.drag_x_offset=e-f.left,d.view.drag_y_offset=g-f.top,!d.view.frontside_width&&a.parent().is(".toontalk-backside")&&(d.view.frontside_width=a.width(),d.view.frontside_height=a.height()),a.is(".toontalk-backside")&&(d.view.backside=!0),a.data("json",d),b.dataTransfer&&(e=k.toontalk_json_div(d,h),b.dataTransfer.effectAllowed=m?"copy":"move",b.dataTransfer.setData("text",e),k.is_internet_explorer()||b.dataTransfer.setData("text/html",e)),h.drag_started(d,m)),
a.addClass("toontalk-being-dragged"),b.stopPropagation())},f=function(b){a||(a=$(b.target).closest(".toontalk-side"));k.widget_from_jquery(a).being_dragged=void 0;if(a.is(".toontalk-frontside"))if(a.parent().is(".toontalk-backside")){var c=a.data("json");c&&k.set_css(a,{width:c.view.frontside_width,height:c.view.frontside_height})}else a.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||a.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||
k.has_animating_image(a.get(0))||k.set_css(a,{width:"100%",height:"100%"});I();b.stopPropagation()},t=function(b){if(a)return k.widget_from_jquery(a);if(b)return b=k.data_transfer_json_object(b),k.create_from_json(b)},p=function(b,d){var e=k.data_transfer_json_object(b),f,h,m,n,p,r,t,v,z,A;!e&&a&&(e=a.data("json"));a&&a.data("json","");f=a;I();if(f||e||b.dataTransfer.files||C(b)){if($(b.target).is(".toontalk-drop-area-instructions"))m=$(b.target).parent();else if($(b.target).is(".toontalk-element-attribute-input")){if(m=
$(b.target).closest(".toontalk-side"),n=k.widget_from_jquery(m)){h=f?k.widget_from_jquery(f):k.create_from_json(e);k.restore_resource(f,h);n.dropped_on_style_attribute(h,b.target.name,b);b.stopPropagation();return}}else if($(b.target).is(".toontalk-drop-area"))m=$(b.target);else{if(e&&$(b.currentTarget).is(".froala-element")){t=e;m=k.create_from_json(t);n=document.createElement("div");t=t.view.backside?m.get_backside_element(!0):m.get_frontside_element(!0);e=$(d).closest(".toontalk-edit");f=g.published_support.create_editable_text();
h=b.target;$(n).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");$(t).addClass("toontalk-top-level-resource").css({position:"relative"});t.toontalk_widget=m;n.toontalk_widget=m;n.appendChild(t);for($(n).insertAfter(e);h.nextSibling;)$(f).children(".froala-element").get(0).appendChild(h.nextSibling);$(f).insertAfter(n);m.update_display();return}m=$(b.target).closest(".toontalk-side")}if(0!==m.length&&!m.is(".toontalk-top-level-resource")){t=m.offset();k.remove_highlight();
n=k.widget_from_jquery(m);if(f&&0<f.length&&!(n&&n.get_infinite_stack&&n.get_infinite_stack())&&(f.get(0)===m.get(0)||jQuery.contains(f.get(0),m.get(0)))){if(f.is(".toontalk-top-level-backside"))return;m.hide();h=k.get_mouse_or_first_touch_event_attribute("pageX",b);p=k.get_mouse_or_first_touch_event_attribute("pageY",b);h=document.elementFromPoint(h-window.pageXOffset,p-window.pageYOffset);m.show();h&&(m=$(h).closest(".toontalk-side"),t=m.offset(),n=k.widget_from_jquery(m))}e&&e.view&&e.view.drag_x_offset?
(p=e.view.drag_x_offset,r=e.view.drag_y_offset):r=p=0;if(f&&0<f.length){if(!(n&&n.get_infinite_stack&&n.get_infinite_stack()||f.get(0)!==m.get(0)&&!jQuery.contains(f.get(0),m.get(0)))){k.set_css(f,{left:f.get(0).offsetLeft+(b.layerX-p),top:f.get(0).offsetTop+(b.layerY-r)});b.stopPropagation();return}v=f.is(".toontalk-backside");h=k.widget_from_jquery(f);f.parent().is(".toontalk-drop-area")?(f.removeClass("toontalk-widget-in-drop_area"),f.parent().data("drop_area_owner").set_next_robot(void 0)):(z=
f.parents(".toontalk-side:first"),(A=k.widget_from_jquery(z))?!v&&h.get_infinite_stack&&h.get_infinite_stack()?(z=h.saved_width,A=h.saved_height,h=h.copy(),h.saved_width=z,h.saved_height=A,z=f.width(),A=f.height(),f=$(h.get_frontside_element(!0)),m.is(".toontalk-backside")&&k.set_css(f,{width:e.view.frontside_width||z,height:e.view.frontside_height||A})):A.removed_from_container&&(z.is(".toontalk-backside")?A.remove_backside_widget(h,v,!0):(A.removed_from_container(h,v,b,void 0,!0),h.restore_dimensions&&
!A.is_empty_hole()&&h.restore_dimensions())):k.restore_resource(f,h),h.robot_in_training()&&h.robot_in_training().add_newly_created_widget_if_new(h))}else{if(0<b.dataTransfer.files.length){for(e=0;e<b.dataTransfer.files.length;e++)q(b.dataTransfer.files[e],m,n,t,b);b.stopPropagation();return}if(C(b)){w(b.dataTransfer.getData("URL"),m,n,t,b);b.stopPropagation();return}h=k.create_from_json(e,{event:b});if(!h){e?k.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):g.debugging&&
console.log("No data transfer in drop.");b.stopPropagation();return}h.robot_in_training()&&h.robot_in_training().drop_from_data_transfer(h);(v=e.view.backside)?(f=$(h.get_backside_element()),k.set_css(f,{width:e.view.backside_width,height:e.view.backside_height,"background-color":e.view.background_color,"border-width":e.view.border_width}),h.apply_backside_geometry()):f=$(h.get_frontside_element())}h!==n&&c(m,f,h,n,t,b,e,p,r,v)}}else b.dataTransfer?k.report_internal_error("Drop failed since unable to parse as JSON."):
k.report_internal_error("Drop failed since there is no event.dataTransfer"),b.stopPropagation()},m=function(a,b){a.addEventListener("drop",function(a){var c=t(a);k.restore_resource(k.get_dragee(),c);b(a)})},r=function(a,b){var c;c=$(b).closest(".toontalk-side");var d=k.get_dragee();c=!c.is("*")||c.is(".toontalk-top-level-backside")||c.closest(".toontalk-top-level-resource").is("*")||c.is(".toontalk-being-dragged")||d&&A(c.get(0),d.get(0))?void 0:c;if(c)return k.highlight_element(c.get(0),a),c.get(0)},
c=function(a,b,c,d,e,f,h,m,n,p){var q=k.get_mouse_or_first_touch_event_attribute("pageX",f),r=k.get_mouse_or_first_touch_event_attribute("pageY",f),t,v,w,z;c.set_visible(!0);if(a.is(".toontalk-backside")){if(c.is_top_level()){t=h.semantic.backside_widgets;v=h.shared_widgets;w=a.get(0);(b=d.robot_in_training())&&b.drop_from_data_transfer(c,d);b=c.get_backside_widgets().slice();b.forEach(function(a,b){var e=a.get_widget(),l,f,g,h,m,u,n;c.remove_backside_widget(e,a.is_backside());l=0<=t[b].widget.shared_widget_index?
v[t[b].widget.shared_widget_index].view:t[b].widget.view;a.is_backside()?(f=e.get_backside_element(!0),g=l.backside_left,h=l.backside_top,m=l.backside_width,u=l.backside_height):(f=e.get_frontside_element(!0),g=l.frontside_left,h=l.frontside_top,m=l.frontside_width,u=l.frontside_height);d.add_backside_widget(e,a.is_backside());w.appendChild(f);n=$(f).position();z={left:n.left+g,top:n.top+h,width:m,height:u};k.constrain_css_to_fit_inside(w,z);k.set_css(f,z);a.is_backside()&&(e.backside_geometry=l.backside_geometry,
e.apply_backside_geometry())}.bind(this));return}c?d.get_backside().widget_dropped_on_me(c,p,f):k.report_internal_error("No source_widget");"undefined"!==typeof m&&(f=q-(e.left+(m||0)),n=r-(e.top+(n||0)),k.set_css(b,{left:g.UTILITIES.left_as_percent(f,b.get(0)),top:g.UTILITIES.top_as_percent(n,b.get(0))}));h&&h.semantic.running&&!k.get_dragee()&&c.set_running(!0)}else if(a.is(".toontalk-drop-area"))b.addClass("toontalk-widget-in-drop_area"),a.append(b.get(0)),b.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(k.widget_from_jquery(b));
else{if(b.is(".toontalk-backside-of-top-level"))return;if(d||f.changedTouches){w=a.closest(".toontalk-top-level-backside").get(0);!w&&f.changedTouches&&(h=document.elementFromPoint(q-window.pageXOffset,r-window.pageYOffset),(w=$(h).is(".toontalk-top-level-backside")?h:$(h).closest(".toontalk-top-level-backside").get(0))||(w=$(".toontalk-top-level-backside").get(0)),d=k.widget_of_element(w).get_backside());if(!w)return;w.appendChild(b.get(0));h=$(w).offset();k.set_css(b,{left:q-(h.left+m),top:r-(h.top+
n)});c.drop_on&&c.drop_on(d,p,f)||d.widget_dropped_on_me&&d.widget_dropped_on_me(c,p,f)||(b=a.closest(".toontalk-top-level-backside"),0<b.length&&(d=k.widget_from_jquery(b))&&d.get_backside().widget_dropped_on_me(c,p,f))}else{k.report_internal_error("target widget missing");return}}k.remove_highlight()},q=function(a,b,d,e,f){var m=new FileReader,n=0===a.type.indexOf("image"),p=0===a.type.indexOf("audio"),q=0===a.type.indexOf("video"),r,t,v;m.onloadend=function(){if(n)r=g.element.create("<img src='"+
m.result+"' alt='"+a.name+"'/>");else if(p)r=g.element.create(a.name+" sound"),r.set_sound_effect(new Audio(m.result));else if(q)r=g.element.create("<video src='"+m.result+"' alt='"+a.name+"'/>");else{if(t=h(m.result))try{v=JSON.parse(t),r=k.create_from_json(v)}catch(w){}r||(r=g.element.create(m.result))}r&&r.robot_in_training()&&r.robot_in_training().drop_from_data_transfer(r,d);c(b,$(r.get_frontside_element(!0)),r,d,e,f,v)};n||p||q?m.readAsDataURL(a):m.readAsText(a)},w=function(a,b,d,e,f){var h=
function(a,b,d,e,l){var f=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),c(b,$(a.get_frontside_element(!0)),a,d,e,l))};k.create_widget_from_URL(a,f,function(b){var c=l.dataTransfer.getData("text/html")||l.dataTransfer.getData("text");c?f(g.element.create(c)):(k.display_message("Error: "+b+". When trying to fetch "+a),console.log(b))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&h(a,b,d,e,f)})},v=function(a,b){var c=$("<div class='"+a+"'>");k.run_when_dimensions_known(c.get(0),
function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},D=function(a){var b=k.get_path_to_toontalk_folder()+"sounds/",c=function(c){c=new Audio(b+c);c.volume=a;return c};g.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),event_ignored:c("PLOP.mp3")};
g.sounds.bird_fly.loop=!0},H=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},I=function(){a&&(a.removeClass("toontalk-being-dragged"),k.set_timeout(function(){a=void 0}))},A=function(a,b){if(a===b)return!0;if(a.parentNode)return A(a.parentNode,b)},G=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",h,m;if(0>f)return a;for(;0<=f;){h=f+d.length;m=a.indexOf(e,
h);if(0>m)return k.report_internal_error("Expected title to have matching pairs of "+d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(h,m));c=m+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},C=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},z=[],E=[],F,K;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window?(a.stopPropagation(),0<z.length&&z.shift()()):a.data.editable_contents&&g.publish.republish(a.data)},
!1);document.addEventListener("DOMContentLoaded",function(){var a;g.debugging=k.get_current_url_parameter("debugging");g.logging=k.get_current_url_parameter("log");a=k.get_current_url_numeric_parameter("volume",10);0<a&&D(a/100);k.process_json_elements();$(document).click(function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget;c&&c.set_running&&c.set_running(!1)})});g.DEFAULT_QUEUE=window.TOONTALK.queue.create();g.DEFAULT_QUEUE.run();window.addEventListener("beforeunload",
function(a){try{k.backup_all_top_level_widgets(!0)}catch(b){console.log(b)}});g.TRANSLATION_ENABLED=k.get_current_url_boolean_parameter("translate",!1);g.TRANSLATION_ENABLED?($("a").each(function(a,b){b.href=k.add_URL_parameter(b.href,"translate","1")}),$("#google_translate_element").is("*")||(a=document.createElement("div"),a.id="google_translate_element",document.body.insertBefore(a,document.body.firstChild)),document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]),
H("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit")):$("#google_translate_element").remove();g.vacuum.the_vacuum||g.vacuum.create();k.add_test_all_button();v("toontalk-robot",g.robot);v("toontalk-empty-nest",g.nest);v("toontalk-bird-static",g.bird);$("[title]").each(function(a,b){window.TOONTALK.UTILITIES.use_custom_tooltip(b)});document.addEventListener("visibilitychange",function(){document.hidden||k.rerender_all()})});k.available_types="number box element robot nest sensor top-level".split(" ");
k.create_from_json=function(a,b,c){var d=function(a,b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},e,f,h,m;if(a){b||(b={});b.guid_to_nest_table||(b.guid_to_nest_table={});a.shared_widgets&&(b.json_of_shared_widgets=a.shared_widgets,b.shared_widgets=[]);a.shared_html&&(b.shared_html=a.shared_html);if(a.widget)return(e=k.create_from_json(a.widget,b))&&a.is_backside?e.get_backside(!0):
e;if(b&&b.shared_widgets&&0<=a.shared_widget_index){if(c=b.shared_widgets[a.shared_widget_index])return c;c=b.json_of_shared_widgets[a.shared_widget_index];e=k.create_from_json(c,b,!0);return d(e,b,a.shared_widget_index)}(h=a.semantic)||(h=a);a=a.view;if(0<=h.shared_widget_index){if(!b.json_of_shared_widgets){k.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}e=k.create_from_json(b.json_of_shared_widgets[h.shared_widget_index],b,!0);return d(e,b,h.shared_widget_index)}if(g.creators_from_json[h.type]){b||
(b={});a?b.json_view=a:a=b.json_view;try{e=g.creators_from_json[h.type](h,b)}catch(n){console.error(n.stack),k.report_internal_error("Unable to recreate a "+h.type+". Error is "+n)}if(e&&e.get_backside){h.erased&&(g.widget.erasable(e),e.set_erased(h.erased));h.infinite_stack&&e.set_infinite_stack(h.infinite_stack);if(a&&a.frontside_width&&(f=a.backside?e.get_backside(!0).get_element():e.get_frontside_element(),e.ok_to_set_dimensions()))if(m={width:a.frontside_width,height:a.frontside_height},"element"===
h.type)e.on_update_display(function(){k.set_css(f,m)});else k.set_css(f,m);a&&a.saved_width&&(e.saved_width=a.saved_width,e.saved_height=a.saved_height);a&&a.backside_geometry&&(e.backside_geometry=a.backside_geometry);h.backside_widgets&&(c?e.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(e,h.backside_widgets,b)}.bind(this):this.add_backside_widgets_from_json(e,h.backside_widgets,b))}return e}k.report_internal_error("JSON type '"+h.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};
k.add_backside_widgets_from_json=function(a,b,c){var d;b&&(a.is_top_level()||(c.to_be_on_backside_of?c.to_be_on_backside_of.push(a):c.to_be_on_backside_of=[a]),d=this.create_array_from_json(b,c),a.set_backside_widget_sides(d,b.map(function(a){return a?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a})),a.is_top_level()||c.to_be_on_backside_of.pop())};k.create_array_from_json=function(a,
b){var c=[];a.forEach(function(a,d){c[d]=a?k.create_from_json(a,b):a});return c};k.get_json_of_array=function(a,b){var c=[];a.forEach(function(a,d){if(a)try{a.is_backside&&a.is_backside()?c[d]={widget:k.get_json(a.get_widget(),b),is_backside:!0}:c[d]=a.get_type_name?{widget:k.get_json(a,b)}:a.get_json(b)}catch(e){k.report_internal_error("Error trying to save "+a)}});return c};k.fresh_json_history=function(){return{widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]}};k.get_json_top_level=
function(a){var b=this.fresh_json_history(),c=k.get_json(a,b);0<b.shared_widgets.length&&(c.shared_widgets=b.shared_widgets.map(function(d,e){var f=function(a){a=b.widgets_encountered.indexOf(a);return b.json_of_widgets_encountered[a]},g=function(a){return f(b.shared_widgets[a])},h=f(d);a===d?(h={semantic:h.semantic,view:h.view,version:h.version},c.semantic={shared_widget_index:e}):k.tree_replace_once(c.semantic,h,{shared_widget_index:e},g,k.generate_unique_id());return h}));c.shared_html=b.shared_html;
return c};k.get_json=function(a,b){var c,d,e;g.debugging&&!b&&k.report_internal_error("no json_history");c=b.shared_widgets.indexOf(a);if(0<=c)return{shared_widget_index:c};c=b.widgets_encountered.indexOf(a);if(0<=c)return c=k.insert_ancestors_last(a,b.shared_widgets),{shared_widget_index:c};c=b.widgets_encountered.push(a)-1;e=a.is_backside();a=a.get_widget();d=a.get_json(b);d=a.add_to_json(d,b);d.view.backside=e;b.json_of_widgets_encountered[c]=d;a.add_backside_widgets_to_json&&a.add_backside_widgets_to_json(d,
b);return d};k.get_json_of_keys=function(a,b){var c;b||(b=[]);Object.keys(a).forEach(function(d){0>b.indexOf(d)&&(c||(c={}),c[d]=a[d].get_json?{json:a[d].get_json()}:a[d])});return c};k.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?k.create_from_json(a[d].json,b):a[d]});return c};k.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).forEach(function(g){if(f=a[g]){if(f===
b)return a[g]=c,!0;if("shared_widget_index"===g){if(this.tree_replace_once(d(f),b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};k.insert_ancestors_last=function(a,b){var c=-1;b.some(function(b,d){if(a.has_ancestor(b))return c=d,!0});0>c&&(c=b.length);b.splice(c,0,a);return c};k.toontalk_json_div=function(a,b){var c=a.view.backside,d=b.get_backside_widgets(),e=b.get_type_name(),
f=b.toString({for_json_div:!0});"top-level"===e?c?(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),F=d.length,d.forEach(function(a){F--;e+=k.add_a_or_an(a.get_type_name());1===F?e+=", and ":1<F&&(e+=", ")}))):e="a top-level widget":(e=k.add_a_or_an(e),c&&(e="the back of "+e));f&&(c=f.indexOf("data:image/"),0<c&&(d=f.indexOf("alt=",c),0>d&&(d=f.indexOf(">",c)),f=f.substring(0,c+20)+" ... "+f.substring(d)));
return"<div class='toontalk-json'>\nThis will be replaced by "+e+".\n"+(f?f+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,k.clean_json,"  ")+"</div></div>"};k.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};k.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:b};k.create_widget_from_URL=function(a,b,c){var d=function(f){try{var h=
this.getResponseHeader("content-type"),k;if(!h){c&&c("Could not determine the contents type of the url");e.removeEventListener("readystatechange",d);return}0===h.indexOf("audio")?(k=g.element.create(a),k.set_sound_effect(new Audio(a))):0===h.indexOf("image")?k=g.element.create("<img src='"+a+"'>"):0===h.indexOf("video")?k=g.element.create("<video src='"+a+" ' width='320' height='240'>"):0===h.indexOf("text")&&0>h.indexOf("text/html")?this.responseText&&(k=g.element.create(this.responseText),k.set_source_URL(a)):
k=g.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");k&&b(k)}catch(m){c&&c(m),b()}e.removeEventListener("readystatechange",d)},e=new XMLHttpRequest;e.addEventListener("readystatechange",d);e.open("GET",a,!0);try{e.send()}catch(f){c?c(f):(k.display_message("Error trying to GET "+a+" "+f),console.error(f.stack))}};k.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};k.copy_widget_sides=function(a,
b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};k.copy_array=function(a){return a.slice()};k.generate_unique_id=function(){b+=1;return"toontalk_id_"+b};k.get_style_property=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)};k.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;return"string"===
typeof c?(d=c.indexOf("px"),0<=d&&(c=c.substring(0,d)),"auto"===c?"left"===b?$(a).position().left:"top"===b?$(a).position().top:c:parseInt(c,10)):c};k.data_transfer_json_object=function(a){var b;if(a.dataTransfer&&!(0<a.dataTransfer.files.length||C(a))){try{b=a.dataTransfer.getData("text/html")}catch(c){b=a.dataTransfer.getData("text")}if(!b||b.match(/[\u3400-\u9FBF]/))b=a.dataTransfer.getData("text");if(b){a=h(b);if(!a)return k.get_json_top_level(g.element.create(b));try{return JSON.parse(a)}catch(d){k.report_internal_error("Exception parsing "+
a+"\n"+d.toString())}}}};k.drag_and_drop=function(a){var b;k.draggable(a);k.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,k.enable_touch_events(a,b))};k.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){n(b,a)});a.addEventListener("dragend",function(b){f(b,a)})};k.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",
function(b){b.preventDefault();p(b,a);b.stopPropagation()});a.addEventListener("dragenter",function(c){var d=r(c,a);d&&b!==d&&k.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!k.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(k.remove_highlight(b),b=void 0);a.stopPropagation()})};k.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");
c.addClass("toontalk-drop-area");c.append(d);k.can_receive_drops(b);return c};k.process_json_elements=function(){$(".toontalk-json").each(function(a,b){var c=b.textContent,d,e,f,h;if(c)if(c=c.substring(c.indexOf("{"),c.lastIndexOf("}")+1),d=JSON.parse(c),e=k.create_from_json(d)){b.textContent="";if(e.get_type_name)if(e.is_top_level()){if(!g.no_local_storage&&!k.get_current_url_boolean_parameter("reset",!1)){if(d.load_most_recent_program)try{(h=window.localStorage.getItem("toontalk-last-key"))&&(f=
window.localStorage.getItem(h))}catch(m){c="Error reading previous state. Error message is "+m,k.is_internet_explorer()?console.error(c):k.display_message(c)}f&&(d=JSON.parse(f),e=k.create_from_json(d))}f=e.get_backside(!0);f=f.get_element();$(b).replaceWith(f);k.set_css(f,{width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width})}else $(b).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),
f=e.get_frontside_element(),$(f).addClass("toontalk-top-level-resource").css({position:"relative"}),b.toontalk_widget=e,b.appendChild(f);else b.appendChild(e.get_element());e.set_active&&e.set_active(!1);e.set_visible&&e.set_visible(!0);setTimeout(function(){e.update_display&&e.update_display();d.semantic.running&&e.set_running(!0)},1)}else k.report_internal_error("Could not recreate a widget from this JSON: "+c)})};k.set_absolute_position=function(a,b){for(var c=a.parent(),d=b.left,e=b.top,f;c.is("*")&&
!c.is("html");)f=c.position(),d-=f.left,e-=f.top,c=c.parent();k.set_css(a,{left:d,top:e,position:"absolute"});a.is(".toontalk-side-animating")&&(a.get(0).style.left=d+"px",a.get(0).style.top=e+"px")};k.set_position_relative_to_top_level_backside=function(a,b,c){var d=a.closest(".toontalk-top-level-backside"),e=d.offset(),f,g;e||(e={left:0,top:0});f=b.left-e.left;b=b.top-e.top;c&&(c=a.width(),e=a.height(),g=d.width(),d=d.height(),f>g-c&&(f=g-c),0>f&&(f=0),b>d-e&&(b=d-e),0>b&&(b=0));k.set_css(a,{left:f,
top:b,position:"absolute"});a.is(".toontalk-side-animating")&&(a.get(0).style.left=f+"px",a.get(0).style.top=b+"px",k.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=""}))};k.restore_resource=function(a,b){var c,d;a&&a.is(".toontalk-top-level-resource")&&(c=b.copy({fresh_copy:!0}),d=c.get_frontside_element(),k.set_css(d,{width:a.width(),height:a.height()}),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),
a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(d).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),a.css({position:"absolute"}),a.get(0).parentElement.appendChild(d),g.DISPLAY_UPDATES.pending_update(c),b.set_active&&(b.set_active(!0),c.set_active(!1)))};k.find_resource_equal_to_widget=function(a){var b;$(".toontalk-top-level-resource.toontalk-side").each(function(c,d){var e=k.widget_from_jquery($(d));if(e&&
(a.equals&&a.equals(e)||a.matching_resource&&a.matching_resource(e)||"matched"===a.match(e))&&(a.is_hole()||e.get_backside_widgets().length===a.get_backside_widgets().length))return b=d,!1});return b};k.set_position_is_absolute=function(a,b,c){var d,e;b?(b=k.get_style_numeric_property(a,"left"),d=k.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===d&&(d=c.pageY-e.top,d-=90)),k.set_css(a,{left:k.left_as_percent(b,a),top:k.top_as_percent(d,
a),position:"absolute"})):a.style.position="static"};k.left_as_percent=function(a,b){var c;if(!b.parentElement)return a;c=b.parentElement.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:k.adjust_left_if_scaled(a,b);return 100*($(b.parentElement).offset().left-window.pageXOffset+a-c.left)/c.width+"%"};k.top_as_percent=function(a,b){var c;if(!b.parentElement)return a;c=b.parentElement.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:k.adjust_top_if_scaled(a,b);return 100*
($(b.parentElement).offset().top+-window.pageYOffset+a-c.top)/c.height+"%"};k.adjust_left_if_scaled=function(a,b){var c=k.widget_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())?a-(d-c.get_attribute("width"))/2:a};k.adjust_top_if_scaled=function(a,b){var c=k.widget_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())?a-(d-c.get_attribute("height"))/2:a};k.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";
case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};k.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};k.give_tooltip=function(a,b){a.title=b;k.use_custom_tooltip(a)};k.use_custom_tooltip=function(a){var b=$(a),c;b.tooltip({position:{my:"center bottom-20",at:"center top",
using:function(a,d){var e;0>a.top&&(a.top=0,e=b.offset(),e.left<$(window).width()/2?a.left=e.left+b.width()+10:(a.left=0,c=e.left-40));"bottom"===d.vertical?(b.is(".toontalk-robot")?a.top-=30:b.is(".toontalk-number")?a.top-=30:b.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);k.set_css(this,a)}},open:function(a,b){var d=b.tooltip.get(0).textContent.length,e=b.tooltip.get(0),
f;e.innerHTML=G(b.tooltip.get(0).textContent.replace(/(\r\n|\n|\r)/g,"<br>"),decodeURIComponent);100<d&&(f=Math.min(800,c||$(window).width()-100),$(e).position(),b.tooltip.css({maxWidth:f}));K&&K.remove();K=b.tooltip;setTimeout(function(){b.tooltip.remove();K=void 0},d*(g.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))},close:function(){K=void 0}})};k.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate'>decodeURIComponent"+a+"decodeURIComponent</span>")};k.remove_encoded_HTML=
function(a){return G(a,function(){return""})};k.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};k.default_animation_speed=.5;k.animate_to_absolute_position=function(a,b,c,d,e,f){var g=$(a).offset(),h=$(a).position(),m=k.distance(b,g);0===f?(k.set_absolute_position($(a),b),c&&c()):($(a).css({"z-index":k.next_z_index()}),f||(f=Math.round(m/(d||k.default_animation_speed))),$(a).addClass("toontalk-side-animating"),
a.style.transitionDuration=f+"ms",m=h.left+(b.left-g.left),g=h.top+(b.top-g.top),a.style.left=m+"px",a.style.top=g+"px",a.toontalk_followed_by&&(b.left+=a.toontalk_followed_by.left_offset,b.top+=a.toontalk_followed_by.top_offset,k.animate_to_absolute_position(a.toontalk_followed_by.element,b,void 0,d,e)),e?setTimeout(c,f):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";c&&c()},f))};k.distance=function(a,b){var c=a.left-b.left,d=a.top-b.top;return Math.sqrt(c*
c+d*d)};k.highlight_element=function(a,b,c){var d;if(a){k.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=k.widget_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){k.remove_highlight(a)},c))}};k.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};k.cursor_of_image=function(a){var b=
a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};k.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};k.constrain_css_to_fit_inside=function(a,b){var c=$(a).width();if(0!==c){var d=$(a).height();b.left=Math.min(Math.max(b.left,0),c);b.top=Math.min(Math.max(b.top,0),d)}};k.next_z_index=function(){d++;return d};k.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b).click(d);k.give_tooltip(a.get(0),c);return a.get(0)};
k.create_close_button=function(a,b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button");$(c).click(a);k.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};k.check_radio_button=function(a){$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};k.create_button_set=function(){var a=document.createElement("div"),b,c;for(b=0;b<arguments.length;b++)if(0<=arguments[b].length)for(c=0;c<arguments[b].length;c++)a.appendChild(arguments[b][c]);
else a.appendChild(arguments[b]);$(a).buttonset();return a};k.create_alert_element=function(a){a=k.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};k.create_text_element=function(a){var b=document.createElement("div");b.innerHTML=a;$(b).addClass("ui-widget");return b};k.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};k.create_anchor_element=function(a,b){var c=document.createElement("a");c.innerHTML=a;g.TRANSLATION_ENABLED&&
(b=k.add_URL_parameter(b,"translate","1"));c.href=b;c.target="_blank";return c};k.create_text_input=function(a,b,c,d,e,f,g){var h=document.createElement("input"),n;h.type="text";h.className=b;h.value=a;k.give_tooltip(h,d);f&&(h.type=f);c?(a=document.createElement("label"),a.innerHTML=c,h.id=k.generate_unique_id(),a.htmlFor=h.id,e&&(n=k.create_anchor_element("i",e),$(n).addClass("toontalk-help-button notranslate"),n.translate=!1),c=k.create_horizontal_table(a,h,n),$(a).addClass("ui-widget")):c=h;$(h).button().addClass("toontalk-text-input").css({"background-color":"white"});
h.addEventListener("touchstart",function(){$(h).select()});g&&m(h,g);k.use_custom_tooltip(h);return{container:c,button:h}};k.create_text_area=function(a,b,c,d,e,f){var g=document.createElement("textarea");g.className=b;g.value=a;k.give_tooltip(g,d);a=document.createElement("label");a.innerHTML=c;g.id=k.generate_unique_id();a.htmlFor=g.id;c=k.create_horizontal_table(a,g);$(g).button().addClass("toontalk-text-area").css({background:"white"});g.addEventListener("touchstart",function(){$(g).select()});
e&&m(g,e);$(a).addClass("ui-widget");k.use_custom_tooltip(g);return{container:c,button:g}};k.input_area_drop_handler=function(a,b,c){var d,e;a.preventDefault();(d=t(a))&&d!==c&&(e=b(d,a))&&($(a.currentTarget).trigger("change"),a.currentTarget.value=e,d.remove(),a.stopPropagation());return"string"===typeof e&&d};k.create_radio_button=function(a,b,c,d,e){var f=document.createElement("div"),g=document.createElement("input"),h=document.createElement("label");g.type="radio";g.className=c;g.name=a;g.value=
b;h.innerHTML=d;g.id=k.generate_unique_id();h.htmlFor=g.id;f.appendChild(g);f.appendChild(h);k.give_tooltip(f,e);$(g).button();k.use_custom_tooltip(g);return{container:f,button:g,label:h}};k.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),h=document.createElement("select"),m=document.createElement("label");h.className=c;h.name=a;h.id=k.generate_unique_id();m.innerHTML=d;m.htmlFor=h.id;g.appendChild(m);g.appendChild(h);k.give_tooltip(g,e);b.forEach(function(a,b){var c=
document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&(k.give_tooltip(c,f[b]),k.use_custom_tooltip(c));h.appendChild(c)});$(h).addClass("ui-widget");$(m).addClass("ui-widget");k.use_custom_tooltip(h);return{container:g,menu:h,label:m}};k.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b;f.checked=a;g.innerHTML=c;f.id=k.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");
e.appendChild(f);e.appendChild(g);k.give_tooltip(e,d);k.use_custom_tooltip(f);return{container:e,button:f,label:g}};k.create_horizontal_table=function(){var a=document.createElement("table"),b,c,d;c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),d.appendChild(arguments[b]));return a};k.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=
k.create_row(arguments[b]),a.appendChild(c));return a};k.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)a.appendChild(arguments[c]);b.appendChild(a);return a};k.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};k.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if(arguments[a].checked)return arguments[a]};k.create_image=function(a,b){var c=document.createElement("img"),
d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+a},c.addEventListener("error",d));return c};k.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?
(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};k.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');a&&b.addClass(a);return b.get(0)};k.become_file_data_table=function(a,b,c,d){$(a).DataTable({data:b,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,
b,e,f){a=c?a.substring(0,a.length-5):a;b=c?g.google_drive.google_drive_url(e.id):"Click to load this program.";if(d)return"<div class='"+d+"' title='"+b+"'id='"+e.id+"'>"+a+"</div>";g.TRANSLATION_ENABLED&&(b=k.add_URL_parameter(b,"translate","1"));return"<a href='"+b+"'target='_blank' title='Click to open published page.'>"+a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},
{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};k.get_local_files_data=function(){return k.get_all_locally_stored_program_names().map(function(a){var b=k.get_local_storage_meta_data(a);if(b)return{title:a,modifiedDate:b.last_modified,createdDate:b.created,fileSize:b.file_size}})};k.create_local_files_table=function(){var a=k.get_local_files_data(),b=k.create_file_data_table();setTimeout(function(){k.become_file_data_table(b,a,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});
return b};k.get_dragee=function(){return a};k.add_URL_parameter=function(a,b,c){a=k.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?"&":"?";return a+d+b+"="+c};k.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};k.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||
0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};k.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};k.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};k.backup_all_top_level_widgets=function(a){$(".toontalk-top-level-backside").each(function(b,
c){k.widget_of_element(c).save(a)})};k.make_resizable=function(a,b){var c,d;a.resizable({start:function(a,b){c=b.originalSize.width;d=b.originalSize.height},resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},
handles:"n,e,s,w"})};k.match=function(a,b){var c=a.match(b);return c.is_widget&&b.matched_by?b.matched_by(a):c};k.current_URL=function(){return window.location.pathname};k.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};k.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&k.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};k.copy_frontside_dimensions=function(a,b){var c=a.get_widget().get_frontside_element(),
d;c&&(d=b.get_frontside_element(!0))&&k.set_css(d,{width:$(c).width(),height:$(c).height()})};k.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?k.scale_element(a,c,d,c,d):k.scale_element(a,$(b).width(),$(b).height(),c,d)};k.scale_element=function(a,b,c,d,e,f,g,h){var m,n;d||(d=$(a).width());e||(e=$(a).height());m=b?b/d:1;n=c?c/e:1;0===m&&(m=1);0===n&&(n=1);var p=!0;h=(h=h&&h!==document.body?h:a.parentElement)&&0>h.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");
var q="";g||(g={});"number"===typeof g.left&&(g.left-=(d-b)/2,p=!1);"number"===typeof g.top&&(g.top-=(e-c)/2,p=!1);p&&h&&(b&&(q+="translateX("+(b-d)/2+"px) "),c&&(q+="translateY("+(c-e)/2+"px) "));k.add_transform_to_css((f||"")+" scale("+m+", "+n+")",q,g,h);g.width=d;g.height=e;k.set_css(a,g);return{x_scale:m,y_scale:n}};k.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),k.set_css_transform(c,b+a))};k.set_css_transform=
function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};k.run_when_dimensions_known=function(a,b,c){var d=a.parentElement,e=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")},f;!c&&$(a).width()&&e(d)?setTimeout(function(){b(d)}):(f=function(c){setTimeout(function(){var g=$(a).width(),h=$(a).height();g&&h?e(a.parentElement)?(b(d),d?d.appendChild(a):a.parentElement===document.body&&$(a).remove(),$(a).removeClass("toontalk-not-observable")):
k.run_when_dimensions_known(a,b,!0):setTimeout(function(){k.widget_of_element(a);1E4>c&&f(2*c)},c)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),c&&k.set_css(a,{width:"",height:"",transform:""}),f(1))};k.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&k.run_when_dimensions_known(d,function(){b($(d).width(),$(d).height())},c)};k.relative_position=function(a,b){var c=$(a).offset(),d;b&&(d=$(b).offset(),c.left-=d.left,c.top-=
d.top);return c};k.add_animation_class=function(a,b){k.set_css(a,{width:"",height:""});$(a).addClass(b)};k.widget_from_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget};k.widget_of_element=function(a){return a.toontalk_widget};k.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};k.display_message_if_new=function(a){0>E.indexOf(a)&&(k.display_message(a),
E.push(a))};k.display_message=function(a){var b=k.create_alert_element(a);$(".toontalk-alert-element").remove();console.log(a);console.trace();document.body.insertBefore(b,document.body.firstChild);setTimeout(function(){$(b).remove()},Math.max(2E3,a.length*(g.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)))};k.display_tooltip=function(a){k.use_custom_tooltip(a.get(0));a.tooltip("open")};k.report_internal_error=function(a){console.log(a);console.trace();g.debugging&&k.display_message("Error: "+a)};k.get_current_url_boolean_parameter=
function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};k.get_current_url_numeric_parameter=function(a,b){var c=k.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};k.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>d&&(d=window.location.href.length);return window.location.href.substring(c,
d)};k.get_path_to_toontalk_folder=function(){var a;if("string"===typeof e)return e;e="";a=window.location.href.indexOf("/ToonTalk/");if(0>a)return e;for(a+=9;;){a=window.location.href.indexOf("/",a+1);if(0>a)return e;e+="../"}};k.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};k.is_internet_explorer=function(){return k.is_browser_of_type("MSIE")||k.is_browser_of_type("Trident")};k.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};k.subtract_position=
function(a,b){return{left:a.left-b.left,top:a.top-b.top}};k.remove_z_index=function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$(a);a.attr("z-index","");return a.html()};k.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b;if(0!==a.length){a.button();b=a.get(0);b.innerHTML="Run all tests";var c=!1;a.click(function(a){c?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),b.innerHTML="Run all tests",
k.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),b.innerHTML="Stop all tests");c=!c})}};k.set_timeout=function(a,b){b?setTimeout(a,b):(z.push(a),window.postMessage("zero-timeout-message","*"))};k.get_first_property=function(a){return Object.keys(a)[0]};k.get_all_locally_stored_program_names=function(){var a=window.localStorage.getItem("toontalk-all-program-names");return a?JSON.parse(a):[]};k.set_all_locally_stored_program_names=
function(a){window.localStorage.setItem("toontalk-all-program-names",JSON.stringify(a))};k.get_local_storage_meta_data=function(a){a=k.local_storage_program_meta_data_key(a);var b;try{if(b=window.localStorage.getItem(a))return JSON.parse(b)}catch(c){}};k.local_storage_program_key=function(a){return"toontalk-json: "+a};k.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};k.enable_editor=function(a,b,c,d){(function(a,b){var c=function(a){a.data.editor_enabled_for&&a.data.editor_enabled_for===
b&&(e=!0,window.removeEventListener("message",c))},d=function(a,b){e||setTimeout(function(){a();d(a,b)},500)},e=!1;window.addEventListener("message",c);d(a,b)})(function(){a.postMessage({save_edits_to:window.location.href,file_id:c,widgets_json:d},"*")},c)};k.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};k.enable_touch_events=function(a,b){var c=a,d=function(b){var d;b.stopPropagation();b.preventDefault();e?(e=!1,f(b,a),d=k.widget_of_element(a),g.logging&&0===
g.logging.indexOf("touch")&&(g.debugging+="\ndrag ended"),d&&(p(b,a),g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ndrop happened")),g.logging&&0===g.logging.indexOf("touch")&&(alert(g.debugging),g.debugging="touch")):h=!0;a=c},e=!1,h=!1,m=0,q=0,t;a.addEventListener("touchstart",function(c){g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch start");c.preventDefault();"TEXTAREA"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||$(c.srcElement).is(".ui-resizable-handle")?
g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch start ignored due to tag name or class"):(c.stopPropagation(),k.set_timeout(function(){var b=c.changedTouches[0],d,f,p;h?(h=!1,d=document.createEvent("MouseEvent"),d.initMouseEvent("click",!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(d),g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch end treated as click",alert(g.debugging),g.debugging="touch")):(e=!0,(d=k.widget_of_element(a))&&
d.get_infinite_stack()?(f=d.copy(),d.add_copy_to_container(f,0,0),d.set_infinite_stack(!1),f.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(f=d.copy(),d.add_copy_to_container(f,0,0),p=$(a).offset(),a=f.get_frontside_element(!0)),p||(p=$(a).offset()),n(c,a),m=b.clientX-p.left,q=b.clientY-p.top,g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ndrag started"))},b))},!0);a.addEventListener("touchmove",function(b){var c;b.preventDefault();if(e){c=b.changedTouches[0];k.set_absolute_position($(a),
{left:c.pageX-m,top:c.pageY-q});b=k.find_widget_on_page(c,a,0,0);if(t&&t!==b){var d=t.get_frontside_element();k.remove_highlight(d);t=void 0}b&&(r(c,b.get_frontside_element()),t=b);g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ndragged to "+(c.pageX-m)+", "+(c.pageY-q))}else g.logging&&0===g.logging.indexOf("touch")&&(g.debugging+="\ntouch move ignored since drag_started not yet set. "+Date.now())},!0);a.addEventListener("touchend",d,!0);a.addEventListener("touchcancel",d,!0)};k.get_mouse_or_first_touch_event_attribute=
function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};k.find_widget_on_page=function(a,b,c,d){var e=k.get_mouse_or_first_touch_event_attribute("pageX",a);a=k.get_mouse_or_first_touch_event_attribute("pageY",a);var f;$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for($(b).show();c&&!c.toontalk_widget&&(!$(c).is(".toontalk-backside")||$(c).is(".toontalk-top-level-backside"));)c=c.parentNode;c&&(f=c.toontalk_widget);if(f)return f&&f.get_contents&&
f.get_contents()&&(f=f.get_contents()),b=f.get_type_name(),f&&"empty hole"===b?f.get_parent_of_frontside():f};k.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-top-level-backside").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return k.widget_of_element(c)};k.set_css=function(a,b){var c;b&&((c=k.widget_of_element(a))&&c.location_constrained_by_container()&&(b.left="",b.top=""),!b.transform&&void 0!==
b.width&&void 0!==b.height&&c&&c.use_scaling_transform?c.use_scaling_transform(b):$(a).css(b))};k.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};k.conjunction=function(a,b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?k.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};k.insert_function_bird_documentation=function(a){var b=TOONTALK[a]["function"],c=Object.keys(b),d="<table class='toontalk-function-bird-documentation-table'>";
c.forEach(function(a,c){d+="<tr><td><div id='bird_id_"+c+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+b[a].title+"</td></tr>"});d+="</table>";document.write(d);c.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e.id=encodeURIComponent(b)})};k.rerender_all=function(){$(".toontalk-side").each(function(a,
b){var c=k.widget_of_element(b);c&&c.rerender()})};k.visible_element=function(a){a=$(a);return a.is(":visible")&&"0"!==a.css("opacity")};k.create_queue=function(){var a=[],b=0;return{getLength:function(){return a.length-b},isEmpty:function(){return 0==a.length},enqueue:function(b){a.push(b)},dequeue:function(){var c;if(0!=a.length)return c=a[b],2*++b>=a.length&&(a=a.slice(b),b=0),c},peek:function(){return 0<a.length?a[b]:void 0},does_any_item_satisfy:function(c){var d;for(d=b;d<a.length;d++)if(c(a[d]))return!0;
return!1}}};return k}(window.TOONTALK);
