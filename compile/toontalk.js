'use strict';window.TOONTALK.copy=function(b){return{create:function(a){var d=Object.create(this);a||console.log("path undefined in copy action");d.path=a;return d},run:function(a){a=b.UTILITIES.dereference_path(this.path,a);if(!a)return!1;this.robot.set_thing_in_hand(a.copy(!0));return!0},toString:function(){return"copy "+this.path.toString()},get_json:function(){return{type:"copy_action",path:this.path.get_json()}},create_from_json:function(a){return b.copy.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.copy_constant=function(b){return{create:function(a){var d=Object.create(this);d.constant_object=a;return d},run:function(a){this.robot.set_thing_in_hand(this.constant_object.copy(!0));return!0},toString:function(){return"copy "+this.constant_object.toString()},get_json:function(){return{type:"copy_constant_action",constant_object:this.constant_object.get_json()}},create_from_json:function(a){return b.copy_constant.create(b.UTILITIES.create_from_json(a.constant_object))}}}(window.TOONTALK);window.TOONTALK.drop_on=function(b){return{create:function(a){var d=Object.create(this);d.path=a;return d},run:function(a){a=b.UTILITIES.dereference_path(this.path,a);var d;if(a){if(d=this.robot.get_thing_in_hand()){if(d.drop_on)d.drop_on(a);else return console.log("Thing in robot's hand doesn't handle 'drop_on': "+d.toString()+". Robot that "+this.robot.toString()),!1;return!0}console.log("The robot that "+this.robot.toString()+" is executing drop_on but has nothing in its hand.")}return!1},toString:function(){return"drop it on "+
this.path.toString()},get_json:function(){return{type:"drop_on_action",path:this.path.get_json()}},create_from_json:function(a){return b.drop_on.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.pick_up=function(b){return{create:function(a){var d=Object.create(this);d.path=a;return d},run:function(a){a=b.UTILITIES.dereference_path(this.path,a);if(!a)return!1;this.robot.set_thing_in_hand(a);return!0},toString:function(){return"pick up "+this.path.toString()},get_json:function(){return{type:"pick_up_action",path:this.path.get_json()}},create_from_json:function(a){return b.pick_up.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.pick_up_constant=function(b){return{create:function(a){var d=Object.create(this);d.constant_object=a;return d},run:function(a){this.robot.set_thing_in_hand(this.constant_object);return!0},toString:function(){return"pick up "+this.constant_object.toString()},get_json:function(){return{type:"pick_up_constant_action",object:this.constant_object.get_json()}},create_from_json:function(a){return b.pick_up_constant.create(b.UTILITIES.create_from_json(a.object))}}}(window.TOONTALK);window.TOONTALK.widget=function(b){return{erasable:function(a){var d;a.get_erased=function(){return d};a.set_erased=function(a,e){d=a;e&&this.update_display()};return a},add_sides_functionality:function(a){var d,f;a.get_frontside=function(e){e&&!d&&(d=b.frontside.create(a));return d};a.get_backside=function(e){e&&!f&&(f=a.create_backside());return f};a.forget_backside=function(){var a=this.get_backside_widgets();a&&(this.backside_widgets=a);f=void 0};return a},remove:function(){var a=this.get_backside(),
d=this.get_frontside();a&&a.remove();d&&d.remove()},get_frontside_element:function(a){var d=this.get_frontside&&this.get_frontside(!0);if(d)return a&&this.update_display(),d.get_element()},dereference:function(){return this},add_to_json:function(a){var d;if(a){this.get_erased()&&(a.erased=!0);if(d=this.get_frontside_element&&this.get_frontside_element())a.width=$(d).width(),a.height=$(d).height();d=this.get_backside_widgets();0<d.length&&(a.backside_widgets=b.UTILITIES.get_json_of_array(d));return a}console.log("get_json not defined");
return{}},get_backside_widgets:function(){var a=this.get_backside();return a?a.get_widgets():this.backside_widgets?this.backside_widgets:[]},set_backside_widgets:function(a){this.backside_widgets=a},add_to_copy:function(a){var d=this.get_backside_widgets();this.get_erased()&&a.set_erased(this.get_erased());0<d.length&&a.set_backside_widgets(b.UTILITIES.copy_widgets(d));return a},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},visible:function(){var a=
this.get_frontside();return a?$(a.get_element()).is(":visible"):!1},drag_started:function(a,d){b.robot.in_training&&b.robot.in_training.picked_up(this,a,d)},widget_dropped_on_me:function(){b.robot.in_training&&b.robot.in_training.dropped_on(this)},equals:function(a){console.assert(!1,"equals not implemented")},match:function(a){console.assert(!1,"copy not implemented")},drop_on:function(a,d,f){console.log("drop_on not implemented; this is "+this.toString()+" and other is "+a.toString());return!1},
removed:function(a){console.log("removed not implemented")},update_display:function(){console.assert(!1,"update_display not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},match_box:function(){return"not matched"},match_number:function(){return"not matched"}}}(window.TOONTALK);window.TOONTALK.backside=function(b){return{create:function(a){var d=Object.create(this),f=document.createElement("div"),e=$(f),k,n,p;e.addClass("toontalk-backside toontalk-side");d.get_element=function(){return f};d.get_widget=function(){return a};a.get_backside||(a.get_backside=function(){return d});a.drop_on||(a.drop_on=function(c,a,d){e.append(a);b.UTILITIES.set_position_absolute(a.get(0),!0,d);a.is(".toontalk-frontside")&&(a.addClass("toontalk-frontside-on-backside"),c.update_display());return!0});
a.removed||(a.removed=function(c,a,e){a.removeClass("toontalk-frontside-on-backside")});d.widget_dropped_on_me=function(c,a){var d=c.get_frontside(!0).get_element(),n=$(d);e.append(n);b.UTILITIES.set_position_absolute(d,!0,a);n.data("owner").update_display();return!0};b.backside.associate_widget_with_backside_element(a,d,f);b.UTILITIES.drag_and_drop(e,a);e.resizable({start:function(){k||(k=e.width());n||(n=e.height())},resize:function(c,a){var d=100*Math.min(1,e.width()/k,e.height()/n);e.css({"font-size":d+
"%"})},handles:"n,e,s,w,se,ne,sw,nw"});$(f).on("DOMNodeInserted",function(c){var a=$(c.originalEvent.srcElement);a.is(".toontalk-frontside")&&a.parent().is(".toontalk-backside")&&(a.addClass("toontalk-frontside-on-backside"),a.is(".ui-resizable")&&a.resizable("enable"),(a=a.data("owner"))&&a.update_display());c.stopPropagation()});$(f).on("DOMNodeRemoved",function(c){var a=$(c.originalEvent.srcElement);a.is(".toontalk-frontside")&&a.removeClass("toontalk-frontside-on-backside");c.stopPropagation()});
a.get_backside_widgets&&(p=a.get_backside_widgets(),setTimeout(function(){var a,e;for(a=0;a<p.length;a++)e=p[a].get_frontside_element(!0),$(e).data("owner",p[a]),$(f).append(e)},1));return d},associate_widget_with_backside_element:function(a,d,f){$(f).data("owner",a);return a},remove:function(){$(this.get_element()).remove()},create_standard_buttons:function(a,d){var f;f=d.get_frontside_element();f=d.get_erased()||$(f).is(".toontalk-thought-bubble-contents")||0!==$(f).parents(".toontalk-thought-bubble-contents").length?
b.backside.create_erase_button(a,d):b.backside.create_run_button(a,d);var e=b.backside.create_copy_button(a,d),k=b.backside.create_hide_button(a,d),n=b.backside.create_remove_button(a,d),p=[],c;for(c=2;c<arguments.length;c++)p[c-2]=arguments[c];return b.UTILITIES.create_button_set(f,e,n,k,p)},create_hide_button:function(a,d){var f=a.get_element(),e=$(f),f=$("<button>Hide</button>").button();f.addClass("toontalk-hide-backside-button");f.click(function(){d&&d.forget_backside&&d.forget_backside();e.remove()});
f.attr("title","Click to hide this.");return f.get(0)},create_erase_button:function(a,d){var f=a.get_element();$(f);var e=$("<button>Erase</button>").button();e.addClass("toontalk-erase-backside-button");var k=function(){d.get_erased()?(e.button("option","label","Un-erase"),e.attr("title","Click to restore this to how it was before it was erased.")):(e.button("option","label","Erase"),e.attr("title","Click to erase this so the robot won't be so fussy."))};k();e.click(function(){d.set_erased(!d.get_erased(),
!0);k()});e.attr("title","Click to hide this.");return e.get(0)},create_copy_button:function(a,d){var f=a.get_element();$(f);f=$("<button>Copy</button>").button();f.addClass("toontalk-copy-backside-button");f.click(function(){var a=d.copy(),k=d.get_frontside_element(),n=a.get_frontside_element(),f=$(k).position();$(n).css({width:$(k).width(),height:$(k).height(),left:f.left+10,top:f.top+10});$(k).parent().append(n);b.robot.in_training&&b.robot.in_training.copied(d,a)});f.attr("title","Click to make a copy of this "+
d.get_type_name());return f.get(0)},create_run_button:function(a,d){var f=a.get_element(),e=$(f),k=$("<button>Run</button>").button(),n=!0,b;k.addClass("toontalk-run-backside-button");k.click(function(){e.children(".toontalk-robot").each(function(a,e){if(b=$(e).data("owner"))n?(b.set_stopped(!1),b.run(d)):b.set_stopped(!0)});n?(k.button("option","label","Stop"),k.attr("title","Click to stop running the robots on this "+d.get_type_name())):(k.button("option","label","Run"),k.attr("title","Click to run the robots on this "+
d.get_type_name()));n=!n});k.attr("title","Click to run the robots on this "+d.get_type_name());return k.get(0)},create_remove_button:function(a,d){var f=$("<button>Remove</button>").button();f.addClass("toontalk-remove-backside-button");f.click(function(){d&&d.remove&&d.remove()});f.attr("title","Click to remove this "+d.get_type_name());return f.get(0)},get_widgets:function(){var a=[];$(this.get_element()).children().each(function(d,f){var e=$(f).data("owner");e&&(a[a.length]=e)});return a}}}(window.TOONTALK);window.TOONTALK.condition=function(b){return{create:function(a){var d=Object.create(this);d.items=a;return d},copy:function(){return this.create(this.items)},match:function(a){return this.items.match(a)}}}(window.TOONTALK);window.TOONTALK.frontside=function(b){return{create:function(a){var d=Object.create(this),f=document.createElement("div"),e=$(f);$(f).addClass("toontalk-frontside toontalk-side");e.data("owner",a);b.UTILITIES.drag_and_drop(e,a);d.get_element=function(){return f};d.get_widget=function(){return a};e.click(function(e){var d=a.get_backside(),b,c;if(!$(e.target).is(".ui-resizable-handle")&&!d&&(b=$(f).parent(),c=$(f),!c.is(".toontalk-top-level-resource"))){for(;0<b.length&&!b.is(".toontalk-backside");)c=
b,b=b.parent();c=c.get(0);d=a.get_backside(!0);d=d.get_element();$(d).data("owner",a);$(d).css({left:c.offsetLeft+c.offsetWidth,top:c.offsetTop});b.append(d);e.stopPropagation()}});return d},update_display:function(){return this.get_widget().update_display()},remove:function(){$(this.get_element()).remove()}}}(window.TOONTALK);window.TOONTALK.number=function(b){var a=Object.create(b.widget),d=function(a,e,c){var d="",k=100;e=(e-1)/e;if(c)for(c=0;1<=k&&c<a.length;)d=d+"<span class='toontalk-digit' style='font-size:"+k+"%'>"+a[c]+"</span>",c+=1,"-"!==a[c]&&(k*=e);else for(c=a.length-1;1<=k&&0<c;)d="<span class='toontalk-digit' style='font-size:"+k+"%'>"+a[c]+"</span>"+d,c-=1,"-"!==a[c]&&(k*=e);return d},f=function(a,e){if(a.length<=Math.round(e))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>
e)return"";if(5>e)return"<span style='font-size: 80%'>"+f(a,1.25*e)+"</span>";var c=e/2;return d(a,c,!0)+d(a,c,!1)},e=function(a,e){e||(e=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof e&&"string"!==typeof e))return bigrat.fromValues(a,e);var c=bigrat.create();1===e?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&e.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(e.get_value())):bigrat.set(c,a,e);return c},k=function(a){switch(a){case "+":return"";
case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "^":return"^";default:return console.log("Number has an unsupported operator: "+a),""}};a.create=function(d,k,c,f){var r=Object.create(a),g=e(d,k);f||(f="improper_fraction");c||(c="+");r.set_value=function(a,l){var h,c;g=a;l?this.update_display():(h=this.get_frontside(),c=this.get_backside(),h&&b.DISPLAY_UPDATES.add_dirty_side(h),c&&b.DISPLAY_UPDATES.add_dirty_side(c));b.debugging&&(this.debug_string=this.toString());
return this};r.get_value=function(){return g};r.set_format=function(a,l){f=a;l&&this.update_display();return this};r.get_operator=function(){return c};r.set_operator=function(a,l){c=a;l&&this.update_display();return this};r.get_format=function(){return f};r=a.add_sides_functionality(r);return r=a.erasable(r)};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,d,c){return this.set_value(e(a,d),c)};a.ONE=function(){return this.create(1)};a.ZERO=function(){return this.create(0)};
a.copy=function(e){var d=a.create(this.get_value()[0],this.get_value()[1],this.get_operator(),this.get_format());return e?d:this.add_to_copy(d)};a.is_number=function(){return!0};a.equals=function(a){return a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.update_display=function(){var a=this.get_frontside();if(a){var a=a.get_element(),e;e=$(a).is(".toontalk-thought-bubble-contents")?$(a):$(a).parent().is(".toontalk-backside")?$(a):$(a).parent();
var c=e.width();e=0.8*e.height();c=this.to_HTML(c/(0.64*e),e,this.get_format(),!0,this.get_operator());a.firstChild||a.appendChild(document.createElement("div"));a.firstChild.innerHTML=c;$(a.firstChild).addClass("toontalk-widget")}};a.to_HTML=function(a,e,c,d,b){var g=!1!==d?" toontalk-top-level-number":"";b=b?k(b):"";a||(a=4);e||(e=16);if(this.get_erased())return'<div class="toontalk-number toontalk-integer'+g+'" style="font-size: '+e+'px;"></div>';0<b.length&&(a-=1);if(this.is_integer())return d=
bigrat.toBigInteger(this.get_value()).toString(),4>a&&4<=d.length&&(e*=a/4,a=4),'<div class="toontalk-number toontalk-integer'+g+'" style="font-size: '+e+'px;">'+b+f(d,a)+"</div>";if("improper_fraction"===c||!c)return a='<table class="toontalk-number toontalk-improper-fraction'+g+'" style="font-size: '+0.5*e+'px;"><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+f(this.numerator_string(),2*a)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><hr class="toontalk-fraction-line"></td></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+
f(this.denominator_string(),2*a)+"</td></tr></table>",""===b?a:"<table class='toontalk-operator-and-fraction'><tr><td>"+b+"</td><td>"+a+"</td></tr></table>";if("proper_fraction"===c){b=this.integer_part();if(b.is_zero())return this.to_HTML(a,e,"improper_fraction",d);d=this.copy().subtract(b).absolute_value();return'<table class="toontalk-number toontalk-proper_fraction'+g+'" style="font-size: '+0.5*e+'px;"><tr><td class="toontalk-number toontalk-integer-part-of-proper-fraction">'+b.to_HTML(a,e,"",
!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-proper_fraction">'+d.to_HTML(a,e,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===c)return 4>a&&(e*=a/4,a=4),'<div class="toontalk-number toontalk-decimal'+g+'" style="font-size: '+e+'px;">'+b+this.decimal_string(a,e)+"</div>"};a.drop_on=function(a,e,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,c),c&&a.update_display(),this.remove(),!0;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,
c);console.log("No handler for drop of "+this.toString()+" on "+a.toString())};a.number_dropped_on_me=function(a,e,c,d){switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "^":return this.power(a);default:return console.log("Number received a number with unsupported operator: "+a.get_operator()),this}};a.add=function(a){this.set_value(bigrat.add(bigrat.create(),this.get_value(),a.get_value()));return this};
a.subtract=function(a){this.set_value(bigrat.subtract(bigrat.create(),this.get_value(),a.get_value()));return this};a.multiply=function(a){this.set_value(bigrat.multiply(bigrat.create(),this.get_value(),a.get_value()));return this};a.divide=function(a){this.set_value(bigrat.divide(bigrat.create(),this.get_value(),a.get_value()));return this};a.power=function(a){this.set_value(bigrat.power(bigrat.create(),this.get_value(),bigrat.toInteger(a.get_value())));return this};a.absolute_value=function(){this.set_value(bigrat.abs(bigrat.create(),
this.get_value()));return this};a.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(){return("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};a.get_type_name=function(){return"number"};a.get_json=function(){return this.add_to_json({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string(),format:this.get_format()})};
a.create_from_json=function(e){return a.create(e.numerator,e.denominator,e.operator,e.format)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};
a.integer_part=function(){return this.create(this)};a.decimal_string=function(a,e){if(this.is_integer())return this.numerator_string();var c=this.copy(),k=c.integer_part(),b=k.toString();"0"===b&&this.is_negative()&&(b="-"+b);var g=c.subtract(k),c=Math.min(b.length,a/2),k=a-(c+0.5),q;a:{var l;q=k*e/20;var h="";l=g.absolute_value();g=l.get_value()[0];l=l.get_value()[1];for(var u=new BigInteger(10);q>h.length;)if(g=g.multiply(u),0>g.compare(l))h+="0";else if(h+=g.divide(l).toString(),g=g.remainder(l).multiply(u),
g.isZero()){q=h;break a}q=h}q.length<k&&(c=a-q.length,k=q.length);return f(b,c,e)+"<span class='toontalk-decimal-point' style='font-family: serif'>.</span>"+d(q,k,!0)};a.match=function(a){return this.get_erased()?a.match_with_any_number():a.match_with_this_number(this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){return a.equals(this)?"matched":"not matched"};return a}(window.TOONTALK);
window.TOONTALK.number_backside=function(b){return{create:function(a){var d=b.backside.create(a),f=d.get_element(),e=b.UTILITIES.create_text_input(a.numerator_string(),"toontalk-numerator-input","","Type here to edit the numerator"),k=document.createElement("div");k.innerHTML="/";$(k).addClass("ui-widget");var n=b.UTILITIES.create_text_input(a.denominator_string(),"toontalk-denominator-input","","Type here to edit the denominator"),p=b.UTILITIES.create_radio_button("number_format","decimal","Decimal",
"Display number as a decimal."),c=b.UTILITIES.create_radio_button("number_format","proper_fraction","Proper fraction","Display number as a proper fraction with an integer part and a fraction."),m=b.UTILITIES.create_radio_button("number_format","improper_fraction","Improper fraction","Display number as a simple fraction."),r=b.UTILITIES.create_radio_button("operator","+","+","Add me to what I'm dropped on."),g=b.UTILITIES.create_radio_button("operator","-","&minus;","Subtract me from what I'm dropped on."),
q=b.UTILITIES.create_radio_button("operator","*","&times;","Multiply me with what I'm dropped on."),l=b.UTILITIES.create_radio_button("operator","/","&divide;","Divide me into what I'm dropped on."),h=b.UTILITIES.create_radio_button("operator","^","Integer power","Use me as the number of times to multiply together what I'm dropped on."),u=function(){a.set_from_values(e.button.value.trim(),n.button.value.trim(),!0)},t=function(){a.set_format(b.UTILITIES.selected_radio_button(p.button,c.button,m.button).value,
!0)},s=function(){a.set_operator(b.UTILITIES.selected_radio_button(r.button,g.button,q.button,l.button,h.button).value,!0)},k=b.UTILITIES.create_horizontal_table(e.container,k,n.container),v=$(b.UTILITIES.create_horizontal_table(p.container,c.container,m.container)).buttonset().get(0),w=$(b.UTILITIES.create_horizontal_table(r.container,g.container,q.container,l.container,h.container)).buttonset().get(0),x=b.backside.create_standard_buttons(d,a);f.appendChild(k);f.appendChild(v);f.appendChild(w);f.appendChild(x);
e.button.onchange=u;n.button.onchange=u;p.button.onchange=t;c.button.onchange=t;m.button.onchange=t;switch(a.get_format()){case "decimal":b.UTILITIES.check_radio_button(p);break;case "improper_fraction":b.UTILITIES.check_radio_button(m);break;case "proper_fraction":b.UTILITIES.check_radio_button(c)}switch(a.get_operator()){case "+":b.UTILITIES.check_radio_button(r);break;case "-":b.UTILITIES.check_radio_button(g);break;case "*":b.UTILITIES.check_radio_button(q);break;case "/":b.UTILITIES.check_radio_button(l);
break;case "^":b.UTILITIES.check_radio_button(h)}r.button.onchange=s;g.button.onchange=s;q.button.onchange=s;l.button.onchange=s;h.button.onchange=s;d.update_display=function(){var l=this.get_widget();$(e.button).val(l.numerator_string());$(n.button).val(l.denominator_string())};return d}}}(window.TOONTALK);window.TOONTALK.box=function(b){var a=Object.create(b.widget);a.create=function(d,f,e){var k=Object.create(a);e||(e=[]);f||(f=!0);k.get_size=function(){return d};k.set_size=function(a,k){d=a;e.length=d;k&&this.update_display();b.debugging&&(this.debug_string=this.toString());return this};k.get_horizontal=function(){return f};k.set_horizontal=function(a,e){f=a;e&&this.update_display();return this};k.get_hole=function(a){return e[a]};k.set_hole=function(a,d,c){e[a]=d;c&&this.update_hole_display(a);
b.debugging&&(this.debug_string=this.toString())};k=k.add_sides_functionality(k);return k=k.erasable(k)};a.copy=function(d){var f=a.create(this.get_size(),this.get_horizontal()),e=this.get_size(),k,b;for(k=0;k<e;k+=1)(b=this.get_hole(k))&&f.set_hole(k,b.copy(f));return d?f:this.add_to_copy(f)};a.create_backside=function(){return b.box_backside.create(this)};a.equals=function(a){return a.equals_box(this)};a.equals_box=function(a){var f=this.get_size(),e,k,b;if(f!==a.get_size())return!1;for(e=0;e<f;e+=
1)if(k=this.get_hole(e),b=a.get_hole(e),!k&&b||k&&!b||k&&b&&!k.equals(b))return!1;return!0};a.match=function(a){return this.get_erased()?a.match_with_any_box?a.match_with_any_box():"not matched":a.match_with_this_box(this)};a.match_with_any_box=function(){return"matched"};a.match_with_this_box=function(a){var f=this.get_size(),e=[],k,b,p;if(f!==a.get_size())return"not matched";for(k=0;k<f;k+=1)if(p=a.get_hole(k)){b=this.get_hole(k);if(!b)return"not matched";b=p.match(b);if("not matched"===b)return"not matched";
"matched"!==b&&(e=0===e.length?b:e.concat(b))}return 0<e.length?e:"matched"};a.toString=function(){var a="",b=this.get_size(),e,k;for(e=0;e<b;e+=1)a=(k=this.get_hole(e))?a+k.toString():a+"_",e<b-1&&(a+=" | ");return"["+a+"]"};a.get_type_name=function(){return"box"};a.get_json=function(){var a=[],b=this.get_size(),e;for(e=0;e<b;e+=1)this.get_hole(e)&&(a[e]=this.get_hole(e).get_json());return this.add_to_json({type:"box",contents:a,horizontal:this.get_horizontal()})};a.create_from_json=function(d){return a.create(d.contents.length,
d.horizontal,b.UTILITIES.create_array_from_json(d.contents))};a.to_HTML=function(){var a=this.get_horizontal(),b=a?"horizontal":"vertical",e="<table class='toontalk-box toontalk-box-"+b+"'>",k=this.get_size(),n;n=0===k?1:100/k;var p=a?" style='width:"+n+"%;'":"",c=a?"":" style='height:"+n+"%;'",m=this.get_erased(),e=e+("<tr"+c+">");for(n=0;n<k;n+=1)e+="<td class='toontalk-box-hole toontalk-box-hole-"+b+"'"+p+">",m||(e+="<div class='toontalk-hole-about-to-be-replaced' />"),e+="</td>",a||(e+="</tr>",
n+1<k&&(e+="<tr"+c+">"));a&&(e+="</tr>");return e+"</table>"};a.update_display=function(){if(this.visible()){var a=this.get_frontside().get_element(),b=this.to_HTML(),e=this;a.firstChild||a.appendChild(document.createElement("div"));a.firstChild.innerHTML=b;$(a.firstChild).addClass("toontalk-widget");$(".toontalk-hole-about-to-be-replaced").each(function(a,d){e.update_hole_display(a,d)})}};a.update_hole_display=function(a,f){if(this.visible()){var e=this.get_hole(a),k;e||(e=b.box_empty_hole.create(a,
this),this.set_hole(a,e));k=e.get_frontside(!0);f&&f.parentNode?(e=k.get_element(),f.parentNode.replaceChild(e,f),b.UTILITIES.set_position_absolute(e,!1),$(e).addClass("toontalk-frontside-in-box")):(f=e.get_frontside(!0).get_element(),e=this.get_frontside(),e=$(e.get_element()).find(".toontalk-box-hole").eq(a),e.append(f),b.UTILITIES.set_position_absolute(f,!1),$(f).is(".toontalk-empty-hole")||$(f).addClass("toontalk-frontside-in-box"));k.update_display()}};a.empty_hole=function(a,f){this.set_hole(a,
b.box_empty_hole.create(a,this),f)};a.dereference=function(a){var b;if(a){b=a.get_index&&a.get_index();if("number"===typeof b&&(b=this.get_hole(b)))return a.next?b.dereference(a.next):b;console.log("box "+this.toString()+" unable to dereference path "+a.toString())}else return this};a.drop_on=function(a,b,e){if(a.box_dropped_on_me)return b=a.box_dropped_on_me(this,e),e&&a.update_display(),this.remove(),b;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,e);console.log("No handler for drop of "+
this.toString()+" on "+a.toString())};a.box_dropped_on_me=function(a,b){console.log("box on box not yet implemented");return!1};a.removed=function(a,b,e){b=this.get_size();var k;k=a.get_frontside();e=!!e;k&&$(k.get_element()).removeClass("toontalk-frontside-in-box");for(k=0;k<b;k+=1)if(a===this.get_hole(k))return this.empty_hole(k,e),this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"box hole "+a+(this.next?"; "+this.next.toString():"")},get_json:function(){return{type:"box_path",
index:a,next:this.next&&this.next.get_json()}}}},create_from_json:function(d){var f=a.path.create(d.index);d.next&&(f.next=b.UTILITIES.create_from_json(d.next));return f}};b.debugging&&(a.debug_string=this.toString());return a}(window.TOONTALK);
window.TOONTALK.box_backside=function(b){return{create:function(a){var d=b.backside.create(this),f=b.UTILITIES.create_text_input(a.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes."),e=b.UTILITIES.create_radio_button("box_orientation","horizontal","Left to right","Show box horizontally."),k=b.UTILITIES.create_radio_button("box_orientation","vertical","Top to bottom","Show box vertically."),n=function(){a.set_horizontal("horizontal"===b.UTILITIES.selected_radio_button(e.button,
k.button).value,!0)},p=d.get_element(),c=b.backside.create_standard_buttons(d,a);f.button.onchange=function(){a.set_size(parseInt(f.button.value.trim(),10),!0)};e.button.onchange=n;k.button.onchange=n;p.appendChild(f.container);p.appendChild($(b.UTILITIES.create_horizontal_table(e.container,k.container)).buttonset().get(0));a.get_horizontal()?b.UTILITIES.check_radio_button(e):b.UTILITIES.check_radio_button(k.button);p.appendChild(c);return d},update_display:function(){var a=b.UTILITIES.get_first_child_with_class(this.get_element(),
"toontalk-box-size-input"),d=this.get_widget();a.value=d.get_size().toString()}}}(window.TOONTALK);
window.TOONTALK.box_empty_hole=function(b){return{create:function(a,d){var f=Object.create(this),e=document.createElement("div");e.className="toontalk-empty-hole toontalk-frontside toontalk-side";f.get_frontside=function(){return e};f.update_display=function(){};f.get_frontside=function(){return this};f.get_element=function(){return e};f.widget_dropped_on_me=function(e){d.set_hole(a,e,!0);d.update_display()};f.get_json=function(){return null};f.copy=function(e){return b.box_empty_hole.create(a,e)};
$(e).on("drop",function(k){var f=b.UTILITIES.data_transfer_json_object(k),p=$("#"+f.id_of_original_dragree);0<p.length&&(k.stopPropagation(),0<$(e).parents("#"+f.id_of_original_dragree).length||(k=p.data("owner"),b.UTILITIES.restore_resource(p,k),p.is(".ui-resizable")&&(p.resizable("disable"),p.removeClass("ui-state-disabled")),d.set_hole(a,k),d.update_display()))});$(e).data("owner",f);return f},toString:function(){return"_"}}}(window.TOONTALK);window.TOONTALK.robot=function(b){var a=Object.create(b.widget);a.create=function(d,f,e,k,n,p,c){var m=Object.create(this);d||(d="images/RB00.PNG");e||(e=b.actions.create());n||(n=100);p||(p=100);m.get_bubble=function(){return f};m.set_bubble=function(a){f=a};m.get_body=function(){return e};m.get_image_url=function(){return d};m.set_image_url=function(a,e){d=a;e&&this.update_display()};m.get_width=function(){return n};m.set_width=function(a){n=a};m.get_height=function(){return p};m.set_height=function(a){p=
a};m.get_description=function(){return k?k:m.toString()};m.set_description=function(a,e){k=a;e&&this.update_display()};m.get_thing_in_hand=function(){return c};m.set_thing_in_hand=function(a){c=a};e.set_robot(m);b.debugging&&(m.debug_string=m.toString());m=a.add_sides_functionality(m);return m=a.erasable(m)};a.create_backside=function(){return b.robot_backside.create(this)};a.copy=function(a){var b=this.get_bubble(),b=b?b.copy(!0):void 0,b=this.create(this.get_image_url(),b,this.get_body().copy(),
this.get_description(),this.get_width(),this.get_height());return a?b:this.add_to_copy(b)};a.run=function(a,f){var e,k;if(this.stopped)return"not matched";e=this.get_bubble().match(a);switch(e){case "matched":return f||(f=b.QUEUE),f.enqueue({robot:this,context:a,queue:f}),e;case "not matched":return this.next_robot?this.next_robot.run(a,f):e;default:for(k=0;k<e.length;k+=1)e[k].run_when_non_empty(this);return e}};a.set_stopped=function(a){this.stopped=a};a.run_actions=function(a,b){return this.get_body().run(a,
b)};a.picked_up=function(a,f,e){var k;f=this.get_body();e?k=b.copy_constant.create(a):(e=f.get_path_to(a))&&(k=b.pick_up(e));this.set_thing_in_hand(a);k&&f.add_step(k)};a.dropped_on=function(a){var f;this.get_context()===a&&(f=b.drop_on.create(b.path_to_entire_context));this.set_thing_in_hand(null);f&&this.get_body().add_step(f)};a.copied=function(a,f){var e;a===this.get_context()&&(e=b.path_to_entire_context);e&&(e=b.copy.create(e),this.get_body().add_step(e))};a.get_context=function(){var a=this.get_frontside_element();
return $(a).parent().data("owner")};a.training_started=function(){this.set_bubble(this.get_context().copy(!0));$("div").css({cursor:"url("+b.UTILITIES.cursor_of_image(this.get_image_url())+"), default"})};a.training_finished=function(){$("div").css({cursor:""});this.set_description(this.toString(),!0)};a.update_display=function(){var a=this.get_frontside(),b=this.get_description(),e=this.get_bubble(),k,n,p,c,m;if(a){p=a.get_element();k=this.image();0<$(p).parent(".toontalk-top-level-resource").length||
!e?a=k:(n=this.thought_bubble_div(),a=document.createElement("div"),$(a).css({position:"absolute"}),a.appendChild(n),$(k).css({top:"30%"}),a.appendChild(k),c=e.get_frontside_element(),$(c).addClass("toontalk-thought-bubble-contents"),n.appendChild(c),m=p.firstChild&&$(p.firstChild).is(".toontalk-robot-image"));for(;p.firstChild;)p.removeChild(p.firstChild);p.title=b?"This robot "+b:"This is a "+this.toString();$(p).addClass("toontalk-robot");$(a).addClass("toontalk-widget");p.style.width=this.get_width();
p.style.height=this.get_height();p.appendChild(a);setTimeout(function(){c&&e.update_display();m&&(p.style.top=$(p).position().top-$(k).height()+"px")},1)}};a.image=function(){var a=document.createElement("img");a.src=this.get_image_url();a.style.width="100%";a.style.height="70%";$(a).addClass("toontalk-robot-image");return a};a.thought_bubble_div=function(){var a=document.createElement("div");$(a).addClass("toontalk-thought-bubble");return a};a.toString=function(){var a=this.get_bubble(),b=this.get_body();
return a&&b&&!b.is_empty()?"when given something that matches"+(a.get_erased()?" an erased ":" a ")+a.toString()+" will "+b.toString():"has yet to be trained"};a.get_type_name=function(){return"robot ("+this.get_description()+")"};a.get_json=function(){var a;this.get_bubble()&&(a=this.get_bubble().get_json());return this.add_to_json({type:"robot",bubble:a,body:this.get_body().get_json(),image_url:this.get_image_url(),description:this.get_description()})};a.create_from_json=function(a){return b.robot.create(b.UTILITIES.create_from_json(a.bubble),
b.UTILITIES.create_from_json(a.body),a.image_url,a.width,a.height,a.description)};return a}(window.TOONTALK);
window.TOONTALK.robot_backside=function(b){return{create:function(a){var d=b.backside.create(a),f=d.get_element(),e=b.UTILITIES.create_text_input(a.get_image_url(),"toontalk-image-url-input","Image URL&nbsp;","Type here to provide a URL for the appearance of this robot."),k=b.UTILITIES.create_text_input(a.get_description(),"toontalk-robot-description-input","Description&nbsp;","Type here to provide a better descprion of this robot."),n,p=b.backside.create_standard_buttons(d,a);p.insertBefore(this.create_train_button(d,
a),p.firstChild);e.button.onchange=function(){a.set_image_url(e.button.value.trim(),!0)};k.button.onchange=function(){a.set_description(k.button.value.trim(),!0)};n=b.UTILITIES.create_vertical_table(k.container,e.container);$(n).css({width:"90%"});f.appendChild(n);f.appendChild(p);return d},update_display:function(){var a=b.UTILITIES.get_first_child_with_class(this.get_element(),"toontalk-image-url-input"),d=this.get_widget();a.value=d.get_image_url()},create_train_button:function(a,d){var f=a.get_element();
$(f);var e=$("<button>Train</button>").button();e.addClass("toontalk-train-backside-button");var k=!1,n=function(){k?(e.button("option","label","Stop training"),e.attr("title","Click to stop training this robot.")):d.get_body().is_empty()?(e.button("option","label","Train"),e.attr("title","Click to stop training this robot.")):(e.button("option","label","Re-train"),e.attr("title","Click to start training this robot all over again."))};n();e.click(function(){k=!k;n();k?(d.get_body().reset_steps(),
b.robot.in_training=d,d.training_started()):(d.training_finished(),b.robot.in_training=null)});return e.get(0)}}}(window.TOONTALK);window.TOONTALK.DISPLAY_UPDATES=function(b){var a=[];return{add_dirty_side:function(b){var f;if(b.update_display){for(f=0;f<a.length;f+=1)if(a[f]===b)return;a.push(b)}},update_display:function(){var b;for(b=0;b<a.length;b+=1)a[b].update_display();a=[]}}}(window.TOONTALK);window.TOONTALK.actions=function(b){return{create:function(a){var d,f=Object.create(this),e=[];a||(a=[]);f.copy=function(){return b.actions.create(b.UTILITIES.copy_array(a))};f.get_steps=function(){return a};f.is_empty=function(){return 0===a.length};f.reset_steps=function(){a=[];e=[]};f.add_step=function(b,f){b.robot=d;a[a.length]=b;f&&(e[e.length]=f)};f.get_robot=function(){return d};f.set_robot=function(e){d=e;for(e=0;e<a.length;e+=1)a[e].robot=d};f.get_path_to=function(a){var d;for(d=0;d<e.length;d++)if(newly_created_widgest[d]===
a)return b.actions_paths.create(d,f)};f.dereference=function(a){return newly_created_widgest[a]};return f},run:function(a,b){var f,e=this.get_steps();for(f=0;f<e.length;f++)e[f].run(a);this.get_robot().run(a,b)},toString:function(){var a="",b,f=this.get_steps();for(b=0;b<f.length;b++)a+=f[b].toString(),b===f.length-2?a+=" and ":b<f.length-2&&(a+=", ");return a},get_json:function(){return{type:"body",steps:b.UTILITIES.get_json_of_array(this.get_steps())}},create_from_json:function(a){return b.actions.create(b.UTILITIES.create_array_from_json(a.steps))}}}(window.TOONTALK);
window.TOONTALK.actions_paths=function(b){return{create:function(a,b){return{dereference:function(){return b.dereference(a)}}}}}(window.TOONTALK);window.TOONTALK.queue=function(b){return{create:function(){var a=Object.create(this);a.to_run=[];return a},enqueue:function(a){return this.to_run.push(a)},dequeue:function(){return this.to_run.shift()},maximum_run:1,paused:!1,run:function(a,d){for(var f,e=(new Date).getTime()+this.maximum_run,k=this;0<this.to_run.length;){if(this.paused)return;f=(new Date).getTime();if(f>=e)break;f=this.dequeue();f.robot.run_actions(f.context,f.queue);if(a&&(a-=1,0===a)){this.to_run=[];b.DISPLAY_UPDATES.update_display();
d&&d();return}}b.DISPLAY_UPDATES.update_display();setTimeout(function(){k.run(a,d)},0)}}}(window.TOONTALK);window.TOONTALK.QUEUE=window.TOONTALK.queue.create();window.TOONTALK.path_to_entire_context=function(b){return{toString:function(){return"what he's working on"},get_json:function(){return{type:"path_to_entire_context"}},create_from_json:function(){return b.path_to_entire_context}}}(window.TOONTALK);window.TOONTALK.UTILITIES=function(b){var a,d={box:b.box.create_from_json,number:b.number.create_from_json,robot:b.robot.create_from_json,body:b.actions.create_from_json,pick_up_constant_action:b.pick_up_constant.create_from_json,pick_up_action:b.pick_up.create_from_json,drop_on_action:b.drop_on.create_from_json,copy_constant_action:b.copy_constant.create_from_json,copy_action:b.copy.create_from_json,box_path:b.box.path.create_from_json,path_to_entire_context:b.path_to_entire_context.create_from_json},
f=(new Date).getTime();return{create_from_json:function(a){var b,f;if(a){if(d[a.type]){if(b=d[a.type](a))a.erased&&b.set_erased(a.erased),a.width&&(f=b.get_frontside_element(),$(f).css({width:a.width,height:a.height})),a.backside_widgets&&b.set_backside_widgets(this.create_array_from_json(a.backside_widgets));return b}console.log("json type "+a.type+" not yet supported.")}},create_array_from_json:function(a){var d=[],f;for(f=0;f<a.length;f+=1)a[f]&&(d[f]=b.UTILITIES.create_from_json(a[f]));return d},
get_json_of_array:function(a){var b=[],d;for(d=0;d<a.length;d+=1)a[d]&&(a[d].get_json?b[d]=a[d].get_json():console.log("No get_json for "+a[d].toString()));return b},copy_widgets:function(a){var b=[],d;for(d=0;d<a.length;d++)b[d]=a[d].copy();return b},copy_array:function(a){var b=[],d;for(d=0;d<a.length;d++)b[d]=a[d];return b},generate_unique_id:function(){f+=1;return"toontalk_id_"+f},get_style_property:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,
null).getPropertyValue(b)},get_style_numeric_property:function(a,b){var d=this.get_style_property(a,b),f;return"string"===typeof d?(f=d.indexOf("px"),0<=f&&(d=d.substring(0,f)),parseInt(d,10)):d},get_first_child_with_class:function(a,b){var d;for(d=a.firstChild;d;d=d.nextSibling)if(d.className===b)return d},dereference_path:function(a,b){var d;return a?((d=b.dereference(a))||console.log("Unable to dereference path: "+a.toString()+" in context: "+b.toString()),d):b},data_transfer_json_object:function(a){if(a.originalEvent.dataTransfer)if(a=
a.originalEvent.dataTransfer.getData("text"))try{return JSON.parse(a)}catch(b){console.log("Exception parsing "+a+"\n"+b.toString())}else console.log("No data in dataTransfer in drop.");else console.log("no dataTransfer in drop event")},drag_and_drop:function(e){e.attr("draggable",!0);e.on("dragstart",function(d){var f=e.get(0).getBoundingClientRect(),p=b.UTILITIES.generate_unique_id(),c=e.data("owner"),m;a=e;e.css({position:"absolute"});e.is(".toontalk-frontside")&&e.css({width:this.offsetWidth+
"px",height:this.offsetHeight+"px"});e.attr("id",p);d.originalEvent.dataTransfer&&(d.originalEvent.dataTransfer.effectAllowed="move",m=c.get_json(),m.id_of_original_dragree=p,m.drag_x_offset=d.originalEvent.clientX-f.left,m.drag_y_offset=d.originalEvent.clientY-f.top,m.width||(e.parent().is(".toontalk-backside")?(m.original_width_fraction=e.outerWidth()/e.parent().outerWidth(),m.original_height_fraction=e.outerHeight()/e.parent().outerHeight()):(m.original_width_fraction=0.2,m.original_height_fraction=
0.1)),e.data("json",m),d.originalEvent.dataTransfer.setData("text",JSON.stringify(m)),c.drag_started(m,e.is(".toontalk-top-level-resource")));d.stopPropagation()});e.on("dragend",function(a){if(e.is(".toontalk-frontside"))if(e.parent().is(".toontalk-backside")){var b=e.data("json");b&&(e.data("json",""),e.css({width:b.width||100*b.original_width_fraction+"%",height:b.height||100*b.original_height_fraction+"%"}))}else e.css({width:"100%",height:"100%"});a.stopPropagation()});e.on("dragover",function(a){a.preventDefault();
return!1});e.on("drop",function(e){var d,f,c,m,r,g;g=b.UTILITIES.data_transfer_json_object(e);if((d=a||g&&$("#"+g.id_of_original_dragree))||g){c=$(e.target).closest(".toontalk-side");m=c.data("owner");if(d&&0<d.length){if(d.get(0)===c.get(0))return;f=d.data("owner");r=d.parents(".toontalk-side:first");(r=r.data("owner"))?r.removed(f,d,e):b.UTILITIES.restore_resource(d,f)}else f=b.UTILITIES.create_from_json(g),d=$(f.get_frontside_element());c.is(".toontalk-backside")?(c=b.UTILITIES.absolute_position(c),
g?(r=g.drag_x_offset,g=g.drag_y_offset):g=r=0,m.get_backside().widget_dropped_on_me(f,e),d.css({left:e.originalEvent.clientX-(c.left+r),top:e.originalEvent.clientY-(c.top+g)}),d.is(".toontalk-frontside")&&!d.is(".ui-resizable")&&d.resizable({resize:function(a,l){f.update_display()},handles:"n,e,s,w"}),e.stopPropagation()):m?f.drop_on(m,c,e)&&e.stopPropagation():console.log("target element has no 'owner'");m&&m.widget_dropped_on_me&&m.widget_dropped_on_me();e.preventDefault();a=void 0}else e.originalEvent.dataTransfer?
console.log("Drop failed since unable to parse "+e.originalEvent.dataTransfer):console.log("Drop failed since there is no event.originalEvent.dataTransfer")})},absolute_position:function(a){for(var b,d={left:0,top:0};0<a.parent().length;)b=a.position(),d.left+=b.left,d.top+=b.top,a=a.parent();return d},restore_resource:function(a,b){var d,f;a.is(".toontalk-top-level-resource")&&(d=b.copy(),f=d.get_frontside_element(),a.removeClass("toontalk-top-level-resource"),$(f).addClass("toontalk-top-level-resource"),
a.parent().append(f),d.update_display())},set_position_absolute:function(a,b,d){var f;d&&d.originalEvent&&(d=d.originalEvent);if(b){if("absolute"!==a.style.position||d&&(d.pageX!==d.clientX||d.pageY!==d.clientY)){if(d)for(b=d.pageX,d=d.pageY,f=a.parentElement;f;)b-=f.offsetLeft,d-=f.offsetTop,f=f.parentElement;else d=$(a).position(),b=d.left,d=d.top;$(a).css({left:b,top:d})}}else"relative"!==a.style.position&&(a.style.position="relative",a.style.left="0",a.style.top="0")},cursor_of_image:function(a){var b=
a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a},check_radio_button:function(a){$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")},create_button_set:function(){var a=document.createElement("div"),b,d;for(b=0;b<arguments.length;b++)if(0<=arguments[b].length)for(d=0;d<arguments[b].length;d++)a.appendChild(arguments[b][d]);else a.appendChild(arguments[b]);$(a).buttonset();return a},create_text_input:function(a,d,f,p){var c=document.createElement("input");
c.type="text";d&&(c.className=d);c.value=a;p&&(c.title=p);c.id=b.UTILITIES.generate_unique_id();a=document.createElement("label");a.innerHTML=f;a.htmlFor=c.id;f=b.UTILITIES.create_horizontal_table(a,c);$(c).button();$(a).addClass("ui-widget");return{container:f,button:c}},create_radio_button:function(a,d,f,p){var c=document.createElement("div"),m=document.createElement("input");m.type="radio";m.className="toontalk-radio-button";m.name=a;m.value=d;m.id=b.UTILITIES.generate_unique_id();a=document.createElement("label");
a.innerHTML=f;a.htmlFor=m.id;c.appendChild(m);c.appendChild(a);p&&(c.title=p);$(m).button();return{container:c,button:m,label:a}},create_horizontal_table:function(){var a=document.createElement("table"),b,d,f;d=document.createElement("tr");a.appendChild(d);for(b=0;b<arguments.length;b+=1)f=document.createElement("td"),d.appendChild(f),f.appendChild(arguments[b]);return a},create_vertical_table:function(){var a=document.createElement("table"),b,d,f;for(b=0;b<arguments.length;b+=1)d=document.createElement("tr"),
a.appendChild(d),f=document.createElement("td"),d.appendChild(f),f.appendChild(arguments[b]);return a},selected_radio_button:function(){var a;for(a=0;a<arguments.length;a+=1)if(arguments[a].checked)return arguments[a]}}}(window.TOONTALK);window.TOONTALK.tests=function(b){return{assert_equals:function(a,b,f){console.assert(a.equals(b),f+" Expected to be equal "+a.toString()+"="+b.toString())},random_integer_between:function(a,b){return Math.round(Math.random()*(b-a))+a},drop_numbers:function(a,d,f,e,k,n,p){a=b.number.create(d,f).set_operator(a);e=b.number.create(e,k);n=b.number.create(n,p);p=a.drop_on(e);this.assert_equals(p,n,"Dropping "+a+" on "+e+" should result in "+n);this.assert_equals(e,n,"Dropping "+a+" on "+e+" should update "+
e+" to "+n);this.assert_equals(a,b.number.create(d,f),"Dropping "+a+" on "+e+" should not update "+a)},create_sides:function(a,b,f){var e=a.get_backside(!0),k=a.get_frontside(!0).get_element(),e=e.get_element();k.style.top=f+"px";e.style.top=f+"px";k.className+=" toontalk-top-level-frontside";b.appendChild(e);b.appendChild(k);a.update_display()},add_or_duplicate_robot:function(a,d,f,e){var k=b.number.create(2);f&&this.create_sides(k,f);e||(e=100);f=d?this.double_robot():this.add_one_robot();a?a=d?
b.number.create(2).power(b.number.create(e+1)).toString():e+2:(f.get_bubble().set_erased(!1),a=3);this.test_robot(f,k,e,b.number.create(a));return this},test_robot:function(a,d,f,e,k){b.QUEUE.paused=!0;var n=b.queue.create(),p=d.copy();a.run(d,n);var c=this;n.run(f,function(){c.assert_equals(d,e,a.toString()+" when given "+p.toString()+" expected "+e.toString()+" not "+d.toString()+" when run "+f+" times. ");k&&k()})},accept_number_robot:function(){var a=b.actions.create(),d=b.number.create(1);d.set_erased(!0);
return b.robot.create("images/robot.png",d,a)},accept_box_robot:function(a){var d=b.actions.create();a=b.box.create(a);a.set_erased(!0);return b.robot.create("images/robot.png",a,d)},add_one_robot:function(){var a=this.accept_number_robot(),d=a.get_body();d.add_step(b.pick_up_constant.create(b.number.ONE()));d.add_step(b.drop_on.create(b.path_to_entire_context));a.set_description("adds one to what it is given");return a},double_robot:function(){var a=this.accept_number_robot(),d=a.get_body();d.add_step(b.copy.create(b.path_to_entire_context));
d.add_step(b.drop_on.create(b.path_to_entire_context));a.set_image_url("images/RB19.PNG");return a},copy_first_hole_to_second_hole_robot:function(){var a=this.accept_box_robot(2),d=a.get_body();d.add_step(b.copy.create(b.box.path.create(0)));d.add_step(b.drop_on.create(b.box.path.create(1)));a.set_image_url("images/RB45.PNG");return a},create_test_box:function(){var a=b.box.create(2);a.set_horizontal(!0);var d=b.number.create(1,49);d.set_operator("*");var f=b.number.create(19);a.set_hole(0,d);a.set_hole(1,
f);a.update_display();return a},test_copy_first_hole_to_second_hole_robot:function(){var a=this.copy_first_hole_to_second_hole_robot(),d=this.create_test_box(),f=document.createElement("div");f.className="toontalk-frontside";f.style.top="10px";var e=document.createElement("div");e.className="toontalk-frontside";f.style.top="200px";var k=document.createElement("div");f.appendChild(k);var n=document.createElement("div");e.appendChild(n);k.innerHTML=d.to_HTML();document.body.appendChild(f);f=d.copy();
k=b.number.create(19,"79792266297612001");f.set_hole(1,k);this.test_robot(a,d,10,f,function(){n.innerHTML=d.to_HTML();document.body.appendChild(e)})},robot_tests:function(){this.add_or_duplicate_robot();this.add_or_duplicate_robot(!0);this.add_or_duplicate_robot(!0,!0);b.tests.add_or_duplicate_robot(!0,!0,document.getElementById("test1_top_level_backside"),1E4);b.tests.add_or_duplicate_robot(!0,!1,document.getElementById("test1_top_level_backside"),1E4);b.tests.test_copy_first_hole_to_second_hole_robot()},
number_tests:function(){this.drop_numbers("+",1,1,2,1,3,1);this.drop_numbers("-",1,1,3,1,2,1);this.drop_numbers("*",2,1,3,1,6,1);this.drop_numbers("/",6,1,10,1,5,3);this.drop_numbers("^",2,1,3,1,9,1)},box_tests:function(){var a=b.box.create(2),d=b.box.create(1),f=b.box.create(1);f.set_erased(!0);var e=b.box.create(2);console.assert("matched"===e.match(a),"Empty box of size 2 should match empty box of size 2");console.assert(e.equals(a),"Empty box of size 2 should equal an empty box of size 2");console.assert("not matched"===
d.match(a),"Empty box of size 1 should not match empty box of size 2");console.assert(!d.equals(a),"Empty box of size 1 should not equal an empty box of size 2");console.assert("matched"===f.match(a),"Empty ERASED box of size 1 should match empty box of size 2");console.assert(!f.equals(a),"Empty ERASED box of size 1 should not equal an empty box of size 2");d=b.number.create(3);a.set_hole(0,d);console.assert("matched"===e.match(a),"Empty box of size 2 should match box of size 2 with number in first hole");
d=b.number.create(3);e.set_hole(0,d);console.assert("matched"===e.match(a),"box of size 2 with 3 in first hole should match box of size 2 with 3 in first hole");console.assert(e.equals(a),"box of size 2 with 3 in first hole should equal a box of size 2 with 3 in first hole");d=b.number.create(4);e.set_hole(1,d);console.assert("not matched"===e.match(a),"box of size 2 with 3 and 4 should not match box of size 2 with just 3 in first hole");d.set_erased(!0);console.assert("not matched"===e.match(a),
"box of size 2 with 3 and erased 4 should not match box of size 2 with 3 in first hole");console.assert(!e.equals(a),"box of size 2 with 3 and erased 4 should not equal a box of size 2 with 3 in first hole");f=b.number.create(5);a.set_hole(1,f);console.assert("matched"===e.match(a),"box of size 2 with 3 and erased 4 should match box of size 2 with 3 and 5");d.set_erased(!1);e.set_hole(1,d.copy());console.assert("not matched"===e.match(a),"box of size 2 with 3 and 4 should not match box of size 2 with 3 and 5");
console.assert(!e.equals(a),"box of size 2 with 3 and 4 should not equal a box of size 2 with 3 and 5");a.set_hole(1,b.number.create(5));e.set_hole(1,b.number.create(5));console.assert("matched"===e.match(a),"box of size 2 with 3 and 5 should match box of size 2 with 3 and 5");console.assert(e.equals(a),"box of size 2 with 3 and 5 should equal a box of size 2 with 3 and 5")},run:function(){this.number_tests();this.box_tests();this.robot_tests();return"All tests run."}}}(window.TOONTALK);window.TOONTALK.initialise=function(){$(document).ready(function(){var b=window.TOONTALK,a=b.backside.create({}).get_element(),d=$(a),f=b.number.create(1),e=f.get_frontside_element(),k=b.box.create(1),n=k.get_frontside_element(),p=b.robot.create(),c=p.get_frontside_element(),m=[e,n,c];$("#top-level-backside").append(a);d.css({width:"1000px",height:"300px","background-color":"yellow",position:"relative"});a.draggable=!1;b.debugging=!0;$("#a-number").append(e);f.update_display();$("#a-box").append(n);
k.update_display();$("#a-robot").append(c);p.update_display();for(a=0;a<m.length;a+=1)$(m[a]).addClass("toontalk-top-level-resource"),$(m[a]).css({position:"relative"});b.QUEUE.run()})};(function(b){var a;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(a={},define(function(){return a})):a="undefined"!==typeof window?window:b:a=exports;(function(a){var b={greatest_common_divisor:function(a,h){if(1===h||1===a)return 1;for(var b;0!==h;){b=h;h=a%h;if(!isFinite(h))return 0;a=b}return a}};b.gcd=b.greatest_common_divisor;b.fromRandom=function(a){return Math.random()*(1<<a)>>>0};b.fromMillitime=function(){return+new Date};b.fromUnixtime=
function(){return 0.001*b.fromMillitime()|0};"undefined"!==typeof a&&(a.integer=b);(function(a){function h(a,l,c){if(c!==b)return a instanceof h?a:"undefined"===typeof a?e:h.parse(a);for(a=a||[];a.length&&!a[a.length-1];)--a.length;this._d=a;this._s=a.length?l||1:0}var b={};h._construct=function(a,l){return new h(a,l,b)};var c=1E7;h.base=c;h.base_log10=7;var e=new h([],0,b);h.ZERO=e;var d=new h([1],1,b);h.ONE=d;var g=new h(d._d,-1,b);h.M_ONE=g;h._0=e;h._1=d;h.small=[e,d,new h([2],1,b),new h([3],1,
b),new h([4],1,b),new h([5],1,b),new h([6],1,b),new h([7],1,b),new h([8],1,b),new h([9],1,b),new h([10],1,b),new h([11],1,b),new h([12],1,b),new h([13],1,b),new h([14],1,b),new h([15],1,b),new h([16],1,b),new h([17],1,b),new h([18],1,b),new h([19],1,b),new h([20],1,b),new h([21],1,b),new h([22],1,b),new h([23],1,b),new h([24],1,b),new h([25],1,b),new h([26],1,b),new h([27],1,b),new h([28],1,b),new h([29],1,b),new h([30],1,b),new h([31],1,b),new h([32],1,b),new h([33],1,b),new h([34],1,b),new h([35],
1,b),new h([36],1,b)];h.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");h.prototype.toString=function(a){a=+a||10;if(2>a||36<a)throw Error("illegal radix "+a+".");if(0===this._s)return"0";if(10===a){a=0>this._s?"-":"";a+=this._d[this._d.length-1].toString();for(var l=this._d.length-2;0<=l;l--){for(var b=this._d[l].toString();7>b.length;)b="0"+b;a+=b}return a}l=h.digits;a=h.small[a];for(var b=this._s,c=this.abs(),e=[],d;0!==c._s;)d=c.divRem(a),c=d[0],d=d[1],e.push(l[d.valueOf()]);return(0>
b?"-":"")+e.reverse().join("")};h.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,
/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];h.parse=function(a,l){function c(a){a=a.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return a.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(a,l,h,b,c){c=+c;var d=0>c,e=h.length+c;a=(d?h:b).length;c=(c=Math.abs(c))>=a?c-a+d:0;a=Array(c+1).join("0");h+=b;return(l||"")+(d?h=a+h:h+=a).substr(0,e+=d?a.length:0)+(e<h.length?"."+h.substr(e):"")})}a=a.toString();if("undefined"===typeof l||10===+l)a=c(a);var d=
RegExp("^([+\\-]?)("+("undefined"===typeof l?"0[xcb]":16==l?"0x":8==l?"0c":2==l?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i").exec(a);if(d){var g=d[1]||"+",f=d[2]||"",d=d[3]||"";if("undefined"===typeof l)l="0x"===f||"0X"===f?16:"0c"===f||"0C"===f?8:"0b"===f||"0B"===f?2:10;else if(2>l||36<l)throw Error("Illegal radix "+l+".");l=+l;if(!h.radixRegex[l].test(d))throw Error("Bad digit for radix "+l);d=d.replace(/^0+/,"").split("");if(0===d.length)return e;g="-"===g?-1:1;if(10==l){for(f=[];7<=d.length;)f.push(parseInt(d.splice(d.length-
h.base_log10,h.base_log10).join(""),10));f.push(parseInt(d.join(""),10));return new h(f,g,b)}f=e;l=h.small[l];for(var k=h.small,t=0;t<d.length;t++)f=f.multiply(l).add(k[parseInt(d[t],36)]);return new h(f._d,g,b)}throw Error("Invalid BigInteger format: "+a);};h.prototype.add=function(a){if(0===this._s)return h(a);a=h(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.subtract(a);var l=this._d;a=a._d;for(var d=l.length,e=a.length,f=Array(Math.max(d,e)+1),g=Math.min(d,e),k=0,s=0;s<
g;s++)k=l[s]+a[s]+k,f[s]=k%c,k=k/c|0;e>d&&(l=a,d=e);for(s=g;k&&s<d;s++)k=l[s]+k,f[s]=k%c,k=k/c|0;for(k&&(f[s]=k);s<d;s++)f[s]=l[s];return new h(f,this._s,b)};h.prototype.negate=function(){return new h(this._d,-this._s|0,b)};h.prototype.abs=function(){return 0>this._s?this.negate():this};h.prototype.subtract=function(a){if(0===this._s)return h(a).negate();a=h(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.add(a);var l=this;0>this._s&&(l=new h(a._d,1,b),a=new h(this._d,1,b));
var d=l.compareAbs(a);if(0===d)return e;if(0>d){var f=a;a=l;l=f}l=l._d;a=a._d;var f=l.length,g=a.length,k=Array(f),p=0,m,n;for(m=0;m<g;m++)n=l[m]-p-a[m],0>n?(n+=c,p=1):p=0,k[m]=n;for(m=g;m<f;m++){n=l[m]-p;if(0>n)n+=c;else{k[m++]=n;break}k[m]=n}for(;m<f;m++)k[m]=l[m];return new h(k,d,b)};(function(){function a(l,d){for(var e=l._d,f=e.slice(),g=0;;){var k=(e[g]||0)+1;f[g]=k%c;if(k<=c-1)break;++g}return new h(f,d,b)}function l(a,d){for(var e=a._d,f=e.slice(),g=0;;){var k=(e[g]||0)-1;if(0>k)f[g]=k+c;
else{f[g]=k;break}++g}return new h(f,d,b)}h.prototype.next=function(){switch(this._s){case 0:return d;case -1:return l(this,-1);default:return a(this,1)}};h.prototype.prev=function(){switch(this._s){case 0:return g;case -1:return a(this,-1);default:return l(this,1)}}})();h.prototype.compareAbs=function(a){if(this===a)return 0;if(!(a instanceof h)){if(!isFinite(a))return isNaN(a)?a:-1;a=h(a)}if(0===this._s)return 0!==a._s?-1:0;if(0===a._s)return 1;var l=this._d.length,b=a._d.length;if(l<b)return-1;
if(l>b)return 1;b=this._d;a=a._d;for(l-=1;0<=l;l--)if(b[l]!==a[l])return b[l]<a[l]?-1:1;return 0};h.prototype.compare=function(a){if(this===a)return 0;a=h(a);return 0===this._s?-a._s:this._s===a._s?this.compareAbs(a)*this._s:this._s};h.prototype.isUnit=function(){return this===d||this===g||1===this._d.length&&1===this._d[0]};h.prototype.multiply=function(a){if(0===this._s)return e;a=h(a);if(0===a._s)return e;if(this.isUnit())return 0>this._s?a.negate():a;if(a.isUnit())return 0>a._s?this.negate():
this;if(this===a)return this.square();var l=this._d.length>=a._d.length,d=(l?this:a)._d,l=(l?a:this)._d,f=d.length,g=l.length,k=f+g,m=Array(k),n;for(n=0;n<k;n++)m[n]=0;for(n=0;n<g;n++){for(var k=0,p=l[n],v=f+n,q,r=n;r<v;r++)q=m[r]+p*d[r-n]+k,k=q/c|0,m[r]=q%c|0;k&&(q=m[r]+k,m[r]=q%c)}return new h(m,this._s*a._s,b)};h.prototype.multiplySingleDigit=function(a){if(0===a||0===this._s)return e;if(1===a)return this;var l;if(1===this._d.length)return l=this._d[0]*a,l>=c?new h([l%c|0,l/c|0],1,b):new h([l],
1,b);if(2===a)return this.add(this);if(this.isUnit())return new h([a],1,b);var d=this._d,f=d.length;l=f+1;for(var g=Array(l),k=0;k<l;k++)g[k]=0;for(var m=k=0;m<f;m++)l=a*d[m]+k,k=l/c|0,g[m]=l%c|0;k&&(g[m]=k);return new h(g,1,b)};h.prototype.square=function(){if(0===this._s)return e;if(this.isUnit())return d;var a=this._d,l=a.length,f=Array(l+l+1),g,k,m,n;for(n=0;n<l;n++)m=2*n,g=a[n]*a[n],k=g/c|0,f[m]=g%c,f[m+1]=k;for(n=0;n<l;n++){k=0;m=2*n+1;for(var p=n+1;p<l;p++,m++)g=a[p]*a[n]*2+f[m]+k,k=g/c|0,
f[m]=g%c;m=l+n;g=k+f[m];k=g/c|0;f[m]=g%c;f[m+1]+=k}return new h(f,1,b)};h.prototype.quotient=function(a){return this.divRem(a)[0]};h.prototype.divide=h.prototype.quotient;h.prototype.remainder=function(a){return this.divRem(a)[1]};h.prototype.divRem=function(a){a=h(a);if(0===a._s)throw Error("Divide by zero");if(0===this._s)return[e,e];if(1===a._d.length)return this.divRemSmall(a._s*a._d[0]);switch(this.compareAbs(a)){case 0:return[this._s===a._s?d:g,e];case -1:return[e,this]}var l=this._s*a._s,f=
a.abs(),k=this._d,m=k.length,n=[],p,q=new h([],0,b);for(q._s=1;m;)if(q._d.unshift(k[--m]),0>q.compareAbs(a))n.push(0);else{if(0===q._s)p=0;else{var r=q._d.length;p=f._d.length;r=q._d[r-1]*c+q._d[r-2];p=f._d[p-1]*c+f._d[p-2];q._d.length>f._d.length&&(r=(r+1)*c);p=Math.ceil(r/p)}do{r=f.multiplySingleDigit(p);if(0>=r.compareAbs(q))break;p--}while(p);n.push(p);p&&(p=q.subtract(r),q._d=p._d.slice(),0===q._d.length&&(q._s=0))}return[new h(n.reverse(),l,b),new h(q._d,this._s,b)]};h.prototype.divRemSmall=
function(a){a=+a;if(0===a)throw Error("Divide by zero");var l=this._s*(0>a?-1:1);a=Math.abs(a);if(1>a||a>=c)throw Error("Argument out of range");if(0===this._s)return[e,e];if(1===a||-1===a)return[1===l?this.abs():new h(this._d,l,b),e];if(1===this._d.length){var d=new h([this._d[0]/a|0],1,b);a=new h([this._d[0]%a|0],1,b);0>l&&(d=d.negate());0>this._s&&(a=a.negate());return[d,a]}for(var f=this._d.slice(),d=Array(f.length),g=0,k=0,m=0,n;f.length;)g=g*c+f[f.length-1],g<a?(d[m++]=0,f.pop(),k=c*k+g):(n=
0===g?0:g/a|0,k=g-a*n,(d[m++]=n)?(f.pop(),g=k):f.pop());a=new h([k],1,b);0>this._s&&(a=a.negate());return[new h(d.reverse(),l,b),a]};h.prototype.isEven=function(){var a=this._d;return 0===this._s||0===a.length||0===a[0]%2};h.prototype.isOdd=function(){return!this.isEven()};h.prototype.sign=function(){return this._s};h.prototype.isPositive=function(){return 0<this._s};h.prototype.isNegative=function(){return 0>this._s};h.prototype.isZero=function(){return 0===this._s};h.prototype.exp10=function(a){a=
+a;if(0===a)return this;if(Math.abs(a)>Number(f))throw Error("exponent too large in BigInteger.exp10");if(0<a){for(var l=new h(this._d.slice(),this._s,b);7<=a;a-=7)l._d.unshift(0);if(0==a)return l;l._s=1;l=l.multiplySingleDigit(Math.pow(10,a));return 0>this._s?l.negate():l}if(-a>=7*this._d.length)return e;l=new h(this._d.slice(),this._s,b);for(a=-a;7<=a;a-=7)l._d.shift();return 0==a?l:l.divRemSmall(Math.pow(10,a))[0]};h.prototype.pow=function(a){if(this.isUnit())return 0<this._s?this:h(a).isOdd()?
this:this.negate();a=h(a);if(0===a._s)return d;if(0>a._s){if(0===this._s)throw Error("Divide by zero");return e}if(0===this._s)return e;if(a.isUnit())return this;if(0<a.compareAbs(f))throw Error("exponent too large in BigInteger.pow");for(var l=this,b=d,c=h.small[2];a.isPositive()&&(!a.isOdd()||(b=b.multiply(l),!a.isUnit()));)l=l.square(),a=a.quotient(c);return b};h.prototype.modPow=function(a,l){for(var b=d,c=this;a.isPositive();)a.isOdd()&&(b=b.multiply(c).remainder(l)),a=a.quotient(h.small[2]),
a.isPositive()&&(c=c.square().remainder(l));return b};h.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var a=this._d.length;if(30>7*a)return Math.log(this.valueOf());var l=Math.ceil(30/7),d=this._d.slice(a-l);return Math.log((new h(d,1,b)).valueOf())+(a-l)*Math.log(c)};h.prototype.valueOf=function(){return parseInt(this.toString(),10)};h.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var f=h(2147483647);h.MAX_EXP=f;(function(){function a(l){return function(a){return l.call(h(a))}}
function l(a){return function(l,b){return a.call(h(l),h(b))}}function b(a){return function(l,b,c){return a.call(h(l),h(b),h(c))}}(function(){var c,d,e="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),f="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),g=["modPow"];for(c=0;c<e.length;c++)d=e[c],h[d]=a(h.prototype[d]);for(c=0;c<f.length;c++)d=f[c],h[d]=l(h.prototype[d]);for(c=0;c<g.length;c++)d=
g[c],h[d]=b(h.prototype[d]);h.exp10=function(a,l){return h(a).exp10(l)}})()})();a.BigInteger=h})("undefined"!==typeof a?a:this);var e={greatest_common_divisor:function(a,h){if(h.isUnit()||a.isUnit())return BigInteger.ONE;for(var b;!h.isZero();)b=h,h=a.remainder(h),a=b;return a},create:function(){return[0]},clone:function(a){for(var h=[],b=0,c=a.length;b<c;b++)h[b]=a[b];return h},copy:function(a,h){a=[];for(var b=0,c=h.length;b<c;b++)a[b]=h[b];return a},abs:function(a,h){a[0]=Math.abs(h[0]);return a},
str:function(a){return a[0].toString()},toInteger:function(a){return out[0]},fromInteger:function(a){return[parseInt(a)]}};e.ZERO=e.fromInteger(0);e.ONE=e.fromInteger(1);"undefined"!==typeof a&&(a.bigint=e);if(!k)var k=Array;if(!n)var n=Math.pow(2,56);if(!p)var p=16777216;var c={EPSILON:2E-16};c.MAX_LOOPS=p;c.create=function(){var a=new k(2);a[0]=0;a[1]=1;return a};c.clone=function(a){var h=new k(2);h[0]=a[0];h[1]=a[1];return h};c.fromValues=function(a,h){var b=new k(2);b[0]=a;b[1]=h;return c.normalize(b,
b)};c.copy=function(a,h){a[0]=h[0];a[1]=h[1];return a};c.set=function(a,h,b){a[0]=h;a[1]=b;return c.normalize(a,a)};c.abs=function(a,h){a[0]=Math.abs(h[0]);a[1]=h[1];return a};c.invert=function(a,h){var b=h[0];a[0]=h[1];a[1]=b;return a};c.reciprocal=c.invert;c.add=function(a,h,b){h[1]===b[1]?(a[0]=h[0]+b[0],a[1]=h[1]):(a[0]=h[0]*b[1]+b[0]*h[1],a[1]=h[1]*b[1]);return c.normalize(a,a)};c.subtract=function(a,h,b){h[1]===b[1]?(a[0]=h[0]-b[0],a[1]=h[1]):(a[0]=h[0]*b[1]-b[0]*h[1],a[1]=h[1]*b[1]);return c.normalize(a,
a)};c.sub=c.subtract;c.multiply=function(a,h,b){a[0]=h[0]*b[0];a[1]=h[1]*b[1];return c.normalize(a,a)};c.mul=c.multiply;c.mediant=function(a,h,b){a[0]=h[0]+b[0];a[1]=h[1]+b[1];return c.normalize(a,a)};c.divide=function(a,h,b){a[0]=h[0]*b[1];a[1]=h[1]*b[0];return c.normalize(a,a)};c.div=c.divide;c.equals=function(a,h){return 0===a[0]&&0===h[0]||0===a[1]&&0===h[1]?!0:a[0]===h[0]&&a[1]===h[1]};c.approximates=function(a,h){if(c.equals(a,h))return!0;var b=c.create();c.sub(b,a,h);c.abs(b,b);return c.isLessThan(b,
c.INFINITESIMAL)};c.isGreaterThan=function(a,h){return c.equals(a,h)?!1:a[0]*h[1]>h[0]*a[1]};c.isLessThan=function(a,h){return c.equals(a,h)?!1:a[0]*h[1]<h[0]*a[1]};c.isNegative=function(a){return 0>a[0]};c.min=function(a,h,b){c.isLessThan(h,b)?(a[0]=h[0],a[1]=h[1]):(a[0]=b[0],a[1]=b[1]);return a};c.max=function(a,h,b){c.isGreaterThan(h,b)?(a[0]=h[0],a[1]=h[1]):(a[0]=b[0],a[1]=b[1]);return a};c.scalar_multiply=function(a,h,b){a[0]=h[0]*b;a[1]=h[1];return c.normalize(a,a)};c.scalar_divide=function(a,
h,b){a[0]=h[0];a[1]=h[1]*b;return c.normalize(a,a)};c.normalize=function(a,h){if(isNaN(h[0])||isNaN(h[1])||0===h[0]&&0===h[1])return a[0]=0,a[1]=0,a;if(0===h[0])return a[0]=0,a[1]=1,a;if(0===h[1])return a[0]=1,a[1]=0,a;if(h[0]===h[1])return a[0]=1,a[1]=1,a;0<h[1]?(a[0]=h[0],a[1]=h[1]):(a[0]=-h[0],a[1]=-h[1]);var c=b.greatest_common_divisor(Math.abs(a[0]),a[1]);1<c&&(a[0]/=c,a[1]/=c);return a};c.opposite=function(a,h){a[0]=-h[0];a[1]=h[1];return a};c.negative=c.opposite;c.neg=c.opposite;c.power=function(a,
h,b){2===b?(a[0]=h[0]*h[0],a[1]=h[1]*h[1]):0<b?(a[0]=Math.pow(h[0],b),a[1]=Math.pow(h[1],b)):0>b?(b=Math.abs(b),a[0]=Math.pow(h[1],b),a[1]=Math.pow(h[0],b)):c.copy(a,c.ONE);return c.normalize(a,a)};c.pow=c.power;c.sqrt=function(a,h){return c.nthRoot(a,h,2)};c.nthRoot=function(a,h,b){if(c.equals(h,c.ZERO))return c.copy(a,c.ZERO);if(c.equals(h,c.ONE))return c.copy(a,c.ONE);if(c.equals(h,c.INFINITY))return c.copy(a,c.INFINITY);if(c.equals(h,c.INFINULL))return c.copy(a,c.INFINULL);var d=c.isNegative(h);
d&&(h[0]=-h[0]);a=c.copy(a,c.ONE);for(var e=[1,0,0,1],f=c.clone(c.ONE),g=c.MAX_LOOPS;!c.approximates(h,f)&&g--;)c.isLessThan(h,f)?(e[0]+=e[1],e[2]+=e[3]):(e[1]+=e[0],e[3]+=e[2]),a[0]=e[0]+e[1],a[1]=e[2]+e[3],c.pow(f,a,b);d&&(h[0]=-h[0],1===b%2&&c.neg(a,a));return a};c.dot=function(a,h){return a[0]*h[0]+a[1]*h[1]};c.str=function(a){return 1===a[1]?a[0].toString():a[0]+"/"+a[1]};c.toDecimal=function(a){return a[0]/a[1]};c.dec=c.toDecimal;c.toInteger=function(a){return Math.round(c.toDecimal(a))};c.round=
c.toInteger;c.floor=function(a){return Math.floor(c.toDecimal(a))};c.ceil=function(a){return Math.ceil(c.toDecimal(a))};c.fromInteger_copy=function(a,h){a[0]=parseInt(h);a[1]=1;return a};c.fromInteger=function(a){return c.fromInteger_copy(c.create(),a)};c.fromIntegerInverse_copy=function(a,h){a[0]=1;a[1]=parseInt(h);0>a[1]&&(a[0]=-a[0],a[1]=-a[1]);return a};c.fromIntegerInverse=function(a){return c.fromIntegerInverse_copy(c.create(),a)};c.fromDecimal=function(a){return c.fromDecimal_copy(c.create(),
a)};c.fromDecimal_copy=function(a,h){h=parseFloat(h);if(isNaN(h))return c.copy(a,c.INFINULL);if(Infinity===h)return c.copy(a,c.INFINITY);if(Math.abs(h)<c.EPSILON)return c.copy(a,c.ZERO);if(Math.abs(h-1)<c.EPSILON)return c.copy(a,c.ONE);if(Math.abs(h%1)<c.EPSILON)return c.fromInteger_copy(a,h);if(Math.abs(1/h%1)<c.EPSILON)return c.fromIntegerInverse_copy(a,Math.round(1/h));c.copy(a,c.ONE);for(var b=[1,0,0,1],d=h,e=1,f=c.MAX_LOOPS;f--&&Math.abs(h-c.toDecimal(a))>c.EPSILON;)e=Math.floor(d),a[0]=e*b[0]+
b[2],a[1]=e*b[1]+b[3],d=1/(d-e),b[2]=b[0],b[3]=b[1],b[0]=a[0],b[1]=a[1];return a};c.fromRandom=function(a){a[0]=0xfffffffffffff*Math.random()<<0;a[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return c.normalize(a,a)};c.sin=function(a,h){if(0===h[1])return c.copy(a,c.ZERO);c.scalar_multiply(a,h,2);var b=c.create();c.pow(b,h,2);c.add(b,b,c.ONE);c.divide(a,a,b);return a};c.cos=function(a,h){if(0===h[1])return c.neg(a,c.ONE);var b=c.create();c.pow(b,h,2);c.sub(a,c.ONE,b);var d=c.create();c.add(d,c.ONE,
b);c.divide(a,a,d);return a};c.tan=function(a,h){c.scalar_multiply(a,h,2);var b=c.create();c.pow(b,h,2);c.scalar_multiply(b,b,2);c.add(a,a,b);c.pow(b,h,4);c.sub(b,c.ONE,b);c.divide(a,a,b);return a};c.toEgyptian=function(a){a=c.clone(a);c.abs(a,a);var h=c.floor(a);h&&c.sub(a,a,c.fromInteger(h));if(!a[0])return h.toString();h||(h="");for(var b=1,d=c.create();1!==a[0];)b++,d=c.fromValues(1,b),c.isGreaterThan(a,d)&&(h&&(h+=" + "),h+=c.str(d),c.sub(a,a,d));return a?h?h+" + "+c.str(a):c.str(a):h?h:"0"};
c.toBabylonian=function(a){var h="",b=c.toDecimal(a);a=parseInt(b);for(var b=b-a,d=0,e=0;0<a;)(d=a%60)&&(h=d+" * 60^"+e+(h?" + ":"")+h),a=(a-d)/60,e++;for(e=-1;0<b;)b*=60,d=parseInt(b+1E-13),b-=d,-1E-13>b||(d&&(h+=(h?" + ":"")+d+" * 60^"+e),e--);return h?h:"0"};c.traceSternBrocot=function(a){var b="";if(c.equals(a,c.ZERO)||c.equals(a,c.ONE)||c.equals(a,c.INFINITY)||c.equals(a,c.INFINULL))return b;if(c.equals(a,c.ZERO))return c.copy(out,c.ZERO);if(c.equals(a,c.ONE))return c.copy(out,c.ONE);if(c.equals(a,
c.INFINITY))return c.copy(out,c.INFINITY);if(c.equals(a,c.INFINULL))return c.copy(out,c.INFINULL);a=c.clone(a);c.isNegative(a)&&(a[0]=-a[0]);for(var d=c.clone(c.ONE),e=[1,0,0,1],f=0,g=0,k=c.MAX_LOOPS;!c.approximates(a,d)&&k--;)c.isLessThan(a,d)?(e[0]+=e[1],e[2]+=e[3],g++,f&&(b+="R",1!==f&&(b+=f),f=0,b+=" ")):(e[1]+=e[0],e[3]+=e[2],f++,g&&(b+="L",1!==g&&(b+=g),g=0,b+=" ")),d[0]=e[0]+e[1],d[1]=e[2]+e[3];g?(b+="L",1!==g&&(b+=g)):f&&(b+="R",1!==f&&(b+=f));0>k&&(b+="...");return b};c.toContinuedFraction=
function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(c.equals(a,c.ZERO))return[0];if(c.equals(a,c.ONE))return[1];if(c.equals(a,c.NEGONE))return[-1];if(c.equals(a,c.INFINITY))return[1,0];if(c.equals(a,c.INFINULL))return[0,0];var d=c.clone(a),e=c.isNegative(d);e&&(d[0]=-d[0]);for(var f=c.clone(c.ONE),g=[1,0,0,1],k=1,m=[0],n=m.length-1;!c.equals(d,f)&&b--;)c.isLessThan(d,f)?(-1===k?m[n]++:(k=-1,m.push(1),n++),g[0]+=g[1],g[2]+=g[3]):(1===k?m[n]++:(k=1,m.push(1),n++),g[1]+=g[0],g[3]+=g[2]),f[0]=
g[0]+g[1],f[1]=g[2]+g[3];0>b?m.push(0):m[n]++;if(e)for(var p in m)m[p]=-m[p];return m};c.fromContinuedFraction=function(a,b){c.fromInteger_copy(a,b[b.length-1]);for(var d=b.length-2;-1<d;d--)c.invert(a,a),c.add(a,c.fromInteger(b[d]),a);return a};c.dump=function(a){c.create();return"rat\t"+c.str(a)+"\n~\t"+c.toDecimal(a)+"\nCF:\t["+c.toContinuedFraction(a)+"]\n"};c.ZERO=c.fromInteger(0);c.ONE=c.fromInteger(1);c.NEGONE=c.fromInteger(-1);c.INFINITY=c.fromValues(1,0);c.INFINULL=c.fromValues(0,0);c.INFINITESIMAL=
c.clone([1,n]);c.PI=c.fromValues(1320192667429,420230377710);"undefined"!==typeof a&&(a.rat=c);if(!m)var m=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!r)var r=1073741824;var g={EPSILON:2E-16};g.MAX_LOOPS=r;g.create=function(){var a=[];a[0]=BigInteger.ZERO;a[1]=BigInteger.ONE;return a};g.clone=function(a){var b=[];b[0]=a[0];b[1]=a[1];return b};g.fromValues=function(a,b){var c=[];c[0]=new BigInteger(a);c[1]=new BigInteger(b);return g.normalize(c,c)};g.copy=function(a,b){a[0]=b[0];a[1]=
b[1];return a};g.set=function(a,b,c){a[0]=b;a[1]=c;return g.normalize(a,a)};g.toRat=function(a,b){return c.set(a,b[0].toJSValue(),b[1].toJSValue())};g.fromRat=function(a,b){return g.set(a,BigInteger(b[0]),BigInteger(b[1]))};g.abs=function(a,b){a[0]=b[0].abs();a[1]=b[1];return a};g.invert=function(a,b){var c=b[0];a[0]=b[1];a[1]=c;return a};g.reciprocal=g.invert;g.add=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].add(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).add(c[0].multiply(b[1])),a[1]=b[1].multiply(c[1]));
return g.normalize(a,a)};g.subtract=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].subtract(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).subtract(c[0].multiply(b[1])),a[1]=b[1].multiply(c[1]));return g.normalize(a,a)};g.sub=g.subtract;g.multiply=function(a,b,c){a[0]=b[0].multiply(c[0]);a[1]=b[1].multiply(c[1]);return g.normalize(a,a)};g.mul=g.multiply;g.mediant=function(a,b,c){a[0]=b[0].add(c[0]);a[1]=b[1].add(c[1]);return g.normalize(a,a)};g.divide=function(a,b,c){a[0]=b[0].multiply(c[1]);a[1]=
b[1].multiply(c[0]);return g.normalize(a,a)};g.div=g.divide;g.equals=function(a,b){return a[0].isZero()&&b[0].isZero()||a[1].isZero()&&b[1].isZero()?!0:0===a[0].compare(b[0])&&0===a[1].compare(b[1])};g.approximates=function(a,b){if(g.equals(a,b))return!0;var c=g.create();g.sub(c,a,b);g.abs(c,c);return g.isLessThan(c,g.INFINITESIMAL)};g.isGreaterThan=function(a,b){return g.equals(a,b)?!1:0<a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};g.isLessThan=function(a,b){return g.equals(a,b)?!1:0>a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};
g.isNegative=function(a){return a[0].isNegative()};g.min=function(a,b,c){g.isLessThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.max=function(a,b,c){g.isGreaterThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.scalar_multiply=function(a,b,c){a[0]=b[0].multiply(c);a[1]=b[1];return g.normalize(a,a)};g.scalar_divide=function(a,b,c){a[0]=b[0];a[1]=b[1].multiply(c);return g.normalize(a,a)};g.normalize=function(a,b){if(b[0].isZero()||b[1].isZero())return b;if(0===b[0].compare(b[1]))return g.clone(g.ONE);
if(b[1].isNegative())a[0]=b[0].negate(),a[1]=b[1].negate();else if(a[0]=b[0],a[1]=b[1],a[1].isZero())return a;var c=e.greatest_common_divisor(a[0].abs(),a[1]);0<c.compare(BigInteger.ONE)&&(a[0]=a[0].quotient(c),a[1]=a[1].quotient(c));return a};g.opposite=function(a,b){a[0]=b[0].negate();a[1]=b[1];return a};g.negative=g.opposite;g.neg=g.opposite;g.power=function(a,b,c){2===c?(a[0]=b[0].square(),a[1]=b[1].square()):0<c?(a[0]=b[0].pow(c),a[1]=b[1].pow(c)):0>c?(c=Math.abs(c),a[0]=b[1].pow(c),a[1]=b[0].pow(c)):
g.copy(a,g.ONE);return a};g.pow=g.power;g.sqrt=function(a,b){return g.nthRoot(a,b,2)};g.nthRoot=function(a,b,c){if(g.equals(b,g.ZERO))return g.copy(a,g.ZERO);if(g.equals(b,g.ONE))return g.copy(a,g.ONE);if(g.equals(b,g.INFINITY))return g.copy(a,g.INFINITY);if(g.equals(b,g.INFINULL))return g.copy(a,g.INFINULL);var d=g.isNegative(b);d&&(b[0]=b[0].negate());g.copy(a,g.ONE);for(var e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=g.clone(g.ONE),k=r;!g.approximates(b,f)&&k--;)g.isLessThan(b,
f)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),a[0]=e[0].add(e[1]),a[1]=e[2].add(e[3]),g.pow(f,a,c);d&&(b[0]=b[0].negate(),1===c%2&&g.neg(a,a));return a};g.dot=function(a,b){return a[0].multiply(b[0]).add(a[1].multiply(b[1]))};g.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};g.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};g.dec=g.toDecimal;g.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};
g.round=g.toInteger;g.toBigInteger=function(a){return a[0].quotient(a[1])};g.floor=function(a){return Math.floor(g.toDecimal(a))};g.ceil=function(a){return Math.ceil(g.toDecimal(a))};g.fromInteger_copy=function(a,b){a[0]=BigInteger(b);a[1]=BigInteger.ONE;return a};g.fromInteger=function(a){return g.fromInteger_copy(g.create(),a)};g.fromIntegerInverse_copy=function(a,b){a[0]=BigInteger.ONE;a[1]=BigInteger(b);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};g.fromIntegerInverse=
function(a){return g.fromIntegerInverse_copy(g.create(),a)};g.fromDecimal=function(a){return g.fromDecimal_copy(g.create(),a)};g.fromDecimal_copy=function(a,b){b=parseFloat(b);if(isNaN(b))return g.copy(a,g.INFINULL);if(Infinity===b)return g.copy(a,g.INFINITY);if(Math.abs(b)<g.EPSILON)return g.copy(a,g.ZERO);if(Math.abs(b-1)<g.EPSILON)return g.copy(a,g.ONE);if(Math.abs(b%1)<g.EPSILON)return g.fromInteger_copy(a,b);if(Math.abs(1/b%1)<g.EPSILON)return g.fromIntegerInverse_copy(a,Math.round(1/b));g.copy(a,
g.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=b,e=1,f=g.MAX_LOOPS;f--&&Math.abs(b-g.toDecimal(a))>g.EPSILON;)e=Math.floor(d),a[0]=BigInteger(e*c[0]+c[2]),a[1]=BigInteger(e*c[1]+c[3]),d=1/(d-e),c[2]=c[0],c[3]=c[1],c[0]=a[0],c[1]=a[1];return a};g.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*Math.random()<<0));return g.normalize(a,a)};g.sin=function(a,b){if(b[1].isZero())return g.copy(a,g.ZERO);g.scalar_multiply(a,
b,2);var c=g.create();g.pow(c,b,2);g.add(c,c,g.ONE);g.divide(a,a,c);return a};g.cos=function(a,b){if(b[1].isZero())return g.neg(a,g.ONE);var c=g.create();g.pow(c,b,2);g.sub(a,g.ONE,c);var d=g.create();g.add(d,g.ONE,c);g.divide(a,a,d);return a};g.tan=function(a,b){g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.scalar_multiply(c,c,2);g.add(a,a,c);g.pow(c,b,4);g.sub(c,g.ONE,c);g.divide(a,a,c);return a};g.toEgyptian=function(a){a=g.clone(a);g.abs(a,a);var b=g.floor(a);b&&g.sub(a,a,g.fromInteger(b));
if(!a[0])return b.toString();b||(b="");for(var c=1,d=g.create();1!==a[0];)c++,d=g.fromValues(1,c),g.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=g.str(d),g.sub(a,a,d));return a?b?b+" + "+g.str(a):g.str(a):b?b:"0"};g.toBabylonian=function(a){var b="",c=g.toDecimal(a);a=parseInt(c);for(var c=c-a,d=0,e=0;0<a;)(d=a%60)&&(b=d+" * 60^"+e+(b?" + ":"")+b),a=(a-d)/60,e++;for(e=-1;0<c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+e),e--);return b?b:"0"};g.traceSternBrocot=function(a){var b=
"";if(g.equals(a,g.ZERO)||g.equals(a,g.ONE)||g.equals(a,g.INFINITY)||g.equals(a,g.INFINULL))return b;a=g.clone(a);g.isNegative(a)&&(a[0]=a[0].negate());for(var c=g.clone(g.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=0,f=0,k=65536;!g.equals(a,c)&&k--;)g.isLessThan(a,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),f++,e&&(b+="R",1!==e&&(b+=e),e=0,b+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),e++,f&&(b+="L",1!==f&&(b+=f),f=0,b+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);f?(b+=
"L",1!==f&&(b+=f)):e&&(b+="R",1!==e&&(b+=e));0>k&&(b+="...");return b};g.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(g.equals(a,g.ZERO))return[0];if(g.equals(a,g.ONE))return[1];if(g.equals(a,g.NEGONE))return[-1];if(g.equals(a,g.INFINITY))return[1,0];if(g.equals(a,g.INFINULL))return[0,0];var c=g.clone(a),d=g.isNegative(c);d&&(c[0]=c[0].negate());for(var e=g.clone(g.ONE),f=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],k=1,m=[0],n=m.length-1;!g.equals(c,
e)&&b--;)g.isLessThan(c,e)?(-1===k?m[n]++:(k=-1,m.push(1),n++),f[0]=f[0].add(f[1]),f[2]=f[2].add(f[3])):(1===k?m[n]++:(k=1,m.push(1),n++),f[1]=f[1].add(f[0]),f[3]=f[3].add(f[2])),e[0]=f[0].add(f[1]),e[1]=f[2].add(f[3]);0>b?m.push(0):m[n]++;if(d)for(var p in m)m[p]=-m[p];return m};g.fromContinuedFraction=function(a,b){g.fromInteger_copy(a,b[b.length-1]);for(var c=b.length-2;-1<c;c--)g.invert(a,a),g.add(a,g.fromInteger(b[c]),a);return a};g.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return g.fromInteger_copy(a,
factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(g.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)g.scalar_multiply(a,a,++c);return a};g.dump=function(a){return"bigrat\t"+g.str(a)+"\n~\t"+g.toDecimal(a)+"\nCF:\t["+g.toContinuedFraction(a)+"]\n"};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);g.NEGONE=g.fromInteger(-1);g.INFINITY=g.fromValues(1,0);g.INFINULL=g.fromValues(0,0);g.INFINITESIMAL=g.clone([new BigInteger(1),m]);g.PI=g.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587",
"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");"undefined"!==typeof a&&(a.bigrat=g);var q=function(a,b){this.a=c.fromValues(parseInt(a),parseInt(b))};q.prototype.toString=function(){return c.str(this.a)};q.prototype.toContinuedFraction=function(a){return c.toContinuedFraction(this.a,
a)};q.prototype.invert=function(){return c.invert(this.a)};q.prototype.reciprocal=q.prototype.invert;q.prototype.add=function(a){var b=c.create();c.add(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.plus=q.prototype.add;q.prototype.subtract=function(a){var b=c.create();c.sub(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.sub=q.prototype.subtract;q.prototype.minus=q.prototype.subtract;q.prototype.multiply=function(a){var b=c.create();c.mul(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.mul=
q.prototype.multiply;q.prototype.times=q.prototype.multiply;q.prototype.mediant=function(a){var b=c.create();c.mediant(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.divide=function(a){var b=c.create();c.div(b,this.a,a.a);return new q(b[0],b[1])};q.prototype.div=q.prototype.divide;q.prototype.divided_by=q.prototype.divide;q.prototype.power=function(a){var b=c.create();c.pow(b,this.a,a);return new q(b[0],b[1])};q.prototype.pow=q.prototype.power;q.prototype.dump=function(){return c.dump(this.a)};
q.prototype.toRat=function(){return c.clone(this.a)};q.prototype.toDecimal=function(){return c.toDecimal(this.a)};q.fromRat=function(a){var b=new q;b.a[0]=a[0];b.a[1]=a[1];return b};q.fromInteger=function(a){return q.fromRat(c.fromInteger(a))};q.fromIntegerInverse=function(a){return q.fromRat(c.fromIntegerInverse(a))};q.fromDecimal=function(a){return q.fromRat(c.fromDecimal(a))};q.fromContinuedFraction=function(a){return q.fromRat(c.fromContinuedFraction(c.create(),a))};"undefined"!==typeof a&&(a.rational=
q)})(a)})(this);
