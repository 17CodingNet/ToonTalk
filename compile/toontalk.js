'use strict';window.TOONTALK.copy=function(b){return{create:function(a){var h=Object.create(this);a||console.log("path undefined in copy action");h.path=a;return h},run:function(a){a=b.UTILITIES.dereference_path(this.path,a);if(!a)return!1;this.robot.thing_in_hand=a.copy();return!0},toString:function(){return"copy "+this.path.toString()},get_json:function(){return{type:"copy_action",path:this.path.get_json()}},create_from_json:function(a){return b.copy.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.copy_constant=function(b){return{create:function(a,h){var e=Object.create(this);e.robot=a;e.constant_object=h;return e},run:function(a){this.robot.thing_in_hand=this.constant_object.copy();return!0},toString:function(){return"copy "+this.constant_object.toString()},get_json:function(){return{type:"copy_constant_action",constant_object:this.constant_object.get_json()}},create_from_json:function(a){return b.copy_constant.create(b.UTILITIES.create_from_json(a.constant_object))}}}(window.TOONTALK);window.TOONTALK.drop_on=function(b){return{create:function(a){var h=Object.create(this);h.path=a;return h},run:function(a){return(a=b.UTILITIES.dereference_path(this.path,a))?(this.robot.thing_in_hand.drop_on(a),!0):!1},toString:function(){return"drop it on "+this.path.toString()},get_json:function(){return{type:"drop_on_action",path:this.path.get_json()}},create_from_json:function(a){return b.drop_on.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.pick_up=function(b){return{create:function(a){var h=Object.create(this);h.path=a;return h},run:function(a){a=b.UTILITIES.dereference_path(this.path,a);if(!a)return!1;this.robot.thing_in_hand=a;return!0},toString:function(){return"pick up "+this.path.toString()},get_json:function(){return{type:"pick_up_action",path:this.path.get_json()}},create_from_json:function(a){return b.pick_up.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.pick_up_constant=function(b){return{create:function(a){var h=Object.create(this);h.constant_object=a;return h},run:function(a){this.robot.thing_in_hand=this.constant_object;return!0},toString:function(){return"pick up "+this.constant_object.toString()},get_json:function(){return{type:"pick_up_constant_action",object:this.constant_object.get_json()}},create_from_json:function(a){return b.pick_up_constant.create(b.UTILITIES.create_from_json(a.object))}}}(window.TOONTALK);window.TOONTALK.widget=function(b){var a;return{get_erased:function(){return a},set_erased:function(h){a=h},add_sides_functionality:function(a){var e,g;a.get_frontside=function(g){g&&!e&&(e=b.frontside.create(a));return e};a.get_backside=function(e){e&&!g&&(g=a.create_backside());return g};a.forget_backside=function(){g=void 0};return a},remove:function(){var a=this.get_backside(),e=this.get_frontside();a&&a.remove();e&&e.remove()},get_frontside_element:function(a){var e=this.get_frontside(!0);a&&
this.update_display();return e.get_element()},dereference:function(){return this},get_json:function(a){if(a)return this.get_erased()&&(a.erased=!0),a;console.log("get_json not defined");return{}},copy:function(){console.assert(!1,"copy not implemented")},visible:function(){var a=this.get_frontside();return a?$(a.get_element()).is(":visible"):!1},equals:function(a){console.assert(!1,"equals not implemented")},match:function(a){console.assert(!1,"copy not implemented")},drop_on:function(a,e,g){console.log("drop_on not implemented; this is "+
this.toString()+" and other is "+a.toString());return!1},removed:function(a){console.log("removed not implemented")},update_display:function(){console.assert(!1,"update_display not implemented")},to_HTML:function(){console.assert(!1,"to_HTML not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},match_box:function(){return"not matched"},match_number:function(){return"not matched"}}}(window.TOONTALK);window.TOONTALK.backside=function(b){return{create:function(a){var h=Object.create(this),e=document.createElement("div"),g=$(e);g.addClass("toontalk-backside toontalk-side");h.get_element=function(){return e};h.get_widget=function(){return a};a.get_backside||(a.get_backside=function(){return h});a.drop_on||(a.drop_on=function(a,e,h){g.append(e);b.UTILITIES.set_position_absolute(e.get(0),!0,h);e.is(".toontalk-frontside")&&(e.addClass("toontalk-frontside-on-backside"),a.update_display());return!0});
a.removed||(a.removed=function(a,e,g){e.removeClass("toontalk-frontside-on-backside")});h.widget_dropped_on_me=function(a,e){var h=a.get_frontside(!0).get_element(),c=$(h);g.append(c);b.UTILITIES.set_position_absolute(h,!0,e);return!0};b.backside.associate_widget_with_backside_element(a,h,e);b.UTILITIES.drag_and_drop(g,a);g.resizable();$(e).on("DOMNodeInserted",function(a){var e=$(a.originalEvent.srcElement);e.is(".toontalk-frontside")&&e.parent().is(".toontalk-backside")&&(e.addClass("toontalk-frontside-on-backside"),
(e=e.data("owner"))&&e.update_display());a.stopPropagation()});$(e).on("DOMNodeRemoved",function(a){var e=$(a.originalEvent.srcElement);e.is(".toontalk-frontside")&&e.removeClass("toontalk-frontside-on-backside");a.stopPropagation()});return h},associate_widget_with_backside_element:function(a,h,e){$(e).data("owner",a);return a},remove:function(){$(this.get_element()).remove()},create_hide_button:function(a,h){var e=a.get_element(),g=$(e),e=$("<button>Hide</button>").button();e.addClass("toontalk-hide-backside-button");
e.click(function(){g.remove();h&&h.forget_backside&&h.forget_backside()});return e.get(0)},create_run_button:function(a,h){var e=a.get_element(),g=$(e),k=$("<button>Run</button>").button(),m=!0,b;k.addClass("toontalk-run-backside-button");k.click(function(){g.children(".toontalk-robot").each(function(c,a){if(b=$(a).data("owner"))m?(b.set_stopped(!1),b.run(h)):b.set_stopped(!0)});m?k.button("option","label","Stop"):k.button("option","label","Run");m=!m});return k.get(0)}}}(window.TOONTALK);window.TOONTALK.condition=function(b){return{create:function(a){var h=Object.create(this);h.items=a;return h},copy:function(){return this.create(this.items)},match:function(a){return this.items.match(a)}}}(window.TOONTALK);window.TOONTALK.frontside=function(b){return{create:function(a){var h=Object.create(this),e=document.createElement("div"),g=$(e);e.className+="toontalk-frontside toontalk-side";g.data("owner",a);b.UTILITIES.drag_and_drop(g,a);h.get_element=function(){return e};h.get_widget=function(){return a};g.click(function(h){var g=a.get_backside(),b,c;if(!g){b=$(e).parent();for(c=$(e);!b.is(".toontalk-backside");)c=b,b=b.parent();c=c.get(0);g=a.get_backside(!0);g=g.get_element();$(g).data("owner",a);$(g).css({left:c.offsetLeft+
c.offsetWidth,top:c.offsetTop});b.append(g);h.stopPropagation()}});return h},update_display:function(){return this.get_widget().update_display()},remove:function(){$(this.get_element()).remove()}}}(window.TOONTALK);window.TOONTALK.number=function(b){var a=Object.create(b.widget),h=function(a,e,c){var g="",h=100;e=(e-1)/e;if(c)for(c=0;1<=h&&c<a.length;)g=g+"<span class='toontalk-digit' style='font-size:"+h+"%'>"+a[c]+"</span>",c+=1,"-"!==a[c]&&(h*=e);else for(c=a.length-1;1<=h&&0<c;)g="<span class='toontalk-digit' style='font-size:"+h+"%'>"+a[c]+"</span>"+g,c-=1,"-"!==a[c]&&(h*=e);return g},e=function(a,g){if(a.length<=Math.round(g))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(5>
g)return"<span style='font-size: 80%'>"+e(a,1.25*g)+"</span>";var c=g/2;return h(a,c,!0)+h(a,c,!1)},g=function(a,e){e||(e=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof e&&"string"!==typeof e))return bigrat.fromValues(a,e);var c=bigrat.create();1===e?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&e.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(e.get_value())):bigrat.set(c,a,e);return c},k=function(a){switch(a){case "+":return"";
case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "^":return"^";default:return console.log("Number has an unsupported operator: "+a),""}};a.create=function(e,h,c){var k=Object.create(a),q=g(e,h),f="improper_fraction";c||(c="+");k.set_value=function(c,l){var d,a;q=c;l?this.update_display():(d=this.get_frontside(),a=this.get_backside(),d&&b.DISPLAY_UPDATES.add_dirty_side(d),a&&b.DISPLAY_UPDATES.add_dirty_side(a));b.debugging&&(this.debug_string=this.toString());return this};
k.get_value=function(){return q};k.set_format=function(c,l){f=c;l&&this.update_display();return this};k.get_operator=function(){return c};k.set_operator=function(a,l){c=a;l&&this.update_display();return this};k.get_format=function(){return f};return a.add_sides_functionality(k)};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,e,c){return this.set_value(g(a,e),c)};a.ONE=function(){return this.create(1)};a.ZERO=function(){return this.create(0)};a.copy=
function(){var e=a.create(this.get_value()[0],this.get_value()[1]);this.get_erased()&&e.set_erased(this.get_erased());this.get_operator()&&e.set_operator(this.get_operator());return e};a.is_number=function(){return!0};a.equals=function(a){return a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.update_display=function(){var a=this.get_frontside();if(a){var a=a.get_element(),e=$(a).parent().is(".toontalk-backside")?$(a):$(a).parent(),c=e.width(),
e=0.8*e.height(),c=this.to_HTML(c/(0.64*e),e,this.get_format(),!0,this.get_operator());a.firstChild||a.appendChild(document.createElement("div"));a.firstChild.innerHTML=c;$(a.firstChild).addClass("toontalk-widget")}};a.drop_on=function(a,e,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,c),c&&a.update_display(),this.remove(),!0;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,c);console.log("No handler for drop of "+this.toString()+" on "+a.toString())};a.number_dropped_on_me=
function(a,e,c,g){switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "^":return this.power(a);default:return console.log("Number received a number with unsupported operator: "+a.get_operator()),this}};a.add=function(a){this.set_value(bigrat.add(bigrat.create(),this.get_value(),a.get_value()));return this};a.subtract=function(a){this.set_value(bigrat.subtract(bigrat.create(),this.get_value(),a.get_value()));
return this};a.multiply=function(a){this.set_value(bigrat.multiply(bigrat.create(),this.get_value(),a.get_value()));return this};a.divide=function(a){this.set_value(bigrat.divide(bigrat.create(),this.get_value(),a.get_value()));return this};a.power=function(a){this.set_value(bigrat.power(bigrat.create(),this.get_value(),bigrat.toInteger(a.get_value())));return this};a.absolute_value=function(){this.set_value(bigrat.abs(bigrat.create(),this.get_value()));return this};a.is_zero=function(){return bigrat.equals(this.get_value(),
bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(){return("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};a.get_json=function(){return Object.getPrototypeOf(Object.getPrototypeOf(this)).get_json({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string()})};a.create_from_json=function(e){return a.create(e.numerator,e.denominator,e.operator)};a.to_HTML=function(a,
g,c,h,b){var f=!1!==h?" toontalk-top-level-number":"";b=b?k(b):"";a||(a=4);g||(g=16);0<b.length&&(a-=1);if(this.is_integer())return h=bigrat.toBigInteger(this.get_value()).toString(),'<div class="toontalk-number toontalk-integer'+f+'" style="font-size: '+g+'px;">'+b+e(h,a)+"</div>";if("improper_fraction"===c||!c)return a='<table class="toontalk-number toontalk-improper-fraction'+f+'" style="font-size: '+0.5*g+'px;"><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+e(this.numerator_string(),
2*a)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><hr class="toontalk-fraction-line"></td></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+e(this.denominator_string(),2*a)+"</td></tr></table>",""===b?a:"<table class='toontalk-operator-and-fraction'><tr><td>"+b+"</td><td>"+a+"</td></tr></table>";if("proper_fraction"===c){b=this.integer_part();if(b.is_zero())return this.to_HTML(a,g,"improper_fraction",h);h=
this.copy().subtract(b).absolute_value();return'<table class="toontalk-number toontalk-proper_fraction'+f+'" style="font-size: '+0.5*g+'px;"><tr><td class="toontalk-number toontalk-integer-part-of-proper-fraction">'+b.to_HTML(a,g,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-proper_fraction">'+h.to_HTML(a,g,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===c)return'<div class="toontalk-number toontalk-decimal'+f+'" style="font-size: '+g+'px;">'+b+
this.decimal_string(a)+"</div>"};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};
a.decimal_string=function(a){if(this.is_integer())return this.numerator_string();var g=this.copy(),c=g.integer_part(),k=c.toString();"0"===k&&this.is_negative()&&(k="-"+k);var b=g.subtract(c),g=Math.min(k.length,a/2),c=a-(g+0.5),f;a:{var n;f=2*c;var l="";n=b.absolute_value();b=n.get_value()[0];n=n.get_value()[1];for(var d=new BigInteger(10);f>l.length;)if(b=b.multiply(d),0>b.compare(n))l+="0";else if(l+=b.divide(n).toString(),b=b.remainder(n).multiply(d),b.isZero()){f=l;break a}f=l}f.length<c&&(g=
a-f.length,c=f.length);return e(k,g)+"<span class='toontalk-decimal-point' style='font-family: serif'>.</span>"+h(f,c,!0)};a.match=function(a){return this.get_erased()?a.match_with_any_number():a.match_with_this_number(this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){return a.equals(this)?"matched":"not matched"};return a}(window.TOONTALK);
window.TOONTALK.number_backside=function(b){return{create:function(a){var h=b.backside.create(a),e=h.get_element(),g=b.UTILITIES.create_text_input(a.numerator_string(),"toontalk-numerator-input","Numerator&nbsp;&nbsp;&nbsp;","Type here to edit the numerator"),k=b.UTILITIES.create_text_input(a.denominator_string(),"toontalk-denominator-input","Denominator","Type here to edit the denominator"),m=b.UTILITIES.create_radio_button("number_format","decimal","Decimal","Display number as a decimal."),p=b.UTILITIES.create_radio_button("number_format",
"proper_fraction","Proper fraction","Display number as a proper fraction with an integer part and a fraction."),c=b.UTILITIES.create_radio_button("number_format","improper_fraction","Improper fraction","Display number as a simple fraction."),s=b.UTILITIES.create_radio_button("operator","+","&plus;","Add me to what I'm dropped on."),q=b.UTILITIES.create_radio_button("operator","-","&minus;","Subtract me from what I'm dropped on."),f=b.UTILITIES.create_radio_button("operator","*","&times;","Multiply me with what I'm dropped on."),
n=b.UTILITIES.create_radio_button("operator","/","&divide;","Divide me into what I'm dropped on."),l=b.UTILITIES.create_radio_button("operator","^","Integer power","Use me as the number of times to multiply together what I'm dropped on."),d=function(){a.set_from_values(g.button.value.trim(),k.button.value.trim(),!0)},x=function(){a.set_format(b.UTILITIES.selected_radio_button(m.button,p.button,c.button).value,!0)},v=function(){a.set_operator(b.UTILITIES.selected_radio_button(s.button,q.button,f.button,
n.button,l.button).value,!0)},t=b.backside.create_run_button(h,a),r=b.backside.create_hide_button(h,a),y=b.UTILITIES.create_button_set(g.container,k.container),u=$(b.UTILITIES.create_horizontal_table(m.container,p.container,c.container)).buttonset().get(0),w=$(b.UTILITIES.create_horizontal_table(s.container,q.container,f.container,n.container,l.container)).buttonset().get(0),t=b.UTILITIES.create_button_set(t,r);e.appendChild(y);e.appendChild(u);e.appendChild(w);e.appendChild(t);g.button.onchange=
d;k.button.onchange=d;m.button.onchange=x;p.button.onchange=x;c.button.onchange=x;switch(a.get_format()){case "decimal":$(m.button).prop("checked",!0);break;case "improper_fraction":$(c.button).prop("checked",!0);break;case "proper_fraction":$(p.button).prop("checked",!0)}switch(a.get_operator()){case "+":$(s.button).prop("checked",!0);break;case "-":$(q.button).prop("checked",!0);break;case "*":$(f.button).prop("checked",!0);break;case "/":$(n.button).prop("checked",!0);break;case "^":$(l.button).prop("checked",
!0)}s.button.onchange=v;q.button.onchange=v;f.button.onchange=v;n.button.onchange=v;l.button.onchange=v;h.update_display=function(){var l=this.get_widget();$(g.button).val(l.numerator_string());$(k.button).val(l.denominator_string())};return h}}}(window.TOONTALK);window.TOONTALK.box=function(b){var a=Object.create(b.widget);a.create=function(h,e,g){var k=Object.create(a);g||(g=[]);k.get_size=function(){return h};k.set_size=function(a,e){h=a;g.length=h;e&&this.update_display();b.debugging&&(this.debug_string=this.toString());return this};k.get_horizontal=function(){return void 0===e?!0:e};k.set_horizontal=function(a,g){e=a;g&&this.update_display();return this};k.get_hole=function(a){return g[a]};k.set_hole=function(a,e,c){g[a]=e;c&&this.update_hole_display(a);
b.debugging&&(this.debug_string=this.toString())};return k.add_sides_functionality(k)};a.copy=function(){var h=a.create(this.get_size(),this.get_horizontal()),e=this.get_size(),g,k;for(g=0;g<e;g+=1)(k=this.get_hole(g))&&h.set_hole(g,k.copy());this.get_erased()&&h.set_erased(this.get_erased());return h};a.create_backside=function(){return b.box_backside.create(this)};a.equals=function(a){return a.equals_box(this)};a.equals_box=function(a){var e=this.get_size(),g,k,b;if(e!==a.get_size())return!1;for(g=
0;g<e;g+=1)if(k=this.get_hole(g),b=a.get_hole(g),!k&&b||k&&!b||k&&b&&!k.equals(b))return!1;return!0};a.match=function(a){return this.get_erased()?a.match_with_any_box?a.match_with_any_box():"not matched":a.match_with_this_box(this)};a.match_with_any_box=function(){return"matched"};a.match_with_this_box=function(a){var e=this.get_size(),g=[],k,b,p;if(e!==a.get_size())return"not matched";for(k=0;k<e;k+=1)if(p=a.get_hole(k)){b=this.get_hole(k);if(!b)return"not matched";b=p.match(b);if("not matched"===
b)return"not matched";"matched"!==b&&(g=0===g.length?b:g.concat(b))}return 0<g.length?g:"matched"};a.toString=function(){var a="",e=this.get_size(),g,b;for(g=0;g<e;g+=1)a=(b=this.get_hole(g))?a+b.toString():a+"_",g<e-1&&(a+=" | ");return"["+a+"]"};a.get_json=function(){var a=Object.getPrototypeOf(Object.getPrototypeOf(this)),e=[],g=this.get_size(),b;for(b=0;b<g;b+=1)this.get_hole(b)&&(e[b]=this.get_hole(b).get_json());return a.get_json({type:"box",contents:e,horizontal:this.get_horizontal()})};a.create_from_json=
function(h){return a.create(h.contents.length,h.horizontal,b.UTILITIES.create_array_from_json(h.contents))};a.to_HTML=function(){var a=this.get_horizontal(),e=a?"horizontal":"vertical",g="<table class='toontalk-box toontalk-box-"+e+"'>",b=this.get_size(),m;m=0===b?1:100/b;var p=a?" style='width:"+m+"%;'":"",c=a?"":" style='height:"+m+"%;'",g=g+("<tr"+c+">");for(m=0;m<b;m+=1)g+="<td class='toontalk-box-hole toontalk-box-hole-"+e+"'"+p+">",g+="<div class='toontalk-hole-about-to-be-replaced'>",g+="</td>",
a||(g+="</tr><tr"+c+">");a&&(g+="</tr>");return g+"</table>"};a.update_display=function(){if(this.visible()){var a=this.get_frontside().get_element(),e=this.to_HTML(),g=this;a.firstChild||a.appendChild(document.createElement("div"));a.firstChild.innerHTML=e;$(a.firstChild).addClass("toontalk-widget");$(".toontalk-hole-about-to-be-replaced").each(function(a,e){g.update_hole_display(a,e)})}};a.update_hole_display=function(a,e){if(this.visible()){var g=this.get_hole(a),k;g||(g=b.box_empty_hole.create(a,
this),this.set_hole(a,g));k=g.get_frontside(!0);e?(g=k.get_element(),e.parentNode.replaceChild(g,e),b.UTILITIES.set_position_absolute(g,!1),$(g).addClass("toontalk-frontside-in-box")):(e=g.get_frontside(!0).get_element(),g=this.get_frontside(),g=$(g.get_element()).find(".toontalk-box-hole").eq(a),g.append(e),b.UTILITIES.set_position_absolute(e,!1),$(e).addClass("toontalk-frontside-in-box"));k.update_display()}};a.empty_hole=function(a,e){this.set_hole(a,b.box_empty_hole.create(a,this),e)};a.dereference=
function(a){var e;if(a){e=a.get_index&&a.get_index();if("number"===typeof e&&(e=this.get_hole(e)))return a.next?e.dereference(a.next):e;console.log("box "+this.toString()+" unable to dereference path "+a.toString())}else return this};a.drop_on=function(a,e,g){if(a.box_dropped_on_me)return e=a.box_dropped_on_me(this,g),g&&a.update_display(),this.remove(),e;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,g);console.log("No handler for drop of "+this.toString()+" on "+a.toString())};a.box_dropped_on_me=
function(a,e){console.log("box on box not yet implemented");return!1};a.removed=function(a,e,g){e=this.get_size();var b;b=a.get_frontside();g=!!g;b&&$(b.get_element()).removeClass("toontalk-frontside-in-box");for(b=0;b<e;b+=1)if(a===this.get_hole(b))return this.empty_hole(b,g),this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"box hole "+a+(this.next?"; "+this.next.toString():"")},get_json:function(){return{type:"box_path",index:a,next:this.next&&this.next.get_json()}}}},
create_from_json:function(h){var e=a.path.create(h.index);h.next&&(e.next=b.UTILITIES.create_from_json(h.next));return e}};b.debugging&&(a.debug_string=this.toString());return a}(window.TOONTALK);
window.TOONTALK.box_backside=function(b){return{create:function(a){var h=b.backside.create(this),e=b.UTILITIES.create_text_input(a.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes."),g=b.UTILITIES.create_radio_button("box_orientation","horizontal","Left to right","Show box horizontally."),k=b.UTILITIES.create_radio_button("box_orientation","vertical","Top to bottom","Show box vertically."),m=function(){a.set_horizontal("horizontal"===b.UTILITIES.selected_radio_button(g.button,
k.button).value,!0)},p=h.get_element(),c=b.backside.create_hide_button(h,a),s=b.backside.create_run_button(h,a),c=b.UTILITIES.create_button_set(s,c);e.button.onchange=function(){a.set_size(parseInt(e.button.value.trim(),10),!0)};g.button.onchange=m;k.button.onchange=m;p.appendChild(e.container);p.appendChild($(b.UTILITIES.create_horizontal_table(g.container,k.container)).buttonset().get(0));a.get_horizontal()?g.button.checked=!0:k.button.checked=!0;p.appendChild(c);return h},update_display:function(){var a=
b.UTILITIES.get_first_child_with_class(this.get_element(),"toontalk-box-size-input"),h=this.get_widget();a.value=h.get_size().toString()}}}(window.TOONTALK);
window.TOONTALK.box_empty_hole=function(b){return{create:function(a,h){var e=Object.create(this),g=document.createElement("div");g.className="toontalk-empty-hole toontalk-frontside toontalk-side";e.get_frontside=function(){return g};e.update_display=function(){};e.get_frontside=function(){return this};e.get_element=function(){return g};e.widget_dropped_on_me=function(e){h.set_hole(a,e,!0);h.update_display()};e.get_json=function(){};e.copy=function(){return b.box_empty_hole.create(a,h)};$(g).on("drop",
function(e){var g=b.UTILITIES.data_transfer_json_object(e),g=$("#"+g.id_of_original_dragree);1<=g.length&&(h.set_hole(a,g.data("owner")),h.update_display(),e.stopPropagation())});$(g).data("owner",e);return e},toString:function(){return"_"}}}(window.TOONTALK);window.TOONTALK.robot=function(b){var a=Object.create(b.widget);a.create=function(h,e,g,k,m,p){var c=Object.create(this);g||(g="images/robot.png");k||(k=50);m||(m=50);c.get_bubble=function(){return h};c.get_body=function(){return e};c.get_image_url=function(){return g};c.set_image_url=function(a,c){g=a;c&&this.update_display()};c.get_width=function(){return k};c.set_width=function(a){k=a};c.get_height=function(){return m};c.set_height=function(a){m=a};c.get_description=function(){return p?p:c.toString()};
c.set_description=function(a,c){p=a;c&&this.update_display()};e.set_robot(c);b.debugging&&(c.debug_string=c.toString());return a.add_sides_functionality(c)};a.create_backside=function(){return b.robot_backside.create(this)};a.copy=function(){return this.create(this.get_bubble().copy(),this.get_body())};a.run=function(a,e){var g,k;if(this.stopped)return"not matched";g=this.get_bubble().match(a);switch(g){case "matched":return e||(e=b.QUEUE),e.enqueue({robot:this,context:a,queue:e}),g;case "not matched":return this.next_robot?
this.next_robot.run(a,e):g;default:for(k=0;k<g.length;k+=1)g[k].run_when_non_empty(this);return g}};a.set_stopped=function(a){this.stopped=a};a.run_actions=function(a,e){return this.get_body().run(a,e)};a.update_display=function(){var a=this.get_frontside(),e;a&&(e=a.get_element(),a=this.to_HTML(),e.firstChild||e.appendChild(document.createElement("div")),e.firstChild.innerHTML=a,$(e).addClass("toontalk-robot"),$(e.firstChild).addClass("toontalk-widget"))};a.to_HTML=function(){var a=this.get_description(),
a=a?"This robot "+a:"This is a "+this.toString();return"<img src='"+this.get_image_url()+"' width='"+this.get_width()+"px' height='"+this.get_height()+"' title='"+a+"'></img>"};a.toString=function(){return"when given something that matches"+(this.get_bubble().get_erased()?" an erased ":" a ")+this.get_bubble().toString()+" will "+this.get_body().toString()};a.get_json=function(){return Object.getPrototypeOf(Object.getPrototypeOf(this)).get_json({type:"robot",bubble:this.get_bubble().get_json(),body:this.get_body().get_json(),
image_url:this.get_image_url(),width:this.get_width(),height:this.get_height(),description:this.get_description()})};a.create_from_json=function(a){return b.robot.create(b.UTILITIES.create_from_json(a.bubble),b.UTILITIES.create_from_json(a.body),a.image_url,a.width,a.height,a.description)};return a}(window.TOONTALK);
window.TOONTALK.robot_backside=function(b){return{create:function(a){var h=b.backside.create(a),e=h.get_element(),g=b.UTILITIES.create_text_input(a.get_image_url(),"toontalk-image-url-input","Image URL","Type here to provide a URL for the appearance of this robot."),k=b.UTILITIES.create_text_input(a.get_description(),"toontalk-robot-description-input","Description","Type here to provide a better descprion of this robot."),m;m=b.backside.create_hide_button(h,a);var p=b.UTILITIES.create_button_set(m);
g.button.onchange=function(){a.set_image_url(g.button.value.trim(),!0)};k.button.onchange=function(){a.set_description(k.button.value.trim(),!0)};m=b.UTILITIES.create_vertical_table(k.container,g.container);$(m).css({width:"90%"});e.appendChild(m);e.appendChild(p);return h},update_display:function(){var a=b.UTILITIES.get_first_child_with_class(this.get_element(),"toontalk-image-url-input"),h=this.get_widget();a.value=h.get_image_url()}}}(window.TOONTALK);window.TOONTALK.DISPLAY_UPDATES=function(b){var a=[];return{add_dirty_side:function(b){var e;if(b.update_display){for(e=0;e<a.length;e+=1)if(a[e]===b)return;a.push(b)}},update_display:function(){var b;for(b=0;b<a.length;b+=1)a[b].update_display();a=[]}}}(window.TOONTALK);window.TOONTALK.actions=function(b){return{create:function(a){var b,e=Object.create(this);a||(a=[]);e.get_steps=function(){return a};e.get_robot=function(){return b};e.set_robot=function(e){b=e;for(e=0;e<a.length;e+=1)a[e].robot=b};return e},add:function(a){a.robot=this.get_robot();this.get_steps()[this.get_steps().length]=a},run:function(a,b){var e,g=this.get_steps();for(e=0;e<g.length;e++)g[e].run(a);this.get_robot().run(a,b)},toString:function(){var a="",b,e=this.get_steps();for(b=0;b<e.length;b++)a+=
e[b].toString(),b===e.length-2?a+=" and ":b<e.length-2&&(a+=", ");return a},get_json:function(){return{type:"body",steps:b.UTILITIES.get_json_of_array(this.get_steps())}},create_from_json:function(a){return b.actions.create(b.UTILITIES.create_array_from_json(a.steps))}}}(window.TOONTALK);window.TOONTALK.queue=function(b){return{create:function(){var a=Object.create(this);a.to_run=[];return a},enqueue:function(a){return this.to_run.push(a)},dequeue:function(){return this.to_run.shift()},maximum_run:1,paused:!1,run:function(a,h){for(var e,g=(new Date).getTime()+this.maximum_run,k=this;0<this.to_run.length;){if(this.paused)return;e=(new Date).getTime();if(e>=g)break;e=this.dequeue();e.robot.run_actions(e.context,e.queue);if(a&&(a-=1,0===a)){this.to_run=[];b.DISPLAY_UPDATES.update_display();
h&&h();return}}b.DISPLAY_UPDATES.update_display();setTimeout(function(){k.run(a,h)},0)}}}(window.TOONTALK);window.TOONTALK.QUEUE=window.TOONTALK.queue.create();window.TOONTALK.path_to_entire_context=function(b){return{toString:function(){return"the entire context"},get_json:function(){return{type:"path_to_entire_context"}},create_from_json:function(){return b.path_to_entire_context}}}(window.TOONTALK);window.TOONTALK.UTILITIES=function(b){var a={box:b.box.create_from_json,number:b.number.create_from_json,robot:b.robot.create_from_json,body:b.actions.create_from_json,pick_up_constant_action:b.pick_up_constant.create_from_json,pick_up_action:b.pick_up.create_from_json,drop_on_action:b.drop_on.create_from_json,copy_constant_action:b.copy_constant.create_from_json,copy_action:b.copy.create_from_json,box_path:b.box.path.create_from_json,path_to_entire_context:b.path_to_entire_context.create_from_json},
h=(new Date).getTime();return{create_from_json:function(e){var g;if(a[e.type])return(g=a[e.type](e))&&e.erased&&g.set_erased(e.erased),g;console.log("json type "+e.type+" not yet supported.")},create_array_from_json:function(a){var g=[],k;for(k=0;k<a.length;k+=1)a[k]&&(g[k]=b.UTILITIES.create_from_json(a[k]));return g},get_json_of_array:function(a){var g=[],b;for(b=0;b<a.length;b+=1)a[b]&&(a[b].get_json?g[b]=a[b].get_json():console.log("No get_json for "+a[b].toString()));return g},generate_unique_id:function(){h+=
1;return"toontalk_id_"+h},get_style_property:function(a,g){if(a.currentStyle)return a.currentStyle[g];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(g)},get_style_numeric_property:function(a,g){var b=this.get_style_property(a,g),h;return"string"===typeof b?(h=b.indexOf("px"),0<=h&&(b=b.substring(0,h)),parseInt(b,10)):b},get_first_child_with_class:function(a,g){var b;for(b=a.firstChild;b;b=b.nextSibling)if(b.className===g)return b},dereference_path:function(a,
g){var b;return a?((b=g.dereference(a))||console.log("Unable to dereference path: "+a.toString()+" in context: "+g.toString()),b):g},data_transfer_json_object:function(a){if(a.originalEvent.dataTransfer)if(a=a.originalEvent.dataTransfer.getData("application/json"))try{return JSON.parse(a)}catch(g){console.log("Exception parsing "+a+"\n"+g.toString())}else console.log("No data in dataTransfer in drop.");else console.log("no dataTransfer in drop event")},drag_and_drop:function(a){a.attr("draggable",
!0);a.on("dragstart",function(g){var h=a.parents(".toontalk-side:first").data("owner"),m=a.get(0).getBoundingClientRect(),p=b.UTILITIES.generate_unique_id(),c=a.data("owner");a.is(".toontalk-frontside")&&a.css({width:this.offsetWidth+"px",height:this.offsetHeight+"px"});a.attr("id",p);h&&h.removed(a.data("owner"),a,g);g.originalEvent.dataTransfer&&(g.originalEvent.dataTransfer.effectAllowed="move",h=c.get_json(),h.id_of_original_dragree=p,h.drag_x_offset=g.originalEvent.clientX-m.left,h.drag_y_offset=
g.originalEvent.clientY-m.top,a.parent().is(".toontalk-backside")?(h.original_width_fraction=a.outerWidth()/a.parent().outerWidth(),h.original_height_fraction=a.outerHeight()/a.parent().outerHeight()):(h.original_width_fraction=0.2,h.original_height_fraction=0.1),a.data("json",h),g.originalEvent.dataTransfer.setData("application/json",JSON.stringify(h)));g.stopPropagation()});a.on("dragend",function(g){if(a.is(".toontalk-frontside"))if(a.parent().is(".toontalk-backside")){var b=a.data("json");b&&
a.css({width:100*b.original_width_fraction+"%",height:100*b.original_height_fraction+"%"})}else a.css({width:"100%",height:"100%"});g.stopPropagation()});a.on("dragover",function(a){a.preventDefault();return!1});a.on("drop",function(a){var e,h,p,c,s,q;q=b.UTILITIES.data_transfer_json_object(a);var f;e=$("#"+q.id_of_original_dragree);p=$(a.target).closest(".toontalk-side");c=p.data("owner");1<=e.length?(h=e.data("owner"),e.is(".toontalk-top-level-resource")&&(s=h.copy(),f=s.get_frontside_element(!0),
e.removeClass("toontalk-top-level-resource"),$(f).addClass("toontalk-top-level-resource"),e.parent().append(f),s.update_display())):(h=b.UTILITIES.create_from_json(q),e=$(h.get_frontside_element()));p.is(".toontalk-backside")?(p=p.position(),q?(s=q.drag_x_offset,q=q.drag_y_offset):q=s=0,e.css({left:a.originalEvent.clientX-p.left-s,top:a.originalEvent.clientY-p.top-q}),c.get_backside().widget_dropped_on_me(h,a),a.stopPropagation()):c?h.drop_on(c,p,a)&&a.stopPropagation():console.log("target element has no 'owner'");
a.preventDefault()})},set_position_absolute:function(a,b,h){var m;if(b){if("absolute"!==a.style.position){if(h)for(b=h.clientX,h=h.clientY,m=a.parentElement;m;)b-=m.offsetLeft,h-=m.offsetTop,m=m.parentElement;else h=$(a).position(),b=h.left,h=h.top;$(a).css({left:b,top:h})}}else"relative"!==a.style.position&&(a.style.position="relative",a.style.left="0",a.style.top="0")},create_button_set:function(){var a=document.createElement("div"),b;for(b=0;b<arguments.length;b+=1)a.appendChild(arguments[b]);
$(a).buttonset();return a},create_text_input:function(a,g,h,m){var p=document.createElement("input");p.type="text";g&&(p.className=g);p.value=a;m&&(p.title=m);p.id=b.UTILITIES.generate_unique_id();a=document.createElement("label");a.innerHTML=h;a.htmlFor=p.id;h=document.createElement("div");h.appendChild(a);h.appendChild(p);$(p).button();$(a).button();return{container:h,button:p}},create_radio_button:function(a,g,h,m){var p=document.createElement("div"),c=document.createElement("input");c.type="radio";
c.className="toontalk-radio-button";c.name=a;c.value=g;c.id=b.UTILITIES.generate_unique_id();a=document.createElement("label");a.innerHTML=h;a.htmlFor=c.id;p.appendChild(c);p.appendChild(a);m&&(p.title=m);$(c).button();return{container:p,button:c,label:a}},create_horizontal_table:function(){var a=document.createElement("table"),b,h,m;h=document.createElement("tr");a.appendChild(h);for(b=0;b<arguments.length;b+=1)m=document.createElement("td"),h.appendChild(m),m.appendChild(arguments[b]);return a},
create_vertical_table:function(){var a=document.createElement("table"),b,h,m;for(b=0;b<arguments.length;b+=1)h=document.createElement("tr"),a.appendChild(h),m=document.createElement("td"),h.appendChild(m),m.appendChild(arguments[b]);return a},selected_radio_button:function(){var a;for(a=0;a<arguments.length;a+=1)if(arguments[a].checked)return arguments[a]}}}(window.TOONTALK);window.TOONTALK.tests=function(b){return{assert_equals:function(a,b,e){console.assert(a.equals(b),e+" Expected to be equal "+a.toString()+"="+b.toString())},random_integer_between:function(a,b){return Math.round(Math.random()*(b-a))+a},drop_numbers:function(a,h,e,g,k,m,p){a=b.number.create(h,e).set_operator(a);g=b.number.create(g,k);m=b.number.create(m,p);p=a.drop_on(g);this.assert_equals(p,m,"Dropping "+a+" on "+g+" should result in "+m);this.assert_equals(g,m,"Dropping "+a+" on "+g+" should update "+
g+" to "+m);this.assert_equals(a,b.number.create(h,e),"Dropping "+a+" on "+g+" should not update "+a)},create_sides:function(a,b,e){var g=a.get_backside(!0),k=a.get_frontside(!0).get_element(),g=g.get_element();k.style.top=e+"px";g.style.top=e+"px";k.className+=" toontalk-top-level-frontside";b.appendChild(g);b.appendChild(k);a.update_display()},add_or_duplicate_robot:function(a,h,e,g){var k=b.number.create(2);e&&this.create_sides(k,e);g||(g=100);e=h?this.double_robot():this.add_one_robot();a?a=h?
b.number.create(2).power(b.number.create(g+1)).toString():g+2:(e.get_bubble().set_erased(!1),a=3);this.test_robot(e,k,g,b.number.create(a));return this},test_robot:function(a,h,e,g,k){b.QUEUE.paused=!0;var m=b.queue.create(),p=h.copy();a.run(h,m);var c=this;m.run(e,function(){c.assert_equals(h,g,a.toString()+" when given "+p.toString()+" expected "+g.toString()+" not "+h.toString()+" when run "+e+" times. ");k&&k()})},accept_number_robot:function(){var a=b.actions.create(),h=b.number.create(1);h.set_erased(!0);
return b.robot.create(h,a)},accept_box_robot:function(a){var h=b.actions.create();a=b.box.create(a);a.set_erased(!0);return b.robot.create(a,h)},add_one_robot:function(){var a=this.accept_number_robot(),h=a.get_body();h.add(b.pick_up_constant.create(b.number.ONE()));h.add(b.drop_on.create(b.path_to_entire_context));a.set_description("adds one to what it is given");return a},double_robot:function(){var a=this.accept_number_robot(),h=a.get_body();h.add(b.copy.create(b.path_to_entire_context));h.add(b.drop_on.create(b.path_to_entire_context));
a.set_image_url("images/RB19.PNG");return a},copy_first_hole_to_second_hole_robot:function(){var a=this.accept_box_robot(2),h=a.get_body();h.add(b.copy.create(b.box.path.create(0)));h.add(b.drop_on.create(b.box.path.create(1)));a.set_image_url("images/RB45.PNG");return a},create_test_box:function(){var a=b.box.create(2);a.set_horizontal(!0);var h=b.number.create(1,49);h.set_operator("*");var e=b.number.create(19);a.set_hole(0,h);a.set_hole(1,e);a.update_display();return a},test_copy_first_hole_to_second_hole_robot:function(){var a=
this.copy_first_hole_to_second_hole_robot(),h=this.create_test_box(),e=document.createElement("div");e.className="toontalk-frontside";e.style.top="10px";var g=document.createElement("div");g.className="toontalk-frontside";e.style.top="200px";var k=document.createElement("div");e.appendChild(k);var m=document.createElement("div");g.appendChild(m);k.innerHTML=h.to_HTML();document.body.appendChild(e);e=h.copy();k=b.number.create(19,"79792266297612001");e.set_hole(1,k);this.test_robot(a,h,10,e,function(){m.innerHTML=
h.to_HTML();document.body.appendChild(g)})},robot_tests:function(){this.add_or_duplicate_robot();this.add_or_duplicate_robot(!0);this.add_or_duplicate_robot(!0,!0);b.tests.add_or_duplicate_robot(!0,!0,document.getElementById("test1_top_level_backside"),1E4);b.tests.add_or_duplicate_robot(!0,!1,document.getElementById("test1_top_level_backside"),1E4);b.tests.test_copy_first_hole_to_second_hole_robot()},number_tests:function(){this.drop_numbers("+",1,1,2,1,3,1);this.drop_numbers("-",1,1,3,1,2,1);this.drop_numbers("*",
2,1,3,1,6,1);this.drop_numbers("/",6,1,10,1,5,3);this.drop_numbers("^",2,1,3,1,9,1)},box_tests:function(){var a=b.box.create(2),h=b.box.create(1),e=b.box.create(1);e.set_erased(!0);var g=b.box.create(2);console.assert("matched"===g.match(a),"Empty box of size 2 should match empty box of size 2");console.assert(g.equals(a),"Empty box of size 2 should equal an empty box of size 2");console.assert("not matched"===h.match(a),"Empty box of size 1 should not match empty box of size 2");console.assert(!h.equals(a),
"Empty box of size 1 should not equal an empty box of size 2");console.assert("matched"===e.match(a),"Empty ERASED box of size 1 should match empty box of size 2");console.assert(!e.equals(a),"Empty ERASED box of size 1 should not equal an empty box of size 2");h=b.number.create(3);a.set_hole(0,h);console.assert("matched"===g.match(a),"Empty box of size 2 should match box of size 2 with number in first hole");h=b.number.create(3);g.set_hole(0,h);console.assert("matched"===g.match(a),"box of size 2 with 3 in first hole should match box of size 2 with 3 in first hole");
console.assert(g.equals(a),"box of size 2 with 3 in first hole should equal a box of size 2 with 3 in first hole");h=b.number.create(4);g.set_hole(1,h);console.assert("not matched"===g.match(a),"box of size 2 with 3 and 4 should not match box of size 2 with just 3 in first hole");h.set_erased(!0);console.assert("not matched"===g.match(a),"box of size 2 with 3 and erased 4 should not match box of size 2 with 3 in first hole");console.assert(!g.equals(a),"box of size 2 with 3 and erased 4 should not equal a box of size 2 with 3 in first hole");
e=b.number.create(5);a.set_hole(1,e);console.assert("matched"===g.match(a),"box of size 2 with 3 and erased 4 should match box of size 2 with 3 and 5");h.set_erased(!1);g.set_hole(1,h.copy());console.assert("not matched"===g.match(a),"box of size 2 with 3 and 4 should not match box of size 2 with 3 and 5");console.assert(!g.equals(a),"box of size 2 with 3 and 4 should not equal a box of size 2 with 3 and 5");a.set_hole(1,b.number.create(5));g.set_hole(1,b.number.create(5));console.assert("matched"===
g.match(a),"box of size 2 with 3 and 5 should match box of size 2 with 3 and 5");console.assert(g.equals(a),"box of size 2 with 3 and 5 should equal a box of size 2 with 3 and 5")},run:function(){this.number_tests();this.box_tests();this.robot_tests();return"All tests run."}}}(window.TOONTALK);window.TOONTALK.initialise=function(){$(document).ready(function(){var b=window.TOONTALK,a=b.backside.create({}).get_element(),h=$(a),e=b.number.create(1),g=e.get_frontside_element(),k=b.box.create(1),m=k.get_frontside_element(),p=b.tests.add_one_robot(),c=p.get_frontside_element(),s=b.tests.double_robot(),q=s.get_frontside_element(),f=b.tests.copy_first_hole_to_second_hole_robot(),n=f.get_frontside_element(),c=[g,m,c,q,n];$("#top-level-backside").append(a);h.css({width:"600px",height:"300px","background-color":"yellow",
position:"relative"});a.draggable=!1;b.debugging=!0;$("#a-number").append(g);e.update_display();$("#a-box").append(m);k.update_display();$("#add_one_robot").append(p.get_frontside(!0).get_element());p.update_display();$("#double_robot").append(s.get_frontside(!0).get_element());s.update_display();$("#copy_first_hole_to_second_hole_robot").append(f.get_frontside(!0).get_element());f.update_display();for(a=0;a<c.length;a+=1)$(c[a]).addClass("toontalk-top-level-resource"),$(c[a]).css({position:"relative"});
b.QUEUE.run()})};(function(b){var a;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(a={},define(function(){return a})):a="undefined"!==typeof window?window:b:a=exports;(function(a){var b={greatest_common_divisor:function(a,d){if(1===d||1===a)return 1;for(var c;0!==d;){c=d;d=a%d;if(!isFinite(d))return 0;a=c}return a}};b.gcd=b.greatest_common_divisor;b.fromRandom=function(a){return Math.random()*(1<<a)>>>0};b.fromMillitime=function(){return+new Date};b.fromUnixtime=
function(){return 0.001*b.fromMillitime()|0};"undefined"!==typeof a&&(a.integer=b);(function(a){function d(a,l,b){if(b!==c)return a instanceof d?a:"undefined"===typeof a?e:d.parse(a);for(a=a||[];a.length&&!a[a.length-1];)--a.length;this._d=a;this._s=a.length?l||1:0}var c={};d._construct=function(a,l){return new d(a,l,c)};var b=1E7;d.base=b;d.base_log10=7;var e=new d([],0,c);d.ZERO=e;var f=new d([1],1,c);d.ONE=f;var g=new d(f._d,-1,c);d.M_ONE=g;d._0=e;d._1=f;d.small=[e,f,new d([2],1,c),new d([3],1,
c),new d([4],1,c),new d([5],1,c),new d([6],1,c),new d([7],1,c),new d([8],1,c),new d([9],1,c),new d([10],1,c),new d([11],1,c),new d([12],1,c),new d([13],1,c),new d([14],1,c),new d([15],1,c),new d([16],1,c),new d([17],1,c),new d([18],1,c),new d([19],1,c),new d([20],1,c),new d([21],1,c),new d([22],1,c),new d([23],1,c),new d([24],1,c),new d([25],1,c),new d([26],1,c),new d([27],1,c),new d([28],1,c),new d([29],1,c),new d([30],1,c),new d([31],1,c),new d([32],1,c),new d([33],1,c),new d([34],1,c),new d([35],
1,c),new d([36],1,c)];d.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");d.prototype.toString=function(a){a=+a||10;if(2>a||36<a)throw Error("illegal radix "+a+".");if(0===this._s)return"0";if(10===a){a=0>this._s?"-":"";a+=this._d[this._d.length-1].toString();for(var l=this._d.length-2;0<=l;l--){for(var c=this._d[l].toString();7>c.length;)c="0"+c;a+=c}return a}l=d.digits;a=d.small[a];for(var c=this._s,b=this.abs(),e=[],f;0!==b._s;)f=b.divRem(a),b=f[0],f=f[1],e.push(l[f.valueOf()]);return(0>
c?"-":"")+e.reverse().join("")};d.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,
/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];d.parse=function(a,l){function b(a){a=a.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return a.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(a,l,d,c,b){b=+b;var e=0>b,f=d.length+b;a=(e?d:c).length;b=(b=Math.abs(b))>=a?b-a+e:0;a=Array(b+1).join("0");d+=c;return(l||"")+(e?d=a+d:d+=a).substr(0,f+=e?a.length:0)+(f<d.length?"."+d.substr(f):"")})}a=a.toString();if("undefined"===typeof l||10===+l)a=b(a);var f=
RegExp("^([+\\-]?)("+("undefined"===typeof l?"0[xcb]":16==l?"0x":8==l?"0c":2==l?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i").exec(a);if(f){var g=f[1]||"+",h=f[2]||"",f=f[3]||"";if("undefined"===typeof l)l="0x"===h||"0X"===h?16:"0c"===h||"0C"===h?8:"0b"===h||"0B"===h?2:10;else if(2>l||36<l)throw Error("Illegal radix "+l+".");l=+l;if(!d.radixRegex[l].test(f))throw Error("Bad digit for radix "+l);f=f.replace(/^0+/,"").split("");if(0===f.length)return e;g="-"===g?-1:1;if(10==l){for(h=[];7<=f.length;)h.push(parseInt(f.splice(f.length-
d.base_log10,d.base_log10).join(""),10));h.push(parseInt(f.join(""),10));return new d(h,g,c)}h=e;l=d.small[l];for(var k=d.small,v=0;v<f.length;v++)h=h.multiply(l).add(k[parseInt(f[v],36)]);return new d(h._d,g,c)}throw Error("Invalid BigInteger format: "+a);};d.prototype.add=function(a){if(0===this._s)return d(a);a=d(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.subtract(a);var l=this._d;a=a._d;for(var e=l.length,f=a.length,g=Array(Math.max(e,f)+1),h=Math.min(e,f),k=0,t=0;t<
h;t++)k=l[t]+a[t]+k,g[t]=k%b,k=k/b|0;f>e&&(l=a,e=f);for(t=h;k&&t<e;t++)k=l[t]+k,g[t]=k%b,k=k/b|0;for(k&&(g[t]=k);t<e;t++)g[t]=l[t];return new d(g,this._s,c)};d.prototype.negate=function(){return new d(this._d,-this._s|0,c)};d.prototype.abs=function(){return 0>this._s?this.negate():this};d.prototype.subtract=function(a){if(0===this._s)return d(a).negate();a=d(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.add(a);var l=this;0>this._s&&(l=new d(a._d,1,c),a=new d(this._d,1,c));
var f=l.compareAbs(a);if(0===f)return e;if(0>f){var g=a;a=l;l=g}l=l._d;a=a._d;var g=l.length,h=a.length,k=Array(g),m=0,r,n;for(r=0;r<h;r++)n=l[r]-m-a[r],0>n?(n+=b,m=1):m=0,k[r]=n;for(r=h;r<g;r++){n=l[r]-m;if(0>n)n+=b;else{k[r++]=n;break}k[r]=n}for(;r<g;r++)k[r]=l[r];return new d(k,f,c)};(function(){function a(l,e){for(var f=l._d,g=f.slice(),h=0;;){var w=(f[h]||0)+1;g[h]=w%b;if(w<=b-1)break;++h}return new d(g,e,c)}function l(a,e){for(var f=a._d,g=f.slice(),h=0;;){var w=(f[h]||0)-1;if(0>w)g[h]=w+b;
else{g[h]=w;break}++h}return new d(g,e,c)}d.prototype.next=function(){switch(this._s){case 0:return f;case -1:return l(this,-1);default:return a(this,1)}};d.prototype.prev=function(){switch(this._s){case 0:return g;case -1:return a(this,-1);default:return l(this,1)}}})();d.prototype.compareAbs=function(a){if(this===a)return 0;if(!(a instanceof d)){if(!isFinite(a))return isNaN(a)?a:-1;a=d(a)}if(0===this._s)return 0!==a._s?-1:0;if(0===a._s)return 1;var l=this._d.length,c=a._d.length;if(l<c)return-1;
if(l>c)return 1;c=this._d;a=a._d;for(l-=1;0<=l;l--)if(c[l]!==a[l])return c[l]<a[l]?-1:1;return 0};d.prototype.compare=function(a){if(this===a)return 0;a=d(a);return 0===this._s?-a._s:this._s===a._s?this.compareAbs(a)*this._s:this._s};d.prototype.isUnit=function(){return this===f||this===g||1===this._d.length&&1===this._d[0]};d.prototype.multiply=function(a){if(0===this._s)return e;a=d(a);if(0===a._s)return e;if(this.isUnit())return 0>this._s?a.negate():a;if(a.isUnit())return 0>a._s?this.negate():
this;if(this===a)return this.square();var l=this._d.length>=a._d.length,f=(l?this:a)._d,l=(l?a:this)._d,g=f.length,h=l.length,k=g+h,r=Array(k),m;for(m=0;m<k;m++)r[m]=0;for(m=0;m<h;m++){for(var k=0,n=l[m],p=g+m,u,q=m;q<p;q++)u=r[q]+n*f[q-m]+k,k=u/b|0,r[q]=u%b|0;k&&(u=r[q]+k,r[q]=u%b)}return new d(r,this._s*a._s,c)};d.prototype.multiplySingleDigit=function(a){if(0===a||0===this._s)return e;if(1===a)return this;var l;if(1===this._d.length)return l=this._d[0]*a,l>=b?new d([l%b|0,l/b|0],1,c):new d([l],
1,c);if(2===a)return this.add(this);if(this.isUnit())return new d([a],1,c);var f=this._d,g=f.length;l=g+1;for(var h=Array(l),k=0;k<l;k++)h[k]=0;for(var m=k=0;m<g;m++)l=a*f[m]+k,k=l/b|0,h[m]=l%b|0;k&&(h[m]=k);return new d(h,1,c)};d.prototype.square=function(){if(0===this._s)return e;if(this.isUnit())return f;var a=this._d,l=a.length,g=Array(l+l+1),h,k,m,n;for(n=0;n<l;n++)m=2*n,h=a[n]*a[n],k=h/b|0,g[m]=h%b,g[m+1]=k;for(n=0;n<l;n++){k=0;m=2*n+1;for(var p=n+1;p<l;p++,m++)h=a[p]*a[n]*2+g[m]+k,k=h/b|0,
g[m]=h%b;m=l+n;h=k+g[m];k=h/b|0;g[m]=h%b;g[m+1]+=k}return new d(g,1,c)};d.prototype.quotient=function(a){return this.divRem(a)[0]};d.prototype.divide=d.prototype.quotient;d.prototype.remainder=function(a){return this.divRem(a)[1]};d.prototype.divRem=function(a){a=d(a);if(0===a._s)throw Error("Divide by zero");if(0===this._s)return[e,e];if(1===a._d.length)return this.divRemSmall(a._s*a._d[0]);switch(this.compareAbs(a)){case 0:return[this._s===a._s?f:g,e];case -1:return[e,this]}var l=this._s*a._s,h=
a.abs(),k=this._d,m=k.length,n=[],p,q=new d([],0,c);for(q._s=1;m;)if(q._d.unshift(k[--m]),0>q.compareAbs(a))n.push(0);else{if(0===q._s)p=0;else{var u=q._d.length;p=h._d.length;u=q._d[u-1]*b+q._d[u-2];p=h._d[p-1]*b+h._d[p-2];q._d.length>h._d.length&&(u=(u+1)*b);p=Math.ceil(u/p)}do{u=h.multiplySingleDigit(p);if(0>=u.compareAbs(q))break;p--}while(p);n.push(p);p&&(p=q.subtract(u),q._d=p._d.slice(),0===q._d.length&&(q._s=0))}return[new d(n.reverse(),l,c),new d(q._d,this._s,c)]};d.prototype.divRemSmall=
function(a){a=+a;if(0===a)throw Error("Divide by zero");var l=this._s*(0>a?-1:1);a=Math.abs(a);if(1>a||a>=b)throw Error("Argument out of range");if(0===this._s)return[e,e];if(1===a||-1===a)return[1===l?this.abs():new d(this._d,l,c),e];if(1===this._d.length){var f=new d([this._d[0]/a|0],1,c);a=new d([this._d[0]%a|0],1,c);0>l&&(f=f.negate());0>this._s&&(a=a.negate());return[f,a]}for(var g=this._d.slice(),f=Array(g.length),h=0,k=0,m=0,n;g.length;)h=h*b+g[g.length-1],h<a?(f[m++]=0,g.pop(),k=b*k+h):(n=
0===h?0:h/a|0,k=h-a*n,(f[m++]=n)?(g.pop(),h=k):g.pop());a=new d([k],1,c);0>this._s&&(a=a.negate());return[new d(f.reverse(),l,c),a]};d.prototype.isEven=function(){var a=this._d;return 0===this._s||0===a.length||0===a[0]%2};d.prototype.isOdd=function(){return!this.isEven()};d.prototype.sign=function(){return this._s};d.prototype.isPositive=function(){return 0<this._s};d.prototype.isNegative=function(){return 0>this._s};d.prototype.isZero=function(){return 0===this._s};d.prototype.exp10=function(a){a=
+a;if(0===a)return this;if(Math.abs(a)>Number(h))throw Error("exponent too large in BigInteger.exp10");if(0<a){for(var l=new d(this._d.slice(),this._s,c);7<=a;a-=7)l._d.unshift(0);if(0==a)return l;l._s=1;l=l.multiplySingleDigit(Math.pow(10,a));return 0>this._s?l.negate():l}if(-a>=7*this._d.length)return e;l=new d(this._d.slice(),this._s,c);for(a=-a;7<=a;a-=7)l._d.shift();return 0==a?l:l.divRemSmall(Math.pow(10,a))[0]};d.prototype.pow=function(a){if(this.isUnit())return 0<this._s?this:d(a).isOdd()?
this:this.negate();a=d(a);if(0===a._s)return f;if(0>a._s){if(0===this._s)throw Error("Divide by zero");return e}if(0===this._s)return e;if(a.isUnit())return this;if(0<a.compareAbs(h))throw Error("exponent too large in BigInteger.pow");for(var l=this,c=f,b=d.small[2];a.isPositive()&&(!a.isOdd()||(c=c.multiply(l),!a.isUnit()));)l=l.square(),a=a.quotient(b);return c};d.prototype.modPow=function(a,l){for(var c=f,b=this;a.isPositive();)a.isOdd()&&(c=c.multiply(b).remainder(l)),a=a.quotient(d.small[2]),
a.isPositive()&&(b=b.square().remainder(l));return c};d.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var a=this._d.length;if(30>7*a)return Math.log(this.valueOf());var l=Math.ceil(30/7),f=this._d.slice(a-l);return Math.log((new d(f,1,c)).valueOf())+(a-l)*Math.log(b)};d.prototype.valueOf=function(){return parseInt(this.toString(),10)};d.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var h=d(2147483647);d.MAX_EXP=h;(function(){function a(l){return function(a){return l.call(d(a))}}
function l(a){return function(l,c){return a.call(d(l),d(c))}}function c(a){return function(l,c,b){return a.call(d(l),d(c),d(b))}}(function(){var b,f,e="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),g="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),h=["modPow"];for(b=0;b<e.length;b++)f=e[b],d[f]=a(d.prototype[f]);for(b=0;b<g.length;b++)f=g[b],d[f]=l(d.prototype[f]);for(b=0;b<h.length;b++)f=
h[b],d[f]=c(d.prototype[f]);d.exp10=function(a,l){return d(a).exp10(l)}})()})();a.BigInteger=d})("undefined"!==typeof a?a:this);var g={greatest_common_divisor:function(a,d){if(d.isUnit()||a.isUnit())return BigInteger.ONE;for(var c;!d.isZero();)c=d,d=a.remainder(d),a=c;return a},create:function(){return[0]},clone:function(a){for(var d=[],c=0,b=a.length;c<b;c++)d[c]=a[c];return d},copy:function(a,d){a=[];for(var c=0,b=d.length;c<b;c++)a[c]=d[c];return a},abs:function(a,d){a[0]=Math.abs(d[0]);return a},
str:function(a){return a[0].toString()},toInteger:function(a){return out[0]},fromInteger:function(a){return[parseInt(a)]}};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);"undefined"!==typeof a&&(a.bigint=g);if(!k)var k=Array;if(!m)var m=Math.pow(2,56);if(!p)var p=16777216;var c={EPSILON:2E-16};c.MAX_LOOPS=p;c.create=function(){var a=new k(2);a[0]=0;a[1]=1;return a};c.clone=function(a){var d=new k(2);d[0]=a[0];d[1]=a[1];return d};c.fromValues=function(a,d){var b=new k(2);b[0]=a;b[1]=d;return c.normalize(b,
b)};c.copy=function(a,d){a[0]=d[0];a[1]=d[1];return a};c.set=function(a,d,b){a[0]=d;a[1]=b;return c.normalize(a,a)};c.abs=function(a,d){a[0]=Math.abs(d[0]);a[1]=d[1];return a};c.invert=function(a,d){var c=d[0];a[0]=d[1];a[1]=c;return a};c.reciprocal=c.invert;c.add=function(a,d,b){d[1]===b[1]?(a[0]=d[0]+b[0],a[1]=d[1]):(a[0]=d[0]*b[1]+b[0]*d[1],a[1]=d[1]*b[1]);return c.normalize(a,a)};c.subtract=function(a,d,b){d[1]===b[1]?(a[0]=d[0]-b[0],a[1]=d[1]):(a[0]=d[0]*b[1]-b[0]*d[1],a[1]=d[1]*b[1]);return c.normalize(a,
a)};c.sub=c.subtract;c.multiply=function(a,d,b){a[0]=d[0]*b[0];a[1]=d[1]*b[1];return c.normalize(a,a)};c.mul=c.multiply;c.mediant=function(a,d,b){a[0]=d[0]+b[0];a[1]=d[1]+b[1];return c.normalize(a,a)};c.divide=function(a,d,b){a[0]=d[0]*b[1];a[1]=d[1]*b[0];return c.normalize(a,a)};c.div=c.divide;c.equals=function(a,d){return 0===a[0]&&0===d[0]||0===a[1]&&0===d[1]?!0:a[0]===d[0]&&a[1]===d[1]};c.approximates=function(a,d){if(c.equals(a,d))return!0;var b=c.create();c.sub(b,a,d);c.abs(b,b);return c.isLessThan(b,
c.INFINITESIMAL)};c.isGreaterThan=function(a,d){return c.equals(a,d)?!1:a[0]*d[1]>d[0]*a[1]};c.isLessThan=function(a,d){return c.equals(a,d)?!1:a[0]*d[1]<d[0]*a[1]};c.isNegative=function(a){return 0>a[0]};c.min=function(a,d,b){c.isLessThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};c.max=function(a,d,b){c.isGreaterThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};c.scalar_multiply=function(a,d,b){a[0]=d[0]*b;a[1]=d[1];return c.normalize(a,a)};c.scalar_divide=function(a,
d,b){a[0]=d[0];a[1]=d[1]*b;return c.normalize(a,a)};c.normalize=function(a,d){if(isNaN(d[0])||isNaN(d[1])||0===d[0]&&0===d[1])return a[0]=0,a[1]=0,a;if(0===d[0])return a[0]=0,a[1]=1,a;if(0===d[1])return a[0]=1,a[1]=0,a;if(d[0]===d[1])return a[0]=1,a[1]=1,a;0<d[1]?(a[0]=d[0],a[1]=d[1]):(a[0]=-d[0],a[1]=-d[1]);var c=b.greatest_common_divisor(Math.abs(a[0]),a[1]);1<c&&(a[0]/=c,a[1]/=c);return a};c.opposite=function(a,d){a[0]=-d[0];a[1]=d[1];return a};c.negative=c.opposite;c.neg=c.opposite;c.power=function(a,
d,b){2===b?(a[0]=d[0]*d[0],a[1]=d[1]*d[1]):0<b?(a[0]=Math.pow(d[0],b),a[1]=Math.pow(d[1],b)):0>b?(b=Math.abs(b),a[0]=Math.pow(d[1],b),a[1]=Math.pow(d[0],b)):c.copy(a,c.ONE);return c.normalize(a,a)};c.pow=c.power;c.sqrt=function(a,d){return c.nthRoot(a,d,2)};c.nthRoot=function(a,d,b){if(c.equals(d,c.ZERO))return c.copy(a,c.ZERO);if(c.equals(d,c.ONE))return c.copy(a,c.ONE);if(c.equals(d,c.INFINITY))return c.copy(a,c.INFINITY);if(c.equals(d,c.INFINULL))return c.copy(a,c.INFINULL);var f=c.isNegative(d);
f&&(d[0]=-d[0]);a=c.copy(a,c.ONE);for(var e=[1,0,0,1],g=c.clone(c.ONE),h=c.MAX_LOOPS;!c.approximates(d,g)&&h--;)c.isLessThan(d,g)?(e[0]+=e[1],e[2]+=e[3]):(e[1]+=e[0],e[3]+=e[2]),a[0]=e[0]+e[1],a[1]=e[2]+e[3],c.pow(g,a,b);f&&(d[0]=-d[0],1===b%2&&c.neg(a,a));return a};c.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]};c.str=function(a){return 1===a[1]?a[0].toString():a[0]+"/"+a[1]};c.toDecimal=function(a){return a[0]/a[1]};c.dec=c.toDecimal;c.toInteger=function(a){return Math.round(c.toDecimal(a))};c.round=
c.toInteger;c.floor=function(a){return Math.floor(c.toDecimal(a))};c.ceil=function(a){return Math.ceil(c.toDecimal(a))};c.fromInteger_copy=function(a,d){a[0]=parseInt(d);a[1]=1;return a};c.fromInteger=function(a){return c.fromInteger_copy(c.create(),a)};c.fromIntegerInverse_copy=function(a,d){a[0]=1;a[1]=parseInt(d);0>a[1]&&(a[0]=-a[0],a[1]=-a[1]);return a};c.fromIntegerInverse=function(a){return c.fromIntegerInverse_copy(c.create(),a)};c.fromDecimal=function(a){return c.fromDecimal_copy(c.create(),
a)};c.fromDecimal_copy=function(a,d){d=parseFloat(d);if(isNaN(d))return c.copy(a,c.INFINULL);if(Infinity===d)return c.copy(a,c.INFINITY);if(Math.abs(d)<c.EPSILON)return c.copy(a,c.ZERO);if(Math.abs(d-1)<c.EPSILON)return c.copy(a,c.ONE);if(Math.abs(d%1)<c.EPSILON)return c.fromInteger_copy(a,d);if(Math.abs(1/d%1)<c.EPSILON)return c.fromIntegerInverse_copy(a,Math.round(1/d));c.copy(a,c.ONE);for(var b=[1,0,0,1],f=d,e=1,g=c.MAX_LOOPS;g--&&Math.abs(d-c.toDecimal(a))>c.EPSILON;)e=Math.floor(f),a[0]=e*b[0]+
b[2],a[1]=e*b[1]+b[3],f=1/(f-e),b[2]=b[0],b[3]=b[1],b[0]=a[0],b[1]=a[1];return a};c.fromRandom=function(a){a[0]=0xfffffffffffff*Math.random()<<0;a[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return c.normalize(a,a)};c.sin=function(a,d){if(0===d[1])return c.copy(a,c.ZERO);c.scalar_multiply(a,d,2);var b=c.create();c.pow(b,d,2);c.add(b,b,c.ONE);c.divide(a,a,b);return a};c.cos=function(a,d){if(0===d[1])return c.neg(a,c.ONE);var b=c.create();c.pow(b,d,2);c.sub(a,c.ONE,b);var f=c.create();c.add(f,c.ONE,
b);c.divide(a,a,f);return a};c.tan=function(a,d){c.scalar_multiply(a,d,2);var b=c.create();c.pow(b,d,2);c.scalar_multiply(b,b,2);c.add(a,a,b);c.pow(b,d,4);c.sub(b,c.ONE,b);c.divide(a,a,b);return a};c.toEgyptian=function(a){a=c.clone(a);c.abs(a,a);var d=c.floor(a);d&&c.sub(a,a,c.fromInteger(d));if(!a[0])return d.toString();d||(d="");for(var b=1,f=c.create();1!==a[0];)b++,f=c.fromValues(1,b),c.isGreaterThan(a,f)&&(d&&(d+=" + "),d+=c.str(f),c.sub(a,a,f));return a?d?d+" + "+c.str(a):c.str(a):d?d:"0"};
c.toBabylonian=function(a){var d="",b=c.toDecimal(a);a=parseInt(b);for(var b=b-a,f=0,e=0;0<a;)(f=a%60)&&(d=f+" * 60^"+e+(d?" + ":"")+d),a=(a-f)/60,e++;for(e=-1;0<b;)b*=60,f=parseInt(b+1E-13),b-=f,-1E-13>b||(f&&(d+=(d?" + ":"")+f+" * 60^"+e),e--);return d?d:"0"};c.traceSternBrocot=function(a){var d="";if(c.equals(a,c.ZERO)||c.equals(a,c.ONE)||c.equals(a,c.INFINITY)||c.equals(a,c.INFINULL))return d;if(c.equals(a,c.ZERO))return c.copy(out,c.ZERO);if(c.equals(a,c.ONE))return c.copy(out,c.ONE);if(c.equals(a,
c.INFINITY))return c.copy(out,c.INFINITY);if(c.equals(a,c.INFINULL))return c.copy(out,c.INFINULL);a=c.clone(a);c.isNegative(a)&&(a[0]=-a[0]);for(var b=c.clone(c.ONE),f=[1,0,0,1],e=0,g=0,h=c.MAX_LOOPS;!c.approximates(a,b)&&h--;)c.isLessThan(a,b)?(f[0]+=f[1],f[2]+=f[3],g++,e&&(d+="R",1!==e&&(d+=e),e=0,d+=" ")):(f[1]+=f[0],f[3]+=f[2],e++,g&&(d+="L",1!==g&&(d+=g),g=0,d+=" ")),b[0]=f[0]+f[1],b[1]=f[2]+f[3];g?(d+="L",1!==g&&(d+=g)):e&&(d+="R",1!==e&&(d+=e));0>h&&(d+="...");return d};c.toContinuedFraction=
function(a,d){d="undefined"===typeof d?65536:parseInt(d);if(c.equals(a,c.ZERO))return[0];if(c.equals(a,c.ONE))return[1];if(c.equals(a,c.NEGONE))return[-1];if(c.equals(a,c.INFINITY))return[1,0];if(c.equals(a,c.INFINULL))return[0,0];var b=c.clone(a),f=c.isNegative(b);f&&(b[0]=-b[0]);for(var e=c.clone(c.ONE),g=[1,0,0,1],h=1,k=[0],m=k.length-1;!c.equals(b,e)&&d--;)c.isLessThan(b,e)?(-1===h?k[m]++:(h=-1,k.push(1),m++),g[0]+=g[1],g[2]+=g[3]):(1===h?k[m]++:(h=1,k.push(1),m++),g[1]+=g[0],g[3]+=g[2]),e[0]=
g[0]+g[1],e[1]=g[2]+g[3];0>d?k.push(0):k[m]++;if(f)for(var n in k)k[n]=-k[n];return k};c.fromContinuedFraction=function(a,d){c.fromInteger_copy(a,d[d.length-1]);for(var b=d.length-2;-1<b;b--)c.invert(a,a),c.add(a,c.fromInteger(d[b]),a);return a};c.dump=function(a){c.create();return"rat\t"+c.str(a)+"\n~\t"+c.toDecimal(a)+"\nCF:\t["+c.toContinuedFraction(a)+"]\n"};c.ZERO=c.fromInteger(0);c.ONE=c.fromInteger(1);c.NEGONE=c.fromInteger(-1);c.INFINITY=c.fromValues(1,0);c.INFINULL=c.fromValues(0,0);c.INFINITESIMAL=
c.clone([1,m]);c.PI=c.fromValues(1320192667429,420230377710);"undefined"!==typeof a&&(a.rat=c);if(!s)var s=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!q)var q=1073741824;var f={EPSILON:2E-16};f.MAX_LOOPS=q;f.create=function(){var a=[];a[0]=BigInteger.ZERO;a[1]=BigInteger.ONE;return a};f.clone=function(a){var d=[];d[0]=a[0];d[1]=a[1];return d};f.fromValues=function(a,d){var b=[];b[0]=new BigInteger(a);b[1]=new BigInteger(d);return f.normalize(b,b)};f.copy=function(a,d){a[0]=d[0];a[1]=
d[1];return a};f.set=function(a,d,b){a[0]=d;a[1]=b;return f.normalize(a,a)};f.toRat=function(a,d){return c.set(a,d[0].toJSValue(),d[1].toJSValue())};f.fromRat=function(a,d){return f.set(a,BigInteger(d[0]),BigInteger(d[1]))};f.abs=function(a,d){a[0]=d[0].abs();a[1]=d[1];return a};f.invert=function(a,d){var b=d[0];a[0]=d[1];a[1]=b;return a};f.reciprocal=f.invert;f.add=function(a,d,b){0===d[1].compare(b[1])?(a[0]=d[0].add(b[0]),a[1]=d[1]):(a[0]=d[0].multiply(b[1]).add(b[0].multiply(d[1])),a[1]=d[1].multiply(b[1]));
return f.normalize(a,a)};f.subtract=function(a,d,b){0===d[1].compare(b[1])?(a[0]=d[0].subtract(b[0]),a[1]=d[1]):(a[0]=d[0].multiply(b[1]).subtract(b[0].multiply(d[1])),a[1]=d[1].multiply(b[1]));return f.normalize(a,a)};f.sub=f.subtract;f.multiply=function(a,d,b){a[0]=d[0].multiply(b[0]);a[1]=d[1].multiply(b[1]);return f.normalize(a,a)};f.mul=f.multiply;f.mediant=function(a,d,b){a[0]=d[0].add(b[0]);a[1]=d[1].add(b[1]);return f.normalize(a,a)};f.divide=function(a,d,b){a[0]=d[0].multiply(b[1]);a[1]=
d[1].multiply(b[0]);return f.normalize(a,a)};f.div=f.divide;f.equals=function(a,d){return a[0].isZero()&&d[0].isZero()||a[1].isZero()&&d[1].isZero()?!0:0===a[0].compare(d[0])&&0===a[1].compare(d[1])};f.approximates=function(a,d){if(f.equals(a,d))return!0;var b=f.create();f.sub(b,a,d);f.abs(b,b);return f.isLessThan(b,f.INFINITESIMAL)};f.isGreaterThan=function(a,d){return f.equals(a,d)?!1:0<a[0].multiply(d[1]).compare(d[0].multiply(a[1]))};f.isLessThan=function(a,d){return f.equals(a,d)?!1:0>a[0].multiply(d[1]).compare(d[0].multiply(a[1]))};
f.isNegative=function(a){return a[0].isNegative()};f.min=function(a,d,b){f.isLessThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};f.max=function(a,d,b){f.isGreaterThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};f.scalar_multiply=function(a,d,b){a[0]=d[0].multiply(b);a[1]=d[1];return f.normalize(a,a)};f.scalar_divide=function(a,d,b){a[0]=d[0];a[1]=d[1].multiply(b);return f.normalize(a,a)};f.normalize=function(a,d){if(d[0].isZero()||d[1].isZero())return d;if(0===d[0].compare(d[1]))return f.clone(f.ONE);
if(d[1].isNegative())a[0]=d[0].negate(),a[1]=d[1].negate();else if(a[0]=d[0],a[1]=d[1],a[1].isZero())return a;var b=g.greatest_common_divisor(a[0].abs(),a[1]);0<b.compare(BigInteger.ONE)&&(a[0]=a[0].quotient(b),a[1]=a[1].quotient(b));return a};f.opposite=function(a,d){a[0]=d[0].negate();a[1]=d[1];return a};f.negative=f.opposite;f.neg=f.opposite;f.power=function(a,d,b){2===b?(a[0]=d[0].square(),a[1]=d[1].square()):0<b?(a[0]=d[0].pow(b),a[1]=d[1].pow(b)):0>b?(b=Math.abs(b),a[0]=d[1].pow(b),a[1]=d[0].pow(b)):
f.copy(a,f.ONE);return a};f.pow=f.power;f.sqrt=function(a,d){return f.nthRoot(a,d,2)};f.nthRoot=function(a,d,b){if(f.equals(d,f.ZERO))return f.copy(a,f.ZERO);if(f.equals(d,f.ONE))return f.copy(a,f.ONE);if(f.equals(d,f.INFINITY))return f.copy(a,f.INFINITY);if(f.equals(d,f.INFINULL))return f.copy(a,f.INFINULL);var c=f.isNegative(d);c&&(d[0]=d[0].negate());f.copy(a,f.ONE);for(var e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=f.clone(f.ONE),h=q;!f.approximates(d,g)&&h--;)f.isLessThan(d,
g)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),a[0]=e[0].add(e[1]),a[1]=e[2].add(e[3]),f.pow(g,a,b);c&&(d[0]=d[0].negate(),1===b%2&&f.neg(a,a));return a};f.dot=function(a,d){return a[0].multiply(d[0]).add(a[1].multiply(d[1]))};f.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};f.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};f.dec=f.toDecimal;f.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};
f.round=f.toInteger;f.toBigInteger=function(a){return a[0].quotient(a[1])};f.floor=function(a){return Math.floor(f.toDecimal(a))};f.ceil=function(a){return Math.ceil(f.toDecimal(a))};f.fromInteger_copy=function(a,d){a[0]=BigInteger(d);a[1]=BigInteger.ONE;return a};f.fromInteger=function(a){return f.fromInteger_copy(f.create(),a)};f.fromIntegerInverse_copy=function(a,d){a[0]=BigInteger.ONE;a[1]=BigInteger(d);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};f.fromIntegerInverse=
function(a){return f.fromIntegerInverse_copy(f.create(),a)};f.fromDecimal=function(a){return f.fromDecimal_copy(f.create(),a)};f.fromDecimal_copy=function(a,d){d=parseFloat(d);if(isNaN(d))return f.copy(a,f.INFINULL);if(Infinity===d)return f.copy(a,f.INFINITY);if(Math.abs(d)<f.EPSILON)return f.copy(a,f.ZERO);if(Math.abs(d-1)<f.EPSILON)return f.copy(a,f.ONE);if(Math.abs(d%1)<f.EPSILON)return f.fromInteger_copy(a,d);if(Math.abs(1/d%1)<f.EPSILON)return f.fromIntegerInverse_copy(a,Math.round(1/d));f.copy(a,
f.ONE);for(var b=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],c=d,e=1,g=f.MAX_LOOPS;g--&&Math.abs(d-f.toDecimal(a))>f.EPSILON;)e=Math.floor(c),a[0]=BigInteger(e*b[0]+b[2]),a[1]=BigInteger(e*b[1]+b[3]),c=1/(c-e),b[2]=b[0],b[3]=b[1],b[0]=a[0],b[1]=a[1];return a};f.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*Math.random()<<0));return f.normalize(a,a)};f.sin=function(a,d){if(d[1].isZero())return f.copy(a,f.ZERO);f.scalar_multiply(a,
d,2);var b=f.create();f.pow(b,d,2);f.add(b,b,f.ONE);f.divide(a,a,b);return a};f.cos=function(a,d){if(d[1].isZero())return f.neg(a,f.ONE);var b=f.create();f.pow(b,d,2);f.sub(a,f.ONE,b);var c=f.create();f.add(c,f.ONE,b);f.divide(a,a,c);return a};f.tan=function(a,b){f.scalar_multiply(a,b,2);var c=f.create();f.pow(c,b,2);f.scalar_multiply(c,c,2);f.add(a,a,c);f.pow(c,b,4);f.sub(c,f.ONE,c);f.divide(a,a,c);return a};f.toEgyptian=function(a){a=f.clone(a);f.abs(a,a);var b=f.floor(a);b&&f.sub(a,a,f.fromInteger(b));
if(!a[0])return b.toString();b||(b="");for(var c=1,e=f.create();1!==a[0];)c++,e=f.fromValues(1,c),f.isGreaterThan(a,e)&&(b&&(b+=" + "),b+=f.str(e),f.sub(a,a,e));return a?b?b+" + "+f.str(a):f.str(a):b?b:"0"};f.toBabylonian=function(a){var b="",c=f.toDecimal(a);a=parseInt(c);for(var c=c-a,e=0,g=0;0<a;)(e=a%60)&&(b=e+" * 60^"+g+(b?" + ":"")+b),a=(a-e)/60,g++;for(g=-1;0<c;)c*=60,e=parseInt(c+1E-13),c-=e,-1E-13>c||(e&&(b+=(b?" + ":"")+e+" * 60^"+g),g--);return b?b:"0"};f.traceSternBrocot=function(a){var b=
"";if(f.equals(a,f.ZERO)||f.equals(a,f.ONE)||f.equals(a,f.INFINITY)||f.equals(a,f.INFINULL))return b;a=f.clone(a);f.isNegative(a)&&(a[0]=a[0].negate());for(var c=f.clone(f.ONE),e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=0,h=0,k=65536;!f.equals(a,c)&&k--;)f.isLessThan(a,c)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3]),h++,g&&(b+="R",1!==g&&(b+=g),g=0,b+=" ")):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2]),g++,h&&(b+="L",1!==h&&(b+=h),h=0,b+=" ")),c[0]=e[0].add(e[1]),c[1]=e[2].add(e[3]);h?(b+=
"L",1!==h&&(b+=h)):g&&(b+="R",1!==g&&(b+=g));0>k&&(b+="...");return b};f.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(f.equals(a,f.ZERO))return[0];if(f.equals(a,f.ONE))return[1];if(f.equals(a,f.NEGONE))return[-1];if(f.equals(a,f.INFINITY))return[1,0];if(f.equals(a,f.INFINULL))return[0,0];var c=f.clone(a),e=f.isNegative(c);e&&(c[0]=c[0].negate());for(var g=f.clone(f.ONE),h=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],k=1,m=[0],n=m.length-1;!f.equals(c,
g)&&b--;)f.isLessThan(c,g)?(-1===k?m[n]++:(k=-1,m.push(1),n++),h[0]=h[0].add(h[1]),h[2]=h[2].add(h[3])):(1===k?m[n]++:(k=1,m.push(1),n++),h[1]=h[1].add(h[0]),h[3]=h[3].add(h[2])),g[0]=h[0].add(h[1]),g[1]=h[2].add(h[3]);0>b?m.push(0):m[n]++;if(e)for(var p in m)m[p]=-m[p];return m};f.fromContinuedFraction=function(a,b){f.fromInteger_copy(a,b[b.length-1]);for(var c=b.length-2;-1<c;c--)f.invert(a,a),f.add(a,f.fromInteger(b[c]),a);return a};f.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return f.fromInteger_copy(a,
factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(f.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)f.scalar_multiply(a,a,++c);return a};f.dump=function(a){return"bigrat\t"+f.str(a)+"\n~\t"+f.toDecimal(a)+"\nCF:\t["+f.toContinuedFraction(a)+"]\n"};f.ZERO=f.fromInteger(0);f.ONE=f.fromInteger(1);f.NEGONE=f.fromInteger(-1);f.INFINITY=f.fromValues(1,0);f.INFINULL=f.fromValues(0,0);f.INFINITESIMAL=f.clone([new BigInteger(1),s]);f.PI=f.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587",
"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");"undefined"!==typeof a&&(a.bigrat=f);var n=function(a,b){this.a=c.fromValues(parseInt(a),parseInt(b))};n.prototype.toString=function(){return c.str(this.a)};n.prototype.toContinuedFraction=function(a){return c.toContinuedFraction(this.a,
a)};n.prototype.invert=function(){return c.invert(this.a)};n.prototype.reciprocal=n.prototype.invert;n.prototype.add=function(a){var b=c.create();c.add(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.plus=n.prototype.add;n.prototype.subtract=function(a){var b=c.create();c.sub(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.sub=n.prototype.subtract;n.prototype.minus=n.prototype.subtract;n.prototype.multiply=function(a){var b=c.create();c.mul(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.mul=
n.prototype.multiply;n.prototype.times=n.prototype.multiply;n.prototype.mediant=function(a){var b=c.create();c.mediant(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.divide=function(a){var b=c.create();c.div(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.div=n.prototype.divide;n.prototype.divided_by=n.prototype.divide;n.prototype.power=function(a){var b=c.create();c.pow(b,this.a,a);return new n(b[0],b[1])};n.prototype.pow=n.prototype.power;n.prototype.dump=function(){return c.dump(this.a)};
n.prototype.toRat=function(){return c.clone(this.a)};n.prototype.toDecimal=function(){return c.toDecimal(this.a)};n.fromRat=function(a){var b=new n;b.a[0]=a[0];b.a[1]=a[1];return b};n.fromInteger=function(a){return n.fromRat(c.fromInteger(a))};n.fromIntegerInverse=function(a){return n.fromRat(c.fromIntegerInverse(a))};n.fromDecimal=function(a){return n.fromRat(c.fromDecimal(a))};n.fromContinuedFraction=function(a){return n.fromRat(c.fromContinuedFraction(c.create(),a))};"undefined"!==typeof a&&(a.rational=
n)})(a)})(this);
