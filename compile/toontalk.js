'use strict';(function(e){var k;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(k={},define(function(){return k})):k="undefined"!==typeof window?window:e:k=exports;(function(b){var a={greatest_common_divisor:function(f,a){if(1===a||1===f)return 1;for(var b;0!==a;){b=a;a=f%a;if(!isFinite(a))return 0;f=b}return f}};a.gcd=a.greatest_common_divisor;a.fromRandom=function(f){return Math.random()*(1<<f)>>>0};a.fromMillitime=function(){return+new Date};a.fromUnixtime=
function(){return.001*a.fromMillitime()|0};"undefined"!==typeof b&&(b.integer=a);(function(f){function a(f,c,g){if(g!==b)return f instanceof a?f:"undefined"===typeof f?d:a.parse(f);for(f=f||[];f.length&&!f[f.length-1];)--f.length;this._d=f;this._s=f.length?c||1:0}var b={};a._construct=function(f,d){return new a(f,d,b)};a.base=1E7;a.base_log10=7;var d=new a([],0,b);a.ZERO=d;var c=new a([1],1,b);a.ONE=c;var g=new a(c._d,-1,b);a.M_ONE=g;a._0=d;a._1=c;a.small=[d,c,new a([2],1,b),new a([3],1,b),new a([4],
1,b),new a([5],1,b),new a([6],1,b),new a([7],1,b),new a([8],1,b),new a([9],1,b),new a([10],1,b),new a([11],1,b),new a([12],1,b),new a([13],1,b),new a([14],1,b),new a([15],1,b),new a([16],1,b),new a([17],1,b),new a([18],1,b),new a([19],1,b),new a([20],1,b),new a([21],1,b),new a([22],1,b),new a([23],1,b),new a([24],1,b),new a([25],1,b),new a([26],1,b),new a([27],1,b),new a([28],1,b),new a([29],1,b),new a([30],1,b),new a([31],1,b),new a([32],1,b),new a([33],1,b),new a([34],1,b),new a([35],1,b),new a([36],
1,b)];a.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");a.prototype.toString=function(f){f=+f||10;if(2>f||36<f)throw Error("illegal radix "+f+".");if(0===this._s)return"0";if(10===f){f=0>this._s?"-":"";f+=this._d[this._d.length-1].toString();for(var b=this._d.length-2;0<=b;b--){for(var d=this._d[b].toString();7>d.length;)d="0"+d;f+=d}return f}b=a.digits;f=a.small[f];for(var d=this._s,c=this.abs(),g=[],h;0!==c._s;)h=c.divRem(f),c=h[0],h=h[1],g.push(b[h.valueOf()]);return(0>d?"-":"")+g.reverse().join("")};
a.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];a.parse=function(f,c){function g(f){f=f.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return f.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(f,a,b,d,c){c=+c;var p=0>c,g=b.length+c;f=(p?b:d).length;c=(c=Math.abs(c))>=f?c-f+p:0;f=Array(c+1).join("0");b+=d;return(a||"")+(p?b=f+b:b+=f).substr(0,g+=p?f.length:0)+(g<b.length?"."+b.substr(g):"")})}f=f.toString();if("undefined"===typeof c||10===+c)f=g(f);var h=(new RegExp("^([+\\-]?)("+("undefined"===
typeof c?"0[xcb]":16==c?"0x":8==c?"0c":2==c?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(f);if(h){var e=h[1]||"+",l=h[2]||"",h=h[3]||"";if("undefined"===typeof c)c="0x"===l||"0X"===l?16:"0c"===l||"0C"===l?8:"0b"===l||"0B"===l?2:10;else if(2>c||36<c)throw Error("Illegal radix "+c+".");c=+c;if(!a.radixRegex[c].test(h))throw Error("Bad digit for radix "+c);h=h.replace(/^0+/,"").split("");if(0===h.length)return d;e="-"===e?-1:1;if(10==c){for(l=[];7<=h.length;)l.push(parseInt(h.splice(h.length-a.base_log10,
a.base_log10).join(""),10));l.push(parseInt(h.join(""),10));return new a(l,e,b)}l=d;c=a.small[c];for(var m=a.small,n=0;n<h.length;n++)l=l.multiply(c).add(m[parseInt(h[n],36)]);return new a(l._d,e,b)}throw Error("Invalid BigInteger format: "+f);};a.prototype.add=function(f){if(0===this._s)return a(f);f=a(f);if(0===f._s)return this;if(this._s!==f._s)return f=f.negate(),this.subtract(f);var d=this._d;f=f._d;for(var c=d.length,g=f.length,h=Array(Math.max(c,g)+1),l=Math.min(c,g),e=0,m=0;m<l;m++)e=d[m]+
f[m]+e,h[m]=e%1E7,e=e/1E7|0;g>c&&(d=f,c=g);for(m=l;e&&m<c;m++)e=d[m]+e,h[m]=e%1E7,e=e/1E7|0;for(e&&(h[m]=e);m<c;m++)h[m]=d[m];return new a(h,this._s,b)};a.prototype.negate=function(){return new a(this._d,-this._s|0,b)};a.prototype.abs=function(){return 0>this._s?this.negate():this};a.prototype.subtract=function(f){if(0===this._s)return a(f).negate();f=a(f);if(0===f._s)return this;if(this._s!==f._s)return f=f.negate(),this.add(f);var c=this;0>this._s&&(c=new a(f._d,1,b),f=new a(this._d,1,b));var g=
c.compareAbs(f);if(0===g)return d;if(0>g){var h=f;f=c;c=h}c=c._d;f=f._d;var h=c.length,e=f.length,l=Array(h),m=0,n,p;for(n=0;n<e;n++)p=c[n]-m-f[n],0>p?(p+=1E7,m=1):m=0,l[n]=p;for(n=e;n<h;n++){p=c[n]-m;if(0>p)p+=1E7;else{l[n++]=p;break}l[n]=p}for(;n<h;n++)l[n]=c[n];return new a(l,g,b)};(function(){function f(c,d){for(var g=c._d,h=g.slice(),e=0;;){var l=(g[e]||0)+1;h[e]=l%1E7;if(9999999>=l)break;++e}return new a(h,d,b)}function d(f,c){for(var g=f._d,h=g.slice(),e=0;;){var l=(g[e]||0)-1;if(0>l)h[e]=
l+1E7;else{h[e]=l;break}++e}return new a(h,c,b)}a.prototype.next=function(){switch(this._s){case 0:return c;case -1:return d(this,-1);default:return f(this,1)}};a.prototype.prev=function(){switch(this._s){case 0:return g;case -1:return f(this,-1);default:return d(this,1)}}})();a.prototype.compareAbs=function(f){if(this===f)return 0;if(!(f instanceof a)){if(!isFinite(f))return isNaN(f)?f:-1;f=a(f)}if(0===this._s)return 0!==f._s?-1:0;if(0===f._s)return 1;var b=this._d.length,c=f._d.length;if(b<c)return-1;
if(b>c)return 1;c=this._d;f=f._d;for(--b;0<=b;b--)if(c[b]!==f[b])return c[b]<f[b]?-1:1;return 0};a.prototype.compare=function(f){if(this===f)return 0;f=a(f);return 0===this._s?-f._s:this._s===f._s?this.compareAbs(f)*this._s:this._s};a.prototype.isUnit=function(){return this===c||this===g||1===this._d.length&&1===this._d[0]};a.prototype.multiply=function(f){if(0===this._s)return d;f=a(f);if(0===f._s)return d;if(this.isUnit())return 0>this._s?f.negate():f;if(f.isUnit())return 0>f._s?this.negate():this;
if(this===f)return this.square();var c=this._d.length>=f._d.length,g=(c?this:f)._d,c=(c?f:this)._d,h=g.length,e=c.length,l=h+e,m=Array(l),n;for(n=0;n<l;n++)m[n]=0;for(n=0;n<e;n++){for(var l=0,p=c[n],v=h+n,w,k=n;k<v;k++)w=m[k]+p*g[k-n]+l,l=w/1E7|0,m[k]=w%1E7|0;l&&(w=m[k]+l,m[k]=w%1E7)}return new a(m,this._s*f._s,b)};a.prototype.multiplySingleDigit=function(f){if(0===f||0===this._s)return d;if(1===f)return this;var c;if(1===this._d.length)return c=this._d[0]*f,1E7<=c?new a([c%1E7|0,c/1E7|0],1,b):new a([c],
1,b);if(2===f)return this.add(this);if(this.isUnit())return new a([f],1,b);var g=this._d,h=g.length;c=h+1;for(var l=Array(c),e=0;e<c;e++)l[e]=0;for(var m=e=0;m<h;m++)c=f*g[m]+e,e=c/1E7|0,l[m]=c%1E7|0;e&&(l[m]=e);return new a(l,1,b)};a.prototype.square=function(){if(0===this._s)return d;if(this.isUnit())return c;var f=this._d,g=f.length,h=Array(g+g+1),e,l,m,n;for(n=0;n<g;n++)m=2*n,e=f[n]*f[n],l=e/1E7|0,h[m]=e%1E7,h[m+1]=l;for(n=0;n<g;n++){l=0;m=2*n+1;for(var k=n+1;k<g;k++,m++)e=f[k]*f[n]*2+h[m]+l,
l=e/1E7|0,h[m]=e%1E7;m=g+n;e=l+h[m];l=e/1E7|0;h[m]=e%1E7;h[m+1]+=l}return new a(h,1,b)};a.prototype.quotient=function(f){return this.divRem(f)[0]};a.prototype.divide=a.prototype.quotient;a.prototype.remainder=function(f){return this.divRem(f)[1]};a.prototype.divRem=function(f){f=a(f);if(0===f._s)throw Error("Divide by zero");if(0===this._s)return[d,d];if(1===f._d.length)return this.divRemSmall(f._s*f._d[0]);switch(this.compareAbs(f)){case 0:return[this._s===f._s?c:g,d];case -1:return[d,this]}var h=
this._s*f._s,e=f.abs(),l=this._d,m=l.length,n=[],k,t=new a([],0,b);for(t._s=1;m;)if(t._d.unshift(l[--m]),0>t.compareAbs(f))n.push(0);else{if(0===t._s)k=0;else{var p=t._d.length;k=e._d.length;p=1E7*t._d[p-1]+t._d[p-2];k=1E7*e._d[k-1]+e._d[k-2];t._d.length>e._d.length&&(p=1E7*(p+1));k=Math.ceil(p/k)}do{p=e.multiplySingleDigit(k);if(0>=p.compareAbs(t))break;k--}while(k);n.push(k);k&&(k=t.subtract(p),t._d=k._d.slice(),0===t._d.length&&(t._s=0))}return[new a(n.reverse(),h,b),new a(t._d,this._s,b)]};a.prototype.divRemSmall=
function(f){f=+f;if(0===f)throw Error("Divide by zero");var c=this._s*(0>f?-1:1);f=Math.abs(f);if(1>f||1E7<=f)throw Error("Argument out of range");if(0===this._s)return[d,d];if(1===f||-1===f)return[1===c?this.abs():new a(this._d,c,b),d];if(1===this._d.length){var h=new a([this._d[0]/f|0],1,b);f=new a([this._d[0]%f|0],1,b);0>c&&(h=h.negate());0>this._s&&(f=f.negate());return[h,f]}for(var g=this._d.slice(),h=Array(g.length),e=0,l=0,m=0,n;g.length;)e=1E7*e+g[g.length-1],e<f?(h[m++]=0,g.pop(),l=1E7*l+
e):(n=0===e?0:e/f|0,l=e-f*n,(h[m++]=n)?(g.pop(),e=l):g.pop());f=new a([l],1,b);0>this._s&&(f=f.negate());return[new a(h.reverse(),c,b),f]};a.prototype.isEven=function(){var f=this._d;return 0===this._s||0===f.length||0===f[0]%2};a.prototype.isOdd=function(){return!this.isEven()};a.prototype.sign=function(){return this._s};a.prototype.isPositive=function(){return 0<this._s};a.prototype.isNegative=function(){return 0>this._s};a.prototype.isZero=function(){return 0===this._s};a.prototype.exp10=function(f){f=
+f;if(0===f)return this;if(Math.abs(f)>Number(h))throw Error("exponent too large in BigInteger.exp10");if(0<f){for(var c=new a(this._d.slice(),this._s,b);7<=f;f-=7)c._d.unshift(0);if(0==f)return c;c._s=1;c=c.multiplySingleDigit(Math.pow(10,f));return 0>this._s?c.negate():c}if(-f>=7*this._d.length)return d;c=new a(this._d.slice(),this._s,b);for(f=-f;7<=f;f-=7)c._d.shift();return 0==f?c:c.divRemSmall(Math.pow(10,f))[0]};a.prototype.pow=function(f){if(this.isUnit())return 0<this._s?this:a(f).isOdd()?
this:this.negate();f=a(f);if(0===f._s)return c;if(0>f._s){if(0===this._s)throw Error("Divide by zero");return d}if(0===this._s)return d;if(f.isUnit())return this;if(0<f.compareAbs(h))throw Error("exponent too large in BigInteger.pow");for(var b=this,g=c,e=a.small[2];f.isPositive()&&(!f.isOdd()||(g=g.multiply(b),!f.isUnit()));)b=b.square(),f=f.quotient(e);return g};a.prototype.modPow=function(f,b){for(var d=c,g=this;f.isPositive();)f.isOdd()&&(d=d.multiply(g).remainder(b)),f=f.quotient(a.small[2]),
f.isPositive()&&(g=g.square().remainder(b));return d};a.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var f=this._d.length;if(30>7*f)return Math.log(this.valueOf());var c=Math.ceil(30/7),d=this._d.slice(f-c);return Math.log((new a(d,1,b)).valueOf())+(f-c)*Math.log(1E7)};a.prototype.valueOf=function(){return parseInt(this.toString(),10)};a.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var h=a(2147483647);a.MAX_EXP=h;(function(){function f(b){return function(f){return b.call(a(f))}}
function b(f){return function(b,c){return f.call(a(b),a(c))}}function c(f){return function(b,c,d){return f.call(a(b),a(c),a(d))}}(function(){var d,g,h="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),e="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),l=["modPow"];for(d=0;d<h.length;d++)g=h[d],a[g]=f(a.prototype[g]);for(d=0;d<e.length;d++)g=e[d],a[g]=b(a.prototype[g]);for(d=0;d<l.length;d++)g=
l[d],a[g]=c(a.prototype[g]);a.exp10=function(f,b){return a(f).exp10(b)}})()})();f.BigInteger=a})("undefined"!==typeof b?b:this);var d={greatest_common_divisor:function(f,a){if(a.isUnit()||f.isUnit())return BigInteger.ONE;for(var b;!a.isZero();)b=a,a=f.remainder(a),f=b;return f},create:function(){return[0]},clone:function(f){for(var a=[],b=0,c=f.length;b<c;b++)a[b]=f[b];return a},copy:function(f,a){f=[];for(var b=0,c=a.length;b<c;b++)f[b]=a[b];return f},abs:function(f,a){f[0]=Math.abs(a[0]);return f},
str:function(f){return f[0].toString()},toInteger:function(f){return out[0]},fromInteger:function(f){return[parseInt(f)]}};d.ZERO=d.fromInteger(0);d.ONE=d.fromInteger(1);"undefined"!==typeof b&&(b.bigint=d);if(!h)var h=Array;if(!e)var e=Math.pow(2,56);if(!l)var l=16777216;var c={EPSILON:2E-16};c.MAX_LOOPS=l;c.create=function(){var f=new h(2);f[0]=0;f[1]=1;return f};c.clone=function(f){var a=new h(2);a[0]=f[0];a[1]=f[1];return a};c.fromValues=function(f,a){var b=new h(2);b[0]=f;b[1]=a;return c.normalize(b,
b)};c.copy=function(f,a){f[0]=a[0];f[1]=a[1];return f};c.set=function(f,a,b){f[0]=a;f[1]=b;return c.normalize(f,f)};c.abs=function(f,a){f[0]=Math.abs(a[0]);f[1]=a[1];return f};c.invert=function(f,a){var b=a[0];f[0]=a[1];f[1]=b;return f};c.reciprocal=c.invert;c.add=function(f,a,b){a[1]===b[1]?(f[0]=a[0]+b[0],f[1]=a[1]):(f[0]=a[0]*b[1]+b[0]*a[1],f[1]=a[1]*b[1]);return c.normalize(f,f)};c.subtract=function(f,a,b){a[1]===b[1]?(f[0]=a[0]-b[0],f[1]=a[1]):(f[0]=a[0]*b[1]-b[0]*a[1],f[1]=a[1]*b[1]);return c.normalize(f,
f)};c.sub=c.subtract;c.multiply=function(f,a,b){f[0]=a[0]*b[0];f[1]=a[1]*b[1];return c.normalize(f,f)};c.mul=c.multiply;c.mediant=function(f,a,b){f[0]=a[0]+b[0];f[1]=a[1]+b[1];return c.normalize(f,f)};c.divide=function(f,a,b){f[0]=a[0]*b[1];f[1]=a[1]*b[0];return c.normalize(f,f)};c.div=c.divide;c.equals=function(f,a){return 0===f[0]&&0===a[0]||0===f[1]&&0===a[1]?!0:f[0]===a[0]&&f[1]===a[1]};c.approximates=function(f,a){if(c.equals(f,a))return!0;var b=c.create();c.sub(b,f,a);c.abs(b,b);return c.isLessThan(b,
c.INFINITESIMAL)};c.isGreaterThan=function(f,a){return c.equals(f,a)?!1:f[0]*a[1]>a[0]*f[1]};c.isLessThan=function(f,a){return c.equals(f,a)?!1:f[0]*a[1]<a[0]*f[1]};c.isNegative=function(f){return 0>f[0]};c.min=function(f,a,b){c.isLessThan(a,b)?(f[0]=a[0],f[1]=a[1]):(f[0]=b[0],f[1]=b[1]);return f};c.max=function(f,a,b){c.isGreaterThan(a,b)?(f[0]=a[0],f[1]=a[1]):(f[0]=b[0],f[1]=b[1]);return f};c.scalar_multiply=function(f,a,b){f[0]=a[0]*b;f[1]=a[1];return c.normalize(f,f)};c.scalar_divide=function(f,
a,b){f[0]=a[0];f[1]=a[1]*b;return c.normalize(f,f)};c.normalize=function(f,b){if(isNaN(b[0])||isNaN(b[1])||0===b[0]&&0===b[1])return f[0]=0,f[1]=0,f;if(0===b[0])return f[0]=0,f[1]=1,f;if(0===b[1])return f[0]=1,f[1]=0,f;if(b[0]===b[1])return f[0]=1,f[1]=1,f;0<b[1]?(f[0]=b[0],f[1]=b[1]):(f[0]=-b[0],f[1]=-b[1]);var c=a.greatest_common_divisor(Math.abs(f[0]),f[1]);1<c&&(f[0]/=c,f[1]/=c);return f};c.opposite=function(f,a){f[0]=-a[0];f[1]=a[1];return f};c.negative=c.opposite;c.neg=c.opposite;c.power=function(f,
a,b){2===b?(f[0]=a[0]*a[0],f[1]=a[1]*a[1]):0<b?(f[0]=Math.pow(a[0],b),f[1]=Math.pow(a[1],b)):0>b?(b=Math.abs(b),f[0]=Math.pow(a[1],b),f[1]=Math.pow(a[0],b)):c.copy(f,c.ONE);return c.normalize(f,f)};c.pow=c.power;c.sqrt=function(f,a){return c.nthRoot(f,a,2)};c.nthRoot=function(f,a,b){if(c.equals(a,c.ZERO))return c.copy(f,c.ZERO);if(c.equals(a,c.ONE))return c.copy(f,c.ONE);if(c.equals(a,c.INFINITY))return c.copy(f,c.INFINITY);if(c.equals(a,c.INFINULL))return c.copy(f,c.INFINULL);var d=c.isNegative(a);
d&&(a[0]=-a[0]);f=c.copy(f,c.ONE);for(var g=[1,0,0,1],h=c.clone(c.ONE),e=c.MAX_LOOPS;!c.approximates(a,h)&&e--;)c.isLessThan(a,h)?(g[0]+=g[1],g[2]+=g[3]):(g[1]+=g[0],g[3]+=g[2]),f[0]=g[0]+g[1],f[1]=g[2]+g[3],c.pow(h,f,b);d&&(a[0]=-a[0],1===b%2&&c.neg(f,f));return f};c.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]};c.str=function(f){return 1===f[1]?f[0].toString():f[0]+"/"+f[1]};c.toDecimal=function(f){return f[0]/f[1]};c.dec=c.toDecimal;c.toInteger=function(f){return Math.round(c.toDecimal(f))};c.round=
c.toInteger;c.floor=function(f){return Math.floor(c.toDecimal(f))};c.ceil=function(f){return Math.ceil(c.toDecimal(f))};c.fromInteger_copy=function(f,a){f[0]=parseInt(a);f[1]=1;return f};c.fromInteger=function(f){return c.fromInteger_copy(c.create(),f)};c.fromIntegerInverse_copy=function(f,a){f[0]=1;f[1]=parseInt(a);0>f[1]&&(f[0]=-f[0],f[1]=-f[1]);return f};c.fromIntegerInverse=function(f){return c.fromIntegerInverse_copy(c.create(),f)};c.fromDecimal=function(f){return c.fromDecimal_copy(c.create(),
f)};c.fromDecimal_copy=function(f,a){a=parseFloat(a);if(isNaN(a))return c.copy(f,c.INFINULL);if(Infinity===a)return c.copy(f,c.INFINITY);if(Math.abs(a)<c.EPSILON)return c.copy(f,c.ZERO);if(Math.abs(a-1)<c.EPSILON)return c.copy(f,c.ONE);if(Math.abs(a%1)<c.EPSILON)return c.fromInteger_copy(f,a);if(Math.abs(1/a%1)<c.EPSILON)return c.fromIntegerInverse_copy(f,Math.round(1/a));c.copy(f,c.ONE);for(var b=[1,0,0,1],d=a,g=1,h=c.MAX_LOOPS;h--&&Math.abs(a-c.toDecimal(f))>c.EPSILON;){g=Math.floor(d);f[0]=g*b[0]+
b[2];f[1]=g*b[1]+b[3];if(d===g)break;d=1/(d-g);b[2]=b[0];b[3]=b[1];b[0]=f[0];b[1]=f[1]}return f};c.fromRandom=function(f){f[0]=0xfffffffffffff*Math.random()<<0;f[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return c.normalize(f,f)};c.sin=function(f,a){if(0===a[1])return c.copy(f,c.ZERO);c.scalar_multiply(f,a,2);var b=c.create();c.pow(b,a,2);c.add(b,b,c.ONE);c.divide(f,f,b);return f};c.cos=function(f,a){if(0===a[1])return c.neg(f,c.ONE);var b=c.create();c.pow(b,a,2);c.sub(f,c.ONE,b);var d=c.create();
c.add(d,c.ONE,b);c.divide(f,f,d);return f};c.tan=function(f,a){c.scalar_multiply(f,a,2);var b=c.create();c.pow(b,a,2);c.scalar_multiply(b,b,2);c.add(f,f,b);c.pow(b,a,4);c.sub(b,c.ONE,b);c.divide(f,f,b);return f};c.toEgyptian=function(f){f=c.clone(f);c.abs(f,f);var a=c.floor(f);a&&c.sub(f,f,c.fromInteger(a));if(!f[0])return a.toString();a||(a="");for(var b=1,d=c.create();1!==f[0];)b++,d=c.fromValues(1,b),c.isGreaterThan(f,d)&&(a&&(a+=" + "),a+=c.str(d),c.sub(f,f,d));return f?a?a+" + "+c.str(f):c.str(f):
a?a:"0"};c.toBabylonian=function(f){var a="",b=c.toDecimal(f);f=parseInt(b);for(var b=b-f,d=0,g=0;0<f;)(d=f%60)&&(a=d+" * 60^"+g+(a?" + ":"")+a),f=(f-d)/60,g++;for(g=-1;0<b;)b*=60,d=parseInt(b+1E-13),b-=d,-1E-13>b||(d&&(a+=(a?" + ":"")+d+" * 60^"+g),g--);return a?a:"0"};c.traceSternBrocot=function(f){var a="";if(c.equals(f,c.ZERO)||c.equals(f,c.ONE)||c.equals(f,c.INFINITY)||c.equals(f,c.INFINULL))return a;f=c.clone(f);c.isNegative(f)&&(f[0]=-f[0]);for(var b=c.clone(c.ONE),d=[1,0,0,1],g=0,h=0,e=c.MAX_LOOPS;!c.approximates(f,
b)&&e--;)c.isLessThan(f,b)?(d[0]+=d[1],d[2]+=d[3],h++,g&&(a+="R",1!==g&&(a+=g),g=0,a+=" ")):(d[1]+=d[0],d[3]+=d[2],g++,h&&(a+="L",1!==h&&(a+=h),h=0,a+=" ")),b[0]=d[0]+d[1],b[1]=d[2]+d[3];h?(a+="L",1!==h&&(a+=h)):g&&(a+="R",1!==g&&(a+=g));0>e&&(a+="...");return a};c.toContinuedFraction=function(f,a){a="undefined"===typeof a?65536:parseInt(a);if(c.equals(f,c.ZERO))return[0];if(c.equals(f,c.ONE))return[1];if(c.equals(f,c.NEGONE))return[-1];if(c.equals(f,c.INFINITY))return[1,0];if(c.equals(f,c.INFINULL))return[0,
0];var b=c.clone(f),d=c.isNegative(b);d&&(b[0]=-b[0]);for(var g=c.clone(c.ONE),h=[1,0,0,1],e=1,l=[0],m=l.length-1;!c.equals(b,g)&&a--;)c.isLessThan(b,g)?(-1===e?l[m]++:(e=-1,l.push(1),m++),h[0]+=h[1],h[2]+=h[3]):(1===e?l[m]++:(e=1,l.push(1),m++),h[1]+=h[0],h[3]+=h[2]),g[0]=h[0]+h[1],g[1]=h[2]+h[3];0>a?l.push(0):l[m]++;if(d)for(var n in l)l[n]=-l[n];return l};c.fromContinuedFraction=function(f,a){c.fromInteger_copy(f,a[a.length-1]);for(var b=a.length-2;-1<b;b--)c.invert(f,f),c.add(f,c.fromInteger(a[b]),
f);return f};c.dump=function(f){c.create();return"rat\t"+c.str(f)+"\n~\t"+c.toDecimal(f)+"\nCF:\t["+c.toContinuedFraction(f)+"]\n"};c.ZERO=c.fromInteger(0);c.ONE=c.fromInteger(1);c.NEGONE=c.fromInteger(-1);c.INFINITY=c.fromValues(1,0);c.INFINULL=c.fromValues(0,0);c.INFINITESIMAL=c.clone([1,e]);c.PI=c.fromValues(1320192667429,420230377710);"undefined"!==typeof b&&(b.rat=c);if(!k)var k=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!q)var q=1073741824;var g={EPSILON:2E-16};g.MAX_LOOPS=q;g.create=
function(){var f=[];f[0]=BigInteger.ZERO;f[1]=BigInteger.ONE;return f};g.clone=function(f){var a=[];a[0]=f[0];a[1]=f[1];return a};g.fromValues=function(f,a){var b=[];b[0]=new BigInteger(f);b[1]=new BigInteger(a);return g.normalize(b,b)};g.copy=function(f,a){f[0]=a[0];f[1]=a[1];return f};g.set=function(f,a,b){f[0]=a;f[1]=b;return g.normalize(f,f)};g.toRat=function(f,a){return c.set(f,a[0].toJSValue(),a[1].toJSValue())};g.fromRat=function(f,a){return g.set(f,BigInteger(a[0]),BigInteger(a[1]))};g.abs=
function(f,a){f[0]=a[0].abs();f[1]=a[1];return f};g.invert=function(f,a){var b=a[0];f[0]=a[1];f[1]=b;return f};g.reciprocal=g.invert;g.add=function(f,a,b){0===a[1].compare(b[1])?(f[0]=a[0].add(b[0]),f[1]=a[1]):(f[0]=a[0].multiply(b[1]).add(b[0].multiply(a[1])),f[1]=a[1].multiply(b[1]));return g.normalize(f,f)};g.subtract=function(f,a,b){0===a[1].compare(b[1])?(f[0]=a[0].subtract(b[0]),f[1]=a[1]):(f[0]=a[0].multiply(b[1]).subtract(b[0].multiply(a[1])),f[1]=a[1].multiply(b[1]));return g.normalize(f,
f)};g.sub=g.subtract;g.multiply=function(f,a,b){f[0]=a[0].multiply(b[0]);f[1]=a[1].multiply(b[1]);return g.normalize(f,f)};g.mul=g.multiply;g.mediant=function(f,a,b){f[0]=a[0].add(b[0]);f[1]=a[1].add(b[1]);return g.normalize(f,f)};g.divide=function(f,a,b){f[0]=a[0].multiply(b[1]);f[1]=a[1].multiply(b[0]);return g.normalize(f,f)};g.div=g.divide;g.equals=function(f,a){return f[0].isZero()&&a[0].isZero()||f[1].isZero()&&a[1].isZero()?!0:0===f[0].compare(a[0])&&0===f[1].compare(a[1])};g.approximates=
function(f,a){if(g.equals(f,a))return!0;var b=g.create();g.sub(b,f,a);g.abs(b,b);return g.isLessThan(b,g.INFINITESIMAL)};g.isGreaterThan=function(a,b){return g.equals(a,b)?!1:0<a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};g.isLessThan=function(a,b){return g.equals(a,b)?!1:0>a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};g.isNegative=function(a){return a[0].isNegative()};g.min=function(a,b,c){g.isLessThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.max=function(a,b,c){g.isGreaterThan(b,
c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.scalar_multiply=function(a,b,c){a[0]=b[0].multiply(c);a[1]=b[1];return g.normalize(a,a)};g.scalar_divide=function(a,b,c){a[0]=b[0];a[1]=b[1].multiply(c);return g.normalize(a,a)};g.normalize=function(a,b){if(b[0].isZero()||b[1].isZero())return b;if(0===b[0].compare(b[1]))return g.clone(g.ONE);if(b[1].isNegative())a[0]=b[0].negate(),a[1]=b[1].negate();else if(a[0]=b[0],a[1]=b[1],a[1].isZero())return a;var c=d.greatest_common_divisor(a[0].abs(),
a[1]);0<c.compare(BigInteger.ONE)&&(a[0]=a[0].quotient(c),a[1]=a[1].quotient(c));return a};g.opposite=function(a,b){a[0]=b[0].negate();a[1]=b[1];return a};g.negative=g.opposite;g.neg=g.opposite;g.power=function(a,b,c){2===c?(a[0]=b[0].square(),a[1]=b[1].square()):0<c?(a[0]=b[0].pow(c),a[1]=b[1].pow(c)):0>c?(c=Math.abs(c),a[0]=b[1].pow(c),a[1]=b[0].pow(c)):g.copy(a,g.ONE);return a};g.pow=g.power;g.sqrt=function(a,b){return g.nthRoot(a,b,2)};g.nthRoot=function(a,b,c){if(g.equals(b,g.ZERO))return g.copy(a,
g.ZERO);if(g.equals(b,g.ONE))return g.copy(a,g.ONE);if(g.equals(b,g.INFINITY))return g.copy(a,g.INFINITY);if(g.equals(b,g.INFINULL))return g.copy(a,g.INFINULL);var d=g.isNegative(b);d&&(b[0]=b[0].negate());g.copy(a,g.ONE);for(var h=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=g.clone(g.ONE),l=q;!g.approximates(b,e)&&l--;)g.isLessThan(b,e)?(h[0]=h[0].add(h[1]),h[2]=h[2].add(h[3])):(h[1]=h[1].add(h[0]),h[3]=h[3].add(h[2])),a[0]=h[0].add(h[1]),a[1]=h[2].add(h[3]),g.pow(e,a,c);d&&(b[0]=
b[0].negate(),1===c%2&&g.neg(a,a));return a};g.dot=function(a,b){return a[0].multiply(b[0]).add(a[1].multiply(b[1]))};g.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};g.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};g.dec=g.toDecimal;g.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};g.round=g.toInteger;g.toBigInteger=function(a){return a[0].quotient(a[1])};g.floor=function(a){return Math.floor(g.toDecimal(a))};
g.ceil=function(a){return Math.ceil(g.toDecimal(a))};g.fromInteger_copy=function(a,b){a[0]=BigInteger(b);a[1]=BigInteger.ONE;return a};g.fromInteger=function(a){return g.fromInteger_copy(g.create(),a)};g.fromIntegerInverse_copy=function(a,b){a[0]=BigInteger.ONE;a[1]=BigInteger(b);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};g.fromIntegerInverse=function(a){return g.fromIntegerInverse_copy(g.create(),a)};g.fromDecimal=function(a){return g.fromDecimal_copy(g.create(),a)};g.fromDecimal_copy=
function(a,b){b=parseFloat(b);if(isNaN(b))return g.copy(a,g.INFINULL);if(Infinity===b)return g.copy(a,g.INFINITY);if(Math.abs(b)<g.EPSILON)return g.copy(a,g.ZERO);if(Math.abs(b-1)<g.EPSILON)return g.copy(a,g.ONE);if(Math.abs(b%1)<g.EPSILON)return g.fromInteger_copy(a,b);if(Math.abs(1/b%1)<g.EPSILON)return g.fromIntegerInverse_copy(a,Math.round(1/b));g.copy(a,g.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=b,h=BigInteger(1),e=g.MAX_LOOPS;e--&&Math.abs(b-g.toDecimal(a))>
g.EPSILON;){h=BigInteger(Math.floor(d));a[0]=h.multiply(c[0]).add(c[2]);a[1]=h.multiply(c[1]).add(c[3]);if(h=d-parseInt(h.toString(),10))d=1/h;else{if(b.toString()===g.toDecimal(a))break;d=(c=(b.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;g.add(a,g.fromInteger(c[1]),g.fromValues(c[2],Math.pow(10,d)));break}c[2]=c[0];c[3]=c[1];c[0]=a[0];c[1]=a[1]}return a};g.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return g.normalize(a,a)};g.sin=function(a,b){if(b[1].isZero())return g.copy(a,g.ZERO);g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.add(c,c,g.ONE);g.divide(a,a,c);return a};g.cos=function(a,b){if(b[1].isZero())return g.neg(a,g.ONE);var c=g.create();g.pow(c,b,2);g.sub(a,g.ONE,c);var d=g.create();g.add(d,g.ONE,c);g.divide(a,a,d);return a};g.tan=function(a,b){g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.scalar_multiply(c,c,2);g.add(a,a,c);g.pow(c,b,4);g.sub(c,
g.ONE,c);g.divide(a,a,c);return a};g.toEgyptian=function(a){a=g.clone(a);g.abs(a,a);var b=g.floor(a);b&&g.sub(a,a,g.fromInteger(b));if(!a[0])return b.toString();b||(b="");for(var c=1,d=g.create();1!==a[0];)c++,d=g.fromValues(1,c),g.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=g.str(d),g.sub(a,a,d));return a?b?b+" + "+g.str(a):g.str(a):b?b:"0"};g.toBabylonian=function(a){var b="",c=g.toDecimal(a);a=parseInt(c);for(var c=c-a,d=0,h=0;0<a;)(d=a%60)&&(b=d+" * 60^"+h+(b?" + ":"")+b),a=(a-d)/60,h++;for(h=-1;0<
c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+h),h--);return b?b:"0"};g.traceSternBrocot=function(a){var b="";if(g.equals(a,g.ZERO)||g.equals(a,g.ONE)||g.equals(a,g.INFINITY)||g.equals(a,g.INFINULL))return b;a=g.clone(a);g.isNegative(a)&&(a[0]=a[0].negate());for(var c=g.clone(g.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],h=0,e=0,l=65536;!g.equals(a,c)&&l--;)g.isLessThan(a,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),e++,h&&(b+="R",1!==h&&(b+=h),h=
0,b+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),h++,e&&(b+="L",1!==e&&(b+=e),e=0,b+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);e?(b+="L",1!==e&&(b+=e)):h&&(b+="R",1!==h&&(b+=h));0>l&&(b+="...");return b};g.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(g.equals(a,g.ZERO))return[0];if(g.equals(a,g.ONE))return[1];if(g.equals(a,g.NEGONE))return[-1];if(g.equals(a,g.INFINITY))return[1,0];if(g.equals(a,g.INFINULL))return[0,0];var c=g.clone(a),d=g.isNegative(c);d&&
(c[0]=c[0].negate());for(var h=g.clone(g.ONE),e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],l=1,m=[0],n=m.length-1;!g.equals(c,h)&&b--;)g.isLessThan(c,h)?(-1===l?m[n]++:(l=-1,m.push(1),n++),e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(1===l?m[n]++:(l=1,m.push(1),n++),e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),h[0]=e[0].add(e[1]),h[1]=e[2].add(e[3]);0>b?m.push(0):m[n]++;if(d)for(var k in m)m[k]=-m[k];return m};g.fromContinuedFraction=function(a,b){g.fromInteger_copy(a,b[b.length-1]);for(var c=
b.length-2;-1<c;c--)g.invert(a,a),g.add(a,g.fromInteger(b[c]),a);return a};g.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return g.fromInteger_copy(a,factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(g.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)g.scalar_multiply(a,a,++c);return a};g.dump=function(a){return"bigrat\t"+g.str(a)+"\n~\t"+g.toDecimal(a)+"\nCF:\t["+g.toContinuedFraction(a)+"]\n"};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);g.NEGONE=g.fromInteger(-1);
g.INFINITY=g.fromValues(1,0);g.INFINULL=g.fromValues(0,0);g.INFINITESIMAL=g.clone([new BigInteger(1),k]);g.PI=g.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof b&&(b.bigrat=g);var n=function(a,b){this.a=c.fromValues(parseInt(a),parseInt(b))};n.prototype.toString=function(){return c.str(this.a)};n.prototype.toContinuedFraction=function(a){return c.toContinuedFraction(this.a,a)};n.prototype.invert=function(){return c.invert(this.a)};n.prototype.reciprocal=n.prototype.invert;n.prototype.add=function(a){var b=c.create();c.add(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.plus=n.prototype.add;n.prototype.subtract=function(a){var b=c.create();
c.sub(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.sub=n.prototype.subtract;n.prototype.minus=n.prototype.subtract;n.prototype.multiply=function(a){var b=c.create();c.mul(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.mul=n.prototype.multiply;n.prototype.times=n.prototype.multiply;n.prototype.mediant=function(a){var b=c.create();c.mediant(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.divide=function(a){var b=c.create();c.div(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.div=n.prototype.divide;
n.prototype.divided_by=n.prototype.divide;n.prototype.power=function(a){var b=c.create();c.pow(b,this.a,a);return new n(b[0],b[1])};n.prototype.pow=n.prototype.power;n.prototype.dump=function(){return c.dump(this.a)};n.prototype.toRat=function(){return c.clone(this.a)};n.prototype.toDecimal=function(){return c.toDecimal(this.a)};n.fromRat=function(a){var b=new n;b.a[0]=a[0];b.a[1]=a[1];return b};n.fromInteger=function(a){return n.fromRat(c.fromInteger(a))};n.fromIntegerInverse=function(a){return n.fromRat(c.fromIntegerInverse(a))};
n.fromDecimal=function(a){return n.fromRat(c.fromDecimal(a))};n.fromContinuedFraction=function(a){return n.fromRat(c.fromContinuedFraction(c.create(),a))};"undefined"!==typeof b&&(b.rational=n);var t={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<t.GREEK.length?t.GREEK[this.i++]:"?"}}};"undefined"!==typeof b&&(b.alpha=t);e={};e.FINE_STRUCTURE=g.fromValues(30223,4141639);
e.a=e.FINE_STRUCTURE;e.FINE_STRUCTURE_ALT=g.fromValues(13355891,1830237867);e.PLANK=g.fromValues(662606957,1E42);e.h=e.PLANK;e.hBAR=g.fromValues(1054571726,1E43);e.GRAVITATIONAL=g.fromValues(667384,1E16);e.G=e.GRAVITATIONAL;e.SPEED_OF_LIGHT=g.fromInteger(299792458);e.c=e.SPEED_OF_LIGHT;"undefined"!==typeof b&&(b.physics=e);var u={create:function(){return[[],[]]},fromValues:function(a){var b=u.create();b[0]=a.slice();a=u.countDimensions(b);for(b[1]=Array(a);a--;)b[1][a]=0;return u.normalize(b,b)},
mergeDimension:function(a,b,c){a[0]=[b.slice()];a[1].push(0);for(var d in c)a[0].push(c[d]);return a},evaluate:function(a,b,c){g.copy(a,g.ZERO);var d=u.countDimensions(b);if(0===d)return"0";if(1===d)for(var h in b[0]){if(b[0][h]){var d=g.fromInteger(b[0][h]),e=g.pow(g.create(),g.fromInteger(c[0]),b[1][0]+ +h);g.mul(d,d,e);g.add(a,a,d)}}else if(2===d)for(var l in b[0])for(h in b[0][l]){if(b[0][l][h]){var d=g.fromInteger(b[0][l][h]),e=g.pow(g.create(),g.fromInteger(c[0]),b[1][1]+ +h),m=g.pow(g.create(),
g.fromInteger(c[1]),b[1][0]+ +l);g.mul(d,d,e);g.mul(d,d,m);g.add(a,a,d)}}else if(3===d)for(var n in b[0])for(l in b[0][n])for(h in b[0][n][l]){if(b[0][n][l][h]){var d=g.fromInteger(b[0][n][l][h]),e=g.pow(g.create(),g.fromInteger(c[0]),b[1][2]+ +h),m=g.pow(g.create(),g.fromInteger(c[1]),b[1][1]+ +l),k=g.pow(g.create(),g.fromInteger(c[1]),b[1][0]+ +n);g.mul(d,d,e);g.mul(d,d,m);g.mul(d,d,k);g.add(a,a,d)}}else alert("unsupported dimension "+d);return a},derivatives:function(a){return[]},forEachNonZeroElement:function(a,
b){for(var c=a.slice(),d=0;"object"===typeof c[0];)c=c[0].slice(),d++;for(var h=d+1;0<h;--h){print(Array(h).join("[0]"));var c=eval("(a"+Array(h).join("[0]")+")"),g;for(g in c)for(var e=d+2;0<e;--e)print(c[g])}return""},str:function(a){var b="",c=new t.iterator,d=c.next(),h=c.next(),c=c.next(),g=u.countDimensions(a);if(0===g)b+=a.toString();else if(1===g)for(var e in a[0]){if(a[0][e]){b?b+=" "+(0>a[0][e]?"-":"+")+" ":0>a[0][e]&&(b+="-");var g=Math.abs(a[0][e]),l=a[1][0]+ +e;if(1!==g||0===l)b+=g;0!==
l&&(b+=d+(1===l?"":"<sup>"+l+"</sup>"))}}else if(2===g)for(var m in a[0])for(e in a[0][m]){if(a[0][m][e]){b?b+=" "+(0>a[0][m][e]?"-":"+")+" ":0>a[0][m][e]&&(b+="-");var g=Math.abs(a[0][m][e]),l=a[1][1]+ +e,n=a[1][0]+ +m;if(1!==g||0===n&&0===l)b+=g;0!==l&&(b+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==n&&(b+=h+(1===n?"":"<sup>"+n+"</sup>"))}}else if(3===g)for(var k in a[0])for(m in a[0][k])for(e in a[0][k][m]){if(a[0][k][m][e]){b?b+=" "+(0>a[0][k][m][e]?"-":"+")+" ":0>a[0][k][m][e]&&(b+="-");var g=Math.abs(a[0][k][m][e]),
l=a[1][2]+ +e,n=a[1][1]+ +m,r=a[1][0]+ +k;if(1!==g||0===r&&0===n&&0===l)b+=g;0!==l&&(b+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==n&&(b+=h+(1===n?"":"<sup>"+n+"</sup>"));0!==r&&(b+=c+(1===r?"":"<sup>"+r+"</sup>"))}}else alert("unsupported dimension "+g);""===b&&(b="0");return b},getJSFormula:function(a){var b="",c=u.countDimensions(a);if(0===c)return"0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d],c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var h in a[0])for(d in a[0][h]){if(a[0][h][d]){b&&
(b+="+");var b=b+a[0][h][d],c=a[1][1]+ +d,g=a[1][0]+ +h;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==g&&(b=1===g?b+"*m[1]":b+("*Math.pow(m[1],"+g+")"))}}else if(3===c)for(var e in a[0])for(h in a[0][e])for(d in a[0][e][h]){if(a[0][e][h][d]){b&&(b+="+");var b=b+a[0][e][h][d],c=a[1][2]+ +d,g=a[1][1]+ +h,l=a[1][0]+ +e;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==g&&(b=1===g?b+"*m[1]":b+("*Math.pow(m[1],"+g+")"));0!==l&&(b=1===l?b+"*m[2]":b+("*Math.pow(m[2],"+l+")"))}}else alert("unsupported dimension "+
c);""===b&&(b="0");return b}};String.prototype.repeat=function(a){return Array(a+1).join(this)};u.getGLSLFormula=function(a){var b="",c=u.countDimensions(a);if(0===c)return"0.0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d]+".0",c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var h in a[0])for(d in a[0][h]){if(a[0][h][d]){b&&(b+="+");var b=b+(a[0][h][d]+".0"),c=a[1][1]+ +d,g=a[1][0]+ +h;0!==c&&(b=1===
c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==g&&(b=1===g?b+"*m_1":1<g?b+"*m_1".repeat(g):b+("*pow(1.0"+"*m_1".repeat(Math.abs(g))+",-1.0)"))}}else alert("unsupported dimension "+c);""===b&&(b="0.0");return b};u.toJSON=function(a){return JSON.stringify(a)};u.fromJSON=function(a){return JSON.parse(a)};u.normalize=function(a,b){return b};u.binary_operation=function(a,b,c,d){a=u.create();var h=u.countDimensions(b),g=u.countDimensions(c);b[1][e]!==c[1][e]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===h&&1===g){for(var e in b[0])a[0][e]="undefined"===typeof c[0][e]?b[0][e]:d(b[0][e],c[0][e]);for(e in c[0])"undefined"===typeof b[0][e]&&(a[0][e]=c[0][e]);for(e in a[0])"undefined"===typeof b[0][e]&&"undefined"===typeof c[0][e]&&(a[0][e]=null)}else alert("unsupported dimension "+h);for(e=h;e--;)a[1][e]=b[1][e];return a};u.add=function(a,b,c){return u.binary_operation(a,b,c,function(a,b){return a+b})};u.subtract=function(a,
b,c){return u.binary_operation(a,b,c,function(a,b){return a-b})};u.sub=u.subtract;u.multiply=function(a,b,c){return a};u.mul=u.multiply;u.divide=function(a,b,c){return a};u.div=u.divide;u.equals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};u.countDimensions=function(a){return"object"===typeof a[0]?u._countDimensions(a[0],1):0};u._countDimensions=function(a,b){return"object"===typeof a[0]?u._countDimensions(a[0],++b):b};u.ZERO=u.fromValues([0]);u.IDENTITY=u.fromValues([1]);u.ONE=u.IDENTITY;"undefined"!==
typeof b&&(b.polyrat=u)})(k)})(this);/*
   Copyright 2008-2014 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
*/
(function(e,k,b){(function(a){"function"===typeof define&&define.amd?define("datatables",["jquery"],a):"object"===typeof exports?a(require("jquery")):jQuery&&!jQuery.fn.dataTable&&a(jQuery)})(function(a){function d(b){var c,f,h={};a.each(b,function(a,g){(c=a.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(c[1]+" ")&&(f=a.replace(c[0],c[2].toLowerCase()),h[f]=a,"o"===c[1]&&d(b[a]))});b._hungarianMap=h}function h(c,f,g){c._hungarianMap||d(c);var e;a.each(f,function(d,p){e=c._hungarianMap[d];
e===b||!g&&f[e]!==b||("o"===e.charAt(0)?(f[e]||(f[e]={}),a.extend(!0,f[e],f[d]),h(c[e],f[e],g)):f[e]=f[d])})}function m(a){var b=z.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&c&&"No data available in table"===b.sEmptyTable&&ga(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&c&&"Loading..."===b.sLoadingRecords&&ga(a,a,"sZeroRecords","sLoadingRecords");a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&cb(a)}function l(a){ca(a,"ordering","bSort");ca(a,"orderMulti","bSortMulti");
ca(a,"orderClasses","bSortClasses");ca(a,"orderCellsTop","bSortCellsTop");ca(a,"order","aaSorting");ca(a,"orderFixed","aaSortingFixed");ca(a,"paging","bPaginate");ca(a,"pagingType","sPaginationType");ca(a,"pageLength","iDisplayLength");ca(a,"searching","bFilter");if(a=a.aoSearchCols)for(var b=0,c=a.length;b<c;b++)a[b]&&h(z.models.oSearch,a[b])}function c(a){ca(a,"orderable","bSortable");ca(a,"orderData","aDataSort");ca(a,"orderSequence","asSorting");ca(a,"orderDataType","sortDataType")}function r(b){b=
b.oBrowser;var c=a("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(a("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(a('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body"),d=c.find(".test");b.bScrollOversize=100===d[0].offsetWidth;b.bScrollbarLeft=1!==d.offset().left;c.remove()}function q(a,c,d,f,h,g){var e,p=!1;d!==b&&(e=d,p=!0);for(;f!==h;)a.hasOwnProperty(f)&&(e=p?c(e,a[f],f,a):a[f],p=!0,f+=g);return e}
function g(b,c){var d=z.defaults.column,f=b.aoColumns.length,d=a.extend({},z.models.oColumn,d,{nTh:c?c:k.createElement("th"),sTitle:d.sTitle?d.sTitle:c?c.innerHTML:"",aDataSort:d.aDataSort?d.aDataSort:[f],mData:d.mData?d.mData:f,idx:f});b.aoColumns.push(d);d=b.aoPreSearchCols;d[f]=a.extend({},z.models.oSearch,d[f]);n(b,f,null)}function n(d,f,g){f=d.aoColumns[f];var e=d.oClasses,p=a(f.nTh);if(!f.sWidthOrig){f.sWidthOrig=p.attr("width")||null;var l=(p.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);
l&&(f.sWidthOrig=l[1])}g!==b&&null!==g&&(c(g),h(z.defaults.column,g),g.mDataProp===b||g.mData||(g.mData=g.mDataProp),g.sType&&(f._sManualType=g.sType),g.className&&!g.sClass&&(g.sClass=g.className),a.extend(f,g),ga(f,g,"sWidth","sWidthOrig"),"number"===typeof g.iDataSort&&(f.aDataSort=[g.iDataSort]),ga(f,g,"aDataSort"));var m=f.mData,n=J(m),v=f.mRender?J(f.mRender):null;g=function(a){return"string"===typeof a&&-1!==a.indexOf("@")};f._bAttrSrc=a.isPlainObject(m)&&(g(m.sort)||g(m.type)||g(m.filter));
f.fnGetData=function(a,c,d){var X=n(a,c,b,d);return v&&c?v(X,c,a,d):X};f.fnSetData=function(a,b,c){return C(m)(a,b,c)};"number"!==typeof m&&(d._rowReadObject=!0);d.oFeatures.bSort||(f.bSortable=!1,p.addClass(e.sSortableNone));d=-1!==a.inArray("asc",f.asSorting);g=-1!==a.inArray("desc",f.asSorting);f.bSortable&&(d||g)?d&&!g?(f.sSortingClass=e.sSortableAsc,f.sSortingClassJUI=e.sSortJUIAscAllowed):!d&&g?(f.sSortingClass=e.sSortableDesc,f.sSortingClassJUI=e.sSortJUIDescAllowed):(f.sSortingClass=e.sSortable,
f.sSortingClassJUI=e.sSortJUI):(f.sSortingClass=e.sSortableNone,f.sSortingClassJUI="")}function t(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;La(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;""===b.sY&&""===b.sX||ta(a);V(a,null,"column-sizing",[a])}function u(a,b){var c=A(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function f(b,c){var d=A(b,"bVisible"),d=a.inArray(c,d);return-1!==d?d:null}function x(a){return A(a,"bVisible").length}function A(b,c){var d=
[];a.map(b.aoColumns,function(a,b){a[c]&&d.push(b)});return d}function E(a){var c=a.aoColumns,d=a.aoData,f=z.ext.type.detect,g,h,e,p,l,m,n,v,k;g=0;for(h=c.length;g<h;g++)if(n=c[g],k=[],!n.sType&&n._sManualType)n.sType=n._sManualType;else if(!n.sType){e=0;for(p=f.length;e<p;e++){l=0;for(m=d.length;l<m;l++){k[l]===b&&(k[l]=B(a,l,g,"type"));v=f[e](k[l],a);if(!v&&e!==f.length-1)break;if("html"===v)break}if(v){n.sType=v;break}}n.sType||(n.sType="string")}}function M(c,d,f,h){var e,p,l,m,n,v,k=c.aoColumns;
if(d)for(e=d.length-1;0<=e;e--){v=d[e];var w=v.targets!==b?v.targets:v.aTargets;a.isArray(w)||(w=[w]);p=0;for(l=w.length;p<l;p++)if("number"===typeof w[p]&&0<=w[p]){for(;k.length<=w[p];)g(c);h(w[p],v)}else if("number"===typeof w[p]&&0>w[p])h(k.length+w[p],v);else if("string"===typeof w[p])for(m=0,n=k.length;m<n;m++)("_all"==w[p]||a(k[m].nTh).hasClass(w[p]))&&h(m,v)}if(f)for(e=0,c=f.length;e<c;e++)h(e,f[e])}function G(b,c,d,f){var g=b.aoData.length,h=a.extend(!0,{},z.models.oRow,{src:d?"dom":"data"});
h._aData=c;b.aoData.push(h);c=b.aoColumns;for(var h=0,e=c.length;h<e;h++)d&&D(b,g,h,B(b,g,h)),c[h].sType=null;b.aiDisplayMaster.push(g);!d&&b.oFeatures.bDeferRender||w(b,g,d,f);return g}function I(b,c){var d;c instanceof a||(c=a(c));return c.map(function(a,c){d=v(b,c);return G(b,d.data,c,d.cells)})}function B(a,c,d,f){var h=a.iDraw,g=a.aoColumns[d],e=a.aoData[c]._aData,p=g.sDefaultContent;d=g.fnGetData(e,f,{settings:a,row:c,col:d});if(d===b)return a.iDrawError!=h&&null===p&&(ma(a,0,"Requested unknown parameter "+
("function"==typeof g.mData?"{function}":"'"+g.mData+"'")+" for row "+c,4),a.iDrawError=h),p;if((d===e||null===d)&&null!==p)d=p;else if("function"===typeof d)return d.call(e);return null===d&&"display"==f?"":d}function D(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d,{settings:a,row:b,col:c})}function H(b){return a.map(b.match(/(\\.|[^\.])+/g),function(a){return a.replace(/\\./g,".")})}function J(c){if(a.isPlainObject(c)){var d={};a.each(c,function(a,b){b&&(d[a]=J(b))});return function(a,
c,f,X){var g=d[c]||d._;return g!==b?g(a,c,f,X):a}}if(null===c)return function(a){return a};if("function"===typeof c)return function(a,b,d,f){return c(a,b,d,f)};if("string"!==typeof c||-1===c.indexOf(".")&&-1===c.indexOf("[")&&-1===c.indexOf("("))return function(a,b){return a[c]};var f=function(a,c,d){var X,g;if(""!==d){g=H(d);for(var h=0,e=g.length;h<e;h++){d=g[h].match(ua);X=g[h].match(na);if(d){g[h]=g[h].replace(ua,"");""!==g[h]&&(a=a[g[h]]);X=[];g.splice(0,h+1);g=g.join(".");h=0;for(e=a.length;h<
e;h++)X.push(f(a[h],c,g));a=d[0].substring(1,d[0].length-1);a=""===a?X:X.join(a);break}else if(X){g[h]=g[h].replace(na,"");a=a[g[h]]();continue}if(null===a||a[g[h]]===b)return b;a=a[g[h]]}}return a};return function(a,b){return f(a,b,c)}}function C(c){if(a.isPlainObject(c))return C(c._);if(null===c)return function(){};if("function"===typeof c)return function(a,b,d){c(a,"set",b,d)};if("string"!==typeof c||-1===c.indexOf(".")&&-1===c.indexOf("[")&&-1===c.indexOf("("))return function(a,b){a[c]=b};var d=
function(a,c,f){f=H(f);var g;g=f[f.length-1];for(var h,X,e=0,p=f.length-1;e<p;e++){h=f[e].match(ua);X=f[e].match(na);if(h){f[e]=f[e].replace(ua,"");a[f[e]]=[];g=f.slice();g.splice(0,e+1);h=g.join(".");X=0;for(p=c.length;X<p;X++)g={},d(g,c[X],h),a[f[e]].push(g);return}X&&(f[e]=f[e].replace(na,""),a=a[f[e]](c));if(null===a[f[e]]||a[f[e]]===b)a[f[e]]={};a=a[f[e]]}if(g.match(na))a[g.replace(na,"")](c);else a[g.replace(ua,"")]=c};return function(a,b){return d(a,b,c)}}function L(a){return fa(a.aoData,"_aData")}
function P(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0}function N(a,c,d){for(var f=-1,g=0,h=a.length;g<h;g++)a[g]==c?f=g:a[g]>c&&a[g]--; -1!=f&&d===b&&a.splice(f,1)}function p(a,c,d,f){var g=a.aoData[c],h,e=function(b,d){for(;b.childNodes.length;)b.removeChild(b.firstChild);b.innerHTML=B(a,c,d,"display")};if("dom"!==d&&(d&&"auto"!==d||"dom"!==g.src)){var p=g.anCells;if(p)if(f!==b)e(p[f],f);else for(d=0,h=p.length;d<h;d++)e(p[d],d)}else g._aData=v(a,g,f,f===b?b:g._aData).data;
g._aSortData=null;g._aFilterData=null;e=a.aoColumns;if(f!==b)e[f].sType=null;else{d=0;for(h=e.length;d<h;d++)e[d].sType=null;F(g)}}function v(c,d,f,g){var h=[],e=d.firstChild,p,l=0,m,n=c.aoColumns,v=c._rowReadObject;g=g||v?{}:[];var k=function(a,b){if("string"===typeof a){var c=a.indexOf("@");-1!==c&&(c=a.substring(c+1),C(a)(g,b.getAttribute(c)))}};c=function(c){if(f===b||f===l)p=n[l],m=a.trim(c.innerHTML),p&&p._bAttrSrc?(C(p.mData._)(g,m),k(p.mData.sort,c),k(p.mData.type,c),k(p.mData.filter,c)):
v?(p._setter||(p._setter=C(p.mData)),p._setter(g,m)):g[l]=m;l++};if(e)for(;e;){d=e.nodeName.toUpperCase();if("TD"==d||"TH"==d)c(e),h.push(e);e=e.nextSibling}else for(h=d.anCells,e=0,d=h.length;e<d;e++)c(h[e]);return{data:g,cells:h}}function w(a,b,c,d){var f=a.aoData[b],g=f._aData,h=[],e,p,l,m,n;if(null===f.nTr){e=c||k.createElement("tr");f.nTr=e;f.anCells=h;e._DT_RowIndex=b;F(f);m=0;for(n=a.aoColumns.length;m<n;m++){l=a.aoColumns[m];p=c?d[m]:k.createElement(l.sCellType);h.push(p);if(!c||l.mRender||
l.mData!==m)p.innerHTML=B(a,b,m,"display");l.sClass&&(p.className+=" "+l.sClass);l.bVisible&&!c?e.appendChild(p):!l.bVisible&&c&&p.parentNode.removeChild(p);l.fnCreatedCell&&l.fnCreatedCell.call(a.oInstance,p,B(a,b,m),g,b,m)}V(a,"aoRowCreatedCallback",null,[e,g,b])}f.nTr.setAttribute("role","row")}function F(b){var c=b.nTr,d=b._aData;if(c){d.DT_RowId&&(c.id=d.DT_RowId);if(d.DT_RowClass){var f=d.DT_RowClass.split(" ");b.__rowc=b.__rowc?Ma(b.__rowc.concat(f)):f;a(c).removeClass(b.__rowc.join(" ")).addClass(d.DT_RowClass)}d.DT_RowData&&
a(c).data(d.DT_RowData)}}function R(b){var c,d,f,g,h,e=b.nTHead,p=b.nTFoot,l=0===a("th, td",e).length,m=b.oClasses,n=b.aoColumns;l&&(g=a("<tr/>").appendTo(e));c=0;for(d=n.length;c<d;c++)h=n[c],f=a(h.nTh).addClass(h.sClass),l&&f.appendTo(g),b.oFeatures.bSort&&(f.addClass(h.sSortingClass),!1!==h.bSortable&&(f.attr("tabindex",b.iTabIndex).attr("aria-controls",b.sTableId),Na(b,h.nTh,c))),h.sTitle!=f.html()&&f.html(h.sTitle),Oa(b,"header")(b,f,h,m);l&&Z(b.aoHeader,e);a(e).find(">tr").attr("role","row");
a(e).find(">tr>th, >tr>td").addClass(m.sHeaderTH);a(p).find(">tr>th, >tr>td").addClass(m.sFooterTH);if(null!==p)for(b=b.aoFooter[0],c=0,d=b.length;c<d;c++)h=n[c],h.nTf=b[c].cell,h.sClass&&a(h.nTf).addClass(h.sClass)}function S(c,d,f){var g,h,e,p=[],l=[],m=c.aoColumns.length,n;if(d){f===b&&(f=!1);g=0;for(h=d.length;g<h;g++){p[g]=d[g].slice();p[g].nTr=d[g].nTr;for(e=m-1;0<=e;e--)c.aoColumns[e].bVisible||f||p[g].splice(e,1);l.push([])}g=0;for(h=p.length;g<h;g++){if(c=p[g].nTr)for(;e=c.firstChild;)c.removeChild(e);
e=0;for(d=p[g].length;e<d;e++)if(n=m=1,l[g][e]===b){c.appendChild(p[g][e].cell);for(l[g][e]=1;p[g+m]!==b&&p[g][e].cell==p[g+m][e].cell;)l[g+m][e]=1,m++;for(;p[g][e+n]!==b&&p[g][e].cell==p[g][e+n].cell;){for(f=0;f<m;f++)l[g+f][e+n]=1;n++}a(p[g][e].cell).attr("rowspan",m).attr("colspan",n)}}}}function y(c){var d=V(c,"aoPreDrawCallback","preDraw",[c]);if(-1!==a.inArray(!1,d))ea(c,!1);else{var d=[],f=0,g=c.asStripeClasses,h=g.length,e=c.oLanguage,p=c.iInitDisplayStart,l="ssp"==da(c),m=c.aiDisplay;c.bDrawing=
!0;p!==b&&-1!==p&&(c._iDisplayStart=l?p:p>=c.fnRecordsDisplay()?0:p,c.iInitDisplayStart=-1);var p=c._iDisplayStart,n=c.fnDisplayEnd();if(c.bDeferLoading)c.bDeferLoading=!1,c.iDraw++,ea(c,!1);else if(!l)c.iDraw++;else if(!c.bDestroying&&!oa(c))return;if(0!==m.length)for(e=l?c.aoData.length:n,l=l?0:p;l<e;l++){var v=m[l],k=c.aoData[v];null===k.nTr&&w(c,v);v=k.nTr;if(0!==h){var t=g[f%h];k._sRowStripe!=t&&(a(v).removeClass(k._sRowStripe).addClass(t),k._sRowStripe=t)}V(c,"aoRowCallback",null,[v,k._aData,
f,l]);d.push(v);f++}else f=e.sZeroRecords,1==c.iDraw&&"ajax"==da(c)?f=e.sLoadingRecords:e.sEmptyTable&&0===c.fnRecordsTotal()&&(f=e.sEmptyTable),d[0]=a("<tr/>",{"class":h?g[0]:""}).append(a("<td />",{valign:"top",colSpan:x(c),"class":c.oClasses.sRowEmpty}).html(f))[0];V(c,"aoHeaderCallback","header",[a(c.nTHead).children("tr")[0],L(c),p,n,m]);V(c,"aoFooterCallback","footer",[a(c.nTFoot).children("tr")[0],L(c),p,n,m]);g=a(c.nTBody);g.children().detach();g.append(a(d));V(c,"aoDrawCallback","draw",[c]);
c.bSorted=!1;c.bFiltered=!1;c.bDrawing=!1}}function T(a,b){var c=a.oFeatures,d=c.bFilter;c.bSort&&db(a);d?ka(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;y(a);a._drawHold=!1}function ia(b){var c=b.oClasses,d=a(b.nTable),d=a("<div/>").insertBefore(d),f=b.oFeatures,g=a("<div/>",{id:b.sTableId+"_wrapper","class":c.sWrapper+(b.nTFoot?"":" "+c.sNoFooter)});b.nHolding=d[0];b.nTableWrapper=g[0];b.nTableReinsertBefore=b.nTable.nextSibling;for(var h=
b.sDom.split(""),e,p,l,m,n,v,k=0;k<h.length;k++){e=null;p=h[k];if("<"==p){l=a("<div/>")[0];m=h[k+1];if("'"==m||'"'==m){n="";for(v=2;h[k+v]!=m;)n+=h[k+v],v++;"H"==n?n=c.sJUIHeader:"F"==n&&(n=c.sJUIFooter);-1!=n.indexOf(".")?(m=n.split("."),l.id=m[0].substr(1,m[0].length-1),l.className=m[1]):"#"==n.charAt(0)?l.id=n.substr(1,n.length-1):l.className=n;k+=v}g.append(l);g=a(l)}else if(">"==p)g=g.parent();else if("l"==p&&f.bPaginate&&f.bLengthChange)e=eb(b);else if("f"==p&&f.bFilter)e=xa(b);else if("r"==
p&&f.bProcessing)e=fb(b);else if("t"==p)e=gb(b);else if("i"==p&&f.bInfo)e=hb(b);else if("p"==p&&f.bPaginate)e=ib(b);else if(0!==z.ext.feature.length)for(l=z.ext.feature,v=0,m=l.length;v<m;v++)if(p==l[v].cFeature){e=l[v].fnInit(b);break}e&&(l=b.aanFeatures,l[p]||(l[p]=[]),l[p].push(e),g.append(e))}d.replaceWith(g)}function Z(b,c){var d=a(c).children("tr"),f,g,h,e,p,l,m,n,v,k;b.splice(0,b.length);h=0;for(l=d.length;h<l;h++)b.push([]);h=0;for(l=d.length;h<l;h++)for(f=d[h],g=f.firstChild;g;){if("TD"==
g.nodeName.toUpperCase()||"TH"==g.nodeName.toUpperCase()){n=1*g.getAttribute("colspan");v=1*g.getAttribute("rowspan");n=n&&0!==n&&1!==n?n:1;v=v&&0!==v&&1!==v?v:1;e=0;for(p=b[h];p[e];)e++;m=e;k=1===n?!0:!1;for(p=0;p<n;p++)for(e=0;e<v;e++)b[h+e][m+p]={cell:g,unique:k},b[h+e].nTr=f}g=g.nextSibling}}function aa(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],Z(c,b)));b=0;for(var f=c.length;b<f;b++)for(var g=0,h=c[b].length;g<h;g++)!c[b][g].unique||d[g]&&a.bSortCellsTop||(d[g]=c[b][g].cell);return d}function la(b,
c,d){V(b,"aoServerParams","serverParams",[c]);if(c&&a.isArray(c)){var f={},g=/(.*?)\[\]$/;a.each(c,function(a,b){var c=b.name.match(g);c?(c=c[0],f[c]||(f[c]=[]),f[c].push(b.value)):f[b.name]=b.value});c=f}var h,e=b.ajax,p=b.oInstance;if(a.isPlainObject(e)&&e.data){h=e.data;var l=a.isFunction(h)?h(c):h;c=a.isFunction(h)&&l?l:a.extend(!0,c,l);delete e.data}l={data:c,success:function(a){var c=a.error||a.sError;c&&b.oApi._fnLog(b,0,c);b.json=a;V(b,null,"xhr",[b,a]);d(a)},dataType:"json",cache:!1,type:b.sServerMethod,
error:function(a,c,d){d=b.oApi._fnLog;"parsererror"==c?d(b,0,"Invalid JSON response",1):4===a.readyState&&d(b,0,"Ajax error",7);ea(b,!1)}};b.oAjaxData=c;V(b,null,"preXhr",[b,c]);b.fnServerData?b.fnServerData.call(p,b.sAjaxSource,a.map(c,function(a,b){return{name:b,value:a}}),d,b):b.sAjaxSource||"string"===typeof e?b.jqXHR=a.ajax(a.extend(l,{url:e||b.sAjaxSource})):a.isFunction(e)?b.jqXHR=e.call(p,c,d,b):(b.jqXHR=a.ajax(a.extend(l,e)),e.data=h)}function oa(a){return a.bAjaxDataGet?(a.iDraw++,ea(a,
!0),la(a,pa(a),function(b){ya(a,b)}),!1):!0}function pa(b){var c=b.aoColumns,d=c.length,f=b.oFeatures,g=b.oPreviousSearch,h=b.aoPreSearchCols,e,p=[],l,m,n,v=qa(b);e=b._iDisplayStart;l=!1!==f.bPaginate?b._iDisplayLength:-1;var k=function(a,b){p.push({name:a,value:b})};k("sEcho",b.iDraw);k("iColumns",d);k("sColumns",fa(c,"sName").join(","));k("iDisplayStart",e);k("iDisplayLength",l);var w={draw:b.iDraw,columns:[],order:[],start:e,length:l,search:{value:g.sSearch,regex:g.bRegex}};for(e=0;e<d;e++)m=c[e],
n=h[e],l="function"==typeof m.mData?"function":m.mData,w.columns.push({data:l,name:m.sName,searchable:m.bSearchable,orderable:m.bSortable,search:{value:n.sSearch,regex:n.bRegex}}),k("mDataProp_"+e,l),f.bFilter&&(k("sSearch_"+e,n.sSearch),k("bRegex_"+e,n.bRegex),k("bSearchable_"+e,m.bSearchable)),f.bSort&&k("bSortable_"+e,m.bSortable);f.bFilter&&(k("sSearch",g.sSearch),k("bRegex",g.bRegex));f.bSort&&(a.each(v,function(a,b){w.order.push({column:b.col,dir:b.dir});k("iSortCol_"+a,b.col);k("sSortDir_"+
a,b.dir)}),k("iSortingCols",v.length));c=z.ext.legacy.ajax;return null===c?b.sAjaxSource?p:w:c?p:w}function ya(a,c){var d=function(a,d){return c[a]!==b?c[a]:c[d]},f=d("sEcho","draw"),g=d("iTotalRecords","recordsTotal"),d=d("iTotalDisplayRecords","recordsFiltered");if(f){if(1*f<a.iDraw)return;a.iDraw=1*f}P(a);a._iRecordsTotal=parseInt(g,10);a._iRecordsDisplay=parseInt(d,10);f=ra(a,c);g=0;for(d=f.length;g<d;g++)G(a,f[g]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;y(a);a._bInitComplete||
za(a,c);a.bAjaxDataGet=!0;ea(a,!1)}function ra(c,d){var f=a.isPlainObject(c.ajax)&&c.ajax.dataSrc!==b?c.ajax.dataSrc:c.sAjaxDataProp;return"data"===f?d.aaData||d[f]:""!==f?J(f)(d):d}function xa(b){var c=b.oClasses,d=b.sTableId,f=b.oLanguage,g=b.oPreviousSearch,h=b.aanFeatures,e='<input type="search" class="'+c.sFilterInput+'"/>',p=f.sSearch,p=p.match(/_INPUT_/)?p.replace("_INPUT_",e):p+e,c=a("<div/>",{id:h.f?null:d+"_filter","class":c.sFilter}).append(a("<label/>").append(p)),h=function(){var a=this.value?
this.value:"";a!=g.sSearch&&(ka(b,{sSearch:a,bRegex:g.bRegex,bSmart:g.bSmart,bCaseInsensitive:g.bCaseInsensitive}),b._iDisplayStart=0,y(b))},e=null!==b.searchDelay?b.searchDelay:"ssp"===da(b)?400:0,l=a("input",c).val(g.sSearch).attr("placeholder",f.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",e?Aa(h,e):h).bind("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",d);a(b.nTable).on("search.dt.DT",function(a,c){if(b===c)try{l[0]!==k.activeElement&&l.val(g.sSearch)}catch(d){}});
return c[0]}function ka(a,c,d){var f=a.oPreviousSearch,g=a.aoPreSearchCols,h=function(a){f.sSearch=a.sSearch;f.bRegex=a.bRegex;f.bSmart=a.bSmart;f.bCaseInsensitive=a.bCaseInsensitive},e=function(a){return a.bEscapeRegex!==b?!a.bEscapeRegex:a.bRegex};E(a);if("ssp"!=da(a)){jb(a,c.sSearch,d,e(c),c.bSmart,c.bCaseInsensitive);h(c);for(c=0;c<g.length;c++)Ba(a,g[c].sSearch,c,e(g[c]),g[c].bSmart,g[c].bCaseInsensitive);Ca(a)}else h(c);a.bFiltered=!0;V(a,null,"search",[a])}function Ca(a){for(var b=z.ext.search,
c=a.aiDisplay,d,f,g=0,h=b.length;g<h;g++){for(var e=[],p=0,l=c.length;p<l;p++)f=c[p],d=a.aoData[f],b[g](a,d._aFilterData,f,d._aData,p)&&e.push(f);c.length=0;c.push.apply(c,e)}}function Ba(a,b,c,d,f,g){if(""!==b){var h=a.aiDisplay;d=Pa(b,d,f,g);for(f=h.length-1;0<=f;f--)b=a.aoData[h[f]]._aFilterData[c],d.test(b)||h.splice(f,1)}}function jb(a,b,c,d,f,g){d=Pa(b,d,f,g);f=a.oPreviousSearch.sSearch;g=a.aiDisplayMaster;var h;0!==z.ext.search.length&&(c=!0);h=kb(a);if(0>=b.length)a.aiDisplay=g.slice();else{if(h||
c||f.length>b.length||0!==b.indexOf(f)||a.bSorted)a.aiDisplay=g.slice();b=a.aiDisplay;for(c=b.length-1;0<=c;c--)d.test(a.aoData[b[c]]._sFilterRow)||b.splice(c,1)}}function Pa(b,c,d,f){b=c?b:Da(b);d&&(b="^(?=.*?"+a.map(b.match(/"[^"]+"|[^ ]+/g)||"",function(a){if('"'===a.charAt(0)){var b=a.match(/^"(.*)"$/);a=b?b[1]:a}return a.replace('"',"")}).join(")(?=.*?")+").*$");return new RegExp(b,f?"i":"")}function Da(a){return a.replace(Jb,"\\$1")}function kb(a){var b=a.aoColumns,c,d,f,g,h,e,p,l,m=z.ext.type.search;
c=!1;d=0;for(g=a.aoData.length;d<g;d++)if(l=a.aoData[d],!l._aFilterData){e=[];f=0;for(h=b.length;f<h;f++)c=b[f],c.bSearchable?(p=B(a,d,f,"filter"),m[c.sType]&&(p=m[c.sType](p)),null===p&&(p=""),"string"!==typeof p&&p.toString&&(p=p.toString())):p="",p.indexOf&&-1!==p.indexOf("&")&&(Ea.innerHTML=p,p=Kb?Ea.textContent:Ea.innerText),p.replace&&(p=p.replace(/[\r\n]/g,"")),e.push(p);l._aFilterData=e;l._sFilterRow=e.join("  ");c=!0}return c}function lb(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,
caseInsensitive:a.bCaseInsensitive}}function mb(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function hb(b){var c=b.sTableId,d=b.aanFeatures.i,f=a("<div/>",{"class":b.oClasses.sInfo,id:d?null:c+"_info"});d||(b.aoDrawCallback.push({fn:nb,sName:"information"}),f.attr("role","status").attr("aria-live","polite"),a(b.nTable).attr("aria-describedby",c+"_info"));return f[0]}function nb(b){var c=b.aanFeatures.i;if(0!==c.length){var d=b.oLanguage,f=b._iDisplayStart+
1,g=b.fnDisplayEnd(),h=b.fnRecordsTotal(),e=b.fnRecordsDisplay(),p=e?d.sInfo:d.sInfoEmpty;e!==h&&(p+=" "+d.sInfoFiltered);p+=d.sInfoPostFix;p=ob(b,p);d=d.fnInfoCallback;null!==d&&(p=d.call(b.oInstance,b,f,g,h,e,p));a(c).html(p)}}function ob(a,b){var c=a.fnFormatNumber,d=a._iDisplayStart+1,f=a._iDisplayLength,g=a.fnRecordsDisplay(),h=-1===f;return b.replace(/_START_/g,c.call(a,d)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,
g)).replace(/_PAGE_/g,c.call(a,h?1:Math.ceil(d/f))).replace(/_PAGES_/g,c.call(a,h?1:Math.ceil(g/f)))}function va(a){var b,c,d=a.iInitDisplayStart,f=a.aoColumns,g;c=a.oFeatures;if(a.bInitialised){ia(a);R(a);S(a,a.aoHeader);S(a,a.aoFooter);ea(a,!0);c.bAutoWidth&&La(a);b=0;for(c=f.length;b<c;b++)g=f[b],g.sWidth&&(g.nTh.style.width=O(g.sWidth));T(a);f=da(a);"ssp"!=f&&("ajax"==f?la(a,[],function(c){var f=ra(a,c);for(b=0;b<f.length;b++)G(a,f[b]);a.iInitDisplayStart=d;T(a);ea(a,!1);za(a,c)},a):(ea(a,!1),
za(a)))}else setTimeout(function(){va(a)},200)}function za(a,b){a._bInitComplete=!0;b&&t(a);V(a,"aoInitComplete","init",[a,b])}function Qa(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Ra(a);V(a,null,"length",[a,c])}function eb(b){for(var c=b.oClasses,d=b.sTableId,f=b.aLengthMenu,g=a.isArray(f[0]),h=g?f[0]:f,f=g?f[1]:f,g=a("<select/>",{name:d+"_length","aria-controls":d,"class":c.sLengthSelect}),e=0,p=h.length;e<p;e++)g[0][e]=new Option(f[e],h[e]);var l=a("<div><label/></div>").addClass(c.sLength);
b.aanFeatures.l||(l[0].id=d+"_length");l.children().append(b.oLanguage.sLengthMenu.replace("_MENU_",g[0].outerHTML));a("select",l).val(b._iDisplayLength).bind("change.DT",function(c){Qa(b,a(this).val());y(b)});a(b.nTable).bind("length.dt.DT",function(c,d,f){b===d&&a("select",l).val(f)});return l[0]}function ib(b){var c=b.sPaginationType,d=z.ext.pager[c],f="function"===typeof d,g=function(a){y(a)},c=a("<div/>").addClass(b.oClasses.sPaging+c)[0],h=b.aanFeatures;f||d.fnInit(b,c,g);h.p||(c.id=b.sTableId+
"_paginate",b.aoDrawCallback.push({fn:function(a){if(f){var b=a._iDisplayStart,c=a._iDisplayLength,e=a.fnRecordsDisplay(),p=-1===c,b=p?0:Math.ceil(b/c),c=p?1:Math.ceil(e/c),e=d(b,c),l,p=0;for(l=h.p.length;p<l;p++)Oa(a,"pageButton")(a,h.p[p],p,e,b,c)}else d.fnUpdate(a,g)},sName:"pagination"}));return c}function Sa(a,b,c){var d=a._iDisplayStart,f=a._iDisplayLength,g=a.fnRecordsDisplay();0===g||-1===f?d=0:"number"===typeof b?(d=b*f,d>g&&(d=0)):"first"==b?d=0:"previous"==b?(d=0<=f?d-f:0,0>d&&(d=0)):"next"==
b?d+f<g&&(d+=f):"last"==b?d=Math.floor((g-1)/f)*f:ma(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==d;a._iDisplayStart=d;b&&(V(a,null,"page",[a]),c&&y(a));return b}function fb(b){return a("<div/>",{id:b.aanFeatures.r?null:b.sTableId+"_processing","class":b.oClasses.sProcessing}).html(b.oLanguage.sProcessing).insertBefore(b.nTable)[0]}function ea(b,c){b.oFeatures.bProcessing&&a(b.aanFeatures.r).css("display",c?"block":"none");V(b,null,"processing",[b,c])}function gb(b){var c=a(b.nTable);c.attr("role",
"grid");var d=b.oScroll;if(""===d.sX&&""===d.sY)return b.nTable;var f=d.sX,g=d.sY,h=b.oClasses,e=c.children("caption"),p=e.length?e[0]._captionSide:null,l=a(c[0].cloneNode(!1)),m=a(c[0].cloneNode(!1)),n=c.children("tfoot");d.sX&&"100%"===c.attr("width")&&c.removeAttr("width");n.length||(n=null);d=a("<div/>",{"class":h.sScrollWrapper}).append(a("<div/>",{"class":h.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:f?f?O(f):null:"100%"}).append(a("<div/>",{"class":h.sScrollHeadInner}).css({"box-sizing":"content-box",
width:d.sXInner||"100%"}).append(l.removeAttr("id").css("margin-left",0).append("top"===p?e:null).append(c.children("thead"))))).append(a("<div/>",{"class":h.sScrollBody}).css({overflow:"auto",height:g?O(g):null,width:f?O(f):null}).append(c));n&&d.append(a("<div/>",{"class":h.sScrollFoot}).css({overflow:"hidden",border:0,width:f?f?O(f):null:"100%"}).append(a("<div/>",{"class":h.sScrollFootInner}).append(m.removeAttr("id").css("margin-left",0).append("bottom"===p?e:null).append(c.children("tfoot")))));
var c=d.children(),v=c[0],h=c[1],k=n?c[2]:null;f&&a(h).scroll(function(a){a=this.scrollLeft;v.scrollLeft=a;n&&(k.scrollLeft=a)});b.nScrollHead=v;b.nScrollBody=h;b.nScrollFoot=k;b.aoDrawCallback.push({fn:ta,sName:"scrolling"});return d[0]}function ta(b){var c=b.oScroll,d=c.sX,f=c.sXInner,g=c.sY,h=c.iBarWidth,e=a(b.nScrollHead),p=e[0].style,l=e.children("div"),m=l[0].style,n=l.children("table"),l=b.nScrollBody,v=a(l),k=l.style,w=a(b.nScrollFoot).children("div"),t=w.children("table"),r=a(b.nTHead),q=
a(b.nTable),H=q[0],F=H.style,y=b.nTFoot?a(b.nTFoot):null,R=b.oBrowser,T=R.bScrollOversize,L,E,x,C,S,J=[],A=[],M=[],G,P=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};q.children("thead, tfoot").remove();S=r.clone().prependTo(q);L=r.find("tr");x=S.find("tr");S.find("th, td").removeAttr("tabindex");y&&(C=y.clone().prependTo(q),E=y.find("tr"),C=C.find("tr"));d||(k.width="100%",e[0].style.width="100%");a.each(aa(b,S),function(a,c){G=
u(b,a);c.style.width=b.aoColumns[G].sWidth});y&&ha(function(a){a.style.width=""},C);c.bCollapse&&""!==g&&(k.height=v[0].offsetHeight+r[0].offsetHeight+"px");e=q.outerWidth();""===d?(F.width="100%",T&&(q.find("tbody").height()>l.offsetHeight||"scroll"==v.css("overflow-y"))&&(F.width=O(q.outerWidth()-h))):""!==f?F.width=O(f):e==v.width()&&v.height()<q.height()?(F.width=O(e-h),q.outerWidth()>e-h&&(F.width=O(e))):F.width=O(e);e=q.outerWidth();ha(P,x);ha(function(b){M.push(b.innerHTML);J.push(O(a(b).css("width")))},
x);ha(function(a,b){a.style.width=J[b]},L);a(x).height(0);y&&(ha(P,C),ha(function(b){A.push(O(a(b).css("width")))},C),ha(function(a,b){a.style.width=A[b]},E),a(C).height(0));ha(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+M[b]+"</div>";a.style.width=J[b]},x);y&&ha(function(a,b){a.innerHTML="";a.style.width=A[b]},C);q.outerWidth()<e?(E=l.scrollHeight>l.offsetHeight||"scroll"==v.css("overflow-y")?e+h:e,T&&(l.scrollHeight>l.offsetHeight||"scroll"==v.css("overflow-y"))&&
(F.width=O(E-h)),""!==d&&""===f||ma(b,1,"Possible column misalignment",6)):E="100%";k.width=O(E);p.width=O(E);y&&(b.nScrollFoot.style.width=O(E));!g&&T&&(k.height=O(H.offsetHeight+h));g&&c.bCollapse&&(k.height=O(g),c=d&&H.offsetWidth>l.offsetWidth?h:0,H.offsetHeight<l.offsetHeight&&(k.height=O(H.offsetHeight+c)));c=q.outerWidth();n[0].style.width=O(c);m.width=O(c);n=q.height()>l.clientHeight||"scroll"==v.css("overflow-y");R="padding"+(R.bScrollbarLeft?"Left":"Right");m[R]=n?h+"px":"0px";y&&(t[0].style.width=
O(c),w[0].style.width=O(c),w[0].style[R]=n?h+"px":"0px");v.scroll();!b.bSorted&&!b.bFiltered||b._drawHold||(l.scrollTop=0)}function ha(a,b,c){for(var d=0,f=0,g=b.length,h,e;f<g;){h=b[f].firstChild;for(e=c?c[f].firstChild:null;h;)1===h.nodeType&&(c?a(h,e,d):a(h,d),d++),h=h.nextSibling,e=c?e.nextSibling:null;f++}}function La(b){var c=b.nTable,d=b.aoColumns,f=b.oScroll,g=f.sY,h=f.sX,p=f.sXInner,l=d.length,f=A(b,"bVisible"),m=a("th",b.nTHead),n=c.getAttribute("width"),v=c.parentNode,k=!1,w,r;for(w=0;w<
f.length;w++)r=d[f[w]],null!==r.sWidth&&(r.sWidth=pb(r.sWidthOrig,v),k=!0);if(k||h||g||l!=x(b)||l!=m.length){l=a(c).clone().empty().css("visibility","hidden").removeAttr("id").append(a(b.nTHead).clone(!1)).append(a(b.nTFoot).clone(!1)).append(a("<tbody><tr/></tbody>"));l.find("tfoot th, tfoot td").css("width","");var q=l.find("tbody tr"),m=aa(b,l.find("thead")[0]);for(w=0;w<f.length;w++)r=d[f[w]],m[w].style.width=null!==r.sWidthOrig&&""!==r.sWidthOrig?O(r.sWidthOrig):"";if(b.aoData.length)for(w=0;w<
f.length;w++)k=f[w],r=d[k],a(qb(b,k)).clone(!1).append(r.sContentPadding).appendTo(q);l.appendTo(v);h&&p?l.width(p):h?(l.css("width","auto"),l.width()<v.offsetWidth&&l.width(v.offsetWidth)):g?l.width(v.offsetWidth):n&&l.width(n);rb(b,l[0]);if(h){for(w=p=0;w<f.length;w++)r=d[f[w]],g=a(m[w]).outerWidth(),p+=null===r.sWidthOrig?g:parseInt(r.sWidth,10)+g-a(m[w]).width();l.width(O(p));c.style.width=O(p)}for(w=0;w<f.length;w++)if(r=d[f[w]],g=a(m[w]).width())r.sWidth=O(g);c.style.width=O(l.css("width"));
l.remove()}else for(w=0;w<l;w++)d[w].sWidth=O(m.eq(w).width());n&&(c.style.width=O(n));!n&&!h||b._reszEvt||(a(e).bind("resize.DT-"+b.sInstance,Aa(function(){t(b)})),b._reszEvt=!0)}function Aa(a,c){var d=c!==b?c:200,f,g;return function(){var c=this,h=+new Date,e=arguments;f&&h<f+d?(clearTimeout(g),g=setTimeout(function(){f=b;a.apply(c,e)},d)):f?(f=h,a.apply(c,e)):f=h}}function pb(b,c){if(!b)return 0;var d=a("<div/>").css("width",O(b)).appendTo(c||k.body),f=d[0].offsetWidth;d.remove();return f}function rb(b,
c){var d=b.oScroll;if(d.sX||d.sY)d=d.sX?0:d.iBarWidth,c.style.width=O(a(c).outerWidth()-d)}function qb(b,c){var d=sb(b,c);if(0>d)return null;var f=b.aoData[d];return f.nTr?f.anCells[c]:a("<td/>").html(B(b,d,c,"display"))[0]}function sb(a,b){for(var c,d=-1,f=-1,g=0,h=a.aoData.length;g<h;g++)c=B(a,g,b,"display")+"",c=c.replace(Lb,""),c.length>d&&(d=c.length,f=g);return f}function O(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function tb(){if(!z.__scrollbarWidth){var b=
a("<p/>").css({width:"100%",height:200,padding:0})[0],c=a("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(b).appendTo("body"),d=b.offsetWidth;c.css("overflow","scroll");b=b.offsetWidth;d===b&&(b=c[0].clientWidth);c.remove();z.__scrollbarWidth=d-b}return z.__scrollbarWidth}function qa(c){var d,f,g=[],h=c.aoColumns,e,p,l,m;d=c.aaSortingFixed;f=a.isPlainObject(d);var n=[];e=function(b){b.length&&!a.isArray(b[0])?n.push(b):
n.push.apply(n,b)};a.isArray(d)&&e(d);f&&d.pre&&e(d.pre);e(c.aaSorting);f&&d.post&&e(d.post);for(c=0;c<n.length;c++)for(m=n[c][0],e=h[m].aDataSort,d=0,f=e.length;d<f;d++)p=e[d],l=h[p].sType||"string",n[c]._idx===b&&(n[c]._idx=a.inArray(n[c][1],h[p].asSorting)),g.push({src:m,col:p,dir:n[c][1],index:n[c]._idx,type:l,formatter:z.ext.type.order[l+"-pre"]});return g}function db(a){var b,c,d=[],f=z.ext.type.order,g=a.aoData,h=0,e,p=a.aiDisplayMaster,l;E(a);l=qa(a);b=0;for(c=l.length;b<c;b++)e=l[b],e.formatter&&
h++,ub(a,e.col);if("ssp"!=da(a)&&0!==l.length){b=0;for(c=p.length;b<c;b++)d[p[b]]=b;h===l.length?p.sort(function(a,b){var c,f,h,e,p=l.length,m=g[a]._aSortData,n=g[b]._aSortData;for(h=0;h<p;h++)if(e=l[h],c=m[e.col],f=n[e.col],c=c<f?-1:c>f?1:0,0!==c)return"asc"===e.dir?c:-c;c=d[a];f=d[b];return c<f?-1:c>f?1:0}):p.sort(function(a,b){var c,h,e,p,m=l.length,n=g[a]._aSortData,v=g[b]._aSortData;for(e=0;e<m;e++)if(p=l[e],c=n[p.col],h=v[p.col],p=f[p.type+"-"+p.dir]||f["string-"+p.dir],c=p(c,h),0!==c)return c;
c=d[a];h=d[b];return c<h?-1:c>h?1:0})}a.bSorted=!0}function vb(a){var b,c,d=a.aoColumns,f=qa(a);a=a.oLanguage.oAria;for(var g=0,h=d.length;g<h;g++){c=d[g];var e=c.asSorting;b=c.sTitle.replace(/<.*?>/g,"");var p=c.nTh;p.removeAttribute("aria-sort");c.bSortable&&(0<f.length&&f[0].col==g?(p.setAttribute("aria-sort","asc"==f[0].dir?"ascending":"descending"),c=e[f[0].index+1]||e[0]):c=e[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);p.setAttribute("aria-label",b)}}function Ta(c,d,f,g){var h=c.aaSorting,
e=c.aoColumns[d].asSorting,p=function(c,d){var f=c._idx;f===b&&(f=a.inArray(c[1],e));return f+1<e.length?f+1:d?null:0};"number"===typeof h[0]&&(h=c.aaSorting=[h]);f&&c.oFeatures.bSortMulti?(f=a.inArray(d,fa(h,"0")),-1!==f?(d=p(h[f],!0),null===d?h.splice(f,1):(h[f][1]=e[d],h[f]._idx=d)):(h.push([d,e[0],0]),h[h.length-1]._idx=0)):h.length&&h[0][0]==d?(d=p(h[0]),h.length=1,h[0][1]=e[d],h[0]._idx=d):(h.length=0,h.push([d,e[0]]),h[0]._idx=0);T(c);"function"==typeof g&&g(c)}function Na(a,b,c,d){var f=a.aoColumns[c];
Ua(b,{},function(b){!1!==f.bSortable&&(a.oFeatures.bProcessing?(ea(a,!0),setTimeout(function(){Ta(a,c,b.shiftKey,d);"ssp"!==da(a)&&ea(a,!1)},0)):Ta(a,c,b.shiftKey,d))})}function Fa(b){var c=b.aLastSort,d=b.oClasses.sSortColumn,f=qa(b),g=b.oFeatures,h,e;if(g.bSort&&g.bSortClasses){g=0;for(h=c.length;g<h;g++)e=c[g].src,a(fa(b.aoData,"anCells",e)).removeClass(d+(2>g?g+1:3));g=0;for(h=f.length;g<h;g++)e=f[g].src,a(fa(b.aoData,"anCells",e)).addClass(d+(2>g?g+1:3))}b.aLastSort=f}function ub(a,b){var c=
a.aoColumns[b],d=z.ext.order[c.sSortDataType],g;d&&(g=d.call(a.oInstance,a,b,f(a,b)));for(var h,e=z.ext.type.order[c.sType+"-pre"],p=0,l=a.aoData.length;p<l;p++)if(c=a.aoData[p],c._aSortData||(c._aSortData=[]),!c._aSortData[b]||d)h=d?g[p]:B(a,p,b,"sort"),c._aSortData[b]=e?e(h):h}function Ga(b){if(b.oFeatures.bStateSave&&!b.bDestroying){var c={time:+new Date,start:b._iDisplayStart,length:b._iDisplayLength,order:a.extend(!0,[],b.aaSorting),search:lb(b.oPreviousSearch),columns:a.map(b.aoColumns,function(a,
c){return{visible:a.bVisible,search:lb(b.aoPreSearchCols[c])}})};V(b,"aoStateSaveParams","stateSaveParams",[b,c]);b.oSavedState=c;b.fnStateSaveCallback.call(b.oInstance,b,c)}}function wb(b,c){var d,f,g=b.aoColumns;if(b.oFeatures.bStateSave){var h=b.fnStateLoadCallback.call(b.oInstance,b);if(h&&h.time&&(d=V(b,"aoStateLoadParams","stateLoadParams",[b,h]),-1===a.inArray(!1,d)&&(d=b.iStateDuration,!(0<d&&h.time<+new Date-1E3*d)&&g.length===h.columns.length))){b.oLoadedState=a.extend(!0,{},h);b._iDisplayStart=
h.start;b.iInitDisplayStart=h.start;b._iDisplayLength=h.length;b.aaSorting=[];a.each(h.order,function(a,c){b.aaSorting.push(c[0]>=g.length?[0,c[1]]:c)});a.extend(b.oPreviousSearch,mb(h.search));d=0;for(f=h.columns.length;d<f;d++){var e=h.columns[d];g[d].bVisible=e.visible;a.extend(b.aoPreSearchCols[d],mb(e.search))}V(b,"aoStateLoaded","stateLoaded",[b,h])}}}function Ha(b){var c=z.settings;b=a.inArray(b,fa(c,"nTable"));return-1!==b?c[b]:null}function ma(a,b,c,d){c="DataTables warning: "+(null!==a?
"table id="+a.sTableId+" - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(b)e.console&&console.log&&console.log(c);else if(a=z.ext,"alert"==(a.sErrMode||a.errMode))alert(c);else throw Error(c);}function ga(c,d,f,g){a.isArray(f)?a.each(f,function(b,f){a.isArray(f)?ga(c,d,f[0],f[1]):ga(c,d,f)}):(g===b&&(g=f),d[f]!==b&&(c[g]=d[f]))}function xb(b,c,d){var f,g;for(g in c)c.hasOwnProperty(g)&&(f=c[g],a.isPlainObject(f)?(a.isPlainObject(b[g])||(b[g]=
{}),a.extend(!0,b[g],f)):d&&"data"!==g&&"aaData"!==g&&a.isArray(f)?b[g]=f.slice():b[g]=f);return b}function Ua(b,c,d){a(b).bind("click.DT",c,function(a){b.blur();d(a)}).bind("keypress.DT",c,function(a){13===a.which&&(a.preventDefault(),d(a))}).bind("selectstart.DT",function(){return!1})}function ba(a,b,c,d){c&&a[b].push({fn:c,sName:d})}function V(b,c,d,f){var g=[];c&&(g=a.map(b[c].slice().reverse(),function(a,c){return a.fn.apply(b.oInstance,f)}));null!==d&&a(b.nTable).trigger(d+".dt",f);return g}
function Ra(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),d=a._iDisplayLength;b>=c&&(b=c-d);b-=b%d;if(-1===d||0>b)b=0;a._iDisplayStart=b}function Oa(b,c){var d=b.renderer,f=z.ext.renderer[c];return a.isPlainObject(d)&&d[c]?f[d[c]]||f._:"string"===typeof d?f[d]||f._:f._}function da(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function Va(a,b){var c=[],c=yb.numbers_length,d=Math.floor(c/2);b<=c?c=sa(0,b):a<=d?(c=sa(0,c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-d?c=sa(b-
(c-2),b):(c=sa(a-1,a+2),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function cb(b){a.each({num:function(a){return Ia(a,b)},"num-fmt":function(a){return Ia(a,b,Wa)},"html-num":function(a){return Ia(a,b,Ja)},"html-num-fmt":function(a){return Ia(a,b,Ja,Wa)}},function(a,c){W.type.order[a+b+"-pre"]=c;a.match(/^html\-/)&&(W.type.search[a+b]=W.type.search.html)})}function zb(a){return function(){var b=[Ha(this[z.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));
return z.ext.internal[a].apply(this,b)}}var z,W,Q,K,U,Xa={},Ab=/[\r\n]/g,Ja=/<.*?>/g,Mb=/^[\w\+\-]/,Nb=/[\w\+\-]$/,Jb=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\|\$|\^|\-)/g,Wa=/[',$\u00a3\u20ac\u00a5%\u2009\u202F]/g,ja=function(a){return a&&!0!==a&&"-"!==a?!1:!0},Bb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Cb=function(a,b){Xa[b]||(Xa[b]=new RegExp(Da(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(Xa[b],"."):a},Ya=function(a,b,c){var d="string"===
typeof a;b&&d&&(a=Cb(a,b));c&&d&&(a=a.replace(Wa,""));return ja(a)||!isNaN(parseFloat(a))&&isFinite(a)},Db=function(a,b,c){return ja(a)?!0:ja(a)||"string"===typeof a?Ya(a.replace(Ja,""),b,c)?!0:null:null},fa=function(a,c,d){var f=[],g=0,h=a.length;if(d!==b)for(;g<h;g++)a[g]&&a[g][c]&&f.push(a[g][c][d]);else for(;g<h;g++)a[g]&&f.push(a[g][c]);return f},wa=function(a,c,d,f){var g=[],h=0,e=c.length;if(f!==b)for(;h<e;h++)a[c[h]][d]&&g.push(a[c[h]][d][f]);else for(;h<e;h++)g.push(a[c[h]][d]);return g},
sa=function(a,c){var d=[],f;c===b?(c=0,f=a):(f=c,c=a);for(var g=c;g<f;g++)d.push(g);return d},Eb=function(a){for(var b=[],c=0,d=a.length;c<d;c++)a[c]&&b.push(a[c]);return b},Ma=function(a){var b=[],c,d,f=a.length,g,h=0;d=0;a:for(;d<f;d++){c=a[d];for(g=0;g<h;g++)if(b[g]===c)continue a;b.push(c);h++}return b},ca=function(a,c,d){a[c]!==b&&(a[d]=a[c])},ua=/\[.*?\]$/,na=/\(\)$/,Ea=a("<div>")[0],Kb=Ea.textContent!==b,Lb=/<.*?>/g;z=function(d){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,
b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new Q(Ha(this[W.iApiIndex])):new Q(this)};this.fnAddData=function(c,d){var f=this.api(!0),g=a.isArray(c)&&(a.isArray(c[0])||a.isPlainObject(c[0]))?f.rows.add(c):f.row.add(c);(d===b||d)&&f.draw();return g.flatten().toArray()};this.fnAdjustColumnSizing=function(a){var c=this.api(!0).columns.adjust(),d=c.settings()[0],f=d.oScroll;a===b||a?c.draw(!1):""===f.sX&&""===f.sY||ta(d)};this.fnClearTable=function(a){var c=this.api(!0).clear();
(a===b||a)&&c.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,c,d){var f=this.api(!0);a=f.rows(a);var g=a.settings()[0],h=g.aoData[a[0][0]];a.remove();c&&c.call(this,g,h);(d===b||d)&&f.draw();return h};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(!a)};this.fnFilter=function(a,c,d,f,g,h){g=this.api(!0);null===c||c===b?g.search(a,d,f,h):g.column(c).search(a,d,f,h);g.draw()};this.fnGetData=function(a,c){var d=
this.api(!0);if(a!==b){var f=a.nodeName?a.nodeName.toLowerCase():"";return c!==b||"td"==f||"th"==f?d.cell(a,c).data():d.row(a).data()||null}return d.data().toArray()};this.fnGetNodes=function(a){var c=this.api(!0);return a!==b?c.row(a).node():c.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};
this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(a,c){var d=this.api(!0).page(a);(c===b||c)&&d.draw(!1)};this.fnSetColumnVis=function(a,c,d){a=this.api(!0).column(a).visible(c);(d===b||d)&&a.columns.adjust().draw()};this.fnSettings=function(){return Ha(this[W.iApiIndex])};this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,c,d,f,g){var h=
this.api(!0);d===b||null===d?h.row(c).data(a):h.cell(c,d).data(a);(g===b||g)&&h.columns.adjust();(f===b||f)&&h.draw();return 0};this.fnVersionCheck=W.fnVersionCheck;var f=this,e=d===b,p=this.length;e&&(d={});this.oApi=this.internal=W.internal;for(var k in z.ext.internal)k&&(this[k]=zb(k));this.each(function(){var k={},k=1<p?xb(k,d,!0):d,w=0,t,q=this.getAttribute("id"),H=!1,F=z.defaults;if("table"!=this.nodeName.toLowerCase())ma(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{l(F);
c(F.column);h(F,F,!0);h(F.column,F.column,!0);h(F,k);var u=z.settings,w=0;for(t=u.length;w<t;w++){if(u[w].nTable==this){t=k.bRetrieve!==b?k.bRetrieve:F.bRetrieve;if(e||t)return u[w].oInstance;if(k.bDestroy!==b?k.bDestroy:F.bDestroy){u[w].oInstance.fnDestroy();break}else{ma(u[w],0,"Cannot reinitialise DataTable",3);return}}if(u[w].sTableId==this.id){u.splice(w,1);break}}if(null===q||""===q)this.id=q="DataTables_Table_"+z.ext._unique++;var y=a.extend(!0,{},z.models.oSettings,{nTable:this,oApi:f.internal,
oInit:k,sDestroyWidth:a(this)[0].style.width,sInstance:q,sTableId:q});u.push(y);y.oInstance=1===f.length?f:a(this).dataTable();l(k);k.oLanguage&&m(k.oLanguage);k.aLengthMenu&&!k.iDisplayLength&&(k.iDisplayLength=a.isArray(k.aLengthMenu[0])?k.aLengthMenu[0][0]:k.aLengthMenu[0]);k=xb(a.extend(!0,{},F),k);ga(y.oFeatures,k,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));ga(y,k,["asStripeClasses","ajax","fnServerData","fnFormatNumber",
"sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);ga(y.oScroll,k,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);
ga(y.oLanguage,k,"fnInfoCallback");ba(y,"aoDrawCallback",k.fnDrawCallback,"user");ba(y,"aoServerParams",k.fnServerParams,"user");ba(y,"aoStateSaveParams",k.fnStateSaveParams,"user");ba(y,"aoStateLoadParams",k.fnStateLoadParams,"user");ba(y,"aoStateLoaded",k.fnStateLoaded,"user");ba(y,"aoRowCallback",k.fnRowCallback,"user");ba(y,"aoRowCreatedCallback",k.fnCreatedRow,"user");ba(y,"aoHeaderCallback",k.fnHeaderCallback,"user");ba(y,"aoFooterCallback",k.fnFooterCallback,"user");ba(y,"aoInitComplete",k.fnInitComplete,
"user");ba(y,"aoPreDrawCallback",k.fnPreDrawCallback,"user");q=y.oClasses;k.bJQueryUI?(a.extend(q,z.ext.oJUIClasses,k.oClasses),k.sDom===F.sDom&&"lfrtip"===F.sDom&&(y.sDom='<"H"lfr>t<"F"ip>'),y.renderer)?a.isPlainObject(y.renderer)&&!y.renderer.header&&(y.renderer.header="jqueryui"):y.renderer="jqueryui":a.extend(q,z.ext.classes,k.oClasses);a(this).addClass(q.sTable);if(""!==y.oScroll.sX||""!==y.oScroll.sY)y.oScroll.iBarWidth=tb();!0===y.oScroll.sX&&(y.oScroll.sX="100%");y.iInitDisplayStart===b&&
(y.iInitDisplayStart=k.iDisplayStart,y._iDisplayStart=k.iDisplayStart);null!==k.iDeferLoading&&(y.bDeferLoading=!0,w=a.isArray(k.iDeferLoading),y._iRecordsDisplay=w?k.iDeferLoading[0]:k.iDeferLoading,y._iRecordsTotal=w?k.iDeferLoading[1]:k.iDeferLoading);var R=y.oLanguage;a.extend(!0,R,k.oLanguage);""!==R.sUrl&&(a.ajax({dataType:"json",url:R.sUrl,success:function(b){m(b);h(F.oLanguage,b);a.extend(!0,R,b);va(y)},error:function(){va(y)}}),H=!0);null===k.asStripeClasses&&(y.asStripeClasses=[q.sStripeOdd,
q.sStripeEven]);var w=y.asStripeClasses,T=a("tbody tr:eq(0)",this);-1!==a.inArray(!0,a.map(w,function(a,b){return T.hasClass(a)}))&&(a("tbody tr",this).removeClass(w.join(" ")),y.asDestroyStripes=w.slice());var u=[],L,w=this.getElementsByTagName("thead");0!==w.length&&(Z(y.aoHeader,w[0]),u=aa(y));if(null===k.aoColumns)for(L=[],w=0,t=u.length;w<t;w++)L.push(null);else L=k.aoColumns;w=0;for(t=L.length;w<t;w++)g(y,u?u[w]:null);M(y,k.aoColumnDefs,L,function(a,b){n(y,a,b)});if(T.length){var E=function(a,
b){return a.getAttribute("data-"+b)?b:null};a.each(v(y,T[0]).cells,function(a,c){var d=y.aoColumns[a];if(d.mData===a){var f=E(c,"sort")||E(c,"order"),g=E(c,"filter")||E(c,"search");if(null!==f||null!==g)d.mData={_:a+".display",sort:null!==f?a+".@data-"+f:b,type:null!==f?a+".@data-"+f:b,filter:null!==g?a+".@data-"+g:b},n(y,a)}})}var x=y.oFeatures;k.bStateSave&&(x.bStateSave=!0,wb(y,k),ba(y,"aoDrawCallback",Ga,"state_save"));if(k.aaSorting===b)for(u=y.aaSorting,w=0,t=u.length;w<t;w++)u[w][1]=y.aoColumns[w].asSorting[0];
Fa(y);x.bSort&&ba(y,"aoDrawCallback",function(){if(y.bSorted){var b=qa(y),c={};a.each(b,function(a,b){c[b.src]=b.dir});V(y,null,"order",[y,b,c]);vb(y)}});ba(y,"aoDrawCallback",function(){(y.bSorted||"ssp"===da(y)||x.bDeferRender)&&Fa(y)},"sc");r(y);w=a(this).children("caption").each(function(){this._captionSide=a(this).css("caption-side")});t=a(this).children("thead");0===t.length&&(t=a("<thead/>").appendTo(this));y.nTHead=t[0];t=a(this).children("tbody");0===t.length&&(t=a("<tbody/>").appendTo(this));
y.nTBody=t[0];t=a(this).children("tfoot");0===t.length&&0<w.length&&(""!==y.oScroll.sX||""!==y.oScroll.sY)&&(t=a("<tfoot/>").appendTo(this));0===t.length||0===t.children().length?a(this).addClass(q.sNoFooter):0<t.length&&(y.nTFoot=t[0],Z(y.aoFooter,y.nTFoot));if(k.aaData)for(w=0;w<k.aaData.length;w++)G(y,k.aaData[w]);else(y.bDeferLoading||"dom"==da(y))&&I(y,a(y.nTBody).children("tr"));y.aiDisplay=y.aiDisplayMaster.slice();y.bInitialised=!0;!1===H&&va(y)}});f=null;return this};var Fb=[],Y=Array.prototype,
Ob=function(b){var c,d,f=z.settings,g=a.map(f,function(a,b){return a.nTable});if(b){if(b.nTable&&b.oApi)return[b];if(b.nodeName&&"table"===b.nodeName.toLowerCase())return c=a.inArray(b,g),-1!==c?[f[c]]:null;if(b&&"function"===typeof b.settings)return b.settings().toArray();"string"===typeof b?d=a(b):b instanceof a&&(d=b)}else return[];if(d)return d.map(function(b){c=a.inArray(this,g);return-1!==c?f[c]:null}).toArray()};Q=function(b,c){if(!this instanceof Q)throw"DT API must be constructed as a new object";
var d=[],f=function(a){(a=Ob(a))&&d.push.apply(d,a)};if(a.isArray(b))for(var g=0,h=b.length;g<h;g++)f(b[g]);else f(b);this.context=Ma(d);c&&this.push.apply(this,c.toArray?c.toArray():c);this.selector={rows:null,cols:null,opts:null};Q.extend(this,this,Fb)};z.Api=Q;Q.prototype={concat:Y.concat,context:[],each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new Q(b[a],this[a]):null},filter:function(a){var b=[];
if(Y.filter)b=Y.filter.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new Q(this.context,b)},flatten:function(){var a=[];return new Q(this.context,a.concat.apply(a,this.toArray()))},join:Y.join,indexOf:Y.indexOf||function(a,b){for(var c=b||0,d=this.length;c<d;c++)if(this[c]===a)return c;return-1},iterator:function(a,c,d,f){var g=[],h,e,p,l,m,n=this.context,k,v,w=this.selector;"string"===typeof a&&(f=d,d=c,c=a,a=!1);e=0;for(p=n.length;e<
p;e++){var t=new Q(n[e]);if("table"===c)h=d.call(t,n[e],e),h!==b&&g.push(h);else if("columns"===c||"rows"===c)h=d.call(t,n[e],this[e],e),h!==b&&g.push(h);else if("column"===c||"column-rows"===c||"row"===c||"cell"===c)for(v=this[e],"column-rows"===c&&(k=Ka(n[e],w.opts)),l=0,m=v.length;l<m;l++)h=v[l],h="cell"===c?d.call(t,n[e],h.row,h.column,e,l):d.call(t,n[e],h,e,l,k),h!==b&&g.push(h)}return g.length||f?(a=new Q(n,a?g.concat.apply([],g):g),c=a.selector,c.rows=w.rows,c.cols=w.cols,c.opts=w.opts,a):
this},lastIndexOf:Y.lastIndexOf||function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(Y.map)b=Y.map.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)b.push(a.call(this,this[c],c));return new Q(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},pop:Y.pop,push:Y.push,reduce:Y.reduce||function(a,b){return q(this,a,b,0,this.length,1)},reduceRight:Y.reduceRight||function(a,b){return q(this,a,b,this.length-1,-1,
-1)},reverse:Y.reverse,selector:null,shift:Y.shift,sort:Y.sort,splice:Y.splice,toArray:function(){return Y.slice.call(this)},to$:function(){return a(this)},toJQuery:function(){return a(this)},unique:function(){return new Q(this.context,Ma(this))},unshift:Y.unshift};Q.extend=function(b,c,d){if(c&&(c instanceof Q||c.__dt_wrapper)){var f,g,h,e=function(a,b,c){return function(){var d=b.apply(a,arguments);Q.extend(d,d,c.methodExt);return d}};f=0;for(g=d.length;f<g;f++)h=d[f],c[h.name]="function"===typeof h.val?
e(b,h.val,h):a.isPlainObject(h.val)?{}:h.val,c[h.name].__dt_wrapper=!0,Q.extend(b,c[h.name],h.propExt)}};Q.register=K=function(b,c){if(a.isArray(b))for(var d=0,f=b.length;d<f;d++)Q.register(b[d],c);else for(var g=b.split("."),h=Fb,e,p,d=0,f=g.length;d<f;d++){e=(p=-1!==g[d].indexOf("()"))?g[d].replace("()",""):g[d];var l;a:{l=0;for(var m=h.length;l<m;l++)if(h[l].name===e){l=h[l];break a}l=null}l||(l={name:e,val:{},methodExt:[],propExt:[]},h.push(l));d===f-1?l.val=c:h=p?l.methodExt:l.propExt}};Q.registerPlural=
U=function(c,d,f){Q.register(c,f);Q.register(d,function(){var c=f.apply(this,arguments);return c===this?this:c instanceof Q?c.length?a.isArray(c[0])?new Q(c.context,c[0]):c[0]:b:c})};var Pb=function(b,c){if("number"===typeof b)return[c[b]];var d=a.map(c,function(a,b){return a.nTable});return a(d).filter(b).map(function(b){b=a.inArray(this,d);return c[b]}).toArray()};K("tables()",function(a){return a?new Q(Pb(a,this.context)):this});K("table()",function(a){a=this.tables(a);var b=a.context;return b.length?
new Q(b[0]):a});U("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});U("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});U("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});U("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});U("tables().containers()","table().container()",
function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});K("draw()",function(a){return this.iterator("table",function(b){T(b,!1===a)})});K("page()",function(a){return a===b?this.page.info().page:this.iterator("table",function(b){Sa(b,a)})});K("page.info()",function(a){if(0===this.context.length)return b;a=this.context[0];var c=a._iDisplayStart,d=a._iDisplayLength,f=a.fnRecordsDisplay(),g=-1===d;return{page:g?0:Math.floor(c/d),pages:g?1:Math.ceil(f/d),start:c,end:a.fnDisplayEnd(),
length:d,recordsTotal:a.fnRecordsTotal(),recordsDisplay:f}});K("page.len()",function(a){return a===b?0!==this.context.length?this.context[0]._iDisplayLength:b:this.iterator("table",function(b){Qa(b,a)})});var Gb=function(a,b,c){"ssp"==da(a)?T(a,b):(ea(a,!0),la(a,[],function(c){P(a);c=ra(a,c);for(var d=0,f=c.length;d<f;d++)G(a,c[d]);T(a,b);ea(a,!1)}));if(c){var d=new Q(a);d.one("draw",function(){c(d.ajax.json())})}};K("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});K("ajax.params()",
function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});K("ajax.reload()",function(a,b){return this.iterator("table",function(c){Gb(c,!1===b,a)})});K("ajax.url()",function(c){var d=this.context;if(c===b){if(0===d.length)return b;d=d[0];return d.ajax?a.isPlainObject(d.ajax)?d.ajax.url:d.ajax:d.sAjaxSource}return this.iterator("table",function(b){a.isPlainObject(b.ajax)?b.ajax.url=c:b.ajax=c})});K("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Gb(c,!1===b,a)})});
var Za=function(c,d){var f=[],g,h,e,p,l,m;g=typeof c;c&&"string"!==g&&"function"!==g&&c.length!==b||(c=[c]);e=0;for(p=c.length;e<p;e++)for(h=c[e]&&c[e].split?c[e].split(","):[c[e]],l=0,m=h.length;l<m;l++)(g=d("string"===typeof h[l]?a.trim(h[l]):h[l]))&&g.length&&f.push.apply(f,g);return f},$a=function(a){a||(a={});a.filter&&!a.search&&(a.search=a.filter);return{search:a.search||"none",order:a.order||"current",page:a.page||"all"}},ab=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=
a[b],a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Ka=function(b,c){var d,f,g,h=[],e=b.aiDisplay;d=b.aiDisplayMaster;var p=c.search;f=c.order;g=c.page;if("ssp"==da(b))return"removed"===p?[]:sa(0,d.length);if("current"==g)for(d=b._iDisplayStart,f=b.fnDisplayEnd();d<f;d++)h.push(e[d]);else if("current"==f||"applied"==f)h="none"==p?d.slice():"applied"==p?e.slice():a.map(d,function(b,c){return-1===a.inArray(b,e)?b:null});else if("index"==f||"original"==f)for(d=0,f=b.aoData.length;d<f;d++)"none"==
p?h.push(d):(g=a.inArray(d,e),(-1===g&&"removed"==p||0<=g&&"applied"==p)&&h.push(d));return h},Qb=function(b,c,d){return Za(c,function(c){var f=Bb(c);if(null!==f&&!d)return[f];var g=Ka(b,d);if(null!==f&&-1!==a.inArray(f,g))return[f];if(!c)return g;if("function"===typeof c)return a.map(g,function(a){var d=b.aoData[a];return c(a,d._aData,d.nTr)?a:null});f=Eb(wa(b.aoData,g,"nTr"));return c.nodeName&&-1!==a.inArray(c,f)?[c._DT_RowIndex]:a(f).filter(c).map(function(){return this._DT_RowIndex}).toArray()})};
K("rows()",function(c,d){c===b?c="":a.isPlainObject(c)&&(d=c,c="");d=$a(d);var f=this.iterator("table",function(a){return Qb(a,c,d)},1);f.selector.rows=c;f.selector.opts=d;return f});K("rows().nodes()",function(){return this.iterator("row",function(a,c){return a.aoData[c].nTr||b},1)});K("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return wa(a.aoData,b,"_aData")},1)});U("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var d=b.aoData[c];
return"search"===a?d._aFilterData:d._aSortData},1)});U("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){p(b,c,a)})});U("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,b){return b},1)});U("rows().remove()","row().remove()",function(){var b=this;return this.iterator("row",function(c,d,f){var g=c.aoData;g.splice(d,1);for(var h=0,e=g.length;h<e;h++)null!==g[h].nTr&&(g[h].nTr._DT_RowIndex=h);a.inArray(d,c.aiDisplay);N(c.aiDisplayMaster,
d);N(c.aiDisplay,d);N(b[f],d,!1);Ra(c)})});K("rows.add()",function(a){var b=this.iterator("table",function(b){var c,d,f,g=[];d=0;for(f=a.length;d<f;d++)c=a[d],c.nodeName&&"TR"===c.nodeName.toUpperCase()?g.push(I(b,c)[0]):g.push(G(b,c));return g},1),c=this.rows(-1);c.pop();c.push.apply(c,b.toArray());return c});K("row()",function(a,b){return ab(this.rows(a,b))});K("row().data()",function(a){var c=this.context;if(a===b)return c.length&&this.length?c[0].aoData[this[0]]._aData:b;c[0].aoData[this[0]]._aData=
a;p(c[0],this[0],"data");return this});K("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});K("row.add()",function(b){b instanceof a&&b.length&&(b=b[0]);var c=this.iterator("table",function(a){return b.nodeName&&"TR"===b.nodeName.toUpperCase()?I(a,b)[0]:G(a,b)});return this.row(c[0])});var Rb=function(b,c,d,f){var g=[],h=function(c,d){if(c.nodeName&&"tr"===c.nodeName.toLowerCase())g.push(c);else{var f=a("<tr><td/></tr>").addClass(d);a("td",
f).addClass(d).html(c)[0].colSpan=x(b);g.push(f[0])}};if(a.isArray(d)||d instanceof a)for(var e=0,p=d.length;e<p;e++)h(d[e],f);else h(d,f);c._details&&c._details.remove();c._details=a(g);c._detailsShow&&c._details.insertAfter(c.nTr)},bb=function(a,c){var d=a.context;d.length&&(d=d[0].aoData[c!==b?c:a[0]],d._details&&(d._details.remove(),d._detailsShow=b,d._details=b))},Hb=function(a,b){var c=a.context;if(c.length&&a.length){var d=c[0].aoData[a[0]];d._details&&((d._detailsShow=b)?d._details.insertAfter(d.nTr):
d._details.detach(),Sb(c[0]))}},Sb=function(a){var b=new Q(a),c=a.aoData;b.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<fa(c,"_details").length&&(b.on("draw.dt.DT_details",function(d,f){a===f&&b.rows({page:"current"}).eq(0).each(function(a){a=c[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),b.on("column-visibility.dt.DT_details",function(b,d,f,g){if(a===d)for(d=x(d),f=0,g=c.length;f<g;f++)b=c[f],b._details&&b._details.children("td[colspan]").attr("colspan",
d)}),b.on("destroy.dt.DT_details",function(d,f){if(a===f)for(var g=0,h=c.length;g<h;g++)c[g]._details&&bb(b,g)}))};K("row().child()",function(a,c){var d=this.context;if(a===b)return d.length&&this.length?d[0].aoData[this[0]]._details:b;!0===a?this.child.show():!1===a?bb(this):d.length&&this.length&&Rb(d[0],d[0].aoData[this[0]],a,c);return this});K(["row().child.show()","row().child().show()"],function(a){Hb(this,!0);return this});K(["row().child.hide()","row().child().hide()"],function(){Hb(this,
!1);return this});K(["row().child.remove()","row().child().remove()"],function(){bb(this);return this});K("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Tb=/^(.+):(name|visIdx|visible)$/,Ib=function(a,b,c,d,f){c=[];d=0;for(var g=f.length;d<g;d++)c.push(B(a,f[d],b));return c},Ub=function(b,c,d){var f=b.aoColumns,g=fa(f,"sName"),h=fa(f,"nTh");return Za(c,function(c){var e=Bb(c);if(""===c)return sa(f.length);if(null!==
e)return[0<=e?e:f.length+e];if("function"===typeof c){var p=Ka(b,d);return a.map(f,function(a,d){return c(d,Ib(b,d,0,0,p),h[d])?d:null})}var l="string"===typeof c?c.match(Tb):"";if(l)switch(l[2]){case "visIdx":case "visible":e=parseInt(l[1],10);if(0>e){var m=a.map(f,function(a,b){return a.bVisible?b:null});return[m[m.length+e]]}return[u(b,e)];case "name":return a.map(g,function(a,b){return a===l[1]?b:null})}else return a(h).filter(c).map(function(){return a.inArray(this,h)}).toArray()})};K("columns()",
function(c,d){c===b?c="":a.isPlainObject(c)&&(d=c,c="");d=$a(d);var f=this.iterator("table",function(a){return Ub(a,c,d)},1);f.selector.cols=c;f.selector.opts=d;return f});U("columns().header()","column().header()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});U("columns().footer()","column().footer()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});U("columns().data()","column().data()",function(){return this.iterator("column-rows",
Ib,1)});U("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});U("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,d,f,g){return wa(b.aoData,g,"search"===a?"_aFilterData":"_aSortData",c)},1)});U("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,d,f){return wa(a.aoData,f,"anCells",b)},1)});U("columns().visible()","column().visible()",
function(c,d){return this.iterator("column",function(f,g){if(c===b)return f.aoColumns[g].bVisible;var h=f.aoColumns,e=h[g],p=f.aoData,l,m,n;if(c!==b&&e.bVisible!==c){if(c){var k=a.inArray(!0,fa(h,"bVisible"),g+1);l=0;for(m=p.length;l<m;l++)n=p[l].nTr,h=p[l].anCells,n&&n.insertBefore(h[g],h[k]||null)}else a(fa(f.aoData,"anCells",g)).detach();e.bVisible=c;S(f,f.aoHeader);S(f,f.aoFooter);if(d===b||d)t(f),(f.oScroll.sX||f.oScroll.sY)&&ta(f);V(f,null,"column-visibility",[f,g,c]);Ga(f)}})});U("columns().indexes()",
"column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?f(b,c):c},1)});K("columns.adjust()",function(){return this.iterator("table",function(a){t(a)},1)});K("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return u(c,b);if("fromData"===a||"toVisible"===a)return f(c,b)}});K("column()",function(a,b){return ab(this.columns(a,b))});var Vb=function(c,d,f){var g=c.aoData,h=Ka(c,f);f=Eb(wa(g,h,"anCells"));
var e=a([].concat.apply([],f)),p,l=c.aoColumns.length,m,n,k,v,w,t;return Za(d,function(d){var f="function"===typeof d;if(null===d||d===b||f){m=[];n=0;for(k=h.length;n<k;n++)for(p=h[n],v=0;v<l;v++)w={row:p,column:v},f?(t=c.aoData[p],d(w,B(c,p,v),t.anCells[v])&&m.push(w)):m.push(w);return m}return a.isPlainObject(d)?[d]:e.filter(d).map(function(b,c){p=c.parentNode._DT_RowIndex;return{row:p,column:a.inArray(c,g[p].anCells)}}).toArray()})};K("cells()",function(c,d,f){a.isPlainObject(c)&&(typeof c.row!==
b?(f=d,d=null):(f=c,c=null));a.isPlainObject(d)&&(f=d,d=null);if(null===d||d===b)return this.iterator("table",function(a){return Vb(a,c,$a(f))});var g=this.columns(d,f),h=this.rows(c,f),e,p,l,m,n,k=this.iterator("table",function(a,b){e=[];p=0;for(l=h[b].length;p<l;p++)for(m=0,n=g[b].length;m<n;m++)e.push({row:h[b][p],column:g[b][m]});return e},1);a.extend(k.selector,{cols:d,rows:c,opts:f});return k});U("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(a,c,d){return(a=
a.aoData[c].anCells)?a[d]:b},1)});K("cells().data()",function(){return this.iterator("cell",function(a,b,c){return B(a,b,c)},1)});U("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,d){return b.aoData[c][a][d]},1)});U("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return B(b,c,d,a)},1)});U("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,
b,c){return{row:b,column:c,columnVisible:f(a,c)}},1)});U("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){p(b,c,a,d)})});K("cell()",function(a,b,c){return ab(this.cells(a,b,c))});K("cell().data()",function(a){var c=this.context,d=this[0];if(a===b)return c.length&&d.length?B(c[0],d[0].row,d[0].column):b;D(c[0],d[0].row,d[0].column,a);p(c[0],d[0].row,"data",d[0].column);return this});K("order()",function(c,d){var f=this.context;if(c===b)return 0!==
f.length?f[0].aaSorting:b;"number"===typeof c?c=[[c,d]]:a.isArray(c[0])||(c=Array.prototype.slice.call(arguments));return this.iterator("table",function(a){a.aaSorting=c.slice()})});K("order.listener()",function(a,b,c){return this.iterator("table",function(d){Na(d,a,b,c)})});K(["columns().order()","column().order()"],function(b){var c=this;return this.iterator("table",function(d,f){var g=[];a.each(c[f],function(a,c){g.push([c,b])});d.aaSorting=g})});K("search()",function(c,d,f,g){var h=this.context;
return c===b?0!==h.length?h[0].oPreviousSearch.sSearch:b:this.iterator("table",function(b){b.oFeatures.bFilter&&ka(b,a.extend({},b.oPreviousSearch,{sSearch:c+"",bRegex:null===d?!1:d,bSmart:null===f?!0:f,bCaseInsensitive:null===g?!0:g}),1)})});U("columns().search()","column().search()",function(c,d,f,g){return this.iterator("column",function(h,e){var p=h.aoPreSearchCols;if(c===b)return p[e].sSearch;h.oFeatures.bFilter&&(a.extend(p[e],{sSearch:c+"",bRegex:null===d?!1:d,bSmart:null===f?!0:f,bCaseInsensitive:null===
g?!0:g}),ka(h,h.oPreviousSearch,1))})});K("state()",function(){return this.context.length?this.context[0].oSavedState:null});K("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});K("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null});K("state.save()",function(){return this.iterator("table",function(a){Ga(a)})});z.versionCheck=z.fnVersionCheck=function(a){var b=z.version.split(".");a=a.split(".");
for(var c,d,f=0,g=a.length;f<g;f++)if(c=parseInt(b[f],10)||0,d=parseInt(a[f],10)||0,c!==d)return c>d;return!0};z.isDataTable=z.fnIsDataTable=function(b){var c=a(b).get(0),d=!1;a.each(z.settings,function(a,b){if(b.nTable===c||b.nScrollHead===c||b.nScrollFoot===c)d=!0});return d};z.tables=z.fnTables=function(b){return a.map(z.settings,function(c){if(!b||b&&a(c.nTable).is(":visible"))return c.nTable})};z.util={throttle:Aa,escapeRegex:Da};z.camelToHungarian=h;K("$()",function(b,c){var d=this.rows(c).nodes(),
d=a(d);return a([].concat(d.filter(b).toArray(),d.find(b).toArray()))});a.each(["on","one","off"],function(b,c){K(c+"()",function(){var b=Array.prototype.slice.call(arguments);b[0].match(/\.dt\b/)||(b[0]+=".dt");var d=a(this.tables().nodes());d[c].apply(d,b);return this})});K("clear()",function(){return this.iterator("table",function(a){P(a)})});K("settings()",function(){return new Q(this.context,this.context)});K("data()",function(){return this.iterator("table",function(a){return fa(a.aoData,"_aData")}).flatten()});
K("destroy()",function(b){b=b||!1;return this.iterator("table",function(c){var d=c.nTableWrapper.parentNode,f=c.oClasses,g=c.nTable,h=c.nTBody,p=c.nTHead,l=c.nTFoot,m=a(g),h=a(h),n=a(c.nTableWrapper),k=a.map(c.aoData,function(a){return a.nTr}),v;c.bDestroying=!0;V(c,"aoDestroyCallback","destroy",[c]);b||(new Q(c)).columns().visible(!0);n.unbind(".DT").find(":not(tbody *)").unbind(".DT");a(e).unbind(".DT-"+c.sInstance);g!=p.parentNode&&(m.children("thead").detach(),m.append(p));l&&g!=l.parentNode&&
(m.children("tfoot").detach(),m.append(l));m.detach();n.detach();c.aaSorting=[];c.aaSortingFixed=[];Fa(c);a(k).removeClass(c.asStripeClasses.join(" "));a("th, td",p).removeClass(f.sSortable+" "+f.sSortableAsc+" "+f.sSortableDesc+" "+f.sSortableNone);c.bJUI&&(a("th span."+f.sSortIcon+", td span."+f.sSortIcon,p).detach(),a("th, td",p).each(function(){var b=a("div."+f.sSortJUIWrapper,this);a(this).append(b.contents());b.detach()}));!b&&d&&d.insertBefore(g,c.nTableReinsertBefore);h.children().detach();
h.append(k);m.css("width",c.sDestroyWidth).removeClass(f.sTable);(v=c.asDestroyStripes.length)&&h.children().each(function(b){a(this).addClass(c.asDestroyStripes[b%v])});d=a.inArray(c,z.settings);-1!==d&&z.settings.splice(d,1)})});z.version="1.10.4";z.settings=[];z.models={};z.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};z.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null};z.models.oColumn={idx:null,aDataSort:null,
asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};z.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],
asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,
fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,
iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",
sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:a.extend({},z.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null};d(z.defaults);z.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,
mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};d(z.defaults.column);z.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,
bScrollbarLeft:!1},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,
nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:b,oAjaxData:b,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},
bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==da(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==da(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,f=this.oFeatures,g=f.bPaginate;return f.bServerSide?!1===g||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!g||c>d||-1===a?d:c},
oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}};z.ext=W={classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:z.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:z.version};a.extend(W,{afnFiltering:W.search,aTypes:W.type.detect,ofnSearch:W.type.search,oSort:W.type.order,afnSortData:W.order,aoFeatures:W.feature,
oApi:W.internal,oStdClasses:W.classes,oPagination:W.pager});a.extend(z.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",
sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",
sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});(function(){var b="",b="",c=b+"ui-state-default",d=b+"css_right ui-icon ui-icon-",b=b+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";a.extend(z.ext.oJUIClasses,z.ext.classes,{sPageButton:"fg-button ui-button "+c,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:c+
" sorting_asc",sSortDesc:c+" sorting_desc",sSortable:c+" sorting",sSortableAsc:c+" sorting_asc_disabled",sSortableDesc:c+" sorting_desc_disabled",sSortableNone:c+" sorting_disabled",sSortJUIAsc:d+"triangle-1-n",sSortJUIDesc:d+"triangle-1-s",sSortJUI:d+"carat-2-n-s",sSortJUIAscAllowed:d+"carat-1-n",sSortJUIDescAllowed:d+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+c,sScrollFoot:"dataTables_scrollFoot "+c,sHeaderTH:c,sFooterTH:c,
sJUIHeader:b+" ui-corner-tl ui-corner-tr",sJUIFooter:b+" ui-corner-bl ui-corner-br"})})();var yb=z.ext.pager;a.extend(yb,{simple:function(a,b){return["previous","next"]},full:function(a,b){return["first","previous","next","last"]},simple_numbers:function(a,b){return["previous",Va(a,b),"next"]},full_numbers:function(a,b){return["first","previous",Va(a,b),"next","last"]},_numbers:Va,numbers_length:7});a.extend(!0,z.ext.renderer,{pageButton:{_:function(b,c,d,f,g,h){var e=b.oClasses,p=b.oLanguage.oPaginate,
l,m,n=0,v=function(c,f){var k,w,t,r,q=function(a){Sa(b,a.data.action,!0)};k=0;for(w=f.length;k<w;k++)if(r=f[k],a.isArray(r))t=a("<"+(r.DT_el||"div")+"/>").appendTo(c),v(t,r);else{m=l="";switch(r){case "ellipsis":c.append("<span>&hellip;</span>");break;case "first":l=p.sFirst;m=r+(0<g?"":" "+e.sPageButtonDisabled);break;case "previous":l=p.sPrevious;m=r+(0<g?"":" "+e.sPageButtonDisabled);break;case "next":l=p.sNext;m=r+(g<h-1?"":" "+e.sPageButtonDisabled);break;case "last":l=p.sLast;m=r+(g<h-1?"":
" "+e.sPageButtonDisabled);break;default:l=r+1,m=g===r?e.sPageButtonActive:""}l&&(t=a("<a>",{"class":e.sPageButton+" "+m,"aria-controls":b.sTableId,"data-dt-idx":n,tabindex:b.iTabIndex,id:0===d&&"string"===typeof r?b.sTableId+"_"+r:null}).html(l).appendTo(c),Ua(t,{action:r},q),n++)}};try{var w=a(k.activeElement).data("dt-idx");v(a(c).empty(),f);null!==w&&a(c).find("[data-dt-idx="+w+"]").focus()}catch(t){}}}});a.extend(z.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c)?"num"+
c:null},function(a,b){if(!(!a||a instanceof Date||Mb.test(a)&&Nb.test(a)))return null;var c=Date.parse(a);return null!==c&&!isNaN(c)||ja(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return Ya(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Db(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Db(a,c,!0)?"html-num-fmt"+c:null},function(a,b){return ja(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);a.extend(z.ext.type.search,{html:function(a){return ja(a)?
a:"string"===typeof a?a.replace(Ab," ").replace(Ja,""):""},string:function(a){return ja(a)?a:"string"===typeof a?a.replace(Ab," "):a}});var Ia=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Cb(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};a.extend(W.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return ja(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return ja(a)?"":"string"===
typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});cb("");a.extend(!0,z.ext.renderer,{header:{_:function(b,c,d,f){a(b.nTable).on("order.dt.DT",function(a,g,h,e){b===g&&(a=d.idx,c.removeClass(d.sSortingClass+" "+f.sSortAsc+" "+f.sSortDesc).addClass("asc"==e[a]?f.sSortAsc:"desc"==e[a]?f.sSortDesc:d.sSortingClass))})},jqueryui:function(b,c,d,f){a("<div/>").addClass(f.sSortJUIWrapper).append(c.contents()).append(a("<span/>").addClass(f.sSortIcon+
" "+d.sSortingClassJUI)).appendTo(c);a(b.nTable).on("order.dt.DT",function(a,g,h,e){b===g&&(a=d.idx,c.removeClass(f.sSortAsc+" "+f.sSortDesc).addClass("asc"==e[a]?f.sSortAsc:"desc"==e[a]?f.sSortDesc:d.sSortingClass),c.find("span."+f.sSortIcon).removeClass(f.sSortJUIAsc+" "+f.sSortJUIDesc+" "+f.sSortJUI+" "+f.sSortJUIAscAllowed+" "+f.sSortJUIDescAllowed).addClass("asc"==e[a]?f.sSortJUIAsc:"desc"==e[a]?f.sSortJUIDesc:d.sSortingClassJUI))})}}});z.render={number:function(a,b,c,d){return{display:function(f){var g=
0>f?"-":"";f=Math.abs(parseFloat(f));var h=parseInt(f,10);f=c?b+(f-h).toFixed(c).substring(2):"";return g+(d||"")+h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f}}}};a.extend(z.ext.internal,{_fnExternApiFunc:zb,_fnBuildAjax:la,_fnAjaxUpdate:oa,_fnAjaxParameters:pa,_fnAjaxUpdateDraw:ya,_fnAjaxDataSrc:ra,_fnAddColumn:g,_fnColumnOptions:n,_fnAdjustColumnSizing:t,_fnVisibleToColumnIndex:u,_fnColumnIndexToVisible:f,_fnVisbleColumns:x,_fnGetColumns:A,_fnColumnTypes:E,_fnApplyColumnDefs:M,_fnHungarianMap:d,
_fnCamelToHungarian:h,_fnLanguageCompat:m,_fnBrowserDetect:r,_fnAddData:G,_fnAddTr:I,_fnNodeToDataIndex:function(a,c){return c._DT_RowIndex!==b?c._DT_RowIndex:null},_fnNodeToColumnIndex:function(b,c,d){return a.inArray(d,b.aoData[c].anCells)},_fnGetCellData:B,_fnSetCellData:D,_fnSplitObjNotation:H,_fnGetObjectDataFn:J,_fnSetObjectDataFn:C,_fnGetDataMaster:L,_fnClearTable:P,_fnDeleteIndex:N,_fnInvalidate:p,_fnGetRowElements:v,_fnCreateTr:w,_fnBuildHead:R,_fnDrawHead:S,_fnDraw:y,_fnReDraw:T,_fnAddOptionsHtml:ia,
_fnDetectHeader:Z,_fnGetUniqueThs:aa,_fnFeatureHtmlFilter:xa,_fnFilterComplete:ka,_fnFilterCustom:Ca,_fnFilterColumn:Ba,_fnFilter:jb,_fnFilterCreateSearch:Pa,_fnEscapeRegex:Da,_fnFilterData:kb,_fnFeatureHtmlInfo:hb,_fnUpdateInfo:nb,_fnInfoMacros:ob,_fnInitialise:va,_fnInitComplete:za,_fnLengthChange:Qa,_fnFeatureHtmlLength:eb,_fnFeatureHtmlPaginate:ib,_fnPageChange:Sa,_fnFeatureHtmlProcessing:fb,_fnProcessingDisplay:ea,_fnFeatureHtmlTable:gb,_fnScrollDraw:ta,_fnApplyToChildren:ha,_fnCalculateColumnWidths:La,
_fnThrottle:Aa,_fnConvertToWidth:pb,_fnScrollingWidthAdjust:rb,_fnGetWidestNode:qb,_fnGetMaxLenString:sb,_fnStringToCss:O,_fnScrollBarWidth:tb,_fnSortFlatten:qa,_fnSort:db,_fnSortAria:vb,_fnSortListener:Ta,_fnSortAttachListener:Na,_fnSortingClasses:Fa,_fnSortData:ub,_fnSaveState:Ga,_fnLoadState:wb,_fnSettingsFromNode:Ha,_fnLog:ma,_fnMap:ga,_fnBindAction:Ua,_fnCallbackReg:ba,_fnCallbackFire:V,_fnLengthOverflow:Ra,_fnRenderer:Oa,_fnDataSource:da,_fnRowAttributes:F,_fnCalculateEnd:function(){}});a.fn.dataTable=
z;a.fn.dataTableSettings=z.settings;a.fn.dataTableExt=z.ext;a.fn.DataTable=function(b){return a(this).dataTable(b).api()};a.each(z,function(b,c){a.fn.DataTable[b]=c});return a.fn.dataTable})})(window,document);window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(e){return function(){var k={};return{check_message:function(b){var a;if(b.is_box())if(a=b.get_size(),1>a)e.UTILITIES.display_message("Function birds can only respond to boxes with holes.");else if(b=b.get_hole_contents(0)){if(b.is_bird())return{box_size:a,bird:b};e.UTILITIES.display_message("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+e.UTILITIES.add_a_or_an(b.get_type_name()+"."))}else e.UTILITIES.display_message("Function birds can only respond to boxes with something in the first hole.");
else e.UTILITIES.display_message("Function birds can only respond to boxes. One was given "+e.UTILITIES.add_a_or_an(b.get_type_name()))},process_response:function(b,a,d,h,e){b&&a.widget_side_dropped_on_me(b,void 0,e,!0,!0);d.remove(void 0,!0)},process_message:function(b,a,d,h){var e=this.check_message(b);if(e)return a=a(e.bird,e.box_size),this.process_response(a,e.bird,b,d,h),a},type_check:function(b,a,d,h){if(!b)return!0;if(!a)return e.UTILITIES.display_message("Birds for the "+d+" function can only respond to boxes with "+
e.UTILITIES.add_a_or_an(b)+" in the "+e.UTILITIES.ordinal(h)+" hole. The "+e.UTILITIES.ordinal(h)+" hole is empty."),!1;if(a.dereference().is_of_type(b))return!0;if(a.is_nest())throw{wait_for_nest_to_receive_something:a};e.UTILITIES.display_message("Birds for the "+d+" function can only respond to boxes with "+e.UTILITIES.add_a_or_an(b)+" in the "+e.UTILITIES.ordinal(h)+" hole. The "+e.UTILITIES.ordinal(h)+" hole contains "+e.UTILITIES.add_a_or_an(a.get_type_name()+"."));return!1},number_check:function(b,
a,d){return this.type_check("number",b,a,d)},n_ary_widget_function:function(b,a,d,h,e,l){var c=function(c,e){var g,l,m,k;if(1===e)return a();l=1;m=b.get_hole_contents(l).dereference();if(k=this.number_check(m,h,l)){for(l++;l<e;){g=b.get_hole_contents(l).dereference();k=this.number_check(g,h,l);if(!k)return;d.call(m,g);l++}return m}}.bind(this);return this.process_message(b,c,e,l)},n_ary_function:function(b,a,d,h,m,l){var c=function(c,l){var g,m,k,u;if(l<d+1)e.UTILITIES.display_message("Birds for the "+
h+" function can only respond to boxes with at least "+(d+1)+" holes. Not "+l+" holes.");else{k=[];for(m=1;m<l;){g=b.get_hole_contents(m).dereference();u=this.number_check(g,h,m);if(!u)return;k.push(g.get_value());m++}return a.apply(null,k)}}.bind(this);return this.process_message(b,c,m,l)},typed_bird_function:function(b,a,d,h,m,l,c){var k=function(c,g){var l,k,r,f;if(0<=h&&g!=h+1)e.UTILITIES.display_message("Birds for the "+m+" function can only respond to boxes with "+(h+1)+" holes. Not "+g+" holes.");
else{r=[];for(k=1;k<g;){l=b.get_hole_contents(k).dereference();k<=d.length&&(f=d[k-1]);if(!this.type_check(f,l,m,k))return;r.push(l);k++}return a.apply(null,r)}}.bind(this);return this.process_message(b,k,l,c)},numeric_javascript_function_to_widget_function:function(b,a,d){return function(){var h=e.number.ZERO(e.number.function_bird_results_default_format);h.set_value_from_decimal(b.apply(null,e.UTILITIES.map_arguments(arguments,d||bigrat.toDecimal)));a&&h.set_approximate(!0);return h}},bigrat_function_to_widget_function:function(b,
a){return function(){var d=e.number.create_from_bigrat(b.apply(null,arguments));a&&d.set_approximate(!0);return d}},add_function_object:function(b,a,d,h,m){k[b]={name:b,short_name:h||b,respond_to_message:a,get_description:m?1===m.length?function(){return"If you give me a box with another bird and "+e.UTILITIES.add_a_or_an(m[0])+" then "+e.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+
e.UTILITIES.conjunction(m,!0)+" then "+e.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+e.UTILITIES.lower_case_first_letter(this.title)+"\nOn my back side you can change me to compute other functions."},toString:function(){return e.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:d}},get_function_table:function(){return k}}}}(window.TOONTALK);window.TOONTALK.widget=function(e){var k=function(b){if(b=this.get_frontside&&this.get_frontside(b))return b.get_element()};e.creators_from_json.top_level=function(b){b=e.widget.create_top_level_widget(b.settings);$(b.get_backside(!0).get_element()).addClass("toontalk-top-level-backside");return b};return{add_standard_widget_functionality:function(b){var a=function(){return!1},d;this.add_sides_functionality(b);this.runnable(b);this.stackable(b);this.animatable(b);this.has_title(b);this.has_parent(b);
this.has_backside_widgets(b);this.has_description(b);this.has_listeners(b);this.droppable(b);this.erasable(b);b.this_and_walk_children=function(a){a(b)&&b.walk_children&&b.walk_children(a)};b.top_level_widget=function(){var a;if(d)return d;if(this.is_top_level())return this;if(d=e.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-top-level-backside")))return d=d.get_widget();if(a=this.get_parent_of_frontside()||this.get_parent_of_backside())return d=a.get_widget().top_level_widget();
a=$(".toontalk-top-level-backside");if(0<a.length)return 1<a.length&&console.log("Cannot find the top-level widget of "+this+" but found "+a.length+" top-level backsides so picked one."),d=e.UTILITIES.widget_side_of_jquery(a).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return d=this.create_top_level_widget()};b.is_of_type||(b.is_of_type=function(a){return this.get_type_name()===a});b.dereference||(b.dereference=function(){return this});b.get_default_description||
(b.get_default_description=function(){return e.UTILITIES.add_a_or_an(this.get_type_name())+"."});b.is_number||(b.is_number=a);b.is_box||(b.is_box=a);b.is_empty_hole||(b.is_empty_hole=a);b.is_hole||(b.is_hole=a);b.is_scale||(b.is_scale=a);b.is_bird||(b.is_bird=a);b.is_nest||(b.is_nest=a);b.is_robot||(b.is_robot=a);b.is_element||(b.is_element=a);b.is_sensor||(b.is_sensor=a);b.is_function_nest||(b.is_function_nest=a);b.is_plain_text_element||(b.is_plain_text_element=a);b.is_attribute_widget||(b.is_attribute_widget=
a);b.maintain_proportional_dimensions||(b.maintain_proportional_dimensions=a);b.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};b.set_name&&(b.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});b.get_width||(b.get_width=function(){return $(b.get_frontside_element()).width()});b.get_height||(b.get_height=function(){return $(b.get_frontside_element()).height()});!e.debugging&&!e.logging||b.to_debug_string||(b.to_debug_string=
function(){var a=this.get_parent_widget_of_frontside(),b=this._debug_id,d=this.get_description(),d=d?d+" ":"";b||(b=a&&a.id?"id of parent is "+a.id:"");d&&(d+=" ");return this.toString({plain_text:!0})+" ("+d+(this.get_name&&this.get_name()+" "||"")+b+")"});b.is_top_level=a;b.is_widget=!0},erasable:function(b){var a;b.get_erased||(b.get_erased=function(){return a});b.set_erased||(b.set_erased=function(b,h){a=b;h&&this.rerender()})},add_sides_functionality:function(b){var a,d,h;b.get_frontside||(b.get_frontside=
function(d){d&&!a&&(a=e.frontside.create(b));return a},b.save_dimensions=function(){return this.save_dimensions_of(this)},b.save_dimensions_of=function(a){var b;if(a.is_element()){if(!this.get_original_width())return;b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0},b.restore_dimensions=function(){var a,b;0<this.saved_width&&(a=this.get_frontside_element(!0),this.use_scaling_transform?
this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.ok_to_set_dimensions()?this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):e.UTILITIES.set_css(a,{width:this.saved_width,height:this.saved_height}):(b={width:"",height:""},e.UTILITIES.set_css_transform(b,""),e.UTILITIES.set_css(a,b)),this.saved_height=this.saved_width=void 0)});b.get_backside||(b.get_backside=function(a){a&&!d&&(d=this.create_backside(),this.backside_widgets_json_views&&
(d.add_backside_widgets(this.get_backside_widgets(),this.backside_widgets_json_views),this.backside_widgets_json_views=void 0));return d});b.set_backside||(b.set_backside=function(a){d=a});b.forget_backside||(b.forget_backside=function(){var a;if(d){if(a=d.get_element())$(a).remove(),a.toontalk_widget_side=void 0;d=void 0}});b.create_backside||(b.create_backside=function(){return e.backside.create(b)});b.get_open_backside_only_if_stopped||(b.get_open_backside_only_if_stopped=function(){return h});
b.set_open_backside_only_if_stopped||(b.set_open_backside_only_if_stopped=function(a){h=a})},runnable:function(b){var a=!1,d=!1;b.get_running||(b.get_running=function(b){var d=!1;if(b)return a;if(a)if(b=this.get_backside_widgets(),0===b.length)a=!1;else for(b.some(function(a){if(a&&(a=a.get_widget(),a.get_running()))return d=!0}),b=this.get_parent_of_frontside();b;){if(b.is_backside())return b.get_widget().get_running(!0);if(b.get_running&&b.get_running(!0))return!0;b=b.get_parent_of_frontside()}return d});
b.is_ok_to_run||(b.is_ok_to_run=function(){return d},b.set_ok_to_run=function(a){d=a});b.set_running||(b.set_running=function(h,e,l){var c=a===h,k,q;d=h;k=this.get_backside_widgets();a=h;this.get_backside()&&!c&&this.get_backside().run_status_changed(a);k.forEach(function(c){c&&(q=c.get_widget(),c.is_backside()&&0<=this.get_backside_widgets().indexOf(q)||(!q.is_robot()||q.being_trained||q.get_body().is_empty()?q.set_running&&(!e&&c.is_backside()&&"top-level"!==b.get_type_name()?q.set_running(h,b,
!0):q.set_running(h)):a?(q.set_stopped(!1),q.run(b,l,e),q.set_ok_to_run(!0)):(q.set_stopped(!0),q.set_running(!1)),q.rerender()))}.bind(this));this.walk_children&&this.walk_children(function(b){b.set_running&&b.set_running(a);return!0});this.is_robot()&&(a?b.get_parent_of_backside()&&(this.set_stopped(!1),this.run(b.get_parent_of_backside().get_widget())):this.set_stopped(!0));c||this.rerender()})},droppable:function(b){b.drop_on||(b.drop_on=function(a,b,h){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,
b,h);console.log("No handler for drop of '"+this+"' on '"+a+"'")})},stackable:function(b){var a=!1;b.get_infinite_stack||(b.get_infinite_stack=function(){return a});b.set_infinite_stack||(b.set_infinite_stack=function(d){var h=b.get_backside_element(),e=b.get_frontside_element();a=d;h&&$(h).find(".toontalk-infinite-stack-check-box").prop("checked",d);e&&(d?$(e).addClass("toontalk-infinite-stack"):$(e).removeClass("toontalk-infinite-stack"))})},animatable:function(b){var a;b.animate_to_widget||(a=
function(a){var b=a.get_element();b&&(a.is_backside()||e.UTILITIES.visible_element(b))||(b=e.UTILITIES.find_resource_equal_to_widget(a));return b},b.animate_to_widget=function(b,h,e,l,c,k,q){var g=function(){this.animate_to_element(a(b),h,e,l,c,k,q&&Math.max(0,q-100));this.rerender()}.bind(this);0===q?g():setTimeout(g,100)});b.animate_to_element||(b.animate_to_element=function(a,b,m,l,c,k,q){var g=$(a).offset(),n=$(this.get_frontside_element()),t=$(a).is(".toontalk-backside");if(a&&e.UTILITIES.visible_element(a)){if("number"===
typeof a.animation_left_offset)l=a.animation_left_offset;else if("undefined"===typeof l||t)l=($(a).width()-n.width())*Math.random();if("number"===typeof a.animation_top_offset)c=a.animation_top_offset;else if("undefined"===typeof c||t)c=($(a).height()-n.height())*Math.random();g?(g.left+=l,g.top+=c):g={left:0,top:0};this.animate_to_absolute_position(g,b,m,k,q)}else b&&b()});b.animate_to_absolute_position||(b.animate_to_absolute_position=function(a,b,m,l,c){e.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),
a,b,m,l,c)})},has_title:function(b){b.get_title||(b.get_title=function(){var a=this.get_type_name(),b=this.get_backside(),h=this.get_frontside_element(),m=this.get_description(),l="";$(h).is(".toontalk-top-level-resource")?l=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":b&&b.get_element()&&e.UTILITIES.visible_element(b.get_element())||(l=
this.can_run&&this.can_run()?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my back side and then click the green flag "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+".":"Click to see my back side.");m&&(m="I'm "+m,l=l?m+"\n"+
l:m);if(this.get_erased())return this.get_title_of_erased_widget();l=this.get_custom_title_prefix&&!$(h).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+l:"I'm "+e.UTILITIES.add_a_or_an(a)+". "+l;l=l.trim();0>".?!".indexOf(l[l.length-1])&&(l+=".");return l});b.update_title=function(){var a=this.get_frontside_element();a&&e.UTILITIES.give_tooltip(a,this.get_title())}},get_title_of_erased_widget:function(){var b=this.get_frontside_element(),a=this.get_type_name();return b&&$(b).closest(".toontalk-conditions-contents-container").is("*")?
"I'm an erased "+a+".\nI'll match with any other "+a+".":"I'm an erased "+a+".\nDusty the Vacuum can restore me to normal."},has_parent:function(b){var a=[],d,h,m,l;b.get_parent_of_frontside=function(){return m&&d?d.get_backside(!0):d};b.get_parent_widget_of_frontside=function(){return d};b.parent_of_frontside_is_backside=function(){return m};b.set_parent_of_frontside=function(b,h,e){var g=d;m=h;d!==b&&(d=b,g&&!e&&!h&&g.is_backside()&&g.get_widget().remove_backside_widget(this,!0),a.forEach(function(a){a(g,
d)}))};b.add_parent_of_frontside_change_listener=function(b){a.push(b)};b.remove_parent_of_frontside_change_listener=function(b){b=a.indexOf(b);0<=b&&a.splice(b,1)};b.get_parent_of_backside=function(){return l&&h?h.get_backside(!0):h};b.set_parent_of_backside=function(a,b,d){void 0===a&&!d&&l&&h&&h.get_widget().remove_backside_widget(this.get_backside(),!0);h=a;l=b};b.parent_of_backside_is_backside=function(){return l};b.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?
a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};b.closest_visible_ancestor_or_frontside=function(){for(var a=this,b;a&&!e.UTILITIES.visible_element(a.get_frontside_element());)b=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=b.get_widget()):a=a.get_parent_of_frontside();return a||this};b.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};b.has_ancestor=function(a){var b;
return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};b.remove_from_parent_of_frontside=function(a){d&&(d.is_backside()?d.remove_backside_widget(this,!a):d.removed_from_container?m?d.remove_backside_widget(this,!0):d.removed_from_container(this,a):d.get_backside()&&d.remove_backside_widget(this,!a))}},has_description:function(b){var a;b.get_description||(b.get_description=function(){return a});b.set_description||(b.set_description=function(b,h){if(a===b||!a&&""===b)return!1;
a=b;h&&this.rerender();return!0});b.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},has_name:function(b){var a;b.get_name||(b.get_name=function(){"string"!==typeof a&&b.generate_name&&(a=b.generate_name());return a});b.set_name||(b.set_name=function(b,h){if(a===b||"string"!==typeof b)return!1;a=b;h&&this.rerender();return!0})},has_listeners:function(b){var a={};b.add_listener||(b.add_listener=function(b,h){var e=
a[b];e?0>e.indexOf(h)&&e.push(h):a[b]=[h]});b.remove_listener||(b.remove_listener=function(b,h,m){if(b=a[b])if(h=b.indexOf(h),0<=h){b.splice(h,1);return}!m&&e.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});b.get_listeners||(b.get_listeners=function(b){return a[b]})},get_full_description:function(b){var a;if(this.get_erased&&this.get_erased())return b&&"conditions"===b.role?"any "+this.get_type_name():"erased "+this.get_type_name();a=this.get_description(b);b=this.toString(b);
return a?b+" ("+a+")":b},remove:function(b,a){var d=this.get_backside(),h=this.get_frontside(),e=this.get_parent_of_frontside();d&&this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level()&&d.hide_backside();h&&h.remove();e&&this.remove_from_parent_of_frontside(b);this.get_running()&&this.set_running(!1);this.set_visible(!1);this.walk_children&&!a&&this.walk_children(function(a){a.remove&&a.remove();return!0})},get_frontside_element:k,get_element:k,get_backside_element:function(b){if(b=
this.get_backside&&this.get_backside(b))return b.get_element()},add_to_json:function(b,a){var d,h,m,l,c;if(b){b.view?(h=b,d=b.view,b=b.semantic):(d={},h={semantic:b,view:d});h.version=1;this.get_erased&&this.get_erased()&&(b.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(b.infinite_stack=!0);this.get_open_backside_only_if_stopped&&this.get_open_backside_only_if_stopped()&&(b.open_backside_only_if_stopped=!0);this.get_running&&this.get_running()&&(b.running=!0);l=this.get_parent_widget_of_frontside();
if(!l||this.parent_of_frontside_is_backside()||l.is_element())if(l=this.get_frontside_element&&this.get_frontside_element())if(c=$(l).width(),$(l).is(".toontalk-plain-text-element")||0===c||(d.frontside_width=$(l).width(),d.frontside_height=$(l).height()),0!==c&&(d.frontside_left=e.UTILITIES.get_style_numeric_property(l,"left"),d.frontside_top=e.UTILITIES.get_style_numeric_property(l,"top")||m&&m.frontside_top,void 0===d.frontside_left&&(m=this.get_parent_of_frontside().get_widget().get_backside_widgets_json_views())))l=
this.get_parent_of_frontside().get_widget().get_backside_widgets().indexOf(this),d.frontside_left=m[l].frontside_left,d.frontside_top=m[l].frontside_top;if(l=this.get_backside()){if(c=l.get_element()){if(l.get_backside_dimensions()||l.is_top_level())d.backside_width=$(c).width(),d.backside_height=$(c).height();d.backside_left||(m=$(c).position(),d.backside_left=m.left,d.backside_top=m.top,"&lt;"===$(c).find(".toontalk-settings-backside-button").html()&&(d.advanced_settings_open=!0))}l.get_backside_dimensions()&&
(d.backside_geometry=l.get_backside_dimensions())}!d.backside_geometry&&this.backside_geometry&&(d.backside_geometry=this.backside_geometry);b.description=this.get_description&&this.get_description();d.saved_width=this.saved_width;d.saved_height=this.saved_height;return h}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(b,a,d,h){var m=this.get_backside_widgets(),l,c;0<m.length?(b.semantic.backside_widgets=[],(l=this.get_backside_widgets_json_views())&&l.forEach(function(d,
h){var g;if(c=b.semantic.backside_widgets[h]){if(0<=c.widget.shared_widget_index){g=a.widgets_encountered.indexOf(a.shared_widgets[c.widget.shared_widget_index]);if(!a.json_of_widgets_encountered[g])return;g=a.json_of_widgets_encountered[g].view}else g=c.widget.view;c.is_backside?d.backside_left&&(g.backside_left=d.backside_left,g.backside_top=d.backside_top):d.frontside_left&&(g.frontside_left=d.frontside_left,g.frontside_top=d.frontside_top)}}),e.UTILITIES.get_json_of_array(m,b.semantic.backside_widgets,
0,a,d,h)):d()},has_backside_widgets:function(b){var a=[];b.get_backside_widgets=function(){return a};b.add_backside_widget=function(b){var h;if(b){h=this.get_backside(!0);if(e.debugging){if(b===this){e.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");return}if(b.get_widget()===this){e.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}a?0>a.indexOf(b)&&a.push(b):a=[b];e.logging&&0<=e.logging.indexOf("backside-widgets")&&
console.log("Added "+b+" to backside widgets of "+this+". Number of backside widgets is "+a.length);b.is_backside()?b.set_parent_of_backside(h,!0):b.set_parent_of_frontside(this,!0);h.visible()&&b.set_visible(!0)}else e.debugging&&e.UTILITIES.report_internal_error("adding undefined to back side widgets.")};b.remove_all_backside_widgets=function(){a&&a.slice().forEach(function(a){a.remove()})};b.remove_backside_widget=function(b,h){var m=a.indexOf(b);0>m?h||e.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+
b.get_widget()+" ("+b.get_widget()._debug_id+")"):(a.splice(m,1),e.logging&&0<=e.logging.indexOf("backside-widgets")&&console.log("Removed "+b+" from backside widgets of "+this+". Number of backside widgets is "+a.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(m,1),b.is_backside()?(m=b.get_parent())&&m.get_widget()===this&&b.set_parent_of_backside(void 0,!0,!0):(m=b.get_parent_of_frontside())&&m.get_widget()===this&&b.set_parent_of_frontside(void 0,void 0,!0),b.set_visible(!1))};
b.set_backside_widgets=function(b,h){var e=this.get_backside(),l=e&&e.visible();a=b;0<a.length&&(e?e.add_backside_widgets(a,h):this.backside_widgets_json_views=h,a.forEach(function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),l&&a.set_visible(l))}.bind(this)))}},get_backside_widgets_json_views:function(b){!this.backside_widgets_json_views&&b&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var b=!1,a;
this.get_backside_widgets().some(function(d){if(!d)return!1;a=d.get_widget();if(a.get_body&&!a.get_body().is_empty()||a.can_run())return b=!0});return b},add_to_copy:function(b,a){var d;this.get_erased&&this.get_erased()&&(b.set_erased||e.widget.erasable(b),b.set_erased(this.get_erased()));a&&a.just_value||(d=this.get_backside_widgets(),0<d.length&&b.set_backside_widgets(e.UTILITIES.copy_widget_sides(d,a),this.get_backside_widgets_json_views()));b.set_running(this.get_running());return b},get_type_name:function(){return""},
copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(b,a,d){var h=this.visible(),m,l,c,k,q;b||(b=this.copy({}));m=this.get_frontside_element(h);l=b.get_frontside_element(h);c=$(m).closest(".toontalk-backside");k=b.ok_to_set_dimensions();0===c.length&&(c=$(this.top_level_widget().get_backside_element()));q=e.UTILITIES.widget_side_of_jquery(c);h&&("undefined"===typeof a&&(a=30),"undefined"===typeof d&&(d=30),h=e.UTILITIES.relative_position(m,c.get(0)),0<c.length&&
c.get(0).appendChild(l),e.UTILITIES.set_css(l,{width:k?$(m).width():"",height:k?$(m).height():"",left:h.left+a,top:h.top+d,"z-index":e.UTILITIES.next_z_index()}));q&&q.add_backside_widget(b);return b},visible:function(){var b;if(!document.hidden)return(b=this.get_frontside())?b.visible():!1},set_visible:function(b){var a=this.get_frontside(b);a&&a.set_visible(b)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(b){this.set_parent_of_frontside(b)},
drag_started:function(b,a){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,a)},match:function(b){console.assert(!1,"match not implemented for "+b.toString())},removed:function(b){e.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(b){var a=this.get_backside(),d,h,m,l,c,k,q,g,n,t,u;if(a&&$(a.get_element()).is(":visible"))$(a.get_element()).css({opacity:1}),d&&d();else if(d=b&&function(){setTimeout(b)},
h=function(a,b){e.UTILITIES.set_timeout(function(){$(a).addClass("toontalk-side-appearing");e.UTILITIES.add_one_shot_event_handler(a,"transitionend",2500,function(){$(a).removeClass("toontalk-side-appearing");d&&d()});$(a).css({left:q,top:g,opacity:b});this.apply_backside_geometry()}.bind(this))}.bind(this),l=this.get_frontside_element(),c=$(l).parent(),a=$(l),a.is(".toontalk-top-level-resource"))d&&d();else{for(;0<c.length&&!c.is(".toontalk-backside");)a=c,c=c.parent();a.get(0);a=this.get_backside(!0);
m=a.get_element();m.toontalk_widget_side=a;n=$(l).offset();t=c.offset();u=c.width();t||(t={left:0,top:0});$(m).css({left:n.left-t.left,top:n.top-t.top,opacity:.01});0<c.length&&c.get(0).appendChild(m);(c=e.UTILITIES.widget_side_of_jquery(c))&&c.add_backside_widget(a);c=this.is_element()?this.get_attribute("height"):$(l).height();l=$(m).width();q=n.left-t.left;q+l>u&&(q=Math.max(0,u-l));g=n.top-t.top+c+34;this.is_box()&&(g+=28);h(m,"inherit");a.set_visible(!0);k=this.get_backside_widgets();0<k.length&&
k.forEach(function(a){a.is_backside()&&0<=k.indexOf(a.get_widget())?a.hide_backside():(a.set_visible(!0),m.appendChild(a.get_element(!0)))}.bind(this));return a}},hide_backside:function(){var b=this.get_backside();b&&b.hide_backside()},apply_backside_geometry:function(){var b=this.get_backside(!0),a=b.get_element();this.backside_geometry&&a&&(b.scale_backside(a,this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),
b.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(b){this.top_level_widget().robot_started_training(b)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},backup_all:function(b){var a=this.top_level_widget();a&&a.save(b)},render:function(){e.DISPLAY_UPDATES.pending_update(this)},
rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},location_constrained_by_container:function(){var b=this.get_parent_of_frontside();return b&&(b.is_hole()||b.is_nest())?!0:!1},close_button_ok:function(b){return"top-level"!==this.get_type_name()&&!$(b).is(".toontalk-top-level-resource")&&!$(b).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(b,a){var d=this.top_level_widget(),
h;b||(b=this);h=b.get_element(!0);d.add_backside_widget(b);d.get_backside_element().appendChild(h);b.render();a&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,d);return h},create_top_level_widget:function(b){var a=Object.create(e.widget),d=[],h=function(){return!1},m=!1;b||(b={});a.is_top_level=function(){return!0};a.is_number=h;a.is_box=h;a.is_empty_hole=h;a.is_scale=h;a.is_bird=h;a.is_nest=h;a.is_robot=h;a.is_element=h;a.is_sensor=h;a.is_function_nest=h;a.is_hole=h;a.is_plain_text_element=
h;a.is_attribute_widget=h;a.ok_to_set_dimensions=h;a.get_json=function(a,c,d){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");c({semantic:{type:"top_level",settings:b},view:{background_color:a}},d)};a.get_type_name=function(){return"top-level"};a.is_of_type=function(a){return"top-level"===a};a.toString=function(){return"top level widget"};a.get_description=function(){};a.match=function(){return"matched"};a.update_display=function(){this.get_backside_widgets()&&
this.get_backside_widgets().forEach(function(a){a&&a.visible()&&a.update_display()})};a.copy=function(){return this};a.visible=function(){return!0};a.get_parent_of_frontside=function(){};a.get_parent_of_backside=function(){};a.closest_visible_ancestor=function(){return this};a.get_infinite_stack=function(){return!1};a.top_level_widget=function(){return this};if(e.debugging||e.logging)a.to_debug_string=function(){var a=$(this.get_backside_element()).offset();return"top-level widget at "+Math.round(a.left)+
", "+Math.round(a.top)};a.add_sides_functionality(a);a.runnable(a);a.has_parent(a);a.has_backside_widgets(a);a.removed_from_container=function(a,b){this.robot_in_training()||this.remove_backside_widget(a,!0)};a.widget_side_dropped_on_me=function(a,b,d,h){return this.get_backside().widget_side_dropped_on_me(a,b,d,h)};a.get_element=function(){return this.get_backside().get_element()};a.get_setting=function(a,c){"undefined"!==typeof b[a]||c||(b[a]=e.DEFAULT_SETTINGS&&e.DEFAULT_SETTINGS[a]);return b[a]};
a.set_setting=function(a,c){b[a]=c};a.open_settings=function(){e.SETTINGS.open(a)};a.robot_in_training=function(){if(0<d.length)return d[d.length-1]};a.robot_training_this_robot=function(){if(1<d.length)return d[d.length-2]};a.robot_started_training=function(a){d.push(a)};a.robot_finished_training=function(){d.pop()};a.save=function(a,b,d){var h=this.get_setting("program_name",!0),g=function(a){m=!1;n&&(k=e.google_drive.get_status(),"Ready"===k?(e.google_drive.upload_file(h,"json",JSON.stringify(a,
e.UTILITIES.clean_JSON),d),d=void 0):e.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===k?(e.UTILITIES.display_message_if_new("Unable to save to your Google Drive because you need to log in. Click on the settings icon "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-settings-icon'></span>")+" to log in."),e.UTILITIES.display_tooltip($(".toontalk-settings-button"))):console.log("Unable to save to Google Drive because: "+k)));b.local_storage&&this.save_to_local_storage(a);
d&&d()}.bind(this),n,k;!m&&h&&(b||(b={}),"undefined"===typeof b.google_drive&&(b.google_drive=e.google_drive&&this.get_setting("auto_save_to_google_drive")),"undefined"===typeof b.local_storage&&(b.local_storage=this.get_setting("auto_save_to_local_storage")),a?(n=b.google_drive&&!this.get_setting("google_drive_unavailable"))||b.local_storage?(m=!0,e.UTILITIES.get_json_top_level(this,g,250)):d&&d():setTimeout(function(){this.save(!0,b,d)}.bind(this),100))};a.publish=function(a,b){e.publish.publish_widget(this.get_setting("program_name"),
this,b,a)};a.save_to_local_storage=function(a,b){var d=this.get_setting("program_name"),h=e.UTILITIES.local_storage_program_key(d),g=e.UTILITIES.local_storage_program_meta_data_key(d),m,k,u;b||(b=Date.now());try{k=(k=window.localStorage.getItem(g))?JSON.parse(k):{created:b},k.last_modified=b,u=JSON.stringify(a,e.UTILITIES.clean_json),k.file_size=u.length,window.localStorage.setItem(g,JSON.stringify(k)),window.localStorage.setItem(h,u),window.localStorage.setItem("toontalk-last-key",h),m=e.UTILITIES.get_all_locally_stored_program_names(),
0>m.indexOf(d)&&(m.push(d),e.UTILITIES.set_all_locally_stored_program_names(m))}catch(f){d=u?"Failed to save state to local storage since it requires "+u.length+" bytes. Error message is "+f:"Error while saving to local storage. Error message is "+f,e.UTILITIES.is_internet_explorer()?console.error("Unresolved difficulties using window.localStorage in IE11: "+d):e.UTILITIES.display_message(d),this.last_local_storage_error=d}};a.load=function(b,c,d){var h=this.get_setting("program_name"),g=h+".json",
m=e.UTILITIES.local_storage_program_key(h),k=function(b){var g;if(b)try{g=JSON.parse(b),a.remove_all_backside_widgets(),e.UTILITIES.add_backside_widgets_from_json(a,g.semantic.backside_widgets,{json_of_shared_widgets:g.shared_widgets,shared_widgets:[],shared_html:g.shared_html}),c&&c()}catch(l){e.UTILITIES.display_message("Error encountered loading "+h+" : "+l)}else d&&d()},u=function(a){a?e.google_drive.download_file(a,k):k(window.localStorage.getItem(m))};b&&e.google_drive&&"Ready"===e.google_drive.get_status()?
e.google_drive.get_toontalk_program_file(g,u):k(window.localStorage.getItem(m))};a.walk_children=function(){};a.render=function(){};a.location_constrained_by_container=function(){return!1};a.is_widget=!0;e.debugging&&(a._debug_id=e.UTILITIES.generate_unique_id(),a._debug_string="Top-level widget");a.get_backside(!0).set_visible(!0);return a}}}(window.TOONTALK);window.TOONTALK.backside=function(e){var k=function(b){var a=b.get_widget(),d=a.get_backside_widgets(),h=a.get_backside_widgets_json_views(!0);b.get_backside_dimensions();var m=b.get_element();d.forEach(function(a,b){var d=a.get_element(),q;d&&(h[b]||(h[b]={}),a.start_offset&&d.parentElement?(q=e.UTILITIES.relative_position_from_absolute_position(d.parentElement,a.start_offset),a.start_offset=void 0):q=$(d).position(),a.is_backside()?(h[b].backside_left=e.UTILITIES.left_as_percent(q.left,d),h[b].backside_top=
e.UTILITIES.top_as_percent(q.top,d),k(a)):(h[b].frontside_left=e.UTILITIES.left_as_percent(q.left,d,m),h[b].frontside_top=e.UTILITIES.top_as_percent(q.top,d,m)))})};return{create:function(b){var a=Object.create(this),d=document.createElement("div"),h=$(d),k=1,l=1,c=document.createElement("div"),r=document.createElement("div"),q=b.get_help_URL&&b.get_help_URL(),g,n,t,u,f,x,A,E,M,G,I,B,D,H,J,C,L=function(a){a?($(c).addClass("toontalk-green-flag-active").removeClass("toontalk-green-flag-inactive"),$(r).addClass("toontalk-stop-sign-inactive").removeClass("toontalk-stop-sign-active")):
($(c).addClass("toontalk-green-flag-inactive").removeClass("toontalk-green-flag-active"),$(r).addClass("toontalk-stop-sign-active").removeClass("toontalk-stop-sign-inactive"))};D=this.create_description_label(a,b);var P=function(){var a;a=b.get_running()?"To stop this click on the stop sign "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):b.can_run()?"Click this to start this running.":"There is nothing to run on this.";e.UTILITIES.give_tooltip(c,a)},N=function(){var a;
a=b.get_running()?"Click to stop this from running.":b.can_run()?"This has stopped. Click on the flag "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";e.UTILITIES.give_tooltip(r,a)},p=function(a){S?(J=document.createElement("iframe"),$(J).addClass("toontalk-help-frame"),J.src=q,document.body.appendChild(C),document.body.appendChild(J),a.stopPropagation()):(H.href=q,H.target="_blank")},v,w,F,R,S,y;e.TRANSLATION_ENABLED&&
(q=e.UTILITIES.add_URL_parameter(q,"translate","1"));b.close_button_ok(d)&&(w=function(c){var f=function(){b.robot_in_training()&&b.robot_in_training()!==b&&b.robot_in_training().backside_closed(a);a.is_primary_backside()?a.hide_backside(c):a.remove()},g,p;b.get_running()?(g=b.get_backside_widgets(),g.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(f),p=a,!0}),p?(p.add_body_finished_listener(function(){p.visible()?h.css({opacity:1}):(b.forget_backside(),e.DEFAULT_QUEUE.start());
f()}),a.set_visible(!1)):f(),h.css({opacity:1}),h.addClass("toontalk-animating-element"),h.css({opacity:0}),e.UTILITIES.add_one_shot_event_handler(d,"transitionend",2E3,function(){b.forget_backside()})):f();c.stopPropagation()},v=(v=b.get_description())?"the "+b.get_type_name()+" who "+v:"the "+b.get_type_name(),B=e.UTILITIES.create_close_button(w,"Click to remove this back side of "+v+"."),d.appendChild(B));$(c).addClass("toontalk-green-flag toontalk-green-flag-inactive");c.addEventListener("click",
function(a){b.can_run()?(L(!0),b.set_running(!0),N(),e.DEFAULT_QUEUE.start()):b.is_top_level()?e.UTILITIES.display_message("There is nothing to run."):e.UTILITIES.display_message("This "+b.get_type_name()+" has nothing to run. Add some robots on the back.");b.robot_in_training()&&b.robot_in_training().button_clicked(".toontalk-green-flag",b);a.stopPropagation()});c.addEventListener("mouseenter",N);$(r).addClass("toontalk-stop-sign toontalk-stop-sign-active");r.addEventListener("click",function(a){L(!1);
b.set_running(!1);P();b.robot_in_training()&&b.robot_in_training().button_clicked(".toontalk-stop-sign",b);a.stopPropagation();b.is_top_level()&&e.UTILITIES.stop_audio_objects()});r.addEventListener("mouseenter",P);d.appendChild(c);d.appendChild(r);e.UTILITIES.use_custom_tooltip(c);e.UTILITIES.use_custom_tooltip(r);e.UTILITIES.when_attached(d,function(){b.is_robot()?d.title="On the back of the robot you can change the conditions and setting of the robot.":(y=b.toString({inside_tool_tip:!0}),d.title=
"The back of "+y+". You can put robots on the back to make it come 'alive'.");e.UTILITIES.use_custom_tooltip(d)});q&&(S=0>q.indexOf("://"),H=document.createElement(S?"div":"a"),$(H).addClass("toontalk-help-button notranslate toontalk-widget-help-button"),H.addEventListener("click",p),H.innerHTML="i",H.translate=!1,e.UTILITIES.give_tooltip(H,"Click to learn more about "+b.get_type_name(!0,!0)+"."),C=document.createElement("div"),$(C).addClass("toontalk-close-help-frame-button").button(),C.addEventListener("click",
function(a){$(J).remove();$(C).remove();a.stopPropagation()}),C.innerHTML="Return to ToonTalk",d.appendChild(H));D&&d.appendChild(D);b.is_top_level()&&(u=document.createElement("div"),$(u).addClass("toontalk-settings-button"),u.addEventListener("click",function(a){b.open_settings();a.stopPropagation()}),d.appendChild(u),e.UTILITIES.give_tooltip(u,"Click to change settings or open a different program."));h.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+b.get_type_name());h.css({"z-index":e.UTILITIES.next_z_index()});
a.get_element=function(){return d};a.get_backside_element=function(){return d};a.get_widget=function(){return b};a.visible=function(){return f};a.set_visible=function(a){f=a;!b.is_top_level()&&this.is_primary_backside()&&(this.get_widget().get_backside_widgets().forEach(function(b){b&&b!==this&&b.set_visible(a)}.bind(this)),f&&this.render())};a.get_erased=function(){return g};a.set_erased=function(a,b){g=a;b&&this.rerender()};b.get_backside||(b.get_backside=function(){return a});a.is_primary_backside=
function(){return this===this.get_widget().get_backside()};a.get_width=function(){return $(this.get_element()).width()};a.get_height=function(){return $(this.get_element()).height()};a.is_widget=!0;a.get_parent_of_backside=function(){return this.is_primary_backside()?b.get_parent_of_backside():t&&n?n.get_backside(!0):n};a.set_parent_of_backside=function(a,c){!a&&n&&t&&n.remove_backside_widget(this,!0);this.is_primary_backside()&&b.set_parent_of_backside(a,c);n=a;t=c};a.get_parent_of_frontside=function(){return b.get_parent_of_frontside()};
a.is_parent_backside=function(){return b.is_parent_backside()};a.get_frontside=function(a){return b.get_frontside(a)};a.get_frontside_element=function(a){return b.get_frontside_element(a)};a.get_description_text_area=function(){return F};a.set_description_text_area=function(a){F=a};a.get_name_text_input=function(){return R};a.set_name_text_input=function(a){R=a};a.removed_from_container=function(b,c,d,f){a.get_widget().robot_in_training()||this.remove_backside_widget(b,f)};a.drop_on=function(a,b,
c){return a.widget_side_dropped_on_me(this,b,c)};a.widget_side_dropped_on_me=function(a,c,f,g){var h,p,l;if(!f||f.visible()||this.visible())return this.visible()&&(e.sounds&&c&&e.sounds.drop.play(),h=a.get_element(this.visible()),a.rerender(),c?(d.appendChild(h),e.UTILITIES.set_position_is_absolute(h,!0,c)):(f&&(l=$(f.get_frontside_element()).offset()),l||(l=$(h).offset()),d.appendChild(h),!l||0===l.left&&0===l.top||e.UTILITIES.set_absolute_position(h,l))),this.get_widget().is_top_level()&&(f&&!f.visible()&&
$(h).addClass("toontalk-widget-added-to-backside-by-unwatched-robot"),c&&!a.is_backside()&&window.dispatchEvent(e.UTILITIES.create_event("widget added",{element_widget:h,here:"back"}))),b.robot_in_training()&&!g&&c&&setTimeout(function(){b.robot_in_training().dropped_on(a,this,c)}.bind(this)),a.is_backside()&&a.get_widget().is_element()&&b.is_element()&&(g=a.get_widget(),g.set_backside(void 0),g.remove(c),g.set_backside(a)),this.add_backside_widget(a),a.dropped_on_other&&a.dropped_on_other(this,c,
f),c&&a.get_body&&a.get_body().is_empty()&&!a.being_trained?setTimeout(function(){(p=a.open_backside())&&$(p.get_element()).find(".toontalk-train-backside-button").click()}):c&&!a.is_backside()&&this.get_frontside_element()&&this.get_frontside_element().dispatchEvent(e.UTILITIES.create_event("widget added",{element_widget:h,where:"back"})),c&&a.get_widget().backup_all(),!a.is_backside()&&a.is_robot()&&this.get_widget().get_running()&&!this.is_top_level()&&this.get_widget().set_running(!0),!0;this.add_backside_widget(a);
a.dropped_on_other&&a.dropped_on_other(this,c,f)};a.add_backside_widget=function(a){return this.get_widget().add_backside_widget(a)};a.add_backside_widgets=function(a,c){var d;0!==a.length&&(d=a.slice(),e.UTILITIES.set_timeout(function(){var f=this.visible(),g=this.get_element(),h,p,l,k;d.forEach(function(d,m){d&&(e.debugging&&d.get_widget()===b?(e.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),a.splice(m,1)):(c&&(l=c[m]),h=d.get_element(!0),h.parentElement||g.appendChild(h),
h.toontalk_widget_side=d,l&&(d.is_backside()?(p=d.get_widget().get_backside(!0),k={left:l.backside_left,top:l.backside_top,width:l.backside_width,height:l.backside_height},d.get_widget().apply_backside_geometry(),l.advanced_settings_open&&p.set_advanced_settings_showing(!0,p.get_element())):(0===l.frontside_width&&(l.frontside_width=""),0===l.frontside_height&&(l.frontside_height=""),k={left:l.frontside_left||l.frontside_left||0,top:l.frontside_top||l.frontside_top||0,width:l.frontside_width||l.saved_width,
height:l.frontside_height||l.saved_height}),e.UTILITIES.constrain_css_to_fit_inside(g,k),$(h).css(k)),d.set_visible(f),d.get_widget().rerender()))})}.bind(this),100))};a.get_backside_dimensions=function(){if(1!==k||1!==l)return{x_scale:k,y_scale:l,original_width:x,original_height:A}};a.set_dimensions=function(a){k=a.x_scale;l=a.y_scale;x=a.original_width;A=a.original_height};a.scale_to_fit=function(a,b){var c;!x&&this.get_widget().backside_geometry&&(x=this.get_widget().backside_geometry.original_width,
A=this.get_widget().backside_geometry.original_height);c=e.UTILITIES.scale_to_fit(a,b,x,A);k=c.x_scale;l=c.y_scale};a.scale_to=function(a,b){var c;!x&&this.get_widget().backside_geometry&&(x=this.get_widget().backside_geometry.original_width,A=this.get_widget().backside_geometry.original_height);c=e.UTILITIES.scale_element(this.get_element(!0),a,b,x,A);k=c.x_scale;l=c.y_scale};a.get_original_width=function(){return x};a.get_original_height=function(){return A};a.run_status_changed=function(a){L(a)};
e.UTILITIES.when_attached(d,function(){var a,b,d,f;h.width();h.height();a=$(r).width();b=(b=$(B).width())?b+14:0;$(r).css({right:b});$(c).css({right:b+a+6});d=$(c).width();H&&($(H).css({right:b+a+d+12}),e.UTILITIES.use_custom_tooltip(H));u&&(f=$(H).width()||0,$(u).css({right:b+a+d+f+12}));B&&e.UTILITIES.use_custom_tooltip(B)});a.save_dimensions=function(){E=k;M=l;return!0};a.restore_dimensions=function(){this.get_element();E&&(k=E);M&&(l=M);this.render_current_scale()};a.render_current_scale=function(){this.scale_backside(d,
k,l,x,A);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();$(d).find("[title]").each(function(a,b){e.UTILITIES.use_custom_tooltip(b)})};if(e.debugging||e.logging)a.to_debug_string=function(){return"backside of "+this.get_widget().to_debug_string()};d.toontalk_widget_side=a;e.UTILITIES.drag_and_drop(d);h.resizable({start:function(){G=h.width();I=h.height();x||(x=G);A||(A=I)},resize:function(b,c){var d=c.size.width,f=c.size.height;h.is(".toontalk-top-level-backside")||
(k*=d/G,l*=f/I,G=d,I=f,a.render_current_scale())},handles:"e,s,se"});d.addEventListener("mouseenter",function(a){a=b.get_frontside();var c=b.get_parent_of_backside();!a||c&&!c.get_widget().is_top_level()||e.UTILITIES.highlight_element(a.get_element())});d.addEventListener("mouseleave",function(a){b.is_top_level()||e.UTILITIES.remove_highlight()});a.update_display=function(){var b=this.get_description_text_area(),c=this.get_name_text_input(),f;b&&(f=this.get_widget().get_description())&&(b.button.value=
f);c&&(c.button.value=this.get_widget().get_name());this.get_erased()?$(d).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():$(d).find().show();a.display_updated()};a.display_updated=function(){var a=$(this.get_element());x||(x=a.width());A||(A=a.height())};a.add_to_top_level_backside=function(a,b){return this.get_widget().add_to_top_level_backside(a,b)};b.get_backside_widgets&&(D=b.get_backside_widgets(),a.add_backside_widgets(D,
b.get_backside_widgets_json_views()));e.debugging&&(d.id=b._debug_id,a._debug_id=b._debug_id,a._debug_string="backside of "+b._debug_string);return a},toString:function(){return"backside of "+this.get_widget()},get_full_description:function(b){return"backside of "+this.get_widget().get_full_description(b)},remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(b,a){var d=e.UTILITIES.create_check_box(a.get_infinite_stack(),"toontalk-infinite-stack-check-box",
"Copy when dragged.","Check this if you want the "+a.get_type_name()+" to be copied instead of moved.");d.button.addEventListener("click",function(b){var e=d.button.checked,l;a.set_infinite_stack(e);a.robot_in_training()&&(l=e?"change dragging to make a copy of ":"change dragging back to moving for ",a.robot_in_training().edited(a,{setter_name:"set_infinite_stack",argument_1:e,toString:l,button_selector:".toontalk-infinite-stack-check-box"}));b.stopPropagation()});return d},create_click_opens_backside_check_box:function(b,
a){var d=e.UTILITIES.create_check_box(a.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box","Mouse click opens this back side only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors.");d.button.addEventListener("click",function(b){var e=d.button.checked,l;a.set_open_backside_only_if_stopped(e);a.robot_in_training()&&(l=e?"change the response to a mouse click to open only if stopped the backside of ":
"change the response to a mouse click to always open the backside of ",a.robot_in_training().edited(a,{setter_name:"set_open_backside_only_if_stopped",argument_1:e,toString:l,button_selector:".toontalk-click-opens-backside-check-box"}));b.stopPropagation()});return d},create_description_label:function(b,a){var d=a.get_description();if(d)return e.UTILITIES.create_text_element("I'm the back side of a "+a.get_type_name()+" that is "+d)},add_description_setting:function(b){var a=this.get_widget(),d=a.get_type_name(),
h=e.UTILITIES.create_text_area(a.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+d+".",function(b){(b=e.UTILITIES.input_area_drop_handler(b,a.receive_description_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(b,a,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})}),k=function(){var b=h.button.value.trim();a.set_description(b,
!0)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_description",argument_1:b,toString:"change the description to '"+b+"'' of the "+d,button_selector:".toontalk-description-input"})};$(h.button).val(a.get_description());h.button.addEventListener("change",k);h.button.addEventListener("mouseout",k);this.set_description_text_area(h);(b||this.get_backside_element(!0)).appendChild(e.UTILITIES.create_row(h.container));a.get_description()||h.button.setAttribute("placeholder",a.get_default_description())},
add_name_setting:function(b){var a=this.get_widget(),d=a.get_type_name(),h=e.UTILITIES.create_text_input(a.get_name(),"toontalk-name-input",a.get_name_input_label?a.get_name_input_label():"My name is ",a.get_name_input_title?a.get_name_input_title():"Edit the name of this "+d+". There is not much room so keep it short.",void 0,"text",function(b){(b=a.receive_name_from_dropped&&e.UTILITIES.input_area_drop_handler(b,a.receive_name_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(b,
a,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})}),k=function(){var b=h.button.value.trim();a.set_name&&a.set_name(b,!0)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_name",argument_1:b,toString:"change the name to '"+b+"'' of the "+d,button_selector:".toontalk-name-input"})};h.button.addEventListener("change",k);h.button.addEventListener("mouseout",k);this.set_name_text_input(h);(b||this.get_backside_element(!0)).appendChild(e.UTILITIES.create_row(h.container))},
add_advanced_settings:function(){var b=this.get_widget(),a=this.create_infinite_stack_check_box(this,b),d=this.create_click_opens_backside_check_box(this,b),h=b.get_type_name(),k=$("<button>Make a sensor nest</button>").button(),l=$("<button>Make a function bird</button>").button(),c=document.createElement("table"),r=this.get_element(),q=function(a,c){var d=b.get_parent_of_frontside(),f=a.get_frontside_element(!0),g;d&&d.add_backside_widget&&!d.get_widget().is_top_level()?(d.add_backside_widget(a),
g=d.get_element(),g.appendChild(f),d=$(g).offset(),d.top+=.6*$(g).height()):(b.add_to_top_level_backside(a,!1),d=c.offset(),d.left-=120,0>d.left&&(d.left=0));e.UTILITIES.set_absolute_position(f,d)};$(r).find(".toontalk-settings-backside-button").get(0);var g;$(c).addClass("toontalk-advanced-settings-table");k.addClass("toontalk-make-sensor_nest_button");k.get(0).addEventListener("click",function(a){var c=e.sensor.create("click","which",void 0,void 0,!0,b);q(c,k);b.robot_in_training()&&b.robot_in_training().created_widget(c,
b,".toontalk-make-sensor_nest_button");a.stopPropagation()});k.attr("title","Click to create a nest which receives messages when events happen to this "+b.get_type_name()+".");l.addClass("toontalk-make-function_bird_button");l.get(0).addEventListener("click",function(a){var c=b.get_function_type&&b.get_function_type(),c=e.bird.create_function(c||h);q(c,l);b.robot_in_training()&&b.robot_in_training().created_widget(c,b,".toontalk-make-function_bird_button");a.stopPropagation()});b.is_number()||b.is_box()?
l.attr("title","Click to get a bird that flies to functions of "+b.get_type_name(!0)+"."):(l.attr("title","There are no functions that operate on "+b.get_type_name(!0)+" (yet)."),l.button("option","disabled",!0));if(0<arguments.length)for(g=0;g<arguments.length;g++)c.appendChild(arguments[g]);this.get_description_text_area()||this.add_description_setting(c);b.set_name&&!this.get_name_text_input()&&this.add_name_setting(c);c.appendChild(e.UTILITIES.create_row(k.get(0),l.get(0),a.container,d.container));
this.is_primary_backside()||(a=$("<button>Remove me and my widget</button>").button(),a.get(0).addEventListener("click",function(){b.robot_in_training()&&(b.robot_in_training().removed(b),b.robot_in_training().removed(this));this.remove();b.remove()}.bind(this)),a.attr("title","Click to remove this "+b.get_type_name()+" and its backside."),a.addClass("toontalk-remove-backside-and-widget-buttton"),e.UTILITIES.use_custom_tooltip(a.get(0)),c.appendChild(a.get(0)));e.UTILITIES.use_custom_tooltip(k.get(0));
e.UTILITIES.use_custom_tooltip(l.get(0));r.appendChild(c)},get_type_name:function(){return"backside of "+e.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(b){var a,d,h,m,l,c,r;if(this.visible()&&(a=this.get_widget(),d=a.robot_in_training(),m=$(this.get_element()),d&&d.get_training_context()===a&&(d.hide_backside(),m.find(".toontalk-train-backside-button").click()),h=a.get_frontside_element(b&&a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_top_level()),
d=m.position(),l=m.parent().closest(".toontalk-backside"),c=function(c){var d=$(h).position(),l=function(){r&&(this.set_parent_of_backside(void 0,!0),r.is_backside()||r.removed_from_container(this,b,void 0,!0),a.forget_backside&&a.forget_backside());c.remove()}.bind(this);c.is(":visible")?"0"===c.css("opacity")?(c.removeClass("toontalk-animating-element"),c.remove()):(c.addClass("toontalk-side-appearing"),e.UTILITIES.add_one_shot_event_handler(c.get(0),"transitionend",2500,l),e.UTILITIES.set_css(c,
{left:d&&d.left,top:d&&d.top,opacity:.1})):l()}.bind(this),r=a.get_parent_of_backside(),e.UTILITIES.remove_highlight(),k(this),a.backside_geometry=this.get_backside_dimensions(),c(m),this.set_visible(!1),b&&h&&!e.UTILITIES.visible_element(h)&&(d&&e.UTILITIES.set_css(h,{left:d.left,top:d.top}),!(m=e.UTILITIES.widget_side_of_jquery(l))||a.is_robot()&&m.get_widget().is_robot()&&a.get_first_in_team()===m.get_widget().get_first_in_team()||(m.widget_side_dropped_on_me(a),a.render())),a.get_backside_widgets()&&
a.get_backside_widgets().forEach(function(a){a.set_visible(!1)}),a.on_backside_hidden))a.on_backside_hidden()},create_advanced_settings_button:function(b,a){var d=document.createElement("div"),h=$(d),k=!1;d.innerHTML="&gt;";h.addClass("toontalk-settings-backside-button");h.css({"z-index":e.UTILITIES.next_z_index()});h.get(0).addEventListener("click",function(d){k=!k;b.set_advanced_settings_showing(k,b.get_element(),h);d.stopPropagation();a.robot_in_training()&&a.robot_in_training().button_clicked(".toontalk-settings-backside-button",
a)});e.UTILITIES.give_tooltip(h.get(0),"Click to see the advanced settings of this "+a.get_type_name()+".");return h.get(0)},set_advanced_settings_showing:function(b){var a=this.get_element(),d=$(a).children(".toontalk-settings-backside-button"),h=$(a).children(".toontalk-advanced-settings-table");0===h.length&&this.add_advanced_settings&&(this.add_advanced_settings(),h=$(a).children(".toontalk-advanced-settings-table"));b?(h.show(),d.html("<"),e.UTILITIES.give_tooltip(d.get(0),"Click to hide the advanced settings.")):
(h.hide(),d.html(">"),e.UTILITIES.give_tooltip(d.get(0),"Click to show the advanced settings."))},scale_backside:function(b,a,d,h,k){var l=Math.min(1,a,d);1===a&&1===d?!this.get_parent()||this.get_parent().is_backside()?e.UTILITIES.set_css(b,{width:h,height:k,transform:"","transform-origin":""}):e.UTILITIES.set_css(b,{width:"",height:""}):e.UTILITIES.set_css(b,{transform:"scale("+l+", "+l+")","transform-origin":"left top",width:h*a/l,height:k*d/l})},render:function(){e.DISPLAY_UPDATES.pending_update(this)},
rerender:function(){this.visible()&&e.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(b,a){return this.get_widget().remove_backside_widget(b,a)},top_level_widget:function(){return this.get_widget().top_level_widget()},robot_in_training:function(){return this.get_widget().robot_in_training()},remove:function(b){var a;this.is_primary_backside()?this.get_widget().remove():((a=this.get_parent_of_backside())&&(a.is_backside()?a.remove_backside_widget(this,!b):a.removed_from_container&&
(a.is_backside()?a.remove_backside_widget(this,!0):a.removed_from_container(this,b))),this.set_parent_of_backside(void 0),(b=this.get_element())&&$(b).remove())},match:function(b){var a;if(b.is_backside()){if(this.get_erased())return this.get_widget().get_type_name()===b.get_widget().get_type_name()?"matched":this;a=this.get_widget();b=a.match(b.get_widget());return b===a?this:b}b.last_match=this;return b},has_ancestor:function(b){var a;return this===b?!0:(a=this.get_parent_of_backside())?a.has_ancestor(b):
!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},set_parent:function(b){this.set_parent_of_backside(b)},maintain_proportional_dimensions:function(){return!1},set_running:function(){},dereference:function(){return this},is_of_type:function(b){return this.get_widget().is_of_type(b)},is_top_level:function(){return this.get_widget().is_top_level()},is_hole:function(){return!1},
is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},drag_started:function(b,a){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,a)},get_json:function(b,a,d){var h=this.get_backside_dimensions(),m=$(this.get_element()).position(),l;k(this);l=h?
{width:h.original_width,height:h.original_height,transform:"scale("+h.x_scale+", "+h.y_scale+")","transform-origin":"left top 0px",left:m.left,top:m.top}:m;h=function(b,d){a({type:"backside",my_widget:b,css:l,erased:this.get_erased(),view:{}},d)}.bind(this);e.UTILITIES.get_json(this.get_widget(),b,h,d)}}}(window.TOONTALK);
TOONTALK.creators_from_json.backside=function(e,k){var b=TOONTALK.UTILITIES.create_from_json(e.my_widget,k).create_backside(),a=b.get_element();TOONTALK.UTILITIES.set_css(a,e.css);e.erased&&b.set_erased(e.erased);return b};window.TOONTALK.frontside=function(e){return{create:function(k){var b=Object.create(this),a=document.createElement("div"),d=$(a),h=function(a){$(a.target).is(".ui-resizable-handle")||"click"===a.type&&1!==a.which||k.get_open_backside_only_if_stopped()&&k.get_running()||(d.is(".toontalk-top-level-resource")?k.set_running(!k.get_running()):(k.open_backside(),k.robot_in_training()&&k.robot_in_training().backside_opened(k)),a.stopPropagation())},m;$(a).addClass("toontalk-frontside toontalk-side");k.get_infinite_stack()&&
$(a).addClass("toontalk-infinite-stack");a.toontalk_widget_side=k;e.UTILITIES.drag_and_drop(a);b.get_element=function(){return a};b.get_widget=function(){return k};b.visible=function(){return m};b.set_visible=function(a){var b=this.get_widget();m=a;b.walk_children&&b.walk_children(function(b){b.set_visible(a);return!0});a&&e.UTILITIES.when_attached(this.get_element(!0),b.render.bind(b))};a.addEventListener("click",h);a.addEventListener("touchstart",h);a.addEventListener("mouseenter",function(a){var b=
k.get_backside(),d=(k.is_empty_hole()?wiget.get_parent_of_frontside():k).get_frontside_element();b&&e.UTILITIES.highlight_element(b.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");$(d).is(".toontalk-top-level-resource")||$(d).addClass("toontalk-wiggle");a.stopPropagation()});a.addEventListener("mouseleave",function(a){a=k.get_backside();var b=k.is_empty_hole()?wiget.get_parent_of_frontside():k;a&&e.UTILITIES.remove_highlight();$(b.get_frontside_element()).removeClass("toontalk-wiggle")});
e.debugging&&(a.id=k._debug_id);return b},update_display:function(){return this.get_widget().update_display()},remove:function(){var e=this.get_element();$(e).remove();e.toontalk_widget_side=null}}}(window.TOONTALK);(function(e){var k=180/Math.PI,b=Math.log(10),a=bigrat.fromInteger(10),d=bigrat.fromValues(1,2),h=bigrat.fromValues(-1,2),m=bigrat.fromInteger(360),l=bigrat.fromDecimal(2*Math.PI),c=Math.log10?Math.log10:function(a){return Math.log(a)/b},r=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},q=function(a){var b=r(a),c=e.number.ZERO(e.number.function_bird_results_default_format),d=e.number.ZERO(e.number.function_bird_results_default_format);
c.set_value(b.integer_part);d.set_value(b.fractional_part);return e.box.create(2,!0,[c,d],"The integer and fraction parts of "+a.toString().replace(",","/"))},g=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),d=r(c);return bigrat.multiply(c,d.fractional_part,b)},n=function(a){a=r(a);return bigrat.isLessThan(a.fractional_part,h)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.isLessThan(a.fractional_part,d)?a.integer_part:bigrat.add(a.integer_part,
a.integer_part,bigrat.ONE)},t=function(a){a=r(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},u=function(a){a=r(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var b=Object.create(e.widget),d=function(a,b,c,d){var f="",g=100;c=50/c;b/=1+b;if(d)for(d=0;g>=c&&
d<a.length;)f=f+"<span class='toontalk-digit' style='font-size:"+g+"%'>"+a[d]+"</span>",d+=1,"-"!==a[d]&&(g*=b);else for(d=a.length-1;g>=c&&0<d;)f="<span class='toontalk-digit' style='font-size:"+g+"%'>"+a[d]+"</span>"+f,--d,"-"!==a[d]&&(g*=b);return f},g=function(a,b){var c=a/(1+a);return Math.ceil(Math.log(.5/b)/Math.log(c))},h=function(a,b,c){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+
h(a,1.25*b,.8*c)+"</span>";b=b/2-1;return d(a,b,c,!0)+d(a,b,c,!1)},l=function(b,c){bigrat.isNegative(b)&&bigrat.abs(b,b);var d;a:{d=bigrat.fromValues(b[0],1);var f=bigrat.fromValues(b[1],1),g="",h=bigrat.create(),e=bigrat.create(),l=bigrat.create();for(bigrat.multiply(d,d,a);c>g.length;){if(bigrat.isLessThan(d,f))g+="0";else if(bigrat.divide(h,d,f),e=bigrat.toBigInteger(h),g+=e.toString(),bigrat.subtract(l,h,bigrat.fromValues(e,1)),bigrat.multiply(d,l,f),bigrat.equals(d,bigrat.ZERO)){d=g=k(g);break a}bigrat.multiply(d,
d,a)}d=g}return d},k=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?k(a.substring(0,a.length-1)):a},n=function(a,b){var c=Math.min(b,a/2);return a-(c+1)},m=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},t=function(a){switch(a){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return e.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}};b.default_format="mixed_number";b.function_bird_results_default_format="decimal";b.create=function(a,c,d,g,h,l){var p=Object.create(b),k=m(a,c);d||(d="+");p.is_number=function(){return!0};p.set_value=function(a,b){if(b||
!bigrat.equals(k,a))return this.fire_value_change_listeners(k,a),k=a,this.rerender(),e.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&e.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),this};p.set_value_from_sub_classes=p.set_value;p.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),d;c&&(d={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(d)}))};
p.get_value=function(){return k};p.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));e.debugging&&"0,0"===this.get_value().toString()&&e.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};p.copy=function(a){return this.add_to_copy(b.create(k[0],k[1],d,g,h,l),a)};p.get_format=function(){return g||b.default_format};p.set_format=function(a,b){g=a;b&&this.rerender();return this};p.get_operator=function(){return d};p.set_operator=function(a,b){d=a;b&&this.rerender();
return this};p.get_approximate=function(){return l};p.set_approximate=function(a,b){l=a;b&&this.rerender();return this};b.add_standard_widget_functionality(p);p.set_description(h);e.debugging&&(p._debug_string=p.toString(),p._debug_id=e.UTILITIES.generate_unique_id(),k._debug_id_new=p._debug_id);return p};b.create_from_bigrat=function(a){var b=e.number.ZERO();b.set_value(a);return b};b.create_backside=function(){return e.number_backside.create(this)};b.set_from_values=function(a,b){return this.set_value(m(a,
b))};b.set_numerator=function(a){return this.set_value(m(a,this.get_value()[1].toString()))};b.set_denominator=function(a){return this.set_value(m(this.get_value()[0].toString(),a))};b.ONE=function(){return e.number.create(1)};b.ZERO=function(a){return e.number.create(0,void 0,void 0,a)};b.equals=function(a){return a.equals_number&&a.equals_number(this)};b.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};b.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};
b.compare_with_number=function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};b.update_display=function(){var a=this.get_frontside(!0),b=28,c,d,f,g,h,l;e.logging&&0<=e.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());a=a.get_element();$(a).is(".toontalk-conditions-contents")?c=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json")?(c=$(a),h=!0):$(a).parent().is(".toontalk-element-frontside")?
(c=$(a),g=h=!0):c=$(a).parent().is(".toontalk-scale-half")?$(a):$(a).parent();0===c.length&&(l=this.get_parent_of_frontside())&&(l.get_widget().is_hole()&&(l=l.get_parent_of_frontside()),c=$(l.get_frontside_element()));if($(a).is(".toontalk-carried-by-bird"))f=d=100;else if($(a).is(".toontalk-held-by-robot"))d=76,f=55;else if($(a).is(".toontalk-element-attribute"))d=200,f=32;else if(h&&(a===c.get(0)||c.is(".toontalk-top-level-resource")))d=$(a).width(),f=$(a).height(),d&&f||(d=this.saved_width||76,
f=this.saved_heieght||55,$(a).css({width:d,height:f}));else{if(!e.UTILITIES.visible_element(c.get(0))){e.logging&&0<=e.logging.indexOf("display")&&console.log("Container not visible so no display of "+this.to_debug_string());return}d=c.width();f=c.height();if(0===d||0===f){e.logging&&0<=e.logging.indexOf("display")&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());e.UTILITIES.is_attached(a)||e.UTILITIES.when_attached(a,this.update_display.bind(this));return}c.is(".toontalk-nest")&&
(d*=e.nest.CONTENTS_WIDTH_FACTOR,f*=e.nest.CONTENTS_HEIGHT_FACTOR)}l=$(a).children(".toontalk-widget");l.is("*")?l=l.get(0):(l=document.createElement("div"),a.appendChild(l));$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");b=this.get_border_size(d,f);g||(4===b?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):8===b?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):
16===b?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number"));g=f-2*b;h=this.to_HTML(d/(.64*g),g,this.get_format(),!0,this.get_operator(),h);e.UTILITIES.on_a_nest_in_a_box(a)&&(d="width:"+d+"px;",g=h.indexOf('style="'),h=0<=g?h.substring(0,g+7)+d+h.substring(g+7):h);l.innerHTML=h;l.translate=!1;$(l).addClass("toontalk-widget notranslate");c.is(".toontalk-box-hole")&&$(a).css({width:"",height:""});e.UTILITIES.give_tooltip(a,
this.get_title())};b.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};b.to_HTML=function(b,f,k,m,q,r){var p,v,w,F,u,S,y=!1!==m?" toontalk-top-level-number":"";u=4;this.is_attribute_widget&&this.is_attribute_widget()?y+=" toontalk-attribute-number":this.get_approximate()&&(y+=" toontalk-approximate-number");r&&(y+=" toontalk-number-size-unconstrained-by-container");w=q?t(q):"";b||(b=4);f||(f=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+
y+'" style="font-size: '+f+'px;"></div>';0<w.length&&(--b,2>b&&(f*=Math.max(1,b)/2,b=2));if(this.is_integer()&&"scientific_notation"!==k){try{p=bigrat.toBigInteger(this.get_value()).toString()}catch(T){e.UTILITIES.report_internal_error("Error converting number to a string: "+T),p="0"}m=p.length;0<w.length&&m++;4>b&&m>b&&(k=Math.min(4,m),f*=b/k,b=k);return'<div class="toontalk-number toontalk-integer'+y+'" style="font-size: '+f+'px;">'+w+h(p,b,f)+"</div>"}if(this.get_approximate()||this.is_attribute_widget())if("decimal"===
k?v=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===k&&(v=bigrat.toDecimal(this.get_value()).toExponential(),p=v.indexOf("e"),0<=p&&(F=v.substring(p+1),v=v.substring(0,p))),v)return m=v.length,0<w.length&&m++,F&&(b-=3+F.length/2),"scientific_notation"===k&&(u+=2),b<u&&m>b&&(k=Math.min(u,m),f=0>=b?f*(Math.max(1,b)/k):f*(Math.max(2,b)/k),b=k),F=F?'&times;10<sup style="font-size: '+f/2+'px;">'+F+"</sup>":"",'<div class="toontalk-number toontalk-approximate-number'+y+'" style="font-size: '+
f+'px;">'+w+d(v,b,f,!0)+F+"</div>";v=' style="font-size:'+.4*f+'px;"';if("improper_fraction"===k||!k)return f='<table class="toontalk-number toontalk-improper-fraction'+y+'"'+v+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+h(this.numerator_string(),2*b,f)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+
h(this.denominator_string(),2*b,f)+"</td></tr></table>",""===w?f:"<table class='toontalk-operator-and-fraction'"+v+"><tr><td>"+w+"</td><td>"+f+"</td></tr></table>";if("mixed_number"===k||"proper_fraction"===k){w=this.integer_part();if(w.is_zero())return this.to_HTML(b,f,"improper_fraction",m,q);F=this.copy({just_value:!0}).subtract(w).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+y+'"'+v+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+w.to_HTML(b/
2,f,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+F.to_HTML(b/2,f,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===k)return 4>b&&(f*=Math.max(1,b)/4,b=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+y+'" style="font-size: '+f+'px;">'+w+this.decimal_string(b,f)+"</div>";if("scientific_notation"===k){p=bigrat.isNegative(this.get_value());F=this.get_value();u=bigrat.abs(bigrat.create(),F);F=bigrat.isLessThan(u,
bigrat.ONE);u=(F?bigrat.toBigInteger(bigrat.divide(bigrat.create(),bigrat.ONE,u)):bigrat.toBigInteger(u)).toString();F=F?-u.length:u.length-1;u=bigrat.power(bigrat.create(),a,F+1);S=bigrat.divide(bigrat.create(),this.get_value(),u);u=6+(0===F?1:Math.ceil(c(Math.abs(F)))/2);p&&u++;if(b<u+1)return this.to_HTML(u+1,f*b/(u+1),k,m,q,r);k=g(n(b,u),f);k=l(S,k);m=p?"-"+k.substring(0,1):k.substring(0,1);k=k.substring(1);b=d(k,b*(1-u/b),f,!0);0<b.length&&(b="<span class='toontalk-decimal-point'>.</span>"+b);
return'<table class="toontalk-number toontalk-scientific_notation'+y+'"'+v+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+y+'" style="font-size: '+.9*f+'px;">'+w+m+b+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+f+'px;"> &times;10<sup style="font-size: '+f/2+'px;">'+F+"</sup></div></td></tr></table>"}};b.get_default_description=function(){return this.get_approximate()?
"a number from an approximate calculation.":"a number."};b.drop_on=function(a,b,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b,c),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c);console.log("No handler for drop of '"+this+"' on '"+a+"'")};b.number_dropped_on_me=function(a,b,c){var d,f,g,h,l;if(!a.is_backside()){if(a.visible()&&this.visible()&&(b||c)){if(c){if(!c.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(a,b,c);a.robot_waiting_before_next_step=
c}d=document.createElement("div");$(d).addClass("toontalk-bammer-down");f=$(this.get_frontside_element()).closest(".toontalk-top-level-backside");d.style.left="-10px";d.style.top=f.height()+"px";0<f.length&&f.get(0).appendChild(d);h=this.get_frontside_element();g=$(h).offset();g.left-=.75*$(d).width();g.left+=.5*$(h).width()+.1*$(d).width();g.top-=.5*$(h).height()+.4*$(d).height();h=function(){e.sounds&&e.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,b,c)&&c&&c.run_next_step();
b&&this.backup_all();$(d).removeClass("toontalk-bammer-down");e.UTILITIES.set_timeout(function(){var a=f.offset();a||(a={left:0,top:0});$(d).addClass("toontalk-bammer-away");g.left=a.left+f.width()-100;g.top=a.top+f.height()+100;l=function(){$(d).remove()};e.UTILITIES.animate_to_absolute_position(d,g,l,c&&c.transform_animation_speed(e.UTILITIES.default_animation_speed));$(d).css({opacity:.01})})}.bind(this);e.UTILITIES.animate_to_absolute_position(d,g,h,c&&c.transform_animation_speed(e.UTILITIES.default_animation_speed));
$(d).css({opacity:1,"z-index":e.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,b,c)}};b.number_dropped_on_me_semantics=function(a,b,c){b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove();switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "=":return this.set_value(a.get_value());
case "^":return this.power(a);default:e.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};b.widget_side_dropped_on_me=function(a,b,c){return a.number_dropped_on_me?this.number_dropped_on_me(a,b,c):!1};b.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),
this.get_value(),a.get_value()),!0);return this};b.divide=function(a){this.set_value(bigrat.divide(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),
!0);return this};b.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};b.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};b.is_negative=function(){return bigrat.isNegative(this.get_value())};b.toString=function(){return this.get_erased()?"erased number":("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};b.operator_word=function(a){switch(this.get_operator()){case "+":return"add "+a+" to";case "-":return"subtract "+
a+" from";case "*":return"multiply "+a+" with";case "/":return"divide "+a+" into"}};b.get_text=function(){return this.is_integer()||"improper_fraction"===this.get_format()?this.toString():bigrat.toDecimal(this.get_value()).toString()};b.to_float=function(){return bigrat.toDecimal(this.get_value())};b.get_type_name=function(a){return a?"numbers":"number"};b.get_help_URL=function(){return"docs/manual/numbers.html"};b.get_json=function(a,b,c){b({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),
denominator:this.denominator_string(),format:this.get_format(),approximate:this.get_approximate()},c)};e.creators_from_json.number=function(a){return b.create(a.numerator,a.denominator,a.operator,a.format,a.description,a.approximate)};b.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};b.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};b.denominator=function(){var a=bigrat.create();
return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};b.numerator_string=function(){return this.get_value()[0].toString()};b.denominator_string=function(){return this.get_value()[1].toString()};b.integer_part=function(){return this.create(this)};b.decimal_string=function(a,c){var e,k,m,t,p;if(this.is_integer())return this.numerator_string();e=this.get_value();k=b.create(e[0],e[1]);m=k.integer_part();e=m.toString();"0"===e&&this.is_negative()&&(e="-"+e);k=k.get_value();bigrat.subtract(k,k,m.get_value());
t=n(a,e.length);p=g(t,c);m=Math.min(e.length,a/2);k=l(k,p);k=k.length<t?k:d(k,t,c,!0);return h(e,m,c)+"<span class='toontalk-decimal-point'>.</span>"+k};b.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_number)return a.match_with_any_number();this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};b.match_with_any_number=function(){return"matched"};b.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===
this.get_operator())return"matched";a.last_match=this;return a};b.get_custom_title_prefix=function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"Drop me on another number and I'll "+this.operator_word("myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+e.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return b}();window.TOONTALK.number_backside=function(){return{create:function(a){var b=
e.backside.create(a),c=b.get_element(),d=document.createElement("div"),g=a.numerator_string(),h=a.denominator_string(),l=e.UTILITIES.create_text_area(g,"toontalk-numerator-input","","Type here to edit the numerator",void 0,"number"),k=e.UTILITIES.create_text_area(h,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),m=e.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal.",!0),n=e.UTILITIES.create_radio_button("number_format",
"proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction.",!0),t=e.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction.",!0),q=e.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",
!0),u=e.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",!0),r=e.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",!0),N=e.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),p=e.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","Divide me into what I'm dropped on.",
!0),v=e.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",!0),w=function(b){var c=l.button.value.trim(),d=k.button.value.trim(),p=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:p(a,b).replacement};a=p(a.substring(1,a.length),b,!0);a.message||(a.replacement=
"-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,"")}},m;if(c!==g||d!==h)m=p(c,"numerator"),m.message&&(e.UTILITIES.display_message(m.message),c=m.replacement),"0"===d?(e.UTILITIES.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1."),d="1"):(m=p(d,"denominator"),m.message&&(e.UTILITIES.display_message(m.message),d=m.replacement)),
a.set_from_values(c,d)&&(g=c,h=d,a.robot_in_training()&&(b=b.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:"set_denominator",argument_1:d,toString:"by changing the value of the denominator to "+d,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:"set_numerator",argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+b})),a.rerender())},F=function(){var b=e.UTILITIES.selected_radio_button(m.button,
n.button,t.button,q.button),c=b.value;a.set_format(c,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_format",argument_1:c,toString:"by changing the format to "+c+" of the number",button_selector:"."+b.className.split(" ",1)[0]});a.rerender()},R=function(){var b=e.UTILITIES.selected_radio_button(u.button,r.button,N.button,p.button,v.button),c=b.value;a.set_operator(c,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_operator",argument_1:c,toString:"by changing the operator to "+
c+" of the number",button_selector:"."+b.className.split(" ",1)[0]})},S=e.UTILITIES.create_horizontal_table(l.container,d,k.container),y=e.UTILITIES.create_horizontal_table(m.container,n.container,t.container,q.container),T=e.UTILITIES.create_horizontal_table(u.container,r.container,N.container,p.container,v.container),ia=e.backside.create_advanced_settings_button(b,a),Z=b.update_display.bind(b),aa=b.add_advanced_settings;d.innerHTML="/";$(d).addClass("ui-widget");l.button.addEventListener("change",
w);l.button.addEventListener("mouseout",w);l.button.addEventListener("mouseenter",function(){g=l.button.value.trim()});k.button.addEventListener("change",w);k.button.addEventListener("mouseout",w);k.button.addEventListener("mouseenter",function(){h=k.button.value.trim()});c.appendChild(S);c.appendChild(ia);m.button.addEventListener("change",F);n.button.addEventListener("change",F);t.button.addEventListener("change",F);q.button.addEventListener("change",F);switch(a.get_format()){case "decimal":e.UTILITIES.check_radio_button(m);
break;case "improper_fraction":e.UTILITIES.check_radio_button(t);break;case "mixed_number":case "proper_fraction":e.UTILITIES.check_radio_button(n);break;case "scientific_format":e.UTILITIES.check_radio_button(q)}switch(a.get_operator()){case "+":e.UTILITIES.check_radio_button(u);break;case "-":e.UTILITIES.check_radio_button(r);break;case "*":e.UTILITIES.check_radio_button(N);break;case "/":e.UTILITIES.check_radio_button(p);break;case "=":e.UTILITIES.check_radio_button(v)}u.button.addEventListener("change",
R);r.button.addEventListener("change",R);N.button.addEventListener("change",R);p.button.addEventListener("change",R);v.button.addEventListener("change",R);b.update_display=function(){$(l.button).val(a.numerator_string());$(k.button).val(a.denominator_string());Z()};b.add_advanced_settings=function(){aa.call(b,y,T);$(y).buttonset();$(T).buttonset()};e.UTILITIES.when_attached(c,function(){b.is_primary_backside()||a.add_listener("value_changed",function(){b.rerender()})});return b}}}();window.TOONTALK.number.function=
function(){var a=e.create_function_table(),b=function(a){return bigrat.toDecimal(g(a,m))},c=function(a){return bigrat.toDecimal(g(a,l))};a.add_function_object("sum",function(b,c,d){return a.n_ary_widget_function(b,e.number.ZERO,e.number.add,"sum",c,d)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",function(b,c,d){return a.n_ary_widget_function(b,e.number.ZERO,e.number.subtract,"difference",c,d)},"The bird will return with the result of subtracting the numbers in the box from the first number.",
"-");a.add_function_object("product",function(b,c,d){return a.n_ary_widget_function(b,e.number.ONE,e.number.multiply,"product",c,d)},"The bird will return with the product of the numbers in the box.","\u00d7");a.add_function_object("division",function(b,c,d){return a.n_ary_widget_function(b,e.number.ONE,e.number.divide,"division",c,d)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00f7");a.add_function_object("modulo",function(b,c,d){return a.n_ary_function(b,
a.bigrat_function_to_widget_function(g),2,"modulo",c,d)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(b,c,d){return a.n_ary_widget_function(b,e.number.ONE,e.number.minimum,"minimum",c,d)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(b,c,d){return a.n_ary_widget_function(b,e.number.ONE,e.number.maximum,
"maximum",c,d)},"The bird will return with the largest of the numbers in the box.","max");a.add_function_object("absolute value",function(b,c,d){return a.n_ary_function(b,function(a){var c=e.number.ZERO(b.get_hole_contents(1).get_format());bigrat.abs(c.get_value(),a);return c},1,"absolute value",c,d)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(function(a,b){var c=
bigrat.power(bigrat.create(),a,b[0].valueOf()),d=b[1].valueOf();return 1===d?c:bigrat.nthRoot(c,c,d)},!0),2,"power",c,d)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},!0),1,"logarithm",c,d)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).",
"log");a.add_function_object("random",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c,d)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.",
"rand");a.add_function_object("round",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(n),1,"round",c,d)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(t),1,"floor",c,d)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(u),
1,"ceiling",c,d)},"The bird will return the smallest integer greater than or equal to the number.","ceil");a.add_function_object("delay",function(b,c,d){var g=Date.now(),h=a.check_message(b),l;if(h)if(2>h.size)e.UTILITIES.display_message("Delay function birds need a number in the second hole.");else return l=b.get_hole_contents(1).to_float(),setTimeout(function(){var l=e.number.ZERO(e.number.function_bird_results_default_format);l.set_value_from_decimal((Date.now()-g)/1E3);l.set_approximate(!0);a.process_response(l,
h.bird,b,c,d)},1E3*l),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");a.add_function_object("integer and fraction parts",function(b,c,d){return a.n_ary_function(b,q,1,"integer and fraction parts",c,d)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(c,d,g){return a.n_ary_function(c,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/
k)},!0,b),1,"sine",d,g)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",function(c,d,g){return a.n_ary_function(c,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/k)},!0,b),1,"cosine",d,g)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return k*
Math.atan(a)},!0),1,"arc tangent",c,d)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.","atan");a.add_function_object("arc tangent of y and x",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return k*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c,d)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.",
"atan2");a.add_function_object("sine (in radians)",function(b,d,g){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,!0,c),1,"sine (in radians)",d,g)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,d,g){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,c),1,"cosine (in radians)",d,g)},"The bird will return with an approximation of the cosine of the number (in radians).",
"cos rad");a.add_function_object("arc tangent (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,!0),1,"arc tangent (in radians)",c,d)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",
c,d)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.","atan2 rad");return a.get_function_table()}()})(window.TOONTALK);(function(e){var k=function(b,a,d,h){var k;b&&0<=d&&b.maintain_proportional_dimensions()&&b.get_default_width?(k=b.get_default_width(),b=b.get_default_height(),d/k>=h/b?(k=k*h/b,d={left:(d-k)/2,top:0,width:k,height:h}):(k=b*d/k,d={left:0,top:(h-k)/2,width:d,height:k})):(b.is_backside()&&(b.update_display(),b.scale_to(d,.92*h)),d={left:0,top:0});e.UTILITIES.set_css(a,d)};window.TOONTALK.box=function(b){var a=Object.create(b.widget);a.create=function(d,h,e,l,c){var r=Object.create(a),q=[];"undefined"===
typeof h&&(h=!0);r.is_box=function(){return!0};r.get_horizontal=function(){return h};r.set_horizontal=function(a,b){h=a;b&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());return this};r.get_hole=function(a){return q[a]};r.get_hole_contents=function(a){return q[a].get_contents()};r.set_hole=function(a,c,d){var h;q[a].set_contents(c);if(d){c&&c.save_dimensions();d=this.get_frontside_element();a=$(d).children(".toontalk-hole-number-"+a);a.empty();if(!c)return;h=
this.get_hole_dimensions();d=c.get_element(!0);0<a.length&&a.get(0).appendChild(d);k(c,d,h.width,h.height);c.rerender()}this.rerender();b.debugging&&(this._debug_string=this.to_debug_string())};r.get_holes=function(){return q};r.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=
void 0}.bind(this)};r.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};r.set_contents=function(a){a.forEach(function(a,b){q[b].set_contents(a)})};r.get_size=function(){return d};r.set_size=function(a,c){var h,e;if(d===a||0>a||isNaN(a))return!1;e=this.visible();q.length=a;if(a>d)for(h=d;h<a;h++)q[h]=b.box_hole.create(h),q[h].set_parent_of_frontside(r),q[h].set_visible(e);d=a;c&&this.rerender();b.debugging&&(this._debug_string=
this.to_debug_string());return!0};r.get_hole_dimensions=function(){var a=this.get_frontside_element(),c=$(a).width()||b.box.get_default_width(),a=$(a).height()||b.box.get_default_height();return h?{width:c/d,height:a}:{width:c,height:a/d}};r.receive_size_from_dropped=function(a,c){var d;if(a.is_number())return d=b.number.create(this.get_size()),d.number_dropped_on_me_semantics(a),d=Math.max(0,Math.round(d.to_float())),this.set_size(d),d.toString()};r.copy=function(b){var c;b||(b={});c=q.map(function(a){if(a=
a.get_contents())return a.copy(b)});c=a.create(d,h,c,this.get_description(),this.get_name());return this.add_to_copy(c,b)};r.generate_name=function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};r.add_standard_widget_functionality(r);r.has_name(r);r.set_name(c);for(c=0;c<d;c++)q[c]=b.box_hole.create(c),q[c].set_parent_of_frontside(r);r.set_description(l);e&&r.set_contents(e);b.debugging&&(r._debug_id=b.UTILITIES.generate_unique_id(),r._debug_string=r.to_debug_string());return r};a.create_backside=
function(){return b.box_backside.create(this)};a.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&a.equals_box(this)};a.equals_box=function(a){var b=this.get_size(),e,l,c;if(b!==a.get_size())return!1;for(e=0;e<b;e++)if(l=this.get_hole_contents(e),c=a.get_hole_contents(e),!l&&c||l&&!c||l&&c&&(!l.equals||!l.equals(c)))return!1;return!0};a.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};a.compare_with_box=function(a){var b=this.get_size(),
e=a.get_size(),l,c;if(b>e)return 1;if(b<e)return-1;for(e=0;e<b;e++){l=this.get_hole_contents(e);c=a.get_hole_contents(e);if(l&&!c)return 1;if(!l&&c)return-1;if(l&&c)if(l.compare_with){if(l=l.compare_with(c),1===l||-1===l)return l}else return}return 0};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_box)return a.match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=a,this)};a.match_with_any_box=function(){return"matched"};
a.match_with_this_box=function(a){var h=this.get_size(),e=[],l,c,k;if(h!==a.get_size())return a.last_match=this,a;for(l=0;l<h;l++)if(k=a.get_hole_contents(l))if(c=this.get_hole_contents(l)){c=b.UTILITIES.match(k,c);if(c.is_widget)return c;"matched"!==c&&(e=0===e.length?c:e.concat(c))}else if(c=this.get_contents_temporarily_removed(l))e.push(c);else return a.last_match=this,a;return 0<e.length?e:"matched"};a.toString=function(a){var b="",e=this.get_size(),l,c,k=this.get_type_name()+" that looks like ";
for(l=0;l<e;l++)c=this.get_hole(l),b+=c.get_full_description(a),l<e-1&&(b+=" | ");return k+"["+b.replace(k,"")+"]"};a.get_type_name=function(a){return a?"boxes":"box"};a.get_default_description=function(){return"a box for holding things."};a.get_help_URL=function(){return"docs/manual/boxes.html"};a.get_json=function(a,h,e){var l=[],c=function(e,k){var g,m;e>=this.get_size()?h({type:"box",size:this.get_size(),contents:l,horizontal:this.get_horizontal(),name:this.get_name()},k):(g=this.get_hole_contents(e))?
g.is_primary_backside&&g.is_primary_backside()?(m=function(a,b){l.push(a);c(e+1,b)}.bind(this),b.UTILITIES.get_json(g.get_widget(),a,m,k)):g.is_widget?(m=function(a,b){l.push(a);c(e+1,b)}.bind(this),b.UTILITIES.get_json(g,a,m,k)):(m=function(a,b){l.push(a);c(e+1,b)}.bind(this),g.get_json(a,m,k)):(l.push(null),c(e+1,k))}.bind(this);c(0,e)};a.walk_children=function(a){var b=this.get_size(),e;for(e=0;e<b&&a(this.get_hole(e));e++);};b.creators_from_json.box=function(d,h){return a.create(d.size,d.horizontal,
b.UTILITIES.create_array_from_json(d.contents,h),d.description,d.name)};a.update_display=function(){var a=this.get_frontside(!0).get_element(),h=this.get_size(),e=function(a,c,d){var g=c.get_contents(),e=(g||c).get_element(!0),m=$(a).parents(".toontalk-box-hole"),t=function(){$(a).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(C/=b.nest.CONTENTS_WIDTH_FACTOR,L/=b.nest.CONTENTS_HEIGHT_FACTOR)},q,J,C,L;l?(J=0,0<m.length?(C=n-2*x/h,L=u-2*x):(C=n,L=u),t(),q=C*d,1<d&&(q+=x*(d-1))):
(q=0,0<m.length?(C=n-2*x,L=u-2*x/h):(C=n,L=u),t(),J=L*d,1<d&&(J+=x*(d-1)));b.UTILITIES.set_css(a,{left:q,top:J,width:C,height:L});r[d]&&a.setAttribute("toontalk_name",r[d]);!b.UTILITIES.has_animating_image(e)&&0<d&&($(a).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(a).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),
l?$(a).addClass(f+"-left"):$(a).addClass(f+"-top"));a!==e&&(k(g,e,C,L),a.appendChild(e),c.get_contents().rerender());c.is_element()&&(c=c.get_contents(),c.set_size_attributes(C,L,!0))},l=this.get_horizontal();$(a).is(".toontalk-box");var c=function(){var c=$(a).children(".toontalk-box-hole");c.length===h?c.each(function(a,b){var c=this.get_hole(a);c&&e(b,c,a)}.bind(this)):(c.remove(),this.get_holes().forEach(function(b,c){q=b.get_element();$(q).addClass("toontalk-hole-number-"+c);e(q,b,c);a.appendChild(q)}));
$(a).parent(".toontalk-conditions-contents-container").is("*")||($(a).parent(".toontalk-box-hole").is("*")?b.UTILITIES.set_css(a,{width:"",height:""}):b.UTILITIES.set_css(a,{width:g,height:t}))}.bind(this),r=this.get_name().split(";"),q,g,n,t,u,f,x;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(a).addClass("toontalk-box");$(a).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");
b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string());this.get_erased()?($(a).addClass("toontalk-box-erased"),$(a).children(".toontalk-side").remove()):($(a).removeClass("toontalk-box-erased"),g=0===h?0:$(a).width()||b.box.get_default_width(),t=$(a).height()||b.box.get_default_height(),l?(n=0===h?0:g/h,u=t):(n=g,u=t/h),x=this.get_border_size(n,u),f=4===x?"toontalk-box-eighth-size-border":8===x?"toontalk-box-quarter-size-border":16===x?"toontalk-box-half-size-border":
"toontalk-box-full-size-border",l?n-=(h-1)*x/h:u-=(h-1)*x/h,$(a).addClass(f),b.UTILITIES.set_timeout(c))};a.get_default_width=function(){return 164};a.get_default_height=function(){return 68};a.get_border_size=function(a,b){var e;if(0===a)return e=$(this.get_frontside_element()).width(),16>=e?4:32>=e?8:64>=e?16:32;a||(a=$(this.get_frontside_element()).width());b||(b=$(this.get_frontside_element()).height());return 32>=a||32>=b?4:64>=a||64>=b?8:128>=a||128>=b?16:32};a.get_name_input_label=function(){return"The labels of my holes are"};
a.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};a.drop_on=function(a,b,e){if(a.box_dropped_on_me)return e=a.box_dropped_on_me&&a.box_dropped_on_me(this,b,e),b&&a.rerender(),e&&this.remove(),e;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,e);console.log("No handler for drop of "+this+" on "+a)};a.box_dropped_on_me=function(a,b){console.log("box on box not yet implemented");return!1};a.widget_side_dropped_on_me=
function(a,e,k){var l=this.which_hole(e),c;if(0<=l)return c=this.get_hole(l),(l=c.get_contents())?a.drop_on(l,e,k):c.widget_side_dropped_on_me(a,e,k);b.UTILITIES.report_internal_error(a+" dropped on "+this+" but no event was provided.")};a.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};a.removed_from_container=function(a,b){var e=!!b,l=this.get_index_of(a);0<=l&&(this.set_hole(l,void 0,e),e&&(this.rerender(),
a.restore_dimensions()))};a.get_path_to=function(a,e){var k=this.get_size(),l,c;if("empty hole"===a.get_type_name()){k=a.get_parent_of_frontside();c=b.box.path.create(a.get_index());if(k===this)return c;k=this.get_path_to(k);if(!k)return;k.next=c;return k}for(l=0;l<k;l++)if(c=this.get_hole_contents(l)||this.get_contents_temporarily_removed(l)){if(a===c||c.top_contents_is&&c.top_contents_is(a))return b.box.path.create(l);if(c.get_path_to&&(c=c.get_path_to(a,e)))return k=b.box.path.create(l),k.next=
c,k}};a.element_to_highlight=function(a){a=this.which_hole(a,!0);var b;if(0>a||0===this.get_size())return this.get_frontside_element();a=this.get_hole(a);return(b=a.get_contents())?b.get_frontside_element():a.get_frontside_element()};a.which_hole=function(a){var b=this.get_horizontal(),e=this.get_frontside_element(),l=this.get_size(),c,k;if(0!==l&&(c=$(e).offset(),e=b?$(e).width()/l:$(e).height()/l,k=b?c.left:c.top,a))for(c=0;c<l;c++)if(k+=e,(b?a.pageX<=k:a.pageY<=k)||c+1===l)return c};a.dereference_path=
function(a,e){var k,l;if(a){k=a.get_index&&a.get_index();if(!b.debugging||"number"===typeof k){if(l=this.get_hole_contents(k)){if(l.dereference_contents&&!a.not_to_be_dereferenced)return l.dereference_contents(a.next||a,e);if(a.next){if(l.dereference_path)return l.dereference_path(a.next,e);b.UTILITIES.report_internal_error("Expected to refer to a part of "+l+" but it lacks a method to obtain "+b.path.toString(a.next))}a.removing_widget&&("empty hole"===l.get_type_name()?b.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):
l.get_infinite_stack()||e.remove_from_container(l,this));return l}return this.get_hole(k)}b.UTILITIES.report_internal_error(this+" unable to dereference the path: "+b.path.toString(a))}else return this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"scale"===this.true_type?0===a?"the left pan ":"the right pan ":"the "+b.UTILITIES.ordinal(a)+" hole "},get_json:function(b,e,l){var c=function(b,c){e({type:"box_path",index:a,true_type:this.true_type,next:b},
c)}.bind(this);this.next?this.next.get_json(b,c,l):c(void 0,l)}}}};a.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};b.creators_from_json.box_path=function(d,e){var k=a.path.create(d.index);d.next&&(k.next=b.UTILITIES.create_from_json(d.next,e));d.true_type&&(k.true_type=d.true_type);return k};return a}(window.TOONTALK);window.TOONTALK.box_backside=function(b){return{create:function(a){var d=b.backside.create(a),e=b.UTILITIES.create_text_input(a.get_size().toString(),
"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(c){if(c=b.UTILITIES.input_area_drop_handler(c,a.receive_size_from_dropped.bind(a),a))a.rerender(),a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(c,a,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),k=b.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-radio-button","Left to right","Show box horizontally.",
!0),l=b.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-radio-button","Top to bottom","Show box vertically.",!0),c=function(){var b=parseInt(e.button.value.trim(),10);a.set_size(b,!0)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_size",argument_1:b,toString:"by changing the number of holes to "+b+" of the box",button_selector:".toontalk-box-size-input"})},r=function(){var c=b.UTILITIES.selected_radio_button(k.button,l.button),d=c.value,g="horizontal"===
d;a.set_horizontal(g,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_horizontal",argument_1:g,toString:"by changing the orientation to "+d+" of the box",button_selector:"."+c.className.split(" ",1)[0]})},q=d.get_element(),g=b.backside.create_advanced_settings_button(d,a),n=d.update_display.bind(d),t=b.UTILITIES.create_horizontal_table(k.container,l.container);e.button.addEventListener("change",c);e.button.addEventListener("mouseout",c);k.button.addEventListener("change",
r);l.button.addEventListener("change",r);d.update_display=function(){e.button.value=a.get_size().toString();a.get_horizontal()?b.UTILITIES.check_radio_button(k):b.UTILITIES.check_radio_button(l);n()};q.appendChild(e.container);q.appendChild(t);$(t).buttonset();q.appendChild(g);d.rerender();return d}}}(window.TOONTALK);window.TOONTALK.box_hole=function(b){return{create:function(a){var d=Object.create(this),e,m,l;d.is_hole=function(){return!0};d.is_empty_hole=function(){return!e};d.location_constrained_by_container=
function(){return!1};d.get_element=function(){l||(l=document.createElement("div"),l.className="toontalk-box-hole toontalk-frontside toontalk-side",l.toontalk_widget_side=d);return l};d.get_frontside=function(a){return e?e.get_frontside(a):this.get_element()};d.get_frontside_element=function(a){return this.get_element()};d.get_frontside=function(){return this};d.widget_side_dropped_on_me=function(a,d,e){var g=this.get_parent_of_frontside(),h,l,k,f;a.dropped_on_other&&a.dropped_on_other(this,d,e);d?
(b.sounds&&b.sounds.fall_inside.play(),e=this.get_element(),f=a.is_plain_text_element(),k=a.get_element(),$(k).css({"z-index":b.UTILITIES.next_z_index()}),l=$(k.parentElement).offset(),h=$(e).offset(),f||(k.style.left=d.pageX-l.left+"px",k.style.top=d.pageY-l.top+"px",$(k).addClass("toontalk-animating-element")),k.style.width=e.style.width,k.style.height=e.style.height,k.style.left=h.left-l.left+"px",k.style.top=h.top-l.top+"px",d=function(){$(k).removeClass("toontalk-animating-element");g.render();
this.set_contents(a)}.bind(this),setTimeout(d,f||b.UTILITIES.has_animating_image(k)?0:1200),g.robot_in_training()&&g.robot_in_training().dropped_on(a,this),a.save_dimensions&&a.set_size_attributes&&a.set_size_attributes($(e).width(),$(e).height()),a.is_backside()||g.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:k,where:"front",ndex:this.get_index()}))):(g.rerender(),this.set_contents(a));return!0};d.get_json=function(){return null};d.add_to_json=function(a){return a};
d.copy=function(c){return b.box_hole.create(a)};d.match=function(){return"matched"};d.get_type_name=function(a){return e?e.get_type_name(a):a?"empty holes":"empty hole"};d.is_of_type=function(a){return e?e.is_of_type(a):"empty hole"===a};d.get_box=function(){return this.get_parent_of_frontside()};d.update_display=function(){var a;e&&(a=this.get_frontside_element(),k(e,e.get_frontside_element(),$(a).width(),$(a).height()))};d.dereference=function(){return e?e.dereference():this};d.get_index=function(){return a};
d.get_contents=function(){return e};d.set_contents=function(a){var d=this.get_listeners("value_changed");d&&(e!==a&&d.forEach(function(b){b({type:"value_changed",old_value:e,new_value:a})}),e&&d.forEach(function(a){e.remove_listener("value_changed",a,!0)}),a&&d.forEach(function(b){a.add_listener("value_changed",b)}));e&&e.set_parent(void 0);(e=a)?(e.set_parent(this),b.debugging&&(this._debug_string="A hole containing "+e.to_debug_string()),e.set_visible(m)):b.debugging&&(this._debug_string=this.to_debug_string())};
d.visible=function(){return this.get_parent_of_frontside().visible()};d.set_visible=function(a){m=a;e&&e.set_visible(a)};d.remove=function(){e&&e.remove()};d.render=function(){e&&b.DISPLAY_UPDATES.pending_update(this)};d.rerender=function(){if(e&&this.visible())return this.render()};d.set_running=function(a){e&&e.set_running(a)};d.maintain_proportional_dimensions=function(){if(e)return e.maintain_proportional_dimensions()};d.removed_from_container=function(a,d,l,g){e?(d&&e.restore_dimensions(),this.set_contents(void 0),
d&&this.get_parent_of_frontside().render()):g&&b.UTILITIES.report_internal_error("Holes can't be removed from containers.")};d.temporarily_remove_contents=function(a,b){if(e)return this.get_parent_of_frontside().temporarily_remove_contents(a,b)};d.toString=function(){return e?e.toString():"_"};d.get_description=function(){return e?e.get_description():"_"};d.get_full_description=function(a){return e?e.get_full_description(a):"_"};d.is_backside=function(){return!1};d.get_widget=function(){return this.get_parent_of_frontside()};
d.is_number=function(){return e?e.is_number():!1};d.is_box=function(){return e?e.is_box():!1};d.is_scale=function(){return e?e.is_scale():!1};d.is_bird=function(){return e?e.is_bird():!1};d.is_nest=function(){return e?e.is_nest():!1};d.is_robot=function(){return e?e.is_robot():!1};d.is_element=function(){return e?e.is_element():!1};d.get_original_width=function(){if(e&&e.get_original_width)return e.get_original_width()};d.get_original_height=function(){if(e&&e.get_original_height)return e.get_original_height()};
d.is_sensor=function(){return e?e.is_sensor():!1};d.is_top_level=function(){return!1};d.is_plain_text_element=function(){return!1};b.widget.has_parent(d);b.widget.has_listeners(d);if(b.debugging||b.logging)d.to_debug_string=function(){var c="the "+b.UTILITIES.ordinal(a)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box");return e?c+" which contains "+e.to_debug_string():c+" which is empty"},d._debug_string=d.to_debug_string();return d}}}(window.TOONTALK);
window.TOONTALK.box.function=function(){var b=e.create_function_table();b.add_function_object("box hole",function(a,d,h){return b.typed_bird_function(a,function(a,b){var c=Math.round(a.to_float());if(1>c)e.UTILITIES.display_message("The box hole function bird cannot accept "+a+". She only accepts positive numbers.");else if(c>b.get_size())e.UTILITIES.display_message("The box hole function bird cannot accept "+a+". The box only has "+b.get_size()+" holes.");else return b.get_hole_contents(c-1)},["number",
"box"],2,"box hole",d,h)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. 1 for the first hole.","hole",["number","box"]);b.add_function_object("count holes",function(a,d,h){return b.typed_bird_function(a,function(a){return e.number.create(a.get_size())},["box"],1,"count holes",d,h)},"The bird will return with the number of holes the box has.","count holes",["box"]);b.add_function_object("fill hole",function(a,d,h){return b.typed_bird_function(a,
function(a,b,c){var d=Math.round(a.to_float());if(1>d)e.UTILITIES.display_message("The fill hole function bird cannot accept "+a+". She only accepts positive numbers.");else return d>b.get_size()&&b.set_size(d),b.set_hole(d-1,c),b},["number","box",void 0],3,"fill hole",d,h)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);
b.add_function_object("split box",function(a,d,h){return b.typed_bird_function(a,function(a,b){var c=Math.round(a.to_float()),d=b.get_size();if(0>c)e.UTILITIES.display_message("The box split function bird cannot accept "+a+". She only accepts zero or positive numbers.");else if(c>d)e.UTILITIES.display_message("The box split function bird cannot accept "+a+". The box only has "+d+" holes.");else{b.get_holes();var d=d-c,h=e.box.create(d),g;for(g=0;g<d;g++)h.set_hole(g,b.get_hole_contents(g+c));b.set_size(c);
return e.box.create(2,!1,[b,h])}},["number","box"],2,"split box",d,h)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.","split",["number","box"]);b.add_function_object("merge boxes",function(a,d,h){return b.typed_bird_function(a,function(){var a=0,b,c,d,h;if(0===arguments.length)return e.box.create(0);c=arguments[0];for(b=0;b<arguments.length;b++)a+=arguments[b].get_size();d=c.get_size();c.set_size(a);for(b=
1;b<arguments.length;b++)for(h=arguments[b].get_size(),a=0;a<h;a++)c.set_hole(d,arguments[b].get_hole_contents(a)),d++;return c},["box"],void 0,"merge boxes",d,h)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);return b.get_function_table()}()})(window.TOONTALK);(function(){var e,k,b,a,d;window.TOONTALK.bird=function(a){var b=Object.create(a.widget),l=function(b,d,e){var g=b.get_function_type();b=b.get_function_object();var l=Object.keys(TOONTALK[g]["function"]),k=l.map(function(a){return TOONTALK[g]["function"][a].title}),l=a.UTILITIES.create_select_menu("functions",l,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",k);d=d.get_element();var m;b&&(l.menu.value=b.name);l.menu.addEventListener("change",
function(a){e.set_function_name(a.target.value);e.get_description()||(m=$(e.get_backside_element()).find(".toontalk-description-input"),0<m.length&&m.get(0).setAttribute("placeholder",e.get_default_description()))});d.insertBefore(l.container,d.firstChild)};b.create=function(c,r){var q=Object.create(b),g=[],n=[];e=function(a){c=a};q.is_bird=function(){return!0};q.widget_side_dropped_on_me=function(b,d,e,g,l){var k,n,m;if(c){if(c.has_ancestor(b))return a.UTILITIES.display_message("Bird can't take its nest to its nest!"),
!1;!(c.visible()||this.visible()||c.any_nest_copies_visible())||e&&e.visible()&&!e.animate_consequences_of_actions()?(m=function(){try{c.add_to_contents(b,d,e)}catch(a){if(a.wait_for_nest_to_receive_something)a.wait_for_nest_to_receive_something.run_when_non_empty(m,this);else throw console.error(a.stack),a;}},m(),e&&e===b.robot_waiting_before_next_step&&(b.robot_waiting_before_next_step=void 0,e.run_next_step())):(l||b.save_dimensions(),k=this.get_frontside_element(),setTimeout(function(){$(k).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside().rerender()}.bind(this)),b.set_visible(c.visible()),e&&!g&&(b.robot_waiting_before_next_step=e,e.run_next_step&&(n=function(){b.robot_waiting_before_next_step=void 0;e.run_next_step()})),c.animate_bird_delivery(b,this,n,d,e))}else console.log("TODO: handle drop on a nestless bird -- just removes other?");d&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,this);return!0};q.animate_delivery_to=function(b,
d,e,l,k,m,q,r){var I=!!e,B=this.get_parent_of_frontside(),D=this.get_frontside_element(!0),H=$(D).position();$(D).width();var J=this.closest_visible_ancestor_or_frontside(),C=$(J.get_frontside_element()).offset(),L=function(){var b,c;a.sounds&&a.sounds.bird_fly.pause();I?this.remove():this.visible()&&(b=function(){$(D).removeClass("toontalk-bird-morph-to-static");$(D).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));B&&B.get_widget().rerender()}.bind(this),
D.style.position=R,a.UTILITIES.set_css(D,H),F&&F.appendChild(D),B&&(B.get_widget().is_top_level()?this.rerender():B.get_widget().rerender()),T&&(la.remove_backside_widget(this,!0),T(),g&&(c=g,g=[],n=[],c.forEach(function(a){a()}))),a.UTILITIES.add_animation_class(D,"toontalk-bird-morph-to-static"),a.UTILITIES.add_one_shot_event_handler(D,"animationend",1E3,b));m&&m()}.bind(this),P=function(){try{e.add_to_contents(b,q,r,this,!0)}catch(c){if(c.wait_for_nest_to_receive_something){c.wait_for_nest_to_receive_something.run_when_non_empty(P,
this);m&&(m(),m=void 0);return}console.error(c.stack);throw c;}p($(D).offset());a.UTILITIES.set_timeout(function(){this.fly_to(C,L,r)}.bind(this))}.bind(this),N=function(b,c){c||(c=a.UTILITIES.widget_side_of_element(b));this.element_to_display_when_flying=b;c&&(this.update_display(),setTimeout(function(){c.update_display()}));$(b).addClass("toontalk-carried-by-bird");$(b).removeClass("toontalk-temporarily-set-down");a.UTILITIES.set_timeout(function(){var d={left:"",top:"",position:""};c&&!c.use_scaling_transform&&
(d.width="",d.height="");1<b.toontalk_x_scale&&(d["font-size"]="inherit");a.UTILITIES.set_css(b,d);this.update_display()}.bind(this))}.bind(this),p=function(c){var d;this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),c?(d={"z-index":a.UTILITIES.next_z_index()},0<this.element_to_display_when_flying.width_before_carry&&(d.width=this.element_to_display_when_flying.width_before_carry),0<this.element_to_display_when_flying.height_before_carry&&
(d.height=this.element_to_display_when_flying.height_before_carry),1<this.element_to_display_when_flying.toontalk_x_scale&&(d["font-size"]="inherit"),a.UTILITIES.set_css(this.element_to_display_when_flying,d),this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying),a.UTILITIES.set_absolute_position(this.element_to_display_when_flying,c),(c=b.get_parent_of_frontside())&&!c.is_backside()?c.rerender():(b.set_visible(!0),b.render())):$(this.element_to_display_when_flying).remove(),
this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),v,w,F,R,S,y,T,ia,Z,aa,la;e||(e=c);aa=b.get_element(!0);N(aa,b);d.is_function_nest()||(w=d.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!d.visible()&&!this.visible()||!d.is_function_nest()&&!a.UTILITIES.visible_element(w))e.add_to_contents(b,q,r,this,!0);else if(a.sounds&&a.sounds.bird_fly.play(),$(D).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),
d.is_function_nest()||(w=d.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element(),v=$(w).offset(),y=$(e.get_frontside_element()).closest(".toontalk-top-level-backside")),y&&y.is("*")||(y=$(this.get_frontside_element()).closest(".toontalk-top-level-backside")),(d=y.offset())||(d={left:0,top:0}),l?C={left:l+d.left,top:k+d.top}:0===C.left&&0===C.top&&(C={left:-aa.clientWidth,top:d.top+y.height()/2}),v||(v={left:-2*aa.clientWidth,top:d.top+y.height()/2}),F=D.parentElement,
J=$(D).width(),S=$(D).height(),R=D.style.position,D.style.position="absolute",la=this.top_level_widget(),B&&B.temporarily_remove_contents&&(T=B.temporarily_remove_contents(this,!0))&&this.get_widget().add_to_top_level_backside(this),0<y.length&&y.get(0).appendChild(D),a.UTILITIES.set_css(D,{left:l||C.left-d.left,top:k||C.top-d.top,width:J,height:S}),a.logging&&0<=a.logging.indexOf("bird")&&console.log(this.to_debug_string()+" from "+(l||C.left-d.left)+", "+(k||C.top-d.top)+" to "+v.left+", "+v.top),
(ia=e.get_contents_element&&e.get_contents_element())&&e.visible()&&(!r||r.animate_consequences_of_actions())){l=$(w).width();k=$(w).height();Z=$(w).offset();d.max_left=d.left+y.width();d.max_top=d.top+y.height();v.left+=l;v.top+=k;var oa={left:Math.min(Z.left+l,d.max_left-l),top:Math.min(Z.top+k,d.max_top-k)},pa={left:Math.max(Z.left-l,d.left),top:Math.max(Z.top-k,d.top)};v=function(){var a=function(){e.visible()?(e.set_locked(!0),this.fly_to(Z,ya,r,300)):(e.add_to_contents(b,q,r,this,!0),m&&(m(),
m=void 0))}.bind(this);$(aa).addClass("toontalk-temporarily-set-down");p(oa);e.get_locked()?e.run_when_unlocked(a):a()}.bind(this);var ya=function(){N(ia);this.fly_to(pa,ra,r,300)}.bind(this),ra=function(){$(ia).addClass("toontalk-temporarily-set-down");p(pa);this.fly_to(oa,xa,r,300)}.bind(this),xa=function(){N(aa,b);this.fly_to(Z,ka,r,300)}.bind(this),ka=function(){var c=e.get_contents_dimensions();b.is_plain_text_element()&&$(aa).addClass("toontalk-temporarily-set-down");p(Z);b.is_plain_text_element()||
a.UTILITIES.set_css(b.get_frontside_element(),c);this.fly_to(pa,Ca,r,300)}.bind(this),Ca=function(){N(ia);this.fly_to(Z,Ba,r,300)}.bind(this),Ba=function(){$(aa).removeClass("toontalk-temporarily-set-down");e.set_locked(!1);p();e.update_display();P()}.bind(this);this.fly_to(oa,v,r,300)}else this.fly_to(v,P,r,300)};q.get_json=function(b,d,e){var g;c?(g=function(a,b){d({type:"bird",nest:a},b)},a.UTILITIES.get_json(c,b,g,e)):d({type:"bird"},e)};q.copy=function(a){var b,e,g;if(a)if(a.just_value)b=this.create(void 0,
this.get_description());else{if((g=c.get_guid())&&a.nests_copied&&a.nests_copied[g]){b=a.nests_copied[g][0];d.call(b);for(e=1;e<a.nests_copied[g].length;e++)k.call(a.nests_copied[g][e],b);b=this.create(b,this.get_description())}else b=this.create(c,this.get_description());a.birds_copied||(a.birds_copied={});g&&(a.birds_copied[g]||(a.birds_copied[g]=[]),a.birds_copied[g].push(b))}else b=c&&c.is_function_nest()?this.create(c.copy(),this.get_description()):this.create(c,this.get_description());return this.add_to_copy(b,
a)};q.run_when_non_empty=function(a,b){0>n.indexOf(b)&&(g.push(a),n.push(b))};q.create_backside=function(){var b=a.bird_backside.create(this);c&&c.is_function_nest()&&l(c,b,this);return b};q.get_help_URL=function(){return c&&c.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};q.is_function_bird=function(){return c&&c.is_function_nest()};q.get_custom_title_prefix=function(){var a;return c?c.is_function_nest()&&(a=c.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":
"This bird no longer knows where her nest is. She'll get rid of anything you give her."};q.toString=function(a){return c?c.is_function_nest()?c.get_function_object().toString():"a bird":a&&"conditions"===a.role?"any bird":"a bird without a nest"};q.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird the '"+c.get_function_object().name+"' of things.":"a bird who takes things to her nest."};q.update_display=function(){var b=this.get_frontside(!0);this.get_backside();
var c;c=b.get_element();c.setAttribute("toontalk_name",this.get_name());a.UTILITIES.give_tooltip(c,this.get_title());$(c).is(".toontalk-bird, .toontalk-side-animating")||($(c).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),c.addEventListener("dragenter",function(b){0<=c.className.indexOf("toontalk-bird-static")&&($(c).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),a.UTILITIES.add_animation_class(c,
"toontalk-bird-gimme"))}.bind(this)),c.addEventListener("dragleave",function(a){$(c).is(".toontalk-bird-gimme")&&($(c).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?c.appendChild(this.element_to_display_when_flying):$(c).children(".toontalk-side").remove()};q.set_function_name=function(a){c&&c.is_function_nest()&&c.set_function_name(a)&&
(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};q.get_class_name_with_color=function(a){return c&&c.get_class_name_with_color?c.get_class_name_with_color(a):a};q.get_name=function(){return c&&c.get_name()};c&&c.set_name&&(q.set_name=function(a,b){return c.set_name(a,b)});q.add_standard_widget_functionality(q);q.set_description(r);
a.debugging&&(q._debug_id=a.UTILITIES.generate_unique_id(),q._debug_string=q.to_debug_string());return q};b.create_function=function(c,d,e){return b.create(a.nest.create_function(d,c,e||a.UTILITIES.get_first_property(a[c].function)))};b.match=function(a){if(a.match_with_any_bird)return a.match_with_any_bird(this);this.last_match=a;return this};b.match_with_any_bird=function(){return"matched"};b.fly_to=function(b,d,e,g){var l=this.get_frontside_element(),k=$(l).offset(),k=Math.atan2(b.top-k.top,b.left-
k.left),m="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*(k/Math.PI+1))%8];$(l).position();var f=function(){$(l).removeClass(m);g?setTimeout(d,e?e.transform_step_duration(g):g):d()}.bind(this);setTimeout(function(){$(l).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));a.UTILITIES.add_animation_class(l,m);this.animate_to_absolute_position(b,
f,e&&e.transform_animation_speed(a.UTILITIES.default_animation_speed))}.bind(this),1)};b.get_type_name=function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};b.maintain_proportional_dimensions=function(){return!0};b.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};b.drop_on=function(a,b,d){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,d)};a.creators_from_json.bird=function(b,d){return a.bird.create(a.UTILITIES.create_from_json(b.nest,
d),b.description)};return b}(window.TOONTALK);window.TOONTALK.bird_backside=function(a){return{create:function(b){var d=a.backside.create(b);d.add_description_setting();d.add_name_setting();d.get_element().appendChild(a.backside.create_advanced_settings_button(d,b));return d}}}(window.TOONTALK);window.TOONTALK.nest=function(h){var m=Object.create(h.widget),l,c=0,r=0;m.default_maximum_capacity=10;m.maximum_capacity=m.default_maximum_capacity;m.create=function(q,g,n,t,u,f){var x=Object.create(m),A=
[],E=[],M=[],G=!1,I,B,D;g||(g=[]);u||(c++,u=c);k=function(c){t&&a.call(t,this);t=c;n=c.get_guid();b.call(c,this)};d=function(){t&&a.call(t,this);t=void 0;n=h.UTILITIES.generate_unique_id()};b=function(a){l||(l=h.UTILITIES.generate_unique_id());this[l](a)};a=function(a){l||(l=h.UTILITIES.generate_unique_id());this[l](a,!0)};x.is_nest=function(){return!0};x.get_guid=function(){return n};x.matched_by=function(a){return 0<g.length?h.UTILITIES.match(a,g[0]):[[this,a]]};x.run_when_non_empty=function(a,
b){0<g.length?a(g[0]):0>M.indexOf(b)&&(A.push(a),M.push(b))};x.dereference=function(){return 0<g.length?g[0]:this};x.match=function(a){if(0<g.length)return g[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};x.add_to_contents=function(a,b,c,d,e){var f;f=g.push(a);var p=this.visible();f>m.maximum_capacity&&c&&G&&!c.visible()&&!p&&(h.logging&&0<=h.logging.indexOf("nest")&&console.log(this.to_debug_string()+" postponing addition of "+a.to_debug_string()+
" by "+c.to_debug_string()+". Stack is "+g.length+" long. "+E.length+" previously postponed."),c.add_body_finished_listener(function(){c.set_stopped(!0);E.push(function(){c.set_stopped(!1);c.run_actions()})}));h.logging&&0<=h.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+a.to_debug_string()+" nest now contains "+g.length+" widgets.");1===f?(G=!1,0<A.length&&(f=A,A=[],M=[],f.forEach(function(b){b(a)})),a.set_visible(p),p||a.hide()):(a.hide(),a.set_visible(!1));a.is_backside()?
a.set_parent_of_backside(this):a.set_parent_of_frontside(this);I&&!e&&(d?I.forEach(function(e){e.has_ancestor(a.get_widget())||e.animate_bird_delivery(h.UTILITIES.copy_side(a),d,void 0,b,c)}):I.forEach(function(d){d.has_ancestor(a.get_widget())||d.add_to_contents(h.UTILITIES.copy_side(a,!1,!0),b,c)}));this.rerender()};x.animate_bird_delivery=function(a,b,c,d,e){var g,f,l;void 0===this.get_parent_of_frontside()?(a.remove(),c&&c()):(b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,e),I&&(g=$(b.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),
f=b.get_parent_of_frontside().get_element(),l=this.visible(),I.forEach(function(c){var k=h.UTILITIES.copy_side(a,!1,l),n,m;c.has_ancestor(a.get_widget())||(g&&(c.visible()||l)?(n=b.copy({just_value:!0}),m=n.get_frontside_element(!0),f.appendChild(m),n.animate_delivery_to(k,c,c,g.left,g.top,void 0,d,e)):c.add_to_contents(k,void 0,e))})))};x.get_contents_element=function(){if(0<g.length)return g[0].get_element()};x.get_locked=function(){return this.locked_for_animating_deliveries};x.set_locked=function(a){this.locked_for_animating_deliveries=
a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};x.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};x.removed_from_container=function(a,b){var c=g.shift();h.logging&&0<=h.logging.indexOf("nest")&&console.log(this.to_debug_string()+" removed "+c.to_debug_string()+" remaining widgets is "+g.length);if(c)return b||(G=!0),c.is_backside()?c.set_parent_of_backside(void 0):c.get_widget().set_parent_of_frontside(void 0),
this.visible()&&(c.restore_dimensions&&c.restore_dimensions(),0<g.length&&(g[0].set_visible(!0),$(g[0].get_element()).show()),this.render()),g.length<=m.maximum_capacity&&0<E.length&&(h.logging&&0<=h.logging.indexOf("nest")&&console.log(this.to_debug_string()+" running "+E.length+" postponed additions. Stack is "+g.length+" long."),m.maximum_capacity=Number.MAX_VALUE,E.forEach(function(a){a()}),m.maximum_capacity=m.default_maximum_capacity,E=[]),c;report_error_if_nothing_removed&&h.UTILITIES.report_internal_error("Nothing removed from nest!")};
x.dereference_path=function(a,b){if(0===g.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(g)return g[0].dereference_path(a,b);h.UTILITIES.display_message("Robot expected to find a nest something that it could get "+h.path.toString(a)+". But the nest is empty.");return this};x.dereference_contents=function(a,b){var c,d,e,f,p,l,k,n,m;return 0===g.length?{wait_until_this_nest_receives_something:this}:a.removing_widget?(c=g[0],b.remove_from_container(c,this),this.visible()&&
(l=this.get_frontside_element(),d=$(l).offset(),e=$(l).closest(".toontalk-backside-of-top-level"),(f=e.offset())||(f={left:0,top:0}),p=c.get_element(!0),k=$(l).width(),l=$(l).height(),n=.1*k+d.left-f.left,m=.1*l+d.top-f.top,h.UTILITIES.set_css(p,{width:k*h.nest.CONTENTS_WIDTH_FACTOR,height:l*h.nest.CONTENTS_HEIGHT_FACTOR}),0<e.length&&b.add_watched_step_end_listeners(function(){e.get(0).appendChild(p);h.UTILITIES.set_css(p,{left:n,top:m})})),c):a.next?g[0].get_widget().dereference_path(a.next,b):
g[0].get_widget()};x.get_json=function(a,b,c){var d=[],e=function(){var e=function(a,c){b({type:"nest",contents:d,guid:n,original_nest:a,serial_number:u,name:this.get_name()},c)}.bind(this);t?h.UTILITIES.get_json(t,a,e,c):e(void 0,c)}.bind(this);h.UTILITIES.get_json_of_array(g,d,0,a,e,c)};x.copy=function(a){var b,c,d,f;if(a&&a.just_value){if(0<g.length&&(b=g[0].copy(a),!a.copy_covered_nests))return b;c=h.nest.create(this.get_description(),[],"in a robot's condition",void 0,u,this.get_name());b&&c.add_to_contents(b);
return c}b=h.UTILITIES.copy_widget_sides(g,a);a?a.fresh_copy?c=h.nest.create(this.get_description(),b,n&&h.UTILITIES.generate_unique_id()):(d=t||this,a.birds_copied&&a.birds_copied[n]?(f=d.get_guid(),a.nests_copied&&a.nests_copied[f]?(c=a.nests_copied[f][0].copy(),a.nests_copied[f].forEach(function(a){k.call(a,c)})):c=h.nest.create(this.get_description(),b,h.UTILITIES.generate_unique_id()),a.birds_copied[n].forEach(function(a){e.call(a,c)})):c=h.nest.create(this.get_description(),b,n,d,u,this.get_name()),
a.nests_copied||(a.nests_copied={}),a.nests_copied[d]?a.nests_copied[f].push(c):a.nests_copied[f]=[c]):c=h.nest.create(this.get_description(),b,n,t||this,u,this.get_name());return this.add_to_copy(c,a)};x.has_contents=function(){return 0<g.length};x.dropped_on_other=function(a,b,c){var d,e,g,f,l,k,m;if(!n){n=h.UTILITIES.generate_unique_id();h.debugging&&(this._debug_string=this.to_debug_string());d=h.bird.create(this);if(c){c.add_newly_created_widget(d);if(!this.visible())return;this.robot_waiting_before_next_step=
c}b&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(d);h.sounds&&setTimeout(function(){h.sounds.hatching.play()},1E3);this.rerender();e=this.get_frontside_element(!0);h.UTILITIES.add_animation_class(e,"toontalk-hatch-egg");l=function(){var l,n,v;if(a.is_backside())l=a;else if((v=h.UTILITIES.widget_side_of_jquery($(e).closest(".toontalk-top-level-backside")))||(v=h.UTILITIES.widget_side_of_jquery($(other.get_widget().get_frontside_element(!0)).closest(".toontalk-top-level-backside"))),
v)l=v.is_backside()?v:v.get_backside();else{h.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");return}n=l.get_element();v=$(n).offset();g=d.get_frontside_element(!0);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));h.UTILITIES.add_animation_class(g,"toontalk-fly-southwest");f=h.UTILITIES.relative_position(e,n);h.UTILITIES.set_css(g,{left:f.left,top:f.top});b&&this.robot_in_training()?l.widget_side_dropped_on_me(d,
b,void 0,!0):l.widget_side_dropped_on_me(d,b);$(e).removeClass("toontalk-hatch-egg").addClass(this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&h.UTILITIES.set_css(e,{left:f.left-5,top:f.top+45});this.get_parent_of_frontside().render();m=function(){$(g).removeClass("toontalk-fly-southwest");h.UTILITIES.set_timeout(function(){h.UTILITIES.add_animation_class(g,"toontalk-fly-down");$(g).removeClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"));k=function(){var a=function(){$(g).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);$(g).removeClass("toontalk-fly-down");h.UTILITIES.add_animation_class(g,"toontalk-bird-morph-to-static");h.UTILITIES.add_one_shot_event_handler(g,"animationend",1E3,a);c&&(this.robot_waiting_before_next_step=void 0,c.run_next_step());d.update_display()}.bind(this);
h.UTILITIES.add_one_shot_event_handler(e,"animationend",1E3,k)}.bind(this))}.bind(this);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));l=Math.max(10,f.left-70);n=Math.max(10,f.top+70);d.animate_to_absolute_position({left:l+v.left,top:n+v.top},m,c&&c.transform_animation_speed(h.UTILITIES.default_animation_speed));this.rerender()}.bind(this);h.UTILITIES.add_one_shot_event_handler(e,"animationend",2E3,l)}return!0};x.widget_side_dropped_on_me=function(a,
b,c){b&&a.save_dimensions&&a.save_dimensions();0===g.length?(this.add_to_contents(a,b,c),a.dropped_on_other?a.dropped_on_other(this,b,c):b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(g[0],b,c);return!0};x.drop_on=function(a,b,c){return a.widget_side_dropped_on_me?(a.widget_side_dropped_on_me(this,b,c),!0):!1};x.element_to_highlight=function(){return 0===g.length?this.get_frontside_element():g[0].get_frontside_element()};x.update_display=function(){var a=this.get_frontside(!0),
b=this.get_backside(),c,d,e,f,a=a.get_element();a.setAttribute("toontalk_name",this.get_name());0<g.length?(c=g[0],c.is_backside()?(f=c.get_element(!0),c.update_display(),c.scale_to_fit(f,a)):(c.set_visible(!0),c.render(),f=g[0].get_element(!0),$(f).show()),d=$(a).width(),e=$(a).height(),0<d&&0<e&&h.UTILITIES.set_timeout(function(){var a=this.get_contents_dimensions();a&&(h.UTILITIES.set_css(f,{width:a.width,height:a.height,left:.1*d,top:.1*e}),c.set_size_attributes&&c.set_size_attributes(a.width,
a.height))}.bind(this),2),a.appendChild(f),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest")),g[0].is_backside()?c.set_parent_of_backside(this):c.set_parent_of_frontside(this)):(h.UTILITIES.give_tooltip(a,this.get_title()),n?($(a).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest"))):h.UTILITIES.add_animation_class(a,this.get_class_name_with_color("toontalk-nest-with-egg")));$(a).addClass("toontalk-nest");
b&&b.rerender()};l||(l=h.UTILITIES.generate_unique_id());x[l]=function(a,b){if(!I){if(b)return;I=[]}b?I.splice(I.indexOf(a),1):I.push(a)};x.get_contents_dimensions=function(){var a=this.get_frontside_element(),b=$(a).width(),a=$(a).height(),b=h.nest.CONTENTS_WIDTH_FACTOR*b,a=h.nest.CONTENTS_HEIGHT_FACTOR*a,c=g[0],d;if(c)return d=c.is_box()?1:2,c=c.get_border_size?d*c.get_border_size(b,a):0,{width:b-c,height:a-c}};x.get_path_to=function(a,b){var c,d;if(0<g.length){c=g[0].get_widget();if(c===a)return h.path.to_widget_on_nest();
if(c.get_path_to&&(d=h.path.to_widget_on_nest(),c=c.get_path_to(a,b)))return d.next=c,d}};x.walk_children=function(a){if(0<g.length)return a(g[0])};x.top_contents_is=function(a){return 0<g.length&&g[0]===a};x.any_nest_copies_visible=function(){var a=!1;if(!I)return!1;I.some(function(b){b.visible()&&(a=!0)});return a};x.compare_with=function(a){if(0<g.length)return g[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};x.compare_with_nest=function(a){return 0===g.length?0:
1};x.compare_with_number=function(a){return 0<g.length?g[0].compare_with(a):-1};x.get_class_name_with_color=function(a){return u?a+["","-magenta","-yellow"][u%3]:a};x.generate_name=function(){r++;return"#"+r.toString()};x.has_name(x);B=x.set_name;x.set_name=function(a,b){var c=this.get_name();if(!B.call(this,a,b))return!1;b&&$(".toontalk-bird").each(function(){this.getAttribute("toontalk_name")===c&&h.UTILITIES.widget_side_of_element(this).rerender()})};x.set_name(f);x.compare_with_box=x.compare_with_number;
x.compare_with_scale=x.compare_with_number;x.add_standard_widget_functionality(x);D=x.set_visible;x.set_visible=function(a){D.call(this,a);a||this.set_locked(!1)};x.set_description(q);h.debugging&&(x._debug_id=h.UTILITIES.generate_unique_id(),x._debug_string=x.to_debug_string());t&&n&&(l||(l=h.UTILITIES.generate_unique_id()),t[l](x));return x};m.create_function=function(a,b,c){var d=function(){return!1},e=h[b]&&h[b].function&&h[b].function[c],d={get_function_type:function(){return b},get_function_object:function(){return e},
set_function_name:function(a){if(c===a)return!1;c=a;e=h[b]&&h[b].function&&h[b].function[c];this.add_to_contents=e.respond_to_message;return!0},is_function_nest:function(){return!0},copy:function(){return h.nest.create_function(a,b,c)},animate_bird_delivery:function(a,b,c,d,e){b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,e)},get_json:function(a,c,d){c({type:"function_nest",function_type:b,function_name:e?e.name:h.UTILITIES.get_first_property(h[b].function)},d)},add_to_json:h.widget.add_to_json,
get_widget:function(){return this},get_guid:function(){},get_name:function(){return e.short_name},has_ancestor:d,visible:d,any_nest_copies_visible:d,is_backside:d};h.widget.has_parent(d);h.widget.has_description(d);h.widget.add_sides_functionality(d);d.set_description(a);e?(d.add_to_contents=e.respond_to_message,h.debugging&&(d._debug_id=h.UTILITIES.generate_unique_id(),d._debug_string="a function nest that "+e.toString())):h.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+
b+"."+c+" is not defined.");return d};h.creators_from_json.function_nest=function(a,b){return h.nest.create_function(a.description,a.function_type,a.function_name)};m.create_backside=function(){return h.nest_backside.create(this)};m.match_nest_with_nest=function(a){return"matched"};m.toString=function(){return"a nest"};m.get_default_description=function(){return"a nest that receives things from its birds."};m.get_help_URL=function(){return"docs/manual/birds-nests.html"};m.get_type_name=function(a){return a?
"nests":"nest"};m.maintain_proportional_dimensions=function(){return!0};m.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};m.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};h.creators_from_json.nest=function(a,b){var c=!a.original_nest&&a.guid&&b&&b.guid_to_nest_table&&b.guid_to_nest_table[a.guid];c||(c=h.nest.create(a.description,h.UTILITIES.create_array_from_json(a.contents,b),a.guid,a.original_nest&&h.UTILITIES.create_from_json(a.original_nest,
b),a.serial_number,a.name),b.guid_to_nest_table[a.guid]=c);return c};m.CONTENTS_WIDTH_FACTOR=.8;m.CONTENTS_HEIGHT_FACTOR=.8;return m}(window.TOONTALK);window.TOONTALK.nest_backside=function(a){return{create:function(b){b=a.backside.create(b);b.add_description_setting();b.add_name_setting();return b}}}(window.TOONTALK)})();window.TOONTALK.scale=function(e){var k=Object.create(e.widget);k.create=function(b,a,d,h,k){var l=function(){d.rerender()},c,r,q;d||(d=e.box.create(2,void 0,b,a,k||""));c=d.get_json;r=d.copy;q=d.get_path_to;d.is_scale=function(){return!0};d.copy=function(a){var b;this.get_name();a||(a={});b=r.call(this,a);b=e.scale.create(void 0,void 0,b,a.just_value&&this.get_state());return d.add_to_copy(b,a)};d.get_json=function(a,b,d){var e=function(a,c){a.type="scale";a.inactive_state=this.get_inactive_state();
b(a,c)}.bind(this);c.call(this,a,e,d)};d.get_path_to=function(a,b){var c=q.call(this,a,b);c&&(c.true_type="scale");return c};d.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c)};d.widget_side_dropped_on_me=function(a,b,c){var d=this.get_hole_contents(0),e=this.get_hole_contents(1),h;a.dropped_on_other&&a.dropped_on_other(this,b,c);if(d&&!e)return this.get_hole(1).widget_side_dropped_on_me(a,b,c),!0;if(!d&&(e||!b))return this.get_hole(0).widget_side_dropped_on_me(a,
b,c),!0;h=this.which_hole(b,!1);if(0===h){if(d){if(d.drop_on)return a.drop_on(d,b,c);return}}else if(e){if(e.drop_on)return a.drop_on(e,b,c);return}this.get_hole(h).widget_side_dropped_on_me(a,b,c);return!0};d.which_hole=function(a,b){var c=$(d.get_frontside_element()),e=c.offset(),c=c.width(),e=a.clientX-(e.left+c/2),c=b?c/10:0;return-e>c?0:e>c?1:-1};d.get_inactive_state=function(){return h};d.update_display=function(){var a=this.get_frontside_element(!0),b=$(a),c=$(a).children(".toontalk-scale-half"),
d=$(a).parent(),d=d.is(".toontalk-backside")?a:d.get(0),f=$(d).width(),h=$(d).height(),l=function(a,b,c){var d=b.get_contents(),e=(d||b).get_frontside_element(!0),g=c*f*.5,l=.5*f,k=h;b=b.get_contents();$(a).css({left:g,top:0,width:l,height:k});a!==e&&(g=0===c?-.05*f:.15*f,c="toontalk-scale-balanced"===m?.1*h:0===c&&"toontalk-scale-left_heavier"===m||1===c&&"toontalk-scale-right_heavier"===m?.25*h:1===c&&"toontalk-scale-left_heavier"===m||0===c&&"toontalk-scale-right_heavier"===m?-.1*h:.2*h,l=.4*f,
k=.4*h,$(e).css({left:g,top:c,width:l,height:k}),b&&(b.set_location_attributes&&b.set_location_attributes(g,c),b.set_size_attributes&&b.set_size_attributes(l,k),d.rerender()),a.appendChild(e))},k,m;b.is(".toontalk-top-level-resource")?m="toontalk-scale-balanced":(k=this.get_state(),m="undefined"===typeof k?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][k+1]);b.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");
b.addClass(m);b.addClass("toontalk-scale");b=e.UTILITIES.scale_to_fit(a,d,123,91);0===f&&(f=1);0===h&&(h=1);f/=b.x_scale;h/=b.y_scale;2===c.length?c.each(function(a,b){e.UTILITIES.set_timeout(function(){l(b,this.get_hole(a),a)}.bind(this))}.bind(this)):this.get_holes().forEach(function(b,c){var d=b.get_element();0===c?$(d).addClass("toontalk-left_scale  toontalk-scale-half"):$(d).addClass("toontalk-right_scale toontalk-scale-half");l(d,b,c);a.appendChild(d)});e.UTILITIES.give_tooltip(a,this.get_title());
e.debugging&&(this._debug_string=this.to_debug_string())};d.render=function(){e.DISPLAY_UPDATES.pending_update(this)};d.get_type_name=function(a){return a?"scales":"scale"};d.get_help_URL=function(){return"docs/manual/scales.html"};d.toString=function(){var a=this.get_hole_contents(0),b=this.get_hole_contents(1),c,d,f;switch(this.get_state()){case -1:c="scale leaning to the right";break;case 1:c="scale leaning to the left";break;case 0:c="balanced scale";break;default:if(c="unbalanced scale",!d&&
!f)return c}d=a?"contains "+e.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";f=b?"contains "+e.UTILITIES.add_a_or_an(b.get_full_description()):"is empty";return c+" and the left pan "+d+" and the right pan "+f};d.create_backside=function(){return e.scale_backside.create(this)};d.get_state=function(){var a=this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);b=this.get_hole_contents(1);if(a||b)if(a){if(!b)return 1;if(a.compare_with)return a.compare_with(b)}else return-1};
d.match=function(a){if(a.match_with_scale)return a.match_with_scale(this);this.last_match=a;return this};d.match_with_scale=function(a){return this.get_state()===a.get_state()?"matched":a};d.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};d.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};d.get_name_input_label=void 0;d.generate_name=function(){return""};d.get_hole(0).add_listener("value_changed",l);
d.get_hole(1).add_listener("value_changed",l);d.get_hole_contents(0)&&d.get_hole_contents(0).add_listener("value_changed",l);d.get_hole_contents(1)&&d.get_hole_contents(1).add_listener("value_changed",l);d.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+
" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};d.get_default_description=function(){return"a scale for comparing things."};d.set_name=void 0;e.debugging&&(d._debug_id=e.UTILITIES.generate_unique_id(),d._debug_string=d.to_debug_string());return d};e.creators_from_json.scale=function(b,a){return k.create(e.UTILITIES.create_array_from_json(b.contents,a),b.description,void 0,b.inactive_state,b.name)};return k}(window.TOONTALK);
window.TOONTALK.scale_backside=function(e){return{create:function(k){var b=e.backside.create(k);b.add_description_setting();b.get_element().appendChild(e.backside.create_advanced_settings_button(b,k));return b}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(e){var k=function(a,b,k,l,c){var r;k.current_action_name=b;(a=e.path.get_path_to(a,k))?(l||(l={}),r=Date.now(),l.time=r-k.time_of_last_step,k.time_of_last_step=r,k.add_step(e.robot_action.create(a,b,l),c)):console.log("No path found for "+b);k.current_action_name=void 0},b=Object.create(e.widget),a=0;b.create=function(a,h,k,l,c,r,q,g,n){var t=Object.create(b),u,f,x,A=[],E=[],M,G,I,B,D,H,J,C;k||(k=e.actions.create());u||(u=t);a&&a.set_parent_of_frontside(t);
t.is_robot=function(){return!0};t.get_frontside_conditions=function(){return a};t.set_frontside_conditions=function(b){a=b;a.set_parent_of_frontside(this)};t.get_backside_matched_widgets=function(){return C};t.set_backside_matched_widgets=function(a){C=a};t.get_matched_backside_widget=function(a){if(C)return C[this.get_training_context().get_backside_widgets().indexOf(a)]};t.get_backside_widget_of_type=function(a,b){var c,d;if(C)return C[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&
0>this.get_newly_created_widgets().indexOf(b))return d=b,!0}.bind(this)),d};t.get_backside_conditions=function(){return h};t.set_backside_conditions=function(a){$.isArray(a)?h=a.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(h=[],e.UTILITIES.available_types.forEach(function(b){a[b]&&h.push(a[b])}));h&&h.forEach(function(a){a.is_backside()?a.set_parent_of_backside(this):(e.widget.erasable(a),a.set_parent_of_frontside(this))}.bind(this))};h&&t.set_backside_conditions(h);t.initialize_backside_conditions=
function(){var a=this.get_training_context();J=e.UTILITIES.copy_widget_sides(a.get_backside_widgets(),{just_value:!0});this.set_backside_conditions([])};t.add_to_backside_conditions=function(a){var b;0<=this.get_newly_created_widgets().indexOf(a)||(h||(h=[]),a=this.get_training_context().get_backside_widgets().indexOf(a),0<=a&&(b=J[a]),b&&0>h.indexOf(b)&&(h.push(b),e.widget.erasable(b)))};t.get_backside_condition_index=function(a){a=this.get_training_context().get_backside_widgets().indexOf(a);if(0<=
a)return h.indexOf(J[a])};t.get_body=function(){return k};t.set_body=function(a){k=a};t.get_running=function(){return D||this.is_ok_to_run()};t.running_or_in_run_queue=function(){return D};t.set_running_or_in_run_queue=function(a){D=a};t.stopped=function(){return H};t.set_stopped=function(a){if(H!==a){if(H=a)this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.drop_thing_in_hand(),this.rerender()),D=!1;this.get_next_robot()&&this.get_next_robot().set_stopped(a)}};
t.drop_thing_in_hand=function(){c&&(c.drop_on(this.top_level_widget(),void 0,this),this.set_thing_in_hand(void 0))};t.finish_cycle_immediately=function(a){var b=x,c=function(){x=b;this.set_visible(!1);a&&a()}.bind(this);x=0;this.add_body_finished_listener(c)};t.get_maximum_step_duration=function(){return x};t.get_context=function(){return M};t.set_context=function(a){M=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};t.context_is_backside=function(){return G};t.set_context_is_backside=
function(a){G=a;this.get_next_robot()&&this.get_next_robot().set_context_is_backside(a)};t.get_top_level_context=function(){return I};t.set_top_level_context=function(a){I=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};t.get_queue=function(){return B};t.set_queue=function(a){B=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};t.animate_consequences_of_actions=function(){return this.visible()&&0!==x};t.transform_step_duration=function(a){return void 0===a&&0===
x||!this.visible()?0:n&&a?a/n:"number"===typeof x?Math.min(a,x):a};t.transform_original_step_duration=function(a){if(M&&!M.get_backside()||!this.visible())return 0;if(!n)return a};t.transform_animation_speed=function(a){return M&&!M.get_backside()||!this.visible()?0:n?a*n:a};t.set_animating=function(a,b){var c=this.get_frontside_element(),d;a&&$(c).is(":visible")?(b||(b=$(c).offset()),$(c).css({width:"",height:"","z-index":e.UTILITIES.next_z_index()}),e.UTILITIES.set_position_relative_to_top_level_backside($(c),
b),d=$(c).closest(".toontalk-top-level-backside"),0<d.length&&d.get(0).appendChild(c),$(c).addClass("toontalk-robot-animating"),setTimeout(function(){$(c).addClass("toontalk-side-animating")},2E3)):$(c).removeClass("toontalk-robot-animating toontalk-side-animating")};t.add_body_finished_listener=function(a){A.push(a)};t.run_body_finished_listeners=function(){A.forEach(function(a){a()});A=[]};t.add_watched_step_end_listeners=function(a){E.push(a)};t.run_watched_step_end_listeners=function(){E.forEach(function(a){a()});
E=[]};t.get_thing_in_hand=function(){return c};t.set_thing_in_hand=function(a){if(e.debugging){if(a&&"empty hole"===a.get_type_name()){e.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");return}e.logging&&0<=e.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string()+" now has in his hand "+(a?a.to_debug_string():"nothing"))}c=a};t.get_next_robot=function(){return q};t.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());
!a&&q&&(q.set_first_in_team(q),q.set_previous_robot(void 0));(q=a)&&q.set_previous_robot(this);b&&($(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=this.drop_area_instructions())};t.get_previous_robot=function(){return f};t.set_previous_robot=function(a){f=a};t.get_first_in_team=function(){return u};t.set_first_in_team=function(a){u=a;q&&q.set_first_in_team(a)};t.walk_children=function(a){var b;q&&!a(q)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};t.get_run_once=function(){return r};
t.set_run_once=function(a){r=a;this.update_title();return!0};t.get_watched_speed=function(){return n};t.set_watched_speed=function(a){n=a;return!0};t.can_run=function(){return this.get_frontside_conditions()&&this.get_frontside_conditions().is_top_level()||e.widget.can_run.call(this)};t.training_started=function(a){var b=this.get_training_context();b?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(b.copy({just_value:!0})),this.initialize_backside_conditions(),
a||($("*").css({cursor:"url("+e.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),this.update_title(),a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):e.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};t.training_finished=function(){if(this.being_trained){var a,
b,c;a=this.get_body().get_newly_created_widgets();for(b=0;b<a.length;b++)c=a[b],"drop it on top-level"!==c.last_action&&"copy"!==c.last_action||this.add_step(e.robot_action.create(e.newly_created_widgets_path.create(b),"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):
$("*").css({cursor:""})}};if(e.debugging||e.logging)t.to_debug_string=function(){var a=this.get_frontside_conditions();return"Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(a?e.UTILITIES.add_a_or_an(a.toString()):"anything")};q&&t.set_next_robot(q);t.add_standard_widget_functionality(t);t.has_name(t);t.set_name(g);t.set_description(l);e.debugging&&(t._debug_id=e.UTILITIES.generate_unique_id(),t._debug_string=t.to_debug_string());return t};b.create_backside=function(){return e.robot_backside.create(this)};
b.copy=function(a){var b=this.get_frontside_conditions(),k=this.get_backside_conditions(),b=b?b.copy({just_value:!0}):void 0,l=this.get_next_robot(),l=l?l.copy(a):void 0,c;k&&(c=e.UTILITIES.copy_widgets(k,{just_value:!0}));k=this.create(b,c,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),l,(!a||!a.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(k,a)};b.match=function(a){var b,e;if(a.is_robot()&&(b=this.get_body().is_empty(),
e=a.get_body().is_empty(),b===e))return"matched";this.last_match=a;return this};b.generate_name=function(){a++;return"#"+a.toString()};b.run=function(a,b,k,l){var c=this.get_frontside_conditions(),r,q,g,n,t;if(this.being_trained||this.running_or_in_run_queue())return this;(t=this.get_backside())&&t.visible()&&(g=function(a){$(a.get_frontside_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},
g(c),this.rerender());a?(this.set_context(a),this.set_context_is_backside(b),this.set_top_level_context(k),this.set_queue(l)):a=this.get_context();this.match_status=e.UTILITIES.match(c,this.get_context());"matched"===this.match_status&&(n=[],(b=this.get_backside_conditions())&&0<b.length&&((r=a.get_backside_widgets())&&b.some(function(a){var b,c;a.matching_widget&&a.matching_widget.get_parent_widget_of_frontside()&&(b=e.UTILITIES.match(a,a.matching_widget),"matched"===b&&(n.push(a.matching_widget),
c=b));c||r.some(function(d){b=void 0;if(!(0<=n.indexOf(d)||d.is_backside()||d===this)){g&&g(d);b=e.UTILITIES.match(a,d);if("matched"===b)return n.push(d),c=b,a.matching_widget=d,!0;if(!b.is_widget)c=b;else if(!c||c.is_widget)c=b}}.bind(this));if("matched"!==c)return this.match_status=c,!0}.bind(this)),"matched"!==this.match_status&&(n=void 0),this.set_backside_matched_widgets(n)));if("matched"===this.match_status)return l||(l=this.get_queue()||e.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),
l.enqueue(this),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),this.rerender(),this.get_next_robot()?this.get_next_robot().run():this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){a=this.get_next_robot().run();if("matched"===a)return a;a.is_widget||a.forEach(function(a){0>this.match_status.indexOf(a)&&
this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(q=function(){this.set_waiting(!1);this.run()}.bind(this),this.match_status.forEach(function(a){a[0]?a[0].run_when_non_empty(q,this):a.run_when_non_empty(q,this)}.bind(this)),this.set_waiting(!0));return this.match_status};b.set_waiting=function(a){var b=this.get_frontside_element();b&&(a?this.visible()&&(e.UTILITIES.add_animation_class(b,"toontalk-robot-waiting"),e.UTILITIES.give_tooltip(b,"This robot is waiting for a bird to deliver something.")):
($(b).removeClass("toontalk-robot-waiting"),e.UTILITIES.give_tooltip(b,this.get_title())))};b.run_actions=function(){return this.stopped()?(this.get_first_in_team().set_running(!1),!1):this.get_first_in_team().visible()?this.get_body().run_watched(this):this.get_body().run_unwatched(this)};b.drop_from_data_transfer=function(a,b){var e;a.is_top_level&&a.is_top_level()?(e=a.get_backside_widgets().slice(),setTimeout(function(){e.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=
1E3;this.dropped_on(a,b.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};b.ignore_pick_up_or_drop=function(a){return this===a.get_widget()||a.is_top_level()||this.get_parent_of_frontside()===a};b.picked_up=function(a,b,k){var l,c;if(!this.ignore_pick_up_or_drop(a))return a.get_infinite_stack&&a.get_infinite_stack()?this.current_action_name="pick up a copy of":this.current_action_name="pick up",k?(c=a,b=a.copy({fresh_copy:!0}),b=e.path.get_path_to_resource(b)):
b=e.path.get_path_to(a,this),b&&(k=Date.now(),l={time:k-this.time_of_last_step},this.time_of_last_step=k,l=e.robot_action.create(b,this.current_action_name,l),this.add_step(l,c)),a.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(a),l};b.dropped_on=function(a,b){var k,l,c,r,q;if(!(this.ignore_pick_up_or_drop(a)||this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===a)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,
!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(k=e.path.get_path_to(b,this))b.is_backside()?(c=$(b.get_element()),l=c.offset(),r=c.width(),q=c.height(),c=$(a.get_frontside_element()).offset(),r=(c.left-l.left)/r,l=(c.top-l.top)/q,r=Math.max(0,Math.min(1,r)),l=Math.max(0,Math.min(1,l)),l={left_offset_fraction:r,top_offset_fraction:l}):l={},c=Date.now(),l.time=c-this.time_of_last_step,this.time_of_last_step=c,k=e.robot_action.create(k,this.current_action_name,
l),this.add_step(k);a.last_action=this.current_action_name+" "+b.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};b.dropped_on_text_area=function(a,b,e){k(a,"drop it on the text area of",this,e);a.last_action="drop it on the text area of "+b.get_type_name();this.set_thing_in_hand(void 0)};b.copied=function(a,b,e){e=e?"pick up a copy of":"copy";k(a,e,this,void 0,b);b.last_action=e};b.removed=function(a){var b;this.get_parent()&&(b=this.get_parent().get_widget());k(a,
"remove",this);a.last_action="remove";b===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};b.edited=function(a,b){k(a,"edit",this,b)};b.erased_widget=function(a){k(a,"change whether erased",this)};b.resized_widget=function(a,b,e,l,c){b===l&&e===c||k(a,"change size of",this,{x_factor:l/b,y_factor:c/e})};b.started_training_another=function(a){k(a,"start training",this)};b.finished_training_another=function(a){k(a,"stop training",
this)};b.trained=function(a,b){k(a,"train",this,{step:b})};b.backside_opened=function(a){k(a,"open the backside",this)};b.backside_closed=function(a){a.is_primary_backside()?k(a.get_widget(),"close the backside",this):this.removed(a)};b.button_clicked=function(a,b){k(b.get_widget(),"click the button of",this,{button_selector:a})};b.created_widget=function(a,b,k){this.add_newly_created_widget(a);this.add_to_top_level_backside(a,!1);this.add_step(e.robot_action.create(e.path.get_path_to_resource(a.copy()),
"add a new widget to the work space",{button_selector:k,path_to_source:e.path.get_path_to(b,this)}))};b.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};b.remove_from_container=function(a,b){var e=b.get_index_of&&a.get_parent_of_frontside()&&b.get_index_of(a),l=function(){b.removed_from_container(a,void 0,e,!0)};this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(l):l();this.add_newly_created_widget_if_new(a)};b.get_training_context=function(){return this.get_first_in_team().get_parent_of_frontside().get_widget()};
b.add_step=function(a,b){this.get_body().add_step(a,b);this.update_title();"train"!==a.get_action_name()&&"start training"!==a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,a)};b.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var b=this.get_thing_in_hand(),k,l;e.debugging&&(this._debug_string=this.to_debug_string());k=a.get_element();b&&(l=b.get_element());!l&&this.carrying_tool&&(l=document.createElement("div"),$(l).addClass(this.carrying_tool));
e.UTILITIES.give_tooltip(k,this.get_title());$(k).addClass("toontalk-robot");$(k).children(".toontalk-held-by-robot").remove();l&&k.appendChild(l);this.match_status&&(this.match_status.is_widget?$(k).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(k).removeClass("toontalk-robot-not-matched"));k.setAttribute("toontalk_name",this.get_name());e.UTILITIES.set_timeout(function(){var a,d,e,g,n;l&&(n={position:"absolute"},$(l).addClass("toontalk-held-by-robot"),a=$(l).width(),$(l).height(),
e=$(k).width(),g=$(k).height(),b&&0===a&&(a=b.get_default_width?b.get_default_width():2*e,d=b.get_default_height?b.get_default_height():g/2,n.width=a,n.height=d),n.left=(e-a)/2,n.top=g/4,$(l).css(n),b&&b.rerender())})};b.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};b.add_newly_created_widget_if_new=function(a){if(a!==this.get_training_context()&&this!==a)return this.get_body().add_newly_created_widget_if_new(a)};b.is_newly_created=function(a){return this.get_body().is_newly_created(a)};
b.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-1]};b.get_title=function(){var a=this.get_description();if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?"Drag this robot to a work area.":this.toString()};b.toString=function(a){var b,k,l,c,r,q,g,n,t,u,f,x,A;if(a&&"conditions"===a.role)return"any robot";if(a&&"match_status"===a.role)return"robot "+
this.get_name();b=this.get_frontside_conditions();if(!b)return"an untrained robot";g=b.is_top_level();a||(a={});f=a.person;if(a&&a.resource){if(this.get_description())return'"'+this.get_description()+'"';a.person="third"}k=this.get_backside_conditions();c=this.get_body();q=r="";t=this.get_next_robot();g?u="When the workspace's green flag "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" is pressed":(n=e.UTILITIES.add_a_or_an(b.get_full_description({role:"conditions"})),
u="When working on something that matches "+n);k&&(k.forEach(function(a){a&&(u+=" and\nif on the"+(g?" work area ":" back ")+" is "+e.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),l=!0)}),l&&(u+="\n"));if(this.being_trained){if(c.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";r="is being trained.\n";q="\n..."}c=r+u+(a&&"third"===a.person?" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(c.toString({robot:this})||
"do nothing")+q;if(a&&a.resource)return a.person=f,c.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(A=b.is_top_level()?"the work area I'm running on":"the "+b.get_type_name()+" I'm on the back of",this.match_status===b?x=A:this.match_status.has_ancestor(b)?x="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+A:(b.is_top_level()||(A="the "+this.match_status.get_type_name()+" on "+A),k.some(function(a){if(this.match_status===a)return x=
"any "+a.get_type_name(!0)+" on ",b.is_top_level()||(x+="the back of "),x+=A,!0;if(this.match_status.has_ancestor(a))return x="any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+A,!0}.bind(this))),c="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+x+". Perhaps editing my conditions will help.\n"+c):"matched"!==this.match_status&&(c="I'm waiting for something to be delivered to the nest that matches the "+
this.match_status[0][1]+" in my conditions (highlighted in yellow on my backside).\n"+c));t&&(c+="\nIf it doesn't match then the next robot will try to run.\n"+t.toString());return c};b.get_type_name=function(a){return a?"robots":"robot"};b.maintain_proportional_dimensions=function(){return!0};b.matching_resource=function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&this.get_body().is_empty()&&a.get_body().is_empty()};b.get_top_level_context_description=
function(a){var b=this.get_frontside_conditions().get_type_name();return"top-level"===b?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+b+" he's working on":"the "+b+" I'm working on"};b.get_help_URL=function(){return"docs/manual/robots.html"};b.drop_area_instructions=function(){return this.get_next_robot()?"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};b.get_json=function(a,b,k){var l=this.get_frontside_conditions(),
c=this.get_backside_conditions(),r,q=function(){var c=function(c,k){var f=function(a,d){b({type:"robot",frontside_conditions:a,backside_conditions:r,body:g,run_once:this.get_run_once(),next_robot:c,name:this.get_name(),speed:this.get_watched_speed()},d)}.bind(this);this.get_body().get_json(a,function(b,c){g=b;l?l.is_top_level()?f({type:"top_level"},c):e.UTILITIES.get_json(l,a,f,c):f(void 0,c)},k)}.bind(this);this.get_next_robot()?e.UTILITIES.get_json(this.get_next_robot(),a,c,k):c(void 0,k)}.bind(this),
g;c?(r=[],e.UTILITIES.get_json_of_array(c,r,0,a,q,k)):q()};e.creators_from_json.robot=function(a,b){var k,l,c,r;a.thing_in_hand&&(l=e.UTILITIES.create_from_json(a.thing_in_hand,b));a.next_robot&&(k=e.UTILITIES.create_from_json(a.next_robot,b));a.backside_conditions&&($.isArray(a.backside_conditions)?r=e.UTILITIES.create_array_from_json(a.backside_conditions,b):a.semantic&&e.UTILITIES.available_types.forEach(function(b){a.semantic.backside_conditions[b]&&r.push(e.UTILITIES.get_json(a.semantic.backside_conditions[b],
json_history))}));c=e.UTILITIES.create_from_json(a.frontside_conditions||a.bubble,b);k=e.robot.create(c,r,void 0,a.description,l,a.run_once,k,a.name,a.speed);b||(b={});b.robot=k;k.set_body(e.UTILITIES.create_from_json(a.body,b));return k};b.find_conditions_path=function(a,b,k){var l=b.get_frontside_conditions(),c=l===a?"entire_condition":l.get_path_to&&l.get_path_to(a,k),l=e.path.get_path_to(b,k),r;c||(b=b.get_backside_conditions(),b.some(function(b){b&&(c=b.get_path_to(a,k))&&(r=b)}));if(c)return e.robot.create_conditions_path(c,
l,r);e.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};b.create_conditions_path=function(a,b,k){"string"===typeof k&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===k)return k=a,!0});return{dereference_path:function(l){var c=e.path.dereference_path(b,l),c=k?k:c.get_frontside_conditions();return"entire_condition"===a?c:e.path.dereference_path(a,l,c)},toString:function(){var l="entire_condition"===a?"the ":e.path.toString(a)+
" of the ";return k?l+k.toString()+" backside condition of "+e.path.toString(b):l+" front side condition of "+e.path.toString(b)},get_json:function(l,c,r){var q=function(e,n){b.get_json(l,function(b,e){var f=function(a,d){c({type:"path_to_robot_conditions",backside_condition:k&&a,path_to_robot:b,path_within_conditions:a},d)};"entire_condition"===a?f("entire_condition",e):a.get_json(l,f,e)},n)};k?e.UTILITIES.get_json(k,l,q,r):q(void 0,r)}}};e.creators_from_json.path_to_robot_conditions=function(a){var b=
e.UTILITIES.create_from_json(a.path_to_robot),k="entire_condition"===a.path_within_conditions?a.path_within_conditions:e.UTILITIES.create_from_json(a.path_within_conditions);a=a.backside_condition&&e.UTILITIES.create_from_json(a.backside_condition);return e.robot.create_conditions_path(k,b,a)};return b}(window.TOONTALK);window.TOONTALK.robot_backside=function(e){var k=function(a,b,h,k){a=e.UTILITIES.create_text_element(a);var l=b.get_element(!0),c=document.createElement("div"),r=function(){var a;
b.visible()&&($(l).parent().addClass("toontalk-conditions-contents-container"),b.update_display(),a={width:$(c).width(),height:$(c).height(),left:"",top:""},b.use_scaling_transform?b.use_scaling_transform(a):b.is_backside()&&e.UTILITIES.scale_element(l,a.width,a.height,b.get_original_width()||$(l).width(),b.get_original_height()||$(l).height(),void 0,a),$(l).css(a),b.rerender())};$(l).addClass("toontalk-conditions-contents "+k);h.match_status&&(h.match_status.is_widget?$(h.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):
"matched"!==h.match_status&&h.match_status.forEach(function(a){$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")}));c.appendChild(l);h=e.UTILITIES.create_horizontal_table(a,c);$(h).addClass("toontalk-conditions-panel");e.UTILITIES.run_when_dimensions_known(l,function(){setTimeout(r,100)});return h},b=function(a,b){var h=b.get_frontside_conditions(),m=b.get_backside_conditions(),l=b.visible(),c;h&&(h.is_top_level()?0>a.firstChild.textContent.indexOf("I always run when the green flag")&&
a.insertBefore(e.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),a.firstChild):0===$(a).find(".toontalk-frontside-conditions-area").length&&a.insertBefore(k("I run only if the thing I'm on the back of matches: ",h,b,"toontalk-frontside-conditions-area"),a.firstChild),h.set_visible(l),h.rerender());m&&m.forEach(function(h){var m;h&&(m=h.get_type_name(),c="toontalk-backside-"+m+"-conditions-area",m="bird"===m?e.UTILITIES.create_text_element("And there is a bird on the back."):
k("And if "+e.UTILITIES.add_a_or_an(m)+" matches: ",h,b,c),a.insertBefore(m,a.firstChild.nextSibling),h.set_visible(l),h.rerender())})};return{create:function(a){var d=e.backside.create(a),h=d.get_element(),k=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},l=e.UTILITIES.create_check_box(!a.get_run_once(),"toontalk-run-once-check-box","When finished start again",
k(a.get_run_once())),c="normal;original;double;half;very fast;very slow".split(";"),r=[1,void 0,2,.5,10,.25],q=function(a){a=c.indexOf(a);return r[a]},g=e.UTILITIES.create_select_menu("robot_speed",c,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),
n=e.UTILITIES.create_drop_area(a.drop_area_instructions()),t=a.get_next_robot(),u=e.backside.create_advanced_settings_button(d,a),f=d.update_display.bind(d),x=function(a,b){var c=a.get_frontside_element(!0),d,e;a.get_default_width&&(d=a.get_default_width(),e=a.get_default_height(),$(c).css({left:"",top:"",width:d,height:e}));b.appendChild(c)},A=d.hide_backside,E=d.add_advanced_settings;d.hide_backside=function(b){A.call(this,b);a.being_trained&&a.training_finished()};$(n).data("drop_area_owner",a);
l.button.addEventListener("click",function(b){var c=l.button.checked;a.set_run_once(!c);e.UTILITIES.give_tooltip(l.container,k(!c));a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_run_once",argument_1:!c,toString:"change to "+(c?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});b.stopPropagation()});g.menu.value=function(a){a=a?r.indexOf(a):1;return c[a]}(a.get_watched_speed());g.menu.addEventListener("change",function(b){a.set_watched_speed(q(b.target.value))});
t&&x(t,n);n.addEventListener("drop",function(b){b=e.UTILITIES.get_dragee();(b=e.UTILITIES.widget_side_of_jquery(b))&&b.is_robot()&&(b.get_body().is_empty()?(b=b.open_backside(),$(b.get_element()).find(".toontalk-train-backside-button").click()):(x(b,n),a.set_next_robot(b)))});d.get_next_robot_area=function(){return n};d.update_display=function(){var b=a.get_frontside_element();b&&e.UTILITIES.give_tooltip(b,a.get_title());f()};e.UTILITIES.when_attached(h,function(){var b=a.get_backside_conditions(),
c=a.get_frontside_conditions();b&&b.forEach(function(a){a.set_visible(!0)});c&&c.set_visible(!0)});h.appendChild(this.create_train_button(d,a));b(h,a);h.appendChild(u);d.add_advanced_settings=function(){E.call(d,l.container,g.container,n)};return d},create_train_button:function(a,d){var h=a.get_element();$(h);var k=$("<button>Train</button>").button(),l=!1;k.addClass("toontalk-train-backside-button");a.change_label_and_title_of_train_button=function(a){a?(k.button("option","label","Stop training "+
d.get_name()),e.UTILITIES.give_tooltip(k.get(0),"Click to stop training this robot.")):d.get_body().is_empty()?(k.button("option","label","Train"),e.UTILITIES.give_tooltip(k.get(0),"Click to start training this robot.")):(k.button("option","label","Re-train "+d.get_name()),e.UTILITIES.give_tooltip(k.get(0),"Click to start training this robot all over again."));e.UTILITIES.visible_element(h)&&b(h,d)};a.change_label_and_title_of_train_button(l);k.get(0).addEventListener("click",function(b){l=!l;a.change_label_and_title_of_train_button(l);
l?(d.initialize_backside_conditions(),d.get_body().reset_steps(),d.robot_started_training(d),d.training_started()):d.training_finished();b.stopPropagation()});return k.get(0)}}}(window.TOONTALK)})();(function(){var e=function(b){return"rotate"===b||"skewX"===b||"skewY"===b||"transform-origin-x"===b||"transform-origin-y"===b},k=function(b){return"transform-origin-x"===b||"transform-origin-y"===b?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+b:e(b)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+b:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+b};window.TOONTALK.element=function(b){var a=["left","top","width","height"],d=Object.create(b.widget),h=
function(a,b){var d,e;if(!a)return 0;"number"===typeof a&&(e=a);0===a.length&&(e=0);if("undefined"===typeof e&&(d=a.substring(a.length-1),0<="0123456789x".indexOf(d)&&(e=parseFloat(a),isNaN(e))))return;d=e;0<=["rotate","skewX","skewY"].indexOf(b)&&(d%=360,0>d&&(d+=360));return d},m=function(a,b){var d,e,g;if((b.left||b.top)&&!a.being_dragged&&(d=a.get_parent_of_frontside()))return b.left&&(e=d.is_element()?d.get_original_width():d.get_width(),e=0<e?(b.left%e+e)%e:b.left,b.left!==e&&(b.left=e,g=!0)),
b.top&&(d=d.is_element()?d.get_original_height():d.get_height(),d=0<d?(b.top%d+d)%d:b.top,b.top!==d&&(b.top=d,g=!0)),g};d.create=function(a,c,h,k,g,n,t,u){var f=Object.create(d),x=b.UTILITIES.generate_unique_id(),A=f.drag_started,E={},M={},G,I,B,D,H,J,C,L,P,N,p,v,w,F,R,S;c||(c=["left","top","width","height"]);f.is_element=function(){return!0};f.get_HTML=function(){return D};f.get_guid=function(){return x};f.get_text=function(){var a,b;return void 0===H&&((a=this.get_frontside_element())?H=a.textContent:
(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),H=a.textContent,$(a).remove()):H=b,""===H&&a&&"IMG"!==a.nodeName&&(this.update_display(),H=a.textContent),""===H)?this.get_HTML():H};f.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>c)break;b+=3;d=a.indexOf("target='_blank'",b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+
a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(D===a)return!1;D=c(a);if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element()?b.innerHTML=D.replace(/ /g,"&nbsp;"):b.innerHTML=D;J&&this.compute_original_dimensions(!0);return!0};f.set_HTML_from_sub_classes=f.set_HTML;f.set_text=function(a){var b=this.get_frontside_element(),c=function(b){$(b).contents().each(function(){this.nodeType==
Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};f.get_style_attributes=function(){return c};f.set_style_attributes=function(a){c=a};f.get_attribute_widgets_in_backside_table=function(){return E};f.set_attribute_widgets_in_backside_table=function(a){E=a};f.get_original_copies=function(){return M};f.get_pending_css=function(){return p};f.get_transform_css=
function(){return v};f.add_to_css=function(a,b){e(a)?(v||(v={}),v[a]=b):(p||(p={}),p[a]=b)};f.apply_css=function(){var a="",c,d;(p||v)&&(c=this.get_frontside_element())&&!$(c).is(".toontalk-not-observable")&&(jQuery.contains(window.document,c)?(p?(p.width&&(P=p.width),p.height&&(N=p.height)):p={},v&&("number"===typeof v.rotate&&(a+="rotate("+v.rotate+"deg)"),"number"===typeof v.skewX&&(a+="skewX("+v.skewX+"deg)"),"number"===typeof v.skewY&&(a+="skewY("+v.skewY+"deg)"),"number"===typeof v["transform-origin-x"]||
"number"===typeof v["transform-origin-y"])&&(p["transform-origin"]=(v["transform-origin-x"]||0)+" "+(v["transform-origin-y"]||0)),P||N?(F&&F.css({width:C,height:L}),this.is_plain_text_element()&&this.plain_text_dimensions(),$(c).css({width:"",height:""}),d=p,b.UTILITIES.run_when_dimensions_known(c,function(e){var f=this.get_parent_of_frontside();m(this,d);b.UTILITIES.scale_element(c,P,N,C,L,a,d,e,!f);p=void 0}.bind(this))):(m(this,p),b.UTILITIES.add_transform_to_css(a,"",p,0>c.parentElement.className.indexOf("toontalk-box-hole")),
$(c).css(p),p=void 0)):b.UTILITIES.when_attached(c,this.apply_css.bind(this)))};f.on_update_display=function(a){w?w.push(a):w=[a]};f.fire_on_update_display_handlers=function(){w&&b.UTILITIES.set_timeout(function(){w.forEach(function(a,b){a()||w.splice(b,1)})})};f.get_image_element=function(){return F};f.set_image_element=function(a,b){F=$(a).find("img");0===F.length?F=void 0:($(b).width(F.width()),$(b).height(F.height()))};f.get_additional_classes=function(){return u};f.set_additional_classes=function(a){u=
a};f.get_children=function(){return k};f.set_sound_effect=function(a){G=a;G.volume=b.UTILITIES.get_audio_volume(G)};f.get_sound_effect=function(){return G};f.get_video_object=function(){var a;I||(a=this.get_frontside_element())&&(I=a.getElementsByTagName("video")[0]);return I};f.set_video_object=function(a){I=a};f.get_ignore_pointer_events=function(){return t};f.set_ignore_pointer_events=function(a){t=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":
"auto"})};f.get_source_URL=function(){return B};f.set_source_URL=function(a){if(B!==a)return B=a,this.refresh(),!0};f.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===C?b.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),function(){b.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,C,L,void 0,a)}.bind(this)):b.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,C,L,void 0,a)};f.add_standard_widget_functionality(f);
R=f.set_running.bind(f);f.set_running=function(a,b){R(a,b);Object.keys(E).forEach(function(c){E[c].set_running(a,b)});!a&&this.visible()&&(c.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());k.forEach(function(c){c.set_running(a,b)})};S=f.can_run.bind(f);f.can_run=function(){var a;if(S())return!0;Object.keys(E).some(function(b){if(E[b].can_run())return a=!0});if(a)return a;k.some(function(b){if(b.can_run())return a=!0});return a};f.drag_started=function(a,
b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;A.call(this,a,b)};f.update_display=function(){var a=this.get_frontside_element(!0);this.get_backside();var c=function(a){return this.get_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged)if(this.get_erased()){var d;d=$(a).parent(".toontalk-backside").is("*")?c="":c="100%";this.save_dimensions();$(a).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:c,
height:d,transform:""});$(a).parent(".toontalk-conditions-contents-container").is("*")?b.UTILITIES.give_tooltip(a,"This is an element that has been erased. It will match any element."):b.UTILITIES.give_tooltip(a,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(a).is(".toontalk-erased-element")&&($(a).removeClass("toontalk-erased-element"),this.restore_dimensions()),this.initialize_element(),b.UTILITIES.on_a_nest_in_a_box(a)&&(this.set_attribute("width",
$(a).closest(".toontalk-box-hole").width(),!1),this.set_attribute("height",$(a).closest(".toontalk-box-hole").height(),!1)),"undefined"===typeof C&&a.parentElement&&this.compute_original_dimensions(),this.apply_css(),k?k.forEach(function(b){a.appendChild(b.get_frontside_element(!0));b.set_visible(!0);b.update_display()}):k=[],this.fire_on_update_display_handlers(),b.UTILITIES.give_tooltip(a,"Click to see the backside where you can place robots or change the style of this "+c(a)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};
f.initialize_element=function(){var a,b;!J&&(a=this.get_frontside_element())&&($(a).children(".ui-resizable-handle"),D=this.get_HTML(),b=this.is_plain_text_element(),a.innerHTML=b?D.replace(/ /g,"&nbsp;"):D,$(a).addClass("toontalk-element-frontside"),b?((b=this.get_additional_classes())&&$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.location_constrained_by_container()||this.plain_text_dimensions()):$(a).addClass("toontalk-non-plain-text-element"),J=!0)};f.is_plain_text_element=
function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};f.plain_text_dimensions=function(){C=9*this.get_HTML().length;L=24};f.compute_original_dimensions=function(a){b.UTILITIES.original_dimensions(this,function(a,b){var d=this.get_parent_of_frontside();C=a;L=b;d&&d.get_box?d.get_box().rerender():(c.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),a)};f.get_attribute_from_current_css=function(a){var c,d;if("width"===a&&(P||C))return P||C;
if("height"===a&&(N||L))return N||L;c=this.get_frontside_element(!0);d=b.UTILITIES.get_style_numeric_property(c,a);""===d&&(d=$(c).css(a));if(!d)return 0;if("number"===typeof d){if(C&&N){if("left"===a)return d+(C-P)/2;if("top"===a)return d+(L-N)/2}return d}return"%"!==d.charAt(d.length-1)||"left"!==a&&"top"!==a?d:$(c).offset()[a]};f.get_original_width=function(){return C};f.get_original_height=function(){return L};f.increment_width=function(a){this.set_attribute("width",(P||C)+a)};f.increment_height=
function(a){this.set_attribute("height",(N||L)+a)};f.get_width=function(){return P};f.get_height=function(){return N};f.add_child=function(a){var c=$(a.get_frontside_element(!0)),d=$(this.get_frontside_element(!0)),e;k.push(a);a.set_parent_of_frontside(this);e=b.UTILITIES.set_position_relative_to_element(c,d,c.offset(),!0);a.is_element()&&a.set_location_attributes(e.left,e.top);d.get(0).dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:c.get(0),where:"front"}));this.robot_in_training()&&
this.robot_in_training().dropped_on(a,this)};f.removed_from_container=function(a,b){var c=k.indexOf(a);0<=c&&k.splice(c,1)};f.set_HTML(a.toString());f.set_description(h);g&&("string"===typeof g?f.set_sound_effect(new Audio(g)):f.set_sound_effect(g));n&&("string"===typeof n?a="<video src='"+n+"' alt='"+n+"'/>":I=n);b.debugging&&(f._debug_id=b.UTILITIES.generate_unique_id(),f._debug_string=f.to_debug_string());k?k.forEach(function(a){a.set_parent_of_frontside(f)}):k=[];return f};d.copy=function(a){var c=
this.get_style_attributes(),e=d.create(this.get_HTML(),c.slice(),this.get_description(),b.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),h=this.get_attribute_widgets_in_backside_table(),g={},k=e.get_backside(this.visible());e.set_source_URL(this.get_source_URL());a&&(a.elements_copied||(a.elements_copied={}),a.elements_copied[this.get_guid()]=e);Object.keys(h).forEach(function(b){g[b]=h[b].copy(a);g[b].set_parent_of_frontside(k,
!1,!0);e.set_attribute(b,this.get_attribute(b))}.bind(this));e.set_attribute_widgets_in_backside_table(g);return this.add_to_copy(e,a)};d.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};d.match_with_any_element=function(){return"matched"};d.match_with_another_element_widget=function(a){var b;
if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};d.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};d.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};d.get_path_to=function(a,b){var e=this.get_children(),h=e.indexOf(a),g,k;if(0<=h)return d.path.create(h);e.forEach(function(e,h){e.get_path_to&&(k=e.get_path_to(a,
b))&&(g=d.path.create(h),g.next=k)});return g};b.creators_from_json.element_path=function(a,c){var e=d.path.create(a.index);a.next&&(e.next=b.UTILITIES.create_from_json(a.next,c));return e};d.dereference_path=function(a,c){var d,e;if(a){d=a.get_index&&a.get_index();if(!b.debugging||"number"===typeof d)if(e=this.get_children(),d=e[d]){if(d.dereference_contents&&!a.not_to_be_dereferenced)return d.dereference_contents(a.next||a,c);if(a.next){if(d.dereference_path)return d.dereference_path(a.next,c);
b.UTILITIES.report_internal_error("Expected to refer to a child of "+d+" but it lacks a method to obtain "+b.path.toString(a.next))}a.removing_widget&&(d.get_infinite_stack()||c.remove_from_container(d,this));return d}b.UTILITIES.report_internal_error(this+" unable to dereference the path: "+b.path.toString(a))}else return this};d.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+b.UTILITIES.ordinal(a)+" widget "},get_json:function(b,d,e){d({type:"element_path",
index:a,next:this.next&&this.next.get_json(b)},e)}}}};d.widget_side_dropped_on_me=function(a,b,d){if(a.is_backside()||!a.is_element()&&!a.is_number())return!1;this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};d.create_backside=function(){return b.element_backside.create(this)};d.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};d.get_attribute=
function(a){var c=this.get_attribute_from_pending_css(a),d;"left"===a?(d=this.get_frontside_element(),d=b.UTILITIES.translate_x(d)):"top"===a?(d=this.get_frontside_element(),d=b.UTILITIES.translate_y(d)):d=0;return"undefined"!==typeof c&&"auto"!=c?c+d:this.get_attribute_from_current_css(a)+d};d.set_attribute=function(a,c,d,e){var g=this.get_frontside(!0).get_element(),k;if(!g)return!1;k="left"===a?b.UTILITIES.translate_x(g):"top"===a?b.UTILITIES.translate_y(g):0;g=this.get_attribute_from_pending_css(a);
c-=k;if(g===c||"undefined"===typeof g&&(g=this.get_attribute_from_current_css(a),g===c))return!1;k=h(c,a);if("number"===typeof k){if(g==k)return!1;c=k}d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:a,argument_2:c,toString:"change the '"+a+"' style to "+c+" of",button_selector:".toontalk-element-"+a+"-attribute-input"});this.add_to_css(a,c);e&&(c=this.get_style_attributes(),0>c.indexOf(a)&&c.push(a));this.rerender();return!0};d.dropped_on_style_attribute=
function(a,b,d,e){var g,h,k;if(a){g=a.toString();if(a.is_number()){h=this.get_attribute(b);if("number"===typeof h)k=h;else if("auto"===h)switch(b){case "left":k=$(this.get_frontside_element()).offset().left;break;case "top":k=$(this.get_frontside_element()).offset().top;break;default:k=0}else k=parseFloat(h);h=a.to_float();switch(g.substring(0,1)){case "-":g=k-h;break;case "*":g=k*h;break;case "/":g=k/h;break;case "^":g=Math.pow(k,h);break;default:g=k+h}this.set_attribute(b,g,!1);(d||e&&e.visible())&&
this.get_backside().render()}a.get_infinite_stack()||a.remove();d&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};d.get_attribute_widget_in_backside_table=function(a,b,d){var e=this.get_attribute_widgets_in_backside_table()[a];e||b||(e=this.create_attribute_widget(a,d),this.get_attribute_widgets_in_backside_table()[a]=e);return e};d.create_attribute_widget=function(d,c){var e=".toontalk-element-"+d+"-attribute-input",h=this.get_backside_element(),
g=this.get_attribute(d),n=this,t=function(a,c){var d=c.toString,e=c.equals,f=c.remove;M=c.update_display;c.element_widget=this;c.attribute=a;c.get_type_name=function(a){return a?"element attributes":"element attribute"};c.toString=function(){return d.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};c.get_default_description=function(){return"a number that is the "+this.attribute+" of "+this.get_attribute_owner().toString({plain_text:!0})+"."};c.get_custom_title_prefix=function(){return"I'm the '"+
this.attribute+"' attribute of "+this.get_attribute_owner()+".\nDrop a number on me or edit my back side to change my value. My back side has an info button to learn more."};c.equals=function(b){return a===b.attribute?this.equals(b.element_widget):e.call(this,b)};c.update_display=function(){var a,b,c;this.get_erased()||(a=this.get_attribute_owner(),a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_element()&&!a.being_dragged?(c={},b=bigrat.toDecimal(this.get_value()),c[this.attribute]=b,
m(a,c)&&this.set_value(c[this.attribute]),$(a.get_frontside_element()).css(c)):(a=a.get_attribute(this.attribute),E(a)));M.call(this)};A=c.copy.bind(c);c.copy=function(b){var c;if(b){if(b.just_value)return A(b);b.elements_copied&&(c=b.elements_copied[n.get_guid()])}return this.add_to_copy((c||n).create_attribute_widget(a),b)};c.get_json=function(c,d,e){b.UTILITIES.get_json(n,c,function(b,c){d({type:"attribute_widget",attribute_name:a,element:b},c)},e)};c.get_original_attribute_widget=function(){var b=
n.get_original_copies()[a];return b&&b[0]};c.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():n;if(!b.get_widget().is_element())return n;b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=b.get_parent_of_backside();return b};c.remove=function(b,
c){var d=n.get_original_copies()[a],e=d&&d.indexOf(this);0<=e&&d.splice(e,1);f.call(this,b,c)};c.get_help_URL=function(){return k(a)}}.bind(this),u=function(a,c){var d=b.number.create(0,1);t(a,d);d.set_value_from_decimal(c);d.set_format("decimal");d.set_value=function(c){try{var d=n.get_original_copies()[a],e="number"===typeof c?c:bigrat.toDecimal(c),f=bigrat.fromDecimal(e);this.get_attribute_owner().set_attribute(this.attribute,e)&&d.forEach(function(a,b){a.set_value_from_sub_classes(f,!0)});return this.set_value_from_sub_classes(f,
!1)}catch(g){return b.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+g),!1}};d.is_attribute_widget=function(){return!0};d.get_function_type=function(){return"number"};return d}.bind(this),f=function(a,c){var d=b.element.create(c);t(a,d);d.set_HTML=function(b){var c=n.get_original_copies()[a],d;this.get_attribute_owner().set_attribute(this.attribute,b)&&c.forEach(function(a,c){d=a.set_HTML_from_sub_classes(b)});return d};d.get_function_type=function(){return"element"};
d.set_additional_classes("toontalk-string-attribute-widget");return d}.bind(this),x;x=0<=["background-color","color"].indexOf(d)?"string":"number";var A,E,M,G,I;h&&(e=$(h).find(e),0<e.length&&(e.get(0).toontalk_widget_side=this));if("number"===x){if(G=u(d,g),E=G.set_value_from_decimal.bind(G),0<=a.indexOf(d)&&(this.on_update_display(function(){G.rerender();return!0}),"left"===d||"top"===d)){var B;c&&c.to_be_on_backside_of&&(B=c.to_be_on_backside_of[0]);B||(B=G.get_attribute_owner());I=function(a){var b,
c;a.currentTarget.toontalk_widget_side===G.get_attribute_owner()&&(a.stopPropagation(),b=$(B.get_frontside_element()).closest(".toontalk-top-level-backside").offset(),b||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),b={left:0,top:0}),c=a.pageX-b.left-(B.drag_x_offset||0),b=a.pageY-b.top-(B.drag_y_offset||0),"left"===d?(a=c,B.set_attribute("top",b)):(a=b,B.set_attribute("left",c)),G.set_value_from_decimal(a),M.call(G))};G.add_parent_of_frontside_change_listener(function(a,
b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",I);b&&b.get_widget().is_element()&&b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",I)})}}else if("string"===x)G=f(d,g),E=G.set_HTML.bind(G);else{b.UTILITIES.report_internal_error("Unrecognized attribute type: "+x+" for "+d);return}(g=this.get_original_copies()[d])?g.push(G):this.get_original_copies()[d]=[G];return G};b.creators_from_json.attribute_widget=function(a,c){return b.UTILITIES.create_from_json(a.element,
c).create_attribute_widget(a.attribute_name,c)};b.creators_from_json.attribute_number=b.creators_from_json.attribute_widget;d.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};d.toString=function(a){var c=function(b){var c,d;return 1<b.length&&"<"===b.charAt(0)?(c="style='width: 50px; height: 30px;'",a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'"),d=b.indexOf(" "),b.substring(0,
d+1)+c+b.substring(d)):'"'+b+'"'},d=function(){var a=this.get_HTML(),b=a.indexOf("alt="),c;return 0<=b&&(c=a.indexOf("'",b+5),0<=c)?"("+a.substring(b+5,c)+")":""}.bind(this),e=this.get_children();if(a&&!a.inside_tool_tip){if(a.for_json_div)return"";c=d();c||(c=(c=this.get_source_URL())?"whose text is the contents of "+c:(c=this.get_text())?'"'+c+'"':"")}else c=c(this.get_HTML());e&&0<e.length&&(c+=" with "+b.UTILITIES.describe_widgets(e)+" on top");return"the element "+c};d.get_type_name=function(a){return a?
"elements":"element"};d.get_help_URL=function(){return"docs/manual/elements.html"};d.get_json=function(a,c,d){var e=this.get_style_attributes(),g=b.UTILITIES.remove_z_index(this.get_HTML()),h=encodeURIComponent(g),k=[],m;100<=g.length?(a.shared_html||(a.shared_html=[]),g=a.shared_html.indexOf(h),0>g&&(g=a.shared_html.push(h)-1),m={shared_html_index:g}):m=h;h=function(){var f=[],g=function(h){var n=function(){g(h+1)},M,G;h>=e.length?c({type:"element",html:m,attributes:e,attribute_values:e.map(this.get_attribute.bind(this)),
attributes_backsides:f,additional_classes:this.get_additional_classes(),children:0<this.get_children().length&&k,sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()},d):(M=e[h],(M=this.get_attribute_widget_in_backside_table(M,!0))?(G=[],f.push(G),b.UTILITIES.get_json_of_array(M.get_backside_widgets(),G,0,a,n,d)):(f.push(null),n()))}.bind(this);
g(0)}.bind(this);0<this.get_children().length?b.UTILITIES.get_json_of_array(this.get_children(),k,0,a,h,d):h()};b.creators_from_json.element=function(a,c){var e=decodeURIComponent("string"===typeof a.html?a.html:c.shared_html&&c.shared_html[a.html.shared_html_index]),k,g,n,m;a.children&&(g=c.is_child,c.is_child=!0,k=b.UTILITIES.create_array_from_json(a.children,c),c.is_child=g);if(!e&&(e="string"===typeof a.html?"No json.html recreating an element widget.":"additional_info.shared_html missing while recreating an element widget.",
!b.debugging))throw e;m=d.create(e,a.attributes,a.description,k,a.sound_effect,a.video,a.ignore_pointer_events);n=c&&c.event?["left","top"]:[];a.attribute_values.forEach(function(d,e){var g=a.attributes[e],k=a.attributes_backsides&&a.attributes_backsides[e];(c.is_child||0>n.indexOf(g))&&(0!==d||"width"!==g&&"height"!==g)&&m.add_to_css(g,h(d)||d);k&&(g=m.get_attribute_widget_in_backside_table(g,!1,c),b.UTILITIES.add_backside_widgets_from_json(g,k,c))}.bind(this));a.additional_classes&&m.set_additional_classes(a.additional_classes);
a.source_URL&&(m.set_source_URL(a.source_URL),m.refresh());k&&b.UTILITIES.when_attached(function(){k.forEach(function(c,d){var e=a.children[d].widget&&a.children[d].widget.view;e&&b.UTILITIES.set_css(c.get_frontside_element(!0),{left:e.frontside_left,top:e.frontside_top})})});return m};d.create_attribute_path=function(a,c){var d=b.path.get_path_to(a.element_widget,c,!0);return this.extend_attribute_path(d,a.attribute)};d.refresh=function(){this.get_source_URL()&&b.UTILITIES.create_widget_from_URL(this.get_source_URL(),
function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};d.extend_attribute_path=function(a,b){return{dereference_path:function(d){return a.dereference_path(d,d.get_top_level_context()||d.get_context()).get_widget().get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+b+"' property of "+a},get_json:function(d,e,g){a.get_json(d,function(a,d){e({type:"path_to_style_attribute",attribute:b,element_widget_path:a},d)},g)}}};b.creators_from_json.path_to_style_attribute=function(a){var c=
b.UTILITIES.create_from_json(a.element_widget_path);return d.extend_attribute_path(c,a.attribute)};d.set_size_attributes=function(a,c,d){d?(this.add_to_css("width",a),this.add_to_css("height",c)):(this.set_attribute("width",a),this.set_attribute("height",c));b.UTILITIES.set_timeout(function(){this.rerender()}.bind(this))};d.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};d.receive_HTML_from_dropped=function(a){var b=a.get_text&&a.get_text();a.remove();
if(this.set_HTML(b))return this.get_text()};d.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};d.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),$(a).addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):
"top"===a&&(a=this.get_frontside_element(),$(a).addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};d.remove_style_attribute=function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return d}(window.TOONTALK);window.TOONTALK.element_backside=function(b){var a=
function(a,d,e){var c;e.visible()&&(c=d.get_style_attributes(),d.get_frontside_element(),$(a).empty(),c.forEach(function(c){d.get_attribute(c);var k=document.createElement("tr"),g=document.createElement("td"),n=e.is_primary_backside()?d.get_attribute_widget_in_backside_table(c):e.get_widget().create_attribute_widget(c),t=n.get_frontside_element(!0);n.set_parent_of_frontside(e,!1,!0);n.set_infinite_stack(!0);a.appendChild(k);k.appendChild(g);g.appendChild(b.UTILITIES.create_text_element(c));g=document.createElement("td");
k.appendChild(g);n.set_visible(!0);$(t).addClass("toontalk-element-attribute");g.appendChild(t)}))},d=function(a,d){var e=$("<button>Add or remove my style attributes</button>").button();e.addClass("toontalk-show-attributes-chooser-button");e.get(0).addEventListener("click",function(c){$(a).is(":visible")?($(a).hide(),e.button("option","label","Add or remove my style attributes"),b.UTILITIES.give_tooltip(e.get(0),"Click to add widgets for my style attributes.")):($(a).show(),e.button("option","label",
"Hide my style attributes list"),b.UTILITIES.give_tooltip(e.get(0),"Click to hide my list of attributes that can be added or removed."));d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",d)});b.UTILITIES.give_tooltip(e.get(0),"Click to add widgets for my style attributes.");return e.get(0)};return{create:function(e){var m=b.backside.create(e),l=m.get_element();e.get_HTML();var c=document.createElement("table"),r=document.createElement("div"),q=
d(r,e),g=b.backside.create_advanced_settings_button(m,e),n=b.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),t=b.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),u=t?"get_HTML":"get_text",f=m.update_display.bind(m),x=m.add_advanced_settings,A,E,M,G,I,B,D,H,J,C;e.initialize_element();A=e[u]().trim();0<
A.length&&!e.get_image_element()&&(M=function(a){(a=b.UTILITIES.input_area_drop_handler(a,e.receive_HTML_from_dropped.bind(e),e))&&e.robot_in_training()&&e.robot_in_training().dropped_on_text_area(a,e,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},E=b.UTILITIES.create_text_area(A,"toontalk-html-input","My HTML is","Type here to edit the text.",M),A=function(a){a=E.button.value.trim().replace(/\xA0/g," ");e.get_frontside_element();var b=
t?"set_HTML":"set_text";e[b](a)&&e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:b,argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(E.container).css({width:"100%"}),$(E.button).css({width:"100%"}),E.button.addEventListener("change",A),E.button.addEventListener("mouseout",A),e.is_plain_text_element()&&l.appendChild(E.container),e.get_source_URL()&&(M=function(a){var c=b.UTILITIES.input_area_drop_handler(a,e.receive_URL_from_dropped.bind(e),
e);c&&e.robot_in_training()&&e.robot_in_training().dropped_on_text_area(c,e,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});a.stopPropagation()},A=function(a){a=G.button.value.trim().replace(/\xA0/g," ");e.get_frontside_element();e.set_source_URL(a)&&e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:"set_source_URL",argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},G=
b.UTILITIES.create_text_input(e.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,M),G.button.addEventListener("change",A),G.button.addEventListener("mouseout",A),l.appendChild(G.container)));m.update_style_attribute_chooser=function(){var d=function(d,e,f){var g=0<=f.get_style_attributes().indexOf(d),h=b.UTILITIES.create_check_box(g,"toontalk-style-attribute-check-box",d+"&nbsp;","Click to add or remove the '"+d+"' style attribute from my backside."),
l="toontalk-style-attribute-check-box-for-"+d,g=b.UTILITIES.create_anchor_element("i",k(d)),n=document.createElement("li");$(g).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(g).css({color:"white"});g.translate=!1;g.lang="en";h.container.appendChild(g);$(h.button).addClass(l);h.button.addEventListener("click",function(b){h.button.checked?f.add_style_attribute(d):f.remove_style_attribute(d);a(c,f,f.get_backside());f.robot_in_training()&&f.robot_in_training().edited(f,
{setter_name:h.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:d,toString:(h.button.checked?"add":"remove")+" a widget for the "+d+" attribute of",button_selector:"."+l})});n.appendChild(h.container);e.appendChild(n)},f=function(a,b,c){var e,g;"string"===typeof a?d(a,b,c):a.label?(e=document.createElement("h3"),e.textContent=a.label,g=document.createElement("ul"),b.appendChild(e),b.appendChild(g),f(a.sub_menus,g,c)):a.forEach(function(a){f(a,b,c)})};$(r).is(".ui-accordion")&&
$(r).accordion("destroy");$(r).empty();f([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],r,e);$(r).accordion({active:0,heightStyle:"content"});
return r};m.get_attributes_chooser=function(){return r};m.add_advanced_settings=function(){var a;x.call(m);a=$(l).children(".toontalk-advanced-settings-table");0<a.length&&(a.get(0).appendChild(n.container),a.get(0).appendChild(r),a.get(0).appendChild(q),e.is_plain_text_element()||a.get(0).appendChild(E.container))};e.get_sound_effect()?(D=e.get_sound_effect(),H=function(){m.visible()&&(D.paused?(b.UTILITIES.give_tooltip(I.get(0),"Click to begin playing this sound."),I.button("option","label","Play sound")):
(b.UTILITIES.give_tooltip(I.get(0),"Click to pause this sound."),I.button("option","label","Pause sound")))},I=$("<button>Play sound</button>").button(),I.addClass("toontalk-play-sound-effect-button"),A=function(a){D.paused?(b.UTILITIES.play_audio(D),D.addEventListener("ended",H)):D.pause();H();e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",e)},I.get(0).addEventListener("click",A),H(),l.appendChild(I.get(0))):$(e.get_frontside_element()).find("video").is("*")&&
(J=e.get_video_object(),C=function(){m.visible()&&(J.paused?(b.UTILITIES.give_tooltip(B.get(0),"Click to begin playing this video."),B.button("option","label","Play video")):(b.UTILITIES.give_tooltip(B.get(0),"Click to pause this video."),B.button("option","label","Pause video")))},B=$("<button>Play video</button>").button(),B.addClass("toontalk-play-video-button"),A=function(a){J.paused?(J.play(),J.addEventListener("ended",C)):J.pause();C();e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-play-video-button",
e)},B.get(0).addEventListener("click",void 0),C(),l.appendChild(B.get(0)));m.update_style_attribute_chooser();a(c,e,m);l.appendChild(c);l.appendChild(g);$(r).hide();$(r).addClass("toontalk-attributes-chooser");m.update_display=function(){E&&$(E.button).val(e[u]());a(c,e,m);$(r).is(":visible")&&m.update_style_attribute_chooser();e.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});f()};$(l).find(".toontalk-hide-backside-button").each(function(a,b){b.addEventListener("click",
function(){$(r).hide()})});n.button.checked=!e.get_ignore_pointer_events();n.button.addEventListener("click",function(){e.set_ignore_pointer_events(!n.button.checked)});return m}}}(window.TOONTALK)})();window.TOONTALK.sensor=function(e){var k=Object.create(e.widget),b=function(a,b){"element"===a.get_type_name()&&(a.set_additional_classes("toontalk-string-value-from-sensor"),b.visible()&&a.rerender())};k.create=function(a,d,h,m,l,c,r){var q=e.nest.create(h,m,"sensor",void 0,void 0,r||"sensor"),g=q.get_json,n=q.update_display,t=q.copy,u=d.split(" "),f,x=function(a){switch(typeof a){case "number":a=e.number.create(Math.round(a),1);break;case "string":a=e.element.create(a,void 0,void 0,void 0,void 0,
void 0,"toontalk-string-value-from-sensor");b(a,q);break;case "boolean":a=e.element.create(a.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");b(a,q);break}return a},A=function(b){var c,d,g;if(q.get_active()){c=f(b);d=q.get_attributes();g=q.visible();b=$(q.get_frontside_element()).closest(".toontalk-top-level-backside");if(1===c.length){if(c=x(c[0]),"undefined"===typeof c)return}else c=e.box.create(c.length,!0,c.map(x),"the values of the "+e.UTILITIES.conjunction(d)+
" attributes of "+e.UTILITIES.add_a_or_an(a)+" event.",d.join(";"));g?(g=e.bird.create(q),q.add_to_top_level_backside(g),c.render(),g.animate_delivery_to(c,q,q,b.width()/2,b.height())):q.add_to_contents(c)}}.bind(this);q.is_sensor=function(){return!0};q.copy=function(b){var d;if(b&&b.just_value&&this.has_contents())return t.call(this,b);d=b?e.sensor.create(a,this.get_attributes_string(),h,void 0,b.copying_resource||l,c,this.get_name()):e.sensor.create(a,this.get_attributes_string(),h,void 0,l,c,this.get_name());
return q.add_to_copy(d,b)};q.get_json=function(b,d,f){var h=function(f,g){var h;f.type="sensor";f.event_name=a;f.attribute=this.get_attributes_string();f.active=l;c?(h=function(a){f.sensor_of=a;d(f,g)},e.UTILITIES.get_json(c,b,h,g)):d(f,g)}.bind(this);g.call(this,b,h,f)};q.update_display=function(){var a=$(this.get_frontside_element());n.call(this);l||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):(a.addClass("toontalk-sensor-inactive-nest"),
a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};q.get_type_name=function(a){return a?"sensors":"sensor"};q.get_help_URL=function(){return"docs/manual/sensors.html"};q.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+a+" events"};q.get_class_name_with_color=function(a){return a};q.get_active=function(){return!0===l};q.restore_active=function(){"temporarily false"===l&&this.set_active(!0)};q.set_active=function(b,d){if(l!==
b||d)!0===b?c?c.get_frontside_element(!0).addEventListener(a,A):window.addEventListener(a,A):c?c.get_frontside_element(!0).removeEventListener(a,A):window.removeEventListener(a,A),l=b};q.set_running=function(a){this.set_active(a)};q.set_active(l,!0);q.create_backside=function(){return e.sensor_backside.create(this)};q.get_event_name=function(){return a};q.set_event_name=function(b){var c=l;a&&l&&this.set_active(!1);a=b;c&&this.set_active(!0)};q.get_attributes=function(){return u};q.set_attributes=
function(a){u=a.split(" ")};q.get_attributes_string=function(){return u.join(" ")};q.match=function(a){this.last_match=a;return this};q.set_sensor_of=function(a){c=a};q.get_custom_title_prefix=function(){var b="When a '"+a+"' event"+(c?" to "+c:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";l?this.get_backside()||(b+=" On my back you can change which kind of events and attributes I receive."):b+=" But I'm deactivated and can't receive anything until the 'Listening to events' check box on my back is ticked.";
return b};q.get_default_description=function(){return c?"a sensor for "+c.get_default_description():"a sensor for this document."};q.can_run=function(){return!0};f=function(a){return q.get_attributes().map(function(b){var c=a[b];if("key"===b&&void 0===c){if(c=a.keyIdentifier,0===c.indexOf("U+"))return String.fromCharCode(a.keyCode)}else if("undefined"===typeof c){if(a.detail&&a.detail.element_widget&&"widget"===b)return b=e.UTILITIES.widget_side_of_element(a.detail.element_widget).create_backside(),
b.save_dimensions(),b;if(a.detail&&void 0!==a.detail[b])return a.detail[b];c="No "+b+" in event "+a+" of sensor "+k;e.UTILITIES.display_message(c)}return c})};return q};e.creators_from_json.sensor=function(a,d){var h=e.UTILITIES.create_array_from_json(a.contents,d),k=e.sensor.create(a.event_name,a.attribute,a.description,h,!1,void 0,a.name);a.sensor_of?e.UTILITIES.set_timeout(function(){k.set_sensor_of(e.UTILITIES.create_from_json(a.sensor_of,d));k.set_active(a.active)}):k.set_active(a.active);0<
h.length&&setTimeout(function(){h.forEach(function(a){b(a.get_widget(),k)})},500);return k};return k}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(e){return{create:function(k){var b=e.UTILITIES.create_text_input(k.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+k.get_event_name()),a=e.UTILITIES.create_text_input(k.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
d=e.UTILITIES.create_check_box(k.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),h=e.nest_backside.create(k),m=h.get_element(),l=function(){k.set_event_name(b.button.value.trim())},c=function(){k.set_attributes(a.button.value.trim())},r=e.backside.create_advanced_settings_button(h,k),q=function(a){var b=d.button.checked;k.set_active(b);k.robot_in_training()&&k.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:b,toString:"change to "+(b?"active":"inactive")+" of the "+k,button_selector:".toontalk-sensor-active-check-box"});k.render();a.stopPropagation()},g=h.add_advanced_settings;m.appendChild(r);h.add_advanced_settings=function(){var e;b.button.addEventListener("change",l);a.button.addEventListener("change",c);d.button.addEventListener("click",q);g.call(h,b.container,a.container);e=$(m).children(".toontalk-advanced-settings-table");0<e.length&&e.get(0).appendChild(d.container)};return h}}}(window.TOONTALK);window.TOONTALK.tool=function(e){document.addEventListener("mousemove",function(k){e.tool.pageX=k.pageX;e.tool.pageY=k.pageY});return{add_listeners:function(k,b){var a,d,h,m,l,c=function(c){var l=k.getBoundingClientRect();b.set_held&&b.set_held(!0);m=l.height;c&&c.preventDefault();setTimeout(function(){b.held&&!b.held()||$(k).addClass("toontalk-tool-held")},200);a=$(k).offset();document.addEventListener("mousemove",q);document.addEventListener("touchmove",q);document.addEventListener("mouseup",g);
document.addEventListener("touchend",g);e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\nmouse_down at "+Date.now());h=d=0;$(".ui-tooltip").each(function(){$(this).hide()})},r=function(a){var g=k.getBoundingClientRect();b.held&&b.held()||c(a);d=e.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",a)-g.left;h=e.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",a)-g.top},q=function(a){var b=e.UTILITIES.find_widget_on_page_side(a,k,d,h-m/2),c,g,q;a.preventDefault();$(".ui-tooltip").each(function(){$(this).hide()});
g=n(a);q=e.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",a)-g.deltaX-d;a=e.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",a)-g.deltaY-h;k.style.left=q+"px";k.style.top=a+"px";e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\nmouse_move at "+Date.now()+" now at "+k.style.left+", "+k.style.top);if(b&&b.get_widget().is_top_level())l&&(e.UTILITIES.remove_highlight(),l=void 0);else{if(b&&(c=b.get_element(),c===l))return;l=c;e.UTILITIES.highlight_element(l)}},g=function(c){var n=
e.UTILITIES.find_widget_on_page_side(c,k,d,h-m/2),f;c.preventDefault();b.set_held&&b.set_held(!1);l&&e.UTILITIES.remove_highlight();n&&n.top_level_widget&&(f=n.top_level_widget(),b.apply_tool(n,c),f.backup_all());!n&&b.nothing_under_tool&&b.nothing_under_tool();$(k).removeClass("toontalk-tool-held");$(k).addClass("toontalk-tool-returning");e.UTILITIES.add_one_shot_event_handler(k,"transitionend",1E3,function(){$(k).removeClass("toontalk-tool-returning")});e.UTILITIES.set_timeout(function(){k.style.left=
a.left+"px";k.style.top=a.top+"px"});document.removeEventListener("mousemove",q);document.removeEventListener("touchmove",q);document.removeEventListener("mouseup",g);document.removeEventListener("touchend",g);e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\nmouse_up at "+Date.now(),alert(e.debugging),e.debugging="touch")},n=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,
deltaY:c}};k.addEventListener("mousedown",r);k.addEventListener("touchstart",r);return c}}}(window.TOONTALK);window.TOONTALK.vacuum=function(e){var k=Object.create(null),b={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},a={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},d={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},h=!1,m;k.create=function(){var l,c,r,q=[],g=function(b){r!==b&&(r=b,e.sounds&&e.sounds.click.play(),$(l).removeClass(c),
c=a[r],$(l).addClass(c),n())},n=function(){"restore"===r&&0===q.length?e.UTILITIES.give_tooltip(l,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):e.UTILITIES.give_tooltip(l,b[r])};document.addEventListener("keyup",function(a){var b=String.fromCharCode(a.keyCode);a.altKey&&(l||(k.the_vacuum.get_element(),$(l).css({left:e.tool.pageX,top:e.tool.pageY}),document.body.appendChild(l)),m());k.the_vacuum.held()&&("s"===b||"S"===b?g("suck"):"e"===b||"E"===
b?g("erase"):"r"===b||"R"===b?g("restore"):"a"===b||"A"===b?g("suck_all"):e.sounds&&e.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){k.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});e.vacuum.the_vacuum={apply_tool:function(a,b){var c=a.get_widget(),d=function(a){b&&c.robot_in_training()&&c.robot_in_training().removed(a);a.is_primary_backside&&a.is_primary_backside()?a.hide_backside():a===c.robot_in_training()?(a.training_finished(),
a.set_run_once(!0)):(c.is_bird()&&e.sounds&&e.sounds.bird_fly.pause(),a.is_backside()||(a.save_dimensions_of(a),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),q.push(a),a.set_running&&a.set_running(!1),a.is_backside()||a.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove(b,!0))},g,h,k;"suck"===r?a.remove&&!a.get_widget().is_top_level()&&(d(a),e.sounds&&e.sounds.vacuum_suck.play()):
"erase"===r||"restore"===r&&a.get_erased&&a.get_erased()?a.is_top_level()||(g=!a.get_erased(),e.sounds&&(g?e.sounds.vacuum_suck.play():e.sounds.vacuum_spit.play()),a.set_erased(g,!0),b&&c.robot_in_training()&&c.robot_in_training().erased_widget(a,g)):"restore"===r?0<q.length&&(g=q.pop(),g.restore_dimensions(),k=a.add_to_top_level_backside(g,!0),h=$(l).offset(),h.left-=$(k).width(),e.UTILITIES.set_absolute_position(k,h),g.this_and_walk_children&&(g.this_and_walk_children(function(a){a.is_sensor()&&
a.restore_active();return!0}),e.sounds&&e.sounds.vacuum_spit.play())):"suck_all"===r&&(g=a.top_level_widget(),h=g.get_backside_widgets().slice(),0<h.length&&e.sounds&&(e.sounds.vacuum_suck.play(),e.sounds.bird_fly.pause()),h.forEach(function(a){a&&c!==c.robot_in_training()&&d(a)}),g.set_backside_widgets([]))},nothing_under_tool:function(){g(d[r])},get_element:function(){l||(l=document.createElement("div"),$(l).addClass("toontalk-vacuum"),m=e.tool.add_listeners(l,this),g("suck"),n());return l},held:function(){return h},
set_held:function(a){h=a}};return e.vacuum.the_vacuum};e.creators_from_json.vacuum=function(a,b){var d=e.vacuum.create();a.mode&&e.UTILITIES.set_timeout(function(){d.set_mode(a.mode)});return d};return k}(window.TOONTALK);window.TOONTALK.wand=function(e){var k=Object.create(null);k.create=function(){var b;return{apply_tool:function(a){var b;"top-level"!==a.get_type_name()&&(e.sounds&&e.sounds.magic.play(),b=a.add_copy_to_container(),a.robot_in_training()&&a.robot_in_training().copied(a,b,!1))},get_element:function(){b||(b=document.createElement("div"),$(b).addClass("toontalk-wand"),e.UTILITIES.give_tooltip(b,"I'm a magic wand. Drag me over the thing you want me to copy."),e.tool.add_listeners(b,this));return b}}};
e.creators_from_json.wand=function(){return e.wand.create()};return k}(window.TOONTALK);window.TOONTALK.SETTINGS=function(e){var k=[],b=function(b,m,l){var c=[],r=e.UTILITIES.create_local_files_table(),q=function(c,d){var k=function(a){a||d.newPanel.appendChild(e.UTILITIES.create_text_element("Error connecting to cloud"))},m=d.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();d.newPanel.is(".toontalk-programs-in-cloud-table")?m?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):a(d.newPanel,"program",b,l,k):d.newPanel.is(".toontalk-pages-in-cloud-table")?
m?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):a(d.newPanel,"page",b,l,k):($("#tab-0_info").show(),$("#tab-0_wrapper").show())};c[0]="Programs stored in browser";k[0]=r;m?(c[1]="Programs in cloud",k[1]=e.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),c[2]="Published pages",k[2]=e.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table"),m=e.UTILITIES.create_tabs(c,k),l.appendChild(m),$(m).on("tabsactivate",q)):l.appendChild(e.UTILITIES.create_tabs(c,k));d(b,r,
!0,l);$(r).on("draw.dt",function(){d(b,r,!1,l)})},a=function(a,b,k,c,r){e.google_drive.get_toontalk_files(!1,b,function(q){var g;"string"===typeof q?g=q:q.error&&(g=q.error.message);g?"Need to authorize"===g||"Login Required"===g?e.google_drive.authorize(r):(console.log(g),console.log("Google drive status: "+e.google_drive.get_status()),r(null)):(g="program"===b&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",e.UTILITIES.become_file_data_table(a,q.items,!0,g),a.on("draw.dt",
function(){d(k,a.get(0),!0,c)}),r(a.get(0)))})},d=function(a,b,d,c){var e=function(b){var e=function(){$(c).remove()},k=function(){a.set_setting("program_name",b.target.textContent);a.load(d,e)}.bind(this);a.save(!0,void 0,k)};b=$(b).find(".toontalk-file-load-button-without-click-handler");b.each(function(a,b){b.addEventListener("click",e)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(a){var d=document.createElement("div"),k=a.get_backside_element(),c=a.get_setting("program_name"),
r=e.UTILITIES.create_text_input(c,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),q=e.UTILITIES.create_close_button(function(){$(d).remove()},"Click to close the settings panel."),g=e.UTILITIES.create_text_element("How should your program be saved?"),n=e.UTILITIES.create_check_box(a.get_setting("auto_save_to_google_drive"),"toontalk-save-setting","Save automatically to my Google Drive",'Check this if you want your programs automatically saved to a "ToonTalk Programs" folder in your Google Drive.'),
t=e.UTILITIES.create_check_box(a.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage","Check this if you want your programs automatically saved in this browser's local storage."),u=e.UTILITIES.create_button("Save to Google Drive now","toontalk-save-button","Click to save your program now to your Google Drive account.",function(){a.save(!0,{google_drive:!0})}),f=e.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button",
"Click to save your program now to this browser's local storage.",function(){a.save(!0,{local_storage:!0})}),x=e.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){e.google_drive.authorize(function(){$(x).remove()})}),A=e.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){e.UTILITIES.display_message("Creating your web page...");
a.publish(M,E.button.checked)}),E=e.UTILITIES.create_check_box(a.get_setting("publish_as_workspace"),"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),M=function(b,c){var d=document.createElement("span"),f=e.google_drive.google_drive_url(b.id);e.TRANSLATION_ENABLED&&(f=e.UTILITIES.add_URL_parameter(f,"translate","1"));d.innerHTML="Published: <a href='"+f+"' target='_blank'>"+a.get_setting("program_name")+
"</a>";f=$(r.container).children("tr");e.UTILITIES.display_message("Your web page is ready for you to edit. Just click on the link.");0<f.length&&f.get(0).appendChild(e.UTILITIES.create_table_entry(d))},G=document.createElement("div"),I=e.google_drive&&"undefined"!==typeof gapi?e.google_drive.get_status():"Google Drive API not loaded",B=!0,D=e.UTILITIES.create_vertical_table(A,E.container),H=$(r.container).children("tr");$(d).addClass("toontalk-settings-panel").css({width:$(k).width()+29,height:$(k).height()+
50,left:-2,top:-25,"z-index":e.UTILITIES.next_z_index()});d.appendChild(q);r.button.addEventListener("change",function(){var b=r.button.value.trim();c!==b&&a.save(!0,void 0,function(){c=b;a.set_setting("program_name",b);a.load(!0,function(){setTimeout(function(){$(d).css({"z-index":e.UTILITIES.next_z_index()})},500)},function(){a.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();e.UTILITIES.display_message("Your program was copied and the new copy's name is '"+a.get_setting("program_name")+
"'.")})})})});n.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_google_drive:t.button.checked,gooogle_drive:!0});a.set_setting("auto_save_to_google_drive",n.button.checked);n.button.checked?$(u).hide():$(u).show()});t.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_local_storage:t.button.checked,local_storage:!0});a.set_setting("auto_save_to_local_storage",t.button.checked);t.button.checked?$(f).hide():$(f).show()});E.button.addEventListener("click",function(b){a.set_setting("publish_as_workspace",
E.button.checked)});d.appendChild(G);$(g).css({"font-weight":"bold","font-size":24,color:"navy"});G.appendChild(g);G.appendChild(r.container);G.appendChild(n.container);G.appendChild(t.container);n.container.appendChild(e.UTILITIES.create_space());n.container.appendChild(u);a.get_setting("auto_save_to_google_drive")&&$(u).hide();t.container.appendChild(e.UTILITIES.create_space());t.container.appendChild(f);a.get_setting("auto_save_to_local_storage")&&$(f).hide();"Need to authorize"===I?(n.container.appendChild(e.UTILITIES.create_space()),
n.container.appendChild(x)):"Authorized"!==I&&"Ready"!==I&&"Authorized but not yet ready"!==I&&(B=!1,a.set_setting("google_drive_unavailable",!0),setTimeout(function(){n.button.disabled=!0;$(A).button("option","disabled",!0);$(u).button("option","disabled",!0);e.UTILITIES.give_tooltip(n.container,"Inactivated because attempt to connect to Google Drive returned: "+I);A.title=n.container.title;u.title=n.container.title},1));0<H.length&&H.get(0).appendChild(e.UTILITIES.create_table_entry(D));b(a,B,d);
k.appendChild(d)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",auto_save_to_google_drive:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(e){var k=[],b=0,a=!1,d=!1;return{pending_update:function(a){0<=k.indexOf(a)||(k.push(a),this.update_display())},update_display:function(){var e;d||document.hidden||0===k.length||(e=Date.now(),e<b?(d=!0,setTimeout(this.update_display_workhorse.bind(this),b-e)):a||(d=!0,setTimeout(function(){this.update_display_workhorse(e)}.bind(this))))},update_display_workhorse:function(h){var m=k,l=function(a,b){$(a).children().each(function(a,c){$(c).css({"z-index":b+1});
l(c,b+1)})};k=[];a=!0;d=!1;b=(h|Date.now())+50;m.forEach(function(a){var b=a.get_element&&a.get_element(),d,g,h;if(a.visible()||$(b).is(".toontalk-top-level-resource"))a.update_display(),a.get_backside&&(g=a.get_backside())&&g.visible()&&g.update_display(),setTimeout(function(){e.UTILITIES.use_custom_tooltip(b)}),d=$(b).parent().closest(".toontalk-side"),d.is("*")&&0===d.find(".toontalk-side-animating, .toontalk-side-appearing").length&&(g=e.UTILITIES.get_style_numeric_property(b,"z-index"),h=e.UTILITIES.get_style_numeric_property(d.get(0),
"z-index"),h||(h=e.UTILITIES.next_z_index(),d.css({"z-index":h})),!g||d.is(".toontalk-top-level-backside")?(g=e.UTILITIES.next_z_index(),$(b).css({"z-index":g})):g>=h&&(g=h+1,$(b).css({"z-index":g})),l(b,g)),b&&!$(b).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&e.UTILITIES.set_timeout(function(){d.is(".toontalk-box-hole")?$(b).is(".ui-resizable")&&
$(b).resizable("destroy"):$(b).is(".ui-resizable")||e.UTILITIES.make_resizable($(b),a)})});a=!1;0<k.length&&(d=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(e){e.creators_from_json.body=function(k,b){var a=e.actions.create();b.body=a;a.initialise_steps(e.UTILITIES.create_array_from_json(k.steps,b));return a};return{create:function(k){var b=Object.create(this),a=[];k||(k=[]);b.copy=function(){return e.actions.create(e.UTILITIES.copy_array(k))};b.get_steps=function(){return k};b.initialise_steps=function(a){k=a};b.is_empty=function(){return 0===k.length};b.reset_steps=function(){k=[];this.reset_newly_created_widgets()};
b.reset_newly_created_widgets=function(){e.logging&&0<=e.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+a.length);a=[]};b.add_step=function(a,b){a?(k.push(a),b&&this.add_newly_created_widget_if_new(b)):e.UTILITIES.report_internal_error("Attempt to add an undefined step.")};b.add_newly_created_widget_if_new=function(b){0<=a.indexOf(b)||this.add_newly_created_widget(b)};b.add_newly_created_widget=function(b){e.debugging&&0<=a.indexOf(b)?console.log("add_newly_created_widget called with not new widget."):
(a.push(b),e.logging&&0<=e.logging.indexOf("newly-created")&&console.log("Added "+b.to_debug_string()+" to list of newly_created_widgets. Length is "+a.length))};b.is_newly_created=function(b){return 0<=a.indexOf(b)};b.get_newly_created_widgets=function(){return a};b.get_path_to=function(b,h,k){var l,c;a.some(function(a,q){if(a===b||k&&a.get_widget()===b)return l=e.newly_created_widgets_path.create(q),!0;if(a.get_path_to&&(c=a.get_path_to(b,h)))return l=e.newly_created_widgets_path.create(q),l.next=
c,!0});return l};b.dereference_path=function(b){e.debugging&&!a[b]&&e.UTILITIES.report_internal_error("Expected to find the "+e.UTILITIES.ordinal(b)+" newly created widget.");return a[b]};return b},run_unwatched:function(k,b){var a=this.get_steps();e.logging&&0<=e.logging.indexOf("run")&&console.log(k.to_debug_string()+" running unwatched");b||(b=0);k.run_next_step=function(){if(b<a.length){var d=a[b];b++;e.logging&&0<=e.logging.indexOf("event")&&console.log(d+" (unwatched)");d.run_unwatched(k)}else k.set_running_or_in_run_queue(!1),
k.run_body_finished_listeners(),k.get_run_once()?k.get_first_in_team().set_running(!1):k.get_first_in_team().run()};k.run_next_step()},run_watched:function(k){var b=this.get_steps(),a=k.get_frontside_element(),d,h,m=a.parentElement,l=k.get_first_in_team(),c=function(){var b=l.visible()&&0!==l.get_maximum_step_duration(),c=function(){b&&(m&&m.appendChild(a),k.set_animating(!1));l===k?e.UTILITIES.set_absolute_position(a,q):(e.UTILITIES.set_css(a,{position:"static"}),h.get_backside(!0).get_next_robot_area().appendChild(a));
k.get_run_once()?l.set_running(!1):k.stopped()?$(a).removeClass(".toontalk-side-animating"):l.run();k.rerender()};b?(a.parentElement||k.get_parent_of_frontside().get_frontside_element().appendChild(a),e.UTILITIES.animate_to_absolute_position(a,q,c,k&&k.transform_animation_speed(e.UTILITIES.default_animation_speed))):(k.set_animating(!1),c(),k===l&&k.get_context().add_backside_widget(k),$(k.get_frontside_element()).remove())},r=0,q=$(a).offset(),g=$(a).offset(),n=$(a).width(),t=$(a).height(),u=k.get_first_in_team().top_level_widget(),
f=$(a).closest(".toontalk-top-level-backside").offset(),x=k.get_context().get_backside(),A,E;e.logging&&0<=e.logging.indexOf("run")&&console.log(k.to_debug_string()+" running watched");A=(h=k.get_previous_robot())?$(h.get_backside(!0).get_next_robot_area()):$(x.get_backside_element(!0));!e.UTILITIES.is_attached(a)&&h&&(h.open_backside(),h.get_backside().set_advanced_settings_showing(!0),(d=a.parentElement)||(d=A.get(0)),k.set_visible(!0),k.update_display(),k.add_body_finished_listener(function(){d&&
d.appendChild(a);$(a).css({left:"",top:"",position:"","z-index":""})}));0===n&&($(a).css({width:"",height:""}),n=k.saved_width||$(a).width(),t=k.saved_height||$(a).height());f||(f={left:0,top:0});0<A.length&&(E=A.get(0).getBoundingClientRect(),q.left<E.left-f.left||q.top<E.top-f.top||q.left+n>E.right+f.left||q.top+t>E.bottom+f.top)&&(q=A.offset(),q.left+=A.width()/2,q.top+=A.height()-t,g=q);k.start_offset=g;u.get_backside_element().appendChild(a);e.UTILITIES.set_absolute_position(a,q);k.run_next_step=
function(){x&&!document.hidden&&(x.visible()||e.UTILITIES.visible_element(x.get_element()))?setTimeout(function(){k.run_watched_step_end_listeners();if(r<b.length&&!k.stopped()){var a=b[r];r++;e.logging&&0<=e.logging.indexOf("event")&&console.log(a+" (watched)");a.run_watched(k);k.get_thing_in_hand()&&(k.get_thing_in_hand().save_dimensions(),k.rerender())}else k.set_running_or_in_run_queue(!1),c(),k.run_body_finished_listeners()},k.transform_step_duration(50)):(k.set_running_or_in_run_queue(!1),k.set_animating(!1),
$(a).css({width:"",height:""}),a.style.transitionDuration="",m&&m.appendChild(a),this.run_unwatched(k,r))}.bind(this);k.set_animating(!0,q);k.run_next_step();return!0},toString:function(e){for(var b="",a=this.get_steps().map(function(a){return a&&a.toString(e)});""===a[a.length-1];)a.pop();a.forEach(function(d,e){d&&(b+=d,b=e===a.length-2?b+" and \n":e<a.length-2?b+", \n":b+".")});return b},get_json:function(k,b,a){var d=[];e.UTILITIES.get_json_of_array(this.get_steps(),d,0,k,function(){b({type:"body",
steps:d},a)},a)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(e){e.creators_from_json.newly_created_widgets_path=function(k){return e.newly_created_widgets_path.create(k.index)};return{create:function(k){return{dereference_path:function(b){var a=b.get_body().dereference_path(k),d;if(this.next)return e.path.dereference_path(this.next,b,a);this.removing_widget&&(d=a.get_parent_of_frontside())&&d.removed_from_container&&b.remove_from_container(a,d);return a},toString:function(){return"the "+e.UTILITIES.ordinal(k)+
" new widget"},get_json:function(b,a,d){a({type:"newly_created_widgets_path",index:k},d)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(e){var k={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b){b.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b){var c=a.copy();b.add_newly_created_widget(c);b.set_thing_in_hand(c);return!0},"drop it on":function(a,b,c){var d;if(a)if(d=b.get_thing_in_hand()){if(d.drop_on)return e.debugging&&d===a&&e.UTILITIES.report_internal_error("Dropping something on itself! "+a),$(d.get_frontside_element()).remove(),d.drop_on(a,
void 0,b),b.set_thing_in_hand(void 0),a.rerender(),d.robot_waiting_before_next_step===b?(c&&c.running_watched||(d.robot_waiting_before_next_step=void 0),!1):!0;e.debugging&&e.UTILITIES.report_internal_error("Thing in robot's hand ("+d+") doesn't handle 'drop_on'. Robot that "+b)}else!b.being_trained&&e.debugging&&e.UTILITIES.report_internal_error("The robot that '"+b.toString()+"' is executing drop_on but has nothing in its hand.");else e.debugging&&e.UTILITIES.report_internal_error("The robot that '"+
b.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(a,b,c){var d;if(a){if(d=b.get_thing_in_hand())return b.set_thing_in_hand(void 0),a[c.setter](d),!0;e.UTILITIES.report_internal_error("The robot that '"+b.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else e.UTILITIES.report_internal_error("The robot that '"+b.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},
remove:function(a,b){a.remove();a===b&&b.set_stopped(!0);return!0},"change whether erased":function(a,b,c){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;e.UTILITIES.display_message("Robot is unable to erase "+a)},edit:function(a,b,c){if(a[c.setter_name])return c.argument_2?a[c.setter_name].call(a,c.argument_1,c.argument_2,a.visible()):a[c.setter_name].call(a,c.argument_1,a.visible()),!0;e.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c){return!0},
"add to the top-level backside":function(a,b,c){var d,f;b.visible()||(d=a.get_frontside_element(!0),c=$(b.get_context().get_frontside_element()).position(),f=$(b.get_context().get_frontside_element()).closest(".toontalk-top-level-backside").get(0)||$(d).closest(".toontalk-top-level-backside").get(0),$(d).css({left:c.left,top:c.top}),f.appendChild(d),f.toontalk_widget_side.get_widget().add_backside_widget(a),a.animate_to_element(f,void 0,b.transform_animation_speed(e.UTILITIES.default_animation_speed)));
return!0},"add a new widget to the work space":function(a,b,c){b.get_context().is_top_level()?(c=b.add_to_top_level_backside(a),b=$(b.get_frontside_element()).offset(),a.update_display(),e.UTILITIES.set_position_relative_to_top_level_backside($(c),b,!0)):a.drop_on(b.get_context().get_backside(),void 0,b,!0);return!0},"start training":function(a,b,c){a.training_started(b);return!0},"stop training":function(a,b,c){a.training_finished();return!0},train:function(a,b,c){a.add_step(c.step)},"open the backside":function(){return!0},
"close the backside":function(){return!0},"click the button of":function(){return!0}},b=function(a,b,c,d){var f=b.get_thing_in_hand(),h=b.get_frontside_element(),k=a.get_element(),l,m,q,r,B,D,H,J;k||(k=e.UTILITIES.find_resource_equal_to_widget(a));e.UTILITIES.is_attached(k)&&b.visible()?(l=$(k).width(),m=$(k).height(),d&&d.left_offset_fraction?(b.original_animation_left_offset||(b.original_animation_left_offset=[]),b.original_animation_top_offset||(b.original_animation_top_offset=[]),B=d.left_offset_fraction*
l,D=d.top_offset_fraction*m,f&&(H=f.get_element(),e.UTILITIES.visible_element(H)&&(J=$(H).offset(),h=$(h).offset(),B-=J.left-h.left,D-=J.top-h.top)),f&&0<=b.original_animation_left_offset.indexOf(B)&&0<=b.original_animation_top_offset.indexOf(D)?(B=b.animation_left_offset+b.last_thing_in_hand_width,D=b.animation_top_offset,B>=l&&(B=0,D+=b.max_thing_in_hand_height,D>=m&&(D=0)),b.last_thing_in_hand_width=$(H).width(),"undefined"===typeof b.max_thing_in_hand_height&&(b.max_thing_in_hand_height=0),b.max_thing_in_hand_height=
Math.max(b.max_thing_in_hand_height,$(H).height())):(b.original_animation_left_offset.push(B),b.original_animation_top_offset.push(D),b.last_thing_in_hand_width=$(H).width(),b.max_thing_in_hand_height=$(H).height()),k.animation_left_offset=B,k.animation_top_offset=D,b.animation_left_offset=B,b.animation_top_offset=D):(q=l/2,r=m/2),b.animate_to_widget(a,c,b.transform_animation_speed(.25),q,r,!0,b.transform_original_step_duration(d&&d.time))):c()},a=function(a,c,d,e){b(a,c,function(){a.open_backside(d);
r(a,c)},e)},d=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},h=function(a,b,c,h,f,k){var l=d(a,h);b.get_frontside_element();var m=l&&$(l).is(":visible"),q=function(){c(l);$(l).addClass("ui-state-active");if(".toontalk-select-function"===h||".toontalk-box-size-input"===h)l.value=f.argument_1;setTimeout(function(){$(l).removeClass("ui-state-active");!m&&a.get_backside()&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()});b.run_next_step()},
k)},G=function(){!e.UTILITIES.visible_element(l)&&I&&I.set_advanced_settings_showing(!0,I.get_element());b.animate_to_element(l,q,b.transform_animation_speed(e.UTILITIES.default_animation_speed/2),0,0,!0)},I;!m&&a.open_backside&&b.animate_consequences_of_actions()?(a.open_backside(G),r(a,b)):G()},m=function(a,b,c,d,f){f=$("."+f).get(0);var h=function(){l(a,b,c,d)};f&&b.animate_consequences_of_actions()?b.animate_to_element(f,h,b.transform_animation_speed(e.UTILITIES.default_animation_speed),0,0,!0):
h()},l=function(a,b,c,d){b.get_frontside_element();var f=function(){b.carrying_tool=void 0;b.update_display();c();b.run_next_step()};b.animate_consequences_of_actions()?(b.carrying_tool=d,b.update_display(),b.animate_to_element(a.get_element(),f,b.transform_animation_speed(e.UTILITIES.default_animation_speed/2),0,0,!0)):(c(),b.run_next_step())},c=function(a,b,c){var d=a.get_parent_of_frontside();m(a,b,function(){c();d&&"top-level"!==d.get_widget().get_type_name()&&d.update_display&&d.update_display();
a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")},r=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},q={copy:function(a,b,c){m(a,b,function(){c();a.add_copy_to_container(b.get_recently_created_widget())},"toontalk-wand-small","toontalk-wand")},"pick up":function(a,c,d,h){var f=function(){d();c.animate_consequences_of_actions()&&c.update_display();c.run_next_step()};e.debugging&&"empty hole"===a.get_type_name()?e.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):
a.save_dimensions()&&c.animate_consequences_of_actions()?b(a,c,f,h):f()},"pick up a copy of":function(a,c,d,h){b(a,c,function(){var b;d();c.animate_consequences_of_actions()&&(b=c.get_recently_created_widget())&&(b.set_visible(!0),e.UTILITIES.copy_frontside_dimensions(a,b),c.update_display());c.run_next_step()},h)},"drop it on":function(c,d,h,k){var f=d.get_thing_in_hand(),l,m;f?(e.debugging&&f===c&&e.UTILITIES.report_internal_error("Dropping something on itself!"),l=f.get_element(!0),f.set_visible(d.visible()),
m=function(){var a;$(l).removeClass("toontalk-held-by-robot");f.drop_on&&(d.animate_consequences_of_actions()&&!e.UTILITIES.visible_element(l)&&(a=$(d.get_frontside_element()).closest(".toontalk-top-level-backside"),0<a.length&&a.get(0).appendChild(l)),d.rerender());h();f.drop_on&&f.visible()&&(e.UTILITIES.set_absolute_position(l,$(l).offset()),f.restore_dimensions());f.robot_waiting_before_next_step!==d&&d.run_next_step()},c.is_backside()&&!e.UTILITIES.visible_element(c.get_element())?a(c.get_widget(),
d,m,k):b(c,d,m,k)):(e.debugging&&(e.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+d)),b(c,d,h,k))},"drop it on the text area of":function(c,d,h,k){var f=d.get_thing_in_hand(),l,m,q,r;f?(l=f.get_element(!0),f.set_visible(d.visible()),m=function(){var a;$(l).removeClass("toontalk-held-by-robot");h();f.remove();a=c.get_parent_of_frontside().get_widget();a.is_hole()&&(a=a.get_parent_of_frontside());a.is_top_level()?c.render():a.render();d.set_thing_in_hand(void 0);
d.run_next_step()},q=function(){return $(c.get_backside_element()).find(k.area_selector).get(0)},d.rerender(),e.UTILITIES.visible_element(c.get_backside_element())?(r=q(),d.animate_to_element(r,m,d.transform_animation_speed(e.UTILITIES.default_animation_speed/2),0,0,!0)):a(c,d,function(){r=q();d.animate_to_element(r,m,d.transform_animation_speed(e.UTILITIES.default_animation_speed/2),0,0,!0)},k)):(e.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+
d),b(c,d,h,k))},remove:c,"change whether erased":c,edit:function(a,b,c,d){h(a,b,function(){a.get_backside()&&a.get_backside().update_display();c()},d.button_selector,d,b.transform_step_duration(1E3))},"change size of":function(a,b,c,d){var f=a.get_frontside_element();f?b.animate_to_element(f,function(){var e=$(f).width(),h=$(f).height(),e=e*d.x_factor,h=h*d.y_factor,k=b.transform_step_duration(1E3);$(f).addClass("toontalk-animating-element");f.style.transitionDuration=k+"ms";f.style.width=e+"px";
f.style.height=h+"px";setTimeout(function(){$(f).removeClass("toontalk-animating-element");f.style.transitionDuration="";c();a.render();b.run_next_step()},k)},b.transform_animation_speed(e.UTILITIES.default_animation_speed),0,0,!0):(c(),b.run_next_step())},"add to the top-level backside":function(a,b,c){c();b.run_next_step()},"add a new widget to the work space":function(a,b,c,d){d&&d.button_selector?(a=e.path.dereference_path(d.path_to_source,b),h(a,b,c,d.button_selector,d,b.transform_step_duration(3E3))):
(c(),b.run_next_step())},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by={element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step()},"stop training":function(a,b,c,d){var f=a.get_frontside_element();h(a,b,function(){var d=function(){f.toontalk_return_to=
void 0;a.get_backside().change_label_and_title_of_train_button(!1);$(f).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");f.toontalk_followed_by=void 0;setTimeout(c,b.transform_step_duration(1500))};f.toontalk_return_to?e.UTILITIES.animate_to_absolute_position(f,f.toontalk_return_to,d,b.transform_animation_speed(e.UTILITIES.default_animation_speed)):d()},".toontalk-train-backside-button",d,b.transform_step_duration(1E3))},train:function(a,b,c,d){var e=function(){c();b.run_next_step()};
(d=d.step.run_watched)?(a.run_next_step=e,a.set_context(a.get_parent_of_frontside().get_widget()),d(a)):e()},"open the backside":function(a,b,c){a.open_backside(function(){c();b.run_next_step()});r(a,b)},"close the backside":function(a,b,c,d){d=b.transform_original_step_duration(d&&d.time);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();c();b.run_next_step()},d)},"click the button of":function(a,b,c,d){h(a,b,function(a){$(a).click();c()},d.button_selector)}};
e.creators_from_json.robot_action=function(a,b){return a.additional_info?e.robot_action.create(e.path.create_from_json(a.path,b),a.action_name,e.UTILITIES.create_keys_from_json(a.additional_info,b)):e.robot_action.create(e.path.create_from_json(a.path,b),a.action_name)};return{create:function(a,b,c){var d=Object.create(this),f=k[b],h=q[b];if(h)return a||e.UTILITIES.report_internal_error("path undefined in "+b+" action"),f||e.UTILITIES.report_internal_error("no run_function for "+b),d.get_action_name=
function(){return b},d.get_additional_info=function(){return c},d.run_unwatched=function(b){var d=e.path.dereference_path(a,b);if(!d)return e.UTILITIES.report_internal_error("Unable to dereference path: "+e.path.toString(a)+" in context: "+b.get_context()),!1;e.logging&&0<=e.logging.indexOf("event")&&(d.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+d.wait_until_this_nest_receives_something.to_debug_string()+"("+e.path.toString(a)+") by unwatched "+
b.to_debug_string()):console.log("   "+d.to_debug_string()+" ("+e.path.toString(a)+" "+d.to_debug_string()+" by unwatched "+b.to_debug_string()));d.wait_until_this_nest_receives_something?d.wait_until_this_nest_receives_something.run_when_non_empty(function(){this.run_unwatched(b)}.bind(this),b):f(d,b,c)&&b.run_next_step()},d.run_watched=function(b){var d=e.path.dereference_path(a,b),k=function(){if(!b.stopped()||b.being_trained)c||(c={}),c.running_watched=!0,f(d,b,c)};d?(e.logging&&0<=e.logging.indexOf("event")&&
console.log("   "+d+" ("+e.path.toString(a)+" "+d.to_debug_string()+" by watched "+b.to_debug_string()+(b.animate_consequences_of_actions()?"":" finishing instantly")),d.wait_until_this_nest_receives_something?(d.wait_until_this_nest_receives_something.run_when_non_empty(function(){b.set_waiting(!1);this.run_watched(b)}.bind(this),b),b.set_waiting(!0),TOONTALK.UTILITIES.visible_element(b.get_context().get_backside_element())||b.get_frontside().remove()):h(d,b,k,c)):e.UTILITIES.report_internal_error("Unable to dereference the path: "+
e.path.toString(a)+" in context: "+b.get_context())},d.toString=function(d){var f="",h="",k=b,l;if("open the backside"===b||"close the backside"===b)return"";if("click the button of"===b)switch(c.button_selector){case ".toontalk-green-flag":k="click the green flag "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" of";break;case ".toontalk-stop-sign":k="click the stop sign "+e.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";
break;case ".toontalk-play-sound-effect-button":k="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":k="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":k="click the button to add or remove attributes of ";break;case ".toontalk-remove-backside-and-widget-buttton":k="click the button to remove the back and front of ";break;default:k="click a button of"}if("add a new widget to the work space"===b)return b.replace("a new widget",e.path.toString(a));
if("add to the top-level backside"===b)return"";d||(d={});l=e.path.toString(a,d);if("edit"===b||"drop it on the text area of"===b)f=" ("+c.toString+")";else if("train"===b){f=c.step.toString({person:"third"});if(""===f)return f;f=" to "+f;h="- ";d&&d.robot_being_trained_description&&(l=d.robot_being_trained_description)}else"start training"===b?d&&(d.robot_being_trained_description="it"):"stop training"===b&&(l=d.robot_being_trained_description,d.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(b)){if(0<=
l.indexOf("hole of"))return h+k+" what is in "+l+f;if(0===l.indexOf("a When"))return l=l.substring(3),l=e.UTILITIES.remove_encoded_HTML(l),l=e.UTILITIES.elide(l,80,1),"."===l[l.length-1]&&(l=l.substring(0,l.length-1)),h+k+" a robot who w"+l+f+"\n"}return h+k+" "+l+f},d.get_json=function(d,f,h){var k=function(c,h){e.path.get_json(a,d,function(a,d){f({type:"robot_action",action_name:b,path:a,additional_info:c},d)},h)};c?e.UTILITIES.get_json_of_keys(c,["running_watched"],k,h):k(void 0,h)},d;e.UTILITIES.report_internal_error("No watched function for "+
b)}}}(window.TOONTALK);window.TOONTALK.queue=function(e){var k={create:function(){var b=Object.create(this);b.to_run=e.UTILITIES.create_queue();b.run_function=b.run.bind(b);return b},enqueue:function(b){b.running_or_in_run_queue()||(b.set_running_or_in_run_queue(!0),this.to_run.enqueue(b)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var b,a;this.running=!0;for(b=Date.now()+k.maximum_run;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<b;)a=this.to_run.dequeue(),a.run_actions();this.to_run.isEmpty()?this.running=!1:e.UTILITIES.set_timeout(this.run_function)}};return k}(window.TOONTALK);window.TOONTALK.path=function(e){var k;e.creators_from_json["path.to_entire_context"]=function(){return e.path.to_entire_context()};e.creators_from_json["path.to_widget_on_nest"]=function(){return e.path.to_widget_on_nest()};e.creators_from_json["path.top_level_backside"]=function(){return e.path.top_level_backside};e.creators_from_json["path.to_backside_widget_of_context"]=function(b,a){return"undefined"===typeof b.backside_index?e.path.get_path_to_backside_widget_of_context(b.type_name,a&&a.robot):
e.path.get_path_to_backside_index_of_context(b.backside_index,b.type_name,a&&a.robot)};e.creators_from_json["path.to_resource"]=function(b,a){return e.path.get_path_to_resource(e.UTILITIES.create_from_json(b.resource,a))};return{get_path_to:function(b,a,d){var h=function(a,b){var c=b.get_training_context(),h=b.get_body(),k,g,n;a.is_primary_backside&&a.is_primary_backside()&&(n=!0,a=a.get_widget());if(c===a)return k=e.path.to_entire_context(),k.is_backside=n,k;g=a.get_type_name();if("top-level"===
g)return e.path.top_level_backside;if(k=h.get_path_to(a,b,d))return k.is_backside=n,k;if("element attribute"===g&&a.get_original_attribute_widget()===a)return k=e.element.create_attribute_path(a,b),k.is_backside=n,k;if(e.debugging&&!c)e.UTILITIES.report_internal_error("No context to compute the path");else{if(c.get_path_to&&(h=c.get_path_to(a,b)))return h.is_backside=n,k=e.path.to_entire_context(),k.next=h,k;c.get_backside_widgets().some(function(c){c=c.get_widget();var d;if(c===a||c.top_contents_is&&
c.top_contents_is(a))return b.add_to_backside_conditions(c),k=e.path.get_path_to_backside_widget_of_context(c,b),k.is_backside=n,!0;if(c.get_path_to&&(d=c.get_path_to(a,b)))return d.is_backside=n,b.add_to_backside_conditions(c),k=e.path.get_path_to_backside_widget_of_context(c,b),k.next=d,!0});if(k)return k.is_backside=n,k;if(c=a.ancestor_of_type("robot"))return e.robot.find_conditions_path(a,c,b);k=e.path.get_path_to_resource(a.copy());k.is_backside=n;return k}}(b,a);h&&b.dereference_contents&&(e.path.path_end(h).not_to_be_dereferenced=
!0);!h||"pick up"!==a.current_action_name&&"remove"!==a.current_action_name||(e.path.path_end(h).removing_widget=!0);return h},path_end:function(b){for(;b.next;)b=b.next;return b},dereference_path:function(b,a,d){var e;b?b.dereference_path?e=b.dereference_path(a,d):d&&d.dereference_path&&(e=d.dereference_path(b,a)):e=d||a.get_context();return e&&b&&b.is_backside?e.get_backside(!0):e},continue_dereferencing_path:function(b,a,d){void 0===a&&d.context_is_backside()&&(a=d.get_top_level_context());void 0===
a&&(a=d.get_context());return b.next?a.dereference_contents&&!b.next.not_to_be_dereferenced?(a=a.dereference_contents(b.next,d))&&b.is_backside?a.get_backside(!0):a:(a=a.dereference_path(b.next,d))&&b.next.is_backside?a.get_backside(!0):a:a.dereference_contents&&!b.not_to_be_dereferenced?(a=a.dereference_contents(b,d))&&b.is_backside?a.get_backside(!0):a:a},toString:function(b,a){var d="",k;if(!b)return"undefined path";b.is_backside&&(d="the backside of ");a||(a={});k=a.resource;a.resource=!0;b.next?
(e.path.toString(b.next,a),d=d+e.path.toString(b.next,a).trim()+" of "+b.toString(a)):d+=b.toString(a);a.resource=k;return d},get_json:function(b,a,d,k){var m,l;b.get_json?(m=function(c,k){b.is_widget&&(c=b.add_to_json(c,a));b.next&&(l=function(a){c.next_path=a},e.path.get_json(b.next,a,l,k));b.removing_widget&&(c.removing_widget=!0);b.not_to_be_dereferenced&&(c.not_to_be_dereferenced=!0);if(!0===b.is_backside||b.is_backside&&b.is_backside())c.is_backside=!0;d(c,k)},b.get_json(a,m,k)):d(b,k)},to_entire_context:function(b){return{dereference_path:function(a,
b){return e.path.continue_dereferencing_path(this,b,a)},toString:function(a){return a&&a.robot?a.robot.get_top_level_context_description(a):a&&"third"===a.person?"what he's working on":"what I'm working on"},get_json:function(a,b,e){b({type:"path.to_entire_context"},e)}}},to_widget_on_nest:function(){return{dereference_path:function(b,a){return e.path.continue_dereferencing_path(this,a,b)},toString:function(){return"what is on the nest"},get_json:function(b,a,d){a({type:"path.to_widget_on_nest"},
d)}}},get_path_to_resource:function(b){b||console.error("Widget missing in get_path_to_resource.");b=b.get_widget();return{dereference_path:function(a){var d=b.copy({copying_resource:!0}),k,m,l;a.add_newly_created_widget(d);a.visible()&&(k=e.UTILITIES.find_resource_equal_to_widget(b))&&(d.save_dimensions_of(e.UTILITIES.widget_side_of_element(k)),l=d.get_frontside_element(),m=$(k).position(),e.UTILITIES.set_timeout(function(){$(l).css({left:m.left,top:m.top,width:$(k).width(),height:$(k).height()})}));
return d},toString:function(a){return e.UTILITIES.add_a_or_an(b.toString(a))},get_json:function(a,d,k){b.get_json(e.UTILITIES.fresh_json_history(a),function(a,b){d({type:"path.to_resource",resource:a},b)},k)}}},get_path_to_backside_widget_of_context:function(b,a){return"string"===typeof b?{dereference_path:function(a){var k=a.get_context(),m=a.get_backside_widget_of_type(b,k);m||k.get_backside_widgets().some(function(e){if(e.get_widget().is_of_type(b)&&!a.is_newly_created(e.get_widget()))return m=
e.get_widget(),!0});if(m)return e.path.continue_dereferencing_path(this,m,a)},toString:function(a){a=(a&&a.robot&&a.robot.get_backside_conditions()?a.robot.get_backside_conditions()[b]:e.UTILITIES.add_a_or_an(b))+" on the back of what I'm working on";return this.removing_widget?"what is on "+a:a},get_json:function(a,e,k){e({type:"path.to_backside_widget_of_context",type_name:b},k)}}:this.get_path_to_backside_index_of_context(a.get_backside_condition_index(b),b.get_type_name(),a)},get_path_to_backside_index_of_context:function(b,
a,d){return{dereference_path:function(a){var d=a.get_backside_matched_widgets()[b];if(d)return e.path.continue_dereferencing_path(this,d,a);e.debugging&&console.log("can this happen?")},toString:function(b){b=d.get_frontside_conditions().is_top_level()?"work area":"back of what";b=e.UTILITIES.add_a_or_an(a||"thing")+" on the "+b+" I'm working on";return this.removing_widget?"what is on "+b:b},get_json:function(d,e,k){e({type:"path.to_backside_widget_of_context",type_name:a,backside_index:b},k)}}},
create_from_json:function(b,a){var d=e.UTILITIES.create_from_json(b,a);b.next_path&&(d.next=this.create_from_json(b.next_path,a));b.removing_widget&&(d.removing_widget=!0);b.not_to_be_dereferenced&&(d.not_to_be_dereferenced=!0);b.is_backside&&(d.is_backside=!0);return d},top_level_backside:{dereference_path:function(b){if(b=b.get_context().ancestor_of_type("top-level"))return b;k||(k=e.widget.create_top_level_widget());return k},toString:function(){return"the top-level backside"},get_json:function(b,
a,d){a({type:"path.top_level_backside"},d)}}}}(window.TOONTALK);window.TOONTALK.publish=function(e){var k=function(b,a,d){var e='<!DOCTYPE html>\n<html>\n<head>\n<link rel="stylesheet" media="all" href="https://toontalk.github.io/ToonTalk/toontalk.css">\n<link href="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/css/font-awesome.min.css" rel="stylesheet" type="text/css" />\n<link href="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/css/froala_editor.min.css" rel="stylesheet" type="text/css" />\n<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">\x3c/script><script src="https://toontalk.github.io/ToonTalk/compile/toontalk.js">\x3c/script>\n<script src="https://toontalk.github.io/ToonTalk/libraries/jquery-ui-1.11.2.custom/jquery-ui.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/froala_editor.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/block_styles.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/colors.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/font_family.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/font_size.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/lists.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/tables.min.js">\x3c/script>\n<script src="https://dl.dropboxusercontent.com/u/51973316/ToonTalk/libraries/froala-wysiwyg-editor/js/plugins/video.min.js">\x3c/script>\n<title>\n'+
b+'</title>\n<link rel="shortcut icon" href="favicon.ico" />\n</head>\n<body>\n';a.forEach(function(a,b){e+='<div class="toontalk-edit" name="content">\n'+a+"\n</div>\n";d[b]&&(e+=d[b])});return e+='<script src="https://toontalk.github.io/ToonTalk/support/published_support.js">\x3c/script>\n</body>\n</html>\n'};return{publish_widget:function(b,a,d,h){var m=e.google_drive.get_status(),l=["Edit this. Select text for formatting.","And edit this."],c=function(a){(a=a&&a.items&&0<a.items.length&&a.items[0])?
h(a,q):(a=k(b,l,q),e.google_drive.upload_file(r,"html",a,h))},r,q;"Ready"===m?(r=a.get_setting("program_name"),d?e.UTILITIES.get_json_top_level(a,function(b){a.set_setting("program_name",r+" (published version)");q=[e.UTILITIES.toontalk_json_div(b,a)];a.set_setting("program_name",r)}):(d=a.get_backside_widgets(),q=[],d.forEach(function(a,b){a.visible()&&e.UTILITIES.get_json_top_level(a,function(c){c.view&&(c.view.saved_width=void 0,c.view.saved_height=void 0);q.push(e.UTILITIES.toontalk_json_div(c,
a.get_widget()));1<b&&(l[b]=l[1])})}),l.push(l[1])),e.google_drive.get_toontalk_files(e.google_drive.full_file_name(r,"page"),"page",c)):(console.log("Unable to publish to Google Drive because: "+m),h(null))},republish:function(b){e.google_drive.insert_or_update_file(void 0,b.file_id,"page",k(b.title,b.editable_contents,b.widgets_json),function(){console.log("Published page '"+b.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(e){var k=e.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",b=e.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",a="Need to authorize",d,h;return{handle_client_load:function(d){0>window.location.href.indexOf(b)?(a="Connections to Google Drive are configured for the following domain only: "+b+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",d&&
d(a)):setTimeout(function(){e.google_drive.check_authorization(d)})},check_authorization:function(b){a="Awaiting authorization";gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(a){e.google_drive.handle_authorization_result(a,b)})},handle_authorization_result:function(b,d){b&&!b.error?(a="Authorized but not yet ready",gapi.client.load("drive","v2",function(){e.google_drive.get_folder_ids(function(){a="Ready"})}),d&&d()):(a="Need to authorize",d&&
d(a))},authorize:function(a){gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(b){e.google_drive.handle_authorization_result(b,a)})},get_folder_ids:function(a){e.google_drive.get_folder_id(!0,function(b){d=b;e.google_drive.get_folder_id(!1,function(b){h=b;a()})})},get_folder_id:function(a,b){var c=a?"ToonTalk Programs":"ToonTalk Pages",k=function(d){var g=function(a){a&&a.id?b(a.id):console.error("Failure to create folder '"+c+"'. Response was "+
a)};(d=d&&d.items&&0<d.items.length&&d.items[0].id)?b(d):a?e.google_drive.create_folder("ToonTalk Programs",!1,g):e.google_drive.create_folder("ToonTalk Pages",!0,g)};a&&d?b(d):!a&&h?b(h):e.google_drive.fetch_folder_id(c,k)},get_status:function(){return a},connection_to_google_drive_possible:function(){return 0!==a.indexOf("Connections to Google Drive are configured for the following domain only: ")},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",params:a}).execute(b)},
fetch_folder_id:function(a,b){e.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},b)},get_toontalk_files:function(a,b,c){"undefined"===typeof gapi?c("Google Drive API not available."):(b="properties has {key='ToonTalkType' and value='"+b+"' and visibility='PUBLIC'} and trashed = false",a&&(b+=" and title='"+a+"'"),e.google_drive.list_files({q:b},c))},get_toontalk_program_file:function(a,b){e.google_drive.list_files({q:"'"+d+"' in parents and trashed = false and title='"+
a+"'"},function(a){a&&a.items&&0<a.items.length?b(a.items[0]):b(null)})},upload_file:function(a,b,c,d){var k="json"===b?"program":"page",g=a+"."+b;e.google_drive.get_toontalk_files(g,k,function(a){gapi.client.load("drive","v2",function(){var b=a&&a.items&&0<a.items.length&&a.items[0].id;d||(d=function(a){a.error&&(console.log("Google drive status: "+e.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message));console.log("File "+a.title+" ("+a.id+") "+(b?"updated":
"created"))});b?e.google_drive.insert_or_update_file(void 0,b,k,c,d):e.google_drive.insert_or_update_file(g,void 0,k,c,d)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(a,b,c,k,q){var g={title:a,mimeType:"text/html"};g.parents=[{kind:"drive#fileLink",id:"program"===c?d:h}];k="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(g)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
k+"\r\n---------314159265358979323846--";a?(a="/upload/drive/v2/files",g="POST"):(a="/upload/drive/v2/files/"+b,g="PUT");gapi.client.request({path:a,method:g,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:k}).execute(function(a){b||e.google_drive.insert_property(a.id,"ToonTalkType",c,"PUBLIC");q&&q(a)})},create_folder:function(a,b,c){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){c(a)})}:c)},download_file:function(a,b){if(a.downloadUrl){var c=gapi.auth.getToken().access_token,d=new XMLHttpRequest;d.open("GET",a.downloadUrl);d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=function(){b(null)};d.send()}else b(null)},google_drive_url:function(a){return"https://googledrive.com/host/"+a+"/"},insert_property:function(a,
b,c,d){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:c,visibility:d}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(e){var k={},b,a=100,d=(new Date).getTime(),h=[],m=[],l=new MutationObserver(function(a){a.forEach(function(a){var b,c;for(b=0;b<a.addedNodes.length;b++)c=a.addedNodes.item(b),1===c.nodeType&&(!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0,c.toontalk_run_even_if_not_observable=void 0),$(c).find(".toontalk-has-attached-callback").each(function(a,
b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)}))})}),c=function(a,b,c){var d;if(a){d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},r=function(a){var b=a.indexOf("<div style='display:none;'>{"),b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},q=function(a,c){var d=$(c).closest(".toontalk-side"),
f=k.get_mouse_or_first_touch_event_attribute("clientX",a),g=k.get_mouse_or_first_touch_event_attribute("clientY",a),h,l,m,n;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(a.dataTransfer&&a.dataTransfer.getData("text")&&0<a.dataTransfer.getData("text").length)){b=d||$(c);m=k.widget_side_of_jquery(b);if(!m){m=k.widget_side_of_element(c);k.report_internal_error("Possible bug that "+b+" doesn't have a known owner.");if(!m){k.report_internal_error("The element doesn't have an owner either.");
return}b=$(c)}m.set_stopped&&m.set_stopped(!0);!m.save_dimensions||m.get_parent_of_frontside()&&!m.get_parent_of_frontside().get_widget().is_top_level()||m.save_dimensions();m.being_dragged=!0;h=b.get(0).getBoundingClientRect();n=b.is(".toontalk-top-level-resource");$(c).removeClass("toontalk-wiggle");m.get_json&&(d=function(c){c.view.drag_x_offset=f-h.left;c.view.drag_y_offset=g-h.top;!c.view.frontside_width&&b.parent().is(".toontalk-backside")&&(c.view.frontside_width=b.width(),c.view.frontside_height=
b.height());b.data("json",c);a.dataTransfer&&(l=k.toontalk_json_div(c,m),a.dataTransfer.effectAllowed=n?"copy":"move",a.dataTransfer.setData("text",l),k.is_internet_explorer()||a.dataTransfer.setData("text/html",l));m.drag_started&&m.drag_started(c,n)},a.dataTransfer&&a.dataTransfer.setData("text","Sorry, it took too long to generate the data structure needed to reconstruct "+m+"."),e.UTILITIES.get_json_top_level(m,d,6E5));b.addClass("toontalk-being-dragged");a.stopPropagation()}},g=function(a){var c;
b||(b=$(a.target).closest(".toontalk-side"));if(c=k.widget_side_of_jquery(b))c.being_dragged=void 0;b.is(".toontalk-frontside")&&(b.parent().is(".toontalk-backside")?(c=b.data("json"))&&k.set_css(b,{width:c.view.frontside_width,height:c.view.frontside_height}):b.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||b.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||k.has_animating_image(b.get(0))||k.set_css(b,{width:"100%",
height:"100%"}));B();a.stopPropagation()},n=function(a){if(b)return k.widget_side_of_jquery(b);if(a)return a=k.data_transfer_json_object(a),k.create_from_json(a)},t=function(a,c){var d=k.data_transfer_json_object(a),f,g,h,l,m,n,q,r,t;void 0===d&&b&&(d=b.data("json"));b&&b.data("json","");f=b;B();if(f||void 0!==d||a.dataTransfer.files||J(a)){if($(a.target).is(".toontalk-drop-area-instructions"))h=$(a.target).parent();else if($(a.target).is(".toontalk-element-attribute-input")){if(h=$(a.target).closest(".toontalk-side"),
l=k.widget_side_of_jquery(h)){g=f?k.widget_side_of_jquery(f):k.create_from_json(d);k.restore_resource(f,g);l.dropped_on_style_attribute(g,a.target.name,a);a.stopPropagation();return}}else if($(a.target).is(".toontalk-drop-area"))h=$(a.target);else{if(d&&$(a.currentTarget).is(".froala-element")){h=k.create_from_json(d);l=document.createElement("div");q=h.get_element(!0);d=$(c).closest(".toontalk-edit");f=e.published_support.create_editable_text();g=a.target;$(l).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");
$(q).addClass("toontalk-top-level-resource").css({position:"relative"});q.toontalk_widget_side=h;l.toontalk_widget_side=h;l.appendChild(q);for($(l).insertAfter(d);g.nextSibling;)$(f).children(".froala-element").get(0).appendChild(g.nextSibling);$(f).insertAfter(l);h.update_display();return}h=$(a.target).closest(".toontalk-side")}if(0!==h.length&&!h.is(".toontalk-top-level-resource")){q=h.offset();k.remove_highlight();l=k.widget_side_of_jquery(h);if(f&&0<f.length&&!(l&&l.get_widget().get_infinite_stack&&
l.get_widget().get_infinite_stack())&&(f.get(0)===h.get(0)||jQuery.contains(f.get(0),h.get(0)))){if(f.is(".toontalk-top-level-backside"))return;h.hide();g=k.get_mouse_or_first_touch_event_attribute("pageX",a);m=k.get_mouse_or_first_touch_event_attribute("pageY",a);g=document.elementFromPoint(g-window.pageXOffset,m-window.pageYOffset);h.show();if(g){h=$(g).closest(".toontalk-side");if(0===h.length)return;q=h.offset();l=k.widget_side_of_jquery(h)}}d&&d.view&&d.view.drag_x_offset?(m=d.view.drag_x_offset,
n=d.view.drag_y_offset):n=m=0;if(f&&0<f.length){if(!(l&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack()||f.get(0)!==h.get(0)&&!jQuery.contains(f.get(0),h.get(0)))){k.set_css(f,{left:f.get(0).offsetLeft+(a.layerX-m),top:f.get(0).offsetTop+(a.layerY-n)});a.stopPropagation();return}g=k.widget_side_of_jquery(f);f.parent().is(".toontalk-drop-area")?(f.removeClass("toontalk-widget-in-drop_area"),f.parent().data("drop_area_owner").set_next_robot(void 0)):(r=f.parents(".toontalk-side:first"),
(t=k.widget_side_of_jquery(r))?!g.is_backside()&&g.get_widget().get_infinite_stack&&g.get_widget().get_infinite_stack()?(r=g.get_widget().saved_width,t=g.get_widget().saved_height,g=g.copy(),g.get_widget().saved_width=r,g.get_widget().saved_height=t,r=f.width(),t=f.height(),f=$(g.get_element(!0)),h.is(".toontalk-backside")&&k.set_css(f,{width:d.view.frontside_width||r,height:d.view.frontside_height||t})):t.removed_from_container&&(r.is(".toontalk-backside")?t.remove_backside_widget(g,!0):(t.removed_from_container(g,
a),g.restore_dimensions&&!t.is_empty_hole()&&g.restore_dimensions())):k.restore_resource(f,g),g.robot_in_training()&&g.robot_in_training().add_newly_created_widget_if_new(g))}else{if(0<a.dataTransfer.files.length){for(d=0;d<a.dataTransfer.files.length;d++)A(a.dataTransfer.files[d],h,l,q,a);a.stopPropagation();return}if(J(a)){E(a.dataTransfer.getData("URL"),h,l,q,a);a.stopPropagation();return}g=k.create_from_json(d,{event:a});if(!g){d?k.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):
e.debugging&&console.log("No data transfer in drop.");a.stopPropagation();return}g.robot_in_training()&&g.robot_in_training().drop_from_data_transfer(g);f=$(g.get_element(!0));g.is_primary_backside&&g.is_primary_backside()&&(k.set_css(f,{width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width}),g.apply_backside_geometry())}l&&g.get_widget()===l.get_widget()||x(h,f,g,l,q,a,d,m,n)}}else a.dataTransfer?k.report_internal_error("Drop failed since unable to parse as JSON."):
k.report_internal_error("Drop failed since there is no event.dataTransfer"),a.stopPropagation()},u=function(a,b){a.addEventListener("drop",function(a){var c=n(a);k.restore_resource(k.get_dragee(),c);b(a)})},f=function(a,b){var c;c=$(b).closest(".toontalk-side");var d=k.get_dragee();c=!c.is("*")||c.is(".toontalk-top-level-backside")||c.closest(".toontalk-top-level-resource").is("*")||c.is(".toontalk-being-dragged")||d&&D(c.get(0),d.get(0))?void 0:c;if(c)return k.highlight_element(c.get(0),a),c.get(0)},
x=function(a,b,c,d,e,f,g,h,l){var m=k.get_mouse_or_first_touch_event_attribute("pageX",f),n=k.get_mouse_or_first_touch_event_attribute("pageY",f),q,r,t,u;h||(h=0);l||(l=0);c.set_visible(!0);if(a.is(".toontalk-backside")){if(c.get_widget().is_top_level()){q=g.semantic.backside_widgets;r=g.shared_widgets;t=a.get(0);(b=d.robot_in_training())&&b.drop_from_data_transfer(c,d);b=c.get_widget().get_backside_widgets().slice();b.forEach(function(a,b){var e=a.get_widget(),f,g,h,p,l,v,m;c.remove_backside_widget(a);
f=0<=q[b].widget.shared_widget_index?r[q[b].widget.shared_widget_index].view:q[b].widget.view;g=a.get_element(!0);a.is_backside()?(h=f.backside_left,p=f.backside_top,l=f.backside_width,v=f.backside_height):(h=f.frontside_left,p=f.frontside_top,l=f.frontside_width,v=f.frontside_height);d.add_backside_widget(a);t.appendChild(g);m=$(g).position();u={left:m.left+h,top:m.top+p,width:l,height:v};k.constrain_css_to_fit_inside(t,u);k.set_css(g,u);c.set_location_attributes&&e.set_location_attributes(u.left,
u.top);a.is_backside()&&(e.backside_geometry=f.backside_geometry,e.apply_backside_geometry())}.bind(this));return}if(!d){k.report_internal_error("No target_widget");return}c?d.widget_side_dropped_on_me(c,f):k.report_internal_error("No source_widget");f=m-(e.left+(h||0));l=n-(e.top+(l||0));k.set_css(b,{left:k.left_as_percent(f,b.get(0)),top:k.top_as_percent(l,b.get(0))});!c.is_backside()&&c.set_location_attributes&&c.set_location_attributes(f,l);g&&g.semantic&&g.semantic.running&&!k.get_dragee()&&
c.set_running(!0)}else if(a.is(".toontalk-drop-area"))b.addClass("toontalk-widget-in-drop_area"),0<a.length&&a.get(0).appendChild(b.get(0)),b.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(k.widget_side_of_jquery(b));else{if(b.is(".toontalk-backside-of-top-level"))return;if(d||f.changedTouches){t=a.closest(".toontalk-top-level-backside").get(0);!t&&f.changedTouches&&(g=document.elementFromPoint(m-window.pageXOffset,n-window.pageYOffset),(t=$(g).is(".toontalk-top-level-backside")?
g:$(g).closest(".toontalk-top-level-backside").get(0))||(t=$(".toontalk-top-level-backside").get(0)),d=k.widget_side_of_element(t).get_backside());if(!t)return;t.appendChild(b.get(0));g=$(t).offset();k.set_css(b,{left:m-(g.left+h),top:n-(g.top+l)});c.drop_on&&c.drop_on(d,f)||d.widget_side_dropped_on_me&&d.widget_side_dropped_on_me(c,f)||(b=a.closest(".toontalk-top-level-backside"),0<b.length&&(d=k.widget_side_of_jquery(b))&&d.widget_side_dropped_on_me(c,f))}else{k.report_internal_error("target widget missing");
return}}k.remove_highlight()},A=function(a,b,c,d,f){var g=new FileReader,h=0===a.type.indexOf("image"),l=0===a.type.indexOf("audio"),m=0===a.type.indexOf("video"),n,q,t;g.onloadend=function(){if(h)n=e.element.create("<img src='"+g.result+"' alt='"+a.name+"'/>");else if(l)n=e.element.create(a.name+" sound"),n.set_sound_effect(new Audio(g.result));else if(m)n=e.element.create("<video src='"+g.result+"' alt='"+a.name+"'/>");else{if(q=r(g.result))try{t=JSON.parse(q),n=k.create_from_json(t)}catch(u){}n||
(n=e.element.create(g.result))}n&&n.robot_in_training()&&n.robot_in_training().drop_from_data_transfer(n,c);x(b,$(n.get_frontside_element(!0)),n,c,d,f,t)};h||l||m?g.readAsDataURL(a):g.readAsText(a)},E=function(a,b,c,d,f){var g=function(a,b,d,f){var g=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,c),x(b,$(a.get_frontside_element(!0)),a,c,d,f))};k.create_widget_from_URL(a,g,function(b){var c=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");
c?g(e.element.create(c)):(k.display_message("Error: "+b+". When trying to fetch "+a),console.log(b))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&g(a,b,d,f)})},M=function(a,b){var c=$("<div class='"+a+"'>");k.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},G=function(){var a=k.get_path_to_toontalk_folder()+"sounds/",b=function(b){b=new Audio(a+b);b.volume=k.get_audio_volume(b);return b};
e.sounds={hatching:b("SPARROW.mp3"),bird_fly:b("PIGEON.mp3"),bammer_hammer:b("POP.mp3"),vacuum_spit:b("SPIT.mp3"),vacuum_suck:b("DUSTBUST.mp3"),drop:b("BOOK_DROP.mp3"),magic:b("MAGIC.mp3"),fall_inside:b("FALL_INSIDE.mp3"),click:b("TYPE.mp3"),event_ignored:b("PLOP.mp3")};e.sounds.bird_fly.loop=!0},I=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},B=function(){b&&(b.removeClass("toontalk-being-dragged"),k.set_timeout(function(){b=void 0}))},D=function(a,b){if(a===
b)return!0;if(a.parentNode)return D(a.parentNode,b)},H=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",h,l;if(0>f)return a;for(;0<=f;){h=f+d.length;l=a.indexOf(e,h);if(0>l)return k.report_internal_error("Expected title to have matching pairs of "+d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(h,l));c=l+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},J=function(a){return(a=a.dataTransfer&&
a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},C=[],L=[],P,N;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window?(a.stopPropagation(),0<C.length&&C.shift()()):a.data.editable_contents&&e.publish.republish(a.data)},!1);document.addEventListener("DOMContentLoaded",function(){var a;e.debugging=k.get_current_url_parameter("debugging");e.logging=k.get_current_url_parameter("log");0<k.get_current_url_numeric_parameter("volume",10)&&G();k.process_json_elements();
window.document.addEventListener("click",function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget_side;c&&c.set_running&&c.set_running(!1)})});e.DEFAULT_QUEUE=window.TOONTALK.queue.create();e.DEFAULT_QUEUE.start();window.addEventListener("beforeunload",function(a){try{k.backup_all_top_level_widgets(!0)}catch(b){e.UTILITIES.report_internal_error(b)}});e.TRANSLATION_ENABLED=k.get_current_url_boolean_parameter("translate",!1);e.TRANSLATION_ENABLED?($("a").each(function(a,
b){b.href=k.add_URL_parameter(b.href,"translate","1")}),$("#google_translate_element").is("*")||(a=document.createElement("div"),a.id="google_translate_element",document.body.insertBefore(a,document.body.firstChild)),document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]),I("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit")):$("#google_translate_element").remove();e.vacuum.the_vacuum||
e.vacuum.create();k.add_test_all_button();M("toontalk-robot",e.robot);M("toontalk-empty-nest",e.nest);M("toontalk-bird-static",e.bird);$("[title]").each(function(a,b){k.use_custom_tooltip(b)});document.addEventListener("visibilitychange",function(){document.hidden?k.mute_audio_objects_playing():(k.rerender_all(),k.restore_audio_volumes())});setTimeout(function(){e.DISPLAY_UPDATES.update_display()},100)});l.observe(window.document,{childList:!0,subtree:!0});k.available_types="number box element robot nest sensor top-level".split(" ");
k.create_from_json=function(a,b,c){var d=function(a,b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},f,g,h,l;if(a){b||(b={});b.guid_to_nest_table||(b.guid_to_nest_table={});a.shared_widgets&&(b.json_of_shared_widgets=a.shared_widgets,b.shared_widgets=[]);a.shared_html&&(b.shared_html=a.shared_html);if(a.widget)return(f=k.create_from_json(a.widget,b))&&a.is_backside?f.get_backside(!0):
f;if(b&&b.shared_widgets&&0<=a.shared_widget_index){if(c=b.shared_widgets[a.shared_widget_index])return c;c=b.json_of_shared_widgets[a.shared_widget_index];f=k.create_from_json(c,b,!0);return d(f,b,a.shared_widget_index)}(h=a.semantic)||(h=a);a=a.view;if(0<=h.shared_widget_index){if(!b.json_of_shared_widgets){k.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}f=k.create_from_json(b.json_of_shared_widgets[h.shared_widget_index],b,!0);return d(f,b,h.shared_widget_index)}if(e.creators_from_json[h.type]){b||
(b={});a?b.json_view=a:a=b.json_view;if(e.debugging)f=e.creators_from_json[h.type](h,b);else try{f=e.creators_from_json[h.type](h,b)}catch(m){console.error(m.stack),k.report_internal_error("Unable to recreate a "+h.type+". Error is "+m)}if(f&&f.get_backside){h.erased&&(e.widget.erasable(f),f.set_erased(h.erased));h.infinite_stack&&f.set_infinite_stack(h.infinite_stack);h.open_backside_only_if_stopped&&f.set_open_backside_only_if_stopped(!0);if(a){if(a.frontside_width)if(g=f.get_element()){if(f.ok_to_set_dimensions())if(l=
{width:a.frontside_width,height:a.frontside_height},"element"===h.type)f.on_update_display(function(){k.set_css(g,l)});else k.set_css(g,l)}else a.saved_width||(f.saved_width=a.frontside_width,f.saved_height=a.frontside_height);a.saved_width&&(f.saved_width=a.saved_width,f.saved_height=a.saved_height);a.backside_geometry&&(f.backside_geometry=a.backside_geometry)}h.backside_widgets&&(c?f.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(f,h.backside_widgets,b)}.bind(this):
this.add_backside_widgets_from_json(f,h.backside_widgets,b))}return f}k.report_internal_error("JSON type '"+h.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};k.add_backside_widgets_from_json=function(a,b,c){var d;b&&(a.is_top_level()||(c.to_be_on_backside_of?c.to_be_on_backside_of.push(a):c.to_be_on_backside_of=[a]),d=this.create_array_from_json(b,c),a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?
c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a})),a.is_top_level()||c.to_be_on_backside_of.pop())};k.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?k.create_from_json(a,b):a});return c};k.get_json_of_array=function(a,b,c,d,e,f){var g,h;c>=a.length?e():(g=a[c])?g.is_primary_backside&&g.is_primary_backside()?(h=function(f,g){b.push({widget:f,is_backside:!0});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),k.get_json(g.get_widget(),d,h,f)):
g.is_widget?(h=function(f,g){b.push({widget:f});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),k.get_json(g,d,h,f)):(h=function(f,g){b.push(f);this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),g.get_json(d,h,f)):k.get_json_of_array(a,b,c+1,d,e,f)};k.fresh_json_history=function(a){var b={widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=a.shared_html);return b};k.get_json_top_level=function(a,b,c){var d=this.fresh_json_history();k.maximum_json_generation_duration=
c;k.get_json(a,d,function(c){0<d.shared_widgets.length&&(c.shared_widgets=d.shared_widgets.map(function(b,e){var f=function(a){a=d.widgets_encountered.indexOf(a);return d.json_of_widgets_encountered[a]},g=function(a){return f(d.shared_widgets[a])},h=f(b);if(a===b)return h={semantic:h.semantic,view:h.view,version:h.version},c.semantic={shared_widget_index:e},h;c.semantic&&k.tree_replace_once(c.semantic,h,{shared_widget_index:e},g,k.generate_unique_id());return h}));c.shared_html=d.shared_html;b(c)},
Date.now())};k.get_json=function(a,b,c,d){var f,g,h;e.debugging&&!b?k.report_internal_error("no json_history"):(f=b.shared_widgets.indexOf(a),0<=f?c({shared_widget_index:f},d):(f=b.widgets_encountered.indexOf(a),0<=f?(f=k.insert_ancestors_last(a,b.shared_widgets),c({shared_widget_index:f},d)):(f=b.widgets_encountered.push(a)-1,(g=a.is_primary_backside&&a.is_primary_backside())&&(a=a.get_widget()),h=function(d,e){a.add_to_json&&(d=a.add_to_json(d,b));b.json_of_widgets_encountered[f]=d;a.add_backside_widgets_to_json?
a.add_backside_widgets_to_json(d,b,function(){c(d,e)},e):c(d,e)},Date.now()-d<=k.maximum_json_generation_duration?a.get_json(b,h,d):setTimeout(function(){a.get_json(b,h,Date.now())}))))};k.get_json_of_keys=function(a,b,c,d){var e;b||(b=[]);Object.keys(a).forEach(function(c){0>b.indexOf(c)&&(e||(e={}),a[c].get_json?a[c].get_json(void 0,function(a,b){e[c]={json:a}},d):e[c]=a[c])});c(e,d)};k.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?k.create_from_json(a[d].json,
b):a[d]});return c};k.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).forEach(function(g){if(f=a[g]){if(f===b)return a[g]=c,!0;if("shared_widget_index"===g){if(this.tree_replace_once(d(f),b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};k.insert_ancestors_last=function(a,b){var c=a.get_widget(),
d=-1;b.some(function(a,b){if(c.has_ancestor(a))return d=b,!0});0>d&&(d=b.length);b.splice(d,0,c);return d};k.toontalk_json_div=function(a,b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name(),c=c.toString({for_json_div:!0}),f;"top-level"===e?b.is_backside()?(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),e+=k.describe_widgets(d))):e="a top-level widget":(e=k.add_a_or_an(e),b.is_backside()&&
(e="the back of "+e));c&&(d=c.indexOf("data:image/"),0<d&&(f=c.indexOf("alt=",d),0>f&&(f=c.indexOf(">",d)),c=c.substring(0,d+20)+" ... "+c.substring(f)));return"<div class='toontalk-json'>\nThis will be replaced by "+e+".\n"+(c?c+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,k.clean_json,"  ")+"</div></div>"};k.describe_widgets=function(a){var b="",c=a.length;a.forEach(function(a){c--;b+=k.add_a_or_an(a.get_type_name());1===c?b+=", and ":1<c&&(b+=", ")});return b};k.elide=function(a,b,c){c=
Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};k.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:b};k.create_widget_from_URL=function(a,b,c){var d=function(g){try{var h=this.getResponseHeader("content-type"),k;if(!h){c&&c("Could not determine the contents type of the url");f.removeEventListener("readystatechange",d);return}0===h.indexOf("audio")?
(k=e.element.create(a),k.set_sound_effect(new Audio(a))):0===h.indexOf("image")?k=e.element.create("<img src='"+a+"'>"):0===h.indexOf("video")?k=e.element.create("<video src='"+a+" ' width='320' height='240'>"):0===h.indexOf("text")&&0>h.indexOf("text/html")?this.responseText&&(k=e.element.create(this.responseText),k.set_source_URL(a)):k=e.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");k&&b(k)}catch(l){c&&c(l),b()}f.removeEventListener("readystatechange",
d)},f=new XMLHttpRequest;f.addEventListener("readystatechange",d);f.open("GET",a,!0);try{f.send()}catch(g){c?c(g):(k.display_message("Error trying to GET "+a+" "+g),console.error(g.stack))}};k.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};k.copy_widget_sides=function(a,b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};k.copy_array=function(a){return a.slice()};k.generate_unique_id=
function(){d+=1;return"toontalk_id_"+d};k.get_style_property=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)};k.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;if("string"===typeof c){d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;c=parseInt(c,10);return isNaN(c)?void 0:c}return c};
k.data_transfer_json_object=function(a){var b,c;if(a.dataTransfer&&!(0<a.dataTransfer.files.length||J(a))){try{b=a.dataTransfer.getData("text/html")}catch(d){b=a.dataTransfer.getData("text")}if(!b||b.match(/[\u3400-\u9FBF]/))b=a.dataTransfer.getData("text");if(b){if(a=r(b))try{return JSON.parse(a)}catch(f){k.report_internal_error("Exception parsing "+a+"\n"+f.toString())}e.element.create(b).get_json(k.fresh_json_history(),function(a){c=a});return c}}};k.drag_and_drop=function(a){var b;k.draggable(a);
k.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,k.enable_touch_events(a,b))};k.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){q(b,a)});a.addEventListener("dragend",function(b){g(b,a)})};k.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",function(b){b.preventDefault();t(b,a);b.stopPropagation()});a.addEventListener("dragenter",
function(c){var d=f(c,a);d&&b!==d&&k.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!k.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(k.remove_highlight(b),b=void 0);a.stopPropagation()})};k.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");b.appendChild(d);k.can_receive_drops(b);
return b};k.process_json_elements=function(){$(".toontalk-json").each(function(a,b){var c=b.textContent,d,f,g,h;if(c){c=c.substring(c.indexOf("{"),c.lastIndexOf("}")+1);d=JSON.parse(c);if(d.semantic&&"top_level"===d.semantic.type&&!e.no_local_storage&&!k.get_current_url_boolean_parameter("reset",!1)){if(d.load_most_recent_program)try{(h=window.localStorage.getItem("toontalk-last-key"))&&(g=window.localStorage.getItem(h))}catch(l){h="Error reading previous state. Error message is "+l,k.is_internet_explorer()?
console.error("Unresolved difficulties using window.localStorage in IE11: "+h):k.display_message(h)}g&&(d=JSON.parse(g),f=k.create_from_json(d))}f||(f=k.create_from_json(d));if(f){b.textContent="";if(f.get_type_name)if(f.is_top_level())c=f.get_backside(!0),c=c.get_element(),$(b).replaceWith(c),$(c).css({width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width});else{if($(b).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),
c=f.get_frontside_element(!0))$(c).addClass("toontalk-top-level-resource").css({position:"relative"}),b.toontalk_widget_side=f,b.appendChild(c)}else b.appendChild(f.get_element());f.set_active&&f.set_active(!1);f.set_visible&&f.set_visible(!0);setTimeout(function(){f.update_display&&f.update_display();d.semantic.running&&f.set_running(!0)},1)}else k.report_internal_error("Could not recreate a widget from this JSON: "+c)}})};k.relative_position_from_absolute_position=function(a,b){for(var c=a.parentElement,
d=b.left,e=b.top,f;c&&"html"!==c.nodeType;)f=$(c).position(),d-=f.left,e-=f.top,c=c.parentElement;return{left:d,top:e}};k.set_absolute_position=function(a,b){var c=k.relative_position_from_absolute_position(a,b);k.set_css(a,{left:c.left,top:c.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=c.left+"px",a.style.top=c.top+"px")};k.set_position_relative_to_top_level_backside=function(a,b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-top-level-backside"),
b,c)};k.set_position_relative_to_element=function(a,b,c,d){var e=b.offset(),f,g;b.get(0).appendChild(a.get(0));e||(e={left:0,top:0});f=c.left-e.left;c=c.top-e.top;d&&(d=a.width(),e=a.height(),g=b.width(),b=b.height(),f>g-d&&(f=g-d),0>f&&(f=0),c>b-e&&(c=b-e),0>c&&(c=0));b={left:f,top:c,position:"absolute"};a.is(".toontalk-side-animating")?(a.get(0).style.left=f+"px",a.get(0).style.top=c+"px",k.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");
a.get(0).style.transitionDuration=""})):k.set_css(a,b);return b};k.restore_resource=function(a,b){var c,d;a&&a.is(".toontalk-top-level-resource")&&(c=b.copy({fresh_copy:!0}),d=c.get_frontside_element(!0),k.set_css(d,{width:a.width(),height:a.height()}),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(d).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),
a.css({position:"absolute"}),a.get(0).parentElement.appendChild(d),e.DISPLAY_UPDATES.pending_update(c),b.set_active&&(b.set_active(!0),c.set_active(!1)))};k.find_resource_equal_to_widget=function(a){var b;$(".toontalk-top-level-resource.toontalk-side").each(function(c,d){var e=k.widget_side_of_jquery($(d));if(e&&(a.equals&&a.equals(e)||a.matching_resource&&a.matching_resource(e)||"matched"===a.match(e))&&(a.is_hole()||e.get_backside_widgets().length===a.get_backside_widgets().length))return b=d,!1});
return b};k.set_position_is_absolute=function(a,b,c){var d,e;b?(b=k.get_style_numeric_property(a,"left"),d=k.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===d&&(d=c.pageY-e.top,d-=90)),k.set_css(a,{left:k.left_as_percent(b,a),top:k.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};k.left_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===
a||isNaN(a)?$(b).offset().left:k.adjust_left_if_scaled(a,b);return 100*($(c).offset().left-window.pageXOffset+a-d.left)/d.width+"%"};k.top_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:k.adjust_top_if_scaled(a,b);return 100*($(c).offset().top+-window.pageYOffset+a-d.top)/d.height+"%"};k.adjust_left_if_scaled=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&
c.get_attribute?a-(d-c.get_attribute("width"))/2:a};k.adjust_top_if_scaled=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a-(d-c.get_attribute("height"))/2:a};k.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";default:return 1===
a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};k.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};k.give_tooltip=function(a,b){a.title=b;k.use_custom_tooltip(a)};k.use_custom_tooltip=function(a){var b=$(a),c;b.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,d){var e;0>a.top&&(a.top=0,e=b.offset(),e.left<$(window).width()/2?a.left=e.left+b.width()+10:(a.left=0,c=e.left-40));"bottom"===d.vertical?(b.is(".toontalk-robot")?
a.top-=30:b.is(".toontalk-number")?a.top-=30:b.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);k.set_css(this,a)}},open:function(b,d){var f=d.tooltip.get(0).textContent.length,g=d.tooltip.get(0),h;g.innerHTML=H(d.tooltip.get(0).textContent.replace(/(\r\n|\n|\r)/g,"<br>"),decodeURIComponent);100<f&&(h=Math.min(800,c||$(window).width()-100),$(g).position(),d.tooltip.css({maxWidth:h}));
N&&N.remove();N=d.tooltip;setTimeout(function(){d.tooltip.remove();$(g).data("ui-tooltip")&&($(g).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),k.use_custom_tooltip(a));N=void 0},f*(e.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))},close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),k.use_custom_tooltip(a));N=void 0}})};k.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate'>decodeURIComponent"+a+"decodeURIComponent</span>")};
k.remove_encoded_HTML=function(a){return H(a,function(){return""})};k.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};k.default_animation_speed=.5;k.animate_to_absolute_position=function(a,b,c,d,e,f){var g=$(a).offset(),h=$(a).position(),l=k.distance(b,g);0===f||0===d?(k.set_absolute_position(a,b),c&&c()):($(a).css({"z-index":k.next_z_index()}),f||(f=Math.round(l/(d||k.default_animation_speed))),
$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=f+"ms",l=h.left+(b.left-g.left),g=h.top+(b.top-g.top),a.style.left=l+"px",a.style.top=g+"px",a.toontalk_followed_by&&(b.left+=a.toontalk_followed_by.left_offset,b.top+=a.toontalk_followed_by.top_offset,k.animate_to_absolute_position(a.toontalk_followed_by.element,b,void 0,d,e)),e?setTimeout(c,f):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";c&&c()},f))};k.distance=function(a,b){var c=
a.left-b.left,d=a.top-b.top;return Math.sqrt(c*c+d*d)};k.highlight_element=function(a,b,c){var d;if(a){k.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=k.widget_side_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){k.remove_highlight(a)},c))}};k.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};
k.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};k.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};k.constrain_css_to_fit_inside=function(a,b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=k.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,
0),d):(c=k.extract_percentage_from_string(b.top),"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};k.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(b){}};k.next_z_index=function(){a++;return a};k.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b);a.get(0).addEventListener("click",d);k.give_tooltip(a.get(0),c);return a.get(0)};k.create_close_button=function(a,
b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button");c.addEventListener("click",a);k.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};k.check_radio_button=function(a){$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};k.create_alert_element=function(a){a=k.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};k.create_text_element=function(a){var b=document.createElement("div");b.innerHTML=
a;$(b).addClass("ui-widget");return b};k.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};k.create_anchor_element=function(a,b){var c=document.createElement("a");c.innerHTML=a;e.TRANSLATION_ENABLED&&(b=k.add_URL_parameter(b,"translate","1"));c.href=b;c.target="_blank";return c};k.create_text_input=function(a,b,c,d,e,f,g){var h=document.createElement("input"),l;h.type="text";h.className=b;h.value=a;k.give_tooltip(h,d);f&&(h.type=
f);c?(a=document.createElement("label"),a.innerHTML=c,h.id=k.generate_unique_id(),a.htmlFor=h.id,e&&(l=k.create_anchor_element("i",e),$(l).addClass("toontalk-help-button notranslate"),l.translate=!1),c=k.create_horizontal_table(a,h,l),$(a).addClass("ui-widget")):c=h;$(h).button().addClass("toontalk-text-input").css({"background-color":"white"});h.addEventListener("touchstart",function(){$(h).select()});g&&u(h,g);k.use_custom_tooltip(h);return{container:c,button:h}};k.create_text_area=function(a,b,
c,d,e,f){var g=document.createElement("textarea");g.className=b;g.value=a;k.give_tooltip(g,d);a=document.createElement("label");a.innerHTML=c;g.id=k.generate_unique_id();a.htmlFor=g.id;c=k.create_horizontal_table(a,g);$(g).button().addClass("toontalk-text-area").css({background:"white"});g.addEventListener("touchstart",function(){$(g).select()});e&&u(g,e);$(a).addClass("ui-widget");k.use_custom_tooltip(g);return{container:c,button:g}};k.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();
if(c=n(a)){if(c.is_backside())return;if(d=b(c,a))$(a.currentTarget).trigger("change"),a.currentTarget.value=d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};k.create_radio_button=function(a,b,c,d,e,f){var g=document.createElement("div"),h=document.createElement("input"),l=document.createElement("label");h.type="radio";h.className=c;h.name=a;h.value=b;l.innerHTML=d;h.id=k.generate_unique_id();l.htmlFor=h.id;g.appendChild(h);g.appendChild(l);k.give_tooltip(g,e);f||$(h).button();k.use_custom_tooltip(h);
return{container:g,button:h,label:l}};k.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),h=document.createElement("select"),l=document.createElement("label");h.className=c;h.name=a;h.id=k.generate_unique_id();l.innerHTML=d;l.htmlFor=h.id;g.appendChild(l);g.appendChild(h);k.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&(k.give_tooltip(c,f[b]),k.use_custom_tooltip(c));h.appendChild(c)});$(h).addClass("ui-widget");
$(l).addClass("ui-widget");k.use_custom_tooltip(h);return{container:g,menu:h,label:l}};k.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b;f.checked=a;g.innerHTML=c;f.id=k.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);k.give_tooltip(e,d);k.use_custom_tooltip(f);return{container:e,button:f,label:g}};k.create_horizontal_table=function(){var a=
document.createElement("table"),b,c,d;c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),d.appendChild(arguments[b]));return a};k.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=k.create_row(arguments[b]),a.appendChild(c));return a};k.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<
arguments.length;c++)a.appendChild(arguments[c]);b.appendChild(a);return a};k.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};k.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if(arguments[a].checked)return arguments[a]};k.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+
a},c.addEventListener("error",d));return c};k.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);
b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};k.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');a&&b.addClass(a);return b.get(0)};k.become_file_data_table=function(a,b,c,d){$(a).DataTable({data:b,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,b,f,g){a=c?a.substring(0,a.length-5):a;b=c?e.google_drive.google_drive_url(f.id):"Click to load this program.";if(d)return"<div class='"+d+"' title='"+
b+"'id='"+f.id+"'>"+a+"</div>";e.TRANSLATION_ENABLED&&(b=k.add_URL_parameter(b,"translate","1"));return"<a href='"+b+"'target='_blank' title='Click to open published page.'>"+a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};k.get_local_files_data=function(){return k.get_all_locally_stored_program_names().map(function(a){var b=
k.get_local_storage_meta_data(a);if(b)return{title:a,modifiedDate:b.last_modified,createdDate:b.created,fileSize:b.file_size}})};k.create_local_files_table=function(){var a=k.get_local_files_data(),b=k.create_file_data_table();k.when_attached(b,function(){k.become_file_data_table(b,a,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});return b};k.get_dragee=function(){return b};k.add_URL_parameter=function(a,b,c){a=k.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?
"&":"?";return a+d+b+"="+c};k.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};k.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||
0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};k.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};k.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};k.backup_all_top_level_widgets=function(a){$(".toontalk-top-level-backside").each(function(b,c){k.widget_side_of_element(c).get_widget().save(a)})};k.make_resizable=function(a,b){var c,
d;a.resizable({start:function(a,b){c=b.originalSize.width;d=b.originalSize.height},resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},handles:"n,e,s,w"})};k.match=function(a,b){var c=a.match(b);return c.is_widget&&
b.matched_by?b.matched_by(a):c};k.current_URL=function(){return window.location.pathname};k.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};k.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&k.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};k.copy_frontside_dimensions=function(a,b){var c=a.get_widget().get_frontside_element(),d;c&&(d=b.get_frontside_element(!0))&&k.set_css(d,{width:$(c).width(),
height:$(c).height()})};k.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?k.scale_element(a,c,d,c,d):k.scale_element(a,$(b).width(),$(b).height(),c,d)};k.scale_element=function(a,b,c,d,e,f,g,h,l){var m,n;d||(m=$(a).children("img"),d=m.is("*")?m.width():$(a).width());e||(m||(m=$(a).children("img")),e=m.is("*")?m.height():$(a).height());m=b&&0!==d?b/d:a.toontalk_x_scale||1;n=c&&0!==e?c/e:a.toontalk_y_scale||1;0===m&&(m=1);0===n&&(n=1);a.toontalk_x_scale=m;a.toontalk_y_scale=n;h=
(h=h&&h!==document.body?h:a.parentElement)&&0>h.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var q="";g||(g={});"number"===typeof g.left&&(g.left-=(d-b)/2,l=!0);"number"===typeof g.top&&(g.top-=(e-c)/2,l=!0);!l&&h?(b&&(a.toontalk_translate_x=(b-d)/2,q+="translateX("+a.toontalk_translate_x+"px) "),c&&(a.toontalk_translate_y=(c-e)/2,q+="translateY("+a.toontalk_translate_y+"px) ")):(a.toontalk_translate_x=void 0,a.toontalk_translate_y=void 0);k.add_transform_to_css((f||
"")+" scale("+m+", "+n+")",q,g,h);g.width=d;g.height=e;k.set_css(a,g);return{x_scale:m,y_scale:n}};k.translate_x=function(a){return c("toontalk_translate_x","toontalk_x_scale")};k.translate_y=function(a){return c("toontalk_translate_y","toontalk_y_scale")};k.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),k.set_css_transform(c,b+a))};k.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=
b;a["o-transform"]=b;a.transform=b};k.run_when_dimensions_known=function(a,b,c){var d=a.parentElement,e=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")},f;!c&&$(a).width()&&e(d)?setTimeout(function(){b(d)}):(f=function(c){setTimeout(function(){var g=$(a).width(),h=$(a).height();g&&h?e(a.parentElement)?(b(d),d?d.appendChild(a):a.parentElement===document.body&&$(a).remove(),$(a).removeClass("toontalk-not-observable")):k.run_when_dimensions_known(a,b,!0):setTimeout(function(){k.widget_side_of_element(a);
1E4>c&&f(2*c)},c)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),c&&k.set_css(a,{width:"",height:"",transform:""}),f(1))};k.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&k.run_when_dimensions_known(d,function(){var a=$(d).children("img");a.is("*")?b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};k.relative_position=function(a,b){var c,d;if(!k.is_attached(a))return{left:0,top:0};c=$(a).offset();b&&(d=$(b).offset(),
c.left-=d.left,c.top-=d.top);return c};k.add_animation_class=function(a,b){k.set_css(a,{width:"",height:""});$(a).addClass(b)};k.widget_side_of_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget_side};k.widget_side_of_element=function(a){return a.toontalk_widget_side};k.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};k.display_message_if_new=function(a){0>
L.indexOf(a)&&(k.display_message(a),L.push(a))};k.display_message=function(a){var b=k.create_alert_element(a);$(".toontalk-alert-element").remove();console.log(a);console.trace();document.body.insertBefore(b,document.body.firstChild);setTimeout(function(){$(b).remove()},Math.max(2E3,a.length*(e.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)))};k.display_tooltip=function(a){k.use_custom_tooltip(a.get(0));a.tooltip("open")};k.report_internal_error=function(a){console.log(a);console.trace();e.debugging&&
k.display_message("Error: "+a)};k.get_current_url_boolean_parameter=function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};k.get_current_url_numeric_parameter=function(a,b){var c=k.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};k.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>
d&&(d=window.location.href.length);return window.location.href.substring(c,d)};k.get_path_to_toontalk_folder=function(){var a;if("string"===typeof P)return P;P="";a=window.location.href.indexOf("/ToonTalk/");if(0>a)return P;for(a+=9;;){a=window.location.href.indexOf("/",a+1);if(0>a)return P;P+="../"}};k.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};k.is_internet_explorer=function(){return k.is_browser_of_type("MSIE")||k.is_browser_of_type("Trident")};k.add_position=
function(a,b){return{left:a.left+b.left,top:a.top+b.top}};k.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};k.remove_z_index=function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$(a);a.attr("z-index","");return a.html()};k.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b=!1,c=function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),d.innerHTML="Run all tests",
k.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),d.innerHTML="Stop all tests");b=!b},d;0!==a.length&&(a.button(),d=a.get(0),d.innerHTML="Run all tests",a.get(0).addEventListener("click",c))};k.set_timeout=function(a,b){b?setTimeout(a,b):(C.push(a),window.postMessage("zero-timeout-message","*"))};k.get_first_property=function(a){return Object.keys(a)[0]};k.get_all_locally_stored_program_names=function(){var a=window.localStorage.getItem("toontalk-all-program-names");
return a?JSON.parse(a):[]};k.set_all_locally_stored_program_names=function(a){window.localStorage.setItem("toontalk-all-program-names",JSON.stringify(a))};k.get_local_storage_meta_data=function(a){a=k.local_storage_program_meta_data_key(a);var b;try{if(b=window.localStorage.getItem(a))return JSON.parse(b)}catch(c){}};k.local_storage_program_key=function(a){return"toontalk-json: "+a};k.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};k.enable_editor=function(a,b,c,d){(function(a,
b){var c=function(a){a.data.editor_enabled_for&&a.data.editor_enabled_for===b&&(e=!0,window.removeEventListener("message",c))},d=function(a,b){e||setTimeout(function(){a();d(a,b)},500)},e=!1;window.addEventListener("message",c);d(a,b)})(function(){a.postMessage({save_edits_to:window.location.href,file_id:c,widgets_json:d},"*")},c)};k.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};k.enable_touch_events=function(a,b){var c=a,d=function(b){b.stopPropagation();b.preventDefault();
h?(h=!1,g(b,a),e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ndrag ended"),t(b,a),e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ndrop happened"),e.logging&&0===e.logging.indexOf("touch")&&(alert(e.debugging),e.debugging="touch")):l=!0;a=c},h=!1,l=!1,m=0,n=0,r;a.addEventListener("touchstart",function(c){e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ntouch start");c.preventDefault();"TEXTAREA"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||$(c.srcElement).is(".ui-resizable-handle")?
e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ntouch start ignored due to tag name or class"):(c.stopPropagation(),k.set_timeout(function(){var b=c.changedTouches[0],d,f,g;l?(l=!1,d=document.createEvent("MouseEvent"),d.initMouseEvent("click",!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(d),e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ntouch end treated as click",alert(e.debugging),e.debugging="touch")):(h=!0,(d=k.widget_side_of_element(a))&&
d.get_infinite_stack()?(f=d.copy(),d.set_infinite_stack(!1),f.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(f=d.copy(),d.add_copy_to_container(f,0,0),g=$(a).offset(),a=f.get_frontside_element(!0)),f&&(d.add_copy_to_container(f,0,0),d.robot_in_training()&&d.robot_in_training().copied(d,f,!1)),g||(g=$(a).offset()),q(c,a),m=b.clientX-g.left,n=b.clientY-g.top,e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ndrag started"))},b))},!0);a.addEventListener("touchmove",function(b){var c;
b.preventDefault();if(h){c=b.changedTouches[0];k.set_absolute_position(a,{left:c.pageX-m,top:c.pageY-n});b=k.find_widget_on_page_side(c,a,0,0);if(r&&r!==b){var d=r.get_frontside_element();k.remove_highlight(d);r=void 0}b&&(f(c,b.get_element()),r=b);e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ndragged to "+(c.pageX-m)+", "+(c.pageY-n))}else e.logging&&0===e.logging.indexOf("touch")&&(e.debugging+="\ntouch move ignored since drag_started not yet set. "+Date.now())},!0);a.addEventListener("touchend",
d,!0);a.addEventListener("touchcancel",d,!0)};k.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};k.find_widget_on_page_side=function(a,b,c,d){var e=k.get_mouse_or_first_touch_event_attribute("pageX",a);a=k.get_mouse_or_first_touch_event_attribute("pageY",a);var f;$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for($(b).show();c&&!c.toontalk_widget_side&&(!$(c).is(".toontalk-backside")||$(c).is(".toontalk-top-level-backside"));)c=
c.parentNode;c&&(f=c.toontalk_widget_side);if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),b=f.get_type_name(),f&&"empty hole"===b?f.get_parent_of_frontside():f};k.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-top-level-backside").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return k.widget_side_of_element(c)};k.set_css=function(a,b){var c;if(b){if(c=k.widget_side_of_element(a)){if(c.is_backside()){b.transform||
(b.width="",b.height="");$(a).css(b);return}$(a).is(".toontalk-temporarily-set-down")||(c.location_constrained_by_container()?(b.left="",b.top=""):c.is_plain_text_element()&&(b.width="",b.height=""))}0===b.width&&(b.width="");0===b.height&&(b.height="");!b.transform&&"number"===typeof b.width&&"number"===typeof b.height&&c&&c.use_scaling_transform?c.use_scaling_transform(b):$(a).css(b)}};k.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};k.conjunction=function(a,
b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?k.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};k.insert_function_bird_documentation=function(a){var b=TOONTALK[a]["function"],c=Object.keys(b),d="<table class='toontalk-function-bird-documentation-table'>";c.forEach(function(a,c){d+="<tr><td><div id='bird_id_"+c+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+
b[a].title+"</td></tr>"});d+="</table>";document.write(d);c.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e.id=encodeURIComponent(b)})};k.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=k.widget_side_of_element(b);c&&c.rerender()})};k.visible_element=function(a){a=$(a);return a.is(":visible")&&"0"!==a.css("opacity")};
k.get_audio_volume=function(a){var b=document.hidden?0:k.get_current_url_numeric_parameter("volume",10)/100;0===b&&h.push({audio_object:a,volume:a.volume});return b};k.play_audio=function(a){a.play();m.push(a);a.addEventListener("ended",function(){var b=m.indexOf(a);0<=b&&m.splice(b,1)})};k.mute_audio_objects_playing=function(){m.forEach(function(a){h.push({audio_object:a,volume:a.volume});a.volume=0});m=[]};k.stop_audio_objects=function(){m.forEach(function(a){a.pause();a.currentTime=0})};k.restore_audio_volumes=
function(){h.forEach(function(a){a.audio_object.volume=a.volume;m.push(a.audio_object)});h=[]};k.is_attached=function(a){return jQuery.contains(window.document,a)};k.when_attached=function(a,b,c){var d=a.toontalk_attached_callback,e;e=d?function(){d();b()}:b;jQuery.contains(window.document,a)&&!c?(a.toontalk_attached_callback=void 0,$(a).removeClass("toontalk-has-attached-callback"),e()):(a.toontalk_attached_callback=e,c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};
k.create_event=function(a,b){var c;try{c=new CustomEvent(a,{detail:b})}catch(d){c=document.createEvent("CustomEvent"),c.initCustomEvent("myMessage",!1,!1,b)}return c};k.create_queue=function(){var a=[],b=0;return{getLength:function(){return a.length-b},isEmpty:function(){return 0==a.length},enqueue:function(b){var c=0==a.length;a.push(b);e.logging&&0<=e.logging.indexOf("queue")&&console.log(b._debug_string+" enqueued");return c},dequeue:function(){var c;if(0!=a.length)return c=a[b],e.logging&&0<=
e.logging.indexOf("queue")&&console.log(c._debug_string+" dequeued"),2*++b>=a.length&&(a=a.slice(b),b=0),c},peek:function(){return 0<a.length?a[b]:void 0},does_any_item_satisfy:function(c){var d;for(d=b;d<a.length;d++)if(c(a[d]))return!0;return!1}}};return k}(window.TOONTALK);
