(function(b){var k;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(k={},define(function(){return k})):k="undefined"!==typeof window?window:b:k=exports;(function(b){var c={greatest_common_divisor:function(f,b){if(1===b||1===f)return 1;for(var a;0!==b;){a=b;b=f%b;if(!isFinite(b))return 0;f=a}return f}};c.gcd=c.greatest_common_divisor;c.fromRandom=function(f){return Math.random()*(1<<f)>>>0};c.fromMillitime=function(){return+new Date};c.fromUnixtime=
function(){return.001*c.fromMillitime()|0};"undefined"!==typeof b&&(b.integer=c);(function(f){function b(f,c,e){if(e!==a)return f instanceof b?f:"undefined"===typeof f?d:b.parse(f);for(f=f||[];f.length&&!f[f.length-1];)--f.length;this._d=f;this._s=f.length?c||1:0}var a={};b._construct=function(f,d){return new b(f,d,a)};b.base=1E7;b.base_log10=7;var d=new b([],0,a);b.ZERO=d;var c=new b([1],1,a);b.ONE=c;var e=new b(c._d,-1,a);b.M_ONE=e;b._0=d;b._1=c;b.small=[d,c,new b([2],1,a),new b([3],1,a),new b([4],
1,a),new b([5],1,a),new b([6],1,a),new b([7],1,a),new b([8],1,a),new b([9],1,a),new b([10],1,a),new b([11],1,a),new b([12],1,a),new b([13],1,a),new b([14],1,a),new b([15],1,a),new b([16],1,a),new b([17],1,a),new b([18],1,a),new b([19],1,a),new b([20],1,a),new b([21],1,a),new b([22],1,a),new b([23],1,a),new b([24],1,a),new b([25],1,a),new b([26],1,a),new b([27],1,a),new b([28],1,a),new b([29],1,a),new b([30],1,a),new b([31],1,a),new b([32],1,a),new b([33],1,a),new b([34],1,a),new b([35],1,a),new b([36],
1,a)];b.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");b.prototype.toString=function(f){f=+f||10;if(2>f||36<f)throw Error("illegal radix "+f+".");if(0===this._s)return"0";if(10===f){f=0>this._s?"-":"";f+=this._d[this._d.length-1].toString();for(var a=this._d.length-2;0<=a;a--){for(var d=this._d[a].toString();7>d.length;)d="0"+d;f+=d}return f}a=b.digits;f=b.small[f];for(var d=this._s,c=this.abs(),e=[],g;0!==c._s;)g=c.divRem(f),c=g[0],g=g[1],e.push(a[g.valueOf()]);return(0>d?"-":"")+e.reverse().join("")};
b.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];b.parse=function(f,c){function e(f){f=f.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return f.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(f,b,a,d,c){c=+c;var p=0>c,e=a.length+c;f=(p?a:d).length;c=(c=Math.abs(c))>=f?c-f+p:0;f=Array(c+1).join("0");a+=d;return(b||"")+(p?a=f+a:a+=f).substr(0,e+=p?f.length:0)+(e<a.length?"."+a.substr(e):"")})}f=f.toString();if("undefined"===typeof c||10===+c)f=e(f);var g=(new RegExp("^([+\\-]?)("+("undefined"===
typeof c?"0[xcb]":16==c?"0x":8==c?"0c":2==c?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(f);if(g){var h=g[1]||"+",l=g[2]||"",g=g[3]||"";if("undefined"===typeof c)c="0x"===l||"0X"===l?16:"0c"===l||"0C"===l?8:"0b"===l||"0B"===l?2:10;else if(2>c||36<c)throw Error("Illegal radix "+c+".");c=+c;if(!b.radixRegex[c].test(g))throw Error("Bad digit for radix "+c);g=g.replace(/^0+/,"").split("");if(0===g.length)return d;h="-"===h?-1:1;if(10==c){for(l=[];7<=g.length;)l.push(parseInt(g.splice(g.length-b.base_log10,
b.base_log10).join(""),10));l.push(parseInt(g.join(""),10));return new b(l,h,a)}l=d;c=b.small[c];for(var m=b.small,n=0;n<g.length;n++)l=l.multiply(c).add(m[parseInt(g[n],36)]);return new b(l._d,h,a)}throw Error("Invalid BigInteger format: "+f);};b.prototype.add=function(f){if(0===this._s)return b(f);f=b(f);if(0===f._s)return this;if(this._s!==f._s)return f=f.negate(),this.subtract(f);var d=this._d;f=f._d;for(var c=d.length,e=f.length,g=Array(Math.max(c,e)+1),h=Math.min(c,e),l=0,m=0;m<h;m++)l=d[m]+
f[m]+l,g[m]=l%1E7,l=l/1E7|0;e>c&&(d=f,c=e);for(m=h;l&&m<c;m++)l=d[m]+l,g[m]=l%1E7,l=l/1E7|0;for(l&&(g[m]=l);m<c;m++)g[m]=d[m];return new b(g,this._s,a)};b.prototype.negate=function(){return new b(this._d,-this._s|0,a)};b.prototype.abs=function(){return 0>this._s?this.negate():this};b.prototype.subtract=function(f){if(0===this._s)return b(f).negate();f=b(f);if(0===f._s)return this;if(this._s!==f._s)return f=f.negate(),this.add(f);var c=this;0>this._s&&(c=new b(f._d,1,a),f=new b(this._d,1,a));var e=
c.compareAbs(f);if(0===e)return d;if(0>e){var g=f;f=c;c=g}c=c._d;f=f._d;var g=c.length,h=f.length,l=Array(g),m=0,n,p;for(n=0;n<h;n++)p=c[n]-m-f[n],0>p?(p+=1E7,m=1):m=0,l[n]=p;for(n=h;n<g;n++){p=c[n]-m;if(0>p)p+=1E7;else{l[n++]=p;break}l[n]=p}for(;n<g;n++)l[n]=c[n];return new b(l,e,a)};(function(){function f(d,c){for(var e=d._d,g=e.slice(),h=0;;){var l=(e[h]||0)+1;g[h]=l%1E7;if(9999999>=l)break;++h}return new b(g,c,a)}function d(f,c){for(var e=f._d,g=e.slice(),h=0;;){var l=(e[h]||0)-1;if(0>l)g[h]=
l+1E7;else{g[h]=l;break}++h}return new b(g,c,a)}b.prototype.next=function(){switch(this._s){case 0:return c;case -1:return d(this,-1);default:return f(this,1)}};b.prototype.prev=function(){switch(this._s){case 0:return e;case -1:return f(this,-1);default:return d(this,1)}}})();b.prototype.compareAbs=function(f){if(this===f)return 0;if(!(f instanceof b)){if(!isFinite(f))return isNaN(f)?f:-1;f=b(f)}if(0===this._s)return 0!==f._s?-1:0;if(0===f._s)return 1;var a=this._d.length,d=f._d.length;if(a<d)return-1;
if(a>d)return 1;d=this._d;f=f._d;for(--a;0<=a;a--)if(d[a]!==f[a])return d[a]<f[a]?-1:1;return 0};b.prototype.compare=function(f){if(this===f)return 0;f=b(f);return 0===this._s?-f._s:this._s===f._s?this.compareAbs(f)*this._s:this._s};b.prototype.isUnit=function(){return this===c||this===e||1===this._d.length&&1===this._d[0]};b.prototype.multiply=function(f){if(0===this._s)return d;f=b(f);if(0===f._s)return d;if(this.isUnit())return 0>this._s?f.negate():f;if(f.isUnit())return 0>f._s?this.negate():this;
if(this===f)return this.square();var c=this._d.length>=f._d.length,e=(c?this:f)._d,c=(c?f:this)._d,g=e.length,h=c.length,l=g+h,m=Array(l),n;for(n=0;n<l;n++)m[n]=0;for(n=0;n<h;n++){for(var l=0,p=c[n],u=g+n,k,r=n;r<u;r++)k=m[r]+p*e[r-n]+l,l=k/1E7|0,m[r]=k%1E7|0;l&&(k=m[r]+l,m[r]=k%1E7)}return new b(m,this._s*f._s,a)};b.prototype.multiplySingleDigit=function(f){if(0===f||0===this._s)return d;if(1===f)return this;var c;if(1===this._d.length)return c=this._d[0]*f,1E7<=c?new b([c%1E7|0,c/1E7|0],1,a):new b([c],
1,a);if(2===f)return this.add(this);if(this.isUnit())return new b([f],1,a);var e=this._d,g=e.length;c=g+1;for(var h=Array(c),l=0;l<c;l++)h[l]=0;for(var m=l=0;m<g;m++)c=f*e[m]+l,l=c/1E7|0,h[m]=c%1E7|0;l&&(h[m]=l);return new b(h,1,a)};b.prototype.square=function(){if(0===this._s)return d;if(this.isUnit())return c;var f=this._d,e=f.length,g=Array(e+e+1),h,l,m,n;for(n=0;n<e;n++)m=2*n,h=f[n]*f[n],l=h/1E7|0,g[m]=h%1E7,g[m+1]=l;for(n=0;n<e;n++){l=0;m=2*n+1;for(var k=n+1;k<e;k++,m++)h=f[k]*f[n]*2+g[m]+l,
l=h/1E7|0,g[m]=h%1E7;m=e+n;h=l+g[m];l=h/1E7|0;g[m]=h%1E7;g[m+1]+=l}return new b(g,1,a)};b.prototype.quotient=function(f){return this.divRem(f)[0]};b.prototype.divide=b.prototype.quotient;b.prototype.remainder=function(f){return this.divRem(f)[1]};b.prototype.divRem=function(f){f=b(f);if(0===f._s)throw Error("Divide by zero");if(0===this._s)return[d,d];if(1===f._d.length)return this.divRemSmall(f._s*f._d[0]);switch(this.compareAbs(f)){case 0:return[this._s===f._s?c:e,d];case -1:return[d,this]}var g=
this._s*f._s,h=f.abs(),l=this._d,m=l.length,n=[],k,r=new b([],0,a);for(r._s=1;m;)if(r._d.unshift(l[--m]),0>r.compareAbs(f))n.push(0);else{if(0===r._s)k=0;else{var p=r._d.length;k=h._d.length;p=1E7*r._d[p-1]+r._d[p-2];k=1E7*h._d[k-1]+h._d[k-2];r._d.length>h._d.length&&(p=1E7*(p+1));k=Math.ceil(p/k)}do{p=h.multiplySingleDigit(k);if(0>=p.compareAbs(r))break;k--}while(k);n.push(k);k&&(k=r.subtract(p),r._d=k._d.slice(),0===r._d.length&&(r._s=0))}return[new b(n.reverse(),g,a),new b(r._d,this._s,a)]};b.prototype.divRemSmall=
function(f){f=+f;if(0===f)throw Error("Divide by zero");var c=this._s*(0>f?-1:1);f=Math.abs(f);if(1>f||1E7<=f)throw Error("Argument out of range");if(0===this._s)return[d,d];if(1===f||-1===f)return[1===c?this.abs():new b(this._d,c,a),d];if(1===this._d.length){var e=new b([this._d[0]/f|0],1,a);f=new b([this._d[0]%f|0],1,a);0>c&&(e=e.negate());0>this._s&&(f=f.negate());return[e,f]}for(var g=this._d.slice(),e=Array(g.length),h=0,l=0,m=0,n;g.length;)h=1E7*h+g[g.length-1],h<f?(e[m++]=0,g.pop(),l=1E7*l+
h):(n=0===h?0:h/f|0,l=h-f*n,(e[m++]=n)?(g.pop(),h=l):g.pop());f=new b([l],1,a);0>this._s&&(f=f.negate());return[new b(e.reverse(),c,a),f]};b.prototype.isEven=function(){var f=this._d;return 0===this._s||0===f.length||0===f[0]%2};b.prototype.isOdd=function(){return!this.isEven()};b.prototype.sign=function(){return this._s};b.prototype.isPositive=function(){return 0<this._s};b.prototype.isNegative=function(){return 0>this._s};b.prototype.isZero=function(){return 0===this._s};b.prototype.exp10=function(f){f=
+f;if(0===f)return this;if(Math.abs(f)>Number(g))throw Error("exponent too large in BigInteger.exp10");if(0<f){for(var c=new b(this._d.slice(),this._s,a);7<=f;f-=7)c._d.unshift(0);if(0==f)return c;c._s=1;c=c.multiplySingleDigit(Math.pow(10,f));return 0>this._s?c.negate():c}if(-f>=7*this._d.length)return d;c=new b(this._d.slice(),this._s,a);for(f=-f;7<=f;f-=7)c._d.shift();return 0==f?c:c.divRemSmall(Math.pow(10,f))[0]};b.prototype.pow=function(f){if(this.isUnit())return 0<this._s?this:b(f).isOdd()?
this:this.negate();f=b(f);if(0===f._s)return c;if(0>f._s){if(0===this._s)throw Error("Divide by zero");return d}if(0===this._s)return d;if(f.isUnit())return this;if(0<f.compareAbs(g))throw Error("exponent too large in BigInteger.pow");for(var a=this,e=c,h=b.small[2];f.isPositive()&&(!f.isOdd()||(e=e.multiply(a),!f.isUnit()));)a=a.square(),f=f.quotient(h);return e};b.prototype.modPow=function(f,a){for(var d=c,e=this;f.isPositive();)f.isOdd()&&(d=d.multiply(e).remainder(a)),f=f.quotient(b.small[2]),
f.isPositive()&&(e=e.square().remainder(a));return d};b.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var f=this._d.length;if(30>7*f)return Math.log(this.valueOf());var c=Math.ceil(30/7),d=this._d.slice(f-c);return Math.log((new b(d,1,a)).valueOf())+(f-c)*Math.log(1E7)};b.prototype.valueOf=function(){return parseInt(this.toString(),10)};b.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var g=b(2147483647);b.MAX_EXP=g;(function(){function f(a){return function(f){return a.call(b(f))}}
function a(f){return function(a,c){return f.call(b(a),b(c))}}function c(f){return function(a,c,d){return f.call(b(a),b(c),b(d))}}(function(){var d,e,g="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),h="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),l=["modPow"];for(d=0;d<g.length;d++)e=g[d],b[e]=f(b.prototype[e]);for(d=0;d<h.length;d++)e=h[d],b[e]=a(b.prototype[e]);for(d=0;d<l.length;d++)e=
l[d],b[e]=c(b.prototype[e]);b.exp10=function(f,a){return b(f).exp10(a)}})()})();f.BigInteger=b})("undefined"!==typeof b?b:this);var a={greatest_common_divisor:function(f,b){if(b.isUnit()||f.isUnit())return BigInteger.ONE;for(var a;!b.isZero();)a=b,b=f.remainder(b),f=a;return f},create:function(){return[0]},clone:function(f){for(var b=[],a=0,d=f.length;a<d;a++)b[a]=f[a];return b},copy:function(f,b){f=[];for(var a=0,d=b.length;a<d;a++)f[a]=b[a];return f},abs:function(f,b){f[0]=Math.abs(b[0]);return f},
str:function(f){return f[0].toString()},toInteger:function(f){return out[0]},fromInteger:function(f){return[parseInt(f)]}};a.ZERO=a.fromInteger(0);a.ONE=a.fromInteger(1);"undefined"!==typeof b&&(b.bigint=a);if(!h)var h=Array;if(!m)var m=Math.pow(2,56);if(!l)var l=16777216;var d={EPSILON:2E-16};d.MAX_LOOPS=l;d.create=function(){var f=new h(2);f[0]=0;f[1]=1;return f};d.clone=function(f){var b=new h(2);b[0]=f[0];b[1]=f[1];return b};d.fromValues=function(f,b){var a=new h(2);a[0]=f;a[1]=b;return d.normalize(a,
a)};d.copy=function(f,b){f[0]=b[0];f[1]=b[1];return f};d.set=function(f,b,a){f[0]=b;f[1]=a;return d.normalize(f,f)};d.abs=function(f,b){f[0]=Math.abs(b[0]);f[1]=b[1];return f};d.invert=function(f,b){var a=b[0];f[0]=b[1];f[1]=a;return f};d.reciprocal=d.invert;d.add=function(f,b,a){b[1]===a[1]?(f[0]=b[0]+a[0],f[1]=b[1]):(f[0]=b[0]*a[1]+a[0]*b[1],f[1]=b[1]*a[1]);return d.normalize(f,f)};d.subtract=function(f,b,a){b[1]===a[1]?(f[0]=b[0]-a[0],f[1]=b[1]):(f[0]=b[0]*a[1]-a[0]*b[1],f[1]=b[1]*a[1]);return d.normalize(f,
f)};d.sub=d.subtract;d.multiply=function(f,b,a){f[0]=b[0]*a[0];f[1]=b[1]*a[1];return d.normalize(f,f)};d.mul=d.multiply;d.mediant=function(f,b,a){f[0]=b[0]+a[0];f[1]=b[1]+a[1];return d.normalize(f,f)};d.divide=function(f,b,a){f[0]=b[0]*a[1];f[1]=b[1]*a[0];return d.normalize(f,f)};d.div=d.divide;d.equals=function(f,b){return 0===f[0]&&0===b[0]||0===f[1]&&0===b[1]?!0:f[0]===b[0]&&f[1]===b[1]};d.approximates=function(f,b){if(d.equals(f,b))return!0;var a=d.create();d.sub(a,f,b);d.abs(a,a);return d.isLessThan(a,
d.INFINITESIMAL)};d.isGreaterThan=function(f,b){return d.equals(f,b)?!1:f[0]*b[1]>b[0]*f[1]};d.isLessThan=function(f,b){return d.equals(f,b)?!1:f[0]*b[1]<b[0]*f[1]};d.isNegative=function(f){return 0>f[0]};d.min=function(f,b,a){d.isLessThan(b,a)?(f[0]=b[0],f[1]=b[1]):(f[0]=a[0],f[1]=a[1]);return f};d.max=function(f,b,a){d.isGreaterThan(b,a)?(f[0]=b[0],f[1]=b[1]):(f[0]=a[0],f[1]=a[1]);return f};d.scalar_multiply=function(f,b,a){f[0]=b[0]*a;f[1]=b[1];return d.normalize(f,f)};d.scalar_divide=function(f,
b,a){f[0]=b[0];f[1]=b[1]*a;return d.normalize(f,f)};d.normalize=function(f,b){if(isNaN(b[0])||isNaN(b[1])||0===b[0]&&0===b[1])return f[0]=0,f[1]=0,f;if(0===b[0])return f[0]=0,f[1]=1,f;if(0===b[1])return f[0]=1,f[1]=0,f;if(b[0]===b[1])return f[0]=1,f[1]=1,f;0<b[1]?(f[0]=b[0],f[1]=b[1]):(f[0]=-b[0],f[1]=-b[1]);var a=c.greatest_common_divisor(Math.abs(f[0]),f[1]);1<a&&(f[0]/=a,f[1]/=a);return f};d.opposite=function(f,b){f[0]=-b[0];f[1]=b[1];return f};d.negative=d.opposite;d.neg=d.opposite;d.power=function(f,
b,a){2===a?(f[0]=b[0]*b[0],f[1]=b[1]*b[1]):0<a?(f[0]=Math.pow(b[0],a),f[1]=Math.pow(b[1],a)):0>a?(a=Math.abs(a),f[0]=Math.pow(b[1],a),f[1]=Math.pow(b[0],a)):d.copy(f,d.ONE);return d.normalize(f,f)};d.pow=d.power;d.sqrt=function(f,b){return d.nthRoot(f,b,2)};d.nthRoot=function(f,b,a){if(d.equals(b,d.ZERO))return d.copy(f,d.ZERO);if(d.equals(b,d.ONE))return d.copy(f,d.ONE);if(d.equals(b,d.INFINITY))return d.copy(f,d.INFINITY);if(d.equals(b,d.INFINULL))return d.copy(f,d.INFINULL);var c=d.isNegative(b);
c&&(b[0]=-b[0]);f=d.copy(f,d.ONE);for(var e=[1,0,0,1],g=d.clone(d.ONE),h=d.MAX_LOOPS;!d.approximates(b,g)&&h--;)d.isLessThan(b,g)?(e[0]+=e[1],e[2]+=e[3]):(e[1]+=e[0],e[3]+=e[2]),f[0]=e[0]+e[1],f[1]=e[2]+e[3],d.pow(g,f,a);c&&(b[0]=-b[0],1===a%2&&d.neg(f,f));return f};d.dot=function(f,b){return f[0]*b[0]+f[1]*b[1]};d.str=function(f){return 1===f[1]?f[0].toString():f[0]+"/"+f[1]};d.toDecimal=function(f){return f[0]/f[1]};d.dec=d.toDecimal;d.toInteger=function(f){return Math.round(d.toDecimal(f))};d.round=
d.toInteger;d.floor=function(f){return Math.floor(d.toDecimal(f))};d.ceil=function(f){return Math.ceil(d.toDecimal(f))};d.fromInteger_copy=function(f,b){f[0]=parseInt(b);f[1]=1;return f};d.fromInteger=function(f){return d.fromInteger_copy(d.create(),f)};d.fromIntegerInverse_copy=function(f,b){f[0]=1;f[1]=parseInt(b);0>f[1]&&(f[0]=-f[0],f[1]=-f[1]);return f};d.fromIntegerInverse=function(f){return d.fromIntegerInverse_copy(d.create(),f)};d.fromDecimal=function(f){return d.fromDecimal_copy(d.create(),
f)};d.fromDecimal_copy=function(f,b){b=parseFloat(b);if(isNaN(b))return d.copy(f,d.INFINULL);if(Infinity===b)return d.copy(f,d.INFINITY);if(Math.abs(b)<d.EPSILON)return d.copy(f,d.ZERO);if(Math.abs(b-1)<d.EPSILON)return d.copy(f,d.ONE);if(Math.abs(b%1)<d.EPSILON)return d.fromInteger_copy(f,b);if(Math.abs(1/b%1)<d.EPSILON)return d.fromIntegerInverse_copy(f,Math.round(1/b));d.copy(f,d.ONE);for(var a=[1,0,0,1],c=b,e=1,g=d.MAX_LOOPS;g--&&Math.abs(b-d.toDecimal(f))>d.EPSILON;){e=Math.floor(c);f[0]=e*a[0]+
a[2];f[1]=e*a[1]+a[3];if(c===e)break;c=1/(c-e);a[2]=a[0];a[3]=a[1];a[0]=f[0];a[1]=f[1]}return f};d.fromRandom=function(f){f[0]=0xfffffffffffff*Math.random()<<0;f[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return d.normalize(f,f)};d.sin=function(f,b){if(0===b[1])return d.copy(f,d.ZERO);d.scalar_multiply(f,b,2);var a=d.create();d.pow(a,b,2);d.add(a,a,d.ONE);d.divide(f,f,a);return f};d.cos=function(f,b){if(0===b[1])return d.neg(f,d.ONE);var a=d.create();d.pow(a,b,2);d.sub(f,d.ONE,a);var c=d.create();
d.add(c,d.ONE,a);d.divide(f,f,c);return f};d.tan=function(f,b){d.scalar_multiply(f,b,2);var a=d.create();d.pow(a,b,2);d.scalar_multiply(a,a,2);d.add(f,f,a);d.pow(a,b,4);d.sub(a,d.ONE,a);d.divide(f,f,a);return f};d.toEgyptian=function(f){f=d.clone(f);d.abs(f,f);var b=d.floor(f);b&&d.sub(f,f,d.fromInteger(b));if(!f[0])return b.toString();b||(b="");for(var a=1,c=d.create();1!==f[0];)a++,c=d.fromValues(1,a),d.isGreaterThan(f,c)&&(b&&(b+=" + "),b+=d.str(c),d.sub(f,f,c));return f?b?b+" + "+d.str(f):d.str(f):
b?b:"0"};d.toBabylonian=function(f){var b="",a=d.toDecimal(f);f=parseInt(a);for(var a=a-f,c=0,e=0;0<f;)(c=f%60)&&(b=c+" * 60^"+e+(b?" + ":"")+b),f=(f-c)/60,e++;for(e=-1;0<a;)a*=60,c=parseInt(a+1E-13),a-=c,-1E-13>a||(c&&(b+=(b?" + ":"")+c+" * 60^"+e),e--);return b?b:"0"};d.traceSternBrocot=function(f){var b="";if(d.equals(f,d.ZERO)||d.equals(f,d.ONE)||d.equals(f,d.INFINITY)||d.equals(f,d.INFINULL))return b;f=d.clone(f);d.isNegative(f)&&(f[0]=-f[0]);for(var a=d.clone(d.ONE),c=[1,0,0,1],e=0,g=0,h=d.MAX_LOOPS;!d.approximates(f,
a)&&h--;)d.isLessThan(f,a)?(c[0]+=c[1],c[2]+=c[3],g++,e&&(b+="R",1!==e&&(b+=e),e=0,b+=" ")):(c[1]+=c[0],c[3]+=c[2],e++,g&&(b+="L",1!==g&&(b+=g),g=0,b+=" ")),a[0]=c[0]+c[1],a[1]=c[2]+c[3];g?(b+="L",1!==g&&(b+=g)):e&&(b+="R",1!==e&&(b+=e));0>h&&(b+="...");return b};d.toContinuedFraction=function(b,a){a="undefined"===typeof a?65536:parseInt(a);if(d.equals(b,d.ZERO))return[0];if(d.equals(b,d.ONE))return[1];if(d.equals(b,d.NEGONE))return[-1];if(d.equals(b,d.INFINITY))return[1,0];if(d.equals(b,d.INFINULL))return[0,
0];var c=d.clone(b),e=d.isNegative(c);e&&(c[0]=-c[0]);for(var g=d.clone(d.ONE),h=[1,0,0,1],l=1,m=[0],n=m.length-1;!d.equals(c,g)&&a--;)d.isLessThan(c,g)?(-1===l?m[n]++:(l=-1,m.push(1),n++),h[0]+=h[1],h[2]+=h[3]):(1===l?m[n]++:(l=1,m.push(1),n++),h[1]+=h[0],h[3]+=h[2]),g[0]=h[0]+h[1],g[1]=h[2]+h[3];0>a?m.push(0):m[n]++;if(e)for(var k in m)m[k]=-m[k];return m};d.fromContinuedFraction=function(b,a){d.fromInteger_copy(b,a[a.length-1]);for(var c=a.length-2;-1<c;c--)d.invert(b,b),d.add(b,d.fromInteger(a[c]),
b);return b};d.dump=function(b){d.create();return"rat\t"+d.str(b)+"\n~\t"+d.toDecimal(b)+"\nCF:\t["+d.toContinuedFraction(b)+"]\n"};d.ZERO=d.fromInteger(0);d.ONE=d.fromInteger(1);d.NEGONE=d.fromInteger(-1);d.INFINITY=d.fromValues(1,0);d.INFINULL=d.fromValues(0,0);d.INFINITESIMAL=d.clone([1,m]);d.PI=d.fromValues(1320192667429,420230377710);"undefined"!==typeof b&&(b.rat=d);if(!k)var k=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!q)var q=1073741824;var g={EPSILON:2E-16};g.MAX_LOOPS=q;g.create=
function(){var b=[];b[0]=BigInteger.ZERO;b[1]=BigInteger.ONE;return b};g.clone=function(b){var a=[];a[0]=b[0];a[1]=b[1];return a};g.fromValues=function(b,a){var c=[];c[0]=new BigInteger(b);c[1]=new BigInteger(a);return g.normalize(c,c)};g.copy=function(b,a){b[0]=a[0];b[1]=a[1];return b};g.set=function(b,a,c){b[0]=a;b[1]=c;return g.normalize(b,b)};g.toRat=function(b,a){return d.set(b,a[0].toJSValue(),a[1].toJSValue())};g.fromRat=function(b,a){return g.set(b,BigInteger(a[0]),BigInteger(a[1]))};g.abs=
function(b,a){b[0]=a[0].abs();b[1]=a[1];return b};g.invert=function(b,a){var c=a[0];b[0]=a[1];b[1]=c;return b};g.reciprocal=g.invert;g.add=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].add(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).add(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return g.normalize(b,b)};g.subtract=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].subtract(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).subtract(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return g.normalize(b,
b)};g.sub=g.subtract;g.multiply=function(b,a,c){b[0]=a[0].multiply(c[0]);b[1]=a[1].multiply(c[1]);return g.normalize(b,b)};g.mul=g.multiply;g.mediant=function(b,a,c){b[0]=a[0].add(c[0]);b[1]=a[1].add(c[1]);return g.normalize(b,b)};g.divide=function(b,a,c){b[0]=a[0].multiply(c[1]);b[1]=a[1].multiply(c[0]);return g.normalize(b,b)};g.div=g.divide;g.equals=function(b,a){return b[0].isZero()&&a[0].isZero()||b[1].isZero()&&a[1].isZero()?!0:0===b[0].compare(a[0])&&0===b[1].compare(a[1])};g.approximates=
function(b,a){if(g.equals(b,a))return!0;var c=g.create();g.sub(c,b,a);g.abs(c,c);return g.isLessThan(c,g.INFINITESIMAL)};g.isGreaterThan=function(b,a){return g.equals(b,a)?!1:0<b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};g.isLessThan=function(b,a){return g.equals(b,a)?!1:0>b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};g.isNegative=function(b){return b[0].isNegative()};g.min=function(b,a,c){g.isLessThan(a,c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};g.max=function(b,a,c){g.isGreaterThan(a,
c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};g.scalar_multiply=function(b,a,c){b[0]=a[0].multiply(c);b[1]=a[1];return g.normalize(b,b)};g.scalar_divide=function(b,a,c){b[0]=a[0];b[1]=a[1].multiply(c);return g.normalize(b,b)};g.normalize=function(b,c){if(c[0].isZero()||c[1].isZero())return c;if(0===c[0].compare(c[1]))return g.clone(g.ONE);if(c[1].isNegative())b[0]=c[0].negate(),b[1]=c[1].negate();else if(b[0]=c[0],b[1]=c[1],b[1].isZero())return b;var d=a.greatest_common_divisor(b[0].abs(),
b[1]);0<d.compare(BigInteger.ONE)&&(b[0]=b[0].quotient(d),b[1]=b[1].quotient(d));return b};g.opposite=function(b,a){b[0]=a[0].negate();b[1]=a[1];return b};g.negative=g.opposite;g.neg=g.opposite;g.power=function(b,a,c){2===c?(b[0]=a[0].square(),b[1]=a[1].square()):0<c?(b[0]=a[0].pow(c),b[1]=a[1].pow(c)):0>c?(c=Math.abs(c),b[0]=a[1].pow(c),b[1]=a[0].pow(c)):g.copy(b,g.ONE);return b};g.pow=g.power;g.sqrt=function(b,a){return g.nthRoot(b,a,2)};g.nthRoot=function(b,a,c){if(g.equals(a,g.ZERO))return g.copy(b,
g.ZERO);if(g.equals(a,g.ONE))return g.copy(b,g.ONE);if(g.equals(a,g.INFINITY))return g.copy(b,g.INFINITY);if(g.equals(a,g.INFINULL))return g.copy(b,g.INFINULL);var d=g.isNegative(a);d&&(a[0]=a[0].negate());g.copy(b,g.ONE);for(var e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],h=g.clone(g.ONE),l=q;!g.approximates(a,h)&&l--;)g.isLessThan(a,h)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),b[0]=e[0].add(e[1]),b[1]=e[2].add(e[3]),g.pow(h,b,c);d&&(a[0]=
a[0].negate(),1===c%2&&g.neg(b,b));return b};g.dot=function(b,a){return b[0].multiply(a[0]).add(b[1].multiply(a[1]))};g.str=function(b){return 0===b[1].compare(BigInteger.ONE)?b[0].toString():b[0].toString()+"/"+b[1].toString()};g.toDecimal=function(b){return b[0].toJSValue()/b[1].toJSValue()};g.dec=g.toDecimal;g.toInteger=function(b){return b[0].quotient(b[1]).toJSValue()};g.round=g.toInteger;g.toBigInteger=function(b){return b[0].quotient(b[1])};g.floor=function(b){return Math.floor(g.toDecimal(b))};
g.ceil=function(b){return Math.ceil(g.toDecimal(b))};g.fromInteger_copy=function(b,a){b[0]=BigInteger(a);b[1]=BigInteger.ONE;return b};g.fromInteger=function(b){return g.fromInteger_copy(g.create(),b)};g.fromIntegerInverse_copy=function(b,a){b[0]=BigInteger.ONE;b[1]=BigInteger(a);b[1].isNegative()&&(b[0]=b[0].negate(),b[1]=b[1].negate());return b};g.fromIntegerInverse=function(b){return g.fromIntegerInverse_copy(g.create(),b)};g.fromDecimal=function(b){return g.fromDecimal_copy(g.create(),b)};g.fromDecimal_copy=
function(b,a){a=parseFloat(a);if(isNaN(a))return g.copy(b,g.INFINULL);if(Infinity===a)return g.copy(b,g.INFINITY);if(Math.abs(a)<g.EPSILON)return g.copy(b,g.ZERO);if(Math.abs(a-1)<g.EPSILON)return g.copy(b,g.ONE);if(Math.abs(a%1)<g.EPSILON)return g.fromInteger_copy(b,a);if(Math.abs(1/a%1)<g.EPSILON)return g.fromIntegerInverse_copy(b,Math.round(1/a));g.copy(b,g.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=a,e=BigInteger(1),h=g.MAX_LOOPS;h--&&Math.abs(a-g.toDecimal(b))>
g.EPSILON;){e=BigInteger(Math.floor(d));b[0]=e.multiply(c[0]).add(c[2]);b[1]=e.multiply(c[1]).add(c[3]);if(e=d-parseInt(e.toString(),10))d=1/e;else{if(a.toString()===g.toDecimal(b))break;d=(c=(a.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;g.add(b,g.fromInteger(c[1]),g.fromValues(c[2],Math.pow(10,d)));break}c[2]=c[0];c[3]=c[1];c[0]=b[0];c[1]=b[1]}return b};g.fromRandom=function(b){b[0]=BigInteger(0xfffffffffffff*Math.random()<<0);b[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return g.normalize(b,b)};g.sin=function(b,a){if(a[1].isZero())return g.copy(b,g.ZERO);g.scalar_multiply(b,a,2);var c=g.create();g.pow(c,a,2);g.add(c,c,g.ONE);g.divide(b,b,c);return b};g.cos=function(b,a){if(a[1].isZero())return g.neg(b,g.ONE);var c=g.create();g.pow(c,a,2);g.sub(b,g.ONE,c);var d=g.create();g.add(d,g.ONE,c);g.divide(b,b,d);return b};g.tan=function(b,a){g.scalar_multiply(b,a,2);var c=g.create();g.pow(c,a,2);g.scalar_multiply(c,c,2);g.add(b,b,c);g.pow(c,a,4);g.sub(c,
g.ONE,c);g.divide(b,b,c);return b};g.toEgyptian=function(b){b=g.clone(b);g.abs(b,b);var a=g.floor(b);a&&g.sub(b,b,g.fromInteger(a));if(!b[0])return a.toString();a||(a="");for(var c=1,d=g.create();1!==b[0];)c++,d=g.fromValues(1,c),g.isGreaterThan(b,d)&&(a&&(a+=" + "),a+=g.str(d),g.sub(b,b,d));return b?a?a+" + "+g.str(b):g.str(b):a?a:"0"};g.toBabylonian=function(b){var a="",c=g.toDecimal(b);b=parseInt(c);for(var c=c-b,d=0,e=0;0<b;)(d=b%60)&&(a=d+" * 60^"+e+(a?" + ":"")+a),b=(b-d)/60,e++;for(e=-1;0<
c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(a+=(a?" + ":"")+d+" * 60^"+e),e--);return a?a:"0"};g.traceSternBrocot=function(b){var a="";if(g.equals(b,g.ZERO)||g.equals(b,g.ONE)||g.equals(b,g.INFINITY)||g.equals(b,g.INFINULL))return a;b=g.clone(b);g.isNegative(b)&&(b[0]=b[0].negate());for(var c=g.clone(g.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=0,h=0,l=65536;!g.equals(b,c)&&l--;)g.isLessThan(b,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),h++,e&&(a+="R",1!==e&&(a+=e),e=
0,a+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),e++,h&&(a+="L",1!==h&&(a+=h),h=0,a+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);h?(a+="L",1!==h&&(a+=h)):e&&(a+="R",1!==e&&(a+=e));0>l&&(a+="...");return a};g.toContinuedFraction=function(b,a){a="undefined"===typeof a?65536:parseInt(a);if(g.equals(b,g.ZERO))return[0];if(g.equals(b,g.ONE))return[1];if(g.equals(b,g.NEGONE))return[-1];if(g.equals(b,g.INFINITY))return[1,0];if(g.equals(b,g.INFINULL))return[0,0];var c=g.clone(b),d=g.isNegative(c);d&&
(c[0]=c[0].negate());for(var e=g.clone(g.ONE),h=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],l=1,m=[0],n=m.length-1;!g.equals(c,e)&&a--;)g.isLessThan(c,e)?(-1===l?m[n]++:(l=-1,m.push(1),n++),h[0]=h[0].add(h[1]),h[2]=h[2].add(h[3])):(1===l?m[n]++:(l=1,m.push(1),n++),h[1]=h[1].add(h[0]),h[3]=h[3].add(h[2])),e[0]=h[0].add(h[1]),e[1]=h[2].add(h[3]);0>a?m.push(0):m[n]++;if(d)for(var k in m)m[k]=-m[k];return m};g.fromContinuedFraction=function(b,a){g.fromInteger_copy(b,a[a.length-1]);for(var c=
a.length-2;-1<c;c--)g.invert(b,b),g.add(b,g.fromInteger(a[c]),b);return b};g.fromFactorial=function(b,a){if("undefined"!==typeof factorial.PREPARED[a])return g.fromInteger_copy(b,factorial.PREPARED[a]);var c=factorial.PREPARED.length-1;for(g.fromInteger_copy(b,factorial.PREPARED[c]);c<a;)g.scalar_multiply(b,b,++c);return b};g.dump=function(b){return"bigrat\t"+g.str(b)+"\n~\t"+g.toDecimal(b)+"\nCF:\t["+g.toContinuedFraction(b)+"]\n"};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);g.NEGONE=g.fromInteger(-1);
g.INFINITY=g.fromValues(1,0);g.INFINULL=g.fromValues(0,0);g.INFINITESIMAL=g.clone([new BigInteger(1),k]);g.PI=g.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof b&&(b.bigrat=g);var n=function(b,a){this.a=d.fromValues(parseInt(b),parseInt(a))};n.prototype.toString=function(){return d.str(this.a)};n.prototype.toContinuedFraction=function(b){return d.toContinuedFraction(this.a,b)};n.prototype.invert=function(){return d.invert(this.a)};n.prototype.reciprocal=n.prototype.invert;n.prototype.add=function(b){var a=d.create();d.add(a,this.a,b.a);return new n(a[0],a[1])};n.prototype.plus=n.prototype.add;n.prototype.subtract=function(b){var a=d.create();
d.sub(a,this.a,b.a);return new n(a[0],a[1])};n.prototype.sub=n.prototype.subtract;n.prototype.minus=n.prototype.subtract;n.prototype.multiply=function(b){var a=d.create();d.mul(a,this.a,b.a);return new n(a[0],a[1])};n.prototype.mul=n.prototype.multiply;n.prototype.times=n.prototype.multiply;n.prototype.mediant=function(b){var a=d.create();d.mediant(a,this.a,b.a);return new n(a[0],a[1])};n.prototype.divide=function(b){var a=d.create();d.div(a,this.a,b.a);return new n(a[0],a[1])};n.prototype.div=n.prototype.divide;
n.prototype.divided_by=n.prototype.divide;n.prototype.power=function(b){var a=d.create();d.pow(a,this.a,b);return new n(a[0],a[1])};n.prototype.pow=n.prototype.power;n.prototype.dump=function(){return d.dump(this.a)};n.prototype.toRat=function(){return d.clone(this.a)};n.prototype.toDecimal=function(){return d.toDecimal(this.a)};n.fromRat=function(b){var a=new n;a.a[0]=b[0];a.a[1]=b[1];return a};n.fromInteger=function(b){return n.fromRat(d.fromInteger(b))};n.fromIntegerInverse=function(b){return n.fromRat(d.fromIntegerInverse(b))};
n.fromDecimal=function(b){return n.fromRat(d.fromDecimal(b))};n.fromContinuedFraction=function(b){return n.fromRat(d.fromContinuedFraction(d.create(),b))};"undefined"!==typeof b&&(b.rational=n);var r={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<r.GREEK.length?r.GREEK[this.i++]:"?"}}};"undefined"!==typeof b&&(b.alpha=r);m={};m.FINE_STRUCTURE=g.fromValues(30223,4141639);
m.a=m.FINE_STRUCTURE;m.FINE_STRUCTURE_ALT=g.fromValues(13355891,1830237867);m.PLANK=g.fromValues(662606957,1E42);m.h=m.PLANK;m.hBAR=g.fromValues(1054571726,1E43);m.GRAVITATIONAL=g.fromValues(667384,1E16);m.G=m.GRAVITATIONAL;m.SPEED_OF_LIGHT=g.fromInteger(299792458);m.c=m.SPEED_OF_LIGHT;"undefined"!==typeof b&&(b.physics=m);var v={create:function(){return[[],[]]},fromValues:function(b){var a=v.create();a[0]=b.slice();b=v.countDimensions(a);for(a[1]=Array(b);b--;)a[1][b]=0;return v.normalize(a,a)},
mergeDimension:function(b,a,c){b[0]=[a.slice()];b[1].push(0);for(var d in c)b[0].push(c[d]);return b},evaluate:function(b,a,c){g.copy(b,g.ZERO);var d=v.countDimensions(a);if(0===d)return"0";if(1===d)for(var e in a[0]){if(a[0][e]){var d=g.fromInteger(a[0][e]),h=g.pow(g.create(),g.fromInteger(c[0]),a[1][0]+ +e);g.mul(d,d,h);g.add(b,b,d)}}else if(2===d)for(var l in a[0])for(e in a[0][l]){if(a[0][l][e]){var d=g.fromInteger(a[0][l][e]),h=g.pow(g.create(),g.fromInteger(c[0]),a[1][1]+ +e),m=g.pow(g.create(),
g.fromInteger(c[1]),a[1][0]+ +l);g.mul(d,d,h);g.mul(d,d,m);g.add(b,b,d)}}else if(3===d)for(var n in a[0])for(l in a[0][n])for(e in a[0][n][l]){if(a[0][n][l][e]){var d=g.fromInteger(a[0][n][l][e]),h=g.pow(g.create(),g.fromInteger(c[0]),a[1][2]+ +e),m=g.pow(g.create(),g.fromInteger(c[1]),a[1][1]+ +l),k=g.pow(g.create(),g.fromInteger(c[1]),a[1][0]+ +n);g.mul(d,d,h);g.mul(d,d,m);g.mul(d,d,k);g.add(b,b,d)}}else alert("unsupported dimension "+d);return b},derivatives:function(b){return[]},forEachNonZeroElement:function(b,
a){for(var c=b.slice(),d=0;"object"===typeof c[0];)c=c[0].slice(),d++;for(var e=d+1;0<e;--e){print(Array(e).join("[0]"));var c=eval("(a"+Array(e).join("[0]")+")"),h;for(h in c)for(var g=d+2;0<g;--g)print(c[h])}return""},str:function(b){var a="",c=new r.iterator,d=c.next(),e=c.next(),c=c.next(),h=v.countDimensions(b);if(0===h)a+=b.toString();else if(1===h)for(var g in b[0]){if(b[0][g]){a?a+=" "+(0>b[0][g]?"-":"+")+" ":0>b[0][g]&&(a+="-");var h=Math.abs(b[0][g]),l=b[1][0]+ +g;if(1!==h||0===l)a+=h;0!==
l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"))}}else if(2===h)for(var m in b[0])for(g in b[0][m]){if(b[0][m][g]){a?a+=" "+(0>b[0][m][g]?"-":"+")+" ":0>b[0][m][g]&&(a+="-");var h=Math.abs(b[0][m][g]),l=b[1][1]+ +g,n=b[1][0]+ +m;if(1!==h||0===n&&0===l)a+=h;0!==l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==n&&(a+=e+(1===n?"":"<sup>"+n+"</sup>"))}}else if(3===h)for(var k in b[0])for(m in b[0][k])for(g in b[0][k][m]){if(b[0][k][m][g]){a?a+=" "+(0>b[0][k][m][g]?"-":"+")+" ":0>b[0][k][m][g]&&(a+="-");var h=Math.abs(b[0][k][m][g]),
l=b[1][2]+ +g,n=b[1][1]+ +m,t=b[1][0]+ +k;if(1!==h||0===t&&0===n&&0===l)a+=h;0!==l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==n&&(a+=e+(1===n?"":"<sup>"+n+"</sup>"));0!==t&&(a+=c+(1===t?"":"<sup>"+t+"</sup>"))}}else alert("unsupported dimension "+h);""===a&&(a="0");return a},getJSFormula:function(b){var a="",c=v.countDimensions(b);if(0===c)return"0";if(1===c)for(var d in b[0])b[0][d]&&(a&&(a+="+"),a+=b[0][d],c=b[1][0]+ +d,0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var e in b[0])for(d in b[0][e]){if(b[0][e][d]){a&&
(a+="+");var a=a+b[0][e][d],c=b[1][1]+ +d,h=b[1][0]+ +e;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==h&&(a=1===h?a+"*m[1]":a+("*Math.pow(m[1],"+h+")"))}}else if(3===c)for(var g in b[0])for(e in b[0][g])for(d in b[0][g][e]){if(b[0][g][e][d]){a&&(a+="+");var a=a+b[0][g][e][d],c=b[1][2]+ +d,h=b[1][1]+ +e,l=b[1][0]+ +g;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==h&&(a=1===h?a+"*m[1]":a+("*Math.pow(m[1],"+h+")"));0!==l&&(a=1===l?a+"*m[2]":a+("*Math.pow(m[2],"+l+")"))}}else alert("unsupported dimension "+
c);""===a&&(a="0");return a}};String.prototype.repeat=function(b){return Array(b+1).join(this)};v.getGLSLFormula=function(b){var a="",c=v.countDimensions(b);if(0===c)return"0.0";if(1===c)for(var d in b[0])b[0][d]&&(a&&(a+="+"),a+=b[0][d]+".0",c=b[1][0]+ +d,0!==c&&(a=1===c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var e in b[0])for(d in b[0][e]){if(b[0][e][d]){a&&(a+="+");var a=a+(b[0][e][d]+".0"),c=b[1][1]+ +d,h=b[1][0]+ +e;0!==c&&(a=1===
c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==h&&(a=1===h?a+"*m_1":1<h?a+"*m_1".repeat(h):a+("*pow(1.0"+"*m_1".repeat(Math.abs(h))+",-1.0)"))}}else alert("unsupported dimension "+c);""===a&&(a="0.0");return a};v.toJSON=function(b){return JSON.stringify(b)};v.fromJSON=function(b){return JSON.parse(b)};v.normalize=function(b,a){return a};v.binary_operation=function(b,a,c,d){b=v.create();var e=v.countDimensions(a),h=v.countDimensions(c);a[1][g]!==c[1][g]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===e&&1===h){for(var g in a[0])b[0][g]="undefined"===typeof c[0][g]?a[0][g]:d(a[0][g],c[0][g]);for(g in c[0])"undefined"===typeof a[0][g]&&(b[0][g]=c[0][g]);for(g in b[0])"undefined"===typeof a[0][g]&&"undefined"===typeof c[0][g]&&(b[0][g]=null)}else alert("unsupported dimension "+e);for(g=e;g--;)b[1][g]=a[1][g];return b};v.add=function(b,a,c){return v.binary_operation(b,a,c,function(b,a){return b+a})};v.subtract=function(b,
a,c){return v.binary_operation(b,a,c,function(b,a){return b-a})};v.sub=v.subtract;v.multiply=function(b,a,c){return b};v.mul=v.multiply;v.divide=function(b,a,c){return b};v.div=v.divide;v.equals=function(b,a){return b[0]===a[0]&&b[1]===a[1]};v.countDimensions=function(b){return"object"===typeof b[0]?v._countDimensions(b[0],1):0};v._countDimensions=function(b,a){return"object"===typeof b[0]?v._countDimensions(b[0],++a):a};v.ZERO=v.fromValues([0]);v.IDENTITY=v.fromValues([1]);v.ONE=v.IDENTITY;"undefined"!==
typeof b&&(b.polyrat=v)})(k)})(this);(function(b){"function"===typeof define&&define.amd?define(["jquery"],function(k){return b(k,window,document)}):"object"===typeof exports?module.exports=function(k,e){k||(k=window);e||(e="undefined"!==typeof window?require("jquery"):require("jquery")(k));return b(e,k,k.document)}:b(jQuery,window,document)})(function(b,k,e,c){function a(c){var d,e,f={};b.each(c,function(b){(d=b.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(d[1]+" ")&&(e=b.replace(d[0],d[2].toLowerCase()),
f[e]=b,"o"===d[1]&&a(c[b]))});c._hungarianMap=f}function h(S,d,e){S._hungarianMap||a(S);var f;b.each(d,function(a){f=S._hungarianMap[a];f===c||!e&&d[f]!==c||("o"===f.charAt(0)?(d[f]||(d[f]={}),b.extend(!0,d[f],d[a]),h(S[f],d[f],e)):d[f]=d[a])})}function m(b){var a=B.defaults.oLanguage,c=b.sZeroRecords;!b.sEmptyTable&&c&&"No data available in table"===a.sEmptyTable&&ha(b,b,"sZeroRecords","sEmptyTable");!b.sLoadingRecords&&c&&"Loading..."===a.sLoadingRecords&&ha(b,b,"sZeroRecords","sLoadingRecords");
b.sInfoThousands&&(b.sThousands=b.sInfoThousands);(b=b.sDecimal)&&fb(b)}function l(b){da(b,"ordering","bSort");da(b,"orderMulti","bSortMulti");da(b,"orderClasses","bSortClasses");da(b,"orderCellsTop","bSortCellsTop");da(b,"order","aaSorting");da(b,"orderFixed","aaSortingFixed");da(b,"paging","bPaginate");da(b,"pagingType","sPaginationType");da(b,"pageLength","iDisplayLength");da(b,"searching","bFilter");"boolean"===typeof b.sScrollX&&(b.sScrollX=b.sScrollX?"100%":"");"boolean"===typeof b.scrollX&&
(b.scrollX=b.scrollX?"100%":"");if(b=b.aoSearchCols)for(var a=0,c=b.length;a<c;a++)b[a]&&h(B.models.oSearch,b[a])}function d(a){da(a,"orderable","bSortable");da(a,"orderData","aDataSort");da(a,"orderSequence","asSorting");da(a,"orderDataType","sortDataType");var c=a.aDataSort;c&&!b.isArray(c)&&(a.aDataSort=[c])}function t(a){if(!B.__browser){var c={};B.__browser=c;var d=b("<div/>").css({position:"fixed",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(b("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(b("<div/>").css({width:"100%",height:10}))).appendTo("body"),e=d.children(),f=e.children();c.barWidth=e[0].offsetWidth-e[0].clientWidth;c.bScrollOversize=100===f[0].offsetWidth&&100!==e[0].clientWidth;c.bScrollbarLeft=1!==Math.round(f.offset().left);c.bBounding=d[0].getBoundingClientRect().width?!0:!1;d.remove()}b.extend(a.oBrowser,B.__browser);a.oScroll.iBarWidth=B.__browser.barWidth}function q(b,a,d,e,f,h){var g,p=!1;for(d!==c&&(g=d,p=!0);e!==f;)b.hasOwnProperty(e)&&
(g=p?a(g,b[e],e,b):b[e],p=!0,e+=h);return g}function g(a,c){var d=B.defaults.column,f=a.aoColumns.length,d=b.extend({},B.models.oColumn,d,{nTh:c?c:e.createElement("th"),sTitle:d.sTitle?d.sTitle:c?c.innerHTML:"",aDataSort:d.aDataSort?d.aDataSort:[f],mData:d.mData?d.mData:f,idx:f});a.aoColumns.push(d);d=a.aoPreSearchCols;d[f]=b.extend({},B.models.oSearch,d[f]);n(a,f,b(c).data())}function n(a,e,f){e=a.aoColumns[e];var g=a.oClasses,p=b(e.nTh);if(!e.sWidthOrig){e.sWidthOrig=p.attr("width")||null;var l=
(p.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);l&&(e.sWidthOrig=l[1])}f!==c&&null!==f&&(d(f),h(B.defaults.column,f),f.mDataProp!==c&&!f.mData&&(f.mData=f.mDataProp),f.sType&&(e._sManualType=f.sType),f.className&&!f.sClass&&(f.sClass=f.className),b.extend(e,f),ha(e,f,"sWidth","sWidthOrig"),f.iDataSort!==c&&(e.aDataSort=[f.iDataSort]),ha(e,f,"aDataSort"));var m=e.mData,n=L(m),u=e.mRender?L(e.mRender):null;f=function(b){return"string"===typeof b&&-1!==b.indexOf("@")};e._bAttrSrc=b.isPlainObject(m)&&
(f(m.sort)||f(m.type)||f(m.filter));e.fnGetData=function(b,a,d){var S=n(b,a,c,d);return u&&a?u(S,a,b,d):S};e.fnSetData=function(b,a,c){return H(m)(b,a,c)};"number"!==typeof m&&(a._rowReadObject=!0);a.oFeatures.bSort||(e.bSortable=!1,p.addClass(g.sSortableNone));a=-1!==b.inArray("asc",e.asSorting);f=-1!==b.inArray("desc",e.asSorting);e.bSortable&&(a||f)?a&&!f?(e.sSortingClass=g.sSortableAsc,e.sSortingClassJUI=g.sSortJUIAscAllowed):!a&&f?(e.sSortingClass=g.sSortableDesc,e.sSortingClassJUI=g.sSortJUIDescAllowed):
(e.sSortingClass=g.sSortable,e.sSortingClassJUI=g.sSortJUI):(e.sSortingClass=g.sSortableNone,e.sSortingClassJUI="")}function r(b){if(!1!==b.oFeatures.bAutoWidth){var a=b.aoColumns;Qa(b);for(var c=0,d=a.length;c<d;c++)a[c].nTh.style.width=a[c].sWidth}a=b.oScroll;""===a.sY&&""===a.sX||ua(b);T(b,null,"column-sizing",[b])}function v(b,a){var c=y(b,"bVisible");return"number"===typeof c[a]?c[a]:null}function f(a,c){var d=y(a,"bVisible"),d=b.inArray(c,d);return-1!==d?d:null}function w(b){return y(b,"bVisible").length}
function y(a,c){var d=[];b.map(a.aoColumns,function(b,a){b[c]&&d.push(a)});return d}function E(b){var a=b.aoColumns,d=b.aoData,e=B.ext.type.detect,f,g,h,p,l,m,n,u,k;f=0;for(g=a.length;f<g;f++)if(n=a[f],k=[],!n.sType&&n._sManualType)n.sType=n._sManualType;else if(!n.sType){h=0;for(p=e.length;h<p;h++){l=0;for(m=d.length;l<m;l++){k[l]===c&&(k[l]=G(b,l,f,"type"));u=e[h](k[l],b);if(!u&&h!==e.length-1)break;if("html"===u)break}if(u){n.sType=u;break}}n.sType||(n.sType="string")}}function N(a,d,e,f){var h,
p,l,m,n,u,k=a.aoColumns;if(d)for(h=d.length-1;0<=h;h--){u=d[h];var r=u.targets!==c?u.targets:u.aTargets;b.isArray(r)||(r=[r]);p=0;for(l=r.length;p<l;p++)if("number"===typeof r[p]&&0<=r[p]){for(;k.length<=r[p];)g(a);f(r[p],u)}else if("number"===typeof r[p]&&0>r[p])f(k.length+r[p],u);else if("string"===typeof r[p])for(m=0,n=k.length;m<n;m++)("_all"==r[p]||b(k[m].nTh).hasClass(r[p]))&&f(m,u)}if(e)for(h=0,a=e.length;h<a;h++)f(h,e[h])}function D(a,d,e,f){var h=a.aoData.length,g=b.extend(!0,{},B.models.oRow,
{src:e?"dom":"data",idx:h});g._aData=d;a.aoData.push(g);for(var p=a.aoColumns,l=0,m=p.length;l<m;l++)p[l].sType=null;a.aiDisplayMaster.push(h);d=a.rowIdFn(d);d!==c&&(a.aIds[d]=g);!e&&a.oFeatures.bDeferRender||A(a,h,e,f);return h}function J(a,c){var d;c instanceof b||(c=b(c));return c.map(function(b,c){d=u(a,c);return D(a,d.data,c,d.cells)})}function G(b,a,d,e){var f=b.iDraw,h=b.aoColumns[d],g=b.aoData[a]._aData,p=h.sDefaultContent,l=h.fnGetData(g,e,{settings:b,row:a,col:d});if(l===c)return b.iDrawError!=
f&&null===p&&(ka(b,0,"Requested unknown parameter "+("function"==typeof h.mData?"{function}":"'"+h.mData+"'")+" for row "+a+", column "+d,4),b.iDrawError=f),p;if((l===g||null===l)&&null!==p)l=p;else if("function"===typeof l)return l.call(g);return null===l&&"display"==e?"":l}function C(b,a,c,d){b.aoColumns[c].fnSetData(b.aoData[a]._aData,d,{settings:b,row:a,col:c})}function I(a){return b.map(a.match(/(\\.|[^\.])+/g)||[""],function(b){return b.replace(/\\./g,".")})}function L(a){if(b.isPlainObject(a)){var d=
{};b.each(a,function(b,a){a&&(d[b]=L(a))});return function(b,a,e,f){var S=d[a]||d._;return S!==c?S(b,a,e,f):b}}if(null===a)return function(b){return b};if("function"===typeof a)return function(b,c,d,e){return a(b,c,d,e)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var e=function(a,d,f){var S,h;if(""!==f){h=I(f);for(var g=0,p=h.length;g<p;g++){f=h[g].match(va);S=h[g].match(oa);if(f){h[g]=h[g].replace(va,"");""!==h[g]&&(a=a[h[g]]);S=[];h.splice(0,g+1);h=
h.join(".");if(b.isArray(a))for(g=0,p=a.length;g<p;g++)S.push(e(a[g],d,h));a=f[0].substring(1,f[0].length-1);a=""===a?S:S.join(a);break}else if(S){h[g]=h[g].replace(oa,"");a=a[h[g]]();continue}if(null===a||a[h[g]]===c)return c;a=a[h[g]]}}return a};return function(b,c){return e(b,c,a)}}return function(b){return b[a]}}function H(a){if(b.isPlainObject(a))return H(a._);if(null===a)return function(){};if("function"===typeof a)return function(b,c,d){a(b,"set",c,d)};if("string"===typeof a&&(-1!==a.indexOf(".")||
-1!==a.indexOf("[")||-1!==a.indexOf("("))){var d=function(a,e,f){f=I(f);var S;S=f[f.length-1];for(var h,g,p=0,l=f.length-1;p<l;p++){h=f[p].match(va);g=f[p].match(oa);if(h){f[p]=f[p].replace(va,"");a[f[p]]=[];S=f.slice();S.splice(0,p+1);h=S.join(".");if(b.isArray(e))for(g=0,l=e.length;g<l;g++)S={},d(S,e[g],h),a[f[p]].push(S);else a[f[p]]=e;return}g&&(f[p]=f[p].replace(oa,""),a=a[f[p]](e));if(null===a[f[p]]||a[f[p]]===c)a[f[p]]={};a=a[f[p]]}if(S.match(oa))a[S.replace(oa,"")](e);else a[S.replace(va,
"")]=e};return function(b,c){return d(b,c,a)}}return function(b,c){b[a]=c}}function M(b){return ga(b.aoData,"_aData")}function O(b){b.aoData.length=0;b.aiDisplayMaster.length=0;b.aiDisplay.length=0;b.aIds={}}function R(b,a,d){for(var e=-1,f=0,h=b.length;f<h;f++)b[f]==a?e=f:b[f]>a&&b[f]--; -1!=e&&d===c&&b.splice(e,1)}function p(b,a,d,e){var f=b.aoData[a],h,g=function(c,d){for(;c.childNodes.length;)c.removeChild(c.firstChild);c.innerHTML=G(b,a,d,"display")};if("dom"!==d&&(d&&"auto"!==d||"dom"!==f.src)){var p=
f.anCells;if(p)if(e!==c)g(p[e],e);else for(d=0,h=p.length;d<h;d++)g(p[d],d)}else f._aData=u(b,f,e,e===c?c:f._aData).data;f._aSortData=null;f._aFilterData=null;g=b.aoColumns;if(e!==c)g[e].sType=null;else{d=0;for(h=g.length;d<h;d++)g[d].sType=null;F(b,f)}}function u(a,d,e,f){var h=[],g=d.firstChild,p,l,m=0,n,u=a.aoColumns,k=a._rowReadObject;f=f!==c?f:k?{}:[];var r=function(b,a){if("string"===typeof b){var c=b.indexOf("@");-1!==c&&(c=b.substring(c+1),H(b)(f,a.getAttribute(c)))}},A=function(a){if(e===
c||e===m)l=u[m],n=b.trim(a.innerHTML),l&&l._bAttrSrc?(H(l.mData._)(f,n),r(l.mData.sort,a),r(l.mData.type,a),r(l.mData.filter,a)):k?(l._setter||(l._setter=H(l.mData)),l._setter(f,n)):f[m]=n;m++};if(g)for(;g;){p=g.nodeName.toUpperCase();if("TD"==p||"TH"==p)A(g),h.push(g);g=g.nextSibling}else for(h=d.anCells,g=0,p=h.length;g<p;g++)A(h[g]);(d=d.firstChild?d:d.nTr)&&(d=d.getAttribute("id"))&&H(a.rowId)(f,d);return{data:f,cells:h}}function A(b,a,c,d){var f=b.aoData[a],h=f._aData,g=[],p,l,m,n,u;if(null===
f.nTr){p=c||e.createElement("tr");f.nTr=p;f.anCells=g;p._DT_RowIndex=a;F(b,f);n=0;for(u=b.aoColumns.length;n<u;n++){m=b.aoColumns[n];l=c?d[n]:e.createElement(m.sCellType);l._DT_CellIndex={row:a,column:n};g.push(l);if(!c||m.mRender||m.mData!==n)l.innerHTML=G(b,a,n,"display");m.sClass&&(l.className+=" "+m.sClass);m.bVisible&&!c?p.appendChild(l):!m.bVisible&&c&&l.parentNode.removeChild(l);m.fnCreatedCell&&m.fnCreatedCell.call(b.oInstance,l,G(b,a,n),h,a,n)}T(b,"aoRowCreatedCallback",null,[p,h,a])}f.nTr.setAttribute("role",
"row")}function F(a,c){var d=c.nTr,e=c._aData;if(d){var f=a.rowIdFn(e);f&&(d.id=f);e.DT_RowClass&&(f=e.DT_RowClass.split(" "),c.__rowc=c.__rowc?za(c.__rowc.concat(f)):f,b(d).removeClass(c.__rowc.join(" ")).addClass(e.DT_RowClass));e.DT_RowAttr&&b(d).attr(e.DT_RowAttr);e.DT_RowData&&b(d).data(e.DT_RowData)}}function P(a){var c,d,e,f,h,g=a.nTHead,p=a.nTFoot,l=0===b("th, td",g).length,m=a.oClasses,n=a.aoColumns;l&&(f=b("<tr/>").appendTo(g));c=0;for(d=n.length;c<d;c++)h=n[c],e=b(h.nTh).addClass(h.sClass),
l&&e.appendTo(f),a.oFeatures.bSort&&(e.addClass(h.sSortingClass),!1!==h.bSortable&&(e.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Ra(a,h.nTh,c))),h.sTitle!=e[0].innerHTML&&e.html(h.sTitle),Sa(a,"header")(a,e,h,m);l&&W(a.aoHeader,g);b(g).find(">tr").attr("role","row");b(g).find(">tr>th, >tr>td").addClass(m.sHeaderTH);b(p).find(">tr>th, >tr>td").addClass(m.sFooterTH);if(null!==p)for(a=a.aoFooter[0],c=0,d=a.length;c<d;c++)h=n[c],h.nTf=a[c].cell,h.sClass&&b(h.nTf).addClass(h.sClass)}
function X(a,d,e){var f,h,g,p=[],l=[],m=a.aoColumns.length,n;if(d){e===c&&(e=!1);f=0;for(h=d.length;f<h;f++){p[f]=d[f].slice();p[f].nTr=d[f].nTr;for(g=m-1;0<=g;g--)a.aoColumns[g].bVisible||e||p[f].splice(g,1);l.push([])}f=0;for(h=p.length;f<h;f++){if(a=p[f].nTr)for(;g=a.firstChild;)a.removeChild(g);g=0;for(d=p[f].length;g<d;g++)if(n=m=1,l[f][g]===c){a.appendChild(p[f][g].cell);for(l[f][g]=1;p[f+m]!==c&&p[f][g].cell==p[f+m][g].cell;)l[f+m][g]=1,m++;for(;p[f][g+n]!==c&&p[f][g].cell==p[f][g+n].cell;){for(e=
0;e<m;e++)l[f+e][g+n]=1;n++}b(p[f][g].cell).attr("rowspan",m).attr("colspan",n)}}}}function z(a){var d=T(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==b.inArray(!1,d))ea(a,!1);else{var d=[],e=0,f=a.asStripeClasses,g=f.length,h=a.oLanguage,p=a.iInitDisplayStart,l="ssp"==ba(a),m=a.aiDisplay;a.bDrawing=!0;p!==c&&-1!==p&&(a._iDisplayStart=l?p:p>=a.fnRecordsDisplay()?0:p,a.iInitDisplayStart=-1);var p=a._iDisplayStart,n=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,ea(a,!1);else if(l){if(!a.bDestroying&&
!pa(a))return}else a.iDraw++;if(0!==m.length)for(h=l?a.aoData.length:n,l=l?0:p;l<h;l++){var u=m[l],k=a.aoData[u];null===k.nTr&&A(a,u);u=k.nTr;if(0!==g){var r=f[e%g];k._sRowStripe!=r&&(b(u).removeClass(k._sRowStripe).addClass(r),k._sRowStripe=r)}T(a,"aoRowCallback",null,[u,k._aData,e,l]);d.push(u);e++}else e=h.sZeroRecords,1==a.iDraw&&"ajax"==ba(a)?e=h.sLoadingRecords:h.sEmptyTable&&0===a.fnRecordsTotal()&&(e=h.sEmptyTable),d[0]=b("<tr/>",{"class":g?f[0]:""}).append(b("<td />",{valign:"top",colSpan:w(a),
"class":a.oClasses.sRowEmpty}).html(e))[0];T(a,"aoHeaderCallback","header",[b(a.nTHead).children("tr")[0],M(a),p,n,m]);T(a,"aoFooterCallback","footer",[b(a.nTFoot).children("tr")[0],M(a),p,n,m]);f=b(a.nTBody);f.children().detach();f.append(b(d));T(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function x(b,a){var c=b.oFeatures,d=c.bFilter;c.bSort&&gb(b);d?ma(b,b.oPreviousSearch):b.aiDisplay=b.aiDisplayMaster.slice();!0!==a&&(b._iDisplayStart=0);b._drawHold=a;z(b);b._drawHold=
!1}function fa(a){var c=a.oClasses,d=b(a.nTable),d=b("<div/>").insertBefore(d),e=a.oFeatures,f=b("<div/>",{id:a.sTableId+"_wrapper","class":c.sWrapper+(a.nTFoot?"":" "+c.sNoFooter)});a.nHolding=d[0];a.nTableWrapper=f[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var g=a.sDom.split(""),h,p,l,m,n,u,k=0;k<g.length;k++){h=null;p=g[k];if("<"==p){l=b("<div/>")[0];m=g[k+1];if("'"==m||'"'==m){n="";for(u=2;g[k+u]!=m;)n+=g[k+u],u++;"H"==n?n=c.sJUIHeader:"F"==n&&(n=c.sJUIFooter);-1!=n.indexOf(".")?(m=n.split("."),
l.id=m[0].substr(1,m[0].length-1),l.className=m[1]):"#"==n.charAt(0)?l.id=n.substr(1,n.length-1):l.className=n;k+=u}f.append(l);f=b(l)}else if(">"==p)f=f.parent();else if("l"==p&&e.bPaginate&&e.bLengthChange)h=hb(a);else if("f"==p&&e.bFilter)h=Aa(a);else if("r"==p&&e.bProcessing)h=ib(a);else if("t"==p)h=jb(a);else if("i"==p&&e.bInfo)h=kb(a);else if("p"==p&&e.bPaginate)h=lb(a);else if(0!==B.ext.feature.length)for(l=B.ext.feature,u=0,m=l.length;u<m;u++)if(p==l[u].cFeature){h=l[u].fnInit(a);break}h&&
(l=a.aanFeatures,l[p]||(l[p]=[]),l[p].push(h),f.append(h))}d.replaceWith(f);a.nHolding=null}function W(a,c){var d=b(c).children("tr"),e,f,h,g,p,l,m,n,u,k;a.splice(0,a.length);h=0;for(l=d.length;h<l;h++)a.push([]);h=0;for(l=d.length;h<l;h++)for(e=d[h],f=e.firstChild;f;){if("TD"==f.nodeName.toUpperCase()||"TH"==f.nodeName.toUpperCase()){n=1*f.getAttribute("colspan");u=1*f.getAttribute("rowspan");n=n&&0!==n&&1!==n?n:1;u=u&&0!==u&&1!==u?u:1;g=0;for(p=a[h];p[g];)g++;m=g;k=1===n?!0:!1;for(p=0;p<n;p++)for(g=
0;g<u;g++)a[h+g][m+p]={cell:f,unique:k},a[h+g].nTr=e}f=f.nextSibling}}function Y(b,a,c){var d=[];c||(c=b.aoHeader,a&&(c=[],W(c,a)));a=0;for(var e=c.length;a<e;a++)for(var f=0,h=c[a].length;f<h;f++)!c[a][f].unique||d[f]&&b.bSortCellsTop||(d[f]=c[a][f].cell);return d}function na(a,c,d){T(a,"aoServerParams","serverParams",[c]);if(c&&b.isArray(c)){var e={},f=/(.*?)\[\]$/;b.each(c,function(b,a){var c=a.name.match(f);c?(c=c[0],e[c]||(e[c]=[]),e[c].push(a.value)):e[a.name]=a.value});c=e}var h,g=a.ajax,p=
a.oInstance,l=function(b){T(a,null,"xhr",[a,b,a.jqXHR]);d(b)};if(b.isPlainObject(g)&&g.data){h=g.data;var m=b.isFunction(h)?h(c,a):h;c=b.isFunction(h)&&m?m:b.extend(!0,c,m);delete g.data}m={data:c,success:function(b){var c=b.error||b.sError;c&&ka(a,0,c);a.json=b;l(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(c,d){var e=T(a,null,"xhr",[a,null,a.jqXHR]);-1===b.inArray(!0,e)&&("parsererror"==d?ka(a,0,"Invalid JSON response",1):4===c.readyState&&ka(a,0,"Ajax error",7));ea(a,!1)}};
a.oAjaxData=c;T(a,null,"preXhr",[a,c]);a.fnServerData?a.fnServerData.call(p,a.sAjaxSource,b.map(c,function(b,a){return{name:a,value:b}}),l,a):a.sAjaxSource||"string"===typeof g?a.jqXHR=b.ajax(b.extend(m,{url:g||a.sAjaxSource})):b.isFunction(g)?a.jqXHR=g.call(p,c,l,a):(a.jqXHR=b.ajax(b.extend(m,g)),g.data=h)}function pa(b){return b.bAjaxDataGet?(b.iDraw++,ea(b,!0),na(b,qa(b),function(a){Ba(b,a)}),!1):!0}function qa(a){var c=a.aoColumns,d=c.length,e=a.oFeatures,f=a.oPreviousSearch,h=a.aoPreSearchCols,
g,p=[],l,m,n,u=ra(a);g=a._iDisplayStart;l=!1!==e.bPaginate?a._iDisplayLength:-1;var k=function(b,a){p.push({name:b,value:a})};k("sEcho",a.iDraw);k("iColumns",d);k("sColumns",ga(c,"sName").join(","));k("iDisplayStart",g);k("iDisplayLength",l);var r={draw:a.iDraw,columns:[],order:[],start:g,length:l,search:{value:f.sSearch,regex:f.bRegex}};for(g=0;g<d;g++)m=c[g],n=h[g],l="function"==typeof m.mData?"function":m.mData,r.columns.push({data:l,name:m.sName,searchable:m.bSearchable,orderable:m.bSortable,
search:{value:n.sSearch,regex:n.bRegex}}),k("mDataProp_"+g,l),e.bFilter&&(k("sSearch_"+g,n.sSearch),k("bRegex_"+g,n.bRegex),k("bSearchable_"+g,m.bSearchable)),e.bSort&&k("bSortable_"+g,m.bSortable);e.bFilter&&(k("sSearch",f.sSearch),k("bRegex",f.bRegex));e.bSort&&(b.each(u,function(b,a){r.order.push({column:a.col,dir:a.dir});k("iSortCol_"+b,a.col);k("sSortDir_"+b,a.dir)}),k("iSortingCols",u.length));c=B.ext.legacy.ajax;return null===c?a.sAjaxSource?p:r:c?p:r}function Ba(b,a){var d=sa(b,a),e=a.sEcho!==
c?a.sEcho:a.draw,f=a.iTotalRecords!==c?a.iTotalRecords:a.recordsTotal,g=a.iTotalDisplayRecords!==c?a.iTotalDisplayRecords:a.recordsFiltered;if(e){if(1*e<b.iDraw)return;b.iDraw=1*e}O(b);b._iRecordsTotal=parseInt(f,10);b._iRecordsDisplay=parseInt(g,10);e=0;for(f=d.length;e<f;e++)D(b,d[e]);b.aiDisplay=b.aiDisplayMaster.slice();b.bAjaxDataGet=!1;z(b);b._bInitComplete||Ca(b,a);b.bAjaxDataGet=!0;ea(b,!1)}function sa(a,d){var e=b.isPlainObject(a.ajax)&&a.ajax.dataSrc!==c?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===
e?d.aaData||d[e]:""!==e?L(e)(d):d}function Aa(a){var c=a.oClasses,d=a.sTableId,f=a.oLanguage,g=a.oPreviousSearch,h=a.aanFeatures,p='<input type="search" class="'+c.sFilterInput+'"/>',l=f.sSearch,l=l.match(/_INPUT_/)?l.replace("_INPUT_",p):l+p,c=b("<div/>",{id:h.f?null:d+"_filter","class":c.sFilter}).append(b("<label/>").append(l)),h=function(){var b=this.value?this.value:"";b!=g.sSearch&&(ma(a,{sSearch:b,bRegex:g.bRegex,bSmart:g.bSmart,bCaseInsensitive:g.bCaseInsensitive}),a._iDisplayStart=0,z(a))},
p=null!==a.searchDelay?a.searchDelay:"ssp"===ba(a)?400:0,m=b("input",c).val(g.sSearch).attr("placeholder",f.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",p?Da(h,p):h).bind("keypress.DT",function(b){if(13==b.keyCode)return!1}).attr("aria-controls",d);b(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{m[0]!==e.activeElement&&m.val(g.sSearch)}catch(d){}});return c[0]}function ma(b,a,d){var e=b.oPreviousSearch,f=b.aoPreSearchCols,g=function(b){e.sSearch=b.sSearch;e.bRegex=
b.bRegex;e.bSmart=b.bSmart;e.bCaseInsensitive=b.bCaseInsensitive};E(b);if("ssp"!=ba(b)){mb(b,a.sSearch,d,a.bEscapeRegex!==c?!a.bEscapeRegex:a.bRegex,a.bSmart,a.bCaseInsensitive);g(a);for(a=0;a<f.length;a++)Ea(b,f[a].sSearch,a,f[a].bEscapeRegex!==c?!f[a].bEscapeRegex:f[a].bRegex,f[a].bSmart,f[a].bCaseInsensitive);Fa(b)}else g(a);b.bFiltered=!0;T(b,null,"search",[b])}function Fa(a){for(var c=B.ext.search,d=a.aiDisplay,e,f,g=0,h=c.length;g<h;g++){for(var p=[],l=0,m=d.length;l<m;l++)f=d[l],e=a.aoData[f],
c[g](a,e._aFilterData,f,e._aData,l)&&p.push(f);d.length=0;b.merge(d,p)}}function Ea(b,a,c,d,e,f){if(""!==a){var g=b.aiDisplay;d=Ta(a,d,e,f);for(e=g.length-1;0<=e;e--)a=b.aoData[g[e]]._aFilterData[c],d.test(a)||g.splice(e,1)}}function mb(b,a,c,d,e,f){d=Ta(a,d,e,f);e=b.oPreviousSearch.sSearch;f=b.aiDisplayMaster;var g;0!==B.ext.search.length&&(c=!0);g=nb(b);if(0>=a.length)b.aiDisplay=f.slice();else{if(g||c||e.length>a.length||0!==a.indexOf(e)||b.bSorted)b.aiDisplay=f.slice();a=b.aiDisplay;for(c=a.length-
1;0<=c;c--)d.test(b.aoData[a[c]]._sFilterRow)||a.splice(c,1)}}function Ta(a,c,d,e){a=c?a:Ga(a);d&&(a="^(?=.*?"+b.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(b){if('"'===b.charAt(0)){var a=b.match(/^"(.*)"$/);b=a?a[1]:b}return b.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(a,e?"i":"")}function Ga(b){return b.replace(Lb,"\\$1")}function nb(b){var a=b.aoColumns,c,d,e,f,g,h,p,l,m=B.ext.type.search;c=!1;d=0;for(f=b.aoData.length;d<f;d++)if(l=b.aoData[d],!l._aFilterData){h=[];e=0;for(g=a.length;e<
g;e++)c=a[e],c.bSearchable?(p=G(b,d,e,"filter"),m[c.sType]&&(p=m[c.sType](p)),null===p&&(p=""),"string"!==typeof p&&p.toString&&(p=p.toString())):p="",p.indexOf&&-1!==p.indexOf("&")&&(Ha.innerHTML=p,p=Mb?Ha.textContent:Ha.innerText),p.replace&&(p=p.replace(/[\r\n]/g,"")),h.push(p);l._aFilterData=h;l._sFilterRow=h.join("  ");c=!0}return c}function ob(b){return{search:b.sSearch,smart:b.bSmart,regex:b.bRegex,caseInsensitive:b.bCaseInsensitive}}function pb(b){return{sSearch:b.search,bSmart:b.smart,bRegex:b.regex,
bCaseInsensitive:b.caseInsensitive}}function kb(a){var c=a.sTableId,d=a.aanFeatures.i,e=b("<div/>",{"class":a.oClasses.sInfo,id:d?null:c+"_info"});d||(a.aoDrawCallback.push({fn:qb,sName:"information"}),e.attr("role","status").attr("aria-live","polite"),b(a.nTable).attr("aria-describedby",c+"_info"));return e[0]}function qb(a){var c=a.aanFeatures.i;if(0!==c.length){var d=a.oLanguage,e=a._iDisplayStart+1,f=a.fnDisplayEnd(),g=a.fnRecordsTotal(),h=a.fnRecordsDisplay(),p=h?d.sInfo:d.sInfoEmpty;h!==g&&
(p+=" "+d.sInfoFiltered);p+=d.sInfoPostFix;p=rb(a,p);d=d.fnInfoCallback;null!==d&&(p=d.call(a.oInstance,a,e,f,g,h,p));b(c).html(p)}}function rb(b,a){var c=b.fnFormatNumber,d=b._iDisplayStart+1,e=b._iDisplayLength,f=b.fnRecordsDisplay(),g=-1===e;return a.replace(/_START_/g,c.call(b,d)).replace(/_END_/g,c.call(b,b.fnDisplayEnd())).replace(/_MAX_/g,c.call(b,b.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(b,f)).replace(/_PAGE_/g,c.call(b,g?1:Math.ceil(d/e))).replace(/_PAGES_/g,c.call(b,g?1:Math.ceil(f/
e)))}function wa(b){var a,c,d=b.iInitDisplayStart,e=b.aoColumns,f;c=b.oFeatures;var g=b.bDeferLoading;if(b.bInitialised){fa(b);P(b);X(b,b.aoHeader);X(b,b.aoFooter);ea(b,!0);c.bAutoWidth&&Qa(b);a=0;for(c=e.length;a<c;a++)f=e[a],f.sWidth&&(f.nTh.style.width=V(f.sWidth));T(b,null,"preInit",[b]);x(b);e=ba(b);if("ssp"!=e||g)"ajax"==e?na(b,[],function(c){var e=sa(b,c);for(a=0;a<e.length;a++)D(b,e[a]);b.iInitDisplayStart=d;x(b);ea(b,!1);Ca(b,c)},b):(ea(b,!1),Ca(b))}else setTimeout(function(){wa(b)},200)}
function Ca(b,a){b._bInitComplete=!0;(a||b.oInit.aaData)&&r(b);T(b,null,"plugin-init",[b,a]);T(b,"aoInitComplete","init",[b,a])}function Ua(b,a){var c=parseInt(a,10);b._iDisplayLength=c;Va(b);T(b,null,"length",[b,c])}function hb(a){for(var c=a.oClasses,d=a.sTableId,e=a.aLengthMenu,f=b.isArray(e[0]),g=f?e[0]:e,e=f?e[1]:e,f=b("<select/>",{name:d+"_length","aria-controls":d,"class":c.sLengthSelect}),h=0,p=g.length;h<p;h++)f[0][h]=new Option(e[h],g[h]);var l=b("<div><label/></div>").addClass(c.sLength);
a.aanFeatures.l||(l[0].id=d+"_length");l.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",f[0].outerHTML));b("select",l).val(a._iDisplayLength).bind("change.DT",function(){Ua(a,b(this).val());z(a)});b(a.nTable).bind("length.dt.DT",function(c,d,e){a===d&&b("select",l).val(e)});return l[0]}function lb(a){var c=a.sPaginationType,d=B.ext.pager[c],e="function"===typeof d,f=function(b){z(b)},c=b("<div/>").addClass(a.oClasses.sPaging+c)[0],g=a.aanFeatures;e||d.fnInit(a,c,f);g.p||(c.id=a.sTableId+
"_paginate",a.aoDrawCallback.push({fn:function(b){if(e){var a=b._iDisplayStart,c=b._iDisplayLength,h=b.fnRecordsDisplay(),p=-1===c,a=p?0:Math.ceil(a/c),c=p?1:Math.ceil(h/c),h=d(a,c),l,p=0;for(l=g.p.length;p<l;p++)Sa(b,"pageButton")(b,g.p[p],p,h,a,c)}else d.fnUpdate(b,f)},sName:"pagination"}));return c}function Wa(b,a,c){var d=b._iDisplayStart,e=b._iDisplayLength,f=b.fnRecordsDisplay();0===f||-1===e?d=0:"number"===typeof a?(d=a*e,d>f&&(d=0)):"first"==a?d=0:"previous"==a?(d=0<=e?d-e:0,0>d&&(d=0)):"next"==
a?d+e<f&&(d+=e):"last"==a?d=Math.floor((f-1)/e)*e:ka(b,0,"Unknown paging action: "+a,5);a=b._iDisplayStart!==d;b._iDisplayStart=d;a&&(T(b,null,"page",[b]),c&&z(b));return a}function ib(a){return b("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function ea(a,c){a.oFeatures.bProcessing&&b(a.aanFeatures.r).css("display",c?"block":"none");T(a,null,"processing",[a,c])}function jb(a){var c=b(a.nTable);c.attr("role",
"grid");var d=a.oScroll;if(""===d.sX&&""===d.sY)return a.nTable;var e=d.sX,f=d.sY,g=a.oClasses,h=c.children("caption"),p=h.length?h[0]._captionSide:null,l=b(c[0].cloneNode(!1)),m=b(c[0].cloneNode(!1)),n=c.children("tfoot");n.length||(n=null);l=b("<div/>",{"class":g.sScrollWrapper}).append(b("<div/>",{"class":g.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:e?e?V(e):null:"100%"}).append(b("<div/>",{"class":g.sScrollHeadInner}).css({"box-sizing":"content-box",width:d.sXInner||
"100%"}).append(l.removeAttr("id").css("margin-left",0).append("top"===p?h:null).append(c.children("thead"))))).append(b("<div/>",{"class":g.sScrollBody}).css({position:"relative",overflow:"auto",width:e?V(e):null}).append(c));n&&l.append(b("<div/>",{"class":g.sScrollFoot}).css({overflow:"hidden",border:0,width:e?e?V(e):null:"100%"}).append(b("<div/>",{"class":g.sScrollFootInner}).append(m.removeAttr("id").css("margin-left",0).append("bottom"===p?h:null).append(c.children("tfoot")))));var c=l.children(),
u=c[0],g=c[1],k=n?c[2]:null;if(e)b(g).on("scroll.DT",function(){var b=this.scrollLeft;u.scrollLeft=b;n&&(k.scrollLeft=b)});b(g).css(f&&d.bCollapse?"max-height":"height",f);a.nScrollHead=u;a.nScrollBody=g;a.nScrollFoot=k;a.aoDrawCallback.push({fn:ua,sName:"scrolling"});return l[0]}function ua(a){var d=a.oScroll,e=d.sX,f=d.sXInner,g=d.sY,d=d.iBarWidth,h=b(a.nScrollHead),p=h[0].style,l=h.children("div"),m=l[0].style,n=l.children("table"),l=a.nScrollBody,u=b(l),k=l.style,A=b(a.nScrollFoot).children("div"),
t=A.children("table"),q=b(a.nTHead),F=b(a.nTable),z=F[0],P=z.style,x=a.nTFoot?b(a.nTFoot):null,I=a.oBrowser,C=I.bScrollOversize,w,N,O,D,L=[],X=[],H=[],E,y=function(b){b=b.style;b.paddingTop="0";b.paddingBottom="0";b.borderTopWidth="0";b.borderBottomWidth="0";b.height=0};N=l.scrollHeight>l.clientHeight;a.scrollBarVis!==N&&a.scrollBarVis!==c?(a.scrollBarVis=N,r(a)):(a.scrollBarVis=N,F.children("thead, tfoot").remove(),D=q.clone().prependTo(F),q=q.find("tr"),N=D.find("tr"),D.find("th, td").removeAttr("tabindex"),
x&&(O=x.clone().prependTo(F),w=x.find("tr"),O=O.find("tr")),e||(k.width="100%",h[0].style.width="100%"),b.each(Y(a,D),function(b,c){E=v(a,b);c.style.width=a.aoColumns[E].sWidth}),x&&ja(function(b){b.style.width=""},O),h=F.outerWidth(),""===e?(P.width="100%",C&&(F.find("tbody").height()>l.offsetHeight||"scroll"==u.css("overflow-y"))&&(P.width=V(F.outerWidth()-d)),h=F.outerWidth()):""!==f&&(P.width=V(f),h=F.outerWidth()),ja(y,N),ja(function(a){H.push(a.innerHTML);L.push(V(b(a).css("width")))},N),ja(function(b,
a){b.style.width=L[a]},q),b(N).height(0),x&&(ja(y,O),ja(function(a){X.push(V(b(a).css("width")))},O),ja(function(b,a){b.style.width=X[a]},w),b(O).height(0)),ja(function(b,a){b.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+H[a]+"</div>";b.style.width=L[a]},N),x&&ja(function(b,a){b.innerHTML="";b.style.width=X[a]},O),F.outerWidth()<h?(w=l.scrollHeight>l.offsetHeight||"scroll"==u.css("overflow-y")?h+d:h,C&&(l.scrollHeight>l.offsetHeight||"scroll"==u.css("overflow-y"))&&
(P.width=V(w-d)),""!==e&&""===f||ka(a,1,"Possible column misalignment",6)):w="100%",k.width=V(w),p.width=V(w),x&&(a.nScrollFoot.style.width=V(w)),!g&&C&&(k.height=V(z.offsetHeight+d)),e=F.outerWidth(),n[0].style.width=V(e),m.width=V(e),f=F.height()>l.clientHeight||"scroll"==u.css("overflow-y"),g="padding"+(I.bScrollbarLeft?"Left":"Right"),m[g]=f?d+"px":"0px",x&&(t[0].style.width=V(e),A[0].style.width=V(e),A[0].style[g]=f?d+"px":"0px"),u.scroll(),!a.bSorted&&!a.bFiltered||a._drawHold||(l.scrollTop=
0))}function ja(b,a,c){for(var d=0,e=0,f=a.length,g,h;e<f;){g=a[e].firstChild;for(h=c?c[e].firstChild:null;g;)1===g.nodeType&&(c?b(g,h,d):b(g,d),d++),g=g.nextSibling,h=c?h.nextSibling:null;e++}}function Qa(a){var c=a.nTable,d=a.aoColumns,e=a.oScroll,f=e.sY,g=e.sX,h=e.sXInner,p=d.length,l=y(a,"bVisible"),m=b("th",a.nTHead),n=c.getAttribute("width"),u=c.parentNode,A=!1,t,q,F=a.oBrowser,e=F.bScrollOversize;(t=c.style.width)&&-1!==t.indexOf("%")&&(n=t);for(t=0;t<l.length;t++)q=d[l[t]],null!==q.sWidth&&
(q.sWidth=sb(q.sWidthOrig,u),A=!0);if(e||!A&&!g&&!f&&p==w(a)&&p==m.length)for(t=0;t<p;t++)l=v(a,t),null!==l&&(d[l].sWidth=V(m.eq(t).width()));else{p=b(c).clone().css("visibility","hidden").removeAttr("id");p.find("tbody tr").remove();var z=b("<tr/>").appendTo(p.find("tbody"));p.find("thead, tfoot").remove();p.append(b(a.nTHead).clone()).append(b(a.nTFoot).clone());p.find("tfoot th, tfoot td").css("width","");m=Y(a,p.find("thead")[0]);for(t=0;t<l.length;t++)q=d[l[t]],m[t].style.width=null!==q.sWidthOrig&&
""!==q.sWidthOrig?V(q.sWidthOrig):"",q.sWidthOrig&&g&&b(m[t]).append(b("<div/>").css({width:q.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(t=0;t<l.length;t++)A=l[t],q=d[A],b(tb(a,A)).clone(!1).append(q.sContentPadding).appendTo(z);q=b("<div/>").css(g||f?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(p).appendTo(u);g&&h?p.width(h):g?(p.css("width","auto"),p.removeAttr("width"),p.width()<u.clientWidth&&n&&p.width(u.clientWidth)):f?p.width(u.clientWidth):
n&&p.width(n);for(t=f=0;t<l.length;t++)u=b(m[t]),h=u.outerWidth()-u.width(),u=F.bBounding?Math.ceil(m[t].getBoundingClientRect().width):u.outerWidth(),f+=u,d[l[t]].sWidth=V(u-h);c.style.width=V(f);q.remove()}n&&(c.style.width=V(n));!n&&!g||a._reszEvt||(c=function(){b(k).bind("resize.DT-"+a.sInstance,Da(function(){r(a)}))},e?setTimeout(c,1E3):c(),a._reszEvt=!0)}function Da(b,a){var d=a!==c?a:200,e,f;return function(){var a=this,g=+new Date,h=arguments;e&&g<e+d?(clearTimeout(f),f=setTimeout(function(){e=
c;b.apply(a,h)},d)):(e=g,b.apply(a,h))}}function sb(a,c){if(!a)return 0;var d=b("<div/>").css("width",V(a)).appendTo(c||e.body),f=d[0].offsetWidth;d.remove();return f}function tb(a,c){var d=ub(a,c);if(0>d)return null;var e=a.aoData[d];return e.nTr?e.anCells[c]:b("<td/>").html(G(a,d,c,"display"))[0]}function ub(b,a){for(var c,d=-1,e=-1,f=0,g=b.aoData.length;f<g;f++)c=G(b,f,a,"display")+"",c=c.replace(Nb,""),c=c.replace(/&nbsp;/g," "),c.length>d&&(d=c.length,e=f);return e}function V(b){return null===
b?"0px":"number"==typeof b?0>b?"0px":b+"px":b.match(/\d$/)?b+"px":b}function ra(a){var d,e,f=[],g=a.aoColumns,h,p,l,m;d=a.aaSortingFixed;e=b.isPlainObject(d);var n=[];h=function(a){a.length&&!b.isArray(a[0])?n.push(a):b.merge(n,a)};b.isArray(d)&&h(d);e&&d.pre&&h(d.pre);h(a.aaSorting);e&&d.post&&h(d.post);for(a=0;a<n.length;a++)for(m=n[a][0],h=g[m].aDataSort,d=0,e=h.length;d<e;d++)p=h[d],l=g[p].sType||"string",n[a]._idx===c&&(n[a]._idx=b.inArray(n[a][1],g[p].asSorting)),f.push({src:m,col:p,dir:n[a][1],
index:n[a]._idx,type:l,formatter:B.ext.type.order[l+"-pre"]});return f}function gb(b){var a,c,d=[],e=B.ext.type.order,f=b.aoData,g=0,h,p=b.aiDisplayMaster,l;E(b);l=ra(b);a=0;for(c=l.length;a<c;a++)h=l[a],h.formatter&&g++,vb(b,h.col);if("ssp"!=ba(b)&&0!==l.length){a=0;for(c=p.length;a<c;a++)d[p[a]]=a;g===l.length?p.sort(function(b,a){var c,e,g,h,p=l.length,m=f[b]._aSortData,n=f[a]._aSortData;for(g=0;g<p;g++)if(h=l[g],c=m[h.col],e=n[h.col],c=c<e?-1:c>e?1:0,0!==c)return"asc"===h.dir?c:-c;c=d[b];e=d[a];
return c<e?-1:c>e?1:0}):p.sort(function(b,a){var c,g,h,p,m=l.length,n=f[b]._aSortData,u=f[a]._aSortData;for(h=0;h<m;h++)if(p=l[h],c=n[p.col],g=u[p.col],p=e[p.type+"-"+p.dir]||e["string-"+p.dir],c=p(c,g),0!==c)return c;c=d[b];g=d[a];return c<g?-1:c>g?1:0})}b.bSorted=!0}function wb(b){var a,c,d=b.aoColumns,e=ra(b);b=b.oLanguage.oAria;for(var f=0,g=d.length;f<g;f++){c=d[f];var h=c.asSorting;a=c.sTitle.replace(/<.*?>/g,"");var p=c.nTh;p.removeAttribute("aria-sort");c.bSortable&&(0<e.length&&e[0].col==
f?(p.setAttribute("aria-sort","asc"==e[0].dir?"ascending":"descending"),c=h[e[0].index+1]||h[0]):c=h[0],a+="asc"===c?b.sSortAscending:b.sSortDescending);p.setAttribute("aria-label",a)}}function Xa(a,d,e,f){var g=a.aaSorting,h=a.aoColumns[d].asSorting,p=function(a,d){var e=a._idx;e===c&&(e=b.inArray(a[1],h));return e+1<h.length?e+1:d?null:0};"number"===typeof g[0]&&(g=a.aaSorting=[g]);e&&a.oFeatures.bSortMulti?(e=b.inArray(d,ga(g,"0")),-1!==e?(d=p(g[e],!0),null===d&&1===g.length&&(d=0),null===d?g.splice(e,
1):(g[e][1]=h[d],g[e]._idx=d)):(g.push([d,h[0],0]),g[g.length-1]._idx=0)):g.length&&g[0][0]==d?(d=p(g[0]),g.length=1,g[0][1]=h[d],g[0]._idx=d):(g.length=0,g.push([d,h[0]]),g[0]._idx=0);x(a);"function"==typeof f&&f(a)}function Ra(b,a,c,d){var e=b.aoColumns[c];Ya(a,{},function(a){!1!==e.bSortable&&(b.oFeatures.bProcessing?(ea(b,!0),setTimeout(function(){Xa(b,c,a.shiftKey,d);"ssp"!==ba(b)&&ea(b,!1)},0)):Xa(b,c,a.shiftKey,d))})}function Ia(a){var c=a.aLastSort,d=a.oClasses.sSortColumn,e=ra(a),f=a.oFeatures,
g,h;if(f.bSort&&f.bSortClasses){f=0;for(g=c.length;f<g;f++)h=c[f].src,b(ga(a.aoData,"anCells",h)).removeClass(d+(2>f?f+1:3));f=0;for(g=e.length;f<g;f++)h=e[f].src,b(ga(a.aoData,"anCells",h)).addClass(d+(2>f?f+1:3))}a.aLastSort=e}function vb(b,a){var c=b.aoColumns[a],d=B.ext.order[c.sSortDataType],e;d&&(e=d.call(b.oInstance,b,a,f(b,a)));for(var g,h=B.ext.type.order[c.sType+"-pre"],p=0,l=b.aoData.length;p<l;p++)if(c=b.aoData[p],c._aSortData||(c._aSortData=[]),!c._aSortData[a]||d)g=d?e[p]:G(b,p,a,"sort"),
c._aSortData[a]=h?h(g):g}function Ja(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var c={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:b.extend(!0,[],a.aaSorting),search:ob(a.oPreviousSearch),columns:b.map(a.aoColumns,function(b,c){return{visible:b.bVisible,search:ob(a.aoPreSearchCols[c])}})};T(a,"aoStateSaveParams","stateSaveParams",[a,c]);a.oSavedState=c;a.fnStateSaveCallback.call(a.oInstance,a,c)}}function xb(a){var d,e,f=a.aoColumns;if(a.oFeatures.bStateSave){var g=a.fnStateLoadCallback.call(a.oInstance,
a);if(g&&g.time&&(d=T(a,"aoStateLoadParams","stateLoadParams",[a,g]),-1===b.inArray(!1,d)&&(d=a.iStateDuration,!(0<d&&g.time<+new Date-1E3*d)&&f.length===g.columns.length))){a.oLoadedState=b.extend(!0,{},g);g.start!==c&&(a._iDisplayStart=g.start,a.iInitDisplayStart=g.start);g.length!==c&&(a._iDisplayLength=g.length);g.order!==c&&(a.aaSorting=[],b.each(g.order,function(b,c){a.aaSorting.push(c[0]>=f.length?[0,c[1]]:c)}));g.search!==c&&b.extend(a.oPreviousSearch,pb(g.search));d=0;for(e=g.columns.length;d<
e;d++){var h=g.columns[d];h.visible!==c&&(f[d].bVisible=h.visible);h.search!==c&&b.extend(a.aoPreSearchCols[d],pb(h.search))}T(a,"aoStateLoaded","stateLoaded",[a,g])}}}function Ka(a){var c=B.settings;a=b.inArray(a,ga(c,"nTable"));return-1!==a?c[a]:null}function ka(b,a,c,d){c="DataTables warning: "+(b?"table id="+b.sTableId+" - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(a)k.console&&console.log&&console.log(c);else if(a=B.ext,a=a.sErrMode||
a.errMode,b&&T(b,null,"error",[b,d,c]),"alert"==a)alert(c);else{if("throw"==a)throw Error(c);"function"==typeof a&&a(b,d,c)}}function ha(a,d,e,f){b.isArray(e)?b.each(e,function(c,e){b.isArray(e)?ha(a,d,e[0],e[1]):ha(a,d,e)}):(f===c&&(f=e),d[e]!==c&&(a[f]=d[e]))}function yb(a,c,d){var e,f;for(f in c)c.hasOwnProperty(f)&&(e=c[f],b.isPlainObject(e)?(b.isPlainObject(a[f])||(a[f]={}),b.extend(!0,a[f],e)):a[f]=d&&"data"!==f&&"aaData"!==f&&b.isArray(e)?e.slice():e);return a}function Ya(a,c,d){b(a).bind("click.DT",
c,function(b){a.blur();d(b)}).bind("keypress.DT",c,function(b){13===b.which&&(b.preventDefault(),d(b))}).bind("selectstart.DT",function(){return!1})}function ca(b,a,c,d){c&&b[a].push({fn:c,sName:d})}function T(a,c,d,e){var f=[];c&&(f=b.map(a[c].slice().reverse(),function(b){return b.fn.apply(a.oInstance,e)}));null!==d&&(c=b.Event(d+".dt"),b(a.nTable).trigger(c,e),f.push(c.result));return f}function Va(b){var a=b._iDisplayStart,c=b.fnDisplayEnd(),d=b._iDisplayLength;a>=c&&(a=c-d);a-=a%d;if(-1===d||
0>a)a=0;b._iDisplayStart=a}function Sa(a,c){var d=a.renderer,e=B.ext.renderer[c];return b.isPlainObject(d)&&d[c]?e[d[c]]||e._:"string"===typeof d?e[d]||e._:e._}function ba(b){return b.oFeatures.bServerSide?"ssp":b.ajax||b.sAjaxSource?"ajax":"dom"}function La(b,a){var c=[],c=zb.numbers_length,d=Math.floor(c/2);a<=c?c=ta(0,a):b<=d?(c=ta(0,c-2),c.push("ellipsis"),c.push(a-1)):(b>=a-1-d?c=ta(a-(c-2),a):(c=ta(b-d+2,b+d-1),c.push("ellipsis"),c.push(a-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el=
"span";return c}function fb(a){b.each({num:function(b){return Ma(b,a)},"num-fmt":function(b){return Ma(b,a,Za)},"html-num":function(b){return Ma(b,a,Na)},"html-num-fmt":function(b){return Ma(b,a,Na,Za)}},function(b,c){Z.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(Z.type.search[b+a]=Z.type.search.html)})}function Ab(b){return function(){var a=[Ka(this[B.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return B.ext.internal[b].apply(this,a)}}var B,Z,Q,K,U,$a={},Bb=/[\r\n]/g,Na=/<.*?>/g,
Ob=/^[\w\+\-]/,Pb=/[\w\+\-]$/,Lb=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),Za=/[',$\u00a3\u20ac\u00a5%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,la=function(b){return b&&!0!==b&&"-"!==b?!1:!0},Cb=function(b){var a=parseInt(b,10);return!isNaN(a)&&isFinite(b)?a:null},Db=function(b,a){$a[a]||($a[a]=RegExp(Ga(a),"g"));return"string"===typeof b&&"."!==a?b.replace(/\./g,"").replace($a[a],"."):b},ab=function(b,a,c){var d="string"===typeof b;if(la(b))return!0;a&&d&&(b=Db(b,
a));c&&d&&(b=b.replace(Za,""));return!isNaN(parseFloat(b))&&isFinite(b)},Eb=function(b,a,c){return la(b)?!0:la(b)||"string"===typeof b?ab(b.replace(Na,""),a,c)?!0:null:null},ga=function(b,a,d){var e=[],f=0,g=b.length;if(d!==c)for(;f<g;f++)b[f]&&b[f][a]&&e.push(b[f][a][d]);else for(;f<g;f++)b[f]&&e.push(b[f][a]);return e},xa=function(b,a,d,e){var f=[],g=0,h=a.length;if(e!==c)for(;g<h;g++)b[a[g]][d]&&f.push(b[a[g]][d][e]);else for(;g<h;g++)f.push(b[a[g]][d]);return f},ta=function(b,a){var d=[],e;a===
c?(a=0,e=b):(e=a,a=b);for(var f=a;f<e;f++)d.push(f);return d},Fb=function(b){for(var a=[],c=0,d=b.length;c<d;c++)b[c]&&a.push(b[c]);return a},za=function(b){var a=[],c,d,e=b.length,f,g=0;d=0;a:for(;d<e;d++){c=b[d];for(f=0;f<g;f++)if(a[f]===c)continue a;a.push(c);g++}return a},da=function(b,a,d){b[a]!==c&&(b[d]=b[a])},va=/\[.*?\]$/,oa=/\(\)$/,Ha=b("<div>")[0],Mb=Ha.textContent!==c,Nb=/<.*?>/g;B=function(a){this.$=function(b,a){return this.api(!0).$(b,a)};this._=function(b,a){return this.api(!0).rows(b,
a).data()};this.api=function(b){return b?new Q(Ka(this[Z.iApiIndex])):new Q(this)};this.fnAddData=function(a,d){var e=this.api(!0),f=b.isArray(a)&&(b.isArray(a[0])||b.isPlainObject(a[0]))?e.rows.add(a):e.row.add(a);(d===c||d)&&e.draw();return f.flatten().toArray()};this.fnAdjustColumnSizing=function(b){var a=this.api(!0).columns.adjust(),d=a.settings()[0],e=d.oScroll;b===c||b?a.draw(!1):(""!==e.sX||""!==e.sY)&&ua(d)};this.fnClearTable=function(b){var a=this.api(!0).clear();(b===c||b)&&a.draw()};this.fnClose=
function(b){this.api(!0).row(b).child.hide()};this.fnDeleteRow=function(b,a,d){var e=this.api(!0);b=e.rows(b);var f=b.settings()[0],g=f.aoData[b[0][0]];b.remove();a&&a.call(this,f,g);(d===c||d)&&e.draw();return g};this.fnDestroy=function(b){this.api(!0).destroy(b)};this.fnDraw=function(b){this.api(!0).draw(b)};this.fnFilter=function(b,a,d,e,f,g){f=this.api(!0);null===a||a===c?f.search(b,d,e,g):f.column(a).search(b,d,e,g);f.draw()};this.fnGetData=function(b,a){var d=this.api(!0);if(b!==c){var e=b.nodeName?
b.nodeName.toLowerCase():"";return a!==c||"td"==e||"th"==e?d.cell(b,a).data():d.row(b).data()||null}return d.data().toArray()};this.fnGetNodes=function(b){var a=this.api(!0);return b!==c?a.row(b).node():a.rows().nodes().flatten().toArray()};this.fnGetPosition=function(b){var a=this.api(!0),c=b.nodeName.toUpperCase();return"TR"==c?a.row(b).index():"TD"==c||"TH"==c?(b=a.cell(b).index(),[b.row,b.columnVisible,b.column]):null};this.fnIsOpen=function(b){return this.api(!0).row(b).child.isShown()};this.fnOpen=
function(b,a,c){return this.api(!0).row(b).child(a,c).show().child()[0]};this.fnPageChange=function(b,a){var d=this.api(!0).page(b);(a===c||a)&&d.draw(!1)};this.fnSetColumnVis=function(b,a,d){b=this.api(!0).column(b).visible(a);(d===c||d)&&b.columns.adjust().draw()};this.fnSettings=function(){return Ka(this[Z.iApiIndex])};this.fnSort=function(b){this.api(!0).order(b).draw()};this.fnSortListener=function(b,a,c){this.api(!0).order.listener(b,a,c)};this.fnUpdate=function(b,a,d,e,f){var g=this.api(!0);
d===c||null===d?g.row(a).data(b):g.cell(a,d).data(b);(f===c||f)&&g.columns.adjust();(e===c||e)&&g.draw();return 0};this.fnVersionCheck=Z.fnVersionCheck;var e=this,f=a===c,p=this.length;f&&(a={});this.oApi=this.internal=Z.internal;for(var u in B.ext.internal)u&&(this[u]=Ab(u));this.each(function(){var u={},u=1<p?yb(u,a,!0):a,k=0,r,A=this.getAttribute("id"),q=!1,F=B.defaults,v=b(this);if("table"!=this.nodeName.toLowerCase())ka(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{l(F);
d(F.column);h(F,F,!0);h(F.column,F.column,!0);h(F,b.extend(u,v.data()));var z=B.settings,k=0;for(r=z.length;k<r;k++){var P=z[k];if(P.nTable==this||P.nTHead.parentNode==this||P.nTFoot&&P.nTFoot.parentNode==this){k=u.bRetrieve!==c?u.bRetrieve:F.bRetrieve;if(f||k)return P.oInstance;if(u.bDestroy!==c?u.bDestroy:F.bDestroy){P.oInstance.fnDestroy();break}else{ka(P,0,"Cannot reinitialise DataTable",3);return}}if(P.sTableId==this.id){z.splice(k,1);break}}if(null===A||""===A)this.id=A="DataTables_Table_"+
B.ext._unique++;var x=b.extend(!0,{},B.models.oSettings,{sDestroyWidth:v[0].style.width,sInstance:A,sTableId:A});x.nTable=this;x.oApi=e.internal;x.oInit=u;z.push(x);x.oInstance=1===e.length?e:v.dataTable();l(u);u.oLanguage&&m(u.oLanguage);u.aLengthMenu&&!u.iDisplayLength&&(u.iDisplayLength=b.isArray(u.aLengthMenu[0])?u.aLengthMenu[0][0]:u.aLengthMenu[0]);u=yb(b.extend(!0,{},F),u);ha(x.oFeatures,u,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));
ha(x,u,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);ha(x.oScroll,u,[["sScrollX","sX"],["sScrollXInner",
"sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);ha(x.oLanguage,u,"fnInfoCallback");ca(x,"aoDrawCallback",u.fnDrawCallback,"user");ca(x,"aoServerParams",u.fnServerParams,"user");ca(x,"aoStateSaveParams",u.fnStateSaveParams,"user");ca(x,"aoStateLoadParams",u.fnStateLoadParams,"user");ca(x,"aoStateLoaded",u.fnStateLoaded,"user");ca(x,"aoRowCallback",u.fnRowCallback,"user");ca(x,"aoRowCreatedCallback",u.fnCreatedRow,"user");ca(x,"aoHeaderCallback",u.fnHeaderCallback,"user");ca(x,"aoFooterCallback",
u.fnFooterCallback,"user");ca(x,"aoInitComplete",u.fnInitComplete,"user");ca(x,"aoPreDrawCallback",u.fnPreDrawCallback,"user");x.rowIdFn=L(u.rowId);t(x);A=x.oClasses;u.bJQueryUI?(b.extend(A,B.ext.oJUIClasses,u.oClasses),u.sDom===F.sDom&&"lfrtip"===F.sDom&&(x.sDom='<"H"lfr>t<"F"ip>'),x.renderer)?b.isPlainObject(x.renderer)&&!x.renderer.header&&(x.renderer.header="jqueryui"):x.renderer="jqueryui":b.extend(A,B.ext.classes,u.oClasses);v.addClass(A.sTable);x.iInitDisplayStart===c&&(x.iInitDisplayStart=
u.iDisplayStart,x._iDisplayStart=u.iDisplayStart);null!==u.iDeferLoading&&(x.bDeferLoading=!0,k=b.isArray(u.iDeferLoading),x._iRecordsDisplay=k?u.iDeferLoading[0]:u.iDeferLoading,x._iRecordsTotal=k?u.iDeferLoading[1]:u.iDeferLoading);var I=x.oLanguage;b.extend(!0,I,u.oLanguage);""!==I.sUrl&&(b.ajax({dataType:"json",url:I.sUrl,success:function(a){m(a);h(F.oLanguage,a);b.extend(!0,I,a);wa(x)},error:function(){wa(x)}}),q=!0);null===u.asStripeClasses&&(x.asStripeClasses=[A.sStripeOdd,A.sStripeEven]);
var k=x.asStripeClasses,C=v.children("tbody").find("tr").eq(0);-1!==b.inArray(!0,b.map(k,function(b){return C.hasClass(b)}))&&(b("tbody tr",this).removeClass(k.join(" ")),x.asDestroyStripes=k.slice());z=[];k=this.getElementsByTagName("thead");0!==k.length&&(W(x.aoHeader,k[0]),z=Y(x));if(null===u.aoColumns)for(P=[],k=0,r=z.length;k<r;k++)P.push(null);else P=u.aoColumns;k=0;for(r=P.length;k<r;k++)g(x,z?z[k]:null);N(x,u.aoColumnDefs,P,function(b,a){n(x,b,a)});if(C.length){var w=function(b,a){return null!==
b.getAttribute("data-"+a)?a:null};b(C[0]).children("th, td").each(function(b,a){var d=x.aoColumns[b];if(d.mData===b){var e=w(a,"sort")||w(a,"order"),f=w(a,"filter")||w(a,"search");if(null!==e||null!==f)d.mData={_:b+".display",sort:null!==e?b+".@data-"+e:c,type:null!==e?b+".@data-"+e:c,filter:null!==f?b+".@data-"+f:c},n(x,b)}})}var O=x.oFeatures;u.bStateSave&&(O.bStateSave=!0,xb(x,u),ca(x,"aoDrawCallback",Ja,"state_save"));if(u.aaSorting===c)for(z=x.aaSorting,k=0,r=z.length;k<r;k++)z[k][1]=x.aoColumns[k].asSorting[0];
Ia(x);O.bSort&&ca(x,"aoDrawCallback",function(){if(x.bSorted){var a=ra(x),c={};b.each(a,function(b,a){c[a.src]=a.dir});T(x,null,"order",[x,a,c]);wb(x)}});ca(x,"aoDrawCallback",function(){(x.bSorted||"ssp"===ba(x)||O.bDeferRender)&&Ia(x)},"sc");k=v.children("caption").each(function(){this._captionSide=v.css("caption-side")});r=v.children("thead");0===r.length&&(r=b("<thead/>").appendTo(this));x.nTHead=r[0];r=v.children("tbody");0===r.length&&(r=b("<tbody/>").appendTo(this));x.nTBody=r[0];r=v.children("tfoot");
0===r.length&&0<k.length&&(""!==x.oScroll.sX||""!==x.oScroll.sY)&&(r=b("<tfoot/>").appendTo(this));0===r.length||0===r.children().length?v.addClass(A.sNoFooter):0<r.length&&(x.nTFoot=r[0],W(x.aoFooter,x.nTFoot));if(u.aaData)for(k=0;k<u.aaData.length;k++)D(x,u.aaData[k]);else(x.bDeferLoading||"dom"==ba(x))&&J(x,b(x.nTBody).children("tr"));x.aiDisplay=x.aiDisplayMaster.slice();x.bInitialised=!0;!1===q&&wa(x)}});e=null;return this};var Gb=[],aa=Array.prototype,Qb=function(a){var c,d,e=B.settings,f=b.map(e,
function(b){return b.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return c=b.inArray(a,f),-1!==c?[e[c]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?d=b(a):a instanceof b&&(d=a)}else return[];if(d)return d.map(function(){c=b.inArray(this,f);return-1!==c?e[c]:null}).toArray()};Q=function(a,c){if(!(this instanceof Q))return new Q(a,c);var d=[],e=function(b){(b=Qb(b))&&(d=d.concat(b))};if(b.isArray(a))for(var f=
0,g=a.length;f<g;f++)e(a[f]);else e(a);this.context=za(d);c&&b.merge(this,c);this.selector={rows:null,cols:null,opts:null};Q.extend(this,this,Gb)};B.Api=Q;b.extend(Q.prototype,{any:function(){return 0!==this.count()},concat:aa.concat,context:[],count:function(){return this.flatten().length},each:function(b){for(var a=0,c=this.length;a<c;a++)b.call(this,this[a],a,this);return this},eq:function(b){var a=this.context;return a.length>b?new Q(a[b],this[b]):null},filter:function(b){var a=[];if(aa.filter)a=
aa.filter.call(this,b,this);else for(var c=0,d=this.length;c<d;c++)b.call(this,this[c],c,this)&&a.push(this[c]);return new Q(this.context,a)},flatten:function(){var b=[];return new Q(this.context,b.concat.apply(b,this.toArray()))},join:aa.join,indexOf:aa.indexOf||function(b,a){for(var c=a||0,d=this.length;c<d;c++)if(this[c]===b)return c;return-1},iterator:function(b,a,d,e){var f=[],g,h,p,l,m,n=this.context,u,k,r=this.selector;"string"===typeof b&&(e=d,d=a,a=b,b=!1);h=0;for(p=n.length;h<p;h++){var A=
new Q(n[h]);if("table"===a)g=d.call(A,n[h],h),g!==c&&f.push(g);else if("columns"===a||"rows"===a)g=d.call(A,n[h],this[h],h),g!==c&&f.push(g);else if("column"===a||"column-rows"===a||"row"===a||"cell"===a)for(k=this[h],"column-rows"===a&&(u=Oa(n[h],r.opts)),l=0,m=k.length;l<m;l++)g=k[l],g="cell"===a?d.call(A,n[h],g.row,g.column,h,l):d.call(A,n[h],g,h,l,u),g!==c&&f.push(g)}return f.length||e?(b=new Q(n,b?f.concat.apply([],f):f),a=b.selector,a.rows=r.rows,a.cols=r.cols,a.opts=r.opts,b):this},lastIndexOf:aa.lastIndexOf||
function(b,a){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(b){var a=[];if(aa.map)a=aa.map.call(this,b,this);else for(var c=0,d=this.length;c<d;c++)a.push(b.call(this,this[c],c));return new Q(this.context,a)},pluck:function(b){return this.map(function(a){return a[b]})},pop:aa.pop,push:aa.push,reduce:aa.reduce||function(b,a){return q(this,b,a,0,this.length,1)},reduceRight:aa.reduceRight||function(b,a){return q(this,b,a,this.length-1,-1,-1)},reverse:aa.reverse,selector:null,
shift:aa.shift,sort:aa.sort,splice:aa.splice,toArray:function(){return aa.slice.call(this)},to$:function(){return b(this)},toJQuery:function(){return b(this)},unique:function(){return new Q(this.context,za(this))},unshift:aa.unshift});Q.extend=function(a,c,d){if(d.length&&c&&(c instanceof Q||c.__dt_wrapper)){var e,f,g,h=function(b,a,c){return function(){var d=a.apply(b,arguments);Q.extend(d,d,c.methodExt);return d}};e=0;for(f=d.length;e<f;e++)g=d[e],c[g.name]="function"===typeof g.val?h(a,g.val,g):
b.isPlainObject(g.val)?{}:g.val,c[g.name].__dt_wrapper=!0,Q.extend(a,c[g.name],g.propExt)}};Q.register=K=function(a,c){if(b.isArray(a))for(var d=0,e=a.length;d<e;d++)Q.register(a[d],c);else for(var f=a.split("."),g=Gb,h,p,d=0,e=f.length;d<e;d++){h=(p=-1!==f[d].indexOf("()"))?f[d].replace("()",""):f[d];var l;a:{l=0;for(var m=g.length;l<m;l++)if(g[l].name===h){l=g[l];break a}l=null}l||(l={name:h,val:{},methodExt:[],propExt:[]},g.push(l));d===e-1?l.val=c:g=p?l.methodExt:l.propExt}};Q.registerPlural=
U=function(a,d,e){Q.register(a,e);Q.register(d,function(){var a=e.apply(this,arguments);return a===this?this:a instanceof Q?a.length?b.isArray(a[0])?new Q(a.context,a[0]):a[0]:c:a})};K("tables()",function(a){var c;if(a){c=Q;var d=this.context;if("number"===typeof a)a=[d[a]];else{var e=b.map(d,function(a){return a.nTable});a=b(e).filter(a).map(function(){var a=b.inArray(this,e);return d[a]}).toArray()}c=new c(a)}else c=this;return c});K("table()",function(a){a=this.tables(a);var b=a.context;return b.length?
new Q(b[0]):a});U("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});U("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});U("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});U("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});U("tables().containers()","table().container()",
function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});K("draw()",function(a){return this.iterator("table",function(b){"page"===a?z(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),x(b,!1===a))})});K("page()",function(a){return a===c?this.page.info().page:this.iterator("table",function(b){Wa(b,a)})});K("page.info()",function(){if(0===this.context.length)return c;var a=this.context[0],b=a._iDisplayStart,d=a.oFeatures.bPaginate?a._iDisplayLength:-1,e=a.fnRecordsDisplay(),
f=-1===d;return{page:f?0:Math.floor(b/d),pages:f?1:Math.ceil(e/d),start:b,end:a.fnDisplayEnd(),length:d,recordsTotal:a.fnRecordsTotal(),recordsDisplay:e,serverSide:"ssp"===ba(a)}});K("page.len()",function(a){return a===c?0!==this.context.length?this.context[0]._iDisplayLength:c:this.iterator("table",function(b){Ua(b,a)})});var Hb=function(a,b,c){if(c){var d=new Q(a);d.one("draw",function(){c(d.ajax.json())})}if("ssp"==ba(a))x(a,b);else{ea(a,!0);var e=a.jqXHR;e&&4!==e.readyState&&e.abort();na(a,[],
function(c){O(a);c=sa(a,c);for(var d=0,e=c.length;d<e;d++)D(a,c[d]);x(a,b);ea(a,!1)})}};K("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});K("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});K("ajax.reload()",function(a,b){return this.iterator("table",function(c){Hb(c,!1===b,a)})});K("ajax.url()",function(a){var d=this.context;if(a===c){if(0===d.length)return c;d=d[0];return d.ajax?b.isPlainObject(d.ajax)?d.ajax.url:d.ajax:d.sAjaxSource}return this.iterator("table",
function(c){b.isPlainObject(c.ajax)?c.ajax.url=a:c.ajax=a})});K("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Hb(c,!1===b,a)})});var bb=function(a,d,e,f,g){var h=[],p,l,m,n,u,k;m=typeof d;d&&"string"!==m&&"function"!==m&&d.length!==c||(d=[d]);m=0;for(n=d.length;m<n;m++)for(l=d[m]&&d[m].split?d[m].split(","):[d[m]],u=0,k=l.length;u<k;u++)(p=e("string"===typeof l[u]?b.trim(l[u]):l[u]))&&p.length&&(h=h.concat(p));a=Z.selector[a];if(a.length)for(m=0,n=a.length;m<n;m++)h=a[m](f,
g,h);return za(h)},cb=function(a){a||(a={});a.filter&&a.search===c&&(a.search=a.filter);return b.extend({search:"none",order:"current",page:"all"},a)},db=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Oa=function(a,c){var d,e,f,g=[],h=a.aiDisplay;d=a.aiDisplayMaster;var p=c.search;e=c.order;f=c.page;if("ssp"==ba(a))return"removed"===p?[]:ta(0,d.length);if("current"==f)for(d=a._iDisplayStart,e=a.fnDisplayEnd();d<
e;d++)g.push(h[d]);else if("current"==e||"applied"==e)g="none"==p?d.slice():"applied"==p?h.slice():b.map(d,function(a){return-1===b.inArray(a,h)?a:null});else if("index"==e||"original"==e)for(d=0,e=a.aoData.length;d<e;d++)"none"==p?g.push(d):(f=b.inArray(d,h),(-1===f&&"removed"==p||0<=f&&"applied"==p)&&g.push(d));return g};K("rows()",function(a,d){a===c?a="":b.isPlainObject(a)&&(d=a,a="");d=cb(d);var e=this.iterator("table",function(e){var f=d;return bb("row",a,function(a){var d=Cb(a);if(null!==d&&
!f)return[d];var g=Oa(e,f);if(null!==d&&-1!==b.inArray(d,g))return[d];if(!a)return g;if("function"===typeof a)return b.map(g,function(b){var c=e.aoData[b];return a(b,c._aData,c.nTr)?b:null});d=Fb(xa(e.aoData,g,"nTr"));return a.nodeName&&-1!==b.inArray(a,d)?[a._DT_RowIndex]:"string"===typeof a&&"#"===a.charAt(0)&&(g=e.aIds[a.replace(/^#/,"")],g!==c)?[g.idx]:b(d).filter(a).map(function(){return this._DT_RowIndex}).toArray()},e,f)},1);e.selector.rows=a;e.selector.opts=d;return e});K("rows().nodes()",
function(){return this.iterator("row",function(a,b){return a.aoData[b].nTr||c},1)});K("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return xa(a.aoData,b,"_aData")},1)});U("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var d=b.aoData[c];return"search"===a?d._aFilterData:d._aSortData},1)});U("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){p(b,c,a)})});U("rows().indexes()","row().index()",
function(){return this.iterator("row",function(a,b){return b},1)});U("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,d=0,e=c.length;d<e;d++)for(var f=0,g=this[d].length;f<g;f++){var h=c[d].rowIdFn(c[d].aoData[this[d][f]]._aData);b.push((!0===a?"#":"")+h)}return new Q(c,b)});U("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,d,e){var f=b.aoData,g=f[d],h,p,l,m,n;f.splice(d,1);h=0;for(p=f.length;h<p;h++)if(l=f[h],n=l.anCells,null!==l.nTr&&(l.nTr._DT_RowIndex=
h),null!==n)for(l=0,m=n.length;l<m;l++)n[l]._DT_CellIndex.row=h;R(b.aiDisplayMaster,d);R(b.aiDisplay,d);R(a[e],d,!1);Va(b);d=b.rowIdFn(g._aData);d!==c&&delete b.aIds[d]});this.iterator("table",function(a){for(var b=0,c=a.aoData.length;b<c;b++)a.aoData[b].idx=b});return this});K("rows.add()",function(a){var c=this.iterator("table",function(b){var c,d,e,f=[];d=0;for(e=a.length;d<e;d++)c=a[d],c.nodeName&&"TR"===c.nodeName.toUpperCase()?f.push(J(b,c)[0]):f.push(D(b,c));return f},1),d=this.rows(-1);d.pop();
b.merge(d,c);return d});K("row()",function(a,b){return db(this.rows(a,b))});K("row().data()",function(a){var b=this.context;if(a===c)return b.length&&this.length?b[0].aoData[this[0]]._aData:c;b[0].aoData[this[0]]._aData=a;p(b[0],this[0],"data");return this});K("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});K("row.add()",function(a){a instanceof b&&a.length&&(a=a[0]);var c=this.iterator("table",function(b){return a.nodeName&&"TR"===a.nodeName.toUpperCase()?
J(b,a)[0]:D(b,a)});return this.row(c[0])});var eb=function(a,b){var d=a.context;d.length&&(d=d[0].aoData[b!==c?b:a[0]])&&d._details&&(d._details.remove(),d._detailsShow=c,d._details=c)},Ib=function(a,b){var c=a.context;if(c.length&&a.length){var d=c[0].aoData[a[0]];if(d._details){(d._detailsShow=b)?d._details.insertAfter(d.nTr):d._details.detach();var e=c[0],f=new Q(e),g=e.aoData;f.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<ga(g,"_details").length&&(f.on("draw.dt.DT_details",
function(a,b){e===b&&f.rows({page:"current"}).eq(0).each(function(a){a=g[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),f.on("column-visibility.dt.DT_details",function(a,b){if(e===b)for(var c,d=w(b),f=0,h=g.length;f<h;f++)c=g[f],c._details&&c._details.children("td[colspan]").attr("colspan",d)}),f.on("destroy.dt.DT_details",function(a,b){if(e===b)for(var c=0,d=g.length;c<d;c++)g[c]._details&&eb(f,c)}))}}};K("row().child()",function(a,d){var e=this.context;if(a===c)return e.length&&this.length?
e[0].aoData[this[0]]._details:c;if(!0===a)this.child.show();else if(!1===a)eb(this);else if(e.length&&this.length){var f=e[0],e=e[0].aoData[this[0]],g=[],h=function(a,c){if(b.isArray(a)||a instanceof b)for(var d=0,e=a.length;d<e;d++)h(a[d],c);else a.nodeName&&"tr"===a.nodeName.toLowerCase()?g.push(a):(d=b("<tr><td/></tr>").addClass(c),b("td",d).addClass(c).html(a)[0].colSpan=w(f),g.push(d[0]))};h(a,d);e._details&&e._details.remove();e._details=b(g);e._detailsShow&&e._details.insertAfter(e.nTr)}return this});
K(["row().child.show()","row().child().show()"],function(){Ib(this,!0);return this});K(["row().child.hide()","row().child().hide()"],function(){Ib(this,!1);return this});K(["row().child.remove()","row().child().remove()"],function(){eb(this);return this});K("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Rb=/^(.+):(name|visIdx|visible)$/,Jb=function(a,b,c,d,e){c=[];d=0;for(var f=e.length;d<f;d++)c.push(G(a,e[d],b));
return c};K("columns()",function(a,d){a===c?a="":b.isPlainObject(a)&&(d=a,a="");d=cb(d);var e=this.iterator("table",function(c){var e=a,f=d,g=c.aoColumns,h=ga(g,"sName"),p=ga(g,"nTh");return bb("column",e,function(a){var d=Cb(a);if(""===a)return ta(g.length);if(null!==d)return[0<=d?d:g.length+d];if("function"===typeof a){var e=Oa(c,f);return b.map(g,function(b,d){return a(d,Jb(c,d,0,0,e),p[d])?d:null})}var l="string"===typeof a?a.match(Rb):"";if(l)switch(l[2]){case "visIdx":case "visible":d=parseInt(l[1],
10);if(0>d){var m=b.map(g,function(a,b){return a.bVisible?b:null});return[m[m.length+d]]}return[v(c,d)];case "name":return b.map(h,function(a,b){return a===l[1]?b:null})}else return b(p).filter(a).map(function(){return b.inArray(this,p)}).toArray()},c,f)},1);e.selector.cols=a;e.selector.opts=d;return e});U("columns().header()","column().header()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});U("columns().footer()","column().footer()",function(){return this.iterator("column",
function(a,b){return a.aoColumns[b].nTf},1)});U("columns().data()","column().data()",function(){return this.iterator("column-rows",Jb,1)});U("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});U("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,d,e,f){return xa(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});U("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",
function(a,b,c,d,e){return xa(a.aoData,e,"anCells",b)},1)});U("columns().visible()","column().visible()",function(a,d){return this.iterator("column",function(e,f){if(a===c)return e.aoColumns[f].bVisible;var g=e.aoColumns,h=g[f],p=e.aoData,l,m,n;if(a!==c&&h.bVisible!==a){if(a){var u=b.inArray(!0,ga(g,"bVisible"),f+1);l=0;for(m=p.length;l<m;l++)n=p[l].nTr,g=p[l].anCells,n&&n.insertBefore(g[f],g[u]||null)}else b(ga(e.aoData,"anCells",f)).detach();h.bVisible=a;X(e,e.aoHeader);X(e,e.aoFooter);if(d===c||
d)r(e),(e.oScroll.sX||e.oScroll.sY)&&ua(e);T(e,null,"column-visibility",[e,f,a,d]);Ja(e)}})});U("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?f(b,c):c},1)});K("columns.adjust()",function(){return this.iterator("table",function(a){r(a)},1)});K("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return v(c,b);if("fromData"===a||"toVisible"===a)return f(c,b)}});K("column()",
function(a,b){return db(this.columns(a,b))});K("cells()",function(a,d,e){b.isPlainObject(a)&&(a.row===c?(e=a,a=null):(e=d,d=null));b.isPlainObject(d)&&(e=d,d=null);if(null===d||d===c)return this.iterator("table",function(d){var f=a,g=cb(e),h=d.aoData,p=Oa(d,g),l=Fb(xa(h,p,"anCells")),m=b([].concat.apply([],l)),n,u=d.aoColumns.length,k,r,A,t,q,F;return bb("cell",f,function(a){var e="function"===typeof a;if(null===a||a===c||e){k=[];r=0;for(A=p.length;r<A;r++)for(n=p[r],t=0;t<u;t++)q={row:n,column:t},
e?(F=h[n],a(q,G(d,n,t),F.anCells?F.anCells[t]:null)&&k.push(q)):k.push(q);return k}return b.isPlainObject(a)?[a]:m.filter(a).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray()},d,g)});var f=this.columns(d,e),g=this.rows(a,e),h,p,l,m,n,u=this.iterator("table",function(a,b){h=[];p=0;for(l=g[b].length;p<l;p++)for(m=0,n=f[b].length;m<n;m++)h.push({row:g[b][p],column:f[b][m]});return h},1);b.extend(u.selector,{cols:d,rows:a,opts:e});return u});U("cells().nodes()",
"cell().node()",function(){return this.iterator("cell",function(a,b,d){return(a=a.aoData[b].anCells)?a[d]:c},1)});K("cells().data()",function(){return this.iterator("cell",function(a,b,c){return G(a,b,c)},1)});U("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,d){return b.aoData[c][a][d]},1)});U("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return G(b,c,d,a)},1)});U("cells().indexes()",
"cell().index()",function(){return this.iterator("cell",function(a,b,c){return{row:b,column:c,columnVisible:f(a,c)}},1)});U("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){p(b,c,a,d)})});K("cell()",function(a,b,c){return db(this.cells(a,b,c))});K("cell().data()",function(a){var b=this.context,d=this[0];if(a===c)return b.length&&d.length?G(b[0],d[0].row,d[0].column):c;C(b[0],d[0].row,d[0].column,a);p(b[0],d[0].row,"data",d[0].column);return this});
K("order()",function(a,d){var e=this.context;if(a===c)return 0!==e.length?e[0].aaSorting:c;"number"===typeof a?a=[[a,d]]:b.isArray(a[0])||(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});K("order.listener()",function(a,b,c){return this.iterator("table",function(d){Ra(d,a,b,c)})});K("order.fixed()",function(a){if(!a){var d=this.context,d=d.length?d[0].aaSortingFixed:c;return b.isArray(d)?{pre:d}:d}return this.iterator("table",function(c){c.aaSortingFixed=
b.extend(!0,{},a)})});K(["columns().order()","column().order()"],function(a){var c=this;return this.iterator("table",function(d,e){var f=[];b.each(c[e],function(b,c){f.push([c,a])});d.aaSorting=f})});K("search()",function(a,d,e,f){var g=this.context;return a===c?0!==g.length?g[0].oPreviousSearch.sSearch:c:this.iterator("table",function(c){c.oFeatures.bFilter&&ma(c,b.extend({},c.oPreviousSearch,{sSearch:a+"",bRegex:null===d?!1:d,bSmart:null===e?!0:e,bCaseInsensitive:null===f?!0:f}),1)})});U("columns().search()",
"column().search()",function(a,d,e,f){return this.iterator("column",function(g,h){var p=g.aoPreSearchCols;if(a===c)return p[h].sSearch;g.oFeatures.bFilter&&(b.extend(p[h],{sSearch:a+"",bRegex:null===d?!1:d,bSmart:null===e?!0:e,bCaseInsensitive:null===f?!0:f}),ma(g,g.oPreviousSearch,1))})});K("state()",function(){return this.context.length?this.context[0].oSavedState:null});K("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});K("state.loaded()",
function(){return this.context.length?this.context[0].oLoadedState:null});K("state.save()",function(){return this.iterator("table",function(a){Ja(a)})});B.versionCheck=B.fnVersionCheck=function(a){var b=B.version.split(".");a=a.split(".");for(var c,d,e=0,f=a.length;e<f;e++)if(c=parseInt(b[e],10)||0,d=parseInt(a[e],10)||0,c!==d)return c>d;return!0};B.isDataTable=B.fnIsDataTable=function(a){var c=b(a).get(0),d=!1;b.each(B.settings,function(a,e){var f=e.nScrollHead?b("table",e.nScrollHead)[0]:null,g=
e.nScrollFoot?b("table",e.nScrollFoot)[0]:null;if(e.nTable===c||f===c||g===c)d=!0});return d};B.tables=B.fnTables=function(a){var c=!1;b.isPlainObject(a)&&(c=a.api,a=a.visible);var d=b.map(B.settings,function(c){if(!a||a&&b(c.nTable).is(":visible"))return c.nTable});return c?new Q(d):d};B.util={throttle:Da,escapeRegex:Ga};B.camelToHungarian=h;K("$()",function(a,c){var d=this.rows(c).nodes(),d=b(d);return b([].concat(d.filter(a).toArray(),d.find(a).toArray()))});b.each(["on","one","off"],function(a,
c){K(c+"()",function(){var a=Array.prototype.slice.call(arguments);a[0].match(/\.dt\b/)||(a[0]+=".dt");var d=b(this.tables().nodes());d[c].apply(d,a);return this})});K("clear()",function(){return this.iterator("table",function(a){O(a)})});K("settings()",function(){return new Q(this.context,this.context)});K("init()",function(){var a=this.context;return a.length?a[0].oInit:null});K("data()",function(){return this.iterator("table",function(a){return ga(a.aoData,"_aData")}).flatten()});K("destroy()",
function(a){a=a||!1;return this.iterator("table",function(c){var d=c.nTableWrapper.parentNode,e=c.oClasses,f=c.nTable,g=c.nTBody,h=c.nTHead,p=c.nTFoot,l=b(f),g=b(g),m=b(c.nTableWrapper),n=b.map(c.aoData,function(a){return a.nTr}),u;c.bDestroying=!0;T(c,"aoDestroyCallback","destroy",[c]);a||(new Q(c)).columns().visible(!0);m.unbind(".DT").find(":not(tbody *)").unbind(".DT");b(k).unbind(".DT-"+c.sInstance);f!=h.parentNode&&(l.children("thead").detach(),l.append(h));p&&f!=p.parentNode&&(l.children("tfoot").detach(),
l.append(p));c.aaSorting=[];c.aaSortingFixed=[];Ia(c);b(n).removeClass(c.asStripeClasses.join(" "));b("th, td",h).removeClass(e.sSortable+" "+e.sSortableAsc+" "+e.sSortableDesc+" "+e.sSortableNone);c.bJUI&&(b("th span."+e.sSortIcon+", td span."+e.sSortIcon,h).detach(),b("th, td",h).each(function(){var a=b("div."+e.sSortJUIWrapper,this);b(this).append(a.contents());a.detach()}));g.children().detach();g.append(n);h=a?"remove":"detach";l[h]();m[h]();!a&&d&&(d.insertBefore(f,c.nTableReinsertBefore),l.css("width",
c.sDestroyWidth).removeClass(e.sTable),(u=c.asDestroyStripes.length)&&g.children().each(function(a){b(this).addClass(c.asDestroyStripes[a%u])}));d=b.inArray(c,B.settings);-1!==d&&B.settings.splice(d,1)})});b.each(["column","row","cell"],function(a,b){K(b+"s().every()",function(a){var d=this.selector.opts,e=this;return this.iterator(b,function(f,g,h,p,l){a.call(e[b](g,"cell"===b?h:d,"cell"===b?d:c),g,h,p,l)})})});K("i18n()",function(a,d,e){var f=this.context[0];a=L(a)(f.oLanguage);a===c&&(a=d);e!==
c&&b.isPlainObject(a)&&(a=a[e]!==c?a[e]:a._);return a.replace("%d",e)});B.version="1.10.10";B.settings=[];B.models={};B.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};B.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};B.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,
mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};B.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,
bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?
sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",
sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},
oSearch:b.extend({},B.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};a(B.defaults);B.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,
sType:null,sWidth:null};a(B.defaults.column);B.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],
aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,
searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:c,oAjaxData:c,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],
fnRecordsTotal:function(){return"ssp"==ba(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ba(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,e=this.oFeatures,f=e.bPaginate;return e.bServerSide?!1===f||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!f||c>d||-1===a?d:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,
aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};B.ext=Z={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:B.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:B.version};b.extend(Z,{afnFiltering:Z.search,aTypes:Z.type.detect,ofnSearch:Z.type.search,oSort:Z.type.order,afnSortData:Z.order,aoFeatures:Z.feature,
oApi:Z.internal,oStdClasses:Z.classes,oPagination:Z.pager});b.extend(B.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",
sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",
sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Pa="",Pa="",ia=Pa+"ui-state-default",ya=Pa+"css_right ui-icon ui-icon-",Kb=Pa+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";b.extend(B.ext.oJUIClasses,B.ext.classes,{sPageButton:"fg-button ui-button "+ia,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:ia+" sorting_asc",
sSortDesc:ia+" sorting_desc",sSortable:ia+" sorting",sSortableAsc:ia+" sorting_asc_disabled",sSortableDesc:ia+" sorting_desc_disabled",sSortableNone:ia+" sorting_disabled",sSortJUIAsc:ya+"triangle-1-n",sSortJUIDesc:ya+"triangle-1-s",sSortJUI:ya+"carat-2-n-s",sSortJUIAscAllowed:ya+"carat-1-n",sSortJUIDescAllowed:ya+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+ia,sScrollFoot:"dataTables_scrollFoot "+ia,sHeaderTH:ia,sFooterTH:ia,
sJUIHeader:Kb+" ui-corner-tl ui-corner-tr",sJUIFooter:Kb+" ui-corner-bl ui-corner-br"});var zb=B.ext.pager;b.extend(zb,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[La(a,b)]},simple_numbers:function(a,b){return["previous",La(a,b),"next"]},full_numbers:function(a,b){return["first","previous",La(a,b),"next","last"]},_numbers:La,numbers_length:7});b.extend(!0,B.ext.renderer,{pageButton:{_:function(a,c,d,f,g,h){var p=
a.oClasses,l=a.oLanguage.oPaginate,m=a.oLanguage.oAria.paginate||{},n,u,k=0,r=function(c,e){var f,A,t,q,F=function(b){Wa(a,b.data.action,!0)};f=0;for(A=e.length;f<A;f++)if(q=e[f],b.isArray(q))t=b("<"+(q.DT_el||"div")+"/>").appendTo(c),r(t,q);else{n=null;u="";switch(q){case "ellipsis":c.append('<span class="ellipsis">&#x2026;</span>');break;case "first":n=l.sFirst;u=q+(0<g?"":" "+p.sPageButtonDisabled);break;case "previous":n=l.sPrevious;u=q+(0<g?"":" "+p.sPageButtonDisabled);break;case "next":n=l.sNext;
u=q+(g<h-1?"":" "+p.sPageButtonDisabled);break;case "last":n=l.sLast;u=q+(g<h-1?"":" "+p.sPageButtonDisabled);break;default:n=q+1,u=g===q?p.sPageButtonActive:""}null!==n&&(t=b("<a>",{"class":p.sPageButton+" "+u,"aria-controls":a.sTableId,"aria-label":m[q],"data-dt-idx":k,tabindex:a.iTabIndex,id:0===d&&"string"===typeof q?a.sTableId+"_"+q:null}).html(n).appendTo(c),Ya(t,{action:q},F),k++)}},A;try{A=b(c).find(e.activeElement).data("dt-idx")}catch(t){}r(b(c).empty(),f);A&&b(c).find("[data-dt-idx="+A+
"]").focus()}}});b.extend(B.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return ab(a,c)?"num"+c:null},function(a){if(!(!a||a instanceof Date||Ob.test(a)&&Pb.test(a)))return null;var b=Date.parse(a);return null!==b&&!isNaN(b)||la(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return ab(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Eb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Eb(a,c,!0)?"html-num-fmt"+c:null},function(a){return la(a)||
"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);b.extend(B.ext.type.search,{html:function(a){return la(a)?a:"string"===typeof a?a.replace(Bb," ").replace(Na,""):""},string:function(a){return la(a)?a:"string"===typeof a?a.replace(Bb," "):a}});var Ma=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Db(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};b.extend(Z.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return la(a)?
"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return la(a)?"":"string"===typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});fb("");b.extend(!0,B.ext.renderer,{header:{_:function(a,c,d,e){b(a.nTable).on("order.dt.DT",function(b,f,g,h){a===f&&(b=d.idx,c.removeClass(d.sSortingClass+" "+e.sSortAsc+" "+e.sSortDesc).addClass("asc"==h[b]?e.sSortAsc:"desc"==h[b]?e.sSortDesc:
d.sSortingClass))})},jqueryui:function(a,c,d,e){b("<div/>").addClass(e.sSortJUIWrapper).append(c.contents()).append(b("<span/>").addClass(e.sSortIcon+" "+d.sSortingClassJUI)).appendTo(c);b(a.nTable).on("order.dt.DT",function(b,f,g,h){a===f&&(b=d.idx,c.removeClass(e.sSortAsc+" "+e.sSortDesc).addClass("asc"==h[b]?e.sSortAsc:"desc"==h[b]?e.sSortDesc:d.sSortingClass),c.find("span."+e.sSortIcon).removeClass(e.sSortJUIAsc+" "+e.sSortJUIDesc+" "+e.sSortJUI+" "+e.sSortJUIAscAllowed+" "+e.sSortJUIDescAllowed).addClass("asc"==
h[b]?e.sSortJUIAsc:"desc"==h[b]?e.sSortJUIDesc:d.sSortingClassJUI))})}}});B.render={number:function(a,b,c,d,e){return{display:function(f){if("number"!==typeof f&&"string"!==typeof f)return f;var g=0>f?"-":"",h=parseFloat(f);if(isNaN(h))return f;f=Math.abs(h);h=parseInt(f,10);f=c?b+(f-h).toFixed(c).substring(2):"";return g+(d||"")+h.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f+(e||"")}}},text:function(){return{display:function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;"):a}}}};b.extend(B.ext.internal,{_fnExternApiFunc:Ab,_fnBuildAjax:na,_fnAjaxUpdate:pa,_fnAjaxParameters:qa,_fnAjaxUpdateDraw:Ba,_fnAjaxDataSrc:sa,_fnAddColumn:g,_fnColumnOptions:n,_fnAdjustColumnSizing:r,_fnVisibleToColumnIndex:v,_fnColumnIndexToVisible:f,_fnVisbleColumns:w,_fnGetColumns:y,_fnColumnTypes:E,_fnApplyColumnDefs:N,_fnHungarianMap:a,_fnCamelToHungarian:h,_fnLanguageCompat:m,_fnBrowserDetect:t,_fnAddData:D,_fnAddTr:J,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==c?b._DT_RowIndex:
null},_fnNodeToColumnIndex:function(a,c,d){return b.inArray(d,a.aoData[c].anCells)},_fnGetCellData:G,_fnSetCellData:C,_fnSplitObjNotation:I,_fnGetObjectDataFn:L,_fnSetObjectDataFn:H,_fnGetDataMaster:M,_fnClearTable:O,_fnDeleteIndex:R,_fnInvalidate:p,_fnGetRowElements:u,_fnCreateTr:A,_fnBuildHead:P,_fnDrawHead:X,_fnDraw:z,_fnReDraw:x,_fnAddOptionsHtml:fa,_fnDetectHeader:W,_fnGetUniqueThs:Y,_fnFeatureHtmlFilter:Aa,_fnFilterComplete:ma,_fnFilterCustom:Fa,_fnFilterColumn:Ea,_fnFilter:mb,_fnFilterCreateSearch:Ta,
_fnEscapeRegex:Ga,_fnFilterData:nb,_fnFeatureHtmlInfo:kb,_fnUpdateInfo:qb,_fnInfoMacros:rb,_fnInitialise:wa,_fnInitComplete:Ca,_fnLengthChange:Ua,_fnFeatureHtmlLength:hb,_fnFeatureHtmlPaginate:lb,_fnPageChange:Wa,_fnFeatureHtmlProcessing:ib,_fnProcessingDisplay:ea,_fnFeatureHtmlTable:jb,_fnScrollDraw:ua,_fnApplyToChildren:ja,_fnCalculateColumnWidths:Qa,_fnThrottle:Da,_fnConvertToWidth:sb,_fnGetWidestNode:tb,_fnGetMaxLenString:ub,_fnStringToCss:V,_fnSortFlatten:ra,_fnSort:gb,_fnSortAria:wb,_fnSortListener:Xa,
_fnSortAttachListener:Ra,_fnSortingClasses:Ia,_fnSortData:vb,_fnSaveState:Ja,_fnLoadState:xb,_fnSettingsFromNode:Ka,_fnLog:ka,_fnMap:ha,_fnBindAction:Ya,_fnCallbackReg:ca,_fnCallbackFire:T,_fnLengthOverflow:Va,_fnRenderer:Sa,_fnDataSource:ba,_fnRowAttributes:F,_fnCalculateEnd:function(){}});b.fn.dataTable=B;B.$=b;b.fn.dataTableSettings=B.settings;b.fn.dataTableExt=B.ext;b.fn.DataTable=function(a){return b(this).dataTable(a).api()};b.each(B,function(a,c){b.fn.DataTable[a]=c});return b.fn.dataTable});window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(b){return function(){var k={};return{check_message:function(e){var c;if(e.is_box())if(c=e.get_size(),1>c)b.UTILITIES.display_message("Function birds can only respond to boxes with holes.");else if(e=e.get_hole_contents(0)){if(e.is_bird())return{box_size:c,bird:e};b.UTILITIES.display_message("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+b.UTILITIES.add_a_or_an(e.get_type_name()+"."))}else b.UTILITIES.display_message("Function birds can only respond to boxes with something in the first hole.");
else b.UTILITIES.display_message("Function birds can only respond to boxes. One was given "+b.UTILITIES.add_a_or_an(e.get_type_name()))},process_response:function(b,c,a,h,m){b&&c.widget_side_dropped_on_me(b,void 0,m,!0,!0);a.remove(void 0,!0)},process_message:function(b,c,a,h){var m=this.check_message(b);if(m)return c=c(m.bird,m.box_size),1<b.get_size()&&b.get_hole_contents(1).remove(a,!0),this.process_response(c,m.bird,b,a,h),c},type_check:function(e,c,a,h){if(!e)return!0;if(!c)return b.UTILITIES.display_message("Birds for the "+
a+" function can only respond to boxes with "+b.UTILITIES.add_a_or_an(e)+" in the "+b.UTILITIES.ordinal(h)+" hole. The "+b.UTILITIES.ordinal(h)+" hole is empty."),!1;if(c.dereference().is_of_type(e))return!0;if(c.is_nest())throw{wait_for_nest_to_receive_something:c};b.UTILITIES.display_message("Birds for the "+a+" function can only respond to boxes with "+b.UTILITIES.add_a_or_an(e)+" in the "+b.UTILITIES.ordinal(h)+" hole. The "+b.UTILITIES.ordinal(h)+" hole contains "+b.UTILITIES.add_a_or_an(c.get_type_name()+
"."));return!1},number_check:function(b,c,a){return this.type_check("number",b,c,a)},n_ary_widget_function:function(b,c,a,h,m,l){var d=function(d,l){var g,m,k,v;if(1===l)return c();m=1;k=b.get_hole_contents(m).dereference();if(v=this.number_check(k,h,m)){for(m++;m<l;){g=b.get_hole_contents(m).dereference();v=this.number_check(g,h,m);if(!v)return;a.call(k,g);m++}return k}}.bind(this);return this.process_message(b,d,m,l)},n_ary_function:function(e,c,a,h,m,l){var d=function(d,l){var g,m,k,v;if(l<a+1)b.UTILITIES.display_message("Birds for the "+
h+" function can only respond to boxes with at least "+(a+1)+" holes. Not "+l+" holes.");else{k=[];for(m=1;m<l;){g=e.get_hole_contents(m).dereference();v=this.number_check(g,h,m);if(!v)return;k.push(g.get_value());m++}return c.apply(null,k)}}.bind(this);return this.process_message(e,d,m,l)},typed_bird_function:function(e,c,a,h,m,l,d){var k=function(d,g){var l,k,t,f;if(0<=h&&g!=h+1)b.UTILITIES.display_message("Birds for the "+m+" function can only respond to boxes with "+(h+1)+" holes. Not "+g+" holes.");
else{t=[];for(k=1;k<g;){l=e.get_hole_contents(k).dereference();k<=a.length&&(f=a[k-1]);if(!this.type_check(f,l,m,k))return;t.push(l);k++}return c.apply(e,t)}}.bind(this);return this.process_message(e,k,l,d)},numeric_javascript_function_to_widget_function:function(e,c,a){return function(){var h=b.number.ZERO(b.number.function_bird_results_default_format);h.set_value_from_decimal(e.apply(null,b.UTILITIES.map_arguments(arguments,a||bigrat.toDecimal)));c&&h.set_approximate(!0);return h}},bigrat_function_to_widget_function:function(e,
c){return function(){var a=b.number.create_from_bigrat(e.apply(null,arguments));c&&a.set_approximate(!0);return a}},add_function_object:function(e,c,a,h,m){k[e]={name:e,short_name:h||e,respond_to_message:c,get_description:m?1===m.length?function(){return"If you give me a box with another bird and "+b.UTILITIES.add_a_or_an(m[0])+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+
b.UTILITIES.conjunction(m,!0)+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."},toString:function(){return b.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:a}},get_function_table:function(){return k}}}}(window.TOONTALK);window.TOONTALK.widget=function(b){var k=function(b){if(b=this.get_frontside&&this.get_frontside(b))return b.get_element()};b.creators_from_json.top_level=function(e){e=b.widget.create_top_level_widget(e.settings);$(e.get_backside(!0).get_element()).addClass("toontalk-top-level-backside");return e};return{add_standard_widget_functionality:function(e){var c=function(){return!1},a;this.add_sides_functionality(e);this.runnable(e);this.stackable(e);this.animatable(e);this.has_title(e);this.has_parent(e);
this.has_backside_widgets(e);this.has_description(e);this.has_listeners(e);this.droppable(e);this.erasable(e);e.this_and_walk_children=function(a){a(e)&&e.walk_children&&e.walk_children(a)};e.top_level_widget=function(){var c;if(a)return a;if(this.is_top_level())return this;if(a=b.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-top-level-backside")))return a=a.get_widget();if(c=this.get_parent_of_frontside()||this.get_parent_of_backside())return a=c.get_widget().top_level_widget();
c=$(".toontalk-top-level-backside");if(0<c.length)return a=b.UTILITIES.widget_side_of_element(b.UTILITIES.closest_element(c,$(this.get_frontside_element()).offset())).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return a=this.create_top_level_widget()};e.is_of_type||(e.is_of_type=function(a){return this.get_type_name()===a});e.dereference||(e.dereference=function(){return this});e.get_default_description||(e.get_default_description=function(){return b.UTILITIES.add_a_or_an(this.get_type_name())+
"."});e.is_number||(e.is_number=c);e.is_box||(e.is_box=c);e.is_empty_hole||(e.is_empty_hole=c);e.is_hole||(e.is_hole=c);e.is_scale||(e.is_scale=c);e.is_bird||(e.is_bird=c);e.is_nest||(e.is_nest=c);e.is_robot||(e.is_robot=c);e.is_element||(e.is_element=c);e.is_sensor||(e.is_sensor=c);e.is_function_nest||(e.is_function_nest=c);e.is_plain_text_element||(e.is_plain_text_element=c);e.is_attribute_widget||(e.is_attribute_widget=c);e.maintain_proportional_dimensions||(e.maintain_proportional_dimensions=
c);e.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};e.set_name&&(e.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});e.get_width||(e.get_width=function(){return $(e.get_frontside_element()).width()});e.get_height||(e.get_height=function(){return $(e.get_frontside_element()).height()});!b.debugging&&!b.logging||e.to_debug_string||(e.to_debug_string=function(){var a=this.get_parent_widget_of_frontside(),b=this._debug_id,
c=this.get_description(),c=c?c+" ":"";b||(b=a&&a.id?"id of parent is "+a.id:"");c&&(c+=" ");return this.toString({plain_text:!0})+" ("+c+(this.get_name&&this.get_name()+" "||"")+b+")"});e.is_top_level=c;e.is_widget=!0},erasable:function(b){var c;b.get_erased||(b.get_erased=function(){return c});b.set_erased||(b.set_erased=function(a,b){c=a;b&&this.rerender()})},add_sides_functionality:function(e){var c,a,h;e.get_frontside||(e.get_frontside=function(a){a&&!c&&(c=b.frontside.create(e));return c},e.save_dimensions=
function(){return this.save_dimensions_of(this)},e.save_dimensions_of=function(a){var b;if(a.is_element()){if(!this.get_original_width())return;b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0},e.restore_dimensions=function(){var a,c;0<this.saved_width&&(a=this.get_frontside_element(!0),this.use_scaling_transform?this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):
this.ok_to_set_dimensions()?this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):b.UTILITIES.set_css(a,{width:this.saved_width,height:this.saved_height}):(c={width:"",height:""},b.UTILITIES.set_css_transform(c,""),b.UTILITIES.set_css(a,c)),this.saved_height=this.saved_width=void 0)});e.get_backside||(e.get_backside=function(b){b&&!a&&(a=this.create_backside(),this.backside_widgets_json_views&&(a.add_backside_widgets(this.get_backside_widgets(),this.backside_widgets_json_views),
this.backside_widgets_json_views=void 0));return a});e.set_backside||(e.set_backside=function(b){a=b});e.forget_backside||(e.forget_backside=function(){var b;if(a){if(b=a.get_element())$(b).remove(),b.toontalk_widget_side=void 0;a=void 0}});e.create_backside||(e.create_backside=function(){return b.backside.create(e)});e.get_open_backside_only_if_stopped||(e.get_open_backside_only_if_stopped=function(){return h});e.set_open_backside_only_if_stopped||(e.set_open_backside_only_if_stopped=function(a){h=
a})},runnable:function(b){var c=!1,a=!1;b.get_running||(b.get_running=function(a){var b=!1;if(a)return c;if(c)if(a=this.get_backside_widgets(),0===a.length)c=!1;else for(a.some(function(a){if(a&&(a=a.get_widget(),a.get_running()))return b=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return b});b.is_ok_to_run||(b.is_ok_to_run=function(){return a},b.set_ok_to_run=function(b){a=
b});b.set_running||(b.set_running=function(h,m,l){var d=c===h,k,q;a=h;k=this.get_backside_widgets();c=h;this.get_backside()&&!d&&this.get_backside().run_status_changed(c);k.forEach(function(a){a&&(q=a.get_widget(),a.is_backside()&&(0<=this.get_backside_widgets().indexOf(q)||!a.is_primary_backside())||(!q.is_robot()||q.being_trained||q.get_body().is_empty()?q.set_running&&(!m&&a.is_backside()&&"top-level"!==b.get_type_name()?q.set_running(h,b,!0):q.set_running(h)):c?(q.set_stopped(!1),q.run(b,l,m),
q.set_ok_to_run(!0)):(q.set_stopped(!0),q.set_running(!1)),q.rerender()))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(c);return!0});this.is_robot()&&(c?b.get_parent_of_backside()&&(this.set_stopped(!1),this.run(b.get_parent_of_backside().get_widget())):this.set_stopped(!0));d||this.rerender()})},droppable:function(b){b.drop_on||(b.drop_on=function(b,a,e){if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,a,e);console.log("No handler for drop of '"+
this+"' on '"+b+"'")})},stackable:function(b){var c=!1;b.get_infinite_stack||(b.get_infinite_stack=function(){return c});b.set_infinite_stack||(b.set_infinite_stack=function(a){var h=b.get_backside_element(),m=b.get_frontside_element();c=a;h&&$(h).find(".toontalk-infinite-stack-check-box").prop("checked",a);m&&(a?$(m).addClass("toontalk-infinite-stack"):$(m).removeClass("toontalk-infinite-stack"))})},animatable:function(e){var c;e.animate_to_widget||(c=function(a,c){var e=a.get_element();e&&(a.is_backside()||
b.UTILITIES.visible_element(e))||(e=b.UTILITIES.find_resource_equal_to_widget(a,c));return e},e.animate_to_widget=function(a,b,e,l,d,k,q,g){var n=function(){this.animate_to_element(c(a,g),b,e,l,d,k,q&&Math.max(0,q-100));this.rerender()}.bind(this);0===q?n():setTimeout(n,100)});e.animate_to_element||(e.animate_to_element=function(a,c,e,l,d,k,q){var g=$(a).offset(),n=$(this.get_frontside_element()),r=$(a).is(".toontalk-backside");if(a&&b.UTILITIES.visible_element(a)){if("number"===typeof a.animation_left_offset)l=
a.animation_left_offset;else if("undefined"===typeof l||r)l=($(a).width()-n.width())*Math.random();if("number"===typeof a.animation_top_offset)d=a.animation_top_offset;else if("undefined"===typeof d||r)d=($(a).height()-n.height())*Math.random();g?(g.left+=l,g.top+=d):g={left:0,top:0};this.animate_to_absolute_position(g,c,e,k,q)}else c&&c()});e.animate_to_absolute_position||(e.animate_to_absolute_position=function(a,c,e,l,d){b.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),a,c,
e,l,d)})},has_title:function(e){e.get_title||(e.get_title=function(){var c=this.get_type_name(),a=this.get_backside(),e=this.get_frontside_element(),m=this.get_description(),l="";$(e).is(".toontalk-top-level-resource")?l=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":a&&a.get_element()&&b.UTILITIES.visible_element(a.get_element())||(l=this.can_run&&
this.can_run()?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my backside and then click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+".":"Click to see my backside.");m&&(m="I'm "+m,l=l?m+"\n"+l:m);if(this.get_erased())return this.get_title_of_erased_widget();
l=this.get_custom_title_prefix&&!$(e).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+l:"I'm "+b.UTILITIES.add_a_or_an(c)+". "+l;l=l.trim();0>".?!".indexOf(l[l.length-1])&&(l+=".");return l});e.update_title=function(){var c=this.get_frontside_element();c&&b.UTILITIES.give_tooltip(c,this.get_title())}},get_title_of_erased_widget:function(){var b=this.get_frontside_element(),c=this.get_type_name();return b&&$(b).closest(".toontalk-conditions-contents-container").is("*")?"I'm an erased "+
c+".\nI'll match with any other "+c+".":"I'm an erased "+c+".\nDusty the Vacuum can restore me to normal."},has_parent:function(e){var c=[],a,h,m,l;e.get_parent_of_frontside=function(){return m&&a?a.get_backside(!0):a};e.get_parent_widget_of_frontside=function(){return a};e.parent_of_frontside_is_backside=function(){return m};e.set_parent_of_frontside=function(b,e,h){var g=a;m=e;a!==b&&(a=b,g&&!h&&!e&&g.is_backside()&&g.get_widget().remove_backside_widget(this,!0),c.forEach(function(b){b(g,a)}))};
e.add_parent_of_frontside_change_listener=function(a){c.push(a)};e.remove_parent_of_frontside_change_listener=function(a){a=c.indexOf(a);0<=a&&c.splice(a,1)};e.get_parent_of_backside=function(){return l&&h?h.get_backside(!0):h};e.set_parent_of_backside=function(a,b,c){void 0===a&&!c&&l&&h&&h.get_widget().remove_backside_widget(this.get_backside(),!0);h=a;l=b};e.parent_of_backside_is_backside=function(){return l};e.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?
a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};e.closest_visible_ancestor_or_frontside=function(){for(var a=this,c;a&&!b.UTILITIES.visible_element(a.get_frontside_element());)c=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=c.get_widget()):a=a.get_parent_of_frontside();return a||this};e.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};e.has_ancestor=function(a){var b;
return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};e.remove_from_parent_of_frontside=function(b){a&&(a.is_backside()?a.remove_backside_widget(this,!b):a.removed_from_container?m?a.remove_backside_widget(this,!0):a.removed_from_container(this,b):a.get_backside()&&a.remove_backside_widget(this,!b))}},has_description:function(b){var c;b.get_description||(b.get_description=function(){return c});b.set_description||(b.set_description=function(a,b){if(c===a||!c&&""===a)return!1;
c=a;b&&this.rerender();return!0});b.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},has_name:function(b){var c;b.get_name||(b.get_name=function(){"string"!==typeof c&&b.generate_name&&(c=b.generate_name());return c});b.set_name||(b.set_name=function(a,b){if(c===a||"string"!==typeof a)return!1;c=a;b&&this.rerender();return!0})},has_listeners:function(e){var c={};e.add_listener||(e.add_listener=function(a,b){var e=
c[a];e?0>e.indexOf(b)&&e.push(b):c[a]=[b]});e.remove_listener||(e.remove_listener=function(a,e,m){if(a=c[a])if(e=a.indexOf(e),0<=e){a.splice(e,1);return}!m&&b.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});e.get_listeners||(e.get_listeners=function(a){return c[a]})},get_full_description:function(b){var c;if(this.get_erased&&this.get_erased())return b&&"conditions"===b.role?"any "+this.get_type_name():"erased "+this.get_type_name();c=this.get_description(b);b=this.toString(b);
return c?b+" ("+c+")":b},remove:function(b,c){var a=this.get_backside(),h=this.get_frontside(),m=this.get_parent_of_frontside();a&&this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level()&&a.hide_backside();h&&h.remove();m&&this.remove_from_parent_of_frontside(b);this.get_running()&&this.set_running(!1);this.set_visible(!1);this.walk_children&&!c&&this.walk_children(function(a){a.remove&&a.remove();return!0})},get_frontside_element:k,get_element:k,get_backside_element:function(b){if(b=
this.get_backside&&this.get_backside(b))return b.get_element()},add_to_json:function(e,c){var a,h,m,l,d,k;if(e){e.view?(h=e,a=e.view,e=e.semantic):(a={},h={semantic:e,view:a});h.version=1;this.get_erased&&this.get_erased()&&(e.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(e.infinite_stack=!0);this.get_open_backside_only_if_stopped&&this.get_open_backside_only_if_stopped()&&(e.open_backside_only_if_stopped=!0);this.get_running&&this.get_running()&&(e.running=!0);d=this.get_parent_widget_of_frontside();
if(!d||this.parent_of_frontside_is_backside()||d.is_element())if(l=this.get_frontside_element&&this.get_frontside_element())if(k=$(l).width(),$(l).is(".toontalk-plain-text-element")||0===k||(a.frontside_width=$(l).width(),a.frontside_height=$(l).height()),0!==k&&(a.frontside_left=b.UTILITIES.get_style_numeric_property(l,"left"),a.frontside_top=b.UTILITIES.get_style_numeric_property(l,"top")||m&&m.frontside_top,void 0===a.frontside_left&&(m=d&&d.get_widget().get_backside_widgets_json_views())))l=this.get_parent_of_frontside().get_widget().get_backside_widgets().indexOf(this),
0<=l&&(a.frontside_left=m[l].frontside_left,a.frontside_top=m[l].frontside_top);if(l=this.get_backside()){if(d=l.get_element()){if(l.get_backside_dimensions()||l.is_top_level())a.backside_width=$(d).width(),a.backside_height=$(d).height();a.backside_left||(m=$(d).position(),a.backside_left=m.left,a.backside_top=m.top,"&lt;"===$(d).find(".toontalk-settings-backside-button").html()&&(a.advanced_settings_open=!0))}l.get_backside_dimensions()&&(a.backside_geometry=l.get_backside_dimensions())}!a.backside_geometry&&
this.backside_geometry&&(a.backside_geometry=this.backside_geometry);e.description=this.get_description&&this.get_description();a.saved_width=this.saved_width;a.saved_height=this.saved_height;return h}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(e,c,a,h){var m=this.get_backside_widgets(),l,d;0<m.length?(e.semantic.backside_widgets=[],(l=this.get_backside_widgets_json_views())&&l.forEach(function(a,b){var g;if(d=e.semantic.backside_widgets[b]){if(0<=d.widget.shared_widget_index){g=
c.widgets_encountered.indexOf(c.shared_widgets[d.widget.shared_widget_index]);if(!c.json_of_widgets_encountered[g])return;g=c.json_of_widgets_encountered[g].view}else g=d.widget.view;d.is_backside?a.backside_left&&(g.backside_left=a.backside_left,g.backside_top=a.backside_top):a.frontside_left&&(g.frontside_left=a.frontside_left,g.frontside_top=a.frontside_top)}}),b.UTILITIES.get_json_of_array(m,e.semantic.backside_widgets,0,c,a,h)):a()},has_backside_widgets:function(e){var c=[];e.get_backside_widgets=
function(){return c};e.add_backside_widget=function(a){var e;if(a){e=this.get_backside(!0);if(b.debugging){if(a===this){b.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");return}if(a.get_widget()===this){b.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}c?0>c.indexOf(a)&&c.push(a):c=[a];b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Added "+a+" to backside widgets of "+this+". Number of backside widgets is "+
c.length);a.is_backside()?a.set_parent_of_backside(e,!0):a.set_parent_of_frontside(this,!0);e.visible()&&a.set_visible(!0)}else b.debugging&&b.UTILITIES.report_internal_error("adding undefined to backside widgets.")};e.remove_all_backside_widgets=function(){c&&c.slice().forEach(function(a){a.remove()})};e.remove_backside_widget=function(a,e){var m=c.indexOf(a);0>m?e||b.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+a.get_widget()+" ("+a.get_widget()._debug_id+
")"):(c.splice(m,1),b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Removed "+a+" from backside widgets of "+this+". Number of backside widgets is "+c.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(m,1),a.is_backside()?(m=a.get_parent())&&m.get_widget()===this&&a.set_parent_of_backside(void 0,!0,!0):(m=a.get_parent_of_frontside())&&m.get_widget()===this&&a.set_parent_of_frontside(void 0,void 0,!0),a.set_visible(!1))};e.set_backside_widgets=function(a,
b){var e=this.get_backside(),l=e&&e.visible();c=a;0<c.length&&(e?e.add_backside_widgets(c,b):this.backside_widgets_json_views=b,c.forEach(function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),l&&a.set_visible(l))}.bind(this)))}},get_backside_widgets_json_views:function(b){!this.backside_widgets_json_views&&b&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var b=!1,c;this.get_backside_widgets().some(function(a){if(!a)return!1;
c=a.get_widget();if(c.get_body&&!c.get_body().is_empty()||c.can_run())return b=!0});return b},add_to_copy:function(e,c){var a;this.get_erased&&this.get_erased()&&(e.set_erased||b.widget.erasable(e),e.set_erased(this.get_erased()));c&&c.just_value||(a=this.get_backside_widgets(),0<a.length&&e.set_backside_widgets(b.UTILITIES.copy_widget_sides(a,c),this.get_backside_widgets_json_views()));e.set_running(this.get_running());return e},get_type_name:function(){return""},copy:function(){console.assert(!1,
"copy not implemented")},add_copy_to_container:function(e,c,a){var h=this.visible(),m,l,d,k,q;e||(e=this.copy({}));m=this.get_frontside_element(h);l=e.get_frontside_element(h);d=$(m).closest(".toontalk-backside");k=e.ok_to_set_dimensions();0===d.length&&(d=$(this.top_level_widget().get_backside_element()));q=b.UTILITIES.widget_side_of_jquery(d);h&&("undefined"===typeof c&&(c=30),"undefined"===typeof a&&(a=30),h=b.UTILITIES.relative_position(m,d.get(0)),0<d.length&&d.get(0).appendChild(l),b.UTILITIES.set_css(l,
{width:k?$(m).width():"",height:k?$(m).height():"",left:h.left+c,top:h.top+a,"z-index":b.UTILITIES.next_z_index()}));q&&q.add_backside_widget(e);return e},visible:function(){var b;if(!document.hidden)return(b=this.get_frontside())?b.visible():!1},set_visible:function(b){var c=this.get_frontside(b);c&&c.set_visible(b)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(b){this.set_parent_of_frontside(b)},drag_started:function(b,c){this.robot_in_training()&&
this.robot_in_training().picked_up(this,b,c)},match:function(b){console.assert(!1,"match not implemented for "+b.toString())},removed:function(e){b.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(e){var c=this.get_backside(),a,h,m,l,d,k,q,g,n,r,v;if(c&&b.UTILITIES.visible_element(c.get_element()))$(c.get_element()).css({opacity:1}),e&&e();else{a=e&&function(){setTimeout(e)};h=function(c,d){b.UTILITIES.set_timeout(function(){$(c).addClass("toontalk-side-appearing");
b.UTILITIES.add_one_shot_event_handler(c,"transitionend",2500,function(){$(c).removeClass("toontalk-side-appearing");a&&a()});$(c).css({left:q,top:g,opacity:d});this.apply_backside_geometry()}.bind(this))}.bind(this);l=this.get_frontside_element();d=$(l).parent();for(c=$(l);0<d.length&&!d.is(".toontalk-backside");)c=d,d=d.parent();c.get(0);c=this.get_backside(!0);m=c.get_element();m.toontalk_widget_side=c;n=$(l).offset();r=d.offset();v=d.width();r||(r={left:0,top:0});$(m).css({left:n.left-r.left,
top:n.top-r.top,opacity:.01});0<d.length?d.get(0).appendChild(m):($(m).css({textAlign:"left"}),l.appendChild(m));(d=b.UTILITIES.widget_side_of_jquery(d))&&d.add_backside_widget(c);d=this.is_element()?this.get_attribute("height"):$(l).height();l=$(m).width();q=n.left-r.left;q+l>v&&(q=Math.max(0,v-l));g=n.top-r.top+d+34;this.is_box()&&(g+=28);h(m,"inherit");c.set_visible(!0);k=this.get_backside_widgets();0<k.length&&k.forEach(function(a){a.is_backside()&&0<=k.indexOf(a.get_widget())?a.hide_backside():
(a.set_visible(!0),m.appendChild(a.get_element(!0)))}.bind(this));return c}},hide_backside:function(){var b=this.get_backside();b&&b.hide_backside()},apply_backside_geometry:function(){var b=this.get_backside(!0),c=b.get_element();this.backside_geometry&&c&&(b.scale_backside(c,this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),b.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},
robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(b){this.top_level_widget().robot_started_training(b)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},backup_all:function(b){var c=this.top_level_widget();c&&c.save(b)},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},
location_constrained_by_container:function(){if(this.is_nest())return!1;var b=this.get_parent_of_frontside();return b&&(b.is_hole()||b.is_nest()||b.is_robot())?!0:!1},close_button_ok:function(b){return"top-level"!==this.get_type_name()&&!$(b).is(".toontalk-top-level-resource")&&!$(b).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(b,c){var a=this.top_level_widget(),h;b||(b=this);h=b.get_element(!0);a.add_backside_widget(b);a.get_backside_element().appendChild(h);
b.render();c&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,a);return h},get_selection:function(){return this},create_top_level_widget:function(e){var c=Object.create(b.widget),a=[],h=function(){return!1},m=!1;e||(e={});c.is_top_level=function(){return!0};c.is_number=h;c.is_box=h;c.is_empty_hole=h;c.is_scale=h;c.is_bird=h;c.is_nest=h;c.is_robot=h;c.is_element=h;c.is_sensor=h;c.is_function_nest=h;c.is_hole=h;c.is_plain_text_element=h;c.is_attribute_widget=h;c.ok_to_set_dimensions=
h;c.get_json=function(a,b,c){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");b({semantic:{type:"top_level",settings:e},view:{background_color:a}},c)};c.get_type_name=function(){return"top-level"};c.is_of_type=function(a){return"top-level"===a};c.toString=function(){return"top level widget"};c.get_description=function(){};c.match=function(){return"matched"};c.update_display=function(){this.get_backside_widgets()&&this.get_backside_widgets().forEach(function(a){a&&
a.visible()&&a.render()})};c.copy=function(){return this};c.visible=function(){return!0};c.get_parent_of_frontside=function(){};c.get_parent_of_backside=function(){};c.closest_visible_ancestor=function(){return this};c.get_infinite_stack=function(){return!1};c.top_level_widget=function(){return this};if(b.debugging||b.logging)c.to_debug_string=function(){var a=$(this.get_backside_element()).offset();return"top-level widget at "+Math.round(a.left)+", "+Math.round(a.top)};c.add_sides_functionality(c);
c.runnable(c);c.has_parent(c);c.has_backside_widgets(c);c.removed_from_container=function(a,b){this.robot_in_training()||this.remove_backside_widget(a,!0)};c.widget_side_dropped_on_me=function(a,b,c,e){return this.get_backside().widget_side_dropped_on_me(a,b,c,e)};c.get_element=function(){return this.get_backside().get_element()};c.get_setting=function(a,c){"undefined"!==typeof e[a]||c||(e[a]=b.DEFAULT_SETTINGS&&b.DEFAULT_SETTINGS[a]);return e[a]};c.set_setting=function(a,b){e[a]=b};c.open_settings=
function(){b.SETTINGS.open(c)};c.robot_in_training=function(){if(0<a.length)return a[a.length-1]};c.robot_training_this_robot=function(){if(1<a.length)return a[a.length-2]};c.robot_started_training=function(b){a.push(b)};c.robot_finished_training=function(){a.pop()};c.save=function(a,c,e){var h=this.get_setting("program_name",!0),g=function(a){m=!1;n&&(k=b.google_drive.get_status(),"Ready"===k?(b.google_drive.upload_file(h,"json",JSON.stringify(a,b.UTILITIES.clean_JSON),e),e=void 0):b.google_drive.connection_to_google_drive_possible()&&
("Need to authorize"===k?(b.UTILITIES.display_message_if_new("Unable to save to your Google Drive because you need to log in. Click on the settings icon "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-settings-icon'></span>")+" to log in."),b.UTILITIES.display_tooltip($(".toontalk-settings-button"))):console.log("Unable to save to Google Drive because: "+k)));c.local_storage&&this.save_to_local_storage(a);e&&e()}.bind(this),n,k;!m&&h&&(c||(c={}),"undefined"===typeof c.google_drive&&(c.google_drive=
b.google_drive&&this.get_setting("auto_save_to_google_drive")),"undefined"===typeof c.local_storage&&(c.local_storage=this.get_setting("auto_save_to_local_storage")),a?(n=c.google_drive&&!this.get_setting("google_drive_unavailable"))||c.local_storage?(m=!0,b.UTILITIES.get_json_top_level(this,g,250)):e&&e():setTimeout(function(){this.save(!0,c,e)}.bind(this),100))};c.publish=function(a,c){b.publish.publish_widget(this.get_setting("program_name"),this,c,a)};c.save_to_local_storage=function(a,c){var e=
this.get_setting("program_name"),h=b.UTILITIES.local_storage_program_key(e),g=b.UTILITIES.local_storage_program_meta_data_key(e),m,k,v;c||(c=Date.now());try{k=(k=window.localStorage.getItem(g))?JSON.parse(k):{created:c},k.last_modified=c,v=JSON.stringify(a,b.UTILITIES.clean_json),k.file_size=v.length,window.localStorage.setItem(g,JSON.stringify(k)),window.localStorage.setItem(h,v),window.localStorage.setItem("toontalk-last-key",h),m=b.UTILITIES.get_all_locally_stored_program_names(),0>m.indexOf(e)&&
(m.push(e),b.UTILITIES.set_all_locally_stored_program_names(m))}catch(f){e=v?"Failed to save state to local storage since it requires "+v.length+" bytes. Error message is "+f:"Error while saving to local storage. Error message is "+f,b.UTILITIES.is_internet_explorer()?console.error("Unresolved difficulties using window.localStorage in IE11: "+e):b.UTILITIES.display_message(e),this.last_local_storage_error=e}};c.load=function(a,d,e){var h=this.get_setting("program_name"),g=h+".json",m=b.UTILITIES.local_storage_program_key(h),
k=function(a){var g;if(a)try{g=JSON.parse(a),c.remove_all_backside_widgets(),b.UTILITIES.add_backside_widgets_from_json(c,g.semantic.backside_widgets,{json_of_shared_widgets:g.shared_widgets,shared_widgets:[],shared_html:g.shared_html}),d&&d()}catch(l){b.UTILITIES.display_message("Error encountered loading "+h+" : "+l)}else e&&e()},v=function(a){a?b.google_drive.download_file(a,k):k(window.localStorage.getItem(m))};a&&b.google_drive&&"Ready"===b.google_drive.get_status()?b.google_drive.get_toontalk_program_file(g,
v):k(window.localStorage.getItem(m))};c.walk_children=function(){};c.render=function(){};c.location_constrained_by_container=function(){return!1};c.is_widget=!0;b.debugging&&(c._debug_id=b.UTILITIES.generate_unique_id(),c._debug_string="Top-level widget");c.get_backside(!0).set_visible(!0);return c}}}(window.TOONTALK);window.TOONTALK.backside=function(b){var k=function(e){var c=e.get_widget(),a=c.get_backside_widgets(),h=c.get_backside_widgets_json_views(!0);e.get_backside_dimensions();var m=e.get_element();a.forEach(function(a,c){var e=a.get_element(),q;e&&(h[c]||(h[c]={}),a.start_offset&&e.parentElement?(q=b.UTILITIES.relative_position_from_absolute_position(e.parentElement,a.start_offset),a.start_offset=void 0):q=$(e).position(),a.is_backside()?(h[c].backside_left=b.UTILITIES.left_as_percent(q.left,e),h[c].backside_top=
b.UTILITIES.top_as_percent(q.top,e),k(a)):(h[c].frontside_left=b.UTILITIES.left_as_percent(q.left,e,m),h[c].frontside_top=b.UTILITIES.top_as_percent(q.top,e,m)))})};return{create:function(e){var c=Object.create(this),a=document.createElement("div"),h=$(a),m=1,l=1,d=document.createElement("div"),k=document.createElement("div"),q=e.get_help_URL&&e.get_help_URL(),g,n,r,v,f,w,y,E,N,D,J,G,C,I,L,H,M=function(a){a?($(d).addClass("toontalk-green-flag-active").removeClass("toontalk-green-flag-inactive"),$(k).addClass("toontalk-stop-sign-inactive").removeClass("toontalk-stop-sign-active")):
($(d).addClass("toontalk-green-flag-inactive").removeClass("toontalk-green-flag-active"),$(k).addClass("toontalk-stop-sign-active").removeClass("toontalk-stop-sign-inactive"))};C=this.create_description_label(c,e);var O=function(){var a;a=e.get_running()?"To stop this click on the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):e.can_run()?"Click this to start this running.":"There is nothing to run on this.";b.UTILITIES.give_tooltip(d,a)},R=function(){var a;
a=e.get_running()?"Click to stop this from running.":e.can_run()?"This has stopped. Click on the flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";b.UTILITIES.give_tooltip(k,a)},p=function(a){X?(L=document.createElement("iframe"),$(L).addClass("toontalk-help-frame"),L.src=q,document.body.appendChild(H),document.body.appendChild(L),a.stopPropagation()):(I.href=q,I.target="_blank")},u,A,F,P,X,z;b.TRANSLATION_ENABLED&&
(q=b.UTILITIES.add_URL_parameter(q,"translate","1"));e.close_button_ok(a)&&(A=function(d){var f=function(){e.robot_in_training()&&e.robot_in_training()!==e&&e.robot_in_training().backside_closed(c);c.is_primary_backside()?c.hide_backside(d):c.remove()},g,p;e.get_running()?(g=e.get_backside_widgets(),g.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(f),p=a,!0}),p?(p.add_body_finished_listener(function(){p.visible()?h.css({opacity:1}):(e.forget_backside(),b.DEFAULT_QUEUE.start());
f()}),c.set_visible(!1)):f(),h.css({opacity:1}),h.addClass("toontalk-animating-element"),h.css({opacity:0}),b.UTILITIES.add_one_shot_event_handler(a,"transitionend",2E3,function(){e.forget_backside()})):f();d.stopPropagation()},u=(u=e.get_description())?"the "+e.get_type_name()+" who "+u:"the "+e.get_type_name(),G=b.UTILITIES.create_close_button(A,"Click to remove this backside of "+u+"."),a.appendChild(G));$(d).addClass("toontalk-green-flag toontalk-green-flag-inactive");d.addEventListener("click",
function(a){e.can_run()?(M(!0),e.set_running(!0),R(),b.DEFAULT_QUEUE.start()):e.is_top_level()?b.UTILITIES.display_message("There is nothing to run."):b.UTILITIES.display_message("This "+e.get_type_name()+" has nothing to run. Add some robots on the back.");e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-green-flag",e);a.stopPropagation()});d.addEventListener("mouseenter",R);$(k).addClass("toontalk-stop-sign toontalk-stop-sign-active");k.addEventListener("click",function(a){M(!1);
e.set_running(!1);O();e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-stop-sign",e);a.stopPropagation();e.is_top_level()&&b.UTILITIES.stop_audio_objects()});k.addEventListener("mouseenter",O);a.appendChild(d);a.appendChild(k);b.UTILITIES.use_custom_tooltip(d);b.UTILITIES.use_custom_tooltip(k);b.UTILITIES.when_attached(a,function(){e.is_robot()?a.title="On the back of the robot you can change the conditions and setting of the robot.":(z=e.toString({inside_tool_tip:!0}),a.title=
"The back of "+z+" You can put robots on the back to make it come 'alive'.");b.UTILITIES.use_custom_tooltip(a)});q&&(X=0>q.indexOf("://"),I=document.createElement(X?"div":"a"),$(I).addClass("toontalk-help-button notranslate toontalk-widget-help-button"),I.addEventListener("click",p),I.innerHTML="i",I.translate=!1,b.UTILITIES.give_tooltip(I,"Click to learn more about "+e.get_type_name(!0,!0)+"."),H=document.createElement("div"),$(H).addClass("toontalk-close-help-frame-button").button(),H.addEventListener("click",
function(a){$(L).remove();$(H).remove();a.stopPropagation()}),H.innerHTML="Return to ToonTalk",a.appendChild(I));C&&a.appendChild(C);e.is_top_level()&&(v=document.createElement("div"),$(v).addClass("toontalk-settings-button"),v.addEventListener("click",function(a){e.open_settings();a.stopPropagation()}),a.appendChild(v),b.UTILITIES.give_tooltip(v,"Click to change settings or open a different program."));h.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+e.get_type_name());h.css({"z-index":b.UTILITIES.next_z_index()});
c.get_element=function(){return a};c.get_backside_element=function(){return a};c.get_widget=function(){return e};c.visible=function(){return f};c.set_visible=function(a){f=a;!e.is_top_level()&&this.is_primary_backside()&&(this.get_widget().get_backside_widgets().forEach(function(b){b&&b!==this&&b.set_visible(a)}.bind(this)),f&&this.render())};c.get_erased=function(){return g};c.set_erased=function(a,b){g=a;b&&this.rerender()};e.get_backside||(e.get_backside=function(){return c});c.is_primary_backside=
function(){return this===this.get_widget().get_backside()};c.get_width=function(){return $(this.get_element()).width()};c.get_height=function(){return $(this.get_element()).height()};c.is_widget=!0;c.get_parent_of_backside=function(){return this.is_primary_backside()?e.get_parent_of_backside():r&&n?n.get_backside(!0):n};c.set_parent_of_backside=function(a,b){!a&&n&&r&&n.remove_backside_widget(this,!0);this.is_primary_backside()&&e.set_parent_of_backside(a,b);n=a;r=b};c.get_parent_of_frontside=function(){return e.get_parent_of_frontside()};
c.is_parent_backside=function(){return e.is_parent_backside()};c.get_frontside=function(a){return e.get_frontside(a)};c.get_frontside_element=function(a){return e.get_frontside_element(a)};c.get_description_text_area=function(){return F};c.set_description_text_area=function(a){F=a};c.get_name_text_input=function(){return P};c.set_name_text_input=function(a){P=a};c.removed_from_container=function(a,b,d,e){c.get_widget().robot_in_training()||this.remove_backside_widget(a,e)};c.drop_on=function(a,b,
c){return a.widget_side_dropped_on_me(this,b,c)};c.widget_side_dropped_on_me=function(c,d,f,g){var h,p,l;if(!f||f.visible()||this.visible())return this.visible()&&(b.sounds&&d&&b.sounds.drop.play(),h=c.get_element(this.visible()),c.rerender(),d?(a.appendChild(h),b.UTILITIES.set_position_is_absolute(h,!0,d)):(f&&(l=$(f.get_frontside_element()).offset()),l||(l=$(h).offset()),a.appendChild(h),!l||0===l.left&&0===l.top||b.UTILITIES.set_absolute_position(h,l))),this.get_widget().is_top_level()&&(f&&!f.visible()&&
$(h).addClass("toontalk-widget-added-to-backside-by-unwatched-robot"),!d||c.is_backside()||c.is_sensor()||window.dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:h,here:"back"}))),e.robot_in_training()&&!g&&d&&setTimeout(function(){e.robot_in_training().dropped_on(c,this,d)}.bind(this)),c.is_backside()&&c.get_widget().is_element()&&e.is_element()&&(g=c.get_widget(),g.set_backside(void 0),g.remove(d),g.set_backside(c)),this.add_backside_widget(c),c.dropped_on_other&&c.dropped_on_other(this,
d,f),d&&c.get_body&&c.get_body().is_empty()&&!c.being_trained?setTimeout(function(){(p=c.open_backside())&&$(p.get_element()).find(".toontalk-train-backside-button").click()}):d&&!c.is_backside()&&this.get_frontside_element()&&!c.is_sensor()&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:h,where:"back"})),d&&c.get_widget().backup_all(),!c.is_backside()&&c.is_robot()&&this.get_widget().get_running()&&!this.is_top_level()&&this.get_widget().set_running(!0),
!0;this.add_backside_widget(c);c.dropped_on_other&&c.dropped_on_other(this,d,f)};c.add_backside_widget=function(a){return this.get_widget().add_backside_widget(a)};c.add_backside_widgets=function(a,c){var d;0!==a.length&&(d=a.slice(),b.UTILITIES.set_timeout(function(){var f=this.visible(),g=this.get_element(),h,p,l,m;d.forEach(function(d,n){d&&(b.debugging&&d.get_widget()===e?(b.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),a.splice(n,1)):(c&&(l=c[n]),h=d.get_element(!0),
h.parentElement||g.appendChild(h),h.toontalk_widget_side=d,l&&(d.is_backside()?(p=d.get_widget().get_backside(!0),m={left:l.backside_left,top:l.backside_top,width:l.backside_width,height:l.backside_height},d.get_widget().apply_backside_geometry(),l.advanced_settings_open&&p.set_advanced_settings_showing(!0,p.get_element())):(0===l.frontside_width&&(l.frontside_width=""),0===l.frontside_height&&(l.frontside_height=""),m={left:l.frontside_left,top:l.frontside_top,width:h.style.transform?"":l.frontside_width||
l.saved_width,height:h.style.transform?"":l.frontside_height||l.saved_height}),b.UTILITIES.constrain_css_to_fit_inside(g,m),$(h).css(m)),d.set_visible(f),d.get_widget().rerender()))})}.bind(this),100))};c.get_backside_dimensions=function(){if(1!==m||1!==l)return{x_scale:m,y_scale:l,original_width:w,original_height:y}};c.set_dimensions=function(a){m=a.x_scale;l=a.y_scale;w=a.original_width;y=a.original_height};c.scale_to_fit=function(a,c){var d;!w&&this.get_widget().backside_geometry&&(w=this.get_widget().backside_geometry.original_width,
y=this.get_widget().backside_geometry.original_height);d=b.UTILITIES.scale_to_fit(a,c,w,y);m=d.x_scale;l=d.y_scale};c.scale_to=function(a,c){var d;!w&&this.get_widget().backside_geometry&&(w=this.get_widget().backside_geometry.original_width,y=this.get_widget().backside_geometry.original_height);d=b.UTILITIES.scale_element(this.get_element(!0),a,c,w,y);m=d.x_scale;l=d.y_scale};c.get_original_width=function(){return w};c.get_original_height=function(){return y};c.run_status_changed=function(a){M(a)};
b.UTILITIES.when_attached(a,function(){var a,c,e,f;h.width();h.height();a=$(k).width();c=(c=$(G).width())?c+14:0;$(k).css({right:c});$(d).css({right:c+a+6});e=$(d).width();I&&($(I).css({right:c+a+e+12}),b.UTILITIES.use_custom_tooltip(I));v&&(f=$(I).width()||0,$(v).css({right:c+a+e+f+12}));G&&b.UTILITIES.use_custom_tooltip(G)});c.save_dimensions=function(){E=m;N=l;return!0};c.restore_dimensions=function(){this.get_element();E&&(m=E);N&&(l=N);this.render_current_scale()};c.render_current_scale=function(){this.scale_backside(a,
m,l,w,y);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();$(a).find("[title]").each(function(a,c){b.UTILITIES.use_custom_tooltip(c)})};c.compare_with=function(a){return this.get_widget().compare_with&&this.get_widget().compare_with(a)};if(b.debugging||b.logging)c.to_debug_string=function(){return"backside of "+this.get_widget().to_debug_string()};a.toontalk_widget_side=c;b.UTILITIES.drag_and_drop(a);h.resizable({start:function(){D=h.width();J=h.height();w||(w=D);y||
(y=J)},resize:function(a,b){var d=b.size.width,e=b.size.height;h.is(".toontalk-top-level-backside")||(m*=d/D,l*=e/J,D=d,J=e,c.render_current_scale())},handles:"e,s,se"});a.addEventListener("mouseenter",function(a){a=e.get_frontside();var c=e.get_parent_of_backside();!a||c&&!c.get_widget().is_top_level()||b.UTILITIES.highlight_element(a.get_element())});a.addEventListener("mouseleave",function(a){e.is_top_level()||b.UTILITIES.remove_highlight()});c.update_display=function(){var b=this.get_description_text_area(),
d=this.get_name_text_input(),e;b&&(e=this.get_widget().get_description())&&(b.button.value=e);d&&(d.button.value=this.get_widget().get_name());this.get_erased()?$(a).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():$(a).find().show();c.display_updated()};c.display_updated=function(){var a=$(this.get_element());w||(w=a.width());y||(y=a.height())};c.add_to_top_level_backside=function(a,b){return this.get_widget().add_to_top_level_backside(a,
b)};e.get_backside_widgets&&(C=e.get_backside_widgets(),c.add_backside_widgets(C,e.get_backside_widgets_json_views()));b.debugging&&(a.id=e._debug_id,c._debug_id=e._debug_id,c._debug_string="backside of "+e._debug_string);return c},toString:function(){return"backside of "+this.get_widget()},get_full_description:function(b){return"backside of "+this.get_widget().get_full_description(b)},remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(e,c){var a=b.UTILITIES.create_check_box(c.get_infinite_stack(),
"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+c.get_type_name()+" to be copied instead of moved.");a.button.addEventListener("click",function(b){var e=a.button.checked,l;c.set_infinite_stack(e);c.robot_in_training()&&(l=e?"change dragging to make a copy of ":"change dragging back to moving for ",c.robot_in_training().edited(c,{setter_name:"set_infinite_stack",argument_1:e,toString:l,button_selector:".toontalk-infinite-stack-check-box"}));b.stopPropagation()});
return a},create_parent_selection_check_box:function(e,c){var a=function(){var a=c.get_parent();if(a&&(a.is_nest()||a.is_hole()||a.is_element()))return a.is_hole()?a.get_parent_of_frontside():a},h=a(),m=function(a){return"Drag the "+a.get_type_name()+" I'm on when dragging"},l=function(a){return"Check this if you want to drag the "+a.get_type_name()+" when you move this widget."},d,k;if(h){d=b.UTILITIES.create_check_box(c.get_infinite_stack(),"toontalk-parent-selection-check-box",m(h),l(h));var q=
function(b){var c=a();c?(c!==b&&g(c),d.button.disabled=!1,$(d.label).removeClass("ui-state-disabled"),d.container.title=l(c)):r()},g=function(a){d.label.innerHTML=m(a);d.button.innerHTML=l(a)},n=function(){q();return c},r=function(){d.button.checked=!1;d.button.disabled=!0;$(d.label).addClass("ui-state-disabled");d.container.title="Widget moved so this has been disabled. Close and re-open the backside to refresh."};k=function(b){var e=a();a()?(e!==h&&g(e),c.get_selection=d.button.checked?function(){var b=
a();q();return b?b.get_selection():c}:n,b.stopPropagation()):r()};d.button.checked=c!==c.get_selection();d.button.checked||(c.get_selection=n);d.button.addEventListener("click",k);return d}},create_click_opens_backside_check_box:function(e,c){var a=b.UTILITIES.create_check_box(c.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box","Mouse click opens this backside only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors.");
a.button.addEventListener("click",function(b){var e=a.button.checked,l;c.set_open_backside_only_if_stopped(e);c.robot_in_training()&&(l=e?"change the response to a mouse click to open only if stopped the backside of ":"change the response to a mouse click to always open the backside of ",c.robot_in_training().edited(c,{setter_name:"set_open_backside_only_if_stopped",argument_1:e,toString:l,button_selector:".toontalk-click-opens-backside-check-box"}));b.stopPropagation()});return a},create_description_label:function(e,
c){var a=c.get_description();if(a)return b.UTILITIES.create_text_element("I'm the backside of a "+c.get_type_name()+" that is "+a)},add_description_setting:function(e){var c=this.get_widget(),a=c.get_type_name(),h=b.UTILITIES.create_text_area(c.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+a+".",function(a){(a=b.UTILITIES.input_area_drop_handler(a,c.receive_description_from_dropped.bind(c),c))&&c.robot_in_training()&&c.robot_in_training().dropped_on_text_area(a,
c,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})}),m=function(){var b=h.button.value.trim();c.set_description(b,!0)&&c.robot_in_training()&&c.robot_in_training().edited(c,{setter_name:"set_description",argument_1:b,toString:"change the description to '"+b+"'' of the "+a,button_selector:".toontalk-description-input"})};$(h.button).val(c.get_description());h.button.addEventListener("change",m);h.button.addEventListener("mouseout",
m);this.set_description_text_area(h);(e||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(h.container));c.get_description()||h.button.setAttribute("placeholder",c.get_default_description())},add_name_setting:function(e){var c=this.get_widget(),a=c.get_type_name(),h=b.UTILITIES.create_text_input(c.get_name(),"toontalk-name-input",c.get_name_input_label?c.get_name_input_label():"My name is ",c.get_name_input_title?c.get_name_input_title():"Edit the name of this "+a+". There is not much room so keep it short.",
void 0,"text",function(a){(a=c.receive_name_from_dropped&&b.UTILITIES.input_area_drop_handler(a,c.receive_name_from_dropped.bind(c),c))&&c.robot_in_training()&&c.robot_in_training().dropped_on_text_area(a,c,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})}),m=function(){var b=h.button.value.trim();c.set_name&&c.set_name(b,!0)&&c.robot_in_training()&&c.robot_in_training().edited(c,{setter_name:"set_name",argument_1:b,toString:"change the name to '"+
b+"'' of the "+a,button_selector:".toontalk-name-input"})};h.button.addEventListener("change",m);h.button.addEventListener("mouseout",m);this.set_name_text_input(h);(e||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(h.container))},add_advanced_settings:function(){var e=this.get_widget(),c=this.create_infinite_stack_check_box(this,e),a=this.create_parent_selection_check_box(this,e),h=this.create_click_opens_backside_check_box(this,e),m=e.get_type_name(),l=$("<button>Make a sensor nest</button>").button(),
d=$("<button>Make a function bird</button>").button(),k=document.createElement("table"),q=this.get_element(),g=function(a,c){var d=e.get_parent_of_frontside(),g=a.get_frontside_element(!0),h;d&&d.add_backside_widget&&!d.get_widget().is_top_level()?(d.add_backside_widget(a),h=d.get_element(),h.appendChild(g),d=$(h).offset(),d.top+=.6*$(h).height()):(e.add_to_top_level_backside(a,!1),d=c.offset(),d.left-=120,0>d.left&&(d.left=0));b.UTILITIES.set_absolute_position(g,d)};$(q).find(".toontalk-settings-backside-button").get(0);
var n;$(k).addClass("toontalk-advanced-settings-table");l.addClass("toontalk-make-sensor_nest_button");l.get(0).addEventListener("click",function(a){var c=b.sensor.create("click","which",void 0,void 0,!0,e);g(c,l);e.robot_in_training()&&e.robot_in_training().created_widget(c,e,".toontalk-make-sensor_nest_button");a.stopPropagation()});l.attr("title","Click to create a nest which receives messages when events happen to this "+e.get_type_name()+".");d.addClass("toontalk-make-function_bird_button");
d.get(0).addEventListener("click",function(a){var c=e.get_function_type&&e.get_function_type(),c=b.bird.create_function(c||m);g(c,d);e.robot_in_training()&&e.robot_in_training().created_widget(c,e,".toontalk-make-function_bird_button");a.stopPropagation()});e.is_number()||e.is_box()||e.is_element()?d.attr("title","Click to get a bird that flies to functions of "+e.get_type_name(!0)+"."):(d.attr("title","There are no functions that operate on "+e.get_type_name(!0)+" (yet)."),d.button("option","disabled",
!0));if(0<arguments.length)for(n=0;n<arguments.length;n++)k.appendChild(arguments[n]);this.get_description_text_area()||this.add_description_setting(k);e.set_name&&!this.get_name_text_input()&&this.add_name_setting(k);k.appendChild(b.UTILITIES.create_row(l.get(0),d.get(0),c.container,a&&a.container,h.container));this.is_primary_backside()||(c=$("<button>Remove me and my widget</button>").button(),c.get(0).addEventListener("click",function(){e.robot_in_training()&&(e.robot_in_training().removed(e),
e.robot_in_training().removed(this));this.remove();e.remove()}.bind(this)),c.attr("title","Click to remove this "+e.get_type_name()+" and its backside."),c.addClass("toontalk-remove-backside-and-widget-buttton"),b.UTILITIES.use_custom_tooltip(c.get(0)),k.appendChild(c.get(0)));b.UTILITIES.use_custom_tooltip(l.get(0));b.UTILITIES.use_custom_tooltip(d.get(0));q.appendChild(k)},get_type_name:function(){return"backside of "+b.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(e){var c,
a,h,m,l,d,t;if(this.visible()&&(c=this.get_widget(),a=c.robot_in_training(),m=$(this.get_element()),a&&a.get_training_context()===c&&(a.hide_backside(),m.find(".toontalk-train-backside-button").click()),h=c.get_frontside_element(e&&c.get_parent_of_frontside()&&c.get_parent_of_frontside().is_top_level()),a=m.position(),l=m.parent().closest(".toontalk-backside"),d=function(a){var d=$(h).position(),l=function(){t&&(this.set_parent_of_backside(void 0,!0),t.is_backside()||t.removed_from_container(this,
e,void 0,!0),c.forget_backside&&c.forget_backside());a.remove()}.bind(this);b.UTILITIES.visible_element(a)?"0"===a.css("opacity")?(a.removeClass("toontalk-animating-element"),a.remove()):(a.addClass("toontalk-side-appearing"),b.UTILITIES.add_one_shot_event_handler(a.get(0),"transitionend",2500,l),b.UTILITIES.set_css(a,{left:d&&d.left,top:d&&d.top,opacity:.1})):l()}.bind(this),t=c.get_parent_of_backside(),b.UTILITIES.remove_highlight(),k(this),c.backside_geometry=this.get_backside_dimensions(),d(m),
this.set_visible(!1),e&&h&&!b.UTILITIES.visible_element(h)&&(a&&b.UTILITIES.set_css(h,{left:a.left,top:a.top}),!(m=b.UTILITIES.widget_side_of_jquery(l))||c.is_robot()&&m.get_widget().is_robot()&&c.get_first_in_team()===m.get_widget().get_first_in_team()||(m.widget_side_dropped_on_me(c),c.render())),c.get_backside_widgets()&&c.get_backside_widgets().forEach(function(a){a.set_visible(!1)}),c.on_backside_hidden))c.on_backside_hidden()},create_advanced_settings_button:function(e,c){var a=document.createElement("div"),
h=$(a),m=!1;a.innerHTML="&gt;";h.addClass("toontalk-settings-backside-button");h.css({"z-index":b.UTILITIES.next_z_index()});h.get(0).addEventListener("click",function(a){m=!m;e.set_advanced_settings_showing(m,e.get_element(),h);a.stopPropagation();c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-settings-backside-button",c)});b.UTILITIES.give_tooltip(h.get(0),"Click to see the advanced settings of this "+c.get_type_name()+".");return h.get(0)},set_advanced_settings_showing:function(e){var c=
this.get_element(),a=$(c).children(".toontalk-settings-backside-button"),h=$(c).children(".toontalk-advanced-settings-table");0===h.length&&this.add_advanced_settings&&(this.add_advanced_settings(),h=$(c).children(".toontalk-advanced-settings-table"));e?(h.show(),a.html("<"),b.UTILITIES.give_tooltip(a.get(0),"Click to hide the advanced settings.")):(h.hide(),a.html(">"),b.UTILITIES.give_tooltip(a.get(0),"Click to show the advanced settings."))},scale_backside:function(e,c,a,h,m){var l=Math.min(1,
c,a);1===c&&1===a?!this.get_parent()||this.get_parent().is_backside()?b.UTILITIES.set_css(e,{width:h,height:m,transform:"","transform-origin":""}):b.UTILITIES.set_css(e,{width:"",height:""}):b.UTILITIES.set_css(e,{transform:"scale("+l+", "+l+")","transform-origin":"left top",width:h*c/l,height:m*a/l})},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&b.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(b,c){return this.get_widget().remove_backside_widget(b,
c)},top_level_widget:function(){return this.get_widget().top_level_widget()},robot_in_training:function(){return this.get_widget().robot_in_training()},remove:function(b){var c;this.is_primary_backside()?this.get_widget().remove():((c=this.get_parent_of_backside())&&(c.is_backside()?c.remove_backside_widget(this,!b):c.removed_from_container&&(c.is_backside()?c.remove_backside_widget(this,!0):c.removed_from_container(this,b))),this.set_parent_of_backside(void 0),(b=this.get_element())&&$(b).remove())},
match:function(b){var c;if(b.is_backside()){if(this.get_erased())return this.get_widget().get_type_name()===b.get_widget().get_type_name()?"matched":this;c=this.get_widget();b=c.match(b.get_widget());return b===c?this:b}b.last_match=this;return b},has_ancestor:function(b){var c;return this===b?!0:(c=this.get_parent_of_backside())?c.has_ancestor(b):!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},
set_parent:function(b){this.set_parent_of_backside(b)},maintain_proportional_dimensions:function(){return!1},set_running:function(){},dereference:function(){return this},is_of_type:function(b){return this.get_widget().is_of_type(b)},is_top_level:function(){return this.get_widget().is_top_level()},ok_to_set_dimensions:function(){return!1},add_listener:function(b,c){this.get_widget().add_listener(b,c)},remove_listener:function(b,c,a){this.get_widget().remove_listener(b,c,a)},get_listeners:function(b){return this.get_widget().get_listeners(typee)},
is_hole:function(){return!1},is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},is_robot:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},get_infinite_stack:function(){return!1},drag_started:function(b,c){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,c)},get_json:function(e,
c,a){var h=this.get_backside_dimensions(),m=$(this.get_element()).position(),l;k(this);l=h?{width:h.original_width,height:h.original_height,transform:"scale("+h.x_scale+", "+h.y_scale+")","transform-origin":"left top 0px",left:m.left,top:m.top}:m;h=function(a,b){c({type:"backside",my_widget:a,css:l,erased:this.get_erased(),view:{}},b)}.bind(this);b.UTILITIES.get_json(this.get_widget(),e,h,a)},get_selection:function(){return this}}}(window.TOONTALK);
TOONTALK.creators_from_json.backside=function(b,k){var e=TOONTALK.UTILITIES.create_from_json(b.my_widget,k).create_backside(),c=e.get_element();TOONTALK.UTILITIES.set_css(c,b.css);b.erased&&e.set_erased(b.erased);return e};window.TOONTALK.frontside=function(b){return{create:function(k){var e=Object.create(this),c=document.createElement("div"),a=$(c),h=function(c){if(!($(c.target).is(".ui-resizable-handle")||"click"===c.type&&1!==c.which||k.get_open_backside_only_if_stopped()&&k.get_running())){if(a.is(".toontalk-top-level-resource")&&!c.altKey)k.set_running(!k.get_running());else{if(b.open_backside_only_if_alt_key&&!c.altKey)return;k.open_backside();k.robot_in_training()&&k.robot_in_training().backside_opened(k)}c.stopPropagation()}},
m;$(c).addClass("toontalk-frontside toontalk-side");k.get_infinite_stack()&&$(c).addClass("toontalk-infinite-stack");c.toontalk_widget_side=k;b.UTILITIES.drag_and_drop(c);e.get_element=function(){return c};e.get_widget=function(){return k};e.visible=function(){return m};e.set_visible=function(a){var c=this.get_widget();(m=a)&&b.UTILITIES.when_attached(this.get_element(!0),c.render.bind(c));c.walk_children&&c.walk_children(function(b){b.set_visible(a);return!0})};c.addEventListener("click",h);c.addEventListener("touchstart",
h);c.addEventListener("mouseenter",function(a){var c=k.get_backside(),e=(k.is_empty_hole()?wiget.get_parent_of_frontside():k).get_selection().get_frontside_element(),e=$(e);c&&b.UTILITIES.highlight_element(c.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");e.is(".toontalk-top-level-resource")||e.addClass("toontalk-wiggle");a.stopPropagation()});c.addEventListener("mouseleave",function(a){a=k.get_backside();var c=k.is_empty_hole()?wiget.get_parent_of_frontside():k;a&&b.UTILITIES.remove_highlight();
$(c.get_frontside_element()).removeClass("toontalk-wiggle")});b.debugging&&(c.id=k._debug_id);return e},update_display:function(){return this.get_widget().update_display()},remove:function(){var b=this.get_element();$(b).remove();b.toontalk_widget_side=null}}}(window.TOONTALK);(function(b){var k=180/Math.PI,e=Math.log(10),c=bigrat.fromInteger(10),a=bigrat.fromValues(1,2),h=bigrat.fromValues(-1,2),m=bigrat.fromInteger(360),l=bigrat.fromDecimal(2*Math.PI),d=Math.log10?Math.log10:function(a){return Math.log(a)/e},t=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},q=function(a){var c=t(a),d=b.number.ZERO(b.number.function_bird_results_default_format),e=b.number.ZERO(b.number.function_bird_results_default_format);
d.set_value(c.integer_part);e.set_value(c.fractional_part);return b.box.create(2,!0,[d,e],"The integer and fraction parts of "+a.toString().replace(",","/"))},g=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),d=t(c);return bigrat.multiply(c,d.fractional_part,b)},n=function(b){b=t(b);return bigrat.isLessThan(b.fractional_part,h)?bigrat.subtract(b.integer_part,b.integer_part,bigrat.ONE):bigrat.isLessThan(b.fractional_part,bigrat.ZERO)||bigrat.isLessThan(b.fractional_part,a)?b.integer_part:bigrat.add(b.integer_part,
b.integer_part,bigrat.ONE)},r=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},v=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(b.widget),e=function(a,b,c,d){var e="",g=100;c=50/c;b/=1+b;if(d)for(d=0;g>=c&&
d<a.length;)e=e+"<span class='toontalk-digit' style='font-size:"+g+"%'>"+a[d]+"</span>",d+=1,"-"!==a[d]&&(g*=b);else for(d=a.length-1;g>=c&&0<d;)e="<span class='toontalk-digit' style='font-size:"+g+"%'>"+a[d]+"</span>"+e,--d,"-"!==a[d]&&(g*=b);return e},g=function(a,b){return Math.ceil(Math.log(.5/b)/Math.log(a/(1+a)))},h=function(a,b,c){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+
h(a,1.25*b,.8*c)+"</span>";b=b/2-1;return e(a,b,c,!0)+e(a,b,c,!1)},l=function(a,b){bigrat.isNegative(a)&&bigrat.abs(a,a);var d;a:{d=bigrat.fromValues(a[0],1);var e=bigrat.fromValues(a[1],1);if(bigrat.equals(d,bigrat.ZERO))d="0";else{var g="",f=bigrat.create(),h=bigrat.create(),p=bigrat.create();for(bigrat.multiply(d,d,c);b>g.length;){if(bigrat.isLessThan(d,e))g+="0";else if(bigrat.divide(f,d,e),h=bigrat.toBigInteger(f),g+=h.toString(),bigrat.subtract(p,f,bigrat.fromValues(h,1)),bigrat.multiply(d,
p,e),bigrat.equals(d,bigrat.ZERO)){d=g=m(g);break a}bigrat.multiply(d,d,c)}d=g}}return d},m=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?m(a.substring(0,a.length-1)):a},n=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},k=function(a){switch(a){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return b.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";a.create=function(c,d,e,g,h,l){var m=Object.create(a),p=n(c,d);e||(e="+");m.is_number=function(){return!0};m.set_value=function(a,c){if(c||
!bigrat.equals(p,a))return this.fire_value_change_listeners(p,a),p=a,this.rerender(),b.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&b.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),this};m.set_value_from_sub_classes=m.set_value;m.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),d;c&&(d={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(d)}))};
m.get_value=function(){return p};m.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));b.debugging&&"0,0"===this.get_value().toString()&&b.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};m.copy=function(b){return this.add_to_copy(a.create(p[0],p[1],e,g,h,l),b)};m.get_format=function(){return g||a.default_format};m.set_format=function(a,b){g=a;b&&this.rerender();return this};m.get_operator=function(){return e};m.set_operator=function(a,b){e=a;b&&this.rerender();
return this};m.get_approximate=function(){return l};m.set_approximate=function(a,b){l=a;b&&this.rerender();return this};a.add_standard_widget_functionality(m);m.set_description(h);b.debugging&&(m._debug_string=m.toString(),m._debug_id=b.UTILITIES.generate_unique_id(),p._debug_id_new=m._debug_id);return m};a.create_from_bigrat=function(a){var c=b.number.ZERO();c.set_value(a);return c};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(n(a,
b))};a.set_numerator=function(a){return this.set_value(n(a,this.get_value()[1].toString()))};a.set_denominator=function(a){return this.set_value(n(this.get_value()[0].toString(),a))};a.ONE=function(){return b.number.create(1)};a.ZERO=function(a){return b.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};
a.compare_with_number=function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),c=function(a,b){var c=a.indexOf('style="');return 0<=c?a.substring(0,c+7)+b+a.substring(c+7):a},d=28,e,g,f,h,p,l;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());a=a.get_element();$(a).is(".toontalk-conditions-contents")?e=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json")?
(e=$(a),p=!0):$(a).parent().is(".toontalk-element-frontside")?(e=$(a),h=p=!0):e=$(a).parent().is(".toontalk-scale-half")?$(a):$(a).parent();0===e.length&&(d=this.get_parent_of_frontside())&&(d.get_widget().is_hole()&&(d=d.get_parent_of_frontside()),e=$(d.get_frontside_element()));1===b.nest.CONTENTS_WIDTH_FACTOR&&1===b.nest.CONTENTS_HEIGHT_FACTOR&&e.is(".toontalk-nest")&&e.parent().is(".toontalk-box-hole")&&!e.parent().is(".toontalk-scale-half")&&(e=e.parent());if($(a).is(".toontalk-carried-by-bird"))f=
g=100;else if($(a).is(".toontalk-held-by-robot"))g=76,f=55;else if($(a).is(".toontalk-element-attribute"))g=200,f=32;else if(p&&(a===e.get(0)||e.is(".toontalk-top-level-resource")))g=$(a).width(),f=$(a).height(),g&&f||(g=this.saved_width||76,f=this.saved_heieght||55,$(a).css({width:g,height:f}));else{g=e.width();f=e.height();if(0===g||0===f){b.logging&&0<=b.logging.indexOf("display")&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());b.UTILITIES.is_attached(a)||
b.UTILITIES.when_attached(a,this.update_display.bind(this));return}e.is(".toontalk-nest")&&(g*=b.nest.CONTENTS_WIDTH_FACTOR,f*=b.nest.CONTENTS_HEIGHT_FACTOR)}l=$(a).children(".toontalk-widget");l.is("*")?l=l.get(0):(l=document.createElement("div"),a.appendChild(l));$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");d=this.get_border_size(g,f);h||(4===d?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):
8===d?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):16===d?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number"));h=f-2*d;p=this.to_HTML(g/(.64*h),h,this.get_format(),!0,this.get_operator(),p);b.UTILITIES.on_a_nest_in_a_box(a)&&(p=c(p,"width:"+(g-2*d)+"px;"),p=c(p,"height:"+(f-2*d)+"px;"));l.innerHTML=p;l.translate=!1;$(l).addClass("toontalk-widget notranslate");e.is(".toontalk-box-hole")&&$(a).css({width:"",
height:""});b.UTILITIES.give_tooltip(a,this.get_title())};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};a.to_HTML=function(a,f,m,n,r,q){var t,p,u,A,F,v,D,z,x=!1!==n?" toontalk-top-level-number":"";v=4;z=a;this.is_attribute_widget&&this.is_attribute_widget()?x+=" toontalk-attribute-number":this.get_approximate()&&(x+=" toontalk-approximate-number");q&&(x+=" toontalk-number-size-unconstrained-by-container");u=r?k(r):"";z||(z=4);f||(f=16);if(this.get_erased&&
this.get_erased())return'<div class="toontalk-number toontalk-integer'+x+'" style="font-size: '+f+'px;"></div>';if(0<u.length){--z;if(D="-"===r&&(this.is_negative()||this.is_zero())&&(this.is_integer()||"improper_fraction"!==m&&"proper_fraction"!==m&&"mixed_number"!==m))--z,u+="&nbsp;";2>z&&(f*=Math.max(1,z)/2,z=2)}if(this.is_integer()&&"scientific_notation"!==m){try{t=bigrat.toBigInteger(this.get_value()).toString()}catch(J){b.UTILITIES.report_internal_error("Error converting number to a string: "+
J),t="0"}n=t.length;0<u.length&&n++;4>z&&n>z&&(m=Math.min(4,n),f*=z/m,z=m);return'<div class="toontalk-number toontalk-integer'+x+'" style="font-size: '+f+'px;">'+u+h(t,z,f)+"</div>"}if(this.get_approximate()||this.is_attribute_widget())if("decimal"===m?p=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===m&&(p=bigrat.toDecimal(this.get_value()).toExponential(),t=p.indexOf("e"),0<=t&&(A=p.substring(t+1),p=p.substring(0,t))),p)return n=p.length,0<u.length&&n++,A&&(z-=3+A.length/
2),"scientific_notation"===m&&(v+=2),z<v&&n>z&&(m=Math.min(v,n),f=0>=z?Math.max(1,z)/m*f:Math.max(2,z)/m*f,z=m),m=A?'&times;10<sup style="font-size: '+f/2+'px;">'+A+"</sup>":"",'<div class="toontalk-number toontalk-approximate-number'+x+'" style="font-size: '+f+'px;">'+u+e(p,z,f,!0)+m+"</div>";p=' style="font-size:'+.4*f+'px;"';if("improper_fraction"===m||!m)return f='<table class="toontalk-number toontalk-improper-fraction'+x+'"'+p+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+
h(this.numerator_string(),2*z,f)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+h(this.denominator_string(),2*z,f)+"</td></tr></table>",""===u?f:"<table class='toontalk-operator-and-fraction'"+p+"><tr><td>"+u+"</td><td>"+f+"</td></tr></table>";if("mixed_number"===m||"proper_fraction"===m){u=this.integer_part();if(u.is_zero())return this.to_HTML(z,
f,"improper_fraction",n,r);m=this.copy({just_value:!0}).subtract(u).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+x+'"'+p+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+u.to_HTML(z/2,f,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+m.to_HTML(z/2,f,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===m)return 4>z&&(f*=Math.max(1,z)/4,z=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+
x+'" style="font-size: '+f+'px;">'+u+this.decimal_string(z,f)+"</div>";if("scientific_notation"===m){t=bigrat.isNegative(this.get_value());v=this.get_value();D=bigrat.abs(bigrat.create(),v);A=bigrat.isLessThan(D,bigrat.ONE);bigrat.equals(v,bigrat.ZERO)?A=0:(v=A?bigrat.toBigInteger(bigrat.divide(bigrat.create(),bigrat.ONE,D)):bigrat.toBigInteger(D),v=v.toString(),A=A?-v.length:v.length-1);F=bigrat.power(bigrat.create(),c,A+1);v=6+(0===A?1:Math.ceil(d(Math.abs(A)))/2);D=g(z-(Math.min(v,z/2)+1),f);var fa=
this.get_value(),W=D+1,W=bigrat.power(bigrat.create(),c,W),Y=bigrat.create();bigrat.multiply(Y,fa,W);fa=bigrat.fromValues(bigrat.toBigInteger(Y),1);bigrat.divide(Y,fa,W);F=bigrat.divide(bigrat.create(),Y,F);t&&v++;if(a<v+1)return this.to_HTML(v+1,f*a/(v+1),m,n,r,q);m=l(F,D);n=t?"-"+m.substring(0,1):m.substring(0,1);m=m.substring(1);z=e(m,z*(1-v/z),f,!0);0<z.length&&(z="<span class='toontalk-decimal-point'>.</span>"+z);return'<table class="toontalk-number toontalk-scientific_notation'+x+'"'+p+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+
x+'" style="font-size: '+.9*f+'px;">'+u+n+z+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+f+'px;"> &times;10<sup style="font-size: '+f/2+'px;">'+A+"</sup></div></td></tr></table>"}};a.get_default_description=function(){return this.get_approximate()?"a number from an approximate calculation.":"a number."};a.drop_on=function(a,b,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b,c),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,
b,c);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,c,d){var e,g,f,h,p;if(!a.is_backside()){if(a.visible()&&this.visible()&&(c||d)){if(d){if(!d.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(a,c,d);a.robot_waiting_before_next_step=d}e=document.createElement("div");$(e).addClass("toontalk-bammer-down");g=$(this.get_frontside_element()).closest(".toontalk-top-level-backside");e.style.left="-10px";e.style.top=g.height()+"px";
0<g.length&&g.get(0).appendChild(e);h=this.get_frontside_element();f=$(h).offset();f.left-=.75*$(e).width();f.left+=.5*$(h).width()+.1*$(e).width();f.top-=.5*$(h).height()+.4*$(e).height();h=function(){b.sounds&&b.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,c,d)&&d&&d.run_next_step();c&&this.backup_all();$(e).removeClass("toontalk-bammer-down");b.UTILITIES.set_timeout(function(){var a=g.offset();a||(a={left:0,top:0});$(e).addClass("toontalk-bammer-away");f.left=a.left+g.width()-
100;f.top=a.top+g.height()+100;p=function(){$(e).remove()};b.UTILITIES.animate_to_absolute_position(e,f,p,d&&d.transform_animation_speed(b.UTILITIES.default_animation_speed));$(e).css({opacity:.01})})}.bind(this);b.UTILITIES.animate_to_absolute_position(e,f,h,d&&d.transform_animation_speed(b.UTILITIES.default_animation_speed));$(e).css({opacity:1,"z-index":b.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c,d)}};a.number_dropped_on_me_semantics=function(a,c,
d){c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove();switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "=":return this.set_value(a.get_value());case "^":return this.power(a);default:b.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_side_dropped_on_me=
function(a,b,c){return a.number_dropped_on_me?this.number_dropped_on_me(a,b,c):!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.divide=function(a){this.set_value(bigrat.divide(this.get_value(),this.get_value(),
a.get_value()),!0);return this};a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};a.is_zero=
function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(){return this.get_erased()?"erased number":("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};a.operator_word=function(a){switch(this.get_operator()){case "+":return"add "+a+" to";case "-":return"subtract "+a+" from";case "*":return"multiply "+a+" with";case "/":return"divide "+a+" into"}};a.get_text=function(){return this.is_integer()||
"improper_fraction"===this.get_format()?this.toString():bigrat.toDecimal(this.get_value()).toString()};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};a.get_json=function(a,b,c){b({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string(),format:this.get_format(),approximate:this.get_approximate()},c)};b.creators_from_json.number=
function(b){return a.create(b.numerator,b.denominator,b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};
a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};a.decimal_string=function(b,c){var d,m,n,k,r;if(this.is_integer())return this.numerator_string();d=this.get_value();m=a.create(d[0],d[1]);n=m.integer_part();d=n.toString();"0"===d&&this.is_negative()&&(d="-"+d);m=m.get_value();bigrat.subtract(m,m,n.get_value());k=b-(Math.min(d.length,b/2)+1);r=g(k,c);n=Math.min(d.length,b/2);m=l(m,r);m=m.length<k?m:e(m,k,c,!0);return h(d,n,c)+
"<span class='toontalk-decimal-point'>.</span>"+m};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_number)return a.match_with_any_number();this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===this.get_operator())return"matched";a.last_match=this;return a};a.get_custom_title_prefix=
function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"Drop me on another number and I'll "+this.operator_word("myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+b.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=function(){return{create:function(a){var c=b.backside.create(a),d=c.get_element(),e=document.createElement("div"),g=a.numerator_string(),
h=a.denominator_string(),l=b.UTILITIES.create_text_area(g,"toontalk-numerator-input","","Type here to edit the numerator",void 0,"number"),m=b.UTILITIES.create_text_area(h,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),n=b.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal.",!0),k=b.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button",
"Mixed number","Display number as an integer part and a proper fraction.",!0),r=b.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction.",!0),q=b.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",!0),t=b.UTILITIES.create_radio_button("operator",
"+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",!0),v=b.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",!0),R=b.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),p=b.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","Divide me into what I'm dropped on.",!0),u=b.UTILITIES.create_radio_button("operator",
"=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",!0),A=function(c){var d=l.button.value.trim(),e=m.button.value.trim(),p=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:p(a,b).replacement};a=p(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?
{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,"")}},n;if(d!==g||e!==h)n=p(d,"numerator"),n.message&&(b.UTILITIES.display_message(n.message),d=n.replacement),"0"===e?(b.UTILITIES.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1."),e="1"):(n=p(e,"denominator"),n.message&&(b.UTILITIES.display_message(n.message),e=n.replacement)),a.set_from_values(d,e)&&(g=d,h=e,a.robot_in_training()&&
(c=c.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===c?a.robot_in_training().edited(a,{setter_name:"set_denominator",argument_1:e,toString:"by changing the value of the denominator to "+e,button_selector:"."+c}):a.robot_in_training().edited(a,{setter_name:"set_numerator",argument_1:d,toString:"by changing the value of the numerator to "+d,button_selector:"."+c})),a.rerender())},F=function(){var c=b.UTILITIES.selected_radio_button(n.button,k.button,r.button,q.button),d=c.value;
a.set_format(d,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_format",argument_1:d,toString:"by changing the format to "+d+" of the number",button_selector:"."+c.className.split(" ",1)[0]});a.rerender()},P=function(){var c=b.UTILITIES.selected_radio_button(t.button,v.button,R.button,p.button,u.button),d=c.value;a.set_operator(d,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_operator",argument_1:d,toString:"by changing the operator to "+d+" of the number",
button_selector:"."+c.className.split(" ",1)[0]})},X=b.UTILITIES.create_horizontal_table(l.container,e,m.container),z=b.UTILITIES.create_horizontal_table(n.container,k.container,r.container,q.container),x=b.UTILITIES.create_horizontal_table(t.container,v.container,R.container,p.container,u.container),fa=b.backside.create_advanced_settings_button(c,a),W=c.update_display.bind(c),Y=c.add_advanced_settings;e.innerHTML="/";$(e).addClass("ui-widget");l.button.addEventListener("change",A);l.button.addEventListener("mouseout",
A);l.button.addEventListener("mouseenter",function(){g=l.button.value.trim()});m.button.addEventListener("change",A);m.button.addEventListener("mouseout",A);m.button.addEventListener("mouseenter",function(){h=m.button.value.trim()});d.appendChild(X);d.appendChild(fa);n.button.addEventListener("change",F);k.button.addEventListener("change",F);r.button.addEventListener("change",F);q.button.addEventListener("change",F);switch(a.get_format()){case "decimal":b.UTILITIES.check_radio_button(n);break;case "improper_fraction":b.UTILITIES.check_radio_button(r);
break;case "mixed_number":case "proper_fraction":b.UTILITIES.check_radio_button(k);break;case "scientific_notation":b.UTILITIES.check_radio_button(q)}switch(a.get_operator()){case "+":b.UTILITIES.check_radio_button(t);break;case "-":b.UTILITIES.check_radio_button(v);break;case "*":b.UTILITIES.check_radio_button(R);break;case "/":b.UTILITIES.check_radio_button(p);break;case "=":b.UTILITIES.check_radio_button(u)}t.button.addEventListener("change",P);v.button.addEventListener("change",P);R.button.addEventListener("change",
P);p.button.addEventListener("change",P);u.button.addEventListener("change",P);c.update_display=function(){$(l.button).val(a.numerator_string());$(m.button).val(a.denominator_string());W()};c.add_advanced_settings=function(){Y.call(c,z,x);$(z).buttonset();$(x).buttonset()};b.UTILITIES.when_attached(d,function(){c.is_primary_backside()||a.add_listener("value_changed",function(){c.rerender()})});return c}}}();window.TOONTALK.number["function"]=function(){var a=b.create_function_table(),c=function(a){return bigrat.toDecimal(g(a,
m))},d=function(a){return bigrat.toDecimal(g(a,l))};a.add_function_object("sum",function(c,d,e){return a.n_ary_widget_function(c,b.number.ZERO,b.number.add,"sum",d,e)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",function(c,d,e){return a.n_ary_widget_function(c,b.number.ZERO,b.number.subtract,"difference",d,e)},"The bird will return with the result of subtracting the numbers in the box from the first number.","-");a.add_function_object("product",
function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.multiply,"product",d,e)},"The bird will return with the product of the numbers in the box.","\u00d7");a.add_function_object("division",function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.divide,"division",d,e)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00f7");a.add_function_object("modulo",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(g),
2,"modulo",c,d)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.minimum,"minimum",d,e)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.maximum,"maximum",d,e)},"The bird will return with the largest of the numbers in the box.",
"max");a.add_function_object("absolute value",function(c,d,e){return a.n_ary_function(c,function(a){var d=b.number.ZERO(c.get_hole_contents(1).get_format());bigrat.abs(d.get_value(),a);return d},1,"absolute value",d,e)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(function(a,b){var c=bigrat.power(bigrat.create(),a,b[0].valueOf()),d=b[1].valueOf();return 1===d?c:bigrat.nthRoot(c,
c,d)},!0),2,"power",c,d)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},!0),1,"logarithm",c,d)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).",
"log");a.add_function_object("random",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c,d)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.",
"rand");a.add_function_object("round",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(n),1,"round",c,d)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(r),1,"floor",c,d)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(v),
1,"ceiling",c,d)},"The bird will return the smallest integer greater than or equal to the number.","ceil");a.add_function_object("delay",function(c,d,e){var g=Date.now(),h=a.check_message(c),l;if(h)if(2>h.size)b.UTILITIES.display_message("Delay function birds need a number in the second hole.");else return l=c.get_hole_contents(1).to_float(),setTimeout(function(){var l=b.number.ZERO(b.number.function_bird_results_default_format);l.set_value_from_decimal((Date.now()-g)/1E3);l.set_approximate(!0);a.process_response(l,
h.bird,c,d,e)},1E3*l),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");a.add_function_object("integer and fraction parts",function(b,c,d){return a.n_ary_function(b,q,1,"integer and fraction parts",c,d)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(b,d,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/
k)},!0,c),1,"sine",d,e)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",function(b,d,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/k)},!0,c),1,"cosine",d,e)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return k*
Math.atan(a)},!0),1,"arc tangent",c,d)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.","atan");a.add_function_object("arc tangent of y and x",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return k*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c,d)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.",
"atan2");a.add_function_object("sine (in radians)",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,!0,d),1,"sine (in radians)",c,e)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,d),1,"cosine (in radians)",c,e)},"The bird will return with an approximation of the cosine of the number (in radians).",
"cos rad");a.add_function_object("arc tangent (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,!0),1,"arc tangent (in radians)",c,d)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",
c,d)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.","atan2 rad");return a.get_function_table()}()})(window.TOONTALK);(function(b){var k=function(e,c,a,h){var m;e&&0<=a&&e.maintain_proportional_dimensions()&&e.get_default_width?(m=e.get_default_width(),e=e.get_default_height(),a/m>=h/e?(m=m*h/e,a={left:(a-m)/2,top:0,width:m,height:h}):(m=e*a/m,a={left:0,top:(h-m)/2,width:a,height:m})):(e.is_backside()&&(e.update_display(),e.scale_to(a,.92*h)),a={left:0,top:0});b.UTILITIES.set_css(c,a)};window.TOONTALK.box=function(b){var c=Object.create(b.widget);c.create=function(a,h,m,l,d){var t=Object.create(c),q=[];"undefined"===
typeof h&&(h=!0);t.is_box=function(){return!0};t.get_horizontal=function(){return h};t.set_horizontal=function(a,b){h=a;b&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());return this};t.get_hole=function(a){return q[a]};t.get_hole_contents=function(a){return q[a].get_contents()};t.set_hole=function(a,c,d){var h;q[a].set_contents(c);if(d){c&&c.save_dimensions();d=this.get_frontside_element();a=$(d).children(".toontalk-hole-number-"+a);a.empty();if(!c)return;h=
this.get_hole_dimensions();d=c.get_element(!0);0<a.length&&a.get(0).appendChild(d);k(c,d,h.width,h.height);c.rerender()}this.rerender();b.debugging&&(this._debug_string=this.to_debug_string())};t.get_holes=function(){return q};t.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=
void 0}.bind(this)};t.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};t.set_contents=function(a){a.forEach(function(a,b){q[b].set_contents(a)})};t.get_size=function(){return a};t.set_size=function(c,d){var h,l;if(a===c||0>c||isNaN(c))return!1;l=this.visible();q.length=c;if(c>a)for(h=a;h<c;h++)q[h]=b.box_hole.create(h),q[h].set_parent_of_frontside(t),q[h].set_visible(l);a=c;d&&this.rerender();b.debugging&&(this._debug_string=
this.to_debug_string());return!0};t.get_hole_dimensions=function(){var c=this.get_frontside_element(),d=$(c).width()||b.box.get_default_width(),c=$(c).height()||b.box.get_default_height();return h?{width:d/a,height:c}:{width:d,height:c/a}};t.receive_size_from_dropped=function(a,c){var d;if(a.is_number())return d=b.number.create(this.get_size()),d.number_dropped_on_me_semantics(a),d=Math.max(0,Math.round(d.to_float())),this.set_size(d),d.toString()};t.copy=function(b){var d;b||(b={});d=q.map(function(a){if(a=
a.get_contents())return a.copy(b)});d=c.create(a,h,d,this.get_description(),this.get_name());return this.add_to_copy(d,b)};t.generate_name=function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};t.add_standard_widget_functionality(t);t.has_name(t);t.set_name(d);for(d=0;d<a;d++)q[d]=b.box_hole.create(d),q[d].set_parent_of_frontside(t);t.set_description(l);m&&t.set_contents(m);b.debugging&&(t._debug_id=b.UTILITIES.generate_unique_id(),t._debug_string=t.to_debug_string());return t};c.create_backside=
function(){return b.box_backside.create(this)};c.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&a.equals_box(this)};c.equals_box=function(a){var b=this.get_size(),c,e,d;if(b!==a.get_size())return!1;for(c=0;c<b;c++)if(e=this.get_hole_contents(c),d=a.get_hole_contents(c),!e&&d||e&&!d||e&&d&&(!e.equals||!e.equals(d)))return!1;return!0};c.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};c.compare_with_box=function(a){var b=this.get_size(),
c=a.get_size(),e,d;if(b>c)return 1;if(b<c)return-1;for(c=0;c<b;c++){e=this.get_hole_contents(c);d=a.get_hole_contents(c);if(e&&!d)return 1;if(!e&&d)return-1;if(e&&d)if(e.compare_with){if(e=e.compare_with(d),1===e||-1===e)return e}else return}return 0};c.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_box)return a.match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=a,this)};c.match_with_any_box=function(){return"matched"};
c.match_with_this_box=function(a){var c=this.get_size(),m=[],l,d,k;if(c!==a.get_size())return a.last_match=this,a;for(l=0;l<c;l++)if(k=a.get_hole_contents(l))if(d=this.get_hole_contents(l)){d=b.UTILITIES.match(k,d);if(d.is_widget)return d;"matched"!==d&&(m=0===m.length?d:m.concat(d))}else if(d=this.get_contents_temporarily_removed(l))m.push(d);else return a.last_match=this,a;return 0<m.length?m:"matched"};c.toString=function(a){var b="",c=this.get_size(),e,d,k=this.get_type_name()+" that looks like ";
for(e=0;e<c;e++)d=this.get_hole(e),b+=d.get_full_description(a),e<c-1&&(b+=" | ");return k+"["+b.replace(k,"")+"]"};c.get_type_name=function(a){return a?"boxes":"box"};c.get_default_description=function(){return"a box for holding things."};c.get_help_URL=function(){return"docs/manual/boxes.html"};c.get_json=function(a,c,m){var l=[],d=function(m,k){var g,n;m>=this.get_size()?c({type:"box",size:this.get_size(),contents:l,horizontal:this.get_horizontal(),name:this.get_name()},k):(g=this.get_hole_contents(m))?
g.is_primary_backside&&g.is_primary_backside()?(n=function(a,b){l.push({widget:a,is_backside:!0});d(m+1,b)}.bind(this),b.UTILITIES.get_json(g.get_widget(),a,n,k)):g.is_widget?(n=function(a,b){l.push({widget:a});d(m+1,b)}.bind(this),b.UTILITIES.get_json(g,a,n,k)):(n=function(a,b){l.push(a);d(m+1,b)}.bind(this),g.get_json(a,n,k)):(l.push(null),d(m+1,k))}.bind(this);d(0,m)};c.walk_children=function(a){var b=this.get_size(),c;for(c=0;c<b&&a(this.get_hole(c));c++);};b.creators_from_json.box=function(a,
h){return c.create(a.size,a.horizontal,b.UTILITIES.create_array_from_json(a.contents,h),a.description,a.name)};c.update_display=function(){var a=this.get_frontside(!0).get_element(),c=this.get_size(),m=function(a,d,g){var m=d.get_contents(),n=(m||d).get_element(!0),t=$(a).parents(".toontalk-box-hole"),v=function(){$(a).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(M/=b.nest.CONTENTS_WIDTH_FACTOR,O/=b.nest.CONTENTS_HEIGHT_FACTOR)},L,H,M,O;l?(H=0,0<t.length?(M=r-2*y/c,O=f-2*y):
(M=r,O=f),v(),L=M*g,1<g&&(L+=y*(g-1))):(L=0,0<t.length?(M=r-2*y,O=f-2*y/c):(M=r,O=f),v(),H=O*g,1<g&&(H+=y*(g-1)));b.UTILITIES.set_css(a,{left:L,top:H,width:M,height:O});q[g]&&a.setAttribute("toontalk_name",q[g]);!b.UTILITIES.has_animating_image(n)&&0<g&&($(a).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(a).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),
l?$(a).addClass(w+"-left"):$(a).addClass(w+"-top"));a!==n&&(k(m,n,M,O),a.appendChild(n),d.get_contents().rerender());d.is_element()&&(d=d.get_contents(),d.set_size_attributes(M,O,!0))},l=this.get_horizontal();$(a).is(".toontalk-box");var d=function(){var d=$(a).children(".toontalk-box-hole");$(a).parent(".toontalk-conditions-contents-container").is("*")||$(a).parent().is(".toontalk-scale-half")||($(a).parent(".toontalk-box-hole").is("*")?b.UTILITIES.set_css(a,{width:"",height:""}):b.UTILITIES.set_css(a,
{width:n,height:v}));d.length===c?d.each(function(a,b){var c=this.get_hole(a);c&&m(b,c,a)}.bind(this)):(d.remove(),this.get_holes().forEach(function(b,c){g=b.get_element();$(g).addClass("toontalk-hole-number-"+c);m(g,b,c);a.appendChild(g)}))}.bind(this),t=function(){var d=function(a){if(a.parentElement)return $(a.parentElement).is(".toontalk-box-hole")?a.parentElement:d(a.parentElement)},g=d(a)||a,g=$(a).parent().is(".toontalk-scale-half")?a:g;n=0===c?0:$(g).width()||this.saved_width||b.box.get_default_width();
v=$(g).height()||this.saved_height||b.box.get_default_height();l?(r=0===c?0:n/c,f=v):(r=n,f=v/c)}.bind(this),q=this.get_name().split(";"),g,n,r,v,f,w,y;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(a).addClass("toontalk-box");$(a).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=
this.to_debug_string());this.get_erased()?($(a).addClass("toontalk-box-erased"),$(a).children(".toontalk-side").remove()):($(a).removeClass("toontalk-box-erased"),t(),y=this.get_border_size(r,f),w=4===y?"toontalk-box-eighth-size-border":8===y?"toontalk-box-quarter-size-border":16===y?"toontalk-box-half-size-border":"toontalk-box-full-size-border",l?r-=(c-1)*y/c:f-=(c-1)*y/c,$(a).addClass(w),b.UTILITIES.set_timeout(d))};c.get_default_width=function(){return 164};c.get_default_height=function(){return 68};
c.get_border_size=function(a,b){var c;if(0===a)return c=$(this.get_frontside_element()).width(),16>=c?4:32>=c?8:64>=c?16:32;a||(a=$(this.get_frontside_element()).width());b||(b=$(this.get_frontside_element()).height());return 32>=a||32>=b?4:64>=a||64>=b?8:128>=a||128>=b?16:32};c.get_name_input_label=function(){return"The labels of my holes are"};c.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};c.drop_on=function(a,
b,c){if(a.box_dropped_on_me)return c=a.box_dropped_on_me&&a.box_dropped_on_me(this,b,c),b&&a.rerender(),c&&this.remove(),c;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c);console.log("No handler for drop of "+this+" on "+a)};c.box_dropped_on_me=function(a,b){console.log("box on box not yet implemented");return!1};c.widget_side_dropped_on_me=function(a,c,m){var l=this.which_hole(c),d;if(0<=l)return d=this.get_hole(l),(l=d.get_contents())?a.drop_on(l,c,m):d.widget_side_dropped_on_me(a,
c,m);b.UTILITIES.report_internal_error(a+" dropped on "+this+" but no event was provided.")};c.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};c.removed_from_container=function(a,b){var c=!!b,e=this.get_index_of(a);0<=e&&(this.set_hole(e,void 0,c),c&&(this.rerender(),a.restore_dimensions()))};c.get_path_to=function(a,c){var m=this.get_size(),l,d;if("empty hole"===a.get_type_name()){m=a.get_parent_of_frontside();
d=b.box.path.create(a.get_index());if(m===this)return d;m=this.get_path_to(m);if(!m)return;m.next=d;return m}for(l=0;l<m;l++)if(d=this.get_hole_contents(l)||this.get_contents_temporarily_removed(l)){if(a===d||d.top_contents_is&&d.top_contents_is(a))return b.box.path.create(l);if(d.get_path_to&&(d=d.get_path_to(a,c)))return m=b.box.path.create(l),m.next=d,m}};c.element_to_highlight=function(a){a=this.which_hole(a,!0);var b;if(0>a||0===this.get_size())return this.get_frontside_element();a=this.get_hole(a);
return(b=a.get_contents())?b.get_frontside_element():a.get_frontside_element()};c.which_hole=function(a){var b=this.get_horizontal(),c=this.get_frontside_element(),e=this.get_size(),d,k;if(0!==e&&(d=$(c).offset(),c=b?$(c).width()/e:$(c).height()/e,k=b?d.left:d.top,a))for(d=0;d<e;d++)if(k+=c,(b?a.pageX<=k:a.pageY<=k)||d+1===e)return d};c.dereference_path=function(a,c){var m,l;if(a){m=a.get_index&&a.get_index();if(!b.debugging||"number"===typeof m){if(l=this.get_hole_contents(m)){if(l.dereference_contents&&
!a.not_to_be_dereferenced)return l.dereference_contents(a.next||a,c);if(a.next){if(l.dereference_path)return l.dereference_path(a.next,c);b.UTILITIES.report_internal_error("Expected to refer to a part of "+l+" but it lacks a method to obtain "+b.path.toString(a.next))}a.removing_widget&&("empty hole"===l.get_type_name()?b.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):l.get_infinite_stack()||c.remove_from_container(l,this));return l}return this.get_hole(m)}b.UTILITIES.report_internal_error(this+
" unable to dereference the path: "+b.path.toString(a))}else return this};c.path={create:function(a){return{get_index:function(){return a},toString:function(){return"scale"===this.true_type?0===a?"the left pan ":"the right pan ":"the "+b.UTILITIES.ordinal(a)+" hole "},get_json:function(b,c,e){var d=function(b,d){c({type:"box_path",index:a,true_type:this.true_type,next:b},d)}.bind(this);this.next?this.next.get_json(b,d,e):d(void 0,e)}}}};c.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};
b.creators_from_json.box_path=function(a,h){var m=c.path.create(a.index);a.next&&(m.next=b.UTILITIES.create_from_json(a.next,h));a.true_type&&(m.true_type=a.true_type);return m};return c}(window.TOONTALK);window.TOONTALK.box_backside=function(b){return{create:function(c){var a=b.backside.create(c),h=b.UTILITIES.create_text_input(c.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(a){if(a=b.UTILITIES.input_area_drop_handler(a,
c.receive_size_from_dropped.bind(c),c))c.rerender(),c.robot_in_training()&&c.robot_in_training().dropped_on_text_area(a,c,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),m=b.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-radio-button","Left to right","Show box horizontally.",!0),l=b.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-radio-button","Top to bottom","Show box vertically.",!0),d=function(){var a=
parseInt(h.button.value.trim(),10);c.set_size(a,!0)&&c.robot_in_training()&&c.robot_in_training().edited(c,{setter_name:"set_size",argument_1:a,toString:"by changing the number of holes to "+a+" of the box",button_selector:".toontalk-box-size-input"})},k=function(){var a=b.UTILITIES.selected_radio_button(m.button,l.button),d=a.value,g="horizontal"===d;c.set_horizontal(g,!0);c.robot_in_training()&&c.robot_in_training().edited(c,{setter_name:"set_horizontal",argument_1:g,toString:"by changing the orientation to "+
d+" of the box",button_selector:"."+a.className.split(" ",1)[0]})},q=a.get_element(),g=b.backside.create_advanced_settings_button(a,c),n=a.update_display.bind(a),r=b.UTILITIES.create_horizontal_table(m.container,l.container);h.button.addEventListener("change",d);h.button.addEventListener("mouseout",d);m.button.addEventListener("change",k);l.button.addEventListener("change",k);a.update_display=function(){h.button.value=c.get_size().toString();c.get_horizontal()?b.UTILITIES.check_radio_button(m):b.UTILITIES.check_radio_button(l);
n()};q.appendChild(h.container);q.appendChild(r);$(r).buttonset();q.appendChild(g);a.rerender();return a}}}(window.TOONTALK);window.TOONTALK.box_hole=function(b){return{create:function(c){var a=Object.create(this),h,m,l;a.is_hole=function(){return!0};a.is_empty_hole=function(){return!h};a.location_constrained_by_container=function(){return!1};a.get_element=function(){l||(l=document.createElement("div"),l.className="toontalk-box-hole toontalk-frontside toontalk-side",l.toontalk_widget_side=a);return l};
a.get_frontside=function(a){return h?h.get_frontside(a):this.get_element()};a.get_frontside_element=function(a){return this.get_element()};a.get_frontside=function(){return this};a.widget_side_dropped_on_me=function(a,c,h){var g=this.get_parent_of_frontside(),l=this.get_contents(),m,k,f;if(l)return l.widget_side_dropped_on_me&&l.widget_side_dropped_on_me(a,c,h);a.dropped_on_other&&a.dropped_on_other(this,c,h);c?(b.sounds&&b.sounds.fall_inside.play(),h=this.get_element(),l=a.is_plain_text_element(),
f=a.get_element(),$(f).css({"z-index":b.UTILITIES.next_z_index()}),k=$(f.parentElement).offset(),m=$(h).offset(),l||(f.style.left=c.pageX-k.left+"px",f.style.top=c.pageY-k.top+"px",$(f).addClass("toontalk-animating-element")),f.style.width=h.style.width,f.style.height=h.style.height,f.style.left=m.left-k.left+"px",f.style.top=m.top-k.top+"px",c=function(){$(f).removeClass("toontalk-animating-element");g.render();this.set_contents(a)}.bind(this),setTimeout(c,l||b.UTILITIES.has_animating_image(f)?0:
1200),g.robot_in_training()&&g.robot_in_training().dropped_on(a,this),a.save_dimensions&&a.set_size_attributes&&a.set_size_attributes($(h).width(),$(h).height()),a.is_backside()||g.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:f,where:"front",index:this.get_index()}))):(g.rerender(),this.set_contents(a));return!0};a.get_json=function(){return null};a.add_to_json=function(a){return a};a.copy=function(a){return b.box_hole.create(c)};a.match=function(){return"matched"};
a.get_type_name=function(a){return h?h.get_type_name(a):a?"empty holes":"empty hole"};a.is_of_type=function(a){return h?h.is_of_type(a):"empty hole"===a};a.get_box=function(){return this.get_parent_of_frontside()};a.update_display=function(){var a;h&&(a=this.get_frontside_element(),k(h,h.get_element(),$(a).width(),$(a).height()))};a.dereference=function(){return h?h.dereference():this};a.get_index=function(){return c};a.get_contents=function(){return h};a.set_contents=function(a){var c=this.get_listeners("value_changed");
c&&(h!==a&&c.forEach(function(b){b({type:"value_changed",old_value:h,new_value:a})}),h&&c.forEach(function(a){h.remove_listener("value_changed",a,!0)}),a&&c.forEach(function(b){a.add_listener("value_changed",b)}));h&&h.set_parent(void 0);(h=a)?(h.set_parent(this),b.debugging&&(this._debug_string="A hole containing "+h.to_debug_string()),h.set_visible(m)):b.debugging&&(this._debug_string=this.to_debug_string())};a.visible=function(){return this.get_parent_of_frontside().visible()};a.set_visible=function(a){m=
a;h&&h.set_visible(a)};a.remove=function(){h&&h.remove()};a.render=function(){h&&b.DISPLAY_UPDATES.pending_update(this)};a.rerender=function(){if(h&&this.visible())return this.render()};a.set_running=function(a){h&&h.set_running(a)};a.maintain_proportional_dimensions=function(){if(h)return h.maintain_proportional_dimensions()};a.removed_from_container=function(a,c,l,g){h?(c&&h.restore_dimensions(),this.set_contents(void 0),c&&this.get_parent_of_frontside().render()):g&&b.UTILITIES.report_internal_error("Holes can't be removed from containers.")};
a.temporarily_remove_contents=function(a,b){if(h)return this.get_parent_of_frontside().temporarily_remove_contents(a,b)};a.toString=function(){return h?h.toString():"_"};a.get_description=function(){return h?h.get_description():"_"};a.get_full_description=function(a){return h?h.get_full_description(a):"_"};a.is_backside=function(){return!1};a.get_widget=function(){return this.get_parent_of_frontside()};a.is_number=function(){return h?h.is_number():!1};a.is_box=function(){return h?h.is_box():!1};a.is_scale=
function(){return h?h.is_scale():!1};a.is_bird=function(){return h?h.is_bird():!1};a.is_nest=function(){return h?h.is_nest():!1};a.is_robot=function(){return h?h.is_robot():!1};a.is_element=function(){return h?h.is_element():!1};a.get_original_width=function(){if(h&&h.get_original_width)return h.get_original_width()};a.get_original_height=function(){if(h&&h.get_original_height)return h.get_original_height()};a.is_sensor=function(){return h?h.is_sensor():!1};a.is_top_level=function(){return!1};a.is_plain_text_element=
function(){return!1};a.get_active=function(){return h?h.get_active():!1};a.set_active=function(a,b){h&&h.set_active(a,b)};b.widget.has_parent(a);b.widget.has_listeners(a);if(b.debugging||b.logging)a.to_debug_string=function(){var a="the "+b.UTILITIES.ordinal(c)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box");return h?a+" which contains "+h.to_debug_string():a+" which is empty"},a._debug_string=a.to_debug_string();return a}}}(window.TOONTALK);
window.TOONTALK.box["function"]=function(){var e=b.create_function_table();e.add_function_object("box hole",function(c,a,h){return e.typed_bird_function(c,function(a,c){var d=Math.round(a.to_float());if(1>d)b.UTILITIES.display_message("The box hole function bird cannot accept "+a+". She only accepts positive numbers.");else if(d>c.get_size())b.UTILITIES.display_message("The box hole function bird cannot accept "+a+". The box only has "+c.get_size()+" holes.");else return c.get_hole_contents(d-1)},
["number","box"],2,"box hole",a,h)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. 1 for the first hole.","hole",["number","box"]);e.add_function_object("count holes",function(c,a,h){return e.typed_bird_function(c,function(a){return b.number.create(a.get_size())},["box"],1,"count holes",a,h)},"The bird will return with the number of holes the box has.","count holes",["box"]);e.add_function_object("fill hole",function(c,a,h){return e.typed_bird_function(c,
function(a,c,d){var e=Math.round(a.to_float());if(1>e)b.UTILITIES.display_message("The fill hole function bird cannot accept "+a+". She only accepts positive numbers.");else return e>c.get_size()&&c.set_size(e),c.set_hole(e-1,d),c},["number","box",void 0],3,"fill hole",a,h)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);
e.add_function_object("split box",function(c,a,h){return e.typed_bird_function(c,function(a,c){var d=Math.round(a.to_float()),e=c.get_size();if(0>d)b.UTILITIES.display_message("The box split function bird cannot accept "+a+". She only accepts zero or positive numbers.");else if(d>e)b.UTILITIES.display_message("The box split function bird cannot accept "+a+". The box only has "+e+" holes.");else{c.get_holes();var e=e-d,h=b.box.create(e),g;for(g=0;g<e;g++)h.set_hole(g,c.get_hole_contents(g+d));c.set_size(d);
return b.box.create(2,!1,[c,h])}},["number","box"],2,"split box",a,h)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.","split",["number","box"]);e.add_function_object("merge boxes",function(c,a,h){return e.typed_bird_function(c,function(){var a=0,c,d,e,h;if(0===arguments.length)return b.box.create(0);d=arguments[0];for(c=0;c<arguments.length;c++)a+=arguments[c].get_size();e=d.get_size();d.set_size(a);for(c=
1;c<arguments.length;c++)for(h=arguments[c].get_size(),a=0;a<h;a++)d.set_hole(e,arguments[c].get_hole_contents(a)),e++;return d},["box"],void 0,"merge boxes",a,h)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);return e.get_function_table()}()})(window.TOONTALK);(function(){var b,k,e,c,a;window.TOONTALK.bird=function(c){var e=Object.create(c.widget),l=function(a,b,e){var g=a.get_function_type();a=a.get_function_object();var l=Object.keys(TOONTALK[g]["function"]),m=l.map(function(a){return TOONTALK[g]["function"][a].title}),l=c.UTILITIES.create_select_menu("functions",l,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",m);b=b.get_element();var k;a&&(l.menu.value=a.name);l.menu.addEventListener("change",
function(a){e.set_function_name(a.target.value);e.get_description()||(k=$(e.get_backside_element()).find(".toontalk-description-input"),0<k.length&&k.get(0).setAttribute("placeholder",e.get_default_description()))});b.insertBefore(l.container,b.firstChild)};e.create=function(d,t){var q=Object.create(e),g=[],n=[];b=function(a){d=a};q.is_bird=function(){return!0};q.widget_side_dropped_on_me=function(a,b,e,g,l){var m,k,n;if(d){if(d.has_ancestor(a))return c.UTILITIES.display_message("Bird can't take its nest to its nest!"),
!1;!(d.visible()||this.visible()||d.any_nest_copies_visible())||e&&e.visible()&&!e.animate_consequences_of_actions()?(n=function(){try{d.add_to_contents(a,b,e)}catch(c){if(c.wait_for_nest_to_receive_something)c.wait_for_nest_to_receive_something.run_when_non_empty(n,this);else throw console.error(c.stack),c;}},n(),e&&e===a.robot_waiting_before_next_step&&(a.robot_waiting_before_next_step=void 0,e.run_next_step())):(l||a.save_dimensions(),m=this.get_frontside_element(),setTimeout(function(){$(m).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside().rerender()}.bind(this)),a.set_visible(d.visible()),e&&!g&&(a.robot_waiting_before_next_step=e,e.run_next_step&&(k=function(){a.robot_waiting_before_next_step=void 0;e.run_next_step()})),d.animate_bird_delivery(a,this,k,b,e))}else console.log("TODO: handle drop on a nestless bird -- just removes other?");b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);return!0};q.animate_delivery_to=function(a,
b,e,l,m,k,q,t){var J=!!e,G=this.get_parent_of_frontside(),C=this.get_frontside_element(!0),I=$(C).position();$(C).width();var L=this.closest_visible_ancestor_or_frontside(),H=$(L.get_frontside_element()).offset(),M=function(){var a,b;c.sounds&&c.sounds.bird_fly.pause();J?this.remove():this.visible()&&(a=function(){$(C).removeClass("toontalk-bird-morph-to-static");$(C).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));G&&G.get_widget().rerender()}.bind(this),
C.style.position=P,c.UTILITIES.set_css(C,I),F&&F.appendChild(C),G&&(G.get_widget().is_top_level()?this.rerender():G.get_widget().rerender()),x&&(na.remove_backside_widget(this,!0),x(),g&&(b=g,g=[],n=[],b.forEach(function(a){a()}))),c.UTILITIES.add_animation_class(C,"toontalk-bird-morph-to-static"),c.UTILITIES.add_one_shot_event_handler(C,"animationend",1E3,a));k&&k()}.bind(this),O=function(){try{e.add_to_contents(a,q,t,this,!0)}catch(b){if(b.wait_for_nest_to_receive_something){b.wait_for_nest_to_receive_something.run_when_non_empty(O,
this);k&&(k(),k=void 0);return}console.error(b.stack);throw b;}p($(C).offset());c.UTILITIES.set_timeout(function(){this.fly_to(H,M,t)}.bind(this))}.bind(this),R=function(a,b){b||(b=c.UTILITIES.widget_side_of_element(a));this.element_to_display_when_flying=a;b&&(this.update_display(),setTimeout(function(){b.update_display()}));$(a).addClass("toontalk-carried-by-bird");$(a).removeClass("toontalk-temporarily-set-down");c.UTILITIES.set_timeout(function(){var d={left:"",top:"",position:""};b&&!b.use_scaling_transform&&
(d.width="",d.height="");1<a.toontalk_x_scale&&(d["font-size"]="inherit");c.UTILITIES.set_css(a,d);this.update_display()}.bind(this))}.bind(this),p=function(b){var d;this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),b?(d={"z-index":c.UTILITIES.next_z_index()},0<this.element_to_display_when_flying.width_before_carry&&(d.width=this.element_to_display_when_flying.width_before_carry),0<this.element_to_display_when_flying.height_before_carry&&
(d.height=this.element_to_display_when_flying.height_before_carry),1<this.element_to_display_when_flying.toontalk_x_scale&&(d["font-size"]="inherit"),c.UTILITIES.set_css(this.element_to_display_when_flying,d),this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying),c.UTILITIES.set_absolute_position(this.element_to_display_when_flying,b),(b=a.get_parent_of_frontside())&&!b.is_backside()?b.rerender():(a.set_visible(!0),a.render())):$(this.element_to_display_when_flying).remove(),
this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),u,A,F,P,X,z,x,fa,W,Y,na;e||(e=d);Y=a.get_element(!0);R(Y,a);b.is_function_nest()||(A=b.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!b.visible()&&!this.visible()||!b.is_function_nest()&&!c.UTILITIES.visible_element(A))e.add_to_contents(a,q,t,this,!0);else if(c.sounds&&c.sounds.bird_fly.play(),$(C).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),
b.is_function_nest()||(A=b.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element(),u=$(A).offset(),z=$(e.get_frontside_element()).closest(".toontalk-top-level-backside")),z&&z.is("*")||(z=$(this.get_frontside_element()).closest(".toontalk-top-level-backside")),(b=z.offset())||(b={left:0,top:0}),l?H={left:l+b.left,top:m+b.top}:0===H.left&&0===H.top&&(H={left:-Y.clientWidth,top:b.top+z.height()/2}),u||(u={left:-2*Y.clientWidth,top:b.top+z.height()/2}),F=C.parentElement,
L=$(C).width(),X=$(C).height(),P=C.style.position,C.style.position="absolute",na=this.top_level_widget(),G&&G.temporarily_remove_contents&&(x=G.temporarily_remove_contents(this,!0))&&this.get_widget().add_to_top_level_backside(this),0<z.length&&z.get(0).appendChild(C),c.UTILITIES.set_css(C,{left:l||H.left-b.left,top:m||H.top-b.top,width:L,height:X}),c.logging&&0<=c.logging.indexOf("bird")&&console.log(this.to_debug_string()+" from "+(l||H.left-b.left)+", "+(m||H.top-b.top)+" to "+u.left+", "+u.top),
(fa=e.get_contents_element&&e.get_contents_element())&&e.visible()&&(!t||t.animate_consequences_of_actions())){l=$(A).width();m=$(A).height();W=$(A).offset();b.max_left=b.left+z.width();b.max_top=b.top+z.height();u.left+=l;u.top+=m;var pa={left:Math.min(W.left+l,b.max_left-l),top:Math.min(W.top+m,b.max_top-m)},qa={left:Math.max(W.left-l,b.left),top:Math.max(W.top-m,b.top)};u=function(){var b=function(){e.visible()?(e.set_locked(!0),this.fly_to(W,Ba,t,300)):(e.add_to_contents(a,q,t,this,!0),k&&(k(),
k=void 0))}.bind(this);$(Y).addClass("toontalk-temporarily-set-down");p(pa);e.get_locked()?e.run_when_unlocked(b):b()}.bind(this);var Ba=function(){R(fa);this.fly_to(qa,sa,t,300)}.bind(this),sa=function(){$(fa).addClass("toontalk-temporarily-set-down");p(qa);this.fly_to(pa,Aa,t,300)}.bind(this),Aa=function(){R(Y,a);this.fly_to(W,ma,t,300)}.bind(this),ma=function(){var b=e.get_contents_dimensions();a.is_plain_text_element()&&$(Y).addClass("toontalk-temporarily-set-down");p(W);a.is_plain_text_element()||
c.UTILITIES.set_css(a.get_frontside_element(),b);this.fly_to(qa,Fa,t,300)}.bind(this),Fa=function(){R(fa);this.fly_to(W,Ea,t,300)}.bind(this),Ea=function(){$(Y).removeClass("toontalk-temporarily-set-down");e.set_locked(!1);p();e.update_display();O()}.bind(this);this.fly_to(pa,u,t,300)}else this.fly_to(u,O,t,300)};q.get_json=function(a,b,e){var g;d?(g=function(a,c){b({type:"bird",nest:a},c)},c.UTILITIES.get_json(d,a,g,e)):b({type:"bird"},e)};q.copy=function(b){var c,e,g;if(b)if(b.just_value)c=this.create(void 0,
this.get_description());else{if((g=d&&d.get_guid())&&b.nests_copied&&b.nests_copied[g]){c=b.nests_copied[g][0];a.call(c);for(e=1;e<b.nests_copied[g].length;e++)k.call(b.nests_copied[g][e],c);c=this.create(c,this.get_description())}else c=this.create(d,this.get_description());b.birds_copied||(b.birds_copied={});g&&(b.birds_copied[g]||(b.birds_copied[g]=[]),b.birds_copied[g].push(c))}else c=d&&d.is_function_nest()?this.create(d.copy(),this.get_description()):this.create(d,this.get_description());return this.add_to_copy(c,
b)};q.run_when_non_empty=function(a,b){0>n.indexOf(b)&&(g.push(a),n.push(b))};q.create_backside=function(){var a=c.bird_backside.create(this);d&&d.is_function_nest()&&l(d,a,this);return a};q.get_help_URL=function(){return d&&d.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};q.is_function_bird=function(){return d&&d.is_function_nest()};q.get_custom_title_prefix=function(){var a;return d?d.is_function_nest()&&(a=d.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":
"This bird no longer knows where her nest is. She'll get rid of anything you give her."};q.toString=function(a){return d?d.is_function_nest()?d.get_function_object().toString():"bird":a&&"conditions"===a.role?"any bird":"bird without a nest"};q.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird a box to compute the '"+d.get_function_object().name+"' of "+this.get_function_type(!0)+".":"a bird who takes things to her nest."};q.update_display=function(){var a=
this.get_frontside(!0);this.get_backside();var b;b=a.get_element();b.setAttribute("toontalk_name",this.get_name());c.UTILITIES.give_tooltip(b,this.get_title());$(b).is(".toontalk-bird, .toontalk-side-animating")||($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),b.addEventListener("dragenter",function(a){0<=b.className.indexOf("toontalk-bird-static")&&($(b).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),
c.UTILITIES.add_animation_class(b,"toontalk-bird-gimme"))}.bind(this)),b.addEventListener("dragleave",function(a){$(b).is(".toontalk-bird-gimme")&&($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?b.appendChild(this.element_to_display_when_flying):$(b).children(".toontalk-side").remove()};q.set_function_name=function(a){d&&d.is_function_nest()&&
d.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};q.get_function_type=function(a){return d.get_function_type(a)};q.get_class_name_with_color=function(a){return d&&d.get_class_name_with_color?d.get_class_name_with_color(a):a};q.get_name=function(){return d?d.get_name():""};d&&d.set_name&&(q.set_name=function(a,
b){return d.set_name(a,b)});q.add_standard_widget_functionality(q);q.set_description(t);c.debugging&&(q._debug_id=c.UTILITIES.generate_unique_id(),q._debug_string=q.to_debug_string());return q};e.create_function=function(a,b,l){return e.create(c.nest.create_function(b,a,l||c.UTILITIES.get_first_property(c[a]["function"])))};e.match=function(a){if(a.match_with_any_bird)return a.match_with_any_bird(this);this.last_match=a;return this};e.match_with_any_bird=function(){return"matched"};e.fly_to=function(a,
b,e,g){var l=this.get_frontside_element(),m=$(l).offset(),k="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*(Math.atan2(a.top-m.top,a.left-m.left)/Math.PI+1))%8];$(l).position();var f=function(){$(l).removeClass(k);g?setTimeout(b,e?e.transform_step_duration(g):g):b()}.bind(this);setTimeout(function(){$(l).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
c.UTILITIES.add_animation_class(l,k);this.animate_to_absolute_position(a,f,e&&e.transform_animation_speed(c.UTILITIES.default_animation_speed))}.bind(this),1)};e.get_type_name=function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};e.maintain_proportional_dimensions=function(){return!0};e.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};e.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,
b,c)};c.creators_from_json.bird=function(a,b){return c.bird.create(c.UTILITIES.create_from_json(a.nest,b),a.description)};return e}(window.TOONTALK);window.TOONTALK.bird_backside=function(a){return{create:function(b){var c=a.backside.create(b);c.add_description_setting();c.add_name_setting();c.get_element().appendChild(a.backside.create_advanced_settings_button(c,b));return c}}}(window.TOONTALK);window.TOONTALK.nest=function(h){var m=Object.create(h.widget),l,d=0,t=0;m.default_maximum_capacity=10;
m.maximum_capacity=m.default_maximum_capacity;m.create=function(q,g,n,r,v,f){var w=Object.create(m),y=[],E=[],N=[],D=!1,J,G,C;g||(g=[]);v||(d++,v=d);k=function(a){r&&c.call(r,this);r=a;n=a.get_guid();e.call(a,this)};a=function(){r&&c.call(r,this);r=void 0;n=h.UTILITIES.generate_unique_id()};e=function(a){l||(l=h.UTILITIES.generate_unique_id());this[l](a)};c=function(a){l||(l=h.UTILITIES.generate_unique_id());this[l](a,!0)};w.is_nest=function(){return!0};w.get_guid=function(){return n};w.matched_by=
function(a){return 0<g.length?h.UTILITIES.match(a,g[0]):[[this,a]]};w.run_when_non_empty=function(a,b){0<g.length?a(g[0]):0>N.indexOf(b)&&(y.push(a),N.push(b))};w.dereference=function(){return 0<g.length?g[0]:this};w.match=function(a){if(0<g.length)return g[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};w.add_to_contents=function(a,b,c,d,e){var f;f=g.push(a);var p=this.visible();f>m.maximum_capacity&&c&&D&&!c.visible()&&!p&&(h.logging&&0<=
h.logging.indexOf("nest")&&console.log(this.to_debug_string()+" postponing addition of "+a.to_debug_string()+" by "+c.to_debug_string()+". Stack is "+g.length+" long. "+E.length+" previously postponed."),c.add_body_finished_listener(function(){c.set_stopped(!0);E.push(function(){c.set_stopped(!1);c.run_actions()})}));h.logging&&0<=h.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+a.to_debug_string()+" nest now contains "+g.length+" widgets.");1===f?(D=!1,0<y.length&&(f=y,y=[],
N=[],f.forEach(function(b){b(a)})),a.set_visible(p),p||a.hide()):(a.hide(),a.set_visible(!1));a.is_backside()?a.set_parent_of_backside(this):a.set_parent_of_frontside(this);J&&!e&&(d?J.forEach(function(e){e.has_ancestor(a.get_widget())||e.animate_bird_delivery(h.UTILITIES.copy_side(a),d,void 0,b,c)}):J.forEach(function(d){d.has_ancestor(a.get_widget())||d.add_to_contents(h.UTILITIES.copy_side(a,!1,!0),b,c)}));this.rerender()};w.animate_bird_delivery=function(a,b,c,d,e){var g,f,l;void 0===this.get_parent_of_frontside()?
(a.remove(),c&&c()):(b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,e),J&&(g=$(b.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),f=b.get_parent_of_frontside().get_element(),l=this.visible(),J.forEach(function(c){var m=h.UTILITIES.copy_side(a,!1,l),k,n;c.has_ancestor(a.get_widget())||(g&&(c.visible()||l)?(k=b.copy({just_value:!0}),n=k.get_frontside_element(!0),f.appendChild(n),k.animate_delivery_to(m,c,c,g.left,g.top,void 0,d,e)):c.add_to_contents(m,
void 0,e))})))};w.get_contents_element=function(){if(0<g.length)return g[0].get_element()};w.get_locked=function(){return this.locked_for_animating_deliveries};w.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};w.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};w.removed_from_container=function(a,b,c){a=g.shift();
h.logging&&0<=h.logging.indexOf("nest")&&(a?console.log(this.to_debug_string()+" removed "+a.to_debug_string()+" remaining widgets is "+g.length):console.log(this.to_debug_string()+" nothing left to remove."));if(a)return b||(D=!0),a.is_backside()?a.set_parent_of_backside(void 0):a.get_widget().set_parent_of_frontside(void 0),this.visible()&&(a.restore_dimensions&&a.restore_dimensions(),0<g.length&&(g[0].set_visible(!0),$(g[0].get_element()).show()),this.render()),g.length<=m.maximum_capacity&&0<
E.length&&(h.logging&&0<=h.logging.indexOf("nest")&&console.log(this.to_debug_string()+" running "+E.length+" postponed additions. Stack is "+g.length+" long."),m.maximum_capacity=Number.MAX_VALUE,E.forEach(function(a){a()}),m.maximum_capacity=m.default_maximum_capacity,E=[]),a;c&&h.UTILITIES.report_internal_error("Nothing removed from nest!")};w.dereference_path=function(a,b){if(0===g.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(g)return g[0].dereference_path(a,
b);h.UTILITIES.display_message("Robot expected to find a nest something that it could get "+h.path.toString(a)+". But the nest is empty.");return this};w.dereference_contents=function(a,b){var c,d,e,f,p,l,m,k,n;return 0===g.length?{wait_until_this_nest_receives_something:this}:a.removing_widget?(c=g[0],b.remove_from_container(c,this),this.visible()&&(l=this.get_frontside_element(),d=$(l).offset(),e=$(l).closest(".toontalk-backside-of-top-level"),(f=e.offset())||(f={left:0,top:0}),p=c.get_element(!0),
m=$(l).width(),l=$(l).height(),k=.1*m+d.left-f.left,n=.1*l+d.top-f.top,h.UTILITIES.set_css(p,{width:m*h.nest.CONTENTS_WIDTH_FACTOR,height:l*h.nest.CONTENTS_HEIGHT_FACTOR}),0<e.length&&b.add_watched_step_end_listeners(function(){e.get(0).appendChild(p);h.UTILITIES.set_css(p,{left:k,top:n})})),c):a.next?g[0].get_widget().dereference_path(a.next,b):g[0].get_widget()};w.get_json=function(a,b,c){var d=[],e=function(){var e=function(a,c){b({type:"nest",contents:d,guid:n,original_nest:a,serial_number:v,
name:this.get_name()},c)}.bind(this);r?h.UTILITIES.get_json(r,a,e,c):e(void 0,c)}.bind(this);h.UTILITIES.get_json_of_array(g,d,0,a,e,c)};w.copy=function(a){var c,d,e,f;if(a&&a.just_value){if(0<g.length&&(c=g[0].copy(a),!a.copy_covered_nests))return c;d=h.nest.create(this.get_description(),[],"in a robot's condition",void 0,v,this.get_name());c&&d.add_to_contents(c);return d}c=h.UTILITIES.copy_widget_sides(g,a);a?a.fresh_copy?d=h.nest.create(this.get_description(),c,n&&h.UTILITIES.generate_unique_id()):
(e=r||this,a.birds_copied&&a.birds_copied[n]?(f=e.get_guid(),a.nests_copied&&a.nests_copied[f]?(d=a.nests_copied[f][0].copy(),a.nests_copied[f].forEach(function(a){k.call(a,d)})):d=h.nest.create(this.get_description(),c,h.UTILITIES.generate_unique_id()),a.birds_copied[n].forEach(function(a){b.call(a,d)})):d=h.nest.create(this.get_description(),c,n,e,v,this.get_name()),a.nests_copied||(a.nests_copied={}),a.nests_copied[e]?a.nests_copied[f].push(d):a.nests_copied[f]=[d]):d=h.nest.create(this.get_description(),
c,n,r||this,v,this.get_name());return this.add_to_copy(d,a)};w.has_contents=function(){return 0<g.length};w.dropped_on_other=function(a,b,c){var d,e,g,f,l,m,k;if(!n){n=h.UTILITIES.generate_unique_id();h.debugging&&(this._debug_string=this.to_debug_string());d=h.bird.create(this);if(c){c.add_newly_created_widget(d);if(!this.visible())return;this.robot_waiting_before_next_step=c}b&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(d);h.sounds&&setTimeout(function(){h.sounds.hatching.play()},
1E3);this.rerender();e=this.get_frontside_element(!0);h.UTILITIES.add_animation_class(e,"toontalk-hatch-egg");l=function(){var l,n,u;if(a.is_backside())l=a;else if((l=h.UTILITIES.widget_side_of_jquery($(e).closest(".toontalk-top-level-backside")))||(l=h.UTILITIES.widget_side_of_jquery($(other.get_widget().get_frontside_element(!0)).closest(".toontalk-top-level-backside"))),l)l=l.is_backside()?l:l.get_backside();else{h.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");
return}n=l.get_element();u=$(n).offset();g=d.get_frontside_element(!0);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));h.UTILITIES.add_animation_class(g,"toontalk-fly-southwest");f=h.UTILITIES.relative_position(e,n);h.UTILITIES.set_css(g,{left:f.left,top:f.top});b&&this.robot_in_training()?l.widget_side_dropped_on_me(d,b,void 0,!0):l.widget_side_dropped_on_me(d,b);$(e).removeClass("toontalk-hatch-egg").addClass(this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",
height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&h.UTILITIES.set_css(e,{left:f.left-5,top:f.top+45});this.get_parent_of_frontside().render();k=function(){$(g).removeClass("toontalk-fly-southwest");h.UTILITIES.set_timeout(function(){h.UTILITIES.add_animation_class(g,"toontalk-fly-down");$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));m=function(){var a=function(){$(g).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);$(g).removeClass("toontalk-fly-down");h.UTILITIES.add_animation_class(g,"toontalk-bird-morph-to-static");h.UTILITIES.add_one_shot_event_handler(g,"animationend",1E3,a);c&&(this.robot_waiting_before_next_step=void 0,c.run_next_step());d.update_display()}.bind(this);h.UTILITIES.add_one_shot_event_handler(e,"animationend",1E3,m)}.bind(this))}.bind(this);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
d.animate_to_absolute_position({left:Math.max(10,f.left-70)+u.left,top:Math.max(10,f.top+70)+u.top},k,c&&c.transform_animation_speed(h.UTILITIES.default_animation_speed));this.rerender()}.bind(this);h.UTILITIES.add_one_shot_event_handler(e,"animationend",2E3,l)}return!0};w.widget_side_dropped_on_me=function(a,b,c){b&&a.save_dimensions&&a.save_dimensions();0===g.length?(this.add_to_contents(a,b,c),a.dropped_on_other?a.dropped_on_other(this,b,c):b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,
this)):a.drop_on(g[0],b,c);return!0};w.drop_on=function(a,b,c){return a.widget_side_dropped_on_me?(a.widget_side_dropped_on_me(this,b,c),!0):!1};w.element_to_highlight=function(){return 0===g.length?this.get_frontside_element():g[0].get_frontside_element()};w.update_display=function(){var a=this.get_frontside(!0),b=this.get_backside(),c,d,e,f,a=a.get_element();a.setAttribute("toontalk_name",this.get_name());0<g.length?(c=g[0],c.is_backside()?(f=c.get_element(!0),c.update_display(),c.scale_to_fit(f,
a)):(c.set_visible(!0),c.render(),f=g[0].get_element(!0),$(f).show()),d=$(a).width(),e=$(a).height(),0<d&&0<e&&h.UTILITIES.set_timeout(function(){var a=this.get_contents_dimensions();a&&(h.UTILITIES.set_css(f,{width:a.width,height:a.height,left:d*(1-h.nest.CONTENTS_WIDTH_FACTOR)/2,top:e*(1-h.nest.CONTENTS_HEIGHT_FACTOR)/2}),c.set_size_attributes&&c.set_size_attributes(a.width,a.height))}.bind(this),2),$(a).parent().is(".toontalk-box-hole")&&!$(a).parent().is(".toontalk-scale-half")?(a.parentElement.appendChild(f),
$(f).css({"z-index":h.UTILITIES.next_z_index()})):a.appendChild(f),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest")),g[0].is_backside()?c.set_parent_of_backside(this):c.set_parent_of_frontside(this)):(h.UTILITIES.give_tooltip(a,this.get_title()),n?($(a).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest"))):h.UTILITIES.add_animation_class(a,this.get_class_name_with_color("toontalk-nest-with-egg")));
$(a).addClass("toontalk-nest");b&&b.rerender()};l||(l=h.UTILITIES.generate_unique_id());w[l]=function(a,b){if(!J){if(b)return;J=[]}b?J.splice(J.indexOf(a),1):J.push(a)};w.get_contents_dimensions=function(){var a,b=this.get_frontside_element();a=$(b).parent().is(".toontalk-box-hole")&&!$(b).parent().is(".toontalk-scale-half")?b.parentElement:b;b=$(a).width();a=$(a).height();b*=h.nest.CONTENTS_WIDTH_FACTOR;a*=h.nest.CONTENTS_HEIGHT_FACTOR;var c=g[0],d;if(c)return d=c.is_box()?1:2,c=c.get_border_size?
d*c.get_border_size(b,a):0,{width:b-c,height:a-c}};w.get_path_to=function(a,b){var c,d;if(0<g.length){c=g[0].get_widget();if(c===a)return h.path.to_widget_on_nest();if(c.get_path_to&&(d=h.path.to_widget_on_nest(),c=c.get_path_to(a,b)))return d.next=c,d}};w.walk_children=function(a){if(0<g.length)return a(g[0])};w.top_contents_is=function(a){return 0<g.length&&g[0]===a};w.any_nest_copies_visible=function(){var a=!1;if(!J)return!1;J.some(function(b){b.visible()&&(a=!0)});return a};w.compare_with=function(a){if(0<
g.length)return g[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};w.compare_with_nest=function(a){return 0===g.length?0:1};w.compare_with_number=function(a){return 0<g.length?g[0].compare_with(a):-1};w.get_class_name_with_color=function(a){return v?a+["","-magenta","-yellow"][v%3]:a};w.generate_name=function(){t++;return"#"+t.toString()};w.has_name(w);G=w.set_name;w.set_name=function(a,b){var c=this.get_name();if(!G.call(this,a,b))return!1;b&&$(".toontalk-bird").each(function(){this.getAttribute("toontalk_name")===
c&&h.UTILITIES.widget_side_of_element(this).rerender()})};w.set_name(f);w.compare_with_box=w.compare_with_number;w.compare_with_scale=w.compare_with_number;w.add_standard_widget_functionality(w);C=w.set_visible;w.set_visible=function(a){C.call(this,a);a||this.set_locked(!1)};w.set_description(q);h.debugging&&(w._debug_id=h.UTILITIES.generate_unique_id(),w._debug_string=w.to_debug_string());r&&n&&(l||(l=h.UTILITIES.generate_unique_id()),r[l](w));return w};m.create_function=function(a,b,c){var d=function(){return!1},
e=h[b]&&h[b]["function"]&&h[b]["function"][c],d={get_function_type:function(a){return h[b].get_type_name(a)},get_function_object:function(){return e},set_function_name:function(a){if(c===a)return!1;c=a;e=h[b]&&h[b]["function"]&&h[b]["function"][c];this.add_to_contents=e.respond_to_message;return!0},is_function_nest:function(){return!0},copy:function(){return h.nest.create_function(a,b,c)},animate_bird_delivery:function(a,b,c,d,e){b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,e)},get_json:function(a,
c,d){c({type:"function_nest",function_type:b,function_name:e?e.name:h.UTILITIES.get_first_property(h[b]["function"])},d)},add_to_json:h.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return e.short_name},has_ancestor:d,visible:d,any_nest_copies_visible:d,is_backside:d};h.widget.has_parent(d);h.widget.has_description(d);h.widget.add_sides_functionality(d);d.set_description(a);e?(d.add_to_contents=e.respond_to_message,h.debugging&&(d._debug_id=h.UTILITIES.generate_unique_id(),
d._debug_string="a function nest that "+e.toString())):h.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+b+"."+c+" is not defined.");return d};h.creators_from_json.function_nest=function(a,b){return h.nest.create_function(a.description,a.function_type,a.function_name)};m.create_backside=function(){return h.nest_backside.create(this)};m.match_nest_with_nest=function(a){return"matched"};m.toString=function(){return"nest"};m.get_default_description=function(){return"a nest that receives things from its birds."};
m.get_help_URL=function(){return"docs/manual/birds-nests.html"};m.get_type_name=function(a){return a?"nests":"nest"};m.maintain_proportional_dimensions=function(){return!0};m.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};m.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};h.creators_from_json.nest=function(a,b){var c=!a.original_nest&&a.guid&&b&&b.guid_to_nest_table&&b.guid_to_nest_table[a.guid];c||(c=h.nest.create(a.description,
h.UTILITIES.create_array_from_json(a.contents,b),a.guid,a.original_nest&&h.UTILITIES.create_from_json(a.original_nest,b),a.serial_number,a.name),b.guid_to_nest_table[a.guid]=c);return c};m.CONTENTS_WIDTH_FACTOR=1;m.CONTENTS_HEIGHT_FACTOR=1;return m}(window.TOONTALK);window.TOONTALK.nest_backside=function(a){return{create:function(b){b=a.backside.create(b);b.add_description_setting();b.add_name_setting();return b}}}(window.TOONTALK)})();window.TOONTALK.scale=function(b){var k=Object.create(b.widget);k.create=function(e,c,a,h,m){var l=function(){a.rerender()},d,k,q;a||(a=b.box.create(2,void 0,e,c,m||""));d=a.get_json;k=a.copy;q=a.get_path_to;a.is_scale=function(){return!0};a.copy=function(c){var d;this.get_name();c||(c={});d=k.call(this,c);d=b.scale.create(void 0,void 0,d,c.just_value&&this.get_state());return a.add_to_copy(d,c)};a.get_json=function(a,b,c){var e=function(a,c){a.type="scale";a.inactive_state=this.get_inactive_state();
b(a,c)}.bind(this);d.call(this,a,e,c)};a.get_path_to=function(a,b){var c=q.call(this,a,b);c&&(c.true_type="scale");return c};a.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c)};a.widget_side_dropped_on_me=function(a,b,c){var d=this.get_hole_contents(0),e=this.get_hole_contents(1),h;a.dropped_on_other&&a.dropped_on_other(this,b,c);if(d&&!e)return this.get_hole(1).widget_side_dropped_on_me(a,b,c),!0;if(!d&&(e||!b))return this.get_hole(0).widget_side_dropped_on_me(a,
b,c),!0;h=this.which_hole(b,!1);if(0===h){if(d){if(d.drop_on)return a.drop_on(d,b,c);return}}else if(e){if(e.drop_on)return a.drop_on(e,b,c);return}this.get_hole(h).widget_side_dropped_on_me(a,b,c);return!0};a.which_hole=function(b,c){var d=$(a.get_frontside_element()),e=d.offset(),d=d.width(),e=b.clientX-(e.left+d/2),d=c?d/10:0;return-e>d?0:e>d?1:-1};a.get_inactive_state=function(){return h};a.update_display=function(){var a=this.get_frontside_element(!0),c=$(a),d=$(a).children(".toontalk-scale-half"),
e=$(a).parent(),e=e.is(".toontalk-backside")||c.is(".toontalk-conditions-contents")?a:e.get(0),f=$(e).width(),h=$(e).height(),l=function(a,c,d){var e=c.get_contents();c=(e||c).get_element(!0);var g,l,m;b.UTILITIES.set_css(a,{left:d*f*.5,top:0,width:.5*f,height:h});a!==c&&(g=0===d?-.05*f:.15*f,d="toontalk-scale-balanced"===k?.1*h:0===d&&"toontalk-scale-left_heavier"===k||1===d&&"toontalk-scale-right_heavier"===k?.25*h:1===d&&"toontalk-scale-left_heavier"===k||0===d&&"toontalk-scale-right_heavier"===
k?-.1*h:.2*h,l=.4*f,m=.4*h,$(c).css({left:g,top:d,width:l,height:m}),e&&(e.set_location_attributes&&e.set_location_attributes(g,d),e.set_size_attributes&&e.set_size_attributes(l,m),e.is_backside()&&(e.update_display(),e.scale_to(l,m)),e.render()),a.appendChild(c))},m,k;c.is(".toontalk-top-level-resource")?k="toontalk-scale-balanced":(m=this.get_state(),k="undefined"===typeof m?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][m+1]);
c.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");c.addClass(k);c.addClass("toontalk-scale");c=b.UTILITIES.scale_to_fit(a,e,123,91);0===f&&(f=1);0===h&&(h=1);f/=c.x_scale;h/=c.y_scale;2===d.length?d.each(function(a,c){b.UTILITIES.set_timeout(function(){l(c,this.get_hole(a),a)}.bind(this))}.bind(this)):this.get_holes().forEach(function(b,c){var d=b.get_element();0===c?$(d).addClass("toontalk-left_scale  toontalk-scale-half"):
$(d).addClass("toontalk-right_scale toontalk-scale-half");l(d,b,c);a.appendChild(d)});b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string())};a.render=function(){b.DISPLAY_UPDATES.pending_update(this)};a.get_type_name=function(a){return a?"scales":"scale"};a.get_help_URL=function(){return"docs/manual/scales.html"};a.toString=function(){var a=this.get_hole_contents(0),c=this.get_hole_contents(1),d,e,f;switch(this.get_state()){case -1:d="scale leaning to the right";
break;case 1:d="scale leaning to the left";break;case 0:d="balanced scale";break;default:if(d="unbalanced scale",!e&&!f)return d}e=a?"contains "+b.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";f=c?"contains "+b.UTILITIES.add_a_or_an(c.get_full_description()):"is empty";return d+" and the left pan "+e+" and the right pan "+f};a.create_backside=function(){return b.scale_backside.create(this)};a.get_state=function(){var a=this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);
b=this.get_hole_contents(1);if(a||b)if(a){if(!b)return 1;if(a.get_widget().compare_with)return a.get_widget().compare_with(b.get_widget())}else return-1};a.match=function(a){if(a.match_with_scale)return a.match_with_scale(this);this.last_match=a;return this};a.match_with_scale=function(a){var b;return this.get_state()===a.get_state()?"matched":(b=this.get_hole_contents(0))&&b.is_nest()&&!b.has_contents()?[[b,this]]:(b=this.get_hole_contents(1))&&b.is_nest()&&!b.has_contents()?[[b,this]]:a};a.compare_with=
function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};a.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};a.get_name_input_label=void 0;a.generate_name=function(){return""};a.get_hole(0).add_listener("value_changed",l);a.get_hole(1).add_listener("value_changed",l);a.get_hole_contents(0)&&a.get_hole_contents(0).add_listener("value_changed",l);a.get_hole_contents(1)&&a.get_hole_contents(1).add_listener("value_changed",l);
a.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};a.get_default_description=function(){return"a scale for comparing things."};a.set_name=void 0;b.debugging&&
(a._debug_id=b.UTILITIES.generate_unique_id(),a._debug_string=a.to_debug_string());return a};b.creators_from_json.scale=function(e,c){return k.create(b.UTILITIES.create_array_from_json(e.contents,c),e.description,void 0,e.inactive_state,e.name)};return k}(window.TOONTALK);window.TOONTALK.scale_backside=function(b){return{create:function(k){var e=b.backside.create(k);e.add_description_setting();e.get_element().appendChild(b.backside.create_advanced_settings_button(e,k));return e}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(b){var k=function(a,c,e,l,d){var k;e.current_action_name=c;(a=b.path.get_path_to(a,e))?(l||(l={}),k=Date.now(),l.time=k-e.time_of_last_step,e.time_of_last_step=k,e.add_step(b.robot_action.create(a,c,l),d)):console.log("No path found for "+c);e.current_action_name=void 0},e=Object.create(b.widget),c=0;e.create=function(a,c,m,l,d,k,q,g,n){var r=Object.create(e),v,f,w,y=[],E=[],N,D,J,G,C,I,L,H,M;m||(m=b.actions.create());v||(v=r);a&&a.set_parent_of_frontside(r);
r.is_robot=function(){return!0};r.get_frontside_conditions=function(){return a};r.set_frontside_conditions=function(b){a=b;a.set_parent_of_frontside(this)};r.get_backside_matched_widgets=function(){return M};r.set_backside_matched_widgets=function(a){M=a};r.get_matched_backside_widget=function(a){if(M)return M[L.indexOf(a)]};r.get_backside_widget_of_type=function(a,b){var c,d;if(M)return M[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&0>this.get_newly_created_widgets().indexOf(b))return d=
b,!0}.bind(this)),d};r.get_backside_conditions=function(){return c};r.set_backside_conditions=function(a){$.isArray(a)?c=a.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(c=[],b.UTILITIES.available_types.forEach(function(b){a[b]&&c.push(a[b])}));c&&c.forEach(function(a){a.is_backside()?a.set_parent_of_backside(this):(b.widget.erasable(a),a.set_parent_of_frontside(this))}.bind(this))};c&&r.set_backside_conditions(c);r.initialize_backside_conditions=function(){L=this.get_training_context().get_backside_widgets().slice();
H=b.UTILITIES.copy_widget_sides(L,{just_value:!0});this.set_backside_conditions([])};r.add_to_backside_conditions=function(a){var d;0<=this.get_newly_created_widgets().indexOf(a)||(c||(c=[]),a=L.indexOf(a),0<=a&&(d=H[a]),d&&0>c.indexOf(d)&&(c.push(d),b.widget.erasable(d)))};r.get_backside_condition_index=function(a){var b;M?(b=M.indexOf(a),0>b&&(b=M.length,M.push(a))):(b=0,M=[a]);return b};r.get_body=function(){return m};r.set_body=function(a){m=a};r.get_running=function(){return C||this.is_ok_to_run()};
r.running_or_in_run_queue=function(){return C};r.set_running_or_in_run_queue=function(a){C=a};r.stopped=function(){return I};r.set_stopped=function(a){if(I!==a){if(I=a)this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.drop_thing_in_hand(),this.rerender()),C=!1;this.get_next_robot()&&this.get_next_robot().set_stopped(a)}};r.drop_thing_in_hand=function(){d&&(d.drop_on(this.top_level_widget(),void 0,this),this.set_thing_in_hand(void 0))};r.finish_cycle_immediately=
function(a){var b=w,c=function(){w=b;this.set_visible(!1);a&&a()}.bind(this);w=0;this.add_body_finished_listener(c)};r.get_maximum_step_duration=function(){return w};r.get_context=function(){return N};r.set_context=function(a){N=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};r.context_is_backside=function(){return D};r.set_context_is_backside=function(a){D=a;this.get_next_robot()&&this.get_next_robot().set_context_is_backside(a)};r.get_top_level_context=function(){return J};r.set_top_level_context=
function(a){J=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};r.get_queue=function(){return G};r.set_queue=function(a){G=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};r.animate_consequences_of_actions=function(){return this.visible()&&0!==w};r.transform_step_duration=function(a){return void 0===a&&0===w||!this.visible()?0:n&&a?a/n:"number"===typeof w?Math.min(a,w):a};r.transform_original_step_duration=function(a){if(N&&!N.get_backside()||!this.visible())return 0;
if(!n)return a};r.transform_animation_speed=function(a){return N&&!N.get_backside()||!this.visible()?0:n?a*n:a};r.set_animating=function(a,c){var d=this.get_frontside_element(),e;a&&b.UTILITIES.visible_element(d)?(c||(c=$(d).offset()),$(d).css({width:"",height:"","z-index":b.UTILITIES.next_z_index()}),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c),e=$(d).closest(".toontalk-top-level-backside"),0<e.length&&e.get(0).appendChild(d),$(d).addClass("toontalk-robot-animating"),setTimeout(function(){$(d).addClass("toontalk-side-animating")},
2E3)):$(d).removeClass("toontalk-robot-animating toontalk-side-animating")};r.add_body_finished_listener=function(a){y.push(a)};r.run_body_finished_listeners=function(){y.forEach(function(a){a()});y=[]};r.add_watched_step_end_listeners=function(a){E.push(a)};r.run_watched_step_end_listeners=function(){E.forEach(function(a){a()});E=[]};r.get_thing_in_hand=function(){return d};r.set_thing_in_hand=function(a){if(b.debugging){if(a&&"empty hole"===a.get_type_name()){b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");
return}b.logging&&0<=b.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string()+" now has in his hand "+(a?a.to_debug_string():"nothing"))}d=a};r.get_next_robot=function(){return q};r.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());!a&&q&&(q.set_first_in_team(q),q.set_previous_robot(void 0));(q=a)&&q.set_previous_robot(this);b&&($(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=this.drop_area_instructions())};r.get_previous_robot=
function(){return f};r.set_previous_robot=function(a){f=a};r.get_first_in_team=function(){return v};r.set_first_in_team=function(a){v=a;q&&q.set_first_in_team(a)};r.walk_children=function(a){var b;q&&!a(q)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};r.get_run_once=function(){return k};r.set_run_once=function(a){k=a;this.update_title();return!0};r.get_watched_speed=function(){return n};r.set_watched_speed=function(a){n=a;return!0};r.can_run=function(){return this.get_frontside_conditions()&&
this.get_frontside_conditions().is_top_level()||b.widget.can_run.call(this)};r.training_started=function(a){var c=this.get_training_context();c?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(c.copy({just_value:!0})),this.initialize_backside_conditions(),a||($("*").css({cursor:"url("+b.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),this.update_title(),
a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):b.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};r.training_finished=function(){if(this.being_trained){var a,c,d;a=this.get_body().get_newly_created_widgets();for(c=0;c<a.length;c++)d=a[c],"drop it on top-level"!==d.last_action&&"copy"!==d.last_action||this.add_step(b.robot_action.create(b.newly_created_widgets_path.create(c),
"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):$("*").css({cursor:""})}};if(b.debugging||b.logging)r.to_debug_string=function(){var a=this.get_frontside_conditions();return"Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(a?
b.UTILITIES.add_a_or_an(a.toString()):"anything")};q&&r.set_next_robot(q);r.add_standard_widget_functionality(r);r.has_name(r);r.set_name(g);r.set_description(l);b.debugging&&(r._debug_id=b.UTILITIES.generate_unique_id(),r._debug_string=r.to_debug_string());return r};e.create_backside=function(){return b.robot_backside.create(this)};e.copy=function(a){var c=this.get_frontside_conditions(),e=this.get_backside_conditions(),c=c?c.copy({just_value:!0}):void 0,l=this.get_next_robot(),l=l?l.copy(a):void 0,
d;e&&(d=b.UTILITIES.copy_widgets(e,{just_value:!0}));e=this.create(c,d,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),l,(!a||!a.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(e,a)};e.match=function(a){var b,c;if(a.is_robot()&&(b=this.get_body().is_empty(),c=a.get_body().is_empty(),b===c))return"matched";this.last_match=a;return this};e.generate_name=function(){c++;return"#"+c.toString()};e.run=function(a,c,e,l){var d=this.get_frontside_conditions(),
k,q,g,n,r;if(this.being_trained||this.running_or_in_run_queue())return this;(r=this.get_backside())&&r.visible()&&(g=function(a){$(a.get_frontside_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},g(d),this.rerender());a?(this.set_context(a),this.set_context_is_backside(c),this.set_top_level_context(e),this.set_queue(l)):
a=this.get_context();this.match_status=b.UTILITIES.match(d,this.get_context());"matched"===this.match_status&&(n=[],(c=this.get_backside_conditions())&&0<c.length&&((k=a.get_backside_widgets())&&c.some(function(a){var c,d;a.matching_widget&&a.matching_widget.get_parent_widget_of_frontside()&&(c=b.UTILITIES.match(a,a.matching_widget),"matched"===c&&(n.push(a.matching_widget),d=c));d||k.some(function(e){c=void 0;if(!(0<=n.indexOf(e)||e.is_backside()||e===this)){g&&g(e);c=b.UTILITIES.match(a,e);if("matched"===
c)return n.push(e),d=c,a.matching_widget=e,!0;if(!c.is_widget)d=c;else if(!d||d.is_widget)d=c}}.bind(this));if("matched"!==d)return this.match_status=d,!0}.bind(this)),"matched"!==this.match_status&&(n=void 0),this.set_backside_matched_widgets(n)));if("matched"===this.match_status)return l||(l=this.get_queue()||b.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),l.enqueue(this),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),
this.rerender(),this.get_next_robot()?this.get_next_robot().run():this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){a=this.get_next_robot().run();if("matched"===a)return a;a.is_widget||a.forEach(function(a){0>this.match_status.indexOf(a)&&this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(q=function(){this.set_waiting(!1);this.run()}.bind(this),this.match_status.forEach(function(a){a[0]?
a[0].run_when_non_empty(q,this):a.run_when_non_empty(q,this)}.bind(this)),this.set_waiting(!0));return this.match_status};e.set_waiting=function(a){var c=this.get_frontside_element();c&&(a?this.visible()&&(b.UTILITIES.add_animation_class(c,"toontalk-robot-waiting"),b.UTILITIES.give_tooltip(c,"This robot is waiting for a bird to deliver something.")):($(c).removeClass("toontalk-robot-waiting"),b.UTILITIES.give_tooltip(c,this.get_title())))};e.run_actions=function(){return this.stopped()?(this.get_first_in_team().set_running(!1),
!1):this.get_first_in_team().visible()?this.get_body().run_watched(this):this.get_body().run_unwatched(this)};e.drop_from_data_transfer=function(a,b){var c;a.is_top_level&&a.is_top_level()?(c=a.get_backside_widgets().slice(),setTimeout(function(){c.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=1E3;this.dropped_on(a,b.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};e.ignore_pick_up_or_drop=function(a){return this===a.get_widget()||
a.is_top_level()||this.get_parent_of_frontside()===a};e.picked_up=function(a,c,e){var l,d;if(!this.ignore_pick_up_or_drop(a))return a.get_infinite_stack&&a.get_infinite_stack()?this.current_action_name="pick up a copy of":this.current_action_name="pick up",e?(d=a,c=a.copy({fresh_copy:!0}),c=b.path.get_path_to_resource(c)):c=b.path.get_path_to(a,this),c&&(e=Date.now(),l={time:e-this.time_of_last_step},this.time_of_last_step=e,l=b.robot_action.create(c,this.current_action_name,l),this.add_step(l,d)),
a.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(a),l};e.dropped_on=function(a,c){var e,l,d,k,q;if(!(this.ignore_pick_up_or_drop(a)||this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===a)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(e=b.path.get_path_to(c,this))c.is_backside()?(d=$(c.get_element()),l=d.offset(),
k=d.width(),q=d.height(),d=$(a.get_frontside_element()).offset(),k=(d.left-l.left)/k,l=(d.top-l.top)/q,k=Math.max(0,Math.min(1,k)),l=Math.max(0,Math.min(1,l)),l={left_offset_fraction:k,top_offset_fraction:l}):l={},d=Date.now(),l.time=d-this.time_of_last_step,this.time_of_last_step=d,e=b.robot_action.create(e,this.current_action_name,l),this.add_step(e);a.last_action=this.current_action_name+" "+c.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};e.dropped_on_text_area=
function(a,b,c){k(a,"drop it on the text area of",this,c);a.last_action="drop it on the text area of "+b.get_type_name();this.set_thing_in_hand(void 0)};e.copied=function(a,b,c){c=c?"pick up a copy of":"copy";k(a,c,this,void 0,b);b.last_action=c};e.removed=function(a){var b;this.get_parent()&&(b=this.get_parent().get_widget());k(a,"remove",this);a.last_action="remove";b===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};e.edited=
function(a,b){k(a,"edit",this,b)};e.erased_widget=function(a){k(a,"change whether erased",this)};e.resized_widget=function(a,b,c,e,d){b===e&&c===d||k(a,"change size of",this,{x_factor:e/b,y_factor:d/c})};e.started_training_another=function(a){k(a,"start training",this)};e.finished_training_another=function(a){k(a,"stop training",this)};e.trained=function(a,b){k(a,"train",this,{step:b})};e.backside_opened=function(a){k(a,"open the backside",this)};e.backside_closed=function(a){a.is_primary_backside()?
k(a.get_widget(),"close the backside",this):this.removed(a)};e.button_clicked=function(a,b){k(b.get_widget(),"click the button of",this,{button_selector:a})};e.created_widget=function(a,c,e){this.add_newly_created_widget(a);a.get_parent()||this.add_to_top_level_backside(a,!1);this.add_step(b.robot_action.create(b.path.get_path_to_resource(a.copy()),"add a new widget to the work space",{button_selector:e,path_to_source:b.path.get_path_to(c,this)}))};e.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};
e.remove_from_container=function(a,b){var c=b.get_index_of&&a.get_parent_of_frontside()&&b.get_index_of(a),e=function(){b.removed_from_container(a,void 0,c,!0)};this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(e):e();this.add_newly_created_widget_if_new(a)};e.get_training_context=function(){return this.get_first_in_team().get_parent_of_frontside().get_widget()};e.add_step=function(a,b){this.get_body().add_step(a,b);this.update_title();"train"!==a.get_action_name()&&"start training"!==
a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,a)};e.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var c=this.get_thing_in_hand(),e,l;b.debugging&&(this._debug_string=this.to_debug_string());e=a.get_element();c&&(l=c.get_element());!l&&this.carrying_tool&&(l=document.createElement("div"),$(l).addClass(this.carrying_tool));b.UTILITIES.give_tooltip(e,this.get_title());$(e).addClass("toontalk-robot");$(e).children(".toontalk-held-by-robot").remove();
l&&e.appendChild(l);this.match_status&&(this.match_status.is_widget?$(e).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(e).removeClass("toontalk-robot-not-matched"));e.setAttribute("toontalk_name",this.get_name());b.UTILITIES.set_timeout(function(){var a,b,k,g,n;l&&(n={position:"absolute"},$(l).addClass("toontalk-held-by-robot"),a=$(l).width(),$(l).height(),k=$(e).width(),g=$(e).height(),c&&0===a&&(a=c.get_default_width?c.get_default_width():2*k,b=c.get_default_height?c.get_default_height():
g/2,n.width=a,n.height=b),n.left=(k-a)/2,n.top=g/4,$(l).css(n),c&&c.rerender())})};e.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};e.add_newly_created_widget_if_new=function(a){if(a!==this.get_training_context()&&this!==a)return this.get_body().add_newly_created_widget_if_new(a)};e.is_newly_created=function(a){return this.get_body().is_newly_created(a)};e.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-
1]};e.get_title=function(){var a=this.get_description();if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?"Drag this robot to a work area.":this.toString()};e.toString=function(a){var c,e,l,d,k,q,g,n,r,v,f,w,y;if(a&&"conditions"===a.role)return"any robot";if(a&&"match_status"===a.role)return"robot "+this.get_name();c=this.get_frontside_conditions();if(!c)return"an untrained robot";g=c.is_top_level();
a||(a={});f=a.person;if(a&&a.resource){if(this.get_description())return'"'+this.get_description()+'"';a.person="third"}e=this.get_backside_conditions();d=this.get_body();q=k="";r=this.get_next_robot();g?v="When the workspace's green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" is pressed":(n=b.UTILITIES.add_a_or_an(c.get_full_description({role:"conditions"})),v="When working on something that matches "+n);e&&(e.forEach(function(a){a&&(v+=" and\nif on the"+
(g?" work area ":" back ")+" is "+b.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),l=!0)}),l&&(v+="\n"));if(this.being_trained){if(d.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";k="is being trained.\n";q="\n..."}d=k+v+(a&&"third"===a.person?" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(d.toString({robot:this})||"do nothing")+q;if(a&&a.resource)return a.person=f,d.replace(/\n/g," ");this.match_status&&
(this.match_status.is_widget?(y=c.is_top_level()?"the work area I'm running on":"the "+c.get_type_name()+" I'm on the back of",this.match_status===c?w=y:this.match_status.has_ancestor(c)?w="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+y:(c.is_top_level()||(y="the "+this.match_status.get_type_name()+" on "+y),e.some(function(a){if(this.match_status===a)return w="any "+a.get_type_name(!0)+" on ",c.is_top_level()||(w+="the back of "),w+=y,!0;if(this.match_status.has_ancestor(a))return w=
"any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+y,!0}.bind(this))),d="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+w+". Perhaps editing my conditions will help.\n"+d):"matched"!==this.match_status&&(d="I'm waiting for something to be delivered to the nest that matches the "+this.match_status[0][1]+" in my conditions (highlighted in yellow on my backside).\n"+
d));r&&(d+="\nIf it doesn't match then the next robot will try to run.\n"+r.toString());return d};e.get_type_name=function(a){return a?"robots":"robot"};e.maintain_proportional_dimensions=function(){return!0};e.matching_resource=function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&this.get_body().is_empty()&&a.get_body().is_empty()};e.get_top_level_context_description=function(a){var b=this.get_frontside_conditions().get_type_name();return"top-level"===
b?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+b+" he's working on":"the "+b+" I'm working on"};e.get_help_URL=function(){return"docs/manual/robots.html"};e.drop_area_instructions=function(){return this.get_next_robot()?"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};e.get_json=function(a,c,e){var l=this.get_frontside_conditions(),d=this.get_backside_conditions(),k,q=function(){var d=function(d,
e){var f=function(a,b){c({type:"robot",frontside_conditions:a,backside_conditions:k,body:g,run_once:this.get_run_once(),next_robot:d,name:this.get_name(),speed:this.get_watched_speed()},b)}.bind(this);this.get_body().get_json(a,function(c,d){g=c;l?l.is_top_level()?f({type:"top_level"},d):b.UTILITIES.get_json(l,a,f,d):f(void 0,d)},e)}.bind(this);this.get_next_robot()?b.UTILITIES.get_json(this.get_next_robot(),a,d,e):d(void 0,e)}.bind(this),g;d?(k=[],b.UTILITIES.get_json_of_array(d,k,0,a,q,e)):q()};
b.creators_from_json.robot=function(a,c){var e,l,d,k;a.thing_in_hand&&(l=b.UTILITIES.create_from_json(a.thing_in_hand,c));a.next_robot&&(e=b.UTILITIES.create_from_json(a.next_robot,c));a.backside_conditions&&($.isArray(a.backside_conditions)?k=b.UTILITIES.create_array_from_json(a.backside_conditions,c):a.semantic&&b.UTILITIES.available_types.forEach(function(c){a.semantic.backside_conditions[c]&&k.push(b.UTILITIES.get_json(a.semantic.backside_conditions[c],json_history))}));d=b.UTILITIES.create_from_json(a.frontside_conditions||
a.bubble,c);e=b.robot.create(d,k,void 0,a.description,l,a.run_once,e,a.name,a.speed);c||(c={});c.robot=e;e.set_body(b.UTILITIES.create_from_json(a.body,c));return e};e.find_conditions_path=function(a,c,e){var l=c.get_frontside_conditions(),d=l===a?"entire_condition":l.get_path_to&&l.get_path_to(a,e),l=b.path.get_path_to(c,e),k;d||(c=c.get_backside_conditions(),c.some(function(b){b&&(d=b.get_path_to(a,e))&&(k=b)}));if(d)return b.robot.create_conditions_path(d,l,k);b.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};
e.create_conditions_path=function(a,c,e){"string"===typeof e&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===e)return e=a,!0});return{dereference_path:function(l){var d=b.path.dereference_path(c,l),d=e?e:d.get_frontside_conditions();return"entire_condition"===a?d:b.path.dereference_path(a,l,d)},toString:function(){var l="entire_condition"===a?"the ":b.path.toString(a)+" of the ";return e?l+e.toString()+" backside condition of "+b.path.toString(c):l+" front side condition of "+
b.path.toString(c)},get_json:function(l,d,k){var q=function(b,k){c.get_json(l,function(b,c){var g=function(a,c){d({type:"path_to_robot_conditions",backside_condition:e&&a,path_to_robot:b,path_within_conditions:a},c)};"entire_condition"===a?g("entire_condition",c):a.get_json(l,g,c)},k)};e?b.UTILITIES.get_json(e,l,q,k):q(void 0,k)}}};b.creators_from_json.path_to_robot_conditions=function(a){var c=b.UTILITIES.create_from_json(a.path_to_robot),e="entire_condition"===a.path_within_conditions?a.path_within_conditions:
b.UTILITIES.create_from_json(a.path_within_conditions);a=a.backside_condition&&b.UTILITIES.create_from_json(a.backside_condition);return b.robot.create_conditions_path(e,c,a)};return e}(window.TOONTALK);window.TOONTALK.robot_backside=function(b){var k=function(c,a,e,k){c=b.UTILITIES.create_text_element(c);var l=a.get_element(!0),d=document.createElement("div"),t=function(){var c;a.visible()&&($(l).parent().addClass("toontalk-conditions-contents-container"),a.update_display(),c={width:$(d).width(),
height:$(d).height(),left:"",top:""},a.use_scaling_transform?a.use_scaling_transform(c):a.is_backside()&&b.UTILITIES.scale_element(l,c.width,c.height,a.get_original_width()||$(l).width(),a.get_original_height()||$(l).height(),void 0,c),$(l).css(c),a.rerender())};$(l).addClass("toontalk-conditions-contents "+k);e.match_status&&(e.match_status.is_widget?$(e.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==e.match_status&&e.match_status.forEach(function(a){$(a[1].get_frontside_element()).addClass("toontalk-conditions-waiting")}));
d.appendChild(l);e=b.UTILITIES.create_horizontal_table(c,d);$(e).addClass("toontalk-conditions-panel");b.UTILITIES.run_when_dimensions_known(l,function(){setTimeout(t,100)});return e},e=function(c,a){var e=a.get_frontside_conditions(),m=a.get_backside_conditions(),l=a.visible(),d;e&&(e.is_top_level()?0>c.firstChild.textContent.indexOf("I always run when the green flag")&&c.insertBefore(b.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),
c.firstChild):0===$(c).find(".toontalk-frontside-conditions-area").length&&c.insertBefore(k("I run only if the thing I'm on the back of matches: ",e,a,"toontalk-frontside-conditions-area"),c.firstChild),e.set_visible(l),e.rerender());m&&m.forEach(function(e){var h;e&&(h=e.get_type_name(),d="toontalk-backside-"+h+"-conditions-area",h="bird"===h?b.UTILITIES.create_text_element("And there is a bird on the back."):k("And if "+b.UTILITIES.add_a_or_an(h)+" matches: ",e,a,d),c.insertBefore(h,c.firstChild.nextSibling),
e.set_visible(l),e.rerender())})};return{create:function(c){var a=b.backside.create(c),h=a.get_element(),k=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},l=b.UTILITIES.create_check_box(!c.get_run_once(),"toontalk-run-once-check-box","When finished start again",k(c.get_run_once())),d="normal;original;double;half;very fast;very slow".split(";"),
t=[1,void 0,2,.5,10,.25],q=function(a){a=d.indexOf(a);return t[a]},g=b.UTILITIES.create_select_menu("robot_speed",d,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),n=b.UTILITIES.create_drop_area(c.drop_area_instructions()),r=c.get_next_robot(),v=
b.backside.create_advanced_settings_button(a,c),f=a.update_display.bind(a),w=function(a,b){var c=a.get_frontside_element(!0),d,e;a.get_default_width&&(d=a.get_default_width(),e=a.get_default_height(),$(c).css({left:"",top:"",width:d,height:e}));b.appendChild(c)},y=a.hide_backside,E=a.add_advanced_settings;a.hide_backside=function(a){y.call(this,a);c.being_trained&&c.training_finished()};$(n).data("drop_area_owner",c);l.button.addEventListener("click",function(a){var d=l.button.checked;c.set_run_once(!d);
b.UTILITIES.give_tooltip(l.container,k(!d));c.robot_in_training()&&c.robot_in_training().edited(c,{setter_name:"set_run_once",argument_1:!d,toString:"change to "+(d?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});a.stopPropagation()});g.menu.value=function(a){a=a?t.indexOf(a):0;return d[a]}(c.get_watched_speed());g.menu.addEventListener("change",function(a){c.set_watched_speed(q(a.target.value))});r&&w(r,n);n.addEventListener("drop",function(a){a=b.UTILITIES.get_dragee();
(a=b.UTILITIES.widget_side_of_jquery(a))&&a.is_robot()&&(a.get_body().is_empty()?(a=a.open_backside(),$(a.get_element()).find(".toontalk-train-backside-button").click()):(w(a,n),c.set_next_robot(a)))});a.get_next_robot_area=function(){return n};a.update_display=function(){var a=c.get_frontside_element();a&&b.UTILITIES.give_tooltip(a,c.get_title());f()};b.UTILITIES.when_attached(h,function(){var a=c.get_backside_conditions(),b=c.get_frontside_conditions();a&&a.forEach(function(a){a.set_visible(!0)});
b&&b.set_visible(!0)});h.appendChild(this.create_train_button(a,c));e(h,c);h.appendChild(v);a.add_advanced_settings=function(){E.call(a,l.container,g.container,n)};return a},create_train_button:function(c,a){var h=c.get_element();$(h);var k=$("<button>Train</button>").button(),l=!1;k.addClass("toontalk-train-backside-button");c.change_label_and_title_of_train_button=function(c){c?(k.button("option","label","Stop training "+a.get_name()),b.UTILITIES.give_tooltip(k.get(0),"Click to stop training this robot.")):
a.get_body().is_empty()?(k.button("option","label","Train"),b.UTILITIES.give_tooltip(k.get(0),"Click to start training this robot.")):(k.button("option","label","Re-train "+a.get_name()),b.UTILITIES.give_tooltip(k.get(0),"Click to start training this robot all over again."));b.UTILITIES.visible_element(h)&&e(h,a)};c.change_label_and_title_of_train_button(l);k.get(0).addEventListener("click",function(b){l=!l;c.change_label_and_title_of_train_button(l);l?(a.initialize_backside_conditions(),a.get_body().reset_steps(),
a.robot_started_training(a),a.training_started()):a.training_finished();b.stopPropagation()});return k.get(0)}}}(window.TOONTALK)})();(function(){var b=function(b){return"rotate"===b||"skewX"===b||"skewY"===b||"transform-origin-x"===b||"transform-origin-y"===b},k=function(e){return"transform-origin-x"===e||"transform-origin-y"===e?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+e:b(e)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+e:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+e};window.TOONTALK.element=function(e){var c=["left","top","width","height"],a=Object.create(e.widget),h=
function(a,b){var c,e;if(!a)return 0;"number"===typeof a&&(e=a);0===a.length&&(e=0);if("undefined"===typeof e&&(c=a.substring(a.length-1),0<="0123456789x".indexOf(c)&&(e=parseFloat(a),isNaN(e))))return;c=e;0<=["rotate","skewX","skewY"].indexOf(b)&&(c%=360,0>c&&(c+=360));return c},m=function(a,b){var c,e,g;if((b.left||b.top)&&!a.being_dragged&&(c=a.get_parent_of_frontside()))return b.left&&(e=c.is_element()?c.get_original_width():c.get_width(),e=0<e?(b.left%e+e)%e:b.left,b.left!==e&&(b.left=e,g=!0)),
b.top&&(c=c.is_element()?c.get_original_height():c.get_height(),c=0<c?(b.top%c+c)%c:b.top,b.top!==c&&(b.top=c,g=!0)),g};a.create=function(c,d,h,k,g,n,r,v){var f=Object.create(a),w=e.UTILITIES.generate_unique_id(),y=f.drag_started,E={},N={},D,J,G,C,I,L,H,M,O,R,p,u,A,F,P,X;d||(d=["left","top","width","height"]);f.is_element=function(){return!0};f.get_HTML=function(){return C};f.get_guid=function(){return w};f.get_text=function(){var a,b;return void 0===I&&((a=this.get_frontside_element())?I=a.textContent:
(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),I=a.textContent,$(a).remove()):I=b,""===I&&a&&"IMG"!==a.nodeName&&(this.update_display(),I=a.textContent),""===I)?this.get_HTML():I};f.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>c)break;b+=3;d=a.indexOf("target='_blank'",b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+
a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(C===a)return!1;C=c(a);if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element()?b.innerHTML=C.replace(/ /g,"&nbsp;"):b.innerHTML=C;L&&this.compute_original_dimensions(!0);return!0};f.set_HTML_from_sub_classes=f.set_HTML;f.set_text=function(a){var b=this.get_frontside_element(),c=function(b){$(b).contents().each(function(){this.nodeType==
Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};f.get_style_attributes=function(){return d};f.set_style_attributes=function(a){d=a};f.get_attribute_widgets_in_backside_table=function(){return E};f.set_attribute_widgets_in_backside_table=function(a){E=a};f.get_original_copies=function(){return N};f.get_pending_css=function(){return p};f.get_transform_css=
function(){return u};f.add_to_css=function(a,c){b(a)?(u||(u={}),u[a]=c):(p||(p={}),p[a]=c)};f.apply_css=function(){var a="",b,c;(p||u)&&(b=this.get_frontside_element())&&!$(b).is(".toontalk-not-observable")&&(jQuery.contains(window.document,b)?(p?(p.width&&(O=p.width),p.height&&(R=p.height)):p={},p.position="absolute",u&&("number"===typeof u.rotate&&(a+="rotate("+u.rotate+"deg)"),"number"===typeof u.skewX&&(a+="skewX("+u.skewX+"deg)"),"number"===typeof u.skewY&&(a+="skewY("+u.skewY+"deg)"),"number"===
typeof u["transform-origin-x"]||"number"===typeof u["transform-origin-y"])&&(p["transform-origin"]=(u["transform-origin-x"]||0)+" "+(u["transform-origin-y"]||0)),O||R?(F&&F.css({width:H,height:M}),this.is_plain_text_element()&&this.plain_text_dimensions(),$(b).css({width:"",height:""}),c=p,e.UTILITIES.run_when_dimensions_known(b,function(d){var g=this.get_parent_of_frontside();m(this,c);e.UTILITIES.scale_element(b,O,R,H,M,a,c,d,!g);p=void 0}.bind(this))):(m(this,p),e.UTILITIES.add_transform_to_css(a,
"",p,0>b.parentElement.className.indexOf("toontalk-box-hole")),$(b).css(p),p=void 0)):e.UTILITIES.when_attached(b,this.apply_css.bind(this)))};f.on_update_display=function(a){A?A.push(a):A=[a]};f.fire_on_update_display_handlers=function(){A&&e.UTILITIES.set_timeout(function(){A.forEach(function(a,b){a()||A.splice(b,1)})})};f.get_image_element=function(){return F};f.set_image_element=function(a,b){F=$(a).find("img");0===F.length?F=void 0:($(b).width(F.width()),$(b).height(F.height()))};f.get_additional_classes=
function(){return v};f.set_additional_classes=function(a){v=a};f.get_children=function(){return k};f.set_sound_effect=function(a){D=a;D.volume=e.UTILITIES.get_audio_volume(D)};f.get_sound_effect=function(){return D};f.get_video_object=function(){var a;J||(a=this.get_frontside_element())&&(J=a.getElementsByTagName("video")[0]);return J};f.set_video_object=function(a){J=a};f.get_ignore_pointer_events=function(){return r};f.set_ignore_pointer_events=function(a){r=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?
"none":"auto"})};f.get_source_URL=function(){return G};f.set_source_URL=function(a){if(G!==a)return G=a,this.refresh(),!0};f.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===H?e.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),function(){e.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,H,M,void 0,a)}.bind(this)):e.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,H,M,void 0,a)};f.add_standard_widget_functionality(f);
P=f.set_running.bind(f);f.set_running=function(a,b){P(a,b);Object.keys(E).forEach(function(c){E[c].set_running(a,b)});!a&&this.visible()&&(d.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());k.forEach(function(c){c.set_running(a,b)})};X=f.can_run.bind(f);f.can_run=function(){var a;if(X())return!0;Object.keys(E).some(function(b){if(E[b].can_run())return a=!0});if(a)return a;k.some(function(b){if(b.can_run())return a=!0});return a};f.drag_started=function(a,
b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;y.call(this,a,b)};f.update_display=function(){var a=this.get_frontside_element(!0);this.get_backside();var b=function(a){return this.get_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged)if(this.get_erased()){var c;c=$(a).parent(".toontalk-backside").is("*")?b="":b="100%";this.save_dimensions();$(a).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:b,
height:c,transform:""});$(a).parent(".toontalk-conditions-contents-container").is("*")?e.UTILITIES.give_tooltip(a,"This is an element that has been erased. It will match any element."):e.UTILITIES.give_tooltip(a,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(a).is(".toontalk-erased-element")&&($(a).removeClass("toontalk-erased-element"),this.restore_dimensions()),this.initialize_element(),e.UTILITIES.on_a_nest_in_a_box(a)&&(this.set_attribute("width",
$(a).closest(".toontalk-box-hole").width(),!1),this.set_attribute("height",$(a).closest(".toontalk-box-hole").height(),!1)),"undefined"===typeof H&&a.parentElement&&(this.is_plain_text_element()?this.plain_text_dimensions():this.compute_original_dimensions()),this.apply_css(),k?k.forEach(function(b){a.appendChild(b.get_frontside_element(!0));b.set_visible(!0);b.update_display()}):k=[],this.fire_on_update_display_handlers(),e.UTILITIES.give_tooltip(a,"Click to see the backside where you can place robots or change the style of this "+
b(a)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};f.initialize_element=function(){var a,b;!L&&(a=this.get_frontside_element())&&($(a).children(".ui-resizable-handle"),C=this.get_HTML(),b=this.is_plain_text_element(),a.innerHTML=b?C.replace(/ /g,"&nbsp;"):C,$(a).addClass("toontalk-element-frontside"),b?((b=this.get_additional_classes())&&$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.location_constrained_by_container()||this.plain_text_dimensions()):
$(a).addClass("toontalk-non-plain-text-element"),L=!0)};f.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};f.plain_text_dimensions=function(){H=9*this.get_HTML().length;M=24};f.compute_original_dimensions=function(a){e.UTILITIES.original_dimensions(this,function(a,b){var c=this.get_parent_of_frontside();H=a;M=b;c&&c.get_box?c.get_box().rerender():(d.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),a)};f.get_attribute_from_current_css=
function(a){var b,c;if("width"===a&&(O||H))return O||H;if("height"===a&&(R||M))return R||M;b=this.get_frontside_element(!0);c=e.UTILITIES.get_style_numeric_property(b,a);""===c&&(c=$(b).css(a));if(!c)return 0;if("number"===typeof c){if(H&&R){if("left"===a)return c+(H-O)/2;if("top"===a)return c+(M-R)/2}return c}return"%"!==c.charAt(c.length-1)||"left"!==a&&"top"!==a?c:$(b).offset()[a]};f.get_original_width=function(){return H};f.get_original_height=function(){return M};f.increment_width=function(a){this.set_attribute("width",
(O||H)+a)};f.increment_height=function(a){this.set_attribute("height",(R||M)+a)};f.get_width=function(){return O};f.get_height=function(){return R};f.add_child=function(a){var b=$(a.get_frontside_element(!0)),c=$(this.get_frontside_element(!0)),d;k.push(a);a.set_parent_of_frontside(this);d=e.UTILITIES.set_position_relative_to_element(b,c,b.offset(),!0);a.is_element()&&a.set_location_attributes(d.left,d.top);c.get(0).dispatchEvent(e.UTILITIES.create_event("widget added",{element_widget:b.get(0),where:"front"}));
this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)};f.removed_from_container=function(a,b){var c=k.indexOf(a);0<=c&&k.splice(c,1)};f.set_HTML(c.toString());f.set_description(h);g&&("string"===typeof g?f.set_sound_effect(new Audio(g)):f.set_sound_effect(g));n&&("string"===typeof n?c="<video src='"+n+"' alt='"+n+"'/>":J=n);e.debugging&&(f._debug_id=e.UTILITIES.generate_unique_id(),f._debug_string=f.to_debug_string());k?k.forEach(function(a){a.set_parent_of_frontside(f)}):k=[];return f};
a.copy=function(b){var c=this.get_style_attributes(),h=a.create(this.get_HTML(),c.slice(),this.get_description(),e.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),k=this.get_attribute_widgets_in_backside_table(),g={},m=h.get_backside(this.visible());h.set_source_URL(this.get_source_URL());b&&(b.elements_copied||(b.elements_copied={}),b.elements_copied[this.get_guid()]=h);Object.keys(k).forEach(function(a){g[a]=k[a].copy(b);
g[a].set_parent_of_frontside(m,!1,!0);h.set_attribute(a,this.get_attribute(a))}.bind(this));h.set_attribute_widgets_in_backside_table(g);return this.add_to_copy(h,b)};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};a.match_with_any_element=function(){return"matched"};a.match_with_another_element_widget=
function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};a.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};a.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};a.get_path_to=function(b,c){var e=this.get_children(),h=e.indexOf(b),g,k;if(0<=h)return a.path.create(h);e.forEach(function(e,h){e.get_path_to&&
(k=e.get_path_to(b,c))&&(g=a.path.create(h),g.next=k)});return g};e.creators_from_json.element_path=function(b,c){var h=a.path.create(b.index);b.next&&(h.next=e.UTILITIES.create_from_json(b.next,c));return h};a.dereference_path=function(a,b){var c,h;if(a){c=a.get_index&&a.get_index();if(!e.debugging||"number"===typeof c)if(h=this.get_children(),c=h[c]){if(c.dereference_contents&&!a.not_to_be_dereferenced)return c.dereference_contents(a.next||a,b);if(a.next){if(c.dereference_path)return c.dereference_path(a.next,
b);e.UTILITIES.report_internal_error("Expected to refer to a child of "+c+" but it lacks a method to obtain "+e.path.toString(a.next))}a.removing_widget&&(c.get_infinite_stack()||b.remove_from_container(c,this));return c}e.UTILITIES.report_internal_error(this+" unable to dereference the path: "+e.path.toString(a))}else return this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+e.UTILITIES.ordinal(a)+" widget "},get_json:function(b,c,e){c({type:"element_path",
index:a,next:this.next&&this.next.get_json(b)},e)}}}};a.widget_side_dropped_on_me=function(a,b,c){if(a.is_backside())return!1;this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};a.create_backside=function(){return e.element_backside.create(this)};a.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};a.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a),
c;"left"===a?(c=this.get_frontside_element(),c=e.UTILITIES.translate_x(c)):"top"===a?(c=this.get_frontside_element(),c=e.UTILITIES.translate_y(c)):c=0;return"undefined"!==typeof b&&"auto"!=b?b+c:this.get_attribute_from_current_css(a)+c};a.set_attribute=function(a,b,c,k){var g=this.get_frontside(!0).get_element(),m;if(!g)return!1;m="left"===a?e.UTILITIES.translate_x(g):"top"===a?e.UTILITIES.translate_y(g):0;g=this.get_attribute_from_pending_css(a);b-=m;if(g===b||"undefined"===typeof g&&(g=this.get_attribute_from_current_css(a),
g===b))return!1;m=h(b,a);if("number"===typeof m){if(g==m)return!1;e.logging&&0<=e.logging.indexOf("attribute:")&&0<=e.logging.indexOf(a)&&console.log("Attribute "+a+" set to "+m+" was "+g+" at "+Date.now()+" for "+this);b=m}c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:a,argument_2:b,toString:"change the '"+a+"' style to "+b+" of",button_selector:".toontalk-element-"+a+"-attribute-input"});this.add_to_css(a,b);k&&(b=this.get_style_attributes(),
0>b.indexOf(a)&&b.push(a));this.rerender();return!0};a.dropped_on_style_attribute=function(a,b,c,e){var g,h,k;if(a){g=a.toString();if(a.is_number()){h=this.get_attribute(b);if("number"===typeof h)k=h;else if("auto"===h)switch(b){case "left":k=$(this.get_frontside_element()).offset().left;break;case "top":k=$(this.get_frontside_element()).offset().top;break;default:k=0}else k=parseFloat(h);h=a.to_float();switch(g.substring(0,1)){case "-":g=k-h;break;case "*":g=k*h;break;case "/":g=k/h;break;case "^":g=
Math.pow(k,h);break;default:g=k+h}this.set_attribute(b,g,!1);(c||e&&e.visible())&&this.get_backside().render()}a.get_infinite_stack()||a.remove();c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};a.get_attribute_widget_in_backside_table=function(a,b,c){var e=this.get_attribute_widgets_in_backside_table()[a];e||b||(e=this.create_attribute_widget(a,c),this.get_attribute_widgets_in_backside_table()[a]=e);return e};a.create_attribute_widget=function(a,
b){var h=".toontalk-element-"+a+"-attribute-input",q=this.get_backside_element(),g=this.get_attribute(a),n=this,r=function(a,b){var c=b.toString,d=b.equals,g=b.remove;N=b.update_display;b.element_widget=this;b.attribute=a;b.get_type_name=function(a){return a?"element attributes":"element attribute"};b.toString=function(){return c.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};b.get_default_description=function(){return"a number that is the "+this.attribute+" of "+this.get_attribute_owner().toString({plain_text:!0})+
"."};b.get_custom_title_prefix=function(){return"I'm the '"+this.attribute+"' attribute of "+this.get_attribute_owner()+".\nDrop a number on me or edit my backside to change my value. My backside has an info button to learn more."};b.equals=function(b){return a===b.attribute?this.equals(b.element_widget):d.call(this,b)};b.update_display=function(){var a,b,c;this.get_erased()||(a=this.get_attribute_owner(),a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_element()&&!a.being_dragged?(c={},
b=bigrat.toDecimal(this.get_value()),c[this.attribute]=b,m(a,c)&&this.set_value(c[this.attribute]),$(a.get_frontside_element()).css(c)):(a=a.get_attribute(this.attribute),E(a)));N.call(this)};y=b.copy.bind(b);b.copy=function(b){var c;if(b){if(b.just_value)return y(b);b.elements_copied&&(c=b.elements_copied[n.get_guid()])}return this.add_to_copy((c||n).create_attribute_widget(a),b)};b.get_json=function(b,c,d){e.UTILITIES.get_json(n,b,function(b,d){c({type:"attribute_widget",attribute_name:a,element:b},
d)},d)};b.get_original_attribute_widget=function(){var b=n.get_original_copies()[a];return b&&b[0]};b.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():n;if(!b.get_widget().is_element())return n;b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=
b.get_parent_of_backside();return b};b.remove=function(b,c){var d=n.get_original_copies()[a],e=d&&d.indexOf(this);0<=e&&d.splice(e,1);g.call(this,b,c)};b.get_help_URL=function(){return k(a)}}.bind(this),v=function(a,b){var c=e.number.create(0,1);r(a,c);c.set_value_from_decimal(b);c.set_format("decimal");c.set_value=function(b){try{var c=n.get_original_copies()[a],d="number"===typeof b?b:bigrat.toDecimal(b),g=bigrat.fromDecimal(d);this.get_attribute_owner().set_attribute(this.attribute,d)&&c.forEach(function(a,
b){a.set_value_from_sub_classes(g,!0)});return this.set_value_from_sub_classes(g,!1)}catch(f){return e.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+f),!1}};c.is_attribute_widget=function(){return!0};c.get_function_type=function(a){return a?"numbers":"number"};return c}.bind(this),f=function(a,b){var c=e.element.create(b);r(a,c);c.set_HTML=function(b){var c=n.get_original_copies()[a],d;this.get_attribute_owner().set_attribute(this.attribute,b)&&c.forEach(function(a,
c){d=a.set_HTML_from_sub_classes(b)});return d};c.get_function_type=function(a){return a?"elements":"element"};c.set_additional_classes("toontalk-string-attribute-widget");return c}.bind(this),w;w=0<=["background-color","color"].indexOf(a)?"string":"number";var y,E,N,D,J;q&&(h=$(q).find(h),0<h.length&&(h.get(0).toontalk_widget_side=this));if("number"===w){if(D=v(a,g),E=D.set_value_from_decimal.bind(D),0<=c.indexOf(a)&&(this.on_update_display(function(){D.rerender();return!0}),"left"===a||"top"===
a))J=function(b){var c,d,e;b.currentTarget.toontalk_widget_side===D.get_attribute_owner()&&(c=D.get_attribute_owner(),b.stopPropagation(),d=$(c.get_frontside_element()).closest(".toontalk-top-level-backside").offset(),d||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),d={left:0,top:0}),e=b.pageX-d.left-(c.drag_x_offset||0),d=b.pageY-d.top-(c.drag_y_offset||0),"left"===a?(b=e,c.set_attribute("top",d)):(b=d,c.set_attribute("left",
e)),D.set_value_from_decimal(b),N.call(D))},D.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",J);b&&b.get_widget().is_element()&&b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",J)})}else if("string"===w)D=f(a,g),E=D.set_HTML.bind(D);else{e.UTILITIES.report_internal_error("Unrecognized attribute type: "+w+" for "+a);return}(g=this.get_original_copies()[a])?g.push(D):this.get_original_copies()[a]=
[D];return D};e.creators_from_json.attribute_widget=function(a,b){return e.UTILITIES.create_from_json(a.element,b).create_attribute_widget(a.attribute_name,b)};e.creators_from_json.attribute_number=e.creators_from_json.attribute_widget;a.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};a.toString=function(a){var b=function(b){var c="";return 1<b.length&&"<"===b.charAt(0)?(this.get_image_element()&&
(c="style='width: 50px; height: 30px;'"),a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'"),"<div "+c+">"+b+"</div>"):'"'+b+'"'}.bind(this),c=function(){var a=this.get_HTML(),b=a.indexOf("alt="),c;return 0<=b&&(c=a.indexOf("'",b+5),0<=c)?"("+a.substring(b+5,c)+")":""}.bind(this),h=this.get_children();if(a&&!a.inside_tool_tip){if(a.for_json_div)return"";b=c();b||(b=(b=this.get_source_URL())?"whose text is the contents of "+b:(b=this.get_text())?'"'+b+'"':"")}else b=b(this.get_HTML());
h&&0<h.length&&(b+=" with "+e.UTILITIES.describe_widgets(h)+" on top");return"the element "+b};a.get_type_name=function(a){return a?"elements":"element"};a.get_help_URL=function(){return"docs/manual/elements.html"};a.get_json=function(a,b,c){var h=this.get_style_attributes(),g=e.UTILITIES.remove_z_index(this.get_HTML()),k=encodeURIComponent(g),m=[],v;100<=g.length?(a.shared_html||(a.shared_html=[]),g=a.shared_html.indexOf(k),0>g&&(g=a.shared_html.push(k)-1),v={shared_html_index:g}):v=k;k=function(){var g=
[],k=function(n){var E=function(){k(n+1)},N,D;n>=h.length?b({type:"element",html:v,attributes:h,attribute_values:h.map(this.get_attribute.bind(this)),attributes_backsides:g,additional_classes:this.get_additional_classes(),children:0<this.get_children().length&&m,sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()},c,a):(N=h[n],(N=
this.get_attribute_widget_in_backside_table(N,!0))?(D=[],g.push(D),e.UTILITIES.get_json_of_array(N.get_backside_widgets(),D,0,a,E,c)):(g.push(null),E()))}.bind(this);k(0)}.bind(this);0<this.get_children().length?e.UTILITIES.get_json_of_array(this.get_children(),m,0,a,k,c):k()};e.creators_from_json.element=function(b,c){var k=decodeURIComponent("string"===typeof b.html?b.html:c.shared_html&&c.shared_html[b.html.shared_html_index]),m,g,n,r;b.children&&(g=c.is_child,c.is_child=!0,m=e.UTILITIES.create_array_from_json(b.children,
c),c.is_child=g);if(!k&&(k="string"===typeof b.html?"No json.html recreating an element widget.":"additional_info.shared_html missing while recreating an element widget.",!e.debugging))throw k;r=a.create(k,b.attributes,b.description,m,b.sound_effect,b.video,b.ignore_pointer_events);n=c&&c.event?["left","top"]:[];b.attribute_values.forEach(function(a,g){var k=b.attributes[g],m=b.attributes_backsides&&b.attributes_backsides[g];(c.is_child||0>n.indexOf(k))&&(0!==a||"width"!==k&&"height"!==k)&&r.add_to_css(k,
h(a)||a);m&&(k=r.get_attribute_widget_in_backside_table(k,!1,c),e.UTILITIES.add_backside_widgets_from_json(k,m,c))}.bind(this));b.additional_classes&&r.set_additional_classes(b.additional_classes);b.source_URL&&(r.set_source_URL(b.source_URL),r.refresh());m&&e.UTILITIES.when_attached(function(){m.forEach(function(a,c){var d=b.children[c].widget&&b.children[c].widget.view;d&&e.UTILITIES.set_css(a.get_frontside_element(!0),{left:d.frontside_left,top:d.frontside_top})})});return r};a.create_attribute_path=
function(a,b){var c=e.path.get_path_to(a.element_widget,b,!0);return this.extend_attribute_path(c,a.attribute)};a.refresh=function(){this.get_source_URL()&&e.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};a.extend_attribute_path=function(a,b){return{dereference_path:function(c){return a.dereference_path(c,c.get_top_level_context()||c.get_context()).get_widget().get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+
b+"' property of "+a},get_json:function(c,e,g){a.get_json(c,function(a,c){e({type:"path_to_style_attribute",attribute:b,element_widget_path:a},c)},g)}}};e.creators_from_json.path_to_style_attribute=function(b){var c=e.UTILITIES.create_from_json(b.element_widget_path);return a.extend_attribute_path(c,b.attribute)};a.set_size_attributes=function(a,b,c){c?(this.add_to_css("width",a),this.add_to_css("height",b)):(this.set_attribute("width",a),this.set_attribute("height",b));e.UTILITIES.set_timeout(function(){this.rerender()}.bind(this))};
a.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};a.receive_HTML_from_dropped=function(a){var b=a.get_text&&a.get_text();a.remove();if(this.set_HTML(b))return this.get_text()};a.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};a.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=
this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):"top"===a&&(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};a.remove_style_attribute=function(a){var b=this.get_style_attributes();a=b.indexOf(a);
0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return a}(window.TOONTALK);window.TOONTALK.element_backside=function(b){var c=function(a,c,k){var d;k.visible()&&(d=c.get_style_attributes(),c.get_frontside_element(),$(a).empty(),d.forEach(function(d){c.get_attribute(d);var q=document.createElement("tr"),g=document.createElement("td"),n=k.is_primary_backside()?c.get_attribute_widget_in_backside_table(d):k.get_widget().create_attribute_widget(d),r=n.get_frontside_element(!0);
n.set_parent_of_frontside(k,!1,!0);n.set_infinite_stack(!0);a.appendChild(q);q.appendChild(g);g.appendChild(b.UTILITIES.create_text_element(d));g=document.createElement("td");q.appendChild(g);n.set_visible(!0);$(r).addClass("toontalk-element-attribute");g.appendChild(r)}))},a=function(a,c){var k=$("<button>Add or remove my style attributes</button>").button();k.addClass("toontalk-show-attributes-chooser-button");k.get(0).addEventListener("click",function(d){b.UTILITIES.visible_element(a)?($(a).hide(),
k.button("option","label","Add or remove my style attributes"),b.UTILITIES.give_tooltip(k.get(0),"Click to add widgets for my style attributes.")):($(a).show(),k.button("option","label","Hide my style attributes list"),b.UTILITIES.give_tooltip(k.get(0),"Click to hide my list of attributes that can be added or removed."));c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",c)});b.UTILITIES.give_tooltip(k.get(0),"Click to add widgets for my style attributes.");
return k.get(0)};return{create:function(h){var m=b.backside.create(h),l=m.get_element();h.get_HTML();var d=document.createElement("table"),t=document.createElement("div"),q=a(t,h),g=b.backside.create_advanced_settings_button(m,h),n=b.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),r=b.UTILITIES.get_current_url_boolean_parameter("elementHTML",
!0),v=r?"get_HTML":"get_text",f=m.update_display.bind(m),w=m.add_advanced_settings,y,E,N,D,J,G,C,I,L,H;h.initialize_element();y=h[v]().trim();0<y.length&&!h.get_image_element()&&(N=function(a){(a=b.UTILITIES.input_area_drop_handler(a,h.receive_HTML_from_dropped.bind(h),h))&&h.robot_in_training()&&h.robot_in_training().dropped_on_text_area(a,h,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},E=b.UTILITIES.create_text_area(y,"toontalk-html-input",
"My HTML is","Type here to edit the text.",N),y=function(a){a=E.button.value.trim().replace(/\xA0/g," ");h.get_frontside_element();var b=r?"set_HTML":"set_text";h[b](a)&&h.robot_in_training()&&h.robot_in_training().edited(h,{setter_name:b,argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(E.container).css({width:"100%"}),$(E.button).css({width:"100%"}),E.button.addEventListener("change",y),E.button.addEventListener("mouseout",y),h.is_plain_text_element()&&
l.appendChild(E.container),h.get_source_URL()&&(N=function(a){var c=b.UTILITIES.input_area_drop_handler(a,h.receive_URL_from_dropped.bind(h),h);c&&h.robot_in_training()&&h.robot_in_training().dropped_on_text_area(c,h,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});a.stopPropagation()},y=function(a){a=D.button.value.trim().replace(/\xA0/g," ");h.get_frontside_element();h.set_source_URL(a)&&h.robot_in_training()&&h.robot_in_training().edited(h,
{setter_name:"set_source_URL",argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},D=b.UTILITIES.create_text_input(h.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,N),D.button.addEventListener("change",y),D.button.addEventListener("mouseout",y),l.appendChild(D.container)));m.update_style_attribute_chooser=function(){var a=function(a,g,f){var h=0<=f.get_style_attributes().indexOf(a),l=b.UTILITIES.create_check_box(h,
"toontalk-style-attribute-check-box",a+"&nbsp;","Click to add or remove the '"+a+"' style attribute from my backside."),m="toontalk-style-attribute-check-box-for-"+a,h=b.UTILITIES.create_anchor_element("i",k(a)),n=document.createElement("li");$(h).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(h).css({color:"white"});h.translate=!1;h.lang="en";l.container.appendChild(h);$(l.button).addClass(m);l.button.addEventListener("click",function(b){l.button.checked?f.add_style_attribute(a):
f.remove_style_attribute(a);c(d,f,f.get_backside());f.robot_in_training()&&f.robot_in_training().edited(f,{setter_name:l.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:a,toString:(l.button.checked?"add":"remove")+" a widget for the "+a+" attribute of",button_selector:"."+m})});n.appendChild(l.container);g.appendChild(n)},g=function(b,c,d){var e,f;"string"===typeof b?a(b,c,d):b.label?(e=document.createElement("h3"),e.textContent=b.label,f=document.createElement("ul"),c.appendChild(e),
c.appendChild(f),g(b.sub_menus,f,d)):b.forEach(function(a){g(a,c,d)})};$(t).is(".ui-accordion")&&$(t).accordion("destroy");$(t).empty();g([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x",
"transform-origin-y"]}],t,h);$(t).accordion({active:0,heightStyle:"content"});return t};m.get_attributes_chooser=function(){return t};m.add_advanced_settings=function(){var a;w.call(m);a=$(l).children(".toontalk-advanced-settings-table");0<a.length&&(a.get(0).appendChild(n.container),a.get(0).appendChild(t),a.get(0).appendChild(q),h.is_plain_text_element()||a.get(0).appendChild(E.container))};h.get_sound_effect()?(C=h.get_sound_effect(),I=function(){m.visible()&&(C.paused?(b.UTILITIES.give_tooltip(J.get(0),
"Click to begin playing this sound."),J.button("option","label","Play sound")):(b.UTILITIES.give_tooltip(J.get(0),"Click to pause this sound."),J.button("option","label","Pause sound")))},J=$("<button>Play sound</button>").button(),J.addClass("toontalk-play-sound-effect-button"),y=function(a){C.paused?(b.UTILITIES.play_audio(C),C.addEventListener("ended",I)):C.pause();I();h.robot_in_training()&&h.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",h)},J.get(0).addEventListener("click",
y),I(),l.appendChild(J.get(0))):$(h.get_frontside_element()).find("video").is("*")&&(L=h.get_video_object(),H=function(){m.visible()&&(L.paused?(b.UTILITIES.give_tooltip(G.get(0),"Click to begin playing this video."),G.button("option","label","Play video")):(b.UTILITIES.give_tooltip(G.get(0),"Click to pause this video."),G.button("option","label","Pause video")))},G=$("<button>Play video</button>").button(),G.addClass("toontalk-play-video-button"),y=function(a){L.paused?(L.play(),L.addEventListener("ended",
H)):L.pause();H();h.robot_in_training()&&h.robot_in_training().button_clicked(".toontalk-play-video-button",h)},G.get(0).addEventListener("click",void 0),H(),l.appendChild(G.get(0)));m.update_style_attribute_chooser();c(d,h,m);l.appendChild(d);l.appendChild(g);$(t).hide();$(t).addClass("toontalk-attributes-chooser");m.update_display=function(){E&&$(E.button).val(h[v]());c(d,h,m);b.UTILITIES.visible_element(t)&&m.update_style_attribute_chooser();h.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&
a.rerender()});f()};$(l).find(".toontalk-hide-backside-button").each(function(a,b){b.addEventListener("click",function(){$(t).hide()})});n.button.checked=!h.get_ignore_pointer_events();n.button.addEventListener("click",function(){h.set_ignore_pointer_events(!n.button.checked)});return m}}}(window.TOONTALK);window.TOONTALK.element["function"]=function(b){var c=b.create_function_table();c.add_function_object("join text",function(a,h,k){var l="";return c.typed_bird_function(a,function(){for(i=0;i<arguments.length;i++)l+=
arguments[i].get_text();return b.element.create(l)},[void 0],void 0,"join",h,k)},"The bird will return with a new element that is made by joining all the elements and numbers.","join",["any number of numbers or elements"]);c.add_function_object("part of text",function(a,h,k){return c.typed_bird_function(a,function(a,c,h){c=Math.round(c.to_float());h=Math.round(h.to_float());return b.element.create(a.get_text().substring(c+1,h+1))},["element","number","number"],3,"part of text",h,k)},"The bird will return with a new element whose text is the part of the text of the first element (or number) beginning with the first number ending with the second number. 1 is for the first letter.",
"part",["an element followed by two postive numbers"]);c.add_function_object("length of text",function(a,h,k){return c.typed_bird_function(a,function(a){return b.number.create(a.get_text().length)},[void 0],1,"length of text",h,k)},"The bird will return with a number that is length of the text of the first element (or number).","length",["an element or number"]);c.add_function_object("text as number",function(a,h,k){return c.typed_bird_function(a,function(a){a=a.get_text();var c;c=a.indexOf("/");
0<=c?c=b.number.create(a.substring(0,c),a.substring(c+1,a.length)):(c=b.number.create(0),c.set_value_from_decimal(a));return c},[void 0],1,"text as number",h,k)},"The bird will return with a number that has the same text as the element. Arithmetic can be done on the result unlike the original text.","text as number",["an element"]);c.add_function_object("go to page",function(a,h,k){return c.typed_bird_function(a,function(a){this.robot_in_training()?b.UTILITIES.display_message("Robot trained to replace current URL."):
window.location.assign(a.get_text())},["element"],1,"replace page",h,k)},"The bird will cause the current page to be replaced by the new URL. The back button should return to the current page.","page",["an element containing a URL"]);return c.get_function_table()}(window.TOONTALK)})();window.TOONTALK.sensor=function(b){var k=Object.create(b.widget),e=function(b,a){"element"===b.get_type_name()&&(b.set_additional_classes("toontalk-string-value-from-sensor"),a.visible()&&b.rerender())};k.create=function(c,a,h,m,l,d,t){var q=b.nest.create(h,m,"sensor",void 0,void 0,t||"sensor"),g=q.get_json,n=q.update_display,r=q.set_running,v=q.copy,f=a.split(" "),w,y=function(a){switch(typeof a){case "number":a=b.number.create(Math.round(a),1);break;case "string":a=b.element.create(a,void 0,void 0,
void 0,void 0,void 0,"toontalk-string-value-from-sensor");e(a,q);break;case "boolean":a=b.element.create(a.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");e(a,q);break}return a},E=function(a){var d,e,g;if(q.get_active()){d=w(a);e=q.get_attributes();g=q.visible();a=$(q.get_frontside_element()).closest(".toontalk-top-level-backside");if(1===d.length){if(d=y(d[0]),"undefined"===typeof d)return}else d=b.box.create(d.length,!0,d.map(y),"the values of the "+b.UTILITIES.conjunction(e)+
" attributes of "+b.UTILITIES.add_a_or_an(c)+" event.",e.join(";"));g?(g=b.bird.create(q),q.add_to_top_level_backside(g),d.render(),g.animate_delivery_to(d,q,q,a.width()/2,a.height())):q.add_to_contents(d)}}.bind(this);q.is_sensor=function(){return!0};q.copy=function(a){var e;if(a&&a.just_value&&this.has_contents())return v.call(this,a);e=a?b.sensor.create(c,this.get_attributes_string(),h,void 0,a.copying_resource||l,d,this.get_name()):b.sensor.create(c,this.get_attributes_string(),h,void 0,l,d,this.get_name());
return q.add_to_copy(e,a)};q.get_json=function(a,e,f){var h=function(g,f){var h;g.type="sensor";g.event_name=c;g.attribute=this.get_attributes_string();g.active=l;d?(h=function(a){g.sensor_of=a;e(g,f)},b.UTILITIES.get_json(d,a,h,f)):e(g,f)}.bind(this);g.call(this,a,h,f)};q.update_display=function(){var a=$(this.get_frontside_element());n.call(this);l||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):(a.addClass("toontalk-sensor-inactive-nest"),
a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};q.get_type_name=function(a){return a?"sensors":"sensor"};q.get_help_URL=function(){return"docs/manual/sensors.html"};q.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+c+" events"};q.get_class_name_with_color=function(a){return a};q.get_active=function(){return!0===l};q.restore_active=function(){"temporarily false"===l&&this.set_active(!0)};q.set_active=function(a,b){if(l!==
a||b)!0===a?d?d.get_frontside_element(!0).addEventListener(c,E):window.addEventListener(c,E):d?d.get_frontside_element(!0).removeEventListener(c,E):window.removeEventListener(c,E),l=a};q.set_running=function(a){this.set_active(a);r.call(this,a)};q.set_active(l,!0);q.create_backside=function(){return b.sensor_backside.create(this)};q.get_event_name=function(){return c};q.set_event_name=function(a){var b=l;c&&l&&this.set_active(!1);c=a;b&&this.set_active(!0)};q.get_attributes=function(){return f};q.set_attributes=
function(a){f=a.split(" ")};q.get_attributes_string=function(){return f.join(" ")};q.match=function(a){this.last_match=a;return this};q.set_sensor_of=function(a){d=a};q.get_custom_title_prefix=function(){var a="When a '"+c+"' event"+(d?" to "+d:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";l?this.get_backside()||(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the 'Listening to events' check box on my back is ticked.";
return a};q.get_default_description=function(){return d?"a sensor for "+d.get_default_description():"a sensor for this document."};q.can_run=function(){return!0};w=function(a){return q.get_attributes().map(function(c){var d=a[c];if("key"===c&&void 0===d){if(d=a.keyIdentifier,0===d.indexOf("U+"))return String.fromCharCode(a.keyCode)}else if("undefined"===typeof d){if(a.detail&&a.detail.element_widget&&("widget"===c||"back"===c))return c=b.UTILITIES.widget_side_of_element(a.detail.element_widget).create_backside(),
c.save_dimensions(),c;if(a.detail&&a.detail.element_widget&&"front"===c)return b.UTILITIES.widget_side_of_element(a.detail.element_widget);if(a.detail&&void 0!==a.detail[c])return a.detail[c];d="No "+c+" in event "+a+" of sensor "+k;b.UTILITIES.display_message(d)}return d})};return q};b.creators_from_json.sensor=function(c,a){var h=b.UTILITIES.create_array_from_json(c.contents,a),k=b.sensor.create(c.event_name,c.attribute,c.description,h,!1,void 0,c.name);c.sensor_of?b.UTILITIES.set_timeout(function(){k.set_sensor_of(b.UTILITIES.create_from_json(c.sensor_of,
a));k.set_active(c.active)}):k.set_active(c.active);0<h.length&&setTimeout(function(){h.forEach(function(a){e(a.get_widget(),k)})},500);return k};return k}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(b){return{create:function(k){var e=b.UTILITIES.create_text_input(k.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+k.get_event_name()),c=b.UTILITIES.create_text_input(k.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
a=b.UTILITIES.create_check_box(k.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),h=b.nest_backside.create(k),m=h.get_element(),l=function(){k.set_event_name(e.button.value.trim())},d=function(){k.set_attributes(c.button.value.trim())},t=b.backside.create_advanced_settings_button(h,k),q=function(b){var c=a.button.checked;k.set_active(c);k.robot_in_training()&&k.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:c,toString:"change to "+(c?"active":"inactive")+" of the "+k,button_selector:".toontalk-sensor-active-check-box"});k.render();b.stopPropagation()},g=h.add_advanced_settings;m.appendChild(t);h.add_advanced_settings=function(){var b;e.button.addEventListener("change",l);c.button.addEventListener("change",d);a.button.addEventListener("click",q);g.call(h,e.container,c.container);b=$(m).children(".toontalk-advanced-settings-table");0<b.length&&b.get(0).appendChild(a.container)};return h}}}(window.TOONTALK);window.TOONTALK.tool=function(b){document.addEventListener("mousemove",function(k){b.tool.pageX=k.pageX;b.tool.pageY=k.pageY});return{add_listeners:function(k,e){var c,a,h,m,l,d=function(d){var l=k.getBoundingClientRect();e.set_held&&e.set_held(!0);m=l.height;d&&d.preventDefault();setTimeout(function(){e.held&&!e.held()||$(k).addClass("toontalk-tool-held")},200);c=$(k).offset();document.addEventListener("mousemove",q);document.addEventListener("touchmove",q);document.addEventListener("mouseup",g);
document.addEventListener("touchend",g);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_down at "+Date.now());h=a=0;$(".ui-tooltip").each(function(){$(this).hide()})},t=function(c){var g=k.getBoundingClientRect();e.held&&e.held()||d(c);a=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",c)-g.left;h=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",c)-g.top},q=function(c){var d=b.UTILITIES.find_widget_on_page_side(c,k,a,h-m/2),e,g,q;c.preventDefault();$(".ui-tooltip").each(function(){$(this).hide()});
g=n(c);q=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",c)-g.deltaX-a;c=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",c)-g.deltaY-h;k.style.left=q+"px";k.style.top=c+"px";b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_move at "+Date.now()+" now at "+k.style.left+", "+k.style.top);if(d&&d.get_widget().is_top_level())l&&(b.UTILITIES.remove_highlight(),l=void 0);else{if(d&&(e=d.get_element(),e===l))return;l=e;b.UTILITIES.highlight_element(l)}},g=function(d){var n=
b.UTILITIES.find_widget_on_page_side(d,k,a,h-m/2),f;d.preventDefault();e.set_held&&e.set_held(!1);l&&b.UTILITIES.remove_highlight();n&&n.top_level_widget&&(f=n.top_level_widget(),e.apply_tool(n,d),f.backup_all());!n&&e.nothing_under_tool&&e.nothing_under_tool();$(k).removeClass("toontalk-tool-held");$(k).addClass("toontalk-tool-returning");b.UTILITIES.add_one_shot_event_handler(k,"transitionend",1E3,function(){$(k).removeClass("toontalk-tool-returning")});b.UTILITIES.set_timeout(function(){k.style.left=
c.left+"px";k.style.top=c.top+"px"});document.removeEventListener("mousemove",q);document.removeEventListener("touchmove",q);document.removeEventListener("mouseup",g);document.removeEventListener("touchend",g);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_up at "+Date.now(),alert(b.debugging),b.debugging="touch")},n=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,
deltaY:c}};k.addEventListener("mousedown",t);k.addEventListener("touchstart",t);return d}}}(window.TOONTALK);window.TOONTALK.vacuum=function(b){var k=Object.create(null),e={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},c={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},a={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},h=!1,m;k.create=function(){var l,d,t,q=[],g=function(a){t!==a&&(t=a,b.sounds&&b.sounds.click.play(),$(l).removeClass(d),
d=c[t],$(l).addClass(d),n())},n=function(){"restore"===t&&0===q.length?b.UTILITIES.give_tooltip(l,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):b.UTILITIES.give_tooltip(l,e[t])};document.addEventListener("keyup",function(a){var c=String.fromCharCode(a.keyCode);if(a.altKey){if(0>"SsEeRrAa".split("").indexOf(c))return;l||(k.the_vacuum.get_element(),$(l).css({left:b.tool.pageX,top:b.tool.pageY}),document.body.appendChild(l));m()}k.the_vacuum.held()&&
("s"===c||"S"===c?g("suck"):"e"===c||"E"===c?g("erase"):"r"===c||"R"===c?g("restore"):"a"===c||"A"===c?g("suck_all"):b.sounds&&b.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){k.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});b.vacuum.the_vacuum={apply_tool:function(a,c){var d=a.get_widget(),e=function(a){c&&d.robot_in_training()&&d.robot_in_training().removed(a);a.is_primary_backside&&a.is_primary_backside()?a.hide_backside():
a===d.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):(d.is_bird()&&b.sounds&&b.sounds.bird_fly.pause(),a.is_backside()||(a.save_dimensions_of(a),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),q.push(a),a.set_running&&a.set_running(!1),a.is_backside()||a.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove(c,!0))},g,h,k;"suck"===t?a.remove&&!a.get_widget().is_top_level()&&
(e(a),b.sounds&&b.sounds.vacuum_suck.play()):"erase"===t||"restore"===t&&a.get_erased&&a.get_erased()?a.is_top_level()||(g=!a.get_erased(),b.sounds&&(g?b.sounds.vacuum_suck.play():b.sounds.vacuum_spit.play()),a.set_erased(g,!0),c&&d.robot_in_training()&&d.robot_in_training().erased_widget(a,g)):"restore"===t?0<q.length&&(g=q.pop(),g.restore_dimensions(),k=a.add_to_top_level_backside(g,!0),h=$(l).offset(),h.left-=$(k).width(),b.UTILITIES.set_absolute_position(k,h),g.this_and_walk_children&&(g.this_and_walk_children(function(a){a.is_sensor()&&
a.restore_active();return!0}),b.sounds&&b.sounds.vacuum_spit.play())):"suck_all"===t&&(g=a.top_level_widget(),h=g.get_backside_widgets().slice(),0<h.length&&b.sounds&&(b.sounds.vacuum_suck.play(),b.sounds.bird_fly.pause()),h.forEach(function(a){a&&d!==d.robot_in_training()&&e(a)}),g.set_backside_widgets([]))},nothing_under_tool:function(){g(a[t])},get_element:function(){l||(l=document.createElement("div"),$(l).addClass("toontalk-vacuum"),m=b.tool.add_listeners(l,this),g("suck"),n());return l},held:function(){return h},
set_held:function(a){h=a}};return b.vacuum.the_vacuum};b.creators_from_json.vacuum=function(a,c){var e=b.vacuum.create();a.mode&&b.UTILITIES.set_timeout(function(){e.set_mode(a.mode)});return e};return k}(window.TOONTALK);window.TOONTALK.wand=function(b){var k=Object.create(null);k.create=function(){var e;return{apply_tool:function(c){var a;c.is_top_level()||(b.sounds&&b.sounds.magic.play(),a=c.add_copy_to_container(),c.robot_in_training()&&c.robot_in_training().copied(c,a,!1))},get_element:function(){e||(e=document.createElement("div"),$(e).addClass("toontalk-wand"),b.UTILITIES.give_tooltip(e,"I'm a magic wand. Drag me over the thing you want me to copy."),b.tool.add_listeners(e,this));return e}}};b.creators_from_json.wand=
function(){return b.wand.create()};return k}(window.TOONTALK);window.TOONTALK.SETTINGS=function(b){var k=[],e=function(e,m,l){var d=[],t=b.UTILITIES.create_local_files_table(),q=function(a,d){var k=function(a){a||d.newPanel.appendChild(b.UTILITIES.create_text_element("Error connecting to cloud"))},m=d.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();d.newPanel.is(".toontalk-programs-in-cloud-table")?m?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):c(d.newPanel,"program",e,l,k):d.newPanel.is(".toontalk-pages-in-cloud-table")?
m?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):c(d.newPanel,"page",e,l,k):($("#tab-0_info").show(),$("#tab-0_wrapper").show())};d[0]="Programs stored in browser";k[0]=t;m?(d[1]="Programs in cloud",k[1]=b.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),d[2]="Published pages",k[2]=b.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table"),m=b.UTILITIES.create_tabs(d,k),l.appendChild(m),$(m).on("tabsactivate",q)):l.appendChild(b.UTILITIES.create_tabs(d,k));a(e,t,
!0,l);$(t).on("draw.dt",function(){a(e,t,!1,l)})},c=function(c,e,k,d,t){b.google_drive.get_toontalk_files(!1,e,function(q){var g;"string"===typeof q?g=q:q.error&&(g=q.error.message);g?"Need to authorize"===g||"Login Required"===g?b.google_drive.authorize(t):(console.log(g),console.log("Google drive status: "+b.google_drive.get_status()),t(null)):(g="program"===e&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",b.UTILITIES.become_file_data_table(c,q.items,!0,g),c.on("draw.dt",
function(){a(k,c.get(0),!0,d)}),t(c.get(0)))})},a=function(a,b,c,d){var e=function(b){var e=function(){$(d).remove()},k=function(){a.set_setting("program_name",b.target.textContent);a.load(c,e)}.bind(this);a.save(!0,void 0,k)};b=$(b).find(".toontalk-file-load-button-without-click-handler");b.each(function(a,b){b.addEventListener("click",e)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(a){var c=document.createElement("div"),k=a.get_backside_element(),d=a.get_setting("program_name"),
t=b.UTILITIES.create_text_input(d,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),q=b.UTILITIES.create_close_button(function(){$(c).remove()},"Click to close the settings panel."),g=b.UTILITIES.create_text_element("How should your program be saved?"),n=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_google_drive"),"toontalk-save-setting","Save automatically to my Google Drive",'Check this if you want your programs automatically saved to a "ToonTalk Programs" folder in your Google Drive.'),
r=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage","Check this if you want your programs automatically saved in this browser's local storage."),v=b.UTILITIES.create_button("Save to Google Drive now","toontalk-save-button","Click to save your program now to your Google Drive account.",function(){a.save(!0,{google_drive:!0})}),f=b.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button",
"Click to save your program now to this browser's local storage.",function(){a.save(!0,{local_storage:!0})}),w=b.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){b.google_drive.authorize(function(){$(w).remove()})}),y=b.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){b.UTILITIES.display_message("Creating your web page...");
a.publish(N,E.button.checked)}),E=b.UTILITIES.create_check_box(a.get_setting("publish_as_workspace"),"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),N=function(c,d){var e=document.createElement("span"),g=b.google_drive.google_drive_url(c.id);b.TRANSLATION_ENABLED&&(g=b.UTILITIES.add_URL_parameter(g,"translate","1"));e.innerHTML="Published: <a href='"+g+"' target='_blank'>"+a.get_setting("program_name")+
"</a>";g=$(t.container).children("tr");b.UTILITIES.display_message("Your web page is ready for you to edit. Just click on the link.");0<g.length&&g.get(0).appendChild(b.UTILITIES.create_table_entry(e))},D=document.createElement("div"),J=b.google_drive&&"undefined"!==typeof gapi?b.google_drive.get_status():"Google Drive API not loaded",G=!0,C=b.UTILITIES.create_vertical_table(y,E.container),I=$(t.container).children("tr");$(c).addClass("toontalk-settings-panel").css({width:$(k).width()+29,height:$(k).height()+
50,left:-2,top:-25,"z-index":9999999});c.appendChild(q);t.button.addEventListener("change",function(){var e=t.button.value.trim();d!==e&&a.save(!0,void 0,function(){d=e;a.set_setting("program_name",e);a.load(!0,function(){setTimeout(function(){$(c).css({"z-index":b.UTILITIES.next_z_index()})},500)},function(){a.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();b.UTILITIES.display_message("Your program was copied and the new copy's name is '"+a.get_setting("program_name")+"'.")})})})});
n.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_google_drive:r.button.checked,gooogle_drive:!0});a.set_setting("auto_save_to_google_drive",n.button.checked);n.button.checked?$(v).hide():$(v).show()});r.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_local_storage:r.button.checked,local_storage:!0});a.set_setting("auto_save_to_local_storage",r.button.checked);r.button.checked?$(f).hide():$(f).show()});E.button.addEventListener("click",function(b){a.set_setting("publish_as_workspace",
E.button.checked)});c.appendChild(D);$(g).css({"font-weight":"bold","font-size":24,color:"navy"});D.appendChild(g);D.appendChild(t.container);D.appendChild(n.container);D.appendChild(r.container);n.container.appendChild(b.UTILITIES.create_space());n.container.appendChild(v);a.get_setting("auto_save_to_google_drive")&&$(v).hide();r.container.appendChild(b.UTILITIES.create_space());r.container.appendChild(f);a.get_setting("auto_save_to_local_storage")&&$(f).hide();"Need to authorize"===J?(n.container.appendChild(b.UTILITIES.create_space()),
n.container.appendChild(w)):"Authorized"!==J&&"Ready"!==J&&"Authorized but not yet ready"!==J&&(G=!1,a.set_setting("google_drive_unavailable",!0),setTimeout(function(){n.button.disabled=!0;$(y).button("option","disabled",!0);$(v).button("option","disabled",!0);b.UTILITIES.give_tooltip(n.container,"Inactivated because attempt to connect to Google Drive returned: "+J);y.title=n.container.title;v.title=n.container.title},1));0<I.length&&I.get(0).appendChild(b.UTILITIES.create_table_entry(C));e(a,G,c);
k.appendChild(c)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",auto_save_to_google_drive:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(b){var k=[],e=0,c=!1,a=!1;return{pending_update:function(a){0<=k.indexOf(a)||(k.push(a),this.update_display())},update_display:function(){var b;a||document.hidden||0===k.length||(b=Date.now(),b<e?(a=!0,setTimeout(this.update_display_workhorse.bind(this),e-b)):c||(a=!0,setTimeout(function(){this.update_display_workhorse(b)}.bind(this))))},update_display_workhorse:function(h){var m=k,l=function(a,b){$(a).children().each(function(a,c){$(c).css({"z-index":b+1});
l(c,b+1)})};k=[];c=!0;a=!1;e=(h|Date.now())+50;m.forEach(function(a){var c=a.get_element&&a.get_element(),e,g,h;if(a.visible()||$(c).is(".toontalk-top-level-resource"))$(c).is(".toontalk-not-observable")?a.render():($(c).show(),a.update_display(),a.get_backside&&(g=a.get_backside())&&g.visible()&&g.update_display(),setTimeout(function(){b.UTILITIES.use_custom_tooltip(c)}),e=$(c).parent().closest(".toontalk-side"),e.is("*")&&0===e.find(".toontalk-side-animating, .toontalk-side-appearing").length&&
(g=b.UTILITIES.get_style_numeric_property(c,"z-index"),h=b.UTILITIES.get_style_numeric_property(e.get(0),"z-index"),h||(h=b.UTILITIES.next_z_index(),e.css({"z-index":h})),!g||e.is(".toontalk-top-level-backside")?(g=b.UTILITIES.next_z_index(),$(c).css({"z-index":g})):g>=h&&(g=h+1,$(c).css({"z-index":g})),l(c,g)),c&&!$(c).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&
b.UTILITIES.set_timeout(function(){e.is(".toontalk-box-hole")?$(c).is(".ui-resizable")&&$(c).resizable("destroy"):$(c).is(".ui-resizable")||b.UTILITIES.make_resizable($(c),a)}))});c=!1;0<k.length&&(a=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(b){b.creators_from_json.body=function(k,e){var c=b.actions.create();e.body=c;c.initialise_steps(b.UTILITIES.create_array_from_json(k.steps,e));return c};return{create:function(k){var e=Object.create(this),c=[];k||(k=[]);e.copy=function(){return b.actions.create(b.UTILITIES.copy_array(k))};e.get_steps=function(){return k};e.initialise_steps=function(a){k=a};e.is_empty=function(){return 0===k.length};e.reset_steps=function(){k=[];this.reset_newly_created_widgets()};
e.reset_newly_created_widgets=function(){b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+c.length);c=[]};e.add_step=function(a,c){a?(k.push(a),c&&this.add_newly_created_widget_if_new(c)):b.UTILITIES.report_internal_error("Attempt to add an undefined step.")};e.add_newly_created_widget_if_new=function(a){0<=c.indexOf(a)||this.add_newly_created_widget(a)};e.add_newly_created_widget=function(a){b.debugging&&0<=c.indexOf(a)?console.log("add_newly_created_widget called with not new widget."):
(c.push(a),b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Added "+a.to_debug_string()+" to list of newly_created_widgets. Length is "+c.length))};e.is_newly_created=function(a){return 0<=c.indexOf(a)};e.get_newly_created_widgets=function(){return c};e.get_path_to=function(a,e,k){var l,d;c.some(function(c,q){if(c===a||k&&c.get_widget()===a)return l=b.newly_created_widgets_path.create(q),!0;if(c.get_path_to&&(d=c.get_path_to(a,e)))return l=b.newly_created_widgets_path.create(q),l.next=
d,!0});return l};e.dereference_path=function(a){b.debugging&&!c[a]&&b.UTILITIES.report_internal_error("Expected to find the "+b.UTILITIES.ordinal(a)+" newly created widget.");return c[a]};return e},run_unwatched:function(k,e){var c=this.get_steps();b.logging&&0<=b.logging.indexOf("run")&&console.log(k.to_debug_string()+" running unwatched");e||(e=0);k.run_next_step=function(){if(e<c.length){var a=c[e];e++;b.logging&&0<=b.logging.indexOf("event")&&console.log(a+" (unwatched)");a.run_unwatched(k)}else k.set_running_or_in_run_queue(!1),
k.run_body_finished_listeners(),k.get_run_once()?k.get_first_in_team().set_running(!1):k.get_first_in_team().run()};k.run_next_step()},run_watched:function(k){var e=this.get_steps(),c=k.get_frontside_element(),a,h,m=c.parentElement,l=k.get_first_in_team(),d=function(){var a=l.visible()&&0!==l.get_maximum_step_duration(),d=function(){a&&(m&&m.appendChild(c),k.set_animating(!1));l===k?b.UTILITIES.set_absolute_position(c,q):(b.UTILITIES.set_css(c,{position:"static"}),h.get_backside(!0).get_next_robot_area().appendChild(c));
k.get_run_once()?l.set_running(!1):k.stopped()?$(c).removeClass(".toontalk-side-animating"):l.run();k.rerender()};a?(c.parentElement||k.get_parent_of_frontside().get_frontside_element().appendChild(c),b.UTILITIES.animate_to_absolute_position(c,q,d,k&&k.transform_animation_speed(b.UTILITIES.default_animation_speed))):(k.set_animating(!1),d(),k===l&&k.get_context().add_backside_widget(k),$(k.get_frontside_element()).remove())},t=0,q=$(c).offset(),g=$(c).offset(),n=$(c).width(),r=$(c).height(),v=k.get_first_in_team().top_level_widget(),
f=$(c).closest(".toontalk-top-level-backside").offset(),w=k.get_context().get_backside(),y,E;b.logging&&0<=b.logging.indexOf("run")&&console.log(k.to_debug_string()+" running watched");y=(h=k.get_previous_robot())?$(h.get_backside(!0).get_next_robot_area()):$(w.get_backside_element(!0));!b.UTILITIES.is_attached(c)&&h&&(h.open_backside(),h.get_backside().set_advanced_settings_showing(!0),(a=c.parentElement)||(a=y.get(0)),k.set_visible(!0),k.update_display(),k.add_body_finished_listener(function(){a&&
a.appendChild(c);$(c).css({left:"",top:"",position:"","z-index":""})}));0===n&&($(c).css({width:"",height:""}),n=k.saved_width||$(c).width(),r=k.saved_height||$(c).height());f||(f={left:0,top:0});0<y.length&&(E=y.get(0).getBoundingClientRect(),q.left<E.left-f.left||q.top<E.top-f.top||q.left+n>E.right+f.left||q.top+r>E.bottom+f.top)&&(q=y.offset(),q.left+=y.width()/2,q.top+=y.height()-r,g=q);k.start_offset=g;v.get_backside_element().appendChild(c);b.UTILITIES.set_absolute_position(c,q);k.run_next_step=
function(){w&&!document.hidden&&(w.visible()||b.UTILITIES.visible_element(w.get_element()))?setTimeout(function(){k.run_watched_step_end_listeners();if(t<e.length&&!k.stopped()){var a=e[t];t++;b.logging&&0<=b.logging.indexOf("event")&&console.log(a+" (watched)");a.run_watched(k);k.get_thing_in_hand()&&(k.get_thing_in_hand().save_dimensions(),k.rerender())}else k.set_running_or_in_run_queue(!1),d(),k.run_body_finished_listeners()},k.transform_step_duration(50)):(k.set_running_or_in_run_queue(!1),k.set_animating(!1),
$(c).css({width:"",height:""}),c.style.transitionDuration="",m&&m.appendChild(c),this.run_unwatched(k,t))}.bind(this);k.set_animating(!0,q);k.run_next_step();return!0},toString:function(b){for(var e="",c=this.get_steps().map(function(a){return a&&a.toString(b)});""===c[c.length-1];)c.pop();c.forEach(function(a,b){a&&(e+=a,e=b===c.length-2?e+" and \n":b<c.length-2?e+", \n":e+".")});return e},get_json:function(k,e,c){var a=[];b.UTILITIES.get_json_of_array(this.get_steps(),a,0,k,function(){e({type:"body",
steps:a},c)},c)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(b){b.creators_from_json.newly_created_widgets_path=function(k){return b.newly_created_widgets_path.create(k.index)};return{create:function(k){return{dereference_path:function(e){var c=e.get_body().dereference_path(k),a;if(this.next)return b.path.dereference_path(this.next,e,c);this.removing_widget&&((a=c.get_parent_of_frontside())&&a.is_hole()&&(a=a.get_parent_of_frontside()),a&&a.removed_from_container&&e.remove_from_container(c,a));return c},toString:function(){return"the "+
b.UTILITIES.ordinal(k)+" new widget"},get_json:function(b,c,a){c({type:"newly_created_widgets_path",index:k},a)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(b){var k={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b){b.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b){var c=a.copy();b.add_newly_created_widget(c);b.set_thing_in_hand(c);return!0},"drop it on":function(a,c,d){var e;if(a)if(e=c.get_thing_in_hand()){if(e.drop_on)return b.debugging&&e===a&&b.UTILITIES.report_internal_error("Dropping something on itself! "+a),$(e.get_frontside_element()).remove(),e.drop_on(a,
void 0,c),c.set_thing_in_hand(void 0),a.rerender(),c.add_newly_created_widget_if_new(e),e.robot_waiting_before_next_step===c?(d&&d.running_watched||(e.robot_waiting_before_next_step=void 0),!1):!0;b.debugging&&b.UTILITIES.report_internal_error("Thing in robot's hand ("+e+") doesn't handle 'drop_on'. Robot that "+c)}else!c.being_trained&&b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but has nothing in its hand.");else b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+
c.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(a,c,d){var e;if(a){if(e=c.get_thing_in_hand())return c.set_thing_in_hand(void 0),a[d.setter](e),!0;b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},
remove:function(a,b){a.remove();a===b&&b.set_stopped(!0);return!0},"change whether erased":function(a,c,d){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;b.UTILITIES.display_message("Robot is unable to erase "+a)},edit:function(a,c,d){if(a[d.setter_name])return d.argument_2?a[d.setter_name].call(a,d.argument_1,d.argument_2,a.visible()):a[d.setter_name].call(a,d.argument_1,a.visible()),!0;b.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c){return!0},
"add to the top-level backside":function(a,c,d){var e,f;c.visible()||(e=a.get_frontside_element(!0),d=$(c.get_context().get_frontside_element()).position(),f=$(c.get_context().get_frontside_element()).closest(".toontalk-top-level-backside").get(0)||$(e).closest(".toontalk-top-level-backside").get(0),$(e).css({left:d.left,top:d.top}),f.appendChild(e),f.toontalk_widget_side.get_widget().add_backside_widget(a),a.animate_to_element(f,void 0,c.transform_animation_speed(b.UTILITIES.default_animation_speed)));
return!0},"add a new widget to the work space":function(a,c,d){c.get_context().is_top_level()?(d=c.add_to_top_level_backside(a),c=$(c.get_frontside_element()).offset(),a.update_display(),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c,!0)):a.drop_on(c.get_context().get_backside(!0),void 0,c,!0);return!0},"start training":function(a,b,c){a.training_started(b);return!0},"stop training":function(a,b,c){a.training_finished();return!0},train:function(a,b,c){a.add_step(c.step)},"open the backside":function(){return!0},
"close the backside":function(){return!0},"click the button of":function(){return!0}},e=function(a,c,d,e){var f=c.get_thing_in_hand(),h=c.get_frontside_element(),k=a.get_element(),l,m,q,t,G,C,I,L;k||(k=b.UTILITIES.find_resource_equal_to_widget(a,c));b.UTILITIES.is_attached(k)&&c.visible()?(l=$(k).width(),m=$(k).height(),e&&e.left_offset_fraction?(c.original_animation_left_offset||(c.original_animation_left_offset=[]),c.original_animation_top_offset||(c.original_animation_top_offset=[]),G=e.left_offset_fraction*
l,C=e.top_offset_fraction*m,f&&(I=f.get_element(),b.UTILITIES.visible_element(I)&&(L=$(I).offset(),h=$(h).offset(),G-=L.left-h.left,C-=L.top-h.top)),f&&0<=c.original_animation_left_offset.indexOf(G)&&0<=c.original_animation_top_offset.indexOf(C)?(G=c.animation_left_offset+c.last_thing_in_hand_width,C=c.animation_top_offset,G>=l&&(G=0,C+=c.max_thing_in_hand_height,C>=m&&(C=0)),c.last_thing_in_hand_width=$(I).width(),"undefined"===typeof c.max_thing_in_hand_height&&(c.max_thing_in_hand_height=0),c.max_thing_in_hand_height=
Math.max(c.max_thing_in_hand_height,$(I).height())):(c.original_animation_left_offset.push(G),c.original_animation_top_offset.push(C),c.last_thing_in_hand_width=$(I).width(),c.max_thing_in_hand_height=$(I).height()),k.animation_left_offset=G,k.animation_top_offset=C,c.animation_left_offset=G,c.animation_top_offset=C):(q=l/2,t=m/2),c.animate_to_widget(a,d,c.transform_animation_speed(.25),q,t,!0,c.transform_original_step_duration(e&&e.time),c)):d()},c=function(a,b,c,d){e(a,b,function(){a.open_backside(c);
t(a,b)},d)},a=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},h=function(c,d,e,h,f,k){var l=a(c,h);d.get_frontside_element();var m=function(){e(l);$(l).addClass("ui-state-active");if(".toontalk-select-function"===h||".toontalk-box-size-input"===h)l.value=f.argument_1;setTimeout(function(){$(l).removeClass("ui-state-active");d.run_next_step()},k)},q=function(){var a;b.UTILITIES.visible_element(l)||(a=c.get_backside(!0),a.set_advanced_settings_showing(!0,a.get_element()));
d.animate_to_element(l,m,d.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)};l&&b.UTILITIES.visible_element(l)||!c.open_backside||!d.animate_consequences_of_actions()?q():c.open_backside(q)&&t(c,d)},m=function(a,c,d,e,f){f=b.UTILITIES.closest_element($("."+f),$(c.get_frontside_element()).offset());var h=function(){l(a,c,d,e)};f&&c.animate_consequences_of_actions()?c.animate_to_element(f,h,c.transform_animation_speed(b.UTILITIES.default_animation_speed),0,0,!0):h()},l=function(a,
c,d,e){c.get_frontside_element();var f=function(){c.carrying_tool=void 0;c.update_display();d();c.run_next_step()};c.animate_consequences_of_actions()?(c.carrying_tool=e,c.update_display(),c.animate_to_element(a.get_element(),f,c.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)):(d(),c.run_next_step())},d=function(a,b,c){var d=a.get_parent_of_frontside();m(a,b,function(){c();d&&"top-level"!==d.get_widget().get_type_name()&&d.update_display&&d.update_display();a.rerender()},
"toontalk-vacuum-ready-small","toontalk-vacuum")},t=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},q={copy:function(a,b,c){m(a,b,function(){c();a.add_copy_to_container(b.get_recently_created_widget())},"toontalk-wand-small","toontalk-wand")},"pick up":function(a,c,d,h){var f=function(){d();c.animate_consequences_of_actions()&&c.update_display();c.run_next_step()};b.debugging&&"empty hole"===a.get_type_name()?b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):
a.save_dimensions()&&c.animate_consequences_of_actions()?e(a,c,f,h):f()},"pick up a copy of":function(a,c,d,h){e(a,c,function(){var e;d();c.animate_consequences_of_actions()&&(e=c.get_recently_created_widget())&&(e.set_visible(!0),b.UTILITIES.copy_frontside_dimensions(a,e),c.update_display());c.run_next_step()},h)},"drop it on":function(a,d,h,k){var f=d.get_thing_in_hand(),l,m;f?(b.debugging&&f===a&&b.UTILITIES.report_internal_error("Dropping something on itself!"),l=f.get_element(!0),f.set_visible(d.visible()),
m=function(){var a;$(l).removeClass("toontalk-held-by-robot");f.drop_on&&(d.animate_consequences_of_actions()&&!b.UTILITIES.visible_element(l)&&(a=$(d.get_frontside_element()).closest(".toontalk-top-level-backside"),0<a.length&&a.get(0).appendChild(l)),d.rerender());h();f.drop_on&&f.visible()&&(b.UTILITIES.set_absolute_position(l,$(l).offset()),f.restore_dimensions());f.robot_waiting_before_next_step!==d&&d.run_next_step()},a.is_backside()&&!b.UTILITIES.visible_element(a.get_element())?c(a.get_widget(),
d,m,k):e(a,d,m,k)):(b.debugging&&(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+d)),e(a,d,h,k))},"drop it on the text area of":function(a,d,h,k){var f=d.get_thing_in_hand(),l,m,q,t;f?(l=f.get_element(!0),f.set_visible(d.visible()),m=function(){var b;$(l).removeClass("toontalk-held-by-robot");h();f.remove();b=a.get_parent_of_frontside().get_widget();b.is_hole()&&(b=b.get_parent_of_frontside());b.is_top_level()?a.render():b.render();d.set_thing_in_hand(void 0);
d.run_next_step()},q=function(){return $(a.get_backside_element()).find(k.area_selector).get(0)},d.rerender(),b.UTILITIES.visible_element(a.get_backside_element())?(t=q(),d.animate_to_element(t,m,d.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)):c(a,d,function(){t=q();d.animate_to_element(t,m,d.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)},k)):(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+
d),e(a,d,h,k))},remove:d,"change whether erased":d,edit:function(a,b,c,d){h(a,b,function(){a.get_backside()&&a.get_backside().update_display();c()},d.button_selector,d,b.transform_step_duration(1E3))},"change size of":function(a,c,d,e){var f=a.get_frontside_element();f?c.animate_to_element(f,function(){var b=$(f).width(),h=$(f).height(),b=b*e.x_factor,h=h*e.y_factor,k=c.transform_step_duration(1E3);$(f).addClass("toontalk-animating-element");f.style.transitionDuration=k+"ms";f.style.width=b+"px";
f.style.height=h+"px";setTimeout(function(){$(f).removeClass("toontalk-animating-element");f.style.transitionDuration="";d();a.render();c.run_next_step()},k)},c.transform_animation_speed(b.UTILITIES.default_animation_speed),0,0,!0):(d(),c.run_next_step())},"add to the top-level backside":function(a,b,c){c();b.run_next_step()},"add a new widget to the work space":function(a,c,d,e){e&&e.button_selector?(a=b.path.dereference_path(e.path_to_source,c),h(a,c,d,e.button_selector,e,c.transform_step_duration(3E3))):
(d(),c.run_next_step())},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by={element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step()},"stop training":function(a,c,d,e){var f=a.get_frontside_element();h(a,c,function(){var e=function(){f.toontalk_return_to=
void 0;a.get_backside().change_label_and_title_of_train_button(!1);$(f).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");f.toontalk_followed_by=void 0;setTimeout(d,c.transform_step_duration(1500))};f.toontalk_return_to?b.UTILITIES.animate_to_absolute_position(f,f.toontalk_return_to,e,c.transform_animation_speed(b.UTILITIES.default_animation_speed)):e()},".toontalk-train-backside-button",e,c.transform_step_duration(1E3))},train:function(a,b,c,d){var e=function(){c();b.run_next_step()};
(d=d.step.run_watched)?(a.run_next_step=e,a.set_context(a.get_parent_of_frontside().get_widget()),d(a)):e()},"open the backside":function(a,b,c){a.open_backside(function(){c();b.run_next_step()});t(a,b)},"close the backside":function(a,b,c,d){d=b.transform_original_step_duration(d&&d.time);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();c();b.run_next_step()},d)},"click the button of":function(a,b,c,d){h(a,b,function(d){$(d).is(".toontalk-settings-backside-button")&&
">"===d.innerText&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().set_advanced_settings_showing(!1,a.get_backside_element())});$(d).click();c()},d.button_selector)}};b.creators_from_json.robot_action=function(a,c){return a.additional_info?b.robot_action.create(b.path.create_from_json(a.path,c),a.action_name,b.UTILITIES.create_keys_from_json(a.additional_info,c)):b.robot_action.create(b.path.create_from_json(a.path,c),a.action_name)};return{create:function(a,c,d){var e=
Object.create(this),f=k[c],h=q[c];if(h)return a||b.UTILITIES.report_internal_error("path undefined in "+c+" action"),f||b.UTILITIES.report_internal_error("no run_function for "+c),e.get_action_name=function(){return c},e.get_additional_info=function(){return d},e.run_unwatched=function(c){var e=b.path.dereference_path(a,c);if(!e)return b.UTILITIES.report_internal_error("Unable to dereference path: "+b.path.toString(a)+" in context: "+c.get_context()),!1;b.logging&&0<=b.logging.indexOf("event")&&(e.wait_until_this_nest_receives_something?
console.log("   wait_until_this_nest_receives_something "+e.wait_until_this_nest_receives_something.to_debug_string()+"("+b.path.toString(a)+") by unwatched "+c.to_debug_string()):console.log("   "+e.to_debug_string()+" ("+b.path.toString(a)+" "+e.to_debug_string()+" by unwatched "+c.to_debug_string()));e.wait_until_this_nest_receives_something?e.wait_until_this_nest_receives_something.run_when_non_empty(function(){this.run_unwatched(c)}.bind(this),c):f(e,c,d)&&c.run_next_step()},e.run_watched=function(c){var e=
b.path.dereference_path(a,c),k=function(){if(!c.stopped()||c.being_trained)d||(d={}),d.running_watched=!0,f(e,c,d)};e?(b.logging&&0<=b.logging.indexOf("event")&&console.log("   "+e+" ("+b.path.toString(a)+" "+(e.to_debug_string?e.to_debug_string():e)+" by watched "+c.to_debug_string()+(c.animate_consequences_of_actions()?"":" finishing instantly")),e.wait_until_this_nest_receives_something?(e.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.set_waiting(!1);this.run_watched(c)}.bind(this),
c),c.set_waiting(!0),TOONTALK.UTILITIES.visible_element(c.get_context().get_backside_element())||c.get_frontside().remove()):h(e,c,k,d)):b.UTILITIES.report_internal_error("Unable to dereference the path: "+b.path.toString(a)+" in context: "+c.get_context())},e.toString=function(e){var f="",h="",k=c,l;if("open the backside"===c||"close the backside"===c)return"";if("click the button of"===c)switch(d.button_selector){case ".toontalk-green-flag":k="click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
" of";break;case ".toontalk-stop-sign":k="click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":k="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":k="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":k="click the button to add or remove attributes of ";break;case ".toontalk-remove-backside-and-widget-buttton":k="click the button to remove the back and front of ";
break;default:k="click a button of"}if("add a new widget to the work space"===c)return c.replace("a new widget",b.path.toString(a));if("add to the top-level backside"===c)return"";e||(e={});l=b.path.toString(a,e);if("edit"===c||"drop it on the text area of"===c)f=" ("+d.toString+")";else if("train"===c){f=d.step.toString({person:"third"});if(""===f)return f;f=" to "+f;h="- ";e&&e.robot_being_trained_description&&(l=e.robot_being_trained_description)}else"start training"===c?e&&(e.robot_being_trained_description=
"it"):"stop training"===c&&(l=e.robot_being_trained_description,e.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(c)){if(0<=l.indexOf("hole of"))return h+k+" what is in "+l+f;if(0===l.indexOf("a When"))return l=l.substring(3),l=b.UTILITIES.remove_encoded_HTML(l),l=b.UTILITIES.elide(l,80,1),"."===l[l.length-1]&&(l=l.substring(0,l.length-1)),h+k+" a robot who w"+l+f+"\n"}return h+k+" "+l+
f},e.get_json=function(e,f,h){var k=function(d,h){b.path.get_json(a,e,function(a,b){f({type:"robot_action",action_name:c,path:a,additional_info:d},b)},h)};d?b.UTILITIES.get_json_of_keys(d,["running_watched"],k,h):k(void 0,h)},e;b.UTILITIES.report_internal_error("No watched function for "+c)}}}(window.TOONTALK);window.TOONTALK.queue=function(b){var k={create:function(){var e=Object.create(this);e.to_run=b.UTILITIES.create_queue();e.run_function=e.run.bind(e);return e},enqueue:function(b){b.running_or_in_run_queue()||(b.set_running_or_in_run_queue(!0),this.to_run.enqueue(b)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var e,c;this.running=!0;for(e=Date.now()+k.maximum_run;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<e;)c=this.to_run.dequeue(),c.run_actions();this.to_run.isEmpty()?this.running=!1:b.UTILITIES.set_timeout(this.run_function)}};return k}(window.TOONTALK);window.TOONTALK.path=function(b){var k;b.creators_from_json["path.to_entire_context"]=function(){return b.path.to_entire_context()};b.creators_from_json["path.to_widget_on_nest"]=function(){return b.path.to_widget_on_nest()};b.creators_from_json["path.top_level_backside"]=function(){return b.path.top_level_backside};b.creators_from_json["path.to_backside_widget_of_context"]=function(e,c){return"undefined"===typeof e.backside_index?b.path.get_path_to_backside_widget_of_context(e.type_name,c&&c.robot):
b.path.get_path_to_backside_index_of_context(e.backside_index,e.type_name,c&&c.robot)};b.creators_from_json["path.to_resource"]=function(e,c){return b.path.get_path_to_resource(b.UTILITIES.create_from_json(e.resource,c))};return{get_path_to:function(e,c,a){var h=function(c,e){var d=e.get_training_context(),h=e.get_body(),k,g,n;c.is_primary_backside&&c.is_primary_backside()&&(n=!0,c=c.get_widget());if(d===c)return k=b.path.to_entire_context(),k.is_backside=n,k;g=c.get_type_name();if("top-level"===
g)return b.path.top_level_backside;if(k=h.get_path_to(c,e,a))return k.is_backside=n,k;if("element attribute"===g&&c.get_original_attribute_widget()===c)return k=b.element.create_attribute_path(c,e),k.is_backside=n,k;if(b.debugging&&!d)b.UTILITIES.report_internal_error("No context to compute the path");else{if(d.get_path_to&&(h=d.get_path_to(c,e)))return h.is_backside=n,k=b.path.to_entire_context(),k.next=h,k;d.get_backside_widgets().some(function(a){a=a.get_widget();var d;if(a===c||a.top_contents_is&&
a.top_contents_is(c))return e.add_to_backside_conditions(a),k=b.path.get_path_to_backside_widget_of_context(a,e),k.is_backside=n,!0;if(a.get_path_to&&(d=a.get_path_to(c,e)))return d.is_backside=n,e.add_to_backside_conditions(a),k=b.path.get_path_to_backside_widget_of_context(a,e),k.next=d,!0});if(k)return k.is_backside=n,k;if(d=c.ancestor_of_type("robot"))return b.robot.find_conditions_path(c,d,e);k=b.path.get_path_to_resource(c.copy());k.is_backside=n;return k}}(e,c);h&&e.dereference_contents&&(b.path.path_end(h).not_to_be_dereferenced=
!0);!h||"pick up"!==c.current_action_name&&"remove"!==c.current_action_name||(b.path.path_end(h).removing_widget=!0);return h},path_end:function(b){for(;b.next;)b=b.next;return b},dereference_path:function(b,c,a){var h;b?b.dereference_path?h=b.dereference_path(c,a):a&&a.dereference_path&&(h=a.dereference_path(b,c)):h=a||c.get_context();return h&&b&&b.is_backside?h.get_backside(!0):h},continue_dereferencing_path:function(b,c,a){void 0===c&&a.context_is_backside()&&(c=a.get_top_level_context());void 0===
c&&(c=a.get_context());return b.next?c.dereference_contents&&!b.next.not_to_be_dereferenced?(c=c.dereference_contents(b.next,a))&&b.is_backside?c.get_backside(!0):c:(c=c.dereference_path(b.next,a))&&b.next.is_backside?c.get_backside(!0):c:c.dereference_contents&&!b.not_to_be_dereferenced?(c=c.dereference_contents(b,a))&&b.is_backside?c.get_backside(!0):c:c},toString:function(e,c){var a="",h;if(!e)return"undefined path";e.is_backside&&(a="the backside of ");c||(c={});h=c.resource;c.resource=!0;e.next?
(b.path.toString(e.next,c),a=a+b.path.toString(e.next,c).trim()+" of "+e.toString(c)):a+=e.toString(c);c.resource=h;return a},get_json:function(e,c,a,h){var k,l;e.get_json?(k=function(d,h){e.is_widget&&(d=e.add_to_json(d,c));e.next&&(l=function(a){d.next_path=a},b.path.get_json(e.next,c,l,h));e.removing_widget&&(d.removing_widget=!0);e.not_to_be_dereferenced&&(d.not_to_be_dereferenced=!0);if(!0===e.is_backside||e.is_backside&&e.is_backside())d.is_backside=!0;a(d,h)},e.get_json(c,k,h)):a(e,h)},to_entire_context:function(e){return{dereference_path:function(c,
a){return b.path.continue_dereferencing_path(this,a,c)},toString:function(b){return b&&b.robot?b.robot.get_top_level_context_description(b):b&&"third"===b.person?"what he's working on":"what I'm working on"},get_json:function(b,a,e){a({type:"path.to_entire_context"},e)}}},to_widget_on_nest:function(){return{dereference_path:function(e,c){return b.path.continue_dereferencing_path(this,c,e)},toString:function(){return"what is on the nest"},get_json:function(b,c,a){c({type:"path.to_widget_on_nest"},
a)}}},get_path_to_resource:function(e){e||console.error("Widget missing in get_path_to_resource.");e=e.get_widget();return{dereference_path:function(c){var a=e.copy({copying_resource:!0}),h,k,l;c.add_newly_created_widget(a);c.visible()&&(h=b.UTILITIES.find_resource_equal_to_widget(e,c))&&(a.save_dimensions_of(b.UTILITIES.widget_side_of_element(h)),l=a.get_frontside_element(),k=$(h).position(),b.UTILITIES.set_timeout(function(){$(l).css({left:k.left,top:k.top,width:$(h).width(),height:$(h).height()})}));
return a},toString:function(c){return b.UTILITIES.add_a_or_an(e.toString(c))},get_json:function(c,a,h){e.get_json(b.UTILITIES.fresh_json_history(c),function(b,c){a({type:"path.to_resource",resource:b},c)},h)}}},get_path_to_backside_widget_of_context:function(e,c){return"string"===typeof e?{dereference_path:function(a){var c=a.get_context(),k=a.get_backside_widget_of_type(e,c);k||c.get_backside_widgets().some(function(b){if(b.get_widget().is_of_type(e)&&!a.is_newly_created(b.get_widget()))return k=
b.get_widget(),!0});if(k)return b.path.continue_dereferencing_path(this,k,a)},toString:function(a){a=(a&&a.robot&&a.robot.get_backside_conditions()?a.robot.get_backside_conditions()[e]:b.UTILITIES.add_a_or_an(e))+" on the back of what I'm working on";return this.removing_widget?"what is on "+a:a},get_json:function(a,b,c){b({type:"path.to_backside_widget_of_context",type_name:e},c)}}:this.get_path_to_backside_index_of_context(c.get_backside_condition_index(e),e.get_type_name(),c)},get_path_to_backside_index_of_context:function(e,
c,a){return{dereference_path:function(a){var c=a.get_backside_matched_widgets()[e];if(c)return b.path.continue_dereferencing_path(this,c,a);b.debugging&&console.log("can this happen?")},toString:function(e){e=a.get_frontside_conditions().is_top_level()?"work area":"back of what";e=b.UTILITIES.add_a_or_an(c||"thing")+" on the "+e+" I'm working on";return this.removing_widget?"what is on "+e:e},get_json:function(a,b,k){b({type:"path.to_backside_widget_of_context",type_name:c,backside_index:e},k)}}},
create_from_json:function(e,c){var a=b.UTILITIES.create_from_json(e,c);e.next_path&&(a.next=this.create_from_json(e.next_path,c));e.removing_widget&&(a.removing_widget=!0);e.not_to_be_dereferenced&&(a.not_to_be_dereferenced=!0);e.is_backside&&(a.is_backside=!0);return a},top_level_backside:{dereference_path:function(e){if(e=e.get_context().ancestor_of_type("top-level"))return e;k||(k=b.widget.create_top_level_widget());return k},toString:function(){return"the top-level backside"},get_json:function(b,
c,a){c({type:"path.top_level_backside"},a)}}}}(window.TOONTALK);window.TOONTALK.publish=function(b){var k=function(b,c,a){var h='<!DOCTYPE html>\n<html>\n<head>\n<script src="https://toontalk.github.io/ToonTalk/toontalk.js?published=1">\x3c/script>\n<title>\n'+b+"</title>\n</head>\n<body>\n";c.forEach(function(b,c){h+='<div class="toontalk-edit" name="content">\n'+b+"\n</div>\n";a[c]&&(h+=a[c])});return h+="</body>\n</html>\n"};return{publish_widget:function(e,c,a,h){var m=b.google_drive.get_status(),l=["Edit this. Select text for formatting."],d=function(a){(a=
a&&a.items&&0<a.items.length&&a.items[0])?h(a,q):(a=k(e,l,q),b.google_drive.upload_file(t,"html",a,h))},t,q;"Ready"===m?(t=c.get_setting("program_name"),a?b.UTILITIES.get_json_top_level(c,function(a){c.set_setting("program_name",t+" (published version)");q=[b.UTILITIES.toontalk_json_div(a,c)];c.set_setting("program_name",t)}):(a=c.get_backside_widgets(),q=[],a.forEach(function(a,c){a.visible()&&b.UTILITIES.get_json_top_level(a,function(c){c.view&&(c.view.saved_width=void 0,c.view.saved_height=void 0);
q.push(b.UTILITIES.toontalk_json_div(c,a.get_widget()));l.push("")})})),b.google_drive.get_toontalk_files(b.google_drive.full_file_name(t,"page"),"page",d)):(console.log("Unable to publish to Google Drive because: "+m),h(null))},republish:function(e){b.google_drive.insert_or_update_file(void 0,e.file_id,"page",k(e.title,e.editable_contents,e.widgets_json),function(){console.log("Published page '"+e.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(b){var k=b.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",e=b.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",c="Need to authorize",a,h;return{handle_client_load:function(a){0>window.location.href.indexOf(e)?(c="Connections to Google Drive are configured for the following domain only: "+e+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",a&&
a(c)):setTimeout(function(){b.google_drive.check_authorization(a)})},check_authorization:function(a){c="Awaiting authorization";gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(c){b.google_drive.handle_authorization_result(c,a)})},handle_authorization_result:function(a,e){a&&!a.error?(c="Authorized but not yet ready",gapi.client.load("drive","v2",function(){b.google_drive.get_folder_ids(function(){c="Ready"})}),e&&e()):(c="Need to authorize",e&&
e(c))},authorize:function(a){gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(c){b.google_drive.handle_authorization_result(c,a)})},get_folder_ids:function(c){b.google_drive.get_folder_id(!0,function(e){a=e;b.google_drive.get_folder_id(!1,function(a){h=a;c()})})},get_folder_id:function(c,e){var d=c?"ToonTalk Programs":"ToonTalk Pages",k=function(a){var g=function(a){a&&a.id?e(a.id):console.error("Failure to create folder '"+d+"'. Response was "+
a)};(a=a&&a.items&&0<a.items.length&&a.items[0].id)?e(a):c?b.google_drive.create_folder("ToonTalk Programs",!1,g):b.google_drive.create_folder("ToonTalk Pages",!0,g)};c&&a?e(a):!c&&h?e(h):b.google_drive.fetch_folder_id(d,k)},get_status:function(){return c},connection_to_google_drive_possible:function(){return 0!==c.indexOf("Connections to Google Drive are configured for the following domain only: ")},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",params:a}).execute(b)},
fetch_folder_id:function(a,c){b.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},c)},get_toontalk_files:function(a,c,d){"undefined"===typeof gapi?d("Google Drive API not available."):(c="properties has {key='ToonTalkType' and value='"+c+"' and visibility='PUBLIC'} and trashed = false",a&&(c+=" and title='"+a+"'"),b.google_drive.list_files({q:c},d))},get_toontalk_program_file:function(c,e){b.google_drive.list_files({q:"'"+a+"' in parents and trashed = false and title='"+
c+"'"},function(a){a&&a.items&&0<a.items.length?e(a.items[0]):e(null)})},upload_file:function(a,c,d,e){var h="json"===c?"program":"page",g=a+"."+c;b.google_drive.get_toontalk_files(g,h,function(a){gapi.client.load("drive","v2",function(){var c=a&&a.items&&0<a.items.length&&a.items[0].id;e||(e=function(a){a.error&&(console.log("Google drive status: "+b.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message));console.log("File "+a.title+" ("+a.id+") "+(c?"updated":
"created"))});c?b.google_drive.insert_or_update_file(void 0,c,h,d,e):b.google_drive.insert_or_update_file(g,void 0,h,d,e)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(c,e,d,k,q){var g={title:c,mimeType:"text/html"};g.parents=[{kind:"drive#fileLink",id:"program"===d?a:h}];k="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(g)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
k+"\r\n---------314159265358979323846--";c?(c="/upload/drive/v2/files",g="POST"):(c="/upload/drive/v2/files/"+e,g="PUT");gapi.client.request({path:c,method:g,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:k}).execute(function(a){e||b.google_drive.insert_property(a.id,"ToonTalkType",d,"PUBLIC");q&&q(a)})},create_folder:function(a,b,c){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){c(a)})}:c)},download_file:function(a,b){if(a.downloadUrl){var c=gapi.auth.getToken().access_token,e=new XMLHttpRequest;e.open("GET",a.downloadUrl);e.setRequestHeader("Authorization","Bearer "+c);e.onload=function(){b(e.responseText)};e.onerror=function(){b(null)};e.send()}else b(null)},google_drive_url:function(a){return"https://googledrive.com/host/"+a+"/"},insert_property:function(a,
b,c,e){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:c,visibility:e}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(b){var k={},e=!1,c,a=100,h=(new Date).getTime(),m=[],l=[],d=new MutationObserver(function(a){a.forEach(function(a){var b,c;for(b=0;b<a.addedNodes.length;b++)c=a.addedNodes.item(b),1===c.nodeType&&(!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0,c.toontalk_run_even_if_not_observable=void 0),
$(c).find(".toontalk-has-attached-callback").each(function(a,b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)}))})}),t=function(a,b,c){var d;if(a){d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},q=function(a){var b=a.indexOf("<div style='display:none;'>{"),b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,
c+1)},g=function(a,d){var e=$(d).closest(".toontalk-side"),f=k.get_mouse_or_first_touch_event_attribute("clientX",a),g=k.get_mouse_or_first_touch_event_attribute("clientY",a),h,l,m,n;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(a.dataTransfer&&a.dataTransfer.getData("text")&&0<a.dataTransfer.getData("text").length)){c=e||$(d);m=k.widget_side_of_jquery(c);if(!m){m=k.widget_side_of_element(d);k.report_internal_error("Possible bug that "+c+" doesn't have a known owner.");
if(!m){k.report_internal_error("The element doesn't have an owner either.");return}c=$(d)}m=m.get_selection();c=$(m.get_element());m.set_stopped&&m.set_stopped(!0);!m.save_dimensions||m.get_parent_of_frontside()&&!m.get_parent_of_frontside().get_widget().is_top_level()||m.save_dimensions();m.being_dragged=!0;h=c.get(0).getBoundingClientRect();n=c.is(".toontalk-top-level-resource");$(d).removeClass("toontalk-wiggle");m.get_json&&(e=function(b){b.view.drag_x_offset=f-h.left;b.view.drag_y_offset=g-h.top;
!b.view.frontside_width&&c.parent().is(".toontalk-backside")&&(b.view.frontside_width=c.width(),b.view.frontside_height=c.height());c.data("json",b);a.dataTransfer&&(l=k.toontalk_json_div(b,m),a.dataTransfer.effectAllowed=n?"copy":"move",a.dataTransfer.setData("text",l),k.is_internet_explorer()||a.dataTransfer.setData("text/html",l));m.drag_started&&m.drag_started(b,n)},a.dataTransfer&&a.dataTransfer.setData("text","Sorry, it took too long to generate the data structure needed to reconstruct "+m+
"."),b.UTILITIES.get_json_top_level(m,e,6E5));c.addClass("toontalk-being-dragged");a.stopPropagation()}},n=function(a){var b;c||(c=$(a.target).closest(".toontalk-side"));if(b=k.widget_side_of_jquery(c))b.being_dragged=void 0;c.is(".toontalk-frontside")&&(c.parent().is(".toontalk-backside")?(b=c.data("json"))&&k.set_css(c,{width:b.view.frontside_width,height:b.view.frontside_height}):c.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||c.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||
k.has_animating_image(c.get(0))||k.set_css(c,{width:"100%",height:"100%"}));C();a.stopPropagation()},r=function(a){if(c)return k.widget_side_of_jquery(c);if(a)return a=k.data_transfer_json_object(a),k.create_from_json(a)},v=function(a,d){var e=k.data_transfer_json_object(a),f=function(a,c){var e=k.create_from_json(a),f=document.createElement("div"),g=e.get_element(!0),h=$(d).closest(".toontalk-edit"),p=b.published_support.create_editable_text(),l=c.target;$(f).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");
$(g).addClass("toontalk-top-level-resource").css({position:"relative"});g.toontalk_widget_side=e;f.toontalk_widget_side=e;f.appendChild(g);for($(f).insertAfter(h);l.nextSibling;)$(p).children(".froala-element").get(0).appendChild(l.nextSibling);$(p).insertAfter(f);e.update_display()},g=function(){var a;h.hide();a=document.elementFromPoint(v-window.pageXOffset,w-window.pageYOffset);h.show();if(a)return $(a).closest(".toontalk-side")},h,l,m,n,q,r,t,v,w;void 0===e&&c&&(e=c.data("json"));c&&c.data("json",
"");h=c;C();if(h||void 0!==e||a.dataTransfer.files||H(a)){if($(a.target).is(".toontalk-drop-area-instructions"))f=$(a.target).parent();else if($(a.target).is(".toontalk-element-attribute-input")){if(f=$(a.target).closest(".toontalk-side"),l=k.widget_side_of_jquery(f)){g=h?k.widget_side_of_jquery(h):k.create_from_json(e);k.restore_resource(h,g);l.dropped_on_style_attribute(g,a.target.name,a);a.stopPropagation();return}}else if($(a.target).is(".toontalk-drop-area"))f=$(a.target);else{if(e&&$(a.currentTarget).is(".froala-element")){f(e,
a);return}f=$(a.target).closest(".toontalk-side")}if(0!==f.length){v=k.get_mouse_or_first_touch_event_attribute("pageX",a);w=k.get_mouse_or_first_touch_event_attribute("pageY",a);if(f.is(".toontalk-top-level-resource"))if("touchend"===a.type){if(f=g(),!f||0===f.length)return}else return;q=f.offset();k.remove_highlight();l=k.widget_side_of_jquery(f);if(h&&0<h.length&&!(l&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack())&&(h.get(0)===f.get(0)||jQuery.contains(h.get(0),f.get(0)))){if(h.is(".toontalk-top-level-backside"))return;
f=g();if(!f||0===f.length)return;q=f.offset();l=k.widget_side_of_jquery(f)}e&&e.view&&e.view.drag_x_offset?(m=e.view.drag_x_offset,n=e.view.drag_y_offset):n=m=0;if(h&&0<h.length){if(!(l&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack()||h.get(0)!==f.get(0)&&!jQuery.contains(h.get(0),f.get(0)))){k.set_css(h,{left:h.get(0).offsetLeft+(a.layerX-m),top:h.get(0).offsetTop+(a.layerY-n)});a.stopPropagation();return}g=k.widget_side_of_jquery(h);h.parent().is(".toontalk-drop-area")?(h.removeClass("toontalk-widget-in-drop_area"),
h.parent().data("drop_area_owner").set_next_robot(void 0)):((t=g.get_parent())?(r=$(t.get_element()),!g.is_backside()&&g.get_widget().get_infinite_stack&&g.get_widget().get_infinite_stack()?(r=g.get_widget().saved_width,t=g.get_widget().saved_height,g=g.copy(),g.get_widget().saved_width=r,g.get_widget().saved_height=t,r=h.width(),t=h.height(),h=$(g.get_element(!0)),f.is(".toontalk-backside")&&k.set_css(h,{width:e.view.frontside_width||r,height:e.view.frontside_height||t})):t.removed_from_container&&
(r.is(".toontalk-backside")?t.remove_backside_widget(g,!0):(t.removed_from_container(g,a),g.restore_dimensions&&!t.is_empty_hole()&&g.restore_dimensions()))):k.restore_resource(h,g),g.robot_in_training()&&g.robot_in_training().add_newly_created_widget_if_new(g))}else{if(0<a.dataTransfer.files.length){for(e=0;e<a.dataTransfer.files.length;e++)E(a.dataTransfer.files[e],f,l,q,a);a.stopPropagation();return}if(H(a)){N(a.dataTransfer.getData("URL"),f,l,q,a);a.stopPropagation();return}g=k.create_from_json(e,
{event:a});if(!g){e?k.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):b.debugging&&console.log("No data transfer in drop.");a.stopPropagation();return}g.robot_in_training()&&g.robot_in_training().drop_from_data_transfer(g);h=$(g.get_element(!0));g.is_primary_backside&&g.is_primary_backside()&&(k.set_css(h,{width:e.view.backside_width,height:e.view.backside_height,"background-color":e.view.background_color,"border-width":e.view.border_width}),g.apply_backside_geometry())}l&&
g.get_widget()===l.get_widget()||y(f,h,g,l,q,a,e,m,n)}}else a.dataTransfer?k.report_internal_error("Drop failed since unable to parse as JSON."):k.report_internal_error("Drop failed since there is no event.dataTransfer"),a.stopPropagation()},f=function(a,b){a.addEventListener("drop",function(a){var c=r(a);k.restore_resource(k.get_$dragee(),c);b(a)})},w=function(a,b){var c;c=$(b).closest(".toontalk-side");var d=k.get_$dragee();c=!c.is("*")||c.is(".toontalk-top-level-backside")||c.closest(".toontalk-top-level-resource").is("*")||
c.is(".toontalk-being-dragged")||d&&I(c.get(0),d.get(0))?void 0:c;if(c)return k.highlight_element(c.get(0),a),c.get(0)},y=function(a,b,c,d,e,f,g,h,l){var m=k.get_mouse_or_first_touch_event_attribute("pageX",f),n=k.get_mouse_or_first_touch_event_attribute("pageY",f),q,r,t,v;h||(h=0);l||(l=0);c.set_visible(!0);if(a.is(".toontalk-backside")){if(c.get_widget().is_top_level()){q=g.semantic.backside_widgets;r=g.shared_widgets;t=a.get(0);(b=d.robot_in_training())&&b.drop_from_data_transfer(c,d);b=c.get_widget().get_backside_widgets().slice();
b.forEach(function(a,b){var e=a.get_widget(),f,g,h,p,l,m,u;c.remove_backside_widget(a);f=0<=q[b].widget.shared_widget_index?r[q[b].widget.shared_widget_index].view:q[b].widget.view;g=a.get_element(!0);a.is_backside()?(h=f.backside_left,p=f.backside_top,l=f.backside_width,m=f.backside_height):(h=f.frontside_left,p=f.frontside_top,l=f.frontside_width,m=f.frontside_height);d.add_backside_widget(a);t.appendChild(g);u=$(g).position();v={left:u.left+h,top:u.top+p,width:l,height:m};k.constrain_css_to_fit_inside(t,
v);k.set_css(g,v);c.set_location_attributes&&e.set_location_attributes(v.left,v.top);a.is_backside()&&(e.backside_geometry=f.backside_geometry,e.apply_backside_geometry())}.bind(this));return}if(!d){k.report_internal_error("No target_widget");return}c?d.widget_side_dropped_on_me(c,f):k.report_internal_error("No source_widget");f=m-(e.left+(h||0));l=n-(e.top+(l||0));k.set_css(b,{left:k.left_as_percent(f,b.get(0)),top:k.top_as_percent(l,b.get(0))});!c.is_backside()&&c.set_location_attributes&&c.set_location_attributes(f,
l);g&&g.semantic&&g.semantic.running&&!k.get_$dragee()&&c.set_running(!0)}else if(a.is(".toontalk-drop-area"))b.addClass("toontalk-widget-in-drop_area"),0<a.length&&a.get(0).appendChild(b.get(0)),b.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(k.widget_side_of_jquery(b));else{if(b.is(".toontalk-backside-of-top-level"))return;if(d||f.changedTouches){t=a.closest(".toontalk-top-level-backside").get(0);!t&&f.changedTouches&&(g=document.elementFromPoint(m-window.pageXOffset,n-window.pageYOffset),
(t=$(g).is(".toontalk-top-level-backside")?g:$(g).closest(".toontalk-top-level-backside").get(0))||(t=$(".toontalk-top-level-backside").get(0)),d=k.widget_side_of_element(t).get_backside());if(!t)return;t.appendChild(b.get(0));g=$(t).offset();k.set_css(b,{left:m-(g.left+h),top:n-(g.top+l)});c.drop_on&&c.drop_on(d,f)||d.widget_side_dropped_on_me&&d.widget_side_dropped_on_me(c,f)||(b=a.closest(".toontalk-top-level-backside"),0<b.length&&(d=k.widget_side_of_jquery(b))&&d.widget_side_dropped_on_me(c,
f))}else{k.report_internal_error("target widget missing");return}}k.remove_highlight()},E=function(a,c,d,e,f){var g=new FileReader,h=0===a.type.indexOf("image"),l=0===a.type.indexOf("audio"),m=0===a.type.indexOf("video"),n,r,t;g.onloadend=function(){if(h)n=b.element.create("<img src='"+g.result+"' alt='"+a.name+"'/>");else if(l)n=b.element.create(a.name+" sound"),n.set_sound_effect(new Audio(g.result));else if(m)n=b.element.create("<video src='"+g.result+"' alt='"+a.name+"'/>");else{if(r=q(g.result))try{t=
JSON.parse(r),n=k.create_from_json(t)}catch(v){}n||(n=b.element.create(g.result))}n&&n.robot_in_training()&&n.robot_in_training().drop_from_data_transfer(n,d);y(c,$(n.get_frontside_element(!0)),n,d,e,f,t)};h||l||m?g.readAsDataURL(a):g.readAsText(a)},N=function(a,c,d,e,f){var g=function(a,c,e,f){var g=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),y(c,$(a.get_frontside_element(!0)),a,d,e,f))};k.create_widget_from_URL(a,g,function(c){var d=f.dataTransfer.getData("text/html")||
f.dataTransfer.getData("text");d?g(b.element.create(d)):(k.display_message("Error: "+c+". When trying to fetch "+a),console.log(c))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&g(a,c,e,f)})},D=function(a,b){var c=$("<div class='"+a+"'>");k.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},J=function(){var a=k.get_path_to_toontalk_folder()+"sounds/",c=function(b){b=new Audio(a+b);b.volume=
k.get_audio_volume(b);return b};b.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),event_ignored:c("PLOP.mp3")};b.sounds.bird_fly.loop=!0},G=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},C=function(){c&&(c.removeClass("toontalk-being-dragged"),k.set_timeout(function(){c=
void 0}))},I=function(a,b){if(a===b)return!0;if(a.parentNode)return I(a.parentNode,b)},L=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",h,l;if(0>f)return a;for(;0<=f;){h=f+d.length;l=a.indexOf(e,h);if(0>l)return k.report_internal_error("Expected title to have matching pairs of "+d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(h,l));c=l+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},
H=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},M=[],O=[],R;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window?(a.stopPropagation(),0<M.length&&M.shift()()):a.data.editable_contents&&b.publish.republish(a.data)},!1);d.observe(window.document,{childList:!0,subtree:!0});k.available_types="number box element robot nest sensor top-level".split(" ");k.create_from_json=function(a,c,d){var e=function(a,
b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},f,g,h,l;if(a){c||(c={});c.guid_to_nest_table||(c.guid_to_nest_table={});a.shared_widgets&&(c.json_of_shared_widgets=a.shared_widgets,c.shared_widgets=[]);a.shared_html&&(c.shared_html=a.shared_html);if(a.widget)return(f=k.create_from_json(a.widget,c))&&a.is_backside?f.get_backside(!0):f;if(c&&c.shared_widgets&&0<=a.shared_widget_index){if(d=
c.shared_widgets[a.shared_widget_index])return d;d=c.json_of_shared_widgets[a.shared_widget_index];f=k.create_from_json(d,c,!0);return e(f,c,a.shared_widget_index)}(h=a.semantic)||(h=a);a=a.view;if(0<=h.shared_widget_index){if(!c.json_of_shared_widgets){k.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}f=k.create_from_json(c.json_of_shared_widgets[h.shared_widget_index],c,!0);return e(f,c,h.shared_widget_index)}if(b.creators_from_json[h.type]){c||(c={});
a?c.json_view=a:a=c.json_view;if(b.debugging)f=b.creators_from_json[h.type](h,c);else try{f=b.creators_from_json[h.type](h,c)}catch(m){console.error(m.stack),k.report_internal_error("Unable to recreate a "+h.type+". Error is "+m)}if(f&&f.get_backside){h.erased&&(b.widget.erasable(f),f.set_erased(h.erased));h.infinite_stack&&f.set_infinite_stack(h.infinite_stack);h.open_backside_only_if_stopped&&f.set_open_backside_only_if_stopped(!0);if(a){if(a.frontside_width)if(g=f.get_element()){if(f.ok_to_set_dimensions())if(l=
{width:a.frontside_width,height:a.frontside_height},"element"===h.type)f.on_update_display(function(){k.set_css(g,l)});else k.set_css(g,l)}else a.saved_width||(f.saved_width=a.frontside_width,f.saved_height=a.frontside_height);a.saved_width&&(f.saved_width=a.saved_width,f.saved_height=a.saved_height);a.backside_geometry&&(f.backside_geometry=a.backside_geometry)}h.backside_widgets&&(d?f.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(f,h.backside_widgets,c)}.bind(this):
this.add_backside_widgets_from_json(f,h.backside_widgets,c))}return f}k.report_internal_error("JSON type '"+h.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};k.add_backside_widgets_from_json=function(a,b,c){var d;b&&(d=this.create_array_from_json(b,c),a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:
a})))};k.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?k.create_from_json(a,b):a});return c};k.get_json_of_array=function(a,b,c,d,e,f){var g,h;c>=a.length?e():(g=a[c])?g.is_primary_backside&&g.is_primary_backside()?(h=function(f,g){b.push({widget:f,is_backside:!0});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),k.get_json(g.get_widget(),d,h,f)):g.is_widget?(h=function(f,g){b.push({widget:f});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),k.get_json(g,d,h,f)):(h=
function(f,g){b.push(f);this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),g.get_json(d,h,f)):k.get_json_of_array(a,b,c+1,d,e,f)};k.fresh_json_history=function(a){var b={widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=a.shared_html);return b};k.get_json_top_level=function(a,b,c){var d=this.fresh_json_history();k.maximum_json_generation_duration=c;k.get_json(a,d,function(c){0<d.shared_widgets.length&&(c.shared_widgets=d.shared_widgets.map(function(b,
e){var f=function(a){a=d.widgets_encountered.indexOf(a);return d.json_of_widgets_encountered[a]},g=function(a){return f(d.shared_widgets[a])},h=f(b);if(a===b)return h={semantic:h.semantic,view:h.view,version:h.version},c.semantic={shared_widget_index:e},h;c.semantic&&k.tree_replace_once(c.semantic,h,{shared_widget_index:e},g,k.generate_unique_id());return h}));c.shared_html=d.shared_html;b(c)},Date.now())};k.get_json=function(a,c,d,e){var f,g,h;b.debugging&&!c?k.report_internal_error("no json_history"):
(f=c.shared_widgets.indexOf(a),0<=f?d({shared_widget_index:f},e):(f=c.widgets_encountered.indexOf(a),0<=f?(f=k.insert_ancestors_last(a,c.shared_widgets),d({shared_widget_index:f},e)):(f=c.widgets_encountered.push(a)-1,(g=a.is_primary_backside&&a.is_primary_backside())&&(a=a.get_widget()),h=function(b,e){a.add_to_json&&(b=a.add_to_json(b,c));c.json_of_widgets_encountered[f]=b;a.add_backside_widgets_to_json?a.add_backside_widgets_to_json(b,c,function(){d(b,e)},e):d(b,e)},Date.now()-e<=k.maximum_json_generation_duration?
a.get_json(c,h,e):setTimeout(function(){a.get_json(c,h,Date.now())}))))};k.get_json_of_keys=function(a,b,c,d){var e;b||(b=[]);Object.keys(a).forEach(function(c){0>b.indexOf(c)&&(e||(e={}),a[c].get_json?a[c].get_json(void 0,function(a,b){e[c]={json:a}},d):e[c]=a[c])});c(e,d)};k.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?k.create_from_json(a[d].json,b):a[d]});return c};k.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=
e;var f;Object.keys(a).forEach(function(g){if(f=a[g]){if(f===b)return a[g]=c,!0;if("shared_widget_index"===g){if(this.tree_replace_once(d(f),b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};k.insert_ancestors_last=function(a,b){var c=a.get_widget(),d=-1;b.some(function(a,b){if(c.has_ancestor(a))return d=b,!0});0>d&&(d=b.length);b.splice(d,0,c);return d};k.toontalk_json_div=function(a,
b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name(),c=c.toString({for_json_div:!0}),f;"top-level"===e?b.is_backside()?(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),e+=k.describe_widgets(d))):e="a top-level widget":(e=k.add_a_or_an(e),b.is_backside()&&(e="the back of "+e));c&&(d=c.indexOf("data:image/"),0<d&&(f=c.indexOf("alt=",d),0>f&&(f=c.indexOf(">",d)),c=c.substring(0,d+20)+
" ... "+c.substring(f)));return"<div class='toontalk-json'>\nThis will be replaced by "+e+".\n"+(c?c+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,k.clean_json,"  ")+"</div></div>"};k.describe_widgets=function(a){var b="",c=a.length;a.forEach(function(a){c--;b+=k.add_a_or_an(a.get_type_name());1===c?b+=", and ":1<c&&(b+=", ")});return b};k.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,
c)+" ... "+a.substring(b,a.length)};k.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:b};k.create_widget_from_URL=function(a,c,d){var e=function(g){try{var h=this.getResponseHeader("content-type"),k,l;if(!h)if(l=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),0===a.indexOf(l))h="";else{d&&d("Could not determine the contents type of the url");f.removeEventListener("readystatechange",e);return}0===h.indexOf("audio")?
(k=b.element.create(a),k.set_sound_effect(new Audio(a))):0===h.indexOf("image")?k=b.element.create("<img src='"+a+"'>"):0===h.indexOf("video")?k=b.element.create("<video src='"+a+" ' width='320' height='240'>"):0===h.indexOf("text")&&0>h.indexOf("text/html")?this.responseText&&(k=b.element.create(this.responseText),k.set_source_URL(a)):k=b.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");k&&c(k)}catch(m){d&&d(m),c()}f.removeEventListener("readystatechange",
e)},f=new XMLHttpRequest;f.addEventListener("readystatechange",e);f.open("GET",a,!0);try{f.send()}catch(g){d?d(g):(k.display_message("Error trying to GET "+a+" "+g),console.error(g.stack))}};k.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};k.copy_widget_sides=function(a,b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};k.copy_array=function(a){return a.slice()};k.generate_unique_id=
function(){h+=1;return"toontalk_id_"+h};k.get_style_property=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)};k.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;if("string"===typeof c){d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;c=parseInt(c,10);return isNaN(c)?void 0:c}return c};
k.data_transfer_json_object=function(a){var c,d;if(a.dataTransfer&&!(0<a.dataTransfer.files.length||H(a))){try{c=a.dataTransfer.getData("text/html")}catch(e){c=a.dataTransfer.getData("text")}if(!c||c.match(/[\u3400-\u9FBF]/))c=a.dataTransfer.getData("text");if(c){if(a=q(c))try{return JSON.parse(a)}catch(e){k.report_internal_error("Exception parsing "+a+"\n"+e.toString())}a=b.element.create("");a.get_frontside_element(!0);a.set_HTML(c);a.get_json(k.fresh_json_history(),function(a,b,c){0<=a.html.shared_html_index&&
(a.html=c.shared_html[a.html.shared_html_index]);d=a});return d}}};k.drag_and_drop=function(a){var b;k.draggable(a);k.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,k.enable_touch_events(a,b))};k.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){g(b,a)});a.addEventListener("dragend",function(b){n(b,a)})};k.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();
return!1});a.addEventListener("drop",function(b){b.preventDefault();v(b,a);b.stopPropagation()});a.addEventListener("dragenter",function(c){var d=w(c,a);d&&b!==d&&k.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!k.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(k.remove_highlight(b),b=void 0);a.stopPropagation()})};k.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;
$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");b.appendChild(d);k.can_receive_drops(b);return b};k.process_json_elements=function(){$(".toontalk-json").each(function(a,c){var d=c.textContent,e,f,g,h;if(d){d=d.substring(d.indexOf("{"),d.lastIndexOf("}")+1);e=JSON.parse(d);if(e.semantic&&"top_level"===e.semantic.type&&!b.no_local_storage&&!b.reset){if(e.load_most_recent_program)try{(h=window.localStorage.getItem("toontalk-last-key"))&&(g=window.localStorage.getItem(h))}catch(l){h=
"Error reading previous state. Error message is "+l,k.is_internet_explorer()?console.error("window.localStorage in IE11 not available with file://...: "+h):k.display_message(h)}g&&(e=JSON.parse(g),f=k.create_from_json(e))}f||(f=k.create_from_json(e));if(f){c.textContent="";if(f.get_type_name)if(f.is_top_level())d=f.get_backside(!0),d=d.get_element(),$(c).replaceWith(d),$(d).css({width:e.view.backside_width,height:e.view.backside_height,"background-color":e.view.background_color,"border-width":e.view.border_width});
else{if($(c).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),d=f.get_frontside_element(!0))$(d).addClass("toontalk-top-level-resource").css({position:"relative",width:f.saved_width,height:f.saved_height}),c.toontalk_widget_side=f,c.appendChild(d)}else c.appendChild(f.get_element());f.set_active&&f.set_active(!1);f.set_visible&&f.set_visible(!0);setTimeout(function(){f.update_display&&f.update_display();e.semantic.running&&f.set_running(!0)},1)}else k.report_internal_error("Could not recreate a widget from this JSON: "+
d)}})};k.relative_position_from_absolute_position=function(a,b){for(var c=a.parentElement,d=b.left,e=b.top,f;c&&"html"!==c.nodeType;)f=$(c).position(),d-=f.left,e-=f.top,c=c.parentElement;return{left:d,top:e}};k.set_absolute_position=function(a,b){var c=k.relative_position_from_absolute_position(a,b);k.set_css(a,{left:c.left,top:c.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=c.left+"px",a.style.top=c.top+"px")};k.set_position_relative_to_top_level_backside=function(a,
b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-top-level-backside"),b,c)};k.set_position_relative_to_element=function(a,b,c,d){var e=b.offset(),f,g;b.get(0).appendChild(a.get(0));e||(e={left:0,top:0});f=c.left-e.left;c=c.top-e.top;d&&(d=a.width(),e=a.height(),g=b.width(),b=b.height(),f>g-d&&(f=g-d),0>f&&(f=0),c>b-e&&(c=b-e),0>c&&(c=0));b={left:f,top:c,position:"absolute"};a.is(".toontalk-side-animating")?(a.get(0).style.left=f+"px",a.get(0).style.top=c+"px",k.add_one_shot_event_handler(a.get(0),
"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=""})):k.set_css(a,b);return b};k.restore_resource=function(a,c){var d,e;a&&a.is(".toontalk-top-level-resource")&&(d=c.copy({fresh_copy:!0}),e=d.get_frontside_element(!0),k.set_css(e,{width:a.width(),height:a.height()}),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),
a.css({position:"absolute"}),a.get(0).parentElement.appendChild(e),b.DISPLAY_UPDATES.pending_update(d),c.set_active&&(c.set_active(!0),d.set_active(!1)))};k.closest_element=function(a,c){var d,e;if(!c)return a.get(0);d=Number.MAX_VALUE;a.each(function(a,f){var g=$(f).offset(),g=b.UTILITIES.distance(g,c);d>g&&(e=f,d=g)});return e};k.find_resource_equal_to_widget=function(a,b){var c=Number.MAX_VALUE,d=$(b.get_frontside_element()).offset(),e;$(".toontalk-top-level-resource.toontalk-side").each(function(b,
f){var g=k.widget_side_of_jquery($(f));g&&(a.equals&&a.equals(g)||a.matching_resource&&a.matching_resource(g)||"matched"===a.match(g))&&(a.is_hole()||g.get_backside_widgets().length===a.get_backside_widgets().length)&&(g=k.distance($(f).offset(),d),c>g&&(e=f,c=g))});return e};k.set_position_is_absolute=function(a,b,c){var d,e;b?(b=k.get_style_numeric_property(a,"left"),d=k.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===
d&&(d=c.pageY-e.top,d-=90)),k.set_css(a,{left:k.left_as_percent(b,a),top:k.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};k.left_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:k.adjust_left_if_scaled(a,b);return 100*($(c).offset().left-window.pageXOffset+a-d.left)/d.width+"%"};k.top_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();
a="auto"===a||isNaN(a)?$(b).offset().top:k.adjust_top_if_scaled(a,b);return 100*($(c).offset().top+-window.pageYOffset+a-d.top)/d.height+"%"};k.adjust_left_if_scaled=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a-(d-c.get_attribute("width"))/2:a};k.adjust_top_if_scaled=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a-(d-c.get_attribute("height"))/
2:a};k.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";case 11:return"eleventh";case 12:return"twelfth";case 13:return"thirteenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};k.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};
k.give_tooltip=function(a,b){a.title=b;k.use_custom_tooltip(a)};k.use_custom_tooltip=function(a){var c=$(a),d;c.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){var e;0>a.top&&(a.top=0,e=c.offset(),e.left<$(window).width()/2?a.left=e.left+c.width()+10:(a.left=0,d=e.left-40));"bottom"===b.vertical?(c.is(".toontalk-robot")?a.top-=30:c.is(".toontalk-number")?a.top-=30:c.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,
window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);k.set_css(this,a)}},open:function(c,e){var f=e.tooltip.get(0).textContent.length,g=e.tooltip.get(0),h;g.innerHTML=L(e.tooltip.get(0).textContent,decodeURIComponent);100<f&&(h=Math.min(800,d||$(window).width()-100),$(g).position(),e.tooltip.css({maxWidth:h}));R&&R.remove();R=e.tooltip;setTimeout(function(){e.tooltip.remove();$(g).data("ui-tooltip")&&($(g).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),k.use_custom_tooltip(a));
R=void 0},f*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))},close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),k.use_custom_tooltip(a));R=void 0}})};k.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate'>decodeURIComponent"+a+"decodeURIComponent</span>")};k.remove_encoded_HTML=function(a){return L(a,function(){return""})};k.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,
f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};k.default_animation_speed=.5;k.animate_to_absolute_position=function(a,b,c,d,e,f){var g=$(a).offset(),h=$(a).position(),l=k.distance(b,g);0===f||0===d?(k.set_absolute_position(a,b),c&&c()):($(a).css({"z-index":k.next_z_index()}),f||(f=Math.round(l/(d||k.default_animation_speed))),$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=f+"ms",l=h.left+(b.left-g.left),g=h.top+(b.top-g.top),a.style.left=l+"px",a.style.top=g+"px",
a.toontalk_followed_by&&(b.left+=a.toontalk_followed_by.left_offset,b.top+=a.toontalk_followed_by.top_offset,k.animate_to_absolute_position(a.toontalk_followed_by.element,b,void 0,d,e)),e?setTimeout(c,f):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";c&&c()},f))};k.distance=function(a,b){var c=a.left-b.left,d=a.top-b.top;return Math.sqrt(c*c+d*d)};k.highlight_element=function(a,b,c){var d;if(a){k.remove_highlight();if(!$(a).is(".toontalk-backside")&&
(d=k.widget_side_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){k.remove_highlight(a)},c))}};k.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};k.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};k.inside_rectangle=function(a,b,
c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};k.constrain_css_to_fit_inside=function(a,b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=k.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,0),d):(c=k.extract_percentage_from_string(b.top),"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};k.extract_percentage_from_string=
function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(b){}};k.next_z_index=function(){a++;return a};k.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b);a.get(0).addEventListener("click",d);k.give_tooltip(a.get(0),c);return a.get(0)};k.create_close_button=function(a,b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button");c.addEventListener("click",a);k.give_tooltip(c,
b);d.innerHTML="&times;";c.appendChild(d);return c};k.check_radio_button=function(a){$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};k.create_alert_element=function(a){a=k.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};k.create_text_element=function(a){var b=document.createElement("div");b.innerHTML=a;$(b).addClass("ui-widget");return b};k.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};
k.create_anchor_element=function(a,c){var d=document.createElement("a");d.innerHTML=a;b.TRANSLATION_ENABLED&&(c=k.add_URL_parameter(c,"translate","1"));d.href=c;d.target="_blank";return d};k.create_text_input=function(a,b,c,d,e,g,h){var l=document.createElement("input"),m;l.type="text";l.className=b;l.value=a;k.give_tooltip(l,d);g&&(l.type=g);c?(a=document.createElement("label"),a.innerHTML=c,l.id=k.generate_unique_id(),a.htmlFor=l.id,e&&(m=k.create_anchor_element("i",e),$(m).addClass("toontalk-help-button notranslate"),
m.translate=!1),c=k.create_horizontal_table(a,l,m),$(a).addClass("ui-widget")):c=l;$(l).button().addClass("toontalk-text-input").css({"background-color":"white"});l.addEventListener("touchstart",function(){$(l).select()});h&&f(l,h);k.use_custom_tooltip(l);return{container:c,button:l}};k.create_text_area=function(a,b,c,d,e,g){var h=document.createElement("textarea");h.className=b;h.value=a;k.give_tooltip(h,d);a=document.createElement("label");a.innerHTML=c;h.id=k.generate_unique_id();a.htmlFor=h.id;
c=k.create_horizontal_table(a,h);$(h).button().addClass("toontalk-text-area").css({background:"white"});h.addEventListener("touchstart",function(){$(h).select()});e&&f(h,e);$(a).addClass("ui-widget");k.use_custom_tooltip(h);return{container:c,button:h}};k.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();if(c=r(a)){if(c.is_backside())return;if(d=b(c,a))$(a.currentTarget).trigger("change"),a.currentTarget.value=d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};k.create_radio_button=
function(a,b,c,d,e,f){var g=document.createElement("div"),h=document.createElement("input"),l=document.createElement("label");h.type="radio";g.className=c;h.name=a;h.value=b;l.innerHTML=d;h.id=k.generate_unique_id();l.htmlFor=h.id;g.appendChild(h);g.appendChild(l);k.give_tooltip(g,e);f||$(h).button();k.use_custom_tooltip(h);return{container:g,button:h,label:l}};k.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),h=document.createElement("select"),l=document.createElement("label");
h.className=c;h.name=a;h.id=k.generate_unique_id();l.innerHTML=d;l.htmlFor=h.id;g.appendChild(l);g.appendChild(h);k.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&(k.give_tooltip(c,f[b]),k.use_custom_tooltip(c));h.appendChild(c)});$(h).addClass("ui-widget");$(l).addClass("ui-widget");k.use_custom_tooltip(h);return{container:g,menu:h,label:l}};k.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),
g=document.createElement("label");f.type="checkbox";f.className=b;f.checked=a;g.innerHTML=c;f.id=k.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);k.give_tooltip(e,d);k.use_custom_tooltip(f);return{container:e,button:f,label:g}};k.create_horizontal_table=function(){var a=document.createElement("table"),b,c,d;c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),
d.appendChild(arguments[b]));return a};k.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=k.create_row(arguments[b]),a.appendChild(c));return a};k.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)arguments[c]&&a.appendChild(arguments[c]);b.appendChild(a);return a};k.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};
k.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if(arguments[a].checked)return arguments[a]};k.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+a},c.addEventListener("error",d));return c};k.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),
c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};k.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');a&&b.addClass(a);return b.get(0)};k.become_file_data_table=function(a,
c,d,e){$(a).DataTable({data:c,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,c,f,g){a=d?a.substring(0,a.length-5):a;c=d?b.google_drive.google_drive_url(f.id):"Click to load this program.";if(e)return"<div class='"+e+"' title='"+c+"'id='"+f.id+"'>"+a+"</div>";b.TRANSLATION_ENABLED&&(c=k.add_URL_parameter(c,"translate","1"));return"<a href='"+c+"'target='_blank' title='Click to open published page.'>"+a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,
b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};k.get_local_files_data=function(){return k.get_all_locally_stored_program_names().map(function(a){var b=k.get_local_storage_meta_data(a);if(b)return{title:a,modifiedDate:b.last_modified,createdDate:b.created,fileSize:b.file_size}})};k.create_local_files_table=function(){var a=k.get_local_files_data(),
b=k.create_file_data_table();k.when_attached(b,function(){k.become_file_data_table(b,a,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});return b};k.get_$dragee=function(){return c};k.add_URL_parameter=function(a,b,c){a=k.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?"&":"?";return a+d+b+"="+c};k.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,
c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};k.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};k.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};k.maximum_string_length=
function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};k.backup_all_top_level_widgets=function(a){$(".toontalk-top-level-backside").each(function(b,c){k.widget_side_of_element(c).get_widget().save(a)})};k.make_resizable=function(a,b){var c,d;a.resizable({start:function(a,b){c=b.originalSize.width;d=b.originalSize.height},resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-
c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},handles:"n,e,s,w"})};k.match=function(a,b){var c=a.match(b);return c.is_widget&&b.matched_by?b.matched_by(a):c};k.current_URL=function(){return window.location.pathname};k.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");
return 0>c?a:b.substring(0,c+9)+a};k.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&k.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};k.copy_frontside_dimensions=function(a,b){var c=a.get_widget().get_frontside_element(),d;c&&(d=b.get_frontside_element(!0))&&k.set_css(d,{width:$(c).width(),height:$(c).height()})};k.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?k.scale_element(a,c,d,c,d):k.scale_element(a,$(b).width(),$(b).height(),
c,d)};k.scale_element=function(a,b,c,d,e,f,g,h,l){var m,n;d||(m=$(a).children("img"),d=m.is("*")?m.width():$(a).width());e||(m||(m=$(a).children("img")),e=m.is("*")?m.height():$(a).height());m=b&&0!==d?b/d:a.toontalk_x_scale||1;n=c&&0!==e?c/e:a.toontalk_y_scale||1;0===m&&(m=1);0===n&&(n=1);a.toontalk_x_scale=m;a.toontalk_y_scale=n;h=(h=h&&h!==document.body?h:a.parentElement)&&0>h.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var q="";g||(g={});"number"===typeof g.left&&
(g.left-=(d-b)/2,l=!0);"number"===typeof g.top&&(g.top-=(e-c)/2,l=!0);!l&&h?(b&&(a.toontalk_translate_x=(b-d)/2,q+="translateX("+a.toontalk_translate_x+"px) "),c&&(a.toontalk_translate_y=(c-e)/2,q+="translateY("+a.toontalk_translate_y+"px) ")):(a.toontalk_translate_x=void 0,a.toontalk_translate_y=void 0);k.add_transform_to_css((f||"")+" scale("+m+", "+n+")",q,g,h);g.width=d;g.height=e;k.set_css(a,g);return{x_scale:m,y_scale:n}};k.translate_x=function(a){return t("toontalk_translate_x","toontalk_x_scale")};
k.translate_y=function(a){return t("toontalk_translate_y","toontalk_y_scale")};k.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),k.set_css_transform(c,b+a))};k.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};k.run_when_dimensions_known=function(a,b,c){var d=a.parentElement,e=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")},
f;!c&&$(a).width()&&e(d)?setTimeout(function(){b(d)}):(f=function(c){setTimeout(function(){var g=$(a).width(),h=$(a).height();g&&h?e(a.parentElement)?(b(d),d?d.appendChild(a):a.parentElement===document.body&&$(a).remove(),$(a).removeClass("toontalk-not-observable")):k.run_when_dimensions_known(a,b,!0):setTimeout(function(){k.widget_side_of_element(a);1E4>c&&f(2*c)},c)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),c&&k.set_css(a,{width:"",height:"",transform:""}),f(1))};
k.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&k.run_when_dimensions_known(d,function(){var a=$(d).children("img");a.is("*")?b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};k.relative_position=function(a,b){var c,d;if(!k.is_attached(a))return{left:0,top:0};c=$(a).offset();b&&(d=$(b).offset(),c.left-=d.left,c.top-=d.top);return c};k.add_animation_class=function(a,b){k.set_css(a,{width:"",height:""});$(a).addClass(b)};k.widget_side_of_jquery=
function(a){if(0<a.length)return a.get(0).toontalk_widget_side};k.widget_side_of_element=function(a){return a.toontalk_widget_side};k.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};k.display_message_if_new=function(a){0>O.indexOf(a)&&(k.display_message(a),O.push(a))};k.display_message=function(a){var c=k.create_alert_element(a);$(".toontalk-alert-element").remove();
console.log(a);console.trace();document.body.insertBefore(c,document.body.firstChild);setTimeout(function(){$(c).remove()},Math.max(2E3,a.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)))};k.display_tooltip=function(a){k.use_custom_tooltip(a.get(0));a.tooltip("open")};k.report_internal_error=function(a){console.log(a);console.trace();b.debugging&&k.display_message("Error: "+a)};k.get_current_url_boolean_parameter=function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+
"=1")?!0:!1};k.get_current_url_numeric_parameter=function(a,b){var c=k.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};k.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>d&&(d=window.location.href.length);return window.location.href.substring(c,d)};k.get_path_to_toontalk_folder=function(){return b.TOONTALK_URL};k.is_browser_of_type=
function(a){return 0<=window.navigator.userAgent.indexOf(a)};k.is_internet_explorer=function(){return k.is_browser_of_type("MSIE")||k.is_browser_of_type("Trident")};k.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};k.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};k.remove_z_index=function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$(a);a.attr("z-index","");return a.html()};k.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),
b=!1,c=function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),d.innerHTML="Run all tests",k.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),d.innerHTML="Stop all tests");b=!b},d;0!==a.length&&(a.button(),d=a.get(0),d.innerHTML="Run all tests",a.get(0).addEventListener("click",c))};k.set_timeout=function(a,b){b?setTimeout(a,b):(M.push(a),window.postMessage("zero-timeout-message",
"*"))};k.get_first_property=function(a){return Object.keys(a)[0]};k.get_all_locally_stored_program_names=function(){var a=window.localStorage.getItem("toontalk-all-program-names");return a?JSON.parse(a):[]};k.set_all_locally_stored_program_names=function(a){window.localStorage.setItem("toontalk-all-program-names",JSON.stringify(a))};k.get_local_storage_meta_data=function(a){a=k.local_storage_program_meta_data_key(a);var b;try{if(b=window.localStorage.getItem(a))return JSON.parse(b)}catch(c){}};k.local_storage_program_key=
function(a){return"toontalk-json: "+a};k.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};k.enable_editor=function(a,b,c,d){(function(a,b){var c=function(a){a.data.editor_enabled_for&&a.data.editor_enabled_for===b&&(e=!0,window.removeEventListener("message",c))},d=function(a,b){e||setTimeout(function(){a();d(a,b)},500)},e=!1;window.addEventListener("message",c);d(a,b)})(function(){a.postMessage({save_edits_to:window.location.href,file_id:c,widgets_json:d},"*")},c)};
k.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};k.enable_touch_events=function(a,c){var d=a,e=function(c){c.stopPropagation();c.preventDefault();f?(f=!1,n(c,a),b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\ndrag ended"),v(c,a),b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\ndrop happened"),b.logging&&0===b.logging.indexOf("touch")&&(alert(b.debugging),b.debugging="touch")):h=!0;a=d},f=!1,h=!1,l=0,m=0,q;a.addEventListener("touchstart",
function(d){b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\ntouch start");d.preventDefault();"TEXTAREA"===d.srcElement.tagName||"INPUT"===d.srcElement.tagName||$(d.srcElement).is(".ui-resizable-handle")?b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\ntouch start ignored due to tag name or class"):(d.stopPropagation(),k.set_timeout(function(){var c=d.changedTouches[0],e,n,q;h?(h=!1,e=document.createEvent("MouseEvent"),e.initMouseEvent("click",!0,!0,window,1,c.screenX,c.screenY,
c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(e),b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\ntouch end treated as click",alert(b.debugging),b.debugging="touch")):(f=!0,(e=k.widget_side_of_element(a))&&e.get_infinite_stack()?(n=e.copy(),e.set_infinite_stack(!1),n.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(n=e.copy(),e.add_copy_to_container(n,0,0),q=$(a).offset(),a=n.get_frontside_element(!0)),n&&(e.add_copy_to_container(n,0,0),e.robot_in_training()&&
e.robot_in_training().copied(e,n,!1)),q||(q=$(a).offset()),g(d,a),l=c.clientX-q.left,m=c.clientY-q.top,b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\ndrag started"))},c))},!0);a.addEventListener("touchmove",function(c){var d;c.preventDefault();if(f){d=c.changedTouches[0];k.set_absolute_position(a,{left:d.pageX-l,top:d.pageY-m});c=k.find_widget_on_page_side(d,a,0,0);if(q&&q!==c){var e=q.get_frontside_element();k.remove_highlight(e);q=void 0}c&&(w(d,c.get_element()),q=c);b.logging&&0===
b.logging.indexOf("touch")&&(b.debugging+="\ndragged to "+(d.pageX-l)+", "+(d.pageY-m))}else b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\ntouch move ignored since drag_started not yet set. "+Date.now())},!0);a.addEventListener("touchend",e,!0);a.addEventListener("touchcancel",e,!0)};k.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};k.find_widget_on_page_side=function(a,b,c,d){var e=k.get_mouse_or_first_touch_event_attribute("pageX",
a);a=k.get_mouse_or_first_touch_event_attribute("pageY",a);var f;$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for($(b).show();c&&!c.toontalk_widget_side&&(!$(c).is(".toontalk-backside")||$(c).is(".toontalk-top-level-backside"));)c=c.parentNode;c&&(f=c.toontalk_widget_side);if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),b=f.get_type_name(),f&&"empty hole"===b?f.get_parent_of_frontside():f};k.closest_top_level_backside=function(a,
b){var c,d;$(".toontalk-top-level-backside").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return k.widget_side_of_element(c)};k.set_css=function(a,b){var c,d;if(b){if(c=k.widget_side_of_element(a)){d=c.dereference();if(d.is_backside()){b.transform||c.get_widget().location_constrained_by_container()||(b.width="",b.height="");$(a).css(b);return}$(a).is(".toontalk-temporarily-set-down")||(c.location_constrained_by_container()?
(b.left="",b.top=""):d.is_plain_text_element()&&(b.width="",b.height=""))}0===b.width&&(b.width="");0===b.height&&(b.height="");!b.transform&&"number"===typeof b.width&&"number"===typeof b.height&&d&&d.use_scaling_transform?d.use_scaling_transform(b):$(a).css(b)}};k.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};k.conjunction=function(a,b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?k.add_a_or_an(c):c;return d===a.length-
2?e+" and ":d===a.length-1?e:e+", "}).join("")};k.insert_function_bird_documentation=function(a,b){var c=TOONTALK[a]["function"],d=Object.keys(c),e="<table class='toontalk-function-bird-documentation-table'>";d.forEach(function(a,b){e+="<tr><td><div id='bird_id_"+b+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+c[a].title+"</td></tr>"});e+="</table>";$(b).html(e);d.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,
void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e&&(e.id=encodeURIComponent(b))})};k.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=k.widget_side_of_element(b);c&&c.rerender()})};k.visible_element=function(a){if(!a||!a.style||"none"===a.style.display)return!1;a=$(a);return(0<a.width()||0<a.height())&&"0"!==a.css("opacity")};k.get_audio_volume=function(a){var b=document.hidden?0:
k.get_current_url_numeric_parameter("volume",10)/100;0===b&&m.push({audio_object:a,volume:a.volume});return b};k.play_audio=function(a){a.play();l.push(a);a.addEventListener("ended",function(){var b=l.indexOf(a);0<=b&&l.splice(b,1)})};k.mute_audio_objects_playing=function(){l.forEach(function(a){m.push({audio_object:a,volume:a.volume});a.volume=0});l=[]};k.stop_audio_objects=function(){l.forEach(function(a){a.pause();a.currentTime=0})};k.restore_audio_volumes=function(){m.forEach(function(a){a.audio_object.volume=
a.volume;l.push(a.audio_object)});m=[]};k.is_attached=function(a){return jQuery.contains(window.document,a)};k.when_attached=function(a,b,c){var d=a.toontalk_attached_callback,e;e=d?function(){d();b()}:b;jQuery.contains(window.document,a)&&!c?(a.toontalk_attached_callback=void 0,$(a).removeClass("toontalk-has-attached-callback"),e()):(a.toontalk_attached_callback=e,c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};k.create_event=function(a,b){var c;try{c=
new CustomEvent(a,{detail:b})}catch(d){c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!1,!1,b)}return c};k.create_queue=function(){var a=[],c=0;return{getLength:function(){return a.length-c},isEmpty:function(){return 0==a.length},enqueue:function(c){var d=0==a.length;a.push(c);b.logging&&0<=b.logging.indexOf("queue")&&console.log(c._debug_string+" enqueued");return d},dequeue:function(){var d;if(0!=a.length)return d=a[c],b.logging&&0<=b.logging.indexOf("queue")&&console.log(d._debug_string+
" dequeued"),2*++c>=a.length&&(a=a.slice(c),c=0),d},peek:function(){return 0<a.length?a[c]:void 0},does_any_item_satisfy:function(b){var d;for(d=c;d<a.length;d++)if(b(a[d]))return!0;return!1}}};k.initialize=function(a){e||(a=function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget_side;c&&c.set_running&&c.set_running(!1)})},b.debugging=k.get_current_url_parameter("debugging"),b.logging=k.get_current_url_parameter("log"),0<k.get_current_url_numeric_parameter("volume",
10)&&J(),b.open_backside_only_if_alt_key=k.get_current_url_boolean_parameter("alt_key_to_open_backside"),b.reset=k.get_current_url_boolean_parameter("reset",!1),b.open_backside_only_if_alt_key||(b.open_backside_only_if_alt_key=k.get_current_url_boolean_parameter("puzzle"),b.open_backside_only_if_alt_key&&(b.reset=!0)),k.process_json_elements(),window.document.addEventListener("click",a),b.DEFAULT_QUEUE=window.TOONTALK.queue.create(),b.DEFAULT_QUEUE.start(),window.addEventListener("beforeunload",function(a){try{k.backup_all_top_level_widgets(!0)}catch(c){b.UTILITIES.report_internal_error(c)}}),
b.TRANSLATION_ENABLED=k.get_current_url_boolean_parameter("translate",!1),b.TRANSLATION_ENABLED?($("a").each(function(a,b){b.href=k.add_URL_parameter(b.href,"translate","1")}),$("#google_translate_element").is("*")||(a=document.createElement("div"),a.id="google_translate_element",document.body.insertBefore(a,document.body.firstChild)),document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]),G("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit")):
$("#google_translate_element").remove(),b.vacuum.the_vacuum||b.vacuum.create(),k.add_test_all_button(),D("toontalk-robot",b.robot),D("toontalk-empty-nest",b.nest),D("toontalk-bird-static",b.bird),$("[title]").each(function(a,b){k.use_custom_tooltip(b)}),document.addEventListener("visibilitychange",function(){document.hidden?k.mute_audio_objects_playing():(k.rerender_all(),k.restore_audio_volumes())}),setTimeout(function(){b.DISPLAY_UPDATES.update_display()},100),e=!0,document.dispatchEvent(b.UTILITIES.create_event("toontalk_initialized",
{})))};k.do_after_initialization=function(a){e?a():document.addEventListener("toontalk_initialized",a)};return k}(window.TOONTALK);window.initialize_toontalk=window.TOONTALK.UTILITIES.initialize;
