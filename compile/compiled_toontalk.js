(function(b){var h;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(h={},define(function(){return h})):h="undefined"!==typeof window?window:b:h=exports;(function(b){var e={greatest_common_divisor:function(f,b){if(1===b||1===f)return 1;for(var c;0!==b;){c=b;b=f%b;if(!isFinite(b))return 0;f=c}return f}};e.gcd=e.greatest_common_divisor;e.fromRandom=function(f){return Math.random()*(1<<f)>>>0};e.fromMillitime=function(){return+new Date};e.fromUnixtime=
function(){return.001*e.fromMillitime()|0};"undefined"!==typeof b&&(b.integer=e);(function(f){function b(f,e,d){if(d!==c)return f instanceof b?f:"undefined"===typeof f?a:b.parse(f);for(f=f||[];f.length&&!f[f.length-1];)--f.length;this._d=f;this._s=f.length?e||1:0}var c={};b._construct=function(f,a){return new b(f,a,c)};b.base=1E7;b.base_log10=7;var a=new b([],0,c);b.ZERO=a;var e=new b([1],1,c);b.ONE=e;var d=new b(e._d,-1,c);b.M_ONE=d;b._0=a;b._1=e;b.small=[a,e,new b([2],1,c),new b([3],1,c),new b([4],
1,c),new b([5],1,c),new b([6],1,c),new b([7],1,c),new b([8],1,c),new b([9],1,c),new b([10],1,c),new b([11],1,c),new b([12],1,c),new b([13],1,c),new b([14],1,c),new b([15],1,c),new b([16],1,c),new b([17],1,c),new b([18],1,c),new b([19],1,c),new b([20],1,c),new b([21],1,c),new b([22],1,c),new b([23],1,c),new b([24],1,c),new b([25],1,c),new b([26],1,c),new b([27],1,c),new b([28],1,c),new b([29],1,c),new b([30],1,c),new b([31],1,c),new b([32],1,c),new b([33],1,c),new b([34],1,c),new b([35],1,c),new b([36],
1,c)];b.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");b.prototype.toString=function(f){f=+f||10;if(2>f||36<f)throw Error("illegal radix "+f+".");if(0===this._s)return"0";if(10===f){f=0>this._s?"-":"";f+=this._d[this._d.length-1].toString();for(var c=this._d.length-2;0<=c;c--){for(var a=this._d[c].toString();7>a.length;)a="0"+a;f+=a}return f}c=b.digits;f=b.small[f];for(var a=this._s,e=this.abs(),d=[],g;0!==e._s;)g=e.divRem(f),e=g[0],g=g[1],d.push(c[g.valueOf()]);return(0>a?"-":"")+d.reverse().join("")};
b.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];b.parse=function(f,e){function d(f){f=f.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return f.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(f,b,p,c,a){a=+a;var e=0>a,d=p.length+a;f=(e?p:c).length;a=(a=Math.abs(a))>=f?a-f+e:0;f=Array(a+1).join("0");p+=c;return(b||"")+(e?p=f+p:p+=f).substr(0,d+=e?f.length:0)+(d<p.length?"."+p.substr(d):"")})}f=f.toString();if("undefined"===typeof e||10===+e)f=d(f);var g=(new RegExp("^([+\\-]?)("+("undefined"===
typeof e?"0[xcb]":16==e?"0x":8==e?"0c":2==e?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(f);if(g){var l=g[1]||"+",k=g[2]||"",g=g[3]||"";if("undefined"===typeof e)e="0x"===k||"0X"===k?16:"0c"===k||"0C"===k?8:"0b"===k||"0B"===k?2:10;else if(2>e||36<e)throw Error("Illegal radix "+e+".");e=+e;if(!b.radixRegex[e].test(g))throw Error("Bad digit for radix "+e);g=g.replace(/^0+/,"").split("");if(0===g.length)return a;l="-"===l?-1:1;if(10==e){for(k=[];7<=g.length;)k.push(parseInt(g.splice(g.length-b.base_log10,
b.base_log10).join(""),10));k.push(parseInt(g.join(""),10));return new b(k,l,c)}k=a;e=b.small[e];for(var n=b.small,m=0;m<g.length;m++)k=k.multiply(e).add(n[parseInt(g[m],36)]);return new b(k._d,l,c)}throw Error("Invalid BigInteger format: "+f);};b.prototype.add=function(f){if(0===this._s)return b(f);f=b(f);if(0===f._s)return this;if(this._s!==f._s)return f=f.negate(),this.subtract(f);var a=this._d;f=f._d;for(var e=a.length,d=f.length,g=Array(Math.max(e,d)+1),l=Math.min(e,d),k=0,n=0;n<l;n++)k=a[n]+
f[n]+k,g[n]=k%1E7,k=k/1E7|0;d>e&&(a=f,e=d);for(n=l;k&&n<e;n++)k=a[n]+k,g[n]=k%1E7,k=k/1E7|0;for(k&&(g[n]=k);n<e;n++)g[n]=a[n];return new b(g,this._s,c)};b.prototype.negate=function(){return new b(this._d,-this._s|0,c)};b.prototype.abs=function(){return 0>this._s?this.negate():this};b.prototype.subtract=function(f){if(0===this._s)return b(f).negate();f=b(f);if(0===f._s)return this;if(this._s!==f._s)return f=f.negate(),this.add(f);var e=this;0>this._s&&(e=new b(f._d,1,c),f=new b(this._d,1,c));var d=
e.compareAbs(f);if(0===d)return a;if(0>d){var g=f;f=e;e=g}e=e._d;f=f._d;var g=e.length,l=f.length,k=Array(g),n=0,m,h;for(m=0;m<l;m++)h=e[m]-n-f[m],0>h?(h+=1E7,n=1):n=0,k[m]=h;for(m=l;m<g;m++){h=e[m]-n;if(0>h)h+=1E7;else{k[m++]=h;break}k[m]=h}for(;m<g;m++)k[m]=e[m];return new b(k,d,c)};(function(){function f(a,e){for(var d=a._d,g=d.slice(),l=0;;){var k=(d[l]||0)+1;g[l]=k%1E7;if(9999999>=k)break;++l}return new b(g,e,c)}function a(f,e){for(var d=f._d,g=d.slice(),l=0;;){var k=(d[l]||0)-1;if(0>k)g[l]=
k+1E7;else{g[l]=k;break}++l}return new b(g,e,c)}b.prototype.next=function(){switch(this._s){case 0:return e;case -1:return a(this,-1);default:return f(this,1)}};b.prototype.prev=function(){switch(this._s){case 0:return d;case -1:return f(this,-1);default:return a(this,1)}}})();b.prototype.compareAbs=function(f){if(this===f)return 0;if(!(f instanceof b)){if(!isFinite(f))return isNaN(f)?f:-1;f=b(f)}if(0===this._s)return 0!==f._s?-1:0;if(0===f._s)return 1;var c=this._d.length,a=f._d.length;if(c<a)return-1;
if(c>a)return 1;a=this._d;f=f._d;for(--c;0<=c;c--)if(a[c]!==f[c])return a[c]<f[c]?-1:1;return 0};b.prototype.compare=function(f){if(this===f)return 0;f=b(f);return 0===this._s?-f._s:this._s===f._s?this.compareAbs(f)*this._s:this._s};b.prototype.isUnit=function(){return this===e||this===d||1===this._d.length&&1===this._d[0]};b.prototype.multiply=function(f){if(0===this._s)return a;f=b(f);if(0===f._s)return a;if(this.isUnit())return 0>this._s?f.negate():f;if(f.isUnit())return 0>f._s?this.negate():this;
if(this===f)return this.square();var e=this._d.length>=f._d.length,d=(e?this:f)._d,e=(e?f:this)._d,g=d.length,l=e.length,k=g+l,n=Array(k),m;for(m=0;m<k;m++)n[m]=0;for(m=0;m<l;m++){for(var k=0,h=e[m],u=g+m,t,p=m;p<u;p++)t=n[p]+h*d[p-m]+k,k=t/1E7|0,n[p]=t%1E7|0;k&&(t=n[p]+k,n[p]=t%1E7)}return new b(n,this._s*f._s,c)};b.prototype.multiplySingleDigit=function(f){if(0===f||0===this._s)return a;if(1===f)return this;var e;if(1===this._d.length)return e=this._d[0]*f,1E7<=e?new b([e%1E7|0,e/1E7|0],1,c):new b([e],
1,c);if(2===f)return this.add(this);if(this.isUnit())return new b([f],1,c);var d=this._d,g=d.length;e=g+1;for(var l=Array(e),k=0;k<e;k++)l[k]=0;for(var n=k=0;n<g;n++)e=f*d[n]+k,k=e/1E7|0,l[n]=e%1E7|0;k&&(l[n]=k);return new b(l,1,c)};b.prototype.square=function(){if(0===this._s)return a;if(this.isUnit())return e;var f=this._d,d=f.length,g=Array(d+d+1),l,k,n,m;for(m=0;m<d;m++)n=2*m,l=f[m]*f[m],k=l/1E7|0,g[n]=l%1E7,g[n+1]=k;for(m=0;m<d;m++){k=0;n=2*m+1;for(var h=m+1;h<d;h++,n++)l=f[h]*f[m]*2+g[n]+k,
k=l/1E7|0,g[n]=l%1E7;n=d+m;l=k+g[n];k=l/1E7|0;g[n]=l%1E7;g[n+1]+=k}return new b(g,1,c)};b.prototype.quotient=function(f){return this.divRem(f)[0]};b.prototype.divide=b.prototype.quotient;b.prototype.remainder=function(f){return this.divRem(f)[1]};b.prototype.divRem=function(f){f=b(f);if(0===f._s)throw Error("Divide by zero");if(0===this._s)return[a,a];if(1===f._d.length)return this.divRemSmall(f._s*f._d[0]);switch(this.compareAbs(f)){case 0:return[this._s===f._s?e:d,a];case -1:return[a,this]}var g=
this._s*f._s,l=f.abs(),k=this._d,n=k.length,m=[],h,u=new b([],0,c);for(u._s=1;n;)if(u._d.unshift(k[--n]),0>u.compareAbs(f))m.push(0);else{if(0===u._s)h=0;else{var t=u._d.length;h=l._d.length;t=1E7*u._d[t-1]+u._d[t-2];h=1E7*l._d[h-1]+l._d[h-2];u._d.length>l._d.length&&(t=1E7*(t+1));h=Math.ceil(t/h)}do{t=l.multiplySingleDigit(h);if(0>=t.compareAbs(u))break;h--}while(h);m.push(h);h&&(h=u.subtract(t),u._d=h._d.slice(),0===u._d.length&&(u._s=0))}return[new b(m.reverse(),g,c),new b(u._d,this._s,c)]};b.prototype.divRemSmall=
function(f){f=+f;if(0===f)throw Error("Divide by zero");var e=this._s*(0>f?-1:1);f=Math.abs(f);if(1>f||1E7<=f)throw Error("Argument out of range");if(0===this._s)return[a,a];if(1===f||-1===f)return[1===e?this.abs():new b(this._d,e,c),a];if(1===this._d.length){var d=new b([this._d[0]/f|0],1,c);f=new b([this._d[0]%f|0],1,c);0>e&&(d=d.negate());0>this._s&&(f=f.negate());return[d,f]}for(var g=this._d.slice(),d=Array(g.length),l=0,k=0,n=0,m;g.length;)l=1E7*l+g[g.length-1],l<f?(d[n++]=0,g.pop(),k=1E7*k+
l):(m=0===l?0:l/f|0,k=l-f*m,(d[n++]=m)?(g.pop(),l=k):g.pop());f=new b([k],1,c);0>this._s&&(f=f.negate());return[new b(d.reverse(),e,c),f]};b.prototype.isEven=function(){var f=this._d;return 0===this._s||0===f.length||0===f[0]%2};b.prototype.isOdd=function(){return!this.isEven()};b.prototype.sign=function(){return this._s};b.prototype.isPositive=function(){return 0<this._s};b.prototype.isNegative=function(){return 0>this._s};b.prototype.isZero=function(){return 0===this._s};b.prototype.exp10=function(f){f=
+f;if(0===f)return this;if(Math.abs(f)>Number(g))throw Error("exponent too large in BigInteger.exp10");if(0<f){for(var e=new b(this._d.slice(),this._s,c);7<=f;f-=7)e._d.unshift(0);if(0==f)return e;e._s=1;e=e.multiplySingleDigit(Math.pow(10,f));return 0>this._s?e.negate():e}if(-f>=7*this._d.length)return a;e=new b(this._d.slice(),this._s,c);for(f=-f;7<=f;f-=7)e._d.shift();return 0==f?e:e.divRemSmall(Math.pow(10,f))[0]};b.prototype.pow=function(f){if(this.isUnit())return 0<this._s?this:b(f).isOdd()?
this:this.negate();f=b(f);if(0===f._s)return e;if(0>f._s){if(0===this._s)throw Error("Divide by zero");return a}if(0===this._s)return a;if(f.isUnit())return this;if(0<f.compareAbs(g))throw Error("exponent too large in BigInteger.pow");for(var c=this,d=e,l=b.small[2];f.isPositive()&&(!f.isOdd()||(d=d.multiply(c),!f.isUnit()));)c=c.square(),f=f.quotient(l);return d};b.prototype.modPow=function(f,c){for(var a=e,d=this;f.isPositive();)f.isOdd()&&(a=a.multiply(d).remainder(c)),f=f.quotient(b.small[2]),
f.isPositive()&&(d=d.square().remainder(c));return a};b.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var f=this._d.length;if(30>7*f)return Math.log(this.valueOf());var e=Math.ceil(30/7),a=this._d.slice(f-e);return Math.log((new b(a,1,c)).valueOf())+(f-e)*Math.log(1E7)};b.prototype.valueOf=function(){return parseInt(this.toString(),10)};b.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var g=b(2147483647);b.MAX_EXP=g;(function(){function f(c){return function(f){return c.call(b(f))}}
function c(f){return function(c,e){return f.call(b(c),b(e))}}function e(f){return function(c,e,a){return f.call(b(c),b(e),b(a))}}(function(){var a,d,g="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),l="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),k=["modPow"];for(a=0;a<g.length;a++)d=g[a],b[d]=f(b.prototype[d]);for(a=0;a<l.length;a++)d=l[a],b[d]=c(b.prototype[d]);for(a=0;a<k.length;a++)d=
k[a],b[d]=e(b.prototype[d]);b.exp10=function(f,c){return b(f).exp10(c)}})()})();f.BigInteger=b})("undefined"!==typeof b?b:this);var a={greatest_common_divisor:function(f,b){if(b.isUnit()||f.isUnit())return BigInteger.ONE;for(var c;!b.isZero();)c=b,b=f.remainder(b),f=c;return f},create:function(){return[0]},clone:function(f){for(var b=[],c=0,a=f.length;c<a;c++)b[c]=f[c];return b},copy:function(f,b){f=[];for(var c=0,a=b.length;c<a;c++)f[c]=b[c];return f},abs:function(f,b){f[0]=Math.abs(b[0]);return f},
str:function(f){return f[0].toString()},toInteger:function(f){return out[0]},fromInteger:function(f){return[parseInt(f)]}};a.ZERO=a.fromInteger(0);a.ONE=a.fromInteger(1);"undefined"!==typeof b&&(b.bigint=a);if(!g)var g=Array;if(!m)var m=Math.pow(2,56);if(!l)var l=16777216;var c={EPSILON:2E-16};c.MAX_LOOPS=l;c.create=function(){var f=new g(2);f[0]=0;f[1]=1;return f};c.clone=function(f){var b=new g(2);b[0]=f[0];b[1]=f[1];return b};c.fromValues=function(f,b){var a=new g(2);a[0]=f;a[1]=b;return c.normalize(a,
a)};c.copy=function(f,b){f[0]=b[0];f[1]=b[1];return f};c.set=function(f,b,a){f[0]=b;f[1]=a;return c.normalize(f,f)};c.abs=function(f,b){f[0]=Math.abs(b[0]);f[1]=b[1];return f};c.invert=function(f,b){var c=b[0];f[0]=b[1];f[1]=c;return f};c.reciprocal=c.invert;c.add=function(f,b,a){b[1]===a[1]?(f[0]=b[0]+a[0],f[1]=b[1]):(f[0]=b[0]*a[1]+a[0]*b[1],f[1]=b[1]*a[1]);return c.normalize(f,f)};c.subtract=function(f,b,a){b[1]===a[1]?(f[0]=b[0]-a[0],f[1]=b[1]):(f[0]=b[0]*a[1]-a[0]*b[1],f[1]=b[1]*a[1]);return c.normalize(f,
f)};c.sub=c.subtract;c.multiply=function(f,b,a){f[0]=b[0]*a[0];f[1]=b[1]*a[1];return c.normalize(f,f)};c.mul=c.multiply;c.mediant=function(f,b,a){f[0]=b[0]+a[0];f[1]=b[1]+a[1];return c.normalize(f,f)};c.divide=function(f,b,a){f[0]=b[0]*a[1];f[1]=b[1]*a[0];return c.normalize(f,f)};c.div=c.divide;c.equals=function(f,b){return 0===f[0]&&0===b[0]||0===f[1]&&0===b[1]?!0:f[0]===b[0]&&f[1]===b[1]};c.approximates=function(f,b){if(c.equals(f,b))return!0;var a=c.create();c.sub(a,f,b);c.abs(a,a);return c.isLessThan(a,
c.INFINITESIMAL)};c.isGreaterThan=function(f,b){return c.equals(f,b)?!1:f[0]*b[1]>b[0]*f[1]};c.isLessThan=function(f,b){return c.equals(f,b)?!1:f[0]*b[1]<b[0]*f[1]};c.isNegative=function(f){return 0>f[0]};c.min=function(f,b,a){c.isLessThan(b,a)?(f[0]=b[0],f[1]=b[1]):(f[0]=a[0],f[1]=a[1]);return f};c.max=function(f,b,a){c.isGreaterThan(b,a)?(f[0]=b[0],f[1]=b[1]):(f[0]=a[0],f[1]=a[1]);return f};c.scalar_multiply=function(f,b,a){f[0]=b[0]*a;f[1]=b[1];return c.normalize(f,f)};c.scalar_divide=function(f,
b,a){f[0]=b[0];f[1]=b[1]*a;return c.normalize(f,f)};c.normalize=function(f,b){if(isNaN(b[0])||isNaN(b[1])||0===b[0]&&0===b[1])return f[0]=0,f[1]=0,f;if(0===b[0])return f[0]=0,f[1]=1,f;if(0===b[1])return f[0]=1,f[1]=0,f;if(b[0]===b[1])return f[0]=1,f[1]=1,f;0<b[1]?(f[0]=b[0],f[1]=b[1]):(f[0]=-b[0],f[1]=-b[1]);var a=e.greatest_common_divisor(Math.abs(f[0]),f[1]);1<a&&(f[0]/=a,f[1]/=a);return f};c.opposite=function(f,b){f[0]=-b[0];f[1]=b[1];return f};c.negative=c.opposite;c.neg=c.opposite;c.power=function(f,
b,a){2===a?(f[0]=b[0]*b[0],f[1]=b[1]*b[1]):0<a?(f[0]=Math.pow(b[0],a),f[1]=Math.pow(b[1],a)):0>a?(a=Math.abs(a),f[0]=Math.pow(b[1],a),f[1]=Math.pow(b[0],a)):c.copy(f,c.ONE);return c.normalize(f,f)};c.pow=c.power;c.sqrt=function(f,b){return c.nthRoot(f,b,2)};c.nthRoot=function(f,b,a){if(c.equals(b,c.ZERO))return c.copy(f,c.ZERO);if(c.equals(b,c.ONE))return c.copy(f,c.ONE);if(c.equals(b,c.INFINITY))return c.copy(f,c.INFINITY);if(c.equals(b,c.INFINULL))return c.copy(f,c.INFINULL);var e=c.isNegative(b);
e&&(b[0]=-b[0]);f=c.copy(f,c.ONE);for(var d=[1,0,0,1],g=c.clone(c.ONE),l=c.MAX_LOOPS;!c.approximates(b,g)&&l--;)c.isLessThan(b,g)?(d[0]+=d[1],d[2]+=d[3]):(d[1]+=d[0],d[3]+=d[2]),f[0]=d[0]+d[1],f[1]=d[2]+d[3],c.pow(g,f,a);e&&(b[0]=-b[0],1===a%2&&c.neg(f,f));return f};c.dot=function(f,b){return f[0]*b[0]+f[1]*b[1]};c.str=function(f){return 1===f[1]?f[0].toString():f[0]+"/"+f[1]};c.toDecimal=function(f){return f[0]/f[1]};c.dec=c.toDecimal;c.toInteger=function(f){return Math.round(c.toDecimal(f))};c.round=
c.toInteger;c.floor=function(f){return Math.floor(c.toDecimal(f))};c.ceil=function(f){return Math.ceil(c.toDecimal(f))};c.fromInteger_copy=function(f,b){f[0]=parseInt(b);f[1]=1;return f};c.fromInteger=function(f){return c.fromInteger_copy(c.create(),f)};c.fromIntegerInverse_copy=function(f,b){f[0]=1;f[1]=parseInt(b);0>f[1]&&(f[0]=-f[0],f[1]=-f[1]);return f};c.fromIntegerInverse=function(f){return c.fromIntegerInverse_copy(c.create(),f)};c.fromDecimal=function(f){return c.fromDecimal_copy(c.create(),
f)};c.fromDecimal_copy=function(f,b){b=parseFloat(b);if(isNaN(b))return c.copy(f,c.INFINULL);if(Infinity===b)return c.copy(f,c.INFINITY);if(Math.abs(b)<c.EPSILON)return c.copy(f,c.ZERO);if(Math.abs(b-1)<c.EPSILON)return c.copy(f,c.ONE);if(Math.abs(b%1)<c.EPSILON)return c.fromInteger_copy(f,b);if(Math.abs(1/b%1)<c.EPSILON)return c.fromIntegerInverse_copy(f,Math.round(1/b));c.copy(f,c.ONE);for(var a=[1,0,0,1],e=b,d=1,g=c.MAX_LOOPS;g--&&Math.abs(b-c.toDecimal(f))>c.EPSILON;){d=Math.floor(e);f[0]=d*a[0]+
a[2];f[1]=d*a[1]+a[3];if(e===d)break;e=1/(e-d);a[2]=a[0];a[3]=a[1];a[0]=f[0];a[1]=f[1]}return f};c.fromRandom=function(f){f[0]=0xfffffffffffff*Math.random()<<0;f[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return c.normalize(f,f)};c.sin=function(f,b){if(0===b[1])return c.copy(f,c.ZERO);c.scalar_multiply(f,b,2);var a=c.create();c.pow(a,b,2);c.add(a,a,c.ONE);c.divide(f,f,a);return f};c.cos=function(f,b){if(0===b[1])return c.neg(f,c.ONE);var a=c.create();c.pow(a,b,2);c.sub(f,c.ONE,a);var e=c.create();
c.add(e,c.ONE,a);c.divide(f,f,e);return f};c.tan=function(f,b){c.scalar_multiply(f,b,2);var a=c.create();c.pow(a,b,2);c.scalar_multiply(a,a,2);c.add(f,f,a);c.pow(a,b,4);c.sub(a,c.ONE,a);c.divide(f,f,a);return f};c.toEgyptian=function(f){f=c.clone(f);c.abs(f,f);var b=c.floor(f);b&&c.sub(f,f,c.fromInteger(b));if(!f[0])return b.toString();b||(b="");for(var a=1,e=c.create();1!==f[0];)a++,e=c.fromValues(1,a),c.isGreaterThan(f,e)&&(b&&(b+=" + "),b+=c.str(e),c.sub(f,f,e));return f?b?b+" + "+c.str(f):c.str(f):
b?b:"0"};c.toBabylonian=function(f){var b="",a=c.toDecimal(f);f=parseInt(a);for(var a=a-f,e=0,d=0;0<f;)(e=f%60)&&(b=e+" * 60^"+d+(b?" + ":"")+b),f=(f-e)/60,d++;for(d=-1;0<a;)a*=60,e=parseInt(a+1E-13),a-=e,-1E-13>a||(e&&(b+=(b?" + ":"")+e+" * 60^"+d),d--);return b?b:"0"};c.traceSternBrocot=function(f){var b="";if(c.equals(f,c.ZERO)||c.equals(f,c.ONE)||c.equals(f,c.INFINITY)||c.equals(f,c.INFINULL))return b;f=c.clone(f);c.isNegative(f)&&(f[0]=-f[0]);for(var a=c.clone(c.ONE),e=[1,0,0,1],d=0,g=0,l=c.MAX_LOOPS;!c.approximates(f,
a)&&l--;)c.isLessThan(f,a)?(e[0]+=e[1],e[2]+=e[3],g++,d&&(b+="R",1!==d&&(b+=d),d=0,b+=" ")):(e[1]+=e[0],e[3]+=e[2],d++,g&&(b+="L",1!==g&&(b+=g),g=0,b+=" ")),a[0]=e[0]+e[1],a[1]=e[2]+e[3];g?(b+="L",1!==g&&(b+=g)):d&&(b+="R",1!==d&&(b+=d));0>l&&(b+="...");return b};c.toContinuedFraction=function(b,a){a="undefined"===typeof a?65536:parseInt(a);if(c.equals(b,c.ZERO))return[0];if(c.equals(b,c.ONE))return[1];if(c.equals(b,c.NEGONE))return[-1];if(c.equals(b,c.INFINITY))return[1,0];if(c.equals(b,c.INFINULL))return[0,
0];var e=c.clone(b),d=c.isNegative(e);d&&(e[0]=-e[0]);for(var g=c.clone(c.ONE),l=[1,0,0,1],k=1,n=[0],m=n.length-1;!c.equals(e,g)&&a--;)c.isLessThan(e,g)?(-1===k?n[m]++:(k=-1,n.push(1),m++),l[0]+=l[1],l[2]+=l[3]):(1===k?n[m]++:(k=1,n.push(1),m++),l[1]+=l[0],l[3]+=l[2]),g[0]=l[0]+l[1],g[1]=l[2]+l[3];0>a?n.push(0):n[m]++;if(d)for(var h in n)n[h]=-n[h];return n};c.fromContinuedFraction=function(b,a){c.fromInteger_copy(b,a[a.length-1]);for(var e=a.length-2;-1<e;e--)c.invert(b,b),c.add(b,c.fromInteger(a[e]),
b);return b};c.dump=function(b){c.create();return"rat\t"+c.str(b)+"\n~\t"+c.toDecimal(b)+"\nCF:\t["+c.toContinuedFraction(b)+"]\n"};c.ZERO=c.fromInteger(0);c.ONE=c.fromInteger(1);c.NEGONE=c.fromInteger(-1);c.INFINITY=c.fromValues(1,0);c.INFINULL=c.fromValues(0,0);c.INFINITESIMAL=c.clone([1,m]);c.PI=c.fromValues(1320192667429,420230377710);"undefined"!==typeof b&&(b.rat=c);if(!h)var h=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!q)var q=1073741824;var k={EPSILON:2E-16};k.MAX_LOOPS=q;k.create=
function(){var b=[];b[0]=BigInteger.ZERO;b[1]=BigInteger.ONE;return b};k.clone=function(b){var a=[];a[0]=b[0];a[1]=b[1];return a};k.fromValues=function(b,a){var c=[];c[0]=new BigInteger(b);c[1]=new BigInteger(a);return k.normalize(c,c)};k.copy=function(b,a){b[0]=a[0];b[1]=a[1];return b};k.set=function(b,a,c){b[0]=a;b[1]=c;return k.normalize(b,b)};k.toRat=function(b,a){return c.set(b,a[0].toJSValue(),a[1].toJSValue())};k.fromRat=function(b,a){return k.set(b,BigInteger(a[0]),BigInteger(a[1]))};k.abs=
function(b,a){b[0]=a[0].abs();b[1]=a[1];return b};k.invert=function(b,a){var c=a[0];b[0]=a[1];b[1]=c;return b};k.reciprocal=k.invert;k.add=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].add(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).add(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return k.normalize(b,b)};k.subtract=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].subtract(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).subtract(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return k.normalize(b,
b)};k.sub=k.subtract;k.multiply=function(b,a,c){b[0]=a[0].multiply(c[0]);b[1]=a[1].multiply(c[1]);return k.normalize(b,b)};k.mul=k.multiply;k.mediant=function(b,a,c){b[0]=a[0].add(c[0]);b[1]=a[1].add(c[1]);return k.normalize(b,b)};k.divide=function(b,a,c){b[0]=a[0].multiply(c[1]);b[1]=a[1].multiply(c[0]);return k.normalize(b,b)};k.div=k.divide;k.equals=function(b,a){return b[0].isZero()&&a[0].isZero()||b[1].isZero()&&a[1].isZero()?!0:0===b[0].compare(a[0])&&0===b[1].compare(a[1])};k.approximates=
function(b,a){if(k.equals(b,a))return!0;var c=k.create();k.sub(c,b,a);k.abs(c,c);return k.isLessThan(c,k.INFINITESIMAL)};k.isGreaterThan=function(b,a){return k.equals(b,a)?!1:0<b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};k.isLessThan=function(b,a){return k.equals(b,a)?!1:0>b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};k.isNegative=function(b){return b[0].isNegative()};k.min=function(b,a,c){k.isLessThan(a,c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};k.max=function(b,a,c){k.isGreaterThan(a,
c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};k.scalar_multiply=function(b,a,c){b[0]=a[0].multiply(c);b[1]=a[1];return k.normalize(b,b)};k.scalar_divide=function(b,a,c){b[0]=a[0];b[1]=a[1].multiply(c);return k.normalize(b,b)};k.normalize=function(b,c){if(c[0].isZero()||c[1].isZero())return c;if(0===c[0].compare(c[1]))return k.clone(k.ONE);if(c[1].isNegative())b[0]=c[0].negate(),b[1]=c[1].negate();else if(b[0]=c[0],b[1]=c[1],b[1].isZero())return b;var e=a.greatest_common_divisor(b[0].abs(),
b[1]);0<e.compare(BigInteger.ONE)&&(b[0]=b[0].quotient(e),b[1]=b[1].quotient(e));return b};k.opposite=function(b,a){b[0]=a[0].negate();b[1]=a[1];return b};k.negative=k.opposite;k.neg=k.opposite;k.power=function(b,a,c){2===c?(b[0]=a[0].square(),b[1]=a[1].square()):0<c?(b[0]=a[0].pow(c),b[1]=a[1].pow(c)):0>c?(c=Math.abs(c),b[0]=a[1].pow(c),b[1]=a[0].pow(c)):k.copy(b,k.ONE);return b};k.pow=k.power;k.sqrt=function(b,a){return k.nthRoot(b,a,2)};k.nthRoot=function(b,a,c){if(k.equals(a,k.ZERO))return k.copy(b,
k.ZERO);if(k.equals(a,k.ONE))return k.copy(b,k.ONE);if(k.equals(a,k.INFINITY))return k.copy(b,k.INFINITY);if(k.equals(a,k.INFINULL))return k.copy(b,k.INFINULL);var e=k.isNegative(a);e&&(a[0]=a[0].negate());k.copy(b,k.ONE);for(var d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=k.clone(k.ONE),l=q;!k.approximates(a,g)&&l--;)k.isLessThan(a,g)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3])):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2])),b[0]=d[0].add(d[1]),b[1]=d[2].add(d[3]),k.pow(g,b,c);e&&(a[0]=
a[0].negate(),1===c%2&&k.neg(b,b));return b};k.dot=function(b,a){return b[0].multiply(a[0]).add(b[1].multiply(a[1]))};k.str=function(b){return 0===b[1].compare(BigInteger.ONE)?b[0].toString():b[0].toString()+"/"+b[1].toString()};k.toDecimal=function(b){return b[0].toJSValue()/b[1].toJSValue()};k.dec=k.toDecimal;k.toInteger=function(b){return b[0].quotient(b[1]).toJSValue()};k.round=k.toInteger;k.toBigInteger=function(b){return b[0].quotient(b[1])};k.floor=function(b){return Math.floor(k.toDecimal(b))};
k.ceil=function(b){return Math.ceil(k.toDecimal(b))};k.fromInteger_copy=function(b,a){b[0]=BigInteger(a);b[1]=BigInteger.ONE;return b};k.fromInteger=function(b){return k.fromInteger_copy(k.create(),b)};k.fromIntegerInverse_copy=function(b,a){b[0]=BigInteger.ONE;b[1]=BigInteger(a);b[1].isNegative()&&(b[0]=b[0].negate(),b[1]=b[1].negate());return b};k.fromIntegerInverse=function(b){return k.fromIntegerInverse_copy(k.create(),b)};k.fromDecimal=function(b){return k.fromDecimal_copy(k.create(),b)};k.fromDecimal_copy=
function(b,a){a=parseFloat(a);if(isNaN(a))return k.copy(b,k.INFINULL);if(Infinity===a)return k.copy(b,k.INFINITY);if(Math.abs(a)<k.EPSILON)return k.copy(b,k.ZERO);if(Math.abs(a-1)<k.EPSILON)return k.copy(b,k.ONE);if(Math.abs(a%1)<k.EPSILON)return k.fromInteger_copy(b,a);if(Math.abs(1/a%1)<k.EPSILON)return k.fromIntegerInverse_copy(b,Math.round(1/a));k.copy(b,k.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=a,d=BigInteger(1),g=k.MAX_LOOPS;g--&&Math.abs(a-k.toDecimal(b))>
k.EPSILON;){d=BigInteger(Math.floor(e));b[0]=d.multiply(c[0]).add(c[2]);b[1]=d.multiply(c[1]).add(c[3]);if(d=e-parseInt(d.toString(),10))e=1/d;else{if(a.toString()===k.toDecimal(b))break;e=(c=(a.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;k.add(b,k.fromInteger(c[1]),k.fromValues(c[2],Math.pow(10,e)));break}c[2]=c[0];c[3]=c[1];c[0]=b[0];c[1]=b[1]}return b};k.fromRandom=function(b){b[0]=BigInteger(0xfffffffffffff*Math.random()<<0);b[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return k.normalize(b,b)};k.sin=function(b,a){if(a[1].isZero())return k.copy(b,k.ZERO);k.scalar_multiply(b,a,2);var c=k.create();k.pow(c,a,2);k.add(c,c,k.ONE);k.divide(b,b,c);return b};k.cos=function(b,a){if(a[1].isZero())return k.neg(b,k.ONE);var c=k.create();k.pow(c,a,2);k.sub(b,k.ONE,c);var e=k.create();k.add(e,k.ONE,c);k.divide(b,b,e);return b};k.tan=function(b,a){k.scalar_multiply(b,a,2);var c=k.create();k.pow(c,a,2);k.scalar_multiply(c,c,2);k.add(b,b,c);k.pow(c,a,4);k.sub(c,
k.ONE,c);k.divide(b,b,c);return b};k.toEgyptian=function(b){b=k.clone(b);k.abs(b,b);var a=k.floor(b);a&&k.sub(b,b,k.fromInteger(a));if(!b[0])return a.toString();a||(a="");for(var c=1,e=k.create();1!==b[0];)c++,e=k.fromValues(1,c),k.isGreaterThan(b,e)&&(a&&(a+=" + "),a+=k.str(e),k.sub(b,b,e));return b?a?a+" + "+k.str(b):k.str(b):a?a:"0"};k.toBabylonian=function(b){var a="",c=k.toDecimal(b);b=parseInt(c);for(var c=c-b,e=0,d=0;0<b;)(e=b%60)&&(a=e+" * 60^"+d+(a?" + ":"")+a),b=(b-e)/60,d++;for(d=-1;0<
c;)c*=60,e=parseInt(c+1E-13),c-=e,-1E-13>c||(e&&(a+=(a?" + ":"")+e+" * 60^"+d),d--);return a?a:"0"};k.traceSternBrocot=function(b){var a="";if(k.equals(b,k.ZERO)||k.equals(b,k.ONE)||k.equals(b,k.INFINITY)||k.equals(b,k.INFINULL))return a;b=k.clone(b);k.isNegative(b)&&(b[0]=b[0].negate());for(var c=k.clone(k.ONE),e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=0,g=0,l=65536;!k.equals(b,c)&&l--;)k.isLessThan(b,c)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3]),g++,d&&(a+="R",1!==d&&(a+=d),d=
0,a+=" ")):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2]),d++,g&&(a+="L",1!==g&&(a+=g),g=0,a+=" ")),c[0]=e[0].add(e[1]),c[1]=e[2].add(e[3]);g?(a+="L",1!==g&&(a+=g)):d&&(a+="R",1!==d&&(a+=d));0>l&&(a+="...");return a};k.toContinuedFraction=function(b,a){a="undefined"===typeof a?65536:parseInt(a);if(k.equals(b,k.ZERO))return[0];if(k.equals(b,k.ONE))return[1];if(k.equals(b,k.NEGONE))return[-1];if(k.equals(b,k.INFINITY))return[1,0];if(k.equals(b,k.INFINULL))return[0,0];var c=k.clone(b),e=k.isNegative(c);e&&
(c[0]=c[0].negate());for(var d=k.clone(k.ONE),g=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],l=1,n=[0],m=n.length-1;!k.equals(c,d)&&a--;)k.isLessThan(c,d)?(-1===l?n[m]++:(l=-1,n.push(1),m++),g[0]=g[0].add(g[1]),g[2]=g[2].add(g[3])):(1===l?n[m]++:(l=1,n.push(1),m++),g[1]=g[1].add(g[0]),g[3]=g[3].add(g[2])),d[0]=g[0].add(g[1]),d[1]=g[2].add(g[3]);0>a?n.push(0):n[m]++;if(e)for(var h in n)n[h]=-n[h];return n};k.fromContinuedFraction=function(b,a){k.fromInteger_copy(b,a[a.length-1]);for(var c=
a.length-2;-1<c;c--)k.invert(b,b),k.add(b,k.fromInteger(a[c]),b);return b};k.fromFactorial=function(b,a){if("undefined"!==typeof factorial.PREPARED[a])return k.fromInteger_copy(b,factorial.PREPARED[a]);var c=factorial.PREPARED.length-1;for(k.fromInteger_copy(b,factorial.PREPARED[c]);c<a;)k.scalar_multiply(b,b,++c);return b};k.dump=function(b){return"bigrat\t"+k.str(b)+"\n~\t"+k.toDecimal(b)+"\nCF:\t["+k.toContinuedFraction(b)+"]\n"};k.ZERO=k.fromInteger(0);k.ONE=k.fromInteger(1);k.NEGONE=k.fromInteger(-1);
k.INFINITY=k.fromValues(1,0);k.INFINULL=k.fromValues(0,0);k.INFINITESIMAL=k.clone([new BigInteger(1),h]);k.PI=k.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof b&&(b.bigrat=k);var r=function(b,a){this.a=c.fromValues(parseInt(b),parseInt(a))};r.prototype.toString=function(){return c.str(this.a)};r.prototype.toContinuedFraction=function(b){return c.toContinuedFraction(this.a,b)};r.prototype.invert=function(){return c.invert(this.a)};r.prototype.reciprocal=r.prototype.invert;r.prototype.add=function(b){var a=c.create();c.add(a,this.a,b.a);return new r(a[0],a[1])};r.prototype.plus=r.prototype.add;r.prototype.subtract=function(b){var a=c.create();
c.sub(a,this.a,b.a);return new r(a[0],a[1])};r.prototype.sub=r.prototype.subtract;r.prototype.minus=r.prototype.subtract;r.prototype.multiply=function(b){var a=c.create();c.mul(a,this.a,b.a);return new r(a[0],a[1])};r.prototype.mul=r.prototype.multiply;r.prototype.times=r.prototype.multiply;r.prototype.mediant=function(b){var a=c.create();c.mediant(a,this.a,b.a);return new r(a[0],a[1])};r.prototype.divide=function(b){var a=c.create();c.div(a,this.a,b.a);return new r(a[0],a[1])};r.prototype.div=r.prototype.divide;
r.prototype.divided_by=r.prototype.divide;r.prototype.power=function(b){var a=c.create();c.pow(a,this.a,b);return new r(a[0],a[1])};r.prototype.pow=r.prototype.power;r.prototype.dump=function(){return c.dump(this.a)};r.prototype.toRat=function(){return c.clone(this.a)};r.prototype.toDecimal=function(){return c.toDecimal(this.a)};r.fromRat=function(b){var a=new r;a.a[0]=b[0];a.a[1]=b[1];return a};r.fromInteger=function(b){return r.fromRat(c.fromInteger(b))};r.fromIntegerInverse=function(b){return r.fromRat(c.fromIntegerInverse(b))};
r.fromDecimal=function(b){return r.fromRat(c.fromDecimal(b))};r.fromContinuedFraction=function(b){return r.fromRat(c.fromContinuedFraction(c.create(),b))};"undefined"!==typeof b&&(b.rational=r);var n={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<n.GREEK.length?n.GREEK[this.i++]:"?"}}};"undefined"!==typeof b&&(b.alpha=n);m={};m.FINE_STRUCTURE=k.fromValues(30223,4141639);
m.a=m.FINE_STRUCTURE;m.FINE_STRUCTURE_ALT=k.fromValues(13355891,1830237867);m.PLANK=k.fromValues(662606957,1E42);m.h=m.PLANK;m.hBAR=k.fromValues(1054571726,1E43);m.GRAVITATIONAL=k.fromValues(667384,1E16);m.G=m.GRAVITATIONAL;m.SPEED_OF_LIGHT=k.fromInteger(299792458);m.c=m.SPEED_OF_LIGHT;"undefined"!==typeof b&&(b.physics=m);var u={create:function(){return[[],[]]},fromValues:function(b){var a=u.create();a[0]=b.slice();b=u.countDimensions(a);for(a[1]=Array(b);b--;)a[1][b]=0;return u.normalize(a,a)},
mergeDimension:function(b,a,c){b[0]=[a.slice()];b[1].push(0);for(var e in c)b[0].push(c[e]);return b},evaluate:function(b,a,c){k.copy(b,k.ZERO);var e=u.countDimensions(a);if(0===e)return"0";if(1===e)for(var d in a[0]){if(a[0][d]){var e=k.fromInteger(a[0][d]),g=k.pow(k.create(),k.fromInteger(c[0]),a[1][0]+ +d);k.mul(e,e,g);k.add(b,b,e)}}else if(2===e)for(var l in a[0])for(d in a[0][l]){if(a[0][l][d]){var e=k.fromInteger(a[0][l][d]),g=k.pow(k.create(),k.fromInteger(c[0]),a[1][1]+ +d),n=k.pow(k.create(),
k.fromInteger(c[1]),a[1][0]+ +l);k.mul(e,e,g);k.mul(e,e,n);k.add(b,b,e)}}else if(3===e)for(var m in a[0])for(l in a[0][m])for(d in a[0][m][l]){if(a[0][m][l][d]){var e=k.fromInteger(a[0][m][l][d]),g=k.pow(k.create(),k.fromInteger(c[0]),a[1][2]+ +d),n=k.pow(k.create(),k.fromInteger(c[1]),a[1][1]+ +l),h=k.pow(k.create(),k.fromInteger(c[1]),a[1][0]+ +m);k.mul(e,e,g);k.mul(e,e,n);k.mul(e,e,h);k.add(b,b,e)}}else alert("unsupported dimension "+e);return b},derivatives:function(b){return[]},forEachNonZeroElement:function(b,
a){for(var c=b.slice(),e=0;"object"===typeof c[0];)c=c[0].slice(),e++;for(var d=e+1;0<d;--d){print(Array(d).join("[0]"));var c=eval("(a"+Array(d).join("[0]")+")"),g;for(g in c)for(var l=e+2;0<l;--l)print(c[g])}return""},str:function(b){var a="",c=new n.iterator,e=c.next(),d=c.next(),c=c.next(),g=u.countDimensions(b);if(0===g)a+=b.toString();else if(1===g)for(var l in b[0]){if(b[0][l]){a?a+=" "+(0>b[0][l]?"-":"+")+" ":0>b[0][l]&&(a+="-");var g=Math.abs(b[0][l]),k=b[1][0]+ +l;if(1!==g||0===k)a+=g;0!==
k&&(a+=e+(1===k?"":"<sup>"+k+"</sup>"))}}else if(2===g)for(var m in b[0])for(l in b[0][m]){if(b[0][m][l]){a?a+=" "+(0>b[0][m][l]?"-":"+")+" ":0>b[0][m][l]&&(a+="-");var g=Math.abs(b[0][m][l]),k=b[1][1]+ +l,h=b[1][0]+ +m;if(1!==g||0===h&&0===k)a+=g;0!==k&&(a+=e+(1===k?"":"<sup>"+k+"</sup>"));0!==h&&(a+=d+(1===h?"":"<sup>"+h+"</sup>"))}}else if(3===g)for(var t in b[0])for(m in b[0][t])for(l in b[0][t][m]){if(b[0][t][m][l]){a?a+=" "+(0>b[0][t][m][l]?"-":"+")+" ":0>b[0][t][m][l]&&(a+="-");var g=Math.abs(b[0][t][m][l]),
k=b[1][2]+ +l,h=b[1][1]+ +m,q=b[1][0]+ +t;if(1!==g||0===q&&0===h&&0===k)a+=g;0!==k&&(a+=e+(1===k?"":"<sup>"+k+"</sup>"));0!==h&&(a+=d+(1===h?"":"<sup>"+h+"</sup>"));0!==q&&(a+=c+(1===q?"":"<sup>"+q+"</sup>"))}}else alert("unsupported dimension "+g);""===a&&(a="0");return a},getJSFormula:function(b){var a="",c=u.countDimensions(b);if(0===c)return"0";if(1===c)for(var e in b[0])b[0][e]&&(a&&(a+="+"),a+=b[0][e],c=b[1][0]+ +e,0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var d in b[0])for(e in b[0][d]){if(b[0][d][e]){a&&
(a+="+");var a=a+b[0][d][e],c=b[1][1]+ +e,g=b[1][0]+ +d;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==g&&(a=1===g?a+"*m[1]":a+("*Math.pow(m[1],"+g+")"))}}else if(3===c)for(var l in b[0])for(d in b[0][l])for(e in b[0][l][d]){if(b[0][l][d][e]){a&&(a+="+");var a=a+b[0][l][d][e],c=b[1][2]+ +e,g=b[1][1]+ +d,k=b[1][0]+ +l;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==g&&(a=1===g?a+"*m[1]":a+("*Math.pow(m[1],"+g+")"));0!==k&&(a=1===k?a+"*m[2]":a+("*Math.pow(m[2],"+k+")"))}}else alert("unsupported dimension "+
c);""===a&&(a="0");return a}};String.prototype.repeat=function(b){return Array(b+1).join(this)};u.getGLSLFormula=function(b){var a="",c=u.countDimensions(b);if(0===c)return"0.0";if(1===c)for(var e in b[0])b[0][e]&&(a&&(a+="+"),a+=b[0][e]+".0",c=b[1][0]+ +e,0!==c&&(a=1===c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var d in b[0])for(e in b[0][d]){if(b[0][d][e]){a&&(a+="+");var a=a+(b[0][d][e]+".0"),c=b[1][1]+ +e,g=b[1][0]+ +d;0!==c&&(a=1===
c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==g&&(a=1===g?a+"*m_1":1<g?a+"*m_1".repeat(g):a+("*pow(1.0"+"*m_1".repeat(Math.abs(g))+",-1.0)"))}}else alert("unsupported dimension "+c);""===a&&(a="0.0");return a};u.toJSON=function(b){return JSON.stringify(b)};u.fromJSON=function(b){return JSON.parse(b)};u.normalize=function(b,a){return a};u.binary_operation=function(b,a,c,e){b=u.create();var d=u.countDimensions(a),g=u.countDimensions(c);a[1][l]!==c[1][l]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===d&&1===g){for(var l in a[0])b[0][l]="undefined"===typeof c[0][l]?a[0][l]:e(a[0][l],c[0][l]);for(l in c[0])"undefined"===typeof a[0][l]&&(b[0][l]=c[0][l]);for(l in b[0])"undefined"===typeof a[0][l]&&"undefined"===typeof c[0][l]&&(b[0][l]=null)}else alert("unsupported dimension "+d);for(l=d;l--;)b[1][l]=a[1][l];return b};u.add=function(b,a,c){return u.binary_operation(b,a,c,function(b,a){return b+a})};u.subtract=function(b,
a,c){return u.binary_operation(b,a,c,function(b,a){return b-a})};u.sub=u.subtract;u.multiply=function(b,a,c){return b};u.mul=u.multiply;u.divide=function(b,a,c){return b};u.div=u.divide;u.equals=function(b,a){return b[0]===a[0]&&b[1]===a[1]};u.countDimensions=function(b){return"object"===typeof b[0]?u._countDimensions(b[0],1):0};u._countDimensions=function(b,a){return"object"===typeof b[0]?u._countDimensions(b[0],++a):a};u.ZERO=u.fromValues([0]);u.IDENTITY=u.fromValues([1]);u.ONE=u.IDENTITY;"undefined"!==
typeof b&&(b.polyrat=u)})(h)})(this);(function(b){"function"===typeof define&&define.amd?define(["jquery"],function(h){return b(h,window,document)}):"object"===typeof exports?module.exports=function(h,d){h||(h=window);d||(d="undefined"!==typeof window?require("jquery"):require("jquery")(h));return b(d,h,h.document)}:b(jQuery,window,document)})(function(b,h,d,e){function a(c){var e,d,p={};b.each(c,function(b){(e=b.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(e[1]+" ")&&(d=b.replace(e[0],e[2].toLowerCase()),
p[d]=b,"o"===e[1]&&a(c[b]))});c._hungarianMap=p}function g(c,d,p){c._hungarianMap||a(c);var f;b.each(d,function(a){f=c._hungarianMap[a];f===e||!p&&d[f]!==e||("o"===f.charAt(0)?(d[f]||(d[f]={}),b.extend(!0,d[f],d[a]),g(c[f],d[f],p)):d[f]=d[a])})}function m(b){var a=C.defaults.oLanguage,c=b.sZeroRecords;!b.sEmptyTable&&c&&"No data available in table"===a.sEmptyTable&&ia(b,b,"sZeroRecords","sEmptyTable");!b.sLoadingRecords&&c&&"Loading..."===a.sLoadingRecords&&ia(b,b,"sZeroRecords","sLoadingRecords");
b.sInfoThousands&&(b.sThousands=b.sInfoThousands);(b=b.sDecimal)&&gb(b)}function l(b){ea(b,"ordering","bSort");ea(b,"orderMulti","bSortMulti");ea(b,"orderClasses","bSortClasses");ea(b,"orderCellsTop","bSortCellsTop");ea(b,"order","aaSorting");ea(b,"orderFixed","aaSortingFixed");ea(b,"paging","bPaginate");ea(b,"pagingType","sPaginationType");ea(b,"pageLength","iDisplayLength");ea(b,"searching","bFilter");"boolean"===typeof b.sScrollX&&(b.sScrollX=b.sScrollX?"100%":"");"boolean"===typeof b.scrollX&&
(b.scrollX=b.scrollX?"100%":"");if(b=b.aoSearchCols)for(var a=0,c=b.length;a<c;a++)b[a]&&g(C.models.oSearch,b[a])}function c(a){ea(a,"orderable","bSortable");ea(a,"orderData","aDataSort");ea(a,"orderSequence","asSorting");ea(a,"orderDataType","sortDataType");var c=a.aDataSort;c&&!b.isArray(c)&&(a.aDataSort=[c])}function t(a){if(!C.__browser){var c={};C.__browser=c;var e=b("<div/>").css({position:"fixed",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(b("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(b("<div/>").css({width:"100%",height:10}))).appendTo("body"),d=e.children(),f=d.children();c.barWidth=d[0].offsetWidth-d[0].clientWidth;c.bScrollOversize=100===f[0].offsetWidth&&100!==d[0].clientWidth;c.bScrollbarLeft=1!==Math.round(f.offset().left);c.bBounding=e[0].getBoundingClientRect().width?!0:!1;e.remove()}b.extend(a.oBrowser,C.__browser);a.oScroll.iBarWidth=C.__browser.barWidth}function q(b,a,c,d,f,p){var g,l=!1;for(c!==e&&(g=c,l=!0);d!==f;)b.hasOwnProperty(d)&&
(g=l?a(g,b[d],d,b):b[d],l=!0,d+=p);return g}function k(a,c){var e=C.defaults.column,f=a.aoColumns.length,e=b.extend({},C.models.oColumn,e,{nTh:c?c:d.createElement("th"),sTitle:e.sTitle?e.sTitle:c?c.innerHTML:"",aDataSort:e.aDataSort?e.aDataSort:[f],mData:e.mData?e.mData:f,idx:f});a.aoColumns.push(e);e=a.aoPreSearchCols;e[f]=b.extend({},C.models.oSearch,e[f]);r(a,f,b(c).data())}function r(a,d,f){d=a.aoColumns[d];var p=a.oClasses,l=b(d.nTh);if(!d.sWidthOrig){d.sWidthOrig=l.attr("width")||null;var k=
(l.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);k&&(d.sWidthOrig=k[1])}f!==e&&null!==f&&(c(f),g(C.defaults.column,f),f.mDataProp!==e&&!f.mData&&(f.mData=f.mDataProp),f.sType&&(d._sManualType=f.sType),f.className&&!f.sClass&&(f.sClass=f.className),b.extend(d,f),ia(d,f,"sWidth","sWidthOrig"),f.iDataSort!==e&&(d.aDataSort=[f.iDataSort]),ia(d,f,"aDataSort"));var m=d.mData,n=G(m),v=d.mRender?G(d.mRender):null;f=function(b){return"string"===typeof b&&-1!==b.indexOf("@")};d._bAttrSrc=b.isPlainObject(m)&&
(f(m.sort)||f(m.type)||f(m.filter));d.fnGetData=function(b,a,c){var d=n(b,a,e,c);return v&&a?v(d,a,b,c):d};d.fnSetData=function(b,a,c){return B(m)(b,a,c)};"number"!==typeof m&&(a._rowReadObject=!0);a.oFeatures.bSort||(d.bSortable=!1,l.addClass(p.sSortableNone));a=-1!==b.inArray("asc",d.asSorting);f=-1!==b.inArray("desc",d.asSorting);d.bSortable&&(a||f)?a&&!f?(d.sSortingClass=p.sSortableAsc,d.sSortingClassJUI=p.sSortJUIAscAllowed):!a&&f?(d.sSortingClass=p.sSortableDesc,d.sSortingClassJUI=p.sSortJUIDescAllowed):
(d.sSortingClass=p.sSortable,d.sSortingClassJUI=p.sSortJUI):(d.sSortingClass=p.sSortableNone,d.sSortingClassJUI="")}function n(b){if(!1!==b.oFeatures.bAutoWidth){var a=b.aoColumns;Ra(b);for(var c=0,e=a.length;c<e;c++)a[c].nTh.style.width=a[c].sWidth}a=b.oScroll;""===a.sY&&""===a.sX||va(b);V(b,null,"column-sizing",[b])}function u(b,a){var c=A(b,"bVisible");return"number"===typeof c[a]?c[a]:null}function f(a,c){var e=A(a,"bVisible"),e=b.inArray(c,e);return-1!==e?e:null}function x(b){return A(b,"bVisible").length}
function A(a,c){var e=[];b.map(a.aoColumns,function(b,a){b[c]&&e.push(a)});return e}function F(b){var a=b.aoColumns,c=b.aoData,d=C.ext.type.detect,f,p,g,l,k,m,n,v,h;f=0;for(p=a.length;f<p;f++)if(n=a[f],h=[],!n.sType&&n._sManualType)n.sType=n._sManualType;else if(!n.sType){g=0;for(l=d.length;g<l;g++){k=0;for(m=c.length;k<m;k++){h[k]===e&&(h[k]=w(b,k,f,"type"));v=d[g](h[k],b);if(!v&&g!==d.length-1)break;if("html"===v)break}if(v){n.sType=v;break}}n.sType||(n.sType="string")}}function L(a,c,d,f){var p,
g,l,n,m,v,h=a.aoColumns;if(c)for(p=c.length-1;0<=p;p--){v=c[p];var y=v.targets!==e?v.targets:v.aTargets;b.isArray(y)||(y=[y]);g=0;for(l=y.length;g<l;g++)if("number"===typeof y[g]&&0<=y[g]){for(;h.length<=y[g];)k(a);f(y[g],v)}else if("number"===typeof y[g]&&0>y[g])f(h.length+y[g],v);else if("string"===typeof y[g])for(n=0,m=h.length;n<m;n++)("_all"==y[g]||b(h[n].nTh).hasClass(y[g]))&&f(n,v)}if(d)for(p=0,a=d.length;p<a;p++)f(p,d[p])}function z(a,c,d,f){var p=a.aoData.length,g=b.extend(!0,{},C.models.oRow,
{src:d?"dom":"data",idx:p});g._aData=c;a.aoData.push(g);for(var l=a.aoColumns,k=0,n=l.length;k<n;k++)l[k].sType=null;a.aiDisplayMaster.push(p);c=a.rowIdFn(c);c!==e&&(a.aIds[c]=g);!d&&a.oFeatures.bDeferRender||D(a,p,d,f);return p}function H(a,c){var e;c instanceof b||(c=b(c));return c.map(function(b,c){e=J(a,c);return z(a,e.data,c,e.cells)})}function w(b,a,c,d){var f=b.iDraw,p=b.aoColumns[c],g=b.aoData[a]._aData,l=p.sDefaultContent,k=p.fnGetData(g,d,{settings:b,row:a,col:c});if(k===e)return b.iDrawError!=
f&&null===l&&(ma(b,0,"Requested unknown parameter "+("function"==typeof p.mData?"{function}":"'"+p.mData+"'")+" for row "+a+", column "+c,4),b.iDrawError=f),l;if((k===g||null===k)&&null!==l)k=l;else if("function"===typeof k)return k.call(g);return null===k&&"display"==d?"":k}function I(b,a,c,e){b.aoColumns[c].fnSetData(b.aoData[a]._aData,e,{settings:b,row:a,col:c})}function P(a){return b.map(a.match(/(\\.|[^\.])+/g)||[""],function(b){return b.replace(/\\./g,".")})}function G(a){if(b.isPlainObject(a)){var c=
{};b.each(a,function(b,a){a&&(c[b]=G(a))});return function(b,a,d,f){var p=c[a]||c._;return p!==e?p(b,a,d,f):b}}if(null===a)return function(b){return b};if("function"===typeof a)return function(b,c,e,d){return a(b,c,e,d)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var d=function(a,c,f){var p,X;if(""!==f){X=P(f);for(var g=0,l=X.length;g<l;g++){f=X[g].match(wa);p=X[g].match(qa);if(f){X[g]=X[g].replace(wa,"");""!==X[g]&&(a=a[X[g]]);p=[];X.splice(0,g+1);X=
X.join(".");if(b.isArray(a))for(g=0,l=a.length;g<l;g++)p.push(d(a[g],c,X));a=f[0].substring(1,f[0].length-1);a=""===a?p:p.join(a);break}else if(p){X[g]=X[g].replace(qa,"");a=a[X[g]]();continue}if(null===a||a[X[g]]===e)return e;a=a[X[g]]}}return a};return function(b,c){return d(b,c,a)}}return function(b){return b[a]}}function B(a){if(b.isPlainObject(a))return B(a._);if(null===a)return function(){};if("function"===typeof a)return function(b,c,e){a(b,"set",c,e)};if("string"===typeof a&&(-1!==a.indexOf(".")||
-1!==a.indexOf("[")||-1!==a.indexOf("("))){var c=function(a,d,f){f=P(f);var p;p=f[f.length-1];for(var g,X,l=0,k=f.length-1;l<k;l++){g=f[l].match(wa);X=f[l].match(qa);if(g){f[l]=f[l].replace(wa,"");a[f[l]]=[];p=f.slice();p.splice(0,l+1);g=p.join(".");if(b.isArray(d))for(X=0,k=d.length;X<k;X++)p={},c(p,d[X],g),a[f[l]].push(p);else a[f[l]]=d;return}X&&(f[l]=f[l].replace(qa,""),a=a[f[l]](d));if(null===a[f[l]]||a[f[l]]===e)a[f[l]]={};a=a[f[l]]}if(p.match(qa))a[p.replace(qa,"")](d);else a[p.replace(wa,
"")]=d};return function(b,e){return c(b,e,a)}}return function(b,c){b[a]=c}}function M(b){return ha(b.aoData,"_aData")}function N(b){b.aoData.length=0;b.aiDisplayMaster.length=0;b.aiDisplay.length=0;b.aIds={}}function Q(b,a,c){for(var f=-1,d=0,p=b.length;d<p;d++)b[d]==a?f=d:b[d]>a&&b[d]--; -1!=f&&c===e&&b.splice(f,1)}function O(b,a,c,f){var d=b.aoData[a],g,l=function(c,e){for(;c.childNodes.length;)c.removeChild(c.firstChild);c.innerHTML=w(b,a,e,"display")};if("dom"!==c&&(c&&"auto"!==c||"dom"!==d.src)){var k=
d.anCells;if(k)if(f!==e)l(k[f],f);else for(c=0,g=k.length;c<g;c++)l(k[c],c)}else d._aData=J(b,d,f,f===e?e:d._aData).data;d._aSortData=null;d._aFilterData=null;l=b.aoColumns;if(f!==e)l[f].sType=null;else{c=0;for(g=l.length;c<g;c++)l[c].sType=null;p(b,d)}}function J(a,c,d,f){var p=[],g=c.firstChild,l,k,n=0,m,v=a.aoColumns,h=a._rowReadObject;f=f!==e?f:h?{}:[];var y=function(b,a){if("string"===typeof b){var c=b.indexOf("@");-1!==c&&(c=b.substring(c+1),B(b)(f,a.getAttribute(c)))}},E=function(a){if(d===
e||d===n)k=v[n],m=b.trim(a.innerHTML),k&&k._bAttrSrc?(B(k.mData._)(f,m),y(k.mData.sort,a),y(k.mData.type,a),y(k.mData.filter,a)):h?(k._setter||(k._setter=B(k.mData)),k._setter(f,m)):f[n]=m;n++};if(g)for(;g;){l=g.nodeName.toUpperCase();if("TD"==l||"TH"==l)E(g),p.push(g);g=g.nextSibling}else for(p=c.anCells,g=0,l=p.length;g<l;g++)E(p[g]);(c=c.firstChild?c:c.nTr)&&(c=c.getAttribute("id"))&&B(a.rowId)(f,c);return{data:f,cells:p}}function D(b,a,c,e){var f=b.aoData[a],g=f._aData,l=[],k,n,m,v,h;if(null===
f.nTr){k=c||d.createElement("tr");f.nTr=k;f.anCells=l;k._DT_RowIndex=a;p(b,f);v=0;for(h=b.aoColumns.length;v<h;v++){m=b.aoColumns[v];n=c?e[v]:d.createElement(m.sCellType);n._DT_CellIndex={row:a,column:v};l.push(n);if(!c||m.mRender||m.mData!==v)n.innerHTML=w(b,a,v,"display");m.sClass&&(n.className+=" "+m.sClass);m.bVisible&&!c?k.appendChild(n):!m.bVisible&&c&&n.parentNode.removeChild(n);m.fnCreatedCell&&m.fnCreatedCell.call(b.oInstance,n,w(b,a,v),g,a,v)}V(b,"aoRowCreatedCallback",null,[k,g,a])}f.nTr.setAttribute("role",
"row")}function p(a,c){var e=c.nTr,f=c._aData;if(e){var d=a.rowIdFn(f);d&&(e.id=d);f.DT_RowClass&&(d=f.DT_RowClass.split(" "),c.__rowc=c.__rowc?Aa(c.__rowc.concat(d)):d,b(e).removeClass(c.__rowc.join(" ")).addClass(f.DT_RowClass));f.DT_RowAttr&&b(e).attr(f.DT_RowAttr);f.DT_RowData&&b(e).data(f.DT_RowData)}}function v(a){var c,e,f,d,p,g=a.nTHead,l=a.nTFoot,k=0===b("th, td",g).length,n=a.oClasses,m=a.aoColumns;k&&(d=b("<tr/>").appendTo(g));c=0;for(e=m.length;c<e;c++)p=m[c],f=b(p.nTh).addClass(p.sClass),
k&&f.appendTo(d),a.oFeatures.bSort&&(f.addClass(p.sSortingClass),!1!==p.bSortable&&(f.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Sa(a,p.nTh,c))),p.sTitle!=f[0].innerHTML&&f.html(p.sTitle),Ta(a,"header")(a,f,p,n);k&&U(a.aoHeader,g);b(g).find(">tr").attr("role","row");b(g).find(">tr>th, >tr>td").addClass(n.sHeaderTH);b(l).find(">tr>th, >tr>td").addClass(n.sFooterTH);if(null!==l)for(a=a.aoFooter[0],c=0,e=a.length;c<e;c++)p=m[c],p.nTf=a[c].cell,p.sClass&&b(p.nTf).addClass(p.sClass)}
function y(a,c,f){var d,p,g,l=[],k=[],n=a.aoColumns.length,m;if(c){f===e&&(f=!1);d=0;for(p=c.length;d<p;d++){l[d]=c[d].slice();l[d].nTr=c[d].nTr;for(g=n-1;0<=g;g--)a.aoColumns[g].bVisible||f||l[d].splice(g,1);k.push([])}d=0;for(p=l.length;d<p;d++){if(a=l[d].nTr)for(;g=a.firstChild;)a.removeChild(g);g=0;for(c=l[d].length;g<c;g++)if(m=n=1,k[d][g]===e){a.appendChild(l[d][g].cell);for(k[d][g]=1;l[d+n]!==e&&l[d][g].cell==l[d+n][g].cell;)k[d+n][g]=1,n++;for(;l[d][g+m]!==e&&l[d][g].cell==l[d][g+m].cell;){for(f=
0;f<n;f++)k[d+f][g+m]=1;m++}b(l[d][g].cell).attr("rowspan",n).attr("colspan",m)}}}}function E(a){var c=V(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==b.inArray(!1,c))fa(a,!1);else{var c=[],f=0,d=a.asStripeClasses,p=d.length,g=a.oLanguage,l=a.iInitDisplayStart,k="ssp"==ba(a),n=a.aiDisplay;a.bDrawing=!0;l!==e&&-1!==l&&(a._iDisplayStart=k?l:l>=a.fnRecordsDisplay()?0:l,a.iInitDisplayStart=-1);var l=a._iDisplayStart,m=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,fa(a,!1);else if(k){if(!a.bDestroying&&
!na(a))return}else a.iDraw++;if(0!==n.length)for(g=k?a.aoData.length:m,k=k?0:l;k<g;k++){var v=n[k],h=a.aoData[v];null===h.nTr&&D(a,v);v=h.nTr;if(0!==p){var y=d[f%p];h._sRowStripe!=y&&(b(v).removeClass(h._sRowStripe).addClass(y),h._sRowStripe=y)}V(a,"aoRowCallback",null,[v,h._aData,f,k]);c.push(v);f++}else f=g.sZeroRecords,1==a.iDraw&&"ajax"==ba(a)?f=g.sLoadingRecords:g.sEmptyTable&&0===a.fnRecordsTotal()&&(f=g.sEmptyTable),c[0]=b("<tr/>",{"class":p?d[0]:""}).append(b("<td />",{valign:"top",colSpan:x(a),
"class":a.oClasses.sRowEmpty}).html(f))[0];V(a,"aoHeaderCallback","header",[b(a.nTHead).children("tr")[0],M(a),l,m,n]);V(a,"aoFooterCallback","footer",[b(a.nTFoot).children("tr")[0],M(a),l,m,n]);d=b(a.nTBody);d.children().detach();d.append(b(c));V(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function R(b,a){var c=b.oFeatures,e=c.bFilter;c.bSort&&hb(b);e?pa(b,b.oPreviousSearch):b.aiDisplay=b.aiDisplayMaster.slice();!0!==a&&(b._iDisplayStart=0);b._drawHold=a;E(b);b._drawHold=
!1}function T(a){var c=a.oClasses,e=b(a.nTable),e=b("<div/>").insertBefore(e),f=a.oFeatures,d=b("<div/>",{id:a.sTableId+"_wrapper","class":c.sWrapper+(a.nTFoot?"":" "+c.sNoFooter)});a.nHolding=e[0];a.nTableWrapper=d[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var p=a.sDom.split(""),g,l,k,n,m,v,h=0;h<p.length;h++){g=null;l=p[h];if("<"==l){k=b("<div/>")[0];n=p[h+1];if("'"==n||'"'==n){m="";for(v=2;p[h+v]!=n;)m+=p[h+v],v++;"H"==m?m=c.sJUIHeader:"F"==m&&(m=c.sJUIFooter);-1!=m.indexOf(".")?(n=m.split("."),
k.id=n[0].substr(1,n[0].length-1),k.className=n[1]):"#"==m.charAt(0)?k.id=m.substr(1,m.length-1):k.className=m;h+=v}d.append(k);d=b(k)}else if(">"==l)d=d.parent();else if("l"==l&&f.bPaginate&&f.bLengthChange)g=ib(a);else if("f"==l&&f.bFilter)g=Ba(a);else if("r"==l&&f.bProcessing)g=jb(a);else if("t"==l)g=kb(a);else if("i"==l&&f.bInfo)g=lb(a);else if("p"==l&&f.bPaginate)g=mb(a);else if(0!==C.ext.feature.length)for(k=C.ext.feature,v=0,n=k.length;v<n;v++)if(l==k[v].cFeature){g=k[v].fnInit(a);break}g&&
(k=a.aanFeatures,k[l]||(k[l]=[]),k[l].push(g),d.append(g))}e.replaceWith(d);a.nHolding=null}function U(a,c){var e=b(c).children("tr"),f,d,p,g,l,k,n,m,v,h;a.splice(0,a.length);p=0;for(k=e.length;p<k;p++)a.push([]);p=0;for(k=e.length;p<k;p++)for(f=e[p],d=f.firstChild;d;){if("TD"==d.nodeName.toUpperCase()||"TH"==d.nodeName.toUpperCase()){m=1*d.getAttribute("colspan");v=1*d.getAttribute("rowspan");m=m&&0!==m&&1!==m?m:1;v=v&&0!==v&&1!==v?v:1;g=0;for(l=a[p];l[g];)g++;n=g;h=1===m?!0:!1;for(l=0;l<m;l++)for(g=
0;g<v;g++)a[p+g][n+l]={cell:d,unique:h},a[p+g].nTr=f}d=d.nextSibling}}function ca(b,a,c){var e=[];c||(c=b.aoHeader,a&&(c=[],U(c,a)));a=0;for(var d=c.length;a<d;a++)for(var f=0,p=c[a].length;f<p;f++)!c[a][f].unique||e[f]&&b.bSortCellsTop||(e[f]=c[a][f].cell);return e}function ka(a,c,e){V(a,"aoServerParams","serverParams",[c]);if(c&&b.isArray(c)){var f={},d=/(.*?)\[\]$/;b.each(c,function(b,a){var c=a.name.match(d);c?(c=c[0],f[c]||(f[c]=[]),f[c].push(a.value)):f[a.name]=a.value});c=f}var p,g=a.ajax,
l=a.oInstance,k=function(b){V(a,null,"xhr",[a,b,a.jqXHR]);e(b)};if(b.isPlainObject(g)&&g.data){p=g.data;var m=b.isFunction(p)?p(c,a):p;c=b.isFunction(p)&&m?m:b.extend(!0,c,m);delete g.data}m={data:c,success:function(b){var c=b.error||b.sError;c&&ma(a,0,c);a.json=b;k(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(c,f){var e=V(a,null,"xhr",[a,null,a.jqXHR]);-1===b.inArray(!0,e)&&("parsererror"==f?ma(a,0,"Invalid JSON response",1):4===c.readyState&&ma(a,0,"Ajax error",7));fa(a,!1)}};
a.oAjaxData=c;V(a,null,"preXhr",[a,c]);a.fnServerData?a.fnServerData.call(l,a.sAjaxSource,b.map(c,function(b,a){return{name:a,value:b}}),k,a):a.sAjaxSource||"string"===typeof g?a.jqXHR=b.ajax(b.extend(m,{url:g||a.sAjaxSource})):b.isFunction(g)?a.jqXHR=g.call(l,c,k,a):(a.jqXHR=b.ajax(b.extend(m,g)),g.data=p)}function na(b){return b.bAjaxDataGet?(b.iDraw++,fa(b,!0),ka(b,ra(b),function(a){Ca(b,a)}),!1):!0}function ra(a){var c=a.aoColumns,f=c.length,e=a.oFeatures,d=a.oPreviousSearch,p=a.aoPreSearchCols,
g,l=[],k,m,n,v=sa(a);g=a._iDisplayStart;k=!1!==e.bPaginate?a._iDisplayLength:-1;var h=function(b,a){l.push({name:b,value:a})};h("sEcho",a.iDraw);h("iColumns",f);h("sColumns",ha(c,"sName").join(","));h("iDisplayStart",g);h("iDisplayLength",k);var y={draw:a.iDraw,columns:[],order:[],start:g,length:k,search:{value:d.sSearch,regex:d.bRegex}};for(g=0;g<f;g++)m=c[g],n=p[g],k="function"==typeof m.mData?"function":m.mData,y.columns.push({data:k,name:m.sName,searchable:m.bSearchable,orderable:m.bSortable,
search:{value:n.sSearch,regex:n.bRegex}}),h("mDataProp_"+g,k),e.bFilter&&(h("sSearch_"+g,n.sSearch),h("bRegex_"+g,n.bRegex),h("bSearchable_"+g,m.bSearchable)),e.bSort&&h("bSortable_"+g,m.bSortable);e.bFilter&&(h("sSearch",d.sSearch),h("bRegex",d.bRegex));e.bSort&&(b.each(v,function(b,a){y.order.push({column:a.col,dir:a.dir});h("iSortCol_"+b,a.col);h("sSortDir_"+b,a.dir)}),h("iSortingCols",v.length));c=C.ext.legacy.ajax;return null===c?a.sAjaxSource?l:y:c?l:y}function Ca(b,a){var c=ta(b,a),f=a.sEcho!==
e?a.sEcho:a.draw,d=a.iTotalRecords!==e?a.iTotalRecords:a.recordsTotal,p=a.iTotalDisplayRecords!==e?a.iTotalDisplayRecords:a.recordsFiltered;if(f){if(1*f<b.iDraw)return;b.iDraw=1*f}N(b);b._iRecordsTotal=parseInt(d,10);b._iRecordsDisplay=parseInt(p,10);f=0;for(d=c.length;f<d;f++)z(b,c[f]);b.aiDisplay=b.aiDisplayMaster.slice();b.bAjaxDataGet=!1;E(b);b._bInitComplete||Da(b,a);b.bAjaxDataGet=!0;fa(b,!1)}function ta(a,c){var f=b.isPlainObject(a.ajax)&&a.ajax.dataSrc!==e?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===
f?c.aaData||c[f]:""!==f?G(f)(c):c}function Ba(a){var c=a.oClasses,f=a.sTableId,e=a.oLanguage,p=a.oPreviousSearch,g=a.aanFeatures,l='<input type="search" class="'+c.sFilterInput+'"/>',k=e.sSearch,k=k.match(/_INPUT_/)?k.replace("_INPUT_",l):k+l,c=b("<div/>",{id:g.f?null:f+"_filter","class":c.sFilter}).append(b("<label/>").append(k)),g=function(){var b=this.value?this.value:"";b!=p.sSearch&&(pa(a,{sSearch:b,bRegex:p.bRegex,bSmart:p.bSmart,bCaseInsensitive:p.bCaseInsensitive}),a._iDisplayStart=0,E(a))},
l=null!==a.searchDelay?a.searchDelay:"ssp"===ba(a)?400:0,m=b("input",c).val(p.sSearch).attr("placeholder",e.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",l?Ea(g,l):g).bind("keypress.DT",function(b){if(13==b.keyCode)return!1}).attr("aria-controls",f);b(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{m[0]!==d.activeElement&&m.val(p.sSearch)}catch(f){}});return c[0]}function pa(b,a,c){var f=b.oPreviousSearch,d=b.aoPreSearchCols,p=function(b){f.sSearch=b.sSearch;f.bRegex=
b.bRegex;f.bSmart=b.bSmart;f.bCaseInsensitive=b.bCaseInsensitive};F(b);if("ssp"!=ba(b)){nb(b,a.sSearch,c,a.bEscapeRegex!==e?!a.bEscapeRegex:a.bRegex,a.bSmart,a.bCaseInsensitive);p(a);for(a=0;a<d.length;a++)Fa(b,d[a].sSearch,a,d[a].bEscapeRegex!==e?!d[a].bEscapeRegex:d[a].bRegex,d[a].bSmart,d[a].bCaseInsensitive);Ga(b)}else p(a);b.bFiltered=!0;V(b,null,"search",[b])}function Ga(a){for(var c=C.ext.search,f=a.aiDisplay,d,e,p=0,g=c.length;p<g;p++){for(var l=[],k=0,m=f.length;k<m;k++)e=f[k],d=a.aoData[e],
c[p](a,d._aFilterData,e,d._aData,k)&&l.push(e);f.length=0;b.merge(f,l)}}function Fa(b,a,c,f,d,e){if(""!==a){var p=b.aiDisplay;f=Ua(a,f,d,e);for(d=p.length-1;0<=d;d--)a=b.aoData[p[d]]._aFilterData[c],f.test(a)||p.splice(d,1)}}function nb(b,a,c,f,d,e){f=Ua(a,f,d,e);d=b.oPreviousSearch.sSearch;e=b.aiDisplayMaster;var p;0!==C.ext.search.length&&(c=!0);p=ob(b);if(0>=a.length)b.aiDisplay=e.slice();else{if(p||c||d.length>a.length||0!==a.indexOf(d)||b.bSorted)b.aiDisplay=e.slice();a=b.aiDisplay;for(c=a.length-
1;0<=c;c--)f.test(b.aoData[a[c]]._sFilterRow)||a.splice(c,1)}}function Ua(a,c,f,d){a=c?a:Ha(a);f&&(a="^(?=.*?"+b.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(b){if('"'===b.charAt(0)){var a=b.match(/^"(.*)"$/);b=a?a[1]:b}return b.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(a,d?"i":"")}function Ha(b){return b.replace(Mb,"\\$1")}function ob(b){var a=b.aoColumns,c,f,d,e,p,g,l,k,m=C.ext.type.search;c=!1;f=0;for(e=b.aoData.length;f<e;f++)if(k=b.aoData[f],!k._aFilterData){g=[];d=0;for(p=a.length;d<
p;d++)c=a[d],c.bSearchable?(l=w(b,f,d,"filter"),m[c.sType]&&(l=m[c.sType](l)),null===l&&(l=""),"string"!==typeof l&&l.toString&&(l=l.toString())):l="",l.indexOf&&-1!==l.indexOf("&")&&(Ia.innerHTML=l,l=Nb?Ia.textContent:Ia.innerText),l.replace&&(l=l.replace(/[\r\n]/g,"")),g.push(l);k._aFilterData=g;k._sFilterRow=g.join("  ");c=!0}return c}function pb(b){return{search:b.sSearch,smart:b.bSmart,regex:b.bRegex,caseInsensitive:b.bCaseInsensitive}}function qb(b){return{sSearch:b.search,bSmart:b.smart,bRegex:b.regex,
bCaseInsensitive:b.caseInsensitive}}function lb(a){var c=a.sTableId,f=a.aanFeatures.i,d=b("<div/>",{"class":a.oClasses.sInfo,id:f?null:c+"_info"});f||(a.aoDrawCallback.push({fn:rb,sName:"information"}),d.attr("role","status").attr("aria-live","polite"),b(a.nTable).attr("aria-describedby",c+"_info"));return d[0]}function rb(a){var c=a.aanFeatures.i;if(0!==c.length){var f=a.oLanguage,d=a._iDisplayStart+1,e=a.fnDisplayEnd(),p=a.fnRecordsTotal(),g=a.fnRecordsDisplay(),l=g?f.sInfo:f.sInfoEmpty;g!==p&&
(l+=" "+f.sInfoFiltered);l+=f.sInfoPostFix;l=sb(a,l);f=f.fnInfoCallback;null!==f&&(l=f.call(a.oInstance,a,d,e,p,g,l));b(c).html(l)}}function sb(b,a){var c=b.fnFormatNumber,f=b._iDisplayStart+1,d=b._iDisplayLength,e=b.fnRecordsDisplay(),p=-1===d;return a.replace(/_START_/g,c.call(b,f)).replace(/_END_/g,c.call(b,b.fnDisplayEnd())).replace(/_MAX_/g,c.call(b,b.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(b,e)).replace(/_PAGE_/g,c.call(b,p?1:Math.ceil(f/d))).replace(/_PAGES_/g,c.call(b,p?1:Math.ceil(e/
d)))}function xa(b){var a,c,f=b.iInitDisplayStart,d=b.aoColumns,e;c=b.oFeatures;var p=b.bDeferLoading;if(b.bInitialised){T(b);v(b);y(b,b.aoHeader);y(b,b.aoFooter);fa(b,!0);c.bAutoWidth&&Ra(b);a=0;for(c=d.length;a<c;a++)e=d[a],e.sWidth&&(e.nTh.style.width=Y(e.sWidth));V(b,null,"preInit",[b]);R(b);d=ba(b);if("ssp"!=d||p)"ajax"==d?ka(b,[],function(c){var d=ta(b,c);for(a=0;a<d.length;a++)z(b,d[a]);b.iInitDisplayStart=f;R(b);fa(b,!1);Da(b,c)},b):(fa(b,!1),Da(b))}else setTimeout(function(){xa(b)},200)}
function Da(b,a){b._bInitComplete=!0;(a||b.oInit.aaData)&&n(b);V(b,null,"plugin-init",[b,a]);V(b,"aoInitComplete","init",[b,a])}function Va(b,a){var c=parseInt(a,10);b._iDisplayLength=c;Wa(b);V(b,null,"length",[b,c])}function ib(a){for(var c=a.oClasses,f=a.sTableId,d=a.aLengthMenu,e=b.isArray(d[0]),p=e?d[0]:d,d=e?d[1]:d,e=b("<select/>",{name:f+"_length","aria-controls":f,"class":c.sLengthSelect}),g=0,l=p.length;g<l;g++)e[0][g]=new Option(d[g],p[g]);var k=b("<div><label/></div>").addClass(c.sLength);
a.aanFeatures.l||(k[0].id=f+"_length");k.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",e[0].outerHTML));b("select",k).val(a._iDisplayLength).bind("change.DT",function(){Va(a,b(this).val());E(a)});b(a.nTable).bind("length.dt.DT",function(c,f,d){a===f&&b("select",k).val(d)});return k[0]}function mb(a){var c=a.sPaginationType,f=C.ext.pager[c],d="function"===typeof f,e=function(b){E(b)},c=b("<div/>").addClass(a.oClasses.sPaging+c)[0],p=a.aanFeatures;d||f.fnInit(a,c,e);p.p||(c.id=a.sTableId+
"_paginate",a.aoDrawCallback.push({fn:function(b){if(d){var a=b._iDisplayStart,c=b._iDisplayLength,g=b.fnRecordsDisplay(),l=-1===c,a=l?0:Math.ceil(a/c),c=l?1:Math.ceil(g/c),g=f(a,c),k,l=0;for(k=p.p.length;l<k;l++)Ta(b,"pageButton")(b,p.p[l],l,g,a,c)}else f.fnUpdate(b,e)},sName:"pagination"}));return c}function Xa(b,a,c){var f=b._iDisplayStart,d=b._iDisplayLength,e=b.fnRecordsDisplay();0===e||-1===d?f=0:"number"===typeof a?(f=a*d,f>e&&(f=0)):"first"==a?f=0:"previous"==a?(f=0<=d?f-d:0,0>f&&(f=0)):"next"==
a?f+d<e&&(f+=d):"last"==a?f=Math.floor((e-1)/d)*d:ma(b,0,"Unknown paging action: "+a,5);a=b._iDisplayStart!==f;b._iDisplayStart=f;a&&(V(b,null,"page",[b]),c&&E(b));return a}function jb(a){return b("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function fa(a,c){a.oFeatures.bProcessing&&b(a.aanFeatures.r).css("display",c?"block":"none");V(a,null,"processing",[a,c])}function kb(a){var c=b(a.nTable);c.attr("role",
"grid");var f=a.oScroll;if(""===f.sX&&""===f.sY)return a.nTable;var d=f.sX,e=f.sY,p=a.oClasses,g=c.children("caption"),l=g.length?g[0]._captionSide:null,k=b(c[0].cloneNode(!1)),m=b(c[0].cloneNode(!1)),n=c.children("tfoot");n.length||(n=null);k=b("<div/>",{"class":p.sScrollWrapper}).append(b("<div/>",{"class":p.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:d?d?Y(d):null:"100%"}).append(b("<div/>",{"class":p.sScrollHeadInner}).css({"box-sizing":"content-box",width:f.sXInner||
"100%"}).append(k.removeAttr("id").css("margin-left",0).append("top"===l?g:null).append(c.children("thead"))))).append(b("<div/>",{"class":p.sScrollBody}).css({position:"relative",overflow:"auto",width:d?Y(d):null}).append(c));n&&k.append(b("<div/>",{"class":p.sScrollFoot}).css({overflow:"hidden",border:0,width:d?d?Y(d):null:"100%"}).append(b("<div/>",{"class":p.sScrollFootInner}).append(m.removeAttr("id").css("margin-left",0).append("bottom"===l?g:null).append(c.children("tfoot")))));var c=k.children(),
v=c[0],p=c[1],h=n?c[2]:null;if(d)b(p).on("scroll.DT",function(){var b=this.scrollLeft;v.scrollLeft=b;n&&(h.scrollLeft=b)});b(p).css(e&&f.bCollapse?"max-height":"height",e);a.nScrollHead=v;a.nScrollBody=p;a.nScrollFoot=h;a.aoDrawCallback.push({fn:va,sName:"scrolling"});return k[0]}function va(a){var c=a.oScroll,f=c.sX,d=c.sXInner,p=c.sY,c=c.iBarWidth,g=b(a.nScrollHead),l=g[0].style,k=g.children("div"),m=k[0].style,v=k.children("table"),k=a.nScrollBody,h=b(k),y=k.style,E=b(a.nScrollFoot).children("div"),
t=E.children("table"),q=b(a.nTHead),r=b(a.nTable),R=r[0],T=R.style,w=a.nTFoot?b(a.nTFoot):null,x=a.oBrowser,P=x.bScrollOversize,z,U,L,G,Q=[],B=[],A=[],M,I=function(b){b=b.style;b.paddingTop="0";b.paddingBottom="0";b.borderTopWidth="0";b.borderBottomWidth="0";b.height=0};U=k.scrollHeight>k.clientHeight;a.scrollBarVis!==U&&a.scrollBarVis!==e?(a.scrollBarVis=U,n(a)):(a.scrollBarVis=U,r.children("thead, tfoot").remove(),G=q.clone().prependTo(r),q=q.find("tr"),U=G.find("tr"),G.find("th, td").removeAttr("tabindex"),
w&&(L=w.clone().prependTo(r),z=w.find("tr"),L=L.find("tr")),f||(y.width="100%",g[0].style.width="100%"),b.each(ca(a,G),function(b,c){M=u(a,b);c.style.width=a.aoColumns[M].sWidth}),w&&la(function(b){b.style.width=""},L),g=r.outerWidth(),""===f?(T.width="100%",P&&(r.find("tbody").height()>k.offsetHeight||"scroll"==h.css("overflow-y"))&&(T.width=Y(r.outerWidth()-c)),g=r.outerWidth()):""!==d&&(T.width=Y(d),g=r.outerWidth()),la(I,U),la(function(a){A.push(a.innerHTML);Q.push(Y(b(a).css("width")))},U),la(function(b,
a){b.style.width=Q[a]},q),b(U).height(0),w&&(la(I,L),la(function(a){B.push(Y(b(a).css("width")))},L),la(function(b,a){b.style.width=B[a]},z),b(L).height(0)),la(function(b,a){b.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+A[a]+"</div>";b.style.width=Q[a]},U),w&&la(function(b,a){b.innerHTML="";b.style.width=B[a]},L),r.outerWidth()<g?(z=k.scrollHeight>k.offsetHeight||"scroll"==h.css("overflow-y")?g+c:g,P&&(k.scrollHeight>k.offsetHeight||"scroll"==h.css("overflow-y"))&&
(T.width=Y(z-c)),""!==f&&""===d||ma(a,1,"Possible column misalignment",6)):z="100%",y.width=Y(z),l.width=Y(z),w&&(a.nScrollFoot.style.width=Y(z)),!p&&P&&(y.height=Y(R.offsetHeight+c)),f=r.outerWidth(),v[0].style.width=Y(f),m.width=Y(f),d=r.height()>k.clientHeight||"scroll"==h.css("overflow-y"),p="padding"+(x.bScrollbarLeft?"Left":"Right"),m[p]=d?c+"px":"0px",w&&(t[0].style.width=Y(f),E[0].style.width=Y(f),E[0].style[p]=d?c+"px":"0px"),h.scroll(),!a.bSorted&&!a.bFiltered||a._drawHold||(k.scrollTop=
0))}function la(b,a,c){for(var f=0,d=0,e=a.length,p,g;d<e;){p=a[d].firstChild;for(g=c?c[d].firstChild:null;p;)1===p.nodeType&&(c?b(p,g,f):b(p,f),f++),p=p.nextSibling,g=c?g.nextSibling:null;d++}}function Ra(a){var c=a.nTable,f=a.aoColumns,d=a.oScroll,e=d.sY,p=d.sX,g=d.sXInner,l=f.length,k=A(a,"bVisible"),m=b("th",a.nTHead),v=c.getAttribute("width"),y=c.parentNode,E=!1,t,q,r=a.oBrowser,d=r.bScrollOversize;(t=c.style.width)&&-1!==t.indexOf("%")&&(v=t);for(t=0;t<k.length;t++)q=f[k[t]],null!==q.sWidth&&
(q.sWidth=tb(q.sWidthOrig,y),E=!0);if(d||!E&&!p&&!e&&l==x(a)&&l==m.length)for(t=0;t<l;t++)k=u(a,t),null!==k&&(f[k].sWidth=Y(m.eq(t).width()));else{l=b(c).clone().css("visibility","hidden").removeAttr("id");l.find("tbody tr").remove();var R=b("<tr/>").appendTo(l.find("tbody"));l.find("thead, tfoot").remove();l.append(b(a.nTHead).clone()).append(b(a.nTFoot).clone());l.find("tfoot th, tfoot td").css("width","");m=ca(a,l.find("thead")[0]);for(t=0;t<k.length;t++)q=f[k[t]],m[t].style.width=null!==q.sWidthOrig&&
""!==q.sWidthOrig?Y(q.sWidthOrig):"",q.sWidthOrig&&p&&b(m[t]).append(b("<div/>").css({width:q.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(t=0;t<k.length;t++)E=k[t],q=f[E],b(ub(a,E)).clone(!1).append(q.sContentPadding).appendTo(R);q=b("<div/>").css(p||e?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(l).appendTo(y);p&&g?l.width(g):p?(l.css("width","auto"),l.removeAttr("width"),l.width()<y.clientWidth&&v&&l.width(y.clientWidth)):e?l.width(y.clientWidth):
v&&l.width(v);for(t=e=0;t<k.length;t++)y=b(m[t]),g=y.outerWidth()-y.width(),y=r.bBounding?Math.ceil(m[t].getBoundingClientRect().width):y.outerWidth(),e+=y,f[k[t]].sWidth=Y(y-g);c.style.width=Y(e);q.remove()}v&&(c.style.width=Y(v));!v&&!p||a._reszEvt||(c=function(){b(h).bind("resize.DT-"+a.sInstance,Ea(function(){n(a)}))},d?setTimeout(c,1E3):c(),a._reszEvt=!0)}function Ea(b,a){var c=a!==e?a:200,f,d;return function(){var a=this,p=+new Date,g=arguments;f&&p<f+c?(clearTimeout(d),d=setTimeout(function(){f=
e;b.apply(a,g)},c)):(f=p,b.apply(a,g))}}function tb(a,c){if(!a)return 0;var f=b("<div/>").css("width",Y(a)).appendTo(c||d.body),e=f[0].offsetWidth;f.remove();return e}function ub(a,c){var f=vb(a,c);if(0>f)return null;var d=a.aoData[f];return d.nTr?d.anCells[c]:b("<td/>").html(w(a,f,c,"display"))[0]}function vb(b,a){for(var c,f=-1,d=-1,e=0,p=b.aoData.length;e<p;e++)c=w(b,e,a,"display")+"",c=c.replace(Ob,""),c=c.replace(/&nbsp;/g," "),c.length>f&&(f=c.length,d=e);return d}function Y(b){return null===
b?"0px":"number"==typeof b?0>b?"0px":b+"px":b.match(/\d$/)?b+"px":b}function sa(a){var c,f,d=[],p=a.aoColumns,g,l,k,m;c=a.aaSortingFixed;f=b.isPlainObject(c);var n=[];g=function(a){a.length&&!b.isArray(a[0])?n.push(a):b.merge(n,a)};b.isArray(c)&&g(c);f&&c.pre&&g(c.pre);g(a.aaSorting);f&&c.post&&g(c.post);for(a=0;a<n.length;a++)for(m=n[a][0],g=p[m].aDataSort,c=0,f=g.length;c<f;c++)l=g[c],k=p[l].sType||"string",n[a]._idx===e&&(n[a]._idx=b.inArray(n[a][1],p[l].asSorting)),d.push({src:m,col:l,dir:n[a][1],
index:n[a]._idx,type:k,formatter:C.ext.type.order[k+"-pre"]});return d}function hb(b){var a,c,f=[],d=C.ext.type.order,e=b.aoData,p=0,g,l=b.aiDisplayMaster,k;F(b);k=sa(b);a=0;for(c=k.length;a<c;a++)g=k[a],g.formatter&&p++,wb(b,g.col);if("ssp"!=ba(b)&&0!==k.length){a=0;for(c=l.length;a<c;a++)f[l[a]]=a;p===k.length?l.sort(function(b,a){var c,d,p,g,l=k.length,m=e[b]._aSortData,n=e[a]._aSortData;for(p=0;p<l;p++)if(g=k[p],c=m[g.col],d=n[g.col],c=c<d?-1:c>d?1:0,0!==c)return"asc"===g.dir?c:-c;c=f[b];d=f[a];
return c<d?-1:c>d?1:0}):l.sort(function(b,a){var c,p,g,l,m=k.length,n=e[b]._aSortData,v=e[a]._aSortData;for(g=0;g<m;g++)if(l=k[g],c=n[l.col],p=v[l.col],l=d[l.type+"-"+l.dir]||d["string-"+l.dir],c=l(c,p),0!==c)return c;c=f[b];p=f[a];return c<p?-1:c>p?1:0})}b.bSorted=!0}function xb(b){var a,c,f=b.aoColumns,d=sa(b);b=b.oLanguage.oAria;for(var e=0,p=f.length;e<p;e++){c=f[e];var g=c.asSorting;a=c.sTitle.replace(/<.*?>/g,"");var l=c.nTh;l.removeAttribute("aria-sort");c.bSortable&&(0<d.length&&d[0].col==
e?(l.setAttribute("aria-sort","asc"==d[0].dir?"ascending":"descending"),c=g[d[0].index+1]||g[0]):c=g[0],a+="asc"===c?b.sSortAscending:b.sSortDescending);l.setAttribute("aria-label",a)}}function Ya(a,c,f,d){var p=a.aaSorting,g=a.aoColumns[c].asSorting,l=function(a,c){var f=a._idx;f===e&&(f=b.inArray(a[1],g));return f+1<g.length?f+1:c?null:0};"number"===typeof p[0]&&(p=a.aaSorting=[p]);f&&a.oFeatures.bSortMulti?(f=b.inArray(c,ha(p,"0")),-1!==f?(c=l(p[f],!0),null===c&&1===p.length&&(c=0),null===c?p.splice(f,
1):(p[f][1]=g[c],p[f]._idx=c)):(p.push([c,g[0],0]),p[p.length-1]._idx=0)):p.length&&p[0][0]==c?(c=l(p[0]),p.length=1,p[0][1]=g[c],p[0]._idx=c):(p.length=0,p.push([c,g[0]]),p[0]._idx=0);R(a);"function"==typeof d&&d(a)}function Sa(b,a,c,f){var d=b.aoColumns[c];Za(a,{},function(a){!1!==d.bSortable&&(b.oFeatures.bProcessing?(fa(b,!0),setTimeout(function(){Ya(b,c,a.shiftKey,f);"ssp"!==ba(b)&&fa(b,!1)},0)):Ya(b,c,a.shiftKey,f))})}function Ja(a){var c=a.aLastSort,f=a.oClasses.sSortColumn,d=sa(a),e=a.oFeatures,
p,g;if(e.bSort&&e.bSortClasses){e=0;for(p=c.length;e<p;e++)g=c[e].src,b(ha(a.aoData,"anCells",g)).removeClass(f+(2>e?e+1:3));e=0;for(p=d.length;e<p;e++)g=d[e].src,b(ha(a.aoData,"anCells",g)).addClass(f+(2>e?e+1:3))}a.aLastSort=d}function wb(b,a){var c=b.aoColumns[a],d=C.ext.order[c.sSortDataType],e;d&&(e=d.call(b.oInstance,b,a,f(b,a)));for(var p,g=C.ext.type.order[c.sType+"-pre"],l=0,k=b.aoData.length;l<k;l++)if(c=b.aoData[l],c._aSortData||(c._aSortData=[]),!c._aSortData[a]||d)p=d?e[l]:w(b,l,a,"sort"),
c._aSortData[a]=g?g(p):p}function Ka(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var c={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:b.extend(!0,[],a.aaSorting),search:pb(a.oPreviousSearch),columns:b.map(a.aoColumns,function(b,c){return{visible:b.bVisible,search:pb(a.aoPreSearchCols[c])}})};V(a,"aoStateSaveParams","stateSaveParams",[a,c]);a.oSavedState=c;a.fnStateSaveCallback.call(a.oInstance,a,c)}}function yb(a){var c,f,d=a.aoColumns;if(a.oFeatures.bStateSave){var p=a.fnStateLoadCallback.call(a.oInstance,
a);if(p&&p.time&&(c=V(a,"aoStateLoadParams","stateLoadParams",[a,p]),-1===b.inArray(!1,c)&&(c=a.iStateDuration,!(0<c&&p.time<+new Date-1E3*c)&&d.length===p.columns.length))){a.oLoadedState=b.extend(!0,{},p);p.start!==e&&(a._iDisplayStart=p.start,a.iInitDisplayStart=p.start);p.length!==e&&(a._iDisplayLength=p.length);p.order!==e&&(a.aaSorting=[],b.each(p.order,function(b,c){a.aaSorting.push(c[0]>=d.length?[0,c[1]]:c)}));p.search!==e&&b.extend(a.oPreviousSearch,qb(p.search));c=0;for(f=p.columns.length;c<
f;c++){var g=p.columns[c];g.visible!==e&&(d[c].bVisible=g.visible);g.search!==e&&b.extend(a.aoPreSearchCols[c],qb(g.search))}V(a,"aoStateLoaded","stateLoaded",[a,p])}}}function La(a){var c=C.settings;a=b.inArray(a,ha(c,"nTable"));return-1!==a?c[a]:null}function ma(b,a,c,f){c="DataTables warning: "+(b?"table id="+b.sTableId+" - ":"")+c;f&&(c+=". For more information about this error, please see http://datatables.net/tn/"+f);if(a)h.console&&console.log&&console.log(c);else if(a=C.ext,a=a.sErrMode||
a.errMode,b&&V(b,null,"error",[b,f,c]),"alert"==a)alert(c);else{if("throw"==a)throw Error(c);"function"==typeof a&&a(b,f,c)}}function ia(a,c,f,d){b.isArray(f)?b.each(f,function(f,d){b.isArray(d)?ia(a,c,d[0],d[1]):ia(a,c,d)}):(d===e&&(d=f),c[f]!==e&&(a[d]=c[f]))}function zb(a,c,f){var d,e;for(e in c)c.hasOwnProperty(e)&&(d=c[e],b.isPlainObject(d)?(b.isPlainObject(a[e])||(a[e]={}),b.extend(!0,a[e],d)):a[e]=f&&"data"!==e&&"aaData"!==e&&b.isArray(d)?d.slice():d);return a}function Za(a,c,f){b(a).bind("click.DT",
c,function(b){a.blur();f(b)}).bind("keypress.DT",c,function(b){13===b.which&&(b.preventDefault(),f(b))}).bind("selectstart.DT",function(){return!1})}function da(b,a,c,f){c&&b[a].push({fn:c,sName:f})}function V(a,c,f,d){var e=[];c&&(e=b.map(a[c].slice().reverse(),function(b){return b.fn.apply(a.oInstance,d)}));null!==f&&(c=b.Event(f+".dt"),b(a.nTable).trigger(c,d),e.push(c.result));return e}function Wa(b){var a=b._iDisplayStart,c=b.fnDisplayEnd(),f=b._iDisplayLength;a>=c&&(a=c-f);a-=a%f;if(-1===f||
0>a)a=0;b._iDisplayStart=a}function Ta(a,c){var f=a.renderer,d=C.ext.renderer[c];return b.isPlainObject(f)&&f[c]?d[f[c]]||d._:"string"===typeof f?d[f]||d._:d._}function ba(b){return b.oFeatures.bServerSide?"ssp":b.ajax||b.sAjaxSource?"ajax":"dom"}function Ma(b,a){var c=[],c=Ab.numbers_length,f=Math.floor(c/2);a<=c?c=ua(0,a):b<=f?(c=ua(0,c-2),c.push("ellipsis"),c.push(a-1)):(b>=a-1-f?c=ua(a-(c-2),a):(c=ua(b-f+2,b+f-1),c.push("ellipsis"),c.push(a-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el=
"span";return c}function gb(a){b.each({num:function(b){return Na(b,a)},"num-fmt":function(b){return Na(b,a,$a)},"html-num":function(b){return Na(b,a,Oa)},"html-num-fmt":function(b){return Na(b,a,Oa,$a)}},function(b,c){Z.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(Z.type.search[b+a]=Z.type.search.html)})}function Bb(b){return function(){var a=[La(this[C.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return C.ext.internal[b].apply(this,a)}}var C,Z,S,K,W,ab={},Cb=/[\r\n]/g,Oa=/<.*?>/g,
Pb=/^[\w\+\-]/,Qb=/[\w\+\-]$/,Mb=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),$a=/[',$\u00a3\u20ac\u00a5%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,oa=function(b){return b&&!0!==b&&"-"!==b?!1:!0},Db=function(b){var a=parseInt(b,10);return!isNaN(a)&&isFinite(b)?a:null},Eb=function(b,a){ab[a]||(ab[a]=RegExp(Ha(a),"g"));return"string"===typeof b&&"."!==a?b.replace(/\./g,"").replace(ab[a],"."):b},bb=function(b,a,c){var f="string"===typeof b;if(oa(b))return!0;a&&f&&(b=Eb(b,
a));c&&f&&(b=b.replace($a,""));return!isNaN(parseFloat(b))&&isFinite(b)},Fb=function(b,a,c){return oa(b)?!0:oa(b)||"string"===typeof b?bb(b.replace(Oa,""),a,c)?!0:null:null},ha=function(b,a,c){var f=[],d=0,p=b.length;if(c!==e)for(;d<p;d++)b[d]&&b[d][a]&&f.push(b[d][a][c]);else for(;d<p;d++)b[d]&&f.push(b[d][a]);return f},ya=function(b,a,c,f){var d=[],p=0,g=a.length;if(f!==e)for(;p<g;p++)b[a[p]][c]&&d.push(b[a[p]][c][f]);else for(;p<g;p++)d.push(b[a[p]][c]);return d},ua=function(b,a){var c=[],f;a===
e?(a=0,f=b):(f=a,a=b);for(var d=a;d<f;d++)c.push(d);return c},Gb=function(b){for(var a=[],c=0,f=b.length;c<f;c++)b[c]&&a.push(b[c]);return a},Aa=function(b){var a=[],c,f,d=b.length,e,p=0;f=0;a:for(;f<d;f++){c=b[f];for(e=0;e<p;e++)if(a[e]===c)continue a;a.push(c);p++}return a},ea=function(b,a,c){b[a]!==e&&(b[c]=b[a])},wa=/\[.*?\]$/,qa=/\(\)$/,Ia=b("<div>")[0],Nb=Ia.textContent!==e,Ob=/<.*?>/g;C=function(a){this.$=function(b,a){return this.api(!0).$(b,a)};this._=function(b,a){return this.api(!0).rows(b,
a).data()};this.api=function(b){return b?new S(La(this[Z.iApiIndex])):new S(this)};this.fnAddData=function(a,c){var f=this.api(!0),d=b.isArray(a)&&(b.isArray(a[0])||b.isPlainObject(a[0]))?f.rows.add(a):f.row.add(a);(c===e||c)&&f.draw();return d.flatten().toArray()};this.fnAdjustColumnSizing=function(b){var a=this.api(!0).columns.adjust(),c=a.settings()[0],f=c.oScroll;b===e||b?a.draw(!1):(""!==f.sX||""!==f.sY)&&va(c)};this.fnClearTable=function(b){var a=this.api(!0).clear();(b===e||b)&&a.draw()};this.fnClose=
function(b){this.api(!0).row(b).child.hide()};this.fnDeleteRow=function(b,a,c){var f=this.api(!0);b=f.rows(b);var d=b.settings()[0],p=d.aoData[b[0][0]];b.remove();a&&a.call(this,d,p);(c===e||c)&&f.draw();return p};this.fnDestroy=function(b){this.api(!0).destroy(b)};this.fnDraw=function(b){this.api(!0).draw(b)};this.fnFilter=function(b,a,c,f,d,p){d=this.api(!0);null===a||a===e?d.search(b,c,f,p):d.column(a).search(b,c,f,p);d.draw()};this.fnGetData=function(b,a){var c=this.api(!0);if(b!==e){var f=b.nodeName?
b.nodeName.toLowerCase():"";return a!==e||"td"==f||"th"==f?c.cell(b,a).data():c.row(b).data()||null}return c.data().toArray()};this.fnGetNodes=function(b){var a=this.api(!0);return b!==e?a.row(b).node():a.rows().nodes().flatten().toArray()};this.fnGetPosition=function(b){var a=this.api(!0),c=b.nodeName.toUpperCase();return"TR"==c?a.row(b).index():"TD"==c||"TH"==c?(b=a.cell(b).index(),[b.row,b.columnVisible,b.column]):null};this.fnIsOpen=function(b){return this.api(!0).row(b).child.isShown()};this.fnOpen=
function(b,a,c){return this.api(!0).row(b).child(a,c).show().child()[0]};this.fnPageChange=function(b,a){var c=this.api(!0).page(b);(a===e||a)&&c.draw(!1)};this.fnSetColumnVis=function(b,a,c){b=this.api(!0).column(b).visible(a);(c===e||c)&&b.columns.adjust().draw()};this.fnSettings=function(){return La(this[Z.iApiIndex])};this.fnSort=function(b){this.api(!0).order(b).draw()};this.fnSortListener=function(b,a,c){this.api(!0).order.listener(b,a,c)};this.fnUpdate=function(b,a,c,f,d){var p=this.api(!0);
c===e||null===c?p.row(a).data(b):p.cell(a,c).data(b);(d===e||d)&&p.columns.adjust();(f===e||f)&&p.draw();return 0};this.fnVersionCheck=Z.fnVersionCheck;var f=this,d=a===e,p=this.length;d&&(a={});this.oApi=this.internal=Z.internal;for(var n in C.ext.internal)n&&(this[n]=Bb(n));this.each(function(){var n={},n=1<p?zb(n,a,!0):a,v=0,h,y=this.getAttribute("id"),E=!1,u=C.defaults,q=b(this);if("table"!=this.nodeName.toLowerCase())ma(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{l(u);
c(u.column);g(u,u,!0);g(u.column,u.column,!0);g(u,b.extend(n,q.data()));var R=C.settings,v=0;for(h=R.length;v<h;v++){var T=R[v];if(T.nTable==this||T.nTHead.parentNode==this||T.nTFoot&&T.nTFoot.parentNode==this){v=n.bRetrieve!==e?n.bRetrieve:u.bRetrieve;if(d||v)return T.oInstance;if(n.bDestroy!==e?n.bDestroy:u.bDestroy){T.oInstance.fnDestroy();break}else{ma(T,0,"Cannot reinitialise DataTable",3);return}}if(T.sTableId==this.id){R.splice(v,1);break}}if(null===y||""===y)this.id=y="DataTables_Table_"+
C.ext._unique++;var w=b.extend(!0,{},C.models.oSettings,{sDestroyWidth:q[0].style.width,sInstance:y,sTableId:y});w.nTable=this;w.oApi=f.internal;w.oInit=n;R.push(w);w.oInstance=1===f.length?f:q.dataTable();l(n);n.oLanguage&&m(n.oLanguage);n.aLengthMenu&&!n.iDisplayLength&&(n.iDisplayLength=b.isArray(n.aLengthMenu[0])?n.aLengthMenu[0][0]:n.aLengthMenu[0]);n=zb(b.extend(!0,{},u),n);ia(w.oFeatures,n,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));
ia(w,n,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);ia(w.oScroll,n,[["sScrollX","sX"],["sScrollXInner",
"sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);ia(w.oLanguage,n,"fnInfoCallback");da(w,"aoDrawCallback",n.fnDrawCallback,"user");da(w,"aoServerParams",n.fnServerParams,"user");da(w,"aoStateSaveParams",n.fnStateSaveParams,"user");da(w,"aoStateLoadParams",n.fnStateLoadParams,"user");da(w,"aoStateLoaded",n.fnStateLoaded,"user");da(w,"aoRowCallback",n.fnRowCallback,"user");da(w,"aoRowCreatedCallback",n.fnCreatedRow,"user");da(w,"aoHeaderCallback",n.fnHeaderCallback,"user");da(w,"aoFooterCallback",
n.fnFooterCallback,"user");da(w,"aoInitComplete",n.fnInitComplete,"user");da(w,"aoPreDrawCallback",n.fnPreDrawCallback,"user");w.rowIdFn=G(n.rowId);t(w);y=w.oClasses;n.bJQueryUI?(b.extend(y,C.ext.oJUIClasses,n.oClasses),n.sDom===u.sDom&&"lfrtip"===u.sDom&&(w.sDom='<"H"lfr>t<"F"ip>'),w.renderer)?b.isPlainObject(w.renderer)&&!w.renderer.header&&(w.renderer.header="jqueryui"):w.renderer="jqueryui":b.extend(y,C.ext.classes,n.oClasses);q.addClass(y.sTable);w.iInitDisplayStart===e&&(w.iInitDisplayStart=
n.iDisplayStart,w._iDisplayStart=n.iDisplayStart);null!==n.iDeferLoading&&(w.bDeferLoading=!0,v=b.isArray(n.iDeferLoading),w._iRecordsDisplay=v?n.iDeferLoading[0]:n.iDeferLoading,w._iRecordsTotal=v?n.iDeferLoading[1]:n.iDeferLoading);var x=w.oLanguage;b.extend(!0,x,n.oLanguage);""!==x.sUrl&&(b.ajax({dataType:"json",url:x.sUrl,success:function(a){m(a);g(u.oLanguage,a);b.extend(!0,x,a);xa(w)},error:function(){xa(w)}}),E=!0);null===n.asStripeClasses&&(w.asStripeClasses=[y.sStripeOdd,y.sStripeEven]);
var v=w.asStripeClasses,P=q.children("tbody").find("tr").eq(0);-1!==b.inArray(!0,b.map(v,function(b){return P.hasClass(b)}))&&(b("tbody tr",this).removeClass(v.join(" ")),w.asDestroyStripes=v.slice());R=[];v=this.getElementsByTagName("thead");0!==v.length&&(U(w.aoHeader,v[0]),R=ca(w));if(null===n.aoColumns)for(T=[],v=0,h=R.length;v<h;v++)T.push(null);else T=n.aoColumns;v=0;for(h=T.length;v<h;v++)k(w,R?R[v]:null);L(w,n.aoColumnDefs,T,function(b,a){r(w,b,a)});if(P.length){var Q=function(b,a){return null!==
b.getAttribute("data-"+a)?a:null};b(P[0]).children("th, td").each(function(b,a){var c=w.aoColumns[b];if(c.mData===b){var f=Q(a,"sort")||Q(a,"order"),d=Q(a,"filter")||Q(a,"search");if(null!==f||null!==d)c.mData={_:b+".display",sort:null!==f?b+".@data-"+f:e,type:null!==f?b+".@data-"+f:e,filter:null!==d?b+".@data-"+d:e},r(w,b)}})}var B=w.oFeatures;n.bStateSave&&(B.bStateSave=!0,yb(w,n),da(w,"aoDrawCallback",Ka,"state_save"));if(n.aaSorting===e)for(R=w.aaSorting,v=0,h=R.length;v<h;v++)R[v][1]=w.aoColumns[v].asSorting[0];
Ja(w);B.bSort&&da(w,"aoDrawCallback",function(){if(w.bSorted){var a=sa(w),c={};b.each(a,function(b,a){c[a.src]=a.dir});V(w,null,"order",[w,a,c]);xb(w)}});da(w,"aoDrawCallback",function(){(w.bSorted||"ssp"===ba(w)||B.bDeferRender)&&Ja(w)},"sc");v=q.children("caption").each(function(){this._captionSide=q.css("caption-side")});h=q.children("thead");0===h.length&&(h=b("<thead/>").appendTo(this));w.nTHead=h[0];h=q.children("tbody");0===h.length&&(h=b("<tbody/>").appendTo(this));w.nTBody=h[0];h=q.children("tfoot");
0===h.length&&0<v.length&&(""!==w.oScroll.sX||""!==w.oScroll.sY)&&(h=b("<tfoot/>").appendTo(this));0===h.length||0===h.children().length?q.addClass(y.sNoFooter):0<h.length&&(w.nTFoot=h[0],U(w.aoFooter,w.nTFoot));if(n.aaData)for(v=0;v<n.aaData.length;v++)z(w,n.aaData[v]);else(w.bDeferLoading||"dom"==ba(w))&&H(w,b(w.nTBody).children("tr"));w.aiDisplay=w.aiDisplayMaster.slice();w.bInitialised=!0;!1===E&&xa(w)}});f=null;return this};var Hb=[],aa=Array.prototype,Rb=function(a){var c,f,d=C.settings,e=b.map(d,
function(b){return b.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return c=b.inArray(a,e),-1!==c?[d[c]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?f=b(a):a instanceof b&&(f=a)}else return[];if(f)return f.map(function(){c=b.inArray(this,e);return-1!==c?d[c]:null}).toArray()};S=function(a,c){if(!(this instanceof S))return new S(a,c);var f=[],d=function(b){(b=Rb(b))&&(f=f.concat(b))};if(b.isArray(a))for(var e=
0,p=a.length;e<p;e++)d(a[e]);else d(a);this.context=Aa(f);c&&b.merge(this,c);this.selector={rows:null,cols:null,opts:null};S.extend(this,this,Hb)};C.Api=S;b.extend(S.prototype,{any:function(){return 0!==this.count()},concat:aa.concat,context:[],count:function(){return this.flatten().length},each:function(b){for(var a=0,c=this.length;a<c;a++)b.call(this,this[a],a,this);return this},eq:function(b){var a=this.context;return a.length>b?new S(a[b],this[b]):null},filter:function(b){var a=[];if(aa.filter)a=
aa.filter.call(this,b,this);else for(var c=0,f=this.length;c<f;c++)b.call(this,this[c],c,this)&&a.push(this[c]);return new S(this.context,a)},flatten:function(){var b=[];return new S(this.context,b.concat.apply(b,this.toArray()))},join:aa.join,indexOf:aa.indexOf||function(b,a){for(var c=a||0,f=this.length;c<f;c++)if(this[c]===b)return c;return-1},iterator:function(b,a,c,f){var d=[],p,g,l,k,n,m=this.context,v,h,y=this.selector;"string"===typeof b&&(f=c,c=a,a=b,b=!1);g=0;for(l=m.length;g<l;g++){var E=
new S(m[g]);if("table"===a)p=c.call(E,m[g],g),p!==e&&d.push(p);else if("columns"===a||"rows"===a)p=c.call(E,m[g],this[g],g),p!==e&&d.push(p);else if("column"===a||"column-rows"===a||"row"===a||"cell"===a)for(h=this[g],"column-rows"===a&&(v=Pa(m[g],y.opts)),k=0,n=h.length;k<n;k++)p=h[k],p="cell"===a?c.call(E,m[g],p.row,p.column,g,k):c.call(E,m[g],p,g,k,v),p!==e&&d.push(p)}return d.length||f?(b=new S(m,b?d.concat.apply([],d):d),a=b.selector,a.rows=y.rows,a.cols=y.cols,a.opts=y.opts,b):this},lastIndexOf:aa.lastIndexOf||
function(b,a){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(b){var a=[];if(aa.map)a=aa.map.call(this,b,this);else for(var c=0,f=this.length;c<f;c++)a.push(b.call(this,this[c],c));return new S(this.context,a)},pluck:function(b){return this.map(function(a){return a[b]})},pop:aa.pop,push:aa.push,reduce:aa.reduce||function(b,a){return q(this,b,a,0,this.length,1)},reduceRight:aa.reduceRight||function(b,a){return q(this,b,a,this.length-1,-1,-1)},reverse:aa.reverse,selector:null,
shift:aa.shift,sort:aa.sort,splice:aa.splice,toArray:function(){return aa.slice.call(this)},to$:function(){return b(this)},toJQuery:function(){return b(this)},unique:function(){return new S(this.context,Aa(this))},unshift:aa.unshift});S.extend=function(a,c,f){if(f.length&&c&&(c instanceof S||c.__dt_wrapper)){var d,p,e,g=function(b,a,c){return function(){var f=a.apply(b,arguments);S.extend(f,f,c.methodExt);return f}};d=0;for(p=f.length;d<p;d++)e=f[d],c[e.name]="function"===typeof e.val?g(a,e.val,e):
b.isPlainObject(e.val)?{}:e.val,c[e.name].__dt_wrapper=!0,S.extend(a,c[e.name],e.propExt)}};S.register=K=function(a,c){if(b.isArray(a))for(var f=0,d=a.length;f<d;f++)S.register(a[f],c);else for(var e=a.split("."),p=Hb,g,l,f=0,d=e.length;f<d;f++){g=(l=-1!==e[f].indexOf("()"))?e[f].replace("()",""):e[f];var k;a:{k=0;for(var n=p.length;k<n;k++)if(p[k].name===g){k=p[k];break a}k=null}k||(k={name:g,val:{},methodExt:[],propExt:[]},p.push(k));f===d-1?k.val=c:p=l?k.methodExt:k.propExt}};S.registerPlural=
W=function(a,c,f){S.register(a,f);S.register(c,function(){var a=f.apply(this,arguments);return a===this?this:a instanceof S?a.length?b.isArray(a[0])?new S(a.context,a[0]):a[0]:e:a})};K("tables()",function(a){var c;if(a){c=S;var f=this.context;if("number"===typeof a)a=[f[a]];else{var d=b.map(f,function(b){return b.nTable});a=b(d).filter(a).map(function(){var a=b.inArray(this,d);return f[a]}).toArray()}c=new c(a)}else c=this;return c});K("table()",function(b){b=this.tables(b);var a=b.context;return a.length?
new S(a[0]):b});W("tables().nodes()","table().node()",function(){return this.iterator("table",function(b){return b.nTable},1)});W("tables().body()","table().body()",function(){return this.iterator("table",function(b){return b.nTBody},1)});W("tables().header()","table().header()",function(){return this.iterator("table",function(b){return b.nTHead},1)});W("tables().footer()","table().footer()",function(){return this.iterator("table",function(b){return b.nTFoot},1)});W("tables().containers()","table().container()",
function(){return this.iterator("table",function(b){return b.nTableWrapper},1)});K("draw()",function(b){return this.iterator("table",function(a){"page"===b?E(a):("string"===typeof b&&(b="full-hold"===b?!1:!0),R(a,!1===b))})});K("page()",function(b){return b===e?this.page.info().page:this.iterator("table",function(a){Xa(a,b)})});K("page.info()",function(){if(0===this.context.length)return e;var b=this.context[0],a=b._iDisplayStart,c=b.oFeatures.bPaginate?b._iDisplayLength:-1,f=b.fnRecordsDisplay(),
d=-1===c;return{page:d?0:Math.floor(a/c),pages:d?1:Math.ceil(f/c),start:a,end:b.fnDisplayEnd(),length:c,recordsTotal:b.fnRecordsTotal(),recordsDisplay:f,serverSide:"ssp"===ba(b)}});K("page.len()",function(b){return b===e?0!==this.context.length?this.context[0]._iDisplayLength:e:this.iterator("table",function(a){Va(a,b)})});var Ib=function(b,a,c){if(c){var f=new S(b);f.one("draw",function(){c(f.ajax.json())})}if("ssp"==ba(b))R(b,a);else{fa(b,!0);var d=b.jqXHR;d&&4!==d.readyState&&d.abort();ka(b,[],
function(c){N(b);c=ta(b,c);for(var f=0,d=c.length;f<d;f++)z(b,c[f]);R(b,a);fa(b,!1)})}};K("ajax.json()",function(){var b=this.context;if(0<b.length)return b[0].json});K("ajax.params()",function(){var b=this.context;if(0<b.length)return b[0].oAjaxData});K("ajax.reload()",function(b,a){return this.iterator("table",function(c){Ib(c,!1===a,b)})});K("ajax.url()",function(a){var c=this.context;if(a===e){if(0===c.length)return e;c=c[0];return c.ajax?b.isPlainObject(c.ajax)?c.ajax.url:c.ajax:c.sAjaxSource}return this.iterator("table",
function(c){b.isPlainObject(c.ajax)?c.ajax.url=a:c.ajax=a})});K("ajax.url().load()",function(b,a){return this.iterator("table",function(c){Ib(c,!1===a,b)})});var cb=function(a,c,f,d,p){var g=[],l,k,n,m,v,h;n=typeof c;c&&"string"!==n&&"function"!==n&&c.length!==e||(c=[c]);n=0;for(m=c.length;n<m;n++)for(k=c[n]&&c[n].split?c[n].split(","):[c[n]],v=0,h=k.length;v<h;v++)(l=f("string"===typeof k[v]?b.trim(k[v]):k[v]))&&l.length&&(g=g.concat(l));a=Z.selector[a];if(a.length)for(n=0,m=a.length;n<m;n++)g=a[n](d,
p,g);return Aa(g)},db=function(a){a||(a={});a.filter&&a.search===e&&(a.search=a.filter);return b.extend({search:"none",order:"current",page:"all"},a)},eb=function(b){for(var a=0,c=b.length;a<c;a++)if(0<b[a].length)return b[0]=b[a],b[0].length=1,b.length=1,b.context=[b.context[a]],b;b.length=0;return b},Pa=function(a,c){var f,d,p,e=[],g=a.aiDisplay;f=a.aiDisplayMaster;var l=c.search;d=c.order;p=c.page;if("ssp"==ba(a))return"removed"===l?[]:ua(0,f.length);if("current"==p)for(f=a._iDisplayStart,d=a.fnDisplayEnd();f<
d;f++)e.push(g[f]);else if("current"==d||"applied"==d)e="none"==l?f.slice():"applied"==l?g.slice():b.map(f,function(a){return-1===b.inArray(a,g)?a:null});else if("index"==d||"original"==d)for(f=0,d=a.aoData.length;f<d;f++)"none"==l?e.push(f):(p=b.inArray(f,g),(-1===p&&"removed"==l||0<=p&&"applied"==l)&&e.push(f));return e};K("rows()",function(a,c){a===e?a="":b.isPlainObject(a)&&(c=a,a="");c=db(c);var f=this.iterator("table",function(f){var d=c;return cb("row",a,function(a){var c=Db(a);if(null!==c&&
!d)return[c];var p=Pa(f,d);if(null!==c&&-1!==b.inArray(c,p))return[c];if(!a)return p;if("function"===typeof a)return b.map(p,function(b){var c=f.aoData[b];return a(b,c._aData,c.nTr)?b:null});c=Gb(ya(f.aoData,p,"nTr"));return a.nodeName&&-1!==b.inArray(a,c)?[a._DT_RowIndex]:"string"===typeof a&&"#"===a.charAt(0)&&(p=f.aIds[a.replace(/^#/,"")],p!==e)?[p.idx]:b(c).filter(a).map(function(){return this._DT_RowIndex}).toArray()},f,d)},1);f.selector.rows=a;f.selector.opts=c;return f});K("rows().nodes()",
function(){return this.iterator("row",function(b,a){return b.aoData[a].nTr||e},1)});K("rows().data()",function(){return this.iterator(!0,"rows",function(b,a){return ya(b.aoData,a,"_aData")},1)});W("rows().cache()","row().cache()",function(b){return this.iterator("row",function(a,c){var f=a.aoData[c];return"search"===b?f._aFilterData:f._aSortData},1)});W("rows().invalidate()","row().invalidate()",function(b){return this.iterator("row",function(a,c){O(a,c,b)})});W("rows().indexes()","row().index()",
function(){return this.iterator("row",function(b,a){return a},1)});W("rows().ids()","row().id()",function(b){for(var a=[],c=this.context,f=0,d=c.length;f<d;f++)for(var p=0,e=this[f].length;p<e;p++){var g=c[f].rowIdFn(c[f].aoData[this[f][p]]._aData);a.push((!0===b?"#":"")+g)}return new S(c,a)});W("rows().remove()","row().remove()",function(){var b=this;this.iterator("row",function(a,c,f){var d=a.aoData,p=d[c],g,l,k,n,m;d.splice(c,1);g=0;for(l=d.length;g<l;g++)if(k=d[g],m=k.anCells,null!==k.nTr&&(k.nTr._DT_RowIndex=
g),null!==m)for(k=0,n=m.length;k<n;k++)m[k]._DT_CellIndex.row=g;Q(a.aiDisplayMaster,c);Q(a.aiDisplay,c);Q(b[f],c,!1);Wa(a);c=a.rowIdFn(p._aData);c!==e&&delete a.aIds[c]});this.iterator("table",function(b){for(var a=0,c=b.aoData.length;a<c;a++)b.aoData[a].idx=a});return this});K("rows.add()",function(a){var c=this.iterator("table",function(b){var c,f,d,p=[];f=0;for(d=a.length;f<d;f++)c=a[f],c.nodeName&&"TR"===c.nodeName.toUpperCase()?p.push(H(b,c)[0]):p.push(z(b,c));return p},1),f=this.rows(-1);f.pop();
b.merge(f,c);return f});K("row()",function(b,a){return eb(this.rows(b,a))});K("row().data()",function(b){var a=this.context;if(b===e)return a.length&&this.length?a[0].aoData[this[0]]._aData:e;a[0].aoData[this[0]]._aData=b;O(a[0],this[0],"data");return this});K("row().node()",function(){var b=this.context;return b.length&&this.length?b[0].aoData[this[0]].nTr||null:null});K("row.add()",function(a){a instanceof b&&a.length&&(a=a[0]);var c=this.iterator("table",function(b){return a.nodeName&&"TR"===a.nodeName.toUpperCase()?
H(b,a)[0]:z(b,a)});return this.row(c[0])});var fb=function(b,a){var c=b.context;c.length&&(c=c[0].aoData[a!==e?a:b[0]])&&c._details&&(c._details.remove(),c._detailsShow=e,c._details=e)},Jb=function(b,a){var c=b.context;if(c.length&&b.length){var f=c[0].aoData[b[0]];if(f._details){(f._detailsShow=a)?f._details.insertAfter(f.nTr):f._details.detach();var d=c[0],p=new S(d),e=d.aoData;p.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<ha(e,"_details").length&&(p.on("draw.dt.DT_details",
function(b,a){d===a&&p.rows({page:"current"}).eq(0).each(function(b){b=e[b];b._detailsShow&&b._details.insertAfter(b.nTr)})}),p.on("column-visibility.dt.DT_details",function(b,a){if(d===a)for(var c,f=x(a),p=0,g=e.length;p<g;p++)c=e[p],c._details&&c._details.children("td[colspan]").attr("colspan",f)}),p.on("destroy.dt.DT_details",function(b,a){if(d===a)for(var c=0,f=e.length;c<f;c++)e[c]._details&&fb(p,c)}))}}};K("row().child()",function(a,c){var f=this.context;if(a===e)return f.length&&this.length?
f[0].aoData[this[0]]._details:e;if(!0===a)this.child.show();else if(!1===a)fb(this);else if(f.length&&this.length){var d=f[0],f=f[0].aoData[this[0]],p=[],g=function(a,c){if(b.isArray(a)||a instanceof b)for(var f=0,e=a.length;f<e;f++)g(a[f],c);else a.nodeName&&"tr"===a.nodeName.toLowerCase()?p.push(a):(f=b("<tr><td/></tr>").addClass(c),b("td",f).addClass(c).html(a)[0].colSpan=x(d),p.push(f[0]))};g(a,c);f._details&&f._details.remove();f._details=b(p);f._detailsShow&&f._details.insertAfter(f.nTr)}return this});
K(["row().child.show()","row().child().show()"],function(){Jb(this,!0);return this});K(["row().child.hide()","row().child().hide()"],function(){Jb(this,!1);return this});K(["row().child.remove()","row().child().remove()"],function(){fb(this);return this});K("row().child.isShown()",function(){var b=this.context;return b.length&&this.length?b[0].aoData[this[0]]._detailsShow||!1:!1});var Sb=/^(.+):(name|visIdx|visible)$/,Kb=function(b,a,c,f,d){c=[];f=0;for(var p=d.length;f<p;f++)c.push(w(b,d[f],a));
return c};K("columns()",function(a,c){a===e?a="":b.isPlainObject(a)&&(c=a,a="");c=db(c);var f=this.iterator("table",function(f){var d=a,p=c,e=f.aoColumns,g=ha(e,"sName"),l=ha(e,"nTh");return cb("column",d,function(a){var c=Db(a);if(""===a)return ua(e.length);if(null!==c)return[0<=c?c:e.length+c];if("function"===typeof a){var d=Pa(f,p);return b.map(e,function(b,c){return a(c,Kb(f,c,0,0,d),l[c])?c:null})}var k="string"===typeof a?a.match(Sb):"";if(k)switch(k[2]){case "visIdx":case "visible":c=parseInt(k[1],
10);if(0>c){var n=b.map(e,function(b,a){return b.bVisible?a:null});return[n[n.length+c]]}return[u(f,c)];case "name":return b.map(g,function(b,a){return b===k[1]?a:null})}else return b(l).filter(a).map(function(){return b.inArray(this,l)}).toArray()},f,p)},1);f.selector.cols=a;f.selector.opts=c;return f});W("columns().header()","column().header()",function(){return this.iterator("column",function(b,a){return b.aoColumns[a].nTh},1)});W("columns().footer()","column().footer()",function(){return this.iterator("column",
function(b,a){return b.aoColumns[a].nTf},1)});W("columns().data()","column().data()",function(){return this.iterator("column-rows",Kb,1)});W("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(b,a){return b.aoColumns[a].mData},1)});W("columns().cache()","column().cache()",function(b){return this.iterator("column-rows",function(a,c,f,d,p){return ya(a.aoData,p,"search"===b?"_aFilterData":"_aSortData",c)},1)});W("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",
function(b,a,c,f,d){return ya(b.aoData,d,"anCells",a)},1)});W("columns().visible()","column().visible()",function(a,c){return this.iterator("column",function(f,d){if(a===e)return f.aoColumns[d].bVisible;var p=f.aoColumns,g=p[d],l=f.aoData,k,m,v;if(a!==e&&g.bVisible!==a){if(a){var h=b.inArray(!0,ha(p,"bVisible"),d+1);k=0;for(m=l.length;k<m;k++)v=l[k].nTr,p=l[k].anCells,v&&v.insertBefore(p[d],p[h]||null)}else b(ha(f.aoData,"anCells",d)).detach();g.bVisible=a;y(f,f.aoHeader);y(f,f.aoFooter);if(c===e||
c)n(f),(f.oScroll.sX||f.oScroll.sY)&&va(f);V(f,null,"column-visibility",[f,d,a,c]);Ka(f)}})});W("columns().indexes()","column().index()",function(b){return this.iterator("column",function(a,c){return"visible"===b?f(a,c):c},1)});K("columns.adjust()",function(){return this.iterator("table",function(b){n(b)},1)});K("column.index()",function(b,a){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===b||"toData"===b)return u(c,a);if("fromData"===b||"toVisible"===b)return f(c,a)}});K("column()",
function(b,a){return eb(this.columns(b,a))});K("cells()",function(a,c,f){b.isPlainObject(a)&&(a.row===e?(f=a,a=null):(f=c,c=null));b.isPlainObject(c)&&(f=c,c=null);if(null===c||c===e)return this.iterator("table",function(c){var d=a,p=db(f),g=c.aoData,l=Pa(c,p),k=Gb(ya(g,l,"anCells")),n=b([].concat.apply([],k)),m,v=c.aoColumns.length,h,y,E,u,t,q;return cb("cell",d,function(a){var f="function"===typeof a;if(null===a||a===e||f){h=[];y=0;for(E=l.length;y<E;y++)for(m=l[y],u=0;u<v;u++)t={row:m,column:u},
f?(q=g[m],a(t,w(c,m,u),q.anCells?q.anCells[u]:null)&&h.push(t)):h.push(t);return h}return b.isPlainObject(a)?[a]:n.filter(a).map(function(b,a){return{row:a._DT_CellIndex.row,column:a._DT_CellIndex.column}}).toArray()},c,p)});var d=this.columns(c,f),p=this.rows(a,f),g,l,k,n,m,v=this.iterator("table",function(b,a){g=[];l=0;for(k=p[a].length;l<k;l++)for(n=0,m=d[a].length;n<m;n++)g.push({row:p[a][l],column:d[a][n]});return g},1);b.extend(v.selector,{cols:c,rows:a,opts:f});return v});W("cells().nodes()",
"cell().node()",function(){return this.iterator("cell",function(b,a,c){return(b=b.aoData[a].anCells)?b[c]:e},1)});K("cells().data()",function(){return this.iterator("cell",function(b,a,c){return w(b,a,c)},1)});W("cells().cache()","cell().cache()",function(b){b="search"===b?"_aFilterData":"_aSortData";return this.iterator("cell",function(a,c,f){return a.aoData[c][b][f]},1)});W("cells().render()","cell().render()",function(b){return this.iterator("cell",function(a,c,f){return w(a,c,f,b)},1)});W("cells().indexes()",
"cell().index()",function(){return this.iterator("cell",function(b,a,c){return{row:a,column:c,columnVisible:f(b,c)}},1)});W("cells().invalidate()","cell().invalidate()",function(b){return this.iterator("cell",function(a,c,f){O(a,c,b,f)})});K("cell()",function(b,a,c){return eb(this.cells(b,a,c))});K("cell().data()",function(b){var a=this.context,c=this[0];if(b===e)return a.length&&c.length?w(a[0],c[0].row,c[0].column):e;I(a[0],c[0].row,c[0].column,b);O(a[0],c[0].row,"data",c[0].column);return this});
K("order()",function(a,c){var f=this.context;if(a===e)return 0!==f.length?f[0].aaSorting:e;"number"===typeof a?a=[[a,c]]:b.isArray(a[0])||(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});K("order.listener()",function(b,a,c){return this.iterator("table",function(f){Sa(f,b,a,c)})});K("order.fixed()",function(a){if(!a){var c=this.context,c=c.length?c[0].aaSortingFixed:e;return b.isArray(c)?{pre:c}:c}return this.iterator("table",function(c){c.aaSortingFixed=
b.extend(!0,{},a)})});K(["columns().order()","column().order()"],function(a){var c=this;return this.iterator("table",function(f,d){var p=[];b.each(c[d],function(b,c){p.push([c,a])});f.aaSorting=p})});K("search()",function(a,c,f,d){var p=this.context;return a===e?0!==p.length?p[0].oPreviousSearch.sSearch:e:this.iterator("table",function(p){p.oFeatures.bFilter&&pa(p,b.extend({},p.oPreviousSearch,{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===f?!0:f,bCaseInsensitive:null===d?!0:d}),1)})});W("columns().search()",
"column().search()",function(a,c,f,d){return this.iterator("column",function(p,g){var l=p.aoPreSearchCols;if(a===e)return l[g].sSearch;p.oFeatures.bFilter&&(b.extend(l[g],{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===f?!0:f,bCaseInsensitive:null===d?!0:d}),pa(p,p.oPreviousSearch,1))})});K("state()",function(){return this.context.length?this.context[0].oSavedState:null});K("state.clear()",function(){return this.iterator("table",function(b){b.fnStateSaveCallback.call(b.oInstance,b,{})})});K("state.loaded()",
function(){return this.context.length?this.context[0].oLoadedState:null});K("state.save()",function(){return this.iterator("table",function(b){Ka(b)})});C.versionCheck=C.fnVersionCheck=function(b){var a=C.version.split(".");b=b.split(".");for(var c,f,d=0,p=b.length;d<p;d++)if(c=parseInt(a[d],10)||0,f=parseInt(b[d],10)||0,c!==f)return c>f;return!0};C.isDataTable=C.fnIsDataTable=function(a){var c=b(a).get(0),f=!1;b.each(C.settings,function(a,d){var p=d.nScrollHead?b("table",d.nScrollHead)[0]:null,e=
d.nScrollFoot?b("table",d.nScrollFoot)[0]:null;if(d.nTable===c||p===c||e===c)f=!0});return f};C.tables=C.fnTables=function(a){var c=!1;b.isPlainObject(a)&&(c=a.api,a=a.visible);var f=b.map(C.settings,function(c){if(!a||a&&b(c.nTable).is(":visible"))return c.nTable});return c?new S(f):f};C.util={throttle:Ea,escapeRegex:Ha};C.camelToHungarian=g;K("$()",function(a,c){var f=this.rows(c).nodes(),f=b(f);return b([].concat(f.filter(a).toArray(),f.find(a).toArray()))});b.each(["on","one","off"],function(a,
c){K(c+"()",function(){var a=Array.prototype.slice.call(arguments);a[0].match(/\.dt\b/)||(a[0]+=".dt");var f=b(this.tables().nodes());f[c].apply(f,a);return this})});K("clear()",function(){return this.iterator("table",function(b){N(b)})});K("settings()",function(){return new S(this.context,this.context)});K("init()",function(){var b=this.context;return b.length?b[0].oInit:null});K("data()",function(){return this.iterator("table",function(b){return ha(b.aoData,"_aData")}).flatten()});K("destroy()",
function(a){a=a||!1;return this.iterator("table",function(c){var f=c.nTableWrapper.parentNode,d=c.oClasses,p=c.nTable,e=c.nTBody,g=c.nTHead,l=c.nTFoot,k=b(p),e=b(e),n=b(c.nTableWrapper),m=b.map(c.aoData,function(b){return b.nTr}),v;c.bDestroying=!0;V(c,"aoDestroyCallback","destroy",[c]);a||(new S(c)).columns().visible(!0);n.unbind(".DT").find(":not(tbody *)").unbind(".DT");b(h).unbind(".DT-"+c.sInstance);p!=g.parentNode&&(k.children("thead").detach(),k.append(g));l&&p!=l.parentNode&&(k.children("tfoot").detach(),
k.append(l));c.aaSorting=[];c.aaSortingFixed=[];Ja(c);b(m).removeClass(c.asStripeClasses.join(" "));b("th, td",g).removeClass(d.sSortable+" "+d.sSortableAsc+" "+d.sSortableDesc+" "+d.sSortableNone);c.bJUI&&(b("th span."+d.sSortIcon+", td span."+d.sSortIcon,g).detach(),b("th, td",g).each(function(){var a=b("div."+d.sSortJUIWrapper,this);b(this).append(a.contents());a.detach()}));e.children().detach();e.append(m);g=a?"remove":"detach";k[g]();n[g]();!a&&f&&(f.insertBefore(p,c.nTableReinsertBefore),k.css("width",
c.sDestroyWidth).removeClass(d.sTable),(v=c.asDestroyStripes.length)&&e.children().each(function(a){b(this).addClass(c.asDestroyStripes[a%v])}));f=b.inArray(c,C.settings);-1!==f&&C.settings.splice(f,1)})});b.each(["column","row","cell"],function(b,a){K(a+"s().every()",function(b){var c=this.selector.opts,f=this;return this.iterator(a,function(d,p,g,l,k){b.call(f[a](p,"cell"===a?g:c,"cell"===a?c:e),p,g,l,k)})})});K("i18n()",function(a,c,f){var d=this.context[0];a=G(a)(d.oLanguage);a===e&&(a=c);f!==
e&&b.isPlainObject(a)&&(a=a[f]!==e?a[f]:a._);return a.replace("%d",f)});C.version="1.10.10";C.settings=[];C.models={};C.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};C.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};C.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,
mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};C.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,
bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?
sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",
sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},
oSearch:b.extend({},C.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};a(C.defaults);C.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,
sType:null,sWidth:null};a(C.defaults.column);C.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],
aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,
searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:e,oAjaxData:e,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],
fnRecordsTotal:function(){return"ssp"==ba(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ba(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,f=this.aiDisplay.length,d=this.oFeatures,p=d.bPaginate;return d.bServerSide?!1===p||-1===a?b+f:Math.min(b+a,this._iRecordsDisplay):!p||c>f||-1===a?f:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,
aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};C.ext=Z={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:C.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:C.version};b.extend(Z,{afnFiltering:Z.search,aTypes:Z.type.detect,ofnSearch:Z.type.search,oSort:Z.type.order,afnSortData:Z.order,aoFeatures:Z.feature,
oApi:Z.internal,oStdClasses:Z.classes,oPagination:Z.pager});b.extend(C.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",
sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",
sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Qa="",Qa="",ja=Qa+"ui-state-default",za=Qa+"css_right ui-icon ui-icon-",Lb=Qa+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";b.extend(C.ext.oJUIClasses,C.ext.classes,{sPageButton:"fg-button ui-button "+ja,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:ja+" sorting_asc",
sSortDesc:ja+" sorting_desc",sSortable:ja+" sorting",sSortableAsc:ja+" sorting_asc_disabled",sSortableDesc:ja+" sorting_desc_disabled",sSortableNone:ja+" sorting_disabled",sSortJUIAsc:za+"triangle-1-n",sSortJUIDesc:za+"triangle-1-s",sSortJUI:za+"carat-2-n-s",sSortJUIAscAllowed:za+"carat-1-n",sSortJUIDescAllowed:za+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+ja,sScrollFoot:"dataTables_scrollFoot "+ja,sHeaderTH:ja,sFooterTH:ja,
sJUIHeader:Lb+" ui-corner-tl ui-corner-tr",sJUIFooter:Lb+" ui-corner-bl ui-corner-br"});var Ab=C.ext.pager;b.extend(Ab,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[Ma(a,b)]},simple_numbers:function(a,b){return["previous",Ma(a,b),"next"]},full_numbers:function(a,b){return["first","previous",Ma(a,b),"next","last"]},_numbers:Ma,numbers_length:7});b.extend(!0,C.ext.renderer,{pageButton:{_:function(a,c,f,p,e,g){var l=
a.oClasses,k=a.oLanguage.oPaginate,n=a.oLanguage.oAria.paginate||{},m,v,h=0,y=function(c,d){var p,E,u,t,q=function(b){Xa(a,b.data.action,!0)};p=0;for(E=d.length;p<E;p++)if(t=d[p],b.isArray(t))u=b("<"+(t.DT_el||"div")+"/>").appendTo(c),y(u,t);else{m=null;v="";switch(t){case "ellipsis":c.append('<span class="ellipsis">&#x2026;</span>');break;case "first":m=k.sFirst;v=t+(0<e?"":" "+l.sPageButtonDisabled);break;case "previous":m=k.sPrevious;v=t+(0<e?"":" "+l.sPageButtonDisabled);break;case "next":m=k.sNext;
v=t+(e<g-1?"":" "+l.sPageButtonDisabled);break;case "last":m=k.sLast;v=t+(e<g-1?"":" "+l.sPageButtonDisabled);break;default:m=t+1,v=e===t?l.sPageButtonActive:""}null!==m&&(u=b("<a>",{"class":l.sPageButton+" "+v,"aria-controls":a.sTableId,"aria-label":n[t],"data-dt-idx":h,tabindex:a.iTabIndex,id:0===f&&"string"===typeof t?a.sTableId+"_"+t:null}).html(m).appendTo(c),Za(u,{action:t},q),h++)}},E;try{E=b(c).find(d.activeElement).data("dt-idx")}catch(u){}y(b(c).empty(),p);E&&b(c).find("[data-dt-idx="+E+
"]").focus()}}});b.extend(C.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return bb(a,c)?"num"+c:null},function(a){if(!(!a||a instanceof Date||Pb.test(a)&&Qb.test(a)))return null;var b=Date.parse(a);return null!==b&&!isNaN(b)||oa(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return bb(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Fb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Fb(a,c,!0)?"html-num-fmt"+c:null},function(a){return oa(a)||
"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);b.extend(C.ext.type.search,{html:function(a){return oa(a)?a:"string"===typeof a?a.replace(Cb," ").replace(Oa,""):""},string:function(a){return oa(a)?a:"string"===typeof a?a.replace(Cb," "):a}});var Na=function(a,b,c,f){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Eb(a,b));a.replace&&(c&&(a=a.replace(c,"")),f&&(a=a.replace(f,"")));return 1*a};b.extend(Z.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return oa(a)?
"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return oa(a)?"":"string"===typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});gb("");b.extend(!0,C.ext.renderer,{header:{_:function(a,c,f,d){b(a.nTable).on("order.dt.DT",function(b,p,e,g){a===p&&(b=f.idx,c.removeClass(f.sSortingClass+" "+d.sSortAsc+" "+d.sSortDesc).addClass("asc"==g[b]?d.sSortAsc:"desc"==g[b]?d.sSortDesc:
f.sSortingClass))})},jqueryui:function(a,c,f,d){b("<div/>").addClass(d.sSortJUIWrapper).append(c.contents()).append(b("<span/>").addClass(d.sSortIcon+" "+f.sSortingClassJUI)).appendTo(c);b(a.nTable).on("order.dt.DT",function(b,p,e,g){a===p&&(b=f.idx,c.removeClass(d.sSortAsc+" "+d.sSortDesc).addClass("asc"==g[b]?d.sSortAsc:"desc"==g[b]?d.sSortDesc:f.sSortingClass),c.find("span."+d.sSortIcon).removeClass(d.sSortJUIAsc+" "+d.sSortJUIDesc+" "+d.sSortJUI+" "+d.sSortJUIAscAllowed+" "+d.sSortJUIDescAllowed).addClass("asc"==
g[b]?d.sSortJUIAsc:"desc"==g[b]?d.sSortJUIDesc:f.sSortingClassJUI))})}}});C.render={number:function(a,b,c,f,d){return{display:function(p){if("number"!==typeof p&&"string"!==typeof p)return p;var e=0>p?"-":"",g=parseFloat(p);if(isNaN(g))return p;p=Math.abs(g);g=parseInt(p,10);p=c?b+(p-g).toFixed(c).substring(2):"";return e+(f||"")+g.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+p+(d||"")}}},text:function(){return{display:function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;"):a}}}};b.extend(C.ext.internal,{_fnExternApiFunc:Bb,_fnBuildAjax:ka,_fnAjaxUpdate:na,_fnAjaxParameters:ra,_fnAjaxUpdateDraw:Ca,_fnAjaxDataSrc:ta,_fnAddColumn:k,_fnColumnOptions:r,_fnAdjustColumnSizing:n,_fnVisibleToColumnIndex:u,_fnColumnIndexToVisible:f,_fnVisbleColumns:x,_fnGetColumns:A,_fnColumnTypes:F,_fnApplyColumnDefs:L,_fnHungarianMap:a,_fnCamelToHungarian:g,_fnLanguageCompat:m,_fnBrowserDetect:t,_fnAddData:z,_fnAddTr:H,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==e?b._DT_RowIndex:
null},_fnNodeToColumnIndex:function(a,c,f){return b.inArray(f,a.aoData[c].anCells)},_fnGetCellData:w,_fnSetCellData:I,_fnSplitObjNotation:P,_fnGetObjectDataFn:G,_fnSetObjectDataFn:B,_fnGetDataMaster:M,_fnClearTable:N,_fnDeleteIndex:Q,_fnInvalidate:O,_fnGetRowElements:J,_fnCreateTr:D,_fnBuildHead:v,_fnDrawHead:y,_fnDraw:E,_fnReDraw:R,_fnAddOptionsHtml:T,_fnDetectHeader:U,_fnGetUniqueThs:ca,_fnFeatureHtmlFilter:Ba,_fnFilterComplete:pa,_fnFilterCustom:Ga,_fnFilterColumn:Fa,_fnFilter:nb,_fnFilterCreateSearch:Ua,
_fnEscapeRegex:Ha,_fnFilterData:ob,_fnFeatureHtmlInfo:lb,_fnUpdateInfo:rb,_fnInfoMacros:sb,_fnInitialise:xa,_fnInitComplete:Da,_fnLengthChange:Va,_fnFeatureHtmlLength:ib,_fnFeatureHtmlPaginate:mb,_fnPageChange:Xa,_fnFeatureHtmlProcessing:jb,_fnProcessingDisplay:fa,_fnFeatureHtmlTable:kb,_fnScrollDraw:va,_fnApplyToChildren:la,_fnCalculateColumnWidths:Ra,_fnThrottle:Ea,_fnConvertToWidth:tb,_fnGetWidestNode:ub,_fnGetMaxLenString:vb,_fnStringToCss:Y,_fnSortFlatten:sa,_fnSort:hb,_fnSortAria:xb,_fnSortListener:Ya,
_fnSortAttachListener:Sa,_fnSortingClasses:Ja,_fnSortData:wb,_fnSaveState:Ka,_fnLoadState:yb,_fnSettingsFromNode:La,_fnLog:ma,_fnMap:ia,_fnBindAction:Za,_fnCallbackReg:da,_fnCallbackFire:V,_fnLengthOverflow:Wa,_fnRenderer:Ta,_fnDataSource:ba,_fnRowAttributes:p,_fnCalculateEnd:function(){}});b.fn.dataTable=C;C.$=b;b.fn.dataTableSettings=C.settings;b.fn.dataTableExt=C.ext;b.fn.DataTable=function(a){return b(this).dataTable(a).api()};b.each(C,function(a,c){b.fn.DataTable[a]=c});return b.fn.dataTable});window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(b){return function(){var h={};return{check_message:function(d){var e,a;if(d.is_box())if(e=d.get_size(),1>e)d.display_message("Function birds can only respond to boxes with holes.");else if(a=d.get_hole_contents(0)){if(a.is_bird())return{box_size:e,bird:a};d.display_message("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+b.UTILITIES.add_a_or_an(a.get_type_name()+"."))}else d.display_message("Function birds can only respond to boxes with something in the first hole.");
else d.display_message("Function birds can only respond to boxes. One was given "+b.UTILITIES.add_a_or_an(d.get_type_name()))},process_response:function(b,e,a,g,m){b&&e.widget_side_dropped_on_me(b,void 0,m,!0,!0);a.remove(void 0,!0)},process_message:function(b,e,a,g){var m=this.check_message(b);if(m)return e=e(m.bird,m.box_size),1<b.get_size()&&b.get_hole_contents(1).remove(a,!0),this.process_response(e,m.bird,b,a,g),e},type_check:function(d,e,a,g){if(!d)return!0;if(!e)return b.UTILITIES.display_message("Birds for the "+
a+" function can only respond to boxes with "+b.UTILITIES.add_a_or_an(d)+" in the "+b.UTILITIES.ordinal(g)+" hole. The "+b.UTILITIES.ordinal(g)+" hole is empty."),!1;if(e.dereference().is_of_type(d))return!0;if(e.is_nest())throw{wait_for_nest_to_receive_something:e};e.display_message("Birds for the "+a+" function can only respond to boxes with "+b.UTILITIES.add_a_or_an(d)+" in the "+b.UTILITIES.ordinal(g)+" hole. The "+b.UTILITIES.ordinal(g)+" hole contains "+b.UTILITIES.add_a_or_an(e.get_type_name()+
"."));return!1},number_check:function(b,e,a){return this.type_check("number",b,e,a)},n_ary_widget_function:function(b,e,a,g,m,l){var c=function(c,l){var k,m,n,h;if(1===l)return e();m=1;n=b.get_hole_contents(m).dereference();if(h=this.number_check(n,g,m)){for(m++;m<l;){k=b.get_hole_contents(m).dereference();h=this.number_check(k,g,m);if(!h)return;a.call(n,k);m++}return n}}.bind(this);return this.process_message(b,c,m,l)},n_ary_function:function(b,e,a,g,m,l){var c=function(c,l){var k,m,n,h,f;if(l<a+
1)b.display_message("Birds for the "+g+" function can only respond to boxes with at least "+(a+1)+" holes. Not "+l+" holes.");else{n=[];for(m=1;m<l;){k=b.get_hole_contents(m).dereference();h=this.number_check(k,g,m);if(!h)return;k.get_approximate&&k.get_approximate()&&(f=!0);n.push(k.get_value());m++}k=e.apply(null,n);f&&(k.set_approximate(!0),k.set_format("decimal"));return k}}.bind(this);return this.process_message(b,c,m,l)},typed_bird_function:function(b,e,a,g,m,l,c){var h=function(c,l){var h,
n,u,f;if(0<=g&&l!=g+1)b.display_message("Birds for the "+m+" function can only respond to boxes with "+(g+1)+" holes. Not "+l+" holes.");else{u=[];for(n=1;n<l;){h=b.get_hole_contents(n).dereference();n<=a.length&&(f=a[n-1]);if(!this.type_check(f,h,m,n))return;u.push(h);n++}return e.apply(b,u)}}.bind(this);return this.process_message(b,h,l,c)},numeric_javascript_function_to_widget_function:function(d,e,a){return function(){var g=b.number.ZERO(b.number.function_bird_results_default_format);g.set_value_from_decimal(d.apply(null,
b.UTILITIES.map_arguments(arguments,a||bigrat.toDecimal)));e&&(g.set_approximate(!0),g.set_format("decimal"));return g}},bigrat_function_to_widget_function:function(d,e){return function(){var a=b.number.create_from_bigrat(d.apply(null,arguments));e&&e(arguments)&&(a.set_approximate(!0),a.set_format("decimal"));return a}},add_function_object:function(d,e,a,g,m){h[d]={name:d,short_name:g||d,respond_to_message:e,get_description:m?1===m.length?function(){return"If you give me a box with another bird and "+
b.UTILITIES.add_a_or_an(m[0])+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+b.UTILITIES.conjunction(m,!0)+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."},
toString:function(){return b.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:a}},get_function_table:function(){return h}}}}(window.TOONTALK);window.TOONTALK.widget=function(b){var h=function(b){if(b=this.get_frontside&&this.get_frontside(b))return b.get_element()};b.creators_from_json.top_level=function(d){d=b.widget.create_top_level_widget(d.settings);d.get_backside(!0);return d};return{add_standard_widget_functionality:function(d){var e=function(){return!1},a;this.add_sides_functionality(d);this.runnable(d);this.stackable(d);this.animatable(d);this.has_title(d);this.has_parent(d);this.has_backside_widgets(d);this.has_description(d);
this.has_listeners(d);this.droppable(d);this.erasable(d);d.this_and_walk_children=function(a){a(d)&&d.walk_children&&d.walk_children(a)};d.top_level_widget=function(){var d;if(a)return a;if(this.is_top_level())return this;if(a=b.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")))return a=a.get_widget();if(d=this.get_parent_of_frontside()||this.get_parent_of_backside())return a=d.get_widget().top_level_widget();d=$(".toontalk-backside-of-top-level");
if(0<d.length)return a=b.UTILITIES.widget_side_of_element(b.UTILITIES.closest_element(d,$(this.get_frontside_element()).offset())).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return a=this.create_top_level_widget()};d.is_of_type||(d.is_of_type=function(a){return this.get_type_name()===a});d.dereference||(d.dereference=function(){return this});d.get_default_description||(d.get_default_description=function(){return b.UTILITIES.add_a_or_an(this.get_type_name())+
"."});d.is_number||(d.is_number=e);d.is_box||(d.is_box=e);d.is_empty_hole||(d.is_empty_hole=e);d.is_hole||(d.is_hole=e);d.is_scale||(d.is_scale=e);d.is_bird||(d.is_bird=e);d.is_nest||(d.is_nest=e);d.is_robot||(d.is_robot=e);d.is_element||(d.is_element=e);d.is_sensor||(d.is_sensor=e);d.is_function_nest||(d.is_function_nest=e);d.is_plain_text_element||(d.is_plain_text_element=e);d.is_attribute_widget||(d.is_attribute_widget=e);d.maintain_proportional_dimensions||(d.maintain_proportional_dimensions=
e);d.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};d.set_name&&(d.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});d.get_width||(d.get_width=function(){return b.UTILITIES.get_element_width(d.get_frontside_element())});d.get_height||(d.get_height=function(){return b.UTILITIES.get_element_height(d.get_frontside_element())});!b.debugging&&!b.logging||d.to_debug_string||(d.to_debug_string=function(a){var b=this.get_parent_widget_of_frontside(),
d=this._debug_id,c=this.get_description(),c=c?c+" ":"";d||(d=b&&b.id?"id of parent is "+b.id:"");c&&(c+=" ");return(this.toString({plain_text:!0})+" ("+c+(this.get_name&&this.get_name()+" "||"")+d+")").substring(0,a)});d.is_top_level=e;d.is_widget=!0},erasable:function(b){var e;b.get_erased||(b.get_erased=function(){return e});b.set_erased||(b.set_erased=function(a,b){e=a;b&&this.rerender()})},add_sides_functionality:function(d){var e,a,g;d.get_frontside||(d.get_frontside=function(a){a&&!e&&(e=b.frontside.create(d));
return e},d.save_dimensions=function(){return this.save_dimensions_of(this)},d.save_dimensions_of=function(a){var b;if(a.is_element()){if(!this.get_original_width())return;b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0},d.restore_dimensions=function(){var a,d;0<this.saved_width&&(a=this.get_frontside_element(!0),this.ok_to_set_dimensions()?this.use_scaling_transform?
this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):b.UTILITIES.set_css(a,{width:this.saved_width,height:this.saved_height}):(d={width:"",height:""},b.UTILITIES.set_css_transform(d,""),b.UTILITIES.set_css(a,d)),this.saved_height=this.saved_width=void 0)});d.get_backside||(d.get_backside=function(b){b&&!a&&(a=this.create_backside(),this.backside_widgets_json_views&&a.add_backside_widgets(this.get_backside_widgets(),
this.backside_widgets_json_views));return a});d.set_backside||(d.set_backside=function(b){a=b});d.forget_backside||(d.forget_backside=function(){var b;if(a){if(b=a.get_element())$(b).remove(),b.toontalk_widget_side=void 0;a=void 0}});d.create_backside||(d.create_backside=function(){return b.backside.create(d)});d.get_open_backside_only_if_stopped||(d.get_open_backside_only_if_stopped=function(){return g});d.set_open_backside_only_if_stopped||(d.set_open_backside_only_if_stopped=function(a){g=a})},
runnable:function(d){var e=!1,a=!1;d.get_running||(d.get_running=function(a){var b=!1;if(a)return e;if(e)if(a=this.get_backside_widgets(),0===a.length)e=!1;else for(a.some(function(a){if(a&&(a=a.get_widget(),a.get_running()))return b=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return b});d.is_ok_to_run||(d.is_ok_to_run=function(){return a},d.set_ok_to_run=function(b){a=
b});d.set_running||(d.set_running=function(g,m,l){var c=e===g,h,q;a=g;h=this.get_backside_widgets();e=g;this.get_backside()&&!c&&this.get_backside().run_status_changed(e);b.UTILITIES.for_each_batch(h,function(a){a&&(q=a.get_widget(),a.is_backside()&&(0<=this.get_backside_widgets().indexOf(q)||!a.is_primary_backside())||(!q.is_robot()||q.being_trained||q.get_body().is_empty()?q.set_running&&(!m&&a.is_backside()&&"top-level"!==d.get_type_name()?q.set_running(g,d,!0):q.set_running(g)):e?(q.set_stopped(!1),
q.run(d,l,m),q.set_ok_to_run(!0)):(q.set_stopped(!0),q.set_running(!1)),q.rerender()))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(e);return!0});this.is_robot()&&(e?d.get_parent_of_backside()&&(this.set_stopped(!1),this.run(d.get_parent_of_backside().get_widget())):this.set_stopped(!0));c||this.rerender()})},droppable:function(b){b.drop_on||(b.drop_on=function(b,a,d){if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,a,d);console.log("No handler for drop of '"+
this+"' on '"+b+"'")})},stackable:function(b){var e=!1;b.get_infinite_stack||(b.get_infinite_stack=function(){return e});b.set_infinite_stack||(b.set_infinite_stack=function(a){var g=b.get_backside_element(),m=b.get_frontside_element();e=a;g&&$(g).find(".toontalk-infinite-stack-check-box").prop("checked",a);m&&(a?$(m).addClass("toontalk-infinite-stack"):$(m).removeClass("toontalk-infinite-stack"))})},animatable:function(d){var e;d.animate_to_widget||(e=function(a,d){var e=a.get_element();e&&(a.is_backside()||
b.UTILITIES.visible_element(e))||(e=b.UTILITIES.find_resource_equal_to_widget(a,d));return e},d.animate_to_widget=function(a,b,d,l,c,h,q,k){var r=function(){this.animate_to_element(e(a,k),b,d,l,c,h,q&&Math.max(0,q-100));this.rerender()}.bind(this);0===q?r():setTimeout(r,100)});d.animate_to_element||(d.animate_to_element=function(a,d,e,l,c,h,q){var k=$(a).offset(),r=this.get_frontside_element(),n=$(a).is(".toontalk-backside");if(a&&b.UTILITIES.visible_element(a)&&0!==e){if("number"===typeof a.animation_left_offset)l=
a.animation_left_offset;else if("undefined"===typeof l||n)l=(b.UTILITIES.get_element_width(a)-b.UTILITIES.get_element_width(r))*Math.random();if("number"===typeof a.animation_top_offset)c=a.animation_top_offset;else if("undefined"===typeof c||n)c=(b.UTILITIES.get_element_height(a)-b.UTILITIES.get_element_height(r))*Math.random();k?(k.left+=l,k.top+=c):k={left:0,top:0};this.animate_to_absolute_position(k,d,e,h,q)}else d&&d()});d.animate_to_absolute_position||(d.animate_to_absolute_position=function(a,
d,e,l,c){b.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),a,d,e,l,c)})},has_title:function(d){d.get_title||(d.get_title=function(){var d=this.get_type_name(),a=this.get_backside(),g=this.get_frontside_element(),m=this.get_description(),l="";$(g).is(".toontalk-top-level-resource")?l=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":
a&&a.get_element()&&b.UTILITIES.visible_element(a.get_element())||(l=this.can_run&&this.can_run(!0)?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my backside and then click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
".":"Click to see my backside.");m&&(m="I'm "+m,l=l?m+"\n"+l:m);if(this.get_erased())return this.get_title_of_erased_widget();l=this.get_custom_title_prefix&&!$(g).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+l:"I'm "+b.UTILITIES.add_a_or_an(d)+". "+l;l=l.trim();0>".?!".indexOf(l[l.length-1])&&(l+=".");return l});d.update_title=function(){var d=this.get_frontside_element();d&&b.UTILITIES.give_tooltip(d,this.get_title())}},inside_conditions_container:function(){return $(this.get_frontside_element()).closest(".toontalk-conditions-container").is("*")},
get_title_of_erased_widget:function(){var b=this.get_type_name();return this.inside_conditions_container()?"I'm an erased "+b+".\nI'll match with any other "+b+".":"I'm an erased "+b+".\nDusty the Vacuum can restore me to normal."},has_parent:function(d){var e=[],a,g,m,l;d.get_parent_of_frontside=function(){return m&&a?a.get_backside(!0):a};d.get_parent_widget_of_frontside=function(){return a};d.get_containing_widget=function(){return a&&a.is_hole()?a.get_parent_widget_of_frontside():this.get_parent_of_frontside()||
this};d.parent_of_frontside_is_backside=function(){return m};d.set_parent_of_frontside=function(b,d,g){var l=a;m=d;a!==b&&(a=b,l&&!g&&!d&&l.is_backside()&&l.get_widget().remove_backside_widget(this,!0),e.forEach(function(b){b(l,a)}))};d.add_parent_of_frontside_change_listener=function(a){e.push(a)};d.remove_parent_of_frontside_change_listener=function(a){a=e.indexOf(a);0<=a&&e.splice(a,1)};d.get_parent_of_backside=function(){return l&&g?g.get_backside(!0):g};d.set_parent_of_backside=function(a,b,
d){void 0===a&&!d&&l&&g&&g.get_widget().remove_backside_widget(this.get_backside(),!0);g=a;l=b};d.parent_of_backside_is_backside=function(){return l};d.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};d.closest_visible_ancestor_or_frontside=function(){for(var a=this,d;a&&!b.UTILITIES.visible_element(a.get_frontside_element());)d=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=d.get_widget()):
a=a.get_parent_of_frontside();return a||this};d.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};d.has_ancestor=function(a){var b;return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};d.remove_from_parent_of_frontside=function(b){a&&(a.is_backside()?a.remove_backside_widget(this,!b):a.removed_from_container?m?a.remove_backside_widget(this,!0):a.removed_from_container(this,
b):a.get_backside()&&a.remove_backside_widget(this,!b))}},has_description:function(b){var e;b.get_description||(b.get_description=function(){return e});b.set_description||(b.set_description=function(a,b){if(e===a||!e&&""===a)return!1;e=a;b&&this.rerender();return!0});b.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},has_name:function(b){var e;b.get_name||(b.get_name=function(){"string"!==typeof e&&b.generate_name&&
(e=b.generate_name());return e});b.set_name||(b.set_name=function(a,b){if(e===a||"string"!==typeof a)return!1;e=a;b&&this.rerender();return!0})},has_listeners:function(d){var e={};d.add_listener||(d.add_listener=function(a,b){var d=e[a];d?0>d.indexOf(b)&&d.push(b):e[a]=[b]});d.remove_listener||(d.remove_listener=function(a,d,m){if(a=e[a])if(d=a.indexOf(d),0<=d){a.splice(d,1);return}!m&&b.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});d.get_listeners||(d.get_listeners=
function(a){return e[a]})},get_full_description:function(b){var e;if(this.get_erased&&this.get_erased())return b&&"conditions"===b.role?"any "+this.get_type_name():"erased "+this.get_type_name();e=this.get_description(b);b=this.toString(b);return e?b+" ("+e+")":b},remove:function(b,e){var a=this.get_backside(),g=this.get_frontside(),m=this.get_parent_of_frontside();a&&this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level()&&a.hide_backside();g&&g.remove();m&&this.remove_from_parent_of_frontside(b);
this.get_running()&&this.set_running(!1);this.set_visible(!1);this.walk_children&&!e&&this.walk_children(function(a){a.remove&&a.remove();return!0})},get_frontside_element:h,get_element:h,get_backside_element:function(b){if(b=this.get_backside&&this.get_backside(b))return b.get_element()},add_to_json:function(d,e){var a,g,m,l,c,h;if(d){d.view?(g=d,a=d.view,d=d.semantic):(a={},g={semantic:d,view:a});g.version=1;this.get_erased&&this.get_erased()&&(d.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&
(d.infinite_stack=!0);this.get_open_backside_only_if_stopped&&this.get_open_backside_only_if_stopped()&&(d.open_backside_only_if_stopped=!0);this.get_running&&this.get_running()&&(d.running=!0);c=this.get_parent_widget_of_frontside();if(!c||this.parent_of_frontside_is_backside()||c.is_element())if(l=this.get_frontside_element&&this.get_frontside_element())if(h=$(l).width(),$(l).is(".toontalk-plain-text-element")||0===h||(a.frontside_width=$(l).width(),a.frontside_height=$(l).height()),0!==h&&(a.frontside_left=
b.UTILITIES.get_style_numeric_property(l,"left"),a.frontside_top=b.UTILITIES.get_style_numeric_property(l,"top")||m&&m.frontside_top,void 0===a.frontside_left&&(m=c&&c.get_widget().get_backside_widgets_json_views())))l=this.get_parent_of_frontside().get_widget().get_backside_widgets().indexOf(this),0<=l&&(a.frontside_left=m[l].frontside_left,a.frontside_top=m[l].frontside_top);if(l=this.get_backside()){if(c=l.get_element()){if(l.get_backside_dimensions()||l.is_top_level())a.backside_width=$(c).width(),
a.backside_height=$(c).height();a.backside_left||(m=$(c).position(),a.backside_left=m.left,a.backside_top=m.top,"&lt;"===$(c).find(".toontalk-settings-backside-button").html()&&(a.advanced_settings_open=!0))}l.get_backside_dimensions()&&(a.backside_geometry=l.get_backside_dimensions())}!a.backside_geometry&&this.backside_geometry&&(a.backside_geometry=this.backside_geometry);void 0===a.frontside_left&&this.json_view&&(a.frontside_left=this.json_view.frontside_left,a.frontside_top=this.json_view.frontside_top);
d.description=this.get_description&&this.get_description();a.saved_width=this.saved_width;a.saved_height=this.saved_height;return g}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(d,e,a,g){var m=this.get_backside_widgets(),l,c;0<m.length?(d.semantic.backside_widgets=[],(l=this.get_backside_widgets_json_views())&&l.forEach(function(a,b){var g;if(c=d.semantic.backside_widgets[b]){if(0<=c.widget.shared_widget_index){g=e.widgets_encountered.indexOf(e.shared_widgets[c.widget.shared_widget_index]);
if(!e.json_of_widgets_encountered[g])return;g=e.json_of_widgets_encountered[g].view}else g=c.widget.view;c.is_backside?a.backside_left&&(g.backside_left=a.backside_left,g.backside_top=a.backside_top):a.frontside_left&&(g.frontside_left=a.frontside_left,g.frontside_top=a.frontside_top)}else m[b].json_view=l[b]}),b.UTILITIES.get_json_of_array(m,d.semantic.backside_widgets,0,e,a,g)):a()},has_backside_widgets:function(d){var e=[];d.get_backside_widgets=function(){return e};d.add_backside_widget=function(a){var d;
if(a){d=this.get_backside(!0);if(b.debugging){if(a===this){b.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");return}if(a.get_widget()===this){b.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}e?0>e.indexOf(a)&&e.push(a):e=[a];b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Added "+a+" to backside widgets of "+this+". Number of backside widgets is "+e.length);a.is_backside()?a.set_parent_of_backside(d,
!0):a.set_parent_of_frontside(this,!0);d.visible()&&a.set_visible(!0)}else b.debugging&&b.UTILITIES.report_internal_error("adding undefined to backside widgets.")};d.remove_all_backside_widgets=function(){e&&b.UTILITIES.for_each_batch(e.slice(),function(a){a.remove()})};d.remove_backside_widget=function(a,d){var m=e.indexOf(a);0>m?d||b.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+a.get_widget()+" ("+a.get_widget()._debug_id+")"):(e.splice(m,1),b.logging&&
0<=b.logging.indexOf("backside-widgets")&&console.log("Removed "+a+" from backside widgets of "+this+". Number of backside widgets is "+e.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(m,1),a.is_backside()?(m=a.get_parent())&&m.get_widget()===this&&a.set_parent_of_backside(void 0,!0,!0):(m=a.get_parent_of_frontside())&&m.get_widget()===this&&a.set_parent_of_frontside(void 0,void 0,!0),a.set_visible(!1))};d.set_backside_widgets=function(a,d){var m=this.get_backside(),
l=m&&m.visible();e=a;b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Set backside widgets "+e.length+" widgets of "+(l?"visible ":"invisible ")+this);0<e.length&&(m?m.add_backside_widgets(e,d):this.backside_widgets_json_views=d,b.UTILITIES.for_each_batch(e,function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),l&&a.set_visible(l))}.bind(this)))}},get_backside_widgets_json_views:function(b){!this.backside_widgets_json_views&&b&&(this.backside_widgets_json_views=
[]);return this.backside_widgets_json_views},can_run:function(){var b=!1,e;this.get_backside_widgets().some(function(a){if(!a)return!1;e=a.get_widget();if(e.get_body&&!e.get_body().is_empty()||e.can_run())return b=!0});this.walk_children&&this.walk_children(function(a){if(a.can_run())b=!0;else return!0});return b},add_to_copy:function(d,e){var a;this.get_erased&&this.get_erased()&&(d.set_erased||b.widget.erasable(d),d.set_erased(this.get_erased()));e&&e.just_value||(a=this.get_backside_widgets(),
0<a.length&&d.set_backside_widgets(b.UTILITIES.copy_widget_sides(a,e),this.get_backside_widgets_json_views()));d.set_running(this.get_running());return d},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(d,e,a){var g=this.visible(),m,l,c,h,q;d||(d=this.copy({}));m=this.get_frontside_element(g);l=d.get_element(g);c=$(m).closest(".toontalk-backside");h=d.ok_to_set_dimensions();0===c.length&&(c=$(this.top_level_widget().get_backside_element()));
q=b.UTILITIES.widget_side_of_jquery(c);g&&("undefined"===typeof e&&(e=30),"undefined"===typeof a&&(a=30),g=b.UTILITIES.relative_position(m,c.get(0)),0<c.length&&c.get(0).appendChild(l),b.UTILITIES.set_css(l,{width:h?$(m).width():"",height:h?$(m).height():"",left:g.left+e,top:g.top+a,"z-index":b.UTILITIES.next_z_index()}));q&&q.add_backside_widget(d);return d},visible:function(){var b;return document.hidden?!1:(b=this.get_frontside())?b.visible():!1},set_visible:function(b){var e=this.get_frontside(b);
e&&e.set_visible(b)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(b){this.set_parent_of_frontside(b)},drag_started:function(b,e){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,e)},match:function(b){console.assert(!1,"match not implemented for "+b.toString())},removed:function(d){b.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(d){var e=
this.get_backside(),a,g,m,l,c,h,q,k,r,n,u;if(e&&b.UTILITIES.visible_element(e.get_element()))$(e.get_element()).css({opacity:1}),d&&d();else{a=d&&function(){setTimeout(d)};g=function(c,d){b.UTILITIES.set_timeout(function(){$(c).addClass("toontalk-side-appearing");b.UTILITIES.add_one_shot_event_handler(c,"transitionend",2500,function(){$(c).removeClass("toontalk-side-appearing");a&&a()});$(c).css({left:q,top:k,opacity:d});this.apply_backside_geometry()}.bind(this))}.bind(this);l=this.get_frontside_element();
c=$(l).parent();for(e=$(l);0<c.length&&!c.is(".toontalk-backside");)e=c,c=c.parent();e.get(0);e=this.get_backside(!0);m=e.get_element();m.toontalk_widget_side=e;r=$(l).offset();n=c.offset();u=c.width();n||(n={left:0,top:0});$(m).css({left:r.left-n.left,top:r.top-n.top,opacity:.01});0<c.length?c.get(0).appendChild(m):($(m).css({textAlign:"left"}),l.appendChild(m));(c=b.UTILITIES.widget_side_of_jquery(c))&&c.add_backside_widget(e);c=this.is_element()?this.get_attribute("height"):$(l).height();l=$(m).width();
q=r.left-n.left;q+l>u&&(q=Math.max(0,u-l));k=r.top-n.top+c+34;this.is_box()&&(k+=28);g(m,"inherit");e.set_visible(!0);h=this.get_backside_widgets();0<h.length&&h.forEach(function(a){a.is_backside()&&0<=h.indexOf(a.get_widget())?a.hide_backside():(a.set_visible(!0),m.appendChild(a.get_element(!0)))}.bind(this));return e}},hide_backside:function(){var b=this.get_backside();b&&b.hide_backside()},apply_backside_geometry:function(){var b=this.get_backside(!0),e=b.get_element();this.backside_geometry&&
e&&(b.scale_backside(e,this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),b.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(b){this.top_level_widget().robot_started_training(b)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},
backup_all:function(b){var e=this.top_level_widget();e&&e.save(b)},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},location_constrained_by_container:function(){var b;return this.is_nest()||this.being_dragged?!1:(b=this.get_parent_of_frontside())&&(b.is_hole()||b.is_nest()||b.is_robot())?!0:!1},close_button_ok:function(b){return"top-level"!==this.get_type_name()&&!$(b).is(".toontalk-top-level-resource")&&
!$(b).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(b,e){var a=this.top_level_widget(),g;b||(b=this);g=b.get_element(!0);a.add_backside_widget(b);a.get_backside_element().appendChild(g);b.render();e&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,a);return g},get_selection:function(){return this},display_message:function(d,e){e?b.UTILITIES.display_message(d,this.get_backside_element(),this.get_frontside_element()):
b.UTILITIES.display_message(d,this.get_frontside_element())},get_speak_function:function(d){return function(e,a,g){a=function(a){var r,n;if(a){if(!window.speechSynthesis)return a.display_message("This browser doesn't support speech output. Try another browser such as Chrome."),!0;a=a.get_widget();r=a.get_text?a.get_text(!0):a.toString();b.TRANSLATION_ENABLED?b.UTILITIES.translate(r,function(a){n=function(c){var l=b.element.create(a,[],"a response to speaking '"+r+"'");d.process_response(l,m.bird,
e,c,g)};b.UTILITIES.speak(a,n,l,c,h,q)}):(n=function(a){var c=b.element.create(r,[],"a response to speaking '"+r+"'");d.process_response(c,m.bird,e,a,g)},b.UTILITIES.speak(r,n,l,c,h,q))}else b.UTILITIES.display_message("Speaking birds need something in the second box hole.")};var m=d.check_message(e),l,c,h,q;if(m)if(2>m.size)b.UTILITIES.display_message("Speaking birds need a box with two or more holes.");else return(l=e.get_hole_contents(2))&&(l=l&&l.to_float&&l.to_float()),(c=e.get_hole_contents(3))&&
(c=c&&c.to_float&&c.to_float()),(h=e.get_hole_contents(4))&&(h=h&&h.to_float&&h.to_float()),(q=e.get_hole_contents(5))&&(q=q&&q.to_float&&q.to_float()),a(e.get_hole_contents(1)),!0}},get_description_function:function(d){return function(e,a,g){var m=function(c){var m,h;c?(h=function(k){k=b.element.create(k,[],c.toString());d.process_response(k,l.bird,e,a,g)},c=c.get_widget(),m=c.get_text?c.get_text(!0):c.toString(),b.TRANSLATION_ENABLED?b.UTILITIES.translate(m,function(a){h(a)}):h(m)):b.UTILITIES.display_message("Description birds need something in the second box hole.")},
l=d.check_message(e);if(l)if(2>l.size)e.display_message("Description birds need a box with two holes containing a bird and a widget.");else return m(e.get_hole_contents(1)),!0}},create_top_level_widget:function(d){var e=Object.create(b.widget),a=[],g=function(){return!1},m=!1;d||(d={});e.is_top_level=function(){return!0};e.is_number=g;e.is_box=g;e.is_empty_hole=g;e.is_scale=g;e.is_bird=g;e.is_nest=g;e.is_robot=g;e.is_element=g;e.is_sensor=g;e.is_function_nest=g;e.is_hole=g;e.is_plain_text_element=
g;e.is_attribute_widget=g;e.ok_to_set_dimensions=g;e.get_json=function(a,b,e){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");b({semantic:{type:"top_level",settings:d},view:{background_color:a}},e)};e.get_type_name=function(){return"top-level"};e.is_of_type=function(a){return"top-level"===a};e.toString=function(){return"top level widget"};e.get_description=function(){};e.match=function(){return"matched"};e.update_display=function(){this.get_backside_widgets()&&
b.UTILITIES.for_each_batch(this.get_backside_widgets().filter(function(a){return a&&a.visible()}),function(a){a.render()})};e.copy=function(){return this};e.visible=function(){return!document.hidden};e.get_parent_of_frontside=function(){};e.get_parent_of_backside=function(){};e.closest_visible_ancestor=function(){return this};e.get_infinite_stack=function(){return!1};e.top_level_widget=function(){return this};if(b.debugging||b.logging)e.to_debug_string=function(a){var b=$(this.get_backside_element()).offset();
return("top-level widget at "+Math.round(b.left)+", "+Math.round(b.top)).substring(0,a)};e.add_sides_functionality(e);e.runnable(e);e.has_parent(e);e.has_backside_widgets(e);e.removed_from_container=function(a,b){this.robot_in_training()||this.remove_backside_widget(a,!0)};e.widget_side_dropped_on_me=function(a,b,d,e){return this.get_backside().widget_side_dropped_on_me(a,b,d,e)};e.get_element=function(){return this.get_backside().get_element()};e.get_setting=function(a,c){"undefined"!==typeof d[a]||
c||(d[a]=b.DEFAULT_SETTINGS&&b.DEFAULT_SETTINGS[a]);return d[a]};e.set_setting=function(a,b){d[a]=b};e.open_settings=function(){b.SETTINGS.open(e)};e.robot_in_training=function(){if(0<a.length)return a[a.length-1]};e.robot_training_this_robot=function(){if(1<a.length)return a[a.length-2]};e.robot_started_training=function(b){a.push(b)};e.robot_finished_training=function(){a.pop()};e.save=function(a,c,d){var e=this.get_setting("program_name",b.reset),g=function(a){m=!1;h&&(n=b.google_drive.get_status(),
"Ready"===n?(b.google_drive.upload_file(e,"json",JSON.stringify(a,b.UTILITIES.clean_JSON),d),d=void 0):b.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===n?(b.UTILITIES.display_message_if_new("Unable to save to your Google Drive because you need to log in. Click on the settings icon <span class='toontalk-settings-icon'></span> to log in."),b.UTILITIES.display_tooltip($(".toontalk-settings-button"))):console.log("Unable to save to Google Drive because: "+n)));c.local_storage&&
this.save_to_local_storage(a);d&&d()}.bind(this),h,n;!m&&e&&(c||(c={}),"undefined"===typeof c.google_drive&&(c.google_drive=b.google_drive&&this.get_setting("auto_save_to_google_drive")),"undefined"===typeof c.local_storage&&(c.local_storage=this.get_setting("auto_save_to_local_storage")),a?(h=c.google_drive&&!this.get_setting("google_drive_unavailable")&&0>b.TOONTALK_URL.indexOf("http://localhost"))||c.local_storage?(m=!0,b.UTILITIES.get_json_top_level(this,g)):d&&d():setTimeout(function(){this.save(!0,
c,d)}.bind(this),100))};e.publish=function(a,c){b.publish.publish_widget(this.get_setting("program_name"),this,c,a)};e.save_to_local_storage=function(a,c){var d=this.get_setting("program_name"),e=b.UTILITIES.local_storage_program_key(d),g=b.UTILITIES.local_storage_program_meta_data_key(d),m=function(m){n=JSON.stringify(a,b.UTILITIES.clean_json);m||(m={created:c});m.last_modified=c;m.file_size=n.length;b.UTILITIES.store_object(g,m);b.UTILITIES.store_string(e,n);b.UTILITIES.store_string("toontalk-last-key",
e);b.UTILITIES.get_all_locally_stored_program_names(function(a){0>a.indexOf(d)&&(a.push(d),b.UTILITIES.set_all_locally_stored_program_names(a))})},n;c||(c=Date.now());try{b.UTILITIES.retrieve_object(g,m)}catch(h){m=n?"Failed to save state to local storage since it requires "+n.length+" bytes. Error message is "+h:"Error while saving to local storage. Error message is "+h,b.UTILITIES.is_internet_explorer()?console.error("Unresolved difficulties using window.localStorage in IE11: "+m):b.UTILITIES.display_message(m),
this.last_local_storage_error=m}};e.load=function(a,c,d){var g=this.get_setting("program_name"),k=g+".json",m=b.UTILITIES.local_storage_program_key(g),n=function(a){var l;if(a)try{l=JSON.parse(a),e.remove_all_backside_widgets(),b.UTILITIES.add_backside_widgets_from_json(e,l.semantic.backside_widgets,{json_of_shared_widgets:l.shared_widgets,shared_widgets:[],shared_html:l.shared_html}),c&&c()}catch(k){b.UTILITIES.display_message("Error encountered loading "+g+" : "+k)}else d&&d()},h=function(a){a?
b.google_drive.download_file(a,n):b.UTILITIES.retrieve_string(m,n)};a&&b.google_drive&&"Ready"===b.google_drive.get_status()?b.google_drive.get_toontalk_program_file(k,h):b.UTILITIES.retrieve_string(m,n)};e.walk_children=function(){};e.render=function(){};e.location_constrained_by_container=function(){return!1};e.dereference=function(){return this};e.is_widget=!0;b.debugging&&(e._debug_id=b.UTILITIES.generate_unique_id(),e._debug_string="Top-level widget");e.get_backside(!0).set_visible(!0);return e}}}(window.TOONTALK);window.TOONTALK.backside=function(b){var h=function(d){var e=d.get_widget(),a=e.get_backside_widgets(),g=e.get_backside_widgets_json_views(!0);d.get_backside_dimensions();var m=d.get_element();b.UTILITIES.for_each_batch(a,function(a,c){var d=a.get_element(),e;d&&(g[c]||(g[c]={}),a.start_offset&&d.parentElement?(e=b.UTILITIES.relative_position_from_absolute_position(d.parentElement,a.start_offset),a.start_offset=void 0):e=$(d).position(),a.is_backside()?(g[c].backside_left=b.UTILITIES.left_as_percent(e.left,
d),g[c].backside_top=b.UTILITIES.top_as_percent(e.top,d),h(a)):(g[c].frontside_left=b.UTILITIES.left_as_percent(e.left,d,m),g[c].frontside_top=b.UTILITIES.top_as_percent(e.top,d,m)))})};return{create:function(d){var e=Object.create(this),a=document.createElement("div"),g=$(a),m=1,l=1,c=document.createElement("div"),h=document.createElement("div"),q=d.get_help_URL&&d.get_help_URL(),k=function(a){a?($(c).addClass("toontalk-green-flag-active toontalk-button").removeClass("toontalk-green-flag-inactive toontalk-button"),
$(h).addClass("toontalk-stop-sign-inactive toontalk-button").removeClass("toontalk-stop-sign-active toontalk-button")):($(c).addClass("toontalk-green-flag-inactive toontalk-button").removeClass("toontalk-green-flag-active toontalk-button"),$(h).addClass("toontalk-stop-sign-active toontalk-button").removeClass("toontalk-stop-sign-inactive toontalk-button"))},r=this.create_description_label(e,d),n=function(){var a;a=d.get_running()?"To stop this click on the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):
d.can_run()?"Click this to start this running.":"There is nothing to run on this.";b.UTILITIES.give_tooltip(c,a)},u=function(){var a;a=d.get_running()?"Click to stop this from running.":d.can_run()?"This has stopped. Click on the flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";b.UTILITIES.give_tooltip(h,a)},f=function(a){J?(b.UTILITIES.add_iframe_popup(q),a.stopPropagation()):(B.href=q,B.target="_blank")},
x,A,F,L,z,H,w,I,P,G,B,M,N,Q,O,J,D;b.TRANSLATION_ENABLED&&q&&(q=b.UTILITIES.add_URL_parameter(q,"translate","1"));d.close_button_ok(a)&&(N=function(c){var f=function(){d.robot_in_training()&&d.robot_in_training()!==d&&d.robot_in_training().backside_closed(e);e.is_primary_backside()?e.hide_backside(c):e.remove()},l,k;d.get_running()?(l=d.get_backside_widgets(),l.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(f),k=a,!0}),k?(k.add_body_finished_listener(function(){k.visible()?
g.css({opacity:1}):(d.forget_backside(),b.DEFAULT_QUEUE.start());f()}),e.set_visible(!1)):f(),g.css({opacity:1}),g.addClass("toontalk-animating-element"),g.css({opacity:0}),b.UTILITIES.add_one_shot_event_handler(a,"transitionend",2E3,function(){d.forget_backside()})):f();c.stopPropagation()},M=(M=d.get_description())?"the "+d.get_type_name()+" who "+M:"the "+d.get_type_name(),G=b.UTILITIES.create_close_button(N,"Click to remove this backside of "+M+"."),a.appendChild(G));$(c).addClass("toontalk-green-flag toontalk-green-flag-inactive");
c.addEventListener("click",function(a){d.can_run()?(k(!0),d.set_running(!0),u(),b.DEFAULT_QUEUE.start()):d.is_top_level()?b.UTILITIES.display_message("There is nothing to run.",a.target):b.UTILITIES.display_message("This "+d.get_type_name()+" has nothing to run. Add some robots on the back.",a.target);d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-green-flag",d);a.stopPropagation()});c.addEventListener("mouseenter",u);$(h).addClass("toontalk-stop-sign toontalk-stop-sign-active");
h.addEventListener("click",function(a){k(!1);d.set_running(!1);n();d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-stop-sign",d);a.stopPropagation();d.is_top_level()&&b.UTILITIES.stop_audio_objects()});h.addEventListener("mouseenter",n);a.appendChild(c);a.appendChild(h);b.UTILITIES.use_custom_tooltip(c);b.UTILITIES.use_custom_tooltip(h);q&&(J=0>q.indexOf("://"),B=document.createElement(J?"div":"a"),$(B).addClass("toontalk-help-button notranslate toontalk-widget-help-button"),
B.addEventListener("click",f),B.innerHTML="i",B.translate=!1,b.UTILITIES.give_tooltip(B,"Click to learn more about "+d.get_type_name(!0,!0)+"."),a.appendChild(B));r&&a.appendChild(r);d.is_top_level()&&(L=document.createElement("div"),$(L).addClass("toontalk-settings-button"),L.addEventListener("click",function(a){d.open_settings();a.stopPropagation()}),a.appendChild(L),b.UTILITIES.give_tooltip(L,"Click to change settings or open a different program."));g.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+
d.get_type_name());g.css({"z-index":b.UTILITIES.next_z_index()});b.UTILITIES.when_attached(a,function(){var f;e.inside_conditions_container()?($(c).hide(),$(h).hide(),$(B).hide(),$(G).hide(),f="This will match "+e.toString()+".",e.rerender()):d.is_robot()?f="On the back of the robot you can change the conditions and setting of the robot.":d.is_top_level()?f="This is a work area where you can drag things.":(D=d.toString({inside_tool_tip:!0}),f="You are pointing to the back of "+b.UTILITIES.add_a_or_an(D)+
". You can put robots on the back to make it come 'alive'.");b.UTILITIES.give_tooltip(a,f)});e.get_element=function(){return a};e.get_backside_element=function(){return a};e.get_widget=function(){return d};e.visible=function(){return document.hidden?!1:z};e.set_visible=function(a){z=a;!d.is_top_level()&&this.is_primary_backside()&&(this.get_widget().get_backside_widgets().forEach(function(b){b&&b!==this&&b.set_visible(a)}.bind(this)),z&&this.render())};e.get_erased=function(){return x};e.set_erased=
function(a,b,c){if(!a||c||this.inside_conditions_container())x=a,b&&this.rerender()};d.get_backside||(d.get_backside=function(){return e});e.is_primary_backside=function(){return this===this.get_widget().get_backside()};e.inside_conditions_container=function(){return $(this.get_element()).closest(".toontalk-conditions-panel, .toontalk-conditions-container").is("*")};e.get_width=function(){return b.UTILITIES.get_element_width(this.get_element())};e.get_height=function(){return b.UTILITIES.get_element_height(this.get_element())};
e.is_widget=!0;e.get_parent_of_backside=function(){return this.is_primary_backside()?d.get_parent_of_backside():F&&A?A.get_backside(!0):A};e.set_parent_of_backside=function(a,b){!a&&A&&F&&A.remove_backside_widget(this,!0);this.is_primary_backside()&&d.set_parent_of_backside(a,b);A=a;F=b};e.get_parent_of_frontside=function(){return d.get_parent_of_frontside()};e.is_parent_backside=function(){return d.is_parent_backside()};e.get_frontside=function(a){return d.get_frontside(a)};e.get_frontside_element=
function(a){return d.get_frontside_element(a)};e.get_description_text_area=function(){return Q};e.set_description_text_area=function(a){Q=a};e.get_name_text_input=function(){return O};e.set_name_text_input=function(a){O=a};e.removed_from_container=function(a,b,c,f){e.get_widget().robot_in_training()||this.remove_backside_widget(a,f)};e.drop_on=function(a,b,c){return a.widget_side_dropped_on_me&&a.widget_side_dropped_on_me(this,b,c)};e.widget_side_dropped_on_me=function(c,f,e,g){var l,k,n;if(!e||e.visible()||
this.visible())return this.visible()&&(b.sounds&&f&&b.sounds.drop.play(),l=c.get_element(this.visible()),c.rerender(),f?(a.appendChild(l),b.UTILITIES.set_position_is_absolute(l,!0,f)):(e&&(n=$(e.get_frontside_element()).offset()),n||(n=$(l).offset()),a.appendChild(l),!n||0===n.left&&0===n.top||b.UTILITIES.set_absolute_position(l,n))),this.get_widget().is_top_level()&&(e&&!e.visible()&&$(l).addClass("toontalk-widget-added-to-backside-by-unwatched-robot"),!f||c.is_backside()||c.is_sensor()||window.dispatchEvent(b.UTILITIES.create_event("widget added",
{element_widget:l,here:"back"}))),d.robot_in_training()&&!g&&f&&setTimeout(function(){d.robot_in_training().dropped_on(c,this,f)}.bind(this)),c.is_backside()&&c.get_widget().is_element()&&d.is_element()&&(g=c.get_widget(),g.set_backside(void 0),g.remove(f),g.set_backside(c)),this.add_backside_widget(c),c.dropped_on_other&&c.dropped_on_other(this,f,e),f&&c.get_body&&c.get_body().is_empty()&&!c.being_trained?setTimeout(function(){(k=c.open_backside())&&$(k.get_element()).find(".toontalk-train-backside-button").click()}):
f&&!c.is_backside()&&this.get_frontside_element()&&!c.is_sensor()&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:l,where:"back"})),f&&c.get_widget().backup_all(),!c.is_backside()&&c.is_robot()&&this.get_widget().get_running()&&!this.is_top_level()&&this.get_widget().set_running(!0),!0;this.add_backside_widget(c);c.dropped_on_other&&c.dropped_on_other(this,f,e)};e.add_backside_widget=function(a){return this.get_widget().add_backside_widget(a)};e.add_backside_widgets=
function(a,c){var f;0!==a.length&&(b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Adding "+a.length+" backside widgets to "+this),f=a.slice(),b.UTILITIES.set_timeout(function(){var e=this.visible(),g=this.get_element(),l,k,n,m;b.UTILITIES.for_each_batch(f,function(f,h){f&&(b.debugging&&f.get_widget()===d?(b.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),a.splice(h,1)):(c&&(n=c[h]),l=f.get_element(!0),l.parentElement||(g.appendChild(l),b.logging&&0<=
b.logging.indexOf("backside-widgets")&&console.log("Widget element added to backside element.")),l.toontalk_widget_side=f,n&&(f.is_backside()?(k=f.get_widget().get_backside(!0),m={left:n.backside_left,top:n.backside_top,width:n.backside_width,height:n.backside_height},f.get_widget().apply_backside_geometry(),n.advanced_settings_open&&k.set_advanced_settings_showing(!0,k.get_element())):(0===n.frontside_width&&(n.frontside_width=""),0===n.frontside_height&&(n.frontside_height=""),m={left:n.frontside_left,
top:n.frontside_top,width:l.style.transform?"":n.frontside_width||n.saved_width,height:l.style.transform?"":n.frontside_height||n.saved_height}),b.UTILITIES.constrain_css_to_fit_inside(g,m),$(l).css(m)),f.set_visible(e),f.get_widget().rerender()))})}.bind(this),100))};e.get_backside_dimensions=function(){if(1!==m||1!==l)return{x_scale:m,y_scale:l,original_width:H,original_height:w}};e.set_dimensions=function(a){m=a.x_scale;l=a.y_scale;a.original_width&&(H=a.original_width);a.original_height&&(w=a.original_height)};
e.scale_to_fit=function(a,c){var f=b.UTILITIES.scale_to_fit(a,c,550,200);m=f.x_scale;l=f.y_scale};e.scale_to=function(a,c){var f=b.UTILITIES.scale_element(this.get_element(!0),a,c,550,200);m=f.x_scale;l=f.y_scale};e.get_original_width=function(){return H};e.get_original_height=function(){return w};e.run_status_changed=function(a){k(a)};b.UTILITIES.when_attached(a,function(){var f,d,e,g;b.UTILITIES.get_element_width(a);b.UTILITIES.get_element_height(a);f=$(h).width();d=(d=$(G).width())?d+14:0;$(h).css({right:d});
$(c).css({right:d+f+6});e=$(c).width();B&&($(B).css({right:d+f+e+12}),b.UTILITIES.use_custom_tooltip(B));L&&(g=$(B).width()||0,$(L).css({right:d+f+e+g+12}));G&&b.UTILITIES.use_custom_tooltip(G)});e.save_dimensions=function(){I=m;P=l;return!0};e.restore_dimensions=function(){this.get_element();I&&(m=I);P&&(l=P);this.render_current_scale()};e.render_current_scale=function(){this.scale_backside(a,m,l,H,w);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();$(a).find("[title]").each(function(a,
c){b.UTILITIES.use_custom_tooltip(c)})};e.compare_with=function(a){return this.get_widget().compare_with&&this.get_widget().compare_with(a)};if(b.debugging||b.logging)e.to_debug_string=function(a){return("backside of "+this.get_widget().to_debug_string()).substring(0,a)};a.toontalk_widget_side=e;b.UTILITIES.drag_and_drop(a);b.UTILITIES.resizable_and_scalable(a,function(a,b){e.set_dimensions({x_scale:a,y_scale:b});e.render_current_scale()},H,w);a.addEventListener("mouseenter",function(a){a=d.get_frontside();
var c=d.get_parent_of_backside();!a||c&&!c.get_widget().is_top_level()||b.UTILITIES.highlight_element(a.get_element())});a.addEventListener("mouseleave",function(a){d.is_top_level()||b.UTILITIES.remove_highlight()});e.update_display=function(c){var f=this.get_description_text_area(),d=this.get_name_text_input(),g=a.getBoundingClientRect(),l;f&&(l=this.get_widget().get_description())&&(f.button.value=l);d&&(d.button.value=this.get_widget().get_name());this.get_erased()?$(a).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():
$(a).find().show();c&&b.UTILITIES.for_each_batch(this.get_widget().get_backside_widgets().filter(function(a){return!a.get_frontside()}),function(c){var f=c.get_element(!0);c.set_visible(!0);b.UTILITIES.set_css(f,{left:(g.width-50)*Math.random(),top:(g.height-50)*Math.random()});a.appendChild(f);c.update_display()});e.display_updated()};e.display_updated=function(){$(this.get_element());H||(H=b.UTILITIES.get_element_width(a));w||(w=b.UTILITIES.get_element_height(a))};e.add_to_top_level_backside=function(a,
b){return this.get_widget().add_to_top_level_backside(a,b)};d.get_backside_widgets&&(r=d.get_backside_widgets(),e.add_backside_widgets(r,d.get_backside_widgets_json_views()));b.debugging&&(a.id=d._debug_id,e._debug_id=d._debug_id,e._debug_string="backside of "+d._debug_string);return e},toString:function(){return this.get_erased()?"any backside":"backside of "+this.get_widget()},get_full_description:function(b){return this.get_erased()?"any backside":"backside of "+this.get_widget().get_full_description(b)},
remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(d,e){var a=b.UTILITIES.create_check_box(e.get_infinite_stack(),"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+e.get_type_name()+" to be copied instead of moved."),g=function(a){var b=!e.get_infinite_stack(),c;e.set_infinite_stack(b);e.robot_in_training()&&(c=b?"change dragging to make a copy of ":"change dragging back to moving for ",e.robot_in_training().edited(e,
{setter_name:"set_infinite_stack",argument_1:b,toString:c,button_selector:".toontalk-infinite-stack-check-box"}));a.stopPropagation()};a.button.addEventListener("click",g);a.button.addEventListener("touchstart",g);return a},create_parent_selection_check_box:function(d,e){var a=function(){var a=e.get_parent();if(a&&(a.is_nest()||a.is_hole()||a.is_element()))return a.is_hole()?a.get_parent_of_frontside():a},g=a(),m=function(a){return"Drag the "+a.get_type_name()+" I'm on when dragging"},l=function(a){return"Check this if you want to drag the "+
a.get_type_name()+" when you move this widget."},c,h;if(g){c=b.UTILITIES.create_check_box(e.get_infinite_stack(),"toontalk-parent-selection-check-box",m(g),l(g));var q=function(b){var f=a();f?(f!==b&&k(f),c.button.disabled=!1,$(c.label).removeClass("ui-state-disabled"),c.container.title=l(f)):n()},k=function(a){c.label.innerHTML=m(a);c.button.innerHTML=l(a)},r=function(){q();return e},n=function(){c.button.checked=!1;c.button.disabled=!0;$(c.label).addClass("ui-state-disabled");c.container.title=
"Widget moved so this has been disabled. Close and re-open the backside to refresh."};h=function(b){var f=a();a()?(f!==g&&k(f),e.get_selection=c.button.checked?function(){var b=a();q();return b?b.get_selection():e}:r,b.stopPropagation()):n()};c.button.checked=e!==e.get_selection();c.button.checked||(e.get_selection=r);c.button.addEventListener("click",h);return c}},create_click_opens_backside_check_box:function(d,e){var a=b.UTILITIES.create_check_box(e.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box",
"Mouse click opens this backside only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors."),g=function(b){var d=!e.get_open_backside_only_if_stopped(),c;e.set_open_backside_only_if_stopped(d);a.button.checked=d;e.robot_in_training()&&(c=d?"change the response to a mouse click to open only if stopped the backside of ":"change the response to a mouse click to always open the backside of ",e.robot_in_training().edited(e,
{setter_name:"set_open_backside_only_if_stopped",argument_1:d,toString:c,button_selector:".toontalk-click-opens-backside-check-box"}));b.stopPropagation()};a.button.addEventListener("click",g);a.button.addEventListener("touchstart",g);return a},create_description_label:function(d,e){var a=e.get_description();if(a)return b.UTILITIES.create_text_element("I'm the backside of a "+e.get_type_name()+" that is "+a)},add_description_setting:function(d){var e=this.get_widget(),a=e.get_type_name(),g=b.UTILITIES.create_text_area(e.get_description(),
"toontalk-description-input","I'm ","Type here to provide additional information about this "+a+".",function(a){(a=b.UTILITIES.input_area_drop_handler(a,e.receive_description_from_dropped.bind(e),e))&&e.robot_in_training()&&e.robot_in_training().dropped_on_text_area(a,e,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})}),m=function(){var b=g.button.value.trim();e.set_description(b,!0)&&e.robot_in_training()&&e.robot_in_training().edited(e,
{setter_name:"set_description",argument_1:b,toString:"change the description to '"+b+"'' of the "+a,button_selector:".toontalk-description-input"})};$(g.button).val(e.get_description());g.button.addEventListener("change",m);g.button.addEventListener("mouseout",m);this.set_description_text_area(g);(d||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(g.container));e.get_description()||g.button.setAttribute("placeholder",e.get_default_description())},add_name_setting:function(d){var e=
this.get_widget(),a=e.get_type_name(),g=b.UTILITIES.create_text_input(e.get_name(),"toontalk-name-input",e.get_name_input_label?e.get_name_input_label():"My name is ",e.get_name_input_title?e.get_name_input_title():"Edit the name of this "+a+". There is not much room so keep it short.",void 0,"text",function(a){(a=e.receive_name_from_dropped&&b.UTILITIES.input_area_drop_handler(a,e.receive_name_from_dropped.bind(e),e))&&e.robot_in_training()&&e.robot_in_training().dropped_on_text_area(a,e,{area_selector:".toontalk-name-input",
setter:"receive_name_from_dropped",toString:"for a widget's name"})}),m=function(){var b=g.button.value.trim();e.set_name&&e.set_name(b,!0)&&e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:"set_name",argument_1:b,toString:"change the name to '"+b+"'' of the "+a,button_selector:".toontalk-name-input"})};g.button.addEventListener("change",m);g.button.addEventListener("mouseout",m);this.set_name_text_input(g);(d||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(g.container))},
add_advanced_settings:function(){var d=this.get_widget(),e=this.create_infinite_stack_check_box(this,d),a=this.create_parent_selection_check_box(this,d),g=this.create_click_opens_backside_check_box(this,d),m=d.get_type_name(),l=$("<button>Make a sensor nest</button>").button(),c=$("<button>Make a function bird</button>").button(),h=document.createElement("table"),q=this.get_element(),k=function(a,c){var f=d.get_parent_of_frontside(),e=a.get_frontside_element(!0),g;f&&f.add_backside_widget&&!f.get_widget().is_top_level()?
(f.add_backside_widget(a),g=f.get_element(),g.appendChild(e),f=$(g).offset(),f.top+=.6*$(g).height()):(d.add_to_top_level_backside(a,!1),f=c.offset(),f.left-=120,0>f.left&&(f.left=0));b.UTILITIES.set_absolute_position(e,f)};$(q).find(".toontalk-settings-backside-button").get(0);var r;$(h).addClass("toontalk-advanced-settings-table");l.addClass("toontalk-make-sensor_nest_button toontalk-button");l.get(0).addEventListener("click",function(a){var c=b.sensor.create("click","which",void 0,void 0,!0,d);
k(c,l);d.robot_in_training()&&d.robot_in_training().created_widget(c,d,".toontalk-make-sensor_nest_button");a.stopPropagation()});l.attr("title","Click to create a nest which receives messages when events happen to this "+d.get_type_name()+".");c.addClass("toontalk-make-function_bird_button toontalk-button");c.get(0).addEventListener("click",function(a){var e=d.get_function_type&&d.get_function_type(),e=b.bird.create_function(e||m);k(e,c);d.robot_in_training()&&d.robot_in_training().created_widget(e,
d,".toontalk-make-function_bird_button");a.stopPropagation()});d.is_number()||d.is_box()||d.is_element()?c.attr("title","Click to get a bird that flies to functions of "+d.get_type_name(!0)+"."):(c.attr("title","There are no functions that operate on "+d.get_type_name(!0)+" (yet)."),c.button("option","disabled",!0));if(0<arguments.length)for(r=0;r<arguments.length;r++)h.appendChild(arguments[r]);this.get_description_text_area()||this.add_description_setting(h);d.set_name&&!this.get_name_text_input()&&
this.add_name_setting(h);h.appendChild(b.UTILITIES.create_row(l.get(0),c.get(0),e.container,a&&a.container,g.container));this.is_primary_backside()||(e=$("<button>Remove me and my widget</button>").button(),e.get(0).addEventListener("click",function(){d.robot_in_training()&&(d.robot_in_training().removed(d),d.robot_in_training().removed(this));this.remove();d.remove()}.bind(this)),e.attr("title","Click to remove this "+d.get_type_name()+" and its backside."),e.addClass("toontalk-remove-backside-and-widget-buttton"),
b.UTILITIES.use_custom_tooltip(e.get(0)),h.appendChild(e.get(0)));b.UTILITIES.use_custom_tooltip(l.get(0));b.UTILITIES.use_custom_tooltip(c.get(0));q.appendChild(h)},get_type_name:function(){return"backside of "+b.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(d){var e,a,g,m,l,c,t;m=$(this.get_element());if(0!==m.length&&(e=this.get_widget(),(a=e.robot_in_training())&&a.get_training_context()===e&&(a.hide_backside(),m.find(".toontalk-train-backside-button").click()),
g=e.get_frontside_element(d&&e.get_parent_of_frontside()&&e.get_parent_of_frontside().is_top_level()),a=m.position(),l=m.parent().closest(".toontalk-backside"),c=function(a){var c=$(g).position(),l=function(){t&&(this.set_parent_of_backside(void 0,!0),t.is_backside()||t.removed_from_container(this,d,void 0,!0),e.forget_backside&&e.forget_backside());a.remove()}.bind(this);b.UTILITIES.visible_element(a)?"0"===a.css("opacity")?(a.removeClass("toontalk-animating-element"),a.remove()):(a.addClass("toontalk-side-appearing"),
b.UTILITIES.add_one_shot_event_handler(a.get(0),"transitionend",2500,l),b.UTILITIES.set_css(a,{left:c&&c.left,top:c&&c.top,opacity:.1})):l()}.bind(this),t=e.get_parent_of_backside(),b.UTILITIES.remove_highlight(),h(this),e.backside_geometry=this.get_backside_dimensions(),c(m),this.set_visible(!1),d&&g&&!b.UTILITIES.visible_element(g)&&(a&&b.UTILITIES.set_css(g,{left:a.left,top:a.top}),!(m=b.UTILITIES.widget_side_of_jquery(l))||e.is_robot()&&m.get_widget().is_robot()&&e.get_first_in_team()===m.get_widget().get_first_in_team()||
(m.widget_side_dropped_on_me(e),e.render())),b.UTILITIES.for_each_batch(e.get_backside_widgets(),function(a){a.set_visible(!1)}),e.on_backside_hidden))e.on_backside_hidden()},create_advanced_settings_button:function(d,e){var a=document.createElement("div"),g=$(a),m=!1;a.innerHTML="&gt;";g.addClass("toontalk-settings-backside-button toontalk-button");g.css({"z-index":b.UTILITIES.next_z_index()});g.get(0).addEventListener("click",function(a){m=!m;d.set_advanced_settings_showing(m,d.get_element(),g);
a.stopPropagation();e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-settings-backside-button",e)});b.UTILITIES.give_tooltip(g.get(0),"Click to see the advanced settings of this "+e.get_type_name()+".");return g.get(0)},set_advanced_settings_showing:function(d){var e=this.get_element(),a=$(e).children(".toontalk-settings-backside-button"),g=$(e).children(".toontalk-advanced-settings-table");0===g.length&&this.add_advanced_settings&&(this.add_advanced_settings(),g=$(e).children(".toontalk-advanced-settings-table"));
d?(g.show(),a.html("<"),b.UTILITIES.give_tooltip(a.get(0),"Click to hide the advanced settings.")):(g.hide(),a.html(">"),b.UTILITIES.give_tooltip(a.get(0),"Click to show the advanced settings."))},scale_backside:function(d,e,a,g,m){var l=Math.min(1,e,a);1===e&&1===a?!this.get_parent()||this.get_parent().is_backside()?b.UTILITIES.set_css(d,{width:g,height:m,transform:"","transform-origin":""}):b.UTILITIES.set_css(d,{width:"",height:""}):b.UTILITIES.set_css(d,{transform:"scale("+l+", "+l+")","transform-origin":"left top",
width:g*e/l,height:m*a/l})},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&b.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(b,e){return this.get_widget().remove_backside_widget(b,e)},top_level_widget:function(){return this.get_widget().top_level_widget()},robot_in_training:function(){return this.get_widget().robot_in_training()},remove:function(b){var e;this.is_primary_backside()?this.get_widget().remove():((e=this.get_parent_of_backside())&&
(e.is_backside()?e.remove_backside_widget(this,!b):e.removed_from_container&&(e.is_backside()?e.remove_backside_widget(this,!0):e.removed_from_container(this,b))),this.set_parent_of_backside(void 0),(b=this.get_element())&&$(b).remove())},match:function(b){var e;if(b.is_backside()){if(this.get_erased())return"matched";e=this.get_widget();b=e.match(b.get_widget());return b===e?this:b}b.last_match=this;return b},add_copy_to_container:function(b,e,a){return this.get_widget().add_copy_to_container(b||
this.copy(),e,a)},has_ancestor:function(b){var e;return this===b?!0:(e=this.get_parent_of_backside())?e.has_ancestor(b):!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},set_parent:function(b){this.set_parent_of_backside(b)},maintain_proportional_dimensions:function(){return!1},location_constrained_by_container:function(){return!1},set_running:function(){},
can_run:function(){return this.get_widget().can_run()},dereference:function(){return this},is_of_type:function(b){return this.get_widget().is_of_type(b)},is_top_level:function(){return this.get_widget().is_top_level()},ok_to_set_dimensions:function(){return!1},add_listener:function(b,e){this.get_widget().add_listener(b,e)},remove_listener:function(b,e,a){this.get_widget().remove_listener(b,e,a)},get_listeners:function(b){return this.get_widget().get_listeners(typee)},is_hole:function(){return!1},
is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},is_robot:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},get_infinite_stack:function(){return!1},drag_started:function(b,e){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,e)},get_json:function(d,e,a){var g=this.get_backside_dimensions(),
m=$(this.get_element()).position(),l;h(this);l=g?{width:g.original_width,height:g.original_height,transform:"scale("+g.x_scale+", "+g.y_scale+")","transform-origin":"left top 0px",left:m.left,top:m.top}:m;g=function(a,b){e({type:"backside",my_widget:a,css:l,erased:this.get_erased(),view:{}},b)}.bind(this);b.UTILITIES.get_json(this.get_widget(),d,g,a)},get_selection:function(){return this}}}(window.TOONTALK);
TOONTALK.creators_from_json.backside=function(b,h){var d=TOONTALK.UTILITIES.create_from_json(b.my_widget,h).create_backside(),e=d.get_element();TOONTALK.UTILITIES.set_css(e,b.css);b.erased&&d.set_erased(b.erased,!1,!0);return d};window.TOONTALK.frontside=function(b){return{create:function(h){var d=Object.create(this),e=document.createElement("div"),a=$(e),g=function(d){if(!($(d.target).is(".ui-resizable-handle")||"click"===d.type&&1!==d.which||h.get_open_backside_only_if_stopped()&&h.get_running())){if(a.is(".toontalk-top-level-resource")&&!d.altKey)h.set_running(!h.get_running());else{if(b.open_backside_only_if_alt_key&&!d.altKey)return;h.open_backside();h.robot_in_training()&&h.robot_in_training().backside_opened(h)}d.stopPropagation()}},
m;$(e).addClass("toontalk-frontside toontalk-side");h.get_infinite_stack()&&$(e).addClass("toontalk-infinite-stack");e.toontalk_widget_side=h;b.UTILITIES.drag_and_drop(e);d.get_element=function(){return e};d.get_widget=function(){return h};d.visible=function(){return m};d.set_visible=function(a){var c=this.get_widget();(m=a)&&b.UTILITIES.when_attached(this.get_element(!0),c.render.bind(c));c.walk_children&&c.walk_children(function(b){b.set_visible(a);return!0})};e.addEventListener("click",g);e.addEventListener("touchstart",
g);e.addEventListener("mouseenter",function(a){var c=h.get_backside(),d=(h.is_empty_hole()?wiget.get_parent_of_frontside():h).get_selection().get_frontside_element(),d=$(d);c&&b.UTILITIES.highlight_element(c.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");d.is(".toontalk-top-level-resource")||d.addClass("toontalk-wiggle");a.stopPropagation()});e.addEventListener("mouseleave",function(a){a=h.get_backside();var c=h.is_empty_hole()?wiget.get_parent_of_frontside():h;a&&b.UTILITIES.remove_highlight();
$(c.get_frontside_element()).removeClass("toontalk-wiggle")});b.debugging&&(e.id=h._debug_id);return d},update_display:function(){return this.get_widget().update_display()},remove:function(){var b=this.get_element();$(b).remove();b.toontalk_widget_side=null}}}(window.TOONTALK);(function(b){var h=180/Math.PI,d=Math.log(10),e=bigrat.fromInteger(10),a=bigrat.fromValues(1,2),g=bigrat.fromValues(-1,2),m=bigrat.fromInteger(360),l=bigrat.fromDecimal(2*Math.PI),c=Math.log10?Math.log10:function(a){return Math.log(a)/d},t=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},q=function(a){var c=t(a),d=b.number.ZERO(b.number.function_bird_results_default_format),e=b.number.ZERO(b.number.function_bird_results_default_format);
d.set_value(c.integer_part);e.set_value(c.fractional_part);return b.box.create(2,!0,[d,e],"The integer and fraction parts of "+a.toString().replace(",","/"))},k=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),d=t(c);return bigrat.multiply(c,d.fractional_part,b)},r=function(b){b=t(b);return bigrat.isLessThan(b.fractional_part,g)?bigrat.subtract(b.integer_part,b.integer_part,bigrat.ONE):bigrat.isLessThan(b.fractional_part,bigrat.ZERO)||bigrat.isLessThan(b.fractional_part,a)?b.integer_part:bigrat.add(b.integer_part,
b.integer_part,bigrat.ONE)},n=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},u=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(b.widget),d=function(a,b,c,f){var d="",e=100;c=50/c;b/=1+b;if(f)for(f=0;e>=c&&
f<a.length;)d=d+"<span class='toontalk-digit' style='font-size:"+e+"%'>"+a[f]+"</span>",f+=1,"-"!==a[f]&&(e*=b);else for(f=a.length-1;e>=c&&0<f;)d="<span class='toontalk-digit' style='font-size:"+e+"%'>"+a[f]+"</span>"+d,--f,"-"!==a[f]&&(e*=b);return d},g=function(a,b){return 0>a?0:Math.ceil(Math.log(.5/b)/Math.log(a/(1+a)))},l=function(a,b,c){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+
l(a,1.25*b,.8*c)+"</span>";b=b/2-1;return d(a,b,c,!0)+d(a,b,c,!1)},k=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?k(a.substring(0,a.length-1)):a},n=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},m=function(a){switch(a){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return b.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";a.create=function(c,d,e,g,l,k){var m=Object.create(a),h=n(c,d);e||(e="+");m.is_number=function(){return!0};m.set_value=function(a,c){if(c||
!bigrat.equals(h,a))return this.fire_value_change_listeners(h,a),h=a,this.rerender(),b.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&b.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),this};m.set_value_from_sub_classes=m.set_value;m.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),f;c&&(f={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(f)}))};
m.get_value=function(){return h};m.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));b.debugging&&"0,0"===this.get_value().toString()&&b.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};m.copy=function(b){return this.add_to_copy(a.create(h[0],h[1],e,g,l,k),b)};m.get_format=function(){return g||a.default_format};m.set_format=function(a,b){g=a;b&&this.rerender();return this};m.get_operator=function(){return e};m.set_operator=function(a,b){e=a;b&&this.rerender();
return this};m.get_approximate=function(){return k};m.set_approximate=function(a,b){k=a;b&&this.rerender();return this};a.add_standard_widget_functionality(m);m.set_description(l);b.debugging&&(m._debug_string=m.toString(),m._debug_id=b.UTILITIES.generate_unique_id(),h._debug_id_new=m._debug_id);return m};a.create_from_bigrat=function(a){var c=b.number.ZERO();c.set_value(a);return c};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(n(a,
b))};a.set_numerator=function(a){return this.set_value(n(a,this.get_value()[1].toString()))};a.set_denominator=function(a){return this.set_value(n(this.get_value()[0].toString(),a))};a.ONE=function(){return b.number.create(1)};a.ZERO=function(a){return b.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};
a.compare_with_number=function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),c=function(a,b){var c=a.indexOf('style="');return 0<=c?a.substring(0,c+7)+b+a.substring(c+7):a},f=28,d,e,g,l,k,n;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string(50));a=a.get_element();$(a).is(".toontalk-conditions-contents")?d=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json")?
(d=$(a),k=!0):$(a).parent().is(".toontalk-element-frontside")?(d=$(a),l=k=!0):d=$(a).parent().is(".toontalk-scale-half")?$(a):$(a).parent();0===d.length&&(f=this.get_parent_of_frontside())&&(f.get_widget().is_hole()&&(f=f.get_parent_of_frontside()),d=$(f.get_frontside_element()));1===b.nest.CONTENTS_WIDTH_FACTOR&&1===b.nest.CONTENTS_HEIGHT_FACTOR&&d.is(".toontalk-nest")&&d.parent().is(".toontalk-box-hole")&&!d.parent().is(".toontalk-scale-half")&&(d=d.parent());if($(a).is(".toontalk-carried-by-bird"))g=
e=100;else if($(a).is(".toontalk-held-by-robot"))e=76,g=55;else if($(a).is(".toontalk-element-attribute"))e=200,g=32;else if(k&&(a===d.get(0)||d.is(".toontalk-top-level-resource")))e=$(a).width(),g=$(a).height(),e&&g||(e=this.saved_width||76,g=this.saved_heieght||55,$(a).css({width:e,height:g}));else{e=d.width();g=d.height();if(0===e||0===g){b.logging&&0<=b.logging.indexOf("display")&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());b.UTILITIES.is_attached(a)||
b.UTILITIES.when_attached(a,this.update_display.bind(this));return}d.is(".toontalk-nest")&&(e*=b.nest.CONTENTS_WIDTH_FACTOR,g*=b.nest.CONTENTS_HEIGHT_FACTOR)}n=$(a).children(".toontalk-widget");n.is("*")?n=n.get(0):(n=document.createElement("div"),a.appendChild(n));$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");f=this.get_border_size(e,g);l||(4===f?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):
8===f?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):16===f?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number"));l=g-2*f;k=this.to_HTML(e/(.64*l),e,g,l,this.get_format(),!0,this.get_operator(),k);b.UTILITIES.on_a_nest_in_a_box(a)&&(k=c(k,"width:"+(e-2*f)+"px;"),k=c(k,"height:"+(g-2*f)+"px;"));n.innerHTML=k;n.translate=!1;$(n).addClass("toontalk-widget notranslate");d.is(".toontalk-box-hole")&&$(a).css({width:"",
height:""});b.UTILITIES.give_tooltip(a,this.get_title())};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};a.to_HTML=function(a,f,n,h,u,q,t,r){var z=!1!==q?" toontalk-top-level-number":"",J=4,D=a,p,v,y,E,R;this.is_attribute_widget&&this.is_attribute_widget()?z+=" toontalk-attribute-number":this.get_approximate()&&(z+=" toontalk-approximate-number");r&&(z+=" toontalk-number-size-unconstrained-by-container");y=t?m(t):"";D||(D=4);h||(h=16);if(this.get_erased&&
this.get_erased())return'<div class="toontalk-number toontalk-integer'+z+'" style="font-size: '+h+'px;"></div>';if(0<y.length){--D;if(R="-"===t&&(this.is_negative()||this.is_zero())&&(this.is_integer()||"improper_fraction"!==u&&"proper_fraction"!==u&&"mixed_number"!==u))--D,y+="&nbsp;";2>D&&(h*=Math.max(1,D)/2,D=2)}if(this.is_integer()&&"scientific_notation"!==u){try{p=bigrat.toBigInteger(this.get_value()).toString()}catch(T){b.UTILITIES.report_internal_error("Error converting number to a string: "+
T),p="0"}q=p.length;0<y.length&&q++;4>D&&q>D&&(u=Math.min(4,q),h*=D/u,D=u);return'<div class="toontalk-number toontalk-integer'+z+'" style="font-size: '+h+'px;">'+y+l(p,D,h)+"</div>"}if(this.get_approximate()||this.is_attribute_widget())if("decimal"===u?v=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===u&&(v=bigrat.toDecimal(this.get_value()).toExponential(),p=v.indexOf("e"),0<=p&&(E=v.substring(p+1),v=v.substring(0,p))),v)return q=v.length,D>q&&(D=q),0<y.length&&q++,E&&(D-=
3+E.length/2),"scientific_notation"===u&&(J+=2),D<J&&q>D&&(u=Math.min(J,q),h=0>=D?Math.max(1,D)/u*h:Math.max(2,D)/u*h),D=E?'&times;10<sup style="font-size: '+h/2+'px;">'+E+"</sup>":"",h=Math.min(h,f/(.64*q)),'<div class="toontalk-number toontalk-approximate-number'+z+'" style="font-size: '+h+'px;">'+y+'<div style="margin-top: '+(n-h)/2+'px">'+v+"</div>"+D+"</div>";v=' style="font-size:'+.4*h+'px;"';if("improper_fraction"===u||!u)return h='<table class="toontalk-number toontalk-improper-fraction'+
z+'"'+v+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+l(this.numerator_string(),2*D,h)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+l(this.denominator_string(),2*D,h)+"</td></tr></table>",""===y?h:"<table class='toontalk-operator-and-fraction'"+v+"><tr><td>"+y+"</td><td>"+h+"</td></tr></table>";
if("mixed_number"===u||"proper_fraction"===u){y=this.integer_part();if(y.is_zero())return this.to_HTML(D,f,n,h,"improper_fraction",q,t);E=this.copy({just_value:!0}).subtract(y).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+z+'"'+v+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+y.to_HTML(D/2,f,n,h,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+E.to_HTML(D/2,f,n,h,"improper_fraction",!1)+
"</td></tr></table>"}if("decimal"===u)return 4>D&&(h*=Math.max(1,D)/4,D=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+z+'" style="font-size: '+h+'px;">'+y+this.decimal_string(D,h)+"</div>";if("scientific_notation"===u){J=bigrat.isNegative(this.get_value());p=this.get_value();R=bigrat.abs(bigrat.create(),p);E=bigrat.isLessThan(R,bigrat.ONE);bigrat.equals(p,bigrat.ZERO)?E=0:(p=E?bigrat.toBigInteger(bigrat.divide(bigrat.create(),bigrat.ONE,R)):bigrat.toBigInteger(R),p=
p.toString(),E=E?"1"===k(p)?-p.length+1:-p.length:p.length-1);p=6+(0===E?1:Math.ceil(c(Math.abs(E)))/2);J&&p++;if(a<p+1)return this.to_HTML(p+1,f,n,h*a/(p+1),u,q,t,r);f=g(D-(Math.min(p,D/2)+1),h);E<f?(n=bigrat.power(bigrat.create(),e,f-E),n=bigrat.multiply(bigrat.create(),this.get_value(),n),f=bigrat.toBigInteger(n).toString().substring(0,f+1)):f=bigrat.toBigInteger(this.get_value()).toString().substring(0,f+1);if(this.is_integer()||this.is_reciprocal_of_integer())f=k(f);n=J?"-"+f.substring(0,1):
f.substring(0,1);f=f.substring(1);D=d(f,D*(1-p/D),h,!0);0<D.length&&(D="<span class='toontalk-decimal-point'>.</span>"+D);return'<table class="toontalk-number toontalk-scientific_notation'+z+'"'+v+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+z+'" style="font-size: '+.9*h+'px;">'+y+n+D+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+h+'px;"> &times;10<sup style="font-size: '+
h/2+'px;">'+E+"</sup></div></td></tr></table>"}};a.get_default_description=function(){return this.get_approximate()?"a number from an approximate calculation.":"a number."};a.drop_on=function(a,b,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b,c),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,c,f){var d,e,g,l,k;if(!a.is_backside()){if(a.visible()&&this.visible()&&
(c||f)){if(f){if(!f.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(a,c,f);a.robot_waiting_before_next_step=f}d=document.createElement("div");$(d).addClass("toontalk-bammer-down");e=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level");d.style.left="-10px";d.style.top=e.height()+"px";0<e.length&&e.get(0).appendChild(d);l=this.get_frontside_element();g=$(l).offset();g.left-=.75*$(d).width();g.left+=.5*$(l).width()+.1*$(d).width();g.top-=.5*$(l).height()+
.4*$(d).height();l=function(){b.sounds&&b.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,c,f)&&f&&f.run_next_step();c&&this.backup_all();$(d).removeClass("toontalk-bammer-down");b.UTILITIES.set_timeout(function(){var a=e.offset();a||(a={left:0,top:0});$(d).addClass("toontalk-bammer-away");g.left=a.left+e.width()-100;g.top=a.top+e.height()+100;k=function(){$(d).remove()};b.UTILITIES.animate_to_absolute_position(d,g,k,f&&f.transform_animation_speed(b.UTILITIES.default_animation_speed));
$(d).css({opacity:.01})})}.bind(this);b.UTILITIES.animate_to_absolute_position(d,g,l,f&&f.transform_animation_speed(b.UTILITIES.default_animation_speed));$(d).css({opacity:1,"z-index":b.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c,f)}};a.number_dropped_on_me_semantics=function(a,c,f){c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove();switch(a.get_operator()){case "+":return this.add(a);
case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "=":return this.set_value(a.get_value());case "^":return this.power(a);default:b.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_side_dropped_on_me=function(a,b,c){return a.number_dropped_on_me?this.number_dropped_on_me(a,b,c):!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};
a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.divide=function(a){this.set_value(bigrat.divide(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),
this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};a.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(){return this.get_erased()?"erased number":("+"===this.get_operator()?
"":this.get_operator())+bigrat.str(this.get_value())};a.operator_word=function(a){switch(this.get_operator()){case "+":return"add "+a+" to";case "-":return"subtract "+a+" from";case "*":return"multiply "+a+" with";case "/":return"divide "+a+" into"}};a.get_text=function(a){var c=this.get_format(),f;if(this.get_approximate()||this.is_attribute_widget&&this.is_attribute_widget())return"approximately "+bigrat.toDecimal(this.get_value()).toString();if(this.is_integer()||"improper_fraction"===c)return a?
b.UTILITIES.number_to_words(this.toString()):this.toString();c=this.integer_part();if(c.is_zero())return a?b.UTILITIES.number_to_words(this.toString()):this.toString();f=this.copy({just_value:!0}).subtract(c).absolute_value();return a?b.UTILITIES.number_to_words(c.toString())+(a?" and ":" ")+b.UTILITIES.number_to_words(f.toString()):c+" "+f};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};
a.get_json=function(a,b,c){b({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string(),format:this.get_format(),approximate:this.get_approximate()},c)};b.creators_from_json.number=function(b){return a.create(b.numerator,b.denominator,b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};a.is_reciprocal_of_integer=function(){return 0===
this.get_value()[0].compare(BigInteger.ONE)&&0!==this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};a.decimal_string=
function(b,c){var n,h,m,u,q;if(this.is_integer())return this.numerator_string();n=this.get_value();h=a.create(n[0],n[1]);m=h.integer_part();n=m.toString();"0"===n&&this.is_negative()&&(n="-"+n);u=h.get_value();bigrat.subtract(u,u,m.get_value());h=b-(Math.min(n.length,b/2)+1);q=g(h,c);m=Math.min(n.length,b/2);bigrat.isNegative(u)&&bigrat.abs(u,u);var t=bigrat.fromValues(u[0],1);u=bigrat.fromValues(u[1],1);if(bigrat.equals(t,bigrat.ZERO))q="0";else{var r="",z=bigrat.create(),H=bigrat.create(),p=bigrat.create();
for(bigrat.multiply(t,t,e);q>r.length;){if(bigrat.isLessThan(t,u))r+="0";else if(bigrat.divide(z,t,u),H=bigrat.toBigInteger(z),r+=H.toString(),bigrat.subtract(p,z,bigrat.fromValues(H,1)),bigrat.multiply(t,p,u),bigrat.equals(t,bigrat.ZERO)){r=k(r);break}bigrat.multiply(t,t,e)}q=r}h=q.length<h?q:d(q,h,c,!0);return l(n,m,c)+"<span class='toontalk-decimal-point'>.</span>"+h};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_number)return a.match_with_any_number();this.last_match=
a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===this.get_operator())return"matched";a.last_match=this;return a};a.get_custom_title_prefix=function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"/"===this.get_operator()?"Drop me on another number I'll divide him by my value.":"Drop me on another number and I'll "+
this.operator_word("myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+b.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=function(){return{create:function(a){var c=b.backside.create(a),d=c.get_element(),e=document.createElement("div"),g=a.numerator_string(),l=a.denominator_string(),k=b.UTILITIES.create_text_area(g,"toontalk-numerator-input","","Type here to edit the numerator",
void 0,"number"),n=b.UTILITIES.create_text_area(l,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),h=b.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal.",!0),m=b.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction.",!0),u=b.UTILITIES.create_radio_button("number_format",
"improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction.",!0),q=b.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",!0),t=b.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",!0),r=b.UTILITIES.create_radio_button("operator",
"-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",!0),Q=b.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),O=b.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","I will divide what I'm dropped on.",!0),J=b.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",!0),D=function(b){var c=
k.button.value.trim(),d=n.button.value.trim(),e,p,h,m,v=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:v(a,b).replacement};a=v(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,
"")}},y;if(c!==g||d!==l){y=v(c,"numerator");y.message&&(e=parseFloat(c),isNaN(e)?(a.display_message(y.message,!0),c=y.replacement):p=bigrat.fromDecimal(e));"0"===d?(a.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1.",!0),d="1"):(y=v(d,"denominator"),y.message&&(h=parseFloat(d),isNaN(h)?(a.display_message(y.message,!0),d=y.replacement||"1"):m=bigrat.fromDecimal(h)));if(p&&m)a.set_value(bigrat.divide(a.get_value(),p,m),!0);else if(p)a.set_value(bigrat.divide(a.get_value(),
p,bigrat.fromValues(d,1)),!0);else if(m)a.set_value(bigrat.divide(a.get_value(),bigrat.fromValues(c,1),m),!0);else if(!a.set_from_values(c,d)&&!isNaN(h))return;g=a.numerator_string();l=a.denominator_string();a.robot_in_training()&&(b=b.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:"set_denominator",argument_1:d,toString:"by changing the value of the denominator to "+d,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:"set_numerator",
argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+b}));a.rerender()}},p=function(){var c=b.UTILITIES.selected_radio_button(h,m,u,q),d=c.button.value;a.set_format(d,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_format",argument_1:d,toString:"by changing the format to "+d+" of the number",button_selector:"."+c.container.className.split(" ",1)[0]});a.rerender()},v=function(){var c=b.UTILITIES.selected_radio_button(t,r,Q,O,J),d=c.button.value;
a.set_operator(d,!0);a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_operator",argument_1:d,toString:"by changing the operator to "+d+" of the number",button_selector:"."+c.container.className.split(" ",1)[0]})},y=b.UTILITIES.create_horizontal_table(k.container,e,n.container),E=b.UTILITIES.create_horizontal_table(h.container,m.container,u.container,q.container),R=b.UTILITIES.create_horizontal_table(t.container,r.container,Q.container,O.container,J.container),T=b.backside.create_advanced_settings_button(c,
a),U=c.update_display.bind(c),ca=c.add_advanced_settings,ka=function(){switch(a.get_format()){case "decimal":return h;case "improper_fraction":return u;case "mixed_number":case "proper_fraction":return m;case "scientific_notation":return q}},na=function(){switch(a.get_operator()){case "+":return t;case "-":return r;case "*":return Q;case "/":return O;case "=":return J}};e.innerHTML="/";$(e).addClass("ui-widget");k.button.addEventListener("change",D);k.button.addEventListener("mouseout",D);k.button.addEventListener("mouseenter",
function(){g=k.button.value.trim()});n.button.addEventListener("change",D);n.button.addEventListener("mouseout",D);n.button.addEventListener("mouseenter",function(){l=n.button.value.trim()});d.appendChild(y);d.appendChild(T);h.button.addEventListener("change",p);m.button.addEventListener("change",p);u.button.addEventListener("change",p);q.button.addEventListener("change",p);b.UTILITIES.check_radio_button(ka());b.UTILITIES.check_radio_button(na());t.button.addEventListener("change",v);r.button.addEventListener("change",
v);Q.button.addEventListener("change",v);O.button.addEventListener("change",v);J.button.addEventListener("change",v);c.update_display=function(){$(k.button).val(a.numerator_string());$(n.button).val(a.denominator_string());b.UTILITIES.check_radio_button(ka());b.UTILITIES.check_radio_button(na());U()};c.add_advanced_settings=function(){ca.call(c,E,R);$(E).buttonset();$(R).buttonset()};b.UTILITIES.when_attached(d,function(){c.is_primary_backside()||a.add_listener("value_changed",function(){c.rerender()})});
return c}}}();window.TOONTALK.number["function"]=function(){var a=b.create_function_table(),c=function(a){return bigrat.toDecimal(k(a,m))},d=function(a){return bigrat.toDecimal(k(a,l))},e=function(){return!0};a.add_function_object("sum",function(c,d,e){return a.n_ary_widget_function(c,b.number.ZERO,b.number.add,"sum",d,e)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",function(c,d,e){return a.n_ary_widget_function(c,b.number.ZERO,b.number.subtract,
"difference",d,e)},"The bird will return with the result of subtracting the numbers in the box from the first number.","-");a.add_function_object("product",function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.multiply,"product",d,e)},"The bird will return with the product of the numbers in the box.","\u00d7");a.add_function_object("division",function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.divide,"division",d,e)},"The bird will return with the result of dividing the numbers into the first number in the box.",
"\u00f7");a.add_function_object("modulo",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(k),2,"modulo",c,d)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.minimum,"minimum",d,e)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",
function(c,d,e){return a.n_ary_widget_function(c,b.number.ONE,b.number.maximum,"maximum",d,e)},"The bird will return with the largest of the numbers in the box.","max");a.add_function_object("absolute value",function(c,d,e){return a.n_ary_function(c,function(a){var d=b.number.ZERO(c.get_hole_contents(1).get_format());bigrat.abs(d.get_value(),a);return d},1,"absolute value",d,e)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c,d){return a.n_ary_function(b,
a.bigrat_function_to_widget_function(function(a,b){var c=bigrat.power(bigrat.create(),a,b[0].valueOf()),d=b[1].valueOf();return 1===d?c:bigrat.nthRoot(bigrat.create(),c,d)},function(a){return 0!==a[1][1].compare(BigInteger.ONE)}),2,"power",c,d)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):
Math.log(arguments[0])/Math.log(arguments[1])},e),1,"logarithm",c,d)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).","log");a.add_function_object("random",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?
Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c,d)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.","rand");a.add_function_object("round",function(b,c,d){return a.n_ary_function(b,
a.bigrat_function_to_widget_function(r),1,"round",c,d)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(n),1,"floor",c,d)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c,d){return a.n_ary_function(b,a.bigrat_function_to_widget_function(u),1,"ceiling",c,d)},"The bird will return the smallest integer greater than or equal to the number.",
"ceil");a.add_function_object("delay",function(c,d,e){var g=Date.now(),l=a.check_message(c),k;if(l)if(2>l.size)Tmessage.display_message("Delay function birds need a number in the second hole.");else return k=c.get_hole_contents(1).to_float(),setTimeout(function(){var k=b.number.ZERO(b.number.function_bird_results_default_format);k.set_value_from_decimal((Date.now()-g)/1E3);k.set_approximate(!0);a.process_response(k,l.bird,c,d,e)},1E3*k),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");
a.add_function_object("integer and fraction parts",function(b,c,d){return a.n_ary_function(b,q,1,"integer and fraction parts",c,d)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(b,d,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/h)},!0,c),1,"sine",d,e)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",
function(b,d,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/h)},!0,c),1,"cosine",d,e)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return h*Math.atan(a)},!0),1,"arc tangent",c,d)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.",
"atan");a.add_function_object("arc tangent of y and x",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return h*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c,d)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.","atan2");a.add_function_object("sine (in radians)",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,
!0,d),1,"sine (in radians)",c,e)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,c,e){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,d),1,"cosine (in radians)",c,e)},"The bird will return with an approximation of the cosine of the number (in radians).","cos rad");a.add_function_object("arc tangent (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,
!0),1,"arc tangent (in radians)",c,d)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",c,d)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.",
"atan2 rad");a.add_function_object("turn into words",b.widget.get_description_function(a),"The bird will return with words describing what is in the second hole.","describe",["a widget"]);a.add_function_object("speak",b.widget.get_speak_function(a),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);return a.get_function_table()}()})(window.TOONTALK);(function(b){var h=function(d,e,a,g){var h;d&&0<=a&&d.maintain_proportional_dimensions()&&d.get_default_width?(h=d.get_default_width(),d=d.get_default_height(),a/h>=g/d?(h=h*g/d,a={left:(a-h)/2,top:0,width:h,height:g}):(h=d*a/h,a={left:0,top:(g-h)/2,width:a,height:h})):(d.is_backside()&&(d.update_display(),d.scale_to(a,.92*g)),a={left:0,top:0});b.UTILITIES.set_css(e,a)};window.TOONTALK.box=function(b){var e=Object.create(b.widget);e.create=function(a,g,m,l,c){var t=Object.create(e),q=[];"undefined"===
typeof g&&(g=!0);t.is_box=function(){return!0};t.get_horizontal=function(){return g};t.set_horizontal=function(a,b){g=a;b&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());return this};t.get_hole=function(a){return q[a]};t.get_hole_contents=function(a){return q[a]&&q[a].get_contents()};t.set_hole=function(a,c,e){var g;q[a].set_contents(c);if(e){c&&c.save_dimensions();e=this.get_frontside_element();a=$(e).children(".toontalk-hole-number-"+a);a.empty();if(!c)return;
g=this.get_hole_dimensions();e=c.get_element(!0);0<a.length&&a.get(0).appendChild(e);h(c,e,g.width,g.height);c.rerender()}this.rerender();b.debugging&&(this._debug_string=this.to_debug_string())};t.get_holes=function(){return q};t.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=
void 0}.bind(this)};t.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};t.set_contents=function(a){b.UTILITIES.for_each_batch(a,function(a,b){q[b].set_contents(a)})};t.get_size=function(){return a};t.set_size=function(c,e){var g,l;if(a===c||0>c||isNaN(c))return!1;l=this.visible();q.length=c;if(c>a)for(g=a;g<c;g++)q[g]=b.box_hole.create(g),q[g].set_parent_of_frontside(t),q[g].set_visible(l);a=c;e&&this.rerender();b.debugging&&
(this._debug_string=this.to_debug_string());return!0};t.get_hole_dimensions=function(){var c=this.get_frontside_element(),e=$(c).width()||b.box.get_default_width(),c=$(c).height()||b.box.get_default_height();return g?{width:e/a,height:c}:{width:e,height:c/a}};t.receive_size_from_dropped=function(a,c){var e;if(a.is_number())return e=b.number.create(this.get_size()),e.number_dropped_on_me_semantics(a),e=Math.max(0,Math.round(e.to_float())),this.set_size(e),e.toString()};t.copy=function(b){var c;b||
(b={});c=q.map(function(a){if(a=a.get_contents())return a.copy(b)});c=e.create(a,g,c,this.get_description(),this.get_name());return this.add_to_copy(c,b)};t.generate_name=function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};t.add_standard_widget_functionality(t);t.has_name(t);t.set_name(c);for(c=0;c<a;c++)q[c]=b.box_hole.create(c),q[c].set_parent_of_frontside(t);t.set_description(l);m&&t.set_contents(m);b.debugging&&(t._debug_id=b.UTILITIES.generate_unique_id(),t._debug_string=t.to_debug_string());
return t};e.create_backside=function(){return b.box_backside.create(this)};e.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&a.equals_box(this)};e.equals_box=function(a){var b=this.get_size(),d,e,c;if(b!==a.get_size())return!1;for(d=0;d<b;d++)if(e=this.get_hole_contents(d),c=a.get_hole_contents(d),!e&&c||e&&!c||e&&c&&(!e.equals||!e.equals(c)))return!1;return!0};e.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};e.compare_with_box=
function(a){var b=this.get_size(),d=a.get_size(),e,c;if(b>d)return 1;if(b<d)return-1;for(d=0;d<b;d++){e=this.get_hole_contents(d);c=a.get_hole_contents(d);if(e&&!c)return 1;if(!e&&c)return-1;if(e&&c)if(e.compare_with){if(e=e.compare_with(c),1===e||-1===e)return e}else return}return 0};e.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_box)return a.match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=
a,this)};e.match_with_any_box=function(){return"matched"};e.match_with_this_box=function(a){var e=this.get_size(),h=[],l,c,t;if(e!==a.get_size())return a.last_match=this,a;for(l=0;l<e;l++)if(t=a.get_hole_contents(l))if(c=this.get_hole_contents(l)){c=b.UTILITIES.match(t,c);if(c.is_widget)return c;"matched"!==c&&(h=0===h.length?c:h.concat(c))}else if(c=this.get_contents_temporarily_removed(l))h.push(c);else return a.last_match=this,a;return 0<h.length?h:"matched"};e.toString=function(a){var b="",d=
this.get_size(),e,c,h=this.get_type_name()+" that looks like ";for(e=0;e<d;e++)c=this.get_hole(e),b+=c.get_full_description(a),e<d-1&&(b+=" | ");return h+"["+b.replace(h,"")+"]"};e.get_type_name=function(a){return a?"boxes":"box"};e.get_default_description=function(){return"a box for holding things."};e.get_help_URL=function(){return"docs/manual/boxes.html"};e.get_json=function(a,e,h){var l=[],c=function(h,m){var k,r;h>=this.get_size()?e({type:"box",size:this.get_size(),contents:l,horizontal:this.get_horizontal(),
name:this.get_name()},m):(k=this.get_hole_contents(h))?k.is_primary_backside&&k.is_primary_backside()?(r=function(a,b){l.push({widget:a,is_backside:!0});c(h+1,b)}.bind(this),b.UTILITIES.get_json(k.get_widget(),a,r,m)):k.is_widget?(r=function(a,b){l.push({widget:a});c(h+1,b)}.bind(this),b.UTILITIES.get_json(k,a,r,m)):(r=function(a,b){l.push(a);c(h+1,b)}.bind(this),k.get_json(a,r,m)):(l.push(null),c(h+1,m))}.bind(this);c(0,h)};e.walk_children=function(a){var b=this.get_size(),d;for(d=0;d<b&&a(this.get_hole(d));d++);
};b.creators_from_json.box=function(a,g){return e.create(a.size,a.horizontal,b.UTILITIES.create_array_from_json(a.contents,g),a.description,a.name)};e.update_display=function(){var a=this.get_frontside(!0).get_element(),e=this.get_size(),m=function(a,c,k){var m=c.get_contents(),u=(m||c).get_element(!0),t=$(a).parents(".toontalk-box-hole"),r=function(){$(a).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(M/=b.nest.CONTENTS_WIDTH_FACTOR,N/=b.nest.CONTENTS_HEIGHT_FACTOR)},G,B,M,N;
l?(B=0,0<t.length?(M=n-2*A/e,N=f-2*A):(M=n,N=f),r(),G=M*k,1<k&&(G+=A*(k-1))):(G=0,0<t.length?(M=n-2*A,N=f-2*A/e):(M=n,N=f),r(),B=N*k,1<k&&(B+=A*(k-1)));b.UTILITIES.set_css(a,{left:G,top:B,width:M,height:N});q[k]&&a.setAttribute("toontalk_name",q[k]);!b.UTILITIES.has_animating_image(u)&&0<k&&($(a).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(a).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),
l?$(a).addClass(x+"-left"):$(a).addClass(x+"-top"));a!==u&&m.get_parent()===c&&(h(m,u,M,N),a.appendChild(u),c.get_contents().rerender());c.is_element()&&(c=c.get_contents(),c.set_size_attributes(M,N,!0))},l=this.get_horizontal();$(a).is(".toontalk-box");var c=function(){var c=$(a).children(".toontalk-box-hole");$(a).parent(".toontalk-conditions-container").is("*")||$(a).parent().is(".toontalk-scale-half")||($(a).parent(".toontalk-box-hole").is("*")?b.UTILITIES.set_css(a,{width:"",height:""}):b.UTILITIES.set_css(a,
{width:r,height:u}));c.length===e?c.each(function(a,b){var c=this.get_hole(a);c&&m(b,c,a)}.bind(this)):(c.remove(),this.get_holes().forEach(function(b,c){k=b.get_element();$(k).addClass("toontalk-hole-number-"+c);m(k,b,c);a.appendChild(k)}))}.bind(this),t=function(){var c=function(a){if(a.parentElement)return $(a.parentElement).is(".toontalk-box-hole")?a.parentElement:c(a.parentElement)},k=c(a)||a,k=$(a).parent().is(".toontalk-scale-half")?a:k;r=0===e?0:b.UTILITIES.element_width(k)||this.saved_width||
b.box.get_default_width();u=b.UTILITIES.element_height(k)||this.saved_height||b.box.get_default_height();l?(n=0===e?0:r/e,f=u):(n=r,f=u/e)}.bind(this),q=this.get_name().split(";"),k,r,n,u,f,x,A;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(a).addClass("toontalk-box");$(a).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");b.UTILITIES.give_tooltip(a,this.get_title());
b.debugging&&(this._debug_string=this.to_debug_string());this.get_erased()?($(a).addClass("toontalk-box-erased"),$(a).children(".toontalk-side").remove()):($(a).removeClass("toontalk-box-erased"),t(),A=this.get_border_size(n,f),x=4===A?"toontalk-box-eighth-size-border":8===A?"toontalk-box-quarter-size-border":16===A?"toontalk-box-half-size-border":"toontalk-box-full-size-border",l?n-=(e-1)*A/e:f-=(e-1)*A/e,$(a).addClass(x),b.UTILITIES.set_timeout(c))};e.get_default_width=function(){return 164};e.get_default_height=
function(){return 68};e.get_border_size=function(a,b){var d;if(0===a)return d=$(this.get_frontside_element()).width(),16>=d?4:32>=d?8:64>=d?16:32;a||(a=$(this.get_frontside_element()).width());b||(b=$(this.get_frontside_element()).height());return 32>=a||32>=b?4:64>=a||64>=b?8:128>=a||128>=b?16:32};e.get_name_input_label=function(){return"The labels of my holes are"};e.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};
e.drop_on=function(a,b,d){if(a.box_dropped_on_me)return d=a.box_dropped_on_me&&a.box_dropped_on_me(this,b,d),b&&a.rerender(),d&&this.remove(),d;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,d);console.log("No handler for drop of "+this+" on "+a)};e.box_dropped_on_me=function(a,b){console.log("box on box not yet implemented");return!1};e.widget_side_dropped_on_me=function(a,e,h){var l=this.which_hole(e),c;if(0<=l)return c=this.get_hole(l),(l=c.get_contents())?a.drop_on(l,
e,h):c.widget_side_dropped_on_me(a,e,h);b.UTILITIES.report_internal_error(a+" dropped on "+this+" but no event was provided.")};e.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};e.removed_from_container=function(a,b){var d=!!b,e=this.get_index_of(a);0<=e&&(this.set_hole(e,void 0,d),d&&(this.rerender(),a.restore_dimensions()))};e.get_path_to=function(a,e){var h=this.get_size(),l,c;if("empty hole"===a.get_type_name()){h=
a.get_parent_of_frontside();c=b.box.path.create(a.get_index());if(h===this)return c;h=this.get_path_to(h);if(!h)return;h.next=c;return h}for(l=0;l<h;l++)if(c=this.get_hole_contents(l)||this.get_contents_temporarily_removed(l)){if(a===c||c.top_contents_is&&c.top_contents_is(a))return b.box.path.create(l);if(c.get_path_to&&(c=c.get_path_to(a,e)))return h=b.box.path.create(l),h.next=c,h}};e.element_to_highlight=function(a){a=this.which_hole(a,!0);var b;if(0>a||0===this.get_size())return this.get_frontside_element();
a=this.get_hole(a);return(b=a.get_contents())?b.get_frontside_element():a.get_frontside_element()};e.which_hole=function(a){var b=this.get_horizontal(),d=this.get_frontside_element(),e=this.get_size(),c,h;if(0!==e&&(c=$(d).offset(),d=b?$(d).width()/e:$(d).height()/e,h=b?c.left:c.top,a))for(c=0;c<e;c++)if(h+=d,(b?a.pageX<=h:a.pageY<=h)||c+1===e)return c};e.dereference_path=function(a,e){var h,l;if(a){h=a.get_index&&a.get_index();if(!b.debugging||"number"===typeof h){if(l=this.get_hole_contents(h)){if(l.dereference_contents&&
!a.not_to_be_dereferenced)return l.dereference_contents(a.next||a,e);if(a.next){if(l.dereference_path)return l.dereference_path(a.next,e);b.UTILITIES.report_internal_error("Expected to refer to a part of "+l+" but it lacks a method to obtain "+b.path.toString(a.next))}a.removing_widget&&("empty hole"===l.get_type_name()?b.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):l.get_infinite_stack()||e.remove_from_container(l,this));return l}return this.get_hole(h)}b.UTILITIES.report_internal_error(this+
" unable to dereference the path: "+b.path.toString(a))}else return this};e.path={create:function(a){return{get_index:function(){return a},toString:function(){return"scale"===this.true_type?0===a?"the left pan ":"the right pan ":"the "+b.UTILITIES.ordinal(a)+" hole "},get_json:function(b,d,e){var c=function(b,c){d({type:"box_path",index:a,true_type:this.true_type,next:b},c)}.bind(this);this.next?this.next.get_json(b,c,e):c(void 0,e)}}}};e.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};
b.creators_from_json.box_path=function(a,g){var h=e.path.create(a.index);a.next&&(h.next=b.UTILITIES.create_from_json(a.next,g));a.true_type&&(h.true_type=a.true_type);return h};return e}(window.TOONTALK);window.TOONTALK.box_backside=function(b){return{create:function(e){var a=b.backside.create(e),g=b.UTILITIES.create_text_input(e.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(a){if(a=b.UTILITIES.input_area_drop_handler(a,
e.receive_size_from_dropped.bind(e),e))e.rerender(),e.robot_in_training()&&e.robot_in_training().dropped_on_text_area(a,e,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),h=b.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-radio-button","Left to right","Show box horizontally.",!0),l=b.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-radio-button","Top to bottom","Show box vertically.",!0),c=function(){var a=
parseInt(g.button.value.trim(),10);e.set_size(a,!0)&&e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:"set_size",argument_1:a,toString:"by changing the number of holes to "+a+" of the box",button_selector:".toontalk-box-size-input"})},t=function(){var a=b.UTILITIES.selected_radio_button(h,l),c=a.button.value,g="horizontal"===c;e.set_horizontal(g,!0);e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:"set_horizontal",argument_1:g,toString:"by changing the orientation to "+
c+" of the box",button_selector:"."+a.container.className.split(" ",1)[0]})},q=a.get_element(),k=b.backside.create_advanced_settings_button(a,e),r=a.update_display.bind(a),n=b.UTILITIES.create_horizontal_table(h.container,l.container);g.button.addEventListener("change",c);g.button.addEventListener("mouseout",c);h.button.addEventListener("change",t);l.button.addEventListener("change",t);a.update_display=function(){g.button.value=e.get_size().toString();e.get_horizontal()?b.UTILITIES.check_radio_button(h):
b.UTILITIES.check_radio_button(l);r()};q.appendChild(g.container);q.appendChild(n);$(n).buttonset();q.appendChild(k);a.rerender();return a}}}(window.TOONTALK);window.TOONTALK.box_hole=function(b){return{create:function(e){var a=Object.create(this),g,m,l;a.is_hole=function(){return!0};a.is_empty_hole=function(){return!g};a.location_constrained_by_container=function(){return!1};a.get_element=function(){l||(l=document.createElement("div"),l.className="toontalk-box-hole toontalk-frontside toontalk-side",
l.toontalk_widget_side=a);return l};a.get_frontside=function(a){return g?g.get_frontside(a):this.get_element()};a.get_frontside_element=function(a){return this.get_element()};a.get_frontside=function(){return this};a.widget_side_dropped_on_me=function(a,e,g){var l=this.get_parent_of_frontside(),h=this.get_contents(),n,m,f;if(h)return h.widget_side_dropped_on_me&&h.widget_side_dropped_on_me(a,e,g);a.dropped_on_other&&a.dropped_on_other(this,e,g);e?(b.sounds&&b.sounds.fall_inside.play(),g=this.get_element(),
h=a.is_plain_text_element(),f=a.get_element(),$(f).css({"z-index":b.UTILITIES.next_z_index()}),m=$(f.parentElement).offset(),n=$(g).offset(),h||(f.style.left=e.pageX-m.left+"px",f.style.top=e.pageY-m.top+"px",$(f).addClass("toontalk-animating-element")),f.style.width=g.style.width,f.style.height=g.style.height,f.style.left=n.left-m.left+"px",f.style.top=n.top-m.top+"px",e=function(){$(f).removeClass("toontalk-animating-element");l.render();this.set_contents(a)}.bind(this),setTimeout(e,h||b.UTILITIES.has_animating_image(f)?
0:1200),l.robot_in_training()&&l.robot_in_training().dropped_on(a,this),a.save_dimensions&&a.set_size_attributes&&a.set_size_attributes($(g).width(),$(g).height()),a.is_backside()||l.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:f,where:"front",index:this.get_index()}))):(l.rerender(),this.set_contents(a));return!0};a.get_json=function(){return null};a.add_to_json=function(a){return a};a.copy=function(a){return b.box_hole.create(e)};a.match=function(){return"matched"};
a.get_type_name=function(a){return g?g.get_type_name(a):a?"empty holes":"empty hole"};a.is_of_type=function(a){return g?g.is_of_type(a):"empty hole"===a};a.get_box=function(){return this.get_parent_of_frontside()};a.update_display=function(){var a;g&&(a=this.get_frontside_element(),h(g,g.get_element(!0),$(a).width(),$(a).height()))};a.dereference=function(){return g?g.dereference():this};a.can_run=function(){return g&&g.can_run()};a.get_index=function(){return e};a.get_contents=function(){return g};
a.set_contents=function(a){var e=this.get_listeners("value_changed");e&&(g!==a&&e.forEach(function(b){b({type:"value_changed",old_value:g,new_value:a})}),g&&e.forEach(function(a){g.remove_listener("value_changed",a,!0)}),a&&e.forEach(function(b){a.add_listener("value_changed",b)}));g&&g.set_parent(void 0);(g=a)?(g.set_parent(this),b.debugging&&(this._debug_string="A hole containing "+g.to_debug_string()),g.set_visible(m)):b.debugging&&(this._debug_string=this.to_debug_string())};a.visible=function(){return this.get_parent_of_frontside().visible()};
a.set_visible=function(a){m=a;g&&g.set_visible(a)};a.remove=function(){g&&g.remove()};a.render=function(){g&&b.DISPLAY_UPDATES.pending_update(this)};a.rerender=function(){if(g&&this.visible())return this.render()};a.set_running=function(a){g&&g.set_running(a)};a.maintain_proportional_dimensions=function(){if(g)return g.maintain_proportional_dimensions()};a.removed_from_container=function(a,e,l,k){g?(e&&g.restore_dimensions(),this.set_contents(void 0),e&&this.get_parent_of_frontside().render()):k&&
b.UTILITIES.report_internal_error("Holes can't be removed from containers.")};a.temporarily_remove_contents=function(a,b){if(g)return this.get_parent_of_frontside().temporarily_remove_contents(a,b)};a.toString=function(){return g?g.toString():"_"};a.get_description=function(){return g?g.get_description():"_"};a.get_full_description=function(a){return g?g.get_full_description(a):"_"};a.is_backside=function(){return!1};a.get_widget=function(){return this.get_parent_of_frontside()};a.is_number=function(){return g?
g.is_number():!1};a.is_box=function(){return g?g.is_box():!1};a.is_scale=function(){return g?g.is_scale():!1};a.is_bird=function(){return g?g.is_bird():!1};a.is_nest=function(){return g?g.is_nest():!1};a.is_robot=function(){return g?g.is_robot():!1};a.is_element=function(){return g?g.is_element():!1};a.get_original_width=function(){if(g&&g.get_original_width)return g.get_original_width()};a.get_original_height=function(){if(g&&g.get_original_height)return g.get_original_height()};a.is_sensor=function(){return g?
g.is_sensor():!1};a.is_top_level=function(){return!1};a.is_plain_text_element=function(){return!1};a.get_active=function(){return g?g.get_active():!1};a.set_active=function(a,b){g&&g.set_active(a,b)};b.widget.has_parent(a);b.widget.has_listeners(a);if(b.debugging||b.logging)a.to_debug_string=function(a){var l=("the "+b.UTILITIES.ordinal(e)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box")).substring(0,a);return g?l+" which contains "+
g.to_debug_string(a):l+" which is empty"},a._debug_string=a.to_debug_string();return a}}}(window.TOONTALK);window.TOONTALK.box["function"]=function(){var d=b.create_function_table();d.add_function_object("box hole",function(b,a,g){return d.typed_bird_function(b,function(a,d){var c=Math.round(a.to_float());if(1>c)b.display_message("The box hole function bird cannot accept "+a+". She only accepts positive numbers.");else if(c>d.get_size())b.display_message("The box hole function bird cannot accept "+
a+". The box only has "+d.get_size()+" holes.");else return d.get_hole_contents(c-1)},["number","box"],2,"box hole",a,g)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. 1 for the first hole.","hole",["number","box"]);d.add_function_object("count holes",function(e,a,g){return d.typed_bird_function(e,function(a){return b.number.create(a.get_size())},["box"],1,"count holes",a,g)},"The bird will return with the number of holes the box has.",
"count holes",["box"]);d.add_function_object("fill hole",function(b,a,g){return d.typed_bird_function(b,function(a,d,c){var g=Math.round(a.to_float());if(1>g)b.display_message("The fill hole function bird cannot accept "+a+". She only accepts positive numbers.");else return g>d.get_size()&&d.set_size(g),d.set_hole(g-1,c),d},["number","box",void 0],3,"fill hole",a,g)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.",
"fill hole",["number","box",void 0]);d.add_function_object("split box",function(e,a,g){return d.typed_bird_function(e,function(a,d){var c=Math.round(a.to_float()),g=d.get_size();if(0>c)e.display_message("The box split function bird cannot accept "+a+". She only accepts zero or positive numbers.");else if(c>g)e.display_message("The box split function bird cannot accept "+a+". The box only has "+g+" holes.");else{d.get_holes();var g=g-c,h=b.box.create(g),k;for(k=0;k<g;k++)h.set_hole(k,d.get_hole_contents(k+
c));d.set_size(c);return b.box.create(2,!1,[d,h])}},["number","box"],2,"split box",a,g)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.","split",["number","box"]);d.add_function_object("merge boxes",function(e,a,g){return d.typed_bird_function(e,function(){var a=0,d,c,e,g;if(0===arguments.length)return b.box.create(0);c=arguments[0];for(d=0;d<arguments.length;d++)a+=arguments[d].get_size();e=c.get_size();c.set_size(a);
for(d=1;d<arguments.length;d++)for(g=arguments[d].get_size(),a=0;a<g;a++)c.set_hole(e,arguments[d].get_hole_contents(a)),e++;return c},["box"],void 0,"merge boxes",a,g)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);return d.get_function_table()}()})(window.TOONTALK);(function(){var b,h,d,e,a;window.TOONTALK.bird=function(d){var e=Object.create(d.widget),l=function(a,b,e){var l=a.get_function_type();a=a.get_function_object();var h=Object.keys(TOONTALK[l]["function"]),n=h.map(function(a){return TOONTALK[l]["function"][a].title}),h=d.UTILITIES.create_select_menu("functions",h,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",n);b=b.get_element();var m;a&&$(h.menu).val(a.name).selectmenu("refresh");
$(h.menu).on("selectmenuselect",function(a){e.set_function_name(a.target.value);e.get_description()||(m=$(e.get_backside_element()).find(".toontalk-description-input"),0<m.length&&m.get(0).setAttribute("placeholder",e.get_default_description()))});$(h.menu).selectmenu("menuWidget").addClass("toontalk-select-menu");b.insertBefore(h.container,b.firstChild)};e.create=function(c,t){var q=Object.create(e),k=[],r=[];b=function(a){c=a};q.is_bird=function(){return!0};q.widget_side_dropped_on_me=function(a,
b,d,e,g){var l,k,h;if(c){if(c.has_ancestor(a))return a.display_message("Bird can't take its nest to its nest!"),!1;!(c.visible()||this.visible()||c.any_nest_copies_visible())||d&&d.visible()&&!d.animate_consequences_of_actions()?(h=function(){try{c.add_to_contents(a,b,d)}catch(e){if(e.wait_for_nest_to_receive_something)e.wait_for_nest_to_receive_something.run_when_non_empty(h,this);else throw console.error(e.stack),e;}},h(),d&&d===a.robot_waiting_before_next_step&&(a.robot_waiting_before_next_step=
void 0,d.run_next_step())):(g||a.save_dimensions(),l=this.get_frontside_element(),setTimeout(function(){$(l).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside().rerender()}.bind(this)),a.set_visible(c.visible()),d&&!e&&(a.robot_waiting_before_next_step=d,d.run_next_step&&(k=function(){a.robot_waiting_before_next_step=void 0;d.run_next_step()})),c.animate_bird_delivery(a,this,k,b,d))}else console.log("TODO: handle drop on a nestless bird -- just removes other?");
b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);return!0};q.animate_delivery_to=function(a,b,e,l,h,m,q,t){var H=!!e,w=this.get_parent_of_frontside(),I=this.get_frontside_element(!0),P=$(I).position();$(I).width();var G=this.closest_visible_ancestor_or_frontside(),B=$(G.get_frontside_element()).offset(),M=function(){var a,b;d.sounds&&d.sounds.bird_fly.pause();H?this.remove():this.visible()&&(a=function(){$(I).removeClass("toontalk-bird-morph-to-static");$(I).addClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"));w&&w.get_widget().rerender()}.bind(this),I.style.position=v,d.UTILITIES.set_css(I,P),p&&p.appendChild(I),w&&(w.get_widget().is_top_level()?this.rerender():w.get_widget().rerender()),R&&(ka.remove_backside_widget(this,!0),R(),k&&(b=k,k=[],r=[],b.forEach(function(a){a()}))),d.UTILITIES.add_animation_class(I,"toontalk-bird-morph-to-static"),d.UTILITIES.add_one_shot_event_handler(I,"animationend",1E3,a));m&&m()}.bind(this),N=function(){try{e.add_to_contents(a,
q,t,this,!0)}catch(b){if(b.wait_for_nest_to_receive_something){b.wait_for_nest_to_receive_something.run_when_non_empty(N,this);m&&(m(),m=void 0);return}console.error(b.stack);throw b;}O($(I).offset());d.UTILITIES.set_timeout(function(){this.fly_to(B,M,t)}.bind(this))}.bind(this),Q=function(a,b){b||(b=d.UTILITIES.widget_side_of_element(a));this.element_to_display_when_flying=a;b&&(this.update_display(),setTimeout(function(){b.update_display()}));$(a).addClass("toontalk-carried-by-bird");$(a).removeClass("toontalk-temporarily-set-down");
d.UTILITIES.set_timeout(function(){var c={left:"",top:"",position:""};b&&!b.use_scaling_transform&&(c.width="",c.height="");1<a.toontalk_x_scale&&(c["font-size"]="inherit");d.UTILITIES.set_css(a,c);this.update_display()}.bind(this))}.bind(this),O=function(b){var c;this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),b?(c={"z-index":d.UTILITIES.next_z_index()},0<this.element_to_display_when_flying.width_before_carry&&(c.width=this.element_to_display_when_flying.width_before_carry),
0<this.element_to_display_when_flying.height_before_carry&&(c.height=this.element_to_display_when_flying.height_before_carry),1<this.element_to_display_when_flying.toontalk_x_scale&&(c["font-size"]="inherit"),d.UTILITIES.set_css(this.element_to_display_when_flying,c),this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying),d.UTILITIES.set_absolute_position(this.element_to_display_when_flying,b),(b=a.get_parent_of_frontside())&&!b.is_backside()&&b.rerender()):
$(this.element_to_display_when_flying).remove(),this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),J,D,p,v,y,E,R,T,U,ca,ka;e||(e=c);ca=a.get_element(!0);Q(ca,a);b.is_function_nest()||(D=b.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!b.visible()&&!this.visible()||!b.is_function_nest()&&!d.UTILITIES.visible_element(D))e.add_to_contents(a,q,t,this,!0);else if(d.sounds&&d.sounds.bird_fly.play(),$(I).removeClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static")),b.is_function_nest()||(J=$(D).offset(),E=$(e.get_frontside_element()).closest(".toontalk-backside-of-top-level")),E&&E.is("*")||(E=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")),(b=E.offset())||(b={left:0,top:0}),l?B={left:l+b.left,top:h+b.top}:0===B.left&&0===B.top&&(B={left:-ca.clientWidth,top:b.top+E.height()/2}),J||(J={left:-2*ca.clientWidth,top:b.top+E.height()/2}),p=I.parentElement,G=$(I).width(),y=$(I).height(),
v=I.style.position,I.style.position="absolute",ka=this.top_level_widget(),w&&w.temporarily_remove_contents&&(R=w.temporarily_remove_contents(this,!0))&&this.get_widget().add_to_top_level_backside(this),0<E.length&&E.get(0).appendChild(I),d.UTILITIES.set_css(I,{left:l||B.left-b.left,top:h||B.top-b.top,width:G,height:y}),d.logging&&0<=d.logging.indexOf("bird")&&console.log(this.to_debug_string(50)+" from "+(l||B.left-b.left)+", "+(h||B.top-b.top)+" to "+J.left+", "+J.top),(T=e.get_contents_element&&
e.get_contents_element())&&e.visible()&&(!t||t.animate_consequences_of_actions())){l=$(D).width();h=$(D).height();U=$(D).offset();b.max_left=b.left+E.width();b.max_top=b.top+E.height();J.left+=l;J.top+=h;var na={left:Math.min(U.left+l,b.max_left-l),top:Math.min(U.top+h,b.max_top-h)},ra={left:Math.max(U.left-l,b.left),top:Math.max(U.top-h,b.top)};J=function(){var b=function(){e.visible()?(e.set_locked(!0),this.fly_to(U,Ca,t,300)):(e.add_to_contents(a,q,t,this,!0),m&&(m(),m=void 0))}.bind(this);$(ca).addClass("toontalk-temporarily-set-down");
O(na);e.get_locked()?e.run_when_unlocked(b):b()}.bind(this);var Ca=function(){Q(T);this.fly_to(ra,ta,t,300)}.bind(this),ta=function(){$(T).addClass("toontalk-temporarily-set-down");O(ra);this.fly_to(na,Ba,t,300)}.bind(this),Ba=function(){Q(ca,a);this.fly_to(U,pa,t,300)}.bind(this),pa=function(){var b=e.get_contents_dimensions();a.is_plain_text_element()&&$(ca).addClass("toontalk-temporarily-set-down");O(U);a.is_plain_text_element()||d.UTILITIES.set_css(a.get_element(),b);this.fly_to(ra,Ga,t,300)}.bind(this),
Ga=function(){Q(T);this.fly_to(U,Fa,t,300)}.bind(this),Fa=function(){$(ca).removeClass("toontalk-temporarily-set-down");e.set_locked(!1);O();e.update_display();N()}.bind(this);this.fly_to(na,J,t,300)}else this.fly_to(J,N,t,300)};q.get_json=function(a,b,e){var l;c?(l=function(a,c){b({type:"bird",nest:a},c)},d.UTILITIES.get_json(c,a,l,e)):b({type:"bird"},e)};q.copy=function(b){var d,e,g;if(b)if(b.just_value)d=this.create(void 0,this.get_description());else{if((g=c&&c.get_guid())&&b.nests_copied&&b.nests_copied[g]){d=
b.nests_copied[g][0];a.call(d);for(e=1;e<b.nests_copied[g].length;e++)h.call(b.nests_copied[g][e],d);d=this.create(d,this.get_description())}else d=this.create(c,this.get_description());b.birds_copied||(b.birds_copied={});g&&(b.birds_copied[g]||(b.birds_copied[g]=[]),b.birds_copied[g].push(d))}else d=c&&c.is_function_nest()?this.create(c.copy(),this.get_description()):this.create(c,this.get_description());return this.add_to_copy(d,b)};q.run_when_non_empty=function(a,b){0>r.indexOf(b)&&(k.push(a),
r.push(b))};q.create_backside=function(){var a=d.bird_backside.create(this);c&&c.is_function_nest()&&l(c,a,this);return a};q.get_help_URL=function(){return c&&c.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};q.is_function_bird=function(){return c&&c.is_function_nest()};q.get_custom_title_prefix=function(){var a;return c?c.is_function_nest()&&(a=c.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":"This bird no longer knows where her nest is. She'll get rid of anything you give her."};
q.toString=function(a){return c?c.is_function_nest()?c.get_function_object().toString():"bird":a&&"conditions"===a.role?"any bird":"bird without a nest"};q.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird a box to compute the '"+c.get_function_object().name+"' of "+this.get_function_type(!0)+".":"a bird who takes things to her nest."};q.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var b;b=a.get_element();b.setAttribute("toontalk_name",
this.get_name());d.UTILITIES.give_tooltip(b,this.get_title());$(b).is(".toontalk-bird, .toontalk-side-animating")||($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),b.addEventListener("dragenter",function(a){0<=b.className.indexOf("toontalk-bird-static")&&($(b).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),d.UTILITIES.add_animation_class(b,"toontalk-bird-gimme"))}.bind(this)),b.addEventListener("dragleave",
function(a){$(b).is(".toontalk-bird-gimme")&&($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside()&&this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?b.appendChild(this.element_to_display_when_flying):$(b).children(".toontalk-side").remove()};q.set_function_name=function(a){c&&c.is_function_nest()&&c.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&
this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};q.get_function_type=function(a){return c.get_function_type(a)};q.get_class_name_with_color=function(a){return c&&c.get_class_name_with_color?c.get_class_name_with_color(a):a};q.get_name=function(){return c?c.get_name():""};c&&c.set_name&&(q.set_name=function(a,b){return c.set_name(a,b)});q.add_standard_widget_functionality(q);
q.set_description(t);d.debugging&&(q._debug_id=d.UTILITIES.generate_unique_id(),q._debug_string=q.to_debug_string());return q};e.create_function=function(a,b,l){return e.create(d.nest.create_function(b,a,l||d.UTILITIES.get_first_property(d[a]["function"])))};e.match=function(a){if(a.match_with_any_bird)return a.match_with_any_bird(this);this.last_match=a;return this};e.match_with_any_bird=function(){return"matched"};e.fly_to=function(a,b,e,l){var h=this.get_frontside_element(),n=$(h).offset(),m="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*
(Math.atan2(a.top-n.top,a.left-n.left)/Math.PI+1))%8];$(h).position();var f=function(){$(h).removeClass(m);l?setTimeout(b,e?e.transform_step_duration(l):l):b()}.bind(this);setTimeout(function(){$(h).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));d.UTILITIES.add_animation_class(h,m);this.animate_to_absolute_position(a,f,e&&e.transform_animation_speed(d.UTILITIES.default_animation_speed))}.bind(this),1)};e.get_type_name=function(a,b){return a?b&&this.is_function_bird()?
"function birds":"birds":"bird"};e.maintain_proportional_dimensions=function(){return!0};e.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};e.drop_on=function(a,b,d){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,d)};d.creators_from_json.bird=function(a,b){return d.bird.create(d.UTILITIES.create_from_json(a.nest,b),a.description)};return e}(window.TOONTALK);window.TOONTALK.bird_backside=function(a){return{create:function(b){var d=
a.backside.create(b);d.add_description_setting();d.add_name_setting();d.get_element().appendChild(a.backside.create_advanced_settings_button(d,b));return d}}}(window.TOONTALK);window.TOONTALK.nest=function(g){var m=Object.create(g.widget),l,c=0,t=0;m.default_maximum_capacity=10;m.maximum_capacity=m.default_maximum_capacity;m.create=function(q,k,r,n,u,f){var x=Object.create(m),A=[],F=[],L=[],z=!1,H,w,I;k||(k=[]);u||(c++,u=c);h=function(a){n&&e.call(n,this);n=a;r=a.get_guid();d.call(a,this)};a=function(){n&&
e.call(n,this);n=void 0;r=g.UTILITIES.generate_unique_id()};d=function(a){l||(l=g.UTILITIES.generate_unique_id());this[l](a)};e=function(a){l||(l=g.UTILITIES.generate_unique_id());this[l](a,!0)};x.is_nest=function(){return!0};x.get_guid=function(){return r};x.matched_by=function(a){return 0<k.length?g.UTILITIES.match(a,k[0]):[[this,a]]};x.run_when_non_empty=function(a,b){0<k.length?a(k[0]):0>L.indexOf(b)&&(A.push(a),L.push(b))};x.dereference=function(){return 0<k.length?k[0]:this};x.match=function(a){if(0<
k.length)return k[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};x.add_to_contents=function(a,b,c,d,e){var f=k.push(a),l=this.visible();f>m.maximum_capacity&&c&&z&&!c.visible()&&!l&&(g.logging&&0<=g.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" postponing addition of "+a.to_debug_string(50)+" by "+c.to_debug_string(50)+". Stack is "+k.length+" long. "+F.length+" previously postponed."),c.add_body_finished_listener(function(){c.set_stopped(!0);
F.push(function(){c.set_stopped(!1);c.run_actions()})}));g.logging&&0<=g.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+a.to_debug_string()+" nest now contains "+k.length+" widgets.");a.is_backside()?a.set_parent_of_backside(this):a.set_parent_of_frontside(this);H&&!e&&(d?H.forEach(function(e){e.has_ancestor(a.get_widget())||e.animate_bird_delivery(g.UTILITIES.copy_side(a),d,void 0,b,c)}):H.forEach(function(d){d.has_ancestor(a.get_widget())||d.add_to_contents(g.UTILITIES.copy_side(a,
!1,!0),b,c)}));1===f?(z=!1,0<A.length&&(e=A,A=[],L=[],e.forEach(function(b){b(a)})),a.set_visible(l),l?this.get_containing_widget().rerender():a.hide()):(a.hide(),a.set_visible(!1));this.rerender()};x.animate_bird_delivery=function(a,b,c,d,e){var f,l,k;void 0===this.get_parent_of_frontside()?(a.remove(),c&&c()):(b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,e),H&&(f=$(b.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),l=b.get_parent_of_frontside().get_element(),
k=this.visible(),H.forEach(function(c){var p=g.UTILITIES.copy_side(a,!1,k),h,n;c.has_ancestor(a.get_widget())||(f&&(c.visible()||k)?(h=b.copy({just_value:!0}),n=h.get_frontside_element(!0),l.appendChild(n),h.animate_delivery_to(p,c,c,f.left,f.top,void 0,d,e)):c.add_to_contents(p,void 0,e))})))};x.get_contents_element=function(){if(0<k.length)return k[0].get_element()};x.get_locked=function(){return this.locked_for_animating_deliveries};x.set_locked=function(a){this.locked_for_animating_deliveries=
a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};x.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};x.removed_from_container=function(a,b,c){a=k.shift();g.logging&&0<=g.logging.indexOf("nest")&&(a?console.log(this.to_debug_string(50)+" removed "+a.to_debug_string()+" remaining widgets is "+k.length):console.log(this.to_debug_string(50)+" nothing left to remove."));if(a)return b||
(z=!0),a.is_backside()?a.set_parent_of_backside(void 0):a.get_widget().set_parent_of_frontside(void 0),this.visible()&&(a.restore_dimensions&&a.restore_dimensions(),0<k.length&&(k[0].set_visible(!0),$(k[0].get_element()).show()),this.get_containing_widget().is_top_level()?this.render():this.get_containing_widget().render()),k.length<=m.maximum_capacity&&0<F.length&&(g.logging&&0<=g.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" running "+F.length+" postponed additions. Stack is "+
k.length+" long."),m.maximum_capacity=Number.MAX_VALUE,F.forEach(function(a){a()}),m.maximum_capacity=m.default_maximum_capacity,F=[]),a;c&&g.UTILITIES.report_internal_error("Nothing removed from nest!")};x.dereference_path=function(a,b){if(0===k.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(k)return k[0].dereference_path(a,b);b.display_message("Robot expected to find something on a nest that it could get "+g.path.toString(a)+". But the nest is empty.");return this};
x.dereference_contents=function(a,b){var c,d,e,f,l,h,n,p,m;return 0===k.length?{wait_until_this_nest_receives_something:this}:a.removing_widget?(c=k[0],b.remove_from_container(c,this),this.visible()&&(h=this.get_frontside_element(),d=$(h).offset(),e=$(h).closest(".toontalk-backside-of-top-level"),(f=e.offset())||(f={left:0,top:0}),l=c.get_element(!0),n=$(h).width(),h=$(h).height(),p=.1*n+d.left-f.left,m=.1*h+d.top-f.top,g.UTILITIES.set_css(l,{width:n*g.nest.CONTENTS_WIDTH_FACTOR,height:h*g.nest.CONTENTS_HEIGHT_FACTOR}),
0<e.length&&b.add_watched_step_end_listeners(function(){c.get_parent()&&(e.get(0).appendChild(l),g.UTILITIES.set_css(l,{left:p,top:m}))})),c):a.next?k[0].get_widget().dereference_path(a.next,b):k[0].get_widget()};x.get_json=function(a,b,c){var d=[],e=function(){var e=function(a,c){b({type:"nest",contents:d,guid:r,original_nest:a,serial_number:u,name:this.get_name()},c)}.bind(this);n?g.UTILITIES.get_json(n,a,e,c):e(void 0,c)}.bind(this);g.UTILITIES.get_json_of_array(k,d,0,a,e,c)};x.copy=function(a){var c,
d,e,f;if(a&&a.just_value){if(0<k.length&&(c=k[0].copy(a),!a.copy_covered_nests))return c;d=g.nest.create(this.get_description(),[],"in a robot's condition",void 0,u,this.get_name());c&&d.add_to_contents(c);return d}c=g.UTILITIES.copy_widget_sides(k,a);a?a.fresh_copy?d=g.nest.create(this.get_description(),c,r&&g.UTILITIES.generate_unique_id()):(e=n||this,a.birds_copied&&a.birds_copied[r]?(f=e.get_guid(),a.nests_copied&&a.nests_copied[f]?(d=a.nests_copied[f][0].copy(),a.nests_copied[f].forEach(function(a){h.call(a,
d)})):d=g.nest.create(this.get_description(),c,g.UTILITIES.generate_unique_id()),a.birds_copied[r].forEach(function(a){b.call(a,d)})):d=g.nest.create(this.get_description(),c,r,e,u,this.get_name()),a.nests_copied||(a.nests_copied={}),a.nests_copied[e]?a.nests_copied[f].push(d):a.nests_copied[f]=[d]):d=g.nest.create(this.get_description(),c,r,n||this,u,this.get_name());return this.add_to_copy(d,a)};x.has_contents=function(){return 0<k.length};x.set_contents=function(a){k=a};x.dropped_on_other=function(a,
b,c){var d,e,f,l,k,h,p;if(!r){r=g.UTILITIES.generate_unique_id();g.debugging&&(this._debug_string=this.to_debug_string());d=g.bird.create(this);if(c){c.add_newly_created_widget(d);if(!this.visible())return;this.robot_waiting_before_next_step=c}b&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(d);g.sounds&&setTimeout(function(){g.sounds.hatching.play()},1E3);this.rerender();e=this.get_frontside_element(!0);g.UTILITIES.add_animation_class(e,"toontalk-hatch-egg");k=function(){var k,
n,m;if(a.is_backside())k=a;else if((k=g.UTILITIES.widget_side_of_jquery($(e).closest(".toontalk-backside-of-top-level")))||(k=g.UTILITIES.widget_side_of_jquery($(a.get_widget().get_frontside_element(!0)).closest(".toontalk-backside-of-top-level"))),k)k=k.is_backside()?k:k.get_backside();else{g.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");return}n=k.get_element();m=$(n).offset();f=d.get_frontside_element(!0);$(f).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
g.UTILITIES.add_animation_class(f,"toontalk-fly-southwest");l=g.UTILITIES.relative_position(e,n);g.UTILITIES.set_css(f,{left:l.left,top:l.top});b&&this.robot_in_training()?k.widget_side_dropped_on_me(d,b,void 0,!0):k.widget_side_dropped_on_me(d,b);$(e).removeClass("toontalk-hatch-egg").addClass(this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&g.UTILITIES.set_css(e,{left:l.left-5,top:l.top+
45});this.get_parent_of_frontside().render();p=function(){$(f).removeClass("toontalk-fly-southwest");g.UTILITIES.set_timeout(function(){g.UTILITIES.add_animation_class(f,"toontalk-fly-down");$(f).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));h=function(){var a=function(){$(f).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);$(f).removeClass("toontalk-fly-down");
g.UTILITIES.add_animation_class(f,"toontalk-bird-morph-to-static");g.UTILITIES.add_one_shot_event_handler(f,"animationend",1E3,a);c&&(this.robot_waiting_before_next_step=void 0,c.run_next_step());d.update_display()}.bind(this);g.UTILITIES.add_one_shot_event_handler(e,"animationend",1E3,h)}.bind(this))}.bind(this);$(f).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));d.animate_to_absolute_position({left:Math.max(10,l.left-70)+m.left,top:Math.max(10,l.top+
70)+m.top},p,c&&c.transform_animation_speed(g.UTILITIES.default_animation_speed));this.rerender()}.bind(this);g.UTILITIES.add_one_shot_event_handler(e,"animationend",2E3,k)}return!0};x.widget_side_dropped_on_me=function(a,b,c){b&&a.save_dimensions&&a.save_dimensions();0===k.length?(this.add_to_contents(a,b,c),a.dropped_on_other?a.dropped_on_other(this,b,c):b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(k[0],b,c);return!0};x.drop_on=function(a,b,c){return a.widget_side_dropped_on_me?
(a.widget_side_dropped_on_me(this,b,c),!0):!1};x.element_to_highlight=function(){return 0===k.length?this.get_frontside_element():k[0].get_frontside_element()};x.update_display=function(){var a=this.get_frontside(!0),b=this.get_backside(),c,d,e,f,a=a.get_element();0<k.length?(a.setAttribute("toontalk_name",""),c=k[0],c.is_backside()?(f=c.get_element(!0),c.update_display(),c.scale_to_fit(f,a)):(c.set_visible(!0),c.render(),f=k[0].get_element(!0),$(f).show()),d=$(a).width(),e=$(a).height(),0<d&&0<e&&
g.UTILITIES.set_timeout(function(){var a=this.get_contents_dimensions();a&&(g.UTILITIES.set_css(f,{width:a.width,height:a.height,left:d*(1-g.nest.CONTENTS_WIDTH_FACTOR)/2,top:e*(1-g.nest.CONTENTS_HEIGHT_FACTOR)/2}),c.set_size_attributes&&c.set_size_attributes(a.width,a.height))}.bind(this),2),$(a).parent().is(".toontalk-box-hole")&&!$(a).parent().is(".toontalk-scale-half")?(a.parentElement.appendChild(f),$(f).css({"z-index":g.UTILITIES.next_z_index()})):a.appendChild(f),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest")),
k[0].is_backside()?c.set_parent_of_backside(this):c.set_parent_of_frontside(this)):(a.setAttribute("toontalk_name",this.get_name()),r?($(a).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest"))):g.UTILITIES.add_animation_class(a,this.get_class_name_with_color("toontalk-nest-with-egg")));g.UTILITIES.give_tooltip(a,this.get_title());$(a).addClass("toontalk-nest");b&&b.rerender()};l||(l=g.UTILITIES.generate_unique_id());
x[l]=function(a,b){if(!H){if(b)return;H=[]}b?H.splice(H.indexOf(a),1):H.push(a)};x.get_contents_dimensions=function(){var a,b=this.get_frontside_element();a=$(b).parent().is(".toontalk-box-hole")&&!$(b).parent().is(".toontalk-scale-half")?b.parentElement:b;b=$(a).width();a=$(a).height();b*=g.nest.CONTENTS_WIDTH_FACTOR;a*=g.nest.CONTENTS_HEIGHT_FACTOR;var c=k[0],d;if(c)return d=c.is_box()?1:2,c=c.get_border_size?d*c.get_border_size(b,a):0,{width:b-c,height:a-c}};x.get_path_to=function(a,b){var c,d;
if(0<k.length){c=k[0].get_widget();if(c===a)return g.path.to_widget_on_nest();if(c.get_path_to&&(d=g.path.to_widget_on_nest(),c=c.get_path_to(a,b)))return d.next=c,d}};x.walk_children=function(a){if(0<k.length)return a(k[0])};x.top_contents_is=function(a){return 0<k.length&&k[0]===a};x.any_nest_copies_visible=function(){var a=!1;if(!H)return!1;H.some(function(b){b.visible()&&(a=!0)});return a};x.compare_with=function(a){if(0<k.length)return k[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};
x.compare_with_nest=function(a){return 0===k.length?0:1};x.compare_with_number=function(a){return 0<k.length?k[0].compare_with(a):-1};x.get_class_name_with_color=function(a){return u?a+["","-magenta","-yellow"][u%3]:a};x.generate_name=function(){t++;return"#"+t.toString()};x.has_name(x);w=x.set_name;x.set_name=function(a,b){var c=this.get_name();if(!w.call(this,a,b))return!1;b&&$(".toontalk-bird").each(function(){this.getAttribute("toontalk_name")===c&&g.UTILITIES.widget_side_of_element(this).rerender()})};
x.set_name(f);x.compare_with_box=x.compare_with_number;x.compare_with_scale=x.compare_with_number;x.add_standard_widget_functionality(x);I=x.set_visible;x.set_visible=function(a){I.call(this,a);a||this.set_locked(!1)};x.set_description(q);g.debugging&&(x._debug_id=g.UTILITIES.generate_unique_id(),x._debug_string=x.to_debug_string());n&&r&&(l||(l=g.UTILITIES.generate_unique_id()),n[l](x));return x};m.create_function=function(a,b,c){var d=function(){return!1},e=g[b]&&g[b]["function"]&&g[b]["function"][c],
d={get_function_type:function(a){return g[b].get_type_name(a)},get_function_object:function(){return e},set_function_name:function(a){if(c===a)return!1;c=a;e=g[b]&&g[b]["function"]&&g[b]["function"][c];this.add_to_contents=e.respond_to_message;return!0},is_function_nest:function(){return!0},copy:function(){return g.nest.create_function(a,b,c)},animate_bird_delivery:function(a,b,c,d,e){b.animate_delivery_to(a,this,void 0,void 0,void 0,c,d,e)},get_json:function(a,c,d){c({type:"function_nest",function_type:b,
function_name:e?e.name:g.UTILITIES.get_first_property(g[b]["function"])},d)},add_to_json:g.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return e.short_name},has_ancestor:d,visible:d,any_nest_copies_visible:d,is_backside:d};g.widget.has_parent(d);g.widget.has_description(d);g.widget.add_sides_functionality(d);d.set_description(a);e?(d.add_to_contents=e.respond_to_message,g.debugging&&(d._debug_id=g.UTILITIES.generate_unique_id(),d._debug_string="a function nest that "+
e.toString())):g.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+b+"."+c+" is not defined.");return d};g.creators_from_json.function_nest=function(a,b){return g.nest.create_function(a.description,a.function_type,a.function_name)};m.create_backside=function(){return g.nest_backside.create(this)};m.match_nest_with_nest=function(a){return"matched"};m.toString=function(){return"nest"};m.get_default_description=function(){return"a nest that receives things from its birds."};
m.get_help_URL=function(){return"docs/manual/birds-nests.html"};m.get_type_name=function(a){return a?"nests":"nest"};m.maintain_proportional_dimensions=function(){return!0};m.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};m.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};g.creators_from_json.nest=function(a,b){var c=!a.original_nest&&a.guid&&b&&b.guid_to_nest_table&&b.guid_to_nest_table[a.guid];c||(c=g.nest.create(a.description,
g.UTILITIES.create_array_from_json(a.contents,b),a.guid,a.original_nest&&g.UTILITIES.create_from_json(a.original_nest,b),a.serial_number,a.name),b.guid_to_nest_table[a.guid]=c);return c};m.CONTENTS_WIDTH_FACTOR=1;m.CONTENTS_HEIGHT_FACTOR=1;return m}(window.TOONTALK);window.TOONTALK.nest_backside=function(a){return{create:function(b){b=a.backside.create(b);b.add_description_setting();b.add_name_setting();return b}}}(window.TOONTALK)})();window.TOONTALK.scale=function(b){var h=Object.create(b.widget);h.create=function(d,e,a,g,h){var l=function(){a.rerender()},c,t,q;a||(a=b.box.create(2,void 0,d,e,h||""));c=a.get_json;t=a.copy;q=a.get_path_to;a.is_scale=function(){return!0};a.copy=function(c){var d;this.get_name();c||(c={});d=t.call(this,c);d=b.scale.create(void 0,void 0,d,c.just_value&&this.get_state());return a.add_to_copy(d,c)};a.get_json=function(a,b,d){var e=function(a,c){a.type="scale";a.inactive_state=this.get_inactive_state();
b(a,c)}.bind(this);c.call(this,a,e,d)};a.get_path_to=function(a,b){var c=q.call(this,a,b);c&&(c.true_type="scale");return c};a.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c)};a.widget_side_dropped_on_me=function(a,b,c){var d=this.get_hole_contents(0),e=this.get_hole_contents(1),g;a.dropped_on_other&&a.dropped_on_other(this,b,c);if(d&&!e)return this.get_hole(1).widget_side_dropped_on_me(a,b,c),!0;if(!d&&(e||!b))return this.get_hole(0).widget_side_dropped_on_me(a,
b,c),!0;g=this.which_hole(b,!1);if(0===g){if(d){if(d.drop_on)return a.drop_on(d,b,c);return}}else if(e){if(e.drop_on)return a.drop_on(e,b,c);return}this.get_hole(g).widget_side_dropped_on_me(a,b,c);return!0};a.which_hole=function(c,d){var e=a.get_frontside_element(),g=$(e).offset(),e=b.UTILITIES.get_element_width(e),g=c.clientX-(g.left+e/2),e=d?e/10:0;return-g>e?0:g>e?1:-1};a.get_inactive_state=function(){return g};a.update_display=function(){var a=this.get_frontside_element(!0),c=$(a),d=$(a).children(".toontalk-scale-half"),
e=$(a).parent(),e=e.is(".toontalk-backside")||c.is(".toontalk-conditions-contents")?a:e.get(0),f=$(e).width()||c.width(),g=$(e).height()||c.height(),l,h;c.is(".toontalk-top-level-resource")?h="toontalk-scale-balanced":(l=this.get_state(),h="undefined"===typeof l?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][l+1]);c.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");
c.addClass(h);c.addClass("toontalk-scale");c=b.UTILITIES.scale_to_fit(a,e,123,91);0===f&&(f=1);0===g&&(g=1);f/=c.x_scale;g/=c.y_scale;2===d.length?d.each(function(a,c){b.UTILITIES.set_timeout(function(){var d=this.get_hole(a),e=d.get_contents(),d=(e||d).get_element(!0),l,k,n,m;b.UTILITIES.set_css(c,{left:a*f*.5,top:0,width:.5*f,height:g});c!==d&&(l=0===a?-.05*f:.15*f,k="toontalk-scale-balanced"===h?.1*g:0===a&&"toontalk-scale-left_heavier"===h||1===a&&"toontalk-scale-right_heavier"===h?.25*g:1===
a&&"toontalk-scale-left_heavier"===h||0===a&&"toontalk-scale-right_heavier"===h?-.1*g:.2*g,n=.4*f,m=.4*g,$(d).css({left:l,top:k,width:n,height:m}),e&&(e.set_location_attributes&&e.set_location_attributes(l,k),e.set_size_attributes&&e.set_size_attributes(n,m),e.is_backside()&&(e.update_display(),e.scale_to(n,m)),e.render()),c.appendChild(d))}.bind(this))}.bind(this)):(this.get_holes().forEach(function(b,c){var d=b.get_element();b.get_contents();0===c?$(d).addClass("toontalk-left_scale  toontalk-scale-half"):
$(d).addClass("toontalk-right_scale toontalk-scale-half");a.appendChild(d);b.update_display()}),setTimeout(function(){this.render()}.bind(this),100));b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string())};a.render=function(){b.DISPLAY_UPDATES.pending_update(this)};a.get_type_name=function(a){return a?"scales":"scale"};a.get_help_URL=function(){return"docs/manual/scales.html"};a.toString=function(){var a=this.get_hole_contents(0),c=this.get_hole_contents(1),
d,e,f;switch(this.get_state()){case -1:d="scale leaning to the right";break;case 1:d="scale leaning to the left";break;case 0:d="balanced scale";break;default:if(d="unbalanced scale",!e&&!f)return d}e=a?"contains "+b.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";f=c?"contains "+b.UTILITIES.add_a_or_an(c.get_full_description()):"is empty";return d+" and the left pan "+e+" and the right pan "+f};a.create_backside=function(){return b.scale_backside.create(this)};a.get_state=function(){var a=
this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);b=this.get_hole_contents(1);if(a||b)if(a)if(b){if(a=a.dereference(),b=b.dereference(),a.get_widget().compare_with)return a.get_widget().compare_with(b.get_widget())}else return 1;else return-1};a.match=function(a){if(a.match_with_scale)return a.match_with_scale(this);this.last_match=a;return this};a.match_with_scale=function(a){var b;return(b=this.get_hole_contents(0))&&b.is_nest()&&!b.has_contents()||(b=this.get_hole_contents(1))&&
b.is_nest()&&!b.has_contents()?[[b,this]]:this.get_state()!==a.get_state()?(a.last_match=this,a):this.match_with_this_scale(a)};a.match_with_this_scale=function(a){var c=[],d,e,f;for(d=0;2>d;d++)if(f=a.get_hole_contents(d))if(e=this.get_hole_contents(d)){e=b.UTILITIES.match(f,e);if(e.is_widget)return e;"matched"!==e&&(c=0===c.length?e:c.concat(e))}else if(e=this.get_contents_temporarily_removed(d))c.push(e);else return a.last_match=this,a;return 0<c.length?c:"matched"};a.match_with_this_box=function(a){a.last_match=
this;return a};a.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};a.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};a.get_name_input_label=void 0;a.generate_name=function(){return""};a.get_hole(0).add_listener("value_changed",l);a.get_hole(1).add_listener("value_changed",l);a.get_hole_contents(0)&&a.get_hole_contents(0).add_listener("value_changed",l);a.get_hole_contents(1)&&a.get_hole_contents(1).add_listener("value_changed",
l);a.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};a.get_default_description=function(){return"a scale for comparing things."};a.set_name=void 0;
b.debugging&&(a._debug_id=b.UTILITIES.generate_unique_id(),a._debug_string=a.to_debug_string());return a};b.creators_from_json.scale=function(d,e){return h.create(b.UTILITIES.create_array_from_json(d.contents,e),d.description,void 0,d.inactive_state,d.name)};return h}(window.TOONTALK);window.TOONTALK.scale_backside=function(b){return{create:function(h){var d=b.backside.create(h);d.add_description_setting();d.get_element().appendChild(b.backside.create_advanced_settings_button(d,h));return d}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(b){var h=function(a,d,e,l,c){var h;e.current_action_name=d;(a=b.path.get_path_to(a,e,!0))?(l||(l={}),h=Date.now(),l.time=h-e.time_of_last_step,e.time_of_last_step=h,e.add_step(b.robot_action.create(a,d,l),c)):console.log("No path found for "+d);e.current_action_name=void 0},d=Object.create(b.widget),e=0;d.create=function(a,e,h,l,c,t,q,k,r){var n=Object.create(d),u,f,x,A,F=[],L=[],z,H,w,I,P,G,B,M,N;h||(h=b.actions.create());f||(f=n);a&&a.set_parent_of_frontside(n);
n.is_robot=function(){return!0};n.get_frontside_conditions=function(){return a};n.set_frontside_conditions=function(b){(a=b)&&a.set_parent_of_frontside(this)};n.get_backside_matched_widgets=function(){return N};n.set_backside_matched_widgets=function(a){N=a};n.get_matched_backside_widget=function(a){if(N)return N[B.indexOf(a)]};n.get_backside_widget_of_type=function(a,b){var c,d;if(N)return N[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&0>this.get_newly_created_widgets().indexOf(b))return d=
b,!0}.bind(this)),d};n.get_backside_conditions=function(){return e};n.set_backside_conditions=function(a){$.isArray(a)?e=a.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(e=[],b.UTILITIES.available_types.forEach(function(b){a[b]&&e.push(a[b])}));e&&e.forEach(function(a){a.is_backside()?a.set_parent_of_backside(this):(b.widget.erasable(a),a.set_parent_of_frontside(this))}.bind(this))};e&&n.set_backside_conditions(e);n.initialize_backside_conditions=function(){B=this.get_training_context().get_backside_widgets().slice();
M=b.UTILITIES.copy_widget_sides(B,{just_value:!0});this.set_backside_conditions([])};n.add_to_backside_conditions=function(a){var c;0<=this.get_newly_created_widgets().indexOf(a)||(e||(e=[]),a=B.indexOf(a),0<=a&&(c=M[a]),c&&0>e.indexOf(c)&&(e.push(c),b.widget.erasable(c)))};n.get_backside_condition_index=function(a){var b;N?(b=N.indexOf(a),0>b&&(b=N.length,N.push(a))):(b=0,N=[a]);return b};n.get_body=function(){return h};n.set_body=function(a){h=a};n.get_running=function(){return P||this.is_ok_to_run()};
n.running_or_in_run_queue=function(){return P};n.set_running_or_in_run_queue=function(a){P=a};n.stopped=function(){return G};n.set_stopped=function(a){if(G!==a){if(G=a)this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.drop_thing_in_hand(),this.rerender()),P=!1;this.get_next_robot()&&this.get_next_robot().set_stopped(a)}};n.drop_thing_in_hand=function(){c&&(c.drop_on(this.top_level_widget(),void 0,this),this.set_thing_in_hand(void 0))};n.finish_cycle_immediately=
function(a){var b=A,c=function(){A=b;this.set_visible(!1);a&&a()}.bind(this);A=0;this.add_body_finished_listener(c)};n.get_maximum_step_duration=function(){return A};n.get_context=function(){return z};n.set_context=function(a){z=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};n.context_is_backside=function(){return H};n.set_context_is_backside=function(a){H=a;this.get_next_robot()&&this.get_next_robot().set_context_is_backside(a)};n.get_top_level_context=function(){return w};n.set_top_level_context=
function(a){w=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};n.get_queue=function(){return I};n.set_queue=function(a){I=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};n.animate_consequences_of_actions=function(){return this.visible()&&0!==A};n.transform_step_duration=function(a){return void 0===a&&0===A||!this.visible()?0:r&&a?a/r:"number"===typeof A?Math.min(a,A):a};n.transform_original_step_duration=function(a){if(z&&!z.get_backside()||!this.visible())return 0;
if(!r)return a};n.transform_animation_speed=function(a){return z&&!z.get_backside()||!this.visible()?0:r?a*r:a};n.set_animating=function(a,c){var d=this.get_frontside_element(),e;a&&b.UTILITIES.visible_element(d)?(c||(c=$(d).offset()),$(d).css({width:"",height:"","z-index":b.UTILITIES.next_z_index()}),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c),e=$(d).closest(".toontalk-backside-of-top-level"),0<e.length&&e.get(0).appendChild(d),$(d).addClass("toontalk-robot-animating"),setTimeout(function(){$(d).addClass("toontalk-side-animating")},
2E3)):$(d).removeClass("toontalk-robot-animating toontalk-side-animating")};n.add_body_finished_listener=function(a){F.push(a)};n.run_body_finished_listeners=function(){F.forEach(function(a){a()});F=[]};n.add_watched_step_end_listeners=function(a){L.push(a)};n.run_watched_step_end_listeners=function(){L.forEach(function(a){a()});L=[]};n.get_thing_in_hand=function(){return c};n.set_thing_in_hand=function(a){if(b.debugging){if(a&&"empty hole"===a.get_type_name()){b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");
return}b.logging&&0<=b.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string(50)+" now has in his hand "+(a?a.to_debug_string(50):"nothing"))}a&&!a.location_constrained_by_container()&&a.save_dimensions();c=a};n.get_next_robot=function(){return q};n.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());!a&&q&&(q.set_first_in_team(q),q.set_previous_robot(void 0));(q=a)&&q.set_previous_robot(this);b&&($(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=
this.drop_area_instructions())};n.get_previous_robot=function(){return x};n.set_previous_robot=function(a){x=a};n.get_first_in_team=function(){return f};n.set_first_in_team=function(a){f=a;q&&q.set_first_in_team(a)};n.walk_children=function(a){var b;q&&!a(q)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};n.get_run_once=function(){return t};n.set_run_once=function(a){t=a;this.update_title();return!0};n.get_watched_speed=function(){return r};n.set_watched_speed=function(a){r=a;return!0};
n.can_run=function(){return this.get_frontside_conditions()&&this.get_frontside_conditions().is_top_level()||b.widget.can_run.call(this)};n.training_started=function(a){var c=this.get_training_context();c?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(c.copy({just_value:!0})),this.initialize_backside_conditions(),a||($("*").css({cursor:"url("+b.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),
this.update_title(),a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):b.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};n.training_finished=function(){if(this.being_trained){var a,c,d;a=this.get_body().get_newly_created_widgets();for(c=0;c<a.length;c++)d=a[c],"drop it on top-level"!==d.last_action&&"copy"!==d.last_action||this.add_step(b.robot_action.create(b.newly_created_widgets_path.create(c),
"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):$("*").css({cursor:""})}};if(b.debugging||b.logging)n.to_debug_string=function(a){var c=this.get_frontside_conditions();return("Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+
(c?b.UTILITIES.add_a_or_an(c.toString()):"anything")).substring(0,a)};q&&n.set_next_robot(q);n.add_standard_widget_functionality(n);u=n.remove_backside_widget.bind(n);n.has_name(n);n.set_name(k);n.set_description(l);n.remove_backside_widget=function(a,b){var c=this.get_frontside_conditions(),d;a===c?this.set_frontside_conditions(void 0):(d=this.get_backside_conditions())&&d.some(function(b,c){if(a===b)return d.splice(c,1),!0})||u(a,b)};b.debugging&&(n._debug_id=b.UTILITIES.generate_unique_id(),n._debug_string=
n.to_debug_string());return n};d.create_backside=function(){return b.robot_backside.create(this)};d.copy=function(a){var d=this.get_frontside_conditions(),e=this.get_backside_conditions(),d=d?d.copy({just_value:!0}):void 0,l=this.get_next_robot(),l=l?l.copy(a):void 0,c;e&&(c=b.UTILITIES.copy_widgets(e,{just_value:!0}));e=this.create(d,c,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),l,(!a||!a.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(e,
a)};d.match=function(a){var b,d;if(a.is_robot()&&(b=this.get_body().is_empty(),d=a.get_body().is_empty(),b===d))return"matched";this.last_match=a;return this};d.generate_name=function(){e++;return"#"+e.toString()};d.run=function(a,d,e,l){var c=this.get_frontside_conditions(),h,q,k,r,n;if(this.being_trained||this.running_or_in_run_queue())return this;(n=this.get_backside())&&n.visible()&&c&&(k=function(a){$(a.get_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},
k(c),this.rerender());a?(this.set_context(a),this.set_context_is_backside(d),this.set_top_level_context(e),this.set_queue(l)):a=this.get_context();this.match_status=b.UTILITIES.match(c,this.get_context());"matched"===this.match_status&&(r=[],(d=this.get_backside_conditions())&&0<d.length&&((h=a.get_backside_widgets())&&d.some(function(c){var d,e;c.matching_widget&&c.matching_widget.get_parent===a&&(d=b.UTILITIES.match(c,c.matching_widget),"matched"===d&&(r.push(c.matching_widget),e=d));e||h.some(function(a){d=
void 0;if(!(0<=r.indexOf(a))){if(a!==this&&!a.is_backside()){k&&k(a);d=b.UTILITIES.match(c,a);if("matched"===d)return r.push(a),e=d,c.matching_widget=a,!0;if(!d.is_widget)e=d;else if(!e||e.is_widget)e=d}void 0===e&&(e=c)}}.bind(this));if("matched"!==e)return this.match_status=e,!0}.bind(this)),"matched"!==this.match_status&&(r=void 0),this.set_backside_matched_widgets(r)));if("matched"===this.match_status)return l||(l=this.get_queue()||b.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),
l.enqueue(this),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),this.rerender(),this.get_next_robot()?this.get_next_robot().run():this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){l=this.get_next_robot().run();if("matched"===l)return l;l.is_widget||l.forEach(function(a){0>this.match_status.indexOf(a)&&
this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(q=function(){this.set_waiting(!1);this.run()}.bind(this),this.match_status.forEach(function(a){a[0]?a[0].run_when_non_empty(q,this):a.run_when_non_empty(q,this)}.bind(this)),this.set_waiting(!0));return this.match_status};d.set_waiting=function(a){var d=this.get_frontside_element();d&&(a?this.visible()&&(b.UTILITIES.add_animation_class(d,"toontalk-robot-waiting"),b.UTILITIES.give_tooltip(d,"This robot is waiting for a bird to deliver something.")):
($(d).removeClass("toontalk-robot-waiting"),b.UTILITIES.give_tooltip(d,this.get_title())))};d.run_actions=function(){return this.stopped()?(this.get_first_in_team().set_running(!1),!1):this.get_first_in_team().visible()?this.get_body().run_watched(this):this.get_body().run_unwatched(this)};d.drop_from_data_transfer=function(a,b){var d;a.is_top_level&&a.is_top_level()?(d=a.get_backside_widgets().slice(),setTimeout(function(){d.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=
1E3;this.dropped_on(a,b.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};d.ignore_pick_up_or_drop=function(a){return this===a.get_widget()||a.is_top_level()||this.get_parent_of_frontside()===a};d.picked_up=function(a,d,e){var l,c;if(!this.ignore_pick_up_or_drop(a))return a.get_infinite_stack&&a.get_infinite_stack()?this.current_action_name="pick up a copy of":this.current_action_name="pick up",e?(c=a,d=a.copy({fresh_copy:!0}),d=b.path.get_path_to_resource(d)):
d=b.path.get_path_to(a,this,!0),d&&(e=Date.now(),l={time:e-this.time_of_last_step},this.time_of_last_step=e,l=b.robot_action.create(d,this.current_action_name,l),this.add_step(l,c)),a.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(a),l};d.dropped_on=function(a,d){var e,l,c,h,q;if(!(this.ignore_pick_up_or_drop(a)||this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===a)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,
!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(e=b.path.get_path_to(d,this))d.is_backside()?(c=$(d.get_element()),l=c.offset(),h=c.width(),q=c.height(),c=$(a.get_frontside_element()).offset(),h=(c.left-l.left)/h,l=(c.top-l.top)/q,h=Math.max(0,Math.min(1,h)),l=Math.max(0,Math.min(1,l)),l={left_offset_fraction:h,top_offset_fraction:l}):l={},c=Date.now(),l.time=c-this.time_of_last_step,this.time_of_last_step=c,e=b.robot_action.create(e,this.current_action_name,
l),this.add_step(e);a.last_action=this.current_action_name+" "+d.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};d.dropped_on_text_area=function(a,b,d){h(a,"drop it on the text area of",this,d);a.last_action="drop it on the text area of "+b.get_type_name();this.set_thing_in_hand(void 0)};d.copied=function(a,b,d){d=d?"pick up a copy of":"copy";h(a,d,this,void 0,b);b.last_action=d};d.removed=function(a){var b;this.get_parent()&&(b=this.get_parent().get_widget());h(a,
"remove",this);a.last_action="remove";b===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};d.restored=function(a){h(a,"restore",this)};d.edited=function(a,b){h(a,"edit",this,b)};d.erased_widget=function(a){h(a,"change whether erased",this)};d.resized_widget=function(a,b,d,e,c){b===e&&d===c||h(a,"change size of",this,{x_factor:e/b,y_factor:c/d})};d.started_training_another=function(a){h(a,"start training",this)};d.finished_training_another=
function(a){h(a,"stop training",this)};d.trained=function(a,b){h(a,"train",this,{step:b})};d.backside_opened=function(a){h(a,"open the backside",this)};d.backside_closed=function(a){a.is_primary_backside()?h(a.get_widget(),"close the backside",this):this.removed(a)};d.button_clicked=function(a,b){h(b.get_widget(),"click the button of",this,{button_selector:a})};d.created_widget=function(a,d,e){this.add_newly_created_widget(a);a.get_parent()||this.add_to_top_level_backside(a,!1);this.add_step(b.robot_action.create(b.path.get_path_to_resource(a.copy()),
"add a new widget to the work space",{button_selector:e,path_to_source:b.path.get_path_to(d,this)}))};d.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};d.remove_from_container=function(a,b){var d=b.get_index_of&&a.get_parent_of_frontside()&&b.get_index_of(a),e=function(){b.removed_from_container(a,void 0,d,!0)};a=a.dereference();this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(e):e();this.add_newly_created_widget_if_new(a)};d.get_training_context=
function(){return this.get_first_in_team().get_parent_of_frontside()&&this.get_first_in_team().get_parent_of_frontside().get_widget()};d.add_step=function(a,b){this.get_body().add_step(a,b);this.update_title();"train"!==a.get_action_name()&&"start training"!==a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,a)};d.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var d=this.get_thing_in_hand(),e,l;b.debugging&&(this._debug_string=
this.to_debug_string());e=a.get_element();d&&(l=d.get_element());!l&&this.carrying_tool&&(l=document.createElement("div"),$(l).addClass(this.carrying_tool));b.UTILITIES.give_tooltip(e,this.get_title());$(e).addClass("toontalk-robot");$(e).children(".toontalk-held-by-robot").remove();l&&e.appendChild(l);this.match_status&&(this.match_status.is_widget?$(e).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(e).removeClass("toontalk-robot-not-matched"));e.setAttribute("toontalk_name",this.get_name());
b.UTILITIES.set_timeout(function(){var a,h,q,k,r;l&&(r={position:"absolute"},$(l).addClass("toontalk-held-by-robot"),a=b.UTILITIES.get_element_width(l),b.UTILITIES.get_element_height(l),q=b.UTILITIES.get_element_width(e),k=b.UTILITIES.get_element_height(e),d&&0===a&&(a=d.get_default_width?d.get_default_width():2*q,h=d.get_default_height?d.get_default_height():k/2,r.width=a,r.height=h),r.left=(q-a)/2,r.top=k/4,$(l).css(r),d&&d.rerender())})};d.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};
d.add_newly_created_widget_if_new=function(a){if(a!==this.get_training_context()&&this!==a)return this.get_body().add_newly_created_widget_if_new(a)};d.is_newly_created=function(a){return this.get_body().is_newly_created(a)};d.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-1]};d.get_title=function(){var a=this.get_description();if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?
"Drag this robot to a work area.":this.toString()};d.toString=function(a){var d,e,l,c,h,q,k,r,n,u,f,x,A;if(a&&"conditions"===a.role)return"any robot";if(a&&"match_status"===a.role)return"robot "+this.get_name();d=this.get_frontside_conditions();if(!d)return"an untrained robot";k=d.is_top_level();a||(a={});f=a.person;if(a&&a.resource){if(this.get_description())return'"'+this.get_description()+'"';a.person="third"}e=this.get_backside_conditions();c=this.get_body();q=h="";n=this.get_next_robot();k?u=
"When the workspace's green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" is pressed":(r=b.UTILITIES.add_a_or_an(d.get_full_description({role:"conditions"})),u="When working on something that matches "+r);e&&(e.forEach(function(a){a&&(u+=" and\nif on the"+(k?" work area ":" back ")+" is "+b.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),l=!0)}),l&&(u+="\n"));if(this.being_trained){if(c.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";
h="is being trained.\n";q="\n..."}c=h+u+(a&&"third"===a.person?" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(c.toString({robot:this})||"do nothing")+q;if(a&&a.resource)return a.person=f,c.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(A=d.is_top_level()?"the work area I'm running on":"the "+d.get_type_name()+" I'm on the back of",this.match_status===d?x=A:this.match_status.has_ancestor(d)?x="the "+(this.match_status.last_match?this.match_status.last_match.toString():
"thing")+" inside the "+A:(d.is_top_level()||(A="the "+this.match_status.get_type_name()+" on "+A),e.some(function(a){if(this.match_status===a)return x="any "+a.get_type_name(!0)+" on ",d.is_top_level()||(x+="the back of "),x+=A,!0;if(this.match_status.has_ancestor(a))return x="any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+A,!0}.bind(this))),c="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+
x+". Perhaps editing my conditions will help.\n"+c):"matched"!==this.match_status&&(c="I'm waiting for something to be delivered to the nest that matches "+(this.match_status[0][1]?b.UTILITIES.add_a_or_an(this.match_status[0][1].toString()):b.UTILITIES.add_a_or_an(this.match_status[0].toString()))+" in my conditions (highlighted in yellow on my backside).\n"+c));n&&(c+="\nIf it doesn't match then the next robot will try to run.\n"+n.toString());return c};d.get_type_name=function(a){return a?"robots":
"robot"};d.maintain_proportional_dimensions=function(){return!0};d.matching_resource=function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&this.get_body().is_empty()&&a.get_body().is_empty()};d.get_top_level_context_description=function(a){var b=this.get_frontside_conditions().get_type_name();return"top-level"===b?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+b+" he's working on":"the "+b+" I'm working on"};d.get_help_URL=
function(){return"docs/manual/robots.html"};d.drop_area_instructions=function(){return this.get_next_robot()?"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};d.get_json=function(a,d,e){var l=this.get_frontside_conditions(),c=this.get_backside_conditions(),h,q=function(){var c=function(c,e){var f=function(a,b){d({type:"robot",frontside_conditions:a,backside_conditions:h,body:k,run_once:this.get_run_once(),next_robot:c,name:this.get_name(),
speed:this.get_watched_speed()},b)}.bind(this);this.get_body().get_json(a,function(c,d){k=c;l?l.is_top_level()?f({type:"top_level"},d):b.UTILITIES.get_json(l,a,f,d):f(void 0,d)},e)}.bind(this);this.get_next_robot()?b.UTILITIES.get_json(this.get_next_robot(),a,c,e):c(void 0,e)}.bind(this),k;c?(h=[],b.UTILITIES.get_json_of_array(c,h,0,a,q,e)):q()};b.creators_from_json.robot=function(a,d){var e,l,c,h;a.thing_in_hand&&(l=b.UTILITIES.create_from_json(a.thing_in_hand,d));a.next_robot&&(e=b.UTILITIES.create_from_json(a.next_robot,
d));a.backside_conditions&&($.isArray(a.backside_conditions)?h=b.UTILITIES.create_array_from_json(a.backside_conditions,d):a.semantic&&b.UTILITIES.available_types.forEach(function(c){a.semantic.backside_conditions[c]&&h.push(b.UTILITIES.get_json(a.semantic.backside_conditions[c],json_history))}));c=b.UTILITIES.create_from_json(a.frontside_conditions||a.bubble,d);e=b.robot.create(c,h,void 0,a.description,l,a.run_once,e,a.name,a.speed);d||(d={});d.robot=e;e.set_body(b.UTILITIES.create_from_json(a.body,
d));return e};d.find_conditions_path=function(a,d,e){var l=d.get_frontside_conditions(),c=l===a?"entire_condition":l.get_path_to&&l.get_path_to(a,e),l=b.path.get_path_to(d,e),h;c||(d=d.get_backside_conditions(),d.some(function(b){if(b&&(c=b.get_path_to(a,e)))return h=b,!0}));if(c)return b.robot.create_conditions_path(c,l,h);b.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};d.create_conditions_path=function(a,d,e){"string"===typeof e&&this.get_backside_conditions().some(function(a){if(a&&
a.get_type_name()===e)return e=a,!0});return{dereference_path:function(l){var c=b.path.dereference_path(d,l),c=e?e:c.get_frontside_conditions();return"entire_condition"===a?c:b.path.dereference_path(a,l,c)},toString:function(){var l="entire_condition"===a?"the ":b.path.toString(a)+" of the ";return e?l+e.toString()+" backside condition of "+b.path.toString(d):l+" front side condition of "+b.path.toString(d)},get_json:function(l,c,h){var q=function(b,h){d.get_json(l,function(b,d){var f=function(a,
d){c({type:"path_to_robot_conditions",backside_condition:e&&a,path_to_robot:b,path_within_conditions:a},d)};"entire_condition"===a?f("entire_condition",d):a.get_json(l,f,d)},h)};e?b.UTILITIES.get_json(e,l,q,h):q(void 0,h)}}};b.creators_from_json.path_to_robot_conditions=function(a){var d=b.UTILITIES.create_from_json(a.path_to_robot),e="entire_condition"===a.path_within_conditions?a.path_within_conditions:b.UTILITIES.create_from_json(a.path_within_conditions);a=a.backside_condition&&b.UTILITIES.create_from_json(a.backside_condition);
return b.robot.create_conditions_path(e,d,a)};return d}(window.TOONTALK);window.TOONTALK.robot_backside=function(b){var h=function(d,a,g,h){d=b.UTILITIES.create_text_element(d);var l=a.get_element(!0),c=document.createElement("div"),t=function(){var d;a.visible()&&($(l).parent().addClass("toontalk-conditions-container"),a.update_display(),d={width:$(c).width(),height:$(c).height(),left:"",top:""},a.use_scaling_transform?a.use_scaling_transform(d):a.is_backside()&&b.UTILITIES.scale_element(l,d.width,
d.height,a.get_original_width()||$(l).width(),a.get_original_height()||$(l).height(),void 0,d),$(l).css(d),a.rerender())};$(l).addClass("toontalk-conditions-contents "+h);g.match_status&&(g.match_status.is_widget?$(g.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==g.match_status&&g.match_status.forEach(function(a){$(a[1].get_element()).addClass("toontalk-conditions-waiting")}));c.appendChild(l);g=b.UTILITIES.create_horizontal_table(d,c);$(g).addClass("toontalk-conditions-panel");
b.UTILITIES.run_when_dimensions_known(l,function(){setTimeout(t,100)});return g},d=function(d,a){var g=a.get_frontside_conditions(),m=a.get_backside_conditions(),l=a.visible(),c;g&&(g.is_top_level()?0>d.firstChild.textContent.indexOf("I always run when the green flag")&&d.insertBefore(b.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),d.firstChild):0===$(d).find(".toontalk-frontside-conditions-area").length&&d.insertBefore(h("I run only if the thing I'm on the back of matches: ",
g,a,"toontalk-frontside-conditions-area"),d.firstChild),g.set_visible(l),g.rerender());m&&m.forEach(function(g){var m;g&&(m=g.is_backside()?"on-backside":g.get_type_name(),c="toontalk-backside-"+m+"-conditions-area",m="bird"===m?b.UTILITIES.create_text_element("And there is a bird on the back."):h("And if "+b.UTILITIES.add_a_or_an(m)+" matches: ",g,a,c),d.insertBefore(m,d.firstChild.nextSibling),g.set_visible(l),g.rerender())})};return{create:function(e){var a=b.backside.create(e),g=a.get_element(),
h=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},l=b.UTILITIES.create_check_box(!e.get_run_once(),"toontalk-run-once-check-box","When finished start again",h(e.get_run_once())),c="normal;original;double;half;very fast;very slow".split(";"),t=[1,0,2,.5,10,.25],q=function(a){a=c.indexOf(a);return t[a]},k=b.UTILITIES.create_select_menu("robot_speed",
c,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),r=b.UTILITIES.create_drop_area(e.drop_area_instructions()),n=e.get_next_robot(),u=b.backside.create_advanced_settings_button(a,e),f=a.update_display.bind(a),x=function(a,b){var c=a.get_frontside_element(!0),
d,e;a.get_default_width&&(d=a.get_default_width(),e=a.get_default_height(),$(c).css({left:"",top:"",width:d,height:e}));b.appendChild(c)},A=a.hide_backside,F=a.add_advanced_settings;a.hide_backside=function(a){A.call(this,a);e.being_trained&&e.training_finished()};$(r).data("drop_area_owner",e);l.button.addEventListener("click",function(a){var c=l.button.checked;e.set_run_once(!c);b.UTILITIES.give_tooltip(l.container,h(!c));e.robot_in_training()&&e.robot_in_training().edited(e,{setter_name:"set_run_once",
argument_1:!c,toString:"change to "+(c?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});a.stopPropagation()});$(k.menu).val(function(a){a=void 0!==a?t.indexOf(a):0;return c[a]}(e.get_watched_speed())).selectmenu("refresh");$(k.menu).on("selectmenuselect",function(a){e.set_watched_speed(q(a.target.value))});n&&x(n,r);r.addEventListener("drop",function(a){a=b.UTILITIES.get_dragee();(a=b.UTILITIES.widget_side_of_jquery(a))&&a.is_robot()&&(a.get_body().is_empty()?
(a=a.open_backside(),$(a.get_element()).find(".toontalk-train-backside-button").click()):(x(a,r),e.set_next_robot(a)))});a.get_next_robot_area=function(){return r};a.update_display=function(){var a=e.get_frontside_element();a&&b.UTILITIES.give_tooltip(a,e.get_title());f()};b.UTILITIES.when_attached(g,function(){var a=e.get_backside_conditions(),b=e.get_frontside_conditions();a&&a.forEach(function(a){a.set_visible(!0)});b&&b.set_visible(!0)});g.appendChild(this.create_train_button(a,e));d(g,e);g.appendChild(u);
a.add_advanced_settings=function(){F.call(a,l.container,k.container,r)};return a},create_train_button:function(e,a){var g=e.get_element();$(g);var h=$("<button>Train</button>").button(),l=!1;h.addClass("toontalk-train-backside-button");e.change_label_and_title_of_train_button=function(c){c?(h.button("option","label","Stop training "+a.get_name()),b.UTILITIES.give_tooltip(h.get(0),"Click to stop training this robot.")):a.get_body().is_empty()?(h.button("option","label","Train"),b.UTILITIES.give_tooltip(h.get(0),
"Click to start training this robot.")):(h.button("option","label","Re-train "+a.get_name()),b.UTILITIES.give_tooltip(h.get(0),"Click to start training this robot all over again."));b.UTILITIES.visible_element(g)&&d(g,a)};e.change_label_and_title_of_train_button(l);h.get(0).addEventListener("click",function(b){l=!l;e.change_label_and_title_of_train_button(l);l?(a.initialize_backside_conditions(),a.get_body().reset_steps(),a.robot_started_training(a),a.training_started()):a.training_finished();b.stopPropagation()});
return h.get(0)}}}(window.TOONTALK)})();(function(){var b=function(b){return"rotate"===b||"skewX"===b||"skewY"===b||"transform-origin-x"===b||"transform-origin-y"===b},h=function(d){return"transform-origin-x"===d||"transform-origin-y"===d?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+d:b(d)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+d:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+d};window.TOONTALK.element=function(d){var e=["left","top","width","height"],a=Object.create(d.widget),g=
function(a,b){var d,e;if(!a)return 0;"number"===typeof a&&(e=a);0===a.length&&(e=0);if("undefined"===typeof e&&(d=a.substring(a.length-1),0<="0123456789x".indexOf(d)&&(e=parseFloat(a),isNaN(e))))return;d=e;0<=["rotate","skewX","skewY"].indexOf(b)&&(d%=360,0>d&&(d+=360));return d},m=function(a,b){var d,e,g,h,n;if((b.left||b.top)&&!a.being_dragged&&(d=a.get_parent_of_frontside(),n=$(a.get_element()).width(),g=$(a.get_element()).height(),d))return b.left&&(e=d.is_element()?d.get_original_width():d.get_width(),
b.left<n/-2||b.left>e+n/2)&&(e=0<e?(b.left%e+e)%e:b.left,b.left!==e&&(b.left=e,h=!0)),b.top&&(d=d.is_element()?d.get_original_height():d.get_height(),b.top<g/-2||b.top>d+g/2)&&(g=0<d?(b.top%d+d)%d:b.top,b.top!==g&&(b.top=g,h=!0)),h};a.create=function(e,c,g,h,k,r,n,u){var f=Object.create(a),x=d.UTILITIES.generate_unique_id(),A=f.drag_started,F={},L={},z,H,w,I,P,G,B,M,N,Q,O,J,D,p,v,y;c||(c=["left","top","width","height"]);f.is_element=function(){return!0};f.get_HTML=function(){return I};f.get_guid=
function(){return x};f.get_text=function(){var a,b;return void 0===P&&((a=this.get_frontside_element())?P=a.textContent:(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),P=a.textContent,$(a).remove()):P=b,""===P&&a&&"IMG"!==a.nodeName&&(this.update_display(),P=a.textContent),""===P)?this.get_HTML():P};f.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>c)break;b+=3;d=a.indexOf("target='_blank'",
b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(I===a)return!1;I=c(a);if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element()?b.innerHTML=I.replace(/ /g,"&nbsp;"):b.innerHTML=I;G&&this.compute_original_dimensions(!0);return!0};f.set_HTML_from_sub_classes=f.set_HTML;
f.set_text=function(a){var b=this.get_frontside_element(),c=function(b){$(b).contents().each(function(){this.nodeType==Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};f.get_style_attributes=function(){return c};f.set_style_attributes=function(a){c=a};f.get_attribute_widgets_in_backside_table=function(){return F};f.set_attribute_widgets_in_backside_table=
function(a){F=a};f.get_original_copies=function(){return L};f.get_pending_css=function(){return O};f.get_transform_css=function(){return J};f.add_to_css=function(a,c){b(a)?(J||(J={}),J[a]=c):(O||(O={}),O[a]=c)};f.apply_css=function(){var a="",b,c;(O||J)&&(b=this.get_frontside_element())&&!$(b).is(".toontalk-not-observable")&&(jQuery.contains(window.document,b)?(O?(O.width&&(N=O.width),O.height&&(Q=O.height)):O={},O.position="absolute",J&&("number"===typeof J.rotate&&(a+="rotate("+J.rotate+"deg)"),
"number"===typeof J.skewX&&(a+="skewX("+J.skewX+"deg)"),"number"===typeof J.skewY&&(a+="skewY("+J.skewY+"deg)"),"number"===typeof J["transform-origin-x"]||"number"===typeof J["transform-origin-y"])&&(O["transform-origin"]=(J["transform-origin-x"]||0)+" "+(J["transform-origin-y"]||0)),N||Q?(p&&p.css({width:B,height:M}),this.is_plain_text_element()&&this.plain_text_dimensions(),$(b).css({width:"",height:""}),c=O,d.UTILITIES.run_when_dimensions_known(b,function(e){var f=this.get_parent_of_frontside();
m(this,c);$(b).is(".toontalk-conditions-contents")&&$(b.parentElement).is(".toontalk-conditions-container")&&(N=$(b.parentElement).width(),Q=$(b.parentElement).height());(this.ok_to_set_dimensions()||this.location_constrained_by_container())&&d.UTILITIES.scale_element(b,N,Q,B,M,a,c,e,!f);O=void 0}.bind(this))):(m(this,O),d.UTILITIES.add_transform_to_css(a,"",O,0>b.parentElement.className.indexOf("toontalk-box-hole")),$(b).css(O),O=void 0)):d.UTILITIES.when_attached(b,this.apply_css.bind(this)))};
f.on_update_display=function(a){D?D.push(a):D=[a]};f.fire_on_update_display_handlers=function(){D&&d.UTILITIES.set_timeout(function(){D.forEach(function(a,b){a()||D.splice(b,1)})})};f.get_image_element=function(){return p};f.set_image_element=function(a,b){p=$(a).find("img");0===p.length?p=void 0:($(b).width(p.width()),$(b).height(p.height()))};f.get_additional_classes=function(){return u};f.set_additional_classes=function(a){u=a};f.get_children=function(){return h};f.get_child=function(a){if(h)return h[a]};
f.set_sound_effect=function(a){z=a;z.volume=d.UTILITIES.get_audio_volume(z)};f.get_sound_effect=function(){return z};f.get_video_object=function(){var a;H||(a=this.get_frontside_element())&&(H=a.getElementsByTagName("video")[0]);return H};f.set_video_object=function(a){H=a};f.get_ignore_pointer_events=function(){return n};f.set_ignore_pointer_events=function(a){n=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":"auto"})};f.get_source_URL=function(){return w};
f.set_source_URL=function(a){if(w!==a)return w=a,this.refresh(),!0};f.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===B?d.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),function(){d.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,B,M,void 0,a)}.bind(this)):d.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,B,M,void 0,a)};f.add_standard_widget_functionality(f);v=f.set_running.bind(f);
f.set_running=function(a,b){v(a,b);Object.keys(F).forEach(function(c){F[c].set_running(a,b)});!a&&this.visible()&&(c.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());h.forEach(function(c){c.set_running(a,b)})};y=f.can_run.bind(f);f.can_run=function(){var a;if(y())return!0;Object.keys(F).some(function(b){if(F[b].can_run())return a=!0});if(a)return a;h.some(function(b){if(b.can_run())return a=!0});return a};f.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;
this.drag_y_offset=a.view.drag_y_offset;A.call(this,a,b)};f.update_display=function(){var a=this.get_frontside_element(!0);this.get_backside();var b=function(a){return this.get_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged)if(this.get_erased()){var c,e;e=$(a).parent(".toontalk-backside").is("*")?c="":c="100%";this.save_dimensions();$(a).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:c,height:e,
position:"",transform:""});$(a).parent(".toontalk-conditions-container").is("*")?d.UTILITIES.give_tooltip(a,"This is an element that has been erased. It will match any element."):d.UTILITIES.give_tooltip(a,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(a).is(".toontalk-erased-element")&&($(a).removeClass("toontalk-erased-element"),this.restore_dimensions()),this.initialize_element(),d.UTILITIES.on_a_nest_in_a_box(a)&&(c=$(a).closest(".toontalk-box-hole").width())&&
(this.set_attribute("width",c,!1),e=$(a).closest(".toontalk-box-hole").height(),this.set_attribute("height",e,!1)),"undefined"===typeof B&&a.parentElement&&(this.is_plain_text_element()?this.plain_text_dimensions():this.compute_original_dimensions()),this.apply_css(),h?h.forEach(function(b){a.appendChild(b.get_frontside_element(!0));b.set_visible(!0);b.update_display()}):h=[],this.fire_on_update_display_handlers(),d.UTILITIES.give_tooltip(a,"Click to see the backside where you can place robots or change the style of this "+
b(a)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};f.initialize_element=function(){var a,b;!G&&(a=this.get_frontside_element())&&($(a).children(".ui-resizable-handle"),I=this.get_HTML(),b=this.is_plain_text_element(),a.innerHTML=b?I.replace(/ /g,"&nbsp;"):I,$(a).addClass("toontalk-element-frontside"),b?((b=this.get_additional_classes())&&$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.location_constrained_by_container()||this.plain_text_dimensions()):
$(a).addClass("toontalk-non-plain-text-element"),G=!0)};f.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};f.plain_text_dimensions=function(){B=12*this.get_HTML().length;M=32;this.saved_width=B;this.saved_height=M};f.compute_original_dimensions=function(a){d.UTILITIES.original_dimensions(this,function(a,b){var d=this.get_parent_of_frontside();B=a;M=b;d&&d.get_box?d.get_box().rerender():(c.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),
a)};f.get_attribute_from_current_css=function(a){var b,c;if("width"===a&&(N||B))return N||B;if("height"===a&&(Q||M))return Q||M;b=this.get_frontside_element(!0);c=d.UTILITIES.get_style_numeric_property(b,a);""===c&&(c=$(b).css(a));if(!c)return 0;if("number"===typeof c){if(B&&Q){if("left"===a)return c+(B-N)/2;if("top"===a)return c+(M-Q)/2}return c}return"%"!==c.charAt(c.length-1)||"left"!==a&&"top"!==a?c:$(b).offset()[a]};f.get_original_width=function(){return B};f.get_original_height=function(){return M};
f.increment_width=function(a){this.set_attribute("width",(N||B)+a)};f.increment_height=function(a){this.set_attribute("height",(Q||M)+a)};f.get_width=function(){return N};f.get_height=function(){return Q};f.add_child=function(a){var b=$(a.get_frontside_element(!0)),c=$(this.get_frontside_element(!0)),e;h.push(a);a.set_parent_of_frontside(this);e=d.UTILITIES.set_position_relative_to_element(b,c,b.offset(),!0);a.is_element()&&a.set_location_attributes(e.left,e.top);c.get(0).dispatchEvent(d.UTILITIES.create_event("widget added",
{element_widget:b.get(0),where:"front"}));this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)};f.removed_from_container=function(a,b){var c=h.indexOf(a);0<=c&&h.splice(c,1)};f.set_HTML(e.toString());f.set_description(g);k&&("string"===typeof k?f.set_sound_effect(new Audio(k)):f.set_sound_effect(k));r&&("string"===typeof r?f.set_HTML("<video src='"+r+"'/>"):f.set_video_object(r));d.debugging&&(f._debug_id=d.UTILITIES.generate_unique_id(),f._debug_string=f.to_debug_string());h?h.forEach(function(a){a.set_parent_of_frontside(f)}):
h=[];return f};a.copy=function(b){var c=this.get_style_attributes(),e=a.create(this.get_HTML(),c.slice(),this.get_description(),d.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),g=this.get_attribute_widgets_in_backside_table(),h={},m=e.get_backside(this.visible());e.set_source_URL(this.get_source_URL());b&&(b.elements_copied||(b.elements_copied={}),b.elements_copied[this.get_guid()]=e);Object.keys(g).forEach(function(a){h[a]=
g[a].copy(b);h[a].set_parent_of_frontside(m,!1,!0);e.set_attribute(a,this.get_attribute(a))}.bind(this));e.set_attribute_widgets_in_backside_table(h);return this.add_to_copy(e,b)};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};a.match_with_any_element=function(){return"matched"};a.match_with_another_element_widget=
function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};a.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};a.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};a.get_path_to=function(b,c){var d=this.get_children(),e=d.indexOf(b),g,h;if(0<=e)return a.path.create(e);d.forEach(function(d,e){d.get_path_to&&
(h=d.get_path_to(b,c))&&(g=a.path.create(e),g.next=h)});return g};d.creators_from_json.element_path=function(b,c){var e=a.path.create(b.index);b.next&&(e.next=d.UTILITIES.create_from_json(b.next,c));return e};a.dereference_path=function(a,b){var e,g;if(a){e=a.get_index&&a.get_index();if(!d.debugging||"number"===typeof e)if(g=this.get_children(),e=g[e]){if(e.dereference_contents&&!a.not_to_be_dereferenced)return e.dereference_contents(a.next||a,b);if(a.next){if(e.dereference_path)return e.dereference_path(a.next,
b);d.UTILITIES.report_internal_error("Expected to refer to a child of "+e+" but it lacks a method to obtain "+d.path.toString(a.next))}a.removing_widget&&(e.get_infinite_stack()||b.remove_from_container(e,this));return e}d.UTILITIES.report_internal_error(this+" unable to dereference the path: "+d.path.toString(a))}else return this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+d.UTILITIES.ordinal(a)+" widget "},get_json:function(b,d,e){d({type:"element_path",
index:a,next:this.next&&this.next.get_json(b)},e)}}}};a.widget_side_dropped_on_me=function(a,b,d){if(a.is_backside())return!1;this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};a.create_backside=function(){return d.element_backside.create(this)};a.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};a.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a),
e;"left"===a?(e=this.get_frontside_element(),e=d.UTILITIES.translate_x(e)):"top"===a?(e=this.get_frontside_element(),e=d.UTILITIES.translate_y(e)):e=0;return"undefined"!==typeof b&&"auto"!=b?b+e:this.get_attribute_from_current_css(a)+e};a.set_attribute=function(a,b,e,h){var k=this.get_frontside(!0).get_element(),m;if(!k)return!1;m="left"===a?d.UTILITIES.translate_x(k):"top"===a?d.UTILITIES.translate_y(k):0;k=this.get_attribute_from_pending_css(a);b-=m;if(k===b||"undefined"===typeof k&&(k=this.get_attribute_from_current_css(a),
k===b))return!1;m=g(b,a);if("number"===typeof m){if(k==m)return!1;d.logging&&0<=d.logging.indexOf("attribute:")&&0<=d.logging.indexOf(a)&&console.log("Attribute "+a+" set to "+m+" was "+k+" at "+Date.now()+" for "+this);b=m}e&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:a,argument_2:b,toString:"change the '"+a+"' style to "+b+" of",button_selector:".toontalk-element-"+a+"-attribute-input"});this.add_to_css(a,b);h&&(b=this.get_style_attributes(),
0>b.indexOf(a)&&b.push(a));this.rerender();return!0};a.dropped_on_style_attribute=function(a,b,d,e){var g,h,n;if(a){g=a.toString();if(a.is_number()){h=this.get_attribute(b);if("number"===typeof h)n=h;else if("auto"===h)switch(b){case "left":n=$(this.get_frontside_element()).offset().left;break;case "top":n=$(this.get_frontside_element()).offset().top;break;default:n=0}else n=parseFloat(h);h=a.to_float();switch(g.substring(0,1)){case "-":g=n-h;break;case "*":g=n*h;break;case "/":g=n/h;break;case "^":g=
Math.pow(n,h);break;default:g=n+h}this.set_attribute(b,g,!1);(d||e&&e.visible())&&this.get_backside().render()}a.get_infinite_stack()||a.remove();d&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};a.get_attribute_widget_in_backside_table=function(a,b,d){var e=this.get_attribute_widgets_in_backside_table()[a];e||b||(e=this.create_attribute_widget(a,d),this.get_attribute_widgets_in_backside_table()[a]=e);return e};a.create_attribute_widget=function(a,
b){var g=".toontalk-element-"+a+"-attribute-input",q=this.get_backside_element(),k=this.get_attribute(a),r=this,n=function(a,b){var c=b.toString,e=b.equals,f=b.remove;L=b.update_display;b.element_widget=this;b.attribute=a;b.get_type_name=function(a){return a?"element attributes":"element attribute"};b.toString=function(){return c.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};b.get_default_description=function(){return"a number that is the "+this.attribute+" of "+this.get_attribute_owner().toString({plain_text:!0})+
"."};b.get_custom_title_prefix=function(){return"I'm the '"+this.attribute+"' attribute of "+this.get_attribute_owner()+".\nDrop a number on me or edit my backside to change my value. My backside has an info button to learn more."};b.equals=function(b){return a===b.attribute?this.equals(b.element_widget):e.call(this,b)};b.update_display=function(){var a,b,c;this.get_erased()||(a=this.get_attribute_owner(),a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_element()&&!a.being_dragged?(c={},
b=bigrat.toDecimal(this.get_value()),c[this.attribute]=b,m(a,c)&&this.set_value(c[this.attribute]),$(a.get_frontside_element()).css(c)):(a=a.get_attribute(this.attribute),isNaN(a)||F(a)));L.call(this)};A=b.copy.bind(b);b.copy=function(b){var c;if(b){if(b.just_value)return A(b);b.elements_copied&&(c=b.elements_copied[r.get_guid()])}return this.add_to_copy((c||r).create_attribute_widget(a),b)};b.get_json=function(b,c,e){d.UTILITIES.get_json(r,b,function(b,d){c({type:"attribute_widget",attribute_name:a,
element:b},d)},e)};b.get_original_attribute_widget=function(){var b=r.get_original_copies()[a];return b&&b[0]};b.is_attribute_widget_copy=function(b){var c=r.get_original_copies()[a];return c&&0<=c.indexOf(b)};b.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():r;if(!b.get_widget().is_element())return r;
b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=b.get_parent_of_backside();return b};b.remove=function(b,c){var d=r.get_original_copies()[a],e=d&&d.indexOf(this);0<=e&&d.splice(e,1);f.call(this,b,c)};b.get_help_URL=function(){return h(a)}}.bind(this),u=function(a,b){var c=d.number.create(0,1);n(a,c);c.set_value_from_decimal(b);c.set_format("decimal");c.set_value=function(b){try{var c=r.get_original_copies()[a],e="number"===typeof b?b:bigrat.toDecimal(b),
f=bigrat.fromDecimal(e);this.get_attribute_owner().set_attribute(this.attribute,e)&&c.forEach(function(a,b){a.set_value_from_sub_classes(f,!0)});return this.set_value_from_sub_classes(f,!1)}catch(g){return d.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+g),!1}};c.is_attribute_widget=function(){return!0};c.get_function_type=function(a){return a?"numbers":"number"};return c}.bind(this),f=function(a,b){var c=d.element.create(b);n(a,c);c.set_HTML=function(b){var c=
r.get_original_copies()[a],d;this.get_attribute_owner().set_attribute(this.attribute,b)&&c.forEach(function(a,c){d=a.set_HTML_from_sub_classes(b)});return d};c.get_function_type=function(a){return a?"elements":"element"};c.set_additional_classes("toontalk-string-attribute-widget");return c}.bind(this),x;x=0<=["background-color","color"].indexOf(a)?"string":"number";var A,F,L,z,H;q&&(g=$(q).find(g),0<g.length&&(g.get(0).toontalk_widget_side=this));if("number"===x){if(z=u(a,k),F=z.set_value_from_decimal.bind(z),
0<=e.indexOf(a)&&(this.on_update_display(function(){z.rerender();return!0}),"left"===a||"top"===a))H=function(b){var c,d,e;b.currentTarget.toontalk_widget_side===z.get_attribute_owner()&&(c=z.get_attribute_owner(),b.stopPropagation(),d=$(c.get_frontside_element()).closest(".toontalk-backside-of-top-level").offset(),d||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),d={left:0,top:0}),e=b.pageX-d.left-(c.drag_x_offset||0),d=b.pageY-
d.top-(c.drag_y_offset||0),"left"===a?(b=e,c.set_attribute("top",d)):(b=d,c.set_attribute("left",e)),z.set_value_from_decimal(b),L.call(z))},z.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",H);b&&b.get_widget().is_element()&&b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",H)})}else if("string"===x)z=f(a,k),F=z.set_HTML.bind(z);else{d.UTILITIES.report_internal_error("Unrecognized attribute type: "+
x+" for "+a);return}(k=this.get_original_copies()[a])?k.push(z):this.get_original_copies()[a]=[z];return z};d.creators_from_json.attribute_widget=function(a,b){return d.UTILITIES.create_from_json(a.element,b).create_attribute_widget(a.attribute_name,b)};d.creators_from_json.attribute_number=d.creators_from_json.attribute_widget;a.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};a.toString=
function(a){var b,e,g;if(this.get_erased())return"any element";b=function(b){var c="",d=function(a,b,c){var d=b.indexOf(a+"="),e,g;if(0<=d&&(e=b.indexOf("'",d),0<=e&&(g=b.indexOf("'",e+1)),0<=g))return b.substring(0,d)+a+"="+c+b.substring(g+1);d=b.indexOf(" ");return b.substring(0,d+1)+a+"="+c+" "+b.substring(d+1)};if(1<b.length&&"<"===b.charAt(0)){if(this.get_image_element())c="style='width: 60px; height: 40px;'";else{if(0===b.indexOf("<img "))return"<img width='60' height='40' "+b.substring(4);
if(0<=b.indexOf("<iframe "))return b.indexOf("<iframe "),d("width",d("height",b,"'60'"),"'80'")}a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'");return"<div "+c+">"+b+"</div>"}return'"'+b+'"'}.bind(this);e=function(){var a=this.get_HTML(),b=a.indexOf("alt="),c;return 0<=b&&(c=a.indexOf("'",b+5),0<=c)?"("+a.substring(b+5,c)+")":""}.bind(this);g=this.get_children();if(a&&!a.inside_tool_tip&&"conditions"!==a.role){if(a.for_json_div)return"";b=e();b||(b=(b=this.get_source_URL())?"whose text is the contents of "+
b:(b=this.get_text())?'"'+b+'"':"")}else b=b(this.get_HTML());g&&0<g.length&&(b+=" with "+d.UTILITIES.describe_widgets(g)+" on top");return"the element "+b};a.get_type_name=function(a){return a?"elements":"element"};a.get_help_URL=function(){return"docs/manual/elements.html"};a.get_json=function(a,b,e){var g=this.get_style_attributes(),h=d.UTILITIES.remove_z_index(this.get_HTML()),m=encodeURIComponent(h),n=[],u;100<=h.length?(a.shared_html||(a.shared_html=[]),h=a.shared_html.indexOf(m),0>h&&(h=a.shared_html.push(m)-
1),u={shared_html_index:h}):u=m;m=function(){var f=[],h=function(k){var m=function(){h(k+1)},r,z;k>=g.length?b({type:"element",html:u,attributes:g,attribute_values:g.map(this.get_attribute.bind(this)),attributes_backsides:f,additional_classes:this.get_additional_classes(),children:0<this.get_children().length&&n,sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,
source_URL:this.get_source_URL()},e,a):(r=g[k],(r=this.get_attribute_widget_in_backside_table(r,!0))?(z=[],f.push(z),d.UTILITIES.get_json_of_array(r.get_backside_widgets(),z,0,a,m,e)):(f.push(null),m()))}.bind(this);h(0)}.bind(this);0<this.get_children().length?d.UTILITIES.get_json_of_array(this.get_children(),n,0,a,m,e):m()};d.creators_from_json.element=function(b,c){var e=decodeURIComponent("string"===typeof b.html?b.html:c.shared_html&&c.shared_html[b.html.shared_html_index]),h,k,m,n;b.children&&
(k=c.is_child,c.is_child=!0,h=d.UTILITIES.create_array_from_json(b.children,c),c.is_child=k);if(!e&&(e="string"===typeof b.html?"No json.html recreating an element widget.":"additional_info.shared_html missing while recreating an element widget.",!d.debugging))throw e;n=a.create(e,b.attributes,b.description,h,b.sound_effect,b.video,b.ignore_pointer_events);m=c&&c.event?["left","top"]:[];b.attribute_values.forEach(function(a,e){var h=b.attributes[e],k=b.attributes_backsides&&b.attributes_backsides[e];
(c.is_child||0>m.indexOf(h))&&(0!==a||"width"!==h&&"height"!==h)&&n.add_to_css(h,g(a)||a);k&&(h=n.get_attribute_widget_in_backside_table(h,!1,c),d.UTILITIES.add_backside_widgets_from_json(h,k,c))}.bind(this));b.additional_classes&&n.set_additional_classes(b.additional_classes);b.source_URL&&(n.set_source_URL(b.source_URL),n.refresh());h&&d.UTILITIES.when_attached(function(){h.forEach(function(a,c){var e=b.children[c]&&b.children[c].widget&&b.children[c].widget.view;e&&d.UTILITIES.set_css(a.get_frontside_element(!0),
{left:e.frontside_left,top:e.frontside_top})})});return n};a.create_attribute_path=function(a,b){var e=d.path.get_path_to(a.element_widget,b,!0);return this.extend_attribute_path(e,a.attribute)};a.refresh=function(){this.get_source_URL()&&d.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};a.extend_attribute_path=function(a,b){return{dereference_path:function(d){return(d=a.dereference_path(d,d.get_top_level_context()||d.get_context()))&&
d.get_widget().get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+b+"' property of "+d.path.toString(a)},get_json:function(e,g,h){d.path.get_json(a,e,function(a,d){g({type:"path_to_style_attribute",attribute:b,element_widget_path:a},d)},h)}}};d.creators_from_json.path_to_style_attribute=function(b,c){var e=d.UTILITIES.create_from_json(b.element_widget_path,c);return a.extend_attribute_path(e,b.attribute)};a.set_size_attributes=function(a,b,e){e?(this.add_to_css("width",a),
this.add_to_css("height",b)):(this.set_attribute("width",a),this.set_attribute("height",b));d.UTILITIES.set_timeout(function(){this.rerender()}.bind(this))};a.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};a.receive_HTML_from_dropped=function(a){var b=a.get_text&&a.get_text();a.remove();if(this.set_HTML(b))return this.get_text()};a.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};a.add_style_attribute=
function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):"top"===a&&(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));
return!0};a.remove_style_attribute=function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return a}(window.TOONTALK);window.TOONTALK.element_backside=function(b){var e=function(a,e,h){var c;h.visible()&&(c=e.get_style_attributes(),e.get_frontside_element(),$(a).empty(),c.forEach(function(c){e.get_attribute(c);var q=document.createElement("tr"),k=document.createElement("td"),r=h.is_primary_backside()?e.get_attribute_widget_in_backside_table(c):
h.get_widget().create_attribute_widget(c),n=r.get_frontside_element(!0);r.set_parent_of_frontside(h,!1,!0);r.set_infinite_stack(!0);a.appendChild(q);q.appendChild(k);k.appendChild(b.UTILITIES.create_text_element(c));k=document.createElement("td");q.appendChild(k);r.set_visible(!0);$(n).addClass("toontalk-element-attribute");k.appendChild(n)}))},a=function(a,e){var h=$("<button>Add or remove my style attributes</button>").button();h.addClass("toontalk-show-attributes-chooser-button");h.get(0).addEventListener("click",
function(c){b.UTILITIES.visible_element(a)?($(a).hide(),h.button("option","label","Add or remove my style attributes"),b.UTILITIES.give_tooltip(h.get(0),"Click to add widgets for my style attributes.")):($(a).show(),h.button("option","label","Hide my style attributes list"),b.UTILITIES.give_tooltip(h.get(0),"Click to hide my list of attributes that can be added or removed."));e.robot_in_training()&&e.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",e)});b.UTILITIES.give_tooltip(h.get(0),
"Click to add widgets for my style attributes.");return h.get(0)};return{create:function(g){var m=b.backside.create(g),l=m.get_element();g.get_HTML();var c=document.createElement("table"),t=document.createElement("div"),q=a(t,g),k=b.backside.create_advanced_settings_button(m,g),r=b.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),
n=b.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),u=n?"get_HTML":"get_text",f=m.update_display.bind(m),x=m.add_advanced_settings,A,F,L,z,H,w,I,P,G,B;g.initialize_element();A=g[u]().trim();0<A.length&&!g.get_image_element()&&(L=function(a){(a=b.UTILITIES.input_area_drop_handler(a,g.receive_HTML_from_dropped.bind(g),g))&&g.robot_in_training()&&g.robot_in_training().dropped_on_text_area(a,g,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},
F=b.UTILITIES.create_text_area(A,"toontalk-html-input","My HTML is","Type here to edit the text.",L,void 0,!0),A=function(a){a=F.button.value.trim().replace(/\xA0/g," ");g.get_frontside_element();var b=n?"set_HTML":"set_text";g[b](a)&&g.robot_in_training()&&g.robot_in_training().edited(g,{setter_name:b,argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(F.container).css({width:"100%"}),L=60>=F.button.value.length?2:600>F.button.value.length?Math.ceil(F.button.value.length/
60):10,$(F.button).css({width:"95%",height:L+"em"}),F.button.addEventListener("change",A),F.button.addEventListener("mouseout",A),g.is_plain_text_element()&&l.appendChild(F.container),g.get_source_URL()&&(L=function(a){var c=b.UTILITIES.input_area_drop_handler(a,g.receive_URL_from_dropped.bind(g),g);c&&g.robot_in_training()&&g.robot_in_training().dropped_on_text_area(c,g,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});a.stopPropagation()},
A=function(a){a=z.button.value.trim().replace(/\xA0/g," ");g.get_frontside_element();g.set_source_URL(a)&&g.robot_in_training()&&g.robot_in_training().edited(g,{setter_name:"set_source_URL",argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},z=b.UTILITIES.create_text_input(g.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,L),z.button.addEventListener("change",A),z.button.addEventListener("mouseout",A),
l.appendChild(z.container)));m.update_style_attribute_chooser=function(){var a=function(a,f,g){var l=0<=g.get_style_attributes().indexOf(a),p=b.UTILITIES.create_check_box(l,"toontalk-style-attribute-check-box",a+"&nbsp;","Click to add or remove the '"+a+"' style attribute from my backside."),k="toontalk-style-attribute-check-box-for-"+a,l=b.UTILITIES.create_anchor_element("i",h(a)),n=document.createElement("li"),m=function(b){p.button.checked?g.add_style_attribute(a):g.remove_style_attribute(a);e(c,
g,g.get_backside());g.robot_in_training()&&g.robot_in_training().edited(g,{setter_name:p.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:a,toString:(p.button.checked?"add":"remove")+" a widget for the "+a+" attribute of",button_selector:"."+k})};$(l).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(l).css({color:"white"});l.translate=!1;l.lang="en";p.container.appendChild(l);$(p.button).addClass(k);p.button.addEventListener("click",m);p.button.addEventListener("touchstart",
function(a){p.button.checked=!p.button.checked;m(a)});n.appendChild(p.container);f.appendChild(n)},f=function(b,c,d){var e,p;"string"===typeof b?a(b,c,d):b.label?(e=document.createElement("h3"),e.textContent=b.label,p=document.createElement("ul"),c.appendChild(e),c.appendChild(p),f(b.sub_menus,p,d)):b.forEach(function(a){f(a,c,d)})};$(t).is(".ui-accordion")&&$(t).accordion("destroy");$(t).empty();f([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},
{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],t,g);$(t).accordion({active:0,heightStyle:"content"});return t};m.get_attributes_chooser=function(){return t};m.add_advanced_settings=function(){var a;x.call(m);a=$(l).children(".toontalk-advanced-settings-table");
0<a.length&&(a.get(0).appendChild(r.container),a.get(0).appendChild(t),a.get(0).appendChild(q),g.is_plain_text_element()||a.get(0).appendChild(F.container))};(I=g.get_sound_effect())?(P=function(){m.visible()&&(I.paused?(b.UTILITIES.give_tooltip(H.get(0),"Click to begin playing this sound."),H.button("option","label","Play sound")):(b.UTILITIES.give_tooltip(H.get(0),"Click to pause this sound."),H.button("option","label","Pause sound")))},H=$("<button>Play sound</button>").button(),H.addClass("toontalk-play-sound-effect-button"),
A=function(a){I.paused?(b.UTILITIES.play_audio(I),I.addEventListener("ended",P)):I.pause();P();g.robot_in_training()&&g.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",g)},H.get(0).addEventListener("click",A),P(),l.appendChild(H.get(0))):g.get_video_object()&&(G=g.get_video_object(),B=function(a){m.visible()&&(G.paused?(b.UTILITIES.give_tooltip(w.get(0),"Click to begin playing this video."),w.button("option","label","Play video")):(b.UTILITIES.give_tooltip(w.get(0),"Click to pause this video."),
w.button("option","label","Pause video")))},w=$("<button>Play video</button>").button(),w.addClass("toontalk-play-video-button"),A=function(a){G.paused?(G.play(),G.addEventListener("ended",B)):G.pause();B();g.robot_in_training()&&g.robot_in_training().button_clicked(".toontalk-play-video-button",g)},w.get(0).addEventListener("click",A),B(),l.appendChild(w.get(0)));m.update_style_attribute_chooser();e(c,g,m);l.appendChild(c);l.appendChild(k);$(t).hide();$(t).addClass("toontalk-attributes-chooser");
m.update_display=function(){F&&$(F.button).val(g[u]());e(c,g,m);b.UTILITIES.visible_element(t)&&m.update_style_attribute_chooser();g.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});f()};$(l).find(".toontalk-hide-backside-button").each(function(a,b){b.addEventListener("click",function(){$(t).hide()})});r.button.checked=!g.get_ignore_pointer_events();r.button.addEventListener("click",function(){g.set_ignore_pointer_events(!r.button.checked)});r.button.addEventListener("touchstart",
function(){r.button.checked=!r.button.checked;g.set_ignore_pointer_events(!r.button.checked)});return m}}}(window.TOONTALK);window.TOONTALK.element["function"]=function(b){var e=b.create_function_table();e.add_function_object("join text",function(a,g,h){var l="";return e.typed_bird_function(a,function(){for(i=0;i<arguments.length;i++)l+=arguments[i].get_text();return b.element.create(l)},[void 0],void 0,"join",g,h)},"The bird will return with a new element that is made by joining all the elements and numbers.",
"join",["any number of numbers or elements"]);e.add_function_object("part of text",function(a,g,h){return e.typed_bird_function(a,function(a,c,e){c=Math.round(c.to_float());e=Math.round(e.to_float());return b.element.create(a.get_text().substring(c+1,e+1))},["element","number","number"],3,"part of text",g,h)},"The bird will return with a new element whose text is the part of the text of the first element (or number) beginning with the first number ending with the second number. 1 is for the first letter.",
"part",["an element followed by two postive numbers"]);e.add_function_object("length of text",function(a,g,h){return e.typed_bird_function(a,function(a){return b.number.create(a.get_text().length)},[void 0],1,"length of text",g,h)},"The bird will return with a number that is length of the text of the first element (or number).","length",["an element or number"]);e.add_function_object("text as number",function(a,g,h){return e.typed_bird_function(a,function(a){a=a.get_text();var c;c=a.indexOf("/");
0<=c?c=b.number.create(a.substring(0,c),a.substring(c+1,a.length)):(c=b.number.create(0),c.set_value_from_decimal(a));return c},[void 0],1,"text as number",g,h)},"The bird will return with a number that has the same text as the element. Arithmetic can be done on the result unlike the original text.","text as number",["an element"]);e.add_function_object("go to page",function(a,b,d){return e.typed_bird_function(a,function(a){this.robot_in_training()?d.display_message("Robot trained to replace current URL."):
window.location.assign(a.get_text())},["element"],1,"replace page",b,d)},"The bird will cause the current page to be replaced by the new URL. The back button should return to the current page.","page",["an element containing a URL"]);e.add_function_object("speak",b.widget.get_speak_function(e),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);return e.get_function_table()}(window.TOONTALK)})();window.TOONTALK.sensor=function(b){var h=Object.create(b.widget),d=function(b,a){"element"===b.get_type_name()&&(b.set_additional_classes("toontalk-string-value-from-sensor"),a.visible()&&b.rerender())};h.create=function(e,a,g,h,l,c,t){var q=b.nest.create(g,h,"sensor",void 0,void 0,t||"sensor"),k=q.get_json,r=q.update_display,n=q.set_running,u=q.copy,f=a.split(" "),x,A=function(a){switch(typeof a){case "number":a=b.number.create(Math.round(a),1);break;case "string":a=b.element.create(a,void 0,void 0,
void 0,void 0,void 0,"toontalk-string-value-from-sensor");d(a,q);break;case "boolean":a=b.element.create(a.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");d(a,q);break}return a},F=function(a){var c,d,f;if(q.get_active()){c=x(a);d=q.get_attributes();f=q.visible();a=$(q.get_frontside_element()).closest(".toontalk-backside-of-top-level");if(1===c.length){if(c=A(c[0]),"undefined"===typeof c)return}else c=b.box.create(c.length,!0,c.map(A),"the values of the "+b.UTILITIES.conjunction(d)+
" attributes of "+b.UTILITIES.add_a_or_an(e)+" event.",d.join(";"));f?(f=b.bird.create(q),q.add_to_top_level_backside(f),c.render(),f.animate_delivery_to(c,q,q,a.width()/2,a.height())):q.add_to_contents(c)}}.bind(this),L;q.is_sensor=function(){return!0};q.copy=function(a){var d;if(a&&a.just_value&&this.has_contents())return u.call(this,a);d=a?b.sensor.create(e,this.get_attributes_string(),g,void 0,a.copying_resource||l,c,this.get_name()):b.sensor.create(e,this.get_attributes_string(),g,void 0,l,c,
this.get_name());d=q.add_to_copy(d,a);d.set_active(this.get_active());return d};q.get_json=function(a,d,f){var g=function(f,g){var h;f.type="sensor";f.event_name=e;f.attribute=this.get_attributes_string();f.active=l;c?(h=function(a){f.sensor_of=a;d(f,g)},b.UTILITIES.get_json(c,a,h,g)):d(f,g)}.bind(this);k.call(this,a,g,f)};q.update_display=function(){var a=$(this.get_frontside_element());r.call(this);l||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):
(a.addClass("toontalk-sensor-inactive-nest"),a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};q.get_type_name=function(a){return a?"sensors":"sensor"};q.get_help_URL=function(){return"docs/manual/sensors.html"};q.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+e+" events"};q.get_class_name_with_color=function(a){return a};q.get_active=function(){return!0===l};q.restore_active=function(){"temporarily false"===l&&this.set_active(!0)};
q.set_active=function(a,b){if(l!==a||b)!0===a?c?c.get_frontside_element(!0).addEventListener(e,F):window.addEventListener(e,F):c?c.get_frontside_element(!0).removeEventListener(e,F):window.removeEventListener(e,F),l=a};q.set_running=function(a){this.set_active(a);n.call(this,a)};q.set_active(l,!0);q.create_backside=function(){return b.sensor_backside.create(this)};q.get_event_name=function(){return e};q.set_event_name=function(a){var b=l;e&&l&&this.set_active(!1);e=a;b&&this.set_active(!0)};q.get_attributes=
function(){return f};q.set_attributes=function(a){f=a.split(" ")};q.get_attributes_string=function(){return f.join(" ")};q.match=function(a){this.last_match=a;return this};q.set_sensor_of=function(a){c=a};q.get_custom_title_prefix=function(){var a="When a '"+e+"' event"+(c?" to "+c:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";l?this.get_backside()||(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the 'Listening to events' check box on my back is ticked.";
return a};q.get_default_description=function(){return c?"a sensor for "+c.get_default_description():"a sensor for this document."};L=q.can_run;q.can_run=function(a){return!a||L.call(this,a)};x=function(a){return q.get_attributes().map(function(c){var d=a[c];if("key"===c&&void 0===d){if(d=a.keyIdentifier,0===d.indexOf("U+"))return String.fromCharCode(a.keyCode)}else if("undefined"===typeof d){if(a.detail&&a.detail.element_widget&&("widget"===c||"back"===c))return c=b.UTILITIES.widget_side_of_element(a.detail.element_widget).create_backside(),
c.save_dimensions(),c;if(a.detail&&a.detail.element_widget&&"front"===c)return b.UTILITIES.widget_side_of_element(a.detail.element_widget);if(a.detail&&void 0!==a.detail[c])return a.detail[c];d="No such attribute for "+q;q.display_message(d,!0)}return d})};return q};b.creators_from_json.sensor=function(e,a){var g=b.sensor.create(e.event_name,e.attribute,e.description,[],!1,void 0,e.name),h;e.sensor_of?b.UTILITIES.set_timeout(function(){g.set_sensor_of(b.UTILITIES.create_from_json(e.sensor_of,a));
g.set_active(e.active)}):g.set_active(e.active);0<e.contents.length&&setTimeout(function(){h=b.UTILITIES.create_array_from_json(e.contents,a);g.set_contents(h);h.forEach(function(a){d(a.get_widget(),g)});g.rerender()},500);return g};return h}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(b){return{create:function(h){var d=b.UTILITIES.create_text_input(h.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+h.get_event_name()),e=b.UTILITIES.create_text_input(h.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
a=b.UTILITIES.create_check_box(h.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),g=b.nest_backside.create(h),m=g.get_element(),l=function(){h.set_event_name(d.button.value.trim())},c=function(){h.set_attributes(e.button.value.trim())},t=b.backside.create_advanced_settings_button(g,h),q=function(b){var c=a.button.checked;h.set_active(c);h.robot_in_training()&&h.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:c,toString:"change to "+(c?"active":"inactive")+" of the "+h,button_selector:".toontalk-sensor-active-check-box"});h.render();b.stopPropagation()},k=g.add_advanced_settings;m.appendChild(t);g.add_advanced_settings=function(){var b;d.button.addEventListener("change",l);e.button.addEventListener("change",c);a.button.addEventListener("click",q);k.call(g,d.container,e.container);b=$(m).children(".toontalk-advanced-settings-table");0<b.length&&b.get(0).appendChild(a.container)};return g}}}(window.TOONTALK);window.TOONTALK.tool=function(b){document.addEventListener("mousemove",function(h){b.tool.pageX=h.pageX;b.tool.pageY=h.pageY});return{add_listeners:function(h,d){var e,a,g,m,l,c=function(c){var l=h.getBoundingClientRect();d.set_held&&d.set_held(!0);m=l.height;c&&c.preventDefault();setTimeout(function(){d.held&&!d.held()||$(h).addClass("toontalk-tool-held")},200);e=$(h).offset();document.addEventListener("mousemove",q);document.addEventListener("touchmove",q);document.addEventListener("mouseup",k);
document.addEventListener("touchend",k);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_down at "+Date.now());g=a=0;$(".ui-tooltip").each(function(){$(this).hide()})},t=function(e){var l=h.getBoundingClientRect();d.held&&d.held()||c(e);a=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",e)-l.left;g=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",e)-l.top},q=function(c){var d=b.UTILITIES.find_widget_side_on_page(c,h,a,g-m/2),e,k,q;c.preventDefault();d&&
d.is_of_type("empty hole")&&(d=d.get_parent_of_frontside());$(".ui-tooltip").each(function(){$(this).hide()});k=r(c);q=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",c)-k.deltaX-a;c=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",c)-k.deltaY-g;h.style.left=q+"px";h.style.top=c+"px";b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_move at "+Date.now()+" now at "+h.style.left+", "+h.style.top);if(d&&d.get_widget().is_top_level())l&&(b.UTILITIES.remove_highlight(),
l=void 0);else{if(d&&(e=d.get_element(),e===l))return;l=e;b.UTILITIES.highlight_element(l)}},k=function(c){var u=b.UTILITIES.find_widget_side_on_page(c,h,a,g-m/2),f;c.preventDefault();u&&u.is_of_type("empty hole")&&(u=u.get_parent_of_frontside());d.set_held&&d.set_held(!1);l&&b.UTILITIES.remove_highlight();u&&u.top_level_widget&&(f=u.top_level_widget(),d.apply_tool(u,c),f.backup_all());!u&&d.nothing_under_tool&&d.nothing_under_tool();$(h).removeClass("toontalk-tool-held");$(h).addClass("toontalk-tool-returning");
b.UTILITIES.add_one_shot_event_handler(h,"transitionend",1E3,function(){$(h).removeClass("toontalk-tool-returning")});b.UTILITIES.set_timeout(function(){h.style.left=e.left+"px";h.style.top=e.top+"px"});document.removeEventListener("mousemove",q);document.removeEventListener("touchmove",q);document.removeEventListener("mouseup",k);document.removeEventListener("touchend",k);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_up at "+Date.now(),alert(b.debugging),b.debugging="touch")},
r=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,deltaY:c}};h.addEventListener("mousedown",t);h.addEventListener("touchstart",t);return c}}}(window.TOONTALK);window.TOONTALK.vacuum=function(b){var h=Object.create(null),d={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},e={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},a={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},g=!1,m;h.create=function(){var l,c,t,q=[],k=function(a){t!==a&&(t=a,b.sounds&&b.sounds.click.play(),$(l).removeClass(c),
c=e[t],$(l).addClass(c),r())},r=function(){"restore"===t&&0===q.length?b.UTILITIES.give_tooltip(l,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):b.UTILITIES.give_tooltip(l,d[t])};document.addEventListener("keyup",function(a){var c=String.fromCharCode(a.keyCode);if(a.altKey){if(0>"SsEeRrAa".split("").indexOf(c))return;l||(h.the_vacuum.get_element(),$(l).css({left:b.tool.pageX,top:b.tool.pageY}),document.body.appendChild(l));m()}h.the_vacuum.held()&&
("s"===c||"S"===c?k("suck"):"e"===c||"E"===c?k("erase"):"r"===c||"R"===c?k("restore"):"a"===c||"A"===c?k("suck_all"):b.sounds&&b.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){h.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});b.vacuum.the_vacuum={apply_tool:function(a,c){var d=a.get_widget(),e=function(a){c&&d.robot_in_training()&&d.robot_in_training().removed(a);a.is_primary_backside&&a.is_primary_backside()?a.hide_backside():
a===d.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):(d.is_bird()&&b.sounds&&b.sounds.bird_fly.pause(),a.is_backside()||(a.save_dimensions_of(a),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),q.push(a),a.set_running&&a.set_running(!1),a.is_backside()||a.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove(c,!0))},g,h,k;"suck"===t?a.remove&&!a.get_widget().is_top_level()&&
(e(a),b.sounds&&b.sounds.vacuum_suck.play()):"erase"===t||"restore"===t&&a.get_erased&&a.get_erased()?a.is_top_level()||(g=!a.get_erased(),b.sounds&&(g?b.sounds.vacuum_suck.play():b.sounds.vacuum_spit.play()),a.set_erased(g,!0),c&&d.robot_in_training()&&d.robot_in_training().erased_widget(a,g)):"restore"===t?0<q.length&&(g=q.pop(),g.restore_dimensions(),k=a.add_to_top_level_backside(g),c&&d.robot_in_training()&&d.robot_in_training().restored(g),k.toontalk_widget_side=g,h=$(l).offset(),h.left-=$(k).width(),
b.UTILITIES.set_absolute_position(k,h),g.this_and_walk_children&&(g.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),b.sounds&&b.sounds.vacuum_spit.play())):"suck_all"===t&&(g=a.top_level_widget(),h=g.get_backside_widgets().slice(),0<h.length&&b.sounds&&(b.sounds.vacuum_suck.play(),b.sounds.bird_fly.pause()),b.UTILITIES.for_each_batch(h,function(a){a&&d!==d.robot_in_training()&&e(a)}),g.set_backside_widgets([]))},nothing_under_tool:function(){k(a[t])},get_element:function(){l||
(l=document.createElement("div"),$(l).addClass("toontalk-vacuum"),m=b.tool.add_listeners(l,this),k("suck"),r());return l},held:function(){return g},set_held:function(a){g=a}};return b.vacuum.the_vacuum};b.creators_from_json.vacuum=function(a,c){var d=b.vacuum.create();a.mode&&b.UTILITIES.set_timeout(function(){d.set_mode(a.mode)});return d};return h}(window.TOONTALK);window.TOONTALK.wand=function(b){var h=Object.create(null);h.create=function(){var d;return{apply_tool:function(d){var a;d.is_top_level()||(b.sounds&&b.sounds.magic.play(),a=d.add_copy_to_container(),a.update_display(),d.robot_in_training()&&d.robot_in_training().copied(d,a,!1))},get_element:function(){d||(d=document.createElement("div"),$(d).addClass("toontalk-wand"),b.UTILITIES.give_tooltip(d,"I'm a magic wand. Drag me over the thing you want me to copy."),b.tool.add_listeners(d,this));return d}}};
b.creators_from_json.wand=function(){return b.wand.create()};return h}(window.TOONTALK);window.TOONTALK.SETTINGS=function(b){var h=[],d=function(d,m,l){var c=[];b.UTILITIES.create_local_files_table(function(t){var q=function(a,c){var h=function(a){a||c.newPanel.appendChild(b.UTILITIES.create_text_element("Error connecting to cloud"))},f=c.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();c.newPanel.is(".toontalk-programs-in-cloud-table")?f?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):e(c.newPanel,"program",d,l,h):c.newPanel.is(".toontalk-pages-in-cloud-table")?
f?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):e(c.newPanel,"page",d,l,h):($("#tab-0_info").show(),$("#tab-0_wrapper").show())},k;c[0]="Programs stored in browser";h[0]=t;m?(c[1]="Programs in cloud",h[1]=b.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),c[2]="Published pages",h[2]=b.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table"),k=b.UTILITIES.create_tabs(c,h),l.appendChild(k),$(k).on("tabsactivate",q)):l.appendChild(b.UTILITIES.create_tabs(c,h));a(d,
t,!0,l);$(t).on("draw.dt",function(){a(d,t,!1,l)})})},e=function(d,e,h,c,t){b.google_drive.get_toontalk_files(!1,e,function(q){var k;"string"===typeof q?k=q:q.error&&(k=q.error.message);k?"Need to authorize"===k||"Login Required"===k?b.google_drive.authorize(t):(console.log(k),console.log("Google drive status: "+b.google_drive.get_status()),t(null)):(k="program"===e&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",b.UTILITIES.become_file_data_table(d,q.items,!0,k),d.on("draw.dt",
function(){a(h,d.get(0),!0,c)}),t(d.get(0)))})},a=function(a,b,d,c){var e=function(b){var e=function(){$(c).remove()},h=function(){a.set_setting("program_name",b.target.textContent);a.load(d,e)}.bind(this);a.save(!0,void 0,h)};b=$(b).find(".toontalk-file-load-button-without-click-handler");b.each(function(a,b){b.addEventListener("click",e)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(a){var e=document.createElement("div"),h=a.get_backside_element(),c=a.get_setting("program_name"),
t=b.UTILITIES.create_text_input(c,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),q=b.UTILITIES.create_close_button(function(){$(e).remove()},"Click to close the settings panel."),k=b.UTILITIES.create_text_element("How should your program be saved?"),r=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_google_drive"),"toontalk-save-setting","Save automatically to my Google Drive",'Check this if you want your programs automatically saved to a "ToonTalk Programs" folder in your Google Drive.'),
n=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage","Check this if you want your programs automatically saved in this browser's local storage."),u=b.UTILITIES.create_button("Save to Google Drive now","toontalk-save-button","Click to save your program now to your Google Drive account.",function(){a.save(!0,{google_drive:!0})}),f=b.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button",
"Click to save your program now to this browser's local storage.",function(){a.save(!0,{local_storage:!0})}),x=b.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){b.google_drive.authorize(function(){$(x).remove()})}),A=b.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){a.display_message("Creating your web page...");
a.publish(L,F.button.checked)}),F=b.UTILITIES.create_check_box(a.get_setting("publish_as_workspace"),"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),L=function(c,d){var e=document.createElement("span"),f=b.google_drive.google_drive_url(c.id);b.TRANSLATION_ENABLED&&(f=b.UTILITIES.add_URL_parameter(f,"translate","1"));e.innerHTML="Published: <a href='"+f+"' target='_blank'>"+a.get_setting("program_name")+
"</a>";f=$(t.container).children("tr");a.display_message("Your web page is ready for you to edit. Just click on the link.");0<f.length&&f.get(0).appendChild(b.UTILITIES.create_table_entry(e))},z=document.createElement("div"),H=b.google_drive&&"undefined"!==typeof gapi?b.google_drive.get_status():"Google Drive API not loaded",w=!0,I=b.UTILITIES.create_vertical_table(A,F.container),P=$(t.container).children("tr");$(e).addClass("toontalk-settings-panel").css({width:$(h).width()+29,height:$(h).height()+
50,left:-2,top:-25,"z-index":9999999});e.appendChild(q);t.button.addEventListener("change",function(){var d=t.button.value.trim();c!==d&&a.save(!0,void 0,function(){c=d;a.set_setting("program_name",d);a.load(!0,function(){setTimeout(function(){$(e).css({"z-index":b.UTILITIES.next_z_index()})},500)},function(){a.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();a.display_message("Your program was copied and the new copy's name is '"+a.get_setting("program_name")+"'.")})})})});r.button.addEventListener("click",
function(b){a.save(!0,{auto_save_to_google_drive:n.button.checked,gooogle_drive:!0});a.set_setting("auto_save_to_google_drive",r.button.checked);r.button.checked?$(u).hide():$(u).show()});n.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_local_storage:n.button.checked,local_storage:!0});a.set_setting("auto_save_to_local_storage",n.button.checked);n.button.checked?$(f).hide():$(f).show()});F.button.addEventListener("click",function(b){a.set_setting("publish_as_workspace",F.button.checked)});
e.appendChild(z);$(k).css({"font-weight":"bold","font-size":24,color:"navy"});z.appendChild(k);z.appendChild(t.container);z.appendChild(r.container);z.appendChild(n.container);r.container.appendChild(b.UTILITIES.create_space());r.container.appendChild(u);a.get_setting("auto_save_to_google_drive")&&$(u).hide();n.container.appendChild(b.UTILITIES.create_space());n.container.appendChild(f);a.get_setting("auto_save_to_local_storage")&&$(f).hide();"Need to authorize"===H?(r.container.appendChild(b.UTILITIES.create_space()),
r.container.appendChild(x)):"Authorized"!==H&&"Ready"!==H&&"Authorized but not yet ready"!==H&&(w=!1,a.set_setting("google_drive_unavailable",!0),setTimeout(function(){r.button.disabled=!0;$(A).button("option","disabled",!0);$(u).button("option","disabled",!0);b.UTILITIES.give_tooltip(r.container,"Inactivated because attempt to connect to Google Drive returned: "+H);A.title=r.container.title;u.title=r.container.title},1));0<P.length&&P.get(0).appendChild(b.UTILITIES.create_table_entry(I));d(a,w,e);
h.appendChild(e)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",auto_save_to_google_drive:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(b){var h=[],d=0,e=!1,a=!1;return{pending_update:function(a){0<=h.indexOf(a)||(h.push(a),this.update_display())},update_display:function(){var g;a||document.hidden||0===h.length||(g=Date.now(),g<d?(a=!0,setTimeout(this.update_display_workhorse.bind(this),d-g)):e||(a=!0,b.UTILITIES.set_timeout(function(){this.update_display_workhorse(g)}.bind(this))))},update_display_workhorse:function(g){var m=h,l=function(a,b){$(a).children().each(function(a,c){$(c).is(".toontalk-side")&&
($(c).css({"z-index":b+1}),l(c,b+1))})};h=[];e=!0;a=!1;d=(g|Date.now())+50;b.UTILITIES.for_each_batch(m,function(a){var d=a.get_element&&a.get_element(),e,g,h;if(a.visible()||$(d).is(".toontalk-top-level-resource"))$(d).show(),a.update_display(),a.get_backside&&(g=a.get_backside())&&g.visible()&&g.update_display(),setTimeout(function(){b.UTILITIES.use_custom_tooltip(d)}),e=$(d).parent().closest(".toontalk-side"),e.is("*")&&0===e.find(".toontalk-side-animating, .toontalk-side-appearing").length&&(g=
b.UTILITIES.get_style_numeric_property(d,"z-index"),h=b.UTILITIES.get_style_numeric_property(e.get(0),"z-index"),h||(h=b.UTILITIES.next_z_index(),e.css({"z-index":h})),!g||e.is(".toontalk-backside-of-top-level")?(g=b.UTILITIES.next_z_index(),$(d).css({"z-index":g})):g>=h&&(g=h+1,$(d).css({"z-index":g})),l(d,g)),d&&!$(d).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&
b.UTILITIES.set_timeout(function(){e.is(".toontalk-box-hole")?$(d).is(".ui-resizable")&&$(d).resizable("destroy"):$(d).is(".ui-resizable")||b.UTILITIES.make_resizable($(d),a)})});e=!1;0<h.length&&(a=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(b){b.creators_from_json.body=function(h,d){var e=b.actions.create();d.body=e;e.initialise_steps(b.UTILITIES.create_array_from_json(h.steps,d));return e};return{create:function(h){var d=Object.create(this),e=[];h||(h=[]);d.copy=function(){return b.actions.create(b.UTILITIES.copy_array(h))};d.get_steps=function(){return h};d.initialise_steps=function(a){h=a};d.is_empty=function(){return 0===h.length};d.reset_steps=function(){h=[];this.reset_newly_created_widgets()};
d.reset_newly_created_widgets=function(){b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+e.length);e=[]};d.add_step=function(a,d){a?(h.push(a),d&&this.add_newly_created_widget_if_new(d)):b.UTILITIES.report_internal_error("Attempt to add an undefined step.")};d.add_newly_created_widget_if_new=function(a){0<=e.indexOf(a)||this.add_newly_created_widget(a)};d.add_newly_created_widget=function(a){b.debugging&&0<=e.indexOf(a)?console.log("add_newly_created_widget called with not new widget."):
(e.push(a),b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Added "+a.to_debug_string(50)+" to list of newly_created_widgets. Length is "+e.length))};d.is_newly_created=function(a){return 0<=e.indexOf(a)};d.get_newly_created_widgets=function(){return e};d.get_path_to=function(a,d,h){var l,c;e.some(function(e,q){if(e===a||h&&e===a)return l=b.newly_created_widgets_path.create(q),!0;if(e.get_path_to&&(c=e.get_path_to(a,d)))return l=b.newly_created_widgets_path.create(q),l.next=c,!0});return l};
d.dereference_path=function(a){b.debugging&&!e[a]&&b.UTILITIES.report_internal_error("Expected to find the "+b.UTILITIES.ordinal(a)+" newly created widget.");return e[a]};return d},run_unwatched:function(h,d){var e=this.get_steps();b.logging&&0<=b.logging.indexOf("run")&&console.log(h.to_debug_string(50)+" running unwatched");d||(d=0);h.run_next_step=function(a){if(d<e.length){var g=e[d];d++;b.logging&&0<=b.logging.indexOf("event")&&console.log(g+" (unwatched) at "+Date.now()+" by robot "+h.get_name());
a?(h.run_watched_step_end_listeners(),g.run_watched(h)):g.run_unwatched(h)}else h.set_running_or_in_run_queue(!1),h.run_body_finished_listeners(),h.get_run_once()?h.get_first_in_team().set_running(!1):h.get_first_in_team().run()};h.run_next_step()},run_watched:function(h){var d=this.get_steps(),e=h.get_frontside_element(),a,g,m=e.parentElement,l=h.get_first_in_team(),c=function(){var a=l.visible()&&0!==l.get_maximum_step_duration(),c=function(){a&&(m&&m.appendChild(e),h.set_animating(!1));l===h?b.UTILITIES.set_absolute_position(e,
q):(b.UTILITIES.set_css(e,{position:"static"}),g.get_backside(!0).get_next_robot_area().appendChild(e));h.get_run_once()?l.set_running(!1):h.stopped()?$(e).removeClass(".toontalk-side-animating"):l.run();h.rerender()};a?(e.parentElement||h.get_parent_of_frontside().get_frontside_element().appendChild(e),b.UTILITIES.animate_to_absolute_position(e,q,c,h&&h.transform_animation_speed(b.UTILITIES.default_animation_speed))):(h.set_animating(!1),c(),h===l&&h.get_context().add_backside_widget(h),$(h.get_frontside_element()).remove())},
t=0,q=$(e).offset(),k=$(e).offset(),r=$(e).width(),n=$(e).height(),u=h.get_first_in_team().top_level_widget(),f=$(e).closest(".toontalk-backside-of-top-level").offset(),x=h.get_context().get_backside(),A,F;b.logging&&0<=b.logging.indexOf("run")&&console.log(h.to_debug_string(50)+" running watched");A=(g=h.get_previous_robot())?$(g.get_backside(!0).get_next_robot_area()):$(x.get_backside_element(!0));!b.UTILITIES.is_attached(e)&&g&&(g.open_backside(),g.get_backside().set_advanced_settings_showing(!0),
(a=e.parentElement)||(a=A.get(0)),h.set_visible(!0),h.update_display(),h.add_body_finished_listener(function(){a&&a.appendChild(e);$(e).css({left:"",top:"",position:"","z-index":""})}));0===r&&($(e).css({width:"",height:""}),r=h.saved_width||$(e).width(),n=h.saved_height||$(e).height());f||(f={left:0,top:0});0<A.length&&(F=A.get(0).getBoundingClientRect(),q.left<F.left-f.left||q.top<F.top-f.top||q.left+r>F.right+f.left||q.top+n>F.bottom+f.top)&&(q=A.offset(),q.left+=A.width()/2,q.top+=A.height()-
n,k=q);h.start_offset=k;u.get_backside_element().appendChild(e);b.UTILITIES.set_absolute_position(e,q);h.run_next_step=function(){x&&!document.hidden&&(x.visible()||b.UTILITIES.visible_element(x.get_element()))?setTimeout(function(){h.run_watched_step_end_listeners();if(t<d.length&&!h.stopped()){var a=d[t];t++;b.logging&&0<=b.logging.indexOf("event")&&console.log(a+" (watched)");a.run_watched(h)}else h.set_running_or_in_run_queue(!1),c(),h.run_body_finished_listeners()},h.transform_step_duration(50)):
(h.set_running_or_in_run_queue(!1),h.set_animating(!1),$(e).css({width:"",height:""}),e.style.transitionDuration="",m&&m.appendChild(e),this.run_unwatched(h,t))}.bind(this);h.set_animating(!0,q);h.run_next_step();return!0},toString:function(b){for(var d="",e=this.get_steps().map(function(a){return a&&a.toString(b)});""===e[e.length-1];)e.pop();e.forEach(function(a,b){a&&(d+=a,d=b===e.length-2?d+" and \n":b<e.length-2?d+", \n":d+".")});return d},get_json:function(h,d,e){var a=[];b.UTILITIES.get_json_of_array(this.get_steps(),
a,0,h,function(){d({type:"body",steps:a},e)},e)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(b){b.creators_from_json.newly_created_widgets_path=function(h){return b.newly_created_widgets_path.create(h.index)};return{create:function(h){return{dereference_path:function(d){var e=d.get_body().dereference_path(h),a;if(this.next)return b.path.dereference_path(this.next,d,e);this.removing_widget&&((a=e.get_parent_of_frontside())&&a.is_hole()&&(a=a.get_parent_of_frontside()),a&&a.removed_from_container&&d.remove_from_container(e,a));return e},toString:function(){return"the "+
b.UTILITIES.ordinal(h)+" new widget"},get_json:function(b,e,a){e({type:"newly_created_widgets_path",index:h},a)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(b){var h=function(a,b,c){if(!c||!c.running_watched||!a.get_backside())return!0;a.get_backside().hide_backside()},d={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b,c){c&&c.running_watched||a.set_parent(void 0);b.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b){var c=a.copy();b.add_newly_created_widget(c);b.set_thing_in_hand(c);return!0},"drop it on":function(a,c,d){var e;if(a)if(e=c.get_thing_in_hand()){if(e.drop_on)return b.debugging&&
e===a&&b.UTILITIES.report_internal_error("Dropping something on itself! "+a),a.visible()||$(e.get_frontside_element()).remove(),e.drop_on(a,void 0,c),c.set_thing_in_hand(void 0),a.rerender(),c.add_newly_created_widget_if_new(e),e.robot_waiting_before_next_step===c?(d&&d.running_watched||(e.robot_waiting_before_next_step=void 0),!1):!0;b.debugging&&b.UTILITIES.report_internal_error("Thing in robot's hand ("+e+") doesn't handle 'drop_on'. Robot that "+c)}else!c.being_trained&&b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+
c.toString()+"' is executing drop_on but has nothing in its hand.");else b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(a,c,d){var e;if(a){if(e=c.get_thing_in_hand())return c.set_thing_in_hand(void 0),a[d.setter](e),!0;b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else b.UTILITIES.report_internal_error("The robot that '"+
c.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},remove:function(a,b){a.remove();a===b?b.set_stopped(!0):b.add_newly_created_widget_if_new(a);return!0},restore:function(a,b){b.add_to_top_level_backside(a);return!0},"change whether erased":function(a,b,c){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;a.display_message("Robot is unable to erase "+a)},edit:function(a,c,d){if(a[d.setter_name])return d.argument_2?a[d.setter_name].call(a,d.argument_1,
d.argument_2,a.visible()):a[d.setter_name].call(a,d.argument_1,a.visible()),!0;b.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c){return!0},"add to the top-level backside":function(a,c,d){var e;if(!d||!d.running_watched){e=c.top_level_widget();e.add_backside_widget(a);d=c.get_context();if(!d.visible())return;e=e.get_backside_element();d=a.get_frontside_element(!0);$(d).css(b.UTILITIES.random_location_inside(e,50));e.appendChild(d);a.animate_to_element(e,void 0,
c.transform_animation_speed(b.UTILITIES.default_animation_speed))}return!0},"add a new widget to the work space":function(a,c,d){c.get_context().is_top_level()?(d=c.add_to_top_level_backside(a),c=$(c.get_frontside_element()).offset(),a.update_display(),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c,!0)):a.drop_on(c.get_context().get_backside(!0),void 0,c,!0);return!0},"start training":function(a,b,c){c&&c.running_watched||(a.initialize_backside_conditions(),a.get_body().reset_steps(),
b.robot_started_training(a));a.training_started(b);return!0},"stop training":function(a,b,c){a.training_finished();return!0},train:function(a,b,c){a.add_step(c.step);return!0},"open the backside":function(){return!0},"open the backside of":function(){return!0},"close the backside of":h,"close the backside":h,"click the button of":function(a,b,c){".toontalk-green-flag"!==c.button_selector||c&&c.running_watched||a.set_running(!0);return!0}},e=function(a,c,d,e){var g=c.get_thing_in_hand(),h=c.get_frontside_element(),
l=a.get_element(),k=function(a,b,c){return c.some(function(c){if(Math.abs(c-a)<=b)return!0})},m,q,r,t,G,B,M;l||(l=b.UTILITIES.find_resource_equal_to_widget(a,c));b.UTILITIES.is_attached(l)&&c.visible()?(m=l.getBoundingClientRect(),e&&e.left_offset_fraction?(c.original_animation_left_offset||(c.original_animation_left_offset=[]),c.original_animation_top_offset||(c.original_animation_top_offset=[]),t=e.left_offset_fraction*m.width,G=e.top_offset_fraction*m.height,g&&(B=g.get_element(),b.UTILITIES.visible_element(B)&&
(M=$(B).offset(),h=$(h).offset(),t-=M.left-h.left,G-=M.top-h.top)),g&&k(t,c.last_thing_in_hand_width,c.original_animation_left_offset)&&0<=c.original_animation_top_offset.indexOf(G)?(t=c.animation_left_offset+c.last_thing_in_hand_width,G=c.animation_top_offset,t>=m.width&&(t=0,G+=c.max_thing_in_hand_height,G>=m.height&&(G=0)),b.UTILITIES.when_attached(B,function(){c.last_thing_in_hand_width=b.UTILITIES.get_element_width(B);"undefined"===typeof c.max_thing_in_hand_height&&(c.max_thing_in_hand_height=
0);c.max_thing_in_hand_height=Math.max(c.max_thing_in_hand_height,$(B).height())})):(c.original_animation_left_offset.push(t),0>c.original_animation_top_offset.indexOf(G)&&c.original_animation_top_offset.push(G),c.last_thing_in_hand_width=b.UTILITIES.get_element_width(B),c.max_thing_in_hand_height=b.UTILITIES.get_element_height(B)),l.animation_left_offset=t,l.animation_top_offset=G,c.animation_left_offset=t,c.animation_top_offset=G):(q=m.width/2,r=m.height/2),c.animate_to_widget(a,d,c.transform_animation_speed(.25),
q,r,!0,c.transform_original_step_duration(e&&e.time),c)):d()},a=function(a,b,c,d){e(a,b,function(){a.open_backside(c);q(a,b)},d)},g=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},m=function(a,c,d,e,h,l){var k=g(a,e);c.get_frontside_element();var m=function(){d(k);$(k).addClass("ui-state-active");if(".toontalk-select-function"===e||".toontalk-box-size-input"===e)k.value=h.argument_1;setTimeout(function(){$(k).removeClass("ui-state-active");c.run_next_step(!0)},l)},t=function(){var d;
b.UTILITIES.visible_element(k)||(d=a.get_backside(!0),d.set_advanced_settings_showing(!0,d.get_element()));c.animate_to_element(k,m,c.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)};k&&b.UTILITIES.visible_element(k)||!a.open_backside||!c.animate_consequences_of_actions()?t():a.open_backside(t)&&q(a,c)},l=function(a,d,e,g,h){var l=b.UTILITIES.closest_element($("."+h),$(d.get_frontside_element()).offset()),k=function(){c(a,d,e,g)};l&&d.animate_consequences_of_actions()&&0<
$("."+h).length?d.animate_to_element(l,k,d.transform_animation_speed(b.UTILITIES.default_animation_speed),0,0,!0):k()},c=function(a,c,d,e){c.get_frontside_element();var g=function(){c.carrying_tool=void 0;c.update_display();d();c.run_next_step(!0)},h;c.animate_consequences_of_actions()?(c.carrying_tool=e,c.update_display(),e=c.transform_animation_speed(b.UTILITIES.default_animation_speed/2),a?c.animate_to_element(a.get_element(),g,e,0,0,!0):(h=c.top_level_widget().get_element(),a=$(h).offset(),a.left+=
$(h).width()*(.1+.8*Math.random()),a.top+=$(h).height()*(.1+.8*Math.random()),c.animate_to_absolute_position(a,g,e,!0))):(d(),c.run_next_step(!0))},h=function(a,b,c){var d=a.get_parent_of_frontside();l(a,b,function(){c();d&&"top-level"!==d.get_widget().get_type_name()&&d.update_display&&d.update_display();a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")},t=function(a,b,c){a.open_backside(function(){c();b.run_next_step(!0)});q(a,b)},q=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&
a.get_backside().hide_backside()})},k=function(a,b,c,d){d=b.transform_original_step_duration(d&&d.time);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();c();b.run_next_step(!0)},d)},r={copy:function(a,b,c){l(a,b,function(){c();a.add_copy_to_container(b.get_recently_created_widget())},"toontalk-wand-small","toontalk-wand")},"pick up":function(a,c,d,g){var h=function(){d();c.animate_consequences_of_actions()&&c.update_display();c.run_next_step(!0)};b.debugging&&
"empty hole"===a.get_type_name()?b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):a.save_dimensions()&&c.animate_consequences_of_actions()?e(a,c,h,g):h()},"pick up a copy of":function(a,c,d,g){e(a,c,function(){var e;d();c.animate_consequences_of_actions()&&(e=c.get_recently_created_widget())&&(e.set_visible(!0),b.UTILITIES.copy_frontside_dimensions(a,e),c.update_display());c.run_next_step(!0)},g)},"drop it on":function(c,d,f,g){var h=d.get_thing_in_hand(),l,k;h?(b.debugging&&
h===c&&b.UTILITIES.report_internal_error("Dropping something on itself!"),l=h.get_element(!0),h.set_visible(d.visible()),k=function(){var a;$(l).removeClass("toontalk-held-by-robot");h.drop_on&&(d.animate_consequences_of_actions()&&!b.UTILITIES.visible_element(l)&&(a=$(d.get_frontside_element()).closest(".toontalk-backside-of-top-level"),0<a.length&&a.get(0).appendChild(l)),d.rerender());f();h.drop_on&&h.visible()&&(b.UTILITIES.set_absolute_position(l,$(l).offset()),h.restore_dimensions());h.robot_waiting_before_next_step!==
d&&d.run_next_step(!0)},c.is_backside()&&!b.UTILITIES.visible_element(c.get_element())?a(c.get_widget(),d,k,g):e(c,d,k,g)):(b.debugging&&(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+d)),e(c,d,f,g))},"drop it on the text area of":function(c,d,f,g){var h=d.get_thing_in_hand(),l,k,m,q;h?(l=h.get_element(!0),h.set_visible(d.visible()),k=function(){var a;$(l).removeClass("toontalk-held-by-robot");f();h.remove();a=c.get_parent_of_frontside().get_widget();
a.is_hole()&&(a=a.get_parent_of_frontside());a.is_top_level()?c.render():a.render();d.set_thing_in_hand(void 0);d.run_next_step(!0)},m=function(){return $(c.get_backside_element()).find(g.area_selector).get(0)},d.rerender(),b.UTILITIES.visible_element(c.get_backside_element())?(q=m(),d.animate_to_element(q,k,d.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)):a(c,d,function(){q=m();d.animate_to_element(q,k,d.transform_animation_speed(b.UTILITIES.default_animation_speed/2),
0,0,!0)},g)):(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+d),e(c,d,f,g))},remove:h,"change whether erased":h,restore:function(a,c,d){l(void 0,c,function(){b.UTILITIES.set_css(a.get_element(!0),$(c.get_frontside_element()).position());d()},"toontalk-vacuum-ready-small","toontalk-vacuum")},edit:function(a,b,c,d){m(a,b,function(){a.get_backside()&&a.get_backside().update_display();c()},d.button_selector,d,b.transform_step_duration(1E3))},
"change size of":function(a,c,d,e){var g=a.get_frontside_element();g?c.animate_to_element(g,function(){var b=g.getBoundingClientRect(),h=b.width*e.x_factor,b=b.height*e.y_factor,l=c.transform_step_duration(1E3);$(g).addClass("toontalk-animating-element");g.style.transitionDuration=l+"ms";g.style.width=h+"px";g.style.height=b+"px";setTimeout(function(){$(g).removeClass("toontalk-animating-element");g.style.transitionDuration="";d();a.render();c.run_next_step(!0)},l)},c.transform_animation_speed(b.UTILITIES.default_animation_speed),
0,0,!0):(d(),c.run_next_step(!0))},"add to the top-level backside":function(a,b,c){c();b.run_next_step(!0)},"add a new widget to the work space":function(a,c,d,e){e&&e.button_selector?(a=b.path.dereference_path(e.path_to_source,c),m(a,c,d,e.button_selector,e,c.transform_step_duration(3E3))):(d(),c.run_next_step(!0))},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");
a.toontalk_followed_by={element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step(!0)},"stop training":function(a,c,d,e){var g=a.get_frontside_element();m(a,c,function(){var e=function(){g.toontalk_return_to=void 0;a.get_backside().change_label_and_title_of_train_button(!1);$(g).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");g.toontalk_followed_by=void 0;setTimeout(d,c.transform_step_duration(1500))};g.toontalk_return_to?
b.UTILITIES.animate_to_absolute_position(g,g.toontalk_return_to,e,c.transform_animation_speed(b.UTILITIES.default_animation_speed)):e()},".toontalk-train-backside-button",e,c.transform_step_duration(1E3))},train:function(a,b,c,d){var e=function(){c();b.run_next_step(!0)};(d=d.step.run_watched)?(a.run_next_step=e,a.set_context(a.get_parent_of_frontside().get_widget()),d(a)):e()},"open the backside":t,"open the backside of":t,"close the backside of":k,"close the backside":k,"click the button of":function(a,
b,c,d){m(a,b,function(d){$(d).is(".toontalk-settings-backside-button")&&">"===d.innerText&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().set_advanced_settings_showing(!1,a.get_backside_element())});$(d).click();c()},d.button_selector)}};b.creators_from_json.robot_action=function(a,c){return a.additional_info?b.robot_action.create(b.UTILITIES.create_from_json(a.path,c),a.action_name,b.UTILITIES.create_keys_from_json(a.additional_info,c)):b.robot_action.create(b.UTILITIES.create_from_json(a.path,
c),a.action_name)};return{create:function(a,c,e){var g=Object.create(this),h=d[c],l=r[c];if(l)return a||b.UTILITIES.report_internal_error("path undefined in "+c+" action"),h||b.UTILITIES.report_internal_error("no run_function for "+c),g.get_action_name=function(){return c},g.get_additional_info=function(){return e},g.run_unwatched=function(c){var d=b.path.dereference_path(a,c);if(!d)return b.UTILITIES.report_internal_error("Unable to dereference path: "+b.path.toString(a)+" in context: "+c.get_context()),
!1;b.logging&&0<=b.logging.indexOf("event")&&(d.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+d.wait_until_this_nest_receives_something.to_debug_string(50)+"("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)):console.log("   "+d.to_debug_string(50)+" ("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)));d.wait_until_this_nest_receives_something?d.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.visible()?
this.run_watched(c):this.run_unwatched(c)}.bind(this),c):h(d,c,e)&&c.run_next_step()},g.run_watched=function(c){var d=b.path.dereference_path(a,c),g=function(){if(!c.stopped()||c.being_trained)e||(e={}),e.running_watched=!0,h(d,c,e)};d?(b.logging&&0<=b.logging.indexOf("event")&&console.log("   "+d+" ("+b.path.toString(a)+" "+(d.to_debug_string?d.to_debug_string(50):d)+" by watched "+c.to_debug_string(50)+(c.animate_consequences_of_actions()?"":" finishing instantly")),d.wait_until_this_nest_receives_something?
(d.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.set_waiting(!1);this.run_watched(c)}.bind(this),c),c.set_waiting(!0),TOONTALK.UTILITIES.visible_element(c.get_context().get_backside_element())||c.get_frontside().remove()):l(d,c,g,e)):b.UTILITIES.report_internal_error("Unable to dereference the path: "+b.path.toString(a)+" in context: "+c.get_context())},g.toString=function(d){var g="",h="",l=c,k;if("open the backside"===c||"close the backside"===c)c+=" of";if("click the button of"===
c)switch(e.button_selector){case ".toontalk-green-flag":l="click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" of";break;case ".toontalk-stop-sign":l="click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":l="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":l="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":l=
"click the button to add or remove attributes of ";break;case ".toontalk-remove-backside-and-widget-buttton":l="click the button to remove the back and front of ";break;default:l="click a button of"}if("add a new widget to the work space"===c)return c.replace("a new widget",b.path.toString(a));if("add to the top-level backside"===c)return"";d||(d={});k=b.path.toString(a,d);if("edit"===c||"drop it on the text area of"===c)g=" ("+e.toString+")";else if("train"===c){g=e.step.toString({person:"third"});
if(""===g)return g;g=" to "+g;h="- ";d&&d.robot_being_trained_description&&(k=d.robot_being_trained_description)}else"start training"===c?d&&(d.robot_being_trained_description="it"):"stop training"===c&&(k=d.robot_being_trained_description,d.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(c)){if(0<=k.indexOf("hole of"))return h+l+" what is in "+k+g;if(0===k.indexOf("a When"))return k=k.substring(3),
k=b.UTILITIES.remove_encoded_HTML(k),k=b.UTILITIES.elide(k,80,1),"."===k[k.length-1]&&(k=k.substring(0,k.length-1)),h+l+" a robot who w"+k+g+"\n"}return h+l+" "+k+g},g.get_json=function(d,g,h){var l=function(e,f){b.path.get_json(a,d,function(a,b){g({type:"robot_action",action_name:c,path:a,additional_info:e},b)},f)};e?b.UTILITIES.get_json_of_keys(e,["running_watched"],l,h):l(void 0,h)},g;b.UTILITIES.report_internal_error("No watched function for "+c)}}}(window.TOONTALK);window.TOONTALK.queue=function(b){var h={create:function(){var d=Object.create(this);d.to_run=b.UTILITIES.create_queue();d.run_function=d.run.bind(d);return d},enqueue:function(b){b.running_or_in_run_queue()||(b.set_running_or_in_run_queue(!0),this.to_run.enqueue(b)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var d=Date.now()+h.maximum_run,e;for(this.running=!0;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<d;)e=this.to_run.dequeue(),e.run_actions();this.to_run.isEmpty()?this.running=!1:b.UTILITIES.set_timeout(this.run_function)}};return h}(window.TOONTALK);window.TOONTALK.path=function(b){var h;b.creators_from_json["path.to_entire_context"]=function(d,e){return b.path.to_entire_context()};b.creators_from_json["path.to_widget_on_nest"]=function(){return b.path.to_widget_on_nest()};b.creators_from_json["path.top_level_backside"]=function(){return b.path.top_level_backside};b.creators_from_json["path.to_backside_widget_of_context"]=function(d,e){return"undefined"===typeof d.backside_index?b.path.get_path_to_backside_widget_of_context(d.type_name,e&&e.robot):
b.path.get_path_to_backside_index_of_context(d.backside_index,d.type_name,e&&e.robot)};b.creators_from_json["path.to_resource"]=function(d,e){return b.path.get_path_to_resource(b.UTILITIES.create_from_json(d.resource,e))};return{get_path_to:function(d,e,a){var g=function(d,e){var c=e.get_training_context(),g=e.get_body(),h,k,r;d.is_primary_backside&&d.is_primary_backside()&&(r=!0,d=d.get_widget());if(c===d)return h=b.path.to_entire_context(),h.is_backside=r,h;k=d.get_type_name();if("top-level"===
k)return b.path.top_level_backside;if(h=g.get_path_to(d,e,a))return h.is_backside=r,h;if("element attribute"===k&&d.is_attribute_widget_copy(d))return h=b.element.create_attribute_path(d,e),h.is_backside=r,h;if(b.debugging&&!c)b.UTILITIES.report_internal_error("No context to compute the path");else{if(c.get_path_to&&(g=c.get_path_to(d,e)))return g.is_backside=r,h=b.path.to_entire_context(),h.next=g,h;c.get_backside_widgets().some(function(a){a=a.get_widget();var c;if(a===d||a.top_contents_is&&a.top_contents_is(d))return e.add_to_backside_conditions(a),
h=b.path.get_path_to_backside_widget_of_context(a,e),h.is_backside=r,!0;if(a.get_path_to&&(c=a.get_path_to(d,e)))return c.is_backside=r,e.add_to_backside_conditions(a),h=b.path.get_path_to_backside_widget_of_context(a,e),h.next=c,!0});if(h)return h.is_backside=r,h;if(c=d.ancestor_of_type("robot"))return b.robot.find_conditions_path(d,c,e);h=b.path.get_path_to_resource(d.copy());h.is_backside=r;return h}}(d,e,a);g&&d.dereference_contents&&(b.path.path_end(g).not_to_be_dereferenced=!0);!g||"pick up"!==
e.current_action_name&&"remove"!==e.current_action_name||(b.path.path_end(g).removing_widget=!0);return g},path_end:function(b){for(;b.next;)b=b.next;return b},dereference_path:function(b,e,a){var g;b?b.dereference_path?g=b.dereference_path(e,a):a&&a.dereference_path&&(g=a.dereference_path(b,e)):g=a||e.get_context();return g&&b&&b.is_backside?g.get_backside(!0):g},continue_dereferencing_path:function(b,e,a){void 0===e&&a.context_is_backside()&&(e=a.get_top_level_context());void 0===e&&(e=a.get_context());
return b.next?e.dereference_contents&&!b.next.not_to_be_dereferenced?(e=e.dereference_contents(b.next,a))&&b.is_backside?e.get_backside(!0):e:(e=e.dereference_path(b.next,a))&&b.next.is_backside?e.get_backside(!0):e:e.dereference_contents&&!b.not_to_be_dereferenced?(e=e.dereference_contents(b,a))&&b.is_backside?e.get_backside(!0):e:e},toString:function(d,e){var a="",g;if(!d)return"undefined path";d.is_backside&&(a="the backside of ");e||(e={});g=e.resource;e.resource=!0;d.next?(b.path.toString(d.next,
e),a=a+b.path.toString(d.next,e).trim()+" of "+d.toString(e)):a+=d.toString(e);e.resource=g;return a},get_json:function(d,e,a,g){var h,l;d.get_json?(h=function(c,g){d.is_widget&&(c=d.add_to_json(c,e));d.next&&(l=function(a){c.next_path=a},b.path.get_json(d.next,e,l,g));d.removing_widget&&(c.removing_widget=!0);d.not_to_be_dereferenced&&(c.not_to_be_dereferenced=!0);if(!0===d.is_backside||d.is_backside&&d.is_backside())c.is_backside=!0;a(c,g)},d.get_json(e,h,g)):a(d,g)},to_entire_context:function(d){return{dereference_path:function(d,
a){return b.path.continue_dereferencing_path(this,a,d)},toString:function(b){return b&&b.robot?b.robot.get_top_level_context_description(b):b&&"third"===b.person?"what he's working on":"what I'm working on"},get_json:function(b,a,d){a({type:"path.to_entire_context"},d)}}},to_widget_on_nest:function(){return{dereference_path:function(d,e){return b.path.continue_dereferencing_path(this,e,d)},toString:function(){return"what is on the nest"},get_json:function(b,e,a){e({type:"path.to_widget_on_nest"},
a)}}},get_path_to_resource:function(d){d||console.error("Widget missing in get_path_to_resource.");d=d.get_widget();return{dereference_path:function(e){var a=d.copy({copying_resource:!0}),g,h,l;e.add_newly_created_widget(a);e.visible()&&(g=b.UTILITIES.find_resource_equal_to_widget(d,e))&&(a.save_dimensions_of(b.UTILITIES.widget_side_of_element(g)),l=a.get_frontside_element(),h=$(g).position(),b.UTILITIES.set_timeout(function(){$(l).css({left:h.left,top:h.top,width:$(g).width(),height:$(g).height()})}));
return a},toString:function(e){return b.UTILITIES.add_a_or_an(d.toString(e))},get_json:function(e,a,g){d.get_json(b.UTILITIES.fresh_json_history(e),function(b,d){a({type:"path.to_resource",resource:b},d)},g)}}},get_path_to_backside_widget_of_context:function(d,e){return"string"===typeof d?{dereference_path:function(a){var e=a.get_context(),h=a.get_backside_widget_of_type(d,e);h||e.get_backside_widgets().some(function(b){if(b.get_widget().is_of_type(d)&&!a.is_newly_created(b.get_widget()))return h=
b.get_widget(),!0});if(h)return b.path.continue_dereferencing_path(this,h,a)},toString:function(a){a=(a&&a.robot&&a.robot.get_backside_conditions()?a.robot.get_backside_conditions()[d]:b.UTILITIES.add_a_or_an(d))+" on the back of what I'm working on";return this.removing_widget?"what is on "+a:a},get_json:function(a,b,e){b({type:"path.to_backside_widget_of_context",type_name:d},e)}}:this.get_path_to_backside_index_of_context(e.get_backside_condition_index(d),d.get_type_name(),e)},get_path_to_backside_index_of_context:function(d,
e,a){return{dereference_path:function(a){var h=a.get_backside_matched_widgets()[d],l;if(h)return this.removing_widget&&((l=h.get_parent_of_frontside())&&l.is_hole()&&(l=l.get_parent_of_frontside()),l&&l.removed_from_container&&"nest"!==e&&a.remove_from_container(h,l)),b.path.continue_dereferencing_path(this,h,a);b.debugging&&console.log("can this happen?")},toString:function(d){var h=(d=(d=a.get_frontside_conditions())&&d.is_top_level())?"work area":"back of what",h=b.UTILITIES.add_a_or_an(e||"thing")+
" on the "+h+" I'm working on";return!this.removing_widget||d&&"nest"!==e?h:"what is on "+h},get_json:function(a,b,h){b({type:"path.to_backside_widget_of_context",type_name:e,backside_index:d},h)}}},process_path_json:function(d,e,a){e.next_path&&(d.next=b.UTILITIES.create_from_json(e.next_path,a));e.removing_widget&&(d.removing_widget=!0);e.not_to_be_dereferenced&&(d.not_to_be_dereferenced=!0);e.is_backside&&(d.is_backside=!0)},top_level_backside:{dereference_path:function(d){if(d=d.get_context().ancestor_of_type("top-level"))return d;
h||(h=b.widget.create_top_level_widget());return h},toString:function(){return"the top-level backside"},get_json:function(b,e,a){e({type:"path.top_level_backside"},a)}}}}(window.TOONTALK);window.TOONTALK.publish=function(b){var h=function(b,e,a){var g='<!DOCTYPE html>\n<html>\n<head>\n<script src="https://toontalk.github.io/ToonTalk/toontalk.js?published=1">\x3c/script>\n<title>\n'+b+"</title>\n</head>\n<body>\n";e.forEach(function(b,d){g+='<div class="toontalk-edit" name="content">\n'+b+"\n</div>\n";a[d]&&(g+=a[d])});return g+="</body>\n</html>\n"};return{publish_widget:function(d,e,a,g){var m=b.google_drive.get_status(),l=["Edit this. Select text for formatting."],c=function(a){(a=
a&&a.items&&0<a.items.length&&a.items[0])?g(a,q):(a=h(d,l,q),b.google_drive.upload_file(t,"html",a,g))},t,q;"Ready"===m?(t=e.get_setting("program_name"),a?b.UTILITIES.get_json_top_level(e,function(a){e.set_setting("program_name",t+" (published version)");q=[b.UTILITIES.toontalk_json_div(a,e)];e.set_setting("program_name",t)}):(a=e.get_backside_widgets(),q=[],a.forEach(function(a,c){a.visible()&&b.UTILITIES.get_json_top_level(a,function(c){c.view&&(c.view.saved_width=void 0,c.view.saved_height=void 0);
q.push(b.UTILITIES.toontalk_json_div(c,a.get_widget()));l.push("")})})),b.google_drive.get_toontalk_files(b.google_drive.full_file_name(t,"page"),"page",c)):(console.log("Unable to publish to Google Drive because: "+m),g(null))},republish:function(d){b.google_drive.insert_or_update_file(void 0,d.file_id,"page",h(d.title,d.editable_contents,d.widgets_json),function(){console.log("Published page '"+d.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(b){var h=b.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",d=b.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",e="Need to authorize",a,g;return{handle_client_load:function(a){0>window.location.href.indexOf(d)?(e="Connections to Google Drive are configured for the following domain only: "+d+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",a&&
a(e)):setTimeout(function(){b.google_drive.check_authorization(a)})},check_authorization:function(a){e="Awaiting authorization";gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(d){b.google_drive.handle_authorization_result(d,a)})},handle_authorization_result:function(a,d){a&&!a.error?(e="Authorized but not yet ready",gapi.client.load("drive","v2",function(){b.google_drive.get_folder_ids(function(){e="Ready"})}),d&&d()):(e="Need to authorize",d&&
d(e))},authorize:function(a){gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(d){b.google_drive.handle_authorization_result(d,a)})},get_folder_ids:function(d){b.google_drive.get_folder_id(!0,function(e){a=e;b.google_drive.get_folder_id(!1,function(a){g=a;d()})})},get_folder_id:function(d,e){var c=d?"ToonTalk Programs":"ToonTalk Pages",h=function(a){var g=function(a){a&&a.id?e(a.id):console.error("Failure to create folder '"+c+"'. Response was "+
a)};(a=a&&a.items&&0<a.items.length&&a.items[0].id)?e(a):d?b.google_drive.create_folder("ToonTalk Programs",!1,g):b.google_drive.create_folder("ToonTalk Pages",!0,g)};d&&a?e(a):!d&&g?e(g):b.google_drive.fetch_folder_id(c,h)},get_status:function(){return e},connection_to_google_drive_possible:function(){return 0!==e.indexOf("Connections to Google Drive are configured for the following domain only: ")&&!b.CHROME_APP},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",
params:a}).execute(b)},fetch_folder_id:function(a,d){b.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},d)},get_toontalk_files:function(a,d,c){"undefined"===typeof gapi?c("Google Drive API not available."):(d="properties has {key='ToonTalkType' and value='"+d+"' and visibility='PUBLIC'} and trashed = false",a&&(d+=" and title='"+a+"'"),b.google_drive.list_files({q:d},c))},get_toontalk_program_file:function(d,e){b.google_drive.list_files({q:"'"+
a+"' in parents and trashed = false and title='"+d+"'"},function(a){a&&a.items&&0<a.items.length?e(a.items[0]):e(null)})},upload_file:function(a,d,c,e){var g="json"===d?"program":"page",h=a+"."+d;b.google_drive.get_toontalk_files(h,g,function(a){gapi.client.load("drive","v2",function(){var d=a&&a.items&&0<a.items.length&&a.items[0].id;e||(e=function(a){a.error&&(console.log("Google drive status: "+b.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message));console.log("File "+
a.title+" ("+a.id+") "+(d?"updated":"created"))});d?b.google_drive.insert_or_update_file(void 0,d,g,c,e):b.google_drive.insert_or_update_file(h,void 0,g,c,e)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(d,e,c,h,q){var k={title:d,mimeType:"text/html"};k.parents=[{kind:"drive#fileLink",id:"program"===c?a:g}];h="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(k)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
h+"\r\n---------314159265358979323846--";d?(d="/upload/drive/v2/files",k="POST"):(d="/upload/drive/v2/files/"+e,k="PUT");gapi.client.request({path:d,method:k,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:h}).execute(function(a){e||b.google_drive.insert_property(a.id,"ToonTalkType",c,"PUBLIC");q&&q(a)})},create_folder:function(a,b,c){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){c(a)})}:c)},download_file:function(a,b){if(a.downloadUrl){var c=gapi.auth.getToken().access_token,d=new XMLHttpRequest;d.open("GET",a.downloadUrl);d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=function(){b(null)};d.send()}else b(null)},google_drive_url:function(a){return"https://googledrive.com/host/"+a+"/"},insert_property:function(a,
b,c,d){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:c,visibility:d}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(b){var h={},d=!1,e,a=100,g=(new Date).getTime(),m=[],l=[],c,t=[],q=new MutationObserver(function(a){a.forEach(function(a){var b,c;for(b=0;b<a.addedNodes.length;b++)c=a.addedNodes.item(b),1===c.nodeType&&setTimeout(function(){!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0,c.toontalk_run_even_if_not_observable=
void 0);$(c).find(".toontalk-has-attached-callback").each(function(a,b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)})})})}),k=function(a,b,c){var d;if(a){d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},r=function(a,c){b.debugging+="\n"+a;console.log(a);c&&(alert(b.debugging),b.debugging="touch")},n=function(a){var b=a.indexOf("<div style='display:none;'>{"),
b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},u=function(a,c){if(!$(c).is(".toontalk-conditions-contents")){var d=$(c).closest(".toontalk-side"),f=h.get_mouse_or_first_touch_event_attribute("clientX",a),g=h.get_mouse_or_first_touch_event_attribute("clientY",a),k,l,m,n;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(a.dataTransfer&&a.dataTransfer.getData("text")&&0<a.dataTransfer.getData("text").length)){e=d||$(c);m=
h.widget_side_of_jquery(e);if(!m){m=h.widget_side_of_element(c);h.report_internal_error("Possible bug that "+e+" doesn't have a known owner.");if(!m){h.report_internal_error("The element doesn't have an owner either.");return}e=$(c)}m=m.get_selection();e=$(m.get_element());m.set_stopped&&m.set_stopped(!0);!m.save_dimensions||m.get_parent_of_frontside()&&!m.get_parent_of_frontside().get_widget().is_top_level()||m.save_dimensions();m.being_dragged=!0;k=e.get(0).getBoundingClientRect();n=e.is(".toontalk-top-level-resource");
$(c).removeClass("toontalk-wiggle");m.get_json&&(d=function(b){b.view.drag_x_offset=f-k.left;b.view.drag_y_offset=g-k.top;!b.view.frontside_width&&e.parent().is(".toontalk-backside")&&(b.view.frontside_width=e.width(),b.view.frontside_height=e.height());e.data("json",b);a.dataTransfer&&(l=h.toontalk_json_div(b,m),a.dataTransfer.effectAllowed=n?"copy":"move",a.dataTransfer.setData("text",l),h.is_internet_explorer()||a.dataTransfer.setData("text/html",l));m.drag_started&&m.drag_started(b,n)},a.dataTransfer&&
a.dataTransfer.setData("text","Sorry, it took too long to generate the data structure needed to reconstruct "+m+"."),b.UTILITIES.get_json_top_level(m,d,6E5));e.addClass("toontalk-being-dragged");a.stopPropagation()}}},f=function(a,b){var c;if(!$(b).is(".toontalk-conditions-contents")){e||(e=$(a.target).closest(".toontalk-side"));if(c=h.widget_side_of_jquery(e))c.being_dragged=void 0;e.is(".toontalk-frontside")&&(e.parent().is(".toontalk-backside")?(c=e.data("json"))&&h.set_css(e,{width:c.view.frontside_width,
height:c.view.frontside_height}):e.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||e.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||h.has_animating_image(e.get(0))||h.set_css(e,{width:"100%",height:"100%"}));B();a.stopPropagation()}},x=function(a){if(e)return h.widget_side_of_jquery(e);if(a)return a=h.data_transfer_json_object(a),h.create_from_json(a)},A=function(a,c){var d=h.data_transfer_json_object(a),
f=function(a,d){var e=h.create_from_json(a),f=document.createElement("div"),g=e.get_element(!0),p=$(c).closest(".toontalk-edit"),k=b.published_support.create_editable_text(),l=d.target;$(f).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");$(g).addClass("toontalk-top-level-resource").css({position:"relative",width:e.saved_width,height:e.saved_height});g.toontalk_widget_side=e;f.toontalk_widget_side=e;f.appendChild(g);for($(f).insertAfter(p);l.nextSibling;)$(k).children(".froala-element").get(0).appendChild(l.nextSibling);
$(k).insertAfter(f);e.set_visible(!0);e.render()},g=function(){var a;k.hide();a=document.elementFromPoint(u-window.pageXOffset-b.USABILITY_DRAG_OFFSET.x,x-window.pageYOffset-b.USABILITY_DRAG_OFFSET.y);k.show();if(a)return $(a).closest(".toontalk-side")},k,l,m,n,q,r,t,u,x;void 0===d&&e&&(d=e.data("json"));e&&e.data("json","");k=e;B();if(k||void 0!==d||a.dataTransfer.files||Q(a)){if($(a.target).is(".toontalk-drop-area-instructions"))f=$(a.target).parent();else if($(a.target).is(".toontalk-element-attribute-input")){if(f=
$(a.target).closest(".toontalk-side"),l=h.widget_side_of_jquery(f)){g=k?h.widget_side_of_jquery(k):h.create_from_json(d);h.restore_resource(k,g);l.dropped_on_style_attribute(g,a.target.name,a);a.stopPropagation();return}}else if($(a.target).is(".toontalk-drop-area"))f=$(a.target);else{if(d&&$(a.currentTarget).is(".froala-element")){f(d,a);return}f=k&&k.is(".toontalk-backside")?$(a.target).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):$(a.target).closest(".toontalk-side")}if(0!==
f.length){u=h.get_mouse_or_first_touch_event_attribute("pageX",a);x=h.get_mouse_or_first_touch_event_attribute("pageY",a);if(f.is(".toontalk-top-level-resource"))if("touchend"===a.type){f=$(".toontalk-highlight");if(0===f.length||f.get(0)===k.get(0))f=g();if(!f||0===f.length)return}else return;q=f.offset();l=h.widget_side_of_jquery(f);if(k&&0<k.length&&!(l&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack())&&(k.get(0)===f.get(0)||jQuery.contains(k.get(0),f.get(0)))){if(k.is(".toontalk-backside-of-top-level"))return;
f=$(".toontalk-highlight");if(0===f.length||f.get(0)===k.get(0))f=g();if(!f||0===f.length)return;q=f.offset();l=h.widget_side_of_jquery(f)}h.remove_highlight();d&&d.view&&d.view.drag_x_offset?(m=d.view.drag_x_offset,n=d.view.drag_y_offset):n=m=0;if(k&&0<k.length){if(!(l&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack()||k.get(0)!==f.get(0)&&!jQuery.contains(k.get(0),f.get(0)))){h.set_css(k,{left:k.get(0).offsetLeft+(a.layerX-m),top:k.get(0).offsetTop+(a.layerY-n)});a.stopPropagation();
return}g=h.widget_side_of_jquery(k);k.parent().is(".toontalk-drop-area")?(k.removeClass("toontalk-widget-in-drop_area"),k.parent().data("drop_area_owner").set_next_robot(void 0)):((t=g&&g.get_parent())?(r=$(t.get_element()),!g.is_backside()&&g.get_widget().get_infinite_stack&&g.get_widget().get_infinite_stack()?(r=g.get_widget().saved_width,t=g.get_widget().saved_height,g=g.copy(),g.get_widget().saved_width=r,g.get_widget().saved_height=t,r=k.width(),t=k.height(),k=$(g.get_element(!0)),f.is(".toontalk-backside")&&
h.set_css(k,{width:d.view.frontside_width||r,height:d.view.frontside_height||t})):t.removed_from_container&&(r.is(".toontalk-backside")?t.remove_backside_widget(g,!0):(t.removed_from_container(g,a),g.restore_dimensions&&!t.is_empty_hole()&&g.restore_dimensions()))):h.restore_resource(k,g),g&&g.robot_in_training()&&g.robot_in_training().add_newly_created_widget_if_new(g))}else{if(0<a.dataTransfer.files.length){for(d=0;d<a.dataTransfer.files.length;d++)H(a.dataTransfer.files[d],f,l,q,a);a.stopPropagation();
return}if(Q(a)){w(a.dataTransfer.getData("URL"),f,l,q,a);a.stopPropagation();return}g=h.create_from_json(d,{event:a});if(!g){d?h.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):b.debugging&&console.log("No data transfer in drop.");a.stopPropagation();return}g.robot_in_training()&&g.robot_in_training().drop_from_data_transfer(g);k=$(g.get_element(!0));g.is_primary_backside&&g.is_primary_backside()&&(h.set_css(k,{width:d.view.backside_width,height:d.view.backside_height,
"background-color":d.view.background_color,"border-width":d.view.border_width}),g.apply_backside_geometry())}l&&g.get_widget()===l.get_widget()||z(f,k,g,l,q,a,d,m,n)}}else a.dataTransfer?h.report_internal_error("Drop failed since unable to parse as JSON."):h.report_internal_error("Drop failed since there is no event.dataTransfer"),a.stopPropagation()},F=function(a,b){a.addEventListener("drop",function(a){var c=x(a);h.restore_resource(h.get_$dragee(),c);b(a)})},L=function(a,b){var c;c=h.get_$dragee();
var d;d=c&&c.is(".toontalk-backside")?$(b).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):$(b).closest(".toontalk-side");c=!d.is("*")||d.is(".toontalk-backside-of-top-level")||d.closest(".toontalk-top-level-resource").is("*")||d.is(".toontalk-being-dragged")||c&&M(d.get(0),c.get(0))?void 0:d;if(c)return h.highlight_element(c.get(0),a),c.get(0)},z=function(a,c,d,e,f,g,k,l,m){var n=h.get_mouse_or_first_touch_event_attribute("pageX",g),q=h.get_mouse_or_first_touch_event_attribute("pageY",
g),r,t,u,w;l||(l=0);m||(m=0);d.set_visible(!0);if(a.is(".toontalk-backside")){if(d.get_widget().is_top_level()){r=k.semantic.backside_widgets;t=k.shared_widgets;u=a.get(0);(l=e.robot_in_training())&&l.drop_from_data_transfer(d,e);l=d.get_widget().get_backside_widgets().slice();b.UTILITIES.for_each_batch(l,function(a,b){var c=a.get_widget(),f,g,p,k,l,v,m;d.remove_backside_widget(a);f=0<=r[b].widget.shared_widget_index?t[r[b].widget.shared_widget_index].view:r[b].widget.view;g=a.get_element(!0);a.is_backside()?
(p=f.backside_left,k=f.backside_top,l=f.backside_width,v=f.backside_height):(p=f.frontside_left,k=f.frontside_top,l=f.frontside_width,v=f.frontside_height);e.add_backside_widget(a);u.appendChild(g);m=$(g).position();w={left:m.left+p,top:m.top+k,width:l,height:v};h.constrain_css_to_fit_inside(u,w);h.set_css(g,w);d.set_location_attributes&&c.set_location_attributes(w.left,w.top);a.is_backside()&&(c.backside_geometry=f.backside_geometry,c.apply_backside_geometry())}.bind(this));return}if(!e){h.report_internal_error("No target_widget");
return}d?e.widget_side_dropped_on_me(d,g):h.report_internal_error("No source_widget");g=n-(f.left+(l||0));a=q-(f.top+(m||0));w={left:h.left_as_percent(g,c.get(0)),top:h.top_as_percent(a,c.get(0))};h.set_css(c,w);!d.is_backside()&&d.set_location_attributes&&d.set_location_attributes(g,a);k&&k.semantic&&k.semantic.running&&!h.get_$dragee()&&d.set_running(!0)}else if(a.is(".toontalk-drop-area"))c.addClass("toontalk-widget-in-drop_area"),0<a.length&&a.get(0).appendChild(c.get(0)),c.is(".toontalk-robot")&&
a.data("drop_area_owner").set_next_robot(h.widget_side_of_jquery(c));else{if(c.is(".toontalk-backside-of-top-level"))return;if(e||g.changedTouches){u=a.closest(".toontalk-backside-of-top-level").get(0);!u&&g.changedTouches&&(k=document.elementFromPoint(n-window.pageXOffset,q-window.pageYOffset),(u=$(k).is(".toontalk-backside-of-top-level")?k:$(k).closest(".toontalk-backside-of-top-level").get(0))||(u=$(".toontalk-backside-of-top-level").get(0)),e=h.widget_side_of_element(u).get_backside());if(!u)return;
u.appendChild(c.get(0));k=$(u).offset();w={left:n-(k.left+l+b.USABILITY_DRAG_OFFSET.x),top:q-(k.top+m+b.USABILITY_DRAG_OFFSET.y)};h.set_css(c,w);d.drop_on&&d.drop_on(e,g)||e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(d,g)||(c=a.closest(".toontalk-backside-of-top-level"),0<c.length&&(e=h.widget_side_of_jquery(c))&&e.widget_side_dropped_on_me(d,g))}else{h.report_internal_error("target widget missing");return}}b.logging&&0<=b.logging.indexOf("drop")&&(console.log("Drop of "+d._debug_id+" on "+
e._debug_id),console.log("Left: "+w.left+"; top: "+w.top+"; page_x: "+n+"; page_y: "+q+"; drag_x_offset: "+l+"; drag_y_offset: "+m));h.remove_highlight()},H=function(a,c,d,e,f){var g=new FileReader,k=0===a.type.indexOf("image"),l=0===a.type.indexOf("audio"),m=0===a.type.indexOf("video"),q,r,t;g.onloadend=function(){if(k)q=b.element.create("<img src='"+g.result+"' alt='"+a.name+"'/>");else if(l)q=b.element.create(a.name+" sound"),q.set_sound_effect(new Audio(g.result));else if(m)q=b.element.create("<video src='"+
g.result+"' alt='"+a.name+"'/>");else{if(r=n(g.result))try{t=JSON.parse(r),q=h.create_from_json(t)}catch(u){}q||(q=b.element.create(g.result))}q&&q.robot_in_training()&&q.robot_in_training().drop_from_data_transfer(q,d);z(c,$(q.get_frontside_element(!0)),q,d,e,f,t)};k||l||m?g.readAsDataURL(a):g.readAsText(a)},w=function(a,c,d,e,f){var g=function(a,c,e,f){var g=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),z(c,$(a.get_frontside_element(!0)),a,d,e,f))};
h.create_widget_from_URL(a,g,function(c){var d=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");d?g(b.element.create(d)):(h.display_message("Error: "+c+". When trying to fetch "+a),console.log(c))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&g(a,c,e,f)})},I=function(a,b){var c=$("<div class='"+a+"'>");h.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},P=function(){var a=
h.get_path_to_toontalk_folder()+"sounds/",c=function(b){b=new Audio(a+b);b.volume=h.get_audio_volume(b);return b};b.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),event_ignored:c("PLOP.mp3")};b.sounds.bird_fly.loop=!0},G=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},
B=function(){e&&(e.removeClass("toontalk-being-dragged"),h.set_timeout(function(){e=void 0}))},M=function(a,b){if(a===b)return!0;if(a.parentNode)return M(a.parentNode,b)},N=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",k,l;if(0>f)return a;for(;0<=f;){k=f+d.length;l=a.indexOf(e,k);if(0>l)return h.report_internal_error("Expected title to have matching pairs of "+d+" and "+
e),a;g+=a.substring(c,f)+b(a.substring(k,l));c=l+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},Q=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},O=[],J=[],D;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window?(a.stopPropagation(),0<O.length&&O.shift()()):a.data.editable_contents&&b.publish.republish(a.data)},!1);q.observe(window.document,{childList:!0,subtree:!0});h.available_types="number box element robot nest sensor top-level".split(" ");
h.create_from_json=function(a,c,d){var e=function(a,b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},f,g,k,l,m;if(a){c||(c={});c.guid_to_nest_table||(c.guid_to_nest_table={});a.shared_widgets&&(c.json_of_shared_widgets=a.shared_widgets,c.shared_widgets=[]);a.shared_html&&(c.shared_html=a.shared_html);if(a.widget)return(f=h.create_from_json(a.widget,c))&&a.is_backside?f.get_backside(!0):
f;if(c&&c.shared_widgets&&0<=a.shared_widget_index){if(d=c.shared_widgets[a.shared_widget_index])return d;d=c.json_of_shared_widgets[a.shared_widget_index];f=h.create_from_json(d,c,!0);return e(f,c,a.shared_widget_index)}(k=a.semantic)||(k=a);l=a.view;if(0<=k.shared_widget_index){if(!c.json_of_shared_widgets){h.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}f=h.create_from_json(c.json_of_shared_widgets[k.shared_widget_index],c,!0);return e(f,c,k.shared_widget_index)}if(b.creators_from_json[k.type]){c||
(c={});l?c.json_view=l:l=c.json_view;if(b.debugging)f=b.creators_from_json[k.type](k,c);else try{f=b.creators_from_json[k.type](k,c)}catch(n){console.error(n.stack),h.report_internal_error("Unable to recreate a "+k.type+". Error is "+n)}f&&!f.is_widget&&b.path.process_path_json(f,a,c);if(f&&f.get_backside){k.erased&&(b.widget.erasable(f),f.set_erased(k.erased));k.infinite_stack&&f.set_infinite_stack(k.infinite_stack);k.open_backside_only_if_stopped&&f.set_open_backside_only_if_stopped(!0);if(l){if(l.frontside_width)if(g=
f.get_element()){if(f.ok_to_set_dimensions())if(m={width:l.frontside_width,height:l.frontside_height},"element"===k.type)f.on_update_display(function(){h.set_css(g,m)});else h.set_css(g,m)}else l.saved_width||(f.saved_width=l.frontside_width,f.saved_height=l.frontside_height);l.saved_width&&(f.saved_width=l.saved_width,f.saved_height=l.saved_height);l.backside_geometry&&(f.backside_geometry=l.backside_geometry);f.json_view=l}k.backside_widgets&&(d?f.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(f,
k.backside_widgets,c)}.bind(this):this.add_backside_widgets_from_json(f,k.backside_widgets,c))}return f}h.report_internal_error("JSON type '"+k.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};h.add_backside_widgets_from_json=function(a,b,c){var d;b&&(d=this.create_array_from_json(b,c),a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:
a.widget.view:a})))};h.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?h.create_from_json(a,b):a});return c};h.get_json_of_array=function(a,b,c,d,e,f){var g,k;c>=a.length?e():(g=a[c])?g.is_primary_backside&&g.is_primary_backside()?(k=function(f,g){b.push({widget:f,is_backside:!0});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),h.get_json(g.get_widget(),d,k,f)):g.is_widget?(k=function(g,k){b.push({widget:g});0===c%100&&(!h.maximum_json_generation_duration||Date.now()-
f>h.maximum_json_generation_duration)?h.set_timeout(function(){this.get_json_of_array(a,b,c+1,d,e,k)}.bind(this)):this.get_json_of_array(a,b,c+1,d,e,k)}.bind(this),h.get_json(g,d,k,f)):(k=function(f,g){b.push(f);this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),g.get_json(d,k,f)):h.get_json_of_array(a,b,c+1,d,e,f)};h.fresh_json_history=function(a){var b={widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=a.shared_html);return b};h.get_json_top_level=
function(a,b,c){var d=this.fresh_json_history();h.maximum_json_generation_duration=c;h.get_json(a,d,function(c){0<d.shared_widgets.length&&(c.shared_widgets=d.shared_widgets.map(function(b,e){var f=function(a){a=d.widgets_encountered.indexOf(a);return d.json_of_widgets_encountered[a]},g=function(a){return f(d.shared_widgets[a])},k=f(b);if(a===b)return k={semantic:k.semantic,view:k.view,version:k.version},c.semantic={shared_widget_index:e},k;c.semantic&&h.tree_replace_once(c.semantic,k,{shared_widget_index:e},
g,h.generate_unique_id());return k}));c.shared_html=d.shared_html;b(c)},Date.now())};h.get_json=function(a,c,d,e){var f,g,k;b.debugging&&!c?h.report_internal_error("no json_history"):(f=c.shared_widgets.indexOf(a),0<=f?d({shared_widget_index:f},e):(f=c.widgets_encountered.indexOf(a),0<=f?(f=h.insert_ancestors_last(a,c.shared_widgets),d({shared_widget_index:f},e)):(f=c.widgets_encountered.push(a)-1,(g=a.is_primary_backside&&a.is_primary_backside())&&(a=a.get_widget()),k=function(b,e){a.add_to_json&&
(b=a.add_to_json(b,c));c.json_of_widgets_encountered[f]=b;a.add_backside_widgets_to_json?a.add_backside_widgets_to_json(b,c,function(){d(b,e)},e):d(b,e)},Date.now()-e<=h.maximum_json_generation_duration?a.get_json(c,k,e):setTimeout(function(){a.get_json(c,k,Date.now())}))))};h.get_json_of_keys=function(a,b,c,d){var e;b||(b=[]);Object.keys(a).forEach(function(c){0>b.indexOf(c)&&(e||(e={}),a[c].get_json?a[c].get_json(void 0,function(a,b){e[c]={json:a}},d):e[c]=a[c])});c(e,d)};h.create_keys_from_json=
function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?h.create_from_json(a[d].json,b):a[d]});return c};h.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).forEach(function(g){if(f=a[g]){if(f===b)return a[g]=c,!0;if("shared_widget_index"===g){if(this.tree_replace_once(d(f),b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,
b,c,d,e))return!0}}.bind(this));return!1}};h.insert_ancestors_last=function(a,b){var c=a.get_widget(),d=-1;b.some(function(a,b){if(c.has_ancestor(a))return d=b,!0});0>d&&(d=b.length);b.splice(d,0,c);return d};h.toontalk_json_div=function(a,b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name(),c=c.toString({for_json_div:!0}),f;"top-level"===e?b.is_backside()?(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":
e+(d.length+" things: "),e+=h.describe_widgets(d))):e="a top-level widget":(e=h.add_a_or_an(e),b.is_backside()&&(e="the back of "+e));c&&(d=c.indexOf("data:image/"),0<d&&(f=c.indexOf("alt=",d),0>f&&(f=c.indexOf(">",d)),c=c.substring(0,d+20)+" ... "+c.substring(f)));return"<div class='toontalk-json' translate='no' style='display:none'>\nThis will be replaced by "+e+".\n"+(c?c+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,h.clean_json,"  ")+"</div></div>"};h.describe_widgets=function(a){var b=
"",c=a.length;a.forEach(function(a){c--;b+=h.add_a_or_an(a.get_type_name());1===c?b+=", and ":1<c&&(b+=", ")});return b};h.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};h.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:b};h.create_widget_from_URL=function(a,c,d){var e=function(g){try{var h=this.getResponseHeader("content-type"),
k,l;if(!h)if(l=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),0===a.indexOf(l))h="";else{d&&d("Could not determine the contents type of the url");f.removeEventListener("readystatechange",e);return}0===h.indexOf("audio")?(k=b.element.create(a),k.set_sound_effect(new Audio(a))):0===h.indexOf("image")?k=b.element.create("<img src='"+a+"'>"):0===h.indexOf("video")?k=b.element.create("<video src='"+a+" ' width='320' height='240'>"):0===h.indexOf("text")&&
0>h.indexOf("text/html")?this.responseText&&(k=b.element.create(this.responseText),k.set_source_URL(a)):k=b.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");k&&c(k)}catch(m){d&&d(m),c()}f.removeEventListener("readystatechange",e)},f=new XMLHttpRequest;f.addEventListener("readystatechange",e);f.open("GET",a,!0);try{f.send()}catch(g){d?d(g):(h.display_message("Error trying to GET "+a+" "+g),console.error(g.stack))}};h.copy_widgets=
function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};h.copy_widget_sides=function(a,b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};h.copy_array=function(a){return a.slice()};h.generate_unique_id=function(){g+=1;return"toontalk_id_"+g};h.get_style_property=function(a,b){var c;if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle){if(a.parentElement)return document.defaultView.getComputedStyle(a,
null).getPropertyValue(b);document.body.appendChild(a);c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b);document.body.removeChild(a);return c}};h.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;if("string"===typeof c){d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;c=parseFloat(c,10);return isNaN(c)?void 0:c}return c};h.get_element_width=function(a){return a?a.getBoundingClientRect().width:
0};h.get_element_height=function(a){return a?a.getBoundingClientRect().height:0};h.data_transfer_json_object=function(a){var c,d;if(a.dataTransfer&&!(0<a.dataTransfer.files.length||Q(a))){try{c=a.dataTransfer.getData("text/html")}catch(e){c=a.dataTransfer.getData("text")}if(!c||c.match(/[\u3400-\u9FBF]/))c=a.dataTransfer.getData("text");if(c){if(a=n(c))try{return JSON.parse(a)}catch(e){h.report_internal_error("Exception parsing "+a+"\n"+e.toString())}a=b.element.create("");a.get_frontside_element(!0);
a.set_HTML(c);a.get_json(h.fresh_json_history(),function(a,b,c){0<=a.html.shared_html_index&&(a.html=c.shared_html[a.html.shared_html_index]);d=a});return d}}};h.drag_and_drop=function(a){var b;h.draggable(a);h.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,h.enable_touch_events(a,b))};h.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){u(b,a)});a.addEventListener("dragend",function(b){f(b,
a)})};h.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",function(b){b.preventDefault();A(b,a);b.stopPropagation()});a.addEventListener("dragenter",function(c){var d=L(c,a);d&&b!==d&&h.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!h.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(h.remove_highlight(b),b=void 0);a.stopPropagation()})};h.create_drop_area=
function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");b.appendChild(d);h.can_receive_drops(b);return b};h.process_json_elements=function(a,c){var d,e,f,g,k,l,m,n,q;a||(a=$(".toontalk-json"),c=0);if(0!==a.length&&(q=function(){if(g){d.textContent="";$(d).css({display:""});if(g.get_type_name)if(g.is_top_level())m=g.get_backside(!0),l=m.get_element(),$(d).replaceWith(l),
$(l).css({width:g.json_view?g.json_view.backside_width:f.view.backside_width,height:g.json_view?g.json_view.backside_height:f.view.backside_height,"background-color":f.view.background_color,"border-width":f.view.border_width}),g.json_view=void 0;else{if($(d).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),k=g.get_frontside_element(!0))$(k).addClass("toontalk-top-level-resource").css({position:"relative",width:g.saved_width,height:g.saved_height}),d.toontalk_widget_side=
g,d.appendChild(k)}else d.appendChild(g.get_element());g.set_active&&g.set_active(!1);g.set_visible&&g.set_visible(!0);setTimeout(function(){g.update_display&&g.update_display();f.semantic.running&&g.set_running(!0)},1)}else h.report_internal_error("Could not recreate a widget from this JSON: "+e);c<a.length-1&&h.process_json_elements(a,c+1)},d=a.get(c),e=d.textContent))if(e=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),f=JSON.parse(e),f.semantic&&"top_level"===f.semantic.type&&!b.no_local_storage&&
!b.reset&&f.load_most_recent_program)try{n=function(a){a?h.retrieve_object(a,function(a){a&&(g=h.create_from_json(a),q())}):(g=h.create_from_json(f),q())},h.retrieve_string("toontalk-last-key",n)}catch(r){n="Error reading previous state. Error message is "+r,h.is_internet_explorer()?console.error("window.localStorage in IE11 not available with file://...: "+n):h.display_message(n)}else g=h.create_from_json(f),q()};h.relative_position_from_absolute_position=function(a,b){for(var c=a.parentElement,
d=b.left,e=b.top,f;c&&"html"!==c.nodeType;)f=$(c).position(),d-=f.left,e-=f.top,c=c.parentElement;return{left:d,top:e}};h.set_absolute_position=function(a,b){var c=h.relative_position_from_absolute_position(a,b);h.set_css(a,{left:c.left,top:c.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=c.left+"px",a.style.top=c.top+"px")};h.set_position_relative_to_top_level_backside=function(a,b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-backside-of-top-level"),
b,c)};h.set_position_relative_to_element=function(a,c,d,e){var f=c.offset(),g,k,l;c.get(0).appendChild(a.get(0));f||(f={left:0,top:0});g=d.left-f.left;d=d.top-f.top;e&&(e=b.UTILITIES.get_element_width(a.get(0)),f=b.UTILITIES.get_element_height(a.get(0)),k=b.UTILITIES.get_element_width(c.get(0)),l=b.UTILITIES.get_element_height(c.get(0)),g>k-e&&(g=k-e),0>g&&(g=0),d>l-f&&(d=l-f),0>d&&(d=0));g=h.scale_left(g,c.get(0));d=h.scale_top(d,c.get(0));c={left:g,top:d,position:"absolute"};a.is(".toontalk-side-animating")?
(a.get(0).style.left=g+"px",a.get(0).style.top=d+"px",h.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=""})):h.set_css(a,c);return c};h.restore_resource=function(a,c){var d,e;a&&a.is(".toontalk-top-level-resource")&&(d=c.copy({fresh_copy:!0}),e=d.get_frontside_element(!0),h.set_css(e,{width:a.width(),height:a.height()}),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),
a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),a.css({position:"absolute"}),a.get(0).parentElement.appendChild(e),b.DISPLAY_UPDATES.pending_update(d),c.set_active&&(c.set_active(!0),d.set_active(!1)))};h.closest_element=function(a,c){var d,e;if(!c)return a.get(0);d=Number.MAX_VALUE;a.each(function(a,f){var g=$(f).offset(),g=b.UTILITIES.distance(g,c);d>g&&
(e=f,d=g)});return e};h.find_resource_equal_to_widget=function(a,b){var c=Number.MAX_VALUE,d=$(b.get_frontside_element()).offset(),e;$(".toontalk-top-level-resource.toontalk-side").each(function(b,f){var g=h.widget_side_of_jquery($(f));g&&(a.equals&&a.equals(g)||a.matching_resource&&a.matching_resource(g)||a.get_type_name()===g.get_type_name()&&"matched"===a.match(g))&&(a.is_hole()||g.get_backside_widgets().length===a.get_backside_widgets().length)&&(g=h.distance($(f).offset(),d),c>g&&(e=f,c=g))});
return e};h.set_position_is_absolute=function(a,b,c){var d,e;b?(b=h.get_style_numeric_property(a,"left"),d=h.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===d&&(d=c.pageY-e.top,d-=90)),h.set_css(a,{left:h.left_as_percent(b,a),top:h.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};h.left_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===
a||isNaN(a)?$(b).offset().left:h.adjust_left_if_scaled(a,b);return 100*($(c).offset().left-window.pageXOffset+a-d.left)/d.width+"%"};h.top_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:h.adjust_top_if_scaled(a,b);return 100*($(c).offset().top+-window.pageYOffset+a-d.top)/d.height+"%"};h.adjust_left_if_scaled=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&
c.get_attribute?a-(d-c.get_attribute("width"))/2:a};h.adjust_top_if_scaled=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a-(d-c.get_attribute("height"))/2:a};h.scale_left=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a*d/c.get_attribute("width"):a};h.scale_top=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_height&&
(d=c.get_original_height())&&c.get_attribute?a*d/c.get_attribute("height"):a};h.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";case 11:return"eleventh";case 12:return"twelfth";case 13:return"thirteenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};h.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&
$(a).closest(".toontalk-box").is("*")};h.give_tooltip=function(a,b){a.title=b;h.use_custom_tooltip(a)};h.use_custom_tooltip=function(a){var c=$(a),d;c.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){var e;0>a.top&&(a.top=0,e=c.offset(),e.left<$(window).width()/2?a.left=e.left+c.width()+10:(a.left=0,d=e.left-40));"bottom"===b.vertical?(c.is(".toontalk-robot")?a.top-=30:c.is(".toontalk-number")?a.top-=30:c.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>
a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);h.set_css(this,a)}},open:function(c,e){var f=e.tooltip.get(0),g=f.textContent,k=$(a).is(".toontalk-robot"),l;g===a.toontalk_previous_text?(e.tooltip.remove(),b.speak&&window.speechSynthesis.cancel()):(f.innerHTML=N(g,decodeURIComponent),b.speak&&(window.speechSynthesis.cancel(),k||(l=function(b){if(f===D||void 0===D)a.toontalk_previous_text=g}),h.speak(f.innerText,l)),D&&$(D).remove(),
D=f,b.balloons?(100<g.length&&(l=Math.min(800,d||$(window).width()-100),$(f).position(),e.tooltip.css({maxWidth:l})),e.tooltip.css({"z-index":99999999}),e.tooltip.find(".toontalk-iframe-container").removeClass("toontalk-iframe-container"),setTimeout(function(){k||(a.toontalk_previous_text=g);e.tooltip.remove();$(f).data("ui-tooltip")&&($(f).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),h.use_custom_tooltip(a));D=void 0},g.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))):e.tooltip.remove())},
close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),h.use_custom_tooltip(a));D=void 0}})};h.speak=function(a,c,d,e,f,g){var k=new SpeechSynthesisUtterance(a),l=window.speechSynthesis.getVoices(),m=function(a){for(var b=[],c=function(a){var b,c;if(200>a.length)return a.length+1;b=a.substring(0,200);c=b.lastIndexOf(". ")||b.lastIndexOf(".\n");if(0<c)return c+2;c=b.lastIndexOf(".");if(c===b.length-1)return c+1;c=b.lastIndexOf(", ");if(0<c)return c+2;c=
b.lastIndexOf(" ");return 0<c?c+1:Math.min(a.length+1,200)},d;0<a.length;)d=c(a),1<d&&b.push(a.substring(0,d-1)),a=a.substring(d);return b},n,q,r;0===l.length?window.speechSynthesis.onvoiceschanged=function(){h.speak(a,c,d,e,f,g);window.speechSynthesis.onvoiceschanged=void 0}:200<a.length?(q=m(a),q.forEach(function(a,b){var k;b===q.length-1?k=c:0===b&&(k=function(){});h.speak(a,k,d,e,f,g)})):(r=t.push(k)-1,k.volume=void 0===d?Math.min(1,3*b.volume):d,k.pitch=void 0===e?1.2:e,k.rate=void 0===f?.75:
f,n=b.TRANSLATION_ENABLED&&google&&google.translate?google.translate.TranslateElement().f:navigator.language,l.some(function(a){if(0===a.lang.indexOf(n)){k.lang=a.lang;k.voice=a;if(0===g||void 0===g)return!0;g--}}),c&&(k.onend=function(){t.splice(r,1);c();k.onend=void 0},setTimeout(function(){k.onend&&(h.display_message("Browser did not begin speaking after waiting 20 seconds. Continuing as if speech occurred."),k.onend())},2E4)),window.speechSynthesis.speak(k))};h.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"+
a+"decodeURIComponent</span>")};h.remove_encoded_HTML=function(a){return N(a,function(){return""})};h.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};h.default_animation_speed=.5;h.animate_to_absolute_position=function(a,b,c,d,e,f){var g=$(a).offset(),k=$(a).position(),l=h.distance(b,g);0===f||0===d?(h.set_absolute_position(a,b),c&&c()):($(a).css({"z-index":h.next_z_index()}),f||(f=
Math.round(l/(d||h.default_animation_speed))),$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=f+"ms",l=k.left+(b.left-g.left),g=k.top+(b.top-g.top),a.style.left=l+"px",a.style.top=g+"px",a.toontalk_followed_by&&(b.left+=a.toontalk_followed_by.left_offset,b.top+=a.toontalk_followed_by.top_offset,h.animate_to_absolute_position(a.toontalk_followed_by.element,b,void 0,d,e)),document.hidden&&(f=0),e?setTimeout(c,f):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration=
"";c&&c()},f))};h.distance=function(a,b){var c=a.left-b.left,d=a.top-b.top;return Math.sqrt(c*c+d*d)};h.highlight_element=function(a,b,c){var d;if(a){h.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=h.widget_side_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){h.remove_highlight(a)},c))}};h.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):
$(".toontalk-highlight").removeClass("toontalk-highlight")};h.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};h.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};h.constrain_css_to_fit_inside=function(a,b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=h.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,
0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,0),d):(c=h.extract_percentage_from_string(b.top),"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};h.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(b){}};h.next_z_index=function(){a++;return a};h.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b+" toontalk-button");a.get(0).addEventListener("click",
d);h.give_tooltip(a.get(0),c);return a.get(0)};h.create_close_button=function(a,b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button toontalk-button");c.addEventListener("click",a);h.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};h.check_radio_button=function(a){var b=$(a.button).closest(".ui-buttonset");0<b.length&&b.find(".ui-state-active").removeClass("ui-state-active").prop("checked",!1);$(a.button).prop("checked",!0);
$(a.label).addClass("ui-state-active")};h.create_alert_element=function(a){a=h.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};h.create_text_element=function(a){var b=document.createElement("div");b.innerHTML=a;$(b).addClass("ui-widget");return b};h.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};h.create_anchor_element=function(a,c){var d=document.createElement("a");d.innerHTML=a;b.TRANSLATION_ENABLED&&
(c=h.add_URL_parameter(c,"translate","1"));d.href=c;d.target="_blank";return d};h.create_text_input=function(a,b,c,d,e,f,g){var k=document.createElement("input"),l;k.type="text";k.className=b;k.value=a;h.give_tooltip(k,d);f&&(k.type=f);c?(a=document.createElement("label"),a.innerHTML=c,k.id=h.generate_unique_id(),a.htmlFor=k.id,e&&(l=h.create_anchor_element("i",e),$(l).addClass("toontalk-help-button toontalk-button notranslate"),l.translate=!1),c=h.create_horizontal_table(a,k,l),$(a).addClass("ui-widget")):
c=k;$(k).button().addClass("toontalk-text-input").css({"background-color":"white"});k.addEventListener("touchstart",function(){$(k).select()});g&&F(k,g);h.use_custom_tooltip(k);return{container:c,button:k}};h.create_text_area=function(a,b,c,d,e,f,g){var k=document.createElement("textarea");k.className=b;k.value=a;h.give_tooltip(k,d);a=document.createElement("label");a.innerHTML=c;k.id=h.generate_unique_id();a.htmlFor=k.id;c=g?h.create_vertical_table(a,k):h.create_horizontal_table(a,k);$(k).button().addClass("toontalk-text-area").css({background:"white"});
k.addEventListener("touchstart",function(){$(k).select()});e&&F(k,e);$(a).addClass("ui-widget");h.use_custom_tooltip(k);return{container:c,button:k}};h.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();if(c=x(a)){if(c.is_backside())return;if(d=b(c,a))$(a.currentTarget).trigger("change"),a.currentTarget.value=d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};h.create_radio_button=function(a,b,c,d,e,f){var g=document.createElement("div"),k=document.createElement("input"),
l=document.createElement("label");k.type="radio";g.className=c+" toontalk-button";k.name=a;k.value=b;l.innerHTML=d;k.id=h.generate_unique_id();l.htmlFor=k.id;g.appendChild(k);g.appendChild(l);h.give_tooltip(g,e);f||$(k).button();h.use_custom_tooltip(k);return{container:g,button:k,label:l}};h.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),k=document.createElement("select"),l=document.createElement("label");k.className=c;k.name=a;k.id=h.generate_unique_id();l.innerHTML=
d;l.htmlFor=k.id;g.appendChild(l);g.appendChild(k);h.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&h.give_tooltip(c,f[b]);k.appendChild(c)});$(k).selectmenu({width:"50%",open:function(){$(".ui-selectmenu-open").css({"z-index":9999999});setTimeout(function(){$(".ui-selectmenu-open").find(".ui-menu-item").each(function(a,c){var d;f&&(d=b.indexOf(c.textContent),0<=d&&f[d]&&h.give_tooltip(c,f[d]))})})}});$(l).addClass("ui-widget");h.use_custom_tooltip(k);
return{container:g,menu:k,label:l}};h.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b+" toontalk-button";f.checked=a;g.innerHTML=c;f.id=h.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);h.give_tooltip(e,d);h.use_custom_tooltip(f);return{container:e,button:f,label:g}};h.create_horizontal_table=function(){var a=document.createElement("table"),
b,c,d;c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),d.appendChild(arguments[b]));return a};h.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=h.create_row(arguments[b]),a.appendChild(c));return a};h.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)arguments[c]&&
a.appendChild(arguments[c]);b.appendChild(a);return a};h.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};h.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if($(arguments[a].label).is(".ui-state-focus"))return arguments[a]};h.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+
a},c.addEventListener("error",d));return c};h.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);
b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};h.add_iframe_popup=function(a){var b=document.createElement("iframe"),c=document.createElement("div");$(c).addClass("toontalk-close-popup-frame-button").button();c.addEventListener("click",function(a){$(b).remove();$(c).remove();a.stopPropagation()});c.innerHTML="Return to ToonTalk";$(b).addClass("toontalk-popup-frame");b.src=a;document.body.appendChild(c);document.body.appendChild(b)};h.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');
a&&b.addClass(a);return b.get(0)};h.become_file_data_table=function(a,c,d,e){$(a).DataTable({data:c,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,c,f,g){a=d?a.substring(0,a.length-5):a;c=d?b.google_drive.google_drive_url(f.id):"Click to load this program.";if(e)return"<div class='"+e+"' title='"+c+"'id='"+f.id+"'>"+a+"</div>";b.TRANSLATION_ENABLED&&(c=h.add_URL_parameter(c,"translate","1"));return"<a href='"+c+"'target='_blank' title='Click to open published page.'>"+
a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};h.get_local_files_data=function(a){h.get_all_locally_stored_program_names(function(b){var c=[],d=function(e){var f=b[e];h.get_local_storage_meta_data(f,function(g){g&&c.push({title:f,modifiedDate:g.last_modified,createdDate:g.created,
fileSize:g.file_size});e<b.length?d(e+1):a(c)})};d(0)})};h.create_local_files_table=function(a){h.get_local_files_data(function(b){var c=h.create_file_data_table();h.when_attached(c,function(){h.become_file_data_table(c,b,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});a(c)})};h.get_$dragee=function(){return e};h.add_URL_parameter=function(a,b,c){a=h.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?"&":"?";return a+d+b+"="+c};h.remove_URL_parameter=function(a,
b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};h.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?
b?"A "+a:"a "+a:b?"An "+a:"an "+a};h.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};h.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};h.each_top_level_widget=function(a){$(".toontalk-backside-of-top-level").each(function(b,c){a(h.widget_side_of_element(c).get_widget())})};h.backup_all_top_level_widgets=function(a){h.each_top_level_widget(function(b){b.save(a)})};
h.make_resizable=function(a,b){var c,d;a.resizable({start:function(a,b){c=b.originalSize.width;d=b.originalSize.height},resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},handles:"n,e,s,w"})};h.match=function(a,
b){var c;if(void 0===a)return"matched";b=b.dereference();c=a.match(b);return c.is_widget&&b.matched_by?b.matched_by(a):c};h.current_URL=function(){return window.location.pathname};h.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};h.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&h.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};h.copy_frontside_dimensions=function(a,b){var c=
a.get_widget().get_frontside_element(),d;c&&(d=b.get_frontside_element(!0))&&h.set_css(d,{width:$(c).width(),height:$(c).height()})};h.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?h.scale_element(a,c,d,c,d):h.scale_element(a,$(b).width(),$(b).height(),c,d)};h.scale_element=function(a,c,d,e,f,g,k,l,m){var n,q;$(a).is(".toontalk-not-observable")&&(n=b.UTILITIES.widget_side_of_element(a))&&n.update_display();e||(q=$(a).children("img"),e=q.is("*")?q.width():$(a).width());f||(q||
(q=$(a).children("img")),f=q.is("*")?q.height():$(a).height());n=c&&0!==e?c/e:a.toontalk_x_scale||1;q=d&&0!==f?d/f:a.toontalk_y_scale||1;0===n&&(n=1);0===q&&(q=1);a.toontalk_x_scale=n;a.toontalk_y_scale=q;l=(l=l&&l!==document.body?l:a.parentElement)&&0>l.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var r="";k||(k={});"number"===typeof k.left&&(k.left-=(e-c)/2,m=!0);"number"===typeof k.top&&(k.top-=(f-d)/2,m=!0);!m&&l?(c&&(a.toontalk_translate_x=(c-e)/2,r+="translateX("+
a.toontalk_translate_x+"px) "),d&&(a.toontalk_translate_y=(d-f)/2,r+="translateY("+a.toontalk_translate_y+"px) ")):(a.toontalk_translate_x=void 0,a.toontalk_translate_y=void 0);h.add_transform_to_css((g||"")+" scale("+n+", "+q+")",r,k,l);k.width=e;k.height=f;h.set_css(a,k);return{x_scale:n,y_scale:q}};h.translate_x=function(a){return k("toontalk_translate_x","toontalk_x_scale")};h.translate_y=function(a){return k("toontalk_translate_y","toontalk_y_scale")};h.add_transform_to_css=function(a,b,c,d){a&&
(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),h.set_css_transform(c,b+a))};h.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};h.run_when_dimensions_known=function(a,b,c){var d=a.parentElement,e=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")},f;!c&&$(a).width()&&e(d)?setTimeout(function(){b(d)}):(f=function(c){setTimeout(function(){var g=$(a).width(),k=$(a).height();
g&&k?e(a.parentElement)?(b(d),d?d.appendChild(a):a.parentElement===document.body&&$(a).remove(),$(a).removeClass("toontalk-not-observable")):h.run_when_dimensions_known(a,b,!0):setTimeout(function(){h.widget_side_of_element(a);1E4>c&&f(2*c)},c)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),c&&h.set_css(a,{width:"",height:"",transform:""}),f(1))};h.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&h.run_when_dimensions_known(d,
function(){var a=$(d).children("img");a.is("*")?b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};h.relative_position=function(a,b){var c,d;if(!h.is_attached(a))return{left:0,top:0};c=$(a).offset();b&&(d=$(b).offset(),c.left-=d.left,c.top-=d.top);return c};h.add_animation_class=function(a,b){h.set_css(a,{width:"",height:""});$(a).addClass(b)};h.widget_side_of_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget_side};h.widget_side_of_element=function(a){return a.toontalk_widget_side};
h.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};h.display_message_if_new=function(a){0>J.indexOf(a)&&(h.display_message(a),J.push(a))};h.display_message=function(a,c,d){var e=h.create_alert_element(a),f=function(){$(e).remove()},g;$(".toontalk-alert-element").remove();console.log(a);console.trace();if(c||d)g=$(c).closest(".toontalk-backside"),0===g.length&&
(g=$(d).closest(".toontalk-backside")),0<g.length&&($(e).addClass("toontalk-local-alert"),g.append(e));c&&0!==g.length||document.body.insertBefore(e,document.body.firstChild);b.speak&&(window.speechSynthesis.cancel(),h.speak(a));e.addEventListener("click",f);setTimeout(f,Math.max(2E3,a.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)))};h.display_tooltip=function(a){h.use_custom_tooltip(a.get(0));a.tooltip("open")};h.report_internal_error=function(a){console.error(a);console.trace();b.debugging&&
h.display_message("Error: "+a)};h.get_current_url_boolean_parameter=function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};h.get_current_url_numeric_parameter=function(a,b){var c=h.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};h.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>
d&&(d=window.location.href.length);return window.location.href.substring(c,d)};h.get_path_to_toontalk_folder=function(){return b.TOONTALK_URL};h.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};c=h.is_browser_of_type("MSIE")||h.is_browser_of_type("Trident");h.is_internet_explorer=function(){return c};h.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};h.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};h.remove_z_index=
function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$(a);a.attr("z-index","");return a.html()};h.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b=!1,c=function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),d.innerHTML="Run all tests",h.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),d.innerHTML=
"Stop all tests");b=!b},d;0!==a.length&&(a.button(),d=a.get(0),d.innerHTML="Run all tests",a.get(0).addEventListener("click",c))};h.set_timeout=function(a,b){b||h.is_internet_explorer()?setTimeout(a,b):(O.push(a),window.postMessage("zero-timeout-message","*"))};h.get_first_property=function(a){return Object.keys(a)[0]};h.get_all_locally_stored_program_names=function(a){h.retrieve_object("toontalk-all-program-names",function(b){if(b)a(b);else return a([])})};h.set_all_locally_stored_program_names=
function(a){h.store_object("toontalk-all-program-names",a,function(){})};h.get_local_storage_meta_data=function(a,b){var c=h.local_storage_program_meta_data_key(a);try{h.retrieve_object(c,b)}catch(d){b()}};h.local_storage_program_key=function(a){return"toontalk-json: "+a};h.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};b.CHROME_APP?(h.store_object=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);e[a]=JSON.stringify(c,
h.clean_json);chrome.storage.local.set(e,d);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by set "+a)},h.store_string=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a);e[a]=c;chrome.storage.local.set(e,d);b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a)},h.retrieve_object=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&
0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+a);c(d[a]&&JSON.parse(d[a]))})},h.retrieve_string=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved string "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+
a);c(d&&d[a])})}):(h.store_object=function(a,c,d){b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);window.localStorage.setItem(a,JSON.stringify(c,h.clean_json));d&&d()},h.store_string=function(a,b,c){window.localStorage.setItem(a,b);c&&c();chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by setItem "+a)},h.retrieve_object=function(a,c){var d=window.localStorage.getItem(a);b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+
(d&&d.substring(0,100))+"... with key "+a);c(d&&JSON.parse(d))},h.retrieve_string=function(a,c){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved string "+(window.localStorage.getItem(a)&&window.localStorage.getItem(a).substring(0,100))+"... with key "+a);c(window.localStorage.getItem(a))});h.enable_editor=function(a,b,c,d){(function(a,b){var c=function(a){a.data.editor_enabled_for&&a.data.editor_enabled_for===b&&(e=!0,window.removeEventListener("message",c))},d=function(a,b){e||
setTimeout(function(){a();d(a,b)},500)},e=!1;window.addEventListener("message",c);d(a,b)})(function(){a.postMessage({save_edits_to:window.location.href,file_id:c,widgets_json:d},"*")},c)};h.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};h.enable_touch_events=function(a,c){var d=a,e=function(e){var q;e.preventDefault();m&&(e.stopPropagation(),q=e.changedTouches[0],n&&(n.being_dragged=!1),$(a).removeClass("toontalk-being-dragged"),m+c>=Date.now()?(e=document.createEvent("MouseEvent"),
e.initMouseEvent("click",!0,!0,window,1,q.screenX,q.screenY,q.clientX,q.clientY,!1,!1,!1,!1,0,null),q.target.dispatchEvent(e),n&&n.location_constrained_by_container()?$(a).css({left:"",top:""}):h.set_absolute_position(a,{left:l.left,top:l.top}),b.logging&&0===b.logging.indexOf("touch")&&r("touch end treated as click "+a.id,!0)):(f(e,a),b.logging&&0===b.logging.indexOf("touch")&&r("drag ended "+a.id),A(e,a),b.logging&&0===b.logging.indexOf("touch")&&r("drop happened "+a.id),b.logging&&0===b.logging.indexOf("touch")&&
r("",!0),h.set_absolute_position(a,{left:q.pageX-g-b.USABILITY_DRAG_OFFSET.x,top:q.pageY-k-b.USABILITY_DRAG_OFFSET.y})),m=void 0,a=d)},g=0,k=0,l,m,n,q;a.addEventListener("touchstart",function(c){var d=c.changedTouches[0],e,f,q;l=$(a).offset();0===b.USABILITY_DRAG_OFFSET.y&&(b.USABILITY_DRAG_OFFSET.y=25);b.logging&&0===b.logging.indexOf("touch")&&r("touch start "+a.id);c.preventDefault();if("TEXTAREA"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||$(c.srcElement).is(".ui-resizable-handle"))b.logging&&
0===b.logging.indexOf("touch")&&r("touch start ignored due to tag name or class "+a.id);else if((e=h.find_widget_side_on_page(c.changedTouches[0],void 0,0,0))&&e.is_of_type("empty hole")&&(e=e.get_parent_of_frontside()),e&&e.get_frontside_element()!==a)b.logging&&0===b.logging.indexOf("touch")&&r("touch start ignored since has child who is really touched: "+h.widget_side_of_element(a));else{m=Date.now();b.logging&&0===b.logging.indexOf("touch")&&r("touch start of "+a.id+" at "+m);c.stopPropagation();
if(n=h.widget_side_of_element(a))n.being_dragged=!0;n&&n.get_infinite_stack()?(f=n.copy(),n.set_infinite_stack(!1),f.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(f=n.copy(),n.add_copy_to_container(f,0,0),q=$(a).offset(),a=f.get_frontside_element(!0));f&&(n.add_copy_to_container(f,0,0),n.robot_in_training()&&n.robot_in_training().copied(n,f,!1));$(a).css({"z-index":99999999});q||(q=$(a).offset());u(c,a);g=d.pageX-q.left;k=d.pageY-q.top;b.logging&&0===b.logging.indexOf("touch")&&
r("drag started "+a.id)}},!0);a.addEventListener("touchmove",function(c){var d=c.changedTouches[0];if(m){c.preventDefault();h.set_absolute_position(a,{left:d.pageX-g-b.USABILITY_DRAG_OFFSET.x,top:d.pageY-k-b.USABILITY_DRAG_OFFSET.y});c=h.find_widget_side_on_page(d,a,b.USABILITY_DRAG_OFFSET.x,b.USABILITY_DRAG_OFFSET.y);if(q&&q!==c){var e=q.get_frontside_element();h.remove_highlight(e);q=void 0}c&&(L(d,c.get_element()),q=c);b.logging&&0===b.logging.indexOf("touch")&&r("dragged to "+(d.pageX-g)+", "+
(d.pageY-k)+" "+a.id)}},!0);a.addEventListener("touchend",e,!0);a.addEventListener("touchcancel",e,!0)};h.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};h.find_widget_side_on_page=function(a,b,c,d){var e=h.get_mouse_or_first_touch_event_attribute("pageX",a);a=h.get_mouse_or_first_touch_event_attribute("pageY",a);var f;b&&$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for(b&&$(b).show();c&&!c.toontalk_widget_side&&
!$(c).is(".toontalk-backside")&&!$(c).is(".toontalk-button")&&!$(c).is(".ui-button");)c=c.parentNode;c&&(f=c.toontalk_widget_side);if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),f};h.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-backside-of-top-level").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return h.widget_side_of_element(c)};h.set_css=function(a,b){var c,d;if(b){if(c=
h.widget_side_of_element(a))d=c.dereference(),$(a).is(".toontalk-temporarily-set-down")||(c.location_constrained_by_container()?(b.left="",b.top=""):d.is_plain_text_element()&&(b.width="",b.height=""));0===b.width&&(b.width="");0===b.height&&(b.height="");!b.transform&&"number"===typeof b.width&&"number"===typeof b.height&&d&&d.use_scaling_transform?d.use_scaling_transform(b):$(a).css(b)}};h.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};h.conjunction=function(a,
b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?h.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};h.insert_function_bird_documentation=function(a,b){var c=TOONTALK[a]["function"],d=Object.keys(c),e="<table class='toontalk-function-bird-documentation-table'>";d.forEach(function(a,b){e+="<tr><td><div id='bird_id_"+b+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+
c[a].title+"</td></tr>"});e+="</table>";$(b).html(e);d.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e&&(e.id=encodeURIComponent(b))})};h.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=h.widget_side_of_element(b);c&&c.update_display(!0)})};h.visible_element=function(a){return a&&null!==a.offsetParent};h.get_audio_volume=
function(a){var c=document.hidden?0:b.volume;0===c&&m.push({audio_object:a,volume:a.volume});return c};h.play_audio=function(a){a.play();l.push(a);a.addEventListener("ended",function(){var b=l.indexOf(a);0<=b&&l.splice(b,1)})};h.mute_audio_objects_playing=function(){l.forEach(function(a){m.push({audio_object:a,volume:a.volume});a.volume=0});l=[]};h.stop_audio_objects=function(){l.forEach(function(a){a.pause();a.currentTime=0})};h.restore_audio_volumes=function(){m.forEach(function(a){a.audio_object.volume=
a.volume;l.push(a.audio_object)});m=[]};h.is_attached=function(a){return jQuery.contains(window.document,a)};h.when_attached=function(a,b,c){var d=a.toontalk_attached_callback;jQuery.contains(window.document,a)&&!c?b():(a.toontalk_attached_callback=function(){d&&d();b();$(a).removeClass("toontalk-has-attached-callback");a.toontalk_attached_callback=void 0},c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};h.create_event=function(a,b){var c;try{c=new CustomEvent(a,
{detail:b})}catch(d){c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!1,!1,b)}return c};h.create_queue=function(){var a=[],c=0;return{getLength:function(){return a.length-c},isEmpty:function(){return 0==a.length},enqueue:function(c){var d=0==a.length;a.push(c);b.logging&&0<=b.logging.indexOf("queue")&&console.log(c._debug_string+" enqueued");return d},dequeue:function(){var d;if(0!=a.length)return d=a[c],b.logging&&0<=b.logging.indexOf("queue")&&console.log(d._debug_string+" dequeued"),
2*++c>=a.length&&(a=a.slice(c),c=0),d},peek:function(){return 0<a.length?a[c]:void 0},does_any_item_satisfy:function(b){var d;for(d=c;d<a.length;d++)if(b(a[d]))return!0;return!1}}};h.number_to_words=function(a){var b=a.indexOf("/"),c=function(a){var b="  half third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth seventeenth eighteenth nineteenth twentieth".split(" ");if(20>=a)return b[a];if(0===a%10&&100>a)return"thirtieth fortieth fiftieth sixtieth seventieth eightieth ninetieth".split(" ")[a/
10-3];if(100===a)return"hundredth";if(1E3===a)return"thousandth";if(1E4===a)return"ten thousandth";if(1E5===a)return"hundred thousandth";if(1E6===a)return"millionth";if(1E7===a)return"ten millionth";if(1E8===a)return"hundred millionth";if(1E9===a)return"billionth"},d,e;if(0>b)return h.integer_to_words(a);d=a.substring(0,b);e="1"!==d&&"-1"!==d;return b+3>=a.length||!e&&b+11>=a.length?(c=c(parseInt(a.substring(b+1))))?h.integer_to_words(d)+" "+c+(e?"s":""):h.integer_to_words(d)+" over "+h.integer_to_words(a.substring(b+
1)):h.integer_to_words(a.substring(0,b))+" over "+h.integer_to_words(a.substring(b+1))};h.integer_to_words=function(a){var b="",c=" un duo tre quattuor quin se septe octo nove".split(" "),d="   *   sx mn  mx".split(" "),e=" deci viginti triginta quadraginta quinquaginta sexaginta septuaginta octoginta nonaginta".split(" "),f=" n ms ns ns ns n n mx m".split(" "),g=" centi ducenti trecenti quadringenti quingenti sescenti septingenti octingenti nongenti".split(" "),h=" nx n ns ns ns n n mx m".split(" "),
k=" milli dumilli tremilli quadrinmilli quinmilli sesmilli septinmilli octinmilli nonmilli".split(" "),l=" decimilli vigintimilli trigintamilli quadragintanmilli quinquagintamilli sexagintamilli septuagintamilli octogintamilli nonagintamilli".split(" "),m=" centimilli ducentimilli trecentimilli quadringentimilli quingentimilli sescentimilli septingentimilli octingentimilli nongentimilli".split(" "),n=" milli-milli milli-dumilli milli-tremilli milli-quadrinmilli milli-quinmilli milli-sesmilli milli-septinmilli milli-octinmilli milli-nonmilli".split(" "),
q="thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion".split(" "),r,t,u,w,x,z,A,B,D,F,G,H,I=function(c){var d=0,e="",f;for(f=0;f<c;f++)if("0"!==a[f]||0<d)e+=a[f],d++;if(e){c=b;e=parseInt(e);f=" one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen twenty".split(" ");var g=" ten twenty thirty forty fifty sixty seventy eighty ninety".split(" "),h="";100<=e&&(h+=f[Math.floor(e/100)]+
" hundred",e%=100,0<e&&10>e&&(h+=" and"));20<e?(""!=h&&(h+=" "),h+=g[Math.floor(e/10)],e%=10,0<e&&(h+="-")):""!=h&&0<e&&(h+=" ");0<e&&(h+=f[e]);b=c+h.toString()}return d},J=function(a,b){var c,d;if(void 0!==a&&void 0!==b)for(c=0;c<a.length;c++)for(d=0;d<b.length;d++)if(a[c]==b[d]||"*"===a[c]&&("s"===b[d]||"x"===b[d]))return b[d]};"-"===a[0]&&(b+="negative ",a=a.substring(1));for(;0<a.length&&"0"===a[0];)a=a.substring(1);if(0===a.length)return"zero";for(r=a.length;;){" "!==b[b.length-1]&&(b+=" ");
if(4>r){0===I(r)&&","===b.substring(b.length-1)&&(b=b.substring(0,b.length-1));break}t=r-4;u=1+t%3;w=I(u);a=a.substring(u);r-=u;0<w&&(" "!==b[b.length-1]&&(b+=" "),x=Math.floor(t/3),u=x%10,10>x?b+=q[x]:(w=Math.floor(x/10%10),t=Math.floor(x/100%10),A=Math.floor(x/1E3%10),B=Math.floor(x/1E4%10),D=Math.floor(x/1E5%10),F=Math.floor(x/1E6%10),G=c[u],x=e[w],H=g[t],A=k[A],B=l[B],D=m[D],F=n[F],z=void 0,G&&(b+=G,z=d[u]),x&&((u=J(z,f[w]))&&(b+=u),z=void 0,b+=x),H&&((u=J(z,h[t]))&&(b+=u),z=void 0,b+=H),b+=A,
b+=B,b+=D,b+=F,"a"===b[b.length-1]&&(b=b.substring(0,b.length-2)+"i"),b+="llion"),b+=",")}b=b.trim();c=b.lastIndexOf(", ");if(0<=c)return b.substring(0,c)+" and"+b.substring(c+1);","===b[b.length-1]&&(b=b.substring(0,b.length-1));return b};h.test_number_to_words=function(a){var b,c;for(b=0;b<a;b++)c=Math.round(1E9*Math.random()),console.log(c+" = "+h.number_to_words(c.toString()))};h.for_each_batch=function(a,b,c,d){var e;if(0!==a.length){void 0===d&&(d=0);c||(c=100);for(e=Math.min(a.length,d+c);d<
e;d++)b(a[d],d);e<a.length&&h.set_timeout(function(){h.for_each_batch(a,b,c,e)})}};h.random_location_inside=function(a,b){var c=a.getBoundingClientRect();return{left:Math.random()*(c.width-b),top:Math.random()*(c.height-b)}};h.element_width=function(a){var b=$(a);if(b.is(".toontalk-conditions-contents"))return 240;if(!b.is(".toontalk-not-observable"))return a.getBoundingClientRect().width};h.element_height=function(a){var b=$(a);if(b.is(".toontalk-conditions-contents"))return 60;if(!b.is(".toontalk-not-observable"))return a.getBoundingClientRect().height};
h.resizable_and_scalable=function(a,b){var c=1,d=1,e;$(a).resizable({start:function(a,b){e={width:b.size.width,height:b.size.height}},resize:function(f,g){var h={width:g.size.width,height:g.size.height};$(a).is(".toontalk-backside-of-top-level")||(c*=h.width/e.width,d*=h.height/e.height,b(c,d),e=h)},handles:"n,e,s,w,se,ne,sw,nw"})};h.initialize=function(a){a=new MutationObserver(function(a){a.forEach(function(a){(a=$(a.target).closest(".toontalk-translation-element").get(0))&&a.toontalk_callback&&
(a.toontalk_callback(a.innerText),a.innerText="",a.toontalk_callback=void 0)})});var c=function(){var a=function(a,b,c,d,e){a=document.getElementById(a);var f=function(a){h.add_iframe_popup(b)};a&&(c=h.create_button(c,"toontalk-manual-button",d,f),e&&$(c).css(e),a.appendChild(c))};a("toontalk-manual-button","docs/manual/index.html?reset=1","Learn about ToonTalk","Click to visit the page that introduces everything.",{background:"yellow"});a("toontalk-manual-tour","docs/tours/tour1.html?reset=1","Watch a tour of ToonTalk",
"Click to visit a page that replays a tour.",{background:"pink"});a("toontalk-manual-whats-new","docs/manual/whats-new.html?reset=1","What's new?","Click to visit see what has changed recently.",{background:"cyan"})},e=function(a){try{window.speechSynthesis.cancel()}catch(c){}try{h.backup_all_top_level_widgets(!0)}catch(c){b.UTILITIES.report_internal_error(c)}},f,g;d||(f=function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget_side;c&&c.set_running&&c.set_running(!1)})},
b.debugging=h.get_current_url_parameter("debugging"),b.logging=h.get_current_url_parameter("log"),b.volume=h.get_current_url_numeric_parameter("volume",10)/100,0<b.volume&&P(),b.open_backside_only_if_alt_key=h.get_current_url_boolean_parameter("alt_key_to_open_backside"),b.reset=h.get_current_url_boolean_parameter("reset",!1),b.speak=h.get_current_url_boolean_parameter("speak",!1),b.speak&&!window.speechSynthesis&&(b.speak=!1,h.display_message("This browser doesn't support speech output. speak=1 ignored.")),
b.balloons=h.get_current_url_boolean_parameter("balloons",!0),b.open_backside_only_if_alt_key||(b.open_backside_only_if_alt_key=h.get_current_url_boolean_parameter("puzzle"),b.open_backside_only_if_alt_key&&(b.reset=!0)),h.process_json_elements(),window.document.addEventListener("click",f),b.DEFAULT_QUEUE=window.TOONTALK.queue.create(),b.DEFAULT_QUEUE.start(),b.CHROME_APP?chrome.runtime.onSuspend.addListener(e):window.addEventListener("beforeunload",e),b.TRANSLATION_ENABLED=h.get_current_url_boolean_parameter("translate",
!1),b.TRANSLATION_ENABLED?($("a").each(function(a,b){b.href=h.add_URL_parameter(b.href,"translate","1")}),$("#google_translate_element").is("*")||(e=document.createElement("div"),e.id="google_translate_element",document.body.insertBefore(e,document.body.firstChild)),document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]),G("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"),
g=document.createElement("div"),g.className="toontalk-translation-element",document.body.appendChild(g),a.observe(g,{characterData:!0,subtree:!0}),h.translate=function(a,b){g.innerHTML=a;g.toontalk_callback=b}):$("#google_translate_element").remove(),b.vacuum.the_vacuum||b.vacuum.create(),h.add_test_all_button(),c(),I("toontalk-robot",b.robot),I("toontalk-empty-nest",b.nest),I("toontalk-bird-static",b.bird),$("[title]").each(function(a,b){h.use_custom_tooltip(b)}),TOONTALK.RUNNING_LOCALLY||(function(a,
b,c,d,e,f,g){a.GoogleAnalyticsObject=e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)};a[e].l=1*new Date;f=b.createElement(c);g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,g)}(window,document,"script",b.CHROME_APP?TOONTALK.TOONTALK_URL+"libraries/analytics.js":"https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-57964541-1","auto"),b.CHROME_APP?(ga("set","checkProtocolTask",function(){}),ga("require","displayfeatures"),ga("send","pageview",
"/options.html")):ga("send","pageview")),document.addEventListener("visibilitychange",function(){document.hidden?h.mute_audio_objects_playing():(h.rerender_all(),h.restore_audio_volumes())}),setTimeout(function(){b.DISPLAY_UPDATES.update_display()},100),d=!0,document.dispatchEvent(b.UTILITIES.create_event("toontalk_initialized",{})))};h.do_after_initialization=function(a){d?a():document.addEventListener("toontalk_initialized",a)};return h}(window.TOONTALK);window.initialize_toontalk=window.TOONTALK.UTILITIES.initialize;
