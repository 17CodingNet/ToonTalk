(function(a){var h;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(h={},define(function(){return h})):h="undefined"!==typeof window?window:a:h=exports;(function(a){var d={greatest_common_divisor:function(a,m){if(1===m||1===a)return 1;for(var b;0!==m;){b=m;m=a%m;if(!isFinite(m))return 0;a=b}return a}};d.gcd=d.greatest_common_divisor;d.fromRandom=function(a){return Math.random()*(1<<a)>>>0};d.fromMillitime=function(){return+new Date};d.fromUnixtime=
function(){return.001*d.fromMillitime()|0};"undefined"!==typeof a&&(a.integer=d);(function(a){function m(a,r,d){if(d!==b)return a instanceof m?a:"undefined"===typeof a?e:m.parse(a);for(a=a||[];a.length&&!a[a.length-1];)--a.length;this._d=a;this._s=a.length?r||1:0}var b={};m._construct=function(a,r){return new m(a,r,b)};m.base=1E7;m.base_log10=7;var e=new m([],0,b);m.ZERO=e;var d=new m([1],1,b);m.ONE=d;var c=new m(d._d,-1,b);m.M_ONE=c;m._0=e;m._1=d;m.small=[e,d,new m([2],1,b),new m([3],1,b),new m([4],
1,b),new m([5],1,b),new m([6],1,b),new m([7],1,b),new m([8],1,b),new m([9],1,b),new m([10],1,b),new m([11],1,b),new m([12],1,b),new m([13],1,b),new m([14],1,b),new m([15],1,b),new m([16],1,b),new m([17],1,b),new m([18],1,b),new m([19],1,b),new m([20],1,b),new m([21],1,b),new m([22],1,b),new m([23],1,b),new m([24],1,b),new m([25],1,b),new m([26],1,b),new m([27],1,b),new m([28],1,b),new m([29],1,b),new m([30],1,b),new m([31],1,b),new m([32],1,b),new m([33],1,b),new m([34],1,b),new m([35],1,b),new m([36],
1,b)];m.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");m.prototype.toString=function(a){a=+a||10;if(2>a||36<a)throw Error("illegal radix "+a+".");if(0===this._s)return"0";if(10===a){a=0>this._s?"-":"";a+=this._d[this._d.length-1].toString();for(var r=this._d.length-2;0<=r;r--){for(var b=this._d[r].toString();7>b.length;)b="0"+b;a+=b}return a}r=m.digits;a=m.small[a];for(var b=this._s,e=this.abs(),d=[],c;0!==e._s;)c=e.divRem(a),e=c[0],c=c[1],d.push(r[c.valueOf()]);return(0>b?"-":"")+d.reverse().join("")};
m.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];m.parse=function(a,r){function d(a){a=a.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return a.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(a,m,r,b,e){e=+e;var c=0>e,d=r.length+e;a=(c?r:b).length;e=(e=Math.abs(e))>=a?e-a+c:0;a=Array(e+1).join("0");r+=b;return(m||"")+(c?r=a+r:r+=a).substr(0,d+=c?a.length:0)+(d<r.length?"."+r.substr(d):"")})}a=a.toString();if("undefined"===typeof r||10===+r)a=d(a);var c=(new RegExp("^([+\\-]?)("+("undefined"===
typeof r?"0[xcb]":16==r?"0x":8==r?"0c":2==r?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(a);if(c){var g=c[1]||"+",f=c[2]||"",c=c[3]||"";if("undefined"===typeof r)r="0x"===f||"0X"===f?16:"0c"===f||"0C"===f?8:"0b"===f||"0B"===f?2:10;else if(2>r||36<r)throw Error("Illegal radix "+r+".");r=+r;if(!m.radixRegex[r].test(c))throw Error("Bad digit for radix "+r);c=c.replace(/^0+/,"").split("");if(0===c.length)return e;g="-"===g?-1:1;if(10==r){for(f=[];7<=c.length;)f.push(parseInt(c.splice(c.length-m.base_log10,
m.base_log10).join(""),10));f.push(parseInt(c.join(""),10));return new m(f,g,b)}f=e;r=m.small[r];for(var k=m.small,l=0;l<c.length;l++)f=f.multiply(r).add(k[parseInt(c[l],36)]);return new m(f._d,g,b)}throw Error("Invalid BigInteger format: "+a);};m.prototype.add=function(a){if(0===this._s)return m(a);a=m(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.subtract(a);var r=this._d;a=a._d;for(var e=r.length,c=a.length,d=Array(Math.max(e,c)+1),g=Math.min(e,c),f=0,k=0;k<g;k++)f=r[k]+
a[k]+f,d[k]=f%1E7,f=f/1E7|0;c>e&&(r=a,e=c);for(k=g;f&&k<e;k++)f=r[k]+f,d[k]=f%1E7,f=f/1E7|0;for(f&&(d[k]=f);k<e;k++)d[k]=r[k];return new m(d,this._s,b)};m.prototype.negate=function(){return new m(this._d,-this._s|0,b)};m.prototype.abs=function(){return 0>this._s?this.negate():this};m.prototype.subtract=function(a){if(0===this._s)return m(a).negate();a=m(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.add(a);var r=this;0>this._s&&(r=new m(a._d,1,b),a=new m(this._d,1,b));var c=
r.compareAbs(a);if(0===c)return e;if(0>c){var d=a;a=r;r=d}r=r._d;a=a._d;var d=r.length,g=a.length,f=Array(d),k=0,l,n;for(l=0;l<g;l++)n=r[l]-k-a[l],0>n?(n+=1E7,k=1):k=0,f[l]=n;for(l=g;l<d;l++){n=r[l]-k;if(0>n)n+=1E7;else{f[l++]=n;break}f[l]=n}for(;l<d;l++)f[l]=r[l];return new m(f,c,b)};(function(){function a(r,e){for(var d=r._d,c=d.slice(),g=0;;){var f=(d[g]||0)+1;c[g]=f%1E7;if(9999999>=f)break;++g}return new m(c,e,b)}function r(a,e){for(var d=a._d,c=d.slice(),g=0;;){var f=(d[g]||0)-1;if(0>f)c[g]=
f+1E7;else{c[g]=f;break}++g}return new m(c,e,b)}m.prototype.next=function(){switch(this._s){case 0:return d;case -1:return r(this,-1);default:return a(this,1)}};m.prototype.prev=function(){switch(this._s){case 0:return c;case -1:return a(this,-1);default:return r(this,1)}}})();m.prototype.compareAbs=function(a){if(this===a)return 0;if(!(a instanceof m)){if(!isFinite(a))return isNaN(a)?a:-1;a=m(a)}if(0===this._s)return 0!==a._s?-1:0;if(0===a._s)return 1;var r=this._d.length,b=a._d.length;if(r<b)return-1;
if(r>b)return 1;b=this._d;a=a._d;for(--r;0<=r;r--)if(b[r]!==a[r])return b[r]<a[r]?-1:1;return 0};m.prototype.compare=function(a){if(this===a)return 0;a=m(a);return 0===this._s?-a._s:this._s===a._s?this.compareAbs(a)*this._s:this._s};m.prototype.isUnit=function(){return this===d||this===c||1===this._d.length&&1===this._d[0]};m.prototype.multiply=function(a){if(0===this._s)return e;a=m(a);if(0===a._s)return e;if(this.isUnit())return 0>this._s?a.negate():a;if(a.isUnit())return 0>a._s?this.negate():this;
if(this===a)return this.square();var r=this._d.length>=a._d.length,c=(r?this:a)._d,r=(r?a:this)._d,d=c.length,g=r.length,f=d+g,k=Array(f),l;for(l=0;l<f;l++)k[l]=0;for(l=0;l<g;l++){for(var f=0,n=r[l],p=d+l,w,x=l;x<p;x++)w=k[x]+n*c[x-l]+f,f=w/1E7|0,k[x]=w%1E7|0;f&&(w=k[x]+f,k[x]=w%1E7)}return new m(k,this._s*a._s,b)};m.prototype.multiplySingleDigit=function(a){if(0===a||0===this._s)return e;if(1===a)return this;var r;if(1===this._d.length)return r=this._d[0]*a,1E7<=r?new m([r%1E7|0,r/1E7|0],1,b):new m([r],
1,b);if(2===a)return this.add(this);if(this.isUnit())return new m([a],1,b);var c=this._d,d=c.length;r=d+1;for(var f=Array(r),g=0;g<r;g++)f[g]=0;for(var k=g=0;k<d;k++)r=a*c[k]+g,g=r/1E7|0,f[k]=r%1E7|0;g&&(f[k]=g);return new m(f,1,b)};m.prototype.square=function(){if(0===this._s)return e;if(this.isUnit())return d;var a=this._d,r=a.length,c=Array(r+r+1),g,f,k,l;for(l=0;l<r;l++)k=2*l,g=a[l]*a[l],f=g/1E7|0,c[k]=g%1E7,c[k+1]=f;for(l=0;l<r;l++){f=0;k=2*l+1;for(var n=l+1;n<r;n++,k++)g=a[n]*a[l]*2+c[k]+f,
f=g/1E7|0,c[k]=g%1E7;k=r+l;g=f+c[k];f=g/1E7|0;c[k]=g%1E7;c[k+1]+=f}return new m(c,1,b)};m.prototype.quotient=function(a){return this.divRem(a)[0]};m.prototype.divide=m.prototype.quotient;m.prototype.remainder=function(a){return this.divRem(a)[1]};m.prototype.divRem=function(a){a=m(a);if(0===a._s)throw Error("Divide by zero");if(0===this._s)return[e,e];if(1===a._d.length)return this.divRemSmall(a._s*a._d[0]);switch(this.compareAbs(a)){case 0:return[this._s===a._s?d:c,e];case -1:return[e,this]}var r=
this._s*a._s,g=a.abs(),f=this._d,k=f.length,l=[],n,h=new m([],0,b);for(h._s=1;k;)if(h._d.unshift(f[--k]),0>h.compareAbs(a))l.push(0);else{if(0===h._s)n=0;else{var t=h._d.length;n=g._d.length;t=1E7*h._d[t-1]+h._d[t-2];n=1E7*g._d[n-1]+g._d[n-2];h._d.length>g._d.length&&(t=1E7*(t+1));n=Math.ceil(t/n)}do{t=g.multiplySingleDigit(n);if(0>=t.compareAbs(h))break;n--}while(n);l.push(n);n&&(n=h.subtract(t),h._d=n._d.slice(),0===h._d.length&&(h._s=0))}return[new m(l.reverse(),r,b),new m(h._d,this._s,b)]};m.prototype.divRemSmall=
function(a){a=+a;if(0===a)throw Error("Divide by zero");var r=this._s*(0>a?-1:1);a=Math.abs(a);if(1>a||1E7<=a)throw Error("Argument out of range");if(0===this._s)return[e,e];if(1===a||-1===a)return[1===r?this.abs():new m(this._d,r,b),e];if(1===this._d.length){var c=new m([this._d[0]/a|0],1,b);a=new m([this._d[0]%a|0],1,b);0>r&&(c=c.negate());0>this._s&&(a=a.negate());return[c,a]}for(var d=this._d.slice(),c=Array(d.length),g=0,f=0,k=0,l;d.length;)g=1E7*g+d[d.length-1],g<a?(c[k++]=0,d.pop(),f=1E7*f+
g):(l=0===g?0:g/a|0,f=g-a*l,(c[k++]=l)?(d.pop(),g=f):d.pop());a=new m([f],1,b);0>this._s&&(a=a.negate());return[new m(c.reverse(),r,b),a]};m.prototype.isEven=function(){var a=this._d;return 0===this._s||0===a.length||0===a[0]%2};m.prototype.isOdd=function(){return!this.isEven()};m.prototype.sign=function(){return this._s};m.prototype.isPositive=function(){return 0<this._s};m.prototype.isNegative=function(){return 0>this._s};m.prototype.isZero=function(){return 0===this._s};m.prototype.exp10=function(a){a=
+a;if(0===a)return this;if(Math.abs(a)>Number(g))throw Error("exponent too large in BigInteger.exp10");if(0<a){for(var r=new m(this._d.slice(),this._s,b);7<=a;a-=7)r._d.unshift(0);if(0==a)return r;r._s=1;r=r.multiplySingleDigit(Math.pow(10,a));return 0>this._s?r.negate():r}if(-a>=7*this._d.length)return e;r=new m(this._d.slice(),this._s,b);for(a=-a;7<=a;a-=7)r._d.shift();return 0==a?r:r.divRemSmall(Math.pow(10,a))[0]};m.prototype.pow=function(a){if(this.isUnit())return 0<this._s?this:m(a).isOdd()?
this:this.negate();a=m(a);if(0===a._s)return d;if(0>a._s){if(0===this._s)throw Error("Divide by zero");return e}if(0===this._s)return e;if(a.isUnit())return this;if(0<a.compareAbs(g))throw Error("exponent too large in BigInteger.pow");for(var r=this,b=d,c=m.small[2];a.isPositive()&&(!a.isOdd()||(b=b.multiply(r),!a.isUnit()));)r=r.square(),a=a.quotient(c);return b};m.prototype.modPow=function(a,r){for(var b=d,e=this;a.isPositive();)a.isOdd()&&(b=b.multiply(e).remainder(r)),a=a.quotient(m.small[2]),
a.isPositive()&&(e=e.square().remainder(r));return b};m.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var a=this._d.length;if(30>7*a)return Math.log(this.valueOf());var r=Math.ceil(30/7),e=this._d.slice(a-r);return Math.log((new m(e,1,b)).valueOf())+(a-r)*Math.log(1E7)};m.prototype.valueOf=function(){return parseInt(this.toString(),10)};m.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var g=m(2147483647);m.MAX_EXP=g;(function(){function a(r){return function(a){return r.call(m(a))}}
function r(a){return function(r,b){return a.call(m(r),m(b))}}function b(a){return function(r,b,e){return a.call(m(r),m(b),m(e))}}(function(){var e,c,d="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),g="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),f=["modPow"];for(e=0;e<d.length;e++)c=d[e],m[c]=a(m.prototype[c]);for(e=0;e<g.length;e++)c=g[e],m[c]=r(m.prototype[c]);for(e=0;e<f.length;e++)c=
f[e],m[c]=b(m.prototype[c]);m.exp10=function(a,r){return m(a).exp10(r)}})()})();a.BigInteger=m})("undefined"!==typeof a?a:this);var b={greatest_common_divisor:function(a,m){if(m.isUnit()||a.isUnit())return BigInteger.ONE;for(var b;!m.isZero();)b=m,m=a.remainder(m),a=b;return a},create:function(){return[0]},clone:function(a){for(var m=[],b=0,e=a.length;b<e;b++)m[b]=a[b];return m},copy:function(a,m){a=[];for(var b=0,e=m.length;b<e;b++)a[b]=m[b];return a},abs:function(a,m){a[0]=Math.abs(m[0]);return a},
str:function(a){return a[0].toString()},toInteger:function(a){return out[0]},fromInteger:function(a){return[parseInt(a)]}};b.ZERO=b.fromInteger(0);b.ONE=b.fromInteger(1);"undefined"!==typeof a&&(a.bigint=b);if(!f)var f=Array;if(!l)var l=Math.pow(2,56);if(!k)var k=16777216;var e={EPSILON:2E-16};e.MAX_LOOPS=k;e.create=function(){var a=new f(2);a[0]=0;a[1]=1;return a};e.clone=function(a){var m=new f(2);m[0]=a[0];m[1]=a[1];return m};e.fromValues=function(a,m){var b=new f(2);b[0]=a;b[1]=m;return e.normalize(b,
b)};e.copy=function(a,m){a[0]=m[0];a[1]=m[1];return a};e.set=function(a,m,b){a[0]=m;a[1]=b;return e.normalize(a,a)};e.abs=function(a,m){a[0]=Math.abs(m[0]);a[1]=m[1];return a};e.invert=function(a,m){var b=m[0];a[0]=m[1];a[1]=b;return a};e.reciprocal=e.invert;e.add=function(a,m,b){m[1]===b[1]?(a[0]=m[0]+b[0],a[1]=m[1]):(a[0]=m[0]*b[1]+b[0]*m[1],a[1]=m[1]*b[1]);return e.normalize(a,a)};e.subtract=function(a,m,b){m[1]===b[1]?(a[0]=m[0]-b[0],a[1]=m[1]):(a[0]=m[0]*b[1]-b[0]*m[1],a[1]=m[1]*b[1]);return e.normalize(a,
a)};e.sub=e.subtract;e.multiply=function(a,m,b){a[0]=m[0]*b[0];a[1]=m[1]*b[1];return e.normalize(a,a)};e.mul=e.multiply;e.mediant=function(a,m,b){a[0]=m[0]+b[0];a[1]=m[1]+b[1];return e.normalize(a,a)};e.divide=function(a,m,b){a[0]=m[0]*b[1];a[1]=m[1]*b[0];return e.normalize(a,a)};e.div=e.divide;e.equals=function(a,m){return 0===a[0]&&0===m[0]||0===a[1]&&0===m[1]?!0:a[0]===m[0]&&a[1]===m[1]};e.approximates=function(a,m){if(e.equals(a,m))return!0;var b=e.create();e.sub(b,a,m);e.abs(b,b);return e.isLessThan(b,
e.INFINITESIMAL)};e.isGreaterThan=function(a,m){return e.equals(a,m)?!1:a[0]*m[1]>m[0]*a[1]};e.isLessThan=function(a,m){return e.equals(a,m)?!1:a[0]*m[1]<m[0]*a[1]};e.isNegative=function(a){return 0>a[0]};e.min=function(a,m,b){e.isLessThan(m,b)?(a[0]=m[0],a[1]=m[1]):(a[0]=b[0],a[1]=b[1]);return a};e.max=function(a,m,b){e.isGreaterThan(m,b)?(a[0]=m[0],a[1]=m[1]):(a[0]=b[0],a[1]=b[1]);return a};e.scalar_multiply=function(a,m,b){a[0]=m[0]*b;a[1]=m[1];return e.normalize(a,a)};e.scalar_divide=function(a,
m,b){a[0]=m[0];a[1]=m[1]*b;return e.normalize(a,a)};e.normalize=function(a,m){if(isNaN(m[0])||isNaN(m[1])||0===m[0]&&0===m[1])return a[0]=0,a[1]=0,a;if(0===m[0])return a[0]=0,a[1]=1,a;if(0===m[1])return a[0]=1,a[1]=0,a;if(m[0]===m[1])return a[0]=1,a[1]=1,a;0<m[1]?(a[0]=m[0],a[1]=m[1]):(a[0]=-m[0],a[1]=-m[1]);var b=d.greatest_common_divisor(Math.abs(a[0]),a[1]);1<b&&(a[0]/=b,a[1]/=b);return a};e.opposite=function(a,m){a[0]=-m[0];a[1]=m[1];return a};e.negative=e.opposite;e.neg=e.opposite;e.power=function(a,
m,b){2===b?(a[0]=m[0]*m[0],a[1]=m[1]*m[1]):0<b?(a[0]=Math.pow(m[0],b),a[1]=Math.pow(m[1],b)):0>b?(b=Math.abs(b),a[0]=Math.pow(m[1],b),a[1]=Math.pow(m[0],b)):e.copy(a,e.ONE);return e.normalize(a,a)};e.pow=e.power;e.sqrt=function(a,m){return e.nthRoot(a,m,2)};e.nthRoot=function(a,m,b){if(e.equals(m,e.ZERO))return e.copy(a,e.ZERO);if(e.equals(m,e.ONE))return e.copy(a,e.ONE);if(e.equals(m,e.INFINITY))return e.copy(a,e.INFINITY);if(e.equals(m,e.INFINULL))return e.copy(a,e.INFINULL);var c=e.isNegative(m);
c&&(m[0]=-m[0]);a=e.copy(a,e.ONE);for(var d=[1,0,0,1],g=e.clone(e.ONE),f=e.MAX_LOOPS;!e.approximates(m,g)&&f--;)e.isLessThan(m,g)?(d[0]+=d[1],d[2]+=d[3]):(d[1]+=d[0],d[3]+=d[2]),a[0]=d[0]+d[1],a[1]=d[2]+d[3],e.pow(g,a,b);c&&(m[0]=-m[0],1===b%2&&e.neg(a,a));return a};e.dot=function(a,m){return a[0]*m[0]+a[1]*m[1]};e.str=function(a){return 1===a[1]?a[0].toString():a[0]+"/"+a[1]};e.toDecimal=function(a){return a[0]/a[1]};e.dec=e.toDecimal;e.toInteger=function(a){return Math.round(e.toDecimal(a))};e.round=
e.toInteger;e.floor=function(a){return Math.floor(e.toDecimal(a))};e.ceil=function(a){return Math.ceil(e.toDecimal(a))};e.fromInteger_copy=function(a,m){a[0]=parseInt(m);a[1]=1;return a};e.fromInteger=function(a){return e.fromInteger_copy(e.create(),a)};e.fromIntegerInverse_copy=function(a,m){a[0]=1;a[1]=parseInt(m);0>a[1]&&(a[0]=-a[0],a[1]=-a[1]);return a};e.fromIntegerInverse=function(a){return e.fromIntegerInverse_copy(e.create(),a)};e.fromDecimal=function(a){return e.fromDecimal_copy(e.create(),
a)};e.fromDecimal_copy=function(a,m){m=parseFloat(m);if(isNaN(m))return e.copy(a,e.INFINULL);if(Infinity===m)return e.copy(a,e.INFINITY);if(Math.abs(m)<e.EPSILON)return e.copy(a,e.ZERO);if(Math.abs(m-1)<e.EPSILON)return e.copy(a,e.ONE);if(Math.abs(m%1)<e.EPSILON)return e.fromInteger_copy(a,m);if(Math.abs(1/m%1)<e.EPSILON)return e.fromIntegerInverse_copy(a,Math.round(1/m));e.copy(a,e.ONE);for(var b=[1,0,0,1],c=m,d=1,g=e.MAX_LOOPS;g--&&Math.abs(m-e.toDecimal(a))>e.EPSILON;){d=Math.floor(c);a[0]=d*b[0]+
b[2];a[1]=d*b[1]+b[3];if(c===d)break;c=1/(c-d);b[2]=b[0];b[3]=b[1];b[0]=a[0];b[1]=a[1]}return a};e.fromRandom=function(a){a[0]=0xfffffffffffff*Math.random()<<0;a[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return e.normalize(a,a)};e.sin=function(a,b){if(0===b[1])return e.copy(a,e.ZERO);e.scalar_multiply(a,b,2);var c=e.create();e.pow(c,b,2);e.add(c,c,e.ONE);e.divide(a,a,c);return a};e.cos=function(a,b){if(0===b[1])return e.neg(a,e.ONE);var c=e.create();e.pow(c,b,2);e.sub(a,e.ONE,c);var d=e.create();
e.add(d,e.ONE,c);e.divide(a,a,d);return a};e.tan=function(a,b){e.scalar_multiply(a,b,2);var c=e.create();e.pow(c,b,2);e.scalar_multiply(c,c,2);e.add(a,a,c);e.pow(c,b,4);e.sub(c,e.ONE,c);e.divide(a,a,c);return a};e.toEgyptian=function(a){a=e.clone(a);e.abs(a,a);var b=e.floor(a);b&&e.sub(a,a,e.fromInteger(b));if(!a[0])return b.toString();b||(b="");for(var c=1,d=e.create();1!==a[0];)c++,d=e.fromValues(1,c),e.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=e.str(d),e.sub(a,a,d));return a?b?b+" + "+e.str(a):e.str(a):
b?b:"0"};e.toBabylonian=function(a){var b="",c=e.toDecimal(a);a=parseInt(c);for(var c=c-a,d=0,g=0;0<a;)(d=a%60)&&(b=d+" * 60^"+g+(b?" + ":"")+b),a=(a-d)/60,g++;for(g=-1;0<c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+g),g--);return b?b:"0"};e.traceSternBrocot=function(a){var b="";if(e.equals(a,e.ZERO)||e.equals(a,e.ONE)||e.equals(a,e.INFINITY)||e.equals(a,e.INFINULL))return b;a=e.clone(a);e.isNegative(a)&&(a[0]=-a[0]);for(var c=e.clone(e.ONE),d=[1,0,0,1],g=0,f=0,k=e.MAX_LOOPS;!e.approximates(a,
c)&&k--;)e.isLessThan(a,c)?(d[0]+=d[1],d[2]+=d[3],f++,g&&(b+="R",1!==g&&(b+=g),g=0,b+=" ")):(d[1]+=d[0],d[3]+=d[2],g++,f&&(b+="L",1!==f&&(b+=f),f=0,b+=" ")),c[0]=d[0]+d[1],c[1]=d[2]+d[3];f?(b+="L",1!==f&&(b+=f)):g&&(b+="R",1!==g&&(b+=g));0>k&&(b+="...");return b};e.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(e.equals(a,e.ZERO))return[0];if(e.equals(a,e.ONE))return[1];if(e.equals(a,e.NEGONE))return[-1];if(e.equals(a,e.INFINITY))return[1,0];if(e.equals(a,e.INFINULL))return[0,
0];var c=e.clone(a),d=e.isNegative(c);d&&(c[0]=-c[0]);for(var g=e.clone(e.ONE),f=[1,0,0,1],k=1,l=[0],n=l.length-1;!e.equals(c,g)&&b--;)e.isLessThan(c,g)?(-1===k?l[n]++:(k=-1,l.push(1),n++),f[0]+=f[1],f[2]+=f[3]):(1===k?l[n]++:(k=1,l.push(1),n++),f[1]+=f[0],f[3]+=f[2]),g[0]=f[0]+f[1],g[1]=f[2]+f[3];0>b?l.push(0):l[n]++;if(d)for(var h in l)l[h]=-l[h];return l};e.fromContinuedFraction=function(a,b){e.fromInteger_copy(a,b[b.length-1]);for(var c=b.length-2;-1<c;c--)e.invert(a,a),e.add(a,e.fromInteger(b[c]),
a);return a};e.dump=function(a){e.create();return"rat\t"+e.str(a)+"\n~\t"+e.toDecimal(a)+"\nCF:\t["+e.toContinuedFraction(a)+"]\n"};e.ZERO=e.fromInteger(0);e.ONE=e.fromInteger(1);e.NEGONE=e.fromInteger(-1);e.INFINITY=e.fromValues(1,0);e.INFINULL=e.fromValues(0,0);e.INFINITESIMAL=e.clone([1,l]);e.PI=e.fromValues(1320192667429,420230377710);"undefined"!==typeof a&&(a.rat=e);if(!h)var h=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!q)var q=1073741824;var g={EPSILON:2E-16};g.MAX_LOOPS=q;g.create=
function(){var a=[];a[0]=BigInteger.ZERO;a[1]=BigInteger.ONE;return a};g.clone=function(a){var b=[];b[0]=a[0];b[1]=a[1];return b};g.fromValues=function(a,b){var c=[];c[0]=new BigInteger(a);c[1]=new BigInteger(b);return g.normalize(c,c)};g.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};g.set=function(a,b,c){a[0]=b;a[1]=c;return g.normalize(a,a)};g.toRat=function(a,b){return e.set(a,b[0].toJSValue(),b[1].toJSValue())};g.fromRat=function(a,b){return g.set(a,BigInteger(b[0]),BigInteger(b[1]))};g.abs=
function(a,b){a[0]=b[0].abs();a[1]=b[1];return a};g.invert=function(a,b){var c=b[0];a[0]=b[1];a[1]=c;return a};g.reciprocal=g.invert;g.add=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].add(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).add(c[0].multiply(b[1])),a[1]=b[1].multiply(c[1]));return g.normalize(a,a)};g.subtract=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].subtract(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).subtract(c[0].multiply(b[1])),a[1]=b[1].multiply(c[1]));return g.normalize(a,
a)};g.sub=g.subtract;g.multiply=function(a,b,c){a[0]=b[0].multiply(c[0]);a[1]=b[1].multiply(c[1]);return g.normalize(a,a)};g.mul=g.multiply;g.mediant=function(a,b,c){a[0]=b[0].add(c[0]);a[1]=b[1].add(c[1]);return g.normalize(a,a)};g.divide=function(a,b,c){a[0]=b[0].multiply(c[1]);a[1]=b[1].multiply(c[0]);return g.normalize(a,a)};g.div=g.divide;g.equals=function(a,b){return a[0].isZero()&&b[0].isZero()||a[1].isZero()&&b[1].isZero()?!0:0===a[0].compare(b[0])&&0===a[1].compare(b[1])};g.approximates=
function(a,b){if(g.equals(a,b))return!0;var c=g.create();g.sub(c,a,b);g.abs(c,c);return g.isLessThan(c,g.INFINITESIMAL)};g.isGreaterThan=function(a,b){return g.equals(a,b)?!1:0<a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};g.isLessThan=function(a,b){return g.equals(a,b)?!1:0>a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};g.isNegative=function(a){return a[0].isNegative()};g.min=function(a,b,c){g.isLessThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.max=function(a,b,c){g.isGreaterThan(b,
c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.scalar_multiply=function(a,b,c){a[0]=b[0].multiply(c);a[1]=b[1];return g.normalize(a,a)};g.scalar_divide=function(a,b,c){a[0]=b[0];a[1]=b[1].multiply(c);return g.normalize(a,a)};g.normalize=function(a,c){if(c[0].isZero()||c[1].isZero())return c;if(0===c[0].compare(c[1]))return g.clone(g.ONE);if(c[1].isNegative())a[0]=c[0].negate(),a[1]=c[1].negate();else if(a[0]=c[0],a[1]=c[1],a[1].isZero())return a;var e=b.greatest_common_divisor(a[0].abs(),
a[1]);0<e.compare(BigInteger.ONE)&&(a[0]=a[0].quotient(e),a[1]=a[1].quotient(e));return a};g.opposite=function(a,b){a[0]=b[0].negate();a[1]=b[1];return a};g.negative=g.opposite;g.neg=g.opposite;g.power=function(a,b,c){2===c?(a[0]=b[0].square(),a[1]=b[1].square()):0<c?(a[0]=b[0].pow(c),a[1]=b[1].pow(c)):0>c?(c=Math.abs(c),a[0]=b[1].pow(c),a[1]=b[0].pow(c)):g.copy(a,g.ONE);return a};g.pow=g.power;g.sqrt=function(a,b){return g.nthRoot(a,b,2)};g.nthRoot=function(a,b,c){if(g.equals(b,g.ZERO))return g.copy(a,
g.ZERO);if(g.equals(b,g.ONE))return g.copy(a,g.ONE);if(g.equals(b,g.INFINITY))return g.copy(a,g.INFINITY);if(g.equals(b,g.INFINULL))return g.copy(a,g.INFINULL);var e=g.isNegative(b);e&&(b[0]=b[0].negate());g.copy(a,g.ONE);for(var d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=g.clone(g.ONE),k=q;!g.approximates(b,f)&&k--;)g.isLessThan(b,f)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3])):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2])),a[0]=d[0].add(d[1]),a[1]=d[2].add(d[3]),g.pow(f,a,c);e&&(b[0]=
b[0].negate(),1===c%2&&g.neg(a,a));return a};g.dot=function(a,b){return a[0].multiply(b[0]).add(a[1].multiply(b[1]))};g.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};g.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};g.dec=g.toDecimal;g.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};g.round=g.toInteger;g.toBigInteger=function(a){return a[0].quotient(a[1])};g.floor=function(a){return Math.floor(g.toDecimal(a))};
g.ceil=function(a){return Math.ceil(g.toDecimal(a))};g.fromInteger_copy=function(a,b){a[0]=BigInteger(b);a[1]=BigInteger.ONE;return a};g.fromInteger=function(a){return g.fromInteger_copy(g.create(),a)};g.fromIntegerInverse_copy=function(a,b){a[0]=BigInteger.ONE;a[1]=BigInteger(b);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};g.fromIntegerInverse=function(a){return g.fromIntegerInverse_copy(g.create(),a)};g.fromDecimal=function(a){return g.fromDecimal_copy(g.create(),a)};g.fromDecimal_copy=
function(a,b){b=parseFloat(b);if(isNaN(b))return g.copy(a,g.INFINULL);if(Infinity===b)return g.copy(a,g.INFINITY);if(Math.abs(b)<g.EPSILON)return g.copy(a,g.ZERO);if(Math.abs(b-1)<g.EPSILON)return g.copy(a,g.ONE);if(Math.abs(b%1)<g.EPSILON)return g.fromInteger_copy(a,b);if(Math.abs(1/b%1)<g.EPSILON)return g.fromIntegerInverse_copy(a,Math.round(1/b));g.copy(a,g.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=b,e=BigInteger(1),f=g.MAX_LOOPS;f--&&Math.abs(b-g.toDecimal(a))>
g.EPSILON;){e=BigInteger(Math.floor(d));a[0]=e.multiply(c[0]).add(c[2]);a[1]=e.multiply(c[1]).add(c[3]);if(e=d-parseInt(e.toString(),10))d=1/e;else{if(b.toString()===g.toDecimal(a))break;d=(c=(b.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;g.add(a,g.fromInteger(c[1]),g.fromValues(c[2],Math.pow(10,d)));break}c[2]=c[0];c[3]=c[1];c[0]=a[0];c[1]=a[1]}return a};g.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return g.normalize(a,a)};g.sin=function(a,b){if(b[1].isZero())return g.copy(a,g.ZERO);g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.add(c,c,g.ONE);g.divide(a,a,c);return a};g.cos=function(a,b){if(b[1].isZero())return g.neg(a,g.ONE);var c=g.create();g.pow(c,b,2);g.sub(a,g.ONE,c);var d=g.create();g.add(d,g.ONE,c);g.divide(a,a,d);return a};g.tan=function(a,b){g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.scalar_multiply(c,c,2);g.add(a,a,c);g.pow(c,b,4);g.sub(c,
g.ONE,c);g.divide(a,a,c);return a};g.toEgyptian=function(a){a=g.clone(a);g.abs(a,a);var b=g.floor(a);b&&g.sub(a,a,g.fromInteger(b));if(!a[0])return b.toString();b||(b="");for(var c=1,d=g.create();1!==a[0];)c++,d=g.fromValues(1,c),g.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=g.str(d),g.sub(a,a,d));return a?b?b+" + "+g.str(a):g.str(a):b?b:"0"};g.toBabylonian=function(a){var b="",c=g.toDecimal(a);a=parseInt(c);for(var c=c-a,d=0,e=0;0<a;)(d=a%60)&&(b=d+" * 60^"+e+(b?" + ":"")+b),a=(a-d)/60,e++;for(e=-1;0<
c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+e),e--);return b?b:"0"};g.traceSternBrocot=function(a){var b="";if(g.equals(a,g.ZERO)||g.equals(a,g.ONE)||g.equals(a,g.INFINITY)||g.equals(a,g.INFINULL))return b;a=g.clone(a);g.isNegative(a)&&(a[0]=a[0].negate());for(var c=g.clone(g.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=0,f=0,k=65536;!g.equals(a,c)&&k--;)g.isLessThan(a,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),f++,e&&(b+="R",1!==e&&(b+=e),e=
0,b+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),e++,f&&(b+="L",1!==f&&(b+=f),f=0,b+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);f?(b+="L",1!==f&&(b+=f)):e&&(b+="R",1!==e&&(b+=e));0>k&&(b+="...");return b};g.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(g.equals(a,g.ZERO))return[0];if(g.equals(a,g.ONE))return[1];if(g.equals(a,g.NEGONE))return[-1];if(g.equals(a,g.INFINITY))return[1,0];if(g.equals(a,g.INFINULL))return[0,0];var c=g.clone(a),d=g.isNegative(c);d&&
(c[0]=c[0].negate());for(var e=g.clone(g.ONE),f=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],k=1,l=[0],n=l.length-1;!g.equals(c,e)&&b--;)g.isLessThan(c,e)?(-1===k?l[n]++:(k=-1,l.push(1),n++),f[0]=f[0].add(f[1]),f[2]=f[2].add(f[3])):(1===k?l[n]++:(k=1,l.push(1),n++),f[1]=f[1].add(f[0]),f[3]=f[3].add(f[2])),e[0]=f[0].add(f[1]),e[1]=f[2].add(f[3]);0>b?l.push(0):l[n]++;if(d)for(var h in l)l[h]=-l[h];return l};g.fromContinuedFraction=function(a,b){g.fromInteger_copy(a,b[b.length-1]);for(var c=
b.length-2;-1<c;c--)g.invert(a,a),g.add(a,g.fromInteger(b[c]),a);return a};g.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return g.fromInteger_copy(a,factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(g.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)g.scalar_multiply(a,a,++c);return a};g.dump=function(a){return"bigrat\t"+g.str(a)+"\n~\t"+g.toDecimal(a)+"\nCF:\t["+g.toContinuedFraction(a)+"]\n"};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);g.NEGONE=g.fromInteger(-1);
g.INFINITY=g.fromValues(1,0);g.INFINULL=g.fromValues(0,0);g.INFINITESIMAL=g.clone([new BigInteger(1),h]);g.PI=g.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof a&&(a.bigrat=g);var n=function(a,b){this.a=e.fromValues(parseInt(a),parseInt(b))};n.prototype.toString=function(){return e.str(this.a)};n.prototype.toContinuedFraction=function(a){return e.toContinuedFraction(this.a,a)};n.prototype.invert=function(){return e.invert(this.a)};n.prototype.reciprocal=n.prototype.invert;n.prototype.add=function(a){var b=e.create();e.add(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.plus=n.prototype.add;n.prototype.subtract=function(a){var b=e.create();
e.sub(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.sub=n.prototype.subtract;n.prototype.minus=n.prototype.subtract;n.prototype.multiply=function(a){var b=e.create();e.mul(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.mul=n.prototype.multiply;n.prototype.times=n.prototype.multiply;n.prototype.mediant=function(a){var b=e.create();e.mediant(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.divide=function(a){var b=e.create();e.div(b,this.a,a.a);return new n(b[0],b[1])};n.prototype.div=n.prototype.divide;
n.prototype.divided_by=n.prototype.divide;n.prototype.power=function(a){var b=e.create();e.pow(b,this.a,a);return new n(b[0],b[1])};n.prototype.pow=n.prototype.power;n.prototype.dump=function(){return e.dump(this.a)};n.prototype.toRat=function(){return e.clone(this.a)};n.prototype.toDecimal=function(){return e.toDecimal(this.a)};n.fromRat=function(a){var b=new n;b.a[0]=a[0];b.a[1]=a[1];return b};n.fromInteger=function(a){return n.fromRat(e.fromInteger(a))};n.fromIntegerInverse=function(a){return n.fromRat(e.fromIntegerInverse(a))};
n.fromDecimal=function(a){return n.fromRat(e.fromDecimal(a))};n.fromContinuedFraction=function(a){return n.fromRat(e.fromContinuedFraction(e.create(),a))};"undefined"!==typeof a&&(a.rational=n);var t={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<t.GREEK.length?t.GREEK[this.i++]:"?"}}};"undefined"!==typeof a&&(a.alpha=t);l={};l.FINE_STRUCTURE=g.fromValues(30223,4141639);
l.a=l.FINE_STRUCTURE;l.FINE_STRUCTURE_ALT=g.fromValues(13355891,1830237867);l.PLANK=g.fromValues(662606957,1E42);l.h=l.PLANK;l.hBAR=g.fromValues(1054571726,1E43);l.GRAVITATIONAL=g.fromValues(667384,1E16);l.G=l.GRAVITATIONAL;l.SPEED_OF_LIGHT=g.fromInteger(299792458);l.c=l.SPEED_OF_LIGHT;"undefined"!==typeof a&&(a.physics=l);var v={create:function(){return[[],[]]},fromValues:function(a){var b=v.create();b[0]=a.slice();a=v.countDimensions(b);for(b[1]=Array(a);a--;)b[1][a]=0;return v.normalize(b,b)},
mergeDimension:function(a,b,c){a[0]=[b.slice()];a[1].push(0);for(var d in c)a[0].push(c[d]);return a},evaluate:function(a,b,c){g.copy(a,g.ZERO);var d=v.countDimensions(b);if(0===d)return"0";if(1===d)for(var e in b[0]){if(b[0][e]){var d=g.fromInteger(b[0][e]),f=g.pow(g.create(),g.fromInteger(c[0]),b[1][0]+ +e);g.mul(d,d,f);g.add(a,a,d)}}else if(2===d)for(var k in b[0])for(e in b[0][k]){if(b[0][k][e]){var d=g.fromInteger(b[0][k][e]),f=g.pow(g.create(),g.fromInteger(c[0]),b[1][1]+ +e),l=g.pow(g.create(),
g.fromInteger(c[1]),b[1][0]+ +k);g.mul(d,d,f);g.mul(d,d,l);g.add(a,a,d)}}else if(3===d)for(var n in b[0])for(k in b[0][n])for(e in b[0][n][k]){if(b[0][n][k][e]){var d=g.fromInteger(b[0][n][k][e]),f=g.pow(g.create(),g.fromInteger(c[0]),b[1][2]+ +e),l=g.pow(g.create(),g.fromInteger(c[1]),b[1][1]+ +k),h=g.pow(g.create(),g.fromInteger(c[1]),b[1][0]+ +n);g.mul(d,d,f);g.mul(d,d,l);g.mul(d,d,h);g.add(a,a,d)}}else alert("unsupported dimension "+d);return a},derivatives:function(a){return[]},forEachNonZeroElement:function(a,
b){for(var c=a.slice(),d=0;"object"===typeof c[0];)c=c[0].slice(),d++;for(var e=d+1;0<e;--e){print(Array(e).join("[0]"));var c=eval("(a"+Array(e).join("[0]")+")"),f;for(f in c)for(var g=d+2;0<g;--g)print(c[f])}return""},str:function(a){var b="",c=new t.iterator,d=c.next(),e=c.next(),c=c.next(),f=v.countDimensions(a);if(0===f)b+=a.toString();else if(1===f)for(var g in a[0]){if(a[0][g]){b?b+=" "+(0>a[0][g]?"-":"+")+" ":0>a[0][g]&&(b+="-");var f=Math.abs(a[0][g]),k=a[1][0]+ +g;if(1!==f||0===k)b+=f;0!==
k&&(b+=d+(1===k?"":"<sup>"+k+"</sup>"))}}else if(2===f)for(var l in a[0])for(g in a[0][l]){if(a[0][l][g]){b?b+=" "+(0>a[0][l][g]?"-":"+")+" ":0>a[0][l][g]&&(b+="-");var f=Math.abs(a[0][l][g]),k=a[1][1]+ +g,n=a[1][0]+ +l;if(1!==f||0===n&&0===k)b+=f;0!==k&&(b+=d+(1===k?"":"<sup>"+k+"</sup>"));0!==n&&(b+=e+(1===n?"":"<sup>"+n+"</sup>"))}}else if(3===f)for(var h in a[0])for(l in a[0][h])for(g in a[0][h][l]){if(a[0][h][l][g]){b?b+=" "+(0>a[0][h][l][g]?"-":"+")+" ":0>a[0][h][l][g]&&(b+="-");var f=Math.abs(a[0][h][l][g]),
k=a[1][2]+ +g,n=a[1][1]+ +l,u=a[1][0]+ +h;if(1!==f||0===u&&0===n&&0===k)b+=f;0!==k&&(b+=d+(1===k?"":"<sup>"+k+"</sup>"));0!==n&&(b+=e+(1===n?"":"<sup>"+n+"</sup>"));0!==u&&(b+=c+(1===u?"":"<sup>"+u+"</sup>"))}}else alert("unsupported dimension "+f);""===b&&(b="0");return b},getJSFormula:function(a){var b="",c=v.countDimensions(a);if(0===c)return"0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d],c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var e in a[0])for(d in a[0][e]){if(a[0][e][d]){b&&
(b+="+");var b=b+a[0][e][d],c=a[1][1]+ +d,f=a[1][0]+ +e;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==f&&(b=1===f?b+"*m[1]":b+("*Math.pow(m[1],"+f+")"))}}else if(3===c)for(var g in a[0])for(e in a[0][g])for(d in a[0][g][e]){if(a[0][g][e][d]){b&&(b+="+");var b=b+a[0][g][e][d],c=a[1][2]+ +d,f=a[1][1]+ +e,k=a[1][0]+ +g;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==f&&(b=1===f?b+"*m[1]":b+("*Math.pow(m[1],"+f+")"));0!==k&&(b=1===k?b+"*m[2]":b+("*Math.pow(m[2],"+k+")"))}}else alert("unsupported dimension "+
c);""===b&&(b="0");return b}};String.prototype.repeat=function(a){return Array(a+1).join(this)};v.getGLSLFormula=function(a){var b="",c=v.countDimensions(a);if(0===c)return"0.0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d]+".0",c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var e in a[0])for(d in a[0][e]){if(a[0][e][d]){b&&(b+="+");var b=b+(a[0][e][d]+".0"),c=a[1][1]+ +d,f=a[1][0]+ +e;0!==c&&(b=1===
c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==f&&(b=1===f?b+"*m_1":1<f?b+"*m_1".repeat(f):b+("*pow(1.0"+"*m_1".repeat(Math.abs(f))+",-1.0)"))}}else alert("unsupported dimension "+c);""===b&&(b="0.0");return b};v.toJSON=function(a){return JSON.stringify(a)};v.fromJSON=function(a){return JSON.parse(a)};v.normalize=function(a,b){return b};v.binary_operation=function(a,b,c,d){a=v.create();var e=v.countDimensions(b),f=v.countDimensions(c);b[1][g]!==c[1][g]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===e&&1===f){for(var g in b[0])a[0][g]="undefined"===typeof c[0][g]?b[0][g]:d(b[0][g],c[0][g]);for(g in c[0])"undefined"===typeof b[0][g]&&(a[0][g]=c[0][g]);for(g in a[0])"undefined"===typeof b[0][g]&&"undefined"===typeof c[0][g]&&(a[0][g]=null)}else alert("unsupported dimension "+e);for(g=e;g--;)a[1][g]=b[1][g];return a};v.add=function(a,b,c){return v.binary_operation(a,b,c,function(a,b){return a+b})};v.subtract=function(a,
b,c){return v.binary_operation(a,b,c,function(a,b){return a-b})};v.sub=v.subtract;v.multiply=function(a,b,c){return a};v.mul=v.multiply;v.divide=function(a,b,c){return a};v.div=v.divide;v.equals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};v.countDimensions=function(a){return"object"===typeof a[0]?v._countDimensions(a[0],1):0};v._countDimensions=function(a,b){return"object"===typeof a[0]?v._countDimensions(a[0],++b):b};v.ZERO=v.fromValues([0]);v.IDENTITY=v.fromValues([1]);v.ONE=v.IDENTITY;"undefined"!==
typeof a&&(a.polyrat=v)})(h)})(this);(function(a){"function"===typeof define&&define.amd?define(["jquery"],function(h){return a(h,window,document)}):"object"===typeof exports?module.exports=function(h,c){h||(h=window);c||(c="undefined"!==typeof window?require("jquery"):require("jquery")(h));return a(c,h,h.document)}:a(jQuery,window,document)})(function(a,h,c,d){function b(c){var d,e,f={};a.each(c,function(a){(d=a.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(d[1]+" ")&&(e=a.replace(d[0],d[2].toLowerCase()),
f[e]=a,"o"===d[1]&&b(c[a]))});c._hungarianMap=f}function f(c,e,g){c._hungarianMap||b(c);var p;a.each(e,function(b){p=c._hungarianMap[b];p===d||!g&&e[p]!==d||("o"===p.charAt(0)?(e[p]||(e[p]={}),a.extend(!0,e[p],e[b]),f(c[p],e[p],g)):e[p]=e[b])})}function l(a){var b=A.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&c&&"No data available in table"===b.sEmptyTable&&ia(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&c&&"Loading..."===b.sLoadingRecords&&ia(a,a,"sZeroRecords","sLoadingRecords");
a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&fb(a)}function k(a){fa(a,"ordering","bSort");fa(a,"orderMulti","bSortMulti");fa(a,"orderClasses","bSortClasses");fa(a,"orderCellsTop","bSortCellsTop");fa(a,"order","aaSorting");fa(a,"orderFixed","aaSortingFixed");fa(a,"paging","bPaginate");fa(a,"pagingType","sPaginationType");fa(a,"pageLength","iDisplayLength");fa(a,"searching","bFilter");"boolean"===typeof a.sScrollX&&(a.sScrollX=a.sScrollX?"100%":"");"boolean"===typeof a.scrollX&&
(a.scrollX=a.scrollX?"100%":"");if(a=a.aoSearchCols)for(var b=0,c=a.length;b<c;b++)a[b]&&f(A.models.oSearch,a[b])}function e(b){fa(b,"orderable","bSortable");fa(b,"orderData","aDataSort");fa(b,"orderSequence","asSorting");fa(b,"orderDataType","sortDataType");var c=b.aDataSort;c&&!a.isArray(c)&&(b.aDataSort=[c])}function u(b){if(!A.__browser){var c={};A.__browser=c;var d=a("<div/>").css({position:"fixed",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(a("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(a("<div/>").css({width:"100%",height:10}))).appendTo("body"),e=d.children(),f=e.children();c.barWidth=e[0].offsetWidth-e[0].clientWidth;c.bScrollOversize=100===f[0].offsetWidth&&100!==e[0].clientWidth;c.bScrollbarLeft=1!==Math.round(f.offset().left);c.bBounding=d[0].getBoundingClientRect().width?!0:!1;d.remove()}a.extend(b.oBrowser,A.__browser);b.oScroll.iBarWidth=A.__browser.barWidth}function q(a,b,c,e,f,g){var p,k=!1;for(c!==d&&(p=c,k=!0);e!==f;)a.hasOwnProperty(e)&&
(p=k?b(p,a[e],e,a):a[e],k=!0,e+=g);return p}function g(b,d){var e=A.defaults.column,f=b.aoColumns.length,e=a.extend({},A.models.oColumn,e,{nTh:d?d:c.createElement("th"),sTitle:e.sTitle?e.sTitle:d?d.innerHTML:"",aDataSort:e.aDataSort?e.aDataSort:[f],mData:e.mData?e.mData:f,idx:f});b.aoColumns.push(e);e=b.aoPreSearchCols;e[f]=a.extend({},A.models.oSearch,e[f]);n(b,f,a(d).data())}function n(b,c,g){c=b.aoColumns[c];var p=b.oClasses,k=a(c.nTh);if(!c.sWidthOrig){c.sWidthOrig=k.attr("width")||null;var l=
(k.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);l&&(c.sWidthOrig=l[1])}g!==d&&null!==g&&(e(g),f(A.defaults.column,g),g.mDataProp!==d&&!g.mData&&(g.mData=g.mDataProp),g.sType&&(c._sManualType=g.sType),g.className&&!g.sClass&&(g.sClass=g.className),a.extend(c,g),ia(c,g,"sWidth","sWidthOrig"),g.iDataSort!==d&&(c.aDataSort=[g.iDataSort]),ia(c,g,"aDataSort"));var m=c.mData,n=Q(m),h=c.mRender?Q(c.mRender):null;g=function(a){return"string"===typeof a&&-1!==a.indexOf("@")};c._bAttrSrc=a.isPlainObject(m)&&
(g(m.sort)||g(m.type)||g(m.filter));c.fnGetData=function(a,b,c){var e=n(a,b,d,c);return h&&b?h(e,b,a,c):e};c.fnSetData=function(a,b,c){return H(m)(a,b,c)};"number"!==typeof m&&(b._rowReadObject=!0);b.oFeatures.bSort||(c.bSortable=!1,k.addClass(p.sSortableNone));b=-1!==a.inArray("asc",c.asSorting);g=-1!==a.inArray("desc",c.asSorting);c.bSortable&&(b||g)?b&&!g?(c.sSortingClass=p.sSortableAsc,c.sSortingClassJUI=p.sSortJUIAscAllowed):!b&&g?(c.sSortingClass=p.sSortableDesc,c.sSortingClassJUI=p.sSortJUIDescAllowed):
(c.sSortingClass=p.sSortable,c.sSortingClassJUI=p.sSortJUI):(c.sSortingClass=p.sSortableNone,c.sSortingClassJUI="")}function t(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Qa(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;""===b.sY&&""===b.sX||ua(a);U(a,null,"column-sizing",[a])}function v(a,b){var c=z(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function r(b,c){var d=z(b,"bVisible"),d=a.inArray(c,d);return-1!==d?d:null}function m(a){return z(a,"bVisible").length}
function z(b,c){var d=[];a.map(b.aoColumns,function(a,b){a[c]&&d.push(b)});return d}function G(a){var b=a.aoColumns,c=a.aoData,e=A.ext.type.detect,g,f,p,k,l,m,n,h,w;g=0;for(f=b.length;g<f;g++)if(n=b[g],w=[],!n.sType&&n._sManualType)n.sType=n._sManualType;else if(!n.sType){p=0;for(k=e.length;p<k;p++){l=0;for(m=c.length;l<m;l++){w[l]===d&&(w[l]=B(a,l,g,"type"));h=e[p](w[l],a);if(!h&&p!==e.length-1)break;if("html"===h)break}if(h){n.sType=h;break}}n.sType||(n.sType="string")}}function M(b,c,e,f){var p,
k,l,m,n,h,w=b.aoColumns;if(c)for(p=c.length-1;0<=p;p--){h=c[p];var x=h.targets!==d?h.targets:h.aTargets;a.isArray(x)||(x=[x]);k=0;for(l=x.length;k<l;k++)if("number"===typeof x[k]&&0<=x[k]){for(;w.length<=x[k];)g(b);f(x[k],h)}else if("number"===typeof x[k]&&0>x[k])f(w.length+x[k],h);else if("string"===typeof x[k])for(m=0,n=w.length;m<n;m++)("_all"==x[k]||a(w[m].nTh).hasClass(x[k]))&&f(m,h)}if(e)for(p=0,b=e.length;p<b;p++)f(p,e[p])}function C(b,c,e,f){var g=b.aoData.length,p=a.extend(!0,{},A.models.oRow,
{src:e?"dom":"data",idx:g});p._aData=c;b.aoData.push(p);for(var k=b.aoColumns,l=0,m=k.length;l<m;l++)k[l].sType=null;b.aiDisplayMaster.push(g);c=b.rowIdFn(c);c!==d&&(b.aIds[c]=p);!e&&b.oFeatures.bDeferRender||w(b,g,e,f);return g}function E(b,c){var d;c instanceof a||(c=a(c));return c.map(function(a,c){d=p(b,c);return C(b,d.data,c,d.cells)})}function B(a,b,c,e){var g=a.iDraw,f=a.aoColumns[c],p=a.aoData[b]._aData,k=f.sDefaultContent,l=f.fnGetData(p,e,{settings:a,row:b,col:c});if(l===d)return a.iDrawError!=
g&&null===k&&(la(a,0,"Requested unknown parameter "+("function"==typeof f.mData?"{function}":"'"+f.mData+"'")+" for row "+b+", column "+c,4),a.iDrawError=g),k;if((l===p||null===l)&&null!==k)l=k;else if("function"===typeof l)return l.call(p);return null===l&&"display"==e?"":l}function I(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d,{settings:a,row:b,col:c})}function D(b){return a.map(b.match(/(\\.|[^\.])+/g)||[""],function(a){return a.replace(/\\./g,".")})}function Q(b){if(a.isPlainObject(b)){var c=
{};a.each(b,function(a,b){b&&(c[a]=Q(b))});return function(a,b,e,g){var f=c[b]||c._;return f!==d?f(a,b,e,g):a}}if(null===b)return function(a){return a};if("function"===typeof b)return function(a,c,d,e){return b(a,c,d,e)};if("string"===typeof b&&(-1!==b.indexOf(".")||-1!==b.indexOf("[")||-1!==b.indexOf("("))){var e=function(b,c,f){var g,Y;if(""!==f){Y=D(f);for(var p=0,k=Y.length;p<k;p++){f=Y[p].match(va);g=Y[p].match(pa);if(f){Y[p]=Y[p].replace(va,"");""!==Y[p]&&(b=b[Y[p]]);g=[];Y.splice(0,p+1);Y=
Y.join(".");if(a.isArray(b))for(p=0,k=b.length;p<k;p++)g.push(e(b[p],c,Y));b=f[0].substring(1,f[0].length-1);b=""===b?g:g.join(b);break}else if(g){Y[p]=Y[p].replace(pa,"");b=b[Y[p]]();continue}if(null===b||b[Y[p]]===d)return d;b=b[Y[p]]}}return b};return function(a,c){return e(a,c,b)}}return function(a){return a[b]}}function H(b){if(a.isPlainObject(b))return H(b._);if(null===b)return function(){};if("function"===typeof b)return function(a,c,d){b(a,"set",c,d)};if("string"===typeof b&&(-1!==b.indexOf(".")||
-1!==b.indexOf("[")||-1!==b.indexOf("("))){var c=function(b,e,f){f=D(f);var g;g=f[f.length-1];for(var Y,p,k=0,l=f.length-1;k<l;k++){Y=f[k].match(va);p=f[k].match(pa);if(Y){f[k]=f[k].replace(va,"");b[f[k]]=[];g=f.slice();g.splice(0,k+1);Y=g.join(".");if(a.isArray(e))for(p=0,l=e.length;p<l;p++)g={},c(g,e[p],Y),b[f[k]].push(g);else b[f[k]]=e;return}p&&(f[k]=f[k].replace(pa,""),b=b[f[k]](e));if(null===b[f[k]]||b[f[k]]===d)b[f[k]]={};b=b[f[k]]}if(g.match(pa))b[g.replace(pa,"")](e);else b[g.replace(va,
"")]=e};return function(a,d){return c(a,d,b)}}return function(a,c){a[b]=c}}function N(a){return ha(a.aoData,"_aData")}function L(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0;a.aIds={}}function P(a,b,c){for(var e=-1,f=0,g=a.length;f<g;f++)a[f]==b?e=f:a[f]>b&&a[f]--; -1!=e&&c===d&&a.splice(e,1)}function O(a,b,c,e){var f=a.aoData[b],g,k=function(c,e){for(;c.childNodes.length;)c.removeChild(c.firstChild);c.innerHTML=B(a,b,e,"display")};if("dom"!==c&&(c&&"auto"!==c||"dom"!==f.src)){var l=
f.anCells;if(l)if(e!==d)k(l[e],e);else for(c=0,g=l.length;c<g;c++)k(l[c],c)}else f._aData=p(a,f,e,e===d?d:f._aData).data;f._aSortData=null;f._aFilterData=null;k=a.aoColumns;if(e!==d)k[e].sType=null;else{c=0;for(g=k.length;c<g;c++)k[c].sType=null;x(a,f)}}function p(b,c,e,f){var g=[],p=c.firstChild,k,l,m=0,n,h=b.aoColumns,w=b._rowReadObject;f=f!==d?f:w?{}:[];var x=function(a,b){if("string"===typeof a){var c=a.indexOf("@");-1!==c&&(c=a.substring(c+1),H(a)(f,b.getAttribute(c)))}},t=function(b){if(e===
d||e===m)l=h[m],n=a.trim(b.innerHTML),l&&l._bAttrSrc?(H(l.mData._)(f,n),x(l.mData.sort,b),x(l.mData.type,b),x(l.mData.filter,b)):w?(l._setter||(l._setter=H(l.mData)),l._setter(f,n)):f[m]=n;m++};if(p)for(;p;){k=p.nodeName.toUpperCase();if("TD"==k||"TH"==k)t(p),g.push(p);p=p.nextSibling}else for(g=c.anCells,p=0,k=g.length;p<k;p++)t(g[p]);(c=c.firstChild?c:c.nTr)&&(c=c.getAttribute("id"))&&H(b.rowId)(f,c);return{data:f,cells:g}}function w(a,b,e,d){var f=a.aoData[b],g=f._aData,p=[],k,l,m,n,h;if(null===
f.nTr){k=e||c.createElement("tr");f.nTr=k;f.anCells=p;k._DT_RowIndex=b;x(a,f);n=0;for(h=a.aoColumns.length;n<h;n++){m=a.aoColumns[n];l=e?d[n]:c.createElement(m.sCellType);l._DT_CellIndex={row:b,column:n};p.push(l);if(!e||m.mRender||m.mData!==n)l.innerHTML=B(a,b,n,"display");m.sClass&&(l.className+=" "+m.sClass);m.bVisible&&!e?k.appendChild(l):!m.bVisible&&e&&l.parentNode.removeChild(l);m.fnCreatedCell&&m.fnCreatedCell.call(a.oInstance,l,B(a,b,n),g,b,n)}U(a,"aoRowCreatedCallback",null,[k,g,b])}f.nTr.setAttribute("role",
"row")}function x(b,c){var e=c.nTr,d=c._aData;if(e){var f=b.rowIdFn(d);f&&(e.id=f);d.DT_RowClass&&(f=d.DT_RowClass.split(" "),c.__rowc=c.__rowc?za(c.__rowc.concat(f)):f,a(e).removeClass(c.__rowc.join(" ")).addClass(d.DT_RowClass));d.DT_RowAttr&&a(e).attr(d.DT_RowAttr);d.DT_RowData&&a(e).data(d.DT_RowData)}}function J(b){var c,e,d,f,g,p=b.nTHead,k=b.nTFoot,l=0===a("th, td",p).length,m=b.oClasses,n=b.aoColumns;l&&(f=a("<tr/>").appendTo(p));c=0;for(e=n.length;c<e;c++)g=n[c],d=a(g.nTh).addClass(g.sClass),
l&&d.appendTo(f),b.oFeatures.bSort&&(d.addClass(g.sSortingClass),!1!==g.bSortable&&(d.attr("tabindex",b.iTabIndex).attr("aria-controls",b.sTableId),Ra(b,g.nTh,c))),g.sTitle!=d[0].innerHTML&&d.html(g.sTitle),Sa(b,"header")(b,d,g,m);l&&ba(b.aoHeader,p);a(p).find(">tr").attr("role","row");a(p).find(">tr>th, >tr>td").addClass(m.sHeaderTH);a(k).find(">tr>th, >tr>td").addClass(m.sFooterTH);if(null!==k)for(b=b.aoFooter[0],c=0,e=b.length;c<e;c++)g=n[c],g.nTf=b[c].cell,g.sClass&&a(g.nTf).addClass(g.sClass)}
function T(b,c,e){var f,g,p,k=[],l=[],m=b.aoColumns.length,n;if(c){e===d&&(e=!1);f=0;for(g=c.length;f<g;f++){k[f]=c[f].slice();k[f].nTr=c[f].nTr;for(p=m-1;0<=p;p--)b.aoColumns[p].bVisible||e||k[f].splice(p,1);l.push([])}f=0;for(g=k.length;f<g;f++){if(b=k[f].nTr)for(;p=b.firstChild;)b.removeChild(p);p=0;for(c=k[f].length;p<c;p++)if(n=m=1,l[f][p]===d){b.appendChild(k[f][p].cell);for(l[f][p]=1;k[f+m]!==d&&k[f][p].cell==k[f+m][p].cell;)l[f+m][p]=1,m++;for(;k[f][p+n]!==d&&k[f][p].cell==k[f][p+n].cell;){for(e=
0;e<m;e++)l[f+e][p+n]=1;n++}a(k[f][p].cell).attr("rowspan",m).attr("colspan",n)}}}}function R(b){var c=U(b,"aoPreDrawCallback","preDraw",[b]);if(-1!==a.inArray(!1,c))ga(b,!1);else{var c=[],e=0,f=b.asStripeClasses,g=f.length,p=b.oLanguage,k=b.iInitDisplayStart,l="ssp"==ca(b),n=b.aiDisplay;b.bDrawing=!0;k!==d&&-1!==k&&(b._iDisplayStart=l?k:k>=b.fnRecordsDisplay()?0:k,b.iInitDisplayStart=-1);var k=b._iDisplayStart,h=b.fnDisplayEnd();if(b.bDeferLoading)b.bDeferLoading=!1,b.iDraw++,ga(b,!1);else if(l){if(!b.bDestroying&&
!na(b))return}else b.iDraw++;if(0!==n.length)for(p=l?b.aoData.length:h,l=l?0:k;l<p;l++){var x=n[l],t=b.aoData[x];null===t.nTr&&w(b,x);x=t.nTr;if(0!==g){var u=f[e%g];t._sRowStripe!=u&&(a(x).removeClass(t._sRowStripe).addClass(u),t._sRowStripe=u)}U(b,"aoRowCallback",null,[x,t._aData,e,l]);c.push(x);e++}else e=p.sZeroRecords,1==b.iDraw&&"ajax"==ca(b)?e=p.sLoadingRecords:p.sEmptyTable&&0===b.fnRecordsTotal()&&(e=p.sEmptyTable),c[0]=a("<tr/>",{"class":g?f[0]:""}).append(a("<td />",{valign:"top",colSpan:m(b),
"class":b.oClasses.sRowEmpty}).html(e))[0];U(b,"aoHeaderCallback","header",[a(b.nTHead).children("tr")[0],N(b),k,h,n]);U(b,"aoFooterCallback","footer",[a(b.nTFoot).children("tr")[0],N(b),k,h,n]);f=a(b.nTBody);f.children().detach();f.append(a(c));U(b,"aoDrawCallback","draw",[b]);b.bSorted=!1;b.bFiltered=!1;b.bDrawing=!1}}function y(a,b){var c=a.oFeatures,e=c.bFilter;c.bSort&&gb(a);e?oa(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;R(a);a._drawHold=
!1}function F(b){var c=b.oClasses,e=a(b.nTable),e=a("<div/>").insertBefore(e),d=b.oFeatures,f=a("<div/>",{id:b.sTableId+"_wrapper","class":c.sWrapper+(b.nTFoot?"":" "+c.sNoFooter)});b.nHolding=e[0];b.nTableWrapper=f[0];b.nTableReinsertBefore=b.nTable.nextSibling;for(var g=b.sDom.split(""),p,k,l,m,n,h,w=0;w<g.length;w++){p=null;k=g[w];if("<"==k){l=a("<div/>")[0];m=g[w+1];if("'"==m||'"'==m){n="";for(h=2;g[w+h]!=m;)n+=g[w+h],h++;"H"==n?n=c.sJUIHeader:"F"==n&&(n=c.sJUIFooter);-1!=n.indexOf(".")?(m=n.split("."),
l.id=m[0].substr(1,m[0].length-1),l.className=m[1]):"#"==n.charAt(0)?l.id=n.substr(1,n.length-1):l.className=n;w+=h}f.append(l);f=a(l)}else if(">"==k)f=f.parent();else if("l"==k&&d.bPaginate&&d.bLengthChange)p=hb(b);else if("f"==k&&d.bFilter)p=Aa(b);else if("r"==k&&d.bProcessing)p=ib(b);else if("t"==k)p=jb(b);else if("i"==k&&d.bInfo)p=kb(b);else if("p"==k&&d.bPaginate)p=lb(b);else if(0!==A.ext.feature.length)for(l=A.ext.feature,h=0,m=l.length;h<m;h++)if(k==l[h].cFeature){p=l[h].fnInit(b);break}p&&
(l=b.aanFeatures,l[k]||(l[k]=[]),l[k].push(p),f.append(p))}e.replaceWith(f);b.nHolding=null}function ba(b,c){var e=a(c).children("tr"),d,f,g,p,k,l,m,n,h,w;b.splice(0,b.length);g=0;for(l=e.length;g<l;g++)b.push([]);g=0;for(l=e.length;g<l;g++)for(d=e[g],f=d.firstChild;f;){if("TD"==f.nodeName.toUpperCase()||"TH"==f.nodeName.toUpperCase()){n=1*f.getAttribute("colspan");h=1*f.getAttribute("rowspan");n=n&&0!==n&&1!==n?n:1;h=h&&0!==h&&1!==h?h:1;p=0;for(k=b[g];k[p];)p++;m=p;w=1===n?!0:!1;for(k=0;k<n;k++)for(p=
0;p<h;p++)b[g+p][m+k]={cell:f,unique:w},b[g+p].nTr=d}f=f.nextSibling}}function da(a,b,c){var e=[];c||(c=a.aoHeader,b&&(c=[],ba(c,b)));b=0;for(var d=c.length;b<d;b++)for(var f=0,g=c[b].length;f<g;f++)!c[b][f].unique||e[f]&&a.bSortCellsTop||(e[f]=c[b][f].cell);return e}function W(b,c,e){U(b,"aoServerParams","serverParams",[c]);if(c&&a.isArray(c)){var d={},f=/(.*?)\[\]$/;a.each(c,function(a,b){var c=b.name.match(f);c?(c=c[0],d[c]||(d[c]=[]),d[c].push(b.value)):d[b.name]=b.value});c=d}var g,p=b.ajax,
k=b.oInstance,l=function(a){U(b,null,"xhr",[b,a,b.jqXHR]);e(a)};if(a.isPlainObject(p)&&p.data){g=p.data;var m=a.isFunction(g)?g(c,b):g;c=a.isFunction(g)&&m?m:a.extend(!0,c,m);delete p.data}m={data:c,success:function(a){var c=a.error||a.sError;c&&la(b,0,c);b.json=a;l(a)},dataType:"json",cache:!1,type:b.sServerMethod,error:function(c,e){var d=U(b,null,"xhr",[b,null,b.jqXHR]);-1===a.inArray(!0,d)&&("parsererror"==e?la(b,0,"Invalid JSON response",1):4===c.readyState&&la(b,0,"Ajax error",7));ga(b,!1)}};
b.oAjaxData=c;U(b,null,"preXhr",[b,c]);b.fnServerData?b.fnServerData.call(k,b.sAjaxSource,a.map(c,function(a,b){return{name:b,value:a}}),l,b):b.sAjaxSource||"string"===typeof p?b.jqXHR=a.ajax(a.extend(m,{url:p||b.sAjaxSource})):a.isFunction(p)?b.jqXHR=p.call(k,c,l,b):(b.jqXHR=a.ajax(a.extend(m,p)),p.data=g)}function na(a){return a.bAjaxDataGet?(a.iDraw++,ga(a,!0),W(a,qa(a),function(b){Ba(a,b)}),!1):!0}function qa(b){var c=b.aoColumns,e=c.length,d=b.oFeatures,f=b.oPreviousSearch,g=b.aoPreSearchCols,
p,k=[],l,m,n,h=ra(b);p=b._iDisplayStart;l=!1!==d.bPaginate?b._iDisplayLength:-1;var w=function(a,b){k.push({name:a,value:b})};w("sEcho",b.iDraw);w("iColumns",e);w("sColumns",ha(c,"sName").join(","));w("iDisplayStart",p);w("iDisplayLength",l);var x={draw:b.iDraw,columns:[],order:[],start:p,length:l,search:{value:f.sSearch,regex:f.bRegex}};for(p=0;p<e;p++)m=c[p],n=g[p],l="function"==typeof m.mData?"function":m.mData,x.columns.push({data:l,name:m.sName,searchable:m.bSearchable,orderable:m.bSortable,
search:{value:n.sSearch,regex:n.bRegex}}),w("mDataProp_"+p,l),d.bFilter&&(w("sSearch_"+p,n.sSearch),w("bRegex_"+p,n.bRegex),w("bSearchable_"+p,m.bSearchable)),d.bSort&&w("bSortable_"+p,m.bSortable);d.bFilter&&(w("sSearch",f.sSearch),w("bRegex",f.bRegex));d.bSort&&(a.each(h,function(a,b){x.order.push({column:b.col,dir:b.dir});w("iSortCol_"+a,b.col);w("sSortDir_"+a,b.dir)}),w("iSortingCols",h.length));c=A.ext.legacy.ajax;return null===c?b.sAjaxSource?k:x:c?k:x}function Ba(a,b){var c=sa(a,b),e=b.sEcho!==
d?b.sEcho:b.draw,f=b.iTotalRecords!==d?b.iTotalRecords:b.recordsTotal,g=b.iTotalDisplayRecords!==d?b.iTotalDisplayRecords:b.recordsFiltered;if(e){if(1*e<a.iDraw)return;a.iDraw=1*e}L(a);a._iRecordsTotal=parseInt(f,10);a._iRecordsDisplay=parseInt(g,10);e=0;for(f=c.length;e<f;e++)C(a,c[e]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;R(a);a._bInitComplete||Ca(a,b);a.bAjaxDataGet=!0;ga(a,!1)}function sa(b,c){var e=a.isPlainObject(b.ajax)&&b.ajax.dataSrc!==d?b.ajax.dataSrc:b.sAjaxDataProp;return"data"===
e?c.aaData||c[e]:""!==e?Q(e)(c):c}function Aa(b){var e=b.oClasses,d=b.sTableId,f=b.oLanguage,g=b.oPreviousSearch,p=b.aanFeatures,k='<input type="search" class="'+e.sFilterInput+'"/>',l=f.sSearch,l=l.match(/_INPUT_/)?l.replace("_INPUT_",k):l+k,e=a("<div/>",{id:p.f?null:d+"_filter","class":e.sFilter}).append(a("<label/>").append(l)),p=function(){var a=this.value?this.value:"";a!=g.sSearch&&(oa(b,{sSearch:a,bRegex:g.bRegex,bSmart:g.bSmart,bCaseInsensitive:g.bCaseInsensitive}),b._iDisplayStart=0,R(b))},
k=null!==b.searchDelay?b.searchDelay:"ssp"===ca(b)?400:0,m=a("input",e).val(g.sSearch).attr("placeholder",f.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",k?Da(p,k):p).bind("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",d);a(b.nTable).on("search.dt.DT",function(a,e){if(b===e)try{m[0]!==c.activeElement&&m.val(g.sSearch)}catch(d){}});return e[0]}function oa(a,b,c){var e=a.oPreviousSearch,f=a.aoPreSearchCols,g=function(a){e.sSearch=a.sSearch;e.bRegex=
a.bRegex;e.bSmart=a.bSmart;e.bCaseInsensitive=a.bCaseInsensitive};G(a);if("ssp"!=ca(a)){mb(a,b.sSearch,c,b.bEscapeRegex!==d?!b.bEscapeRegex:b.bRegex,b.bSmart,b.bCaseInsensitive);g(b);for(b=0;b<f.length;b++)Ea(a,f[b].sSearch,b,f[b].bEscapeRegex!==d?!f[b].bEscapeRegex:f[b].bRegex,f[b].bSmart,f[b].bCaseInsensitive);Fa(a)}else g(b);a.bFiltered=!0;U(a,null,"search",[a])}function Fa(b){for(var c=A.ext.search,e=b.aiDisplay,d,f,g=0,p=c.length;g<p;g++){for(var k=[],l=0,m=e.length;l<m;l++)f=e[l],d=b.aoData[f],
c[g](b,d._aFilterData,f,d._aData,l)&&k.push(f);e.length=0;a.merge(e,k)}}function Ea(a,b,c,e,d,f){if(""!==b){var g=a.aiDisplay;e=Ta(b,e,d,f);for(d=g.length-1;0<=d;d--)b=a.aoData[g[d]]._aFilterData[c],e.test(b)||g.splice(d,1)}}function mb(a,b,c,e,d,f){e=Ta(b,e,d,f);d=a.oPreviousSearch.sSearch;f=a.aiDisplayMaster;var g;0!==A.ext.search.length&&(c=!0);g=nb(a);if(0>=b.length)a.aiDisplay=f.slice();else{if(g||c||d.length>b.length||0!==b.indexOf(d)||a.bSorted)a.aiDisplay=f.slice();b=a.aiDisplay;for(c=b.length-
1;0<=c;c--)e.test(a.aoData[b[c]]._sFilterRow)||b.splice(c,1)}}function Ta(b,c,e,d){b=c?b:Ga(b);e&&(b="^(?=.*?"+a.map(b.match(/"[^"]+"|[^ ]+/g)||[""],function(a){if('"'===a.charAt(0)){var b=a.match(/^"(.*)"$/);a=b?b[1]:a}return a.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(b,d?"i":"")}function Ga(a){return a.replace(Lb,"\\$1")}function nb(a){var b=a.aoColumns,c,e,d,f,g,p,k,l,m=A.ext.type.search;c=!1;e=0;for(f=a.aoData.length;e<f;e++)if(l=a.aoData[e],!l._aFilterData){p=[];d=0;for(g=b.length;d<
g;d++)c=b[d],c.bSearchable?(k=B(a,e,d,"filter"),m[c.sType]&&(k=m[c.sType](k)),null===k&&(k=""),"string"!==typeof k&&k.toString&&(k=k.toString())):k="",k.indexOf&&-1!==k.indexOf("&")&&(Ha.innerHTML=k,k=Mb?Ha.textContent:Ha.innerText),k.replace&&(k=k.replace(/[\r\n]/g,"")),p.push(k);l._aFilterData=p;l._sFilterRow=p.join("  ");c=!0}return c}function ob(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,caseInsensitive:a.bCaseInsensitive}}function pb(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,
bCaseInsensitive:a.caseInsensitive}}function kb(b){var c=b.sTableId,e=b.aanFeatures.i,d=a("<div/>",{"class":b.oClasses.sInfo,id:e?null:c+"_info"});e||(b.aoDrawCallback.push({fn:qb,sName:"information"}),d.attr("role","status").attr("aria-live","polite"),a(b.nTable).attr("aria-describedby",c+"_info"));return d[0]}function qb(b){var c=b.aanFeatures.i;if(0!==c.length){var e=b.oLanguage,d=b._iDisplayStart+1,f=b.fnDisplayEnd(),g=b.fnRecordsTotal(),p=b.fnRecordsDisplay(),k=p?e.sInfo:e.sInfoEmpty;p!==g&&
(k+=" "+e.sInfoFiltered);k+=e.sInfoPostFix;k=rb(b,k);e=e.fnInfoCallback;null!==e&&(k=e.call(b.oInstance,b,d,f,g,p,k));a(c).html(k)}}function rb(a,b){var c=a.fnFormatNumber,e=a._iDisplayStart+1,d=a._iDisplayLength,f=a.fnRecordsDisplay(),g=-1===d;return b.replace(/_START_/g,c.call(a,e)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,f)).replace(/_PAGE_/g,c.call(a,g?1:Math.ceil(e/d))).replace(/_PAGES_/g,c.call(a,g?1:Math.ceil(f/
d)))}function wa(a){var b,c,e=a.iInitDisplayStart,d=a.aoColumns,f;c=a.oFeatures;var g=a.bDeferLoading;if(a.bInitialised){F(a);J(a);T(a,a.aoHeader);T(a,a.aoFooter);ga(a,!0);c.bAutoWidth&&Qa(a);b=0;for(c=d.length;b<c;b++)f=d[b],f.sWidth&&(f.nTh.style.width=X(f.sWidth));U(a,null,"preInit",[a]);y(a);d=ca(a);if("ssp"!=d||g)"ajax"==d?W(a,[],function(c){var d=sa(a,c);for(b=0;b<d.length;b++)C(a,d[b]);a.iInitDisplayStart=e;y(a);ga(a,!1);Ca(a,c)},a):(ga(a,!1),Ca(a))}else setTimeout(function(){wa(a)},200)}function Ca(a,
b){a._bInitComplete=!0;(b||a.oInit.aaData)&&t(a);U(a,null,"plugin-init",[a,b]);U(a,"aoInitComplete","init",[a,b])}function Ua(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Va(a);U(a,null,"length",[a,c])}function hb(b){for(var c=b.oClasses,e=b.sTableId,d=b.aLengthMenu,f=a.isArray(d[0]),g=f?d[0]:d,d=f?d[1]:d,f=a("<select/>",{name:e+"_length","aria-controls":e,"class":c.sLengthSelect}),p=0,k=g.length;p<k;p++)f[0][p]=new Option(d[p],g[p]);var l=a("<div><label/></div>").addClass(c.sLength);b.aanFeatures.l||
(l[0].id=e+"_length");l.children().append(b.oLanguage.sLengthMenu.replace("_MENU_",f[0].outerHTML));a("select",l).val(b._iDisplayLength).bind("change.DT",function(){Ua(b,a(this).val());R(b)});a(b.nTable).bind("length.dt.DT",function(c,e,d){b===e&&a("select",l).val(d)});return l[0]}function lb(b){var c=b.sPaginationType,e=A.ext.pager[c],d="function"===typeof e,f=function(a){R(a)},c=a("<div/>").addClass(b.oClasses.sPaging+c)[0],g=b.aanFeatures;d||e.fnInit(b,c,f);g.p||(c.id=b.sTableId+"_paginate",b.aoDrawCallback.push({fn:function(a){if(d){var b=
a._iDisplayStart,c=a._iDisplayLength,p=a.fnRecordsDisplay(),k=-1===c,b=k?0:Math.ceil(b/c),c=k?1:Math.ceil(p/c),p=e(b,c),l,k=0;for(l=g.p.length;k<l;k++)Sa(a,"pageButton")(a,g.p[k],k,p,b,c)}else e.fnUpdate(a,f)},sName:"pagination"}));return c}function Wa(a,b,c){var e=a._iDisplayStart,d=a._iDisplayLength,f=a.fnRecordsDisplay();0===f||-1===d?e=0:"number"===typeof b?(e=b*d,e>f&&(e=0)):"first"==b?e=0:"previous"==b?(e=0<=d?e-d:0,0>e&&(e=0)):"next"==b?e+d<f&&(e+=d):"last"==b?e=Math.floor((f-1)/d)*d:la(a,
0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==e;a._iDisplayStart=e;b&&(U(a,null,"page",[a]),c&&R(a));return b}function ib(b){return a("<div/>",{id:b.aanFeatures.r?null:b.sTableId+"_processing","class":b.oClasses.sProcessing}).html(b.oLanguage.sProcessing).insertBefore(b.nTable)[0]}function ga(b,c){b.oFeatures.bProcessing&&a(b.aanFeatures.r).css("display",c?"block":"none");U(b,null,"processing",[b,c])}function jb(b){var c=a(b.nTable);c.attr("role","grid");var e=b.oScroll;if(""===e.sX&&""===
e.sY)return b.nTable;var d=e.sX,f=e.sY,g=b.oClasses,p=c.children("caption"),k=p.length?p[0]._captionSide:null,l=a(c[0].cloneNode(!1)),m=a(c[0].cloneNode(!1)),n=c.children("tfoot");n.length||(n=null);l=a("<div/>",{"class":g.sScrollWrapper}).append(a("<div/>",{"class":g.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:d?d?X(d):null:"100%"}).append(a("<div/>",{"class":g.sScrollHeadInner}).css({"box-sizing":"content-box",width:e.sXInner||"100%"}).append(l.removeAttr("id").css("margin-left",
0).append("top"===k?p:null).append(c.children("thead"))))).append(a("<div/>",{"class":g.sScrollBody}).css({position:"relative",overflow:"auto",width:d?X(d):null}).append(c));n&&l.append(a("<div/>",{"class":g.sScrollFoot}).css({overflow:"hidden",border:0,width:d?d?X(d):null:"100%"}).append(a("<div/>",{"class":g.sScrollFootInner}).append(m.removeAttr("id").css("margin-left",0).append("bottom"===k?p:null).append(c.children("tfoot")))));var c=l.children(),h=c[0],g=c[1],w=n?c[2]:null;if(d)a(g).on("scroll.DT",
function(){var a=this.scrollLeft;h.scrollLeft=a;n&&(w.scrollLeft=a)});a(g).css(f&&e.bCollapse?"max-height":"height",f);b.nScrollHead=h;b.nScrollBody=g;b.nScrollFoot=w;b.aoDrawCallback.push({fn:ua,sName:"scrolling"});return l[0]}function ua(b){var c=b.oScroll,e=c.sX,f=c.sXInner,g=c.sY,c=c.iBarWidth,p=a(b.nScrollHead),k=p[0].style,l=p.children("div"),m=l[0].style,n=l.children("table"),l=b.nScrollBody,h=a(l),w=l.style,x=a(b.nScrollFoot).children("div"),u=x.children("table"),r=a(b.nTHead),q=a(b.nTable),
J=q[0],D=J.style,y=b.nTFoot?a(b.nTFoot):null,R=b.oBrowser,T=R.bScrollOversize,F,P,C,N,H=[],z=[],M=[],Q,L=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};P=l.scrollHeight>l.clientHeight;b.scrollBarVis!==P&&b.scrollBarVis!==d?(b.scrollBarVis=P,t(b)):(b.scrollBarVis=P,q.children("thead, tfoot").remove(),N=r.clone().prependTo(q),r=r.find("tr"),P=N.find("tr"),N.find("th, td").removeAttr("tabindex"),y&&(C=y.clone().prependTo(q),F=y.find("tr"),
C=C.find("tr")),e||(w.width="100%",p[0].style.width="100%"),a.each(da(b,N),function(a,c){Q=v(b,a);c.style.width=b.aoColumns[Q].sWidth}),y&&ka(function(a){a.style.width=""},C),p=q.outerWidth(),""===e?(D.width="100%",T&&(q.find("tbody").height()>l.offsetHeight||"scroll"==h.css("overflow-y"))&&(D.width=X(q.outerWidth()-c)),p=q.outerWidth()):""!==f&&(D.width=X(f),p=q.outerWidth()),ka(L,P),ka(function(b){M.push(b.innerHTML);H.push(X(a(b).css("width")))},P),ka(function(a,b){a.style.width=H[b]},r),a(P).height(0),
y&&(ka(L,C),ka(function(b){z.push(X(a(b).css("width")))},C),ka(function(a,b){a.style.width=z[b]},F),a(C).height(0)),ka(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+M[b]+"</div>";a.style.width=H[b]},P),y&&ka(function(a,b){a.innerHTML="";a.style.width=z[b]},C),q.outerWidth()<p?(F=l.scrollHeight>l.offsetHeight||"scroll"==h.css("overflow-y")?p+c:p,T&&(l.scrollHeight>l.offsetHeight||"scroll"==h.css("overflow-y"))&&(D.width=X(F-c)),""!==e&&""===f||la(b,1,
"Possible column misalignment",6)):F="100%",w.width=X(F),k.width=X(F),y&&(b.nScrollFoot.style.width=X(F)),!g&&T&&(w.height=X(J.offsetHeight+c)),e=q.outerWidth(),n[0].style.width=X(e),m.width=X(e),f=q.height()>l.clientHeight||"scroll"==h.css("overflow-y"),g="padding"+(R.bScrollbarLeft?"Left":"Right"),m[g]=f?c+"px":"0px",y&&(u[0].style.width=X(e),x[0].style.width=X(e),x[0].style[g]=f?c+"px":"0px"),h.scroll(),!b.bSorted&&!b.bFiltered||b._drawHold||(l.scrollTop=0))}function ka(a,b,c){for(var e=0,d=0,
f=b.length,g,p;d<f;){g=b[d].firstChild;for(p=c?c[d].firstChild:null;g;)1===g.nodeType&&(c?a(g,p,e):a(g,e),e++),g=g.nextSibling,p=c?p.nextSibling:null;d++}}function Qa(b){var c=b.nTable,e=b.aoColumns,d=b.oScroll,f=d.sY,g=d.sX,p=d.sXInner,k=e.length,l=z(b,"bVisible"),n=a("th",b.nTHead),w=c.getAttribute("width"),x=c.parentNode,u=!1,r,q,J=b.oBrowser,d=J.bScrollOversize;(r=c.style.width)&&-1!==r.indexOf("%")&&(w=r);for(r=0;r<l.length;r++)q=e[l[r]],null!==q.sWidth&&(q.sWidth=sb(q.sWidthOrig,x),u=!0);if(d||
!u&&!g&&!f&&k==m(b)&&k==n.length)for(r=0;r<k;r++)l=v(b,r),null!==l&&(e[l].sWidth=X(n.eq(r).width()));else{k=a(c).clone().css("visibility","hidden").removeAttr("id");k.find("tbody tr").remove();var D=a("<tr/>").appendTo(k.find("tbody"));k.find("thead, tfoot").remove();k.append(a(b.nTHead).clone()).append(a(b.nTFoot).clone());k.find("tfoot th, tfoot td").css("width","");n=da(b,k.find("thead")[0]);for(r=0;r<l.length;r++)q=e[l[r]],n[r].style.width=null!==q.sWidthOrig&&""!==q.sWidthOrig?X(q.sWidthOrig):
"",q.sWidthOrig&&g&&a(n[r]).append(a("<div/>").css({width:q.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(b.aoData.length)for(r=0;r<l.length;r++)u=l[r],q=e[u],a(tb(b,u)).clone(!1).append(q.sContentPadding).appendTo(D);q=a("<div/>").css(g||f?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(k).appendTo(x);g&&p?k.width(p):g?(k.css("width","auto"),k.removeAttr("width"),k.width()<x.clientWidth&&w&&k.width(x.clientWidth)):f?k.width(x.clientWidth):w&&k.width(w);for(r=
f=0;r<l.length;r++)x=a(n[r]),p=x.outerWidth()-x.width(),x=J.bBounding?Math.ceil(n[r].getBoundingClientRect().width):x.outerWidth(),f+=x,e[l[r]].sWidth=X(x-p);c.style.width=X(f);q.remove()}w&&(c.style.width=X(w));!w&&!g||b._reszEvt||(c=function(){a(h).bind("resize.DT-"+b.sInstance,Da(function(){t(b)}))},d?setTimeout(c,1E3):c(),b._reszEvt=!0)}function Da(a,b){var c=b!==d?b:200,e,f;return function(){var b=this,g=+new Date,p=arguments;e&&g<e+c?(clearTimeout(f),f=setTimeout(function(){e=d;a.apply(b,p)},
c)):(e=g,a.apply(b,p))}}function sb(b,e){if(!b)return 0;var d=a("<div/>").css("width",X(b)).appendTo(e||c.body),f=d[0].offsetWidth;d.remove();return f}function tb(b,c){var e=ub(b,c);if(0>e)return null;var d=b.aoData[e];return d.nTr?d.anCells[c]:a("<td/>").html(B(b,e,c,"display"))[0]}function ub(a,b){for(var c,e=-1,d=-1,f=0,g=a.aoData.length;f<g;f++)c=B(a,f,b,"display")+"",c=c.replace(Nb,""),c=c.replace(/&nbsp;/g," "),c.length>e&&(e=c.length,d=f);return d}function X(a){return null===a?"0px":"number"==
typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function ra(b){var c,e,f=[],g=b.aoColumns,p,k,l,m;c=b.aaSortingFixed;e=a.isPlainObject(c);var n=[];p=function(b){b.length&&!a.isArray(b[0])?n.push(b):a.merge(n,b)};a.isArray(c)&&p(c);e&&c.pre&&p(c.pre);p(b.aaSorting);e&&c.post&&p(c.post);for(b=0;b<n.length;b++)for(m=n[b][0],p=g[m].aDataSort,c=0,e=p.length;c<e;c++)k=p[c],l=g[k].sType||"string",n[b]._idx===d&&(n[b]._idx=a.inArray(n[b][1],g[k].asSorting)),f.push({src:m,col:k,dir:n[b][1],index:n[b]._idx,
type:l,formatter:A.ext.type.order[l+"-pre"]});return f}function gb(a){var b,c,e=[],d=A.ext.type.order,f=a.aoData,g=0,p,k=a.aiDisplayMaster,l;G(a);l=ra(a);b=0;for(c=l.length;b<c;b++)p=l[b],p.formatter&&g++,vb(a,p.col);if("ssp"!=ca(a)&&0!==l.length){b=0;for(c=k.length;b<c;b++)e[k[b]]=b;g===l.length?k.sort(function(a,b){var c,d,g,p,k=l.length,m=f[a]._aSortData,n=f[b]._aSortData;for(g=0;g<k;g++)if(p=l[g],c=m[p.col],d=n[p.col],c=c<d?-1:c>d?1:0,0!==c)return"asc"===p.dir?c:-c;c=e[a];d=e[b];return c<d?-1:
c>d?1:0}):k.sort(function(a,b){var c,g,p,k,m=l.length,n=f[a]._aSortData,h=f[b]._aSortData;for(p=0;p<m;p++)if(k=l[p],c=n[k.col],g=h[k.col],k=d[k.type+"-"+k.dir]||d["string-"+k.dir],c=k(c,g),0!==c)return c;c=e[a];g=e[b];return c<g?-1:c>g?1:0})}a.bSorted=!0}function wb(a){var b,c,e=a.aoColumns,d=ra(a);a=a.oLanguage.oAria;for(var f=0,g=e.length;f<g;f++){c=e[f];var p=c.asSorting;b=c.sTitle.replace(/<.*?>/g,"");var k=c.nTh;k.removeAttribute("aria-sort");c.bSortable&&(0<d.length&&d[0].col==f?(k.setAttribute("aria-sort",
"asc"==d[0].dir?"ascending":"descending"),c=p[d[0].index+1]||p[0]):c=p[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);k.setAttribute("aria-label",b)}}function Xa(b,c,e,f){var g=b.aaSorting,p=b.aoColumns[c].asSorting,k=function(b,c){var e=b._idx;e===d&&(e=a.inArray(b[1],p));return e+1<p.length?e+1:c?null:0};"number"===typeof g[0]&&(g=b.aaSorting=[g]);e&&b.oFeatures.bSortMulti?(e=a.inArray(c,ha(g,"0")),-1!==e?(c=k(g[e],!0),null===c&&1===g.length&&(c=0),null===c?g.splice(e,1):(g[e][1]=p[c],g[e]._idx=
c)):(g.push([c,p[0],0]),g[g.length-1]._idx=0)):g.length&&g[0][0]==c?(c=k(g[0]),g.length=1,g[0][1]=p[c],g[0]._idx=c):(g.length=0,g.push([c,p[0]]),g[0]._idx=0);y(b);"function"==typeof f&&f(b)}function Ra(a,b,c,e){var d=a.aoColumns[c];Ya(b,{},function(b){!1!==d.bSortable&&(a.oFeatures.bProcessing?(ga(a,!0),setTimeout(function(){Xa(a,c,b.shiftKey,e);"ssp"!==ca(a)&&ga(a,!1)},0)):Xa(a,c,b.shiftKey,e))})}function Ia(b){var c=b.aLastSort,e=b.oClasses.sSortColumn,d=ra(b),f=b.oFeatures,g,p;if(f.bSort&&f.bSortClasses){f=
0;for(g=c.length;f<g;f++)p=c[f].src,a(ha(b.aoData,"anCells",p)).removeClass(e+(2>f?f+1:3));f=0;for(g=d.length;f<g;f++)p=d[f].src,a(ha(b.aoData,"anCells",p)).addClass(e+(2>f?f+1:3))}b.aLastSort=d}function vb(a,b){var c=a.aoColumns[b],e=A.ext.order[c.sSortDataType],d;e&&(d=e.call(a.oInstance,a,b,r(a,b)));for(var f,g=A.ext.type.order[c.sType+"-pre"],p=0,k=a.aoData.length;p<k;p++)if(c=a.aoData[p],c._aSortData||(c._aSortData=[]),!c._aSortData[b]||e)f=e?d[p]:B(a,p,b,"sort"),c._aSortData[b]=g?g(f):f}function Ja(b){if(b.oFeatures.bStateSave&&
!b.bDestroying){var c={time:+new Date,start:b._iDisplayStart,length:b._iDisplayLength,order:a.extend(!0,[],b.aaSorting),search:ob(b.oPreviousSearch),columns:a.map(b.aoColumns,function(a,c){return{visible:a.bVisible,search:ob(b.aoPreSearchCols[c])}})};U(b,"aoStateSaveParams","stateSaveParams",[b,c]);b.oSavedState=c;b.fnStateSaveCallback.call(b.oInstance,b,c)}}function xb(b){var c,e,f=b.aoColumns;if(b.oFeatures.bStateSave){var g=b.fnStateLoadCallback.call(b.oInstance,b);if(g&&g.time&&(c=U(b,"aoStateLoadParams",
"stateLoadParams",[b,g]),-1===a.inArray(!1,c)&&(c=b.iStateDuration,!(0<c&&g.time<+new Date-1E3*c)&&f.length===g.columns.length))){b.oLoadedState=a.extend(!0,{},g);g.start!==d&&(b._iDisplayStart=g.start,b.iInitDisplayStart=g.start);g.length!==d&&(b._iDisplayLength=g.length);g.order!==d&&(b.aaSorting=[],a.each(g.order,function(a,c){b.aaSorting.push(c[0]>=f.length?[0,c[1]]:c)}));g.search!==d&&a.extend(b.oPreviousSearch,pb(g.search));c=0;for(e=g.columns.length;c<e;c++){var p=g.columns[c];p.visible!==
d&&(f[c].bVisible=p.visible);p.search!==d&&a.extend(b.aoPreSearchCols[c],pb(p.search))}U(b,"aoStateLoaded","stateLoaded",[b,g])}}}function Ka(b){var c=A.settings;b=a.inArray(b,ha(c,"nTable"));return-1!==b?c[b]:null}function la(a,b,c,e){c="DataTables warning: "+(a?"table id="+a.sTableId+" - ":"")+c;e&&(c+=". For more information about this error, please see http://datatables.net/tn/"+e);if(b)h.console&&console.log&&console.log(c);else if(b=A.ext,b=b.sErrMode||b.errMode,a&&U(a,null,"error",[a,e,c]),
"alert"==b)alert(c);else{if("throw"==b)throw Error(c);"function"==typeof b&&b(a,e,c)}}function ia(b,c,e,f){a.isArray(e)?a.each(e,function(e,d){a.isArray(d)?ia(b,c,d[0],d[1]):ia(b,c,d)}):(f===d&&(f=e),c[e]!==d&&(b[f]=c[e]))}function yb(b,c,e){var d,f;for(f in c)c.hasOwnProperty(f)&&(d=c[f],a.isPlainObject(d)?(a.isPlainObject(b[f])||(b[f]={}),a.extend(!0,b[f],d)):b[f]=e&&"data"!==f&&"aaData"!==f&&a.isArray(d)?d.slice():d);return b}function Ya(b,c,e){a(b).bind("click.DT",c,function(a){b.blur();e(a)}).bind("keypress.DT",
c,function(a){13===a.which&&(a.preventDefault(),e(a))}).bind("selectstart.DT",function(){return!1})}function ea(a,b,c,e){c&&a[b].push({fn:c,sName:e})}function U(b,c,e,d){var f=[];c&&(f=a.map(b[c].slice().reverse(),function(a){return a.fn.apply(b.oInstance,d)}));null!==e&&(c=a.Event(e+".dt"),a(b.nTable).trigger(c,d),f.push(c.result));return f}function Va(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),e=a._iDisplayLength;b>=c&&(b=c-e);b-=b%e;if(-1===e||0>b)b=0;a._iDisplayStart=b}function Sa(b,c){var e=
b.renderer,d=A.ext.renderer[c];return a.isPlainObject(e)&&e[c]?d[e[c]]||d._:"string"===typeof e?d[e]||d._:d._}function ca(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function La(a,b){var c=[],c=zb.numbers_length,e=Math.floor(c/2);b<=c?c=ta(0,b):a<=e?(c=ta(0,c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-e?c=ta(b-(c-2),b):(c=ta(a-e+2,a+e-1),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function fb(b){a.each({num:function(a){return Ma(a,
b)},"num-fmt":function(a){return Ma(a,b,Za)},"html-num":function(a){return Ma(a,b,Na)},"html-num-fmt":function(a){return Ma(a,b,Na,Za)}},function(a,c){Z.type.order[a+b+"-pre"]=c;a.match(/^html\-/)&&(Z.type.search[a+b]=Z.type.search.html)})}function Ab(a){return function(){var b=[Ka(this[A.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return A.ext.internal[a].apply(this,b)}}var A,Z,S,K,V,$a={},Bb=/[\r\n]/g,Na=/<.*?>/g,Ob=/^[\w\+\-]/,Pb=/[\w\+\-]$/,Lb=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)",
"g"),Za=/[',$\u00a3\u20ac\u00a5%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,ma=function(a){return a&&!0!==a&&"-"!==a?!1:!0},Cb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Db=function(a,b){$a[b]||($a[b]=RegExp(Ga(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace($a[b],"."):a},ab=function(a,b,c){var e="string"===typeof a;if(ma(a))return!0;b&&e&&(a=Db(a,b));c&&e&&(a=a.replace(Za,""));return!isNaN(parseFloat(a))&&isFinite(a)},Eb=function(a,b,c){return ma(a)?!0:
ma(a)||"string"===typeof a?ab(a.replace(Na,""),b,c)?!0:null:null},ha=function(a,b,c){var e=[],f=0,g=a.length;if(c!==d)for(;f<g;f++)a[f]&&a[f][b]&&e.push(a[f][b][c]);else for(;f<g;f++)a[f]&&e.push(a[f][b]);return e},xa=function(a,b,c,e){var f=[],g=0,p=b.length;if(e!==d)for(;g<p;g++)a[b[g]][c]&&f.push(a[b[g]][c][e]);else for(;g<p;g++)f.push(a[b[g]][c]);return f},ta=function(a,b){var c=[],e;b===d?(b=0,e=a):(e=b,b=a);for(var f=b;f<e;f++)c.push(f);return c},Fb=function(a){for(var b=[],c=0,e=a.length;c<
e;c++)a[c]&&b.push(a[c]);return b},za=function(a){var b=[],c,e,d=a.length,f,g=0;e=0;a:for(;e<d;e++){c=a[e];for(f=0;f<g;f++)if(b[f]===c)continue a;b.push(c);g++}return b},fa=function(a,b,c){a[b]!==d&&(a[c]=a[b])},va=/\[.*?\]$/,pa=/\(\)$/,Ha=a("<div>")[0],Mb=Ha.textContent!==d,Nb=/<.*?>/g;A=function(b){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new S(Ka(this[Z.iApiIndex])):new S(this)};this.fnAddData=function(b,
c){var e=this.api(!0),f=a.isArray(b)&&(a.isArray(b[0])||a.isPlainObject(b[0]))?e.rows.add(b):e.row.add(b);(c===d||c)&&e.draw();return f.flatten().toArray()};this.fnAdjustColumnSizing=function(a){var b=this.api(!0).columns.adjust(),c=b.settings()[0],e=c.oScroll;a===d||a?b.draw(!1):(""!==e.sX||""!==e.sY)&&ua(c)};this.fnClearTable=function(a){var b=this.api(!0).clear();(a===d||a)&&b.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,b,c){var e=this.api(!0);
a=e.rows(a);var f=a.settings()[0],g=f.aoData[a[0][0]];a.remove();b&&b.call(this,f,g);(c===d||c)&&e.draw();return g};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(a)};this.fnFilter=function(a,b,c,e,f,g){f=this.api(!0);null===b||b===d?f.search(a,c,e,g):f.column(b).search(a,c,e,g);f.draw()};this.fnGetData=function(a,b){var c=this.api(!0);if(a!==d){var e=a.nodeName?a.nodeName.toLowerCase():"";return b!==d||"td"==e||"th"==e?c.cell(a,b).data():c.row(a).data()||
null}return c.data().toArray()};this.fnGetNodes=function(a){var b=this.api(!0);return a!==d?b.row(a).node():b.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=
function(a,b){var c=this.api(!0).page(a);(b===d||b)&&c.draw(!1)};this.fnSetColumnVis=function(a,b,c){a=this.api(!0).column(a).visible(b);(c===d||c)&&a.columns.adjust().draw()};this.fnSettings=function(){return Ka(this[Z.iApiIndex])};this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,b,c,e,f){var g=this.api(!0);c===d||null===c?g.row(b).data(a):g.cell(b,c).data(a);(f===d||f)&&g.columns.adjust();(e===
d||e)&&g.draw();return 0};this.fnVersionCheck=Z.fnVersionCheck;var c=this,p=b===d,m=this.length;p&&(b={});this.oApi=this.internal=Z.internal;for(var h in A.ext.internal)h&&(this[h]=Ab(h));this.each(function(){var h={},h=1<m?yb(h,b,!0):b,w=0,x,t=this.getAttribute("id"),r=!1,q=A.defaults,J=a(this);if("table"!=this.nodeName.toLowerCase())la(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{k(q);e(q.column);f(q,q,!0);f(q.column,q.column,!0);f(q,a.extend(h,J.data()));var v=A.settings,
w=0;for(x=v.length;w<x;w++){var D=v[w];if(D.nTable==this||D.nTHead.parentNode==this||D.nTFoot&&D.nTFoot.parentNode==this){w=h.bRetrieve!==d?h.bRetrieve:q.bRetrieve;if(p||w)return D.oInstance;if(h.bDestroy!==d?h.bDestroy:q.bDestroy){D.oInstance.fnDestroy();break}else{la(D,0,"Cannot reinitialise DataTable",3);return}}if(D.sTableId==this.id){v.splice(w,1);break}}if(null===t||""===t)this.id=t="DataTables_Table_"+A.ext._unique++;var y=a.extend(!0,{},A.models.oSettings,{sDestroyWidth:J[0].style.width,sInstance:t,
sTableId:t});y.nTable=this;y.oApi=c.internal;y.oInit=h;v.push(y);y.oInstance=1===c.length?c:J.dataTable();k(h);h.oLanguage&&l(h.oLanguage);h.aLengthMenu&&!h.iDisplayLength&&(h.iDisplayLength=a.isArray(h.aLengthMenu[0])?h.aLengthMenu[0][0]:h.aLengthMenu[0]);h=yb(a.extend(!0,{},q),h);ia(y.oFeatures,h,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));ia(y,h,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod",
"aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);ia(y.oScroll,h,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);ia(y.oLanguage,
h,"fnInfoCallback");ea(y,"aoDrawCallback",h.fnDrawCallback,"user");ea(y,"aoServerParams",h.fnServerParams,"user");ea(y,"aoStateSaveParams",h.fnStateSaveParams,"user");ea(y,"aoStateLoadParams",h.fnStateLoadParams,"user");ea(y,"aoStateLoaded",h.fnStateLoaded,"user");ea(y,"aoRowCallback",h.fnRowCallback,"user");ea(y,"aoRowCreatedCallback",h.fnCreatedRow,"user");ea(y,"aoHeaderCallback",h.fnHeaderCallback,"user");ea(y,"aoFooterCallback",h.fnFooterCallback,"user");ea(y,"aoInitComplete",h.fnInitComplete,
"user");ea(y,"aoPreDrawCallback",h.fnPreDrawCallback,"user");y.rowIdFn=Q(h.rowId);u(y);t=y.oClasses;h.bJQueryUI?(a.extend(t,A.ext.oJUIClasses,h.oClasses),h.sDom===q.sDom&&"lfrtip"===q.sDom&&(y.sDom='<"H"lfr>t<"F"ip>'),y.renderer)?a.isPlainObject(y.renderer)&&!y.renderer.header&&(y.renderer.header="jqueryui"):y.renderer="jqueryui":a.extend(t,A.ext.classes,h.oClasses);J.addClass(t.sTable);y.iInitDisplayStart===d&&(y.iInitDisplayStart=h.iDisplayStart,y._iDisplayStart=h.iDisplayStart);null!==h.iDeferLoading&&
(y.bDeferLoading=!0,w=a.isArray(h.iDeferLoading),y._iRecordsDisplay=w?h.iDeferLoading[0]:h.iDeferLoading,y._iRecordsTotal=w?h.iDeferLoading[1]:h.iDeferLoading);var R=y.oLanguage;a.extend(!0,R,h.oLanguage);""!==R.sUrl&&(a.ajax({dataType:"json",url:R.sUrl,success:function(b){l(b);f(q.oLanguage,b);a.extend(!0,R,b);wa(y)},error:function(){wa(y)}}),r=!0);null===h.asStripeClasses&&(y.asStripeClasses=[t.sStripeOdd,t.sStripeEven]);var w=y.asStripeClasses,T=J.children("tbody").find("tr").eq(0);-1!==a.inArray(!0,
a.map(w,function(a){return T.hasClass(a)}))&&(a("tbody tr",this).removeClass(w.join(" ")),y.asDestroyStripes=w.slice());v=[];w=this.getElementsByTagName("thead");0!==w.length&&(ba(y.aoHeader,w[0]),v=da(y));if(null===h.aoColumns)for(D=[],w=0,x=v.length;w<x;w++)D.push(null);else D=h.aoColumns;w=0;for(x=D.length;w<x;w++)g(y,v?v[w]:null);M(y,h.aoColumnDefs,D,function(a,b){n(y,a,b)});if(T.length){var F=function(a,b){return null!==a.getAttribute("data-"+b)?b:null};a(T[0]).children("th, td").each(function(a,
b){var c=y.aoColumns[a];if(c.mData===a){var e=F(b,"sort")||F(b,"order"),f=F(b,"filter")||F(b,"search");if(null!==e||null!==f)c.mData={_:a+".display",sort:null!==e?a+".@data-"+e:d,type:null!==e?a+".@data-"+e:d,filter:null!==f?a+".@data-"+f:d},n(y,a)}})}var P=y.oFeatures;h.bStateSave&&(P.bStateSave=!0,xb(y,h),ea(y,"aoDrawCallback",Ja,"state_save"));if(h.aaSorting===d)for(v=y.aaSorting,w=0,x=v.length;w<x;w++)v[w][1]=y.aoColumns[w].asSorting[0];Ia(y);P.bSort&&ea(y,"aoDrawCallback",function(){if(y.bSorted){var b=
ra(y),c={};a.each(b,function(a,b){c[b.src]=b.dir});U(y,null,"order",[y,b,c]);wb(y)}});ea(y,"aoDrawCallback",function(){(y.bSorted||"ssp"===ca(y)||P.bDeferRender)&&Ia(y)},"sc");w=J.children("caption").each(function(){this._captionSide=J.css("caption-side")});x=J.children("thead");0===x.length&&(x=a("<thead/>").appendTo(this));y.nTHead=x[0];x=J.children("tbody");0===x.length&&(x=a("<tbody/>").appendTo(this));y.nTBody=x[0];x=J.children("tfoot");0===x.length&&0<w.length&&(""!==y.oScroll.sX||""!==y.oScroll.sY)&&
(x=a("<tfoot/>").appendTo(this));0===x.length||0===x.children().length?J.addClass(t.sNoFooter):0<x.length&&(y.nTFoot=x[0],ba(y.aoFooter,y.nTFoot));if(h.aaData)for(w=0;w<h.aaData.length;w++)C(y,h.aaData[w]);else(y.bDeferLoading||"dom"==ca(y))&&E(y,a(y.nTBody).children("tr"));y.aiDisplay=y.aiDisplayMaster.slice();y.bInitialised=!0;!1===r&&wa(y)}});c=null;return this};var Gb=[],aa=Array.prototype,Qb=function(b){var c,e,f=A.settings,d=a.map(f,function(a){return a.nTable});if(b){if(b.nTable&&b.oApi)return[b];
if(b.nodeName&&"table"===b.nodeName.toLowerCase())return c=a.inArray(b,d),-1!==c?[f[c]]:null;if(b&&"function"===typeof b.settings)return b.settings().toArray();"string"===typeof b?e=a(b):b instanceof a&&(e=b)}else return[];if(e)return e.map(function(){c=a.inArray(this,d);return-1!==c?f[c]:null}).toArray()};S=function(b,c){if(!(this instanceof S))return new S(b,c);var e=[],f=function(a){(a=Qb(a))&&(e=e.concat(a))};if(a.isArray(b))for(var d=0,g=b.length;d<g;d++)f(b[d]);else f(b);this.context=za(e);
c&&a.merge(this,c);this.selector={rows:null,cols:null,opts:null};S.extend(this,this,Gb)};A.Api=S;a.extend(S.prototype,{any:function(){return 0!==this.count()},concat:aa.concat,context:[],count:function(){return this.flatten().length},each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new S(b[a],this[a]):null},filter:function(a){var b=[];if(aa.filter)b=aa.filter.call(this,a,this);else for(var c=0,e=this.length;c<
e;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new S(this.context,b)},flatten:function(){var a=[];return new S(this.context,a.concat.apply(a,this.toArray()))},join:aa.join,indexOf:aa.indexOf||function(a,b){for(var c=b||0,e=this.length;c<e;c++)if(this[c]===a)return c;return-1},iterator:function(a,b,c,e){var f=[],g,p,k,l,m,n=this.context,h,w,x=this.selector;"string"===typeof a&&(e=c,c=b,b=a,a=!1);p=0;for(k=n.length;p<k;p++){var t=new S(n[p]);if("table"===b)g=c.call(t,n[p],p),g!==d&&f.push(g);
else if("columns"===b||"rows"===b)g=c.call(t,n[p],this[p],p),g!==d&&f.push(g);else if("column"===b||"column-rows"===b||"row"===b||"cell"===b)for(w=this[p],"column-rows"===b&&(h=Oa(n[p],x.opts)),l=0,m=w.length;l<m;l++)g=w[l],g="cell"===b?c.call(t,n[p],g.row,g.column,p,l):c.call(t,n[p],g,p,l,h),g!==d&&f.push(g)}return f.length||e?(a=new S(n,a?f.concat.apply([],f):f),b=a.selector,b.rows=x.rows,b.cols=x.cols,b.opts=x.opts,a):this},lastIndexOf:aa.lastIndexOf||function(a,b){return this.indexOf.apply(this.toArray.reverse(),
arguments)},length:0,map:function(a){var b=[];if(aa.map)b=aa.map.call(this,a,this);else for(var c=0,e=this.length;c<e;c++)b.push(a.call(this,this[c],c));return new S(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},pop:aa.pop,push:aa.push,reduce:aa.reduce||function(a,b){return q(this,a,b,0,this.length,1)},reduceRight:aa.reduceRight||function(a,b){return q(this,a,b,this.length-1,-1,-1)},reverse:aa.reverse,selector:null,shift:aa.shift,sort:aa.sort,splice:aa.splice,toArray:function(){return aa.slice.call(this)},
to$:function(){return a(this)},toJQuery:function(){return a(this)},unique:function(){return new S(this.context,za(this))},unshift:aa.unshift});S.extend=function(b,c,e){if(e.length&&c&&(c instanceof S||c.__dt_wrapper)){var f,d,g,p=function(a,b,c){return function(){var e=b.apply(a,arguments);S.extend(e,e,c.methodExt);return e}};f=0;for(d=e.length;f<d;f++)g=e[f],c[g.name]="function"===typeof g.val?p(b,g.val,g):a.isPlainObject(g.val)?{}:g.val,c[g.name].__dt_wrapper=!0,S.extend(b,c[g.name],g.propExt)}};
S.register=K=function(b,c){if(a.isArray(b))for(var e=0,f=b.length;e<f;e++)S.register(b[e],c);else for(var d=b.split("."),g=Gb,p,k,e=0,f=d.length;e<f;e++){p=(k=-1!==d[e].indexOf("()"))?d[e].replace("()",""):d[e];var l;a:{l=0;for(var m=g.length;l<m;l++)if(g[l].name===p){l=g[l];break a}l=null}l||(l={name:p,val:{},methodExt:[],propExt:[]},g.push(l));e===f-1?l.val=c:g=k?l.methodExt:l.propExt}};S.registerPlural=V=function(b,c,e){S.register(b,e);S.register(c,function(){var b=e.apply(this,arguments);return b===
this?this:b instanceof S?b.length?a.isArray(b[0])?new S(b.context,b[0]):b[0]:d:b})};K("tables()",function(b){var c;if(b){c=S;var e=this.context;if("number"===typeof b)b=[e[b]];else{var f=a.map(e,function(a){return a.nTable});b=a(f).filter(b).map(function(){var b=a.inArray(this,f);return e[b]}).toArray()}c=new c(b)}else c=this;return c});K("table()",function(a){a=this.tables(a);var b=a.context;return b.length?new S(b[0]):a});V("tables().nodes()","table().node()",function(){return this.iterator("table",
function(a){return a.nTable},1)});V("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});V("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});V("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});V("tables().containers()","table().container()",function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});
K("draw()",function(a){return this.iterator("table",function(b){"page"===a?R(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),y(b,!1===a))})});K("page()",function(a){return a===d?this.page.info().page:this.iterator("table",function(b){Wa(b,a)})});K("page.info()",function(){if(0===this.context.length)return d;var a=this.context[0],b=a._iDisplayStart,c=a.oFeatures.bPaginate?a._iDisplayLength:-1,e=a.fnRecordsDisplay(),f=-1===c;return{page:f?0:Math.floor(b/c),pages:f?1:Math.ceil(e/c),start:b,end:a.fnDisplayEnd(),
length:c,recordsTotal:a.fnRecordsTotal(),recordsDisplay:e,serverSide:"ssp"===ca(a)}});K("page.len()",function(a){return a===d?0!==this.context.length?this.context[0]._iDisplayLength:d:this.iterator("table",function(b){Ua(b,a)})});var Hb=function(a,b,c){if(c){var e=new S(a);e.one("draw",function(){c(e.ajax.json())})}if("ssp"==ca(a))y(a,b);else{ga(a,!0);var f=a.jqXHR;f&&4!==f.readyState&&f.abort();W(a,[],function(c){L(a);c=sa(a,c);for(var e=0,f=c.length;e<f;e++)C(a,c[e]);y(a,b);ga(a,!1)})}};K("ajax.json()",
function(){var a=this.context;if(0<a.length)return a[0].json});K("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});K("ajax.reload()",function(a,b){return this.iterator("table",function(c){Hb(c,!1===b,a)})});K("ajax.url()",function(b){var c=this.context;if(b===d){if(0===c.length)return d;c=c[0];return c.ajax?a.isPlainObject(c.ajax)?c.ajax.url:c.ajax:c.sAjaxSource}return this.iterator("table",function(c){a.isPlainObject(c.ajax)?c.ajax.url=b:c.ajax=b})});K("ajax.url().load()",
function(a,b){return this.iterator("table",function(c){Hb(c,!1===b,a)})});var bb=function(b,c,e,f,g){var p=[],k,l,m,n,h,w;m=typeof c;c&&"string"!==m&&"function"!==m&&c.length!==d||(c=[c]);m=0;for(n=c.length;m<n;m++)for(l=c[m]&&c[m].split?c[m].split(","):[c[m]],h=0,w=l.length;h<w;h++)(k=e("string"===typeof l[h]?a.trim(l[h]):l[h]))&&k.length&&(p=p.concat(k));b=Z.selector[b];if(b.length)for(m=0,n=b.length;m<n;m++)p=b[m](f,g,p);return za(p)},cb=function(b){b||(b={});b.filter&&b.search===d&&(b.search=
b.filter);return a.extend({search:"none",order:"current",page:"all"},b)},db=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Oa=function(b,c){var e,f,d,g=[],p=b.aiDisplay;e=b.aiDisplayMaster;var k=c.search;f=c.order;d=c.page;if("ssp"==ca(b))return"removed"===k?[]:ta(0,e.length);if("current"==d)for(e=b._iDisplayStart,f=b.fnDisplayEnd();e<f;e++)g.push(p[e]);else if("current"==f||"applied"==f)g="none"==
k?e.slice():"applied"==k?p.slice():a.map(e,function(b){return-1===a.inArray(b,p)?b:null});else if("index"==f||"original"==f)for(e=0,f=b.aoData.length;e<f;e++)"none"==k?g.push(e):(d=a.inArray(e,p),(-1===d&&"removed"==k||0<=d&&"applied"==k)&&g.push(e));return g};K("rows()",function(b,c){b===d?b="":a.isPlainObject(b)&&(c=b,b="");c=cb(c);var e=this.iterator("table",function(e){var f=c;return bb("row",b,function(b){var c=Cb(b);if(null!==c&&!f)return[c];var g=Oa(e,f);if(null!==c&&-1!==a.inArray(c,g))return[c];
if(!b)return g;if("function"===typeof b)return a.map(g,function(a){var c=e.aoData[a];return b(a,c._aData,c.nTr)?a:null});c=Fb(xa(e.aoData,g,"nTr"));return b.nodeName&&-1!==a.inArray(b,c)?[b._DT_RowIndex]:"string"===typeof b&&"#"===b.charAt(0)&&(g=e.aIds[b.replace(/^#/,"")],g!==d)?[g.idx]:a(c).filter(b).map(function(){return this._DT_RowIndex}).toArray()},e,f)},1);e.selector.rows=b;e.selector.opts=c;return e});K("rows().nodes()",function(){return this.iterator("row",function(a,b){return a.aoData[b].nTr||
d},1)});K("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return xa(a.aoData,b,"_aData")},1)});V("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var e=b.aoData[c];return"search"===a?e._aFilterData:e._aSortData},1)});V("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){O(b,c,a)})});V("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,b){return b},1)});V("rows().ids()",
"row().id()",function(a){for(var b=[],c=this.context,e=0,f=c.length;e<f;e++)for(var d=0,g=this[e].length;d<g;d++){var p=c[e].rowIdFn(c[e].aoData[this[e][d]]._aData);b.push((!0===a?"#":"")+p)}return new S(c,b)});V("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,c,e){var f=b.aoData,g=f[c],p,k,l,m,n;f.splice(c,1);p=0;for(k=f.length;p<k;p++)if(l=f[p],n=l.anCells,null!==l.nTr&&(l.nTr._DT_RowIndex=p),null!==n)for(l=0,m=n.length;l<m;l++)n[l]._DT_CellIndex.row=p;P(b.aiDisplayMaster,
c);P(b.aiDisplay,c);P(a[e],c,!1);Va(b);c=b.rowIdFn(g._aData);c!==d&&delete b.aIds[c]});this.iterator("table",function(a){for(var b=0,c=a.aoData.length;b<c;b++)a.aoData[b].idx=b});return this});K("rows.add()",function(b){var c=this.iterator("table",function(a){var c,e,f,d=[];e=0;for(f=b.length;e<f;e++)c=b[e],c.nodeName&&"TR"===c.nodeName.toUpperCase()?d.push(E(a,c)[0]):d.push(C(a,c));return d},1),e=this.rows(-1);e.pop();a.merge(e,c);return e});K("row()",function(a,b){return db(this.rows(a,b))});K("row().data()",
function(a){var b=this.context;if(a===d)return b.length&&this.length?b[0].aoData[this[0]]._aData:d;b[0].aoData[this[0]]._aData=a;O(b[0],this[0],"data");return this});K("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});K("row.add()",function(b){b instanceof a&&b.length&&(b=b[0]);var c=this.iterator("table",function(a){return b.nodeName&&"TR"===b.nodeName.toUpperCase()?E(a,b)[0]:C(a,b)});return this.row(c[0])});var eb=function(a,b){var c=
a.context;c.length&&(c=c[0].aoData[b!==d?b:a[0]])&&c._details&&(c._details.remove(),c._detailsShow=d,c._details=d)},Ib=function(a,b){var c=a.context;if(c.length&&a.length){var e=c[0].aoData[a[0]];if(e._details){(e._detailsShow=b)?e._details.insertAfter(e.nTr):e._details.detach();var f=c[0],d=new S(f),g=f.aoData;d.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<ha(g,"_details").length&&(d.on("draw.dt.DT_details",function(a,b){f===b&&d.rows({page:"current"}).eq(0).each(function(a){a=
g[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),d.on("column-visibility.dt.DT_details",function(a,b){if(f===b)for(var c,e=m(b),d=0,p=g.length;d<p;d++)c=g[d],c._details&&c._details.children("td[colspan]").attr("colspan",e)}),d.on("destroy.dt.DT_details",function(a,b){if(f===b)for(var c=0,e=g.length;c<e;c++)g[c]._details&&eb(d,c)}))}}};K("row().child()",function(b,c){var e=this.context;if(b===d)return e.length&&this.length?e[0].aoData[this[0]]._details:d;if(!0===b)this.child.show();else if(!1===
b)eb(this);else if(e.length&&this.length){var f=e[0],e=e[0].aoData[this[0]],g=[],p=function(b,c){if(a.isArray(b)||b instanceof a)for(var e=0,d=b.length;e<d;e++)p(b[e],c);else b.nodeName&&"tr"===b.nodeName.toLowerCase()?g.push(b):(e=a("<tr><td/></tr>").addClass(c),a("td",e).addClass(c).html(b)[0].colSpan=m(f),g.push(e[0]))};p(b,c);e._details&&e._details.remove();e._details=a(g);e._detailsShow&&e._details.insertAfter(e.nTr)}return this});K(["row().child.show()","row().child().show()"],function(){Ib(this,
!0);return this});K(["row().child.hide()","row().child().hide()"],function(){Ib(this,!1);return this});K(["row().child.remove()","row().child().remove()"],function(){eb(this);return this});K("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Rb=/^(.+):(name|visIdx|visible)$/,Jb=function(a,b,c,e,f){c=[];e=0;for(var d=f.length;e<d;e++)c.push(B(a,f[e],b));return c};K("columns()",function(b,c){b===d?b="":a.isPlainObject(b)&&
(c=b,b="");c=cb(c);var e=this.iterator("table",function(e){var f=b,d=c,g=e.aoColumns,p=ha(g,"sName"),k=ha(g,"nTh");return bb("column",f,function(b){var c=Cb(b);if(""===b)return ta(g.length);if(null!==c)return[0<=c?c:g.length+c];if("function"===typeof b){var f=Oa(e,d);return a.map(g,function(a,c){return b(c,Jb(e,c,0,0,f),k[c])?c:null})}var l="string"===typeof b?b.match(Rb):"";if(l)switch(l[2]){case "visIdx":case "visible":c=parseInt(l[1],10);if(0>c){var m=a.map(g,function(a,b){return a.bVisible?b:
null});return[m[m.length+c]]}return[v(e,c)];case "name":return a.map(p,function(a,b){return a===l[1]?b:null})}else return a(k).filter(b).map(function(){return a.inArray(this,k)}).toArray()},e,d)},1);e.selector.cols=b;e.selector.opts=c;return e});V("columns().header()","column().header()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});V("columns().footer()","column().footer()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},
1)});V("columns().data()","column().data()",function(){return this.iterator("column-rows",Jb,1)});V("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});V("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,e,f,d){return xa(b.aoData,d,"search"===a?"_aFilterData":"_aSortData",c)},1)});V("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,
b,c,e,f){return xa(a.aoData,f,"anCells",b)},1)});V("columns().visible()","column().visible()",function(b,c){return this.iterator("column",function(e,f){if(b===d)return e.aoColumns[f].bVisible;var g=e.aoColumns,p=g[f],k=e.aoData,l,m,n;if(b!==d&&p.bVisible!==b){if(b){var h=a.inArray(!0,ha(g,"bVisible"),f+1);l=0;for(m=k.length;l<m;l++)n=k[l].nTr,g=k[l].anCells,n&&n.insertBefore(g[f],g[h]||null)}else a(ha(e.aoData,"anCells",f)).detach();p.bVisible=b;T(e,e.aoHeader);T(e,e.aoFooter);if(c===d||c)t(e),(e.oScroll.sX||
e.oScroll.sY)&&ua(e);U(e,null,"column-visibility",[e,f,b,c]);Ja(e)}})});V("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?r(b,c):c},1)});K("columns.adjust()",function(){return this.iterator("table",function(a){t(a)},1)});K("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return v(c,b);if("fromData"===a||"toVisible"===a)return r(c,b)}});K("column()",function(a,b){return db(this.columns(a,
b))});K("cells()",function(b,c,e){a.isPlainObject(b)&&(b.row===d?(e=b,b=null):(e=c,c=null));a.isPlainObject(c)&&(e=c,c=null);if(null===c||c===d)return this.iterator("table",function(c){var f=b,g=cb(e),p=c.aoData,k=Oa(c,g),l=Fb(xa(p,k,"anCells")),m=a([].concat.apply([],l)),n,h=c.aoColumns.length,w,x,t,r,q,u;return bb("cell",f,function(b){var e="function"===typeof b;if(null===b||b===d||e){w=[];x=0;for(t=k.length;x<t;x++)for(n=k[x],r=0;r<h;r++)q={row:n,column:r},e?(u=p[n],b(q,B(c,n,r),u.anCells?u.anCells[r]:
null)&&w.push(q)):w.push(q);return w}return a.isPlainObject(b)?[b]:m.filter(b).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray()},c,g)});var f=this.columns(c,e),g=this.rows(b,e),p,k,l,m,n,h=this.iterator("table",function(a,b){p=[];k=0;for(l=g[b].length;k<l;k++)for(m=0,n=f[b].length;m<n;m++)p.push({row:g[b][k],column:f[b][m]});return p},1);a.extend(h.selector,{cols:c,rows:b,opts:e});return h});V("cells().nodes()","cell().node()",function(){return this.iterator("cell",
function(a,b,c){return(a=a.aoData[b].anCells)?a[c]:d},1)});K("cells().data()",function(){return this.iterator("cell",function(a,b,c){return B(a,b,c)},1)});V("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,e){return b.aoData[c][a][e]},1)});V("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,e){return B(b,c,e,a)},1)});V("cells().indexes()","cell().index()",function(){return this.iterator("cell",
function(a,b,c){return{row:b,column:c,columnVisible:r(a,c)}},1)});V("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,e){O(b,c,a,e)})});K("cell()",function(a,b,c){return db(this.cells(a,b,c))});K("cell().data()",function(a){var b=this.context,c=this[0];if(a===d)return b.length&&c.length?B(b[0],c[0].row,c[0].column):d;I(b[0],c[0].row,c[0].column,a);O(b[0],c[0].row,"data",c[0].column);return this});K("order()",function(b,c){var e=this.context;if(b===d)return 0!==
e.length?e[0].aaSorting:d;"number"===typeof b?b=[[b,c]]:a.isArray(b[0])||(b=Array.prototype.slice.call(arguments));return this.iterator("table",function(a){a.aaSorting=b.slice()})});K("order.listener()",function(a,b,c){return this.iterator("table",function(e){Ra(e,a,b,c)})});K("order.fixed()",function(b){if(!b){var c=this.context,c=c.length?c[0].aaSortingFixed:d;return a.isArray(c)?{pre:c}:c}return this.iterator("table",function(c){c.aaSortingFixed=a.extend(!0,{},b)})});K(["columns().order()","column().order()"],
function(b){var c=this;return this.iterator("table",function(e,f){var d=[];a.each(c[f],function(a,c){d.push([c,b])});e.aaSorting=d})});K("search()",function(b,c,e,f){var g=this.context;return b===d?0!==g.length?g[0].oPreviousSearch.sSearch:d:this.iterator("table",function(d){d.oFeatures.bFilter&&oa(d,a.extend({},d.oPreviousSearch,{sSearch:b+"",bRegex:null===c?!1:c,bSmart:null===e?!0:e,bCaseInsensitive:null===f?!0:f}),1)})});V("columns().search()","column().search()",function(b,c,e,f){return this.iterator("column",
function(g,p){var k=g.aoPreSearchCols;if(b===d)return k[p].sSearch;g.oFeatures.bFilter&&(a.extend(k[p],{sSearch:b+"",bRegex:null===c?!1:c,bSmart:null===e?!0:e,bCaseInsensitive:null===f?!0:f}),oa(g,g.oPreviousSearch,1))})});K("state()",function(){return this.context.length?this.context[0].oSavedState:null});K("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});K("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:
null});K("state.save()",function(){return this.iterator("table",function(a){Ja(a)})});A.versionCheck=A.fnVersionCheck=function(a){var b=A.version.split(".");a=a.split(".");for(var c,e,f=0,d=a.length;f<d;f++)if(c=parseInt(b[f],10)||0,e=parseInt(a[f],10)||0,c!==e)return c>e;return!0};A.isDataTable=A.fnIsDataTable=function(b){var c=a(b).get(0),e=!1;a.each(A.settings,function(b,f){var d=f.nScrollHead?a("table",f.nScrollHead)[0]:null,g=f.nScrollFoot?a("table",f.nScrollFoot)[0]:null;if(f.nTable===c||d===
c||g===c)e=!0});return e};A.tables=A.fnTables=function(b){var c=!1;a.isPlainObject(b)&&(c=b.api,b=b.visible);var e=a.map(A.settings,function(c){if(!b||b&&a(c.nTable).is(":visible"))return c.nTable});return c?new S(e):e};A.util={throttle:Da,escapeRegex:Ga};A.camelToHungarian=f;K("$()",function(b,c){var e=this.rows(c).nodes(),e=a(e);return a([].concat(e.filter(b).toArray(),e.find(b).toArray()))});a.each(["on","one","off"],function(b,c){K(c+"()",function(){var b=Array.prototype.slice.call(arguments);
b[0].match(/\.dt\b/)||(b[0]+=".dt");var e=a(this.tables().nodes());e[c].apply(e,b);return this})});K("clear()",function(){return this.iterator("table",function(a){L(a)})});K("settings()",function(){return new S(this.context,this.context)});K("init()",function(){var a=this.context;return a.length?a[0].oInit:null});K("data()",function(){return this.iterator("table",function(a){return ha(a.aoData,"_aData")}).flatten()});K("destroy()",function(b){b=b||!1;return this.iterator("table",function(c){var e=
c.nTableWrapper.parentNode,f=c.oClasses,d=c.nTable,g=c.nTBody,p=c.nTHead,k=c.nTFoot,l=a(d),g=a(g),m=a(c.nTableWrapper),n=a.map(c.aoData,function(a){return a.nTr}),w;c.bDestroying=!0;U(c,"aoDestroyCallback","destroy",[c]);b||(new S(c)).columns().visible(!0);m.unbind(".DT").find(":not(tbody *)").unbind(".DT");a(h).unbind(".DT-"+c.sInstance);d!=p.parentNode&&(l.children("thead").detach(),l.append(p));k&&d!=k.parentNode&&(l.children("tfoot").detach(),l.append(k));c.aaSorting=[];c.aaSortingFixed=[];Ia(c);
a(n).removeClass(c.asStripeClasses.join(" "));a("th, td",p).removeClass(f.sSortable+" "+f.sSortableAsc+" "+f.sSortableDesc+" "+f.sSortableNone);c.bJUI&&(a("th span."+f.sSortIcon+", td span."+f.sSortIcon,p).detach(),a("th, td",p).each(function(){var b=a("div."+f.sSortJUIWrapper,this);a(this).append(b.contents());b.detach()}));g.children().detach();g.append(n);p=b?"remove":"detach";l[p]();m[p]();!b&&e&&(e.insertBefore(d,c.nTableReinsertBefore),l.css("width",c.sDestroyWidth).removeClass(f.sTable),(w=
c.asDestroyStripes.length)&&g.children().each(function(b){a(this).addClass(c.asDestroyStripes[b%w])}));e=a.inArray(c,A.settings);-1!==e&&A.settings.splice(e,1)})});a.each(["column","row","cell"],function(a,b){K(b+"s().every()",function(a){var c=this.selector.opts,e=this;return this.iterator(b,function(f,g,p,k,l){a.call(e[b](g,"cell"===b?p:c,"cell"===b?c:d),g,p,k,l)})})});K("i18n()",function(b,c,e){var f=this.context[0];b=Q(b)(f.oLanguage);b===d&&(b=c);e!==d&&a.isPlainObject(b)&&(b=b[e]!==d?b[e]:b._);
return b.replace("%d",e)});A.version="1.10.10";A.settings=[];A.models={};A.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};A.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};A.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,
sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};A.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,
bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+
a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},
oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:a.extend({},
A.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};b(A.defaults);A.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};
b(A.defaults.column);A.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aIds:{},aoColumns:[],aoHeader:[],
aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",
iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:d,oAjaxData:d,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==ca(this)?
1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ca(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,e=this.aiDisplay.length,f=this.oFeatures,d=f.bPaginate;return f.bServerSide?!1===d||-1===a?b+e:Math.min(b+a,this._iRecordsDisplay):!d||c>e||-1===a?e:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};
A.ext=Z={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:A.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:A.version};a.extend(Z,{afnFiltering:Z.search,aTypes:Z.type.detect,ofnSearch:Z.type.search,oSort:Z.type.order,afnSortData:Z.order,aoFeatures:Z.feature,oApi:Z.internal,oStdClasses:Z.classes,
oPagination:Z.pager});a.extend(A.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",
sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",
sJUIHeader:"",sJUIFooter:""});var Pa="",Pa="",ja=Pa+"ui-state-default",ya=Pa+"css_right ui-icon ui-icon-",Kb=Pa+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";a.extend(A.ext.oJUIClasses,A.ext.classes,{sPageButton:"fg-button ui-button "+ja,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:ja+" sorting_asc",sSortDesc:ja+" sorting_desc",sSortable:ja+
" sorting",sSortableAsc:ja+" sorting_asc_disabled",sSortableDesc:ja+" sorting_desc_disabled",sSortableNone:ja+" sorting_disabled",sSortJUIAsc:ya+"triangle-1-n",sSortJUIDesc:ya+"triangle-1-s",sSortJUI:ya+"carat-2-n-s",sSortJUIAscAllowed:ya+"carat-1-n",sSortJUIDescAllowed:ya+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+ja,sScrollFoot:"dataTables_scrollFoot "+ja,sHeaderTH:ja,sFooterTH:ja,sJUIHeader:Kb+" ui-corner-tl ui-corner-tr",
sJUIFooter:Kb+" ui-corner-bl ui-corner-br"});var zb=A.ext.pager;a.extend(zb,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[La(a,b)]},simple_numbers:function(a,b){return["previous",La(a,b),"next"]},full_numbers:function(a,b){return["first","previous",La(a,b),"next","last"]},_numbers:La,numbers_length:7});a.extend(!0,A.ext.renderer,{pageButton:{_:function(b,e,f,d,g,p){var k=b.oClasses,l=b.oLanguage.oPaginate,m=b.oLanguage.oAria.paginate||
{},n,h,w=0,x=function(c,e){var d,t,r,q,u=function(a){Wa(b,a.data.action,!0)};d=0;for(t=e.length;d<t;d++)if(q=e[d],a.isArray(q))r=a("<"+(q.DT_el||"div")+"/>").appendTo(c),x(r,q);else{n=null;h="";switch(q){case "ellipsis":c.append('<span class="ellipsis">&#x2026;</span>');break;case "first":n=l.sFirst;h=q+(0<g?"":" "+k.sPageButtonDisabled);break;case "previous":n=l.sPrevious;h=q+(0<g?"":" "+k.sPageButtonDisabled);break;case "next":n=l.sNext;h=q+(g<p-1?"":" "+k.sPageButtonDisabled);break;case "last":n=
l.sLast;h=q+(g<p-1?"":" "+k.sPageButtonDisabled);break;default:n=q+1,h=g===q?k.sPageButtonActive:""}null!==n&&(r=a("<a>",{"class":k.sPageButton+" "+h,"aria-controls":b.sTableId,"aria-label":m[q],"data-dt-idx":w,tabindex:b.iTabIndex,id:0===f&&"string"===typeof q?b.sTableId+"_"+q:null}).html(n).appendTo(c),Ya(r,{action:q},u),w++)}},t;try{t=a(e).find(c.activeElement).data("dt-idx")}catch(r){}x(a(e).empty(),d);t&&a(e).find("[data-dt-idx="+t+"]").focus()}}});a.extend(A.ext.type.detect,[function(a,b){var c=
b.oLanguage.sDecimal;return ab(a,c)?"num"+c:null},function(a){if(!(!a||a instanceof Date||Ob.test(a)&&Pb.test(a)))return null;var b=Date.parse(a);return null!==b&&!isNaN(b)||ma(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return ab(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Eb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Eb(a,c,!0)?"html-num-fmt"+c:null},function(a){return ma(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":
null}]);a.extend(A.ext.type.search,{html:function(a){return ma(a)?a:"string"===typeof a?a.replace(Bb," ").replace(Na,""):""},string:function(a){return ma(a)?a:"string"===typeof a?a.replace(Bb," "):a}});var Ma=function(a,b,c,e){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Db(a,b));a.replace&&(c&&(a=a.replace(c,"")),e&&(a=a.replace(e,"")));return 1*a};a.extend(Z.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return ma(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():
a+""},"string-pre":function(a){return ma(a)?"":"string"===typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});fb("");a.extend(!0,A.ext.renderer,{header:{_:function(b,c,e,f){a(b.nTable).on("order.dt.DT",function(a,d,g,p){b===d&&(a=e.idx,c.removeClass(e.sSortingClass+" "+f.sSortAsc+" "+f.sSortDesc).addClass("asc"==p[a]?f.sSortAsc:"desc"==p[a]?f.sSortDesc:e.sSortingClass))})},jqueryui:function(b,c,
e,f){a("<div/>").addClass(f.sSortJUIWrapper).append(c.contents()).append(a("<span/>").addClass(f.sSortIcon+" "+e.sSortingClassJUI)).appendTo(c);a(b.nTable).on("order.dt.DT",function(a,d,g,p){b===d&&(a=e.idx,c.removeClass(f.sSortAsc+" "+f.sSortDesc).addClass("asc"==p[a]?f.sSortAsc:"desc"==p[a]?f.sSortDesc:e.sSortingClass),c.find("span."+f.sSortIcon).removeClass(f.sSortJUIAsc+" "+f.sSortJUIDesc+" "+f.sSortJUI+" "+f.sSortJUIAscAllowed+" "+f.sSortJUIDescAllowed).addClass("asc"==p[a]?f.sSortJUIAsc:"desc"==
p[a]?f.sSortJUIDesc:e.sSortingClassJUI))})}}});A.render={number:function(a,b,c,e,f){return{display:function(d){if("number"!==typeof d&&"string"!==typeof d)return d;var g=0>d?"-":"",p=parseFloat(d);if(isNaN(p))return d;d=Math.abs(p);p=parseInt(d,10);d=c?b+(d-p).toFixed(c).substring(2):"";return g+(e||"")+p.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+d+(f||"")}}},text:function(){return{display:function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):
a}}}};a.extend(A.ext.internal,{_fnExternApiFunc:Ab,_fnBuildAjax:W,_fnAjaxUpdate:na,_fnAjaxParameters:qa,_fnAjaxUpdateDraw:Ba,_fnAjaxDataSrc:sa,_fnAddColumn:g,_fnColumnOptions:n,_fnAdjustColumnSizing:t,_fnVisibleToColumnIndex:v,_fnColumnIndexToVisible:r,_fnVisbleColumns:m,_fnGetColumns:z,_fnColumnTypes:G,_fnApplyColumnDefs:M,_fnHungarianMap:b,_fnCamelToHungarian:f,_fnLanguageCompat:l,_fnBrowserDetect:u,_fnAddData:C,_fnAddTr:E,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==d?b._DT_RowIndex:
null},_fnNodeToColumnIndex:function(b,c,e){return a.inArray(e,b.aoData[c].anCells)},_fnGetCellData:B,_fnSetCellData:I,_fnSplitObjNotation:D,_fnGetObjectDataFn:Q,_fnSetObjectDataFn:H,_fnGetDataMaster:N,_fnClearTable:L,_fnDeleteIndex:P,_fnInvalidate:O,_fnGetRowElements:p,_fnCreateTr:w,_fnBuildHead:J,_fnDrawHead:T,_fnDraw:R,_fnReDraw:y,_fnAddOptionsHtml:F,_fnDetectHeader:ba,_fnGetUniqueThs:da,_fnFeatureHtmlFilter:Aa,_fnFilterComplete:oa,_fnFilterCustom:Fa,_fnFilterColumn:Ea,_fnFilter:mb,_fnFilterCreateSearch:Ta,
_fnEscapeRegex:Ga,_fnFilterData:nb,_fnFeatureHtmlInfo:kb,_fnUpdateInfo:qb,_fnInfoMacros:rb,_fnInitialise:wa,_fnInitComplete:Ca,_fnLengthChange:Ua,_fnFeatureHtmlLength:hb,_fnFeatureHtmlPaginate:lb,_fnPageChange:Wa,_fnFeatureHtmlProcessing:ib,_fnProcessingDisplay:ga,_fnFeatureHtmlTable:jb,_fnScrollDraw:ua,_fnApplyToChildren:ka,_fnCalculateColumnWidths:Qa,_fnThrottle:Da,_fnConvertToWidth:sb,_fnGetWidestNode:tb,_fnGetMaxLenString:ub,_fnStringToCss:X,_fnSortFlatten:ra,_fnSort:gb,_fnSortAria:wb,_fnSortListener:Xa,
_fnSortAttachListener:Ra,_fnSortingClasses:Ia,_fnSortData:vb,_fnSaveState:Ja,_fnLoadState:xb,_fnSettingsFromNode:Ka,_fnLog:la,_fnMap:ia,_fnBindAction:Ya,_fnCallbackReg:ea,_fnCallbackFire:U,_fnLengthOverflow:Va,_fnRenderer:Sa,_fnDataSource:ca,_fnRowAttributes:x,_fnCalculateEnd:function(){}});a.fn.dataTable=A;A.$=a;a.fn.dataTableSettings=A.settings;a.fn.dataTableExt=A.ext;a.fn.DataTable=function(b){return a(this).dataTable(b).api()};a.each(A,function(b,c){a.fn.DataTable[b]=c});return a.fn.dataTable});window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(a){return function(){var h={};return{check_message:function(c){var d;if(c.is_box())if(d=c.get_size(),1>d)a.UTILITIES.display_message("Function birds can only respond to boxes with holes.");else if(c=c.get_hole_contents(0)){if(c.is_bird())return{box_size:d,bird:c};a.UTILITIES.display_message("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+a.UTILITIES.add_a_or_an(c.get_type_name()+"."))}else a.UTILITIES.display_message("Function birds can only respond to boxes with something in the first hole.");
else a.UTILITIES.display_message("Function birds can only respond to boxes. One was given "+a.UTILITIES.add_a_or_an(c.get_type_name()))},process_response:function(a,d,b,f,l){a&&d.widget_side_dropped_on_me(a,void 0,l,!0,!0);b.remove(void 0,!0)},process_message:function(a,d,b,f){var l=this.check_message(a);if(l)return d=d(l.bird,l.box_size),1<a.get_size()&&a.get_hole_contents(1).remove(b,!0),this.process_response(d,l.bird,a,b,f),d},type_check:function(c,d,b,f){if(!c)return!0;if(!d)return a.UTILITIES.display_message("Birds for the "+
b+" function can only respond to boxes with "+a.UTILITIES.add_a_or_an(c)+" in the "+a.UTILITIES.ordinal(f)+" hole. The "+a.UTILITIES.ordinal(f)+" hole is empty."),!1;if(d.dereference().is_of_type(c))return!0;if(d.is_nest())throw{wait_for_nest_to_receive_something:d};a.UTILITIES.display_message("Birds for the "+b+" function can only respond to boxes with "+a.UTILITIES.add_a_or_an(c)+" in the "+a.UTILITIES.ordinal(f)+" hole. The "+a.UTILITIES.ordinal(f)+" hole contains "+a.UTILITIES.add_a_or_an(d.get_type_name()+
"."));return!1},number_check:function(a,d,b){return this.type_check("number",a,d,b)},n_ary_widget_function:function(a,d,b,f,l,k){var e=function(e,k){var g,l,h,v;if(1===k)return d();l=1;h=a.get_hole_contents(l).dereference();if(v=this.number_check(h,f,l)){for(l++;l<k;){g=a.get_hole_contents(l).dereference();v=this.number_check(g,f,l);if(!v)return;b.call(h,g);l++}return h}}.bind(this);return this.process_message(a,e,l,k)},n_ary_function:function(c,d,b,f,l,k){var e=function(e,k){var g,l,h,v,r;if(k<b+
1)a.UTILITIES.display_message("Birds for the "+f+" function can only respond to boxes with at least "+(b+1)+" holes. Not "+k+" holes.");else{h=[];for(l=1;l<k;){g=c.get_hole_contents(l).dereference();v=this.number_check(g,f,l);if(!v)return;g.get_approximate&&g.get_approximate()&&(r=!0);h.push(g.get_value());l++}g=d.apply(null,h);r&&(g.set_approximate(!0),g.set_format("decimal"));return g}}.bind(this);return this.process_message(c,e,l,k)},typed_bird_function:function(c,d,b,f,l,k,e){var h=function(e,
g){var k,h,u,r;if(0<=f&&g!=f+1)a.UTILITIES.display_message("Birds for the "+l+" function can only respond to boxes with "+(f+1)+" holes. Not "+g+" holes.");else{u=[];for(h=1;h<g;){k=c.get_hole_contents(h).dereference();h<=b.length&&(r=b[h-1]);if(!this.type_check(r,k,l,h))return;u.push(k);h++}return d.apply(c,u)}}.bind(this);return this.process_message(c,h,k,e)},numeric_javascript_function_to_widget_function:function(c,d,b){return function(){var f=a.number.ZERO(a.number.function_bird_results_default_format);
f.set_value_from_decimal(c.apply(null,a.UTILITIES.map_arguments(arguments,b||bigrat.toDecimal)));d&&(f.set_approximate(!0),f.set_format("decimal"));return f}},bigrat_function_to_widget_function:function(c,d){return function(){var b=a.number.create_from_bigrat(c.apply(null,arguments));d&&d(arguments)&&(b.set_approximate(!0),b.set_format("decimal"));return b}},add_function_object:function(c,d,b,f,l){h[c]={name:c,short_name:f||c,respond_to_message:d,get_description:l?1===l.length?function(){return"If you give me a box with another bird and "+
a.UTILITIES.add_a_or_an(l[0])+" then "+a.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+a.UTILITIES.conjunction(l,!0)+" then "+a.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+a.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."},
toString:function(){return a.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:b}},get_function_table:function(){return h}}}}(window.TOONTALK);window.TOONTALK.widget=function(a){var h=function(a){if(a=this.get_frontside&&this.get_frontside(a))return a.get_element()};a.creators_from_json.top_level=function(c){c=a.widget.create_top_level_widget(c.settings);$(c.get_backside(!0).get_element()).addClass("toontalk-top-level-backside");return c};return{add_standard_widget_functionality:function(c){var d=function(){return!1},b;this.add_sides_functionality(c);this.runnable(c);this.stackable(c);this.animatable(c);this.has_title(c);this.has_parent(c);
this.has_backside_widgets(c);this.has_description(c);this.has_listeners(c);this.droppable(c);this.erasable(c);c.this_and_walk_children=function(a){a(c)&&c.walk_children&&c.walk_children(a)};c.top_level_widget=function(){var c;if(b)return b;if(this.is_top_level())return this;if(b=a.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-top-level-backside")))return b=b.get_widget();if(c=this.get_parent_of_frontside()||this.get_parent_of_backside())return b=c.get_widget().top_level_widget();
c=$(".toontalk-top-level-backside");if(0<c.length)return b=a.UTILITIES.widget_side_of_element(a.UTILITIES.closest_element(c,$(this.get_frontside_element()).offset())).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return b=this.create_top_level_widget()};c.is_of_type||(c.is_of_type=function(a){return this.get_type_name()===a});c.dereference||(c.dereference=function(){return this});c.get_default_description||(c.get_default_description=function(){return a.UTILITIES.add_a_or_an(this.get_type_name())+
"."});c.is_number||(c.is_number=d);c.is_box||(c.is_box=d);c.is_empty_hole||(c.is_empty_hole=d);c.is_hole||(c.is_hole=d);c.is_scale||(c.is_scale=d);c.is_bird||(c.is_bird=d);c.is_nest||(c.is_nest=d);c.is_robot||(c.is_robot=d);c.is_element||(c.is_element=d);c.is_sensor||(c.is_sensor=d);c.is_function_nest||(c.is_function_nest=d);c.is_plain_text_element||(c.is_plain_text_element=d);c.is_attribute_widget||(c.is_attribute_widget=d);c.maintain_proportional_dimensions||(c.maintain_proportional_dimensions=
d);c.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};c.set_name&&(c.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});c.get_width||(c.get_width=function(){return a.UTILITIES.get_element_width(c.get_frontside_element())});c.get_height||(c.get_height=function(){return a.UTILITIES.get_element_height(c.get_frontside_element())});!a.debugging&&!a.logging||c.to_debug_string||(c.to_debug_string=function(){var a=this.get_parent_widget_of_frontside(),
b=this._debug_id,c=this.get_description(),c=c?c+" ":"";b||(b=a&&a.id?"id of parent is "+a.id:"");c&&(c+=" ");return this.toString({plain_text:!0})+" ("+c+(this.get_name&&this.get_name()+" "||"")+b+")"});c.is_top_level=d;c.is_widget=!0},erasable:function(a){var d;a.get_erased||(a.get_erased=function(){return d});a.set_erased||(a.set_erased=function(a,c){d=a;c&&this.rerender()})},add_sides_functionality:function(c){var d,b,f;c.get_frontside||(c.get_frontside=function(b){b&&!d&&(d=a.frontside.create(c));
return d},c.save_dimensions=function(){return this.save_dimensions_of(this)},c.save_dimensions_of=function(a){var b;if(a.is_element()){if(!this.get_original_width())return;b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0},c.restore_dimensions=function(){var b,c;0<this.saved_width&&(b=this.get_frontside_element(!0),this.use_scaling_transform?this.use_scaling_transform({width:this.saved_width,
height:this.saved_height}):this.ok_to_set_dimensions()?this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):a.UTILITIES.set_css(b,{width:this.saved_width,height:this.saved_height}):(c={width:"",height:""},a.UTILITIES.set_css_transform(c,""),a.UTILITIES.set_css(b,c)),this.saved_height=this.saved_width=void 0)});c.get_backside||(c.get_backside=function(a){a&&!b&&(b=this.create_backside(),this.backside_widgets_json_views&&(b.add_backside_widgets(this.get_backside_widgets(),
this.backside_widgets_json_views),this.backside_widgets_json_views=void 0));return b});c.set_backside||(c.set_backside=function(a){b=a});c.forget_backside||(c.forget_backside=function(){var a;if(b){if(a=b.get_element())$(a).remove(),a.toontalk_widget_side=void 0;b=void 0}});c.create_backside||(c.create_backside=function(){return a.backside.create(c)});c.get_open_backside_only_if_stopped||(c.get_open_backside_only_if_stopped=function(){return f});c.set_open_backside_only_if_stopped||(c.set_open_backside_only_if_stopped=
function(a){f=a})},runnable:function(a){var d=!1,b=!1;a.get_running||(a.get_running=function(a){var b=!1;if(a)return d;if(d)if(a=this.get_backside_widgets(),0===a.length)d=!1;else for(a.some(function(a){if(a&&(a=a.get_widget(),a.get_running()))return b=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return b});a.is_ok_to_run||(a.is_ok_to_run=function(){return b},a.set_ok_to_run=
function(a){b=a});a.set_running||(a.set_running=function(f,l,k){var e=d===f,h,q;b=f;h=this.get_backside_widgets();d=f;this.get_backside()&&!e&&this.get_backside().run_status_changed(d);h.forEach(function(b){b&&(q=b.get_widget(),b.is_backside()&&(0<=this.get_backside_widgets().indexOf(q)||!b.is_primary_backside())||(!q.is_robot()||q.being_trained||q.get_body().is_empty()?q.set_running&&(!l&&b.is_backside()&&"top-level"!==a.get_type_name()?q.set_running(f,a,!0):q.set_running(f)):d?(q.set_stopped(!1),
q.run(a,k,l),q.set_ok_to_run(!0)):(q.set_stopped(!0),q.set_running(!1)),q.rerender()))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(d);return!0});this.is_robot()&&(d?a.get_parent_of_backside()&&(this.set_stopped(!1),this.run(a.get_parent_of_backside().get_widget())):this.set_stopped(!0));e||this.rerender()})},droppable:function(a){a.drop_on||(a.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c);console.log("No handler for drop of '"+
this+"' on '"+a+"'")})},stackable:function(a){var d=!1;a.get_infinite_stack||(a.get_infinite_stack=function(){return d});a.set_infinite_stack||(a.set_infinite_stack=function(b){var f=a.get_backside_element(),l=a.get_frontside_element();d=b;f&&$(f).find(".toontalk-infinite-stack-check-box").prop("checked",b);l&&(b?$(l).addClass("toontalk-infinite-stack"):$(l).removeClass("toontalk-infinite-stack"))})},animatable:function(c){var d;c.animate_to_widget||(d=function(b,c){var d=b.get_element();d&&(b.is_backside()||
a.UTILITIES.visible_element(d))||(d=a.UTILITIES.find_resource_equal_to_widget(b,c));return d},c.animate_to_widget=function(a,c,l,k,e,h,q,g){var n=function(){this.animate_to_element(d(a,g),c,l,k,e,h,q&&Math.max(0,q-100));this.rerender()}.bind(this);0===q?n():setTimeout(n,100)});c.animate_to_element||(c.animate_to_element=function(b,c,d,k,e,h,q){var g=$(b).offset(),n=this.get_frontside_element(),t=$(b).is(".toontalk-backside");if(b&&a.UTILITIES.visible_element(b)){if("number"===typeof b.animation_left_offset)k=
b.animation_left_offset;else if("undefined"===typeof k||t)k=(a.UTILITIES.get_element_width(b)-a.UTILITIES.get_element_width(n))*Math.random();if("number"===typeof b.animation_top_offset)e=b.animation_top_offset;else if("undefined"===typeof e||t)e=(a.UTILITIES.get_element_height(b)-a.UTILITIES.get_element_height(n))*Math.random();g?(g.left+=k,g.top+=e):g={left:0,top:0};this.animate_to_absolute_position(g,c,d,h,q)}else c&&c()});c.animate_to_absolute_position||(c.animate_to_absolute_position=function(b,
c,d,k,e){a.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),b,c,d,k,e)})},has_title:function(c){c.get_title||(c.get_title=function(){var c=this.get_type_name(),b=this.get_backside(),f=this.get_frontside_element(),l=this.get_description(),k="";$(f).is(".toontalk-top-level-resource")?k=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":
b&&b.get_element()&&a.UTILITIES.visible_element(b.get_element())||(k=this.can_run&&this.can_run()?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+a.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my backside and then click the green flag "+a.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
".":"Click to see my backside.");l&&(l="I'm "+l,k=k?l+"\n"+k:l);if(this.get_erased())return this.get_title_of_erased_widget();k=this.get_custom_title_prefix&&!$(f).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+k:"I'm "+a.UTILITIES.add_a_or_an(c)+". "+k;k=k.trim();0>".?!".indexOf(k[k.length-1])&&(k+=".");return k});c.update_title=function(){var c=this.get_frontside_element();c&&a.UTILITIES.give_tooltip(c,this.get_title())}},inside_conditions_container:function(){return $(this.get_frontside_element()).closest(".toontalk-conditions-container").is("*")},
get_title_of_erased_widget:function(){var a=this.get_type_name();return this.inside_conditions_container()?"I'm an erased "+a+".\nI'll match with any other "+a+".":"I'm an erased "+a+".\nDusty the Vacuum can restore me to normal."},has_parent:function(c){var d=[],b,f,l,k;c.get_parent_of_frontside=function(){return l&&b?b.get_backside(!0):b};c.get_parent_widget_of_frontside=function(){return b};c.parent_of_frontside_is_backside=function(){return l};c.set_parent_of_frontside=function(a,c,f){var g=b;
l=c;b!==a&&(b=a,g&&!f&&!c&&g.is_backside()&&g.get_widget().remove_backside_widget(this,!0),d.forEach(function(a){a(g,b)}))};c.add_parent_of_frontside_change_listener=function(a){d.push(a)};c.remove_parent_of_frontside_change_listener=function(a){a=d.indexOf(a);0<=a&&d.splice(a,1)};c.get_parent_of_backside=function(){return k&&f?f.get_backside(!0):f};c.set_parent_of_backside=function(a,b,c){void 0===a&&!c&&k&&f&&f.get_widget().remove_backside_widget(this.get_backside(),!0);f=a;k=b};c.parent_of_backside_is_backside=
function(){return k};c.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};c.closest_visible_ancestor_or_frontside=function(){for(var b=this,c;b&&!a.UTILITIES.visible_element(b.get_frontside_element());)c=b,b.is_backside()?(b=b.get_parent_of_backside())||(b=c.get_widget()):b=b.get_parent_of_frontside();return b||this};c.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?
b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};c.has_ancestor=function(a){var b;return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};c.remove_from_parent_of_frontside=function(a){b&&(b.is_backside()?b.remove_backside_widget(this,!a):b.removed_from_container?l?b.remove_backside_widget(this,!0):b.removed_from_container(this,a):b.get_backside()&&b.remove_backside_widget(this,!a))}},has_description:function(a){var d;a.get_description||(a.get_description=
function(){return d});a.set_description||(a.set_description=function(a,c){if(d===a||!d&&""===a)return!1;d=a;c&&this.rerender();return!0});a.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},has_name:function(a){var d;a.get_name||(a.get_name=function(){"string"!==typeof d&&a.generate_name&&(d=a.generate_name());return d});a.set_name||(a.set_name=function(a,c){if(d===a||"string"!==typeof a)return!1;d=a;c&&this.rerender();
return!0})},has_listeners:function(c){var d={};c.add_listener||(c.add_listener=function(a,c){var l=d[a];l?0>l.indexOf(c)&&l.push(c):d[a]=[c]});c.remove_listener||(c.remove_listener=function(b,c,l){if(b=d[b])if(c=b.indexOf(c),0<=c){b.splice(c,1);return}!l&&a.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});c.get_listeners||(c.get_listeners=function(a){return d[a]})},get_full_description:function(a){var d;if(this.get_erased&&this.get_erased())return a&&"conditions"===
a.role?"any "+this.get_type_name():"erased "+this.get_type_name();d=this.get_description(a);a=this.toString(a);return d?a+" ("+d+")":a},remove:function(a,d){var b=this.get_backside(),f=this.get_frontside(),l=this.get_parent_of_frontside();b&&this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level()&&b.hide_backside();f&&f.remove();l&&this.remove_from_parent_of_frontside(a);this.get_running()&&this.set_running(!1);this.set_visible(!1);this.walk_children&&!d&&this.walk_children(function(a){a.remove&&
a.remove();return!0})},get_frontside_element:h,get_element:h,get_backside_element:function(a){if(a=this.get_backside&&this.get_backside(a))return a.get_element()},add_to_json:function(c,d){var b,f,l,k,e,h;if(c){c.view?(f=c,b=c.view,c=c.semantic):(b={},f={semantic:c,view:b});f.version=1;this.get_erased&&this.get_erased()&&(c.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(c.infinite_stack=!0);this.get_open_backside_only_if_stopped&&this.get_open_backside_only_if_stopped()&&(c.open_backside_only_if_stopped=
!0);this.get_running&&this.get_running()&&(c.running=!0);e=this.get_parent_widget_of_frontside();if(!e||this.parent_of_frontside_is_backside()||e.is_element())if(k=this.get_frontside_element&&this.get_frontside_element())if(h=$(k).width(),$(k).is(".toontalk-plain-text-element")||0===h||(b.frontside_width=$(k).width(),b.frontside_height=$(k).height()),0!==h&&(b.frontside_left=a.UTILITIES.get_style_numeric_property(k,"left"),b.frontside_top=a.UTILITIES.get_style_numeric_property(k,"top")||l&&l.frontside_top,
void 0===b.frontside_left&&(l=e&&e.get_widget().get_backside_widgets_json_views())))k=this.get_parent_of_frontside().get_widget().get_backside_widgets().indexOf(this),0<=k&&(b.frontside_left=l[k].frontside_left,b.frontside_top=l[k].frontside_top);if(k=this.get_backside()){if(e=k.get_element()){if(k.get_backside_dimensions()||k.is_top_level())b.backside_width=$(e).width(),b.backside_height=$(e).height();b.backside_left||(l=$(e).position(),b.backside_left=l.left,b.backside_top=l.top,"&lt;"===$(e).find(".toontalk-settings-backside-button").html()&&
(b.advanced_settings_open=!0))}k.get_backside_dimensions()&&(b.backside_geometry=k.get_backside_dimensions())}!b.backside_geometry&&this.backside_geometry&&(b.backside_geometry=this.backside_geometry);c.description=this.get_description&&this.get_description();b.saved_width=this.saved_width;b.saved_height=this.saved_height;return f}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(c,d,b,f){var l=this.get_backside_widgets(),k,e;0<l.length?(c.semantic.backside_widgets=
[],(k=this.get_backside_widgets_json_views())&&k.forEach(function(a,b){var f;if(e=c.semantic.backside_widgets[b]){if(0<=e.widget.shared_widget_index){f=d.widgets_encountered.indexOf(d.shared_widgets[e.widget.shared_widget_index]);if(!d.json_of_widgets_encountered[f])return;f=d.json_of_widgets_encountered[f].view}else f=e.widget.view;e.is_backside?a.backside_left&&(f.backside_left=a.backside_left,f.backside_top=a.backside_top):a.frontside_left&&(f.frontside_left=a.frontside_left,f.frontside_top=a.frontside_top)}}),
a.UTILITIES.get_json_of_array(l,c.semantic.backside_widgets,0,d,b,f)):b()},has_backside_widgets:function(c){var d=[];c.get_backside_widgets=function(){return d};c.add_backside_widget=function(b){var c;if(b){c=this.get_backside(!0);if(a.debugging){if(b===this){a.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");return}if(b.get_widget()===this){a.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}d?0>
d.indexOf(b)&&d.push(b):d=[b];a.logging&&0<=a.logging.indexOf("backside-widgets")&&console.log("Added "+b+" to backside widgets of "+this+". Number of backside widgets is "+d.length);b.is_backside()?b.set_parent_of_backside(c,!0):b.set_parent_of_frontside(this,!0);c.visible()&&b.set_visible(!0)}else a.debugging&&a.UTILITIES.report_internal_error("adding undefined to backside widgets.")};c.remove_all_backside_widgets=function(){d&&d.slice().forEach(function(a){a.remove()})};c.remove_backside_widget=
function(b,c){var l=d.indexOf(b);0>l?c||a.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+b.get_widget()+" ("+b.get_widget()._debug_id+")"):(d.splice(l,1),a.logging&&0<=a.logging.indexOf("backside-widgets")&&console.log("Removed "+b+" from backside widgets of "+this+". Number of backside widgets is "+d.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(l,1),b.is_backside()?(l=b.get_parent())&&l.get_widget()===this&&b.set_parent_of_backside(void 0,
!0,!0):(l=b.get_parent_of_frontside())&&l.get_widget()===this&&b.set_parent_of_frontside(void 0,void 0,!0),b.set_visible(!1))};c.set_backside_widgets=function(a,c){var l=this.get_backside(),k=l&&l.visible();d=a;0<d.length&&(l?l.add_backside_widgets(d,c):this.backside_widgets_json_views=c,d.forEach(function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),k&&a.set_visible(k))}.bind(this)))}},get_backside_widgets_json_views:function(a){!this.backside_widgets_json_views&&
a&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var a=!1,d;this.get_backside_widgets().some(function(b){if(!b)return!1;d=b.get_widget();if(d.get_body&&!d.get_body().is_empty()||d.can_run())return a=!0});return a},add_to_copy:function(c,d){var b;this.get_erased&&this.get_erased()&&(c.set_erased||a.widget.erasable(c),c.set_erased(this.get_erased()));d&&d.just_value||(b=this.get_backside_widgets(),0<b.length&&c.set_backside_widgets(a.UTILITIES.copy_widget_sides(b,
d),this.get_backside_widgets_json_views()));c.set_running(this.get_running());return c},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(c,d,b){var f=this.visible(),l,k,e,h,q;c||(c=this.copy({}));l=this.get_frontside_element(f);k=c.get_element(f);e=$(l).closest(".toontalk-backside");h=c.ok_to_set_dimensions();0===e.length&&(e=$(this.top_level_widget().get_backside_element()));q=a.UTILITIES.widget_side_of_jquery(e);f&&("undefined"===
typeof d&&(d=30),"undefined"===typeof b&&(b=30),f=a.UTILITIES.relative_position(l,e.get(0)),0<e.length&&e.get(0).appendChild(k),a.UTILITIES.set_css(k,{width:h?$(l).width():"",height:h?$(l).height():"",left:f.left+d,top:f.top+b,"z-index":a.UTILITIES.next_z_index()}));q&&q.add_backside_widget(c);return c},visible:function(){var a;if(!document.hidden)return(a=this.get_frontside())?a.visible():!1},set_visible:function(a){var d=this.get_frontside(a);d&&d.set_visible(a)},is_backside:function(){return!1},
get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(a){this.set_parent_of_frontside(a)},drag_started:function(a,d){this.robot_in_training()&&this.robot_in_training().picked_up(this,a,d)},match:function(a){console.assert(!1,"match not implemented for "+a.toString())},removed:function(c){a.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(c){var d=this.get_backside(),b,f,
l,k,e,h,q,g,n,t,v;if(d&&a.UTILITIES.visible_element(d.get_element()))$(d.get_element()).css({opacity:1}),c&&c();else{b=c&&function(){setTimeout(c)};f=function(c,e){a.UTILITIES.set_timeout(function(){$(c).addClass("toontalk-side-appearing");a.UTILITIES.add_one_shot_event_handler(c,"transitionend",2500,function(){$(c).removeClass("toontalk-side-appearing");b&&b()});$(c).css({left:q,top:g,opacity:e});this.apply_backside_geometry()}.bind(this))}.bind(this);k=this.get_frontside_element();e=$(k).parent();
for(d=$(k);0<e.length&&!e.is(".toontalk-backside");)d=e,e=e.parent();d.get(0);d=this.get_backside(!0);l=d.get_element();l.toontalk_widget_side=d;n=$(k).offset();t=e.offset();v=e.width();t||(t={left:0,top:0});$(l).css({left:n.left-t.left,top:n.top-t.top,opacity:.01});0<e.length?e.get(0).appendChild(l):($(l).css({textAlign:"left"}),k.appendChild(l));(e=a.UTILITIES.widget_side_of_jquery(e))&&e.add_backside_widget(d);e=this.is_element()?this.get_attribute("height"):$(k).height();k=$(l).width();q=n.left-
t.left;q+k>v&&(q=Math.max(0,v-k));g=n.top-t.top+e+34;this.is_box()&&(g+=28);f(l,"inherit");d.set_visible(!0);h=this.get_backside_widgets();0<h.length&&h.forEach(function(a){a.is_backside()&&0<=h.indexOf(a.get_widget())?a.hide_backside():(a.set_visible(!0),l.appendChild(a.get_element(!0)))}.bind(this));return d}},hide_backside:function(){var a=this.get_backside();a&&a.hide_backside()},apply_backside_geometry:function(){var a=this.get_backside(!0),d=a.get_element();this.backside_geometry&&d&&(a.scale_backside(d,
this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),a.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(a){this.top_level_widget().robot_started_training(a)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},
backup_all:function(a){var d=this.top_level_widget();d&&d.save(a)},render:function(){a.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},location_constrained_by_container:function(){var a;return this.is_nest()||this.being_dragged?!1:(a=this.get_parent_of_frontside())&&(a.is_hole()||a.is_nest()||a.is_robot())?!0:!1},close_button_ok:function(a){return"top-level"!==this.get_type_name()&&!$(a).is(".toontalk-top-level-resource")&&
!$(a).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(a,d){var b=this.top_level_widget(),f;a||(a=this);f=a.get_element(!0);b.add_backside_widget(a);b.get_backside_element().appendChild(f);a.render();d&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,b);return f},get_selection:function(){return this},create_top_level_widget:function(c){var d=Object.create(a.widget),b=[],f=function(){return!1},l=!1;c||(c={});d.is_top_level=
function(){return!0};d.is_number=f;d.is_box=f;d.is_empty_hole=f;d.is_scale=f;d.is_bird=f;d.is_nest=f;d.is_robot=f;d.is_element=f;d.is_sensor=f;d.is_function_nest=f;d.is_hole=f;d.is_plain_text_element=f;d.is_attribute_widget=f;d.ok_to_set_dimensions=f;d.get_json=function(a,b,f){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");b({semantic:{type:"top_level",settings:c},view:{background_color:a}},f)};d.get_type_name=function(){return"top-level"};
d.is_of_type=function(a){return"top-level"===a};d.toString=function(){return"top level widget"};d.get_description=function(){};d.match=function(){return"matched"};d.update_display=function(){this.get_backside_widgets()&&this.get_backside_widgets().forEach(function(a){a&&a.visible()&&a.render()})};d.copy=function(){return this};d.visible=function(){return!0};d.get_parent_of_frontside=function(){};d.get_parent_of_backside=function(){};d.closest_visible_ancestor=function(){return this};d.get_infinite_stack=
function(){return!1};d.top_level_widget=function(){return this};if(a.debugging||a.logging)d.to_debug_string=function(){var a=$(this.get_backside_element()).offset();return"top-level widget at "+Math.round(a.left)+", "+Math.round(a.top)};d.add_sides_functionality(d);d.runnable(d);d.has_parent(d);d.has_backside_widgets(d);d.removed_from_container=function(a,b){this.robot_in_training()||this.remove_backside_widget(a,!0)};d.widget_side_dropped_on_me=function(a,b,c,f){return this.get_backside().widget_side_dropped_on_me(a,
b,c,f)};d.get_element=function(){return this.get_backside().get_element()};d.get_setting=function(b,e){"undefined"!==typeof c[b]||e||(c[b]=a.DEFAULT_SETTINGS&&a.DEFAULT_SETTINGS[b]);return c[b]};d.set_setting=function(a,b){c[a]=b};d.open_settings=function(){a.SETTINGS.open(d)};d.robot_in_training=function(){if(0<b.length)return b[b.length-1]};d.robot_training_this_robot=function(){if(1<b.length)return b[b.length-2]};d.robot_started_training=function(a){b.push(a)};d.robot_finished_training=function(){b.pop()};
d.save=function(b,c,f){var d=this.get_setting("program_name",a.reset),g=function(b){l=!1;n&&(h=a.google_drive.get_status(),"Ready"===h?(a.google_drive.upload_file(d,"json",JSON.stringify(b,a.UTILITIES.clean_JSON),f),f=void 0):a.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===h?(a.UTILITIES.display_message_if_new("Unable to save to your Google Drive because you need to log in. Click on the settings icon <span class='toontalk-settings-icon'></span> to log in."),a.UTILITIES.display_tooltip($(".toontalk-settings-button"))):
console.log("Unable to save to Google Drive because: "+h)));c.local_storage&&this.save_to_local_storage(b);f&&f()}.bind(this),n,h;!l&&d&&(c||(c={}),"undefined"===typeof c.google_drive&&(c.google_drive=a.google_drive&&this.get_setting("auto_save_to_google_drive")),"undefined"===typeof c.local_storage&&(c.local_storage=this.get_setting("auto_save_to_local_storage")),b?(n=c.google_drive&&!this.get_setting("google_drive_unavailable"))||c.local_storage?(l=!0,a.UTILITIES.get_json_top_level(this,g,250)):
f&&f():setTimeout(function(){this.save(!0,c,f)}.bind(this),100))};d.publish=function(b,c){a.publish.publish_widget(this.get_setting("program_name"),this,c,b)};d.save_to_local_storage=function(b,c){var f=this.get_setting("program_name"),d=a.UTILITIES.local_storage_program_key(f),g=a.UTILITIES.local_storage_program_meta_data_key(f),l,h,v;c||(c=Date.now());try{h=(h=window.localStorage.getItem(g))?JSON.parse(h):{created:c},h.last_modified=c,v=JSON.stringify(b,a.UTILITIES.clean_json),h.file_size=v.length,
window.localStorage.setItem(g,JSON.stringify(h)),window.localStorage.setItem(d,v),window.localStorage.setItem("toontalk-last-key",d),l=a.UTILITIES.get_all_locally_stored_program_names(),0>l.indexOf(f)&&(l.push(f),a.UTILITIES.set_all_locally_stored_program_names(l))}catch(r){f=v?"Failed to save state to local storage since it requires "+v.length+" bytes. Error message is "+r:"Error while saving to local storage. Error message is "+r,a.UTILITIES.is_internet_explorer()?console.error("Unresolved difficulties using window.localStorage in IE11: "+
f):a.UTILITIES.display_message(f),this.last_local_storage_error=f}};d.load=function(b,c,f){var l=this.get_setting("program_name"),g=l+".json",n=a.UTILITIES.local_storage_program_key(l),h=function(b){var g;if(b)try{g=JSON.parse(b),d.remove_all_backside_widgets(),a.UTILITIES.add_backside_widgets_from_json(d,g.semantic.backside_widgets,{json_of_shared_widgets:g.shared_widgets,shared_widgets:[],shared_html:g.shared_html}),c&&c()}catch(k){a.UTILITIES.display_message("Error encountered loading "+l+" : "+
k)}else f&&f()},v=function(b){b?a.google_drive.download_file(b,h):h(window.localStorage.getItem(n))};b&&a.google_drive&&"Ready"===a.google_drive.get_status()?a.google_drive.get_toontalk_program_file(g,v):h(window.localStorage.getItem(n))};d.walk_children=function(){};d.render=function(){};d.location_constrained_by_container=function(){return!1};d.dereference=function(){return this};d.is_widget=!0;a.debugging&&(d._debug_id=a.UTILITIES.generate_unique_id(),d._debug_string="Top-level widget");d.get_backside(!0).set_visible(!0);
return d}}}(window.TOONTALK);window.TOONTALK.backside=function(a){var h=function(c){var d=c.get_widget(),b=d.get_backside_widgets(),f=d.get_backside_widgets_json_views(!0);c.get_backside_dimensions();var l=c.get_element();b.forEach(function(b,c){var d=b.get_element(),q;d&&(f[c]||(f[c]={}),b.start_offset&&d.parentElement?(q=a.UTILITIES.relative_position_from_absolute_position(d.parentElement,b.start_offset),b.start_offset=void 0):q=$(d).position(),b.is_backside()?(f[c].backside_left=a.UTILITIES.left_as_percent(q.left,d),f[c].backside_top=
a.UTILITIES.top_as_percent(q.top,d),h(b)):(f[c].frontside_left=a.UTILITIES.left_as_percent(q.left,d,l),f[c].frontside_top=a.UTILITIES.top_as_percent(q.top,d,l)))})};return{create:function(c){var d=Object.create(this),b=document.createElement("div"),f=$(b),l=1,k=1,e=document.createElement("div"),h=document.createElement("div"),q=c.get_help_URL&&c.get_help_URL(),g,n,t,v,r,m,z,G,M,C,E,B,I,D,Q,H,N=function(a){a?($(e).addClass("toontalk-green-flag-active toontalk-button").removeClass("toontalk-green-flag-inactive toontalk-button"),
$(h).addClass("toontalk-stop-sign-inactive toontalk-button").removeClass("toontalk-stop-sign-active toontalk-button")):($(e).addClass("toontalk-green-flag-inactive toontalk-button").removeClass("toontalk-green-flag-active toontalk-button"),$(h).addClass("toontalk-stop-sign-active toontalk-button").removeClass("toontalk-stop-sign-inactive toontalk-button"))};I=this.create_description_label(d,c);var L=function(){var b;b=c.get_running()?"To stop this click on the stop sign "+a.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):
c.can_run()?"Click this to start this running.":"There is nothing to run on this.";a.UTILITIES.give_tooltip(e,b)},P=function(){var b;b=c.get_running()?"Click to stop this from running.":c.can_run()?"This has stopped. Click on the flag "+a.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";a.UTILITIES.give_tooltip(h,b)},O=function(a){T?(Q=document.createElement("iframe"),$(Q).addClass("toontalk-help-frame"),Q.src=
q,document.body.appendChild(H),document.body.appendChild(Q),a.stopPropagation()):(D.href=q,D.target="_blank")},p,w,x,J,T,R;a.TRANSLATION_ENABLED&&q&&(q=a.UTILITIES.add_URL_parameter(q,"translate","1"));c.close_button_ok(b)&&(w=function(e){var g=function(){c.robot_in_training()&&c.robot_in_training()!==c&&c.robot_in_training().backside_closed(d);d.is_primary_backside()?d.hide_backside(e):d.remove()},p,k;c.get_running()?(p=c.get_backside_widgets(),p.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(g),
k=a,!0}),k?(k.add_body_finished_listener(function(){k.visible()?f.css({opacity:1}):(c.forget_backside(),a.DEFAULT_QUEUE.start());g()}),d.set_visible(!1)):g(),f.css({opacity:1}),f.addClass("toontalk-animating-element"),f.css({opacity:0}),a.UTILITIES.add_one_shot_event_handler(b,"transitionend",2E3,function(){c.forget_backside()})):g();e.stopPropagation()},p=(p=c.get_description())?"the "+c.get_type_name()+" who "+p:"the "+c.get_type_name(),B=a.UTILITIES.create_close_button(w,"Click to remove this backside of "+
p+"."),b.appendChild(B));$(e).addClass("toontalk-green-flag toontalk-green-flag-inactive");e.addEventListener("click",function(b){c.can_run()?(N(!0),c.set_running(!0),P(),a.DEFAULT_QUEUE.start()):c.is_top_level()?a.UTILITIES.display_message("There is nothing to run."):a.UTILITIES.display_message("This "+c.get_type_name()+" has nothing to run. Add some robots on the back.");c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-green-flag",c);b.stopPropagation()});e.addEventListener("mouseenter",
P);$(h).addClass("toontalk-stop-sign toontalk-stop-sign-active");h.addEventListener("click",function(b){N(!1);c.set_running(!1);L();c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-stop-sign",c);b.stopPropagation();c.is_top_level()&&a.UTILITIES.stop_audio_objects()});h.addEventListener("mouseenter",L);b.appendChild(e);b.appendChild(h);a.UTILITIES.use_custom_tooltip(e);a.UTILITIES.use_custom_tooltip(h);q&&(T=0>q.indexOf("://"),D=document.createElement(T?"div":"a"),$(D).addClass("toontalk-help-button notranslate toontalk-widget-help-button"),
D.addEventListener("click",O),D.innerHTML="i",D.translate=!1,a.UTILITIES.give_tooltip(D,"Click to learn more about "+c.get_type_name(!0,!0)+"."),H=document.createElement("div"),$(H).addClass("toontalk-close-help-frame-button").button(),H.addEventListener("click",function(a){$(Q).remove();$(H).remove();a.stopPropagation()}),H.innerHTML="Return to ToonTalk",b.appendChild(D));I&&b.appendChild(I);c.is_top_level()&&(v=document.createElement("div"),$(v).addClass("toontalk-settings-button"),v.addEventListener("click",
function(a){c.open_settings();a.stopPropagation()}),b.appendChild(v),a.UTILITIES.give_tooltip(v,"Click to change settings or open a different program."));f.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+c.get_type_name());f.css({"z-index":a.UTILITIES.next_z_index()});a.UTILITIES.when_attached(b,function(){var f;d.inside_conditions_container()?($(e).hide(),$(h).hide(),$(D).hide(),$(B).hide(),f="This will match "+d.toString()+".",d.rerender()):c.is_robot()?f="On the back of the robot you can change the conditions and setting of the robot.":
c.is_top_level()?f="This is a work area where you can drag things.":(R=c.toString({inside_tool_tip:!0}),f="You are pointing to the back of "+a.UTILITIES.add_a_or_an(R)+". You can put robots on the back to make it come 'alive'.");a.UTILITIES.give_tooltip(b,f)});d.get_element=function(){return b};d.get_backside_element=function(){return b};d.get_widget=function(){return c};d.visible=function(){return r};d.set_visible=function(a){r=a;!c.is_top_level()&&this.is_primary_backside()&&(this.get_widget().get_backside_widgets().forEach(function(b){b&&
b!==this&&b.set_visible(a)}.bind(this)),r&&this.render())};d.get_erased=function(){return g};d.set_erased=function(a,b,c){if(!a||c||this.inside_conditions_container())g=a,b&&this.rerender()};c.get_backside||(c.get_backside=function(){return d});d.is_primary_backside=function(){return this===this.get_widget().get_backside()};d.inside_conditions_container=function(){return $(this.get_element()).closest(".toontalk-conditions-panel, .toontalk-conditions-container").is("*")};d.get_width=function(){return a.UTILITIES.get_element_width(this.get_element())};
d.get_height=function(){return a.UTILITIES.get_element_height(this.get_element())};d.is_widget=!0;d.get_parent_of_backside=function(){return this.is_primary_backside()?c.get_parent_of_backside():t&&n?n.get_backside(!0):n};d.set_parent_of_backside=function(a,b){!a&&n&&t&&n.remove_backside_widget(this,!0);this.is_primary_backside()&&c.set_parent_of_backside(a,b);n=a;t=b};d.get_parent_of_frontside=function(){return c.get_parent_of_frontside()};d.is_parent_backside=function(){return c.is_parent_backside()};
d.get_frontside=function(a){return c.get_frontside(a)};d.get_frontside_element=function(a){return c.get_frontside_element(a)};d.get_description_text_area=function(){return x};d.set_description_text_area=function(a){x=a};d.get_name_text_input=function(){return J};d.set_name_text_input=function(a){J=a};d.removed_from_container=function(a,b,c,e){d.get_widget().robot_in_training()||this.remove_backside_widget(a,e)};d.drop_on=function(a,b,c){return a.widget_side_dropped_on_me(this,b,c)};d.widget_side_dropped_on_me=
function(e,f,d,g){var p,k,l;if(!d||d.visible()||this.visible())return this.visible()&&(a.sounds&&f&&a.sounds.drop.play(),p=e.get_element(this.visible()),e.rerender(),f?(b.appendChild(p),a.UTILITIES.set_position_is_absolute(p,!0,f)):(d&&(l=$(d.get_frontside_element()).offset()),l||(l=$(p).offset()),b.appendChild(p),!l||0===l.left&&0===l.top||a.UTILITIES.set_absolute_position(p,l))),this.get_widget().is_top_level()&&(d&&!d.visible()&&$(p).addClass("toontalk-widget-added-to-backside-by-unwatched-robot"),
!f||e.is_backside()||e.is_sensor()||window.dispatchEvent(a.UTILITIES.create_event("widget added",{element_widget:p,here:"back"}))),c.robot_in_training()&&!g&&f&&setTimeout(function(){c.robot_in_training().dropped_on(e,this,f)}.bind(this)),e.is_backside()&&e.get_widget().is_element()&&c.is_element()&&(g=e.get_widget(),g.set_backside(void 0),g.remove(f),g.set_backside(e)),this.add_backside_widget(e),e.dropped_on_other&&e.dropped_on_other(this,f,d),f&&e.get_body&&e.get_body().is_empty()&&!e.being_trained?
setTimeout(function(){(k=e.open_backside())&&$(k.get_element()).find(".toontalk-train-backside-button").click()}):f&&!e.is_backside()&&this.get_frontside_element()&&!e.is_sensor()&&this.get_frontside_element().dispatchEvent(a.UTILITIES.create_event("widget added",{element_widget:p,where:"back"})),f&&e.get_widget().backup_all(),!e.is_backside()&&e.is_robot()&&this.get_widget().get_running()&&!this.is_top_level()&&this.get_widget().set_running(!0),!0;this.add_backside_widget(e);e.dropped_on_other&&
e.dropped_on_other(this,f,d)};d.add_backside_widget=function(a){return this.get_widget().add_backside_widget(a)};d.add_backside_widgets=function(b,e){var f;0!==b.length&&(f=b.slice(),a.UTILITIES.set_timeout(function(){var d=this.visible(),g=this.get_element(),p,k,l,m;f.forEach(function(f,h){f&&(a.debugging&&f.get_widget()===c?(a.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),b.splice(h,1)):(e&&(l=e[h]),p=f.get_element(!0),p.parentElement||g.appendChild(p),p.toontalk_widget_side=
f,l&&(f.is_backside()?(k=f.get_widget().get_backside(!0),m={left:l.backside_left,top:l.backside_top,width:l.backside_width,height:l.backside_height},f.get_widget().apply_backside_geometry(),l.advanced_settings_open&&k.set_advanced_settings_showing(!0,k.get_element())):(0===l.frontside_width&&(l.frontside_width=""),0===l.frontside_height&&(l.frontside_height=""),m={left:l.frontside_left,top:l.frontside_top,width:p.style.transform?"":l.frontside_width||l.saved_width,height:p.style.transform?"":l.frontside_height||
l.saved_height}),a.UTILITIES.constrain_css_to_fit_inside(g,m),$(p).css(m)),f.set_visible(d),f.get_widget().rerender()))})}.bind(this),100))};d.get_backside_dimensions=function(){if(1!==l||1!==k)return{x_scale:l,y_scale:k,original_width:m,original_height:z}};d.set_dimensions=function(a){l=a.x_scale;k=a.y_scale;m=a.original_width;z=a.original_height};d.scale_to_fit=function(b,c){var e=a.UTILITIES.scale_to_fit(b,c,550,200);l=e.x_scale;k=e.y_scale};d.scale_to=function(b,c){var e=a.UTILITIES.scale_element(this.get_element(!0),
b,c,550,200);l=e.x_scale;k=e.y_scale};d.get_original_width=function(){return m};d.get_original_height=function(){return z};d.run_status_changed=function(a){N(a)};a.UTILITIES.when_attached(b,function(){var c,f,d,g;a.UTILITIES.get_element_width(b);a.UTILITIES.get_element_height(b);c=$(h).width();f=(f=$(B).width())?f+14:0;$(h).css({right:f});$(e).css({right:f+c+6});d=$(e).width();D&&($(D).css({right:f+c+d+12}),a.UTILITIES.use_custom_tooltip(D));v&&(g=$(D).width()||0,$(v).css({right:f+c+d+g+12}));B&&
a.UTILITIES.use_custom_tooltip(B)});d.save_dimensions=function(){G=l;M=k;return!0};d.restore_dimensions=function(){this.get_element();G&&(l=G);M&&(k=M);this.render_current_scale()};d.render_current_scale=function(){this.scale_backside(b,l,k,m,z);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();$(b).find("[title]").each(function(b,c){a.UTILITIES.use_custom_tooltip(c)})};d.compare_with=function(a){return this.get_widget().compare_with&&this.get_widget().compare_with(a)};
if(a.debugging||a.logging)d.to_debug_string=function(){return"backside of "+this.get_widget().to_debug_string()};b.toontalk_widget_side=d;a.UTILITIES.drag_and_drop(b);f.resizable({start:function(){C=a.UTILITIES.get_element_width(b);E=a.UTILITIES.get_element_height(b);m||(m=C);z||(z=E)},resize:function(a,b){var c=b.size.width,e=b.size.height;f.is(".toontalk-top-level-backside")||(l*=c/C,k*=e/E,C=c,E=e,d.render_current_scale())},handles:"e,s,se"});b.addEventListener("mouseenter",function(b){b=c.get_frontside();
var e=c.get_parent_of_backside();!b||e&&!e.get_widget().is_top_level()||a.UTILITIES.highlight_element(b.get_element())});b.addEventListener("mouseleave",function(b){c.is_top_level()||a.UTILITIES.remove_highlight()});d.update_display=function(){var a=this.get_description_text_area(),c=this.get_name_text_input(),e;a&&(e=this.get_widget().get_description())&&(a.button.value=e);c&&(c.button.value=this.get_widget().get_name());this.get_erased()?$(b).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():
$(b).find().show();d.display_updated()};d.display_updated=function(){$(this.get_element());m||(m=a.UTILITIES.get_element_width(b));z||(z=a.UTILITIES.get_element_height(b))};d.add_to_top_level_backside=function(a,b){return this.get_widget().add_to_top_level_backside(a,b)};c.get_backside_widgets&&(I=c.get_backside_widgets(),d.add_backside_widgets(I,c.get_backside_widgets_json_views()));a.debugging&&(b.id=c._debug_id,d._debug_id=c._debug_id,d._debug_string="backside of "+c._debug_string);return d},toString:function(){return this.get_erased()?
"any backside":"backside of "+this.get_widget()},get_full_description:function(a){return this.get_erased()?"any backside":"backside of "+this.get_widget().get_full_description(a)},remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(c,d){var b=a.UTILITIES.create_check_box(d.get_infinite_stack(),"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+d.get_type_name()+" to be copied instead of moved."),f=function(a){var b=
!d.get_infinite_stack(),c;d.set_infinite_stack(b);d.robot_in_training()&&(c=b?"change dragging to make a copy of ":"change dragging back to moving for ",d.robot_in_training().edited(d,{setter_name:"set_infinite_stack",argument_1:b,toString:c,button_selector:".toontalk-infinite-stack-check-box"}));a.stopPropagation()};b.button.addEventListener("click",f);b.button.addEventListener("touchstart",f);return b},create_parent_selection_check_box:function(c,d){var b=function(){var a=d.get_parent();if(a&&(a.is_nest()||
a.is_hole()||a.is_element()))return a.is_hole()?a.get_parent_of_frontside():a},f=b(),l=function(a){return"Drag the "+a.get_type_name()+" I'm on when dragging"},k=function(a){return"Check this if you want to drag the "+a.get_type_name()+" when you move this widget."},e,h;if(f){e=a.UTILITIES.create_check_box(d.get_infinite_stack(),"toontalk-parent-selection-check-box",l(f),k(f));var q=function(a){var c=b();c?(c!==a&&g(c),e.button.disabled=!1,$(e.label).removeClass("ui-state-disabled"),e.container.title=
k(c)):t()},g=function(a){e.label.innerHTML=l(a);e.button.innerHTML=k(a)},n=function(){q();return d},t=function(){e.button.checked=!1;e.button.disabled=!0;$(e.label).addClass("ui-state-disabled");e.container.title="Widget moved so this has been disabled. Close and re-open the backside to refresh."};h=function(a){var c=b();b()?(c!==f&&g(c),d.get_selection=e.button.checked?function(){var a=b();q();return a?a.get_selection():d}:n,a.stopPropagation()):t()};e.button.checked=d!==d.get_selection();e.button.checked||
(d.get_selection=n);e.button.addEventListener("click",h);return e}},create_click_opens_backside_check_box:function(c,d){var b=a.UTILITIES.create_check_box(d.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box","Mouse click opens this backside only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors."),f=function(a){var c=!d.get_open_backside_only_if_stopped(),e;d.set_open_backside_only_if_stopped(c);
b.button.checked=c;d.robot_in_training()&&(e=c?"change the response to a mouse click to open only if stopped the backside of ":"change the response to a mouse click to always open the backside of ",d.robot_in_training().edited(d,{setter_name:"set_open_backside_only_if_stopped",argument_1:c,toString:e,button_selector:".toontalk-click-opens-backside-check-box"}));a.stopPropagation()};b.button.addEventListener("click",f);b.button.addEventListener("touchstart",f);return b},create_description_label:function(c,
d){var b=d.get_description();if(b)return a.UTILITIES.create_text_element("I'm the backside of a "+d.get_type_name()+" that is "+b)},add_description_setting:function(c){var d=this.get_widget(),b=d.get_type_name(),f=a.UTILITIES.create_text_area(d.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+b+".",function(b){(b=a.UTILITIES.input_area_drop_handler(b,d.receive_description_from_dropped.bind(d),d))&&d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(b,
d,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})}),l=function(){var a=f.button.value.trim();d.set_description(a,!0)&&d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_description",argument_1:a,toString:"change the description to '"+a+"'' of the "+b,button_selector:".toontalk-description-input"})};$(f.button).val(d.get_description());f.button.addEventListener("change",l);f.button.addEventListener("mouseout",
l);this.set_description_text_area(f);(c||this.get_backside_element(!0)).appendChild(a.UTILITIES.create_row(f.container));d.get_description()||f.button.setAttribute("placeholder",d.get_default_description())},add_name_setting:function(c){var d=this.get_widget(),b=d.get_type_name(),f=a.UTILITIES.create_text_input(d.get_name(),"toontalk-name-input",d.get_name_input_label?d.get_name_input_label():"My name is ",d.get_name_input_title?d.get_name_input_title():"Edit the name of this "+b+". There is not much room so keep it short.",
void 0,"text",function(b){(b=d.receive_name_from_dropped&&a.UTILITIES.input_area_drop_handler(b,d.receive_name_from_dropped.bind(d),d))&&d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(b,d,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})}),l=function(){var a=f.button.value.trim();d.set_name&&d.set_name(a,!0)&&d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_name",argument_1:a,toString:"change the name to '"+
a+"'' of the "+b,button_selector:".toontalk-name-input"})};f.button.addEventListener("change",l);f.button.addEventListener("mouseout",l);this.set_name_text_input(f);(c||this.get_backside_element(!0)).appendChild(a.UTILITIES.create_row(f.container))},add_advanced_settings:function(){var c=this.get_widget(),d=this.create_infinite_stack_check_box(this,c),b=this.create_parent_selection_check_box(this,c),f=this.create_click_opens_backside_check_box(this,c),l=c.get_type_name(),k=$("<button>Make a sensor nest</button>").button(),
e=$("<button>Make a function bird</button>").button(),h=document.createElement("table"),q=this.get_element(),g=function(b,e){var f=c.get_parent_of_frontside(),d=b.get_frontside_element(!0),g;f&&f.add_backside_widget&&!f.get_widget().is_top_level()?(f.add_backside_widget(b),g=f.get_element(),g.appendChild(d),f=$(g).offset(),f.top+=.6*$(g).height()):(c.add_to_top_level_backside(b,!1),f=e.offset(),f.left-=120,0>f.left&&(f.left=0));a.UTILITIES.set_absolute_position(d,f)};$(q).find(".toontalk-settings-backside-button").get(0);
var n;$(h).addClass("toontalk-advanced-settings-table");k.addClass("toontalk-make-sensor_nest_button toontalk-button");k.get(0).addEventListener("click",function(b){var e=a.sensor.create("click","which",void 0,void 0,!0,c);g(e,k);c.robot_in_training()&&c.robot_in_training().created_widget(e,c,".toontalk-make-sensor_nest_button");b.stopPropagation()});k.attr("title","Click to create a nest which receives messages when events happen to this "+c.get_type_name()+".");e.addClass("toontalk-make-function_bird_button toontalk-button");
e.get(0).addEventListener("click",function(b){var f=c.get_function_type&&c.get_function_type(),f=a.bird.create_function(f||l);g(f,e);c.robot_in_training()&&c.robot_in_training().created_widget(f,c,".toontalk-make-function_bird_button");b.stopPropagation()});c.is_number()||c.is_box()||c.is_element()?e.attr("title","Click to get a bird that flies to functions of "+c.get_type_name(!0)+"."):(e.attr("title","There are no functions that operate on "+c.get_type_name(!0)+" (yet)."),e.button("option","disabled",
!0));if(0<arguments.length)for(n=0;n<arguments.length;n++)h.appendChild(arguments[n]);this.get_description_text_area()||this.add_description_setting(h);c.set_name&&!this.get_name_text_input()&&this.add_name_setting(h);h.appendChild(a.UTILITIES.create_row(k.get(0),e.get(0),d.container,b&&b.container,f.container));this.is_primary_backside()||(d=$("<button>Remove me and my widget</button>").button(),d.get(0).addEventListener("click",function(){c.robot_in_training()&&(c.robot_in_training().removed(c),
c.robot_in_training().removed(this));this.remove();c.remove()}.bind(this)),d.attr("title","Click to remove this "+c.get_type_name()+" and its backside."),d.addClass("toontalk-remove-backside-and-widget-buttton"),a.UTILITIES.use_custom_tooltip(d.get(0)),h.appendChild(d.get(0)));a.UTILITIES.use_custom_tooltip(k.get(0));a.UTILITIES.use_custom_tooltip(e.get(0));q.appendChild(h)},get_type_name:function(){return"backside of "+a.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(c){var d,
b,f,l,k,e,u;if(this.visible()&&(d=this.get_widget(),b=d.robot_in_training(),l=$(this.get_element()),b&&b.get_training_context()===d&&(b.hide_backside(),l.find(".toontalk-train-backside-button").click()),f=d.get_frontside_element(c&&d.get_parent_of_frontside()&&d.get_parent_of_frontside().is_top_level()),b=l.position(),k=l.parent().closest(".toontalk-backside"),e=function(b){var e=$(f).position(),k=function(){u&&(this.set_parent_of_backside(void 0,!0),u.is_backside()||u.removed_from_container(this,
c,void 0,!0),d.forget_backside&&d.forget_backside());b.remove()}.bind(this);a.UTILITIES.visible_element(b)?"0"===b.css("opacity")?(b.removeClass("toontalk-animating-element"),b.remove()):(b.addClass("toontalk-side-appearing"),a.UTILITIES.add_one_shot_event_handler(b.get(0),"transitionend",2500,k),a.UTILITIES.set_css(b,{left:e&&e.left,top:e&&e.top,opacity:.1})):k()}.bind(this),u=d.get_parent_of_backside(),a.UTILITIES.remove_highlight(),h(this),d.backside_geometry=this.get_backside_dimensions(),e(l),
this.set_visible(!1),c&&f&&!a.UTILITIES.visible_element(f)&&(b&&a.UTILITIES.set_css(f,{left:b.left,top:b.top}),!(l=a.UTILITIES.widget_side_of_jquery(k))||d.is_robot()&&l.get_widget().is_robot()&&d.get_first_in_team()===l.get_widget().get_first_in_team()||(l.widget_side_dropped_on_me(d),d.render())),d.get_backside_widgets()&&d.get_backside_widgets().forEach(function(a){a.set_visible(!1)}),d.on_backside_hidden))d.on_backside_hidden()},create_advanced_settings_button:function(c,d){var b=document.createElement("div"),
f=$(b),l=!1;b.innerHTML="&gt;";f.addClass("toontalk-settings-backside-button toontalk-button");f.css({"z-index":a.UTILITIES.next_z_index()});f.get(0).addEventListener("click",function(a){l=!l;c.set_advanced_settings_showing(l,c.get_element(),f);a.stopPropagation();d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-settings-backside-button",d)});a.UTILITIES.give_tooltip(f.get(0),"Click to see the advanced settings of this "+d.get_type_name()+".");return f.get(0)},set_advanced_settings_showing:function(c){var d=
this.get_element(),b=$(d).children(".toontalk-settings-backside-button"),f=$(d).children(".toontalk-advanced-settings-table");0===f.length&&this.add_advanced_settings&&(this.add_advanced_settings(),f=$(d).children(".toontalk-advanced-settings-table"));c?(f.show(),b.html("<"),a.UTILITIES.give_tooltip(b.get(0),"Click to hide the advanced settings.")):(f.hide(),b.html(">"),a.UTILITIES.give_tooltip(b.get(0),"Click to show the advanced settings."))},scale_backside:function(c,d,b,f,l){var k=Math.min(1,
d,b);1===d&&1===b?!this.get_parent()||this.get_parent().is_backside()?a.UTILITIES.set_css(c,{width:f,height:l,transform:"","transform-origin":""}):a.UTILITIES.set_css(c,{width:"",height:""}):a.UTILITIES.set_css(c,{transform:"scale("+k+", "+k+")","transform-origin":"left top",width:f*d/k,height:l*b/k})},render:function(){a.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&a.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(a,d){return this.get_widget().remove_backside_widget(a,
d)},top_level_widget:function(){return this.get_widget().top_level_widget()},robot_in_training:function(){return this.get_widget().robot_in_training()},remove:function(a){var d;this.is_primary_backside()?this.get_widget().remove():((d=this.get_parent_of_backside())&&(d.is_backside()?d.remove_backside_widget(this,!a):d.removed_from_container&&(d.is_backside()?d.remove_backside_widget(this,!0):d.removed_from_container(this,a))),this.set_parent_of_backside(void 0),(a=this.get_element())&&$(a).remove())},
match:function(a){var d;if(a.is_backside()){if(this.get_erased())return"matched";d=this.get_widget();a=d.match(a.get_widget());return a===d?this:a}a.last_match=this;return a},add_copy_to_container:function(a,d,b){return this.get_widget().add_copy_to_container(a||this.copy(),d,b)},has_ancestor:function(a){var d;return this===a?!0:(d=this.get_parent_of_backside())?d.has_ancestor(a):!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},
get_parent:function(){return this.get_parent_of_backside()},set_parent:function(a){this.set_parent_of_backside(a)},maintain_proportional_dimensions:function(){return!1},location_constrained_by_container:function(){return!1},set_running:function(){},dereference:function(){return this},is_of_type:function(a){return this.get_widget().is_of_type(a)},is_top_level:function(){return this.get_widget().is_top_level()},ok_to_set_dimensions:function(){return!1},add_listener:function(a,d){this.get_widget().add_listener(a,
d)},remove_listener:function(a,d,b){this.get_widget().remove_listener(a,d,b)},get_listeners:function(a){return this.get_widget().get_listeners(typee)},is_hole:function(){return!1},is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},is_robot:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},
get_infinite_stack:function(){return!1},drag_started:function(a,d){this.robot_in_training()&&this.robot_in_training().picked_up(this,a,d)},get_json:function(c,d,b){var f=this.get_backside_dimensions(),l=$(this.get_element()).position(),k;h(this);k=f?{width:f.original_width,height:f.original_height,transform:"scale("+f.x_scale+", "+f.y_scale+")","transform-origin":"left top 0px",left:l.left,top:l.top}:l;f=function(a,b){d({type:"backside",my_widget:a,css:k,erased:this.get_erased(),view:{}},b)}.bind(this);
a.UTILITIES.get_json(this.get_widget(),c,f,b)},get_selection:function(){return this}}}(window.TOONTALK);TOONTALK.creators_from_json.backside=function(a,h){var c=TOONTALK.UTILITIES.create_from_json(a.my_widget,h).create_backside(),d=c.get_element();TOONTALK.UTILITIES.set_css(d,a.css);a.erased&&c.set_erased(a.erased,!1,!0);return c};window.TOONTALK.frontside=function(a){return{create:function(h){var c=Object.create(this),d=document.createElement("div"),b=$(d),f=function(c){if(!($(c.target).is(".ui-resizable-handle")||"click"===c.type&&1!==c.which||h.get_open_backside_only_if_stopped()&&h.get_running())){if(b.is(".toontalk-top-level-resource")&&!c.altKey)h.set_running(!h.get_running());else{if(a.open_backside_only_if_alt_key&&!c.altKey)return;h.open_backside();h.robot_in_training()&&h.robot_in_training().backside_opened(h)}c.stopPropagation()}},
l;$(d).addClass("toontalk-frontside toontalk-side");h.get_infinite_stack()&&$(d).addClass("toontalk-infinite-stack");d.toontalk_widget_side=h;a.UTILITIES.drag_and_drop(d);c.get_element=function(){return d};c.get_widget=function(){return h};c.visible=function(){return l};c.set_visible=function(b){var c=this.get_widget();(l=b)&&a.UTILITIES.when_attached(this.get_element(!0),c.render.bind(c));c.walk_children&&c.walk_children(function(a){a.set_visible(b);return!0})};d.addEventListener("click",f);d.addEventListener("touchstart",
f);d.addEventListener("mouseenter",function(b){var c=h.get_backside(),f=(h.is_empty_hole()?wiget.get_parent_of_frontside():h).get_selection().get_frontside_element(),f=$(f);c&&a.UTILITIES.highlight_element(c.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");f.is(".toontalk-top-level-resource")||f.addClass("toontalk-wiggle");b.stopPropagation()});d.addEventListener("mouseleave",function(b){b=h.get_backside();var c=h.is_empty_hole()?wiget.get_parent_of_frontside():h;b&&a.UTILITIES.remove_highlight();
$(c.get_frontside_element()).removeClass("toontalk-wiggle")});a.debugging&&(d.id=h._debug_id);return c},update_display:function(){return this.get_widget().update_display()},remove:function(){var a=this.get_element();$(a).remove();a.toontalk_widget_side=null}}}(window.TOONTALK);(function(a){var h=180/Math.PI,c=Math.log(10),d=bigrat.fromInteger(10),b=bigrat.fromValues(1,2),f=bigrat.fromValues(-1,2),l=bigrat.fromInteger(360),k=bigrat.fromDecimal(2*Math.PI),e=Math.log10?Math.log10:function(a){return Math.log(a)/c},u=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},q=function(b){var c=u(b),e=a.number.ZERO(a.number.function_bird_results_default_format),f=a.number.ZERO(a.number.function_bird_results_default_format);
e.set_value(c.integer_part);f.set_value(c.fractional_part);return a.box.create(2,!0,[e,f],"The integer and fraction parts of "+b.toString().replace(",","/"))},g=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),e=u(c);return bigrat.multiply(c,e.fractional_part,b)},n=function(a){a=u(a);return bigrat.isLessThan(a.fractional_part,f)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.isLessThan(a.fractional_part,b)?a.integer_part:bigrat.add(a.integer_part,
a.integer_part,bigrat.ONE)},t=function(a){a=u(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},v=function(a){a=u(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)},r=function(a,b){var c=bigrat.power(bigrat.create(),d,b),e=bigrat.create(),f;bigrat.multiply(e,a,c);f=bigrat.fromValues(bigrat.toBigInteger(e),
1);bigrat.divide(e,f,c);return bigrat.equals(e,bigrat.ZERO)&&!bigrat.equals(a,bigrat.ZERO)?r(a,2*b):e};window.TOONTALK.number=function(){var b=Object.create(a.widget),c=function(a,b,c,e){var f="",d=100;c=50/c;b/=1+b;if(e)for(e=0;d>=c&&e<a.length;)f=f+"<span class='toontalk-digit' style='font-size:"+d+"%'>"+a[e]+"</span>",e+=1,"-"!==a[e]&&(d*=b);else for(e=a.length-1;d>=c&&0<e;)f="<span class='toontalk-digit' style='font-size:"+d+"%'>"+a[e]+"</span>"+f,--e,"-"!==a[e]&&(d*=b);return f},f=function(a,
b){return 0>a?0:Math.ceil(Math.log(.5/b)/Math.log(a/(1+a)))},g=function(a,b,e){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+g(a,1.25*b,.8*e)+"</span>";b=b/2-1;return c(a,b,e,!0)+c(a,b,e,!1)},k=function(a,b){bigrat.isNegative(a)&&bigrat.abs(a,a);var c;a:{c=bigrat.fromValues(a[0],1);var e=bigrat.fromValues(a[1],1);if(bigrat.equals(c,bigrat.ZERO))c="0";else{var f="",g=bigrat.create(),k=
bigrat.create(),p=bigrat.create();for(bigrat.multiply(c,c,d);b>f.length;){if(bigrat.isLessThan(c,e))f+="0";else if(bigrat.divide(g,c,e),k=bigrat.toBigInteger(g),f+=k.toString(),bigrat.subtract(p,g,bigrat.fromValues(k,1)),bigrat.multiply(c,p,e),bigrat.equals(c,bigrat.ZERO)){c=f=l(f);break a}bigrat.multiply(c,c,d)}c=f}}return c},l=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?l(a.substring(0,a.length-1)):a},h=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==
typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):bigrat.set(c,a,b);return c},n=function(b){switch(b){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return a.UTILITIES.report_internal_error("Number has an unsupported operator: "+
b),""}};b.default_format="mixed_number";b.function_bird_results_default_format="decimal";b.create=function(c,e,f,d,g,k){var l=Object.create(b),p=h(c,e);f||(f="+");l.is_number=function(){return!0};l.set_value=function(b,c){if(c||!bigrat.equals(p,b))return this.fire_value_change_listeners(p,b),p=b,this.rerender(),a.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===b.toString()&&a.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),
this};l.set_value_from_sub_classes=l.set_value;l.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),e;c&&(e={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(e)}))};l.get_value=function(){return p};l.set_value_from_decimal=function(b){this.set_value(bigrat.fromDecimal(b));a.debugging&&"0,0"===this.get_value().toString()&&a.UTILITIES.report_internal_error("Number being set to 0/0 from "+b)};l.copy=function(a){return this.add_to_copy(b.create(p[0],
p[1],f,d,g,k),a)};l.get_format=function(){return d||b.default_format};l.set_format=function(a,b){d=a;b&&this.rerender();return this};l.get_operator=function(){return f};l.set_operator=function(a,b){f=a;b&&this.rerender();return this};l.get_approximate=function(){return k};l.set_approximate=function(a,b){k=a;b&&this.rerender();return this};b.add_standard_widget_functionality(l);l.set_description(g);a.debugging&&(l._debug_string=l.toString(),l._debug_id=a.UTILITIES.generate_unique_id(),p._debug_id_new=
l._debug_id);return l};b.create_from_bigrat=function(b){var c=a.number.ZERO();c.set_value(b);return c};b.create_backside=function(){return a.number_backside.create(this)};b.set_from_values=function(a,b){return this.set_value(h(a,b))};b.set_numerator=function(a){return this.set_value(h(a,this.get_value()[1].toString()))};b.set_denominator=function(a){return this.set_value(h(this.get_value()[0].toString(),a))};b.ONE=function(){return a.number.create(1)};b.ZERO=function(b){return a.number.create(0,void 0,
void 0,b)};b.equals=function(a){return a.equals_number&&a.equals_number(this)};b.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};b.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};b.compare_with_number=function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};b.update_display=function(){var b=this.get_frontside(!0),c=function(a,b){var c=a.indexOf('style="');return 0<=
c?a.substring(0,c+7)+b+a.substring(c+7):a},e=28,f,d,g,k,p,l;a.logging&&0<=a.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());b=b.get_element();$(b).is(".toontalk-conditions-contents")?f=$(b):$(b).parent().is(".toontalk-backside, .toontalk-json")?(f=$(b),p=!0):$(b).parent().is(".toontalk-element-frontside")?(f=$(b),k=p=!0):f=$(b).parent().is(".toontalk-scale-half")?$(b):$(b).parent();0===f.length&&(e=this.get_parent_of_frontside())&&(e.get_widget().is_hole()&&
(e=e.get_parent_of_frontside()),f=$(e.get_frontside_element()));1===a.nest.CONTENTS_WIDTH_FACTOR&&1===a.nest.CONTENTS_HEIGHT_FACTOR&&f.is(".toontalk-nest")&&f.parent().is(".toontalk-box-hole")&&!f.parent().is(".toontalk-scale-half")&&(f=f.parent());if($(b).is(".toontalk-carried-by-bird"))g=d=100;else if($(b).is(".toontalk-held-by-robot"))d=76,g=55;else if($(b).is(".toontalk-element-attribute"))d=200,g=32;else if(p&&(b===f.get(0)||f.is(".toontalk-top-level-resource")))d=$(b).width(),g=$(b).height(),
d&&g||(d=this.saved_width||76,g=this.saved_heieght||55,$(b).css({width:d,height:g}));else{d=f.width();g=f.height();if(0===d||0===g){a.logging&&0<=a.logging.indexOf("display")&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());a.UTILITIES.is_attached(b)||a.UTILITIES.when_attached(b,this.update_display.bind(this));return}f.is(".toontalk-nest")&&(d*=a.nest.CONTENTS_WIDTH_FACTOR,g*=a.nest.CONTENTS_HEIGHT_FACTOR)}l=$(b).children(".toontalk-widget");l.is("*")?l=l.get(0):
(l=document.createElement("div"),b.appendChild(l));$(b).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");e=this.get_border_size(d,g);k||(4===e?$(b).addClass("toontalk-number-eighth-size-border toontalk-number"):8===e?$(b).addClass("toontalk-number-quarter-size-border toontalk-number"):16===e?$(b).addClass("toontalk-number-half-size-border toontalk-number"):$(b).addClass("toontalk-number-full-size-border toontalk-number"));
k=g-2*e;p=this.to_HTML(d/(.64*k),d,g,k,this.get_format(),!0,this.get_operator(),p);a.UTILITIES.on_a_nest_in_a_box(b)&&(p=c(p,"width:"+(d-2*e)+"px;"),p=c(p,"height:"+(g-2*e)+"px;"));l.innerHTML=p;l.translate=!1;$(l).addClass("toontalk-widget notranslate");f.is(".toontalk-box-hole")&&$(b).css({width:"",height:""});a.UTILITIES.give_tooltip(b,this.get_title())};b.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};b.to_HTML=function(b,l,h,m,t,q,v,p){var w,x,J,u,
R,y,F,E,B,W=!1!==q?" toontalk-top-level-number":"";y=4;F=b;this.is_attribute_widget&&this.is_attribute_widget()?W+=" toontalk-attribute-number":this.get_approximate()&&(W+=" toontalk-approximate-number");p&&(W+=" toontalk-number-size-unconstrained-by-container");J=v?n(v):"";F||(F=4);m||(m=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+W+'" style="font-size: '+m+'px;"></div>';if(0<J.length){--F;if(B="-"===v&&(this.is_negative()||this.is_zero())&&(this.is_integer()||
"improper_fraction"!==t&&"proper_fraction"!==t&&"mixed_number"!==t))--F,J+="&nbsp;";2>F&&(m*=Math.max(1,F)/2,F=2)}if(this.is_integer()&&"scientific_notation"!==t){try{w=bigrat.toBigInteger(this.get_value()).toString()}catch(na){a.UTILITIES.report_internal_error("Error converting number to a string: "+na),w="0"}q=w.length;0<J.length&&q++;4>F&&q>F&&(t=Math.min(4,q),m*=F/t,F=t);return'<div class="toontalk-number toontalk-integer'+W+'" style="font-size: '+m+'px;">'+J+g(w,F,m)+"</div>"}if(this.get_approximate()||
this.is_attribute_widget())if("decimal"===t?x=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===t&&(x=bigrat.toDecimal(this.get_value()).toExponential(),w=x.indexOf("e"),0<=w&&(u=x.substring(w+1),x=x.substring(0,w))),x)return q=x.length,F>q&&(F=q),0<J.length&&q++,u&&(F-=3+u.length/2),"scientific_notation"===t&&(y+=2),F<y&&q>F&&(t=Math.min(y,q),m=0>=F?Math.max(1,F)/t*m:Math.max(2,F)/t*m),F=u?'&times;10<sup style="font-size: '+m/2+'px;">'+u+"</sup>":"",m=Math.min(m,l/(.64*q)),'<div class="toontalk-number toontalk-approximate-number'+
W+'" style="font-size: '+m+'px;">'+J+'<div style="margin-top: '+(h-m)/2+'px">'+x+"</div>"+F+"</div>";x=' style="font-size:'+.4*m+'px;"';if("improper_fraction"===t||!t)return m='<table class="toontalk-number toontalk-improper-fraction'+W+'"'+x+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+g(this.numerator_string(),2*F,m)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+
g(this.denominator_string(),2*F,m)+"</td></tr></table>",""===J?m:"<table class='toontalk-operator-and-fraction'"+x+"><tr><td>"+J+"</td><td>"+m+"</td></tr></table>";if("mixed_number"===t||"proper_fraction"===t){J=this.integer_part();if(J.is_zero())return this.to_HTML(F,l,h,m,"improper_fraction",q,v);t=this.copy({just_value:!0}).subtract(J).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+W+'"'+x+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+J.to_HTML(F/
2,l,h,m,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+t.to_HTML(F/2,l,h,m,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===t)return 4>F&&(m*=Math.max(1,F)/4,F=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+W+'" style="font-size: '+m+'px;">'+J+this.decimal_string(F,m)+"</div>";if("scientific_notation"===t){w=bigrat.isNegative(this.get_value());y=this.get_value();B=bigrat.abs(bigrat.create(),y);u=bigrat.isLessThan(B,
bigrat.ONE);bigrat.equals(y,bigrat.ZERO)?u=0:(y=u?bigrat.toBigInteger(bigrat.divide(bigrat.create(),bigrat.ONE,B)):bigrat.toBigInteger(B),y=y.toString(),u=u?-y.length:y.length-1);R=bigrat.power(bigrat.create(),d,u+1);y=6+(0===u?1:Math.ceil(e(Math.abs(u)))/2);B=f(F-(Math.min(y,F/2)+1),m);E=r(this.get_value(),B+1);R=bigrat.divide(bigrat.create(),E,R);w&&y++;if(b<y+1)return this.to_HTML(y+1,l,h,m*b/(y+1),t,q,v,p);l=k(R,B);h=w?"-"+l.substring(0,1):l.substring(0,1);l=l.substring(1);F=c(l,F*(1-y/F),m,!0);
0<F.length&&(F="<span class='toontalk-decimal-point'>.</span>"+F);return'<table class="toontalk-number toontalk-scientific_notation'+W+'"'+x+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+W+'" style="font-size: '+.9*m+'px;">'+J+h+F+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+m+'px;"> &times;10<sup style="font-size: '+m/2+'px;">'+u+"</sup></div></td></tr></table>"}};
b.get_default_description=function(){return this.get_approximate()?"a number from an approximate calculation.":"a number."};b.drop_on=function(a,b,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b,c),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c);console.log("No handler for drop of '"+this+"' on '"+a+"'")};b.number_dropped_on_me=function(b,c,e){var f,d,g,k,p;if(!b.is_backside()){if(b.visible()&&this.visible()&&(c||e)){if(e){if(!e.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(b,
c,e);b.robot_waiting_before_next_step=e}f=document.createElement("div");$(f).addClass("toontalk-bammer-down");d=$(this.get_frontside_element()).closest(".toontalk-top-level-backside");f.style.left="-10px";f.style.top=d.height()+"px";0<d.length&&d.get(0).appendChild(f);k=this.get_frontside_element();g=$(k).offset();g.left-=.75*$(f).width();g.left+=.5*$(k).width()+.1*$(f).width();g.top-=.5*$(k).height()+.4*$(f).height();k=function(){a.sounds&&a.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(b,
c,e)&&e&&e.run_next_step();c&&this.backup_all();$(f).removeClass("toontalk-bammer-down");a.UTILITIES.set_timeout(function(){var b=d.offset();b||(b={left:0,top:0});$(f).addClass("toontalk-bammer-away");g.left=b.left+d.width()-100;g.top=b.top+d.height()+100;p=function(){$(f).remove()};a.UTILITIES.animate_to_absolute_position(f,g,p,e&&e.transform_animation_speed(a.UTILITIES.default_animation_speed));$(f).css({opacity:.01})})}.bind(this);a.UTILITIES.animate_to_absolute_position(f,g,k,e&&e.transform_animation_speed(a.UTILITIES.default_animation_speed));
$(f).css({opacity:1,"z-index":a.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(b,c,e)}};b.number_dropped_on_me_semantics=function(b,c,e){c&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,this);b.get_approximate()&&this.set_approximate(!0);b.remove();switch(b.get_operator()){case "+":return this.add(b);case "-":return this.subtract(b);case "*":return this.multiply(b);case "/":return this.divide(b);case "=":return this.set_value(b.get_value());
case "^":return this.power(b);default:a.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+b.get_operator())}};b.widget_side_dropped_on_me=function(a,b,c){return a.number_dropped_on_me?this.number_dropped_on_me(a,b,c):!1};b.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),
this.get_value(),a.get_value()),!0);return this};b.divide=function(a){this.set_value(bigrat.divide(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};b.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),
!0);return this};b.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};b.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};b.is_negative=function(){return bigrat.isNegative(this.get_value())};b.toString=function(){return this.get_erased()?"erased number":("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};b.operator_word=function(a){switch(this.get_operator()){case "+":return"add "+a+" to";case "-":return"subtract "+
a+" from";case "*":return"multiply "+a+" with";case "/":return"divide "+a+" into"}};b.get_text=function(){var a=this.get_format(),b;if(this.get_approximate()||this.is_attribute_widget&&this.is_attribute_widget())return"approximately "+bigrat.toDecimal(this.get_value()).toString();if(this.is_integer()||"improper_fraction"===a)return this.toString();a=this.integer_part();if(a.is_zero())return this.toString();b=this.copy({just_value:!0}).subtract(a).absolute_value();return a+" "+b};b.to_float=function(){return bigrat.toDecimal(this.get_value())};
b.get_type_name=function(a){return a?"numbers":"number"};b.get_help_URL=function(){return"docs/manual/numbers.html"};b.get_json=function(a,b,c){b({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string(),format:this.get_format(),approximate:this.get_approximate()},c)};a.creators_from_json.number=function(a){return b.create(a.numerator,a.denominator,a.operator,a.format,a.description,a.approximate)};b.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||
0===this.get_value()[0].compare(BigInteger.ZERO)};b.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};b.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};b.numerator_string=function(){return this.get_value()[0].toString()};b.denominator_string=function(){return this.get_value()[1].toString()};b.integer_part=function(){return this.create(this)};b.decimal_string=function(a,e){var d,l,h,n,t;if(this.is_integer())return this.numerator_string();
d=this.get_value();l=b.create(d[0],d[1]);h=l.integer_part();d=h.toString();"0"===d&&this.is_negative()&&(d="-"+d);l=l.get_value();bigrat.subtract(l,l,h.get_value());n=a-(Math.min(d.length,a/2)+1);t=f(n,e);h=Math.min(d.length,a/2);l=k(l,t);l=l.length<n?l:c(l,n,e,!0);return g(d,h,e)+"<span class='toontalk-decimal-point'>.</span>"+l};b.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_number)return a.match_with_any_number();this.last_match=a;return this}return a.match_with_this_number?
a.match_with_this_number(this):(this.last_match=a,this)};b.match_with_any_number=function(){return"matched"};b.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===this.get_operator())return"matched";a.last_match=this;return a};b.get_custom_title_prefix=function(){var b;b="="===this.get_operator()?"Drop me on another number I'll give him my value.":"/"===this.get_operator()?"Drop me on another number I'll divide him by my value.":"Drop me on another number and I'll "+this.operator_word("myself")+
" him.";this.get_approximate()&&(b+="\nI look a bit yellow because I'm the result of an "+a.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return b};return b}();window.TOONTALK.number_backside=function(){return{create:function(b){var c=a.backside.create(b),e=c.get_element(),f=document.createElement("div"),d=b.numerator_string(),g=b.denominator_string(),k=a.UTILITIES.create_text_area(d,"toontalk-numerator-input","","Type here to edit the numerator",void 0,"number"),l=a.UTILITIES.create_text_area(g,
"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),h=a.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal.",!0),n=a.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction.",!0),t=a.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button",
"Improper fraction","Display number as a simple fraction.",!0),q=a.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",!0),r=a.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",!0),u=a.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",
!0),v=a.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),p=a.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","I will divide what I'm dropped on.",!0),w=a.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",!0),x=function(c){var e=k.button.value.trim(),f=l.button.value.trim(),p,h,n,w,x=function(a,b,c){if(1>
a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:x(a,b).replacement};a=x(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,"")}},t;if(e!==d||f!==g){t=x(e,"numerator");t.message&&
(p=parseFloat(e),isNaN(p)?(a.UTILITIES.display_message(t.message),e=t.replacement):h=bigrat.fromDecimal(p));"0"===f?(a.UTILITIES.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1."),f="1"):(t=x(f,"denominator"),t.message&&(n=parseFloat(f),isNaN(n)?(a.UTILITIES.display_message(t.message),f=t.replacement||"1"):w=bigrat.fromDecimal(n)));if(h&&w)b.set_value(bigrat.divide(b.get_value(),h,w),!0);else if(h)b.set_value(bigrat.divide(b.get_value(),h,bigrat.fromValues(f,
1)),!0);else if(w)b.set_value(bigrat.divide(b.get_value(),bigrat.fromValues(e,1),w),!0);else if(!b.set_from_values(e,f)&&!isNaN(n))return;d=b.numerator_string();g=b.denominator_string();b.robot_in_training()&&(c=c.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===c?b.robot_in_training().edited(b,{setter_name:"set_denominator",argument_1:f,toString:"by changing the value of the denominator to "+f,button_selector:"."+c}):b.robot_in_training().edited(b,{setter_name:"set_numerator",
argument_1:e,toString:"by changing the value of the numerator to "+e,button_selector:"."+c}));b.rerender()}},J=function(){var c=a.UTILITIES.selected_radio_button(h.button,n.button,t.button,q.button),e=c.value;b.set_format(e,!0);b.robot_in_training()&&b.robot_in_training().edited(b,{setter_name:"set_format",argument_1:e,toString:"by changing the format to "+e+" of the number",button_selector:"."+c.className.split(" ",1)[0]});b.rerender()},T=function(){var c=a.UTILITIES.selected_radio_button(r.button,
u.button,v.button,p.button,w.button),e=c.value;b.set_operator(e,!0);b.robot_in_training()&&b.robot_in_training().edited(b,{setter_name:"set_operator",argument_1:e,toString:"by changing the operator to "+e+" of the number",button_selector:"."+c.className.split(" ",1)[0]})},R=a.UTILITIES.create_horizontal_table(k.container,f,l.container),y=a.UTILITIES.create_horizontal_table(h.container,n.container,t.container,q.container),F=a.UTILITIES.create_horizontal_table(r.container,u.container,v.container,p.container,
w.container),ba=a.backside.create_advanced_settings_button(c,b),da=c.update_display.bind(c),W=c.add_advanced_settings;f.innerHTML="/";$(f).addClass("ui-widget");k.button.addEventListener("change",x);k.button.addEventListener("mouseout",x);k.button.addEventListener("mouseenter",function(){d=k.button.value.trim()});l.button.addEventListener("change",x);l.button.addEventListener("mouseout",x);l.button.addEventListener("mouseenter",function(){g=l.button.value.trim()});e.appendChild(R);e.appendChild(ba);
h.button.addEventListener("change",J);n.button.addEventListener("change",J);t.button.addEventListener("change",J);q.button.addEventListener("change",J);switch(b.get_format()){case "decimal":a.UTILITIES.check_radio_button(h);break;case "improper_fraction":a.UTILITIES.check_radio_button(t);break;case "mixed_number":case "proper_fraction":a.UTILITIES.check_radio_button(n);break;case "scientific_notation":a.UTILITIES.check_radio_button(q)}switch(b.get_operator()){case "+":a.UTILITIES.check_radio_button(r);
break;case "-":a.UTILITIES.check_radio_button(u);break;case "*":a.UTILITIES.check_radio_button(v);break;case "/":a.UTILITIES.check_radio_button(p);break;case "=":a.UTILITIES.check_radio_button(w)}r.button.addEventListener("change",T);u.button.addEventListener("change",T);v.button.addEventListener("change",T);p.button.addEventListener("change",T);w.button.addEventListener("change",T);c.update_display=function(){$(k.button).val(b.numerator_string());$(l.button).val(b.denominator_string());da()};c.add_advanced_settings=
function(){W.call(c,y,F);$(y).buttonset();$(F).buttonset()};a.UTILITIES.when_attached(e,function(){c.is_primary_backside()||b.add_listener("value_changed",function(){c.rerender()})});return c}}}();window.TOONTALK.number["function"]=function(){var b=a.create_function_table(),c=function(a){return bigrat.toDecimal(g(a,l))},e=function(a){return bigrat.toDecimal(g(a,k))},f=function(){return!0};b.add_function_object("sum",function(c,e,f){return b.n_ary_widget_function(c,a.number.ZERO,a.number.add,"sum",
e,f)},"The bird will return with the sum of the numbers in the box.","+");b.add_function_object("difference",function(c,e,f){return b.n_ary_widget_function(c,a.number.ZERO,a.number.subtract,"difference",e,f)},"The bird will return with the result of subtracting the numbers in the box from the first number.","-");b.add_function_object("product",function(c,e,f){return b.n_ary_widget_function(c,a.number.ONE,a.number.multiply,"product",e,f)},"The bird will return with the product of the numbers in the box.",
"\u00d7");b.add_function_object("division",function(c,e,f){return b.n_ary_widget_function(c,a.number.ONE,a.number.divide,"division",e,f)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00f7");b.add_function_object("modulo",function(a,c,e){return b.n_ary_function(a,b.bigrat_function_to_widget_function(g),2,"modulo",c,e)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.",
"mod");b.add_function_object("minimum",function(c,e,f){return b.n_ary_widget_function(c,a.number.ONE,a.number.minimum,"minimum",e,f)},"The bird will return with the smallest of the numbers in the box.","min");b.add_function_object("maximum",function(c,e,f){return b.n_ary_widget_function(c,a.number.ONE,a.number.maximum,"maximum",e,f)},"The bird will return with the largest of the numbers in the box.","max");b.add_function_object("absolute value",function(c,e,f){return b.n_ary_function(c,function(b){var e=
a.number.ZERO(c.get_hole_contents(1).get_format());bigrat.abs(e.get_value(),b);return e},1,"absolute value",e,f)},"The bird will return with the positive version of the number.","abs");b.add_function_object("power",function(a,c,e){return b.n_ary_function(a,b.bigrat_function_to_widget_function(function(a,b){var c=bigrat.power(bigrat.create(),a,b[0].valueOf()),e=b[1].valueOf();return 1===e?c:bigrat.nthRoot(bigrat.create(),c,e)},function(a){return 0!==a[1][1].compare(BigInteger.ONE)}),2,"power",c,e)},
"The bird will return with the first number to the power of the second number.");b.add_function_object("logarithm",function(a,c,e){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},f),1,"logarithm",c,e)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).",
"log");b.add_function_object("random",function(a,c,e){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c,e)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.",
"rand");b.add_function_object("round",function(a,c,e){return b.n_ary_function(a,b.bigrat_function_to_widget_function(n),1,"round",c,e)},"The bird will return the number rounded to the nearest integer.");b.add_function_object("floor",function(a,c,e){return b.n_ary_function(a,b.bigrat_function_to_widget_function(t),1,"floor",c,e)},"The bird will return the largest integer less than or equal to the number.");b.add_function_object("ceiling",function(a,c,e){return b.n_ary_function(a,b.bigrat_function_to_widget_function(v),
1,"ceiling",c,e)},"The bird will return the smallest integer greater than or equal to the number.","ceil");b.add_function_object("delay",function(c,e,f){var d=Date.now(),g=b.check_message(c),k;if(g)if(2>g.size)a.UTILITIES.display_message("Delay function birds need a number in the second hole.");else return k=c.get_hole_contents(1).to_float(),setTimeout(function(){var k=a.number.ZERO(a.number.function_bird_results_default_format);k.set_value_from_decimal((Date.now()-d)/1E3);k.set_approximate(!0);b.process_response(k,
g.bird,c,e,f)},1E3*k),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");b.add_function_object("integer and fraction parts",function(a,c,e){return b.n_ary_function(a,q,1,"integer and fraction parts",c,e)},"The bird will return with a box containing the integer part and the fraction.","parts");b.add_function_object("sine",function(a,e,f){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/
h)},!0,c),1,"sine",e,f)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");b.add_function_object("cosine",function(a,e,f){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/h)},!0,c),1,"cosine",e,f)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");b.add_function_object("arc tangent",function(a,c,e){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(function(a){return h*
Math.atan(a)},!0),1,"arc tangent",c,e)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.","atan");b.add_function_object("arc tangent of y and x",function(a,c,e){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(function(a,b){return h*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c,e)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.",
"atan2");b.add_function_object("sine (in radians)",function(a,c,f){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(Math.sin,!0,e),1,"sine (in radians)",c,f)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");b.add_function_object("cosine (in radians)",function(a,c,f){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(Math.cos,!0,e),1,"cosine (in radians)",c,f)},"The bird will return with an approximation of the cosine of the number (in radians).",
"cos rad");b.add_function_object("arc tangent (in radians)",function(a,c,e){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(Math.atan,!0),1,"arc tangent (in radians)",c,e)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");b.add_function_object("arc tangent of y and x (in radians)",function(a,c,e){return b.n_ary_function(a,b.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",
c,e)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.","atan2 rad");return b.get_function_table()}()})(window.TOONTALK);(function(a){var h=function(c,d,b,f){var l;c&&0<=b&&c.maintain_proportional_dimensions()&&c.get_default_width?(l=c.get_default_width(),c=c.get_default_height(),b/l>=f/c?(l=l*f/c,b={left:(b-l)/2,top:0,width:l,height:f}):(l=c*b/l,b={left:0,top:(f-l)/2,width:b,height:l})):(c.is_backside()&&(c.update_display(),c.scale_to(b,.92*f)),b={left:0,top:0});a.UTILITIES.set_css(d,b)};window.TOONTALK.box=function(a){var d=Object.create(a.widget);d.create=function(b,f,l,k,e){var u=Object.create(d),q=[];"undefined"===
typeof f&&(f=!0);u.is_box=function(){return!0};u.get_horizontal=function(){return f};u.set_horizontal=function(a,b){f=a;b&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());return this};u.get_hole=function(a){return q[a]};u.get_hole_contents=function(a){return q[a]&&q[a].get_contents()};u.set_hole=function(b,e,f){var d;q[b].set_contents(e);if(f){e&&e.save_dimensions();f=this.get_frontside_element();b=$(f).children(".toontalk-hole-number-"+b);b.empty();if(!e)return;
d=this.get_hole_dimensions();f=e.get_element(!0);0<b.length&&b.get(0).appendChild(f);h(e,f,d.width,d.height);e.rerender()}this.rerender();a.debugging&&(this._debug_string=this.to_debug_string())};u.get_holes=function(){return q};u.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=
void 0}.bind(this)};u.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};u.set_contents=function(a){a.forEach(function(a,b){q[b].set_contents(a)})};u.get_size=function(){return b};u.set_size=function(e,f){var d,k;if(b===e||0>e||isNaN(e))return!1;k=this.visible();q.length=e;if(e>b)for(d=b;d<e;d++)q[d]=a.box_hole.create(d),q[d].set_parent_of_frontside(u),q[d].set_visible(k);b=e;f&&this.rerender();a.debugging&&(this._debug_string=
this.to_debug_string());return!0};u.get_hole_dimensions=function(){var e=this.get_frontside_element(),d=$(e).width()||a.box.get_default_width(),e=$(e).height()||a.box.get_default_height();return f?{width:d/b,height:e}:{width:d,height:e/b}};u.receive_size_from_dropped=function(b,e){var f;if(b.is_number())return f=a.number.create(this.get_size()),f.number_dropped_on_me_semantics(b),f=Math.max(0,Math.round(f.to_float())),this.set_size(f),f.toString()};u.copy=function(a){var c;a||(a={});c=q.map(function(b){if(b=
b.get_contents())return b.copy(a)});c=d.create(b,f,c,this.get_description(),this.get_name());return this.add_to_copy(c,a)};u.generate_name=function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};u.add_standard_widget_functionality(u);u.has_name(u);u.set_name(e);for(e=0;e<b;e++)q[e]=a.box_hole.create(e),q[e].set_parent_of_frontside(u);u.set_description(k);l&&u.set_contents(l);a.debugging&&(u._debug_id=a.UTILITIES.generate_unique_id(),u._debug_string=u.to_debug_string());return u};d.create_backside=
function(){return a.box_backside.create(this)};d.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&a.equals_box(this)};d.equals_box=function(a){var c=this.get_size(),d,k,e;if(c!==a.get_size())return!1;for(d=0;d<c;d++)if(k=this.get_hole_contents(d),e=a.get_hole_contents(d),!k&&e||k&&!e||k&&e&&(!k.equals||!k.equals(e)))return!1;return!0};d.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};d.compare_with_box=function(a){var c=this.get_size(),
d=a.get_size(),k,e;if(c>d)return 1;if(c<d)return-1;for(d=0;d<c;d++){k=this.get_hole_contents(d);e=a.get_hole_contents(d);if(k&&!e)return 1;if(!k&&e)return-1;if(k&&e)if(k.compare_with){if(k=k.compare_with(e),1===k||-1===k)return k}else return}return 0};d.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_box)return a.match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=a,this)};d.match_with_any_box=function(){return"matched"};
d.match_with_this_box=function(b){var f=this.get_size(),d=[],k,e,h;if(f!==b.get_size())return b.last_match=this,b;for(k=0;k<f;k++)if(h=b.get_hole_contents(k))if(e=this.get_hole_contents(k)){e=a.UTILITIES.match(h,e);if(e.is_widget)return e;"matched"!==e&&(d=0===d.length?e:d.concat(e))}else if(e=this.get_contents_temporarily_removed(k))d.push(e);else return b.last_match=this,b;return 0<d.length?d:"matched"};d.toString=function(a){var c="",d=this.get_size(),k,e,h=this.get_type_name()+" that looks like ";
for(k=0;k<d;k++)e=this.get_hole(k),c+=e.get_full_description(a),k<d-1&&(c+=" | ");return h+"["+c.replace(h,"")+"]"};d.get_type_name=function(a){return a?"boxes":"box"};d.get_default_description=function(){return"a box for holding things."};d.get_help_URL=function(){return"docs/manual/boxes.html"};d.get_json=function(b,f,d){var k=[],e=function(d,l){var g,h;d>=this.get_size()?f({type:"box",size:this.get_size(),contents:k,horizontal:this.get_horizontal(),name:this.get_name()},l):(g=this.get_hole_contents(d))?
g.is_primary_backside&&g.is_primary_backside()?(h=function(a,b){k.push({widget:a,is_backside:!0});e(d+1,b)}.bind(this),a.UTILITIES.get_json(g.get_widget(),b,h,l)):g.is_widget?(h=function(a,b){k.push({widget:a});e(d+1,b)}.bind(this),a.UTILITIES.get_json(g,b,h,l)):(h=function(a,b){k.push(a);e(d+1,b)}.bind(this),g.get_json(b,h,l)):(k.push(null),e(d+1,l))}.bind(this);e(0,d)};d.walk_children=function(a){var c=this.get_size(),d;for(d=0;d<c&&a(this.get_hole(d));d++);};a.creators_from_json.box=function(b,
f){return d.create(b.size,b.horizontal,a.UTILITIES.create_array_from_json(b.contents,f),b.description,b.name)};d.update_display=function(){var b=this.get_frontside(!0).get_element(),f=this.get_size(),d=function(b,e,d){var g=e.get_contents(),l=(g||e).get_element(!0),n=$(b).parents(".toontalk-box-hole"),u=function(){$(b).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(N/=a.nest.CONTENTS_WIDTH_FACTOR,L/=a.nest.CONTENTS_HEIGHT_FACTOR)},v,H,N,L;k?(H=0,0<n.length?(N=t-2*z/f,L=r-2*z):
(N=t,L=r),u(),v=N*d,1<d&&(v+=z*(d-1))):(v=0,0<n.length?(N=t-2*z,L=r-2*z/f):(N=t,L=r),u(),H=L*d,1<d&&(H+=z*(d-1)));a.UTILITIES.set_css(b,{left:v,top:H,width:N,height:L});q[d]&&b.setAttribute("toontalk_name",q[d]);!a.UTILITIES.has_animating_image(l)&&0<d&&($(b).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(b).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),
k?$(b).addClass(m+"-left"):$(b).addClass(m+"-top"));b!==l&&(h(g,l,N,L),b.appendChild(l),e.get_contents().rerender());e.is_element()&&(e=e.get_contents(),e.set_size_attributes(N,L,!0))},k=this.get_horizontal();$(b).is(".toontalk-box");var e=function(){var e=$(b).children(".toontalk-box-hole");$(b).parent(".toontalk-conditions-container").is("*")||$(b).parent().is(".toontalk-scale-half")||($(b).parent(".toontalk-box-hole").is("*")?a.UTILITIES.set_css(b,{width:"",height:""}):a.UTILITIES.set_css(b,{width:n,
height:v}));e.length===f?e.each(function(a,b){var c=this.get_hole(a);c&&d(b,c,a)}.bind(this)):(e.remove(),this.get_holes().forEach(function(a,c){g=a.get_element();$(g).addClass("toontalk-hole-number-"+c);d(g,a,c);b.appendChild(g)}))}.bind(this),u=function(){var e=function(a){if(a.parentElement)return $(a.parentElement).is(".toontalk-box-hole")?a.parentElement:e(a.parentElement)},d=e(b)||b,d=$(b).parent().is(".toontalk-scale-half")?b:d;n=0===f?0:$(d).width()||this.saved_width||a.box.get_default_width();
v=$(d).height()||this.saved_height||a.box.get_default_height();k?(t=0===f?0:n/f,r=v):(t=n,r=v/f)}.bind(this),q=this.get_name().split(";"),g,n,t,v,r,m,z;a.logging&&0<=a.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(b).addClass("toontalk-box");$(b).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");a.UTILITIES.give_tooltip(b,this.get_title());a.debugging&&(this._debug_string=
this.to_debug_string());this.get_erased()?($(b).addClass("toontalk-box-erased"),$(b).children(".toontalk-side").remove()):($(b).removeClass("toontalk-box-erased"),u(),z=this.get_border_size(t,r),m=4===z?"toontalk-box-eighth-size-border":8===z?"toontalk-box-quarter-size-border":16===z?"toontalk-box-half-size-border":"toontalk-box-full-size-border",k?t-=(f-1)*z/f:r-=(f-1)*z/f,$(b).addClass(m),a.UTILITIES.set_timeout(e))};d.get_default_width=function(){return 164};d.get_default_height=function(){return 68};
d.get_border_size=function(a,c){var d;if(0===a)return d=$(this.get_frontside_element()).width(),16>=d?4:32>=d?8:64>=d?16:32;a||(a=$(this.get_frontside_element()).width());c||(c=$(this.get_frontside_element()).height());return 32>=a||32>=c?4:64>=a||64>=c?8:128>=a||128>=c?16:32};d.get_name_input_label=function(){return"The labels of my holes are"};d.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};d.drop_on=function(a,
c,d){if(a.box_dropped_on_me)return d=a.box_dropped_on_me&&a.box_dropped_on_me(this,c,d),c&&a.rerender(),d&&this.remove(),d;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,c,d);console.log("No handler for drop of "+this+" on "+a)};d.box_dropped_on_me=function(a,c){console.log("box on box not yet implemented");return!1};d.widget_side_dropped_on_me=function(b,f,d){var k=this.which_hole(f),e;if(0<=k)return e=this.get_hole(k),(k=e.get_contents())?b.drop_on(k,f,d):e.widget_side_dropped_on_me(b,
f,d);a.UTILITIES.report_internal_error(b+" dropped on "+this+" but no event was provided.")};d.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};d.removed_from_container=function(a,c){var d=!!c,k=this.get_index_of(a);0<=k&&(this.set_hole(k,void 0,d),d&&(this.rerender(),a.restore_dimensions()))};d.get_path_to=function(b,f){var d=this.get_size(),k,e;if("empty hole"===b.get_type_name()){d=b.get_parent_of_frontside();
e=a.box.path.create(b.get_index());if(d===this)return e;d=this.get_path_to(d);if(!d)return;d.next=e;return d}for(k=0;k<d;k++)if(e=this.get_hole_contents(k)||this.get_contents_temporarily_removed(k)){if(b===e||e.top_contents_is&&e.top_contents_is(b))return a.box.path.create(k);if(e.get_path_to&&(e=e.get_path_to(b,f)))return d=a.box.path.create(k),d.next=e,d}};d.element_to_highlight=function(a){a=this.which_hole(a,!0);var c;if(0>a||0===this.get_size())return this.get_frontside_element();a=this.get_hole(a);
return(c=a.get_contents())?c.get_frontside_element():a.get_frontside_element()};d.which_hole=function(a){var c=this.get_horizontal(),d=this.get_frontside_element(),k=this.get_size(),e,h;if(0!==k&&(e=$(d).offset(),d=c?$(d).width()/k:$(d).height()/k,h=c?e.left:e.top,a))for(e=0;e<k;e++)if(h+=d,(c?a.pageX<=h:a.pageY<=h)||e+1===k)return e};d.dereference_path=function(b,d){var l,k;if(b){l=b.get_index&&b.get_index();if(!a.debugging||"number"===typeof l){if(k=this.get_hole_contents(l)){if(k.dereference_contents&&
!b.not_to_be_dereferenced)return k.dereference_contents(b.next||b,d);if(b.next){if(k.dereference_path)return k.dereference_path(b.next,d);a.UTILITIES.report_internal_error("Expected to refer to a part of "+k+" but it lacks a method to obtain "+a.path.toString(b.next))}b.removing_widget&&("empty hole"===k.get_type_name()?a.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):k.get_infinite_stack()||d.remove_from_container(k,this));return k}return this.get_hole(l)}a.UTILITIES.report_internal_error(this+
" unable to dereference the path: "+a.path.toString(b))}else return this};d.path={create:function(b){return{get_index:function(){return b},toString:function(){return"scale"===this.true_type?0===b?"the left pan ":"the right pan ":"the "+a.UTILITIES.ordinal(b)+" hole "},get_json:function(a,c,d){var e=function(a,e){c({type:"box_path",index:b,true_type:this.true_type,next:a},e)}.bind(this);this.next?this.next.get_json(a,e,d):e(void 0,d)}}}};d.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};
a.creators_from_json.box_path=function(b,f){var l=d.path.create(b.index);b.next&&(l.next=a.UTILITIES.create_from_json(b.next,f));b.true_type&&(l.true_type=b.true_type);return l};return d}(window.TOONTALK);window.TOONTALK.box_backside=function(a){return{create:function(d){var b=a.backside.create(d),f=a.UTILITIES.create_text_input(d.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(b){if(b=a.UTILITIES.input_area_drop_handler(b,
d.receive_size_from_dropped.bind(d),d))d.rerender(),d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(b,d,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),l=a.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-radio-button","Left to right","Show box horizontally.",!0),k=a.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-radio-button","Top to bottom","Show box vertically.",!0),e=function(){var a=
parseInt(f.button.value.trim(),10);d.set_size(a,!0)&&d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_size",argument_1:a,toString:"by changing the number of holes to "+a+" of the box",button_selector:".toontalk-box-size-input"})},h=function(){var b=a.UTILITIES.selected_radio_button(l.button,k.button),e=b.value,f="horizontal"===e;d.set_horizontal(f,!0);d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_horizontal",argument_1:f,toString:"by changing the orientation to "+
e+" of the box",button_selector:"."+b.className.split(" ",1)[0]})},q=b.get_element(),g=a.backside.create_advanced_settings_button(b,d),n=b.update_display.bind(b),t=a.UTILITIES.create_horizontal_table(l.container,k.container);f.button.addEventListener("change",e);f.button.addEventListener("mouseout",e);l.button.addEventListener("change",h);k.button.addEventListener("change",h);b.update_display=function(){f.button.value=d.get_size().toString();d.get_horizontal()?a.UTILITIES.check_radio_button(l):a.UTILITIES.check_radio_button(k);
n()};q.appendChild(f.container);q.appendChild(t);$(t).buttonset();q.appendChild(g);b.rerender();return b}}}(window.TOONTALK);window.TOONTALK.box_hole=function(a){return{create:function(d){var b=Object.create(this),f,l,k;b.is_hole=function(){return!0};b.is_empty_hole=function(){return!f};b.location_constrained_by_container=function(){return!1};b.get_element=function(){k||(k=document.createElement("div"),k.className="toontalk-box-hole toontalk-frontside toontalk-side",k.toontalk_widget_side=b);return k};
b.get_frontside=function(a){return f?f.get_frontside(a):this.get_element()};b.get_frontside_element=function(a){return this.get_element()};b.get_frontside=function(){return this};b.widget_side_dropped_on_me=function(b,d,f){var g=this.get_parent_of_frontside(),k=this.get_contents(),l,h,r;if(k)return k.widget_side_dropped_on_me&&k.widget_side_dropped_on_me(b,d,f);b.dropped_on_other&&b.dropped_on_other(this,d,f);d?(a.sounds&&a.sounds.fall_inside.play(),f=this.get_element(),k=b.is_plain_text_element(),
r=b.get_element(),$(r).css({"z-index":a.UTILITIES.next_z_index()}),h=$(r.parentElement).offset(),l=$(f).offset(),k||(r.style.left=d.pageX-h.left+"px",r.style.top=d.pageY-h.top+"px",$(r).addClass("toontalk-animating-element")),r.style.width=f.style.width,r.style.height=f.style.height,r.style.left=l.left-h.left+"px",r.style.top=l.top-h.top+"px",d=function(){$(r).removeClass("toontalk-animating-element");g.render();this.set_contents(b)}.bind(this),setTimeout(d,k||a.UTILITIES.has_animating_image(r)?0:
1200),g.robot_in_training()&&g.robot_in_training().dropped_on(b,this),b.save_dimensions&&b.set_size_attributes&&b.set_size_attributes($(f).width(),$(f).height()),b.is_backside()||g.get_frontside_element().dispatchEvent(a.UTILITIES.create_event("widget added",{element_widget:r,where:"front",index:this.get_index()}))):(g.rerender(),this.set_contents(b));return!0};b.get_json=function(){return null};b.add_to_json=function(a){return a};b.copy=function(b){return a.box_hole.create(d)};b.match=function(){return"matched"};
b.get_type_name=function(a){return f?f.get_type_name(a):a?"empty holes":"empty hole"};b.is_of_type=function(a){return f?f.is_of_type(a):"empty hole"===a};b.get_box=function(){return this.get_parent_of_frontside()};b.update_display=function(){var a;f&&(a=this.get_frontside_element(),h(f,f.get_element(),$(a).width(),$(a).height()))};b.dereference=function(){return f?f.dereference():this};b.get_index=function(){return d};b.get_contents=function(){return f};b.set_contents=function(b){var d=this.get_listeners("value_changed");
d&&(f!==b&&d.forEach(function(a){a({type:"value_changed",old_value:f,new_value:b})}),f&&d.forEach(function(a){f.remove_listener("value_changed",a,!0)}),b&&d.forEach(function(a){b.add_listener("value_changed",a)}));f&&f.set_parent(void 0);(f=b)?(f.set_parent(this),a.debugging&&(this._debug_string="A hole containing "+f.to_debug_string()),f.set_visible(l)):a.debugging&&(this._debug_string=this.to_debug_string())};b.visible=function(){return this.get_parent_of_frontside().visible()};b.set_visible=function(a){l=
a;f&&f.set_visible(a)};b.remove=function(){f&&f.remove()};b.render=function(){f&&a.DISPLAY_UPDATES.pending_update(this)};b.rerender=function(){if(f&&this.visible())return this.render()};b.set_running=function(a){f&&f.set_running(a)};b.maintain_proportional_dimensions=function(){if(f)return f.maintain_proportional_dimensions()};b.removed_from_container=function(b,d,k,g){f?(d&&f.restore_dimensions(),this.set_contents(void 0),d&&this.get_parent_of_frontside().render()):g&&a.UTILITIES.report_internal_error("Holes can't be removed from containers.")};
b.temporarily_remove_contents=function(a,b){if(f)return this.get_parent_of_frontside().temporarily_remove_contents(a,b)};b.toString=function(){return f?f.toString():"_"};b.get_description=function(){return f?f.get_description():"_"};b.get_full_description=function(a){return f?f.get_full_description(a):"_"};b.is_backside=function(){return!1};b.get_widget=function(){return this.get_parent_of_frontside()};b.is_number=function(){return f?f.is_number():!1};b.is_box=function(){return f?f.is_box():!1};b.is_scale=
function(){return f?f.is_scale():!1};b.is_bird=function(){return f?f.is_bird():!1};b.is_nest=function(){return f?f.is_nest():!1};b.is_robot=function(){return f?f.is_robot():!1};b.is_element=function(){return f?f.is_element():!1};b.get_original_width=function(){if(f&&f.get_original_width)return f.get_original_width()};b.get_original_height=function(){if(f&&f.get_original_height)return f.get_original_height()};b.is_sensor=function(){return f?f.is_sensor():!1};b.is_top_level=function(){return!1};b.is_plain_text_element=
function(){return!1};b.get_active=function(){return f?f.get_active():!1};b.set_active=function(a,b){f&&f.set_active(a,b)};a.widget.has_parent(b);a.widget.has_listeners(b);if(a.debugging||a.logging)b.to_debug_string=function(){var b="the "+a.UTILITIES.ordinal(d)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box");return f?b+" which contains "+f.to_debug_string():b+" which is empty"},b._debug_string=b.to_debug_string();return b}}}(window.TOONTALK);
window.TOONTALK.box["function"]=function(){var c=a.create_function_table();c.add_function_object("box hole",function(d,b,f){return c.typed_bird_function(d,function(b,c){var e=Math.round(b.to_float());if(1>e)a.UTILITIES.display_message("The box hole function bird cannot accept "+b+". She only accepts positive numbers.");else if(e>c.get_size())a.UTILITIES.display_message("The box hole function bird cannot accept "+b+". The box only has "+c.get_size()+" holes.");else return c.get_hole_contents(e-1)},
["number","box"],2,"box hole",b,f)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. 1 for the first hole.","hole",["number","box"]);c.add_function_object("count holes",function(d,b,f){return c.typed_bird_function(d,function(b){return a.number.create(b.get_size())},["box"],1,"count holes",b,f)},"The bird will return with the number of holes the box has.","count holes",["box"]);c.add_function_object("fill hole",function(d,b,f){return c.typed_bird_function(d,
function(b,c,e){var d=Math.round(b.to_float());if(1>d)a.UTILITIES.display_message("The fill hole function bird cannot accept "+b+". She only accepts positive numbers.");else return d>c.get_size()&&c.set_size(d),c.set_hole(d-1,e),c},["number","box",void 0],3,"fill hole",b,f)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);
c.add_function_object("split box",function(d,b,f){return c.typed_bird_function(d,function(b,c){var e=Math.round(b.to_float()),d=c.get_size();if(0>e)a.UTILITIES.display_message("The box split function bird cannot accept "+b+". She only accepts zero or positive numbers.");else if(e>d)a.UTILITIES.display_message("The box split function bird cannot accept "+b+". The box only has "+d+" holes.");else{c.get_holes();var d=d-e,f=a.box.create(d),g;for(g=0;g<d;g++)f.set_hole(g,c.get_hole_contents(g+e));c.set_size(e);
return a.box.create(2,!1,[c,f])}},["number","box"],2,"split box",b,f)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.","split",["number","box"]);c.add_function_object("merge boxes",function(d,b,f){return c.typed_bird_function(d,function(){var b=0,c,e,d,f;if(0===arguments.length)return a.box.create(0);e=arguments[0];for(c=0;c<arguments.length;c++)b+=arguments[c].get_size();d=e.get_size();e.set_size(b);for(c=
1;c<arguments.length;c++)for(f=arguments[c].get_size(),b=0;b<f;b++)e.set_hole(d,arguments[c].get_hole_contents(b)),d++;return e},["box"],void 0,"merge boxes",b,f)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);return c.get_function_table()}()})(window.TOONTALK);(function(){var a,h,c,d,b;window.TOONTALK.bird=function(c){var d=Object.create(c.widget),k=function(a,b,d){var g=a.get_function_type();a=a.get_function_object();var k=Object.keys(TOONTALK[g]["function"]),l=k.map(function(a){return TOONTALK[g]["function"][a].title}),k=c.UTILITIES.create_select_menu("functions",k,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",l);b=b.get_element();var h;a&&(k.menu.value=a.name);k.menu.addEventListener("change",
function(a){d.set_function_name(a.target.value);d.get_description()||(h=$(d.get_backside_element()).find(".toontalk-description-input"),0<h.length&&h.get(0).setAttribute("placeholder",d.get_default_description()))});b.insertBefore(k.container,b.firstChild)};d.create=function(e,u){var q=Object.create(d),g=[],n=[];a=function(a){e=a};q.is_bird=function(){return!0};q.widget_side_dropped_on_me=function(a,b,d,g,k){var l,h,n;if(e){if(e.has_ancestor(a))return c.UTILITIES.display_message("Bird can't take its nest to its nest!"),
!1;!(e.visible()||this.visible()||e.any_nest_copies_visible())||d&&d.visible()&&!d.animate_consequences_of_actions()?(n=function(){try{e.add_to_contents(a,b,d)}catch(c){if(c.wait_for_nest_to_receive_something)c.wait_for_nest_to_receive_something.run_when_non_empty(n,this);else throw console.error(c.stack),c;}},n(),d&&d===a.robot_waiting_before_next_step&&(a.robot_waiting_before_next_step=void 0,d.run_next_step())):(k||a.save_dimensions(),l=this.get_frontside_element(),setTimeout(function(){$(l).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside().rerender()}.bind(this)),a.set_visible(e.visible()),d&&!g&&(a.robot_waiting_before_next_step=d,d.run_next_step&&(h=function(){a.robot_waiting_before_next_step=void 0;d.run_next_step()})),e.animate_bird_delivery(a,this,h,b,d))}else console.log("TODO: handle drop on a nestless bird -- just removes other?");b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);return!0};q.animate_delivery_to=function(a,
b,d,k,l,h,q,u){var E=!!d,B=this.get_parent_of_frontside(),I=this.get_frontside_element(!0),D=$(I).position();$(I).width();var Q=this.closest_visible_ancestor_or_frontside(),H=$(Q.get_frontside_element()).offset(),N=function(){var a,b;c.sounds&&c.sounds.bird_fly.pause();E?this.remove():this.visible()&&(a=function(){$(I).removeClass("toontalk-bird-morph-to-static");$(I).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));B&&B.get_widget().rerender()}.bind(this),
I.style.position=J,c.UTILITIES.set_css(I,D),x&&x.appendChild(I),B&&(B.get_widget().is_top_level()?this.rerender():B.get_widget().rerender()),y&&(W.remove_backside_widget(this,!0),y(),g&&(b=g,g=[],n=[],b.forEach(function(a){a()}))),c.UTILITIES.add_animation_class(I,"toontalk-bird-morph-to-static"),c.UTILITIES.add_one_shot_event_handler(I,"animationend",1E3,a));h&&h()}.bind(this),L=function(){try{d.add_to_contents(a,q,u,this,!0)}catch(b){if(b.wait_for_nest_to_receive_something){b.wait_for_nest_to_receive_something.run_when_non_empty(L,
this);h&&(h(),h=void 0);return}console.error(b.stack);throw b;}O($(I).offset());c.UTILITIES.set_timeout(function(){this.fly_to(H,N,u)}.bind(this))}.bind(this),P=function(a,b){b||(b=c.UTILITIES.widget_side_of_element(a));this.element_to_display_when_flying=a;b&&(this.update_display(),setTimeout(function(){b.update_display()}));$(a).addClass("toontalk-carried-by-bird");$(a).removeClass("toontalk-temporarily-set-down");c.UTILITIES.set_timeout(function(){var e={left:"",top:"",position:""};b&&!b.use_scaling_transform&&
(e.width="",e.height="");1<a.toontalk_x_scale&&(e["font-size"]="inherit");c.UTILITIES.set_css(a,e);this.update_display()}.bind(this))}.bind(this),O=function(b){var e;this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),b?(e={"z-index":c.UTILITIES.next_z_index()},0<this.element_to_display_when_flying.width_before_carry&&(e.width=this.element_to_display_when_flying.width_before_carry),0<this.element_to_display_when_flying.height_before_carry&&
(e.height=this.element_to_display_when_flying.height_before_carry),1<this.element_to_display_when_flying.toontalk_x_scale&&(e["font-size"]="inherit"),c.UTILITIES.set_css(this.element_to_display_when_flying,e),this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying),c.UTILITIES.set_absolute_position(this.element_to_display_when_flying,b),(b=a.get_parent_of_frontside())&&!b.is_backside()?b.rerender():(a.set_visible(!0),a.render())):$(this.element_to_display_when_flying).remove(),
this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),p,w,x,J,T,R,y,F,ba,da,W;d||(d=e);da=a.get_element(!0);P(da,a);b.is_function_nest()||(w=b.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!b.visible()&&!this.visible()||!b.is_function_nest()&&!c.UTILITIES.visible_element(w))d.add_to_contents(a,q,u,this,!0);else if(c.sounds&&c.sounds.bird_fly.play(),$(I).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),
b.is_function_nest()||(p=$(w).offset(),R=$(d.get_frontside_element()).closest(".toontalk-top-level-backside")),R&&R.is("*")||(R=$(this.get_frontside_element()).closest(".toontalk-top-level-backside")),(b=R.offset())||(b={left:0,top:0}),k?H={left:k+b.left,top:l+b.top}:0===H.left&&0===H.top&&(H={left:-da.clientWidth,top:b.top+R.height()/2}),p||(p={left:-2*da.clientWidth,top:b.top+R.height()/2}),x=I.parentElement,Q=$(I).width(),T=$(I).height(),J=I.style.position,I.style.position="absolute",W=this.top_level_widget(),
B&&B.temporarily_remove_contents&&(y=B.temporarily_remove_contents(this,!0))&&this.get_widget().add_to_top_level_backside(this),0<R.length&&R.get(0).appendChild(I),c.UTILITIES.set_css(I,{left:k||H.left-b.left,top:l||H.top-b.top,width:Q,height:T}),c.logging&&0<=c.logging.indexOf("bird")&&console.log(this.to_debug_string()+" from "+(k||H.left-b.left)+", "+(l||H.top-b.top)+" to "+p.left+", "+p.top),(F=d.get_contents_element&&d.get_contents_element())&&d.visible()&&(!u||u.animate_consequences_of_actions())){k=
$(w).width();l=$(w).height();ba=$(w).offset();b.max_left=b.left+R.width();b.max_top=b.top+R.height();p.left+=k;p.top+=l;var na={left:Math.min(ba.left+k,b.max_left-k),top:Math.min(ba.top+l,b.max_top-l)},qa={left:Math.max(ba.left-k,b.left),top:Math.max(ba.top-l,b.top)};p=function(){var b=function(){d.visible()?(d.set_locked(!0),this.fly_to(ba,Ba,u,300)):(d.add_to_contents(a,q,u,this,!0),h&&(h(),h=void 0))}.bind(this);$(da).addClass("toontalk-temporarily-set-down");O(na);d.get_locked()?d.run_when_unlocked(b):
b()}.bind(this);var Ba=function(){P(F);this.fly_to(qa,sa,u,300)}.bind(this),sa=function(){$(F).addClass("toontalk-temporarily-set-down");O(qa);this.fly_to(na,Aa,u,300)}.bind(this),Aa=function(){P(da,a);this.fly_to(ba,oa,u,300)}.bind(this),oa=function(){var b=d.get_contents_dimensions();a.is_plain_text_element()&&$(da).addClass("toontalk-temporarily-set-down");O(ba);a.is_plain_text_element()||c.UTILITIES.set_css(a.get_frontside_element(),b);this.fly_to(qa,Fa,u,300)}.bind(this),Fa=function(){P(F);this.fly_to(ba,
Ea,u,300)}.bind(this),Ea=function(){$(da).removeClass("toontalk-temporarily-set-down");d.set_locked(!1);O();d.update_display();L()}.bind(this);this.fly_to(na,p,u,300)}else this.fly_to(p,L,u,300)};q.get_json=function(a,b,d){var g;e?(g=function(a,c){b({type:"bird",nest:a},c)},c.UTILITIES.get_json(e,a,g,d)):b({type:"bird"},d)};q.copy=function(a){var c,d,f;if(a)if(a.just_value)c=this.create(void 0,this.get_description());else{if((f=e&&e.get_guid())&&a.nests_copied&&a.nests_copied[f]){c=a.nests_copied[f][0];
b.call(c);for(d=1;d<a.nests_copied[f].length;d++)h.call(a.nests_copied[f][d],c);c=this.create(c,this.get_description())}else c=this.create(e,this.get_description());a.birds_copied||(a.birds_copied={});f&&(a.birds_copied[f]||(a.birds_copied[f]=[]),a.birds_copied[f].push(c))}else c=e&&e.is_function_nest()?this.create(e.copy(),this.get_description()):this.create(e,this.get_description());return this.add_to_copy(c,a)};q.run_when_non_empty=function(a,b){0>n.indexOf(b)&&(g.push(a),n.push(b))};q.create_backside=
function(){var a=c.bird_backside.create(this);e&&e.is_function_nest()&&k(e,a,this);return a};q.get_help_URL=function(){return e&&e.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};q.is_function_bird=function(){return e&&e.is_function_nest()};q.get_custom_title_prefix=function(){var a;return e?e.is_function_nest()&&(a=e.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":"This bird no longer knows where her nest is. She'll get rid of anything you give her."};
q.toString=function(a){return e?e.is_function_nest()?e.get_function_object().toString():"bird":a&&"conditions"===a.role?"any bird":"bird without a nest"};q.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird a box to compute the '"+e.get_function_object().name+"' of "+this.get_function_type(!0)+".":"a bird who takes things to her nest."};q.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var b;b=a.get_element();b.setAttribute("toontalk_name",
this.get_name());c.UTILITIES.give_tooltip(b,this.get_title());$(b).is(".toontalk-bird, .toontalk-side-animating")||($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),b.addEventListener("dragenter",function(a){0<=b.className.indexOf("toontalk-bird-static")&&($(b).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),c.UTILITIES.add_animation_class(b,"toontalk-bird-gimme"))}.bind(this)),b.addEventListener("dragleave",
function(a){$(b).is(".toontalk-bird-gimme")&&($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside()&&this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?b.appendChild(this.element_to_display_when_flying):$(b).children(".toontalk-side").remove()};q.set_function_name=function(a){e&&e.is_function_nest()&&e.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&
this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};q.get_function_type=function(a){return e.get_function_type(a)};q.get_class_name_with_color=function(a){return e&&e.get_class_name_with_color?e.get_class_name_with_color(a):a};q.get_name=function(){return e?e.get_name():""};e&&e.set_name&&(q.set_name=function(a,b){return e.set_name(a,b)});q.add_standard_widget_functionality(q);
q.set_description(u);c.debugging&&(q._debug_id=c.UTILITIES.generate_unique_id(),q._debug_string=q.to_debug_string());return q};d.create_function=function(a,b,k){return d.create(c.nest.create_function(b,a,k||c.UTILITIES.get_first_property(c[a]["function"])))};d.match=function(a){if(a.match_with_any_bird)return a.match_with_any_bird(this);this.last_match=a;return this};d.match_with_any_bird=function(){return"matched"};d.fly_to=function(a,b,d,g){var k=this.get_frontside_element(),l=$(k).offset(),h="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*
(Math.atan2(a.top-l.top,a.left-l.left)/Math.PI+1))%8];$(k).position();var r=function(){$(k).removeClass(h);g?setTimeout(b,d?d.transform_step_duration(g):g):b()}.bind(this);setTimeout(function(){$(k).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));c.UTILITIES.add_animation_class(k,h);this.animate_to_absolute_position(a,r,d&&d.transform_animation_speed(c.UTILITIES.default_animation_speed))}.bind(this),1)};d.get_type_name=function(a,b){return a?b&&this.is_function_bird()?
"function birds":"birds":"bird"};d.maintain_proportional_dimensions=function(){return!0};d.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};d.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c)};c.creators_from_json.bird=function(a,b){return c.bird.create(c.UTILITIES.create_from_json(a.nest,b),a.description)};return d}(window.TOONTALK);window.TOONTALK.bird_backside=function(a){return{create:function(b){var c=
a.backside.create(b);c.add_description_setting();c.add_name_setting();c.get_element().appendChild(a.backside.create_advanced_settings_button(c,b));return c}}}(window.TOONTALK);window.TOONTALK.nest=function(f){var l=Object.create(f.widget),k,e=0,u=0;l.default_maximum_capacity=10;l.maximum_capacity=l.default_maximum_capacity;l.create=function(q,g,n,t,v,r){var m=Object.create(l),z=[],G=[],M=[],C=!1,E,B,I;g||(g=[]);v||(e++,v=e);h=function(a){t&&d.call(t,this);t=a;n=a.get_guid();c.call(a,this)};b=function(){t&&
d.call(t,this);t=void 0;n=f.UTILITIES.generate_unique_id()};c=function(a){k||(k=f.UTILITIES.generate_unique_id());this[k](a)};d=function(a){k||(k=f.UTILITIES.generate_unique_id());this[k](a,!0)};m.is_nest=function(){return!0};m.get_guid=function(){return n};m.matched_by=function(a){return 0<g.length?f.UTILITIES.match(a,g[0]):[[this,a]]};m.run_when_non_empty=function(a,b){0<g.length?a(g[0]):0>M.indexOf(b)&&(z.push(a),M.push(b))};m.dereference=function(){return 0<g.length?g[0]:this};m.match=function(a){if(0<
g.length)return g[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};m.add_to_contents=function(a,b,c,e,d){var k;k=g.push(a);var h=this.visible();k>l.maximum_capacity&&c&&C&&!c.visible()&&!h&&(f.logging&&0<=f.logging.indexOf("nest")&&console.log(this.to_debug_string()+" postponing addition of "+a.to_debug_string()+" by "+c.to_debug_string()+". Stack is "+g.length+" long. "+G.length+" previously postponed."),c.add_body_finished_listener(function(){c.set_stopped(!0);
G.push(function(){c.set_stopped(!1);c.run_actions()})}));f.logging&&0<=f.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+a.to_debug_string()+" nest now contains "+g.length+" widgets.");1===k?(C=!1,0<z.length&&(k=z,z=[],M=[],k.forEach(function(b){b(a)})),a.set_visible(h),h||a.hide()):(a.hide(),a.set_visible(!1));a.is_backside()?a.set_parent_of_backside(this):a.set_parent_of_frontside(this);E&&!d&&(e?E.forEach(function(d){d.has_ancestor(a.get_widget())||d.animate_bird_delivery(f.UTILITIES.copy_side(a),
e,void 0,b,c)}):E.forEach(function(e){e.has_ancestor(a.get_widget())||e.add_to_contents(f.UTILITIES.copy_side(a,!1,!0),b,c)}));this.rerender()};m.animate_bird_delivery=function(a,b,c,e,d){var g,k,p;void 0===this.get_parent_of_frontside()?(a.remove(),c&&c()):(b.animate_delivery_to(a,this,void 0,void 0,void 0,c,e,d),E&&(g=$(b.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),k=b.get_parent_of_frontside().get_element(),p=this.visible(),E.forEach(function(c){var l=
f.UTILITIES.copy_side(a,!1,p),h,n;c.has_ancestor(a.get_widget())||(g&&(c.visible()||p)?(h=b.copy({just_value:!0}),n=h.get_frontside_element(!0),k.appendChild(n),h.animate_delivery_to(l,c,c,g.left,g.top,void 0,e,d)):c.add_to_contents(l,void 0,d))})))};m.get_contents_element=function(){if(0<g.length)return g[0].get_element()};m.get_locked=function(){return this.locked_for_animating_deliveries};m.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&
this.to_run_when_unlocked.shift()()};m.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};m.removed_from_container=function(a,b,c){a=g.shift();f.logging&&0<=f.logging.indexOf("nest")&&(a?console.log(this.to_debug_string()+" removed "+a.to_debug_string()+" remaining widgets is "+g.length):console.log(this.to_debug_string()+" nothing left to remove."));if(a)return b||(C=!0),a.is_backside()?a.set_parent_of_backside(void 0):a.get_widget().set_parent_of_frontside(void 0),
this.visible()&&(a.restore_dimensions&&a.restore_dimensions(),0<g.length&&(g[0].set_visible(!0),$(g[0].get_element()).show()),this.render()),g.length<=l.maximum_capacity&&0<G.length&&(f.logging&&0<=f.logging.indexOf("nest")&&console.log(this.to_debug_string()+" running "+G.length+" postponed additions. Stack is "+g.length+" long."),l.maximum_capacity=Number.MAX_VALUE,G.forEach(function(a){a()}),l.maximum_capacity=l.default_maximum_capacity,G=[]),a;c&&f.UTILITIES.report_internal_error("Nothing removed from nest!")};
m.dereference_path=function(a,b){if(0===g.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(g)return g[0].dereference_path(a,b);f.UTILITIES.display_message("Robot expected to find a nest something that it could get "+f.path.toString(a)+". But the nest is empty.");return this};m.dereference_contents=function(a,b){var c,e,d,k,l,p,h,n,m;return 0===g.length?{wait_until_this_nest_receives_something:this}:a.removing_widget?(c=g[0],b.remove_from_container(c,this),this.visible()&&
(p=this.get_frontside_element(),e=$(p).offset(),d=$(p).closest(".toontalk-backside-of-top-level"),(k=d.offset())||(k={left:0,top:0}),l=c.get_element(!0),h=$(p).width(),p=$(p).height(),n=.1*h+e.left-k.left,m=.1*p+e.top-k.top,f.UTILITIES.set_css(l,{width:h*f.nest.CONTENTS_WIDTH_FACTOR,height:p*f.nest.CONTENTS_HEIGHT_FACTOR}),0<d.length&&b.add_watched_step_end_listeners(function(){d.get(0).appendChild(l);f.UTILITIES.set_css(l,{left:n,top:m})})),c):a.next?g[0].get_widget().dereference_path(a.next,b):
g[0].get_widget()};m.get_json=function(a,b,c){var e=[],d=function(){var d=function(a,c){b({type:"nest",contents:e,guid:n,original_nest:a,serial_number:v,name:this.get_name()},c)}.bind(this);t?f.UTILITIES.get_json(t,a,d,c):d(void 0,c)}.bind(this);f.UTILITIES.get_json_of_array(g,e,0,a,d,c)};m.copy=function(b){var c,e,d,k;if(b&&b.just_value){if(0<g.length&&(c=g[0].copy(b),!b.copy_covered_nests))return c;e=f.nest.create(this.get_description(),[],"in a robot's condition",void 0,v,this.get_name());c&&e.add_to_contents(c);
return e}c=f.UTILITIES.copy_widget_sides(g,b);b?b.fresh_copy?e=f.nest.create(this.get_description(),c,n&&f.UTILITIES.generate_unique_id()):(d=t||this,b.birds_copied&&b.birds_copied[n]?(k=d.get_guid(),b.nests_copied&&b.nests_copied[k]?(e=b.nests_copied[k][0].copy(),b.nests_copied[k].forEach(function(a){h.call(a,e)})):e=f.nest.create(this.get_description(),c,f.UTILITIES.generate_unique_id()),b.birds_copied[n].forEach(function(b){a.call(b,e)})):e=f.nest.create(this.get_description(),c,n,d,v,this.get_name()),
b.nests_copied||(b.nests_copied={}),b.nests_copied[d]?b.nests_copied[k].push(e):b.nests_copied[k]=[e]):e=f.nest.create(this.get_description(),c,n,t||this,v,this.get_name());return this.add_to_copy(e,b)};m.has_contents=function(){return 0<g.length};m.dropped_on_other=function(a,b,c){var e,d,g,k,p,l,h;if(!n){n=f.UTILITIES.generate_unique_id();f.debugging&&(this._debug_string=this.to_debug_string());e=f.bird.create(this);if(c){c.add_newly_created_widget(e);if(!this.visible())return;this.robot_waiting_before_next_step=
c}b&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(e);f.sounds&&setTimeout(function(){f.sounds.hatching.play()},1E3);this.rerender();d=this.get_frontside_element(!0);f.UTILITIES.add_animation_class(d,"toontalk-hatch-egg");p=function(){var p,n,m;if(a.is_backside())p=a;else if((p=f.UTILITIES.widget_side_of_jquery($(d).closest(".toontalk-top-level-backside")))||(p=f.UTILITIES.widget_side_of_jquery($(a.get_widget().get_frontside_element(!0)).closest(".toontalk-top-level-backside"))),
p)p=p.is_backside()?p:p.get_backside();else{f.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");return}n=p.get_element();m=$(n).offset();g=e.get_frontside_element(!0);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));f.UTILITIES.add_animation_class(g,"toontalk-fly-southwest");k=f.UTILITIES.relative_position(d,n);f.UTILITIES.set_css(g,{left:k.left,top:k.top});b&&this.robot_in_training()?p.widget_side_dropped_on_me(e,
b,void 0,!0):p.widget_side_dropped_on_me(e,b);$(d).removeClass("toontalk-hatch-egg").addClass(this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&f.UTILITIES.set_css(d,{left:k.left-5,top:k.top+45});this.get_parent_of_frontside().render();h=function(){$(g).removeClass("toontalk-fly-southwest");f.UTILITIES.set_timeout(function(){f.UTILITIES.add_animation_class(g,"toontalk-fly-down");$(g).removeClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"));l=function(){var a=function(){$(g).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);$(g).removeClass("toontalk-fly-down");f.UTILITIES.add_animation_class(g,"toontalk-bird-morph-to-static");f.UTILITIES.add_one_shot_event_handler(g,"animationend",1E3,a);c&&(this.robot_waiting_before_next_step=void 0,c.run_next_step());e.update_display()}.bind(this);
f.UTILITIES.add_one_shot_event_handler(d,"animationend",1E3,l)}.bind(this))}.bind(this);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));e.animate_to_absolute_position({left:Math.max(10,k.left-70)+m.left,top:Math.max(10,k.top+70)+m.top},h,c&&c.transform_animation_speed(f.UTILITIES.default_animation_speed));this.rerender()}.bind(this);f.UTILITIES.add_one_shot_event_handler(d,"animationend",2E3,p)}return!0};m.widget_side_dropped_on_me=function(a,b,c){b&&
a.save_dimensions&&a.save_dimensions();0===g.length?(this.add_to_contents(a,b,c),a.dropped_on_other?a.dropped_on_other(this,b,c):b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(g[0],b,c);return!0};m.drop_on=function(a,b,c){return a.widget_side_dropped_on_me?(a.widget_side_dropped_on_me(this,b,c),!0):!1};m.element_to_highlight=function(){return 0===g.length?this.get_frontside_element():g[0].get_frontside_element()};m.update_display=function(){var a=this.get_frontside(!0),
b=this.get_backside(),c,e,d,k,a=a.get_element();a.setAttribute("toontalk_name",this.get_name());0<g.length?(c=g[0],c.is_backside()?(k=c.get_element(!0),c.update_display(),c.scale_to_fit(k,a)):(c.set_visible(!0),c.render(),k=g[0].get_element(!0),$(k).show()),e=$(a).width(),d=$(a).height(),0<e&&0<d&&f.UTILITIES.set_timeout(function(){var a=this.get_contents_dimensions();a&&(f.UTILITIES.set_css(k,{width:a.width,height:a.height,left:e*(1-f.nest.CONTENTS_WIDTH_FACTOR)/2,top:d*(1-f.nest.CONTENTS_HEIGHT_FACTOR)/
2}),c.set_size_attributes&&c.set_size_attributes(a.width,a.height))}.bind(this),2),$(a).parent().is(".toontalk-box-hole")&&!$(a).parent().is(".toontalk-scale-half")?(a.parentElement.appendChild(k),$(k).css({"z-index":f.UTILITIES.next_z_index()})):a.appendChild(k),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest")),g[0].is_backside()?c.set_parent_of_backside(this):c.set_parent_of_frontside(this)):n?($(a).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(a).addClass(this.get_class_name_with_color("toontalk-empty-nest"))):
f.UTILITIES.add_animation_class(a,this.get_class_name_with_color("toontalk-nest-with-egg"));f.UTILITIES.give_tooltip(a,this.get_title());$(a).addClass("toontalk-nest");b&&b.rerender()};k||(k=f.UTILITIES.generate_unique_id());m[k]=function(a,b){if(!E){if(b)return;E=[]}b?E.splice(E.indexOf(a),1):E.push(a)};m.get_contents_dimensions=function(){var a,b=this.get_frontside_element();a=$(b).parent().is(".toontalk-box-hole")&&!$(b).parent().is(".toontalk-scale-half")?b.parentElement:b;b=$(a).width();a=$(a).height();
b*=f.nest.CONTENTS_WIDTH_FACTOR;a*=f.nest.CONTENTS_HEIGHT_FACTOR;var c=g[0],e;if(c)return e=c.is_box()?1:2,c=c.get_border_size?e*c.get_border_size(b,a):0,{width:b-c,height:a-c}};m.get_path_to=function(a,b){var c,e;if(0<g.length){c=g[0].get_widget();if(c===a)return f.path.to_widget_on_nest();if(c.get_path_to&&(e=f.path.to_widget_on_nest(),c=c.get_path_to(a,b)))return e.next=c,e}};m.walk_children=function(a){if(0<g.length)return a(g[0])};m.top_contents_is=function(a){return 0<g.length&&g[0]===a};m.any_nest_copies_visible=
function(){var a=!1;if(!E)return!1;E.some(function(b){b.visible()&&(a=!0)});return a};m.compare_with=function(a){if(0<g.length)return g[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};m.compare_with_nest=function(a){return 0===g.length?0:1};m.compare_with_number=function(a){return 0<g.length?g[0].compare_with(a):-1};m.get_class_name_with_color=function(a){return v?a+["","-magenta","-yellow"][v%3]:a};m.generate_name=function(){u++;return"#"+u.toString()};m.has_name(m);
B=m.set_name;m.set_name=function(a,b){var c=this.get_name();if(!B.call(this,a,b))return!1;b&&$(".toontalk-bird").each(function(){this.getAttribute("toontalk_name")===c&&f.UTILITIES.widget_side_of_element(this).rerender()})};m.set_name(r);m.compare_with_box=m.compare_with_number;m.compare_with_scale=m.compare_with_number;m.add_standard_widget_functionality(m);I=m.set_visible;m.set_visible=function(a){I.call(this,a);a||this.set_locked(!1)};m.set_description(q);f.debugging&&(m._debug_id=f.UTILITIES.generate_unique_id(),
m._debug_string=m.to_debug_string());t&&n&&(k||(k=f.UTILITIES.generate_unique_id()),t[k](m));return m};l.create_function=function(a,b,c){var e=function(){return!1},d=f[b]&&f[b]["function"]&&f[b]["function"][c],e={get_function_type:function(a){return f[b].get_type_name(a)},get_function_object:function(){return d},set_function_name:function(a){if(c===a)return!1;c=a;d=f[b]&&f[b]["function"]&&f[b]["function"][c];this.add_to_contents=d.respond_to_message;return!0},is_function_nest:function(){return!0},
copy:function(){return f.nest.create_function(a,b,c)},animate_bird_delivery:function(a,b,c,e,d){b.animate_delivery_to(a,this,void 0,void 0,void 0,c,e,d)},get_json:function(a,c,e){c({type:"function_nest",function_type:b,function_name:d?d.name:f.UTILITIES.get_first_property(f[b]["function"])},e)},add_to_json:f.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return d.short_name},has_ancestor:e,visible:e,any_nest_copies_visible:e,is_backside:e};f.widget.has_parent(e);
f.widget.has_description(e);f.widget.add_sides_functionality(e);e.set_description(a);d?(e.add_to_contents=d.respond_to_message,f.debugging&&(e._debug_id=f.UTILITIES.generate_unique_id(),e._debug_string="a function nest that "+d.toString())):f.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+b+"."+c+" is not defined.");return e};f.creators_from_json.function_nest=function(a,b){return f.nest.create_function(a.description,a.function_type,a.function_name)};l.create_backside=
function(){return f.nest_backside.create(this)};l.match_nest_with_nest=function(a){return"matched"};l.toString=function(){return"nest"};l.get_default_description=function(){return"a nest that receives things from its birds."};l.get_help_URL=function(){return"docs/manual/birds-nests.html"};l.get_type_name=function(a){return a?"nests":"nest"};l.maintain_proportional_dimensions=function(){return!0};l.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};l.get_custom_title_prefix=
function(){return"Drop something on my bird and she'll take it here."};f.creators_from_json.nest=function(a,b){var c=!a.original_nest&&a.guid&&b&&b.guid_to_nest_table&&b.guid_to_nest_table[a.guid];c||(c=f.nest.create(a.description,f.UTILITIES.create_array_from_json(a.contents,b),a.guid,a.original_nest&&f.UTILITIES.create_from_json(a.original_nest,b),a.serial_number,a.name),b.guid_to_nest_table[a.guid]=c);return c};l.CONTENTS_WIDTH_FACTOR=1;l.CONTENTS_HEIGHT_FACTOR=1;return l}(window.TOONTALK);window.TOONTALK.nest_backside=
function(a){return{create:function(b){b=a.backside.create(b);b.add_description_setting();b.add_name_setting();return b}}}(window.TOONTALK)})();window.TOONTALK.scale=function(a){var h=Object.create(a.widget);h.create=function(c,d,b,f,l){var k=function(){b.rerender()},e,h,q;b||(b=a.box.create(2,void 0,c,d,l||""));e=b.get_json;h=b.copy;q=b.get_path_to;b.is_scale=function(){return!0};b.copy=function(c){var e;this.get_name();c||(c={});e=h.call(this,c);e=a.scale.create(void 0,void 0,e,c.just_value&&this.get_state());return b.add_to_copy(e,c)};b.get_json=function(a,b,c){var d=function(a,c){a.type="scale";a.inactive_state=this.get_inactive_state();
b(a,c)}.bind(this);e.call(this,a,d,c)};b.get_path_to=function(a,b){var c=q.call(this,a,b);c&&(c.true_type="scale");return c};b.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c)};b.widget_side_dropped_on_me=function(a,b,c){var e=this.get_hole_contents(0),d=this.get_hole_contents(1),f;a.dropped_on_other&&a.dropped_on_other(this,b,c);if(e&&!d)return this.get_hole(1).widget_side_dropped_on_me(a,b,c),!0;if(!e&&(d||!b))return this.get_hole(0).widget_side_dropped_on_me(a,
b,c),!0;f=this.which_hole(b,!1);if(0===f){if(e){if(e.drop_on)return a.drop_on(e,b,c);return}}else if(d){if(d.drop_on)return a.drop_on(d,b,c);return}this.get_hole(f).widget_side_dropped_on_me(a,b,c);return!0};b.which_hole=function(c,e){var d=b.get_frontside_element(),f=$(d).offset(),d=a.UTILITIES.get_element_width(d),f=c.clientX-(f.left+d/2),d=e?d/10:0;return-f>d?0:f>d?1:-1};b.get_inactive_state=function(){return f};b.update_display=function(){var b=this.get_frontside_element(!0),c=$(b),e=$(b).children(".toontalk-scale-half"),
d=$(b).parent(),d=d.is(".toontalk-backside")||c.is(".toontalk-conditions-contents")?b:d.get(0),f=$(d).width(),k=$(d).height(),l=function(b,c,e){var d=c.get_contents();c=(d||c).get_element(!0);var g,l,h;a.UTILITIES.set_css(b,{left:e*f*.5,top:0,width:.5*f,height:k});b!==c&&(g=0===e?-.05*f:.15*f,e="toontalk-scale-balanced"===q?.1*k:0===e&&"toontalk-scale-left_heavier"===q||1===e&&"toontalk-scale-right_heavier"===q?.25*k:1===e&&"toontalk-scale-left_heavier"===q||0===e&&"toontalk-scale-right_heavier"===
q?-.1*k:.2*k,l=.4*f,h=.4*k,$(c).css({left:g,top:e,width:l,height:h}),d&&(d.set_location_attributes&&d.set_location_attributes(g,e),d.set_size_attributes&&d.set_size_attributes(l,h),d.is_backside()&&(d.update_display(),d.scale_to(l,h)),d.render()),b.appendChild(c))},h,q;c.is(".toontalk-top-level-resource")?q="toontalk-scale-balanced":(h=this.get_state(),q="undefined"===typeof h?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][h+1]);
c.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");c.addClass(q);c.addClass("toontalk-scale");c=a.UTILITIES.scale_to_fit(b,d,123,91);0===f&&(f=1);0===k&&(k=1);f/=c.x_scale;k/=c.y_scale;2===e.length?e.each(function(b,c){a.UTILITIES.set_timeout(function(){l(c,this.get_hole(b),b)}.bind(this))}.bind(this)):this.get_holes().forEach(function(a,c){var e=a.get_element();0===c?$(e).addClass("toontalk-left_scale  toontalk-scale-half"):
$(e).addClass("toontalk-right_scale toontalk-scale-half");l(e,a,c);b.appendChild(e)});a.UTILITIES.give_tooltip(b,this.get_title());a.debugging&&(this._debug_string=this.to_debug_string())};b.render=function(){a.DISPLAY_UPDATES.pending_update(this)};b.get_type_name=function(a){return a?"scales":"scale"};b.get_help_URL=function(){return"docs/manual/scales.html"};b.toString=function(){var b=this.get_hole_contents(0),c=this.get_hole_contents(1),e,d,f;switch(this.get_state()){case -1:e="scale leaning to the right";
break;case 1:e="scale leaning to the left";break;case 0:e="balanced scale";break;default:if(e="unbalanced scale",!d&&!f)return e}d=b?"contains "+a.UTILITIES.add_a_or_an(b.get_full_description()):"is empty";f=c?"contains "+a.UTILITIES.add_a_or_an(c.get_full_description()):"is empty";return e+" and the left pan "+d+" and the right pan "+f};b.create_backside=function(){return a.scale_backside.create(this)};b.get_state=function(){var a=this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);
b=this.get_hole_contents(1);if(a||b)if(a){if(!b)return 1;if(a.get_widget().compare_with)return a.get_widget().compare_with(b.get_widget())}else return-1};b.match=function(a){if(a.match_with_scale)return a.match_with_scale(this);this.last_match=a;return this};b.match_with_scale=function(a){var b;return this.get_state()===a.get_state()?"matched":(b=this.get_hole_contents(0))&&b.is_nest()&&!b.has_contents()?[[b,this]]:(b=this.get_hole_contents(1))&&b.is_nest()&&!b.has_contents()?[[b,this]]:a};b.compare_with=
function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};b.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};b.get_name_input_label=void 0;b.generate_name=function(){return""};b.get_hole(0).add_listener("value_changed",k);b.get_hole(1).add_listener("value_changed",k);b.get_hole_contents(0)&&b.get_hole_contents(0).add_listener("value_changed",k);b.get_hole_contents(1)&&b.get_hole_contents(1).add_listener("value_changed",k);
b.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};b.get_default_description=function(){return"a scale for comparing things."};b.set_name=void 0;a.debugging&&
(b._debug_id=a.UTILITIES.generate_unique_id(),b._debug_string=b.to_debug_string());return b};a.creators_from_json.scale=function(c,d){return h.create(a.UTILITIES.create_array_from_json(c.contents,d),c.description,void 0,c.inactive_state,c.name)};return h}(window.TOONTALK);window.TOONTALK.scale_backside=function(a){return{create:function(h){var c=a.backside.create(h);c.add_description_setting();c.get_element().appendChild(a.backside.create_advanced_settings_button(c,h));return c}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(a){var h=function(b,c,d,k,e){var h;d.current_action_name=c;(b=a.path.get_path_to(b,d,!0))?(k||(k={}),h=Date.now(),k.time=h-d.time_of_last_step,d.time_of_last_step=h,d.add_step(a.robot_action.create(b,c,k),e)):console.log("No path found for "+c);d.current_action_name=void 0},c=Object.create(a.widget),d=0;c.create=function(b,d,l,k,e,h,q,g,n){var t=Object.create(c),v,r,m,z,G=[],M=[],C,E,B,I,D,Q,H,N,L;l||(l=a.actions.create());r||(r=t);b&&b.set_parent_of_frontside(t);
t.is_robot=function(){return!0};t.get_frontside_conditions=function(){return b};t.set_frontside_conditions=function(a){(b=a)&&b.set_parent_of_frontside(this)};t.get_backside_matched_widgets=function(){return L};t.set_backside_matched_widgets=function(a){L=a};t.get_matched_backside_widget=function(a){if(L)return L[H.indexOf(a)]};t.get_backside_widget_of_type=function(a,b){var c,e;if(L)return L[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&0>this.get_newly_created_widgets().indexOf(b))return e=
b,!0}.bind(this)),e};t.get_backside_conditions=function(){return d};t.set_backside_conditions=function(b){$.isArray(b)?d=b.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(d=[],a.UTILITIES.available_types.forEach(function(a){b[a]&&d.push(b[a])}));d&&d.forEach(function(b){b.is_backside()?b.set_parent_of_backside(this):(a.widget.erasable(b),b.set_parent_of_frontside(this))}.bind(this))};d&&t.set_backside_conditions(d);t.initialize_backside_conditions=function(){H=this.get_training_context().get_backside_widgets().slice();
N=a.UTILITIES.copy_widget_sides(H,{just_value:!0});this.set_backside_conditions([])};t.add_to_backside_conditions=function(b){var c;0<=this.get_newly_created_widgets().indexOf(b)||(d||(d=[]),b=H.indexOf(b),0<=b&&(c=N[b]),c&&0>d.indexOf(c)&&(d.push(c),a.widget.erasable(c)))};t.get_backside_condition_index=function(a){var b;L?(b=L.indexOf(a),0>b&&(b=L.length,L.push(a))):(b=0,L=[a]);return b};t.get_body=function(){return l};t.set_body=function(a){l=a};t.get_running=function(){return D||this.is_ok_to_run()};
t.running_or_in_run_queue=function(){return D};t.set_running_or_in_run_queue=function(a){D=a};t.stopped=function(){return Q};t.set_stopped=function(a){if(Q!==a){if(Q=a)this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.drop_thing_in_hand(),this.rerender()),D=!1;this.get_next_robot()&&this.get_next_robot().set_stopped(a)}};t.drop_thing_in_hand=function(){e&&(e.drop_on(this.top_level_widget(),void 0,this),this.set_thing_in_hand(void 0))};t.finish_cycle_immediately=
function(a){var b=z,c=function(){z=b;this.set_visible(!1);a&&a()}.bind(this);z=0;this.add_body_finished_listener(c)};t.get_maximum_step_duration=function(){return z};t.get_context=function(){return C};t.set_context=function(a){C=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};t.context_is_backside=function(){return E};t.set_context_is_backside=function(a){E=a;this.get_next_robot()&&this.get_next_robot().set_context_is_backside(a)};t.get_top_level_context=function(){return B};t.set_top_level_context=
function(a){B=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};t.get_queue=function(){return I};t.set_queue=function(a){I=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};t.animate_consequences_of_actions=function(){return this.visible()&&0!==z};t.transform_step_duration=function(a){return void 0===a&&0===z||!this.visible()?0:n&&a?a/n:"number"===typeof z?Math.min(a,z):a};t.transform_original_step_duration=function(a){if(C&&!C.get_backside()||!this.visible())return 0;
if(!n)return a};t.transform_animation_speed=function(a){return C&&!C.get_backside()||!this.visible()?0:n?a*n:a};t.set_animating=function(b,c){var e=this.get_frontside_element(),d;b&&a.UTILITIES.visible_element(e)?(c||(c=$(e).offset()),$(e).css({width:"",height:"","z-index":a.UTILITIES.next_z_index()}),a.UTILITIES.set_position_relative_to_top_level_backside($(e),c),d=$(e).closest(".toontalk-top-level-backside"),0<d.length&&d.get(0).appendChild(e),$(e).addClass("toontalk-robot-animating"),setTimeout(function(){$(e).addClass("toontalk-side-animating")},
2E3)):$(e).removeClass("toontalk-robot-animating toontalk-side-animating")};t.add_body_finished_listener=function(a){G.push(a)};t.run_body_finished_listeners=function(){G.forEach(function(a){a()});G=[]};t.add_watched_step_end_listeners=function(a){M.push(a)};t.run_watched_step_end_listeners=function(){M.forEach(function(a){a()});M=[]};t.get_thing_in_hand=function(){return e};t.set_thing_in_hand=function(b){if(a.debugging){if(b&&"empty hole"===b.get_type_name()){a.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");
return}a.logging&&0<=a.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string()+" now has in his hand "+(b?b.to_debug_string():"nothing"))}e=b};t.get_next_robot=function(){return q};t.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());!a&&q&&(q.set_first_in_team(q),q.set_previous_robot(void 0));(q=a)&&q.set_previous_robot(this);b&&($(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=this.drop_area_instructions())};t.get_previous_robot=
function(){return m};t.set_previous_robot=function(a){m=a};t.get_first_in_team=function(){return r};t.set_first_in_team=function(a){r=a;q&&q.set_first_in_team(a)};t.walk_children=function(a){var b;q&&!a(q)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};t.get_run_once=function(){return h};t.set_run_once=function(a){h=a;this.update_title();return!0};t.get_watched_speed=function(){return n};t.set_watched_speed=function(a){n=a;return!0};t.can_run=function(){return this.get_frontside_conditions()&&
this.get_frontside_conditions().is_top_level()||a.widget.can_run.call(this)};t.training_started=function(b){var c=this.get_training_context();c?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(c.copy({just_value:!0})),this.initialize_backside_conditions(),b||($("*").css({cursor:"url("+a.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),this.update_title(),
b=this.get_backside_element(),$(b).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):a.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};t.training_finished=function(){if(this.being_trained){var b,c,e;b=this.get_body().get_newly_created_widgets();for(c=0;c<b.length;c++)e=b[c],"drop it on top-level"!==e.last_action&&"copy"!==e.last_action||this.add_step(a.robot_action.create(a.newly_created_widgets_path.create(c),
"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):$("*").css({cursor:""})}};if(a.debugging||a.logging)t.to_debug_string=function(){var b=this.get_frontside_conditions();return"Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(b?
a.UTILITIES.add_a_or_an(b.toString()):"anything")};q&&t.set_next_robot(q);t.add_standard_widget_functionality(t);v=t.remove_backside_widget.bind(t);t.has_name(t);t.set_name(g);t.set_description(k);t.remove_backside_widget=function(a,b){var c=this.get_frontside_conditions(),e;a===c?this.set_frontside_conditions(void 0):(e=this.get_backside_conditions())&&e.some(function(b,c){if(a===b)return e.splice(c,1),!0})||v(a,b)};a.debugging&&(t._debug_id=a.UTILITIES.generate_unique_id(),t._debug_string=t.to_debug_string());
return t};c.create_backside=function(){return a.robot_backside.create(this)};c.copy=function(b){var c=this.get_frontside_conditions(),d=this.get_backside_conditions(),c=c?c.copy({just_value:!0}):void 0,k=this.get_next_robot(),k=k?k.copy(b):void 0,e;d&&(e=a.UTILITIES.copy_widgets(d,{just_value:!0}));d=this.create(c,e,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),k,(!b||!b.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(d,b)};
c.match=function(a){var c,d;if(a.is_robot()&&(c=this.get_body().is_empty(),d=a.get_body().is_empty(),c===d))return"matched";this.last_match=a;return this};c.generate_name=function(){d++;return"#"+d.toString()};c.run=function(b,c,d,k){var e=this.get_frontside_conditions(),h,q,g,n,t;if(this.being_trained||this.running_or_in_run_queue())return this;(t=this.get_backside())&&t.visible()&&e&&(g=function(a){$(a.get_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},
g(e),this.rerender());b?(this.set_context(b),this.set_context_is_backside(c),this.set_top_level_context(d),this.set_queue(k)):b=this.get_context();this.match_status=a.UTILITIES.match(e,this.get_context());"matched"===this.match_status&&(n=[],(c=this.get_backside_conditions())&&0<c.length&&((h=b.get_backside_widgets())&&c.some(function(b){var c,e;b.matching_widget&&b.matching_widget.get_parent_widget_of_frontside()&&(c=a.UTILITIES.match(b,b.matching_widget),"matched"===c&&(n.push(b.matching_widget),
e=c));e||h.some(function(d){c=void 0;if(!(0<=n.indexOf(d)))if(d.is_backside()||d===this)e=b;else{g&&g(d);c=a.UTILITIES.match(b,d);if("matched"===c)return n.push(d),e=c,b.matching_widget=d,!0;if(!c.is_widget)e=c;else if(!e||e.is_widget)e=c}}.bind(this));if("matched"!==e)return this.match_status=e,!0}.bind(this)),"matched"!==this.match_status&&(n=void 0),this.set_backside_matched_widgets(n)));if("matched"===this.match_status)return k||(k=this.get_queue()||a.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),
k.enqueue(this),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),this.rerender(),this.get_next_robot()?this.get_next_robot().run():this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){b=this.get_next_robot().run();if("matched"===b)return b;b.is_widget||b.forEach(function(a){0>this.match_status.indexOf(a)&&
this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(q=function(){this.set_waiting(!1);this.run()}.bind(this),this.match_status.forEach(function(a){a[0]?a[0].run_when_non_empty(q,this):a.run_when_non_empty(q,this)}.bind(this)),this.set_waiting(!0));return this.match_status};c.set_waiting=function(b){var c=this.get_frontside_element();c&&(b?this.visible()&&(a.UTILITIES.add_animation_class(c,"toontalk-robot-waiting"),a.UTILITIES.give_tooltip(c,"This robot is waiting for a bird to deliver something.")):
($(c).removeClass("toontalk-robot-waiting"),a.UTILITIES.give_tooltip(c,this.get_title())))};c.run_actions=function(){return this.stopped()?(this.get_first_in_team().set_running(!1),!1):this.get_first_in_team().visible()?this.get_body().run_watched(this):this.get_body().run_unwatched(this)};c.drop_from_data_transfer=function(a,c){var d;a.is_top_level&&a.is_top_level()?(d=a.get_backside_widgets().slice(),setTimeout(function(){d.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=
1E3;this.dropped_on(a,c.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};c.ignore_pick_up_or_drop=function(a){return this===a.get_widget()||a.is_top_level()||this.get_parent_of_frontside()===a};c.picked_up=function(b,c,d){var k,e;if(!this.ignore_pick_up_or_drop(b))return b.get_infinite_stack&&b.get_infinite_stack()?this.current_action_name="pick up a copy of":this.current_action_name="pick up",d?(e=b,c=b.copy({fresh_copy:!0}),c=a.path.get_path_to_resource(c)):
c=a.path.get_path_to(b,this,!0),c&&(d=Date.now(),k={time:d-this.time_of_last_step},this.time_of_last_step=d,k=a.robot_action.create(c,this.current_action_name,k),this.add_step(k,e)),b.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(b),k};c.dropped_on=function(b,c){var d,k,e,h,q;if(!(this.ignore_pick_up_or_drop(b)||this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===b)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,
!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(d=a.path.get_path_to(c,this))c.is_backside()?(e=$(c.get_element()),k=e.offset(),h=e.width(),q=e.height(),e=$(b.get_frontside_element()).offset(),h=(e.left-k.left)/h,k=(e.top-k.top)/q,h=Math.max(0,Math.min(1,h)),k=Math.max(0,Math.min(1,k)),k={left_offset_fraction:h,top_offset_fraction:k}):k={},e=Date.now(),k.time=e-this.time_of_last_step,this.time_of_last_step=e,d=a.robot_action.create(d,this.current_action_name,
k),this.add_step(d);b.last_action=this.current_action_name+" "+c.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};c.dropped_on_text_area=function(a,c,d){h(a,"drop it on the text area of",this,d);a.last_action="drop it on the text area of "+c.get_type_name();this.set_thing_in_hand(void 0)};c.copied=function(a,c,d){d=d?"pick up a copy of":"copy";h(a,d,this,void 0,c);c.last_action=d};c.removed=function(a){var c;this.get_parent()&&(c=this.get_parent().get_widget());h(a,
"remove",this);a.last_action="remove";c===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};c.restored=function(a){h(a,"restore",this)};c.edited=function(a,c){h(a,"edit",this,c)};c.erased_widget=function(a){h(a,"change whether erased",this)};c.resized_widget=function(a,c,d,k,e){c===k&&d===e||h(a,"change size of",this,{x_factor:k/c,y_factor:e/d})};c.started_training_another=function(a){h(a,"start training",this)};c.finished_training_another=
function(a){h(a,"stop training",this)};c.trained=function(a,c){h(a,"train",this,{step:c})};c.backside_opened=function(a){h(a,"open the backside",this)};c.backside_closed=function(a){a.is_primary_backside()?h(a.get_widget(),"close the backside",this):this.removed(a)};c.button_clicked=function(a,c){h(c.get_widget(),"click the button of",this,{button_selector:a})};c.created_widget=function(b,c,d){this.add_newly_created_widget(b);b.get_parent()||this.add_to_top_level_backside(b,!1);this.add_step(a.robot_action.create(a.path.get_path_to_resource(b.copy()),
"add a new widget to the work space",{button_selector:d,path_to_source:a.path.get_path_to(c,this)}))};c.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};c.remove_from_container=function(a,c){var d=c.get_index_of&&a.get_parent_of_frontside()&&c.get_index_of(a),k=function(){c.removed_from_container(a,void 0,d,!0)};this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(k):k();this.add_newly_created_widget_if_new(a)};c.get_training_context=function(){return this.get_first_in_team().get_parent_of_frontside()&&
this.get_first_in_team().get_parent_of_frontside().get_widget()};c.add_step=function(a,c){this.get_body().add_step(a,c);this.update_title();"train"!==a.get_action_name()&&"start training"!==a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,a)};c.update_display=function(){var b=this.get_frontside(!0);this.get_backside();var c=this.get_thing_in_hand(),d,k;a.debugging&&(this._debug_string=this.to_debug_string());d=b.get_element();c&&(k=c.get_element());
!k&&this.carrying_tool&&(k=document.createElement("div"),$(k).addClass(this.carrying_tool));a.UTILITIES.give_tooltip(d,this.get_title());$(d).addClass("toontalk-robot");$(d).children(".toontalk-held-by-robot").remove();k&&d.appendChild(k);this.match_status&&(this.match_status.is_widget?$(d).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(d).removeClass("toontalk-robot-not-matched"));d.setAttribute("toontalk_name",this.get_name());a.UTILITIES.set_timeout(function(){var b,h,q,g,n;k&&
(n={position:"absolute"},$(k).addClass("toontalk-held-by-robot"),b=a.UTILITIES.get_element_width(k),a.UTILITIES.get_element_height(k),q=a.UTILITIES.get_element_width(d),g=a.UTILITIES.get_element_height(d),c&&0===b&&(b=c.get_default_width?c.get_default_width():2*q,h=c.get_default_height?c.get_default_height():g/2,n.width=b,n.height=h),n.left=(q-b)/2,n.top=g/4,$(k).css(n),c&&c.rerender())})};c.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};c.add_newly_created_widget_if_new=
function(a){if(a!==this.get_training_context()&&this!==a)return this.get_body().add_newly_created_widget_if_new(a)};c.is_newly_created=function(a){return this.get_body().is_newly_created(a)};c.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-1]};c.get_title=function(){var a=this.get_description();if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?
"Drag this robot to a work area.":this.toString()};c.toString=function(b){var c,d,k,e,h,q,g,n,t,v,r,m,z;if(b&&"conditions"===b.role)return"any robot";if(b&&"match_status"===b.role)return"robot "+this.get_name();c=this.get_frontside_conditions();if(!c)return"an untrained robot";g=c.is_top_level();b||(b={});r=b.person;if(b&&b.resource){if(this.get_description())return'"'+this.get_description()+'"';b.person="third"}d=this.get_backside_conditions();e=this.get_body();q=h="";t=this.get_next_robot();g?v=
"When the workspace's green flag "+a.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" is pressed":(n=a.UTILITIES.add_a_or_an(c.get_full_description({role:"conditions"})),v="When working on something that matches "+n);d&&(d.forEach(function(b){b&&(v+=" and\nif on the"+(g?" work area ":" back ")+" is "+a.UTILITIES.add_a_or_an(b.get_full_description({role:"conditions"})),k=!0)}),k&&(v+="\n"));if(this.being_trained){if(e.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";
h="is being trained.\n";q="\n..."}e=h+v+(b&&"third"===b.person?" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(e.toString({robot:this})||"do nothing")+q;if(b&&b.resource)return b.person=r,e.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(z=c.is_top_level()?"the work area I'm running on":"the "+c.get_type_name()+" I'm on the back of",this.match_status===c?m=z:this.match_status.has_ancestor(c)?m="the "+(this.match_status.last_match?this.match_status.last_match.toString():
"thing")+" inside the "+z:(c.is_top_level()||(z="the "+this.match_status.get_type_name()+" on "+z),d.some(function(a){if(this.match_status===a)return m="any "+a.get_type_name(!0)+" on ",c.is_top_level()||(m+="the back of "),m+=z,!0;if(this.match_status.has_ancestor(a))return m="any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+z,!0}.bind(this))),e="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+
m+". Perhaps editing my conditions will help.\n"+e):"matched"!==this.match_status&&(e="I'm waiting for something to be delivered to the nest that matches "+a.UTILITIES.add_a_or_an(this.match_status[0][1].toString())+" in my conditions (highlighted in yellow on my backside).\n"+e));t&&(e+="\nIf it doesn't match then the next robot will try to run.\n"+t.toString());return e};c.get_type_name=function(a){return a?"robots":"robot"};c.maintain_proportional_dimensions=function(){return!0};c.matching_resource=
function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&this.get_body().is_empty()&&a.get_body().is_empty()};c.get_top_level_context_description=function(a){var c=this.get_frontside_conditions().get_type_name();return"top-level"===c?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+c+" he's working on":"the "+c+" I'm working on"};c.get_help_URL=function(){return"docs/manual/robots.html"};c.drop_area_instructions=function(){return this.get_next_robot()?
"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};c.get_json=function(b,c,d){var k=this.get_frontside_conditions(),e=this.get_backside_conditions(),h,q=function(){var e=function(e,d){var l=function(a,b){c({type:"robot",frontside_conditions:a,backside_conditions:h,body:g,run_once:this.get_run_once(),next_robot:e,name:this.get_name(),speed:this.get_watched_speed()},b)}.bind(this);this.get_body().get_json(b,function(c,e){g=c;k?k.is_top_level()?
l({type:"top_level"},e):a.UTILITIES.get_json(k,b,l,e):l(void 0,e)},d)}.bind(this);this.get_next_robot()?a.UTILITIES.get_json(this.get_next_robot(),b,e,d):e(void 0,d)}.bind(this),g;e?(h=[],a.UTILITIES.get_json_of_array(e,h,0,b,q,d)):q()};a.creators_from_json.robot=function(b,c){var d,k,e,h;b.thing_in_hand&&(k=a.UTILITIES.create_from_json(b.thing_in_hand,c));b.next_robot&&(d=a.UTILITIES.create_from_json(b.next_robot,c));b.backside_conditions&&($.isArray(b.backside_conditions)?h=a.UTILITIES.create_array_from_json(b.backside_conditions,
c):b.semantic&&a.UTILITIES.available_types.forEach(function(c){b.semantic.backside_conditions[c]&&h.push(a.UTILITIES.get_json(b.semantic.backside_conditions[c],json_history))}));e=a.UTILITIES.create_from_json(b.frontside_conditions||b.bubble,c);d=a.robot.create(e,h,void 0,b.description,k,b.run_once,d,b.name,b.speed);c||(c={});c.robot=d;d.set_body(a.UTILITIES.create_from_json(b.body,c));return d};c.find_conditions_path=function(b,c,d){var k=c.get_frontside_conditions(),e=k===b?"entire_condition":k.get_path_to&&
k.get_path_to(b,d),k=a.path.get_path_to(c,d),h;e||(c=c.get_backside_conditions(),c.some(function(a){if(a&&(e=a.get_path_to(b,d)))return h=a,!0}));if(e)return a.robot.create_conditions_path(e,k,h);a.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};c.create_conditions_path=function(b,c,d){"string"===typeof d&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===d)return d=a,!0});return{dereference_path:function(k){var e=a.path.dereference_path(c,
k),e=d?d:e.get_frontside_conditions();return"entire_condition"===b?e:a.path.dereference_path(b,k,e)},toString:function(){var k="entire_condition"===b?"the ":a.path.toString(b)+" of the ";return d?k+d.toString()+" backside condition of "+a.path.toString(c):k+" front side condition of "+a.path.toString(c)},get_json:function(k,e,h){var q=function(a,h){c.get_json(k,function(a,c){var f=function(b,c){e({type:"path_to_robot_conditions",backside_condition:d&&b,path_to_robot:a,path_within_conditions:b},c)};
"entire_condition"===b?f("entire_condition",c):b.get_json(k,f,c)},h)};d?a.UTILITIES.get_json(d,k,q,h):q(void 0,h)}}};a.creators_from_json.path_to_robot_conditions=function(b){var c=a.UTILITIES.create_from_json(b.path_to_robot),d="entire_condition"===b.path_within_conditions?b.path_within_conditions:a.UTILITIES.create_from_json(b.path_within_conditions);b=b.backside_condition&&a.UTILITIES.create_from_json(b.backside_condition);return a.robot.create_conditions_path(d,c,b)};return c}(window.TOONTALK);
window.TOONTALK.robot_backside=function(a){var h=function(c,b,f,h){c=a.UTILITIES.create_text_element(c);var k=b.get_element(!0),e=document.createElement("div"),u=function(){var c;b.visible()&&($(k).parent().addClass("toontalk-conditions-container"),b.update_display(),c={width:$(e).width(),height:$(e).height(),left:"",top:""},b.use_scaling_transform?b.use_scaling_transform(c):b.is_backside()&&a.UTILITIES.scale_element(k,c.width,c.height,b.get_original_width()||$(k).width(),b.get_original_height()||
$(k).height(),void 0,c),$(k).css(c),b.rerender())};$(k).addClass("toontalk-conditions-contents "+h);f.match_status&&(f.match_status.is_widget?$(f.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==f.match_status&&f.match_status.forEach(function(a){$(a[1].get_element()).addClass("toontalk-conditions-waiting")}));e.appendChild(k);f=a.UTILITIES.create_horizontal_table(c,e);$(f).addClass("toontalk-conditions-panel");a.UTILITIES.run_when_dimensions_known(k,function(){setTimeout(u,
100)});return f},c=function(c,b){var f=b.get_frontside_conditions(),l=b.get_backside_conditions(),k=b.visible(),e;f&&(f.is_top_level()?0>c.firstChild.textContent.indexOf("I always run when the green flag")&&c.insertBefore(a.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),c.firstChild):0===$(c).find(".toontalk-frontside-conditions-area").length&&c.insertBefore(h("I run only if the thing I'm on the back of matches: ",f,b,"toontalk-frontside-conditions-area"),
c.firstChild),f.set_visible(k),f.rerender());l&&l.forEach(function(f){var l;f&&(l=f.is_backside()?"on-backside":f.get_type_name(),e="toontalk-backside-"+l+"-conditions-area",l="bird"===l?a.UTILITIES.create_text_element("And there is a bird on the back."):h("And if "+a.UTILITIES.add_a_or_an(l)+" matches: ",f,b,e),c.insertBefore(l,c.firstChild.nextSibling),f.set_visible(k),f.rerender())})};return{create:function(d){var b=a.backside.create(d),f=b.get_element(),h=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":
"Uncheck this if you want the robot to stop after finishing what he was trained to do."},k=a.UTILITIES.create_check_box(!d.get_run_once(),"toontalk-run-once-check-box","When finished start again",h(d.get_run_once())),e="normal;original;double;half;very fast;very slow".split(";"),u=[1,void 0,2,.5,10,.25],q=function(a){a=e.indexOf(a);return u[a]},g=a.UTILITIES.create_select_menu("robot_speed",e,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.",
"The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),n=a.UTILITIES.create_drop_area(d.drop_area_instructions()),t=d.get_next_robot(),v=a.backside.create_advanced_settings_button(b,d),r=b.update_display.bind(b),m=function(a,b){var c=a.get_frontside_element(!0),e,d;a.get_default_width&&(e=a.get_default_width(),d=a.get_default_height(),$(c).css({left:"",top:"",width:e,
height:d}));b.appendChild(c)},z=b.hide_backside,G=b.add_advanced_settings;b.hide_backside=function(a){z.call(this,a);d.being_trained&&d.training_finished()};$(n).data("drop_area_owner",d);k.button.addEventListener("click",function(b){var c=k.button.checked;d.set_run_once(!c);a.UTILITIES.give_tooltip(k.container,h(!c));d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_run_once",argument_1:!c,toString:"change to "+(c?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});
b.stopPropagation()});g.menu.value=function(a){a=a?u.indexOf(a):0;return e[a]}(d.get_watched_speed());g.menu.addEventListener("change",function(a){d.set_watched_speed(q(a.target.value))});t&&m(t,n);n.addEventListener("drop",function(b){b=a.UTILITIES.get_dragee();(b=a.UTILITIES.widget_side_of_jquery(b))&&b.is_robot()&&(b.get_body().is_empty()?(b=b.open_backside(),$(b.get_element()).find(".toontalk-train-backside-button").click()):(m(b,n),d.set_next_robot(b)))});b.get_next_robot_area=function(){return n};
b.update_display=function(){var b=d.get_frontside_element();b&&a.UTILITIES.give_tooltip(b,d.get_title());r()};a.UTILITIES.when_attached(f,function(){var a=d.get_backside_conditions(),b=d.get_frontside_conditions();a&&a.forEach(function(a){a.set_visible(!0)});b&&b.set_visible(!0)});f.appendChild(this.create_train_button(b,d));c(f,d);f.appendChild(v);b.add_advanced_settings=function(){G.call(b,k.container,g.container,n)};return b},create_train_button:function(d,b){var f=d.get_element();$(f);var h=$("<button>Train</button>").button(),
k=!1;h.addClass("toontalk-train-backside-button");d.change_label_and_title_of_train_button=function(e){e?(h.button("option","label","Stop training "+b.get_name()),a.UTILITIES.give_tooltip(h.get(0),"Click to stop training this robot.")):b.get_body().is_empty()?(h.button("option","label","Train"),a.UTILITIES.give_tooltip(h.get(0),"Click to start training this robot.")):(h.button("option","label","Re-train "+b.get_name()),a.UTILITIES.give_tooltip(h.get(0),"Click to start training this robot all over again."));
a.UTILITIES.visible_element(f)&&c(f,b)};d.change_label_and_title_of_train_button(k);h.get(0).addEventListener("click",function(a){k=!k;d.change_label_and_title_of_train_button(k);k?(b.initialize_backside_conditions(),b.get_body().reset_steps(),b.robot_started_training(b),b.training_started()):b.training_finished();a.stopPropagation()});return h.get(0)}}}(window.TOONTALK)})();(function(){var a=function(a){return"rotate"===a||"skewX"===a||"skewY"===a||"transform-origin-x"===a||"transform-origin-y"===a},h=function(c){return"transform-origin-x"===c||"transform-origin-y"===c?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+c:a(c)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+c:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+c};window.TOONTALK.element=function(c){var d=["left","top","width","height"],b=Object.create(c.widget),f=
function(a,b){var c,d;if(!a)return 0;"number"===typeof a&&(d=a);0===a.length&&(d=0);if("undefined"===typeof d&&(c=a.substring(a.length-1),0<="0123456789x".indexOf(c)&&(d=parseFloat(a),isNaN(d))))return;c=d;0<=["rotate","skewX","skewY"].indexOf(b)&&(c%=360,0>c&&(c+=360));return c},l=function(a,b){var c,d,f;if((b.left||b.top)&&!a.being_dragged&&(c=a.get_parent_of_frontside()))return b.left&&(d=c.is_element()?c.get_original_width():c.get_width(),d=0<d?(b.left%d+d)%d:b.left,b.left!==d&&(b.left=d,f=!0)),
b.top&&(c=c.is_element()?c.get_original_height():c.get_height(),c=0<c?(b.top%c+c)%c:b.top,b.top!==c&&(b.top=c,f=!0)),f};b.create=function(d,e,f,h,g,n,t,v){var r=Object.create(b),m=c.UTILITIES.generate_unique_id(),z=r.drag_started,G={},M={},C,E,B,I,D,Q,H,N,L,P,O,p,w,x,J,T;e||(e=["left","top","width","height"]);r.is_element=function(){return!0};r.get_HTML=function(){return I};r.get_guid=function(){return m};r.get_text=function(){var a,b;return void 0===D&&((a=this.get_frontside_element())?D=a.textContent:
(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),D=a.textContent,$(a).remove()):D=b,""===D&&a&&"IMG"!==a.nodeName&&(this.update_display(),D=a.textContent),""===D)?this.get_HTML():D};r.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>c)break;b+=3;d=a.indexOf("target='_blank'",b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+
a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(I===a)return!1;I=c(a);if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element()?b.innerHTML=I.replace(/ /g,"&nbsp;"):b.innerHTML=I;Q&&this.compute_original_dimensions(!0);return!0};r.set_HTML_from_sub_classes=r.set_HTML;r.set_text=function(a){var b=this.get_frontside_element(),c=function(b){$(b).contents().each(function(){this.nodeType==
Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};r.get_style_attributes=function(){return e};r.set_style_attributes=function(a){e=a};r.get_attribute_widgets_in_backside_table=function(){return G};r.set_attribute_widgets_in_backside_table=function(a){G=a};r.get_original_copies=function(){return M};r.get_pending_css=function(){return O};r.get_transform_css=
function(){return p};r.add_to_css=function(b,c){a(b)?(p||(p={}),p[b]=c):(O||(O={}),O[b]=c)};r.apply_css=function(){var a="",b,d;(O||p)&&(b=this.get_frontside_element())&&!$(b).is(".toontalk-not-observable")&&(jQuery.contains(window.document,b)?(O?(O.width&&(L=O.width),O.height&&(P=O.height)):O={},O.position="absolute",p&&("number"===typeof p.rotate&&(a+="rotate("+p.rotate+"deg)"),"number"===typeof p.skewX&&(a+="skewX("+p.skewX+"deg)"),"number"===typeof p.skewY&&(a+="skewY("+p.skewY+"deg)"),"number"===
typeof p["transform-origin-x"]||"number"===typeof p["transform-origin-y"])&&(O["transform-origin"]=(p["transform-origin-x"]||0)+" "+(p["transform-origin-y"]||0)),L||P?(x&&x.css({width:H,height:N}),this.is_plain_text_element()&&this.plain_text_dimensions(),$(b).css({width:"",height:""}),d=O,c.UTILITIES.run_when_dimensions_known(b,function(e){var f=this.get_parent_of_frontside();l(this,d);c.UTILITIES.scale_element(b,L,P,H,N,a,d,e,!f);O=void 0}.bind(this))):(l(this,O),c.UTILITIES.add_transform_to_css(a,
"",O,0>b.parentElement.className.indexOf("toontalk-box-hole")),$(b).css(O),O=void 0)):c.UTILITIES.when_attached(b,this.apply_css.bind(this)))};r.on_update_display=function(a){w?w.push(a):w=[a]};r.fire_on_update_display_handlers=function(){w&&c.UTILITIES.set_timeout(function(){w.forEach(function(a,b){a()||w.splice(b,1)})})};r.get_image_element=function(){return x};r.set_image_element=function(a,b){x=$(a).find("img");0===x.length?x=void 0:($(b).width(x.width()),$(b).height(x.height()))};r.get_additional_classes=
function(){return v};r.set_additional_classes=function(a){v=a};r.get_children=function(){return h};r.get_child=function(a){if(h)return h[a]};r.set_sound_effect=function(a){C=a;C.volume=c.UTILITIES.get_audio_volume(C)};r.get_sound_effect=function(){return C};r.get_video_object=function(){var a;E||(a=this.get_frontside_element())&&(E=a.getElementsByTagName("video")[0]);return E};r.set_video_object=function(a){E=a};r.get_ignore_pointer_events=function(){return t};r.set_ignore_pointer_events=function(a){t=
a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":"auto"})};r.get_source_URL=function(){return B};r.set_source_URL=function(a){if(B!==a)return B=a,this.refresh(),!0};r.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===H?c.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),function(){c.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,H,N,void 0,a)}.bind(this)):
c.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,H,N,void 0,a)};r.add_standard_widget_functionality(r);J=r.set_running.bind(r);r.set_running=function(a,b){J(a,b);Object.keys(G).forEach(function(c){G[c].set_running(a,b)});!a&&this.visible()&&(e.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());h.forEach(function(c){c.set_running(a,b)})};T=r.can_run.bind(r);r.can_run=function(){var a;if(T())return!0;Object.keys(G).some(function(b){if(G[b].can_run())return a=
!0});if(a)return a;h.some(function(b){if(b.can_run())return a=!0});return a};r.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;z.call(this,a,b)};r.update_display=function(){var a=this.get_frontside_element(!0);this.get_backside();var b=function(a){return this.get_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged)if(this.get_erased()){var d;d=$(a).parent(".toontalk-backside").is("*")?
b="":b="100%";this.save_dimensions();$(a).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:b,height:d,position:"",transform:""});$(a).parent(".toontalk-conditions-container").is("*")?c.UTILITIES.give_tooltip(a,"This is an element that has been erased. It will match any element."):c.UTILITIES.give_tooltip(a,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(a).is(".toontalk-erased-element")&&($(a).removeClass("toontalk-erased-element"),
this.restore_dimensions()),this.initialize_element(),c.UTILITIES.on_a_nest_in_a_box(a)&&(this.set_attribute("width",$(a).closest(".toontalk-box-hole").width(),!1),this.set_attribute("height",$(a).closest(".toontalk-box-hole").height(),!1)),"undefined"===typeof H&&a.parentElement&&(this.is_plain_text_element()?this.plain_text_dimensions():this.compute_original_dimensions()),this.apply_css(),h?h.forEach(function(b){a.appendChild(b.get_frontside_element(!0));b.set_visible(!0);b.update_display()}):h=
[],this.fire_on_update_display_handlers(),c.UTILITIES.give_tooltip(a,"Click to see the backside where you can place robots or change the style of this "+b(a)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};r.initialize_element=function(){var a,b;!Q&&(a=this.get_frontside_element())&&($(a).children(".ui-resizable-handle"),I=this.get_HTML(),b=this.is_plain_text_element(),a.innerHTML=b?I.replace(/ /g,"&nbsp;"):I,$(a).addClass("toontalk-element-frontside"),b?((b=this.get_additional_classes())&&
$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.location_constrained_by_container()||this.plain_text_dimensions()):$(a).addClass("toontalk-non-plain-text-element"),Q=!0)};r.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};r.plain_text_dimensions=function(){H=9*this.get_HTML().length;N=24};r.compute_original_dimensions=function(a){c.UTILITIES.original_dimensions(this,function(a,b){var c=this.get_parent_of_frontside();H=a;N=b;c&&c.get_box?
c.get_box().rerender():(e.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),a)};r.get_attribute_from_current_css=function(a){var b,d;if("width"===a&&(L||H))return L||H;if("height"===a&&(P||N))return P||N;b=this.get_frontside_element(!0);d=c.UTILITIES.get_style_numeric_property(b,a);""===d&&(d=$(b).css(a));if(!d)return 0;if("number"===typeof d){if(H&&P){if("left"===a)return d+(H-L)/2;if("top"===a)return d+(N-P)/2}return d}return"%"!==d.charAt(d.length-
1)||"left"!==a&&"top"!==a?d:$(b).offset()[a]};r.get_original_width=function(){return H};r.get_original_height=function(){return N};r.increment_width=function(a){this.set_attribute("width",(L||H)+a)};r.increment_height=function(a){this.set_attribute("height",(P||N)+a)};r.get_width=function(){return L};r.get_height=function(){return P};r.add_child=function(a){var b=$(a.get_frontside_element(!0)),d=$(this.get_frontside_element(!0)),e;h.push(a);a.set_parent_of_frontside(this);e=c.UTILITIES.set_position_relative_to_element(b,
d,b.offset(),!0);a.is_element()&&a.set_location_attributes(e.left,e.top);d.get(0).dispatchEvent(c.UTILITIES.create_event("widget added",{element_widget:b.get(0),where:"front"}));this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)};r.removed_from_container=function(a,b){var c=h.indexOf(a);0<=c&&h.splice(c,1)};r.set_HTML(d.toString());r.set_description(f);g&&("string"===typeof g?r.set_sound_effect(new Audio(g)):r.set_sound_effect(g));n&&("string"===typeof n?d="<video src='"+n+"' alt='"+
n+"'/>":E=n);c.debugging&&(r._debug_id=c.UTILITIES.generate_unique_id(),r._debug_string=r.to_debug_string());h?h.forEach(function(a){a.set_parent_of_frontside(r)}):h=[];return r};b.copy=function(a){var d=this.get_style_attributes(),f=b.create(this.get_HTML(),d.slice(),this.get_description(),c.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),h=this.get_attribute_widgets_in_backside_table(),g={},l=f.get_backside(this.visible());
f.set_source_URL(this.get_source_URL());a&&(a.elements_copied||(a.elements_copied={}),a.elements_copied[this.get_guid()]=f);Object.keys(h).forEach(function(b){g[b]=h[b].copy(a);g[b].set_parent_of_frontside(l,!1,!0);f.set_attribute(b,this.get_attribute(b))}.bind(this));f.set_attribute_widgets_in_backside_table(g);return this.add_to_copy(f,a)};b.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?
a.match_with_another_element_widget(this):(this.last_match=a,this)};b.match_with_any_element=function(){return"matched"};b.match_with_another_element_widget=function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};b.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};b.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());
return 0>a?-1:0<a?1:a};b.get_path_to=function(a,c){var d=this.get_children(),f=d.indexOf(a),g,h;if(0<=f)return b.path.create(f);d.forEach(function(d,f){d.get_path_to&&(h=d.get_path_to(a,c))&&(g=b.path.create(f),g.next=h)});return g};c.creators_from_json.element_path=function(a,d){var f=b.path.create(a.index);a.next&&(f.next=c.UTILITIES.create_from_json(a.next,d));return f};b.dereference_path=function(a,b){var d,f;if(a){d=a.get_index&&a.get_index();if(!c.debugging||"number"===typeof d)if(f=this.get_children(),
d=f[d]){if(d.dereference_contents&&!a.not_to_be_dereferenced)return d.dereference_contents(a.next||a,b);if(a.next){if(d.dereference_path)return d.dereference_path(a.next,b);c.UTILITIES.report_internal_error("Expected to refer to a child of "+d+" but it lacks a method to obtain "+c.path.toString(a.next))}a.removing_widget&&(d.get_infinite_stack()||b.remove_from_container(d,this));return d}c.UTILITIES.report_internal_error(this+" unable to dereference the path: "+c.path.toString(a))}else return this};
b.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+c.UTILITIES.ordinal(a)+" widget "},get_json:function(b,c,d){c({type:"element_path",index:a,next:this.next&&this.next.get_json(b)},d)}}}};b.widget_side_dropped_on_me=function(a,b,c){if(a.is_backside())return!1;this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};b.create_backside=function(){return c.element_backside.create(this)};
b.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};b.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a),d;"left"===a?(d=this.get_frontside_element(),d=c.UTILITIES.translate_x(d)):"top"===a?(d=this.get_frontside_element(),d=c.UTILITIES.translate_y(d)):d=0;return"undefined"!==typeof b&&"auto"!=b?b+d:this.get_attribute_from_current_css(a)+d};b.set_attribute=function(a,b,d,h){var g=this.get_frontside(!0).get_element(),
l;if(!g)return!1;l="left"===a?c.UTILITIES.translate_x(g):"top"===a?c.UTILITIES.translate_y(g):0;g=this.get_attribute_from_pending_css(a);b-=l;if(g===b||"undefined"===typeof g&&(g=this.get_attribute_from_current_css(a),g===b))return!1;l=f(b,a);if("number"===typeof l){if(g==l)return!1;c.logging&&0<=c.logging.indexOf("attribute:")&&0<=c.logging.indexOf(a)&&console.log("Attribute "+a+" set to "+l+" was "+g+" at "+Date.now()+" for "+this);b=l}d&&this.robot_in_training()&&this.robot_in_training().edited(this,
{setter_name:"set_attribute",argument_1:a,argument_2:b,toString:"change the '"+a+"' style to "+b+" of",button_selector:".toontalk-element-"+a+"-attribute-input"});this.add_to_css(a,b);h&&(b=this.get_style_attributes(),0>b.indexOf(a)&&b.push(a));this.rerender();return!0};b.dropped_on_style_attribute=function(a,b,c,d){var f,h,l;if(a){f=a.toString();if(a.is_number()){h=this.get_attribute(b);if("number"===typeof h)l=h;else if("auto"===h)switch(b){case "left":l=$(this.get_frontside_element()).offset().left;
break;case "top":l=$(this.get_frontside_element()).offset().top;break;default:l=0}else l=parseFloat(h);h=a.to_float();switch(f.substring(0,1)){case "-":f=l-h;break;case "*":f=l*h;break;case "/":f=l/h;break;case "^":f=Math.pow(l,h);break;default:f=l+h}this.set_attribute(b,f,!1);(c||d&&d.visible())&&this.get_backside().render()}a.get_infinite_stack()||a.remove();c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};b.get_attribute_widget_in_backside_table=
function(a,b,c){var d=this.get_attribute_widgets_in_backside_table()[a];d||b||(d=this.create_attribute_widget(a,c),this.get_attribute_widgets_in_backside_table()[a]=d);return d};b.create_attribute_widget=function(a,b){var f=".toontalk-element-"+a+"-attribute-input",q=this.get_backside_element(),g=this.get_attribute(a),n=this,t=function(a,b){var d=b.toString,e=b.equals,f=b.remove;M=b.update_display;b.element_widget=this;b.attribute=a;b.get_type_name=function(a){return a?"element attributes":"element attribute"};
b.toString=function(){return d.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};b.get_default_description=function(){return"a number that is the "+this.attribute+" of "+this.get_attribute_owner().toString({plain_text:!0})+"."};b.get_custom_title_prefix=function(){return"I'm the '"+this.attribute+"' attribute of "+this.get_attribute_owner()+".\nDrop a number on me or edit my backside to change my value. My backside has an info button to learn more."};b.equals=function(b){return a===
b.attribute?this.equals(b.element_widget):e.call(this,b)};b.update_display=function(){var a,b,c;this.get_erased()||(a=this.get_attribute_owner(),a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_element()&&!a.being_dragged?(c={},b=bigrat.toDecimal(this.get_value()),c[this.attribute]=b,l(a,c)&&this.set_value(c[this.attribute]),$(a.get_frontside_element()).css(c)):(a=a.get_attribute(this.attribute),isNaN(a)||G(a)));M.call(this)};z=b.copy.bind(b);b.copy=function(b){var c;if(b){if(b.just_value)return z(b);
b.elements_copied&&(c=b.elements_copied[n.get_guid()])}return this.add_to_copy((c||n).create_attribute_widget(a),b)};b.get_json=function(b,d,e){c.UTILITIES.get_json(n,b,function(b,c){d({type:"attribute_widget",attribute_name:a,element:b},c)},e)};b.get_original_attribute_widget=function(){var b=n.get_original_copies()[a];return b&&b[0]};b.is_attribute_widget_copy=function(b){var c=n.get_original_copies()[a];return c&&0<=c.indexOf(b)};b.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;
if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():n;if(!b.get_widget().is_element())return n;b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=b.get_parent_of_backside();return b};b.remove=function(b,c){var d=n.get_original_copies()[a],e=d&&d.indexOf(this);0<=e&&d.splice(e,1);f.call(this,b,c)};b.get_help_URL=function(){return h(a)}}.bind(this),v=function(a,
b){var d=c.number.create(0,1);t(a,d);d.set_value_from_decimal(b);d.set_format("decimal");d.set_value=function(b){try{var d=n.get_original_copies()[a],e="number"===typeof b?b:bigrat.toDecimal(b),f=bigrat.fromDecimal(e);this.get_attribute_owner().set_attribute(this.attribute,e)&&d.forEach(function(a,b){a.set_value_from_sub_classes(f,!0)});return this.set_value_from_sub_classes(f,!1)}catch(g){return c.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+g),!1}};d.is_attribute_widget=
function(){return!0};d.get_function_type=function(a){return a?"numbers":"number"};return d}.bind(this),r=function(a,b){var d=c.element.create(b);t(a,d);d.set_HTML=function(b){var c=n.get_original_copies()[a],d;this.get_attribute_owner().set_attribute(this.attribute,b)&&c.forEach(function(a,c){d=a.set_HTML_from_sub_classes(b)});return d};d.get_function_type=function(a){return a?"elements":"element"};d.set_additional_classes("toontalk-string-attribute-widget");return d}.bind(this),m;m=0<=["background-color",
"color"].indexOf(a)?"string":"number";var z,G,M,C,E;q&&(f=$(q).find(f),0<f.length&&(f.get(0).toontalk_widget_side=this));if("number"===m){if(C=v(a,g),G=C.set_value_from_decimal.bind(C),0<=d.indexOf(a)&&(this.on_update_display(function(){C.rerender();return!0}),"left"===a||"top"===a))E=function(b){var c,d,e;b.currentTarget.toontalk_widget_side===C.get_attribute_owner()&&(c=C.get_attribute_owner(),b.stopPropagation(),d=$(c.get_frontside_element()).closest(".toontalk-top-level-backside").offset(),d||
(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),d={left:0,top:0}),e=b.pageX-d.left-(c.drag_x_offset||0),d=b.pageY-d.top-(c.drag_y_offset||0),"left"===a?(b=e,c.set_attribute("top",d)):(b=d,c.set_attribute("left",e)),C.set_value_from_decimal(b),M.call(C))},C.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",E);b&&b.get_widget().is_element()&&
b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",E)})}else if("string"===m)C=r(a,g),G=C.set_HTML.bind(C);else{c.UTILITIES.report_internal_error("Unrecognized attribute type: "+m+" for "+a);return}(g=this.get_original_copies()[a])?g.push(C):this.get_original_copies()[a]=[C];return C};c.creators_from_json.attribute_widget=function(a,b){return c.UTILITIES.create_from_json(a.element,b).create_attribute_widget(a.attribute_name,b)};c.creators_from_json.attribute_number=c.creators_from_json.attribute_widget;
b.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};b.toString=function(a){var b,d,f;if(this.get_erased())return"any element";b=function(b){var c="";return 1<b.length&&"<"===b.charAt(0)?(this.get_image_element()&&(c="style='width: 50px; height: 30px;'"),a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'"),"<div "+c+">"+b+"</div>"):'"'+b+'"'}.bind(this);d=function(){var a=
this.get_HTML(),b=a.indexOf("alt="),c;return 0<=b&&(c=a.indexOf("'",b+5),0<=c)?"("+a.substring(b+5,c)+")":""}.bind(this);f=this.get_children();if(a&&!a.inside_tool_tip){if(a.for_json_div)return"";b=d();b||(b=(b=this.get_source_URL())?"whose text is the contents of "+b:(b=this.get_text())?'"'+b+'"':"")}else b=b(this.get_HTML());f&&0<f.length&&(b+=" with "+c.UTILITIES.describe_widgets(f)+" on top");return"the element "+b};b.get_type_name=function(a){return a?"elements":"element"};b.get_help_URL=function(){return"docs/manual/elements.html"};
b.get_json=function(a,b,d){var f=this.get_style_attributes(),g=c.UTILITIES.remove_z_index(this.get_HTML()),h=encodeURIComponent(g),l=[],v;100<=g.length?(a.shared_html||(a.shared_html=[]),g=a.shared_html.indexOf(h),0>g&&(g=a.shared_html.push(h)-1),v={shared_html_index:g}):v=h;h=function(){var g=[],h=function(n){var G=function(){h(n+1)},M,C;n>=f.length?b({type:"element",html:v,attributes:f,attribute_values:f.map(this.get_attribute.bind(this)),attributes_backsides:g,additional_classes:this.get_additional_classes(),
children:0<this.get_children().length&&l,sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()},d,a):(M=f[n],(M=this.get_attribute_widget_in_backside_table(M,!0))?(C=[],g.push(C),c.UTILITIES.get_json_of_array(M.get_backside_widgets(),C,0,a,G,d)):(g.push(null),G()))}.bind(this);h(0)}.bind(this);0<this.get_children().length?c.UTILITIES.get_json_of_array(this.get_children(),
l,0,a,h,d):h()};c.creators_from_json.element=function(a,d){var h=decodeURIComponent("string"===typeof a.html?a.html:d.shared_html&&d.shared_html[a.html.shared_html_index]),l,g,n,t;a.children&&(g=d.is_child,d.is_child=!0,l=c.UTILITIES.create_array_from_json(a.children,d),d.is_child=g);if(!h&&(h="string"===typeof a.html?"No json.html recreating an element widget.":"additional_info.shared_html missing while recreating an element widget.",!c.debugging))throw h;t=b.create(h,a.attributes,a.description,
l,a.sound_effect,a.video,a.ignore_pointer_events);n=d&&d.event?["left","top"]:[];a.attribute_values.forEach(function(b,g){var h=a.attributes[g],l=a.attributes_backsides&&a.attributes_backsides[g];(d.is_child||0>n.indexOf(h))&&(0!==b||"width"!==h&&"height"!==h)&&t.add_to_css(h,f(b)||b);l&&(h=t.get_attribute_widget_in_backside_table(h,!1,d),c.UTILITIES.add_backside_widgets_from_json(h,l,d))}.bind(this));a.additional_classes&&t.set_additional_classes(a.additional_classes);a.source_URL&&(t.set_source_URL(a.source_URL),
t.refresh());l&&c.UTILITIES.when_attached(function(){l.forEach(function(b,d){var e=a.children[d]&&a.children[d].widget&&a.children[d].widget.view;e&&c.UTILITIES.set_css(b.get_frontside_element(!0),{left:e.frontside_left,top:e.frontside_top})})});return t};b.create_attribute_path=function(a,b){var d=c.path.get_path_to(a.element_widget,b,!0);return this.extend_attribute_path(d,a.attribute)};b.refresh=function(){this.get_source_URL()&&c.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&
this.set_HTML(a.get_HTML())}.bind(this))};b.extend_attribute_path=function(a,b){return{dereference_path:function(c){return(c=a.dereference_path(c,c.get_top_level_context()||c.get_context()))&&c.get_widget().get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+b+"' property of "+c.path.toString(a)},get_json:function(d,f,g){c.path.get_json(a,d,function(a,c){f({type:"path_to_style_attribute",attribute:b,element_widget_path:a},c)},g)}}};c.creators_from_json.path_to_style_attribute=
function(a,d){var f=c.UTILITIES.create_from_json(a.element_widget_path,d);return b.extend_attribute_path(f,a.attribute)};b.set_size_attributes=function(a,b,d){d?(this.add_to_css("width",a),this.add_to_css("height",b)):(this.set_attribute("width",a),this.set_attribute("height",b));c.UTILITIES.set_timeout(function(){this.rerender()}.bind(this))};b.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};b.receive_HTML_from_dropped=function(a){var b=a.get_text&&
a.get_text();a.remove();if(this.set_HTML(b))return this.get_text()};b.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};b.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):
"top"===a&&(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};b.remove_style_attribute=function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return b}(window.TOONTALK);window.TOONTALK.element_backside=function(a){var d=
function(b,d,h){var e;h.visible()&&(e=d.get_style_attributes(),d.get_frontside_element(),$(b).empty(),e.forEach(function(e){d.get_attribute(e);var q=document.createElement("tr"),g=document.createElement("td"),n=h.is_primary_backside()?d.get_attribute_widget_in_backside_table(e):h.get_widget().create_attribute_widget(e),t=n.get_frontside_element(!0);n.set_parent_of_frontside(h,!1,!0);n.set_infinite_stack(!0);b.appendChild(q);q.appendChild(g);g.appendChild(a.UTILITIES.create_text_element(e));g=document.createElement("td");
q.appendChild(g);n.set_visible(!0);$(t).addClass("toontalk-element-attribute");g.appendChild(t)}))},b=function(b,d){var h=$("<button>Add or remove my style attributes</button>").button();h.addClass("toontalk-show-attributes-chooser-button");h.get(0).addEventListener("click",function(e){a.UTILITIES.visible_element(b)?($(b).hide(),h.button("option","label","Add or remove my style attributes"),a.UTILITIES.give_tooltip(h.get(0),"Click to add widgets for my style attributes.")):($(b).show(),h.button("option",
"label","Hide my style attributes list"),a.UTILITIES.give_tooltip(h.get(0),"Click to hide my list of attributes that can be added or removed."));d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",d)});a.UTILITIES.give_tooltip(h.get(0),"Click to add widgets for my style attributes.");return h.get(0)};return{create:function(f){var l=a.backside.create(f),k=l.get_element();f.get_HTML();var e=document.createElement("table"),u=document.createElement("div"),
q=b(u,f),g=a.backside.create_advanced_settings_button(l,f),n=a.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),t=a.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),v=t?"get_HTML":"get_text",r=l.update_display.bind(l),m=l.add_advanced_settings,z,G,M,C,E,B,I,D,Q,H;f.initialize_element();z=f[v]().trim();
0<z.length&&!f.get_image_element()&&(M=function(b){(b=a.UTILITIES.input_area_drop_handler(b,f.receive_HTML_from_dropped.bind(f),f))&&f.robot_in_training()&&f.robot_in_training().dropped_on_text_area(b,f,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},G=a.UTILITIES.create_text_area(z,"toontalk-html-input","My HTML is","Type here to edit the text.",M),z=function(a){a=G.button.value.trim().replace(/\xA0/g," ");f.get_frontside_element();var b=
t?"set_HTML":"set_text";f[b](a)&&f.robot_in_training()&&f.robot_in_training().edited(f,{setter_name:b,argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(G.container).css({width:"100%"}),$(G.button).css({width:"100%"}),G.button.addEventListener("change",z),G.button.addEventListener("mouseout",z),f.is_plain_text_element()&&k.appendChild(G.container),f.get_source_URL()&&(M=function(b){var d=a.UTILITIES.input_area_drop_handler(b,f.receive_URL_from_dropped.bind(f),
f);d&&f.robot_in_training()&&f.robot_in_training().dropped_on_text_area(d,f,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});b.stopPropagation()},z=function(a){a=C.button.value.trim().replace(/\xA0/g," ");f.get_frontside_element();f.set_source_URL(a)&&f.robot_in_training()&&f.robot_in_training().edited(f,{setter_name:"set_source_URL",argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},C=
a.UTILITIES.create_text_input(f.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,M),C.button.addEventListener("change",z),C.button.addEventListener("mouseout",z),k.appendChild(C.container)));l.update_style_attribute_chooser=function(){var b=function(b,f,g){var k=0<=g.get_style_attributes().indexOf(b),l=a.UTILITIES.create_check_box(k,"toontalk-style-attribute-check-box",b+"&nbsp;","Click to add or remove the '"+b+"' style attribute from my backside."),
n="toontalk-style-attribute-check-box-for-"+b,k=a.UTILITIES.create_anchor_element("i",h(b)),m=document.createElement("li"),t=function(a){l.button.checked?g.add_style_attribute(b):g.remove_style_attribute(b);d(e,g,g.get_backside());g.robot_in_training()&&g.robot_in_training().edited(g,{setter_name:l.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:b,toString:(l.button.checked?"add":"remove")+" a widget for the "+b+" attribute of",button_selector:"."+n})};$(k).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");
$(k).css({color:"white"});k.translate=!1;k.lang="en";l.container.appendChild(k);$(l.button).addClass(n);l.button.addEventListener("click",t);l.button.addEventListener("touchstart",function(a){l.button.checked=!l.button.checked;t(a)});m.appendChild(l.container);f.appendChild(m)},g=function(a,c,d){var e,f;"string"===typeof a?b(a,c,d):a.label?(e=document.createElement("h3"),e.textContent=a.label,f=document.createElement("ul"),c.appendChild(e),c.appendChild(f),g(a.sub_menus,f,d)):a.forEach(function(a){g(a,
c,d)})};$(u).is(".ui-accordion")&&$(u).accordion("destroy");$(u).empty();g([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],u,f);$(u).accordion({active:0,
heightStyle:"content"});return u};l.get_attributes_chooser=function(){return u};l.add_advanced_settings=function(){var a;m.call(l);a=$(k).children(".toontalk-advanced-settings-table");0<a.length&&(a.get(0).appendChild(n.container),a.get(0).appendChild(u),a.get(0).appendChild(q),f.is_plain_text_element()||a.get(0).appendChild(G.container))};f.get_sound_effect()?(I=f.get_sound_effect(),D=function(){l.visible()&&(I.paused?(a.UTILITIES.give_tooltip(E.get(0),"Click to begin playing this sound."),E.button("option",
"label","Play sound")):(a.UTILITIES.give_tooltip(E.get(0),"Click to pause this sound."),E.button("option","label","Pause sound")))},E=$("<button>Play sound</button>").button(),E.addClass("toontalk-play-sound-effect-button"),z=function(b){I.paused?(a.UTILITIES.play_audio(I),I.addEventListener("ended",D)):I.pause();D();f.robot_in_training()&&f.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",f)},E.get(0).addEventListener("click",z),D(),k.appendChild(E.get(0))):$(f.get_frontside_element()).find("video").is("*")&&
(Q=f.get_video_object(),H=function(){l.visible()&&(Q.paused?(a.UTILITIES.give_tooltip(B.get(0),"Click to begin playing this video."),B.button("option","label","Play video")):(a.UTILITIES.give_tooltip(B.get(0),"Click to pause this video."),B.button("option","label","Pause video")))},B=$("<button>Play video</button>").button(),B.addClass("toontalk-play-video-button"),z=function(a){Q.paused?(Q.play(),Q.addEventListener("ended",H)):Q.pause();H();f.robot_in_training()&&f.robot_in_training().button_clicked(".toontalk-play-video-button",
f)},B.get(0).addEventListener("click",z),H(),k.appendChild(B.get(0)));l.update_style_attribute_chooser();d(e,f,l);k.appendChild(e);k.appendChild(g);$(u).hide();$(u).addClass("toontalk-attributes-chooser");l.update_display=function(){G&&$(G.button).val(f[v]());d(e,f,l);a.UTILITIES.visible_element(u)&&l.update_style_attribute_chooser();f.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});r()};$(k).find(".toontalk-hide-backside-button").each(function(a,
b){b.addEventListener("click",function(){$(u).hide()})});n.button.checked=!f.get_ignore_pointer_events();n.button.addEventListener("click",function(){f.set_ignore_pointer_events(!n.button.checked)});n.button.addEventListener("touchstart",function(){n.button.checked=!n.button.checked;f.set_ignore_pointer_events(!n.button.checked)});return l}}}(window.TOONTALK);window.TOONTALK.element["function"]=function(a){var d=a.create_function_table();d.add_function_object("join text",function(b,f,h){var k="";
return d.typed_bird_function(b,function(){for(i=0;i<arguments.length;i++)k+=arguments[i].get_text();return a.element.create(k)},[void 0],void 0,"join",f,h)},"The bird will return with a new element that is made by joining all the elements and numbers.","join",["any number of numbers or elements"]);d.add_function_object("part of text",function(b,f,h){return d.typed_bird_function(b,function(b,d,f){d=Math.round(d.to_float());f=Math.round(f.to_float());return a.element.create(b.get_text().substring(d+
1,f+1))},["element","number","number"],3,"part of text",f,h)},"The bird will return with a new element whose text is the part of the text of the first element (or number) beginning with the first number ending with the second number. 1 is for the first letter.","part",["an element followed by two postive numbers"]);d.add_function_object("length of text",function(b,f,h){return d.typed_bird_function(b,function(b){return a.number.create(b.get_text().length)},[void 0],1,"length of text",f,h)},"The bird will return with a number that is length of the text of the first element (or number).",
"length",["an element or number"]);d.add_function_object("text as number",function(b,f,h){return d.typed_bird_function(b,function(b){b=b.get_text();var d;d=b.indexOf("/");0<=d?d=a.number.create(b.substring(0,d),b.substring(d+1,b.length)):(d=a.number.create(0),d.set_value_from_decimal(b));return d},[void 0],1,"text as number",f,h)},"The bird will return with a number that has the same text as the element. Arithmetic can be done on the result unlike the original text.","text as number",["an element"]);
d.add_function_object("go to page",function(b,f,h){return d.typed_bird_function(b,function(b){this.robot_in_training()?a.UTILITIES.display_message("Robot trained to replace current URL."):window.location.assign(b.get_text())},["element"],1,"replace page",f,h)},"The bird will cause the current page to be replaced by the new URL. The back button should return to the current page.","page",["an element containing a URL"]);d.add_function_object("speak",function(b,f,h){f=function(f){var t,v;if(f){if(!window.speechSynthesis)return!0;
v=function(e){var f=a.element.create(t,[],"a response to speaking '"+t+"'");d.process_response(f,k.bird,b,e,h)};f=f.get_widget();t=f.get_text?f.get_text():f.toString();a.TRANSLATION_ENABLED?a.UTILITIES.translate(t,function(b){a.UTILITIES.speak(b,v,e,u,q,g)}):a.UTILITIES.speak(t,v,e,u,q,g)}else a.UTILITIES.display_message("Speaking birds need something in the second box hole.")};var k=d.check_message(b),e,u,q,g;if(k)if(2>k.size)a.UTILITIES.display_message("Speaking birds need a box with two or more holes.");
else return(e=b.get_hole_contents(2))&&(e=e&&e.to_float&&e.to_float()),(u=b.get_hole_contents(3))&&(u=u&&u.to_float&&u.to_float()),(q=b.get_hole_contents(4))&&(q=q&&q.to_float&&q.to_float()),(g=b.get_hole_contents(5))&&(g=g&&g.to_float&&g.to_float()),f(b.get_hole_contents(1)),!0},"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);return d.get_function_table()}(window.TOONTALK)})();window.TOONTALK.sensor=function(a){var h=Object.create(a.widget),c=function(a,b){"element"===a.get_type_name()&&(a.set_additional_classes("toontalk-string-value-from-sensor"),b.visible()&&a.rerender())};h.create=function(d,b,f,l,k,e,u){var q=a.nest.create(f,l,"sensor",void 0,void 0,u||"sensor"),g=q.get_json,n=q.update_display,t=q.set_running,v=q.copy,r=b.split(" "),m,z=function(b){switch(typeof b){case "number":b=a.number.create(Math.round(b),1);break;case "string":b=a.element.create(b,void 0,void 0,
void 0,void 0,void 0,"toontalk-string-value-from-sensor");c(b,q);break;case "boolean":b=a.element.create(b.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");c(b,q);break}return b},G=function(b){var c,e,f;if(q.get_active()){c=m(b);e=q.get_attributes();f=q.visible();b=$(q.get_frontside_element()).closest(".toontalk-top-level-backside");if(1===c.length){if(c=z(c[0]),"undefined"===typeof c)return}else c=a.box.create(c.length,!0,c.map(z),"the values of the "+a.UTILITIES.conjunction(e)+
" attributes of "+a.UTILITIES.add_a_or_an(d)+" event.",e.join(";"));f?(f=a.bird.create(q),q.add_to_top_level_backside(f),c.render(),f.animate_delivery_to(c,q,q,b.width()/2,b.height())):q.add_to_contents(c)}}.bind(this);q.is_sensor=function(){return!0};q.copy=function(b){var c;if(b&&b.just_value&&this.has_contents())return v.call(this,b);c=b?a.sensor.create(d,this.get_attributes_string(),f,void 0,b.copying_resource||k,e,this.get_name()):a.sensor.create(d,this.get_attributes_string(),f,void 0,k,e,this.get_name());
return q.add_to_copy(c,b)};q.get_json=function(b,c,f){var h=function(f,g){var h;f.type="sensor";f.event_name=d;f.attribute=this.get_attributes_string();f.active=k;e?(h=function(a){f.sensor_of=a;c(f,g)},a.UTILITIES.get_json(e,b,h,g)):c(f,g)}.bind(this);g.call(this,b,h,f)};q.update_display=function(){var a=$(this.get_frontside_element());n.call(this);k||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):(a.addClass("toontalk-sensor-inactive-nest"),
a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};q.get_type_name=function(a){return a?"sensors":"sensor"};q.get_help_URL=function(){return"docs/manual/sensors.html"};q.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+d+" events"};q.get_class_name_with_color=function(a){return a};q.get_active=function(){return!0===k};q.restore_active=function(){"temporarily false"===k&&this.set_active(!0)};q.set_active=function(a,b){if(k!==
a||b)!0===a?e?e.get_frontside_element(!0).addEventListener(d,G):window.addEventListener(d,G):e?e.get_frontside_element(!0).removeEventListener(d,G):window.removeEventListener(d,G),k=a};q.set_running=function(a){this.set_active(a);t.call(this,a)};q.set_active(k,!0);q.create_backside=function(){return a.sensor_backside.create(this)};q.get_event_name=function(){return d};q.set_event_name=function(a){var b=k;d&&k&&this.set_active(!1);d=a;b&&this.set_active(!0)};q.get_attributes=function(){return r};q.set_attributes=
function(a){r=a.split(" ")};q.get_attributes_string=function(){return r.join(" ")};q.match=function(a){this.last_match=a;return this};q.set_sensor_of=function(a){e=a};q.get_custom_title_prefix=function(){var a="When a '"+d+"' event"+(e?" to "+e:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";k?this.get_backside()||(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the 'Listening to events' check box on my back is ticked.";
return a};q.get_default_description=function(){return e?"a sensor for "+e.get_default_description():"a sensor for this document."};q.can_run=function(){return!0};m=function(b){return q.get_attributes().map(function(c){var d=b[c];if("key"===c&&void 0===d){if(d=b.keyIdentifier,0===d.indexOf("U+"))return String.fromCharCode(b.keyCode)}else if("undefined"===typeof d){if(b.detail&&b.detail.element_widget&&("widget"===c||"back"===c))return c=a.UTILITIES.widget_side_of_element(b.detail.element_widget).create_backside(),
c.save_dimensions(),c;if(b.detail&&b.detail.element_widget&&"front"===c)return a.UTILITIES.widget_side_of_element(b.detail.element_widget);if(b.detail&&void 0!==b.detail[c])return b.detail[c];d="No "+c+" in event "+b+" of sensor "+h;a.UTILITIES.display_message(d)}return d})};return q};a.creators_from_json.sensor=function(d,b){var f=a.UTILITIES.create_array_from_json(d.contents,b),h=a.sensor.create(d.event_name,d.attribute,d.description,f,!1,void 0,d.name);d.sensor_of?a.UTILITIES.set_timeout(function(){h.set_sensor_of(a.UTILITIES.create_from_json(d.sensor_of,
b));h.set_active(d.active)}):h.set_active(d.active);0<f.length&&setTimeout(function(){f.forEach(function(a){c(a.get_widget(),h)})},500);return h};return h}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(a){return{create:function(h){var c=a.UTILITIES.create_text_input(h.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+h.get_event_name()),d=a.UTILITIES.create_text_input(h.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
b=a.UTILITIES.create_check_box(h.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),f=a.nest_backside.create(h),l=f.get_element(),k=function(){h.set_event_name(c.button.value.trim())},e=function(){h.set_attributes(d.button.value.trim())},u=a.backside.create_advanced_settings_button(f,h),q=function(a){var c=b.button.checked;h.set_active(c);h.robot_in_training()&&h.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:c,toString:"change to "+(c?"active":"inactive")+" of the "+h,button_selector:".toontalk-sensor-active-check-box"});h.render();a.stopPropagation()},g=f.add_advanced_settings;l.appendChild(u);f.add_advanced_settings=function(){var a;c.button.addEventListener("change",k);d.button.addEventListener("change",e);b.button.addEventListener("click",q);g.call(f,c.container,d.container);a=$(l).children(".toontalk-advanced-settings-table");0<a.length&&a.get(0).appendChild(b.container)};return f}}}(window.TOONTALK);window.TOONTALK.tool=function(a){document.addEventListener("mousemove",function(h){a.tool.pageX=h.pageX;a.tool.pageY=h.pageY});return{add_listeners:function(h,c){var d,b,f,l,k,e=function(e){var k=h.getBoundingClientRect();c.set_held&&c.set_held(!0);l=k.height;e&&e.preventDefault();setTimeout(function(){c.held&&!c.held()||$(h).addClass("toontalk-tool-held")},200);d=$(h).offset();document.addEventListener("mousemove",q);document.addEventListener("touchmove",q);document.addEventListener("mouseup",g);
document.addEventListener("touchend",g);a.logging&&0===a.logging.indexOf("touch")&&(a.debugging+="\nmouse_down at "+Date.now());f=b=0;$(".ui-tooltip").each(function(){$(this).hide()})},u=function(d){var g=h.getBoundingClientRect();c.held&&c.held()||e(d);b=a.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",d)-g.left;f=a.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",d)-g.top},q=function(c){var d=a.UTILITIES.find_widget_on_page_side(c,h,b,f-l/2),e,g,q;c.preventDefault();d&&
d.is_of_type("empty hole")&&(d=d.get_parent_of_frontside());$(".ui-tooltip").each(function(){$(this).hide()});g=n(c);q=a.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",c)-g.deltaX-b;c=a.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",c)-g.deltaY-f;h.style.left=q+"px";h.style.top=c+"px";a.logging&&0===a.logging.indexOf("touch")&&(a.debugging+="\nmouse_move at "+Date.now()+" now at "+h.style.left+", "+h.style.top);if(d&&d.get_widget().is_top_level())k&&(a.UTILITIES.remove_highlight(),
k=void 0);else{if(d&&(e=d.get_element(),e===k))return;k=e;a.UTILITIES.highlight_element(k)}},g=function(e){var n=a.UTILITIES.find_widget_on_page_side(e,h,b,f-l/2),r;e.preventDefault();n&&n.is_of_type("empty hole")&&(n=n.get_parent_of_frontside());c.set_held&&c.set_held(!1);k&&a.UTILITIES.remove_highlight();n&&n.top_level_widget&&(r=n.top_level_widget(),c.apply_tool(n,e),r.backup_all());!n&&c.nothing_under_tool&&c.nothing_under_tool();$(h).removeClass("toontalk-tool-held");$(h).addClass("toontalk-tool-returning");
a.UTILITIES.add_one_shot_event_handler(h,"transitionend",1E3,function(){$(h).removeClass("toontalk-tool-returning")});a.UTILITIES.set_timeout(function(){h.style.left=d.left+"px";h.style.top=d.top+"px"});document.removeEventListener("mousemove",q);document.removeEventListener("touchmove",q);document.removeEventListener("mouseup",g);document.removeEventListener("touchend",g);a.logging&&0===a.logging.indexOf("touch")&&(a.debugging+="\nmouse_up at "+Date.now(),alert(a.debugging),a.debugging="touch")},
n=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,deltaY:c}};h.addEventListener("mousedown",u);h.addEventListener("touchstart",u);return e}}}(window.TOONTALK);window.TOONTALK.vacuum=function(a){var h=Object.create(null),c={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},d={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},b={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},f=!1,l;h.create=function(){var k,e,u,q=[],g=function(b){u!==b&&(u=b,a.sounds&&a.sounds.click.play(),$(k).removeClass(e),
e=d[u],$(k).addClass(e),n())},n=function(){"restore"===u&&0===q.length?a.UTILITIES.give_tooltip(k,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):a.UTILITIES.give_tooltip(k,c[u])};document.addEventListener("keyup",function(b){var c=String.fromCharCode(b.keyCode);if(b.altKey){if(0>"SsEeRrAa".split("").indexOf(c))return;k||(h.the_vacuum.get_element(),$(k).css({left:a.tool.pageX,top:a.tool.pageY}),document.body.appendChild(k));l()}h.the_vacuum.held()&&
("s"===c||"S"===c?g("suck"):"e"===c||"E"===c?g("erase"):"r"===c||"R"===c?g("restore"):"a"===c||"A"===c?g("suck_all"):a.sounds&&a.sounds.event_ignored.play(),b.preventDefault(),b.stopPropagation())});document.addEventListener("keydown",function(a){h.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});a.vacuum.the_vacuum={apply_tool:function(b,c){var d=b.get_widget(),e=function(b){c&&d.robot_in_training()&&d.robot_in_training().removed(b);b.is_primary_backside&&b.is_primary_backside()?b.hide_backside():
b===d.robot_in_training()?(b.training_finished(),b.set_run_once(!0)):(d.is_bird()&&a.sounds&&a.sounds.bird_fly.pause(),b.is_backside()||(b.save_dimensions_of(b),b.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),q.push(b),b.set_running&&b.set_running(!1),b.is_backside()||b.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),b.remove(c,!0))},f,g,h;"suck"===u?b.remove&&!b.get_widget().is_top_level()&&
(e(b),a.sounds&&a.sounds.vacuum_suck.play()):"erase"===u||"restore"===u&&b.get_erased&&b.get_erased()?b.is_top_level()||(f=!b.get_erased(),a.sounds&&(f?a.sounds.vacuum_suck.play():a.sounds.vacuum_spit.play()),b.set_erased(f,!0),c&&d.robot_in_training()&&d.robot_in_training().erased_widget(b,f)):"restore"===u?0<q.length&&(f=q.pop(),f.restore_dimensions(),h=b.add_to_top_level_backside(f),c&&d.robot_in_training()&&d.robot_in_training().restored(f),h.toontalk_widget_side=f,g=$(k).offset(),g.left-=$(h).width(),
a.UTILITIES.set_absolute_position(h,g),f.this_and_walk_children&&(f.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),a.sounds&&a.sounds.vacuum_spit.play())):"suck_all"===u&&(f=b.top_level_widget(),g=f.get_backside_widgets().slice(),0<g.length&&a.sounds&&(a.sounds.vacuum_suck.play(),a.sounds.bird_fly.pause()),g.forEach(function(a){a&&d!==d.robot_in_training()&&e(a)}),f.set_backside_widgets([]))},nothing_under_tool:function(){g(b[u])},get_element:function(){k||(k=document.createElement("div"),
$(k).addClass("toontalk-vacuum"),l=a.tool.add_listeners(k,this),g("suck"),n());return k},held:function(){return f},set_held:function(a){f=a}};return a.vacuum.the_vacuum};a.creators_from_json.vacuum=function(b,c){var d=a.vacuum.create();b.mode&&a.UTILITIES.set_timeout(function(){d.set_mode(b.mode)});return d};return h}(window.TOONTALK);window.TOONTALK.wand=function(a){var h=Object.create(null);h.create=function(){var c;return{apply_tool:function(c){var b;c.is_top_level()||(a.sounds&&a.sounds.magic.play(),b=c.add_copy_to_container(),b.update_display(),c.robot_in_training()&&c.robot_in_training().copied(c,b,!1))},get_element:function(){c||(c=document.createElement("div"),$(c).addClass("toontalk-wand"),a.UTILITIES.give_tooltip(c,"I'm a magic wand. Drag me over the thing you want me to copy."),a.tool.add_listeners(c,this));return c}}};
a.creators_from_json.wand=function(){return a.wand.create()};return h}(window.TOONTALK);window.TOONTALK.SETTINGS=function(a){var h=[],c=function(c,l,k){var e=[],u=a.UTILITIES.create_local_files_table(),q=function(b,e){var h=function(b){b||e.newPanel.appendChild(a.UTILITIES.create_text_element("Error connecting to cloud"))},l=e.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();e.newPanel.is(".toontalk-programs-in-cloud-table")?l?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):d(e.newPanel,"program",c,k,h):e.newPanel.is(".toontalk-pages-in-cloud-table")?
l?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):d(e.newPanel,"page",c,k,h):($("#tab-0_info").show(),$("#tab-0_wrapper").show())};e[0]="Programs stored in browser";h[0]=u;l?(e[1]="Programs in cloud",h[1]=a.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),e[2]="Published pages",h[2]=a.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table"),l=a.UTILITIES.create_tabs(e,h),k.appendChild(l),$(l).on("tabsactivate",q)):k.appendChild(a.UTILITIES.create_tabs(e,h));b(c,u,
!0,k);$(u).on("draw.dt",function(){b(c,u,!1,k)})},d=function(c,d,h,e,u){a.google_drive.get_toontalk_files(!1,d,function(q){var g;"string"===typeof q?g=q:q.error&&(g=q.error.message);g?"Need to authorize"===g||"Login Required"===g?a.google_drive.authorize(u):(console.log(g),console.log("Google drive status: "+a.google_drive.get_status()),u(null)):(g="program"===d&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",a.UTILITIES.become_file_data_table(c,q.items,!0,g),c.on("draw.dt",
function(){b(h,c.get(0),!0,e)}),u(c.get(0)))})},b=function(a,b,c,d){var h=function(b){var g=function(){$(d).remove()},h=function(){a.set_setting("program_name",b.target.textContent);a.load(c,g)}.bind(this);a.save(!0,void 0,h)};b=$(b).find(".toontalk-file-load-button-without-click-handler");b.each(function(a,b){b.addEventListener("click",h)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(b){var d=document.createElement("div"),h=b.get_backside_element(),e=b.get_setting("program_name"),
u=a.UTILITIES.create_text_input(e,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),q=a.UTILITIES.create_close_button(function(){$(d).remove()},"Click to close the settings panel."),g=a.UTILITIES.create_text_element("How should your program be saved?"),n=a.UTILITIES.create_check_box(b.get_setting("auto_save_to_google_drive"),"toontalk-save-setting","Save automatically to my Google Drive",'Check this if you want your programs automatically saved to a "ToonTalk Programs" folder in your Google Drive.'),
t=a.UTILITIES.create_check_box(b.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage","Check this if you want your programs automatically saved in this browser's local storage."),v=a.UTILITIES.create_button("Save to Google Drive now","toontalk-save-button","Click to save your program now to your Google Drive account.",function(){b.save(!0,{google_drive:!0})}),r=a.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button",
"Click to save your program now to this browser's local storage.",function(){b.save(!0,{local_storage:!0})}),m=a.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){a.google_drive.authorize(function(){$(m).remove()})}),z=a.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){a.UTILITIES.display_message("Creating your web page...");
b.publish(M,G.button.checked)}),G=a.UTILITIES.create_check_box(b.get_setting("publish_as_workspace"),"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),M=function(c,d){var e=document.createElement("span"),g=a.google_drive.google_drive_url(c.id);a.TRANSLATION_ENABLED&&(g=a.UTILITIES.add_URL_parameter(g,"translate","1"));e.innerHTML="Published: <a href='"+g+"' target='_blank'>"+b.get_setting("program_name")+
"</a>";g=$(u.container).children("tr");a.UTILITIES.display_message("Your web page is ready for you to edit. Just click on the link.");0<g.length&&g.get(0).appendChild(a.UTILITIES.create_table_entry(e))},C=document.createElement("div"),E=a.google_drive&&"undefined"!==typeof gapi?a.google_drive.get_status():"Google Drive API not loaded",B=!0,I=a.UTILITIES.create_vertical_table(z,G.container),D=$(u.container).children("tr");$(d).addClass("toontalk-settings-panel").css({width:$(h).width()+29,height:$(h).height()+
50,left:-2,top:-25,"z-index":9999999});d.appendChild(q);u.button.addEventListener("change",function(){var c=u.button.value.trim();e!==c&&b.save(!0,void 0,function(){e=c;b.set_setting("program_name",c);b.load(!0,function(){setTimeout(function(){$(d).css({"z-index":a.UTILITIES.next_z_index()})},500)},function(){b.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();a.UTILITIES.display_message("Your program was copied and the new copy's name is '"+b.get_setting("program_name")+"'.")})})})});
n.button.addEventListener("click",function(a){b.save(!0,{auto_save_to_google_drive:t.button.checked,gooogle_drive:!0});b.set_setting("auto_save_to_google_drive",n.button.checked);n.button.checked?$(v).hide():$(v).show()});t.button.addEventListener("click",function(a){b.save(!0,{auto_save_to_local_storage:t.button.checked,local_storage:!0});b.set_setting("auto_save_to_local_storage",t.button.checked);t.button.checked?$(r).hide():$(r).show()});G.button.addEventListener("click",function(a){b.set_setting("publish_as_workspace",
G.button.checked)});d.appendChild(C);$(g).css({"font-weight":"bold","font-size":24,color:"navy"});C.appendChild(g);C.appendChild(u.container);C.appendChild(n.container);C.appendChild(t.container);n.container.appendChild(a.UTILITIES.create_space());n.container.appendChild(v);b.get_setting("auto_save_to_google_drive")&&$(v).hide();t.container.appendChild(a.UTILITIES.create_space());t.container.appendChild(r);b.get_setting("auto_save_to_local_storage")&&$(r).hide();"Need to authorize"===E?(n.container.appendChild(a.UTILITIES.create_space()),
n.container.appendChild(m)):"Authorized"!==E&&"Ready"!==E&&"Authorized but not yet ready"!==E&&(B=!1,b.set_setting("google_drive_unavailable",!0),setTimeout(function(){n.button.disabled=!0;$(z).button("option","disabled",!0);$(v).button("option","disabled",!0);a.UTILITIES.give_tooltip(n.container,"Inactivated because attempt to connect to Google Drive returned: "+E);z.title=n.container.title;v.title=n.container.title},1));0<D.length&&D.get(0).appendChild(a.UTILITIES.create_table_entry(I));c(b,B,d);
h.appendChild(d)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",auto_save_to_google_drive:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(a){var h=[],c=0,d=!1,b=!1;return{pending_update:function(a){0<=h.indexOf(a)||(h.push(a),this.update_display())},update_display:function(){var a;b||document.hidden||0===h.length||(a=Date.now(),a<c?(b=!0,setTimeout(this.update_display_workhorse.bind(this),c-a)):d||(b=!0,setTimeout(function(){this.update_display_workhorse(a)}.bind(this))))},update_display_workhorse:function(f){var l=h,k=function(a,b){$(a).children().each(function(a,c){$(c).css({"z-index":b+1});
k(c,b+1)})};h=[];d=!0;b=!1;c=(f|Date.now())+50;l.forEach(function(b){var c=b.get_element&&b.get_element(),d,f,h;if(b.visible()||$(c).is(".toontalk-top-level-resource"))$(c).is(".toontalk-not-observable")?b.render():($(c).show(),b.update_display(),b.get_backside&&(f=b.get_backside())&&f.visible()&&f.update_display(),setTimeout(function(){a.UTILITIES.use_custom_tooltip(c)}),d=$(c).parent().closest(".toontalk-side"),d.is("*")&&0===d.find(".toontalk-side-animating, .toontalk-side-appearing").length&&
(f=a.UTILITIES.get_style_numeric_property(c,"z-index"),h=a.UTILITIES.get_style_numeric_property(d.get(0),"z-index"),h||(h=a.UTILITIES.next_z_index(),d.css({"z-index":h})),!f||d.is(".toontalk-top-level-backside")?(f=a.UTILITIES.next_z_index(),$(c).css({"z-index":f})):f>=h&&(f=h+1,$(c).css({"z-index":f})),k(c,f)),c&&!$(c).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&
a.UTILITIES.set_timeout(function(){d.is(".toontalk-box-hole")?$(c).is(".ui-resizable")&&$(c).resizable("destroy"):$(c).is(".ui-resizable")||a.UTILITIES.make_resizable($(c),b)}))});d=!1;0<h.length&&(b=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(a){a.creators_from_json.body=function(h,c){var d=a.actions.create();c.body=d;d.initialise_steps(a.UTILITIES.create_array_from_json(h.steps,c));return d};return{create:function(h){var c=Object.create(this),d=[];h||(h=[]);c.copy=function(){return a.actions.create(a.UTILITIES.copy_array(h))};c.get_steps=function(){return h};c.initialise_steps=function(a){h=a};c.is_empty=function(){return 0===h.length};c.reset_steps=function(){h=[];this.reset_newly_created_widgets()};
c.reset_newly_created_widgets=function(){a.logging&&0<=a.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+d.length);d=[]};c.add_step=function(b,c){b?(h.push(b),c&&this.add_newly_created_widget_if_new(c)):a.UTILITIES.report_internal_error("Attempt to add an undefined step.")};c.add_newly_created_widget_if_new=function(a){0<=d.indexOf(a)||this.add_newly_created_widget(a)};c.add_newly_created_widget=function(b){a.debugging&&0<=d.indexOf(b)?console.log("add_newly_created_widget called with not new widget."):
(d.push(b),a.logging&&0<=a.logging.indexOf("newly-created")&&console.log("Added "+b.to_debug_string()+" to list of newly_created_widgets. Length is "+d.length))};c.is_newly_created=function(a){return 0<=d.indexOf(a)};c.get_newly_created_widgets=function(){return d};c.get_path_to=function(b,c,h){var k,e;d.some(function(d,q){if(d===b||h&&d===b)return k=a.newly_created_widgets_path.create(q),!0;if(d.get_path_to&&(e=d.get_path_to(b,c)))return k=a.newly_created_widgets_path.create(q),k.next=e,!0});return k};
c.dereference_path=function(b){a.debugging&&!d[b]&&a.UTILITIES.report_internal_error("Expected to find the "+a.UTILITIES.ordinal(b)+" newly created widget.");return d[b]};return c},run_unwatched:function(h,c){var d=this.get_steps();a.logging&&0<=a.logging.indexOf("run")&&console.log(h.to_debug_string()+" running unwatched");c||(c=0);h.run_next_step=function(){if(c<d.length){var b=d[c];c++;a.logging&&0<=a.logging.indexOf("event")&&console.log(b+" (unwatched)");b.run_unwatched(h)}else h.set_running_or_in_run_queue(!1),
h.run_body_finished_listeners(),h.get_run_once()?h.get_first_in_team().set_running(!1):h.get_first_in_team().run()};h.run_next_step()},run_watched:function(h){var c=this.get_steps(),d=h.get_frontside_element(),b,f,l=d.parentElement,k=h.get_first_in_team(),e=function(){var b=k.visible()&&0!==k.get_maximum_step_duration(),c=function(){b&&(l&&l.appendChild(d),h.set_animating(!1));k===h?a.UTILITIES.set_absolute_position(d,q):(a.UTILITIES.set_css(d,{position:"static"}),f.get_backside(!0).get_next_robot_area().appendChild(d));
h.get_run_once()?k.set_running(!1):h.stopped()?$(d).removeClass(".toontalk-side-animating"):k.run();h.rerender()};b?(d.parentElement||h.get_parent_of_frontside().get_frontside_element().appendChild(d),a.UTILITIES.animate_to_absolute_position(d,q,c,h&&h.transform_animation_speed(a.UTILITIES.default_animation_speed))):(h.set_animating(!1),c(),h===k&&h.get_context().add_backside_widget(h),$(h.get_frontside_element()).remove())},u=0,q=$(d).offset(),g=$(d).offset(),n=$(d).width(),t=$(d).height(),v=h.get_first_in_team().top_level_widget(),
r=$(d).closest(".toontalk-top-level-backside").offset(),m=h.get_context().get_backside(),z,G;a.logging&&0<=a.logging.indexOf("run")&&console.log(h.to_debug_string()+" running watched");z=(f=h.get_previous_robot())?$(f.get_backside(!0).get_next_robot_area()):$(m.get_backside_element(!0));!a.UTILITIES.is_attached(d)&&f&&(f.open_backside(),f.get_backside().set_advanced_settings_showing(!0),(b=d.parentElement)||(b=z.get(0)),h.set_visible(!0),h.update_display(),h.add_body_finished_listener(function(){b&&
b.appendChild(d);$(d).css({left:"",top:"",position:"","z-index":""})}));0===n&&($(d).css({width:"",height:""}),n=h.saved_width||$(d).width(),t=h.saved_height||$(d).height());r||(r={left:0,top:0});0<z.length&&(G=z.get(0).getBoundingClientRect(),q.left<G.left-r.left||q.top<G.top-r.top||q.left+n>G.right+r.left||q.top+t>G.bottom+r.top)&&(q=z.offset(),q.left+=z.width()/2,q.top+=z.height()-t,g=q);h.start_offset=g;v.get_backside_element().appendChild(d);a.UTILITIES.set_absolute_position(d,q);h.run_next_step=
function(){m&&!document.hidden&&(m.visible()||a.UTILITIES.visible_element(m.get_element()))?setTimeout(function(){h.run_watched_step_end_listeners();if(u<c.length&&!h.stopped()){var b=c[u];u++;a.logging&&0<=a.logging.indexOf("event")&&console.log(b+" (watched)");b.run_watched(h);h.get_thing_in_hand()&&(h.get_thing_in_hand().save_dimensions(),h.rerender())}else h.set_running_or_in_run_queue(!1),e(),h.run_body_finished_listeners()},h.transform_step_duration(50)):(h.set_running_or_in_run_queue(!1),h.set_animating(!1),
$(d).css({width:"",height:""}),d.style.transitionDuration="",l&&l.appendChild(d),this.run_unwatched(h,u))}.bind(this);h.set_animating(!0,q);h.run_next_step();return!0},toString:function(a){for(var c="",d=this.get_steps().map(function(b){return b&&b.toString(a)});""===d[d.length-1];)d.pop();d.forEach(function(a,f){a&&(c+=a,c=f===d.length-2?c+" and \n":f<d.length-2?c+", \n":c+".")});return c},get_json:function(h,c,d){var b=[];a.UTILITIES.get_json_of_array(this.get_steps(),b,0,h,function(){c({type:"body",
steps:b},d)},d)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(a){a.creators_from_json.newly_created_widgets_path=function(h){return a.newly_created_widgets_path.create(h.index)};return{create:function(h){return{dereference_path:function(c){var d=c.get_body().dereference_path(h),b;if(this.next)return a.path.dereference_path(this.next,c,d);this.removing_widget&&((b=d.get_parent_of_frontside())&&b.is_hole()&&(b=b.get_parent_of_frontside()),b&&b.removed_from_container&&c.remove_from_container(d,b));return d},toString:function(){return"the "+
a.UTILITIES.ordinal(h)+" new widget"},get_json:function(a,d,b){d({type:"newly_created_widgets_path",index:h},b)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(a){var h={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b){b.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b){var c=a.copy();b.add_newly_created_widget(c);b.set_thing_in_hand(c);return!0},"drop it on":function(b,c,d){var e;if(b)if(e=c.get_thing_in_hand()){if(e.drop_on)return a.debugging&&e===b&&a.UTILITIES.report_internal_error("Dropping something on itself! "+b),$(e.get_frontside_element()).remove(),e.drop_on(b,
void 0,c),c.set_thing_in_hand(void 0),b.rerender(),c.add_newly_created_widget_if_new(e),e.robot_waiting_before_next_step===c?(d&&d.running_watched||(e.robot_waiting_before_next_step=void 0),!1):!0;a.debugging&&a.UTILITIES.report_internal_error("Thing in robot's hand ("+e+") doesn't handle 'drop_on'. Robot that "+c)}else!c.being_trained&&a.debugging&&a.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but has nothing in its hand.");else a.debugging&&a.UTILITIES.report_internal_error("The robot that '"+
c.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(b,c,d){var e;if(b){if(e=c.get_thing_in_hand())return c.set_thing_in_hand(void 0),b[d.setter](e),!0;a.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else a.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},
remove:function(a,b){a.remove();a===b?b.set_stopped(!0):b.add_newly_created_widget_if_new(a);return!0},restore:function(a,b){b.add_to_top_level_backside(a);return!0},"change whether erased":function(b,c,d){if(b.set_erased)return b.set_erased(!b.get_erased()),!0;a.UTILITIES.display_message("Robot is unable to erase "+b)},edit:function(b,c,d){if(b[d.setter_name])return d.argument_2?b[d.setter_name].call(b,d.argument_1,d.argument_2,b.visible()):b[d.setter_name].call(b,d.argument_1,b.visible()),!0;a.UTILITIES.report_internal_error(b+
" cannot be edited.")},"change size of":function(a,b,c){return!0},"add to the top-level backside":function(b,c,d){var e,f;c.visible()||(e=b.get_frontside_element(!0),d=$(c.get_context().get_frontside_element()).position(),f=$(c.get_context().get_frontside_element()).closest(".toontalk-top-level-backside").get(0)||$(e).closest(".toontalk-top-level-backside").get(0),$(e).css({left:d.left,top:d.top}),f.appendChild(e),f.toontalk_widget_side.get_widget().add_backside_widget(b),b.animate_to_element(f,void 0,
c.transform_animation_speed(a.UTILITIES.default_animation_speed)));return!0},"add a new widget to the work space":function(b,c,d){c.get_context().is_top_level()?(d=c.add_to_top_level_backside(b),c=$(c.get_frontside_element()).offset(),b.update_display(),a.UTILITIES.set_position_relative_to_top_level_backside($(d),c,!0)):b.drop_on(c.get_context().get_backside(!0),void 0,c,!0);return!0},"start training":function(a,b,c){a.training_started(b);return!0},"stop training":function(a,b,c){a.training_finished();
return!0},train:function(a,b,c){a.add_step(c.step)},"open the backside":function(){return!0},"close the backside":function(){return!0},"click the button of":function(){return!0}},c=function(b,c,d,e){var f=c.get_thing_in_hand(),h=c.get_frontside_element(),k=b.get_element(),l,q,u,E,B,I,D;k||(k=a.UTILITIES.find_resource_equal_to_widget(b,c));a.UTILITIES.is_attached(k)&&c.visible()?(l=k.getBoundingClientRect(),e&&e.left_offset_fraction?(c.original_animation_left_offset||(c.original_animation_left_offset=
[]),c.original_animation_top_offset||(c.original_animation_top_offset=[]),E=e.left_offset_fraction*l.width,B=e.top_offset_fraction*l.height,f&&(I=f.get_element(),a.UTILITIES.visible_element(I)&&(D=$(I).offset(),h=$(h).offset(),E-=D.left-h.left,B-=D.top-h.top)),f&&0<=c.original_animation_left_offset.indexOf(E)&&0<=c.original_animation_top_offset.indexOf(B)?(E=c.animation_left_offset+c.last_thing_in_hand_width,B=c.animation_top_offset,E>=l.width&&(E=0,B+=c.max_thing_in_hand_height,B>=l.height&&(B=0)),
c.last_thing_in_hand_width=a.UTILITIES.get_element_width(I),"undefined"===typeof c.max_thing_in_hand_height&&(c.max_thing_in_hand_height=0),c.max_thing_in_hand_height=Math.max(c.max_thing_in_hand_height,$(I).height())):(c.original_animation_left_offset.push(E),c.original_animation_top_offset.push(B),c.last_thing_in_hand_width=a.UTILITIES.get_element_width(I),c.max_thing_in_hand_height=a.UTILITIES.get_element_height(I)),k.animation_left_offset=E,k.animation_top_offset=B,c.animation_left_offset=E,c.animation_top_offset=
B):(q=l.width/2,u=l.height/2),c.animate_to_widget(b,d,c.transform_animation_speed(.25),q,u,!0,c.transform_original_step_duration(e&&e.time),c)):d()},d=function(a,b,d,e){c(a,b,function(){a.open_backside(d);u(a,b)},e)},b=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},f=function(c,d,e,f,h,k){var l=b(c,f);d.get_frontside_element();var q=function(){e(l);$(l).addClass("ui-state-active");if(".toontalk-select-function"===f||".toontalk-box-size-input"===f)l.value=h.argument_1;setTimeout(function(){$(l).removeClass("ui-state-active");
d.run_next_step()},k)},M=function(){var b;a.UTILITIES.visible_element(l)||(b=c.get_backside(!0),b.set_advanced_settings_showing(!0,b.get_element()));d.animate_to_element(l,q,d.transform_animation_speed(a.UTILITIES.default_animation_speed/2),0,0,!0)};l&&a.UTILITIES.visible_element(l)||!c.open_backside||!d.animate_consequences_of_actions()?M():c.open_backside(M)&&u(c,d)},l=function(b,c,d,e,f){var h=a.UTILITIES.closest_element($("."+f),$(c.get_frontside_element()).offset()),l=function(){k(b,c,d,e)};
h&&c.animate_consequences_of_actions()&&0<$("."+f).length?c.animate_to_element(h,l,c.transform_animation_speed(a.UTILITIES.default_animation_speed),0,0,!0):l()},k=function(b,c,d,e){c.get_frontside_element();var f=function(){c.carrying_tool=void 0;c.update_display();d();c.run_next_step()},h;c.animate_consequences_of_actions()?(c.carrying_tool=e,c.update_display(),e=c.transform_animation_speed(a.UTILITIES.default_animation_speed/2),b?c.animate_to_element(b.get_element(),f,e,0,0,!0):(h=c.top_level_widget().get_element(),
b=$(h).offset(),b.left+=$(h).width()*(.1+.8*Math.random()),b.top+=$(h).height()*(.1+.8*Math.random()),c.animate_to_absolute_position(b,f,e,!0))):(d(),c.run_next_step())},e=function(a,b,c){var d=a.get_parent_of_frontside();l(a,b,function(){c();d&&"top-level"!==d.get_widget().get_type_name()&&d.update_display&&d.update_display();a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")},u=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},
q={copy:function(a,b,c){l(a,b,function(){c();a.add_copy_to_container(b.get_recently_created_widget())},"toontalk-wand-small","toontalk-wand")},"pick up":function(b,d,e,f){var h=function(){e();d.animate_consequences_of_actions()&&d.update_display();d.run_next_step()};a.debugging&&"empty hole"===b.get_type_name()?a.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):b.save_dimensions()&&d.animate_consequences_of_actions()?c(b,d,h,f):h()},"pick up a copy of":function(b,d,e,f){c(b,
d,function(){var c;e();d.animate_consequences_of_actions()&&(c=d.get_recently_created_widget())&&(c.set_visible(!0),a.UTILITIES.copy_frontside_dimensions(b,c),d.update_display());d.run_next_step()},f)},"drop it on":function(b,e,f,h){var k=e.get_thing_in_hand(),l,q;k?(a.debugging&&k===b&&a.UTILITIES.report_internal_error("Dropping something on itself!"),l=k.get_element(!0),k.set_visible(e.visible()),q=function(){var b;$(l).removeClass("toontalk-held-by-robot");k.drop_on&&(e.animate_consequences_of_actions()&&
!a.UTILITIES.visible_element(l)&&(b=$(e.get_frontside_element()).closest(".toontalk-top-level-backside"),0<b.length&&b.get(0).appendChild(l)),e.rerender());f();k.drop_on&&k.visible()&&(a.UTILITIES.set_absolute_position(l,$(l).offset()),k.restore_dimensions());k.robot_waiting_before_next_step!==e&&e.run_next_step()},b.is_backside()&&!a.UTILITIES.visible_element(b.get_element())?d(b.get_widget(),e,q,h):c(b,e,q,h)):(a.debugging&&(a.UTILITIES.report_internal_error("Expected the robot to be holding something."),
console.log("The robot is "+e)),c(b,e,f,h))},"drop it on the text area of":function(b,e,f,h){var k=e.get_thing_in_hand(),l,q,u,M;k?(l=k.get_element(!0),k.set_visible(e.visible()),q=function(){var a;$(l).removeClass("toontalk-held-by-robot");f();k.remove();a=b.get_parent_of_frontside().get_widget();a.is_hole()&&(a=a.get_parent_of_frontside());a.is_top_level()?b.render():a.render();e.set_thing_in_hand(void 0);e.run_next_step()},u=function(){return $(b.get_backside_element()).find(h.area_selector).get(0)},
e.rerender(),a.UTILITIES.visible_element(b.get_backside_element())?(M=u(),e.animate_to_element(M,q,e.transform_animation_speed(a.UTILITIES.default_animation_speed/2),0,0,!0)):d(b,e,function(){M=u();e.animate_to_element(M,q,e.transform_animation_speed(a.UTILITIES.default_animation_speed/2),0,0,!0)},h)):(a.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+e),c(b,e,f,h))},remove:e,"change whether erased":e,restore:function(b,c,d){l(void 0,c,function(){a.UTILITIES.set_css(b.get_element(!0),
$(c.get_frontside_element()).position());d()},"toontalk-vacuum-ready-small","toontalk-vacuum")},edit:function(a,b,c,d){f(a,b,function(){a.get_backside()&&a.get_backside().update_display();c()},d.button_selector,d,b.transform_step_duration(1E3))},"change size of":function(b,c,d,e){var f=b.get_frontside_element();f?c.animate_to_element(f,function(){var a=f.getBoundingClientRect(),h=a.width*e.x_factor,a=a.height*e.y_factor,k=c.transform_step_duration(1E3);$(f).addClass("toontalk-animating-element");
f.style.transitionDuration=k+"ms";f.style.width=h+"px";f.style.height=a+"px";setTimeout(function(){$(f).removeClass("toontalk-animating-element");f.style.transitionDuration="";d();b.render();c.run_next_step()},k)},c.transform_animation_speed(a.UTILITIES.default_animation_speed),0,0,!0):(d(),c.run_next_step())},"add to the top-level backside":function(a,b,c){c();b.run_next_step()},"add a new widget to the work space":function(b,c,d,e){e&&e.button_selector?(b=a.path.dereference_path(e.path_to_source,
c),f(b,c,d,e.button_selector,e,c.transform_step_duration(3E3))):(d(),c.run_next_step())},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by={element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step()},"stop training":function(b,c,d,
e){var h=b.get_frontside_element();f(b,c,function(){var e=function(){h.toontalk_return_to=void 0;b.get_backside().change_label_and_title_of_train_button(!1);$(h).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");h.toontalk_followed_by=void 0;setTimeout(d,c.transform_step_duration(1500))};h.toontalk_return_to?a.UTILITIES.animate_to_absolute_position(h,h.toontalk_return_to,e,c.transform_animation_speed(a.UTILITIES.default_animation_speed)):e()},".toontalk-train-backside-button",
e,c.transform_step_duration(1E3))},train:function(a,b,c,d){var e=function(){c();b.run_next_step()};(d=d.step.run_watched)?(a.run_next_step=e,a.set_context(a.get_parent_of_frontside().get_widget()),d(a)):e()},"open the backside":function(a,b,c){a.open_backside(function(){c();b.run_next_step()});u(a,b)},"close the backside":function(a,b,c,d){d=b.transform_original_step_duration(d&&d.time);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();c();b.run_next_step()},
d)},"click the button of":function(a,b,c,d){f(a,b,function(d){$(d).is(".toontalk-settings-backside-button")&&">"===d.innerText&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().set_advanced_settings_showing(!1,a.get_backside_element())});$(d).click();c()},d.button_selector)}};a.creators_from_json.robot_action=function(b,c){return b.additional_info?a.robot_action.create(a.UTILITIES.create_from_json(b.path,c),b.action_name,a.UTILITIES.create_keys_from_json(b.additional_info,
c)):a.robot_action.create(a.UTILITIES.create_from_json(b.path,c),b.action_name)};return{create:function(b,c,d){var e=Object.create(this),f=h[c],k=q[c];if(k)return b||a.UTILITIES.report_internal_error("path undefined in "+c+" action"),f||a.UTILITIES.report_internal_error("no run_function for "+c),e.get_action_name=function(){return c},e.get_additional_info=function(){return d},e.run_unwatched=function(c){var e=a.path.dereference_path(b,c);if(!e)return a.UTILITIES.report_internal_error("Unable to dereference path: "+
a.path.toString(b)+" in context: "+c.get_context()),!1;a.logging&&0<=a.logging.indexOf("event")&&(e.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+e.wait_until_this_nest_receives_something.to_debug_string()+"("+a.path.toString(b)+") by unwatched "+c.to_debug_string()):console.log("   "+e.to_debug_string()+" ("+a.path.toString(b)+" "+e.to_debug_string()+" by unwatched "+c.to_debug_string()));e.wait_until_this_nest_receives_something?e.wait_until_this_nest_receives_something.run_when_non_empty(function(){this.run_unwatched(c)}.bind(this),
c):f(e,c,d)&&c.run_next_step()},e.run_watched=function(c){var e=a.path.dereference_path(b,c),h=function(){if(!c.stopped()||c.being_trained)d||(d={}),d.running_watched=!0,f(e,c,d)};e?(a.logging&&0<=a.logging.indexOf("event")&&console.log("   "+e+" ("+a.path.toString(b)+" "+(e.to_debug_string?e.to_debug_string():e)+" by watched "+c.to_debug_string()+(c.animate_consequences_of_actions()?"":" finishing instantly")),e.wait_until_this_nest_receives_something?(e.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.set_waiting(!1);
this.run_watched(c)}.bind(this),c),c.set_waiting(!0),TOONTALK.UTILITIES.visible_element(c.get_context().get_backside_element())||c.get_frontside().remove()):k(e,c,h,d)):a.UTILITIES.report_internal_error("Unable to dereference the path: "+a.path.toString(b)+" in context: "+c.get_context())},e.toString=function(e){var f="",h="",k=c,l;if("open the backside"===c||"close the backside"===c)return"";if("click the button of"===c)switch(d.button_selector){case ".toontalk-green-flag":k="click the green flag "+
a.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" of";break;case ".toontalk-stop-sign":k="click the stop sign "+a.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":k="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":k="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":k="click the button to add or remove attributes of ";
break;case ".toontalk-remove-backside-and-widget-buttton":k="click the button to remove the back and front of ";break;default:k="click a button of"}if("add a new widget to the work space"===c)return c.replace("a new widget",a.path.toString(b));if("add to the top-level backside"===c)return"";e||(e={});l=a.path.toString(b,e);if("edit"===c||"drop it on the text area of"===c)f=" ("+d.toString+")";else if("train"===c){f=d.step.toString({person:"third"});if(""===f)return f;f=" to "+f;h="- ";e&&e.robot_being_trained_description&&
(l=e.robot_being_trained_description)}else"start training"===c?e&&(e.robot_being_trained_description="it"):"stop training"===c&&(l=e.robot_being_trained_description,e.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(c)){if(0<=l.indexOf("hole of"))return h+k+" what is in "+l+f;if(0===l.indexOf("a When"))return l=l.substring(3),l=a.UTILITIES.remove_encoded_HTML(l),l=a.UTILITIES.elide(l,80,
1),"."===l[l.length-1]&&(l=l.substring(0,l.length-1)),h+k+" a robot who w"+l+f+"\n"}return h+k+" "+l+f},e.get_json=function(e,f,h){var k=function(d,h){a.path.get_json(b,e,function(a,b){f({type:"robot_action",action_name:c,path:a,additional_info:d},b)},h)};d?a.UTILITIES.get_json_of_keys(d,["running_watched"],k,h):k(void 0,h)},e;a.UTILITIES.report_internal_error("No watched function for "+c)}}}(window.TOONTALK);window.TOONTALK.queue=function(a){var h={create:function(){var c=Object.create(this);c.to_run=a.UTILITIES.create_queue();c.run_function=c.run.bind(c);return c},enqueue:function(a){a.running_or_in_run_queue()||(a.set_running_or_in_run_queue(!0),this.to_run.enqueue(a)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var c,d;this.running=!0;for(c=Date.now()+h.maximum_run;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<c;)d=this.to_run.dequeue(),d.run_actions();this.to_run.isEmpty()?this.running=!1:a.UTILITIES.set_timeout(this.run_function)}};return h}(window.TOONTALK);window.TOONTALK.path=function(a){var h;a.creators_from_json["path.to_entire_context"]=function(c,d){return a.path.to_entire_context()};a.creators_from_json["path.to_widget_on_nest"]=function(){return a.path.to_widget_on_nest()};a.creators_from_json["path.top_level_backside"]=function(){return a.path.top_level_backside};a.creators_from_json["path.to_backside_widget_of_context"]=function(c,d){return"undefined"===typeof c.backside_index?a.path.get_path_to_backside_widget_of_context(c.type_name,d&&d.robot):
a.path.get_path_to_backside_index_of_context(c.backside_index,c.type_name,d&&d.robot)};a.creators_from_json["path.to_resource"]=function(c,d){return a.path.get_path_to_resource(a.UTILITIES.create_from_json(c.resource,d))};return{get_path_to:function(c,d,b){var f=function(c,d){var e=d.get_training_context(),f=d.get_body(),h,g,n;c.is_primary_backside&&c.is_primary_backside()&&(n=!0,c=c.get_widget());if(e===c)return h=a.path.to_entire_context(),h.is_backside=n,h;g=c.get_type_name();if("top-level"===
g)return a.path.top_level_backside;if(h=f.get_path_to(c,d,b))return h.is_backside=n,h;if("element attribute"===g&&c.is_attribute_widget_copy(c))return h=a.element.create_attribute_path(c,d),h.is_backside=n,h;if(a.debugging&&!e)a.UTILITIES.report_internal_error("No context to compute the path");else{if(e.get_path_to&&(f=e.get_path_to(c,d)))return f.is_backside=n,h=a.path.to_entire_context(),h.next=f,h;e.get_backside_widgets().some(function(b){b=b.get_widget();var e;if(b===c||b.top_contents_is&&b.top_contents_is(c))return d.add_to_backside_conditions(b),
h=a.path.get_path_to_backside_widget_of_context(b,d),h.is_backside=n,!0;if(b.get_path_to&&(e=b.get_path_to(c,d)))return e.is_backside=n,d.add_to_backside_conditions(b),h=a.path.get_path_to_backside_widget_of_context(b,d),h.next=e,!0});if(h)return h.is_backside=n,h;if(e=c.ancestor_of_type("robot"))return a.robot.find_conditions_path(c,e,d);h=a.path.get_path_to_resource(c.copy());h.is_backside=n;return h}}(c,d,b);f&&c.dereference_contents&&(a.path.path_end(f).not_to_be_dereferenced=!0);!f||"pick up"!==
d.current_action_name&&"remove"!==d.current_action_name||(a.path.path_end(f).removing_widget=!0);return f},path_end:function(a){for(;a.next;)a=a.next;return a},dereference_path:function(a,d,b){var f;a?a.dereference_path?f=a.dereference_path(d,b):b&&b.dereference_path&&(f=b.dereference_path(a,d)):f=b||d.get_context();return f&&a&&a.is_backside?f.get_backside(!0):f},continue_dereferencing_path:function(a,d,b){void 0===d&&b.context_is_backside()&&(d=b.get_top_level_context());void 0===d&&(d=b.get_context());
return a.next?d.dereference_contents&&!a.next.not_to_be_dereferenced?(d=d.dereference_contents(a.next,b))&&a.is_backside?d.get_backside(!0):d:(d=d.dereference_path(a.next,b))&&a.next.is_backside?d.get_backside(!0):d:d.dereference_contents&&!a.not_to_be_dereferenced?(d=d.dereference_contents(a,b))&&a.is_backside?d.get_backside(!0):d:d},toString:function(c,d){var b="",f;if(!c)return"undefined path";c.is_backside&&(b="the backside of ");d||(d={});f=d.resource;d.resource=!0;c.next?(a.path.toString(c.next,
d),b=b+a.path.toString(c.next,d).trim()+" of "+c.toString(d)):b+=c.toString(d);d.resource=f;return b},get_json:function(c,d,b,f){var h,k;c.get_json?(h=function(e,f){c.is_widget&&(e=c.add_to_json(e,d));c.next&&(k=function(a){e.next_path=a},a.path.get_json(c.next,d,k,f));c.removing_widget&&(e.removing_widget=!0);c.not_to_be_dereferenced&&(e.not_to_be_dereferenced=!0);if(!0===c.is_backside||c.is_backside&&c.is_backside())e.is_backside=!0;b(e,f)},c.get_json(d,h,f)):b(c,f)},to_entire_context:function(c){return{dereference_path:function(c,
b){return a.path.continue_dereferencing_path(this,b,c)},toString:function(a){return a&&a.robot?a.robot.get_top_level_context_description(a):a&&"third"===a.person?"what he's working on":"what I'm working on"},get_json:function(a,b,c){b({type:"path.to_entire_context"},c)}}},to_widget_on_nest:function(){return{dereference_path:function(c,d){return a.path.continue_dereferencing_path(this,d,c)},toString:function(){return"what is on the nest"},get_json:function(a,d,b){d({type:"path.to_widget_on_nest"},
b)}}},get_path_to_resource:function(c){c||console.error("Widget missing in get_path_to_resource.");c=c.get_widget();return{dereference_path:function(d){var b=c.copy({copying_resource:!0}),f,h,k;d.add_newly_created_widget(b);d.visible()&&(f=a.UTILITIES.find_resource_equal_to_widget(c,d))&&(b.save_dimensions_of(a.UTILITIES.widget_side_of_element(f)),k=b.get_frontside_element(),h=$(f).position(),a.UTILITIES.set_timeout(function(){$(k).css({left:h.left,top:h.top,width:$(f).width(),height:$(f).height()})}));
return b},toString:function(d){return a.UTILITIES.add_a_or_an(c.toString(d))},get_json:function(d,b,f){c.get_json(a.UTILITIES.fresh_json_history(d),function(a,c){b({type:"path.to_resource",resource:a},c)},f)}}},get_path_to_backside_widget_of_context:function(c,d){return"string"===typeof c?{dereference_path:function(b){var d=b.get_context(),h=b.get_backside_widget_of_type(c,d);h||d.get_backside_widgets().some(function(a){if(a.get_widget().is_of_type(c)&&!b.is_newly_created(a.get_widget()))return h=
a.get_widget(),!0});if(h)return a.path.continue_dereferencing_path(this,h,b)},toString:function(b){b=(b&&b.robot&&b.robot.get_backside_conditions()?b.robot.get_backside_conditions()[c]:a.UTILITIES.add_a_or_an(c))+" on the back of what I'm working on";return this.removing_widget?"what is on "+b:b},get_json:function(a,d,h){d({type:"path.to_backside_widget_of_context",type_name:c},h)}}:this.get_path_to_backside_index_of_context(d.get_backside_condition_index(c),c.get_type_name(),d)},get_path_to_backside_index_of_context:function(c,
d,b){return{dereference_path:function(b){var d=b.get_backside_matched_widgets()[c];if(d)return a.path.continue_dereferencing_path(this,d,b);a.debugging&&console.log("can this happen?")},toString:function(c){c=(c=b.get_frontside_conditions())&&c.is_top_level()?"work area":"back of what";c=a.UTILITIES.add_a_or_an(d||"thing")+" on the "+c+" I'm working on";return this.removing_widget?"what is on "+c:c},get_json:function(a,b,h){b({type:"path.to_backside_widget_of_context",type_name:d,backside_index:c},
h)}}},process_path_json:function(c,d,b){d.next_path&&(c.next=a.UTILITIES.create_from_json(d.next_path,b));d.removing_widget&&(c.removing_widget=!0);d.not_to_be_dereferenced&&(c.not_to_be_dereferenced=!0);d.is_backside&&(c.is_backside=!0)},top_level_backside:{dereference_path:function(c){if(c=c.get_context().ancestor_of_type("top-level"))return c;h||(h=a.widget.create_top_level_widget());return h},toString:function(){return"the top-level backside"},get_json:function(a,d,b){d({type:"path.top_level_backside"},
b)}}}}(window.TOONTALK);window.TOONTALK.publish=function(a){var h=function(a,d,b){var f='<!DOCTYPE html>\n<html>\n<head>\n<script src="https://toontalk.github.io/ToonTalk/toontalk.js?published=1">\x3c/script>\n<title>\n'+a+"</title>\n</head>\n<body>\n";d.forEach(function(a,c){f+='<div class="toontalk-edit" name="content">\n'+a+"\n</div>\n";b[c]&&(f+=b[c])});return f+="</body>\n</html>\n"};return{publish_widget:function(c,d,b,f){var l=a.google_drive.get_status(),k=["Edit this. Select text for formatting."],e=function(b){(b=
b&&b.items&&0<b.items.length&&b.items[0])?f(b,q):(b=h(c,k,q),a.google_drive.upload_file(u,"html",b,f))},u,q;"Ready"===l?(u=d.get_setting("program_name"),b?a.UTILITIES.get_json_top_level(d,function(b){d.set_setting("program_name",u+" (published version)");q=[a.UTILITIES.toontalk_json_div(b,d)];d.set_setting("program_name",u)}):(b=d.get_backside_widgets(),q=[],b.forEach(function(b,c){b.visible()&&a.UTILITIES.get_json_top_level(b,function(c){c.view&&(c.view.saved_width=void 0,c.view.saved_height=void 0);
q.push(a.UTILITIES.toontalk_json_div(c,b.get_widget()));k.push("")})})),a.google_drive.get_toontalk_files(a.google_drive.full_file_name(u,"page"),"page",e)):(console.log("Unable to publish to Google Drive because: "+l),f(null))},republish:function(c){a.google_drive.insert_or_update_file(void 0,c.file_id,"page",h(c.title,c.editable_contents,c.widgets_json),function(){console.log("Published page '"+c.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(a){var h=a.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",c=a.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",d="Need to authorize",b,f;return{handle_client_load:function(b){0>window.location.href.indexOf(c)?(d="Connections to Google Drive are configured for the following domain only: "+c+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",b&&
b(d)):setTimeout(function(){a.google_drive.check_authorization(b)})},check_authorization:function(b){d="Awaiting authorization";gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(c){a.google_drive.handle_authorization_result(c,b)})},handle_authorization_result:function(b,c){b&&!b.error?(d="Authorized but not yet ready",gapi.client.load("drive","v2",function(){a.google_drive.get_folder_ids(function(){d="Ready"})}),c&&c()):(d="Need to authorize",c&&
c(d))},authorize:function(b){gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(c){a.google_drive.handle_authorization_result(c,b)})},get_folder_ids:function(c){a.google_drive.get_folder_id(!0,function(d){b=d;a.google_drive.get_folder_id(!1,function(a){f=a;c()})})},get_folder_id:function(c,d){var e=c?"ToonTalk Programs":"ToonTalk Pages",h=function(b){var f=function(a){a&&a.id?d(a.id):console.error("Failure to create folder '"+e+"'. Response was "+
a)};(b=b&&b.items&&0<b.items.length&&b.items[0].id)?d(b):c?a.google_drive.create_folder("ToonTalk Programs",!1,f):a.google_drive.create_folder("ToonTalk Pages",!0,f)};c&&b?d(b):!c&&f?d(f):a.google_drive.fetch_folder_id(e,h)},get_status:function(){return d},connection_to_google_drive_possible:function(){return 0!==d.indexOf("Connections to Google Drive are configured for the following domain only: ")},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",params:a}).execute(b)},
fetch_folder_id:function(b,c){a.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+b+"' and trashed = false"},c)},get_toontalk_files:function(b,c,d){"undefined"===typeof gapi?d("Google Drive API not available."):(c="properties has {key='ToonTalkType' and value='"+c+"' and visibility='PUBLIC'} and trashed = false",b&&(c+=" and title='"+b+"'"),a.google_drive.list_files({q:c},d))},get_toontalk_program_file:function(c,d){a.google_drive.list_files({q:"'"+b+"' in parents and trashed = false and title='"+
c+"'"},function(a){a&&a.items&&0<a.items.length?d(a.items[0]):d(null)})},upload_file:function(b,c,d,f){var h="json"===c?"program":"page",g=b+"."+c;a.google_drive.get_toontalk_files(g,h,function(b){gapi.client.load("drive","v2",function(){var c=b&&b.items&&0<b.items.length&&b.items[0].id;f||(f=function(b){b.error&&(console.log("Google drive status: "+a.google_drive.get_status()),"Login Required"!==b.error.message&&console.log(b.error.message));console.log("File "+b.title+" ("+b.id+") "+(c?"updated":
"created"))});c?a.google_drive.insert_or_update_file(void 0,c,h,d,f):a.google_drive.insert_or_update_file(g,void 0,h,d,f)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(c,d,e,h,q){var g={title:c,mimeType:"text/html"};g.parents=[{kind:"drive#fileLink",id:"program"===e?b:f}];h="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(g)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
h+"\r\n---------314159265358979323846--";c?(c="/upload/drive/v2/files",g="POST"):(c="/upload/drive/v2/files/"+d,g="PUT");gapi.client.request({path:c,method:g,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:h}).execute(function(b){d||a.google_drive.insert_property(b.id,"ToonTalkType",e,"PUBLIC");q&&q(b)})},create_folder:function(a,b,c){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){c(a)})}:c)},download_file:function(a,b){if(a.downloadUrl){var c=gapi.auth.getToken().access_token,d=new XMLHttpRequest;d.open("GET",a.downloadUrl);d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=function(){b(null)};d.send()}else b(null)},google_drive_url:function(a){return"https://googledrive.com/host/"+a+"/"},insert_property:function(a,
b,c,d){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:c,visibility:d}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(a){var h={},c=!1,d,b=100,f=(new Date).getTime(),l=[],k=[],e=new MutationObserver(function(a){a.forEach(function(a){var b,c;for(b=0;b<a.addedNodes.length;b++)c=a.addedNodes.item(b),1===c.nodeType&&setTimeout(function(){!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0,c.toontalk_run_even_if_not_observable=
void 0);$(c).find(".toontalk-has-attached-callback").each(function(a,b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)})})})}),u=function(a,b,c){var d;if(a){d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},q=function(b,c){a.debugging+="\n"+b;console.log(b);c&&(alert(a.debugging),a.debugging="touch")},g=function(a){var b=a.indexOf("<div style='display:none;'>{"),
b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},n=function(b,c){if(!$(c).is(".toontalk-conditions-contents")){var e=$(c).closest(".toontalk-side"),f=h.get_mouse_or_first_touch_event_attribute("clientX",b),g=h.get_mouse_or_first_touch_event_attribute("clientY",b),k,l,m,n;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(b.dataTransfer&&b.dataTransfer.getData("text")&&0<b.dataTransfer.getData("text").length)){d=e||$(c);m=
h.widget_side_of_jquery(d);if(!m){m=h.widget_side_of_element(c);h.report_internal_error("Possible bug that "+d+" doesn't have a known owner.");if(!m){h.report_internal_error("The element doesn't have an owner either.");return}d=$(c)}m=m.get_selection();d=$(m.get_element());m.set_stopped&&m.set_stopped(!0);!m.save_dimensions||m.get_parent_of_frontside()&&!m.get_parent_of_frontside().get_widget().is_top_level()||m.save_dimensions();m.being_dragged=!0;k=d.get(0).getBoundingClientRect();n=d.is(".toontalk-top-level-resource");
$(c).removeClass("toontalk-wiggle");m.get_json&&(e=function(a){a.view.drag_x_offset=f-k.left;a.view.drag_y_offset=g-k.top;!a.view.frontside_width&&d.parent().is(".toontalk-backside")&&(a.view.frontside_width=d.width(),a.view.frontside_height=d.height());d.data("json",a);b.dataTransfer&&(l=h.toontalk_json_div(a,m),b.dataTransfer.effectAllowed=n?"copy":"move",b.dataTransfer.setData("text",l),h.is_internet_explorer()||b.dataTransfer.setData("text/html",l));m.drag_started&&m.drag_started(a,n)},b.dataTransfer&&
b.dataTransfer.setData("text","Sorry, it took too long to generate the data structure needed to reconstruct "+m+"."),a.UTILITIES.get_json_top_level(m,e,6E5));d.addClass("toontalk-being-dragged");b.stopPropagation()}}},t=function(a,b){var c;if(!$(b).is(".toontalk-conditions-contents")){d||(d=$(a.target).closest(".toontalk-side"));if(c=h.widget_side_of_jquery(d))c.being_dragged=void 0;d.is(".toontalk-frontside")&&(d.parent().is(".toontalk-backside")?(c=d.data("json"))&&h.set_css(d,{width:c.view.frontside_width,
height:c.view.frontside_height}):d.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||d.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||h.has_animating_image(d.get(0))||h.set_css(d,{width:"100%",height:"100%"}));D();a.stopPropagation()}},v=function(a){if(d)return h.widget_side_of_jquery(d);if(a)return a=h.data_transfer_json_object(a),h.create_from_json(a)},r=function(b,c){var e=h.data_transfer_json_object(b),
f=function(b,d){var e=h.create_from_json(b),f=document.createElement("div"),g=e.get_element(!0),p=$(c).closest(".toontalk-edit"),k=a.published_support.create_editable_text(),l=d.target;$(f).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");$(g).addClass("toontalk-top-level-resource").css({position:"relative"});g.toontalk_widget_side=e;f.toontalk_widget_side=e;f.appendChild(g);for($(f).insertAfter(p);l.nextSibling;)$(k).children(".froala-element").get(0).appendChild(l.nextSibling);
$(k).insertAfter(f);e.update_display()},g=function(){var b;k.hide();b=document.elementFromPoint(u-window.pageXOffset-a.USABILITY_DRAG_OFFSET.x,v-window.pageYOffset-a.USABILITY_DRAG_OFFSET.y);k.show();if(b)return $(b).closest(".toontalk-side")},k,l,m,n,q,r,t,u,v;void 0===e&&d&&(e=d.data("json"));d&&d.data("json","");k=d;D();if(k||void 0!==e||b.dataTransfer.files||N(b)){if($(b.target).is(".toontalk-drop-area-instructions"))f=$(b.target).parent();else if($(b.target).is(".toontalk-element-attribute-input")){if(f=
$(b.target).closest(".toontalk-side"),l=h.widget_side_of_jquery(f)){g=k?h.widget_side_of_jquery(k):h.create_from_json(e);h.restore_resource(k,g);l.dropped_on_style_attribute(g,b.target.name,b);b.stopPropagation();return}}else if($(b.target).is(".toontalk-drop-area"))f=$(b.target);else{if(e&&$(b.currentTarget).is(".froala-element")){f(e,b);return}f=$(b.target).closest(".toontalk-side")}if(0!==f.length){u=h.get_mouse_or_first_touch_event_attribute("pageX",b);v=h.get_mouse_or_first_touch_event_attribute("pageY",
b);if(f.is(".toontalk-top-level-resource"))if("touchend"===b.type){f=$(".toontalk-highlight");if(0===f.length||f.get(0)===k.get(0))f=g();if(!f||0===f.length)return}else return;q=f.offset();l=h.widget_side_of_jquery(f);if(k&&0<k.length&&!(l&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack())&&(k.get(0)===f.get(0)||jQuery.contains(k.get(0),f.get(0)))){if(k.is(".toontalk-top-level-backside"))return;f=$(".toontalk-highlight");if(0===f.length||f.get(0)===k.get(0))f=g();if(!f||0===
f.length)return;q=f.offset();l=h.widget_side_of_jquery(f)}h.remove_highlight();e&&e.view&&e.view.drag_x_offset?(m=e.view.drag_x_offset,n=e.view.drag_y_offset):n=m=0;if(k&&0<k.length){if(!(l&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack()||k.get(0)!==f.get(0)&&!jQuery.contains(k.get(0),f.get(0)))){h.set_css(k,{left:k.get(0).offsetLeft+(b.layerX-m),top:k.get(0).offsetTop+(b.layerY-n)});b.stopPropagation();return}g=h.widget_side_of_jquery(k);k.parent().is(".toontalk-drop-area")?
(k.removeClass("toontalk-widget-in-drop_area"),k.parent().data("drop_area_owner").set_next_robot(void 0)):((t=g&&g.get_parent())?(r=$(t.get_element()),!g.is_backside()&&g.get_widget().get_infinite_stack&&g.get_widget().get_infinite_stack()?(r=g.get_widget().saved_width,t=g.get_widget().saved_height,g=g.copy(),g.get_widget().saved_width=r,g.get_widget().saved_height=t,r=k.width(),t=k.height(),k=$(g.get_element(!0)),f.is(".toontalk-backside")&&h.set_css(k,{width:e.view.frontside_width||r,height:e.view.frontside_height||
t})):t.removed_from_container&&(r.is(".toontalk-backside")?t.remove_backside_widget(g,!0):(t.removed_from_container(g,b),g.restore_dimensions&&!t.is_empty_hole()&&g.restore_dimensions()))):h.restore_resource(k,g),g.robot_in_training()&&g.robot_in_training().add_newly_created_widget_if_new(g))}else{if(0<b.dataTransfer.files.length){for(e=0;e<b.dataTransfer.files.length;e++)M(b.dataTransfer.files[e],f,l,q,b);b.stopPropagation();return}if(N(b)){C(b.dataTransfer.getData("URL"),f,l,q,b);b.stopPropagation();
return}g=h.create_from_json(e,{event:b});if(!g){e?h.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):a.debugging&&console.log("No data transfer in drop.");b.stopPropagation();return}g.robot_in_training()&&g.robot_in_training().drop_from_data_transfer(g);k=$(g.get_element(!0));g.is_primary_backside&&g.is_primary_backside()&&(h.set_css(k,{width:e.view.backside_width,height:e.view.backside_height,"background-color":e.view.background_color,"border-width":e.view.border_width}),
g.apply_backside_geometry())}l&&g.get_widget()===l.get_widget()||G(f,k,g,l,q,b,e,m,n)}}else b.dataTransfer?h.report_internal_error("Drop failed since unable to parse as JSON."):h.report_internal_error("Drop failed since there is no event.dataTransfer"),b.stopPropagation()},m=function(a,b){a.addEventListener("drop",function(a){var c=v(a);h.restore_resource(h.get_$dragee(),c);b(a)})},z=function(a,b){var c;c=$(b).closest(".toontalk-side");var d=h.get_$dragee();c=!c.is("*")||c.is(".toontalk-top-level-backside")||
c.closest(".toontalk-top-level-resource").is("*")||c.is(".toontalk-being-dragged")||d&&Q(c.get(0),d.get(0))?void 0:c;if(c)return h.highlight_element(c.get(0),a),c.get(0)},G=function(b,c,d,e,f,g,k,l,m){var n=h.get_mouse_or_first_touch_event_attribute("pageX",g),q=h.get_mouse_or_first_touch_event_attribute("pageY",g),r,t,u,v;l||(l=0);m||(m=0);d.set_visible(!0);if(b.is(".toontalk-backside")){if(d.get_widget().is_top_level()){r=k.semantic.backside_widgets;t=k.shared_widgets;u=b.get(0);(c=e.robot_in_training())&&
c.drop_from_data_transfer(d,e);c=d.get_widget().get_backside_widgets().slice();c.forEach(function(a,b){var c=a.get_widget(),f,g,p,k,l,w,m;d.remove_backside_widget(a);f=0<=r[b].widget.shared_widget_index?t[r[b].widget.shared_widget_index].view:r[b].widget.view;g=a.get_element(!0);a.is_backside()?(p=f.backside_left,k=f.backside_top,l=f.backside_width,w=f.backside_height):(p=f.frontside_left,k=f.frontside_top,l=f.frontside_width,w=f.frontside_height);e.add_backside_widget(a);u.appendChild(g);m=$(g).position();
v={left:m.left+p,top:m.top+k,width:l,height:w};h.constrain_css_to_fit_inside(u,v);h.set_css(g,v);d.set_location_attributes&&c.set_location_attributes(v.left,v.top);a.is_backside()&&(c.backside_geometry=f.backside_geometry,c.apply_backside_geometry())}.bind(this));return}if(!e){h.report_internal_error("No target_widget");return}d?e.widget_side_dropped_on_me(d,g):h.report_internal_error("No source_widget");g=n-(f.left+(l||0));m=q-(f.top+(m||0));h.set_css(c,{left:h.left_as_percent(g,c.get(0)),top:h.top_as_percent(m,
c.get(0))});!d.is_backside()&&d.set_location_attributes&&d.set_location_attributes(g,m);k&&k.semantic&&k.semantic.running&&!h.get_$dragee()&&d.set_running(!0)}else if(b.is(".toontalk-drop-area"))c.addClass("toontalk-widget-in-drop_area"),0<b.length&&b.get(0).appendChild(c.get(0)),c.is(".toontalk-robot")&&b.data("drop_area_owner").set_next_robot(h.widget_side_of_jquery(c));else{if(c.is(".toontalk-backside-of-top-level"))return;if(e||g.changedTouches){u=b.closest(".toontalk-top-level-backside").get(0);
!u&&g.changedTouches&&(k=document.elementFromPoint(n-window.pageXOffset,q-window.pageYOffset),(u=$(k).is(".toontalk-top-level-backside")?k:$(k).closest(".toontalk-top-level-backside").get(0))||(u=$(".toontalk-top-level-backside").get(0)),e=h.widget_side_of_element(u).get_backside());if(!u)return;u.appendChild(c.get(0));k=$(u).offset();h.set_css(c,{left:n-(k.left+l+a.USABILITY_DRAG_OFFSET.x),top:q-(k.top+m+a.USABILITY_DRAG_OFFSET.y)});d.drop_on&&d.drop_on(e,g)||e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(d,
g)||(c=b.closest(".toontalk-top-level-backside"),0<c.length&&(e=h.widget_side_of_jquery(c))&&e.widget_side_dropped_on_me(d,g))}else{h.report_internal_error("target widget missing");return}}h.remove_highlight()},M=function(b,c,d,e,f){var k=new FileReader,l=0===b.type.indexOf("image"),m=0===b.type.indexOf("audio"),n=0===b.type.indexOf("video"),q,r,t;k.onloadend=function(){if(l)q=a.element.create("<img src='"+k.result+"' alt='"+b.name+"'/>");else if(m)q=a.element.create(b.name+" sound"),q.set_sound_effect(new Audio(k.result));
else if(n)q=a.element.create("<video src='"+k.result+"' alt='"+b.name+"'/>");else{if(r=g(k.result))try{t=JSON.parse(r),q=h.create_from_json(t)}catch(u){}q||(q=a.element.create(k.result))}q&&q.robot_in_training()&&q.robot_in_training().drop_from_data_transfer(q,d);G(c,$(q.get_frontside_element(!0)),q,d,e,f,t)};l||m||n?k.readAsDataURL(b):k.readAsText(b)},C=function(b,c,d,e,f){var g=function(b,c,e,f){var g=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),G(c,
$(a.get_frontside_element(!0)),a,d,e,f))};h.create_widget_from_URL(b,g,function(c){var d=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");d?g(a.element.create(d)):(h.display_message("Error: "+c+". When trying to fetch "+b),console.log(c))})};b.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&g(a,c,e,f)})},E=function(a,b){var c=$("<div class='"+a+"'>");h.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=
function(){return d}})},B=function(){var b=h.get_path_to_toontalk_folder()+"sounds/",c=function(a){a=new Audio(b+a);a.volume=h.get_audio_volume(a);return a};a.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),event_ignored:c("PLOP.mp3")};a.sounds.bird_fly.loop=!0},I=function(a){var b=document.createElement("script");
b.src=a;document.body.appendChild(b)},D=function(){d&&(d.removeClass("toontalk-being-dragged"),h.set_timeout(function(){d=void 0}))},Q=function(a,b){if(a===b)return!0;if(a.parentNode)return Q(a.parentNode,b)},H=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",k,l;if(0>f)return a;for(;0<=f;){k=f+d.length;l=a.indexOf(e,k);if(0>l)return h.report_internal_error("Expected title to have matching pairs of "+
d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(k,l));c=l+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},N=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},L=[],P=[],O;window.addEventListener("message",function(b){"zero-timeout-message"===b.data&&b.source===window?(b.stopPropagation(),0<L.length&&L.shift()()):b.data.editable_contents&&a.publish.republish(b.data)},!1);e.observe(window.document,{childList:!0,subtree:!0});h.available_types=
"number box element robot nest sensor top-level".split(" ");h.create_from_json=function(b,c,d){var e=function(a,b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},f,g,k,l,m;if(b){c||(c={});c.guid_to_nest_table||(c.guid_to_nest_table={});b.shared_widgets&&(c.json_of_shared_widgets=b.shared_widgets,c.shared_widgets=[]);b.shared_html&&(c.shared_html=b.shared_html);if(b.widget)return(f=
h.create_from_json(b.widget,c))&&b.is_backside?f.get_backside(!0):f;if(c&&c.shared_widgets&&0<=b.shared_widget_index){if(d=c.shared_widgets[b.shared_widget_index])return d;d=c.json_of_shared_widgets[b.shared_widget_index];f=h.create_from_json(d,c,!0);return e(f,c,b.shared_widget_index)}(k=b.semantic)||(k=b);l=b.view;if(0<=k.shared_widget_index){if(!c.json_of_shared_widgets){h.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}f=h.create_from_json(c.json_of_shared_widgets[k.shared_widget_index],
c,!0);return e(f,c,k.shared_widget_index)}if(a.creators_from_json[k.type]){c||(c={});l?c.json_view=l:l=c.json_view;if(a.debugging)f=a.creators_from_json[k.type](k,c);else try{f=a.creators_from_json[k.type](k,c)}catch(n){console.error(n.stack),h.report_internal_error("Unable to recreate a "+k.type+". Error is "+n)}f&&!f.is_widget&&a.path.process_path_json(f,b,c);if(f&&f.get_backside){k.erased&&(a.widget.erasable(f),f.set_erased(k.erased));k.infinite_stack&&f.set_infinite_stack(k.infinite_stack);k.open_backside_only_if_stopped&&
f.set_open_backside_only_if_stopped(!0);if(l){if(l.frontside_width)if(g=f.get_element()){if(f.ok_to_set_dimensions())if(m={width:l.frontside_width,height:l.frontside_height},"element"===k.type)f.on_update_display(function(){h.set_css(g,m)});else h.set_css(g,m)}else l.saved_width||(f.saved_width=l.frontside_width,f.saved_height=l.frontside_height);l.saved_width&&(f.saved_width=l.saved_width,f.saved_height=l.saved_height);l.backside_geometry&&(f.backside_geometry=l.backside_geometry)}k.backside_widgets&&
(d?f.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(f,k.backside_widgets,c)}.bind(this):this.add_backside_widgets_from_json(f,k.backside_widgets,c))}return f}h.report_internal_error("JSON type '"+k.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};h.add_backside_widgets_from_json=function(a,b,c){var d;b&&(d=this.create_array_from_json(b,c),a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?0<=a.widget.shared_widget_index&&
c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a})))};h.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?h.create_from_json(a,b):a});return c};h.get_json_of_array=function(a,b,c,d,e,f){var g,k;c>=a.length?e():(g=a[c])?g.is_primary_backside&&g.is_primary_backside()?(k=function(f,g){b.push({widget:f,is_backside:!0});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),h.get_json(g.get_widget(),
d,k,f)):g.is_widget?(k=function(f,g){b.push({widget:f});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),h.get_json(g,d,k,f)):(k=function(f,g){b.push(f);this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),g.get_json(d,k,f)):h.get_json_of_array(a,b,c+1,d,e,f)};h.fresh_json_history=function(a){var b={widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=a.shared_html);return b};h.get_json_top_level=function(a,b,c){var d=this.fresh_json_history();h.maximum_json_generation_duration=
c;h.get_json(a,d,function(c){0<d.shared_widgets.length&&(c.shared_widgets=d.shared_widgets.map(function(b,e){var f=function(a){a=d.widgets_encountered.indexOf(a);return d.json_of_widgets_encountered[a]},g=function(a){return f(d.shared_widgets[a])},k=f(b);if(a===b)return k={semantic:k.semantic,view:k.view,version:k.version},c.semantic={shared_widget_index:e},k;c.semantic&&h.tree_replace_once(c.semantic,k,{shared_widget_index:e},g,h.generate_unique_id());return k}));c.shared_html=d.shared_html;b(c)},
Date.now())};h.get_json=function(b,c,d,e){var f,g,k;a.debugging&&!c?h.report_internal_error("no json_history"):(f=c.shared_widgets.indexOf(b),0<=f?d({shared_widget_index:f},e):(f=c.widgets_encountered.indexOf(b),0<=f?(f=h.insert_ancestors_last(b,c.shared_widgets),d({shared_widget_index:f},e)):(f=c.widgets_encountered.push(b)-1,(g=b.is_primary_backside&&b.is_primary_backside())&&(b=b.get_widget()),k=function(a,e){b.add_to_json&&(a=b.add_to_json(a,c));c.json_of_widgets_encountered[f]=a;b.add_backside_widgets_to_json?
b.add_backside_widgets_to_json(a,c,function(){d(a,e)},e):d(a,e)},Date.now()-e<=h.maximum_json_generation_duration?b.get_json(c,k,e):setTimeout(function(){b.get_json(c,k,Date.now())}))))};h.get_json_of_keys=function(a,b,c,d){var e;b||(b=[]);Object.keys(a).forEach(function(c){0>b.indexOf(c)&&(e||(e={}),a[c].get_json?a[c].get_json(void 0,function(a,b){e[c]={json:a}},d):e[c]=a[c])});c(e,d)};h.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?h.create_from_json(a[d].json,
b):a[d]});return c};h.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).forEach(function(g){if(f=a[g]){if(f===b)return a[g]=c,!0;if("shared_widget_index"===g){if(this.tree_replace_once(d(f),b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};h.insert_ancestors_last=function(a,b){var c=a.get_widget(),
d=-1;b.some(function(a,b){if(c.has_ancestor(a))return d=b,!0});0>d&&(d=b.length);b.splice(d,0,c);return d};h.toontalk_json_div=function(a,b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name(),c=c.toString({for_json_div:!0}),f;"top-level"===e?b.is_backside()?(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),e+=h.describe_widgets(d))):e="a top-level widget":(e=h.add_a_or_an(e),b.is_backside()&&
(e="the back of "+e));c&&(d=c.indexOf("data:image/"),0<d&&(f=c.indexOf("alt=",d),0>f&&(f=c.indexOf(">",d)),c=c.substring(0,d+20)+" ... "+c.substring(f)));return"<div class='toontalk-json' translate='no' style='display:none'>\nThis will be replaced by "+e+".\n"+(c?c+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,h.clean_json,"  ")+"</div></div>"};h.describe_widgets=function(a){var b="",c=a.length;a.forEach(function(a){c--;b+=h.add_a_or_an(a.get_type_name());1===c?b+=", and ":1<c&&(b+=", ")});
return b};h.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};h.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:b};h.create_widget_from_URL=function(b,c,d){var e=function(g){try{var h=this.getResponseHeader("content-type"),k,l;if(!h)if(l=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:
""),0===b.indexOf(l))h="";else{d&&d("Could not determine the contents type of the url");f.removeEventListener("readystatechange",e);return}0===h.indexOf("audio")?(k=a.element.create(b),k.set_sound_effect(new Audio(b))):0===h.indexOf("image")?k=a.element.create("<img src='"+b+"'>"):0===h.indexOf("video")?k=a.element.create("<video src='"+b+" ' width='320' height='240'>"):0===h.indexOf("text")&&0>h.indexOf("text/html")?this.responseText&&(k=a.element.create(this.responseText),k.set_source_URL(b)):k=
a.element.create("<div class='toontalk-iframe-container'><iframe src='"+b+"' width='480' height='320'></iframe></div>");k&&c(k)}catch(m){d&&d(m),c()}f.removeEventListener("readystatechange",e)},f=new XMLHttpRequest;f.addEventListener("readystatechange",e);f.open("GET",b,!0);try{f.send()}catch(g){d?d(g):(h.display_message("Error trying to GET "+b+" "+g),console.error(g.stack))}};h.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};h.copy_widget_sides=function(a,
b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};h.copy_array=function(a){return a.slice()};h.generate_unique_id=function(){f+=1;return"toontalk_id_"+f};h.get_style_property=function(a,b){var c;if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle){if(a.parentElement)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);document.body.appendChild(a);c=document.defaultView.getComputedStyle(a,
null).getPropertyValue(b);document.body.removeChild(a);return c}};h.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;if("string"===typeof c){d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;c=parseFloat(c,10);return isNaN(c)?void 0:c}return c};h.get_element_width=function(a){return a?a.getBoundingClientRect().width:0};h.get_element_height=function(a){return a?a.getBoundingClientRect().height:
0};h.data_transfer_json_object=function(b){var c,d;if(b.dataTransfer&&!(0<b.dataTransfer.files.length||N(b))){try{c=b.dataTransfer.getData("text/html")}catch(e){c=b.dataTransfer.getData("text")}if(!c||c.match(/[\u3400-\u9FBF]/))c=b.dataTransfer.getData("text");if(c){if(b=g(c))try{return JSON.parse(b)}catch(e){h.report_internal_error("Exception parsing "+b+"\n"+e.toString())}b=a.element.create("");b.get_frontside_element(!0);b.set_HTML(c);b.get_json(h.fresh_json_history(),function(a,b,c){0<=a.html.shared_html_index&&
(a.html=c.shared_html[a.html.shared_html_index]);d=a});return d}}};h.drag_and_drop=function(a){var b;h.draggable(a);h.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,h.enable_touch_events(a,b))};h.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){n(b,a)});a.addEventListener("dragend",function(b){t(b,a)})};h.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();
return!1});a.addEventListener("drop",function(b){b.preventDefault();r(b,a);b.stopPropagation()});a.addEventListener("dragenter",function(c){var d=z(c,a);d&&b!==d&&h.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!h.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(h.remove_highlight(b),b=void 0);a.stopPropagation()})};h.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;
$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");b.appendChild(d);h.can_receive_drops(b);return b};h.process_json_elements=function(){$(".toontalk-json").each(function(b,c){var d=c.textContent,e,f,g,k;if(d){d=d.substring(d.indexOf("{"),d.lastIndexOf("}")+1);e=JSON.parse(d);if(e.semantic&&"top_level"===e.semantic.type&&!a.no_local_storage&&!a.reset){if(e.load_most_recent_program)try{(k=window.localStorage.getItem("toontalk-last-key"))&&(g=window.localStorage.getItem(k))}catch(l){k=
"Error reading previous state. Error message is "+l,h.is_internet_explorer()?console.error("window.localStorage in IE11 not available with file://...: "+k):h.display_message(k)}g&&(e=JSON.parse(g),f=h.create_from_json(e))}f||(f=h.create_from_json(e));if(f){c.textContent="";$(c).css({display:""});if(f.get_type_name)if(f.is_top_level())d=f.get_backside(!0),d=d.get_element(),$(c).replaceWith(d),$(d).css({width:e.view.backside_width,height:e.view.backside_height,"background-color":e.view.background_color,
"border-width":e.view.border_width});else{if($(c).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),d=f.get_frontside_element(!0))$(d).addClass("toontalk-top-level-resource").css({position:"relative",width:f.saved_width,height:f.saved_height}),c.toontalk_widget_side=f,c.appendChild(d)}else c.appendChild(f.get_element());f.set_active&&f.set_active(!1);f.set_visible&&f.set_visible(!0);setTimeout(function(){f.update_display&&f.update_display();e.semantic.running&&f.set_running(!0)},
1)}else h.report_internal_error("Could not recreate a widget from this JSON: "+d)}})};h.relative_position_from_absolute_position=function(a,b){for(var c=a.parentElement,d=b.left,e=b.top,f;c&&"html"!==c.nodeType;)f=$(c).position(),d-=f.left,e-=f.top,c=c.parentElement;return{left:d,top:e}};h.set_absolute_position=function(a,b){var c=h.relative_position_from_absolute_position(a,b);h.set_css(a,{left:c.left,top:c.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=c.left+"px",
a.style.top=c.top+"px")};h.set_position_relative_to_top_level_backside=function(a,b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-top-level-backside"),b,c)};h.set_position_relative_to_element=function(b,c,d,e){var f=c.offset(),g,k,l;c.get(0).appendChild(b.get(0));f||(f={left:0,top:0});g=d.left-f.left;d=d.top-f.top;e&&(e=a.UTILITIES.get_element_width(b.get(0)),f=a.UTILITIES.get_element_height(b.get(0)),k=a.UTILITIES.get_element_width(c.get(0)),l=a.UTILITIES.get_element_height(c.get(0)),
g>k-e&&(g=k-e),0>g&&(g=0),d>l-f&&(d=l-f),0>d&&(d=0));g=h.scale_left(g,c.get(0));d=h.scale_top(d,c.get(0));c={left:g,top:d,position:"absolute"};b.is(".toontalk-side-animating")?(b.get(0).style.left=g+"px",b.get(0).style.top=d+"px",h.add_one_shot_event_handler(b.get(0),"transitionend",2E3,function(){b.removeClass("toontalk-side-animating");b.get(0).style.transitionDuration=""})):h.set_css(b,c);return c};h.restore_resource=function(b,c){var d,e;b&&b.is(".toontalk-top-level-resource")&&(d=c.copy({fresh_copy:!0}),
e=d.get_frontside_element(!0),h.set_css(e,{width:b.width(),height:b.height()}),b.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),b.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),b.css({position:"absolute"}),b.get(0).parentElement.appendChild(e),a.DISPLAY_UPDATES.pending_update(d),c.set_active&&(c.set_active(!0),d.set_active(!1)))};
h.closest_element=function(b,c){var d,e;if(!c)return b.get(0);d=Number.MAX_VALUE;b.each(function(b,f){var g=$(f).offset(),g=a.UTILITIES.distance(g,c);d>g&&(e=f,d=g)});return e};h.find_resource_equal_to_widget=function(a,b){var c=Number.MAX_VALUE,d=$(b.get_frontside_element()).offset(),e;$(".toontalk-top-level-resource.toontalk-side").each(function(b,f){var g=h.widget_side_of_jquery($(f));g&&(a.equals&&a.equals(g)||a.matching_resource&&a.matching_resource(g)||"matched"===a.match(g))&&(a.is_hole()||
g.get_backside_widgets().length===a.get_backside_widgets().length)&&(g=h.distance($(f).offset(),d),c>g&&(e=f,c=g))});return e};h.set_position_is_absolute=function(a,b,c){var d,e;b?(b=h.get_style_numeric_property(a,"left"),d=h.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===d&&(d=c.pageY-e.top,d-=90)),h.set_css(a,{left:h.left_as_percent(b,a),top:h.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};h.left_as_percent=
function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:h.adjust_left_if_scaled(a,b);return 100*($(c).offset().left-window.pageXOffset+a-d.left)/d.width+"%"};h.top_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:h.adjust_top_if_scaled(a,b);return 100*($(c).offset().top+-window.pageYOffset+a-d.top)/d.height+"%"};h.adjust_left_if_scaled=
function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a-(d-c.get_attribute("width"))/2:a};h.adjust_top_if_scaled=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a-(d-c.get_attribute("height"))/2:a};h.scale_left=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a*d/c.get_attribute("width"):
a};h.scale_top=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a*d/c.get_attribute("height"):a};h.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";case 11:return"eleventh";case 12:return"twelfth";case 13:return"thirteenth";
default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};h.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};h.give_tooltip=function(a,b){a.title=b;h.use_custom_tooltip(a)};h.use_custom_tooltip=function(b){var c=$(b),d;c.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){var e;0>a.top&&(a.top=0,e=c.offset(),e.left<$(window).width()/2?a.left=e.left+c.width()+10:(a.left=0,d=e.left-40));"bottom"===
b.vertical?(c.is(".toontalk-robot")?a.top-=30:c.is(".toontalk-number")?a.top-=30:c.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);h.set_css(this,a)}},open:function(c,e){var f=e.tooltip.get(0),g=f.textContent,k=$(b).is(".toontalk-robot"),l;g===b.toontalk_previous_text?(e.tooltip.remove(),a.speak&&window.speechSynthesis.cancel()):(f.innerHTML=H(g,decodeURIComponent),a.speak&&
(window.speechSynthesis.cancel(),k||(l=function(a){if(f===O||void 0===O)b.toontalk_previous_text=g}),h.speak(f.innerText,l)),O&&$(O).remove(),O=f,a.balloons?(100<g.length&&(l=Math.min(800,d||$(window).width()-100),$(f).position(),e.tooltip.css({maxWidth:l})),setTimeout(function(){k||(b.toontalk_previous_text=g);e.tooltip.remove();$(f).data("ui-tooltip")&&($(f).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),h.use_custom_tooltip(b));O=void 0},g.length*(a.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||
100))):e.tooltip.remove())},close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),h.use_custom_tooltip(b));O=void 0}})};h.speak=function(b,c,d,e,f,g){var k=new SpeechSynthesisUtterance(b),l=window.speechSynthesis.getVoices(),m;0===l.length?window.speechSynthesis.onvoiceschanged=function(){h.speak(b,c,d,e,f,g);window.speechSynthesis.onvoiceschanged=void 0}:(k.volume=void 0===d?Math.min(1,3*a.volume):d,k.pitch=void 0===e?1.2:e,k.rate=void 0===f?.75:f,m=
a.TRANSLATION_ENABLED&&google&&google.translate?google.translate.TranslateElement().f:navigator.language,l.some(function(a){if(0===a.lang.indexOf(m)){k.lang=a.lang;k.voice=a;if(0===g||void 0===g)return!0;g--}}),c&&(k.onend=c),window.speechSynthesis.speak(k))};h.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate'>decodeURIComponent"+a+"decodeURIComponent</span>")};h.remove_encoded_HTML=function(a){return H(a,function(){return""})};h.add_one_shot_event_handler=function(a,
b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};h.default_animation_speed=.5;h.animate_to_absolute_position=function(a,b,c,d,e,f){var g=$(a).offset(),k=$(a).position(),l=h.distance(b,g);0===f||0===d?(h.set_absolute_position(a,b),c&&c()):($(a).css({"z-index":h.next_z_index()}),f||(f=Math.round(l/(d||h.default_animation_speed))),$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=f+"ms",l=k.left+(b.left-
g.left),g=k.top+(b.top-g.top),a.style.left=l+"px",a.style.top=g+"px",a.toontalk_followed_by&&(b.left+=a.toontalk_followed_by.left_offset,b.top+=a.toontalk_followed_by.top_offset,h.animate_to_absolute_position(a.toontalk_followed_by.element,b,void 0,d,e)),e?setTimeout(c,f):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";c&&c()},f))};h.distance=function(a,b){var c=a.left-b.left,d=a.top-b.top;return Math.sqrt(c*c+d*d)};h.highlight_element=function(a,b,
c){var d;if(a){h.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=h.widget_side_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){h.remove_highlight(a)},c))}};h.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};h.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,
b)+".32x32"+a.substring(b):a};h.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};h.constrain_css_to_fit_inside=function(a,b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=h.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,0),d):(c=h.extract_percentage_from_string(b.top),"number"===typeof c&&
(b.top=Math.min(100,Math.max(c,0))+"%")))};h.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(b){}};h.next_z_index=function(){b++;return b};h.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b+" toontalk-button");a.get(0).addEventListener("click",d);h.give_tooltip(a.get(0),c);return a.get(0)};h.create_close_button=function(a,b){var c=document.createElement("div"),d=document.createElement("div");
$(c).addClass("toontalk-close-button toontalk-button");c.addEventListener("click",a);h.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};h.check_radio_button=function(a){$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};h.create_alert_element=function(a){a=h.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};h.create_text_element=function(a){var b=document.createElement("div");b.innerHTML=a;$(b).addClass("ui-widget");return b};h.create_space=
function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};h.create_anchor_element=function(b,c){var d=document.createElement("a");d.innerHTML=b;a.TRANSLATION_ENABLED&&(c=h.add_URL_parameter(c,"translate","1"));d.href=c;d.target="_blank";return d};h.create_text_input=function(a,b,c,d,e,f,g){var k=document.createElement("input"),l;k.type="text";k.className=b;k.value=a;h.give_tooltip(k,d);f&&(k.type=f);c?(a=document.createElement("label"),a.innerHTML=c,
k.id=h.generate_unique_id(),a.htmlFor=k.id,e&&(l=h.create_anchor_element("i",e),$(l).addClass("toontalk-help-button toontalk-button notranslate"),l.translate=!1),c=h.create_horizontal_table(a,k,l),$(a).addClass("ui-widget")):c=k;$(k).button().addClass("toontalk-text-input").css({"background-color":"white"});k.addEventListener("touchstart",function(){$(k).select()});g&&m(k,g);h.use_custom_tooltip(k);return{container:c,button:k}};h.create_text_area=function(a,b,c,d,e,f){var g=document.createElement("textarea");
g.className=b;g.value=a;h.give_tooltip(g,d);a=document.createElement("label");a.innerHTML=c;g.id=h.generate_unique_id();a.htmlFor=g.id;c=h.create_horizontal_table(a,g);$(g).button().addClass("toontalk-text-area").css({background:"white"});g.addEventListener("touchstart",function(){$(g).select()});e&&m(g,e);$(a).addClass("ui-widget");h.use_custom_tooltip(g);return{container:c,button:g}};h.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();if(c=v(a)){if(c.is_backside())return;if(d=b(c,
a))$(a.currentTarget).trigger("change"),a.currentTarget.value=d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};h.create_radio_button=function(a,b,c,d,e,f){var g=document.createElement("div"),k=document.createElement("input"),l=document.createElement("label");k.type="radio";g.className=c+" toontalk-button";k.name=a;k.value=b;l.innerHTML=d;k.id=h.generate_unique_id();l.htmlFor=k.id;g.appendChild(k);g.appendChild(l);h.give_tooltip(g,e);f||$(k).button();h.use_custom_tooltip(k);return{container:g,
button:k,label:l}};h.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),k=document.createElement("select"),l=document.createElement("label");k.className=c;k.name=a;k.id=h.generate_unique_id();l.innerHTML=d;l.htmlFor=k.id;g.appendChild(l);g.appendChild(k);h.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&(h.give_tooltip(c,f[b]),h.use_custom_tooltip(c));k.appendChild(c)});$(k).addClass("ui-widget");$(l).addClass("ui-widget");
h.use_custom_tooltip(k);return{container:g,menu:k,label:l}};h.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b+" toontalk-button";f.checked=a;g.innerHTML=c;f.id=h.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);h.give_tooltip(e,d);h.use_custom_tooltip(f);return{container:e,button:f,label:g}};h.create_horizontal_table=function(){var a=
document.createElement("table"),b,c,d;c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),d.appendChild(arguments[b]));return a};h.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=h.create_row(arguments[b]),a.appendChild(c));return a};h.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<
arguments.length;c++)arguments[c]&&a.appendChild(arguments[c]);b.appendChild(a);return a};h.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};h.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if(arguments[a].checked)return arguments[a]};h.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+
a},c.addEventListener("error",d));return c};h.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);
b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};h.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');a&&b.addClass(a);return b.get(0)};h.become_file_data_table=function(b,c,d,e){$(b).DataTable({data:c,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(b,c,f,g){b=d?b.substring(0,b.length-5):b;c=d?a.google_drive.google_drive_url(f.id):"Click to load this program.";if(e)return"<div class='"+e+"' title='"+
c+"'id='"+f.id+"'>"+b+"</div>";a.TRANSLATION_ENABLED&&(c=h.add_URL_parameter(c,"translate","1"));return"<a href='"+c+"'target='_blank' title='Click to open published page.'>"+b+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(b).addClass("toontalk-file-table")};h.get_local_files_data=function(){return h.get_all_locally_stored_program_names().map(function(a){var b=
h.get_local_storage_meta_data(a);if(b)return{title:a,modifiedDate:b.last_modified,createdDate:b.created,fileSize:b.file_size}})};h.create_local_files_table=function(){var a=h.get_local_files_data(),b=h.create_file_data_table();h.when_attached(b,function(){h.become_file_data_table(b,a,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});return b};h.get_$dragee=function(){return d};h.add_URL_parameter=function(a,b,c){a=h.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?
"&":"?";return a+d+b+"="+c};h.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};h.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||
0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};h.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};h.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};h.backup_all_top_level_widgets=function(a){$(".toontalk-top-level-backside").each(function(b,c){h.widget_side_of_element(c).get_widget().save(a)})};h.make_resizable=function(a,b){var c,
d;a.resizable({start:function(a,b){c=b.originalSize.width;d=b.originalSize.height},resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},handles:"n,e,s,w"})};h.match=function(a,b){var c;if(void 0===a)return"matched";
b=b.dereference();c=a.match(b);return c.is_widget&&b.matched_by?b.matched_by(a):c};h.current_URL=function(){return window.location.pathname};h.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};h.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&h.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};h.copy_frontside_dimensions=function(a,b){var c=a.get_widget().get_frontside_element(),
d;c&&(d=b.get_frontside_element(!0))&&h.set_css(d,{width:$(c).width(),height:$(c).height()})};h.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?h.scale_element(a,c,d,c,d):h.scale_element(a,$(b).width(),$(b).height(),c,d)};h.scale_element=function(b,c,d,e,f,g,k,l,m){var n,q;$(b).is(".toontalk-not-observable")&&(n=a.UTILITIES.widget_side_of_element(b))&&n.update_display();e||(q=$(b).children("img"),e=q.is("*")?q.width():$(b).width());f||(q||(q=$(b).children("img")),f=q.is("*")?q.height():
$(b).height());n=c&&0!==e?c/e:b.toontalk_x_scale||1;q=d&&0!==f?d/f:b.toontalk_y_scale||1;0===n&&(n=1);0===q&&(q=1);b.toontalk_x_scale=n;b.toontalk_y_scale=q;l=(l=l&&l!==document.body?l:b.parentElement)&&0>l.className.indexOf("toontalk-box-hole")&&0>b.className.indexOf("toontalk-scale");var r="";k||(k={});"number"===typeof k.left&&(k.left-=(e-c)/2,m=!0);"number"===typeof k.top&&(k.top-=(f-d)/2,m=!0);!m&&l?(c&&(b.toontalk_translate_x=(c-e)/2,r+="translateX("+b.toontalk_translate_x+"px) "),d&&(b.toontalk_translate_y=
(d-f)/2,r+="translateY("+b.toontalk_translate_y+"px) ")):(b.toontalk_translate_x=void 0,b.toontalk_translate_y=void 0);h.add_transform_to_css((g||"")+" scale("+n+", "+q+")",r,k,l);k.width=e;k.height=f;h.set_css(b,k);return{x_scale:n,y_scale:q}};h.translate_x=function(a){return u("toontalk_translate_x","toontalk_x_scale")};h.translate_y=function(a){return u("toontalk_translate_y","toontalk_y_scale")};h.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=
d?"center center":"left top"),h.set_css_transform(c,b+a))};h.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};h.run_when_dimensions_known=function(a,b,c){var d=a.parentElement,e=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")},f;!c&&$(a).width()&&e(d)?setTimeout(function(){b(d)}):(f=function(c){setTimeout(function(){var g=$(a).width(),k=$(a).height();g&&k?e(a.parentElement)?(b(d),d?d.appendChild(a):
a.parentElement===document.body&&$(a).remove(),$(a).removeClass("toontalk-not-observable")):h.run_when_dimensions_known(a,b,!0):setTimeout(function(){h.widget_side_of_element(a);1E4>c&&f(2*c)},c)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),c&&h.set_css(a,{width:"",height:"",transform:""}),f(1))};h.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&h.run_when_dimensions_known(d,function(){var a=$(d).children("img");a.is("*")?
b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};h.relative_position=function(a,b){var c,d;if(!h.is_attached(a))return{left:0,top:0};c=$(a).offset();b&&(d=$(b).offset(),c.left-=d.left,c.top-=d.top);return c};h.add_animation_class=function(a,b){h.set_css(a,{width:"",height:""});$(a).addClass(b)};h.widget_side_of_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget_side};h.widget_side_of_element=function(a){return a.toontalk_widget_side};h.has_animating_image=function(a){a=$(a);
return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};h.display_message_if_new=function(a){0>P.indexOf(a)&&(h.display_message(a),P.push(a))};h.display_message=function(b){var c=h.create_alert_element(b);$(".toontalk-alert-element").remove();console.log(b);console.trace();document.body.insertBefore(c,document.body.firstChild);a.speak&&(window.speechSynthesis.cancel(),h.speak(b));setTimeout(function(){$(c).remove()},
Math.max(2E3,b.length*(a.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)))};h.display_tooltip=function(a){h.use_custom_tooltip(a.get(0));a.tooltip("open")};h.report_internal_error=function(b){console.error(b);console.trace();a.debugging&&h.display_message("Error: "+b)};h.get_current_url_boolean_parameter=function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};h.get_current_url_numeric_parameter=function(a,b){var c=h.get_current_url_parameter(a);if("undefined"===
typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};h.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>d&&(d=window.location.href.length);return window.location.href.substring(c,d)};h.get_path_to_toontalk_folder=function(){return a.TOONTALK_URL};h.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};h.is_internet_explorer=function(){return h.is_browser_of_type("MSIE")||
h.is_browser_of_type("Trident")};h.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};h.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};h.remove_z_index=function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$(a);a.attr("z-index","");return a.html()};h.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b=!1,c=function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&
$(this).click()}),d.innerHTML="Run all tests",h.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-top-level-backside")&&$(this).click()}),d.innerHTML="Stop all tests");b=!b},d;0!==a.length&&(a.button(),d=a.get(0),d.innerHTML="Run all tests",a.get(0).addEventListener("click",c))};h.set_timeout=function(a,b){b||h.is_internet_explorer()?setTimeout(a,b):(L.push(a),window.postMessage("zero-timeout-message","*"))};h.get_first_property=function(a){return Object.keys(a)[0]};
h.get_all_locally_stored_program_names=function(){var a=window.localStorage.getItem("toontalk-all-program-names");return a?JSON.parse(a):[]};h.set_all_locally_stored_program_names=function(a){window.localStorage.setItem("toontalk-all-program-names",JSON.stringify(a))};h.get_local_storage_meta_data=function(a){a=h.local_storage_program_meta_data_key(a);var b;try{if(b=window.localStorage.getItem(a))return JSON.parse(b)}catch(c){}};h.local_storage_program_key=function(a){return"toontalk-json: "+a};h.local_storage_program_meta_data_key=
function(a){return"toontalk-meta-data: "+a};h.enable_editor=function(a,b,c,d){(function(a,b){var c=function(a){a.data.editor_enabled_for&&a.data.editor_enabled_for===b&&(e=!0,window.removeEventListener("message",c))},d=function(a,b){e||setTimeout(function(){a();d(a,b)},500)},e=!1;window.addEventListener("message",c);d(a,b)})(function(){a.postMessage({save_edits_to:window.location.href,file_id:c,widgets_json:d},"*")},c)};h.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};
h.enable_touch_events=function(b,c){var d=b,e=function(e){var n;e.preventDefault();l&&(e.stopPropagation(),n=e.changedTouches[0],m&&(m.being_dragged=!1),$(b).removeClass("toontalk-being-dragged"),l+c>=Date.now()?(e=document.createEvent("MouseEvent"),e.initMouseEvent("click",!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(e),m&&m.location_constrained_by_container()?$(b).css({left:"",top:""}):h.set_absolute_position(b,{left:k.left,top:k.top}),a.logging&&
0===a.logging.indexOf("touch")&&q("touch end treated as click "+b.id,!0)):(t(e,b),a.logging&&0===a.logging.indexOf("touch")&&q("drag ended "+b.id),r(e,b),a.logging&&0===a.logging.indexOf("touch")&&q("drop happened "+b.id),a.logging&&0===a.logging.indexOf("touch")&&q("",!0),h.set_absolute_position(b,{left:n.pageX-f-a.USABILITY_DRAG_OFFSET.x,top:n.pageY-g-a.USABILITY_DRAG_OFFSET.y})),l=void 0,b=d)},f=0,g=0,k,l,m,u;b.addEventListener("touchstart",function(c){var d=c.changedTouches[0],e,r,t;k=$(b).offset();
0===a.USABILITY_DRAG_OFFSET.y&&(a.USABILITY_DRAG_OFFSET.y=25);a.logging&&0===a.logging.indexOf("touch")&&q("touch start "+b.id);c.preventDefault();if("TEXTAREA"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||$(c.srcElement).is(".ui-resizable-handle"))a.logging&&0===a.logging.indexOf("touch")&&q("touch start ignored due to tag name or class "+b.id);else if((e=h.find_widget_on_page_side(c.changedTouches[0],void 0,0,0))&&e.is_of_type("empty hole")&&(e=e.get_parent_of_frontside()),e&&e.get_frontside_element()!==
b)a.logging&&0===a.logging.indexOf("touch")&&q("touch start ignored since has child who is really touched: "+h.widget_side_of_element(b));else{l=Date.now();a.logging&&0===a.logging.indexOf("touch")&&q("touch start of "+b.id+" at "+l);c.stopPropagation();if(m=h.widget_side_of_element(b))m.being_dragged=!0;m&&m.get_infinite_stack()?(r=m.copy(),m.set_infinite_stack(!1),r.set_infinite_stack(!0)):$(b).is(".toontalk-top-level-resource")&&(r=m.copy(),m.add_copy_to_container(r,0,0),t=$(b).offset(),b=r.get_frontside_element(!0));
r&&(m.add_copy_to_container(r,0,0),m.robot_in_training()&&m.robot_in_training().copied(m,r,!1));$(b).css({"z-index":99999999});t||(t=$(b).offset());n(c,b);f=d.pageX-t.left;g=d.pageY-t.top;a.logging&&0===a.logging.indexOf("touch")&&q("drag started "+b.id)}},!0);b.addEventListener("touchmove",function(c){var d=c.changedTouches[0];if(l){c.preventDefault();h.set_absolute_position(b,{left:d.pageX-f-a.USABILITY_DRAG_OFFSET.x,top:d.pageY-g-a.USABILITY_DRAG_OFFSET.y});c=h.find_widget_on_page_side(d,b,a.USABILITY_DRAG_OFFSET.x,
a.USABILITY_DRAG_OFFSET.y);if(u&&u!==c){var e=u.get_frontside_element();h.remove_highlight(e);u=void 0}c&&(z(d,c.get_element()),u=c);a.logging&&0===a.logging.indexOf("touch")&&q("dragged to "+(d.pageX-f)+", "+(d.pageY-g)+" "+b.id)}},!0);b.addEventListener("touchend",e,!0);b.addEventListener("touchcancel",e,!0)};h.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};h.find_widget_on_page_side=function(a,b,c,d){var e=h.get_mouse_or_first_touch_event_attribute("pageX",
a),f=h.get_mouse_or_first_touch_event_attribute("pageY",a),g;b&&$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),f-(window.pageYOffset+d));for(b&&$(b).show();c&&!c.toontalk_widget_side&&!$(c).is(".toontalk-backside")&&!$(c).is(".toontalk-button")&&!$(c).is(".ui-button");)c=c.parentNode;c&&(g=c.toontalk_widget_side);if(g){g&&g.get_contents&&g.get_contents()&&(g=g.get_contents());if(g.element_to_highlight&&a){c=g.element_to_highlight(a);if(!c)return;g=c.toontalk_widget_side}return g}};
h.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-top-level-backside").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return h.widget_side_of_element(c)};h.set_css=function(a,b){var c,d;if(b){if(c=h.widget_side_of_element(a))d=c.dereference(),$(a).is(".toontalk-temporarily-set-down")||(c.location_constrained_by_container()?(b.left="",b.top=""):d.is_plain_text_element()&&(b.width="",b.height=""));
0===b.width&&(b.width="");0===b.height&&(b.height="");!b.transform&&"number"===typeof b.width&&"number"===typeof b.height&&d&&d.use_scaling_transform?d.use_scaling_transform(b):$(a).css(b)}};h.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};h.conjunction=function(a,b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?h.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};h.insert_function_bird_documentation=
function(a,b){var c=TOONTALK[a]["function"],d=Object.keys(c),e="<table class='toontalk-function-bird-documentation-table'>";d.forEach(function(a,b){e+="<tr><td><div id='bird_id_"+b+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+c[a].title+"</td></tr>"});e+="</table>";$(b).html(e);d.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));
e&&(e.id=encodeURIComponent(b))})};h.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=h.widget_side_of_element(b);c&&c.rerender()})};h.visible_element=function(a){return a&&null!==a.offsetParent};h.get_audio_volume=function(b){var c=document.hidden?0:a.volume;0===c&&l.push({audio_object:b,volume:b.volume});return c};h.play_audio=function(a){a.play();k.push(a);a.addEventListener("ended",function(){var b=k.indexOf(a);0<=b&&k.splice(b,1)})};h.mute_audio_objects_playing=function(){k.forEach(function(a){l.push({audio_object:a,
volume:a.volume});a.volume=0});k=[]};h.stop_audio_objects=function(){k.forEach(function(a){a.pause();a.currentTime=0})};h.restore_audio_volumes=function(){l.forEach(function(a){a.audio_object.volume=a.volume;k.push(a.audio_object)});l=[]};h.is_attached=function(a){return jQuery.contains(window.document,a)};h.when_attached=function(a,b,c){var d=a.toontalk_attached_callback,e;e=d?function(){d();b()}:b;jQuery.contains(window.document,a)&&!c?(a.toontalk_attached_callback=void 0,$(a).removeClass("toontalk-has-attached-callback"),
e()):(a.toontalk_attached_callback=e,c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};h.create_event=function(a,b){var c;try{c=new CustomEvent(a,{detail:b})}catch(d){c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!1,!1,b)}return c};h.create_queue=function(){var b=[],c=0;return{getLength:function(){return b.length-c},isEmpty:function(){return 0==b.length},enqueue:function(c){var d=0==b.length;b.push(c);a.logging&&0<=a.logging.indexOf("queue")&&
console.log(c._debug_string+" enqueued");return d},dequeue:function(){var d;if(0!=b.length)return d=b[c],a.logging&&0<=a.logging.indexOf("queue")&&console.log(d._debug_string+" dequeued"),2*++c>=b.length&&(b=b.slice(c),c=0),d},peek:function(){return 0<b.length?b[c]:void 0},does_any_item_satisfy:function(a){var d;for(d=c;d<b.length;d++)if(a(b[d]))return!0;return!1}}};h.initialize=function(b){var d;c||(b=function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget_side;
c&&c.set_running&&c.set_running(!1)})},a.debugging=h.get_current_url_parameter("debugging"),a.logging=h.get_current_url_parameter("log"),a.volume=h.get_current_url_numeric_parameter("volume",10)/100,0<a.volume&&B(),a.open_backside_only_if_alt_key=h.get_current_url_boolean_parameter("alt_key_to_open_backside"),a.reset=h.get_current_url_boolean_parameter("reset",!1),a.speak=h.get_current_url_boolean_parameter("speak",!1),a.speak&&!window.speechSynthesis&&(a.speak=!1,h.display_message("This browser doesn't support speech output. speak=1 ignored.")),
a.balloons=h.get_current_url_boolean_parameter("balloons",!0),a.open_backside_only_if_alt_key||(a.open_backside_only_if_alt_key=h.get_current_url_boolean_parameter("puzzle"),a.open_backside_only_if_alt_key&&(a.reset=!0)),h.process_json_elements(),window.document.addEventListener("click",b),a.DEFAULT_QUEUE=window.TOONTALK.queue.create(),a.DEFAULT_QUEUE.start(),window.addEventListener("beforeunload",function(b){try{h.backup_all_top_level_widgets(!0)}catch(c){a.UTILITIES.report_internal_error(c)}}),
a.TRANSLATION_ENABLED=h.get_current_url_boolean_parameter("translate",!1),a.TRANSLATION_ENABLED?($("a").each(function(a,b){b.href=h.add_URL_parameter(b.href,"translate","1")}),$("#google_translate_element").is("*")||(b=document.createElement("div"),b.id="google_translate_element",document.body.insertBefore(b,document.body.firstChild)),document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]),I("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"),
d=document.createElement("div"),d.className="toontalk-translation-element",document.body.appendChild(d),h.translate=function(a,b,c){var e;void 0===c&&(c=500);d.innerHTML=a;e=d.innerText;setTimeout(function(){e!==d.innerText||0>=c?(b(d.innerText),d.innerText=""):h.translate(a,b,c-100)},100)}):$("#google_translate_element").remove(),a.vacuum.the_vacuum||a.vacuum.create(),h.add_test_all_button(),E("toontalk-robot",a.robot),E("toontalk-empty-nest",a.nest),E("toontalk-bird-static",a.bird),$("[title]").each(function(a,
b){h.use_custom_tooltip(b)}),document.addEventListener("visibilitychange",function(){document.hidden?h.mute_audio_objects_playing():(h.rerender_all(),h.restore_audio_volumes())}),setTimeout(function(){a.DISPLAY_UPDATES.update_display()},100),c=!0,document.dispatchEvent(a.UTILITIES.create_event("toontalk_initialized",{})))};h.do_after_initialization=function(a){c?a():document.addEventListener("toontalk_initialized",a)};return h}(window.TOONTALK);window.initialize_toontalk=window.TOONTALK.UTILITIES.initialize;
