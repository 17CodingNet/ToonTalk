(function(b){var h;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(h={},define(function(){return h})):h="undefined"!==typeof window?window:b:h=exports;(function(b){var d={greatest_common_divisor:function(e,b){if(1===b||1===e)return 1;for(var a;0!==b;){a=b;b=e%b;if(!isFinite(b))return 0;e=a}return e}};d.gcd=d.greatest_common_divisor;d.fromRandom=function(e){return Math.random()*(1<<e)>>>0};d.fromMillitime=function(){return+new Date};d.fromUnixtime=
function(){return.001*d.fromMillitime()|0};"undefined"!==typeof b&&(b.integer=d);(function(e){function b(e,c,d){if(d!==a)return e instanceof b?e:"undefined"===typeof e?g:b.parse(e);for(e=e||[];e.length&&!e[e.length-1];)--e.length;this._d=e;this._s=e.length?c||1:0}var a={};b._construct=function(e,g){return new b(e,g,a)};b.base=1E7;b.base_log10=7;var g=new b([],0,a);b.ZERO=g;var c=new b([1],1,a);b.ONE=c;var d=new b(c._d,-1,a);b.M_ONE=d;b._0=g;b._1=c;b.small=[g,c,new b([2],1,a),new b([3],1,a),new b([4],
1,a),new b([5],1,a),new b([6],1,a),new b([7],1,a),new b([8],1,a),new b([9],1,a),new b([10],1,a),new b([11],1,a),new b([12],1,a),new b([13],1,a),new b([14],1,a),new b([15],1,a),new b([16],1,a),new b([17],1,a),new b([18],1,a),new b([19],1,a),new b([20],1,a),new b([21],1,a),new b([22],1,a),new b([23],1,a),new b([24],1,a),new b([25],1,a),new b([26],1,a),new b([27],1,a),new b([28],1,a),new b([29],1,a),new b([30],1,a),new b([31],1,a),new b([32],1,a),new b([33],1,a),new b([34],1,a),new b([35],1,a),new b([36],
1,a)];b.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");b.prototype.toString=function(e){e=+e||10;if(2>e||36<e)throw Error("illegal radix "+e+".");if(0===this._s)return"0";if(10===e){e=0>this._s?"-":"";e+=this._d[this._d.length-1].toString();for(var a=this._d.length-2;0<=a;a--){for(var g=this._d[a].toString();7>g.length;)g="0"+g;e+=g}return e}a=b.digits;e=b.small[e];for(var g=this._s,c=this.abs(),d=[],f;0!==c._s;)f=c.divRem(e),c=f[0],f=f[1],d.push(a[f.valueOf()]);return(0>g?"-":"")+d.reverse().join("")};
b.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];b.parse=function(e,c){function d(e){e=e.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return e.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(e,b,a,c,g){g=+g;var d=0>g,n=a.length+g;e=(d?a:c).length;g=(g=Math.abs(g))>=e?g-e+d:0;e=Array(g+1).join("0");a+=c;return(b||"")+(d?a=e+a:a+=e).substr(0,n+=d?e.length:0)+(n<a.length?"."+a.substr(n):"")})}e=e.toString();if("undefined"===typeof c||10===+c)e=d(e);var f=(new RegExp("^([+\\-]?)("+("undefined"===
typeof c?"0[xcb]":16==c?"0x":8==c?"0c":2==c?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(e);if(f){var k=f[1]||"+",l=f[2]||"",f=f[3]||"";if("undefined"===typeof c)c="0x"===l||"0X"===l?16:"0c"===l||"0C"===l?8:"0b"===l||"0B"===l?2:10;else if(2>c||36<c)throw Error("Illegal radix "+c+".");c=+c;if(!b.radixRegex[c].test(f))throw Error("Bad digit for radix "+c);f=f.replace(/^0+/,"").split("");if(0===f.length)return g;k="-"===k?-1:1;if(10==c){for(l=[];7<=f.length;)l.push(parseInt(f.splice(f.length-b.base_log10,
b.base_log10).join(""),10));l.push(parseInt(f.join(""),10));return new b(l,k,a)}l=g;c=b.small[c];for(var m=b.small,h=0;h<f.length;h++)l=l.multiply(c).add(m[parseInt(f[h],36)]);return new b(l._d,k,a)}throw Error("Invalid BigInteger format: "+e);};b.prototype.add=function(e){if(0===this._s)return b(e);e=b(e);if(0===e._s)return this;if(this._s!==e._s)return e=e.negate(),this.subtract(e);var g=this._d;e=e._d;for(var c=g.length,d=e.length,f=Array(Math.max(c,d)+1),k=Math.min(c,d),l=0,m=0;m<k;m++)l=g[m]+
e[m]+l,f[m]=l%1E7,l=l/1E7|0;d>c&&(g=e,c=d);for(m=k;l&&m<c;m++)l=g[m]+l,f[m]=l%1E7,l=l/1E7|0;for(l&&(f[m]=l);m<c;m++)f[m]=g[m];return new b(f,this._s,a)};b.prototype.negate=function(){return new b(this._d,-this._s|0,a)};b.prototype.abs=function(){return 0>this._s?this.negate():this};b.prototype.subtract=function(e){if(0===this._s)return b(e).negate();e=b(e);if(0===e._s)return this;if(this._s!==e._s)return e=e.negate(),this.add(e);var c=this;0>this._s&&(c=new b(e._d,1,a),e=new b(this._d,1,a));var d=
c.compareAbs(e);if(0===d)return g;if(0>d){var f=e;e=c;c=f}c=c._d;e=e._d;var f=c.length,k=e.length,l=Array(f),m=0,h,q;for(h=0;h<k;h++)q=c[h]-m-e[h],0>q?(q+=1E7,m=1):m=0,l[h]=q;for(h=k;h<f;h++){q=c[h]-m;if(0>q)q+=1E7;else{l[h++]=q;break}l[h]=q}for(;h<f;h++)l[h]=c[h];return new b(l,d,a)};(function(){function e(c,g){for(var d=c._d,f=d.slice(),k=0;;){var l=(d[k]||0)+1;f[k]=l%1E7;if(9999999>=l)break;++k}return new b(f,g,a)}function g(e,c){for(var d=e._d,f=d.slice(),k=0;;){var l=(d[k]||0)-1;if(0>l)f[k]=
l+1E7;else{f[k]=l;break}++k}return new b(f,c,a)}b.prototype.next=function(){switch(this._s){case 0:return c;case -1:return g(this,-1);default:return e(this,1)}};b.prototype.prev=function(){switch(this._s){case 0:return d;case -1:return e(this,-1);default:return g(this,1)}}})();b.prototype.compareAbs=function(e){if(this===e)return 0;if(!(e instanceof b)){if(!isFinite(e))return isNaN(e)?e:-1;e=b(e)}if(0===this._s)return 0!==e._s?-1:0;if(0===e._s)return 1;var a=this._d.length,c=e._d.length;if(a<c)return-1;
if(a>c)return 1;c=this._d;e=e._d;for(--a;0<=a;a--)if(c[a]!==e[a])return c[a]<e[a]?-1:1;return 0};b.prototype.compare=function(e){if(this===e)return 0;e=b(e);return 0===this._s?-e._s:this._s===e._s?this.compareAbs(e)*this._s:this._s};b.prototype.isUnit=function(){return this===c||this===d||1===this._d.length&&1===this._d[0]};b.prototype.multiply=function(e){if(0===this._s)return g;e=b(e);if(0===e._s)return g;if(this.isUnit())return 0>this._s?e.negate():e;if(e.isUnit())return 0>e._s?this.negate():this;
if(this===e)return this.square();var c=this._d.length>=e._d.length,d=(c?this:e)._d,c=(c?e:this)._d,f=d.length,k=c.length,l=f+k,m=Array(l),h;for(h=0;h<l;h++)m[h]=0;for(h=0;h<k;h++){for(var l=0,q=c[h],u=f+h,r,p=h;p<u;p++)r=m[p]+q*d[p-h]+l,l=r/1E7|0,m[p]=r%1E7|0;l&&(r=m[p]+l,m[p]=r%1E7)}return new b(m,this._s*e._s,a)};b.prototype.multiplySingleDigit=function(e){if(0===e||0===this._s)return g;if(1===e)return this;var c;if(1===this._d.length)return c=this._d[0]*e,1E7<=c?new b([c%1E7|0,c/1E7|0],1,a):new b([c],
1,a);if(2===e)return this.add(this);if(this.isUnit())return new b([e],1,a);var d=this._d,f=d.length;c=f+1;for(var k=Array(c),l=0;l<c;l++)k[l]=0;for(var m=l=0;m<f;m++)c=e*d[m]+l,l=c/1E7|0,k[m]=c%1E7|0;l&&(k[m]=l);return new b(k,1,a)};b.prototype.square=function(){if(0===this._s)return g;if(this.isUnit())return c;var e=this._d,d=e.length,f=Array(d+d+1),k,l,m,h;for(h=0;h<d;h++)m=2*h,k=e[h]*e[h],l=k/1E7|0,f[m]=k%1E7,f[m+1]=l;for(h=0;h<d;h++){l=0;m=2*h+1;for(var q=h+1;q<d;q++,m++)k=e[q]*e[h]*2+f[m]+l,
l=k/1E7|0,f[m]=k%1E7;m=d+h;k=l+f[m];l=k/1E7|0;f[m]=k%1E7;f[m+1]+=l}return new b(f,1,a)};b.prototype.quotient=function(e){return this.divRem(e)[0]};b.prototype.divide=b.prototype.quotient;b.prototype.remainder=function(e){return this.divRem(e)[1]};b.prototype.divRem=function(e){e=b(e);if(0===e._s)throw Error("Divide by zero");if(0===this._s)return[g,g];if(1===e._d.length)return this.divRemSmall(e._s*e._d[0]);switch(this.compareAbs(e)){case 0:return[this._s===e._s?c:d,g];case -1:return[g,this]}var f=
this._s*e._s,k=e.abs(),l=this._d,m=l.length,h=[],q,u=new b([],0,a);for(u._s=1;m;)if(u._d.unshift(l[--m]),0>u.compareAbs(e))h.push(0);else{if(0===u._s)q=0;else{var r=u._d.length;q=k._d.length;r=1E7*u._d[r-1]+u._d[r-2];q=1E7*k._d[q-1]+k._d[q-2];u._d.length>k._d.length&&(r=1E7*(r+1));q=Math.ceil(r/q)}do{r=k.multiplySingleDigit(q);if(0>=r.compareAbs(u))break;q--}while(q);h.push(q);q&&(q=u.subtract(r),u._d=q._d.slice(),0===u._d.length&&(u._s=0))}return[new b(h.reverse(),f,a),new b(u._d,this._s,a)]};b.prototype.divRemSmall=
function(e){e=+e;if(0===e)throw Error("Divide by zero");var c=this._s*(0>e?-1:1);e=Math.abs(e);if(1>e||1E7<=e)throw Error("Argument out of range");if(0===this._s)return[g,g];if(1===e||-1===e)return[1===c?this.abs():new b(this._d,c,a),g];if(1===this._d.length){var f=new b([this._d[0]/e|0],1,a);e=new b([this._d[0]%e|0],1,a);0>c&&(f=f.negate());0>this._s&&(e=e.negate());return[f,e]}for(var d=this._d.slice(),f=Array(d.length),k=0,l=0,m=0,h;d.length;)k=1E7*k+d[d.length-1],k<e?(f[m++]=0,d.pop(),l=1E7*l+
k):(h=0===k?0:k/e|0,l=k-e*h,(f[m++]=h)?(d.pop(),k=l):d.pop());e=new b([l],1,a);0>this._s&&(e=e.negate());return[new b(f.reverse(),c,a),e]};b.prototype.isEven=function(){var e=this._d;return 0===this._s||0===e.length||0===e[0]%2};b.prototype.isOdd=function(){return!this.isEven()};b.prototype.sign=function(){return this._s};b.prototype.isPositive=function(){return 0<this._s};b.prototype.isNegative=function(){return 0>this._s};b.prototype.isZero=function(){return 0===this._s};b.prototype.exp10=function(e){e=
+e;if(0===e)return this;if(Math.abs(e)>Number(f))throw Error("exponent too large in BigInteger.exp10");if(0<e){for(var c=new b(this._d.slice(),this._s,a);7<=e;e-=7)c._d.unshift(0);if(0==e)return c;c._s=1;c=c.multiplySingleDigit(Math.pow(10,e));return 0>this._s?c.negate():c}if(-e>=7*this._d.length)return g;c=new b(this._d.slice(),this._s,a);for(e=-e;7<=e;e-=7)c._d.shift();return 0==e?c:c.divRemSmall(Math.pow(10,e))[0]};b.prototype.pow=function(e){if(this.isUnit())return 0<this._s?this:b(e).isOdd()?
this:this.negate();e=b(e);if(0===e._s)return c;if(0>e._s){if(0===this._s)throw Error("Divide by zero");return g}if(0===this._s)return g;if(e.isUnit())return this;if(0<e.compareAbs(f))throw Error("exponent too large in BigInteger.pow");for(var a=this,d=c,k=b.small[2];e.isPositive()&&(!e.isOdd()||(d=d.multiply(a),!e.isUnit()));)a=a.square(),e=e.quotient(k);return d};b.prototype.modPow=function(e,a){for(var g=c,d=this;e.isPositive();)e.isOdd()&&(g=g.multiply(d).remainder(a)),e=e.quotient(b.small[2]),
e.isPositive()&&(d=d.square().remainder(a));return g};b.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var e=this._d.length;if(30>7*e)return Math.log(this.valueOf());var c=Math.ceil(30/7),g=this._d.slice(e-c);return Math.log((new b(g,1,a)).valueOf())+(e-c)*Math.log(1E7)};b.prototype.valueOf=function(){return parseInt(this.toString(),10)};b.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var f=b(2147483647);b.MAX_EXP=f;(function(){function e(a){return function(e){return a.call(b(e))}}
function a(e){return function(a,c){return e.call(b(a),b(c))}}function c(e){return function(a,c,g){return e.call(b(a),b(c),b(g))}}(function(){var g,d,f="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),k="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),l=["modPow"];for(g=0;g<f.length;g++)d=f[g],b[d]=e(b.prototype[d]);for(g=0;g<k.length;g++)d=k[g],b[d]=a(b.prototype[d]);for(g=0;g<l.length;g++)d=
l[g],b[d]=c(b.prototype[d]);b.exp10=function(e,a){return b(e).exp10(a)}})()})();e.BigInteger=b})("undefined"!==typeof b?b:this);var a={greatest_common_divisor:function(e,b){if(b.isUnit()||e.isUnit())return BigInteger.ONE;for(var a;!b.isZero();)a=b,b=e.remainder(b),e=a;return e},create:function(){return[0]},clone:function(e){for(var b=[],a=0,c=e.length;a<c;a++)b[a]=e[a];return b},copy:function(e,b){e=[];for(var a=0,c=b.length;a<c;a++)e[a]=b[a];return e},abs:function(e,b){e[0]=Math.abs(b[0]);return e},
str:function(e){return e[0].toString()},toInteger:function(e){return out[0]},fromInteger:function(e){return[parseInt(e)]}};a.ZERO=a.fromInteger(0);a.ONE=a.fromInteger(1);"undefined"!==typeof b&&(b.bigint=a);if(!k)var k=Array;if(!m)var m=Math.pow(2,56);if(!f)var f=16777216;var g={EPSILON:2E-16};g.MAX_LOOPS=f;g.create=function(){var e=new k(2);e[0]=0;e[1]=1;return e};g.clone=function(e){var b=new k(2);b[0]=e[0];b[1]=e[1];return b};g.fromValues=function(e,b){var a=new k(2);a[0]=e;a[1]=b;return g.normalize(a,
a)};g.copy=function(e,b){e[0]=b[0];e[1]=b[1];return e};g.set=function(e,b,a){e[0]=b;e[1]=a;return g.normalize(e,e)};g.abs=function(e,b){e[0]=Math.abs(b[0]);e[1]=b[1];return e};g.invert=function(e,b){var a=b[0];e[0]=b[1];e[1]=a;return e};g.reciprocal=g.invert;g.add=function(e,b,a){b[1]===a[1]?(e[0]=b[0]+a[0],e[1]=b[1]):(e[0]=b[0]*a[1]+a[0]*b[1],e[1]=b[1]*a[1]);return g.normalize(e,e)};g.subtract=function(e,b,a){b[1]===a[1]?(e[0]=b[0]-a[0],e[1]=b[1]):(e[0]=b[0]*a[1]-a[0]*b[1],e[1]=b[1]*a[1]);return g.normalize(e,
e)};g.sub=g.subtract;g.multiply=function(e,b,a){e[0]=b[0]*a[0];e[1]=b[1]*a[1];return g.normalize(e,e)};g.mul=g.multiply;g.mediant=function(e,b,a){e[0]=b[0]+a[0];e[1]=b[1]+a[1];return g.normalize(e,e)};g.divide=function(e,b,a){e[0]=b[0]*a[1];e[1]=b[1]*a[0];return g.normalize(e,e)};g.div=g.divide;g.equals=function(e,b){return 0===e[0]&&0===b[0]||0===e[1]&&0===b[1]?!0:e[0]===b[0]&&e[1]===b[1]};g.approximates=function(e,b){if(g.equals(e,b))return!0;var a=g.create();g.sub(a,e,b);g.abs(a,a);return g.isLessThan(a,
g.INFINITESIMAL)};g.isGreaterThan=function(e,b){return g.equals(e,b)?!1:e[0]*b[1]>b[0]*e[1]};g.isLessThan=function(e,b){return g.equals(e,b)?!1:e[0]*b[1]<b[0]*e[1]};g.isNegative=function(e){return 0>e[0]};g.min=function(e,b,a){g.isLessThan(b,a)?(e[0]=b[0],e[1]=b[1]):(e[0]=a[0],e[1]=a[1]);return e};g.max=function(e,b,a){g.isGreaterThan(b,a)?(e[0]=b[0],e[1]=b[1]):(e[0]=a[0],e[1]=a[1]);return e};g.scalar_multiply=function(e,b,a){e[0]=b[0]*a;e[1]=b[1];return g.normalize(e,e)};g.scalar_divide=function(e,
b,a){e[0]=b[0];e[1]=b[1]*a;return g.normalize(e,e)};g.normalize=function(e,b){if(isNaN(b[0])||isNaN(b[1])||0===b[0]&&0===b[1])return e[0]=0,e[1]=0,e;if(0===b[0])return e[0]=0,e[1]=1,e;if(0===b[1])return e[0]=1,e[1]=0,e;if(b[0]===b[1])return e[0]=1,e[1]=1,e;0<b[1]?(e[0]=b[0],e[1]=b[1]):(e[0]=-b[0],e[1]=-b[1]);var a=d.greatest_common_divisor(Math.abs(e[0]),e[1]);1<a&&(e[0]/=a,e[1]/=a);return e};g.opposite=function(e,b){e[0]=-b[0];e[1]=b[1];return e};g.negative=g.opposite;g.neg=g.opposite;g.power=function(e,
b,a){2===a?(e[0]=b[0]*b[0],e[1]=b[1]*b[1]):0<a?(e[0]=Math.pow(b[0],a),e[1]=Math.pow(b[1],a)):0>a?(a=Math.abs(a),e[0]=Math.pow(b[1],a),e[1]=Math.pow(b[0],a)):g.copy(e,g.ONE);return g.normalize(e,e)};g.pow=g.power;g.sqrt=function(e,b){return g.nthRoot(e,b,2)};g.nthRoot=function(e,b,a){if(g.equals(b,g.ZERO))return g.copy(e,g.ZERO);if(g.equals(b,g.ONE))return g.copy(e,g.ONE);if(g.equals(b,g.INFINITY))return g.copy(e,g.INFINITY);if(g.equals(b,g.INFINULL))return g.copy(e,g.INFINULL);var c=g.isNegative(b);
c&&(b[0]=-b[0]);e=g.copy(e,g.ONE);for(var d=[1,0,0,1],f=g.clone(g.ONE),k=g.MAX_LOOPS;!g.approximates(b,f)&&k--;)g.isLessThan(b,f)?(d[0]+=d[1],d[2]+=d[3]):(d[1]+=d[0],d[3]+=d[2]),e[0]=d[0]+d[1],e[1]=d[2]+d[3],g.pow(f,e,a);c&&(b[0]=-b[0],1===a%2&&g.neg(e,e));return e};g.dot=function(e,b){return e[0]*b[0]+e[1]*b[1]};g.str=function(e){return 1===e[1]?e[0].toString():e[0]+"/"+e[1]};g.toDecimal=function(e){return e[0]/e[1]};g.dec=g.toDecimal;g.toInteger=function(e){return Math.round(g.toDecimal(e))};g.round=
g.toInteger;g.floor=function(e){return Math.floor(g.toDecimal(e))};g.ceil=function(e){return Math.ceil(g.toDecimal(e))};g.fromInteger_copy=function(e,b){e[0]=parseInt(b);e[1]=1;return e};g.fromInteger=function(e){return g.fromInteger_copy(g.create(),e)};g.fromIntegerInverse_copy=function(e,b){e[0]=1;e[1]=parseInt(b);0>e[1]&&(e[0]=-e[0],e[1]=-e[1]);return e};g.fromIntegerInverse=function(e){return g.fromIntegerInverse_copy(g.create(),e)};g.fromDecimal=function(e){return g.fromDecimal_copy(g.create(),
e)};g.fromDecimal_copy=function(e,b){b=parseFloat(b);if(isNaN(b))return g.copy(e,g.INFINULL);if(Infinity===b)return g.copy(e,g.INFINITY);if(Math.abs(b)<g.EPSILON)return g.copy(e,g.ZERO);if(Math.abs(b-1)<g.EPSILON)return g.copy(e,g.ONE);if(Math.abs(b%1)<g.EPSILON)return g.fromInteger_copy(e,b);if(Math.abs(1/b%1)<g.EPSILON)return g.fromIntegerInverse_copy(e,Math.round(1/b));g.copy(e,g.ONE);for(var a=[1,0,0,1],c=b,d=1,f=g.MAX_LOOPS;f--&&Math.abs(b-g.toDecimal(e))>g.EPSILON;){d=Math.floor(c);e[0]=d*a[0]+
a[2];e[1]=d*a[1]+a[3];if(c===d)break;c=1/(c-d);a[2]=a[0];a[3]=a[1];a[0]=e[0];a[1]=e[1]}return e};g.fromRandom=function(e){e[0]=0xfffffffffffff*Math.random()<<0;e[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return g.normalize(e,e)};g.sin=function(e,b){if(0===b[1])return g.copy(e,g.ZERO);g.scalar_multiply(e,b,2);var a=g.create();g.pow(a,b,2);g.add(a,a,g.ONE);g.divide(e,e,a);return e};g.cos=function(e,b){if(0===b[1])return g.neg(e,g.ONE);var a=g.create();g.pow(a,b,2);g.sub(e,g.ONE,a);var c=g.create();
g.add(c,g.ONE,a);g.divide(e,e,c);return e};g.tan=function(e,b){g.scalar_multiply(e,b,2);var a=g.create();g.pow(a,b,2);g.scalar_multiply(a,a,2);g.add(e,e,a);g.pow(a,b,4);g.sub(a,g.ONE,a);g.divide(e,e,a);return e};g.toEgyptian=function(e){e=g.clone(e);g.abs(e,e);var b=g.floor(e);b&&g.sub(e,e,g.fromInteger(b));if(!e[0])return b.toString();b||(b="");for(var a=1,c=g.create();1!==e[0];)a++,c=g.fromValues(1,a),g.isGreaterThan(e,c)&&(b&&(b+=" + "),b+=g.str(c),g.sub(e,e,c));return e?b?b+" + "+g.str(e):g.str(e):
b?b:"0"};g.toBabylonian=function(e){var b="",a=g.toDecimal(e);e=parseInt(a);for(var a=a-e,c=0,d=0;0<e;)(c=e%60)&&(b=c+" * 60^"+d+(b?" + ":"")+b),e=(e-c)/60,d++;for(d=-1;0<a;)a*=60,c=parseInt(a+1E-13),a-=c,-1E-13>a||(c&&(b+=(b?" + ":"")+c+" * 60^"+d),d--);return b?b:"0"};g.traceSternBrocot=function(e){var b="";if(g.equals(e,g.ZERO)||g.equals(e,g.ONE)||g.equals(e,g.INFINITY)||g.equals(e,g.INFINULL))return b;e=g.clone(e);g.isNegative(e)&&(e[0]=-e[0]);for(var a=g.clone(g.ONE),c=[1,0,0,1],d=0,f=0,k=g.MAX_LOOPS;!g.approximates(e,
a)&&k--;)g.isLessThan(e,a)?(c[0]+=c[1],c[2]+=c[3],f++,d&&(b+="R",1!==d&&(b+=d),d=0,b+=" ")):(c[1]+=c[0],c[3]+=c[2],d++,f&&(b+="L",1!==f&&(b+=f),f=0,b+=" ")),a[0]=c[0]+c[1],a[1]=c[2]+c[3];f?(b+="L",1!==f&&(b+=f)):d&&(b+="R",1!==d&&(b+=d));0>k&&(b+="...");return b};g.toContinuedFraction=function(e,b){b="undefined"===typeof b?65536:parseInt(b);if(g.equals(e,g.ZERO))return[0];if(g.equals(e,g.ONE))return[1];if(g.equals(e,g.NEGONE))return[-1];if(g.equals(e,g.INFINITY))return[1,0];if(g.equals(e,g.INFINULL))return[0,
0];var a=g.clone(e),c=g.isNegative(a);c&&(a[0]=-a[0]);for(var d=g.clone(g.ONE),f=[1,0,0,1],k=1,l=[0],m=l.length-1;!g.equals(a,d)&&b--;)g.isLessThan(a,d)?(-1===k?l[m]++:(k=-1,l.push(1),m++),f[0]+=f[1],f[2]+=f[3]):(1===k?l[m]++:(k=1,l.push(1),m++),f[1]+=f[0],f[3]+=f[2]),d[0]=f[0]+f[1],d[1]=f[2]+f[3];0>b?l.push(0):l[m]++;if(c)for(var h in l)l[h]=-l[h];return l};g.fromContinuedFraction=function(e,b){g.fromInteger_copy(e,b[b.length-1]);for(var a=b.length-2;-1<a;a--)g.invert(e,e),g.add(e,g.fromInteger(b[a]),
e);return e};g.dump=function(e){g.create();return"rat\t"+g.str(e)+"\n~\t"+g.toDecimal(e)+"\nCF:\t["+g.toContinuedFraction(e)+"]\n"};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);g.NEGONE=g.fromInteger(-1);g.INFINITY=g.fromValues(1,0);g.INFINULL=g.fromValues(0,0);g.INFINITESIMAL=g.clone([1,m]);g.PI=g.fromValues(1320192667429,420230377710);"undefined"!==typeof b&&(b.rat=g);if(!h)var h=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!p)var p=1073741824;var l={EPSILON:2E-16};l.MAX_LOOPS=p;l.create=
function(){var e=[];e[0]=BigInteger.ZERO;e[1]=BigInteger.ONE;return e};l.clone=function(e){var b=[];b[0]=e[0];b[1]=e[1];return b};l.fromValues=function(e,b){var a=[];a[0]=new BigInteger(e);a[1]=new BigInteger(b);return l.normalize(a,a)};l.copy=function(e,b){e[0]=b[0];e[1]=b[1];return e};l.set=function(e,b,a){e[0]=b;e[1]=a;return l.normalize(e,e)};l.toRat=function(e,b){return g.set(e,b[0].toJSValue(),b[1].toJSValue())};l.fromRat=function(b,a){return l.set(b,BigInteger(a[0]),BigInteger(a[1]))};l.abs=
function(b,a){b[0]=a[0].abs();b[1]=a[1];return b};l.invert=function(b,a){var c=a[0];b[0]=a[1];b[1]=c;return b};l.reciprocal=l.invert;l.add=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].add(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).add(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return l.normalize(b,b)};l.subtract=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].subtract(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).subtract(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return l.normalize(b,
b)};l.sub=l.subtract;l.multiply=function(b,a,c){b[0]=a[0].multiply(c[0]);b[1]=a[1].multiply(c[1]);return l.normalize(b,b)};l.mul=l.multiply;l.mediant=function(b,a,c){b[0]=a[0].add(c[0]);b[1]=a[1].add(c[1]);return l.normalize(b,b)};l.divide=function(b,a,c){b[0]=a[0].multiply(c[1]);b[1]=a[1].multiply(c[0]);return l.normalize(b,b)};l.div=l.divide;l.equals=function(b,a){return b[0].isZero()&&a[0].isZero()||b[1].isZero()&&a[1].isZero()?!0:0===b[0].compare(a[0])&&0===b[1].compare(a[1])};l.approximates=
function(b,a){if(l.equals(b,a))return!0;var c=l.create();l.sub(c,b,a);l.abs(c,c);return l.isLessThan(c,l.INFINITESIMAL)};l.isGreaterThan=function(b,a){return l.equals(b,a)?!1:0<b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};l.isLessThan=function(b,a){return l.equals(b,a)?!1:0>b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};l.isNegative=function(b){return b[0].isNegative()};l.min=function(b,a,c){l.isLessThan(a,c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};l.max=function(b,a,c){l.isGreaterThan(a,
c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};l.scalar_multiply=function(b,a,c){b[0]=a[0].multiply(c);b[1]=a[1];return l.normalize(b,b)};l.scalar_divide=function(b,a,c){b[0]=a[0];b[1]=a[1].multiply(c);return l.normalize(b,b)};l.normalize=function(b,c){if(c[0].isZero()||c[1].isZero())return c;if(0===c[0].compare(c[1]))return l.clone(l.ONE);if(c[1].isNegative())b[0]=c[0].negate(),b[1]=c[1].negate();else if(b[0]=c[0],b[1]=c[1],b[1].isZero())return b;var d=a.greatest_common_divisor(b[0].abs(),
b[1]);0<d.compare(BigInteger.ONE)&&(b[0]=b[0].quotient(d),b[1]=b[1].quotient(d));return b};l.opposite=function(b,a){b[0]=a[0].negate();b[1]=a[1];return b};l.negative=l.opposite;l.neg=l.opposite;l.power=function(b,a,c){2===c?(b[0]=a[0].square(),b[1]=a[1].square()):0<c?(b[0]=a[0].pow(c),b[1]=a[1].pow(c)):0>c?(c=Math.abs(c),b[0]=a[1].pow(c),b[1]=a[0].pow(c)):l.copy(b,l.ONE);return b};l.pow=l.power;l.sqrt=function(b,a){return l.nthRoot(b,a,2)};l.nthRoot=function(b,a,c){if(l.equals(a,l.ZERO))return l.copy(b,
l.ZERO);if(l.equals(a,l.ONE))return l.copy(b,l.ONE);if(l.equals(a,l.INFINITY))return l.copy(b,l.INFINITY);if(l.equals(a,l.INFINULL))return l.copy(b,l.INFINULL);var d=l.isNegative(a);d&&(a[0]=a[0].negate());l.copy(b,l.ONE);for(var g=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=l.clone(l.ONE),k=p;!l.approximates(a,f)&&k--;)l.isLessThan(a,f)?(g[0]=g[0].add(g[1]),g[2]=g[2].add(g[3])):(g[1]=g[1].add(g[0]),g[3]=g[3].add(g[2])),b[0]=g[0].add(g[1]),b[1]=g[2].add(g[3]),l.pow(f,b,c);d&&(a[0]=
a[0].negate(),1===c%2&&l.neg(b,b));return b};l.dot=function(b,a){return b[0].multiply(a[0]).add(b[1].multiply(a[1]))};l.str=function(b){return 0===b[1].compare(BigInteger.ONE)?b[0].toString():b[0].toString()+"/"+b[1].toString()};l.toDecimal=function(b){return b[0].toJSValue()/b[1].toJSValue()};l.dec=l.toDecimal;l.toInteger=function(b){return b[0].quotient(b[1]).toJSValue()};l.round=l.toInteger;l.toBigInteger=function(b){return b[0].quotient(b[1])};l.floor=function(b){return Math.floor(l.toDecimal(b))};
l.ceil=function(b){return Math.ceil(l.toDecimal(b))};l.fromInteger_copy=function(b,a){b[0]=BigInteger(a);b[1]=BigInteger.ONE;return b};l.fromInteger=function(b){return l.fromInteger_copy(l.create(),b)};l.fromIntegerInverse_copy=function(b,a){b[0]=BigInteger.ONE;b[1]=BigInteger(a);b[1].isNegative()&&(b[0]=b[0].negate(),b[1]=b[1].negate());return b};l.fromIntegerInverse=function(b){return l.fromIntegerInverse_copy(l.create(),b)};l.fromDecimal=function(b){return l.fromDecimal_copy(l.create(),b)};l.fromDecimal_copy=
function(b,a){a=parseFloat(a);if(isNaN(a))return l.copy(b,l.INFINULL);if(Infinity===a)return l.copy(b,l.INFINITY);if(Math.abs(a)<l.EPSILON)return l.copy(b,l.ZERO);if(Math.abs(a-1)<l.EPSILON)return l.copy(b,l.ONE);if(Math.abs(a%1)<l.EPSILON)return l.fromInteger_copy(b,a);if(Math.abs(1/a%1)<l.EPSILON)return l.fromIntegerInverse_copy(b,Math.round(1/a));l.copy(b,l.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=a,d=BigInteger(1),f=l.MAX_LOOPS;f--&&Math.abs(a-l.toDecimal(b))>
l.EPSILON;){d=BigInteger(Math.floor(g));b[0]=d.multiply(c[0]).add(c[2]);b[1]=d.multiply(c[1]).add(c[3]);if(d=g-parseInt(d.toString(),10))g=1/d;else{if(a.toString()===l.toDecimal(b))break;g=(c=(a.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;l.add(b,l.fromInteger(c[1]),l.fromValues(c[2],Math.pow(10,g)));break}c[2]=c[0];c[3]=c[1];c[0]=b[0];c[1]=b[1]}return b};l.fromRandom=function(b){b[0]=BigInteger(0xfffffffffffff*Math.random()<<0);b[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return l.normalize(b,b)};l.sin=function(b,a){if(a[1].isZero())return l.copy(b,l.ZERO);l.scalar_multiply(b,a,2);var c=l.create();l.pow(c,a,2);l.add(c,c,l.ONE);l.divide(b,b,c);return b};l.cos=function(b,a){if(a[1].isZero())return l.neg(b,l.ONE);var c=l.create();l.pow(c,a,2);l.sub(b,l.ONE,c);var d=l.create();l.add(d,l.ONE,c);l.divide(b,b,d);return b};l.tan=function(b,a){l.scalar_multiply(b,a,2);var c=l.create();l.pow(c,a,2);l.scalar_multiply(c,c,2);l.add(b,b,c);l.pow(c,a,4);l.sub(c,
l.ONE,c);l.divide(b,b,c);return b};l.toEgyptian=function(b){b=l.clone(b);l.abs(b,b);var a=l.floor(b);a&&l.sub(b,b,l.fromInteger(a));if(!b[0])return a.toString();a||(a="");for(var c=1,d=l.create();1!==b[0];)c++,d=l.fromValues(1,c),l.isGreaterThan(b,d)&&(a&&(a+=" + "),a+=l.str(d),l.sub(b,b,d));return b?a?a+" + "+l.str(b):l.str(b):a?a:"0"};l.toBabylonian=function(b){var a="",c=l.toDecimal(b);b=parseInt(c);for(var c=c-b,d=0,g=0;0<b;)(d=b%60)&&(a=d+" * 60^"+g+(a?" + ":"")+a),b=(b-d)/60,g++;for(g=-1;0<
c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(a+=(a?" + ":"")+d+" * 60^"+g),g--);return a?a:"0"};l.traceSternBrocot=function(b){var a="";if(l.equals(b,l.ZERO)||l.equals(b,l.ONE)||l.equals(b,l.INFINITY)||l.equals(b,l.INFINULL))return a;b=l.clone(b);l.isNegative(b)&&(b[0]=b[0].negate());for(var c=l.clone(l.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=0,f=0,k=65536;!l.equals(b,c)&&k--;)l.isLessThan(b,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),f++,g&&(a+="R",1!==g&&(a+=g),g=
0,a+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),g++,f&&(a+="L",1!==f&&(a+=f),f=0,a+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);f?(a+="L",1!==f&&(a+=f)):g&&(a+="R",1!==g&&(a+=g));0>k&&(a+="...");return a};l.toContinuedFraction=function(b,a){a="undefined"===typeof a?65536:parseInt(a);if(l.equals(b,l.ZERO))return[0];if(l.equals(b,l.ONE))return[1];if(l.equals(b,l.NEGONE))return[-1];if(l.equals(b,l.INFINITY))return[1,0];if(l.equals(b,l.INFINULL))return[0,0];var c=l.clone(b),d=l.isNegative(c);d&&
(c[0]=c[0].negate());for(var g=l.clone(l.ONE),f=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],k=1,m=[0],h=m.length-1;!l.equals(c,g)&&a--;)l.isLessThan(c,g)?(-1===k?m[h]++:(k=-1,m.push(1),h++),f[0]=f[0].add(f[1]),f[2]=f[2].add(f[3])):(1===k?m[h]++:(k=1,m.push(1),h++),f[1]=f[1].add(f[0]),f[3]=f[3].add(f[2])),g[0]=f[0].add(f[1]),g[1]=f[2].add(f[3]);0>a?m.push(0):m[h]++;if(d)for(var q in m)m[q]=-m[q];return m};l.fromContinuedFraction=function(b,a){l.fromInteger_copy(b,a[a.length-1]);for(var c=
a.length-2;-1<c;c--)l.invert(b,b),l.add(b,l.fromInteger(a[c]),b);return b};l.fromFactorial=function(b,a){if("undefined"!==typeof factorial.PREPARED[a])return l.fromInteger_copy(b,factorial.PREPARED[a]);var c=factorial.PREPARED.length-1;for(l.fromInteger_copy(b,factorial.PREPARED[c]);c<a;)l.scalar_multiply(b,b,++c);return b};l.dump=function(b){return"bigrat\t"+l.str(b)+"\n~\t"+l.toDecimal(b)+"\nCF:\t["+l.toContinuedFraction(b)+"]\n"};l.ZERO=l.fromInteger(0);l.ONE=l.fromInteger(1);l.NEGONE=l.fromInteger(-1);
l.INFINITY=l.fromValues(1,0);l.INFINULL=l.fromValues(0,0);l.INFINITESIMAL=l.clone([new BigInteger(1),h]);l.PI=l.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof b&&(b.bigrat=l);var t=function(b,a){this.a=g.fromValues(parseInt(b),parseInt(a))};t.prototype.toString=function(){return g.str(this.a)};t.prototype.toContinuedFraction=function(b){return g.toContinuedFraction(this.a,b)};t.prototype.invert=function(){return g.invert(this.a)};t.prototype.reciprocal=t.prototype.invert;t.prototype.add=function(b){var a=g.create();g.add(a,this.a,b.a);return new t(a[0],a[1])};t.prototype.plus=t.prototype.add;t.prototype.subtract=function(b){var a=g.create();
g.sub(a,this.a,b.a);return new t(a[0],a[1])};t.prototype.sub=t.prototype.subtract;t.prototype.minus=t.prototype.subtract;t.prototype.multiply=function(b){var a=g.create();g.mul(a,this.a,b.a);return new t(a[0],a[1])};t.prototype.mul=t.prototype.multiply;t.prototype.times=t.prototype.multiply;t.prototype.mediant=function(b){var a=g.create();g.mediant(a,this.a,b.a);return new t(a[0],a[1])};t.prototype.divide=function(b){var a=g.create();g.div(a,this.a,b.a);return new t(a[0],a[1])};t.prototype.div=t.prototype.divide;
t.prototype.divided_by=t.prototype.divide;t.prototype.power=function(b){var a=g.create();g.pow(a,this.a,b);return new t(a[0],a[1])};t.prototype.pow=t.prototype.power;t.prototype.dump=function(){return g.dump(this.a)};t.prototype.toRat=function(){return g.clone(this.a)};t.prototype.toDecimal=function(){return g.toDecimal(this.a)};t.fromRat=function(b){var a=new t;a.a[0]=b[0];a.a[1]=b[1];return a};t.fromInteger=function(b){return t.fromRat(g.fromInteger(b))};t.fromIntegerInverse=function(b){return t.fromRat(g.fromIntegerInverse(b))};
t.fromDecimal=function(b){return t.fromRat(g.fromDecimal(b))};t.fromContinuedFraction=function(b){return t.fromRat(g.fromContinuedFraction(g.create(),b))};"undefined"!==typeof b&&(b.rational=t);var q={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<q.GREEK.length?q.GREEK[this.i++]:"?"}}};"undefined"!==typeof b&&(b.alpha=q);m={};m.FINE_STRUCTURE=l.fromValues(30223,4141639);
m.a=m.FINE_STRUCTURE;m.FINE_STRUCTURE_ALT=l.fromValues(13355891,1830237867);m.PLANK=l.fromValues(662606957,1E42);m.h=m.PLANK;m.hBAR=l.fromValues(1054571726,1E43);m.GRAVITATIONAL=l.fromValues(667384,1E16);m.G=m.GRAVITATIONAL;m.SPEED_OF_LIGHT=l.fromInteger(299792458);m.c=m.SPEED_OF_LIGHT;"undefined"!==typeof b&&(b.physics=m);var u={create:function(){return[[],[]]},fromValues:function(b){var a=u.create();a[0]=b.slice();b=u.countDimensions(a);for(a[1]=Array(b);b--;)a[1][b]=0;return u.normalize(a,a)},
mergeDimension:function(b,a,c){b[0]=[a.slice()];b[1].push(0);for(var d in c)b[0].push(c[d]);return b},evaluate:function(b,a,c){l.copy(b,l.ZERO);var d=u.countDimensions(a);if(0===d)return"0";if(1===d)for(var g in a[0]){if(a[0][g]){var d=l.fromInteger(a[0][g]),f=l.pow(l.create(),l.fromInteger(c[0]),a[1][0]+ +g);l.mul(d,d,f);l.add(b,b,d)}}else if(2===d)for(var k in a[0])for(g in a[0][k]){if(a[0][k][g]){var d=l.fromInteger(a[0][k][g]),f=l.pow(l.create(),l.fromInteger(c[0]),a[1][1]+ +g),m=l.pow(l.create(),
l.fromInteger(c[1]),a[1][0]+ +k);l.mul(d,d,f);l.mul(d,d,m);l.add(b,b,d)}}else if(3===d)for(var h in a[0])for(k in a[0][h])for(g in a[0][h][k]){if(a[0][h][k][g]){var d=l.fromInteger(a[0][h][k][g]),f=l.pow(l.create(),l.fromInteger(c[0]),a[1][2]+ +g),m=l.pow(l.create(),l.fromInteger(c[1]),a[1][1]+ +k),q=l.pow(l.create(),l.fromInteger(c[1]),a[1][0]+ +h);l.mul(d,d,f);l.mul(d,d,m);l.mul(d,d,q);l.add(b,b,d)}}else alert("unsupported dimension "+d);return b},derivatives:function(b){return[]},forEachNonZeroElement:function(b,
a){for(var c=b.slice(),d=0;"object"===typeof c[0];)c=c[0].slice(),d++;for(var g=d+1;0<g;--g){print(Array(g).join("[0]"));var c=eval("(a"+Array(g).join("[0]")+")"),f;for(f in c)for(var k=d+2;0<k;--k)print(c[f])}return""},str:function(b){var a="",c=new q.iterator,d=c.next(),g=c.next(),c=c.next(),f=u.countDimensions(b);if(0===f)a+=b.toString();else if(1===f)for(var k in b[0]){if(b[0][k]){a?a+=" "+(0>b[0][k]?"-":"+")+" ":0>b[0][k]&&(a+="-");var f=Math.abs(b[0][k]),l=b[1][0]+ +k;if(1!==f||0===l)a+=f;0!==
l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"))}}else if(2===f)for(var m in b[0])for(k in b[0][m]){if(b[0][m][k]){a?a+=" "+(0>b[0][m][k]?"-":"+")+" ":0>b[0][m][k]&&(a+="-");var f=Math.abs(b[0][m][k]),l=b[1][1]+ +k,h=b[1][0]+ +m;if(1!==f||0===h&&0===l)a+=f;0!==l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==h&&(a+=g+(1===h?"":"<sup>"+h+"</sup>"))}}else if(3===f)for(var r in b[0])for(m in b[0][r])for(k in b[0][r][m]){if(b[0][r][m][k]){a?a+=" "+(0>b[0][r][m][k]?"-":"+")+" ":0>b[0][r][m][k]&&(a+="-");var f=Math.abs(b[0][r][m][k]),
l=b[1][2]+ +k,h=b[1][1]+ +m,p=b[1][0]+ +r;if(1!==f||0===p&&0===h&&0===l)a+=f;0!==l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==h&&(a+=g+(1===h?"":"<sup>"+h+"</sup>"));0!==p&&(a+=c+(1===p?"":"<sup>"+p+"</sup>"))}}else alert("unsupported dimension "+f);""===a&&(a="0");return a},getJSFormula:function(b){var a="",c=u.countDimensions(b);if(0===c)return"0";if(1===c)for(var d in b[0])b[0][d]&&(a&&(a+="+"),a+=b[0][d],c=b[1][0]+ +d,0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var g in b[0])for(d in b[0][g]){if(b[0][g][d]){a&&
(a+="+");var a=a+b[0][g][d],c=b[1][1]+ +d,f=b[1][0]+ +g;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==f&&(a=1===f?a+"*m[1]":a+("*Math.pow(m[1],"+f+")"))}}else if(3===c)for(var k in b[0])for(g in b[0][k])for(d in b[0][k][g]){if(b[0][k][g][d]){a&&(a+="+");var a=a+b[0][k][g][d],c=b[1][2]+ +d,f=b[1][1]+ +g,l=b[1][0]+ +k;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==f&&(a=1===f?a+"*m[1]":a+("*Math.pow(m[1],"+f+")"));0!==l&&(a=1===l?a+"*m[2]":a+("*Math.pow(m[2],"+l+")"))}}else alert("unsupported dimension "+
c);""===a&&(a="0");return a}};String.prototype.repeat=function(b){return Array(b+1).join(this)};u.getGLSLFormula=function(b){var a="",c=u.countDimensions(b);if(0===c)return"0.0";if(1===c)for(var d in b[0])b[0][d]&&(a&&(a+="+"),a+=b[0][d]+".0",c=b[1][0]+ +d,0!==c&&(a=1===c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var g in b[0])for(d in b[0][g]){if(b[0][g][d]){a&&(a+="+");var a=a+(b[0][g][d]+".0"),c=b[1][1]+ +d,f=b[1][0]+ +g;0!==c&&(a=1===
c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==f&&(a=1===f?a+"*m_1":1<f?a+"*m_1".repeat(f):a+("*pow(1.0"+"*m_1".repeat(Math.abs(f))+",-1.0)"))}}else alert("unsupported dimension "+c);""===a&&(a="0.0");return a};u.toJSON=function(b){return JSON.stringify(b)};u.fromJSON=function(b){return JSON.parse(b)};u.normalize=function(b,a){return a};u.binary_operation=function(b,a,c,d){b=u.create();var g=u.countDimensions(a),f=u.countDimensions(c);a[1][k]!==c[1][k]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===g&&1===f){for(var k in a[0])b[0][k]="undefined"===typeof c[0][k]?a[0][k]:d(a[0][k],c[0][k]);for(k in c[0])"undefined"===typeof a[0][k]&&(b[0][k]=c[0][k]);for(k in b[0])"undefined"===typeof a[0][k]&&"undefined"===typeof c[0][k]&&(b[0][k]=null)}else alert("unsupported dimension "+g);for(k=g;k--;)b[1][k]=a[1][k];return b};u.add=function(b,a,c){return u.binary_operation(b,a,c,function(b,a){return b+a})};u.subtract=function(b,
a,c){return u.binary_operation(b,a,c,function(b,a){return b-a})};u.sub=u.subtract;u.multiply=function(b,a,c){return b};u.mul=u.multiply;u.divide=function(b,a,c){return b};u.div=u.divide;u.equals=function(b,a){return b[0]===a[0]&&b[1]===a[1]};u.countDimensions=function(b){return"object"===typeof b[0]?u._countDimensions(b[0],1):0};u._countDimensions=function(b,a){return"object"===typeof b[0]?u._countDimensions(b[0],++a):a};u.ZERO=u.fromValues([0]);u.IDENTITY=u.fromValues([1]);u.ONE=u.IDENTITY;"undefined"!==
typeof b&&(b.polyrat=u)})(h)})(this);(function(b){"function"===typeof define&&define.amd?define(["jquery"],function(h){return b(h,window,document)}):"object"===typeof exports?module.exports=function(h,c){h||(h=window);c||(c="undefined"!==typeof window?require("jquery"):require("jquery")(h));return b(c,h,h.document)}:b(jQuery,window,document)})(function(b,h,c,d){function a(c){var e,d,n={};b.each(c,function(b){(e=b.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(e[1]+" ")&&(d=b.replace(e[0],e[2].toLowerCase()),
n[d]=b,"o"===e[1]&&a(c[b]))});c._hungarianMap=n}function k(c,e,n){c._hungarianMap||a(c);var g;b.each(e,function(a){g=c._hungarianMap[a];g===d||!n&&e[g]!==d||("o"===g.charAt(0)?(e[g]||(e[g]={}),b.extend(!0,e[g],e[a]),k(c[g],e[g],n)):e[g]=e[a])})}function m(b){var a=C.defaults.oLanguage,c=b.sZeroRecords;!b.sEmptyTable&&c&&"No data available in table"===a.sEmptyTable&&la(b,b,"sZeroRecords","sEmptyTable");!b.sLoadingRecords&&c&&"Loading..."===a.sLoadingRecords&&la(b,b,"sZeroRecords","sLoadingRecords");
b.sInfoThousands&&(b.sThousands=b.sInfoThousands);(b=b.sDecimal)&&fb(b)}function f(b){ha(b,"ordering","bSort");ha(b,"orderMulti","bSortMulti");ha(b,"orderClasses","bSortClasses");ha(b,"orderCellsTop","bSortCellsTop");ha(b,"order","aaSorting");ha(b,"orderFixed","aaSortingFixed");ha(b,"paging","bPaginate");ha(b,"pagingType","sPaginationType");ha(b,"pageLength","iDisplayLength");ha(b,"searching","bFilter");"boolean"===typeof b.sScrollX&&(b.sScrollX=b.sScrollX?"100%":"");"boolean"===typeof b.scrollX&&
(b.scrollX=b.scrollX?"100%":"");if(b=b.aoSearchCols)for(var a=0,c=b.length;a<c;a++)b[a]&&k(C.models.oSearch,b[a])}function g(a){ha(a,"orderable","bSortable");ha(a,"orderData","aDataSort");ha(a,"orderSequence","asSorting");ha(a,"orderDataType","sortDataType");var c=a.aDataSort;c&&!b.isArray(c)&&(a.aDataSort=[c])}function r(a){if(!C.__browser){var c={};C.__browser=c;var e=b("<div/>").css({position:"fixed",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(b("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(b("<div/>").css({width:"100%",height:10}))).appendTo("body"),d=e.children(),n=d.children();c.barWidth=d[0].offsetWidth-d[0].clientWidth;c.bScrollOversize=100===n[0].offsetWidth&&100!==d[0].clientWidth;c.bScrollbarLeft=1!==Math.round(n.offset().left);c.bBounding=e[0].getBoundingClientRect().width?!0:!1;e.remove()}b.extend(a.oBrowser,C.__browser);a.oScroll.iBarWidth=C.__browser.barWidth}function p(b,a,c,e,n,g){var f,k=!1;for(c!==d&&(f=c,k=!0);e!==n;)b.hasOwnProperty(e)&&
(f=k?a(f,b[e],e,b):b[e],k=!0,e+=g);return f}function l(a,e){var d=C.defaults.column,n=a.aoColumns.length,d=b.extend({},C.models.oColumn,d,{nTh:e?e:c.createElement("th"),sTitle:d.sTitle?d.sTitle:e?e.innerHTML:"",aDataSort:d.aDataSort?d.aDataSort:[n],mData:d.mData?d.mData:n,idx:n});a.aoColumns.push(d);d=a.aoPreSearchCols;d[n]=b.extend({},C.models.oSearch,d[n]);t(a,n,b(e).data())}function t(a,c,e){c=a.aoColumns[c];var n=a.oClasses,f=b(c.nTh);if(!c.sWidthOrig){c.sWidthOrig=f.attr("width")||null;var l=
(f.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);l&&(c.sWidthOrig=l[1])}e!==d&&null!==e&&(g(e),k(C.defaults.column,e),e.mDataProp!==d&&!e.mData&&(e.mData=e.mDataProp),e.sType&&(c._sManualType=e.sType),e.className&&!e.sClass&&(e.sClass=e.className),b.extend(c,e),la(c,e,"sWidth","sWidthOrig"),e.iDataSort!==d&&(c.aDataSort=[e.iDataSort]),la(c,e,"aDataSort"));var v=c.mData,m=F(v),h=c.mRender?F(c.mRender):null;e=function(b){return"string"===typeof b&&-1!==b.indexOf("@")};c._bAttrSrc=b.isPlainObject(v)&&
(e(v.sort)||e(v.type)||e(v.filter));c.fnGetData=function(b,a,c){var e=m(b,a,d,c);return h&&a?h(e,a,b,c):e};c.fnSetData=function(b,a,c){return A(v)(b,a,c)};"number"!==typeof v&&(a._rowReadObject=!0);a.oFeatures.bSort||(c.bSortable=!1,f.addClass(n.sSortableNone));a=-1!==b.inArray("asc",c.asSorting);e=-1!==b.inArray("desc",c.asSorting);c.bSortable&&(a||e)?a&&!e?(c.sSortingClass=n.sSortableAsc,c.sSortingClassJUI=n.sSortJUIAscAllowed):!a&&e?(c.sSortingClass=n.sSortableDesc,c.sSortingClassJUI=n.sSortJUIDescAllowed):
(c.sSortingClass=n.sSortable,c.sSortingClassJUI=n.sSortJUI):(c.sSortingClass=n.sSortableNone,c.sSortingClassJUI="")}function q(b){if(!1!==b.oFeatures.bAutoWidth){var a=b.aoColumns;Qa(b);for(var c=0,e=a.length;c<e;c++)a[c].nTh.style.width=a[c].sWidth}a=b.oScroll;""===a.sY&&""===a.sX||wa(b);X(b,null,"column-sizing",[b])}function u(b,a){var c=y(b,"bVisible");return"number"===typeof c[a]?c[a]:null}function e(a,c){var e=y(a,"bVisible"),e=b.inArray(c,e);return-1!==e?e:null}function B(b){return y(b,"bVisible").length}
function y(a,c){var e=[];b.map(a.aoColumns,function(b,a){b[c]&&e.push(a)});return e}function G(b){var a=b.aoColumns,c=b.aoData,e=C.ext.type.detect,n,g,f,k,l,v,m,h,x;n=0;for(g=a.length;n<g;n++)if(m=a[n],x=[],!m.sType&&m._sManualType)m.sType=m._sManualType;else if(!m.sType){f=0;for(k=e.length;f<k;f++){l=0;for(v=c.length;l<v;l++){x[l]===d&&(x[l]=E(b,l,n,"type"));h=e[f](x[l],b);if(!h&&f!==e.length-1)break;if("html"===h)break}if(h){m.sType=h;break}}m.sType||(m.sType="string")}}function L(a,c,e,n){var g,
f,k,v,m,h,x=a.aoColumns;if(c)for(g=c.length-1;0<=g;g--){h=c[g];var q=h.targets!==d?h.targets:h.aTargets;b.isArray(q)||(q=[q]);f=0;for(k=q.length;f<k;f++)if("number"===typeof q[f]&&0<=q[f]){for(;x.length<=q[f];)l(a);n(q[f],h)}else if("number"===typeof q[f]&&0>q[f])n(x.length+q[f],h);else if("string"===typeof q[f])for(v=0,m=x.length;v<m;v++)("_all"==q[f]||b(x[v].nTh).hasClass(q[f]))&&n(v,h)}if(e)for(g=0,a=e.length;g<a;g++)n(g,e[g])}function z(a,c,e,n){var g=a.aoData.length,f=b.extend(!0,{},C.models.oRow,
{src:e?"dom":"data",idx:g});f._aData=c;a.aoData.push(f);for(var k=a.aoColumns,l=0,v=k.length;l<v;l++)k[l].sType=null;a.aiDisplayMaster.push(g);c=a.rowIdFn(c);c!==d&&(a.aIds[c]=f);!e&&a.oFeatures.bDeferRender||H(a,g,e,n);return g}function M(a,c){var e;c instanceof b||(c=b(c));return c.map(function(b,c){e=Q(a,c);return z(a,e.data,c,e.cells)})}function E(b,a,c,e){var n=b.iDraw,g=b.aoColumns[c],f=b.aoData[a]._aData,k=g.sDefaultContent,l=g.fnGetData(f,e,{settings:b,row:a,col:c});if(l===d)return b.iDrawError!=
n&&null===k&&(oa(b,0,"Requested unknown parameter "+("function"==typeof g.mData?"{function}":"'"+g.mData+"'")+" for row "+a+", column "+c,4),b.iDrawError=n),k;if((l===f||null===l)&&null!==k)l=k;else if("function"===typeof l)return l.call(f);return null===l&&"display"==e?"":l}function I(b,a,c,e){b.aoColumns[c].fnSetData(b.aoData[a]._aData,e,{settings:b,row:a,col:c})}function S(a){return b.map(a.match(/(\\.|[^\.])+/g)||[""],function(b){return b.replace(/\\./g,".")})}function F(a){if(b.isPlainObject(a)){var c=
{};b.each(a,function(b,a){a&&(c[b]=F(a))});return function(b,a,e,n){var g=c[a]||c._;return g!==d?g(b,a,e,n):b}}if(null===a)return function(b){return b};if("function"===typeof a)return function(b,c,e,d){return a(b,c,e,d)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var e=function(a,c,n){var g,f;if(""!==n){f=S(n);for(var Y=0,k=f.length;Y<k;Y++){n=f[Y].match(xa);g=f[Y].match(sa);if(n){f[Y]=f[Y].replace(xa,"");""!==f[Y]&&(a=a[f[Y]]);g=[];f.splice(0,Y+1);f=
f.join(".");if(b.isArray(a))for(Y=0,k=a.length;Y<k;Y++)g.push(e(a[Y],c,f));a=n[0].substring(1,n[0].length-1);a=""===a?g:g.join(a);break}else if(g){f[Y]=f[Y].replace(sa,"");a=a[f[Y]]();continue}if(null===a||a[f[Y]]===d)return d;a=a[f[Y]]}}return a};return function(b,c){return e(b,c,a)}}return function(b){return b[a]}}function A(a){if(b.isPlainObject(a))return A(a._);if(null===a)return function(){};if("function"===typeof a)return function(b,c,e){a(b,"set",c,e)};if("string"===typeof a&&(-1!==a.indexOf(".")||
-1!==a.indexOf("[")||-1!==a.indexOf("("))){var c=function(a,e,n){n=S(n);var g;g=n[n.length-1];for(var f,Y,k=0,l=n.length-1;k<l;k++){f=n[k].match(xa);Y=n[k].match(sa);if(f){n[k]=n[k].replace(xa,"");a[n[k]]=[];g=n.slice();g.splice(0,k+1);f=g.join(".");if(b.isArray(e))for(Y=0,l=e.length;Y<l;Y++)g={},c(g,e[Y],f),a[n[k]].push(g);else a[n[k]]=e;return}Y&&(n[k]=n[k].replace(sa,""),a=a[n[k]](e));if(null===a[n[k]]||a[n[k]]===d)a[n[k]]={};a=a[n[k]]}if(g.match(sa))a[g.replace(sa,"")](e);else a[g.replace(xa,
"")]=e};return function(b,e){return c(b,e,a)}}return function(b,c){b[a]=c}}function J(b){return ka(b.aoData,"_aData")}function K(b){b.aoData.length=0;b.aiDisplayMaster.length=0;b.aiDisplay.length=0;b.aIds={}}function w(b,a,c){for(var e=-1,n=0,g=b.length;n<g;n++)b[n]==a?e=n:b[n]>a&&b[n]--; -1!=e&&c===d&&b.splice(e,1)}function O(b,a,c,e){var n=b.aoData[a],g,f=function(c,e){for(;c.childNodes.length;)c.removeChild(c.firstChild);c.innerHTML=E(b,a,e,"display")};if("dom"!==c&&(c&&"auto"!==c||"dom"!==n.src)){var k=
n.anCells;if(k)if(e!==d)f(k[e],e);else for(c=0,g=k.length;c<g;c++)f(k[c],c)}else n._aData=Q(b,n,e,e===d?d:n._aData).data;n._aSortData=null;n._aFilterData=null;f=b.aoColumns;if(e!==d)f[e].sType=null;else{c=0;for(g=f.length;c<g;c++)f[c].sType=null;U(b,n)}}function Q(a,c,e,n){var g=[],f=c.firstChild,k,l,v=0,m,h=a.aoColumns,x=a._rowReadObject;n=n!==d?n:x?{}:[];var q=function(b,a){if("string"===typeof b){var c=b.indexOf("@");-1!==c&&(c=b.substring(c+1),A(b)(n,a.getAttribute(c)))}},u=function(a){if(e===
d||e===v)l=h[v],m=b.trim(a.innerHTML),l&&l._bAttrSrc?(A(l.mData._)(n,m),q(l.mData.sort,a),q(l.mData.type,a),q(l.mData.filter,a)):x?(l._setter||(l._setter=A(l.mData)),l._setter(n,m)):n[v]=m;v++};if(f)for(;f;){k=f.nodeName.toUpperCase();if("TD"==k||"TH"==k)u(f),g.push(f);f=f.nextSibling}else for(g=c.anCells,f=0,k=g.length;f<k;f++)u(g[f]);(c=c.firstChild?c:c.nTr)&&(c=c.getAttribute("id"))&&A(a.rowId)(n,c);return{data:n,cells:g}}function H(b,a,e,n){var g=b.aoData[a],d=g._aData,f=[],k,l,v,m,h;if(null===
g.nTr){k=e||c.createElement("tr");g.nTr=k;g.anCells=f;k._DT_RowIndex=a;U(b,g);m=0;for(h=b.aoColumns.length;m<h;m++){v=b.aoColumns[m];l=e?n[m]:c.createElement(v.sCellType);l._DT_CellIndex={row:a,column:m};f.push(l);if(!e||v.mRender||v.mData!==m)l.innerHTML=E(b,a,m,"display");v.sClass&&(l.className+=" "+v.sClass);v.bVisible&&!e?k.appendChild(l):!v.bVisible&&e&&l.parentNode.removeChild(l);v.fnCreatedCell&&v.fnCreatedCell.call(b.oInstance,l,E(b,a,m),d,a,m)}X(b,"aoRowCreatedCallback",null,[k,d,a])}g.nTr.setAttribute("role",
"row")}function U(a,c){var e=c.nTr,n=c._aData;if(e){var g=a.rowIdFn(n);g&&(e.id=g);n.DT_RowClass&&(g=n.DT_RowClass.split(" "),c.__rowc=c.__rowc?Ba(c.__rowc.concat(g)):g,b(e).removeClass(c.__rowc.join(" ")).addClass(n.DT_RowClass));n.DT_RowAttr&&b(e).attr(n.DT_RowAttr);n.DT_RowData&&b(e).data(n.DT_RowData)}}function ca(a){var c,e,n,g,d,f=a.nTHead,k=a.nTFoot,l=0===b("th, td",f).length,v=a.oClasses,m=a.aoColumns;l&&(g=b("<tr/>").appendTo(f));c=0;for(e=m.length;c<e;c++)d=m[c],n=b(d.nTh).addClass(d.sClass),
l&&n.appendTo(g),a.oFeatures.bSort&&(n.addClass(d.sSortingClass),!1!==d.bSortable&&(n.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Ra(a,d.nTh,c))),d.sTitle!=n[0].innerHTML&&n.html(d.sTitle),Sa(a,"header")(a,n,d,v);l&&x(a.aoHeader,f);b(f).find(">tr").attr("role","row");b(f).find(">tr>th, >tr>td").addClass(v.sHeaderTH);b(k).find(">tr>th, >tr>td").addClass(v.sFooterTH);if(null!==k)for(a=a.aoFooter[0],c=0,e=a.length;c<e;c++)d=m[c],d.nTf=a[c].cell,d.sClass&&b(d.nTf).addClass(d.sClass)}
function R(a,c,e){var n,g,f,k=[],l=[],v=a.aoColumns.length,m;if(c){e===d&&(e=!1);n=0;for(g=c.length;n<g;n++){k[n]=c[n].slice();k[n].nTr=c[n].nTr;for(f=v-1;0<=f;f--)a.aoColumns[f].bVisible||e||k[n].splice(f,1);l.push([])}n=0;for(g=k.length;n<g;n++){if(a=k[n].nTr)for(;f=a.firstChild;)a.removeChild(f);f=0;for(c=k[n].length;f<c;f++)if(m=v=1,l[n][f]===d){a.appendChild(k[n][f].cell);for(l[n][f]=1;k[n+v]!==d&&k[n][f].cell==k[n+v][f].cell;)l[n+v][f]=1,v++;for(;k[n][f+m]!==d&&k[n][f].cell==k[n][f+m].cell;){for(e=
0;e<v;e++)l[n+e][f+m]=1;m++}b(k[n][f].cell).attr("rowspan",v).attr("colspan",m)}}}}function D(a){var c=X(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==b.inArray(!1,c))ja(a,!1);else{var c=[],e=0,n=a.asStripeClasses,g=n.length,f=a.oLanguage,k=a.iInitDisplayStart,l="ssp"==ea(a),v=a.aiDisplay;a.bDrawing=!0;k!==d&&-1!==k&&(a._iDisplayStart=l?k:k>=a.fnRecordsDisplay()?0:k,a.iInitDisplayStart=-1);var k=a._iDisplayStart,m=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,ja(a,!1);else if(l){if(!a.bDestroying&&
!V(a))return}else a.iDraw++;if(0!==v.length)for(f=l?a.aoData.length:m,l=l?0:k;l<f;l++){var h=v[l],x=a.aoData[h];null===x.nTr&&H(a,h);h=x.nTr;if(0!==g){var q=n[e%g];x._sRowStripe!=q&&(b(h).removeClass(x._sRowStripe).addClass(q),x._sRowStripe=q)}X(a,"aoRowCallback",null,[h,x._aData,e,l]);c.push(h);e++}else e=f.sZeroRecords,1==a.iDraw&&"ajax"==ea(a)?e=f.sLoadingRecords:f.sEmptyTable&&0===a.fnRecordsTotal()&&(e=f.sEmptyTable),c[0]=b("<tr/>",{"class":g?n[0]:""}).append(b("<td />",{valign:"top",colSpan:B(a),
"class":a.oClasses.sRowEmpty}).html(e))[0];X(a,"aoHeaderCallback","header",[b(a.nTHead).children("tr")[0],J(a),k,m,v]);X(a,"aoFooterCallback","footer",[b(a.nTFoot).children("tr")[0],J(a),k,m,v]);n=b(a.nTBody);n.children().detach();n.append(b(c));X(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function n(b,a){var c=b.oFeatures,e=c.bFilter;c.bSort&&gb(b);e?qa(b,b.oPreviousSearch):b.aiDisplay=b.aiDisplayMaster.slice();!0!==a&&(b._iDisplayStart=0);b._drawHold=a;D(b);b._drawHold=
!1}function v(a){var c=a.oClasses,e=b(a.nTable),e=b("<div/>").insertBefore(e),n=a.oFeatures,g=b("<div/>",{id:a.sTableId+"_wrapper","class":c.sWrapper+(a.nTFoot?"":" "+c.sNoFooter)});a.nHolding=e[0];a.nTableWrapper=g[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var f=a.sDom.split(""),d,k,l,v,m,h,x=0;x<f.length;x++){d=null;k=f[x];if("<"==k){l=b("<div/>")[0];v=f[x+1];if("'"==v||'"'==v){m="";for(h=2;f[x+h]!=v;)m+=f[x+h],h++;"H"==m?m=c.sJUIHeader:"F"==m&&(m=c.sJUIFooter);-1!=m.indexOf(".")?(v=m.split("."),
l.id=v[0].substr(1,v[0].length-1),l.className=v[1]):"#"==m.charAt(0)?l.id=m.substr(1,m.length-1):l.className=m;x+=h}g.append(l);g=b(l)}else if(">"==k)g=g.parent();else if("l"==k&&n.bPaginate&&n.bLengthChange)d=hb(a);else if("f"==k&&n.bFilter)d=Ca(a);else if("r"==k&&n.bProcessing)d=ib(a);else if("t"==k)d=jb(a);else if("i"==k&&n.bInfo)d=kb(a);else if("p"==k&&n.bPaginate)d=lb(a);else if(0!==C.ext.feature.length)for(l=C.ext.feature,h=0,v=l.length;h<v;h++)if(k==l[h].cFeature){d=l[h].fnInit(a);break}d&&
(l=a.aanFeatures,l[k]||(l[k]=[]),l[k].push(d),g.append(d))}e.replaceWith(g);a.nHolding=null}function x(a,c){var e=b(c).children("tr"),n,g,f,d,k,l,v,m,h,x;a.splice(0,a.length);f=0;for(l=e.length;f<l;f++)a.push([]);f=0;for(l=e.length;f<l;f++)for(n=e[f],g=n.firstChild;g;){if("TD"==g.nodeName.toUpperCase()||"TH"==g.nodeName.toUpperCase()){m=1*g.getAttribute("colspan");h=1*g.getAttribute("rowspan");m=m&&0!==m&&1!==m?m:1;h=h&&0!==h&&1!==h?h:1;d=0;for(k=a[f];k[d];)d++;v=d;x=1===m?!0:!1;for(k=0;k<m;k++)for(d=
0;d<h;d++)a[f+d][v+k]={cell:g,unique:x},a[f+d].nTr=n}g=g.nextSibling}}function W(b,a,c){var e=[];c||(c=b.aoHeader,a&&(c=[],x(c,a)));a=0;for(var n=c.length;a<n;a++)for(var g=0,f=c[a].length;g<f;g++)!c[a][g].unique||e[g]&&b.bSortCellsTop||(e[g]=c[a][g].cell);return e}function P(a,c,e){X(a,"aoServerParams","serverParams",[c]);if(c&&b.isArray(c)){var n={},g=/(.*?)\[\]$/;b.each(c,function(b,a){var c=a.name.match(g);c?(c=c[0],n[c]||(n[c]=[]),n[c].push(a.value)):n[a.name]=a.value});c=n}var f,d=a.ajax,k=
a.oInstance,l=function(b){X(a,null,"xhr",[a,b,a.jqXHR]);e(b)};if(b.isPlainObject(d)&&d.data){f=d.data;var v=b.isFunction(f)?f(c,a):f;c=b.isFunction(f)&&v?v:b.extend(!0,c,v);delete d.data}v={data:c,success:function(b){var c=b.error||b.sError;c&&oa(a,0,c);a.json=b;l(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(c,e){var n=X(a,null,"xhr",[a,null,a.jqXHR]);-1===b.inArray(!0,n)&&("parsererror"==e?oa(a,0,"Invalid JSON response",1):4===c.readyState&&oa(a,0,"Ajax error",7));ja(a,!1)}};
a.oAjaxData=c;X(a,null,"preXhr",[a,c]);a.fnServerData?a.fnServerData.call(k,a.sAjaxSource,b.map(c,function(b,a){return{name:a,value:b}}),l,a):a.sAjaxSource||"string"===typeof d?a.jqXHR=b.ajax(b.extend(v,{url:d||a.sAjaxSource})):b.isFunction(d)?a.jqXHR=d.call(k,c,l,a):(a.jqXHR=b.ajax(b.extend(v,d)),d.data=f)}function V(b){return b.bAjaxDataGet?(b.iDraw++,ja(b,!0),P(b,ia(b),function(a){ra(b,a)}),!1):!0}function ia(a){var c=a.aoColumns,e=c.length,n=a.oFeatures,g=a.oPreviousSearch,f=a.aoPreSearchCols,
d,k=[],l,v,m,h=ta(a);d=a._iDisplayStart;l=!1!==n.bPaginate?a._iDisplayLength:-1;var x=function(b,a){k.push({name:b,value:a})};x("sEcho",a.iDraw);x("iColumns",e);x("sColumns",ka(c,"sName").join(","));x("iDisplayStart",d);x("iDisplayLength",l);var q={draw:a.iDraw,columns:[],order:[],start:d,length:l,search:{value:g.sSearch,regex:g.bRegex}};for(d=0;d<e;d++)v=c[d],m=f[d],l="function"==typeof v.mData?"function":v.mData,q.columns.push({data:l,name:v.sName,searchable:v.bSearchable,orderable:v.bSortable,
search:{value:m.sSearch,regex:m.bRegex}}),x("mDataProp_"+d,l),n.bFilter&&(x("sSearch_"+d,m.sSearch),x("bRegex_"+d,m.bRegex),x("bSearchable_"+d,v.bSearchable)),n.bSort&&x("bSortable_"+d,v.bSortable);n.bFilter&&(x("sSearch",g.sSearch),x("bRegex",g.bRegex));n.bSort&&(b.each(h,function(b,a){q.order.push({column:a.col,dir:a.dir});x("iSortCol_"+b,a.col);x("sSortDir_"+b,a.dir)}),x("iSortingCols",h.length));c=C.ext.legacy.ajax;return null===c?a.sAjaxSource?k:q:c?k:q}function ra(b,a){var c=ua(b,a),e=a.sEcho!==
d?a.sEcho:a.draw,n=a.iTotalRecords!==d?a.iTotalRecords:a.recordsTotal,g=a.iTotalDisplayRecords!==d?a.iTotalDisplayRecords:a.recordsFiltered;if(e){if(1*e<b.iDraw)return;b.iDraw=1*e}K(b);b._iRecordsTotal=parseInt(n,10);b._iRecordsDisplay=parseInt(g,10);e=0;for(n=c.length;e<n;e++)z(b,c[e]);b.aiDisplay=b.aiDisplayMaster.slice();b.bAjaxDataGet=!1;D(b);b._bInitComplete||Da(b,a);b.bAjaxDataGet=!0;ja(b,!1)}function ua(a,c){var e=b.isPlainObject(a.ajax)&&a.ajax.dataSrc!==d?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===
e?c.aaData||c[e]:""!==e?F(e)(c):c}function Ca(a){var e=a.oClasses,n=a.sTableId,g=a.oLanguage,d=a.oPreviousSearch,f=a.aanFeatures,k='<input type="search" class="'+e.sFilterInput+'"/>',l=g.sSearch,l=l.match(/_INPUT_/)?l.replace("_INPUT_",k):l+k,e=b("<div/>",{id:f.f?null:n+"_filter","class":e.sFilter}).append(b("<label/>").append(l)),f=function(){var b=this.value?this.value:"";b!=d.sSearch&&(qa(a,{sSearch:b,bRegex:d.bRegex,bSmart:d.bSmart,bCaseInsensitive:d.bCaseInsensitive}),a._iDisplayStart=0,D(a))},
k=null!==a.searchDelay?a.searchDelay:"ssp"===ea(a)?400:0,v=b("input",e).val(d.sSearch).attr("placeholder",g.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",k?Ea(f,k):f).bind("keypress.DT",function(b){if(13==b.keyCode)return!1}).attr("aria-controls",n);b(a.nTable).on("search.dt.DT",function(b,e){if(a===e)try{v[0]!==c.activeElement&&v.val(d.sSearch)}catch(n){}});return e[0]}function qa(b,a,c){var e=b.oPreviousSearch,n=b.aoPreSearchCols,g=function(b){e.sSearch=b.sSearch;e.bRegex=
b.bRegex;e.bSmart=b.bSmart;e.bCaseInsensitive=b.bCaseInsensitive};G(b);if("ssp"!=ea(b)){mb(b,a.sSearch,c,a.bEscapeRegex!==d?!a.bEscapeRegex:a.bRegex,a.bSmart,a.bCaseInsensitive);g(a);for(a=0;a<n.length;a++)nb(b,n[a].sSearch,a,n[a].bEscapeRegex!==d?!n[a].bEscapeRegex:n[a].bRegex,n[a].bSmart,n[a].bCaseInsensitive);Fa(b)}else g(a);b.bFiltered=!0;X(b,null,"search",[b])}function Fa(a){for(var c=C.ext.search,e=a.aiDisplay,n,g,d=0,f=c.length;d<f;d++){for(var k=[],l=0,v=e.length;l<v;l++)g=e[l],n=a.aoData[g],
c[d](a,n._aFilterData,g,n._aData,l)&&k.push(g);e.length=0;b.merge(e,k)}}function nb(b,a,c,e,n,g){if(""!==a){var d=b.aiDisplay;e=Ta(a,e,n,g);for(n=d.length-1;0<=n;n--)a=b.aoData[d[n]]._aFilterData[c],e.test(a)||d.splice(n,1)}}function mb(b,a,c,e,n,g){e=Ta(a,e,n,g);n=b.oPreviousSearch.sSearch;g=b.aiDisplayMaster;var d;0!==C.ext.search.length&&(c=!0);d=ob(b);if(0>=a.length)b.aiDisplay=g.slice();else{if(d||c||n.length>a.length||0!==a.indexOf(n)||b.bSorted)b.aiDisplay=g.slice();a=b.aiDisplay;for(c=a.length-
1;0<=c;c--)e.test(b.aoData[a[c]]._sFilterRow)||a.splice(c,1)}}function Ta(a,c,e,n){a=c?a:Ga(a);e&&(a="^(?=.*?"+b.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(b){if('"'===b.charAt(0)){var a=b.match(/^"(.*)"$/);b=a?a[1]:b}return b.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(a,n?"i":"")}function Ga(b){return b.replace(Mb,"\\$1")}function ob(b){var a=b.aoColumns,c,e,n,g,d,f,k,l,v=C.ext.type.search;c=!1;e=0;for(g=b.aoData.length;e<g;e++)if(l=b.aoData[e],!l._aFilterData){f=[];n=0;for(d=a.length;n<
d;n++)c=a[n],c.bSearchable?(k=E(b,e,n,"filter"),v[c.sType]&&(k=v[c.sType](k)),null===k&&(k=""),"string"!==typeof k&&k.toString&&(k=k.toString())):k="",k.indexOf&&-1!==k.indexOf("&")&&(Ha.innerHTML=k,k=Nb?Ha.textContent:Ha.innerText),k.replace&&(k=k.replace(/[\r\n]/g,"")),f.push(k);l._aFilterData=f;l._sFilterRow=f.join("  ");c=!0}return c}function pb(b){return{search:b.sSearch,smart:b.bSmart,regex:b.bRegex,caseInsensitive:b.bCaseInsensitive}}function qb(b){return{sSearch:b.search,bSmart:b.smart,bRegex:b.regex,
bCaseInsensitive:b.caseInsensitive}}function kb(a){var c=a.sTableId,e=a.aanFeatures.i,n=b("<div/>",{"class":a.oClasses.sInfo,id:e?null:c+"_info"});e||(a.aoDrawCallback.push({fn:rb,sName:"information"}),n.attr("role","status").attr("aria-live","polite"),b(a.nTable).attr("aria-describedby",c+"_info"));return n[0]}function rb(a){var c=a.aanFeatures.i;if(0!==c.length){var e=a.oLanguage,n=a._iDisplayStart+1,g=a.fnDisplayEnd(),d=a.fnRecordsTotal(),f=a.fnRecordsDisplay(),k=f?e.sInfo:e.sInfoEmpty;f!==d&&
(k+=" "+e.sInfoFiltered);k+=e.sInfoPostFix;k=sb(a,k);e=e.fnInfoCallback;null!==e&&(k=e.call(a.oInstance,a,n,g,d,f,k));b(c).html(k)}}function sb(b,a){var c=b.fnFormatNumber,e=b._iDisplayStart+1,n=b._iDisplayLength,g=b.fnRecordsDisplay(),d=-1===n;return a.replace(/_START_/g,c.call(b,e)).replace(/_END_/g,c.call(b,b.fnDisplayEnd())).replace(/_MAX_/g,c.call(b,b.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(b,g)).replace(/_PAGE_/g,c.call(b,d?1:Math.ceil(e/n))).replace(/_PAGES_/g,c.call(b,d?1:Math.ceil(g/
n)))}function ya(b){var a,c,e=b.iInitDisplayStart,g=b.aoColumns,d;c=b.oFeatures;var f=b.bDeferLoading;if(b.bInitialised){v(b);ca(b);R(b,b.aoHeader);R(b,b.aoFooter);ja(b,!0);c.bAutoWidth&&Qa(b);a=0;for(c=g.length;a<c;a++)d=g[a],d.sWidth&&(d.nTh.style.width=aa(d.sWidth));X(b,null,"preInit",[b]);n(b);g=ea(b);if("ssp"!=g||f)"ajax"==g?P(b,[],function(c){var g=ua(b,c);for(a=0;a<g.length;a++)z(b,g[a]);b.iInitDisplayStart=e;n(b);ja(b,!1);Da(b,c)},b):(ja(b,!1),Da(b))}else setTimeout(function(){ya(b)},200)}
function Da(b,a){b._bInitComplete=!0;(a||b.oInit.aaData)&&q(b);X(b,null,"plugin-init",[b,a]);X(b,"aoInitComplete","init",[b,a])}function Ua(b,a){var c=parseInt(a,10);b._iDisplayLength=c;Va(b);X(b,null,"length",[b,c])}function hb(a){for(var c=a.oClasses,e=a.sTableId,n=a.aLengthMenu,g=b.isArray(n[0]),d=g?n[0]:n,n=g?n[1]:n,g=b("<select/>",{name:e+"_length","aria-controls":e,"class":c.sLengthSelect}),f=0,k=d.length;f<k;f++)g[0][f]=new Option(n[f],d[f]);var l=b("<div><label/></div>").addClass(c.sLength);
a.aanFeatures.l||(l[0].id=e+"_length");l.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",g[0].outerHTML));b("select",l).val(a._iDisplayLength).bind("change.DT",function(){Ua(a,b(this).val());D(a)});b(a.nTable).bind("length.dt.DT",function(c,e,n){a===e&&b("select",l).val(n)});return l[0]}function lb(a){var c=a.sPaginationType,e=C.ext.pager[c],n="function"===typeof e,g=function(b){D(b)},c=b("<div/>").addClass(a.oClasses.sPaging+c)[0],d=a.aanFeatures;n||e.fnInit(a,c,g);d.p||(c.id=a.sTableId+
"_paginate",a.aoDrawCallback.push({fn:function(b){if(n){var a=b._iDisplayStart,c=b._iDisplayLength,f=b.fnRecordsDisplay(),k=-1===c,a=k?0:Math.ceil(a/c),c=k?1:Math.ceil(f/c),f=e(a,c),l,k=0;for(l=d.p.length;k<l;k++)Sa(b,"pageButton")(b,d.p[k],k,f,a,c)}else e.fnUpdate(b,g)},sName:"pagination"}));return c}function Wa(b,a,c){var e=b._iDisplayStart,n=b._iDisplayLength,g=b.fnRecordsDisplay();0===g||-1===n?e=0:"number"===typeof a?(e=a*n,e>g&&(e=0)):"first"==a?e=0:"previous"==a?(e=0<=n?e-n:0,0>e&&(e=0)):"next"==
a?e+n<g&&(e+=n):"last"==a?e=Math.floor((g-1)/n)*n:oa(b,0,"Unknown paging action: "+a,5);a=b._iDisplayStart!==e;b._iDisplayStart=e;a&&(X(b,null,"page",[b]),c&&D(b));return a}function ib(a){return b("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function ja(a,c){a.oFeatures.bProcessing&&b(a.aanFeatures.r).css("display",c?"block":"none");X(a,null,"processing",[a,c])}function jb(a){var c=b(a.nTable);c.attr("role",
"grid");var e=a.oScroll;if(""===e.sX&&""===e.sY)return a.nTable;var n=e.sX,g=e.sY,d=a.oClasses,f=c.children("caption"),k=f.length?f[0]._captionSide:null,l=b(c[0].cloneNode(!1)),v=b(c[0].cloneNode(!1)),m=c.children("tfoot");m.length||(m=null);l=b("<div/>",{"class":d.sScrollWrapper}).append(b("<div/>",{"class":d.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:n?n?aa(n):null:"100%"}).append(b("<div/>",{"class":d.sScrollHeadInner}).css({"box-sizing":"content-box",width:e.sXInner||
"100%"}).append(l.removeAttr("id").css("margin-left",0).append("top"===k?f:null).append(c.children("thead"))))).append(b("<div/>",{"class":d.sScrollBody}).css({position:"relative",overflow:"auto",width:n?aa(n):null}).append(c));m&&l.append(b("<div/>",{"class":d.sScrollFoot}).css({overflow:"hidden",border:0,width:n?n?aa(n):null:"100%"}).append(b("<div/>",{"class":d.sScrollFootInner}).append(v.removeAttr("id").css("margin-left",0).append("bottom"===k?f:null).append(c.children("tfoot")))));var c=l.children(),
h=c[0],d=c[1],x=m?c[2]:null;if(n)b(d).on("scroll.DT",function(){var b=this.scrollLeft;h.scrollLeft=b;m&&(x.scrollLeft=b)});b(d).css(g&&e.bCollapse?"max-height":"height",g);a.nScrollHead=h;a.nScrollBody=d;a.nScrollFoot=x;a.aoDrawCallback.push({fn:wa,sName:"scrolling"});return l[0]}function wa(a){var c=a.oScroll,e=c.sX,n=c.sXInner,g=c.sY,c=c.iBarWidth,f=b(a.nScrollHead),k=f[0].style,l=f.children("div"),v=l[0].style,m=l.children("table"),l=a.nScrollBody,h=b(l),x=l.style,r=b(a.nScrollFoot).children("div"),
p=r.children("table"),t=b(a.nTHead),P=b(a.nTable),B=P[0],V=B.style,A=a.nTFoot?b(a.nTFoot):null,z=a.oBrowser,w=z.bScrollOversize,I,L,y,ia,J=[],K=[],D=[],ra,U=function(b){b=b.style;b.paddingTop="0";b.paddingBottom="0";b.borderTopWidth="0";b.borderBottomWidth="0";b.height=0};L=l.scrollHeight>l.clientHeight;a.scrollBarVis!==L&&a.scrollBarVis!==d?(a.scrollBarVis=L,q(a)):(a.scrollBarVis=L,P.children("thead, tfoot").remove(),ia=t.clone().prependTo(P),t=t.find("tr"),L=ia.find("tr"),ia.find("th, td").removeAttr("tabindex"),
A&&(y=A.clone().prependTo(P),I=A.find("tr"),y=y.find("tr")),e||(x.width="100%",f[0].style.width="100%"),b.each(W(a,ia),function(b,c){ra=u(a,b);c.style.width=a.aoColumns[ra].sWidth}),A&&na(function(b){b.style.width=""},y),f=P.outerWidth(),""===e?(V.width="100%",w&&(P.find("tbody").height()>l.offsetHeight||"scroll"==h.css("overflow-y"))&&(V.width=aa(P.outerWidth()-c)),f=P.outerWidth()):""!==n&&(V.width=aa(n),f=P.outerWidth()),na(U,L),na(function(a){D.push(a.innerHTML);J.push(aa(b(a).css("width")))},
L),na(function(b,a){b.style.width=J[a]},t),b(L).height(0),A&&(na(U,y),na(function(a){K.push(aa(b(a).css("width")))},y),na(function(b,a){b.style.width=K[a]},I),b(y).height(0)),na(function(b,a){b.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+D[a]+"</div>";b.style.width=J[a]},L),A&&na(function(b,a){b.innerHTML="";b.style.width=K[a]},y),P.outerWidth()<f?(I=l.scrollHeight>l.offsetHeight||"scroll"==h.css("overflow-y")?f+c:f,w&&(l.scrollHeight>l.offsetHeight||"scroll"==h.css("overflow-y"))&&
(V.width=aa(I-c)),""!==e&&""===n||oa(a,1,"Possible column misalignment",6)):I="100%",x.width=aa(I),k.width=aa(I),A&&(a.nScrollFoot.style.width=aa(I)),!g&&w&&(x.height=aa(B.offsetHeight+c)),e=P.outerWidth(),m[0].style.width=aa(e),v.width=aa(e),n=P.height()>l.clientHeight||"scroll"==h.css("overflow-y"),g="padding"+(z.bScrollbarLeft?"Left":"Right"),v[g]=n?c+"px":"0px",A&&(p[0].style.width=aa(e),r[0].style.width=aa(e),r[0].style[g]=n?c+"px":"0px"),h.scroll(),!a.bSorted&&!a.bFiltered||a._drawHold||(l.scrollTop=
0))}function na(b,a,c){for(var e=0,n=0,g=a.length,d,f;n<g;){d=a[n].firstChild;for(f=c?c[n].firstChild:null;d;)1===d.nodeType&&(c?b(d,f,e):b(d,e),e++),d=d.nextSibling,f=c?f.nextSibling:null;n++}}function Qa(a){var c=a.nTable,e=a.aoColumns,n=a.oScroll,g=n.sY,d=n.sX,f=n.sXInner,k=e.length,l=y(a,"bVisible"),v=b("th",a.nTHead),m=c.getAttribute("width"),x=c.parentNode,r=!1,p,t,P=a.oBrowser,n=P.bScrollOversize;(p=c.style.width)&&-1!==p.indexOf("%")&&(m=p);for(p=0;p<l.length;p++)t=e[l[p]],null!==t.sWidth&&
(t.sWidth=tb(t.sWidthOrig,x),r=!0);if(n||!r&&!d&&!g&&k==B(a)&&k==v.length)for(p=0;p<k;p++)l=u(a,p),null!==l&&(e[l].sWidth=aa(v.eq(p).width()));else{k=b(c).clone().css("visibility","hidden").removeAttr("id");k.find("tbody tr").remove();var V=b("<tr/>").appendTo(k.find("tbody"));k.find("thead, tfoot").remove();k.append(b(a.nTHead).clone()).append(b(a.nTFoot).clone());k.find("tfoot th, tfoot td").css("width","");v=W(a,k.find("thead")[0]);for(p=0;p<l.length;p++)t=e[l[p]],v[p].style.width=null!==t.sWidthOrig&&
""!==t.sWidthOrig?aa(t.sWidthOrig):"",t.sWidthOrig&&d&&b(v[p]).append(b("<div/>").css({width:t.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(p=0;p<l.length;p++)r=l[p],t=e[r],b(ub(a,r)).clone(!1).append(t.sContentPadding).appendTo(V);t=b("<div/>").css(d||g?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(k).appendTo(x);d&&f?k.width(f):d?(k.css("width","auto"),k.removeAttr("width"),k.width()<x.clientWidth&&m&&k.width(x.clientWidth)):g?k.width(x.clientWidth):
m&&k.width(m);for(p=g=0;p<l.length;p++)x=b(v[p]),f=x.outerWidth()-x.width(),x=P.bBounding?Math.ceil(v[p].getBoundingClientRect().width):x.outerWidth(),g+=x,e[l[p]].sWidth=aa(x-f);c.style.width=aa(g);t.remove()}m&&(c.style.width=aa(m));!m&&!d||a._reszEvt||(c=function(){b(h).bind("resize.DT-"+a.sInstance,Ea(function(){q(a)}))},n?setTimeout(c,1E3):c(),a._reszEvt=!0)}function Ea(b,a){var c=a!==d?a:200,e,n;return function(){var a=this,g=+new Date,f=arguments;e&&g<e+c?(clearTimeout(n),n=setTimeout(function(){e=
d;b.apply(a,f)},c)):(e=g,b.apply(a,f))}}function tb(a,e){if(!a)return 0;var n=b("<div/>").css("width",aa(a)).appendTo(e||c.body),g=n[0].offsetWidth;n.remove();return g}function ub(a,c){var e=vb(a,c);if(0>e)return null;var n=a.aoData[e];return n.nTr?n.anCells[c]:b("<td/>").html(E(a,e,c,"display"))[0]}function vb(b,a){for(var c,e=-1,n=-1,g=0,d=b.aoData.length;g<d;g++)c=E(b,g,a,"display")+"",c=c.replace(Ob,""),c=c.replace(/&nbsp;/g," "),c.length>e&&(e=c.length,n=g);return n}function aa(b){return null===
b?"0px":"number"==typeof b?0>b?"0px":b+"px":b.match(/\d$/)?b+"px":b}function ta(a){var c,e,n=[],g=a.aoColumns,f,k,l,v;c=a.aaSortingFixed;e=b.isPlainObject(c);var m=[];f=function(a){a.length&&!b.isArray(a[0])?m.push(a):b.merge(m,a)};b.isArray(c)&&f(c);e&&c.pre&&f(c.pre);f(a.aaSorting);e&&c.post&&f(c.post);for(a=0;a<m.length;a++)for(v=m[a][0],f=g[v].aDataSort,c=0,e=f.length;c<e;c++)k=f[c],l=g[k].sType||"string",m[a]._idx===d&&(m[a]._idx=b.inArray(m[a][1],g[k].asSorting)),n.push({src:v,col:k,dir:m[a][1],
index:m[a]._idx,type:l,formatter:C.ext.type.order[l+"-pre"]});return n}function gb(b){var a,c,e=[],n=C.ext.type.order,g=b.aoData,d=0,f,k=b.aiDisplayMaster,l;G(b);l=ta(b);a=0;for(c=l.length;a<c;a++)f=l[a],f.formatter&&d++,wb(b,f.col);if("ssp"!=ea(b)&&0!==l.length){a=0;for(c=k.length;a<c;a++)e[k[a]]=a;d===l.length?k.sort(function(b,a){var c,n,d,f,k=l.length,v=g[b]._aSortData,m=g[a]._aSortData;for(d=0;d<k;d++)if(f=l[d],c=v[f.col],n=m[f.col],c=c<n?-1:c>n?1:0,0!==c)return"asc"===f.dir?c:-c;c=e[b];n=e[a];
return c<n?-1:c>n?1:0}):k.sort(function(b,a){var c,d,f,k,v=l.length,m=g[b]._aSortData,h=g[a]._aSortData;for(f=0;f<v;f++)if(k=l[f],c=m[k.col],d=h[k.col],k=n[k.type+"-"+k.dir]||n["string-"+k.dir],c=k(c,d),0!==c)return c;c=e[b];d=e[a];return c<d?-1:c>d?1:0})}b.bSorted=!0}function xb(b){var a,c,e=b.aoColumns,n=ta(b);b=b.oLanguage.oAria;for(var g=0,d=e.length;g<d;g++){c=e[g];var f=c.asSorting;a=c.sTitle.replace(/<.*?>/g,"");var k=c.nTh;k.removeAttribute("aria-sort");c.bSortable&&(0<n.length&&n[0].col==
g?(k.setAttribute("aria-sort","asc"==n[0].dir?"ascending":"descending"),c=f[n[0].index+1]||f[0]):c=f[0],a+="asc"===c?b.sSortAscending:b.sSortDescending);k.setAttribute("aria-label",a)}}function Xa(a,c,e,g){var f=a.aaSorting,k=a.aoColumns[c].asSorting,l=function(a,c){var e=a._idx;e===d&&(e=b.inArray(a[1],k));return e+1<k.length?e+1:c?null:0};"number"===typeof f[0]&&(f=a.aaSorting=[f]);e&&a.oFeatures.bSortMulti?(e=b.inArray(c,ka(f,"0")),-1!==e?(c=l(f[e],!0),null===c&&1===f.length&&(c=0),null===c?f.splice(e,
1):(f[e][1]=k[c],f[e]._idx=c)):(f.push([c,k[0],0]),f[f.length-1]._idx=0)):f.length&&f[0][0]==c?(c=l(f[0]),f.length=1,f[0][1]=k[c],f[0]._idx=c):(f.length=0,f.push([c,k[0]]),f[0]._idx=0);n(a);"function"==typeof g&&g(a)}function Ra(b,a,c,e){var n=b.aoColumns[c];Ya(a,{},function(a){!1!==n.bSortable&&(b.oFeatures.bProcessing?(ja(b,!0),setTimeout(function(){Xa(b,c,a.shiftKey,e);"ssp"!==ea(b)&&ja(b,!1)},0)):Xa(b,c,a.shiftKey,e))})}function Ia(a){var c=a.aLastSort,e=a.oClasses.sSortColumn,n=ta(a),f=a.oFeatures,
g,d;if(f.bSort&&f.bSortClasses){f=0;for(g=c.length;f<g;f++)d=c[f].src,b(ka(a.aoData,"anCells",d)).removeClass(e+(2>f?f+1:3));f=0;for(g=n.length;f<g;f++)d=n[f].src,b(ka(a.aoData,"anCells",d)).addClass(e+(2>f?f+1:3))}a.aLastSort=n}function wb(b,a){var c=b.aoColumns[a],n=C.ext.order[c.sSortDataType],f;n&&(f=n.call(b.oInstance,b,a,e(b,a)));for(var g,d=C.ext.type.order[c.sType+"-pre"],k=0,l=b.aoData.length;k<l;k++)if(c=b.aoData[k],c._aSortData||(c._aSortData=[]),!c._aSortData[a]||n)g=n?f[k]:E(b,k,a,"sort"),
c._aSortData[a]=d?d(g):g}function Ja(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var c={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:b.extend(!0,[],a.aaSorting),search:pb(a.oPreviousSearch),columns:b.map(a.aoColumns,function(b,c){return{visible:b.bVisible,search:pb(a.aoPreSearchCols[c])}})};X(a,"aoStateSaveParams","stateSaveParams",[a,c]);a.oSavedState=c;a.fnStateSaveCallback.call(a.oInstance,a,c)}}function yb(a){var c,e,n=a.aoColumns;if(a.oFeatures.bStateSave){var f=a.fnStateLoadCallback.call(a.oInstance,
a);if(f&&f.time&&(c=X(a,"aoStateLoadParams","stateLoadParams",[a,f]),-1===b.inArray(!1,c)&&(c=a.iStateDuration,!(0<c&&f.time<+new Date-1E3*c)&&n.length===f.columns.length))){a.oLoadedState=b.extend(!0,{},f);f.start!==d&&(a._iDisplayStart=f.start,a.iInitDisplayStart=f.start);f.length!==d&&(a._iDisplayLength=f.length);f.order!==d&&(a.aaSorting=[],b.each(f.order,function(b,c){a.aaSorting.push(c[0]>=n.length?[0,c[1]]:c)}));f.search!==d&&b.extend(a.oPreviousSearch,qb(f.search));c=0;for(e=f.columns.length;c<
e;c++){var g=f.columns[c];g.visible!==d&&(n[c].bVisible=g.visible);g.search!==d&&b.extend(a.aoPreSearchCols[c],qb(g.search))}X(a,"aoStateLoaded","stateLoaded",[a,f])}}}function Ka(a){var c=C.settings;a=b.inArray(a,ka(c,"nTable"));return-1!==a?c[a]:null}function oa(a,b,c,e){c="DataTables warning: "+(a?"table id="+a.sTableId+" - ":"")+c;e&&(c+=". For more information about this error, please see http://datatables.net/tn/"+e);if(b)h.console&&console.log&&console.log(c);else if(b=C.ext,b=b.sErrMode||
b.errMode,a&&X(a,null,"error",[a,e,c]),"alert"==b)alert(c);else{if("throw"==b)throw Error(c);"function"==typeof b&&b(a,e,c)}}function la(a,c,e,n){b.isArray(e)?b.each(e,function(e,n){b.isArray(n)?la(a,c,n[0],n[1]):la(a,c,n)}):(n===d&&(n=e),c[e]!==d&&(a[n]=c[e]))}function zb(a,c,e){var n,f;for(f in c)c.hasOwnProperty(f)&&(n=c[f],b.isPlainObject(n)?(b.isPlainObject(a[f])||(a[f]={}),b.extend(!0,a[f],n)):a[f]=e&&"data"!==f&&"aaData"!==f&&b.isArray(n)?n.slice():n);return a}function Ya(a,c,e){b(a).bind("click.DT",
c,function(b){a.blur();e(b)}).bind("keypress.DT",c,function(a){13===a.which&&(a.preventDefault(),e(a))}).bind("selectstart.DT",function(){return!1})}function fa(a,b,c,e){c&&a[b].push({fn:c,sName:e})}function X(a,c,e,n){var f=[];c&&(f=b.map(a[c].slice().reverse(),function(b){return b.fn.apply(a.oInstance,n)}));null!==e&&(c=b.Event(e+".dt"),b(a.nTable).trigger(c,n),f.push(c.result));return f}function Va(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),e=a._iDisplayLength;b>=c&&(b=c-e);b-=b%e;if(-1===e||
0>b)b=0;a._iDisplayStart=b}function Sa(a,c){var e=a.renderer,n=C.ext.renderer[c];return b.isPlainObject(e)&&e[c]?n[e[c]]||n._:"string"===typeof e?n[e]||n._:n._}function ea(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function La(a,b){var c=[],c=Ab.numbers_length,e=Math.floor(c/2);b<=c?c=va(0,b):a<=e?(c=va(0,c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-e?c=va(b-(c-2),b):(c=va(a-e+2,a+e-1),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el=
"span";return c}function fb(a){b.each({num:function(b){return Ma(b,a)},"num-fmt":function(b){return Ma(b,a,Za)},"html-num":function(b){return Ma(b,a,Na)},"html-num-fmt":function(b){return Ma(b,a,Na,Za)}},function(b,c){ba.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(ba.type.search[b+a]=ba.type.search.html)})}function Bb(a){return function(){var b=[Ka(this[C.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return C.ext.internal[a].apply(this,b)}}var C,ba,T,N,Z,$a={},Cb=/[\r\n]/g,Na=/<.*?>/g,
Pb=/^[\w\+\-]/,Qb=/[\w\+\-]$/,Mb=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),Za=/[',$\u00a3\u20ac\u00a5%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,pa=function(a){return a&&!0!==a&&"-"!==a?!1:!0},Db=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Eb=function(a,b){$a[b]||($a[b]=RegExp(Ga(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace($a[b],"."):a},ab=function(a,b,c){var e="string"===typeof a;if(pa(a))return!0;b&&e&&(a=Eb(a,
b));c&&e&&(a=a.replace(Za,""));return!isNaN(parseFloat(a))&&isFinite(a)},Fb=function(a,b,c){return pa(a)?!0:pa(a)||"string"===typeof a?ab(a.replace(Na,""),b,c)?!0:null:null},ka=function(a,b,c){var e=[],n=0,f=a.length;if(c!==d)for(;n<f;n++)a[n]&&a[n][b]&&e.push(a[n][b][c]);else for(;n<f;n++)a[n]&&e.push(a[n][b]);return e},za=function(a,b,c,e){var n=[],f=0,g=b.length;if(e!==d)for(;f<g;f++)a[b[f]][c]&&n.push(a[b[f]][c][e]);else for(;f<g;f++)n.push(a[b[f]][c]);return n},va=function(a,b){var c=[],e;b===
d?(b=0,e=a):(e=b,b=a);for(var n=b;n<e;n++)c.push(n);return c},Gb=function(a){for(var b=[],c=0,e=a.length;c<e;c++)a[c]&&b.push(a[c]);return b},Ba=function(a){var b=[],c,e,n=a.length,f,g=0;e=0;a:for(;e<n;e++){c=a[e];for(f=0;f<g;f++)if(b[f]===c)continue a;b.push(c);g++}return b},ha=function(a,b,c){a[b]!==d&&(a[c]=a[b])},xa=/\[.*?\]$/,sa=/\(\)$/,Ha=b("<div>")[0],Nb=Ha.textContent!==d,Ob=/<.*?>/g;C=function(a){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,b){return this.api(!0).rows(a,
b).data()};this.api=function(a){return a?new T(Ka(this[ba.iApiIndex])):new T(this)};this.fnAddData=function(a,c){var e=this.api(!0),n=b.isArray(a)&&(b.isArray(a[0])||b.isPlainObject(a[0]))?e.rows.add(a):e.row.add(a);(c===d||c)&&e.draw();return n.flatten().toArray()};this.fnAdjustColumnSizing=function(a){var b=this.api(!0).columns.adjust(),c=b.settings()[0],e=c.oScroll;a===d||a?b.draw(!1):(""!==e.sX||""!==e.sY)&&wa(c)};this.fnClearTable=function(a){var b=this.api(!0).clear();(a===d||a)&&b.draw()};
this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,b,c){var e=this.api(!0);a=e.rows(a);var n=a.settings()[0],f=n.aoData[a[0][0]];a.remove();b&&b.call(this,n,f);(c===d||c)&&e.draw();return f};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(a)};this.fnFilter=function(a,b,c,e,n,f){n=this.api(!0);null===b||b===d?n.search(a,c,e,f):n.column(b).search(a,c,e,f);n.draw()};this.fnGetData=function(a,b){var c=this.api(!0);if(a!==
d){var e=a.nodeName?a.nodeName.toLowerCase():"";return b!==d||"td"==e||"th"==e?c.cell(a,b).data():c.row(a).data()||null}return c.data().toArray()};this.fnGetNodes=function(a){var b=this.api(!0);return a!==d?b.row(a).node():b.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};
this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(a,b){var c=this.api(!0).page(a);(b===d||b)&&c.draw(!1)};this.fnSetColumnVis=function(a,b,c){a=this.api(!0).column(a).visible(b);(c===d||c)&&a.columns.adjust().draw()};this.fnSettings=function(){return Ka(this[ba.iApiIndex])};this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,b,c,e,n){var f=
this.api(!0);c===d||null===c?f.row(b).data(a):f.cell(b,c).data(a);(n===d||n)&&f.columns.adjust();(e===d||e)&&f.draw();return 0};this.fnVersionCheck=ba.fnVersionCheck;var c=this,e=a===d,n=this.length;e&&(a={});this.oApi=this.internal=ba.internal;for(var v in C.ext.internal)v&&(this[v]=Bb(v));this.each(function(){var v={},v=1<n?zb(v,a,!0):a,h=0,q,u=this.getAttribute("id"),p=!1,P=C.defaults,B=b(this);if("table"!=this.nodeName.toLowerCase())oa(null,0,"Non-table node initialisation ("+this.nodeName+")",
2);else{f(P);g(P.column);k(P,P,!0);k(P.column,P.column,!0);k(P,b.extend(v,B.data()));var V=C.settings,h=0;for(q=V.length;h<q;h++){var A=V[h];if(A.nTable==this||A.nTHead.parentNode==this||A.nTFoot&&A.nTFoot.parentNode==this){h=v.bRetrieve!==d?v.bRetrieve:P.bRetrieve;if(e||h)return A.oInstance;if(v.bDestroy!==d?v.bDestroy:P.bDestroy){A.oInstance.fnDestroy();break}else{oa(A,0,"Cannot reinitialise DataTable",3);return}}if(A.sTableId==this.id){V.splice(h,1);break}}if(null===u||""===u)this.id=u="DataTables_Table_"+
C.ext._unique++;var w=b.extend(!0,{},C.models.oSettings,{sDestroyWidth:B[0].style.width,sInstance:u,sTableId:u});w.nTable=this;w.oApi=c.internal;w.oInit=v;V.push(w);w.oInstance=1===c.length?c:B.dataTable();f(v);v.oLanguage&&m(v.oLanguage);v.aLengthMenu&&!v.iDisplayLength&&(v.iDisplayLength=b.isArray(v.aLengthMenu[0])?v.aLengthMenu[0][0]:v.aLengthMenu[0]);v=zb(b.extend(!0,{},P),v);la(w.oFeatures,v,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));
la(w,v,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);la(w.oScroll,v,[["sScrollX","sX"],["sScrollXInner",
"sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);la(w.oLanguage,v,"fnInfoCallback");fa(w,"aoDrawCallback",v.fnDrawCallback,"user");fa(w,"aoServerParams",v.fnServerParams,"user");fa(w,"aoStateSaveParams",v.fnStateSaveParams,"user");fa(w,"aoStateLoadParams",v.fnStateLoadParams,"user");fa(w,"aoStateLoaded",v.fnStateLoaded,"user");fa(w,"aoRowCallback",v.fnRowCallback,"user");fa(w,"aoRowCreatedCallback",v.fnCreatedRow,"user");fa(w,"aoHeaderCallback",v.fnHeaderCallback,"user");fa(w,"aoFooterCallback",
v.fnFooterCallback,"user");fa(w,"aoInitComplete",v.fnInitComplete,"user");fa(w,"aoPreDrawCallback",v.fnPreDrawCallback,"user");w.rowIdFn=F(v.rowId);r(w);u=w.oClasses;v.bJQueryUI?(b.extend(u,C.ext.oJUIClasses,v.oClasses),v.sDom===P.sDom&&"lfrtip"===P.sDom&&(w.sDom='<"H"lfr>t<"F"ip>'),w.renderer)?b.isPlainObject(w.renderer)&&!w.renderer.header&&(w.renderer.header="jqueryui"):w.renderer="jqueryui":b.extend(u,C.ext.classes,v.oClasses);B.addClass(u.sTable);w.iInitDisplayStart===d&&(w.iInitDisplayStart=
v.iDisplayStart,w._iDisplayStart=v.iDisplayStart);null!==v.iDeferLoading&&(w.bDeferLoading=!0,h=b.isArray(v.iDeferLoading),w._iRecordsDisplay=h?v.iDeferLoading[0]:v.iDeferLoading,w._iRecordsTotal=h?v.iDeferLoading[1]:v.iDeferLoading);var I=w.oLanguage;b.extend(!0,I,v.oLanguage);""!==I.sUrl&&(b.ajax({dataType:"json",url:I.sUrl,success:function(a){m(a);k(P.oLanguage,a);b.extend(!0,I,a);ya(w)},error:function(){ya(w)}}),p=!0);null===v.asStripeClasses&&(w.asStripeClasses=[u.sStripeOdd,u.sStripeEven]);
var h=w.asStripeClasses,y=B.children("tbody").find("tr").eq(0);-1!==b.inArray(!0,b.map(h,function(a){return y.hasClass(a)}))&&(b("tbody tr",this).removeClass(h.join(" ")),w.asDestroyStripes=h.slice());V=[];h=this.getElementsByTagName("thead");0!==h.length&&(x(w.aoHeader,h[0]),V=W(w));if(null===v.aoColumns)for(A=[],h=0,q=V.length;h<q;h++)A.push(null);else A=v.aoColumns;h=0;for(q=A.length;h<q;h++)l(w,V?V[h]:null);L(w,v.aoColumnDefs,A,function(a,b){t(w,a,b)});if(y.length){var ia=function(a,b){return null!==
a.getAttribute("data-"+b)?b:null};b(y[0]).children("th, td").each(function(a,b){var c=w.aoColumns[a];if(c.mData===a){var e=ia(b,"sort")||ia(b,"order"),n=ia(b,"filter")||ia(b,"search");if(null!==e||null!==n)c.mData={_:a+".display",sort:null!==e?a+".@data-"+e:d,type:null!==e?a+".@data-"+e:d,filter:null!==n?a+".@data-"+n:d},t(w,a)}})}var J=w.oFeatures;v.bStateSave&&(J.bStateSave=!0,yb(w,v),fa(w,"aoDrawCallback",Ja,"state_save"));if(v.aaSorting===d)for(V=w.aaSorting,h=0,q=V.length;h<q;h++)V[h][1]=w.aoColumns[h].asSorting[0];
Ia(w);J.bSort&&fa(w,"aoDrawCallback",function(){if(w.bSorted){var a=ta(w),c={};b.each(a,function(a,b){c[b.src]=b.dir});X(w,null,"order",[w,a,c]);xb(w)}});fa(w,"aoDrawCallback",function(){(w.bSorted||"ssp"===ea(w)||J.bDeferRender)&&Ia(w)},"sc");h=B.children("caption").each(function(){this._captionSide=B.css("caption-side")});q=B.children("thead");0===q.length&&(q=b("<thead/>").appendTo(this));w.nTHead=q[0];q=B.children("tbody");0===q.length&&(q=b("<tbody/>").appendTo(this));w.nTBody=q[0];q=B.children("tfoot");
0===q.length&&0<h.length&&(""!==w.oScroll.sX||""!==w.oScroll.sY)&&(q=b("<tfoot/>").appendTo(this));0===q.length||0===q.children().length?B.addClass(u.sNoFooter):0<q.length&&(w.nTFoot=q[0],x(w.aoFooter,w.nTFoot));if(v.aaData)for(h=0;h<v.aaData.length;h++)z(w,v.aaData[h]);else(w.bDeferLoading||"dom"==ea(w))&&M(w,b(w.nTBody).children("tr"));w.aiDisplay=w.aiDisplayMaster.slice();w.bInitialised=!0;!1===p&&ya(w)}});c=null;return this};var Hb=[],da=Array.prototype,Rb=function(a){var c,e,n=C.settings,f=b.map(n,
function(a){return a.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return c=b.inArray(a,f),-1!==c?[n[c]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?e=b(a):a instanceof b&&(e=a)}else return[];if(e)return e.map(function(){c=b.inArray(this,f);return-1!==c?n[c]:null}).toArray()};T=function(a,c){if(!(this instanceof T))return new T(a,c);var e=[],n=function(a){(a=Rb(a))&&(e=e.concat(a))};if(b.isArray(a))for(var f=
0,g=a.length;f<g;f++)n(a[f]);else n(a);this.context=Ba(e);c&&b.merge(this,c);this.selector={rows:null,cols:null,opts:null};T.extend(this,this,Hb)};C.Api=T;b.extend(T.prototype,{any:function(){return 0!==this.count()},concat:da.concat,context:[],count:function(){return this.flatten().length},each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new T(b[a],this[a]):null},filter:function(a){var b=[];if(da.filter)b=
da.filter.call(this,a,this);else for(var c=0,e=this.length;c<e;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new T(this.context,b)},flatten:function(){var a=[];return new T(this.context,a.concat.apply(a,this.toArray()))},join:da.join,indexOf:da.indexOf||function(a,b){for(var c=b||0,e=this.length;c<e;c++)if(this[c]===a)return c;return-1},iterator:function(a,b,c,e){var n=[],f,g,k,l,v,m=this.context,h,x,q=this.selector;"string"===typeof a&&(e=c,c=b,b=a,a=!1);g=0;for(k=m.length;g<k;g++){var u=
new T(m[g]);if("table"===b)f=c.call(u,m[g],g),f!==d&&n.push(f);else if("columns"===b||"rows"===b)f=c.call(u,m[g],this[g],g),f!==d&&n.push(f);else if("column"===b||"column-rows"===b||"row"===b||"cell"===b)for(x=this[g],"column-rows"===b&&(h=Oa(m[g],q.opts)),l=0,v=x.length;l<v;l++)f=x[l],f="cell"===b?c.call(u,m[g],f.row,f.column,g,l):c.call(u,m[g],f,g,l,h),f!==d&&n.push(f)}return n.length||e?(a=new T(m,a?n.concat.apply([],n):n),b=a.selector,b.rows=q.rows,b.cols=q.cols,b.opts=q.opts,a):this},lastIndexOf:da.lastIndexOf||
function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(da.map)b=da.map.call(this,a,this);else for(var c=0,e=this.length;c<e;c++)b.push(a.call(this,this[c],c));return new T(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},pop:da.pop,push:da.push,reduce:da.reduce||function(a,b){return p(this,a,b,0,this.length,1)},reduceRight:da.reduceRight||function(a,b){return p(this,a,b,this.length-1,-1,-1)},reverse:da.reverse,selector:null,
shift:da.shift,sort:da.sort,splice:da.splice,toArray:function(){return da.slice.call(this)},to$:function(){return b(this)},toJQuery:function(){return b(this)},unique:function(){return new T(this.context,Ba(this))},unshift:da.unshift});T.extend=function(a,c,e){if(e.length&&c&&(c instanceof T||c.__dt_wrapper)){var n,f,g,d=function(a,b,c){return function(){var e=b.apply(a,arguments);T.extend(e,e,c.methodExt);return e}};n=0;for(f=e.length;n<f;n++)g=e[n],c[g.name]="function"===typeof g.val?d(a,g.val,g):
b.isPlainObject(g.val)?{}:g.val,c[g.name].__dt_wrapper=!0,T.extend(a,c[g.name],g.propExt)}};T.register=N=function(a,c){if(b.isArray(a))for(var e=0,n=a.length;e<n;e++)T.register(a[e],c);else for(var f=a.split("."),g=Hb,d,k,e=0,n=f.length;e<n;e++){d=(k=-1!==f[e].indexOf("()"))?f[e].replace("()",""):f[e];var l;a:{l=0;for(var v=g.length;l<v;l++)if(g[l].name===d){l=g[l];break a}l=null}l||(l={name:d,val:{},methodExt:[],propExt:[]},g.push(l));e===n-1?l.val=c:g=k?l.methodExt:l.propExt}};T.registerPlural=
Z=function(a,c,e){T.register(a,e);T.register(c,function(){var a=e.apply(this,arguments);return a===this?this:a instanceof T?a.length?b.isArray(a[0])?new T(a.context,a[0]):a[0]:d:a})};N("tables()",function(a){var c;if(a){c=T;var e=this.context;if("number"===typeof a)a=[e[a]];else{var n=b.map(e,function(a){return a.nTable});a=b(n).filter(a).map(function(){var a=b.inArray(this,n);return e[a]}).toArray()}c=new c(a)}else c=this;return c});N("table()",function(a){a=this.tables(a);var b=a.context;return b.length?
new T(b[0]):a});Z("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});Z("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});Z("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});Z("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});Z("tables().containers()","table().container()",
function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});N("draw()",function(a){return this.iterator("table",function(b){"page"===a?D(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),n(b,!1===a))})});N("page()",function(a){return a===d?this.page.info().page:this.iterator("table",function(b){Wa(b,a)})});N("page.info()",function(){if(0===this.context.length)return d;var a=this.context[0],b=a._iDisplayStart,c=a.oFeatures.bPaginate?a._iDisplayLength:-1,e=a.fnRecordsDisplay(),
n=-1===c;return{page:n?0:Math.floor(b/c),pages:n?1:Math.ceil(e/c),start:b,end:a.fnDisplayEnd(),length:c,recordsTotal:a.fnRecordsTotal(),recordsDisplay:e,serverSide:"ssp"===ea(a)}});N("page.len()",function(a){return a===d?0!==this.context.length?this.context[0]._iDisplayLength:d:this.iterator("table",function(b){Ua(b,a)})});var Ib=function(a,b,c){if(c){var e=new T(a);e.one("draw",function(){c(e.ajax.json())})}if("ssp"==ea(a))n(a,b);else{ja(a,!0);var f=a.jqXHR;f&&4!==f.readyState&&f.abort();P(a,[],
function(c){K(a);c=ua(a,c);for(var e=0,f=c.length;e<f;e++)z(a,c[e]);n(a,b);ja(a,!1)})}};N("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});N("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});N("ajax.reload()",function(a,b){return this.iterator("table",function(c){Ib(c,!1===b,a)})});N("ajax.url()",function(a){var c=this.context;if(a===d){if(0===c.length)return d;c=c[0];return c.ajax?b.isPlainObject(c.ajax)?c.ajax.url:c.ajax:c.sAjaxSource}return this.iterator("table",
function(c){b.isPlainObject(c.ajax)?c.ajax.url=a:c.ajax=a})});N("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Ib(c,!1===b,a)})});var bb=function(a,c,e,n,f){var g=[],k,l,v,m,h,x;v=typeof c;c&&"string"!==v&&"function"!==v&&c.length!==d||(c=[c]);v=0;for(m=c.length;v<m;v++)for(l=c[v]&&c[v].split?c[v].split(","):[c[v]],h=0,x=l.length;h<x;h++)(k=e("string"===typeof l[h]?b.trim(l[h]):l[h]))&&k.length&&(g=g.concat(k));a=ba.selector[a];if(a.length)for(v=0,m=a.length;v<m;v++)g=
a[v](n,f,g);return Ba(g)},cb=function(a){a||(a={});a.filter&&a.search===d&&(a.search=a.filter);return b.extend({search:"none",order:"current",page:"all"},a)},db=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Oa=function(a,c){var e,n,f,g=[],d=a.aiDisplay;e=a.aiDisplayMaster;var k=c.search;n=c.order;f=c.page;if("ssp"==ea(a))return"removed"===k?[]:va(0,e.length);if("current"==f)for(e=a._iDisplayStart,
n=a.fnDisplayEnd();e<n;e++)g.push(d[e]);else if("current"==n||"applied"==n)g="none"==k?e.slice():"applied"==k?d.slice():b.map(e,function(a){return-1===b.inArray(a,d)?a:null});else if("index"==n||"original"==n)for(e=0,n=a.aoData.length;e<n;e++)"none"==k?g.push(e):(f=b.inArray(e,d),(-1===f&&"removed"==k||0<=f&&"applied"==k)&&g.push(e));return g};N("rows()",function(a,c){a===d?a="":b.isPlainObject(a)&&(c=a,a="");c=cb(c);var e=this.iterator("table",function(e){var n=c;return bb("row",a,function(a){var c=
Db(a);if(null!==c&&!n)return[c];var f=Oa(e,n);if(null!==c&&-1!==b.inArray(c,f))return[c];if(!a)return f;if("function"===typeof a)return b.map(f,function(b){var c=e.aoData[b];return a(b,c._aData,c.nTr)?b:null});c=Gb(za(e.aoData,f,"nTr"));return a.nodeName&&-1!==b.inArray(a,c)?[a._DT_RowIndex]:"string"===typeof a&&"#"===a.charAt(0)&&(f=e.aIds[a.replace(/^#/,"")],f!==d)?[f.idx]:b(c).filter(a).map(function(){return this._DT_RowIndex}).toArray()},e,n)},1);e.selector.rows=a;e.selector.opts=c;return e});
N("rows().nodes()",function(){return this.iterator("row",function(a,b){return a.aoData[b].nTr||d},1)});N("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return za(a.aoData,b,"_aData")},1)});Z("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var e=b.aoData[c];return"search"===a?e._aFilterData:e._aSortData},1)});Z("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){O(b,c,a)})});Z("rows().indexes()",
"row().index()",function(){return this.iterator("row",function(a,b){return b},1)});Z("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,e=0,n=c.length;e<n;e++)for(var f=0,g=this[e].length;f<g;f++){var d=c[e].rowIdFn(c[e].aoData[this[e][f]]._aData);b.push((!0===a?"#":"")+d)}return new T(c,b)});Z("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,c,e){var n=b.aoData,f=n[c],g,k,l,v,m;n.splice(c,1);g=0;for(k=n.length;g<k;g++)if(l=n[g],m=l.anCells,
null!==l.nTr&&(l.nTr._DT_RowIndex=g),null!==m)for(l=0,v=m.length;l<v;l++)m[l]._DT_CellIndex.row=g;w(b.aiDisplayMaster,c);w(b.aiDisplay,c);w(a[e],c,!1);Va(b);c=b.rowIdFn(f._aData);c!==d&&delete b.aIds[c]});this.iterator("table",function(a){for(var b=0,c=a.aoData.length;b<c;b++)a.aoData[b].idx=b});return this});N("rows.add()",function(a){var c=this.iterator("table",function(b){var c,e,n,f=[];e=0;for(n=a.length;e<n;e++)c=a[e],c.nodeName&&"TR"===c.nodeName.toUpperCase()?f.push(M(b,c)[0]):f.push(z(b,c));
return f},1),e=this.rows(-1);e.pop();b.merge(e,c);return e});N("row()",function(a,b){return db(this.rows(a,b))});N("row().data()",function(a){var b=this.context;if(a===d)return b.length&&this.length?b[0].aoData[this[0]]._aData:d;b[0].aoData[this[0]]._aData=a;O(b[0],this[0],"data");return this});N("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});N("row.add()",function(a){a instanceof b&&a.length&&(a=a[0]);var c=this.iterator("table",function(b){return a.nodeName&&
"TR"===a.nodeName.toUpperCase()?M(b,a)[0]:z(b,a)});return this.row(c[0])});var eb=function(a,b){var c=a.context;c.length&&(c=c[0].aoData[b!==d?b:a[0]])&&c._details&&(c._details.remove(),c._detailsShow=d,c._details=d)},Jb=function(a,b){var c=a.context;if(c.length&&a.length){var e=c[0].aoData[a[0]];if(e._details){(e._detailsShow=b)?e._details.insertAfter(e.nTr):e._details.detach();var n=c[0],f=new T(n),g=n.aoData;f.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<ka(g,
"_details").length&&(f.on("draw.dt.DT_details",function(a,b){n===b&&f.rows({page:"current"}).eq(0).each(function(a){a=g[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),f.on("column-visibility.dt.DT_details",function(a,b){if(n===b)for(var c,e=B(b),f=0,d=g.length;f<d;f++)c=g[f],c._details&&c._details.children("td[colspan]").attr("colspan",e)}),f.on("destroy.dt.DT_details",function(a,b){if(n===b)for(var c=0,e=g.length;c<e;c++)g[c]._details&&eb(f,c)}))}}};N("row().child()",function(a,c){var e=this.context;
if(a===d)return e.length&&this.length?e[0].aoData[this[0]]._details:d;if(!0===a)this.child.show();else if(!1===a)eb(this);else if(e.length&&this.length){var n=e[0],e=e[0].aoData[this[0]],f=[],g=function(a,c){if(b.isArray(a)||a instanceof b)for(var e=0,d=a.length;e<d;e++)g(a[e],c);else a.nodeName&&"tr"===a.nodeName.toLowerCase()?f.push(a):(e=b("<tr><td/></tr>").addClass(c),b("td",e).addClass(c).html(a)[0].colSpan=B(n),f.push(e[0]))};g(a,c);e._details&&e._details.remove();e._details=b(f);e._detailsShow&&
e._details.insertAfter(e.nTr)}return this});N(["row().child.show()","row().child().show()"],function(){Jb(this,!0);return this});N(["row().child.hide()","row().child().hide()"],function(){Jb(this,!1);return this});N(["row().child.remove()","row().child().remove()"],function(){eb(this);return this});N("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Sb=/^(.+):(name|visIdx|visible)$/,Kb=function(a,b,c,e,n){c=[];e=0;for(var f=
n.length;e<f;e++)c.push(E(a,n[e],b));return c};N("columns()",function(a,c){a===d?a="":b.isPlainObject(a)&&(c=a,a="");c=cb(c);var e=this.iterator("table",function(e){var n=a,f=c,g=e.aoColumns,d=ka(g,"sName"),k=ka(g,"nTh");return bb("column",n,function(a){var c=Db(a);if(""===a)return va(g.length);if(null!==c)return[0<=c?c:g.length+c];if("function"===typeof a){var n=Oa(e,f);return b.map(g,function(b,c){return a(c,Kb(e,c,0,0,n),k[c])?c:null})}var l="string"===typeof a?a.match(Sb):"";if(l)switch(l[2]){case "visIdx":case "visible":c=
parseInt(l[1],10);if(0>c){var v=b.map(g,function(a,b){return a.bVisible?b:null});return[v[v.length+c]]}return[u(e,c)];case "name":return b.map(d,function(a,b){return a===l[1]?b:null})}else return b(k).filter(a).map(function(){return b.inArray(this,k)}).toArray()},e,f)},1);e.selector.cols=a;e.selector.opts=c;return e});Z("columns().header()","column().header()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});Z("columns().footer()","column().footer()",function(){return this.iterator("column",
function(a,b){return a.aoColumns[b].nTf},1)});Z("columns().data()","column().data()",function(){return this.iterator("column-rows",Kb,1)});Z("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});Z("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,e,n,f){return za(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});Z("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",
function(a,b,c,e,n){return za(a.aoData,n,"anCells",b)},1)});Z("columns().visible()","column().visible()",function(a,c){return this.iterator("column",function(e,n){if(a===d)return e.aoColumns[n].bVisible;var f=e.aoColumns,g=f[n],k=e.aoData,l,v,m;if(a!==d&&g.bVisible!==a){if(a){var h=b.inArray(!0,ka(f,"bVisible"),n+1);l=0;for(v=k.length;l<v;l++)m=k[l].nTr,f=k[l].anCells,m&&m.insertBefore(f[n],f[h]||null)}else b(ka(e.aoData,"anCells",n)).detach();g.bVisible=a;R(e,e.aoHeader);R(e,e.aoFooter);if(c===d||
c)q(e),(e.oScroll.sX||e.oScroll.sY)&&wa(e);X(e,null,"column-visibility",[e,n,a,c]);Ja(e)}})});Z("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?e(b,c):c},1)});N("columns.adjust()",function(){return this.iterator("table",function(a){q(a)},1)});N("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return u(c,b);if("fromData"===a||"toVisible"===a)return e(c,b)}});N("column()",
function(a,b){return db(this.columns(a,b))});N("cells()",function(a,c,e){b.isPlainObject(a)&&(a.row===d?(e=a,a=null):(e=c,c=null));b.isPlainObject(c)&&(e=c,c=null);if(null===c||c===d)return this.iterator("table",function(c){var n=a,f=cb(e),g=c.aoData,k=Oa(c,f),l=Gb(za(g,k,"anCells")),v=b([].concat.apply([],l)),m,h=c.aoColumns.length,x,q,u,r,p,t;return bb("cell",n,function(a){var e="function"===typeof a;if(null===a||a===d||e){x=[];q=0;for(u=k.length;q<u;q++)for(m=k[q],r=0;r<h;r++)p={row:m,column:r},
e?(t=g[m],a(p,E(c,m,r),t.anCells?t.anCells[r]:null)&&x.push(p)):x.push(p);return x}return b.isPlainObject(a)?[a]:v.filter(a).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray()},c,f)});var n=this.columns(c,e),f=this.rows(a,e),g,k,l,v,m,h=this.iterator("table",function(a,b){g=[];k=0;for(l=f[b].length;k<l;k++)for(v=0,m=n[b].length;v<m;v++)g.push({row:f[b][k],column:n[b][v]});return g},1);b.extend(h.selector,{cols:c,rows:a,opts:e});return h});Z("cells().nodes()",
"cell().node()",function(){return this.iterator("cell",function(a,b,c){return(a=a.aoData[b].anCells)?a[c]:d},1)});N("cells().data()",function(){return this.iterator("cell",function(a,b,c){return E(a,b,c)},1)});Z("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,e){return b.aoData[c][a][e]},1)});Z("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,e){return E(b,c,e,a)},1)});Z("cells().indexes()",
"cell().index()",function(){return this.iterator("cell",function(a,b,c){return{row:b,column:c,columnVisible:e(a,c)}},1)});Z("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,e){O(b,c,a,e)})});N("cell()",function(a,b,c){return db(this.cells(a,b,c))});N("cell().data()",function(a){var b=this.context,c=this[0];if(a===d)return b.length&&c.length?E(b[0],c[0].row,c[0].column):d;I(b[0],c[0].row,c[0].column,a);O(b[0],c[0].row,"data",c[0].column);return this});
N("order()",function(a,c){var e=this.context;if(a===d)return 0!==e.length?e[0].aaSorting:d;"number"===typeof a?a=[[a,c]]:b.isArray(a[0])||(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});N("order.listener()",function(a,b,c){return this.iterator("table",function(e){Ra(e,a,b,c)})});N("order.fixed()",function(a){if(!a){var c=this.context,c=c.length?c[0].aaSortingFixed:d;return b.isArray(c)?{pre:c}:c}return this.iterator("table",function(c){c.aaSortingFixed=
b.extend(!0,{},a)})});N(["columns().order()","column().order()"],function(a){var c=this;return this.iterator("table",function(e,n){var f=[];b.each(c[n],function(b,c){f.push([c,a])});e.aaSorting=f})});N("search()",function(a,c,e,n){var f=this.context;return a===d?0!==f.length?f[0].oPreviousSearch.sSearch:d:this.iterator("table",function(f){f.oFeatures.bFilter&&qa(f,b.extend({},f.oPreviousSearch,{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===e?!0:e,bCaseInsensitive:null===n?!0:n}),1)})});Z("columns().search()",
"column().search()",function(a,c,e,n){return this.iterator("column",function(f,g){var k=f.aoPreSearchCols;if(a===d)return k[g].sSearch;f.oFeatures.bFilter&&(b.extend(k[g],{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===e?!0:e,bCaseInsensitive:null===n?!0:n}),qa(f,f.oPreviousSearch,1))})});N("state()",function(){return this.context.length?this.context[0].oSavedState:null});N("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});N("state.loaded()",
function(){return this.context.length?this.context[0].oLoadedState:null});N("state.save()",function(){return this.iterator("table",function(a){Ja(a)})});C.versionCheck=C.fnVersionCheck=function(a){var b=C.version.split(".");a=a.split(".");for(var c,e,n=0,f=a.length;n<f;n++)if(c=parseInt(b[n],10)||0,e=parseInt(a[n],10)||0,c!==e)return c>e;return!0};C.isDataTable=C.fnIsDataTable=function(a){var c=b(a).get(0),e=!1;b.each(C.settings,function(a,n){var f=n.nScrollHead?b("table",n.nScrollHead)[0]:null,g=
n.nScrollFoot?b("table",n.nScrollFoot)[0]:null;if(n.nTable===c||f===c||g===c)e=!0});return e};C.tables=C.fnTables=function(a){var c=!1;b.isPlainObject(a)&&(c=a.api,a=a.visible);var e=b.map(C.settings,function(c){if(!a||a&&b(c.nTable).is(":visible"))return c.nTable});return c?new T(e):e};C.util={throttle:Ea,escapeRegex:Ga};C.camelToHungarian=k;N("$()",function(a,c){var e=this.rows(c).nodes(),e=b(e);return b([].concat(e.filter(a).toArray(),e.find(a).toArray()))});b.each(["on","one","off"],function(a,
c){N(c+"()",function(){var a=Array.prototype.slice.call(arguments);a[0].match(/\.dt\b/)||(a[0]+=".dt");var e=b(this.tables().nodes());e[c].apply(e,a);return this})});N("clear()",function(){return this.iterator("table",function(a){K(a)})});N("settings()",function(){return new T(this.context,this.context)});N("init()",function(){var a=this.context;return a.length?a[0].oInit:null});N("data()",function(){return this.iterator("table",function(a){return ka(a.aoData,"_aData")}).flatten()});N("destroy()",
function(a){a=a||!1;return this.iterator("table",function(c){var e=c.nTableWrapper.parentNode,n=c.oClasses,f=c.nTable,g=c.nTBody,d=c.nTHead,k=c.nTFoot,l=b(f),g=b(g),v=b(c.nTableWrapper),m=b.map(c.aoData,function(a){return a.nTr}),x;c.bDestroying=!0;X(c,"aoDestroyCallback","destroy",[c]);a||(new T(c)).columns().visible(!0);v.unbind(".DT").find(":not(tbody *)").unbind(".DT");b(h).unbind(".DT-"+c.sInstance);f!=d.parentNode&&(l.children("thead").detach(),l.append(d));k&&f!=k.parentNode&&(l.children("tfoot").detach(),
l.append(k));c.aaSorting=[];c.aaSortingFixed=[];Ia(c);b(m).removeClass(c.asStripeClasses.join(" "));b("th, td",d).removeClass(n.sSortable+" "+n.sSortableAsc+" "+n.sSortableDesc+" "+n.sSortableNone);c.bJUI&&(b("th span."+n.sSortIcon+", td span."+n.sSortIcon,d).detach(),b("th, td",d).each(function(){var a=b("div."+n.sSortJUIWrapper,this);b(this).append(a.contents());a.detach()}));g.children().detach();g.append(m);d=a?"remove":"detach";l[d]();v[d]();!a&&e&&(e.insertBefore(f,c.nTableReinsertBefore),l.css("width",
c.sDestroyWidth).removeClass(n.sTable),(x=c.asDestroyStripes.length)&&g.children().each(function(a){b(this).addClass(c.asDestroyStripes[a%x])}));e=b.inArray(c,C.settings);-1!==e&&C.settings.splice(e,1)})});b.each(["column","row","cell"],function(a,b){N(b+"s().every()",function(a){var c=this.selector.opts,e=this;return this.iterator(b,function(n,f,g,k,l){a.call(e[b](f,"cell"===b?g:c,"cell"===b?c:d),f,g,k,l)})})});N("i18n()",function(a,c,e){var n=this.context[0];a=F(a)(n.oLanguage);a===d&&(a=c);e!==
d&&b.isPlainObject(a)&&(a=a[e]!==d?a[e]:a._);return a.replace("%d",e)});C.version="1.10.10";C.settings=[];C.models={};C.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};C.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};C.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,
mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};C.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,
bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?
sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",
sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},
oSearch:b.extend({},C.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};a(C.defaults);C.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,
sType:null,sWidth:null};a(C.defaults.column);C.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],
aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,
searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:d,oAjaxData:d,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],
fnRecordsTotal:function(){return"ssp"==ea(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ea(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,e=this.aiDisplay.length,n=this.oFeatures,f=n.bPaginate;return n.bServerSide?!1===f||-1===a?b+e:Math.min(b+a,this._iRecordsDisplay):!f||c>e||-1===a?e:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,
aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};C.ext=ba={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:C.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:C.version};b.extend(ba,{afnFiltering:ba.search,aTypes:ba.type.detect,ofnSearch:ba.type.search,oSort:ba.type.order,afnSortData:ba.order,
aoFeatures:ba.feature,oApi:ba.internal,oStdClasses:ba.classes,oPagination:ba.pager});b.extend(C.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",
sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",
sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Pa="",Pa="",ma=Pa+"ui-state-default",Aa=Pa+"css_right ui-icon ui-icon-",Lb=Pa+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";b.extend(C.ext.oJUIClasses,C.ext.classes,{sPageButton:"fg-button ui-button "+ma,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",
sSortAsc:ma+" sorting_asc",sSortDesc:ma+" sorting_desc",sSortable:ma+" sorting",sSortableAsc:ma+" sorting_asc_disabled",sSortableDesc:ma+" sorting_desc_disabled",sSortableNone:ma+" sorting_disabled",sSortJUIAsc:Aa+"triangle-1-n",sSortJUIDesc:Aa+"triangle-1-s",sSortJUI:Aa+"carat-2-n-s",sSortJUIAscAllowed:Aa+"carat-1-n",sSortJUIDescAllowed:Aa+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+ma,sScrollFoot:"dataTables_scrollFoot "+
ma,sHeaderTH:ma,sFooterTH:ma,sJUIHeader:Lb+" ui-corner-tl ui-corner-tr",sJUIFooter:Lb+" ui-corner-bl ui-corner-br"});var Ab=C.ext.pager;b.extend(Ab,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[La(a,b)]},simple_numbers:function(a,b){return["previous",La(a,b),"next"]},full_numbers:function(a,b){return["first","previous",La(a,b),"next","last"]},_numbers:La,numbers_length:7});b.extend(!0,C.ext.renderer,{pageButton:{_:function(a,
e,n,f,g,d){var k=a.oClasses,l=a.oLanguage.oPaginate,v=a.oLanguage.oAria.paginate||{},m,h,x=0,q=function(c,e){var f,u,r,p,t=function(b){Wa(a,b.data.action,!0)};f=0;for(u=e.length;f<u;f++)if(p=e[f],b.isArray(p))r=b("<"+(p.DT_el||"div")+"/>").appendTo(c),q(r,p);else{m=null;h="";switch(p){case "ellipsis":c.append('<span class="ellipsis">&#x2026;</span>');break;case "first":m=l.sFirst;h=p+(0<g?"":" "+k.sPageButtonDisabled);break;case "previous":m=l.sPrevious;h=p+(0<g?"":" "+k.sPageButtonDisabled);break;
case "next":m=l.sNext;h=p+(g<d-1?"":" "+k.sPageButtonDisabled);break;case "last":m=l.sLast;h=p+(g<d-1?"":" "+k.sPageButtonDisabled);break;default:m=p+1,h=g===p?k.sPageButtonActive:""}null!==m&&(r=b("<a>",{"class":k.sPageButton+" "+h,"aria-controls":a.sTableId,"aria-label":v[p],"data-dt-idx":x,tabindex:a.iTabIndex,id:0===n&&"string"===typeof p?a.sTableId+"_"+p:null}).html(m).appendTo(c),Ya(r,{action:p},t),x++)}},u;try{u=b(e).find(c.activeElement).data("dt-idx")}catch(r){}q(b(e).empty(),f);u&&b(e).find("[data-dt-idx="+
u+"]").focus()}}});b.extend(C.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return ab(a,c)?"num"+c:null},function(a){if(!(!a||a instanceof Date||Pb.test(a)&&Qb.test(a)))return null;var b=Date.parse(a);return null!==b&&!isNaN(b)||pa(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return ab(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Fb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Fb(a,c,!0)?"html-num-fmt"+c:null},function(a){return pa(a)||
"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);b.extend(C.ext.type.search,{html:function(a){return pa(a)?a:"string"===typeof a?a.replace(Cb," ").replace(Na,""):""},string:function(a){return pa(a)?a:"string"===typeof a?a.replace(Cb," "):a}});var Ma=function(a,b,c,e){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Eb(a,b));a.replace&&(c&&(a=a.replace(c,"")),e&&(a=a.replace(e,"")));return 1*a};b.extend(ba.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return pa(a)?
"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return pa(a)?"":"string"===typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});fb("");b.extend(!0,C.ext.renderer,{header:{_:function(a,c,e,n){b(a.nTable).on("order.dt.DT",function(b,f,g,d){a===f&&(b=e.idx,c.removeClass(e.sSortingClass+" "+n.sSortAsc+" "+n.sSortDesc).addClass("asc"==d[b]?n.sSortAsc:"desc"==d[b]?n.sSortDesc:
e.sSortingClass))})},jqueryui:function(a,c,e,n){b("<div/>").addClass(n.sSortJUIWrapper).append(c.contents()).append(b("<span/>").addClass(n.sSortIcon+" "+e.sSortingClassJUI)).appendTo(c);b(a.nTable).on("order.dt.DT",function(b,f,g,d){a===f&&(b=e.idx,c.removeClass(n.sSortAsc+" "+n.sSortDesc).addClass("asc"==d[b]?n.sSortAsc:"desc"==d[b]?n.sSortDesc:e.sSortingClass),c.find("span."+n.sSortIcon).removeClass(n.sSortJUIAsc+" "+n.sSortJUIDesc+" "+n.sSortJUI+" "+n.sSortJUIAscAllowed+" "+n.sSortJUIDescAllowed).addClass("asc"==
d[b]?n.sSortJUIAsc:"desc"==d[b]?n.sSortJUIDesc:e.sSortingClassJUI))})}}});C.render={number:function(a,b,c,e,n){return{display:function(f){if("number"!==typeof f&&"string"!==typeof f)return f;var g=0>f?"-":"",d=parseFloat(f);if(isNaN(d))return f;f=Math.abs(d);d=parseInt(f,10);f=c?b+(f-d).toFixed(c).substring(2):"";return g+(e||"")+d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f+(n||"")}}},text:function(){return{display:function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;"):a}}}};b.extend(C.ext.internal,{_fnExternApiFunc:Bb,_fnBuildAjax:P,_fnAjaxUpdate:V,_fnAjaxParameters:ia,_fnAjaxUpdateDraw:ra,_fnAjaxDataSrc:ua,_fnAddColumn:l,_fnColumnOptions:t,_fnAdjustColumnSizing:q,_fnVisibleToColumnIndex:u,_fnColumnIndexToVisible:e,_fnVisbleColumns:B,_fnGetColumns:y,_fnColumnTypes:G,_fnApplyColumnDefs:L,_fnHungarianMap:a,_fnCamelToHungarian:k,_fnLanguageCompat:m,_fnBrowserDetect:r,_fnAddData:z,_fnAddTr:M,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==d?b._DT_RowIndex:
null},_fnNodeToColumnIndex:function(a,c,e){return b.inArray(e,a.aoData[c].anCells)},_fnGetCellData:E,_fnSetCellData:I,_fnSplitObjNotation:S,_fnGetObjectDataFn:F,_fnSetObjectDataFn:A,_fnGetDataMaster:J,_fnClearTable:K,_fnDeleteIndex:w,_fnInvalidate:O,_fnGetRowElements:Q,_fnCreateTr:H,_fnBuildHead:ca,_fnDrawHead:R,_fnDraw:D,_fnReDraw:n,_fnAddOptionsHtml:v,_fnDetectHeader:x,_fnGetUniqueThs:W,_fnFeatureHtmlFilter:Ca,_fnFilterComplete:qa,_fnFilterCustom:Fa,_fnFilterColumn:nb,_fnFilter:mb,_fnFilterCreateSearch:Ta,
_fnEscapeRegex:Ga,_fnFilterData:ob,_fnFeatureHtmlInfo:kb,_fnUpdateInfo:rb,_fnInfoMacros:sb,_fnInitialise:ya,_fnInitComplete:Da,_fnLengthChange:Ua,_fnFeatureHtmlLength:hb,_fnFeatureHtmlPaginate:lb,_fnPageChange:Wa,_fnFeatureHtmlProcessing:ib,_fnProcessingDisplay:ja,_fnFeatureHtmlTable:jb,_fnScrollDraw:wa,_fnApplyToChildren:na,_fnCalculateColumnWidths:Qa,_fnThrottle:Ea,_fnConvertToWidth:tb,_fnGetWidestNode:ub,_fnGetMaxLenString:vb,_fnStringToCss:aa,_fnSortFlatten:ta,_fnSort:gb,_fnSortAria:xb,_fnSortListener:Xa,
_fnSortAttachListener:Ra,_fnSortingClasses:Ia,_fnSortData:wb,_fnSaveState:Ja,_fnLoadState:yb,_fnSettingsFromNode:Ka,_fnLog:oa,_fnMap:la,_fnBindAction:Ya,_fnCallbackReg:fa,_fnCallbackFire:X,_fnLengthOverflow:Va,_fnRenderer:Sa,_fnDataSource:ea,_fnRowAttributes:U,_fnCalculateEnd:function(){}});b.fn.dataTable=C;C.$=b;b.fn.dataTableSettings=C.settings;b.fn.dataTableExt=C.ext;b.fn.DataTable=function(a){return b(this).dataTable(a).api()};b.each(C,function(a,c){b.fn.DataTable[a]=c});return b.fn.dataTable});window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(b){return function(){var h={};return{check_message:function(c){var d,a;if(c.is_box())if(d=c.get_size(),1>d)c.display_message("Function birds can only respond to boxes with holes.");else if(a=c.get_hole_contents(0)){if(a.is_bird())return{box_size:d,bird:a};c.display_message("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+b.UTILITIES.add_a_or_an(a.get_type_name()+"."))}else c.display_message("Function birds can only respond to boxes with something in the first hole.");
else c.display_message("Function birds can only respond to boxes. One was given "+b.UTILITIES.add_a_or_an(c.get_type_name()))},process_response:function(b,d,a,k,m){b&&d.widget_side_dropped_on_me(b,void 0,m,!0,!0);a.remove(void 0,!0)},process_message:function(b,d,a,k){var m=this.check_message(b);if(m)return d=d(m.bird,m.box_size),1<b.get_size()&&b.get_hole_contents(1).remove(a,!0),this.process_response(d,m.bird,b,a,k),d},type_check:function(c,d,a,k){if(d.is_nest()&&!d.has_contents())throw b.sounds&&
b.sounds.bird_fly.pause(),{wait_for_nest_to_receive_something:d};if(!c)return!0;if(!d)return b.UTILITIES.display_message("Birds for the "+a+" function can only respond to boxes with "+b.UTILITIES.add_a_or_an(c)+" in the "+b.UTILITIES.ordinal(k)+" hole. The "+b.UTILITIES.ordinal(k)+" hole is empty."),!1;if(d.dereference().is_of_type(c))return!0;d.display_message("Birds for the "+a+" function can only respond to boxes with "+b.UTILITIES.add_a_or_an(c)+" in the "+b.UTILITIES.ordinal(k)+" hole. The "+
b.UTILITIES.ordinal(k)+" hole contains "+b.UTILITIES.add_a_or_an(d.get_type_name()+"."));return!1},number_check:function(b,d,a){return this.type_check("number",b,d,a)},n_ary_widget_function:function(b,d,a,k,m,f){var g=function(f,g){var l,m,h,u;if(1===g)return d();m=1;h=b.get_hole_contents(m).dereference();if(u=this.number_check(h,k,m)){for(m++;m<g;){l=b.get_hole_contents(m).dereference();u=this.number_check(l,k,m);if(!u)return;a.call(h,l);m++}return h}}.bind(this);return this.process_message(b,g,
m,f)},n_ary_function:function(b,d,a,k,m,f){var g=function(f,g){var l,m,h,u,e;if(g<a+1)b.display_message("Birds for the "+k+" function can only respond to boxes with at least "+(a+1)+" holes. Not "+g+" holes.");else{h=[];for(m=1;m<g;){l=b.get_hole_contents(m).dereference();u=this.number_check(l,k,m);if(!u)return;l.get_approximate&&l.get_approximate()&&(e=!0);h.push(l.get_value());m++}l=d.apply(null,h);e&&(l.set_approximate(!0),l.set_format("decimal"));return l}}.bind(this);return this.process_message(b,
g,m,f)},typed_bird_function:function(b,d,a,k,m,f,g){var h=function(f,g){var h,q,u,e;if(0<=k&&g!=k+1)b.display_message("Birds for the "+m+" function can only respond to boxes with "+(k+1)+" holes. Not "+g+" holes.");else{u=[];for(q=1;q<g;){h=b.get_hole_contents(q).dereference();q<=a.length&&(e=a[q-1]);if(!this.type_check(e,h,m,q))return;u.push(h);q++}return d.apply(b,u)}}.bind(this);return this.process_message(b,h,f,g)},numeric_javascript_function_to_widget_function:function(c,d,a){return function(){var k=
b.number.ZERO(b.number.function_bird_results_default_format);k.set_value_from_decimal(c.apply(null,b.UTILITIES.map_arguments(arguments,a||bigrat.toDecimal)));d&&(k.set_approximate(!0),k.set_format("decimal"));return k}},bigrat_function_to_widget_function:function(c,d){return function(){var a=b.number.create_from_bigrat(c.apply(null,arguments));d&&d(arguments)&&(a.set_approximate(!0),a.set_format("decimal"));return a}},add_function_object:function(c,d,a,k,m){h[c]={name:c,short_name:k||c,respond_to_message:d,
get_description:m?1===m.length?function(){return"If you give me a box with another bird and "+b.UTILITIES.add_a_or_an(m[0])+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+b.UTILITIES.conjunction(m,!0)+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+
b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."},toString:function(){return b.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:a}},get_function_table:function(){return h}}}}(window.TOONTALK);window.TOONTALK.widget=function(b){var h=function(b){if(b=this.get_frontside&&this.get_frontside(b))return b.get_element()};b.creators_from_json.top_level=function(c){c=b.widget.create_top_level_widget(c.settings);c.get_backside(!0);return c};return{add_standard_widget_functionality:function(c){var d=function(){return!1},a;this.add_sides_functionality(c);this.runnable(c);this.stackable(c);this.animatable(c);this.has_title(c);this.has_parent(c);this.has_backside_widgets(c);this.has_description(c);
this.has_listeners(c);this.droppable(c);this.erasable(c);c.this_and_walk_children=function(a){a(c)&&c.walk_children&&c.walk_children(a)};c.top_level_widget=function(){var c;if(a)return a;if(this.is_top_level())return this;if(a=b.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")))return a=a.get_widget();if(c=this.get_parent_of_frontside()||this.get_parent_of_backside())return a=c.get_widget().top_level_widget();c=$(".toontalk-backside-of-top-level");
if(0<c.length)return a=b.UTILITIES.widget_side_of_element(b.UTILITIES.closest_element(c,$(this.get_frontside_element()).offset())).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return a=this.create_top_level_widget()};c.is_of_type||(c.is_of_type=function(a){return this.get_type_name()===a});c.dereference||(c.dereference=function(){return this});c.get_default_description||(c.get_default_description=function(){return b.UTILITIES.add_a_or_an(this.get_type_name())+
"."});c.is_number||(c.is_number=d);c.is_box||(c.is_box=d);c.is_empty_hole||(c.is_empty_hole=d);c.is_hole||(c.is_hole=d);c.is_scale||(c.is_scale=d);c.is_bird||(c.is_bird=d);c.is_nest||(c.is_nest=d);c.is_robot||(c.is_robot=d);c.is_element||(c.is_element=d);c.is_sensor||(c.is_sensor=d);c.is_function_nest||(c.is_function_nest=d);c.is_plain_text_element||(c.is_plain_text_element=d);c.is_attribute_widget||(c.is_attribute_widget=d);c.maintain_proportional_dimensions||(c.maintain_proportional_dimensions=
d);c.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};c.set_name&&(c.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});c.get_width||(c.get_width=function(){return b.UTILITIES.get_element_width(c.get_frontside_element())});c.get_height||(c.get_height=function(){return b.UTILITIES.get_element_height(c.get_frontside_element())});!b.debugging&&!b.logging||c.to_debug_string||(c.to_debug_string=function(a){var b=this.get_parent_widget_of_frontside(),
c=this._debug_id,g=this.get_description(),g=g?g+" ":"";c||(c=b&&b.id?"id of parent is "+b.id:"");g&&(g+=" ");return(this.toString({plain_text:!0})+" ("+g+(this.get_name&&this.get_name()+" "||"")+c+")").substring(0,a)});c.is_top_level=d;c.is_widget=!0},erasable:function(b){var d;b.get_erased||(b.get_erased=function(){return d});b.set_erased||(b.set_erased=function(a,b){d=a;b&&this.rerender()})},add_sides_functionality:function(c){var d,a,k;c.get_frontside||(c.get_frontside=function(a){a&&!d&&(d=b.frontside.create(c));
return d},c.save_dimensions=function(){return this.save_dimensions_of(this)},c.save_dimensions_of=function(a){var b;if(a.is_element()){if(!this.get_original_width())return;b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0},c.restore_dimensions=function(){var a,c;0<this.saved_width&&(a=this.get_frontside_element(!0),this.ok_to_set_dimensions()?this.use_scaling_transform?
this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):b.UTILITIES.set_css(a,{width:this.saved_width,height:this.saved_height}):(c={width:"",height:""},b.UTILITIES.set_css_transform(c,""),b.UTILITIES.set_css(a,c)),this.saved_height=this.saved_width=void 0)});c.get_backside||(c.get_backside=function(b){b&&!a&&(a=this.create_backside(),this.backside_widgets_json_views&&a.add_backside_widgets(this.get_backside_widgets(),
this.backside_widgets_json_views));return a});c.set_backside||(c.set_backside=function(b){a=b});c.forget_backside||(c.forget_backside=function(){var b;if(a){if(b=a.get_element())$(b).remove(),b.toontalk_widget_side=void 0;a=void 0}});c.create_backside||(c.create_backside=function(){return b.backside.create(c)});c.get_open_backside_only_if_stopped||(c.get_open_backside_only_if_stopped=function(){return k});c.set_open_backside_only_if_stopped||(c.set_open_backside_only_if_stopped=function(a){k=a})},
runnable:function(c){var d=!1,a=!1;c.get_running||(c.get_running=function(a){var b=!1;if(a)return d;if(d)if(a=this.get_backside_widgets(),0===a.length)d=!1;else for(a.some(function(a){if(a&&(a=a.get_widget(),a.get_running()))return b=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return b});c.is_ok_to_run||(c.is_ok_to_run=function(){return a},c.set_ok_to_run=function(b){a=
b});c.set_running||(c.set_running=function(k,m,f){var g=d===k,h,p;a=k;h=this.get_backside_widgets();(d=k)&&b.logging&&0<=b.logging.indexOf("running")&&console.log(this._debug_string.substring(0,100)+" running.");this.get_backside()&&!g&&this.get_backside().run_status_changed(d);b.UTILITIES.for_each_batch(h,function(a){a&&(p=a.get_widget(),a.is_backside()&&(0<=this.get_backside_widgets().indexOf(p)||!a.is_primary_backside())||(!p.is_robot()||p.being_trained||p.get_body().is_empty()?p.set_running&&
(!m&&a.is_backside()&&"top-level"!==c.get_type_name()?p.set_running(k,c,!0):p.set_running(k)):d?(d&&b.logging&&0<=b.logging.indexOf("running")&&console.log(p._debug_string.substring(0,100)+" running."),p.set_stopped(!1),p.run(c,f,m),p.set_ok_to_run(!0)):(p.set_stopped(!0),p.set_running(!1)),p.rerender()))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(d);return!0});this.is_robot()&&(d?c.get_parent_of_backside()&&(this.set_stopped(!1),this.run(c.get_parent_of_backside().get_widget())):
this.set_stopped(!0));g||this.rerender()})},droppable:function(b){b.drop_on||(b.drop_on=function(b,a,c){if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,a,c);console.log("No handler for drop of '"+this+"' on '"+b+"'")})},stackable:function(b){var d=!1;b.get_infinite_stack||(b.get_infinite_stack=function(){return d});b.set_infinite_stack||(b.set_infinite_stack=function(a){var k=b.get_backside_element(),m=b.get_frontside_element();d=a;k&&$(k).find(".toontalk-infinite-stack-check-box").prop("checked",
a);m&&(a?$(m).addClass("toontalk-infinite-stack"):$(m).removeClass("toontalk-infinite-stack"))})},animatable:function(c){var d;c.animate_to_widget||(d=function(a,c){var d=a.get_element();d&&(a.is_backside()||b.UTILITIES.visible_element(d))||(d=b.UTILITIES.find_resource_equal_to_widget(a,c));return d},c.animate_to_widget=function(a,b,c,f,g,h,p,l){var t=function(){this.animate_to_element(d(a,l),b,c,f,g,h,p&&Math.max(0,p-100));this.rerender()}.bind(this);0===p?t():setTimeout(t,100)});c.animate_to_element||
(c.animate_to_element=function(a,c,d,f,g,h,p){var l=$(a).offset(),t=this.get_frontside_element(),q=$(a).is(".toontalk-backside");if(a&&b.UTILITIES.visible_element(a)&&0!==d){if("number"===typeof a.animation_left_offset)f=a.animation_left_offset;else if("undefined"===typeof f||q)f=(b.UTILITIES.get_element_width(a)-b.UTILITIES.get_element_width(t))*Math.random();if("number"===typeof a.animation_top_offset)g=a.animation_top_offset;else if("undefined"===typeof g||q)g=(b.UTILITIES.get_element_height(a)-
b.UTILITIES.get_element_height(t))*Math.random();l?(l.left+=f,l.top+=g):l={left:0,top:0};this.animate_to_absolute_position(l,c,d,h,p)}else c&&c()});c.animate_to_absolute_position||(c.animate_to_absolute_position=function(a,c,d,f,g){b.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),a,c,d,f,g)})},has_title:function(c){c.get_title||(c.get_title=function(){var c=this.get_type_name(),a=this.get_backside(),k=this.get_frontside_element(),h=this.get_description(),f="";$(k).is(".toontalk-top-level-resource")?
f=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":a&&a.get_element()&&b.UTILITIES.visible_element(a.get_element())||b.open_backside_only_if_alt_key||(f=this.can_run&&this.can_run(!0)?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+
" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my backside and then click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+".":"Click to see my backside.");h&&(h="I'm "+h,f=f?h+"\n"+f:h);if(this.get_erased())return this.get_title_of_erased_widget();f=this.get_custom_title_prefix&&!$(k).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+f:"I'm "+b.UTILITIES.add_a_or_an(c)+". "+f;
f=f.trim();0>".?!".indexOf(f[f.length-1])&&(f+=".");return f});c.update_title=function(){var c=this.get_frontside_element();c&&b.UTILITIES.give_tooltip(c,this.get_title())}},inside_conditions_container:function(){return $(this.get_frontside_element()).closest(".toontalk-conditions-container").is("*")},get_title_of_erased_widget:function(){var b=this.get_type_name();return this.inside_conditions_container()?"I'm an erased "+b+".\nI'll match with any other "+b+".":"I'm an erased "+b+".\nDusty the Vacuum can restore me to normal."},
has_parent:function(c){var d=[],a,k,h,f;c.get_parent_of_frontside=function(){return h&&a?a.get_backside(!0):a};c.get_parent_widget_of_frontside=function(){return a};c.get_containing_widget=function(){return a&&a.is_hole()?a.get_parent_widget_of_frontside():this.get_parent_of_frontside()||this};c.parent_of_frontside_is_backside=function(){return h};c.set_parent_of_frontside=function(b,c,f){var k=a;h=c;a!==b&&(a=b,k&&!f&&!c&&k.is_backside()&&k.get_widget().remove_backside_widget(this,!0),d.forEach(function(b){b(k,
a)}))};c.add_parent_of_frontside_change_listener=function(a){d.push(a)};c.remove_parent_of_frontside_change_listener=function(a){a=d.indexOf(a);0<=a&&d.splice(a,1)};c.get_parent_of_backside=function(){return f&&k?k.get_backside(!0):k};c.set_parent_of_backside=function(a,b,c){void 0===a&&!c&&f&&k&&k.get_widget().remove_backside_widget(this.get_backside(),!0);k=a;f=b};c.parent_of_backside_is_backside=function(){return f};c.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?
a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};c.closest_visible_ancestor_or_frontside=function(){for(var a=this,c;a&&!b.UTILITIES.visible_element(a.get_frontside_element());)c=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=c.get_widget()):a=a.get_parent_of_frontside();return a||this};c.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};c.has_ancestor=function(a){var b;
return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};c.remove_from_parent_of_frontside=function(b){a&&(a.is_backside()?a.remove_backside_widget(this,!b):a.removed_from_container?h?a.remove_backside_widget(this,!0):a.removed_from_container(this,b):a.get_backside()&&a.remove_backside_widget(this,!b))}},has_description:function(b){var d;b.get_description||(b.get_description=function(){return d});b.set_description||(b.set_description=function(a,b,c){if(d===a||!d&&""===a)return!1;
d=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_description",argument_1:a,toString:"change the description to '"+a+"'' of the "+this.get_type_name(),button_selector:".toontalk-description-input"});return!0});b.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},has_name:function(b){var d;b.get_name||(b.get_name=function(){"string"!==typeof d&&b.generate_name&&
(d=b.generate_name());return d});b.set_name||(b.set_name=function(a,b,c){if(d===a||"string"!==typeof a)return!1;d=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_name",argument_1:a,toString:"change the name of the "+this.get_type_name()+' to "'+d+'"',button_selector:".toontalk-name-input"});return!0})},has_listeners:function(c){var d={};c.add_listener||(c.add_listener=function(a,b){var c=d[a];c?0>c.indexOf(b)&&c.push(b):d[a]=[b]});c.remove_listener||
(c.remove_listener=function(a,c,h){if(a=d[a])if(c=a.indexOf(c),0<=c){a.splice(c,1);return}!h&&b.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});c.get_listeners||(c.get_listeners=function(a){return d[a]})},add_speech_listeners:function(c){b.listen&&(c.widget=this,this.add_listener("picked up",function(){b.UTILITIES.listen_for_speech(c)}),this.add_listener("dropped",function(){b.UTILITIES.stop_listening_for_speech()}))},get_full_description:function(b){var d;if(this.get_erased&&
this.get_erased())return b&&"conditions"===b.role?"any "+this.get_type_name():"erased "+this.get_type_name();d=this.get_description(b);b=this.toString(b);return d?b+" ("+d+")":b},remove:function(b,d){var a=this.get_backside(),k=this.get_frontside(),h=this.get_parent_of_frontside();a&&this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level()&&a.hide_backside();k&&k.remove();h&&this.remove_from_parent_of_frontside(b);this.get_running()&&this.set_running(!1);this.set_visible(!1);this.walk_children&&
!d&&this.walk_children(function(a){a.remove&&a.remove();return!0})},get_frontside_element:h,get_element:h,get_backside_element:function(b){if(b=this.get_backside&&this.get_backside(b))return b.get_element()},add_to_json:function(c,d){var a,k,h,f,g,r;if(c){c.view?(k=c,a=c.view,c=c.semantic):(a={},k={semantic:c,view:a});k.version=1;this.get_erased&&this.get_erased()&&(c.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(c.infinite_stack=!0);this.get_open_backside_only_if_stopped&&this.get_open_backside_only_if_stopped()&&
(c.open_backside_only_if_stopped=!0);this.get_running&&this.get_running()&&(c.running=!0);g=this.get_parent_widget_of_frontside();if(!g||this.parent_of_frontside_is_backside()||g.is_element())if(f=this.get_frontside_element&&this.get_frontside_element())if(r=$(f).width(),$(f).is(".toontalk-plain-text-element")||0===r||(a.frontside_width=$(f).width(),a.frontside_height=$(f).height()),0!==r&&(a.frontside_left=b.UTILITIES.get_style_numeric_property(f,"left"),a.frontside_top=b.UTILITIES.get_style_numeric_property(f,
"top")||h&&h.frontside_top,void 0===a.frontside_left&&(h=g&&g.get_widget().get_backside_widgets_json_views())))f=this.get_parent_of_frontside().get_widget().get_backside_widgets().indexOf(this),0<=f&&(a.frontside_left=h[f].frontside_left,a.frontside_top=h[f].frontside_top);if(f=this.get_backside()){if(g=f.get_element()){if(f.get_backside_dimensions()||f.is_top_level())a.backside_width=$(g).width(),a.backside_height=$(g).height();a.backside_left||(h=$(g).position(),a.backside_left=h.left,a.backside_top=
h.top,"&lt;"===$(g).find(".toontalk-settings-backside-button").html()&&(a.advanced_settings_open=!0))}f.get_backside_dimensions()&&(a.backside_geometry=f.get_backside_dimensions())}!a.backside_geometry&&this.backside_geometry&&(a.backside_geometry=this.backside_geometry);void 0===a.frontside_left&&this.json_view&&(a.frontside_left=this.json_view.frontside_left,a.frontside_top=this.json_view.frontside_top);c.description=this.get_description&&this.get_description();a.saved_width=this.saved_width;a.saved_height=
this.saved_height;return k}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(c,d,a,k){var h=this.get_backside_widgets(),f,g;0<h.length?(c.semantic.backside_widgets=[],(f=this.get_backside_widgets_json_views())&&f.forEach(function(a,b){var k;if(g=c.semantic.backside_widgets[b]){if(0<=g.widget.shared_widget_index){k=d.widgets_encountered.indexOf(d.shared_widgets[g.widget.shared_widget_index]);if(!d.json_of_widgets_encountered[k])return;k=d.json_of_widgets_encountered[k].view}else k=
g.widget.view;g.is_backside?a.backside_left&&(k.backside_left=a.backside_left,k.backside_top=a.backside_top):a.frontside_left&&(k.frontside_left=a.frontside_left,k.frontside_top=a.frontside_top)}else h[b].json_view=f[b]}),b.UTILITIES.get_json_of_array(h,c.semantic.backside_widgets,0,d,a,k)):a()},has_backside_widgets:function(c){var d=[];c.get_backside_widgets=function(){return d};c.add_backside_widget=function(a){var c;if(a){c=this.get_backside(!0);if(b.debugging){if(a===this){b.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");
return}if(a.get_widget()===this){b.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}d?0>d.indexOf(a)&&d.push(a):d=[a];b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Added "+a+" to backside widgets of "+this+". Number of backside widgets is "+d.length);a.is_backside()?a.set_parent_of_backside(c,!0):a.set_parent_of_frontside(this,!0);c.visible()&&a.set_visible(!0)}else b.debugging&&b.UTILITIES.report_internal_error("adding undefined to backside widgets.")};
c.remove_all_backside_widgets=function(){d&&b.UTILITIES.for_each_batch(d.slice(),function(a){a.remove()})};c.remove_backside_widget=function(a,c){var h=d.indexOf(a);0>h?c||b.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+a.get_widget()+" ("+a.get_widget()._debug_id+")"):(d.splice(h,1),b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Removed "+a+" from backside widgets of "+this+". Number of backside widgets is "+d.length),this.backside_widgets_json_views&&
this.backside_widgets_json_views.splice(h,1),a.is_backside()?(h=a.get_parent())&&h.get_widget()===this&&a.set_parent_of_backside(void 0,!0,!0):(h=a.get_parent_of_frontside())&&h.get_widget()===this&&a.set_parent_of_frontside(void 0,void 0,!0),a.set_visible(!1))};c.set_backside_widgets=function(a,c){var h=this.get_backside(),f=h&&h.visible();d=a;b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Set backside widgets "+d.length+" widgets of "+(f?"visible ":"invisible ")+this);0<d.length&&
(h?h.add_backside_widgets(d,c):this.backside_widgets_json_views=c,b.UTILITIES.for_each_batch(d,function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),f&&a.set_visible(f))}.bind(this)))}},get_backside_widgets_json_views:function(b){!this.backside_widgets_json_views&&b&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var b=!1,d;this.get_backside_widgets().some(function(a){if(!a)return!1;d=a.get_widget();
if(d.get_body&&!d.get_body().is_empty()||d.can_run())return b=!0});this.walk_children&&this.walk_children(function(a){if(a.can_run())b=!0;else return!0});return b},add_to_copy:function(c,d){var a;this.get_erased&&this.get_erased()&&(c.set_erased||b.widget.erasable(c),c.set_erased(this.get_erased()));d&&d.just_value||(a=this.get_backside_widgets(),0<a.length&&c.set_backside_widgets(b.UTILITIES.copy_widget_sides(a,d),this.get_backside_widgets_json_views()));c.set_running(this.get_running());return c},
get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(c,d,a){var k=this.visible(),h,f,g,r,p;c||(c=this.copy({}));h=this.get_frontside_element(k);f=c.get_element(k);g=$(h).closest(".toontalk-backside");r=c.ok_to_set_dimensions();0===g.length&&(g=$(this.top_level_widget().get_backside_element()));p=b.UTILITIES.widget_side_of_jquery(g);k&&("undefined"===typeof d&&(d=30),"undefined"===typeof a&&(a=30),k=b.UTILITIES.relative_position(h,
g.get(0)),0<g.length&&g.get(0).appendChild(f),b.UTILITIES.set_css(f,{width:r?$(h).width():"",height:r?$(h).height():"",left:k.left+d,top:k.top+a,"z-index":b.UTILITIES.next_z_index()}));p&&p.add_backside_widget(c);return c},visible:function(){var b;return document.hidden?!1:(b=this.get_frontside())?b.visible():!1},set_visible:function(b){var d=this.get_frontside(b);d&&d.set_visible(b)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(b){this.set_parent_of_frontside(b)},
drag_started:function(b,d){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,d)},match:function(b){console.assert(!1,"match not implemented for "+b.toString())},removed:function(c){b.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(c,d){var a=this.get_backside(),k,h,f,g,r,p,l,t,q,u,e;if(a&&b.UTILITIES.visible_element(a.get_element()))$(a.get_element()).css({opacity:1}),c&&c();else{k=
c&&function(){setTimeout(c)};h=function(a,c){b.UTILITIES.set_timeout(function(){$(a).addClass("toontalk-side-appearing");b.UTILITIES.add_one_shot_event_handler(a,"transitionend",d||2500,function(){$(a).removeClass("toontalk-side-appearing");k&&k()});$(a).css({left:l,top:t,opacity:c});this.apply_backside_geometry()}.bind(this))}.bind(this);g=this.get_frontside_element(!0);r=$(g).parent();for(a=$(g);0<r.length&&!r.is(".toontalk-backside");)a=r,r=r.parent();a.get(0);a=this.get_backside(!0);f=a.get_element();
f.toontalk_widget_side=a;q=$(g).offset();u=r.offset();e=r.width();u||(u={left:0,top:0});$(f).css({left:q.left-u.left,top:q.top-u.top,opacity:.01});0<r.length?r.get(0).appendChild(f):($(f).css({textAlign:"left"}),g.appendChild(f));(r=b.UTILITIES.widget_side_of_jquery(r))&&r.add_backside_widget(a);r=this.is_element()?this.get_attribute("height"):$(g).height();g=$(f).width();l=q.left-u.left;l+g>e&&(l=Math.max(0,e-g));t=q.top-u.top+r+34;this.is_box()&&(t+=28);h(f,"inherit");a.set_visible(!0);p=this.get_backside_widgets();
0<p.length&&p.forEach(function(a){a.is_backside()&&0<=p.indexOf(a.get_widget())?a.hide_backside():(a.set_visible(!0),f.appendChild(a.get_element(!0)))}.bind(this));return a}},hide_backside:function(){var b=this.get_backside();b&&b.hide_backside()},apply_backside_geometry:function(){var b=this.get_backside(!0),d=b.get_element();this.backside_geometry&&d&&(b.scale_backside(d,this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),
b.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(b){this.top_level_widget().robot_started_training(b)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},backup_all:function(b){var d=this.top_level_widget();d&&d.save(b)},render:function(){b.DISPLAY_UPDATES.pending_update(this)},
rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},location_constrained_by_container:function(){var b;return this.is_nest()||this.being_dragged?!1:(b=this.get_parent_of_frontside())&&(b.is_hole()||b.is_nest()||b.is_robot())?!0:!1},close_button_ok:function(b){return"top-level"!==this.get_type_name()&&!$(b).is(".toontalk-top-level-resource")&&!$(b).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(b,
d){var a=this.top_level_widget(),k;b||(b=this);k=b.get_element(!0);a.add_backside_widget(b);a.get_backside_element().appendChild(k);b.render();d&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,a);return k},get_selection:function(){return this},display_message:function(c,d){d.display_on_backside_if_possible?(d.element=this.get_backside_element(),d.second_choice_element=this.get_frontside_element()):d.element=this.get_frontside_element();b.UTILITIES.display_message(c,d)},get_speak_function:function(c){return function(d,
a,k){a=function(a){var t,q;if(a){if(!window.speechSynthesis)return a.display_message("This browser doesn't support speech output. Try another browser such as Chrome."),!0;a=a.get_widget();t=a.get_text?a.get_text(!0):a.toString();b.TRANSLATION_ENABLED?b.UTILITIES.translate(t,function(a){q=function(e){var f=b.element.create(a,[],"a response to speaking '"+t+"'");c.process_response(f,h.bird,d,e,k)};b.UTILITIES.speak(a,q,f,g,r,p)}):(q=function(a){var e=b.element.create(t,[],"a response to speaking '"+
t+"'");c.process_response(e,h.bird,d,a,k)},b.UTILITIES.speak(t,q,f,g,r,p))}else b.UTILITIES.display_message("Speaking birds need something in the second box hole.")};var h=c.check_message(d),f,g,r,p;if(h)if(2>h.size)b.UTILITIES.display_message("Speaking birds need a box with two or more holes.");else return(f=d.get_hole_contents(2))&&(f=f&&f.to_float&&f.to_float()),(g=d.get_hole_contents(3))&&(g=g&&g.to_float&&g.to_float()),(r=d.get_hole_contents(4))&&(r=r&&r.to_float&&r.to_float()),(p=d.get_hole_contents(5))&&
(p=p&&p.to_float&&p.to_float()),a(d.get_hole_contents(1)),!0}},get_listen_function:function(c,d){return function(a,k,h){var f=c.check_message(a),g,r,p,l;if(f)if(1>f.size)b.UTILITIES.display_message("Listening birds need a box with one or more holes.");else{if(!window.webkitSpeechRecognition&&!window.SpeechRecognition)return widget.display_message("This browser doesn't support speech input. Try another browser such as Chrome."),!0;if(p=a.get_hole_contents(2))p=p&&p.to_float&&p.to_float(),0>p?p=0:1<
p&&(p=1);d||(l=a.get_hole_contents(3))&&(l=l.get_text());g=d?function(f){f=parseFloat(f);isNaN(f)||(f=b.number.create_from_bigrat(bigrat.fromDecimal(f)),f.set_description("a number that was heard"),c.process_response(f,a.get_hole_contents(0),a,k,h),b.UTILITIES.stop_listening_for_speech())}:function(f){f=b.element.create(f,[],"what was spoken");c.process_response(f,a.get_hole_contents(0),a,k,h);b.UTILITIES.stop_listening_for_speech()};r=function(g){var d;1<f.size&&a.get_hole_contents(1)&&(d=b.element.create(g.error,
[],"description of a problem listening to speech"),c.process_response(d,a.get_hole_contents(1),a,g,h));b.UTILITIES.stop_listening_for_speech()};b.UTILITIES.listen_for_speech({commands:l,confidence:p,numbers_acceptable:d,success_callback:g,fail_callback:r});return!0}}},get_description_function:function(c){return function(d,a,k){var h=function(g){var h,m;g?(m=function(l){l=b.element.create(l,[],g.toString());c.process_response(l,f.bird,d,a,k)},g=g.get_widget(),h=g.get_text?g.get_text(!0):g.toString(),
b.TRANSLATION_ENABLED?b.UTILITIES.translate(h,function(a){m(a)}):m(h)):b.UTILITIES.display_message("Description birds need something in the second box hole.")},f=c.check_message(d);if(f)if(2>f.size)d.display_message("Description birds need a box with two holes containing a bird and a widget.");else return h(d.get_hole_contents(1)),!0}},create_top_level_widget:function(c){var d=Object.create(b.widget),a=[],k=function(){return!1},h=!1;c||(c={});d.is_top_level=function(){return!0};d.is_number=k;d.is_box=
k;d.is_empty_hole=k;d.is_scale=k;d.is_bird=k;d.is_nest=k;d.is_robot=k;d.is_element=k;d.is_sensor=k;d.is_function_nest=k;d.is_hole=k;d.is_plain_text_element=k;d.is_attribute_widget=k;d.ok_to_set_dimensions=k;d.get_json=function(a,b,d){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");b({semantic:{type:"top_level",settings:c},view:{background_color:a}},d)};d.get_type_name=function(){return"top-level"};d.is_of_type=function(a){return"top-level"===
a};d.toString=function(){return"top level widget"};d.get_description=function(){};d.match=function(){return"matched"};d.update_display=function(){this.get_backside_widgets()&&b.UTILITIES.for_each_batch(this.get_backside_widgets().filter(function(a){return a&&a.visible()}),function(a){a.render()})};d.copy=function(){return this};d.visible=function(){return!document.hidden};d.get_parent_of_frontside=function(){};d.get_parent_of_backside=function(){};d.closest_visible_ancestor=function(){return this};
d.get_infinite_stack=function(){return!1};d.get_listeners=function(){return[]};d.top_level_widget=function(){return this};if(b.debugging||b.logging)d.to_debug_string=function(a){var b=$(this.get_backside_element()).offset();return("top-level widget at "+Math.round(b.left)+", "+Math.round(b.top)).substring(0,a)};d.add_sides_functionality(d);d.runnable(d);d.has_parent(d);d.has_backside_widgets(d);d.removed_from_container=function(a,b){this.robot_in_training()||this.remove_backside_widget(a,!0)};d.widget_side_dropped_on_me=
function(a,b,c,d){return this.get_backside().widget_side_dropped_on_me(a,b,c,d)};d.get_element=function(){return this.get_backside().get_element()};d.get_setting=function(a,g){"undefined"!==typeof c[a]||g||(c[a]=b.DEFAULT_SETTINGS&&b.DEFAULT_SETTINGS[a]);return c[a]};d.set_setting=function(a,b){c[a]=b};d.open_settings=function(){b.SETTINGS.open(d)};d.robot_in_training=function(){if(0<a.length)return a[a.length-1]};d.robot_training_this_robot=function(){if(1<a.length)return a[a.length-2]};d.robot_started_training=
function(b){a.push(b)};d.robot_finished_training=function(){a.pop()};d.save=function(a,c,d){var k=this.get_setting("program_name",b.reset),l=function(a){h=!1;t&&(q=b.google_drive.get_status(),"Ready"===q?(b.google_drive.upload_file(k,"json",JSON.stringify(a,b.UTILITIES.clean_JSON),d),d=void 0):b.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===q?(b.UTILITIES.display_message("Unable to save to your Google Drive because you need to log in. Click on the settings icon <span class='toontalk-settings-icon'></span> to log in.",
{only_if_new:!0}),b.UTILITIES.display_tooltip($(".toontalk-settings-button"))):console.log("Unable to save to Google Drive because: "+q)));c.local_storage&&this.save_to_local_storage(a);d&&d()}.bind(this),t,q;!h&&k&&(c||(c={}),"undefined"===typeof c.google_drive&&(c.google_drive=b.google_drive&&this.get_setting("auto_save_to_google_drive")),"undefined"===typeof c.local_storage&&(c.local_storage=this.get_setting("auto_save_to_local_storage")),a?(t=c.google_drive&&!this.get_setting("google_drive_unavailable")&&
0>b.TOONTALK_URL.indexOf("http://localhost"))||c.local_storage?(h=!0,b.UTILITIES.get_json_top_level(this,l)):d&&d():setTimeout(function(){this.save(!0,c,d)}.bind(this),100))};d.publish=function(a,c){b.publish.publish_widget(this.get_setting("program_name"),this,c,a)};d.save_to_local_storage=function(a,c){var d=this.get_setting("program_name"),k=b.UTILITIES.local_storage_program_key(d),l=b.UTILITIES.local_storage_program_meta_data_key(d),h=function(h){m=JSON.stringify(a,b.UTILITIES.clean_json);h||
(h={created:c});h.last_modified=c;h.file_size=m.length;b.UTILITIES.store_object(l,h);b.UTILITIES.store_string(k,m);b.UTILITIES.store_string("toontalk-last-key",k);b.UTILITIES.get_all_locally_stored_program_names(function(a){0>a.indexOf(d)&&(a.push(d),b.UTILITIES.set_all_locally_stored_program_names(a))})},m;c||(c=Date.now());try{b.UTILITIES.retrieve_object(l,h)}catch(u){h=m?"Failed to save state to local storage since it requires "+m.length+" bytes. Error message is "+u:"Error while saving to local storage. Error message is "+
u,b.UTILITIES.is_internet_explorer()?console.error("Unresolved difficulties using window.localStorage in IE11: "+h):b.UTILITIES.display_message(h),this.last_local_storage_error=h}};d.load=function(a,c,k){var h=this.get_setting("program_name"),l=h+".json",m=b.UTILITIES.local_storage_program_key(h),q=function(a){var f;if(a)try{f=JSON.parse(a),d.remove_all_backside_widgets(),b.UTILITIES.add_backside_widgets_from_json(d,f.semantic.backside_widgets,{json_of_shared_widgets:f.shared_widgets,shared_widgets:[],
shared_html:f.shared_html}),c&&c()}catch(l){b.UTILITIES.display_message("Error encountered loading "+h+" : "+l)}else k&&k()},u=function(a){a?b.google_drive.download_file(a,q):b.UTILITIES.retrieve_string(m,q)};a&&b.google_drive&&"Ready"===b.google_drive.get_status()?b.google_drive.get_toontalk_program_file(l,u):b.UTILITIES.retrieve_string(m,q)};d.walk_children=function(){};d.render=function(){};d.location_constrained_by_container=function(){return!1};d.dereference=function(){return this};d.is_widget=
!0;b.debugging&&(d._debug_id=b.UTILITIES.generate_unique_id(),d._debug_string="Top-level widget");d.get_backside(!0).set_visible(!0);return d}}}(window.TOONTALK);window.TOONTALK.backside=function(b){var h=function(c){var d=c.get_widget(),a=d.get_backside_widgets(),k=d.get_backside_widgets_json_views(!0);c.get_backside_dimensions();var m=c.get_element();b.UTILITIES.for_each_batch(a,function(a,c){var d=a.get_element(),p;d&&(k[c]||(k[c]={}),a.start_offset&&d.parentElement?(p=b.UTILITIES.relative_position_from_absolute_position(d.parentElement,a.start_offset),a.start_offset=void 0):p=$(d).position(),a.is_backside()?(k[c].backside_left=b.UTILITIES.left_as_percent(p.left,
d),k[c].backside_top=b.UTILITIES.top_as_percent(p.top,d),h(a)):(k[c].frontside_left=b.UTILITIES.left_as_percent(p.left,d,m),k[c].frontside_top=b.UTILITIES.top_as_percent(p.top,d,m)))})};return{create:function(c){var d=Object.create(this),a=document.createElement("div"),k=$(a),h=1,f=1,g=document.createElement("div"),r=document.createElement("div"),p=c.get_help_URL&&c.get_help_URL(),l=function(a){a?($(g).addClass("toontalk-green-flag-active toontalk-button").removeClass("toontalk-green-flag-inactive toontalk-button"),
$(r).addClass("toontalk-stop-sign-inactive toontalk-button").removeClass("toontalk-stop-sign-active toontalk-button")):($(g).addClass("toontalk-green-flag-inactive toontalk-button").removeClass("toontalk-green-flag-active toontalk-button"),$(r).addClass("toontalk-stop-sign-active toontalk-button").removeClass("toontalk-stop-sign-inactive toontalk-button"))},t=this.create_description_label(d,c),q=function(){var a;a=c.get_running()?"To stop this click on the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):
c.can_run()?"Click this to start this running.":"There is nothing to run on this.";b.UTILITIES.give_tooltip(g,a)},u=function(){var a;a=c.get_running()?"Click to stop this from running.":c.can_run()?"This has stopped. Click on the flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";b.UTILITIES.give_tooltip(r,a)},e=function(a){Q?(b.UTILITIES.add_iframe_popup(p),a.stopPropagation()):(A.href=p,A.target="_blank")},
B,y,G,L,z,M,E,I,S,F,A,J,K,w,O,Q,H;b.TRANSLATION_ENABLED&&p&&(p=b.UTILITIES.add_URL_parameter(p,"translate","1"));c.close_button_ok(a)&&(K=function(e){var f=function(){c.robot_in_training()&&c.robot_in_training()!==c&&c.robot_in_training().backside_closed(d);d.is_primary_backside()?d.hide_backside(e):d.remove()},g,l;c.get_running()?(g=c.get_backside_widgets(),g.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(f),l=a,!0}),l?(l.add_body_finished_listener(function(){l.visible()?
k.css({opacity:1}):(c.forget_backside(),b.DEFAULT_QUEUE.start());f()}),d.set_visible(!1)):f(),k.css({opacity:1}),k.addClass("toontalk-animating-element"),k.css({opacity:0}),b.UTILITIES.add_one_shot_event_handler(a,"transitionend",2E3,function(){c.forget_backside()})):f();e.stopPropagation()},J=(J=c.get_description())?"the "+c.get_type_name()+" who "+J:"the "+c.get_type_name(),F=b.UTILITIES.create_close_button(K,"Click to remove this backside of "+J+"."),a.appendChild(F));$(g).addClass("toontalk-green-flag toontalk-green-flag-inactive");
g.addEventListener("click",function(a){c.can_run()?(l(!0),c.set_running(!0),u(),b.DEFAULT_QUEUE.start()):c.is_top_level()?b.UTILITIES.display_message("There is nothing to run.",{element:a.target}):b.UTILITIES.display_message("This "+c.get_type_name()+" has nothing to run. Add some robots on the back.",{element:a.target});c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-green-flag",c);a.stopPropagation()});g.addEventListener("mouseenter",u);$(r).addClass("toontalk-stop-sign toontalk-stop-sign-active");
r.addEventListener("click",function(a){l(!1);c.set_running(!1);q();c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-stop-sign",c);a.stopPropagation();c.is_top_level()&&b.UTILITIES.stop_audio_objects()});r.addEventListener("mouseenter",q);a.appendChild(g);a.appendChild(r);b.UTILITIES.use_custom_tooltip(g);b.UTILITIES.use_custom_tooltip(r);p&&(Q=0>p.indexOf("://"),A=document.createElement(Q?"div":"a"),$(A).addClass("toontalk-help-button notranslate toontalk-widget-help-button"),
A.addEventListener("click",e),A.innerHTML="i",A.translate=!1,b.UTILITIES.give_tooltip(A,"Click to learn more about "+c.get_type_name(!0,!0)+"."),a.appendChild(A));t&&a.appendChild(t);c.is_top_level()&&(L=document.createElement("div"),$(L).addClass("toontalk-settings-button"),L.addEventListener("click",function(a){c.open_settings();a.stopPropagation()}),a.appendChild(L),b.UTILITIES.give_tooltip(L,"Click to change settings or open a different program."));k.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+
c.get_type_name());k.css({"z-index":b.UTILITIES.next_z_index()});b.UTILITIES.when_attached(a,function(){var e;d.inside_conditions_container()?($(g).hide(),$(r).hide(),$(A).hide(),$(F).hide(),e="This will match "+d.toString()+".",d.rerender()):c.is_robot()?e="On the back of the robot you can change the conditions and setting of the robot.":c.is_top_level()?e="This is a work area where you can drag things.":(H=c.toString({inside_tool_tip:!0}),e="You are pointing to the back of "+b.UTILITIES.add_a_or_an(H)+
". You can put robots on the back to make it come 'alive'.");b.UTILITIES.give_tooltip(a,e)});d.get_element=function(){return a};d.get_backside_element=function(){return a};d.get_widget=function(){return c};d.visible=function(){return document.hidden?!1:z};d.set_visible=function(a){z=a;!c.is_top_level()&&this.is_primary_backside()&&(this.get_widget().get_backside_widgets().forEach(function(b){b&&b!==this&&b.set_visible(a)}.bind(this)),z&&this.render())};d.get_erased=function(){return B};d.set_erased=
function(a,b,c){if(!a||c||this.inside_conditions_container())B=a,b&&this.rerender()};c.get_backside||(c.get_backside=function(){return d});d.is_primary_backside=function(){return this===this.get_widget().get_backside()};d.inside_conditions_container=function(){return $(this.get_element()).closest(".toontalk-conditions-panel, .toontalk-conditions-container").is("*")};d.get_width=function(){return b.UTILITIES.get_element_width(this.get_element())};d.get_height=function(){return b.UTILITIES.get_element_height(this.get_element())};
d.is_widget=!0;d.get_parent_of_backside=function(){return this.is_primary_backside()?c.get_parent_of_backside():G&&y?y.get_backside(!0):y};d.set_parent_of_backside=function(a,b){!a&&y&&G&&y.remove_backside_widget(this,!0);this.is_primary_backside()&&c.set_parent_of_backside(a,b);y=a;G=b};d.get_parent_of_frontside=function(){return c.get_parent_of_frontside()};d.is_parent_backside=function(){return c.is_parent_backside()};d.get_frontside=function(a){return c.get_frontside(a)};d.get_frontside_element=
function(a){return c.get_frontside_element(a)};d.get_description_text_area=function(){return w};d.set_description_text_area=function(a){w=a};d.get_name_text_input=function(){return O};d.set_name_text_input=function(a){O=a};d.removed_from_container=function(a,b,c,e){d.get_widget().robot_in_training()||this.remove_backside_widget(a,e)};d.drop_on=function(a,b,c){return a.widget_side_dropped_on_me&&a.widget_side_dropped_on_me(this,b,c)};d.widget_side_dropped_on_me=function(e,f,d,g){var n,k,l;if(!d||d.visible()||
this.visible())return this.visible()&&(b.sounds&&f&&b.sounds.drop.play(),n=e.get_element(this.visible()),e.rerender(),f?(a.appendChild(n),b.UTILITIES.set_position_is_absolute(n,!0,f)):(d&&(l=$(d.get_frontside_element()).offset()),l||(l=$(n).offset()),a.appendChild(n),!l||0===l.left&&0===l.top||b.UTILITIES.set_absolute_position(n,l))),this.get_widget().is_top_level()&&(d&&!d.visible()&&$(n).addClass("toontalk-widget-added-to-backside-by-unwatched-robot"),!f||e.is_backside()||e.is_sensor()||window.dispatchEvent(b.UTILITIES.create_event("widget added",
{element_widget:n,here:"back"}))),c.robot_in_training()&&!g&&f&&setTimeout(function(){c.robot_in_training().dropped_on(e,this,f)}.bind(this)),e.is_backside()&&e.get_widget().is_element()&&c.is_element()&&(g=e.get_widget(),g.set_backside(void 0),g.remove(f),g.set_backside(e)),this.add_backside_widget(e),e.dropped_on_other&&e.dropped_on_other(this,f,d),f&&e.get_body&&e.get_body().is_empty()&&!e.being_trained?setTimeout(function(){(k=e.open_backside())&&$(k.get_element()).find(".toontalk-train-backside-button").click()}):
f&&!e.is_backside()&&this.get_frontside_element()&&!e.is_sensor()&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:n,where:"back"})),f&&e.get_widget().backup_all(),!e.is_backside()&&e.is_robot()&&this.get_widget().get_running()&&!this.is_top_level()&&this.get_widget().set_running(!0),!0;this.add_backside_widget(e);e.dropped_on_other&&e.dropped_on_other(this,f,d)};d.add_backside_widget=function(a){return this.get_widget().add_backside_widget(a)};d.add_backside_widgets=
function(a,e){var f;0!==a.length&&(b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Adding "+a.length+" backside widgets to "+this),f=a.slice(),b.UTILITIES.set_timeout(function(){var d=this.visible(),n=this.get_element(),g,k,l,h;b.UTILITIES.for_each_batch(f,function(f,m){f&&(b.debugging&&f.get_widget()===c?(b.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),a.splice(m,1)):(e&&(l=e[m]),g=f.get_element(!0),g.parentElement||(n.appendChild(g),b.logging&&0<=
b.logging.indexOf("backside-widgets")&&console.log("Widget element added to backside element.")),g.toontalk_widget_side=f,l&&(f.is_backside()?(k=f.get_widget().get_backside(!0),h={left:l.backside_left,top:l.backside_top,width:l.backside_width,height:l.backside_height},f.get_widget().apply_backside_geometry(),l.advanced_settings_open&&k.set_advanced_settings_showing(!0,k.get_element())):(0===l.frontside_width&&(l.frontside_width=""),0===l.frontside_height&&(l.frontside_height=""),h={left:l.frontside_left,
top:l.frontside_top,width:g.style.transform?"":l.frontside_width||l.saved_width,height:g.style.transform?"":l.frontside_height||l.saved_height}),b.UTILITIES.constrain_css_to_fit_inside(n,h),$(g).css(h)),f.set_visible(d),f.get_widget().rerender()))})}.bind(this),100))};d.get_backside_dimensions=function(){if(1!==h||1!==f)return{x_scale:h,y_scale:f,original_width:M,original_height:E}};d.set_dimensions=function(a){h=a.x_scale;f=a.y_scale;a.original_width&&(M=a.original_width);a.original_height&&(E=a.original_height)};
d.scale_to_fit=function(a,c){var e=b.UTILITIES.scale_to_fit(a,c,550,200);h=e.x_scale;f=e.y_scale};d.scale_to=function(a,c){var e=b.UTILITIES.scale_element(this.get_element(!0),a,c,550,200);h=e.x_scale;f=e.y_scale};d.get_original_width=function(){return M};d.get_original_height=function(){return E};d.run_status_changed=function(a){l(a)};b.UTILITIES.when_attached(F||a,function(){var c,e,f,d;b.UTILITIES.get_element_width(a);b.UTILITIES.get_element_height(a);c=$(r).width();e=(e=$(F).width())?e+14:0;$(r).css({right:e});
$(g).css({right:e+c+6});f=$(g).width();A&&($(A).css({right:e+c+f+12}),b.UTILITIES.use_custom_tooltip(A));L&&(d=$(A).width()||0,$(L).css({right:e+c+f+d+12}));F&&b.UTILITIES.use_custom_tooltip(F)});d.save_dimensions=function(){I=h;S=f;return!0};d.restore_dimensions=function(){this.get_element();I&&(h=I);S&&(f=S);this.render_current_scale()};d.render_current_scale=function(){this.scale_backside(a,h,f,M,E);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();$(a).find("[title]").each(function(a,
c){b.UTILITIES.use_custom_tooltip(c)})};d.compare_with=function(a){return this.get_widget().compare_with&&this.get_widget().compare_with(a)};if(b.debugging||b.logging)d.to_debug_string=function(a){return("backside of "+this.get_widget().to_debug_string()).substring(0,a)};a.toontalk_widget_side=d;b.UTILITIES.drag_and_drop(a);b.UTILITIES.resizable_and_scalable(a,function(a,b){d.set_dimensions({x_scale:a,y_scale:b});d.render_current_scale()},M,E);a.addEventListener("mouseenter",function(a){a=c.get_frontside();
var e=c.get_parent_of_backside();!a||e&&!e.get_widget().is_top_level()||b.UTILITIES.highlight_element(a.get_element())});a.addEventListener("mouseleave",function(a){c.is_top_level()||b.UTILITIES.remove_highlight()});d.update_display=function(c){var e=this.get_description_text_area(),f=this.get_name_text_input(),g=a.getBoundingClientRect(),n;e&&(n=this.get_widget().get_description())&&(e.button.value=n);f&&(f.button.value=this.get_widget().get_name());this.get_erased()?$(a).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():
$(a).find().show();c&&b.UTILITIES.for_each_batch(this.get_widget().get_backside_widgets().filter(function(a){return!a.get_frontside()}),function(c){var e=c.get_element(!0);c.set_visible(!0);b.UTILITIES.set_css(e,{left:(g.width-50)*Math.random(),top:(g.height-50)*Math.random()});a.appendChild(e);c.update_display()});d.display_updated()};d.display_updated=function(){$(this.get_element());M||(M=b.UTILITIES.get_element_width(a));E||(E=b.UTILITIES.get_element_height(a))};d.add_to_top_level_backside=function(a,
b){return this.get_widget().add_to_top_level_backside(a,b)};c.get_backside_widgets&&(t=c.get_backside_widgets(),d.add_backside_widgets(t,c.get_backside_widgets_json_views()));b.debugging&&(a.id=c._debug_id,d._debug_id=c._debug_id,d._debug_string="backside of "+c._debug_string);return d},toString:function(){return this.get_erased()?"any backside":"backside of "+this.get_widget()},get_full_description:function(b){return this.get_erased()?"any backside":"backside of "+this.get_widget().get_full_description(b)},
remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(c,d){var a=b.UTILITIES.create_check_box(d.get_infinite_stack(),"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+d.get_type_name()+" to be copied instead of moved."),k=function(a){var b=!d.get_infinite_stack(),c;d.set_infinite_stack(b);d.robot_in_training()&&(c=b?"change dragging to make a copy of ":"change dragging back to moving for ",d.robot_in_training().edited(d,
{setter_name:"set_infinite_stack",argument_1:b,toString:c,button_selector:".toontalk-infinite-stack-check-box"}));a.stopPropagation()};a.button.addEventListener("click",k);a.button.addEventListener("touchstart",k);return a},create_parent_selection_check_box:function(c,d){var a=function(){var a=d.get_parent();if(a&&(a.is_nest()||a.is_hole()||a.is_element()))return a.is_hole()?a.get_parent_of_frontside():a},k=a(),h=function(a){return"Drag the "+a.get_type_name()+" I'm on when dragging"},f=function(a){return"Check this if you want to drag the "+
a.get_type_name()+" when you move this widget."},g,r;if(k){g=b.UTILITIES.create_check_box(d.get_infinite_stack(),"toontalk-parent-selection-check-box",h(k),f(k));var p=function(b){var c=a();c?(c!==b&&l(c),g.button.disabled=!1,$(g.label).removeClass("ui-state-disabled"),g.container.title=f(c)):q()},l=function(a){g.label.innerHTML=h(a);g.button.innerHTML=f(a)},t=function(){p();return d},q=function(){g.button.checked=!1;g.button.disabled=!0;$(g.label).addClass("ui-state-disabled");g.container.title=
"Widget moved so this has been disabled. Close and re-open the backside to refresh."};r=function(b){var c=a();a()?(c!==k&&l(c),d.get_selection=g.button.checked?function(){var b=a();p();return b?b.get_selection():d}:t,b.stopPropagation()):q()};g.button.checked=d!==d.get_selection();g.button.checked||(d.get_selection=t);g.button.addEventListener("click",r);return g}},create_click_opens_backside_check_box:function(c,d){var a=b.UTILITIES.create_check_box(d.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box",
"Mouse click opens this backside only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors."),k=function(b){var c=!d.get_open_backside_only_if_stopped(),g;d.set_open_backside_only_if_stopped(c);a.button.checked=c;d.robot_in_training()&&(g=c?"change the response to a mouse click to open only if stopped the backside of ":"change the response to a mouse click to always open the backside of ",d.robot_in_training().edited(d,
{setter_name:"set_open_backside_only_if_stopped",argument_1:c,toString:g,button_selector:".toontalk-click-opens-backside-check-box"}));b.stopPropagation()};a.button.addEventListener("click",k);a.button.addEventListener("touchstart",k);return a},create_description_label:function(c,d){var a=d.get_description();if(a)return b.UTILITIES.create_text_element("I'm the backside of a "+d.get_type_name()+" that is "+a)},add_description_setting:function(c){var d=this.get_widget(),a=d.get_type_name(),k=b.UTILITIES.create_text_area(d.get_description(),
"toontalk-description-input","I'm ","Type here to provide additional information about this "+a+".",function(a){(a=b.UTILITIES.input_area_drop_handler(a,d.receive_description_from_dropped.bind(d),d))&&d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(a,d,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})}),a=function(){var a=k.button.value.trim();d.set_description(a,!0,!0)};$(k.button).val(d.get_description());
k.button.addEventListener("change",a);k.button.addEventListener("mouseout",a);this.set_description_text_area(k);(c||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(k.container));d.get_description()||k.button.setAttribute("placeholder",d.get_default_description())},add_name_setting:function(c){var d=this.get_widget(),a=d.get_type_name(),k=b.UTILITIES.create_text_input(d.get_name(),"toontalk-name-input",d.get_name_input_label?d.get_name_input_label():"My name is ",d.get_name_input_title?
d.get_name_input_title():"Edit the name of this "+a+". There is not much room so keep it short.",void 0,"text",function(a){(a=d.receive_name_from_dropped&&b.UTILITIES.input_area_drop_handler(a,d.receive_name_from_dropped.bind(d),d))&&d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(a,d,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})}),a=function(){d.set_name&&d.set_name(k.button.value.trim(),!0,!0)};k.button.addEventListener("change",
a);k.button.addEventListener("mouseout",a);this.set_name_text_input(k);(c||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(k.container))},add_advanced_settings:function(){var c=this.get_widget(),d=this.create_infinite_stack_check_box(this,c),a=this.create_parent_selection_check_box(this,c),k=this.create_click_opens_backside_check_box(this,c),h=c.get_type_name(),f=$("<button>Make a sensor nest</button>").button(),g=$("<button>Make a function bird</button>").button(),r=document.createElement("table"),
p=this.get_element(),l=function(a,f){var e=c.get_parent_of_frontside(),d=a.get_frontside_element(!0),g;e&&e.add_backside_widget&&!e.get_widget().is_top_level()?(e.add_backside_widget(a),g=e.get_element(),g.appendChild(d),e=$(g).offset(),e.top+=.6*$(g).height()):(c.add_to_top_level_backside(a,!1),e=f.offset(),e.left-=120,0>e.left&&(e.left=0));b.UTILITIES.set_absolute_position(d,e)};$(p).find(".toontalk-settings-backside-button").get(0);var t;$(r).addClass("toontalk-advanced-settings-table");f.addClass("toontalk-make-sensor_nest_button toontalk-button");
f.get(0).addEventListener("click",function(a){var d=b.sensor.create("click","which",void 0,void 0,!0,c);l(d,f);c.robot_in_training()&&c.robot_in_training().created_widget(d,c,".toontalk-make-sensor_nest_button");a.stopPropagation()});f.attr("title","Click to create a nest which receives messages when events happen to this "+c.get_type_name()+".");g.addClass("toontalk-make-function_bird_button toontalk-button");g.get(0).addEventListener("click",function(a){var f=c.get_function_type&&c.get_function_type(),
f=b.bird.create_function(f||h);l(f,g);c.robot_in_training()&&c.robot_in_training().created_widget(f,c,".toontalk-make-function_bird_button");a.stopPropagation()});c.is_number()||c.is_box()||c.is_element()?g.attr("title","Click to get a bird that flies to functions of "+c.get_type_name(!0)+"."):(g.attr("title","There are no functions that operate on "+c.get_type_name(!0)+" (yet)."),g.button("option","disabled",!0));if(0<arguments.length)for(t=0;t<arguments.length;t++)r.appendChild(arguments[t]);this.get_description_text_area()||
this.add_description_setting(r);c.set_name&&!this.get_name_text_input()&&this.add_name_setting(r);r.appendChild(b.UTILITIES.create_row(f.get(0),g.get(0),d.container,a&&a.container,k.container));this.is_primary_backside()||(d=$("<button>Remove me and my widget</button>").button(),d.get(0).addEventListener("click",function(){c.robot_in_training()&&(c.robot_in_training().removed(c),c.robot_in_training().removed(this));this.remove();c.remove()}.bind(this)),d.attr("title","Click to remove this "+c.get_type_name()+
" and its backside."),d.addClass("toontalk-remove-backside-and-widget-buttton"),b.UTILITIES.use_custom_tooltip(d.get(0)),r.appendChild(d.get(0)));b.UTILITIES.use_custom_tooltip(f.get(0));b.UTILITIES.use_custom_tooltip(g.get(0));p.appendChild(r)},get_type_name:function(){return"backside of "+b.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(c){var d,a,k,m,f,g,r;m=$(this.get_element());if(0!==m.length&&(d=this.get_widget(),(a=d.robot_in_training())&&a.get_training_context()===
d&&(a.hide_backside(),m.find(".toontalk-train-backside-button").click()),k=d.get_frontside_element(c&&d.get_parent_of_frontside()&&d.get_parent_of_frontside().is_top_level()),a=m.position(),f=m.parent().closest(".toontalk-backside"),g=function(a){var f=$(k).position(),g=function(){r&&(this.set_parent_of_backside(void 0,!0),r.is_backside()||r.removed_from_container(this,c,void 0,!0),d.forget_backside&&d.forget_backside());a.remove()}.bind(this);b.UTILITIES.visible_element(a)?"0"===a.css("opacity")?
(a.removeClass("toontalk-animating-element"),a.remove()):(a.addClass("toontalk-side-appearing"),b.UTILITIES.add_one_shot_event_handler(a.get(0),"transitionend",2500,g),b.UTILITIES.set_css(a,{left:f&&f.left,top:f&&f.top,opacity:.1})):g()}.bind(this),r=d.get_parent_of_backside(),b.UTILITIES.remove_highlight(),h(this),d.backside_geometry=this.get_backside_dimensions(),g(m),this.set_visible(!1),c&&k&&!b.UTILITIES.visible_element(k)&&(a&&b.UTILITIES.set_css(k,{left:a.left,top:a.top}),!(m=b.UTILITIES.widget_side_of_jquery(f))||
d.is_robot()&&m.get_widget().is_robot()&&d.get_first_in_team()===m.get_widget().get_first_in_team()||(m.widget_side_dropped_on_me(d),d.render())),b.UTILITIES.for_each_batch(d.get_backside_widgets(),function(a){a.set_visible(!1)}),d.on_backside_hidden))d.on_backside_hidden()},create_advanced_settings_button:function(c,d){var a=document.createElement("div"),k=$(a),h=!1;a.innerHTML="&gt;";k.addClass("toontalk-settings-backside-button toontalk-button");k.css({"z-index":b.UTILITIES.next_z_index()});k.get(0).addEventListener("click",
function(a){h=!h;c.set_advanced_settings_showing(h,c.get_element(),k);a.stopPropagation();d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-settings-backside-button",d)});b.UTILITIES.give_tooltip(k.get(0),"Click to see the advanced settings of this "+d.get_type_name()+".");return k.get(0)},set_advanced_settings_showing:function(c){var d=this.get_element(),a=$(d).children(".toontalk-settings-backside-button"),k=$(d).children(".toontalk-advanced-settings-table");0===k.length&&this.add_advanced_settings&&
(this.add_advanced_settings(),k=$(d).children(".toontalk-advanced-settings-table"));c?(k.show(),a.html("<"),b.UTILITIES.give_tooltip(a.get(0),"Click to hide the advanced settings.")):(k.hide(),a.html(">"),b.UTILITIES.give_tooltip(a.get(0),"Click to show the advanced settings."))},scale_backside:function(c,d,a,k,h){var f=Math.min(1,d,a);1===d&&1===a?!this.get_parent()||this.get_parent().is_backside()?b.UTILITIES.set_css(c,{width:k,height:h,transform:"","transform-origin":""}):b.UTILITIES.set_css(c,
{width:"",height:""}):b.UTILITIES.set_css(c,{transform:"scale("+f+", "+f+")","transform-origin":"left top",width:k*d/f,height:h*a/f})},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&b.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(b,d){return this.get_widget().remove_backside_widget(b,d)},top_level_widget:function(){return this.get_widget().top_level_widget()},robot_in_training:function(){return this.get_widget().robot_in_training()},
remove:function(b){var d;this.is_primary_backside()?this.get_widget().remove():((d=this.get_parent_of_backside())&&(d.is_backside()?d.remove_backside_widget(this,!b):d.removed_from_container&&(d.is_backside()?d.remove_backside_widget(this,!0):d.removed_from_container(this,b))),this.set_parent_of_backside(void 0),(b=this.get_element())&&$(b).remove())},match:function(b){var d;if(b.is_backside()){if(this.get_erased())return"matched";d=this.get_widget();b=d.match(b.get_widget());return b===d?this:b}b.last_match=
this;return b},add_copy_to_container:function(b,d,a){return this.get_widget().add_copy_to_container(b||this.copy(),d,a)},has_ancestor:function(b){var d;return this===b?!0:(d=this.get_parent_of_backside())?d.has_ancestor(b):!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},set_parent:function(b){this.set_parent_of_backside(b)},maintain_proportional_dimensions:function(){return!1},
location_constrained_by_container:function(){return!1},set_running:function(){},can_run:function(){return this.get_widget().can_run()},dereference:function(){return this},is_of_type:function(b){return this.get_widget().is_of_type(b)},is_top_level:function(){return this.get_widget().is_top_level()},ok_to_set_dimensions:function(){return!1},add_listener:function(b,d){this.get_widget().add_listener(b,d)},remove_listener:function(b,d,a){this.get_widget().remove_listener(b,d,a)},get_listeners:function(b){return this.get_widget().get_listeners(b)},
is_hole:function(){return!1},is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},is_robot:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},get_infinite_stack:function(){return!1},drag_started:function(b,d){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,d)},get_json:function(c,
d,a){var k=this.get_backside_dimensions(),m=$(this.get_element()).position(),f;h(this);f=k?{width:k.original_width,height:k.original_height,transform:"scale("+k.x_scale+", "+k.y_scale+")","transform-origin":"left top 0px",left:m.left,top:m.top}:m;k=function(a,b){d({type:"backside",my_widget:a,css:f,erased:this.get_erased(),view:{}},b)}.bind(this);b.UTILITIES.get_json(this.get_widget(),c,k,a)},get_selection:function(){return this}}}(window.TOONTALK);
TOONTALK.creators_from_json.backside=function(b,h){var c=TOONTALK.UTILITIES.create_from_json(b.my_widget,h).create_backside(),d=c.get_element();TOONTALK.UTILITIES.set_css(d,b.css);b.erased&&c.set_erased(b.erased,!1,!0);return c};window.TOONTALK.frontside=function(b){return{create:function(h){var c=Object.create(this),d=document.createElement("div"),a=$(d),k=function(c){if(!($(c.target).is(".ui-resizable-handle")||"click"===c.type&&1!==c.which||h.get_open_backside_only_if_stopped()&&h.get_running())){if(a.is(".toontalk-top-level-resource")&&!c.altKey)h.set_running(!h.get_running());else{if(b.open_backside_only_if_alt_key&&!c.altKey)return;h.open_backside();h.robot_in_training()&&h.robot_in_training().backside_opened(h)}c.stopPropagation()}},
m;$(d).addClass("toontalk-frontside toontalk-side");h.get_infinite_stack()&&$(d).addClass("toontalk-infinite-stack");d.toontalk_widget_side=h;b.UTILITIES.drag_and_drop(d);c.get_element=function(){return d};c.get_widget=function(){return h};c.visible=function(){return m};c.set_visible=function(a){var c=this.get_widget();(m=a)&&b.UTILITIES.when_attached(this.get_element(!0),c.render.bind(c));c.walk_children&&c.walk_children(function(b){b.set_visible(a);return!0})};d.addEventListener("click",k);d.addEventListener("touchstart",
k);d.addEventListener("mouseenter",function(a){var c=h.get_backside(),d=(h.is_empty_hole()?wiget.get_parent_of_frontside():h).get_selection().get_frontside_element(),d=$(d);c&&b.UTILITIES.highlight_element(c.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");d.is(".toontalk-top-level-resource")||d.addClass("toontalk-wiggle");a.stopPropagation()});d.addEventListener("mouseleave",function(a){a=h.get_backside();var c=h.is_empty_hole()?wiget.get_parent_of_frontside():h;a&&b.UTILITIES.remove_highlight();
$(c.get_frontside_element()).removeClass("toontalk-wiggle")});b.debugging&&(d.id=h._debug_id);return c},update_display:function(){return this.get_widget().update_display()},remove:function(){var b=this.get_element();$(b).remove();b.toontalk_widget_side=null}}}(window.TOONTALK);(function(b){var h=180/Math.PI,c=Math.log(10),d=bigrat.fromInteger(10),a=bigrat.fromValues(1,2),k=bigrat.fromValues(-1,2),m=bigrat.fromInteger(360),f=bigrat.fromDecimal(2*Math.PI),g=Math.log10?Math.log10:function(a){return Math.log(a)/c},r=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},p=function(a){var c=r(a),f=b.number.ZERO(b.number.function_bird_results_default_format),d=b.number.ZERO(b.number.function_bird_results_default_format);
f.set_value(c.integer_part);d.set_value(c.fractional_part);return b.box.create(2,!0,[f,d],"The integer and fraction parts of "+a.toString().replace(",","/"))},l=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),f=r(c);return bigrat.multiply(c,f.fractional_part,b)},t=function(b){b=r(b);return bigrat.isLessThan(b.fractional_part,k)?bigrat.subtract(b.integer_part,b.integer_part,bigrat.ONE):bigrat.isLessThan(b.fractional_part,bigrat.ZERO)||bigrat.isLessThan(b.fractional_part,a)?b.integer_part:bigrat.add(b.integer_part,
b.integer_part,bigrat.ONE)},q=function(a){a=r(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},u=function(a){a=r(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(b.widget),c=function(a,b,c,e){var f="",d=100;c=50/c;b/=1+b;if(e)for(e=0;d>=c&&
e<a.length;)f=f+"<span class='toontalk-digit' style='font-size:"+d+"%'>"+a[e]+"</span>",e+=1,"-"!==a[e]&&(d*=b);else for(e=a.length-1;d>=c&&0<e;)f="<span class='toontalk-digit' style='font-size:"+d+"%'>"+a[e]+"</span>"+f,--e,"-"!==a[e]&&(d*=b);return f},f=function(a,b){return 0>a?0:Math.ceil(Math.log(.5/b)/Math.log(a/(1+a)))},k=function(a,b,e){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+
k(a,1.25*b,.8*e)+"</span>";b=b/2-1;return c(a,b,e,!0)+c(a,b,e,!1)},l=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?l(a.substring(0,a.length-1)):a},h=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},m=function(a){switch(a){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return b.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}},q=function(a){switch(a){case "+":return"toontalk-plus-radio-button";case "-":return"toontalk-minus-radio-button";case "*":return"toontalk-times-radio-button";case "/":return"toontalk-divide-radio-button";case "=":return"toontalk-set-equal-radio-button";
default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}},u=function(a){switch(a){case "decimal":return"toontalk-decimal-radio-button";case "proper_fraction":return"toontalk-proper-fraction-radio-button";case "improper_fraction":return"toontalk-improper-fraction-radio-button";case "scientific_notation":return"toontalk-scientific-notation-radio-button";default:return b.UTILITIES.report_internal_error("Unsupported number format: "+a),""}},r=function(a,b){switch(a){case "+":return"add "+
b+" to";case "-":return"subtract "+b+" from";case "*":return"multiply "+b+" with";case "/":return"divide "+b+" into"}},p=function(a){switch(a){case "+":return"addition";case "-":return"subtraction";case "*":return"multiplication";case "/":return"division";case "=":return"equality";default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";a.create=function(c,f,d,g,k,l){var m=Object.create(a),
r=h(c,f);d||(d="+");m.is_number=function(){return!0};m.set_value=function(a,c){var e;if(c||!bigrat.equals(r,a))return this.fire_value_change_listeners(r,a),(e=this.get_frontside_element())&&e.dispatchEvent(b.UTILITIES.create_event("value changed",{old_value:r,new_value:a})),r=a,this.rerender(),b.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&b.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),
this};m.set_value_from_sub_classes=m.set_value;m.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),e;c&&(e={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(e)}))};m.get_value=function(){return r};m.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));b.debugging&&"0,0"===this.get_value().toString()&&b.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};m.copy=function(b){return this.add_to_copy(a.create(r[0],
r[1],d,g,k,l),b)};m.get_format=function(){return g||a.default_format};m.set_format=function(a,b,c){g=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_format",argument_1:a,toString:"by changing the format to "+a,button_selector:"."+u(a)});return this};m.get_operator=function(){return d};m.set_operator=function(a,b,c){d=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_operator",argument_1:a,
toString:"by changing the operator to "+p(a),button_selector:"."+q(a)});return this};m.get_approximate=function(){return l};m.set_approximate=function(a,b){l=a;b&&this.rerender();return this};a.add_standard_widget_functionality(m);m.set_description(k);if(b.listen){var t,B,L;m.add_speech_listeners({commands:"add | plus | sum | addition | subtract | subtraction | take away | times | multiply | multiplication | divide | division | equal | equals | decimal number | decimal | mixed number | mixed | improper fraction | improper | fraction | scientific notation | scientific",
numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var c=b.UTILITIES.get_dragee_copy()||m;switch(a){case "add":case "plus":case "sum":case "addition":c.set_operator("+",!0,!0);break;case "subtract":case "take away":case "subtraction":c.set_operator("-",!0,!0);break;case "times":case "multiply":case "multiplication":c.set_operator("*",!0,!0);break;case "divide":case "divides":case "divide by":case "division":c.set_operator("/",!0,!0);break;case "equal":case "equals":c.set_operator("=",
!0,!0);break;case "decimal number":case "decimal":c.set_format("decimal",!0,!0);break;case "mixed number":case "mixed":c.set_format("mixed_number",!0,!0);break;case "improper fraction":case "improper":case "fraction":c.set_format("improper_fraction",!0,!0);break;case "scientific notation":case "scientific":c.set_format("scientific_notation",!0,!0);break;default:t=parseFloat(a),isNaN(t)?console.log("did not understand spoken command: '"+a+"'"):(c.set_value_from_decimal(t),c.robot_in_training()&&c.robot_in_training().edited(c,
{setter_name:"set_value_from_decimal",argument_1:t,toString:"by changing its value to "+t,button_selector:".toontalk-numerator-input"}))}c.update_display();B="You are now holding "+c.get_text(!0);B!==L&&(m.display_message("You are now holding "+c.get_frontside_element(!0).innerHTML,{display_on_backside_if_possible:!0,duration:4E3,plain_text:B}),L=B)}})}b.debugging&&(m._debug_string=m.toString(),m._debug_id=b.UTILITIES.generate_unique_id(),r._debug_id_new=m._debug_id);return m};a.create_from_bigrat=
function(a){var c=b.number.ZERO();c.set_value(a);return c};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(h(a,b))};a.set_numerator=function(a){return this.set_value(h(a,this.get_value()[1].toString()))};a.set_denominator=function(a){return this.set_value(h(this.get_value()[0].toString(),a))};a.ONE=function(){return b.number.create(1)};a.ZERO=function(a){return b.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&
a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};a.compare_with_number=function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),c=function(a,b){var c=a.indexOf('style="');return 0<=c?a.substring(0,c+7)+b+a.substring(c+7):a},e=28,
f,d,g,k,l,h;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string(50));a=a.get_element();$(a).is(".toontalk-conditions-contents")?f=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json, .toontalk-robot")?(f=$(a),l=!0):$(a).parent().is(".toontalk-element-frontside")?(f=$(a),k=l=!0):f=$(a).parent().is(".toontalk-scale-half")?$(a):$(a).parent();0===f.length&&(e=this.get_parent_of_frontside())&&(e.get_widget().is_hole()&&(e=e.get_parent_of_frontside()),
f=$(e.get_frontside_element()));1===b.nest.CONTENTS_WIDTH_FACTOR&&1===b.nest.CONTENTS_HEIGHT_FACTOR&&f.is(".toontalk-nest")&&f.parent().is(".toontalk-box-hole")&&!f.parent().is(".toontalk-scale-half")&&(f=f.parent());if($(a).is(".toontalk-carried-by-bird"))g=d=100;else if($(a).is(".toontalk-element-attribute"))d=200,g=32;else if(l&&(a===f.get(0)||f.is(".toontalk-top-level-resource")))d=$(a).width(),g=$(a).height(),d&&g||(d=this.saved_width||76,g=this.saved_heieght||55,$(a).css({width:d,height:g}));
else{0<f.length&&(d=b.UTILITIES.element_width(f.get(0)),g=b.UTILITIES.element_height(f.get(0)));if(0===d||0===g||0===f.length){b.logging&&0<=b.logging.indexOf("display")&&0<f.length&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());b.UTILITIES.is_attached(a)||b.UTILITIES.when_attached(a,this.update_display.bind(this));return}f.is(".toontalk-nest")&&(d*=b.nest.CONTENTS_WIDTH_FACTOR,g*=b.nest.CONTENTS_HEIGHT_FACTOR)}h=$(a).children(".toontalk-widget");h.is("*")?
h=h.get(0):(h=document.createElement("div"),a.appendChild(h));$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");e=this.get_border_size(d,g);k||(4===e?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):8===e?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):16===e?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number"));
k=g-2*e;l=this.to_HTML(d/(.64*k),d,g,k,this.get_format(),!0,this.get_operator(),l);b.UTILITIES.on_a_nest_in_a_box(a)&&(l=c(l,"width:"+(d-2*e)+"px;"),l=c(l,"height:"+(g-2*e)+"px;"));h.innerHTML=l;h.translate=!1;$(h).addClass("toontalk-widget notranslate");f.is(".toontalk-box-hole")&&$(a).css({width:"",height:""});b.UTILITIES.give_tooltip(a,this.get_title())};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};a.to_HTML=function(a,e,h,q,u,r,p,t){var z=!1!==r?
" toontalk-top-level-number":"",I=4,D=a,n,v,x,W,P;this.is_attribute_widget&&this.is_attribute_widget()?z+=" toontalk-attribute-number":this.get_approximate()&&(z+=" toontalk-approximate-number");t&&(z+=" toontalk-number-size-unconstrained-by-container");x=p?m(p):"";D||(D=4);q||(q=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+z+'" style="font-size: '+q+'px;"></div>';if(0<x.length){--D;if(P="-"===p&&(this.is_negative()||this.is_zero())&&(this.is_integer()||
"improper_fraction"!==u&&"proper_fraction"!==u&&"mixed_number"!==u))--D,x+="&nbsp;";2>D&&(q*=Math.max(1,D)/2,D=2)}if(this.is_integer()&&"scientific_notation"!==u){try{n=bigrat.toBigInteger(this.get_value()).toString()}catch(V){b.UTILITIES.report_internal_error("Error converting number to a string: "+V),n="0"}r=n.length;0<x.length&&r++;4>D&&r>D&&(u=Math.min(4,r),q*=D/u,D=u);return'<div class="toontalk-number toontalk-integer'+z+'" style="font-size: '+q+'px;">'+x+k(n,D,q)+"</div>"}if(this.get_approximate()||
this.is_attribute_widget())if("decimal"===u?v=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===u&&(v=bigrat.toDecimal(this.get_value()).toExponential(),n=v.indexOf("e"),0<=n&&(W=v.substring(n+1),v=v.substring(0,n))),v)return r=v.length,D>r&&(D=r),0<x.length&&r++,W&&(D-=3+W.length/2),"scientific_notation"===u&&(I+=2),D<I&&r>D&&(u=Math.min(I,r),q=0>=D?Math.max(1,D)/u*q:Math.max(2,D)/u*q),D=W?'&times;10<sup style="font-size: '+q/2+'px;">'+W+"</sup>":"",q=Math.min(q,e/(.64*r)),'<div class="toontalk-number toontalk-approximate-number'+
z+'" style="font-size: '+q+'px;">'+x+'<div style="margin-top: '+(h-q)/2+'px">'+v+"</div>"+D+"</div>";v=' style="font-size:'+.4*q+'px;"';if("improper_fraction"===u||!u)return q='<table class="toontalk-number toontalk-improper-fraction'+z+'"'+v+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+k(this.numerator_string(),2*D,q)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+
k(this.denominator_string(),2*D,q)+"</td></tr></table>",""===x?q:"<table class='toontalk-operator-and-fraction'"+v+"><tr><td>"+x+"</td><td>"+q+"</td></tr></table>";if("mixed_number"===u||"proper_fraction"===u){x=this.integer_part();if(x.is_zero())return this.to_HTML(D,e,h,q,"improper_fraction",r,p);W=this.copy({just_value:!0}).subtract(x).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+z+'"'+v+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+x.to_HTML(D/
2,e,h,q,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+W.to_HTML(D/2,e,h,q,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===u)return 4>D&&(q*=Math.max(1,D)/4,D=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+z+'" style="font-size: '+q+'px;">'+x+this.decimal_string(D,q)+"</div>";if("scientific_notation"===u){I=bigrat.isNegative(this.get_value());n=this.get_value();P=bigrat.abs(bigrat.create(),n);W=bigrat.isLessThan(P,
bigrat.ONE);bigrat.equals(n,bigrat.ZERO)?W=0:(n=W?bigrat.toBigInteger(bigrat.divide(bigrat.create(),bigrat.ONE,P)):bigrat.toBigInteger(P),n=n.toString(),W=W?"1"===l(n)?-n.length+1:-n.length:n.length-1);n=6+(0===W?1:Math.ceil(g(Math.abs(W)))/2);I&&n++;if(a<n+1)return this.to_HTML(n+1,e,h,q*a/(n+1),u,r,p,t);e=f(D-(Math.min(n,D/2)+1),q);W<e?(h=bigrat.power(bigrat.create(),d,e-W),h=bigrat.multiply(bigrat.create(),this.get_value(),h),e=bigrat.toBigInteger(h).toString().substring(0,e+1)):e=bigrat.toBigInteger(this.get_value()).toString().substring(0,
e+1);if(this.is_integer()||this.is_reciprocal_of_integer())e=l(e);h=I?"-"+e.substring(0,1):e.substring(0,1);e=e.substring(1);D=c(e,D*(1-n/D),q,!0);0<D.length&&(D="<span class='toontalk-decimal-point'>.</span>"+D);return'<table class="toontalk-number toontalk-scientific_notation'+z+'"'+v+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+z+'" style="font-size: '+.9*q+'px;">'+x+h+D+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+
q+'px;"> &times;10<sup style="font-size: '+q/2+'px;">'+W+"</sup></div></td></tr></table>"}};a.get_default_description=function(){return this.get_approximate()?"a number from an approximate calculation.":"a number."};a.drop_on=function(a,b,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b,c),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,c,e){var f,d,g,k,l;
if(!a.is_backside()){if(a.visible()&&this.visible()&&(c||e)){if(e){if(!e.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(a,c,e);a.robot_waiting_before_next_step=e}f=document.createElement("div");$(f).addClass("toontalk-bammer-down");d=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level");f.style.left="-10px";f.style.top=d.height()+"px";0<d.length&&d.get(0).appendChild(f);k=this.get_frontside_element();g=$(k).offset();g.left-=.75*$(f).width();g.left+=
.5*$(k).width()+.1*$(f).width();g.top-=.5*$(k).height()+.4*$(f).height();k=function(){b.sounds&&b.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,c,e)&&e&&e.run_next_step();c&&this.backup_all();$(f).removeClass("toontalk-bammer-down");b.UTILITIES.set_timeout(function(){var a=d.offset();a||(a={left:0,top:0});$(f).addClass("toontalk-bammer-away");g.left=a.left+d.width()-100;g.top=a.top+d.height()+100;l=function(){$(f).remove()};b.UTILITIES.animate_to_absolute_position(f,g,l,e&&e.transform_animation_speed(b.UTILITIES.default_animation_speed));
$(f).css({opacity:.01})})}.bind(this);b.UTILITIES.animate_to_absolute_position(f,g,k,e&&e.transform_animation_speed(b.UTILITIES.default_animation_speed));$(f).css({opacity:1,"z-index":b.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c,e)}};a.number_dropped_on_me_semantics=function(a,c,e){c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove();switch(a.get_operator()){case "+":return this.add(a);
case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "=":return this.set_value(a.get_value());case "^":return this.power(a);default:b.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_side_dropped_on_me=function(a,c,e){if(a.number_dropped_on_me)return this.number_dropped_on_me(a,c,e);(a=a.get_frontside_element())&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",
{element_widget:a,where:"front"}));return!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.divide=function(a){this.set_value(bigrat.divide(this.get_value(),this.get_value(),a.get_value()),!0);return this};
a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};a.is_zero=function(){return bigrat.equals(this.get_value(),
bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(a){var b="";if(this.get_erased())return"erased number";"+"===this.get_operator()||a&&a.without_operator||(b=this.get_operator());return b+bigrat.str(this.get_value())};a.get_text=function(a){var c=this.get_format(),e="";switch(this.get_operator()){case "-":e="subtract ";break;case "*":e="multiply by ";break;case "/":e="divide by ";break;case "=":e="make what I'm dropped on equal to "}var f;if(this.get_approximate()||
this.is_attribute_widget&&this.is_attribute_widget())return"approximately "+bigrat.toDecimal(this.get_value()).toString();if(this.is_integer()||"improper_fraction"===c)return a?e+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):e+this.toString({without_operator:!0});c=this.integer_part();if(c.is_zero())return a?e+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):e+this.toString({without_operator:!0});f=this.copy({just_value:!0}).subtract(c).absolute_value();return a?
e+b.UTILITIES.number_to_words(c.toString({without_operator:!0}))+(a?" and ":" ")+b.UTILITIES.number_to_words(f.toString({without_operator:!0})):e+c+" "+f};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};a.get_json=function(a,b,c){b({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string(),format:this.get_format(),
approximate:this.get_approximate()},c)};b.creators_from_json.number=function(b){return a.create(b.numerator,b.denominator,b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};a.is_reciprocal_of_integer=function(){return 0===this.get_value()[0].compare(BigInteger.ONE)&&0!==this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,
this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};a.decimal_string=function(b,g){var h,m,q,u,r;if(this.is_integer())return this.numerator_string();h=this.get_value();m=a.create(h[0],h[1]);q=m.integer_part();h=q.toString();
"0"===h&&this.is_negative()&&(h="-"+h);u=m.get_value();bigrat.subtract(u,u,q.get_value());m=b-(Math.min(h.length,b/2)+1);r=f(m,g);q=Math.min(h.length,b/2);bigrat.isNegative(u)&&bigrat.abs(u,u);var p=bigrat.fromValues(u[0],1);u=bigrat.fromValues(u[1],1);if(bigrat.equals(p,bigrat.ZERO))r="0";else{var t="",z=bigrat.create(),I=bigrat.create(),n=bigrat.create();for(bigrat.multiply(p,p,d);r>t.length;){if(bigrat.isLessThan(p,u))t+="0";else if(bigrat.divide(z,p,u),I=bigrat.toBigInteger(z),t+=I.toString(),
bigrat.subtract(n,z,bigrat.fromValues(I,1)),bigrat.multiply(p,n,u),bigrat.equals(p,bigrat.ZERO)){t=l(t);break}bigrat.multiply(p,p,d)}r=t}m=r.length<m?r:c(r,m,g,!0);return k(h,q,g)+"<span class='toontalk-decimal-point'>.</span>"+m};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.get_widget().match_with_any_number)return a.get_widget().match_with_any_number();this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=
function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===this.get_operator())return"matched";a.last_match=this;return a};a.get_custom_title_prefix=function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"/"===this.get_operator()?"Drop me on another number I'll divide him by my value.":"Drop me on another number and I'll "+r(this.get_operator(),"myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+
b.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=function(){return{create:function(a){var c=b.backside.create(a),f=c.get_element(),d=document.createElement("div"),g=a.numerator_string(),k=a.denominator_string(),l=b.UTILITIES.create_text_area(g,"toontalk-numerator-input","","Type here to edit the numerator",void 0,"number"),h=b.UTILITIES.create_text_area(k,"toontalk-denominator-input","","Type here to edit the denominator",
void 0,"number"),m=b.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal.",!0),q=b.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction.",!0),u=b.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction.",
!0),r=b.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",!0),p=b.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",!0),t=b.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",!0),w=b.UTILITIES.create_radio_button("operator",
"*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),O=b.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","I will divide what I'm dropped on.",!0),Q=b.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",!0),H=function(b){var c=l.button.value.trim(),n=h.button.value.trim(),f,d,v,m,x=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",
replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:x(a,b).replacement};a=x(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,"")}},q;if(c!==g||n!==k){q=x(c,"numerator");q.message&&(f=parseFloat(c),isNaN(f)?(a.display_message(q.message,
{display_on_backside_if_possible:!0}),c=q.replacement):d=bigrat.fromDecimal(f));"0"===n?(a.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1.",{display_on_backside_if_possible:!0}),n="1"):(q=x(n,"denominator"),q.message&&(v=parseFloat(n),isNaN(v)?(a.display_message(q.message,{display_on_backside_if_possible:!0}),n=q.replacement||"1"):m=bigrat.fromDecimal(v)));if(d&&m)a.set_value(bigrat.divide(a.get_value(),d,m),!0);else if(d)a.set_value(bigrat.divide(a.get_value(),
d,bigrat.fromValues(n,1)),!0);else if(m)a.set_value(bigrat.divide(a.get_value(),bigrat.fromValues(c,1),m),!0);else if(!a.set_from_values(c,n)&&!isNaN(v))return;g=a.numerator_string();k=a.denominator_string();a.robot_in_training()&&(b=b.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:"set_denominator",argument_1:n,toString:"by changing the value of the denominator to "+n,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:"set_numerator",
argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+b}));a.rerender()}},U=function(){var c=b.UTILITIES.selected_radio_button(m,q,u,r).button.value;a.set_format(c,!0,!0)},ca=function(){var c=b.UTILITIES.selected_radio_button(p,t,w,O,Q).button.value;a.set_operator(c,!0,!0)},R=b.UTILITIES.create_horizontal_table(l.container,d,h.container),D=b.UTILITIES.create_horizontal_table(m.container,q.container,u.container,r.container),n=b.UTILITIES.create_horizontal_table(p.container,
t.container,w.container,O.container,Q.container),v=b.backside.create_advanced_settings_button(c,a),x=c.update_display.bind(c),W=c.add_advanced_settings,P=function(){switch(a.get_format()){case "decimal":return m;case "improper_fraction":return u;case "mixed_number":case "proper_fraction":return q;case "scientific_notation":return r}},V=function(){switch(a.get_operator()){case "+":return p;case "-":return t;case "*":return w;case "/":return O;case "=":return Q}};d.innerHTML="/";$(d).addClass("ui-widget");
l.button.addEventListener("change",H);l.button.addEventListener("mouseout",H);l.button.addEventListener("mouseenter",function(){g=l.button.value.trim()});h.button.addEventListener("change",H);h.button.addEventListener("mouseout",H);h.button.addEventListener("mouseenter",function(){k=h.button.value.trim()});f.appendChild(R);f.appendChild(v);m.button.addEventListener("change",U);q.button.addEventListener("change",U);u.button.addEventListener("change",U);r.button.addEventListener("change",U);b.UTILITIES.check_radio_button(P());
b.UTILITIES.check_radio_button(V());p.button.addEventListener("change",ca);t.button.addEventListener("change",ca);w.button.addEventListener("change",ca);O.button.addEventListener("change",ca);Q.button.addEventListener("change",ca);c.update_display=function(){$(l.button).val(a.numerator_string());$(h.button).val(a.denominator_string());b.UTILITIES.check_radio_button(P());b.UTILITIES.check_radio_button(V());x()};c.add_advanced_settings=function(){W.call(c,D,n);$(D).buttonset();$(n).buttonset()};b.UTILITIES.when_attached(f,
function(){c.is_primary_backside()||a.add_listener("value_changed",function(){c.rerender()})});return c}}}();window.TOONTALK.number["function"]=function(){var a=b.create_function_table(),c=function(a){return bigrat.toDecimal(l(a,m))},d=function(a){return bigrat.toDecimal(l(a,f))},g=function(){return!0};a.add_function_object("sum",function(c,f,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.add,"sum",f,d)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",
function(c,f,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.subtract,"difference",f,d)},"The bird will return with the result of subtracting the numbers in the box from the first number.","-");a.add_function_object("product",function(c,f,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.multiply,"product",f,d)},"The bird will return with the product of the numbers in the box.","\u00d7");a.add_function_object("division",function(c,f,d){return a.n_ary_widget_function(c,b.number.ONE,
b.number.divide,"division",f,d)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00f7");a.add_function_object("modulo",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(l),2,"modulo",c,f)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(c,f,d){return a.n_ary_widget_function(c,b.number.ONE,
b.number.minimum,"minimum",f,d)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(c,f,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.maximum,"maximum",f,d)},"The bird will return with the largest of the numbers in the box.","max");a.add_function_object("absolute value",function(c,f,d){return a.n_ary_function(c,function(a){var e=b.number.ZERO(c.get_hole_contents(1).get_format());bigrat.abs(e.get_value(),a);return e},1,"absolute value",
f,d)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(function(a,b){var c=bigrat.power(bigrat.create(),a,b[0].valueOf()),e=b[1].valueOf();return 1===e?c:bigrat.nthRoot(bigrat.create(),c,e)},function(a){return 0!==a[1][1].compare(BigInteger.ONE)}),2,"power",c,f)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",
function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},g),1,"logarithm",c,f)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).","log");a.add_function_object("random",function(b,
c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c,f)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.",
"rand");a.add_function_object("round",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(t),1,"round",c,f)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(q),1,"floor",c,f)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c,f){return a.n_ary_function(b,a.bigrat_function_to_widget_function(u),
1,"ceiling",c,f)},"The bird will return the smallest integer greater than or equal to the number.","ceil");a.add_function_object("delay",function(c,f,d){var g=Date.now(),k=a.check_message(c),l;if(k)if(2>k.size)Tmessage.display_message("Delay function birds need a number in the second hole.");else return l=c.get_hole_contents(1).to_float(),setTimeout(function(){var l=b.number.ZERO(b.number.function_bird_results_default_format);l.set_value_from_decimal((Date.now()-g)/1E3);l.set_approximate(!0);a.process_response(l,
k.bird,c,f,d)},1E3*l),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");a.add_function_object("integer and fraction parts",function(b,c,f){return a.n_ary_function(b,p,1,"integer and fraction parts",c,f)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(b,f,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/
h)},!0,c),1,"sine",f,d)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",function(b,f,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/h)},!0,c),1,"cosine",f,d)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return h*
Math.atan(a)},!0),1,"arc tangent",c,f)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.","atan");a.add_function_object("arc tangent of y and x",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return h*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c,f)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.",
"atan2");a.add_function_object("sine (in radians)",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,!0,d),1,"sine (in radians)",c,f)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,d),1,"cosine (in radians)",c,f)},"The bird will return with an approximation of the cosine of the number (in radians).",
"cos rad");a.add_function_object("arc tangent (in radians)",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,!0),1,"arc tangent (in radians)",c,f)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c,f){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",
c,f)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.","atan2 rad");a.add_function_object("turn into words",b.widget.get_description_function(a),"The bird will return with words describing what is in the second hole.","describe",["a widget"]);a.add_function_object("speak",b.widget.get_speak_function(a),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);a.add_function_object("listen for a number",b.widget.get_listen_function(a,!0),"The bird will cause the browser to listen to the next number said and give the number to the bird in the first hole. If there is an error and there is a bird in the second hole it will be given the error message. If you put a number between 0 and 1 in the third hole then only recognitions with at least that confidence will be considered. ","listen",[]);return a.get_function_table()}()})(window.TOONTALK);(function(b){var h=function(c,d,a,k){var h;c&&0<=a&&c.maintain_proportional_dimensions()&&c.get_default_width?(h=c.get_default_width(),c=c.get_default_height(),a/h>=k/c?(h=h*k/c,a={left:(a-h)/2,top:0,width:h,height:k}):(h=c*a/h,a={left:0,top:(k-h)/2,width:a,height:h})):(c.is_backside()&&(c.update_display(),c.scale_to(a,.92*k)),a={left:0,top:0});b.UTILITIES.set_css(d,a)};window.TOONTALK.box=function(b){var d=Object.create(b.widget);d.create=function(a,k,m,f,g){var r=Object.create(d),p=[];"undefined"===
typeof k&&(k=!0);r.is_box=function(){return!0};r.get_horizontal=function(){return k};r.set_horizontal=function(a,b,c){k=a;b&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_horizontal",argument_1:a,toString:"by changing the orientation to "+(a?"horizontal":"vertical"),button_selector:a?".toontalk-horiztonal-radio-button":"toontalk-vertical-radio-button"});return this};r.get_hole=
function(a){return p[a]};r.get_hole_contents=function(a){return p[a]&&p[a].get_contents()};r.set_hole=function(a,e,f){var d;p[a].set_contents(e);if(f){e&&e.save_dimensions();f=this.get_frontside_element();a=$(f).children(".toontalk-hole-number-"+a);a.empty();if(!e)return;d=this.get_hole_dimensions();f=e.get_element(!0);0<a.length&&a.get(0).appendChild(f);h(e,f,d.width,d.height);e.rerender()}this.rerender();b.debugging&&(this._debug_string=this.to_debug_string())};r.get_holes=function(){return p};
r.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=void 0}.bind(this)};r.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};r.set_contents=function(a){b.UTILITIES.for_each_batch(a,function(a,
b){p[b].set_contents(a)})};r.get_size=function(){return a};r.set_size=function(f,e,d){var g,k;if(a===f||0>f||isNaN(f))return!1;k=this.visible();p.length=f;if(f>a)for(g=a;g<f;g++)p[g]=b.box_hole.create(g),p[g].set_parent_of_frontside(r),p[g].set_visible(k);a=f;e&&this.rerender();(e=this.get_listeners("contents_or_properties_changed"))&&e.forEach(function(a){a({type:"contents_or_properties_changed",new_size:f})});d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_size",
argument_1:f,oString:"by changing the number of holes to "+f+" of the box",button_selector:".toontalk-box-size-input"});b.debugging&&(this._debug_string=this.to_debug_string());return!0};r.get_hole_dimensions=function(){var f=this.get_frontside_element(),e=$(f).width()||b.box.get_default_width(),f=$(f).height()||b.box.get_default_height();return k?{width:e/a,height:f}:{width:e,height:f/a}};r.receive_size_from_dropped=function(a,e){var f;if(a.is_number())return f=b.number.create(this.get_size()),f.number_dropped_on_me_semantics(a),
f=Math.max(0,Math.round(f.to_float())),this.set_size(f),f.toString()};r.copy=function(b){var c;b||(b={});c=p.map(function(a){if(a=a.get_contents())return a.copy(b)});c=d.create(a,k,c,this.get_description(),this.get_name());return this.add_to_copy(c,b)};r.generate_name=function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};r.add_standard_widget_functionality(r);r.has_name(r);r.set_name(g);for(g=0;g<a;g++)p[g]=b.box_hole.create(g),p[g].set_parent_of_frontside(r);r.set_description(f);if(b.listen){var l,
t,q;r.add_speech_listeners({commands:"left to right | horizontal | top to bottom | vertical",numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var e=b.UTILITIES.get_dragee_copy()||r;switch(a){case "left to right":case "horizontal":e.set_horizontal(!0,!0,!0);break;case "top to bottom":case "vertical":e.set_horizontal(!1,!0,!0);break;default:l=parseInt(a),isNaN(l)?console.log("did not understand '"+a+"'"):e.set_size(l,!0,!0)}e.update_display(!0);a=e.get_size();t="You are now holding a "+
(e.get_horizontal()?"horizontal":"vertical")+" box with "+(1<a?a+" holes":0===a?"no holes":"one hole")+".";t!==q&&(r.display_message(t,{display_on_backside_if_possible:!0,duration:4E3}),q=t)}})}m&&r.set_contents(m);b.debugging&&(r._debug_id=b.UTILITIES.generate_unique_id(),r._debug_string=r.to_debug_string());return r};d.create_backside=function(){return b.box_backside.create(this)};d.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&a.equals_box(this)};d.equals_box=
function(a){var b=this.get_size(),c,f,d;if(b!==a.get_size())return!1;for(c=0;c<b;c++)if(f=this.get_hole_contents(c),d=a.get_hole_contents(c),!f&&d||f&&!d||f&&d&&(!f.equals||!f.equals(d)))return!1;return!0};d.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};d.compare_with_box=function(a){var b=this.get_size(),c=a.get_size(),f,d;if(b>c)return 1;if(b<c)return-1;for(c=0;c<b;c++){f=this.get_hole_contents(c);d=a.get_hole_contents(c);if(f&&!d)return 1;if(!f&&d)return-1;if(f&&
d)if(f.compare_with){if(f=f.compare_with(d),1===f||-1===f)return f}else return}return 0};d.match=function(a){if(this.get_erased&&this.get_erased()){if(a.get_widget().match_with_any_box)return a.get_widget().match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=a,this)};d.match_with_any_box=function(){return"matched"};d.match_with_this_box=function(a){var d=this.get_size(),h=[],f,g,r;if(d!==a.get_size())return a.last_match=this,
a;for(f=0;f<d;f++)if(r=a.get_hole_contents(f))if(g=this.get_hole_contents(f)){g=b.UTILITIES.match(r,g);if(g.is_widget)return g;"matched"!==g&&(h=0===h.length?g:h.concat(g))}else if(g=this.get_contents_temporarily_removed(f))h.push(g);else return a.last_match=this,a;return 0<h.length?h:"matched"};d.toString=function(a){var b="",c=this.get_size(),f,d,h=this.get_type_name()+" that looks like ";for(f=0;f<c;f++)d=this.get_hole(f),b+=d.get_full_description(a),f<c-1&&(b+=" | ");return h+"["+b.replace(h,
"")+"]"};d.get_type_name=function(a){return a?"boxes":"box"};d.get_default_description=function(){return"a box for holding things."};d.get_help_URL=function(){return"docs/manual/boxes.html"};d.get_json=function(a,d,h){var f=[],g=function(h,m){var l,t;h>=this.get_size()?d({type:"box",size:this.get_size(),contents:f,horizontal:this.get_horizontal(),name:this.get_name()},m):(l=this.get_hole_contents(h))?l.is_primary_backside&&l.is_primary_backside()?(t=function(a,b){f.push({widget:a,is_backside:!0});
g(h+1,b)}.bind(this),b.UTILITIES.get_json(l.get_widget(),a,t,m)):l.is_widget?(t=function(a,b){f.push({widget:a});g(h+1,b)}.bind(this),b.UTILITIES.get_json(l,a,t,m)):(t=function(a,b){f.push(a);g(h+1,b)}.bind(this),l.get_json(a,t,m)):(f.push(null),g(h+1,m))}.bind(this);g(0,h)};d.walk_children=function(a){var b=this.get_size(),c;for(c=0;c<b&&a(this.get_hole(c));c++);};b.creators_from_json.box=function(a,k){return d.create(a.size,a.horizontal,b.UTILITIES.create_array_from_json(a.contents,k),a.description,
a.name)};d.update_display=function(){var a=this.get_frontside(!0).get_element(),d=this.get_size(),m=function(a,g,l){var m=g.get_contents(),r=(m||g).get_element(!0),u=$(a).parents(".toontalk-box-hole"),t=function(){$(a).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(J/=b.nest.CONTENTS_WIDTH_FACTOR,K/=b.nest.CONTENTS_HEIGHT_FACTOR)},F,A,J,K;f?(A=0,0<u.length?(J=q-2*y/d,K=e-2*y):(J=q,K=e),t(),F=J*l,1<l&&(F+=y*(l-1))):(F=0,0<u.length?(J=q-2*y,K=e-2*y/d):(J=q,K=e),t(),A=K*l,1<l&&(A+=
y*(l-1)));b.UTILITIES.set_css(a,{left:F,top:A,width:J,height:K});p[l]&&a.setAttribute("toontalk_name",p[l]);!b.UTILITIES.has_animating_image(r)&&0<l&&($(a).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(a).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),f?$(a).addClass(B+"-left"):
$(a).addClass(B+"-top"));a!==r&&m.get_parent()===g&&(h(m,r,J,K),a.appendChild(r),g.get_contents().rerender());g.is_element()&&(l={width:J,height:K},g=g.get_contents(),$(g.get_frontside_element()).css(l),g=g.dereference(),g.set_size_attributes(J,K,!0),$(a).css(l))},f=this.get_horizontal();$(a).is(".toontalk-box");var g=function(){var e=$(a).children(".toontalk-box-hole");$(a).parent(".toontalk-conditions-container").is("*")||$(a).parent().is(".toontalk-scale-half")||($(a).parent(".toontalk-box-hole").is("*")?
b.UTILITIES.set_css(a,{width:"",height:""}):b.UTILITIES.set_css(a,{width:t,height:u}));e.length===d?e.each(function(a,b){var c=this.get_hole(a);c&&m(b,c,a)}.bind(this)):(e.remove(),this.get_holes().forEach(function(b,c){l=b.get_element();$(l).addClass("toontalk-hole-number-"+c);b.get_contents()&&b.get_contents().update_display();m(l,b,c);a.appendChild(l)}))}.bind(this),r=function(){var g=function(a){if(a.parentElement)return $(a.parentElement).is(".toontalk-box-hole")?a.parentElement:g(a.parentElement)},
l=g(a)||a,l=$(a).parent().is(".toontalk-scale-half")?a:l;t=0===d?0:b.UTILITIES.element_width(l)||this.saved_width||b.box.get_default_width();u=b.UTILITIES.element_height(l)||this.saved_height||b.box.get_default_height();f?(q=0===d?0:t/d,e=u):(q=t,e=u/d)}.bind(this),p=this.get_name().split(";"),l,t,q,u,e,B,y;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(a).addClass("toontalk-box");$(a).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");
b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string());this.get_erased()?($(a).addClass("toontalk-box-erased"),$(a).children(".toontalk-side").remove()):($(a).removeClass("toontalk-box-erased"),r(),y=this.get_border_size(q,e),B=4===y?"toontalk-box-eighth-size-border":8===y?"toontalk-box-quarter-size-border":16===y?"toontalk-box-half-size-border":"toontalk-box-full-size-border",f?q-=(d-1)*y/d:e-=(d-1)*y/d,$(a).addClass(B),b.UTILITIES.set_timeout(g))};
d.get_default_width=function(){return 164};d.get_default_height=function(){return 68};d.get_border_size=function(a,b){var c;if(0===a)return c=$(this.get_frontside_element()).width(),16>=c?4:32>=c?8:64>=c?16:32;a||(a=$(this.get_frontside_element()).width());b||(b=$(this.get_frontside_element()).height());return 32>=a||32>=b?4:64>=a||64>=b?8:128>=a||128>=b?16:32};d.get_name_input_label=function(){return"The labels of my holes are"};d.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};
d.drop_on=function(a,b,c){if(a.box_dropped_on_me)return c=a.box_dropped_on_me&&a.box_dropped_on_me(this,b,c),b&&a.rerender(),c&&this.remove(),c;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c);console.log("No handler for drop of "+this+" on "+a)};d.box_dropped_on_me=function(a,b){console.log("box on box not yet implemented");return!1};d.widget_side_dropped_on_me=function(a,d,h){var f=this.which_hole(d),g;if(0<=f)return g=this.get_hole(f),(f=g.get_contents())?a.drop_on(f,
d,h):g.widget_side_dropped_on_me(a,d,h);b.UTILITIES.report_internal_error(a+" dropped on "+this+" but no event was provided.")};d.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};d.removed_from_container=function(a,b){var c=!!b,f=this.get_index_of(a);0<=f&&(this.set_hole(f,void 0,c),c&&(this.rerender(),a.restore_dimensions()))};d.get_path_to=function(a,d){var h=this.get_size(),f,g;if("empty hole"===a.get_type_name()){h=
a.get_parent_of_frontside();g=b.box.path.create(a.get_index());if(h===this)return g;h=this.get_path_to(h);if(!h)return;h.next=g;return h}for(f=0;f<h;f++)if(g=this.get_hole_contents(f)||this.get_contents_temporarily_removed(f)){if(a===g||g.top_contents_is&&g.top_contents_is(a))return b.box.path.create(f);if(g.get_path_to&&(g=g.get_path_to(a,d)))return h=b.box.path.create(f),h.next=g,h}};d.element_to_highlight=function(a){a=this.which_hole(a,!0);var b;if(0>a||0===this.get_size())return this.get_frontside_element();
a=this.get_hole(a);return(b=a.get_contents())?b.get_frontside_element():a.get_frontside_element()};d.which_hole=function(a){var b=this.get_horizontal(),c=this.get_frontside_element(),f=this.get_size(),d,h;if(0!==f&&(d=$(c).offset(),c=b?$(c).width()/f:$(c).height()/f,h=b?d.left:d.top,a))for(d=0;d<f;d++)if(h+=c,(b?a.pageX<=h:a.pageY<=h)||d+1===f)return d};d.dereference_path=function(a,d){var h,f;if(a){h=a.get_index&&a.get_index();if(!b.debugging||"number"===typeof h){if(f=this.get_hole_contents(h)){if(f.dereference_contents&&
!a.not_to_be_dereferenced)return f.dereference_contents(a.next||a,d);if(a.next){if(f.dereference_path)return f.dereference_path(a.next,d);b.UTILITIES.report_internal_error("Expected to refer to a part of "+f+" but it lacks a method to obtain "+b.path.toString(a.next))}a.removing_widget&&("empty hole"===f.get_type_name()?b.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):f.get_infinite_stack()||d.remove_from_container(f,this));return f}return this.get_hole(h)}b.UTILITIES.report_internal_error(this+
" unable to dereference the path: "+b.path.toString(a))}else return this};d.path={create:function(a){return{get_index:function(){return a},toString:function(){return"scale"===this.true_type?0===a?"the left pan ":"the right pan ":"the "+b.UTILITIES.ordinal(a)+" hole "},get_json:function(b,c,f){var d=function(b,f){c({type:"box_path",index:a,true_type:this.true_type,next:b},f)}.bind(this);this.next?this.next.get_json(b,d,f):d(void 0,f)}}}};d.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};
b.creators_from_json.box_path=function(a,k){var h=d.path.create(a.index);a.next&&(h.next=b.UTILITIES.create_from_json(a.next,k));a.true_type&&(h.true_type=a.true_type);return h};return d}(window.TOONTALK);window.TOONTALK.box_backside=function(b){return{create:function(d){var a=b.backside.create(d),k=b.UTILITIES.create_text_input(d.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(a){if(a=b.UTILITIES.input_area_drop_handler(a,
d.receive_size_from_dropped.bind(d),d))d.rerender(),d.robot_in_training()&&d.robot_in_training().dropped_on_text_area(a,d,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),h=b.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-horiztonal-radio-button","Left to right","Show box horizontally.",!0),f=b.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-vertical-radio-button","Top to bottom","Show box vertically.",
!0),g=function(){var a=parseInt(k.button.value.trim(),10);d.set_size(a,!0,!0)},r=function(){var a="horizontal"===b.UTILITIES.selected_radio_button(h,f).button.value;d.set_horizontal(a,!0,!0)},p=a.get_element(),l=b.backside.create_advanced_settings_button(a,d),t=a.update_display.bind(a),q=b.UTILITIES.create_horizontal_table(h.container,f.container);k.button.addEventListener("change",g);k.button.addEventListener("mouseout",g);h.button.addEventListener("change",r);f.button.addEventListener("change",
r);a.update_display=function(){k.button.value=d.get_size().toString();d.get_horizontal()?b.UTILITIES.check_radio_button(h):b.UTILITIES.check_radio_button(f);t()};b.UTILITIES.when_attached(p,function(){a.is_primary_backside()||d.add_listener("contents_or_properties_changed",function(){a.rerender()})});p.appendChild(k.container);p.appendChild(q);$(q).buttonset();p.appendChild(l);a.rerender();return a}}}(window.TOONTALK);window.TOONTALK.box_hole=function(b){return{create:function(d){var a=Object.create(this),
k,m,f;a.is_hole=function(){return!0};a.is_empty_hole=function(){return!k};a.location_constrained_by_container=function(){return!1};a.get_element=function(){f||(f=document.createElement("div"),f.className="toontalk-box-hole toontalk-frontside toontalk-side",f.toontalk_widget_side=a);return f};a.get_frontside=function(a){return k?k.get_frontside(a):this.get_element()};a.get_frontside_element=function(a){return this.get_element()};a.get_frontside=function(){return this};a.widget_side_dropped_on_me=function(a,
f,d){var k=this.get_parent_of_frontside(),h=this.get_contents(),m,u,e;if(h)return h.widget_side_dropped_on_me&&h.widget_side_dropped_on_me(a,f,d);a.dropped_on_other&&a.dropped_on_other(this,f,d);f?(b.sounds&&b.sounds.fall_inside.play(),d=this.get_element(),h=a.is_plain_text_element(),e=a.get_element(),$(e).css({"z-index":b.UTILITIES.next_z_index()}),u=$(e.parentElement).offset(),m=$(d).offset(),h||(e.style.left=f.pageX-u.left+"px",e.style.top=f.pageY-u.top+"px",$(e).addClass("toontalk-animating-element")),
e.style.width=d.style.width,e.style.height=d.style.height,e.style.left=m.left-u.left+"px",e.style.top=m.top-u.top+"px",f=function(){$(e).removeClass("toontalk-animating-element");k.render();this.set_contents(a)}.bind(this),setTimeout(f,h||b.UTILITIES.has_animating_image(e)?0:1200),k.robot_in_training()&&k.robot_in_training().dropped_on(a,this),a.save_dimensions&&a.set_size_attributes&&a.set_size_attributes($(d).width(),$(d).height()),a.is_backside()||k.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",
{element_widget:e,where:"front",index:this.get_index()}))):(k.rerender(),this.set_contents(a));return!0};a.get_json=function(){return null};a.add_to_json=function(a){return a};a.copy=function(a){return b.box_hole.create(d)};a.match=function(){return"matched"};a.get_type_name=function(a){return k?k.get_type_name(a):a?"empty holes":"empty hole"};a.is_of_type=function(a){return k?k.is_of_type(a):"empty hole"===a};a.get_box=function(){return this.get_parent_of_frontside()};a.update_display=function(){var a;
k&&(a=this.get_frontside_element(),h(k,k.get_element(!0),$(a).width(),$(a).height()))};a.dereference=function(){return k?k.dereference():this};a.can_run=function(){return k&&k.can_run()};a.get_index=function(){return d};a.get_contents=function(){return k};a.set_contents=function(a){var f=this.get_listeners("contents_or_properties_changed");f&&(k!==a&&f.forEach(function(b){b({type:"contents_or_properties_changed",old_value:k,new_value:a})}),k&&f.forEach(function(a){k.remove_listener("contents_or_properties_changed",
a,!0)}),a&&f.forEach(function(b){a.add_listener("contents_or_properties_changed",b)}));k&&k.set_parent(void 0);(k=a)?(k.set_parent(this),b.debugging&&(this._debug_string="A hole containing "+k.to_debug_string()),k.set_visible(m)):b.debugging&&(this._debug_string=this.to_debug_string())};a.visible=function(){return this.get_parent_of_frontside().visible()};a.set_visible=function(a){m=a;k&&k.set_visible(a)};a.remove=function(){k&&k.remove()};a.render=function(){k&&b.DISPLAY_UPDATES.pending_update(this)};
a.rerender=function(){if(k&&this.visible())return this.render()};a.set_running=function(a){k&&k.set_running(a)};a.set_parent=function(a){k&&k.set_parent(a)};a.maintain_proportional_dimensions=function(){if(k)return k.maintain_proportional_dimensions()};a.removed_from_container=function(a,f,d,l){k?(f&&k.restore_dimensions(),this.set_contents(void 0),f&&this.get_parent_of_frontside().render()):l&&b.UTILITIES.report_internal_error("Holes can't be removed from containers.")};a.temporarily_remove_contents=
function(a,b){if(k)return this.get_parent_of_frontside().temporarily_remove_contents(a,b)};a.toString=function(){return k?k.toString():"_"};a.get_description=function(){return k?k.get_description():"_"};a.get_full_description=function(a){return k?k.get_full_description(a):"_"};a.is_backside=function(){return!1};a.get_widget=function(){return this.get_parent_of_frontside()};a.is_number=function(){return k?k.is_number():!1};a.is_box=function(){return k?k.is_box():!1};a.is_scale=function(){return k?
k.is_scale():!1};a.is_bird=function(){return k?k.is_bird():!1};a.is_nest=function(){return k?k.is_nest():!1};a.is_robot=function(){return k?k.is_robot():!1};a.is_element=function(){return k?k.dereference().is_element():!1};a.get_original_width=function(){if(k&&k.get_original_width)return k.get_original_width()};a.get_original_height=function(){if(k&&k.get_original_height)return k.get_original_height()};a.is_sensor=function(){return k?k.is_sensor():!1};a.is_top_level=function(){return!1};a.is_plain_text_element=
function(){return!1};a.get_active=function(){return k?k.get_active():!1};a.set_active=function(a,b){k&&k.set_active(a,b)};b.widget.has_parent(a);b.widget.has_listeners(a);if(b.debugging||b.logging)a.to_debug_string=function(a){var f=("the "+b.UTILITIES.ordinal(d)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box")).substring(0,a);return k?f+" which contains "+k.to_debug_string(a):f+" which is empty"},a._debug_string=a.to_debug_string();
return a}}}(window.TOONTALK);window.TOONTALK.box["function"]=function(){var c=b.create_function_table();c.add_function_object("box hole",function(b,a,k){return c.typed_bird_function(b,function(a,c){var g=Math.round(a.to_float());if(1>g)b.display_message("The box hole function bird cannot accept "+a+". She only accepts positive numbers.");else if(g>c.get_size())b.display_message("The box hole function bird cannot accept "+a+". The box only has "+c.get_size()+" holes.");else return c.get_hole_contents(g-
1)},["number","box"],2,"box hole",a,k)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. 1 for the first hole.","hole",["number","box"]);c.add_function_object("count holes",function(d,a,k){return c.typed_bird_function(d,function(a){return b.number.create(a.get_size())},["box"],1,"count holes",a,k)},"The bird will return with the number of holes the box has.","count holes",["box"]);c.add_function_object("fill hole",function(b,a,k){return c.typed_bird_function(b,
function(a,c,g){var k=Math.round(a.to_float());if(1>k)b.display_message("The fill hole function bird cannot accept "+a+". She only accepts positive numbers.");else return k>c.get_size()&&c.set_size(k),c.set_hole(k-1,g),c},["number","box",void 0],3,"fill hole",a,k)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);c.add_function_object("split box",
function(d,a,k){return c.typed_bird_function(d,function(a,c){var g=Math.round(a.to_float()),k=c.get_size();if(0>g)d.display_message("The box split function bird cannot accept "+a+". She only accepts zero or positive numbers.");else if(g>k)d.display_message("The box split function bird cannot accept "+a+". The box only has "+k+" holes.");else{c.get_holes();var k=k-g,h=b.box.create(k),l;for(l=0;l<k;l++)h.set_hole(l,c.get_hole_contents(l+g));c.set_size(g);return b.box.create(2,!1,[c,h])}},["number",
"box"],2,"split box",a,k)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.","split",["number","box"]);c.add_function_object("merge boxes",function(d,a,k){return c.typed_bird_function(d,function(){var a=0,c,d,k,h;if(0===arguments.length)return b.box.create(0);d=arguments[0];for(c=0;c<arguments.length;c++)a+=arguments[c].get_size();k=d.get_size();d.set_size(a);for(c=1;c<arguments.length;c++)for(h=arguments[c].get_size(),
a=0;a<h;a++)d.set_hole(k,arguments[c].get_hole_contents(a)),k++;return d},["box"],void 0,"merge boxes",a,k)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);c.add_function_object("get window property",function(d,a,k){return c.typed_bird_function(d,function(a){var c=window,d=a.get_size(),k=function(){var b="window",c;for(c=0;c<d;c++)b+="."+a.get_hole_contents(c).get_text().trim();return b},h;for(h=0;h<d;h++)try{c=c[a.get_hole_contents(h).get_text().trim()]}catch(l){b.UTILITIES.display_message("Error trying to find the value of "+
k()+". "+l)}return void 0===c?(c="Error no value for "+k(),b.UTILITIES.display_message(c),b.element.create(c)):"number"===typeof c?b.number.create(c):b.element.create(c.toString())},["box"],1,"window property",a,k)},"The bird will return with the value of the property accessed by each of the property names in the box.","win prop",["box"]);c.add_function_object("set window property",function(d,a,k){return c.typed_bird_function(d,function(a,c){var d=window,k=a.get_size(),h=function(b){var c="window",
f;for(f=0;f<b;f++)c+="."+a.get_hole_contents(f).get_text().trim();return c},l,t,q;for(l=0;l<k-1;l++)try{d=d[a.get_hole_contents(l).get_text().trim()]}catch(u){q="Error trying to find the property of "+h(k-1)+". "+u,b.UTILITIES.display_message(q)}d||(q="Property missing of "+h(k-1));if(!q)try{t=c.to_float?c.to_float():c.get_text?c.get_text():c.toString(),d[a.get_hole_contents(k-1).get_text().trim()]=t}catch(u){q="Unable to set the value of "+h(k)+" to value of "+c}return q?(b.UTILITIES.display_message(q),
b.element.create(q)):c},["box",void 0],2,"set window property",a,k)},"The bird will set the value of the property accessed by each of the property names in the box in the second hole to the value of the widget in the third hole.","set win prop",["box"]);return c.get_function_table()}()})(window.TOONTALK);(function(){var b,h,c,d;window.TOONTALK.bird=function(a){var c=Object.create(a.widget),h=function(b,c,d){var k=b.get_function_type();b=b.get_function_object();var l=Object.keys(TOONTALK[k]["function"]),h=l.map(function(a){return TOONTALK[k]["function"][a].title}),l=a.UTILITIES.create_select_menu("functions",l,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",h);c=c.get_element();var q;b&&$(l.menu).val(b.name).selectmenu("refresh");
$(l.menu).on("selectmenuselect",function(a){d.set_function_name(a.target.value);d.get_description()||(q=$(d.get_backside_element()).find(".toontalk-description-input"),0<q.length&&q.get(0).setAttribute("placeholder",d.get_default_description()))});$(l.menu).selectmenu("menuWidget").addClass("toontalk-select-menu");c.insertBefore(l.container,c.firstChild)};c.create=function(f,g){var r=Object.create(c),p=[],l=[];r.set_nest=function(a,b){if(f===b||void 0===f)f=a};r.is_bird=function(){return!0};r.widget_side_dropped_on_me=
function(a,b,c,e,d){var g,k,l;if(f){if(f.has_ancestor(a))return a.display_message("Bird can't take its nest to its nest!"),!1;!(f.visible()||this.visible()||f.any_nest_copies_visible())||c&&c.visible()&&!c.animate_consequences_of_actions()?(l=function(){try{f.add_to_contents(a,b,c)}catch(e){if(e.wait_for_nest_to_receive_something)e.wait_for_nest_to_receive_something.run_when_non_empty(l,this);else throw console.error(e.stack),e;}},l(),c&&c===a.robot_waiting_before_next_step&&(a.robot_waiting_before_next_step=
void 0,c.run_next_step())):(d||a.save_dimensions(),g=this.get_frontside_element(),setTimeout(function(){$(g).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside().rerender()}.bind(this)),a.set_visible(f.visible()),c&&!e&&(a.robot_waiting_before_next_step=c,c.run_next_step&&(k=function(){a.robot_waiting_before_next_step=void 0;c.run_next_step()})),f.animate_bird_delivery(a,this,k,b,c))}else c&&!c.visible()?
a.remove():console.error("Drop on a nestless bird should have been handled.");b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);return!0};r.animate_delivery_to=function(b,c,d,e,g,k,h,m){var r=!!d,M=this.get_parent_of_frontside(),E=this.get_frontside_element(!0),I=$(E).position();$(E).width();var S=this.closest_visible_ancestor_or_frontside(),F=$(S.get_frontside_element()).offset(),A=function(){var b,c;a.sounds&&a.sounds.bird_fly.pause();r?this.remove():this.visible()&&(b=function(){$(E).removeClass("toontalk-bird-morph-to-static");
$(E).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));M&&M.get_widget().rerender()}.bind(this),E.style.position=U,a.UTILITIES.set_css(E,I),H&&H.appendChild(E),M&&(M.get_widget().is_top_level()?this.rerender():M.get_widget().rerender()),D&&(W.remove_backside_widget(this,!0),D(),p&&(c=p,p=[],l=[],c.forEach(function(a){a()}))),a.UTILITIES.add_animation_class(E,"toontalk-bird-morph-to-static"),a.UTILITIES.add_one_shot_event_handler(E,"animationend",1E3,b));k&&k()}.bind(this),
J=function(){try{d.add_to_contents(b,h,m,this,!0)}catch(c){if(c.wait_for_nest_to_receive_something){c.wait_for_nest_to_receive_something.run_when_non_empty(J,this);k&&(k(),k=void 0);return}a.sounds&&a.sounds.bird_fly.pause();console.error(c.stack);throw c;}w($(E).offset());a.UTILITIES.set_timeout(function(){this.fly_to(F,A,m)}.bind(this))}.bind(this),K=function(b,c){c||(c=a.UTILITIES.widget_side_of_element(b));this.element_to_display_when_flying=b;c&&(this.update_display(),setTimeout(function(){c.update_display()}));
$(b).addClass("toontalk-carried-by-bird");$(b).removeClass("toontalk-temporarily-set-down");a.UTILITIES.set_timeout(function(){var e={left:"",top:"",position:""};c&&!c.use_scaling_transform&&(e.width="",e.height="");1<b.toontalk_x_scale&&(e["font-size"]="inherit");a.UTILITIES.set_css(b,e);this.update_display()}.bind(this))}.bind(this),w=function(c){var e;this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),c?(e={"z-index":a.UTILITIES.next_z_index()},
0<this.element_to_display_when_flying.width_before_carry&&(e.width=this.element_to_display_when_flying.width_before_carry),0<this.element_to_display_when_flying.height_before_carry&&(e.height=this.element_to_display_when_flying.height_before_carry),1<this.element_to_display_when_flying.toontalk_x_scale&&(e["font-size"]="inherit"),a.UTILITIES.set_css(this.element_to_display_when_flying,e),this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying),a.UTILITIES.set_absolute_position(this.element_to_display_when_flying,
c),(c=b.get_parent_of_frontside())&&!c.is_backside()&&c.rerender()):$(this.element_to_display_when_flying).remove(),this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),O,Q,H,U,ca,R,D,n,v,x,W;d||(d=f);x=b.get_element(!0);K(x,b);c.is_function_nest()||(Q=c.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!c.visible()&&!this.visible()||!c.is_function_nest()&&!a.UTILITIES.visible_element(Q))d.add_to_contents(b,h,m,this,!0);else if(a.sounds&&
a.sounds.bird_fly.play(),$(E).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),c.is_function_nest()||(O=$(Q).offset(),R=$(d.get_frontside_element()).closest(".toontalk-backside-of-top-level")),R&&R.is("*")||(R=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")),(c=R.offset())||(c={left:0,top:0}),e?F={left:e+c.left,top:g+c.top}:0===F.left&&0===F.top&&(F={left:-x.clientWidth,top:c.top+R.height()/2}),O||(O={left:-2*x.clientWidth,top:c.top+
R.height()/2}),H=E.parentElement,S=$(E).width(),ca=$(E).height(),U=E.style.position,E.style.position="absolute",W=this.top_level_widget(),M&&M.temporarily_remove_contents&&(D=M.temporarily_remove_contents(this,!0))&&this.get_widget().add_to_top_level_backside(this),0<R.length&&R.get(0).appendChild(E),a.UTILITIES.set_css(E,{left:e||F.left-c.left,top:g||F.top-c.top,width:S,height:ca}),a.logging&&0<=a.logging.indexOf("bird")&&console.log(this.to_debug_string(50)+" from "+(e||F.left-c.left)+", "+(g||
F.top-c.top)+" to "+O.left+", "+O.top),(n=d.get_contents_element&&d.get_contents_element())&&d.visible()&&(!m||m.animate_consequences_of_actions())){e=$(Q).width();g=$(Q).height();v=$(Q).offset();c.max_left=c.left+R.width();c.max_top=c.top+R.height();O.left+=e;O.top+=g;var P={left:Math.min(v.left+e,c.max_left-e),top:Math.min(v.top+g,c.max_top-g)},V={left:Math.max(v.left-e,c.left),top:Math.max(v.top-g,c.top)};O=function(){var a=function(){d.visible()?(d.set_locked(!0),this.fly_to(v,ia,m,300)):(d.add_to_contents(b,
h,m,this,!0),k&&(k(),k=void 0))}.bind(this);$(x).addClass("toontalk-temporarily-set-down");w(P);d.get_locked()?d.run_when_unlocked(a):a()}.bind(this);var ia=function(){K(n);this.fly_to(V,ra,m,300)}.bind(this),ra=function(){$(n).addClass("toontalk-temporarily-set-down");w(V);this.fly_to(P,ua,m,300)}.bind(this),ua=function(){K(x,b);this.fly_to(v,Ca,m,300)}.bind(this),Ca=function(){var c=d.get_contents_dimensions();b.is_plain_text_element()&&$(x).addClass("toontalk-temporarily-set-down");w(v);b.is_plain_text_element()||
a.UTILITIES.set_css(b.get_element(),c);this.fly_to(V,qa,m,300)}.bind(this),qa=function(){K(n);this.fly_to(v,Fa,m,300)}.bind(this),Fa=function(){$(x).removeClass("toontalk-temporarily-set-down");d.set_locked(!1);w();d.update_display();J()}.bind(this);this.fly_to(P,O,m,300)}else this.fly_to(O,J,m,300)};r.get_json=function(b,c,d){var e;f?(e=function(a,b){c({type:"bird",nest:a},b)},a.UTILITIES.get_json(f,b,e,d)):c({type:"bird"},d)};r.copy=function(a){var c,g,e;if(a)if(a.just_value)c=this.create(void 0,
this.get_description());else{if((e=f&&f.get_guid())&&a.nests_copied&&a.nests_copied[e]){c=a.nests_copied[e][0];d.call(c);for(g=1;g<a.nests_copied[e].length;g++)b.call(a.nests_copied[e][g],c);c=this.create(c,this.get_description())}else c=this.create(f,this.get_description());a.birds_copied||(a.birds_copied={});e&&(a.birds_copied[e]||(a.birds_copied[e]=[]),a.birds_copied[e].push(c))}else c=f&&f.is_function_nest()?this.create(f.copy(),this.get_description()):this.create(f,this.get_description());return this.add_to_copy(c,
a)};r.run_when_non_empty=function(a,b){0>l.indexOf(b)&&(p.push(a),l.push(b))};r.create_backside=function(){var b=a.bird_backside.create(this);f&&f.is_function_nest()&&h(f,b,this);return b};r.get_help_URL=function(){return f&&f.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};r.is_function_bird=function(){return f&&f.is_function_nest()};r.get_custom_title_prefix=function(){var a;return f?f.is_function_nest()&&(a=f.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":
"This bird no longer knows where her nest is. She'll get rid of anything you give her."};r.toString=function(a){return f?f.is_function_nest()?f.get_function_object().toString():"bird":a&&"conditions"===a.role?"any bird":"bird without a nest"};r.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird a box to compute the '"+f.get_function_object().name+"' of "+this.get_function_type(!0)+".":"a bird who takes things to her nest."};r.update_display=function(){var b=
this.get_frontside(!0);this.get_backside();var c;c=b.get_element();c.setAttribute("toontalk_name",this.get_name());a.UTILITIES.give_tooltip(c,this.get_title());$(c).is(".toontalk-bird, .toontalk-side-animating")||($(c).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),c.addEventListener("dragenter",function(b){0<=c.className.indexOf("toontalk-bird-static")&&($(c).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),
a.UTILITIES.add_animation_class(c,"toontalk-bird-gimme"))}.bind(this)),c.addEventListener("dragleave",function(a){$(c).is(".toontalk-bird-gimme")&&($(c).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside()&&this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?c.appendChild(this.element_to_display_when_flying):$(c).children(".toontalk-side").remove()};r.set_function_name=
function(a){f&&f.is_function_nest()&&f.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};r.get_function_type=function(a){return f.get_function_type(a)};r.get_class_name_with_color=function(a){return f&&f.get_class_name_with_color?f.get_class_name_with_color(a):a};r.get_name=function(){return f?f.get_name():
""};f&&f.set_name&&(r.set_name=function(a,b,c){return f.set_name(a,b,c)});r.add_standard_widget_functionality(r);r.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});r.set_description(g);a.debugging&&(r._debug_id=a.UTILITIES.generate_unique_id(),r._debug_string=r.to_debug_string());return r};c.create_function=function(b,d,h){return c.create(a.nest.create_function(d,b,h||a.UTILITIES.get_first_property(a[b]["function"])))};c.match=function(a){if(a.get_widget().match_with_any_bird)return a.get_widget().match_with_any_bird(this);
this.last_match=a;return this};c.match_with_any_bird=function(){return"matched"};c.fly_to=function(b,c,d,k){var l=this.get_frontside_element(),h=$(l).offset(),m="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*(Math.atan2(b.top-h.top,b.left-h.left)/Math.PI+1))%8];$(l).position();var u=function(){$(l).removeClass(m);k?setTimeout(c,d?d.transform_step_duration(k):
k):c()}.bind(this);setTimeout(function(){$(l).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));a.UTILITIES.add_animation_class(l,m);this.animate_to_absolute_position(b,u,d&&d.transform_animation_speed(a.UTILITIES.default_animation_speed))}.bind(this),1)};c.get_type_name=function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};c.maintain_proportional_dimensions=function(){return!0};c.matching_resource=function(a){return a.get_type_name&&
a.get_type_name()===this.get_type_name()};c.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c)};a.creators_from_json.bird=function(b,c){return a.bird.create(a.UTILITIES.create_from_json(b.nest,c),b.description)};return c}(window.TOONTALK);window.TOONTALK.bird_backside=function(a){return{create:function(b){var c=a.backside.create(b);c.add_description_setting();c.add_name_setting();c.get_element().appendChild(a.backside.create_advanced_settings_button(c,
b));return c}}}(window.TOONTALK);window.TOONTALK.nest=function(a){var k=Object.create(a.widget),m,f=0,g=0;k.default_maximum_capacity=10;k.maximum_capacity=k.default_maximum_capacity;k.create=function(r,p,l,t,q,u){var e=Object.create(k),B=[],y=[],G=[],L=!1,z,M,E;p||(p=[]);q||(f++,q=f);b=function(a){t&&c.call(t,this);t=a;l=a.get_guid();h.call(a,this)};d=function(){t&&c.call(t,this);t=void 0;l=a.UTILITIES.generate_unique_id();this.set_name(this.generate_name())};h=function(b){m||(m=a.UTILITIES.generate_unique_id());
this[m](b)};c=function(b){m||(m=a.UTILITIES.generate_unique_id());this[m](b,!0)};e.is_nest=function(){return!0};e.get_guid=function(){return l};e.matched_by=function(b){return 0<p.length?a.UTILITIES.match(b,p[0]):[[this,b]]};e.run_when_non_empty=function(a,b){0<p.length?a(p[0]):0>G.indexOf(b)&&(B.push(a),G.push(b))};e.dereference=function(){return 0<p.length?p[0]:this};e.match=function(a){if(0<p.length)return p[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=
a;return this};e.add_to_contents=function(b,c,e,f,d){var g=p.push(b),l=this.visible();g>k.maximum_capacity&&e&&L&&!e.visible()&&!l&&(a.logging&&0<=a.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" postponing addition of "+b.to_debug_string(50)+" by "+e.to_debug_string(50)+". Stack is "+p.length+" long. "+y.length+" previously postponed."),e.add_body_finished_listener(function(){e.set_stopped(!0);y.push(function(){e.set_stopped(!1);e.run_actions()})}));a.logging&&0<=a.logging.indexOf("nest")&&
console.log(this.to_debug_string()+" added "+b.to_debug_string()+" nest now contains "+p.length+" widgets.");b.is_backside()?b.set_parent_of_backside(this):b.set_parent_of_frontside(this);z&&!d&&(f?z.forEach(function(d){d.has_ancestor(b.get_widget())||d.animate_bird_delivery(a.UTILITIES.copy_side(b),f,void 0,c,e)}):z.forEach(function(f){f.has_ancestor(b.get_widget())||f.add_to_contents(a.UTILITIES.copy_side(b,!1,!0),c,e)}));1===g?(L=!1,0<B.length&&(d=B,B=[],G=[],d.forEach(function(a){a(b)})),b.set_visible(l),
l?this.get_containing_widget().rerender():b.hide()):(b.hide(),b.set_visible(!1));this.rerender()};e.animate_bird_delivery=function(b,c,e,f,d){var g,k,l;void 0===this.get_parent_of_frontside()?(b.remove(),e&&e()):(c.animate_delivery_to(b,this,void 0,void 0,void 0,e,f,d),z&&(g=$(c.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),k=c.get_parent_of_frontside().get_element(),l=this.visible(),z.forEach(function(e){var h=a.UTILITIES.copy_side(b,!1,l),m,q;e.has_ancestor(b.get_widget())||
(g&&(e.visible()||l)?(m=c.copy({just_value:!0}),q=m.get_frontside_element(!0),k.appendChild(q),m.animate_delivery_to(h,e,e,g.left,g.top,void 0,f,d)):e.add_to_contents(h,void 0,d))})))};e.get_contents_element=function(){if(0<p.length)return p[0].get_element()};e.get_locked=function(){return this.locked_for_animating_deliveries};e.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};e.run_when_unlocked=
function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};e.removed_from_container=function(b,c,e){b=p.shift();a.logging&&0<=a.logging.indexOf("nest")&&(b?console.log(this.to_debug_string(50)+" removed "+b.to_debug_string()+" remaining widgets is "+p.length):console.log(this.to_debug_string(50)+" nothing left to remove."));if(b)return c||(L=!0),b.is_backside()?b.set_parent_of_backside(void 0):b.get_widget().set_parent_of_frontside(void 0),this.visible()&&
(b.restore_dimensions&&b.restore_dimensions(),0<p.length&&(p[0].set_visible(!0),$(p[0].get_element()).show()),this.get_containing_widget().is_top_level()?this.render():this.get_containing_widget().render()),p.length<=k.maximum_capacity&&0<y.length&&(a.logging&&0<=a.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" running "+y.length+" postponed additions. Stack is "+p.length+" long."),k.maximum_capacity=Number.MAX_VALUE,y.forEach(function(a){a()}),k.maximum_capacity=k.default_maximum_capacity,
y=[]),b;e&&a.UTILITIES.report_internal_error("Nothing removed from nest!")};e.dereference_path=function(b,c){if(0===p.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(p)return p[0].dereference_path(b,c);c.display_message("Robot expected to find something on a nest that it could get "+a.path.toString(b)+". But the nest is empty.");return this};e.dereference_contents=function(b,c){var e,f,d,g,k,l,h,m,q;return 0===p.length?{wait_until_this_nest_receives_something:this}:
b.removing_widget?(e=p[0],c.remove_from_container(e,this),this.visible()&&(l=this.get_frontside_element(),f=$(l).offset(),d=$(l).closest(".toontalk-backside-of-top-level"),(g=d.offset())||(g={left:0,top:0}),k=e.get_element(!0),h=$(l).width(),l=$(l).height(),m=.1*h+f.left-g.left,q=.1*l+f.top-g.top,a.UTILITIES.set_css(k,{width:h*a.nest.CONTENTS_WIDTH_FACTOR,height:l*a.nest.CONTENTS_HEIGHT_FACTOR}),0<d.length&&c.add_watched_step_end_listeners(function(){e.get_parent()&&(d.get(0).appendChild(k),a.UTILITIES.set_css(k,
{left:m,top:q}))})),e):b.next?p[0].get_widget().dereference_path(b.next,c):p[0].get_widget()};e.get_json=function(b,c,e){var f=[],d=function(){var d=function(a,b){c({type:"nest",contents:f,guid:l,original_nest:a,serial_number:q,name:this.get_name()},b)}.bind(this);t?a.UTILITIES.get_json(t,b,d,e):d(void 0,e)}.bind(this);a.UTILITIES.get_json_of_array(p,f,0,b,d,e)};e.copy=function(c){var e,f,d,g;if(c&&c.just_value){if(0<p.length&&(e=p[0].copy(c),!c.copy_covered_nests))return e;f=a.nest.create(this.get_description(),
[],"in a robot's condition",void 0,q,this.get_name());e&&f.add_to_contents(e);return f}e=a.UTILITIES.copy_widget_sides(p,c);c?c.fresh_copy?f=a.nest.create(this.get_description(),e,l&&a.UTILITIES.generate_unique_id()):(d=t||this,c.birds_copied&&c.birds_copied[l]?(g=d.get_guid(),c.nests_copied&&c.nests_copied[g]?(f=c.nests_copied[g][0].copy(),c.nests_copied[g].forEach(function(a){b.call(a,f)})):f=a.nest.create(this.get_description(),e,a.UTILITIES.generate_unique_id(),void 0,void 0,this.generate_name()),
c.birds_copied[l].forEach(function(b){b.set_nest(f,this);a.debugging&&(b._debug_string=b.to_debug_string())}.bind(this))):(f=a.nest.create(this.get_description(),e,l,d,q,this.get_name()),g=l),c.nests_copied||(c.nests_copied={}),c.nests_copied[d]?c.nests_copied[g].push(f):c.nests_copied[g]=[f]):f=a.nest.create(this.get_description(),e,l,t||this,q,this.get_name());return this.add_to_copy(f,c)};e.has_contents=function(){return 0<p.length};e.set_contents=function(a){p=a};e.dropped_on_other=function(b,
c,e){var f,d,g,k,h,m,q;if(!l){l=a.UTILITIES.generate_unique_id();a.debugging&&(this._debug_string=this.to_debug_string());f=a.bird.create(this);if(e){e.add_newly_created_widget(f);if(!this.visible())return;this.robot_waiting_before_next_step=e}c&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(f);a.sounds&&setTimeout(function(){a.sounds.hatching.play()},1E3);this.rerender();d=this.get_frontside_element(!0);a.UTILITIES.add_animation_class(d,"toontalk-hatch-egg");h=function(){var l,
h,u;if(b.is_backside())l=b;else if((l=a.UTILITIES.widget_side_of_jquery($(d).closest(".toontalk-backside-of-top-level")))||(l=a.UTILITIES.widget_side_of_jquery($(b.get_widget().get_frontside_element(!0)).closest(".toontalk-backside-of-top-level"))),l)l=l.is_backside()?l:l.get_backside();else{a.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");return}h=l.get_element();u=$(h).offset();g=f.get_frontside_element(!0);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
a.UTILITIES.add_animation_class(g,"toontalk-fly-southwest");k=a.UTILITIES.relative_position(d,h);a.UTILITIES.set_css(g,{left:k.left,top:k.top});c&&this.robot_in_training()?l.widget_side_dropped_on_me(f,c,void 0,!0):l.widget_side_dropped_on_me(f,c);$(d).removeClass("toontalk-hatch-egg").addClass(this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&a.UTILITIES.set_css(d,{left:k.left-5,top:k.top+
45});this.get_parent_of_frontside().render();q=function(){$(g).removeClass("toontalk-fly-southwest");a.UTILITIES.set_timeout(function(){a.UTILITIES.add_animation_class(g,"toontalk-fly-down");$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));m=function(){var b=function(){$(g).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);$(g).removeClass("toontalk-fly-down");
a.UTILITIES.add_animation_class(g,"toontalk-bird-morph-to-static");a.UTILITIES.add_one_shot_event_handler(g,"animationend",1E3,b);e&&(this.robot_waiting_before_next_step=void 0,e.run_next_step());f.update_display()}.bind(this);a.UTILITIES.add_one_shot_event_handler(d,"animationend",1E3,m)}.bind(this))}.bind(this);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));f.animate_to_absolute_position({left:Math.max(10,k.left-70)+u.left,top:Math.max(10,k.top+
70)+u.top},q,e&&e.transform_animation_speed(a.UTILITIES.default_animation_speed));this.rerender()}.bind(this);a.UTILITIES.add_one_shot_event_handler(d,"animationend",2E3,h)}return!0};e.widget_side_dropped_on_me=function(a,b,c){b&&a.save_dimensions&&a.save_dimensions();0===p.length?(this.add_to_contents(a,b,c),a.dropped_on_other?a.dropped_on_other(this,b,c):b&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(p[0],b,c);return!0};e.drop_on=function(a,b,c){return a.widget_side_dropped_on_me?
(a.widget_side_dropped_on_me(this,b,c),!0):!1};e.element_to_highlight=function(){return 0===p.length?this.get_frontside_element():p[0].get_frontside_element()};e.update_display=function(){var b=this.get_frontside(!0),c=this.get_backside(),e,f,d,g,b=b.get_element();0<p.length?(b.setAttribute("toontalk_name",""),e=p[0],e.is_backside()?(g=e.get_element(!0),e.update_display(),e.scale_to_fit(g,b)):(e.set_visible(!0),e.render(),g=p[0].get_element(!0),$(g).show()),f=$(b).width(),d=$(b).height(),0<f&&0<d&&
a.UTILITIES.set_timeout(function(){var b=this.get_contents_dimensions();b&&(a.UTILITIES.set_css(g,{width:b.width,height:b.height,left:f*(1-a.nest.CONTENTS_WIDTH_FACTOR)/2,top:d*(1-a.nest.CONTENTS_HEIGHT_FACTOR)/2}),e.set_size_attributes&&e.set_size_attributes(b.width,b.height))}.bind(this),2),$(b).parent().is(".toontalk-box-hole")&&!$(b).parent().is(".toontalk-scale-half")?(b.parentElement.appendChild(g),$(g).css({"z-index":a.UTILITIES.next_z_index()})):b.appendChild(g),$(b).addClass(this.get_class_name_with_color("toontalk-empty-nest")),
p[0].is_backside()?e.set_parent_of_backside(this):e.set_parent_of_frontside(this)):(b.setAttribute("toontalk_name",this.get_name()),l?($(b).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(b).addClass(this.get_class_name_with_color("toontalk-empty-nest"))):a.UTILITIES.add_animation_class(b,this.get_class_name_with_color("toontalk-nest-with-egg")));a.UTILITIES.give_tooltip(b,this.get_title());$(b).addClass("toontalk-nest");c&&c.rerender()};m||(m=a.UTILITIES.generate_unique_id());
e[m]=function(a,b){if(!z){if(b)return;z=[]}b?z.splice(z.indexOf(a),1):z.push(a)};e.get_contents_dimensions=function(){var b,c=this.get_frontside_element();b=$(c).parent().is(".toontalk-box-hole")&&!$(c).parent().is(".toontalk-scale-half")?c.parentElement:c;c=$(b).width();b=$(b).height();c*=a.nest.CONTENTS_WIDTH_FACTOR;b*=a.nest.CONTENTS_HEIGHT_FACTOR;var e=p[0],f;if(e)return f=e.is_box()?1:2,e=e.get_border_size?f*e.get_border_size(c,b):0,{width:c-e,height:b-e}};e.get_path_to=function(b,c){var e,f;
if(0<p.length){e=p[0].get_widget();if(e===b)return a.path.to_widget_on_nest();if(e.get_path_to&&(f=a.path.to_widget_on_nest(),e=e.get_path_to(b,c)))return f.next=e,f}};e.walk_children=function(a){if(0<p.length)return a(p[0])};e.top_contents_is=function(a){return 0<p.length&&p[0]===a};e.any_nest_copies_visible=function(){var a=!1;if(!z)return!1;z.some(function(b){b.visible()&&(a=!0)});return a};e.compare_with=function(a){if(0<p.length)return p[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};
e.compare_with_nest=function(a){return 0===p.length?0:1};e.compare_with_number=function(a){return 0<p.length?p[0].compare_with(a):-1};e.get_class_name_with_color=function(a){return q?a+["","-magenta","-yellow"][q%3]:a};e.generate_name=function(){g++;return u&&"#"!==u[0]?a.UTILITIES.strip_trailling_digits(u).trim()+" "+g:"#"+g};e.has_name(e);M=e.set_name;e.set_name=function(b,c,e){var f=this.get_name();if(!M.call(this,b,c,e))return!1;c&&$(".toontalk-bird").each(function(){this.getAttribute("toontalk_name")===
f&&a.UTILITIES.widget_side_of_element(this).rerender()})};e.set_name(u);e.compare_with_box=e.compare_with_number;e.compare_with_scale=e.compare_with_number;e.add_standard_widget_functionality(e);e.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});E=e.set_visible;e.set_visible=function(a){E.call(this,a);a||this.set_locked(!1)};e.set_description(r);a.debugging&&(e._debug_id=a.UTILITIES.generate_unique_id(),e._debug_string=e.to_debug_string());t&&l&&(m||(m=a.UTILITIES.generate_unique_id()),
t[m](e));return e};k.create_function=function(b,c,f){var d=function(){return!1},g=a[c]&&a[c]["function"]&&a[c]["function"][f],d={get_function_type:function(b){return a[c].get_type_name(b)},get_function_object:function(){return g},set_function_name:function(b){if(f===b)return!1;f=b;g=a[c]&&a[c]["function"]&&a[c]["function"][f];this.add_to_contents=g.respond_to_message;return!0},is_function_nest:function(){return!0},copy:function(){return a.nest.create_function(b,c,f)},animate_bird_delivery:function(a,
b,c,f,d){b.animate_delivery_to(a,this,void 0,void 0,void 0,c,f,d)},get_json:function(b,e,f){e({type:"function_nest",function_type:c,function_name:g?g.name:a.UTILITIES.get_first_property(a[c]["function"])},f)},add_to_json:a.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return g.short_name},has_ancestor:d,visible:d,any_nest_copies_visible:d,is_backside:d};a.widget.has_parent(d);a.widget.has_description(d);a.widget.add_sides_functionality(d);d.set_description(b);
g?(d.add_to_contents=g.respond_to_message,a.debugging&&(d._debug_id=a.UTILITIES.generate_unique_id(),d._debug_string="a function nest that "+g.toString())):a.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+c+"."+f+" is not defined.");return d};a.creators_from_json.function_nest=function(b,c){return a.nest.create_function(b.description,b.function_type,b.function_name)};k.create_backside=function(){return a.nest_backside.create(this)};k.match_nest_with_nest=function(a){return"matched"};
k.toString=function(){return"nest"};k.get_default_description=function(){return"a nest that receives things from its birds."};k.get_help_URL=function(){return"docs/manual/birds-nests.html"};k.get_type_name=function(a){return a?"nests":"nest"};k.maintain_proportional_dimensions=function(){return!0};k.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};k.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};a.creators_from_json.nest=
function(b,c){var f=!b.original_nest&&b.guid&&c&&c.guid_to_nest_table&&c.guid_to_nest_table[b.guid];f||(f=a.nest.create(b.description,a.UTILITIES.create_array_from_json(b.contents,c),b.guid,b.original_nest&&a.UTILITIES.create_from_json(b.original_nest,c),b.serial_number,b.name),c.guid_to_nest_table[b.guid]=f);return f};k.CONTENTS_WIDTH_FACTOR=1;k.CONTENTS_HEIGHT_FACTOR=1;return k}(window.TOONTALK);window.TOONTALK.nest_backside=function(a){return{create:function(b){b=a.backside.create(b);b.add_description_setting();
b.add_name_setting();return b}}}(window.TOONTALK)})();window.TOONTALK.scale=function(b){var h=Object.create(b.widget);h.create=function(c,d,a,k,h){var f=function(){a.rerender()},g,r,p;a||(a=b.box.create(2,void 0,c,d,h||""));g=a.get_json;r=a.copy;p=a.get_path_to;a.is_scale=function(){return!0};a.copy=function(c){var f;this.get_name();c||(c={});f=r.call(this,c);f=b.scale.create(void 0,void 0,f,c.just_value&&this.get_state());return a.add_to_copy(f,c)};a.get_json=function(a,b,c){var f=function(a,c){a.type="scale";a.inactive_state=this.get_inactive_state();
b(a,c)}.bind(this);g.call(this,a,f,c)};a.get_path_to=function(a,b){var c=p.call(this,a,b);c&&(c.true_type="scale");return c};a.drop_on=function(a,b,c){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b,c)};a.widget_side_dropped_on_me=function(a,b,c){var f=this.get_hole_contents(0),e=this.get_hole_contents(1),d;a.dropped_on_other&&a.dropped_on_other(this,b,c);if(f&&!e)return this.get_hole(1).widget_side_dropped_on_me(a,b,c),!0;if(!f&&(e||!b))return this.get_hole(0).widget_side_dropped_on_me(a,
b,c),!0;d=this.which_hole(b,!1);if(0===d){if(f){if(f.drop_on)return a.drop_on(f,b,c);return}}else if(e){if(e.drop_on)return a.drop_on(e,b,c);return}this.get_hole(d).widget_side_dropped_on_me(a,b,c);return!0};a.which_hole=function(c,f){var d=a.get_frontside_element(),g=$(d).offset(),d=b.UTILITIES.get_element_width(d),g=c.clientX-(g.left+d/2),d=f?d/10:0;return-g>d?0:g>d?1:-1};a.get_inactive_state=function(){return k};a.update_display=function(){var a=this.get_frontside_element(!0),c=$(a),f=$(a).children(".toontalk-scale-half"),
d=$(a).parent(),d=d.is(".toontalk-backside")||c.is(".toontalk-conditions-contents")?a:d.get(0),e=$(d).width()||c.width(),g=$(d).height()||c.height(),k,h;c.is(".toontalk-top-level-resource")?h="toontalk-scale-balanced":(k=this.get_state(),h="undefined"===typeof k?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][k+1]);c.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");
c.addClass(h);c.addClass("toontalk-scale");c=b.UTILITIES.scale_to_fit(a,d,123,91);0===e&&(e=1);0===g&&(g=1);e/=c.x_scale;g/=c.y_scale;2===f.length?f.each(function(a,c){b.UTILITIES.set_timeout(function(){var f=this.get_hole(a),d=f.get_contents(),f=(d||f).get_element(!0),k,l,m,q;b.UTILITIES.set_css(c,{left:a*e*.5,top:0,width:.5*e,height:g});c!==f&&(k=0===a?-.05*e:.15*e,l="toontalk-scale-balanced"===h?.1*g:0===a&&"toontalk-scale-left_heavier"===h||1===a&&"toontalk-scale-right_heavier"===h?.25*g:1===
a&&"toontalk-scale-left_heavier"===h||0===a&&"toontalk-scale-right_heavier"===h?-.1*g:.2*g,m=.4*e,q=.4*g,$(f).css({left:k,top:l,width:m,height:q}),d&&(d.set_location_attributes&&d.set_location_attributes(k,l),d.set_size_attributes&&d.set_size_attributes(m,q),d.is_backside()&&(d.update_display(),d.scale_to(m,q)),d.render()),c.appendChild(f))}.bind(this))}.bind(this)):(this.get_holes().forEach(function(b,c){var e=b.get_element();b.get_contents();0===c?$(e).addClass("toontalk-left_scale  toontalk-scale-half"):
$(e).addClass("toontalk-right_scale toontalk-scale-half");a.appendChild(e);b.update_display()}),setTimeout(function(){this.render()}.bind(this),100));b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string())};a.render=function(){b.DISPLAY_UPDATES.pending_update(this)};a.get_type_name=function(a){return a?"scales":"scale"};a.get_help_URL=function(){return"docs/manual/scales.html"};a.toString=function(){var a=this.get_hole_contents(0),c=this.get_hole_contents(1),
f,d,e;switch(this.get_state()){case -1:f="scale leaning to the right";break;case 1:f="scale leaning to the left";break;case 0:f="balanced scale";break;default:if(f="unbalanced scale",!d&&!e)return f}d=a?"contains "+b.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";e=c?"contains "+b.UTILITIES.add_a_or_an(c.get_full_description()):"is empty";return f+" and the left pan "+d+" and the right pan "+e};a.create_backside=function(){return b.scale_backside.create(this)};a.get_state=function(){var a=
this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);b=this.get_hole_contents(1);if(a||b)if(a)if(b){if(a=a.dereference(),b=b.dereference(),a.get_widget().compare_with)return a.get_widget().compare_with(b.get_widget())}else return 1;else return-1};a.match=function(a){if(a.get_widget().match_with_scale)return a.get_widget().match_with_scale(this);this.last_match=a;return this};a.match_with_scale=function(a){var b;return(b=this.get_hole_contents(0))&&b.is_nest()&&!b.has_contents()||
(b=this.get_hole_contents(1))&&b.is_nest()&&!b.has_contents()?[[b,this]]:this.get_state()!==a.get_state()?(a.last_match=this,a):this.match_with_this_scale(a)};a.match_with_this_scale=function(a){var c=[],f,d,e;for(f=0;2>f;f++)if(e=a.get_hole_contents(f))if(d=this.get_hole_contents(f)){d=b.UTILITIES.match(e,d.dereference());if(d.is_widget)return d;"matched"!==d&&(c=0===c.length?d:c.concat(d))}else if(d=this.get_contents_temporarily_removed(f))c.push(d);else return a.last_match=this,a;return 0<c.length?
c:"matched"};a.match_with_this_box=function(a){a.last_match=this;return a};a.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};a.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};a.get_name_input_label=void 0;a.generate_name=function(){return""};a.get_hole(0).add_listener("value_changed",f);a.get_hole(1).add_listener("value_changed",f);a.get_hole_contents(0)&&a.get_hole_contents(0).add_listener("value_changed",
f);a.get_hole_contents(1)&&a.get_hole_contents(1).add_listener("value_changed",f);a.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};a.get_default_description=
function(){return"a scale for comparing things."};a.set_name=void 0;b.debugging&&(a._debug_id=b.UTILITIES.generate_unique_id(),a._debug_string=a.to_debug_string());return a};b.creators_from_json.scale=function(c,d){return h.create(b.UTILITIES.create_array_from_json(c.contents,d),c.description,void 0,c.inactive_state,c.name)};return h}(window.TOONTALK);
window.TOONTALK.scale_backside=function(b){return{create:function(h){var c=b.backside.create(h);c.add_description_setting();c.get_element().appendChild(b.backside.create_advanced_settings_button(c,h));return c}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(b){var h=function(a,c,d,f,g){var h;d.current_action_name=c;(a=b.path.get_path_to(a,d,!0))?(f||(f={}),h=Date.now(),f.time=h-d.time_of_last_step,d.time_of_last_step=h,d.add_step(b.robot_action.create(a,c,f),g)):console.log("No path found for "+c);d.current_action_name=void 0},c=Object.create(b.widget),d=0;c.create=function(a,d,h,f,g,r,p,l,t){var q=Object.create(c),u,e,B,y,G=[],L=[],z,M,E,I,S,F,A,J,K;h||(h=b.actions.create());e||(e=q);a&&a.set_parent_of_frontside(q);
q.is_robot=function(){return!0};q.get_frontside_conditions=function(){return a};q.set_frontside_conditions=function(b){(a=b)&&a.set_parent_of_frontside(this)};q.get_backside_matched_widgets=function(){return K};q.set_backside_matched_widgets=function(a){K=a};q.get_matched_backside_widget=function(a){if(K)return K[A.indexOf(a)]};q.get_backside_widget_of_type=function(a,b){var c,e;if(K)return K[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&0>this.get_newly_created_widgets().indexOf(b))return e=
b,!0}.bind(this)),e};q.get_backside_conditions=function(){return d};q.set_backside_conditions=function(a){$.isArray(a)?d=a.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(d=[],b.UTILITIES.available_types.forEach(function(b){a[b]&&d.push(a[b])}));d&&d.forEach(function(a){a.is_backside()?a.set_parent_of_backside(this):(b.widget.erasable(a),a.set_parent_of_frontside(this))}.bind(this))};d&&q.set_backside_conditions(d);q.initialize_backside_conditions=function(){A=this.get_training_context().get_backside_widgets().slice();
J=b.UTILITIES.copy_widget_sides(A,{just_value:!0});this.set_backside_conditions([])};q.add_to_backside_conditions=function(a){var c;0<=this.get_newly_created_widgets().indexOf(a)||(d||(d=[]),a=A.indexOf(a),0<=a&&(c=J[a]),c&&0>d.indexOf(c)&&(d.push(c),b.widget.erasable(c)))};q.get_backside_condition_index=function(a){var b;K?(b=K.indexOf(a),0>b&&(b=K.length,K.push(a))):(b=0,K=[a]);return b};q.get_body=function(){return h};q.set_body=function(a){h=a};q.get_running=function(){return S||this.is_ok_to_run()};
q.running_or_in_run_queue=function(){return S};q.set_running_or_in_run_queue=function(a){S=a};q.stopped=function(){return F};q.set_stopped=function(a){if(F!==a){if(F=a)this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.get_thing_in_hand()&&($(this.get_thing_in_hand().get_element()).removeClass("toontalk-held-by-robot"),this.drop_thing_in_hand()),this.rerender()),S=!1;this.get_next_robot()&&this.get_next_robot().set_stopped(a)}};q.drop_thing_in_hand=function(){g&&
(g.drop_on(this.top_level_widget(),void 0,this),this.set_thing_in_hand(void 0))};q.finish_cycle_immediately=function(a){var b=y,c=function(){y=b;this.set_visible(!1);a&&a()}.bind(this);y=0;this.add_body_finished_listener(c)};q.get_maximum_step_duration=function(){return y};q.get_context=function(){return z};q.set_context=function(a){z=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};q.context_is_backside=function(){return M};q.set_context_is_backside=function(a){M=a;this.get_next_robot()&&
this.get_next_robot().set_context_is_backside(a)};q.get_top_level_context=function(){return E};q.set_top_level_context=function(a){E=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};q.get_queue=function(){return I};q.set_queue=function(a){I=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};q.animate_consequences_of_actions=function(){return this.visible()&&0!==y};q.transform_step_duration=function(a){return void 0===a&&0===y||!this.visible()?0:t&&a?a/t:"number"===
typeof y?Math.min(a,y):a};q.transform_original_step_duration=function(a){if(z&&!z.get_backside()||!this.visible())return 0;if(!t)return a};q.transform_animation_speed=function(a){return z&&!z.get_backside()||!this.visible()?0:t?a*t:a};q.set_animating=function(a,c){var e=this.get_frontside_element(),f;a&&b.UTILITIES.visible_element(e)?(c||(c=$(e).offset()),$(e).css({width:"",height:"","z-index":b.UTILITIES.next_z_index()}),b.UTILITIES.set_position_relative_to_top_level_backside($(e),c),f=$(e).closest(".toontalk-backside-of-top-level"),
0<f.length&&f.get(0).appendChild(e),$(e).addClass("toontalk-robot-animating"),setTimeout(function(){$(e).addClass("toontalk-side-animating")},2E3)):$(e).removeClass("toontalk-robot-animating toontalk-side-animating")};q.add_body_finished_listener=function(a){G.push(a)};q.run_body_finished_listeners=function(){G.forEach(function(a){a()});G=[]};q.add_watched_step_end_listeners=function(a){L.push(a)};q.run_watched_step_end_listeners=function(){L.forEach(function(a){a()});L=[]};q.get_thing_in_hand=function(){return g};
q.set_thing_in_hand=function(a){if(b.debugging){if(a&&"empty hole"===a.get_type_name()){b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");return}b.logging&&0<=b.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string(50)+" now has in his hand "+(a?a.to_debug_string(50):"nothing"))}a&&!a.location_constrained_by_container()&&a.save_dimensions();g=a};q.get_next_robot=function(){return p};q.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());
!a&&p&&(p.set_first_in_team(p),p.set_previous_robot(void 0));(p=a)&&p.set_previous_robot(this);b&&($(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=this.drop_area_instructions())};q.get_previous_robot=function(){return B};q.set_previous_robot=function(a){B=a};q.get_first_in_team=function(){return e};q.set_first_in_team=function(a){e=a;p&&p.set_first_in_team(a)};q.walk_children=function(a){var b;p&&!a(p)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};q.get_run_once=function(){return r};
q.set_run_once=function(a){r=a;this.update_title();return!0};q.get_watched_speed=function(){return t};q.set_watched_speed=function(a){t=a;return!0};q.can_run=function(){return this.get_frontside_conditions()&&this.get_frontside_conditions().is_top_level()||b.widget.can_run.call(this)};q.training_started=function(a){var c=this.get_training_context();c?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(c.copy({just_value:!0})),this.initialize_backside_conditions(),
a||($("*").css({cursor:"url("+b.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),this.update_title(),a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):b.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};q.training_finished=function(){if(this.being_trained){var a,
c,e;a=this.get_body().get_newly_created_widgets();for(c=0;c<a.length;c++)e=a[c],"drop it on top-level"!==e.last_action&&"copy"!==e.last_action||this.add_step(b.robot_action.create(b.newly_created_widgets_path.create(c),"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):
$("*").css({cursor:""})}};if(b.debugging||b.logging)q.to_debug_string=function(a){var c=this.get_frontside_conditions();return("Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(c?b.UTILITIES.add_a_or_an(c.toString()):"anything")).substring(0,a)};p&&q.set_next_robot(p);q.add_standard_widget_functionality(q);u=q.remove_backside_widget.bind(q);q.has_name(q);q.set_name(l);q.set_description(f);b.listen&&q.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});
q.remove_backside_widget=function(a,b){var c=this.get_frontside_conditions(),e;a===c?this.set_frontside_conditions(void 0):(e=this.get_backside_conditions())&&e.some(function(b,c){if(a===b)return e.splice(c,1),!0})||u(a,b)};b.debugging&&(q._debug_id=b.UTILITIES.generate_unique_id(),q._debug_string=q.to_debug_string());return q};c.create_backside=function(){return b.robot_backside.create(this)};c.copy=function(a){var c=this.get_frontside_conditions(),d=this.get_backside_conditions(),c=c?c.copy({just_value:!0}):
void 0,f=this.get_next_robot(),f=f?f.copy(a):void 0,g;d&&(g=b.UTILITIES.copy_widgets(d,{just_value:!0}));d=this.create(c,g,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),f,(!a||!a.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(d,a)};c.match=function(a){var b,c;if(a.get_widget().is_robot()&&(b=this.get_body().is_empty(),c=a.get_widget().get_body().is_empty(),b===c))return"matched";this.last_match=a;return this};c.generate_name=
function(){d++;return"#"+d.toString()};c.run=function(a,c,d,f){var g=this.get_frontside_conditions(),h,p,l,t,q;if(this.being_trained||this.running_or_in_run_queue())return this;(q=this.get_backside())&&q.visible()&&g&&(l=function(a){$(a.get_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},l(g),this.rerender());a?(this.set_context(a),
this.set_context_is_backside(c),this.set_top_level_context(d),this.set_queue(f)):a=this.get_context();this.match_status=b.UTILITIES.match(g,this.get_context());"matched"===this.match_status&&(t=[],(c=this.get_backside_conditions())&&0<c.length&&((h=a.get_backside_widgets())&&c.some(function(c){var e,f;c.matching_widget&&c.matching_widget.get_parent===a&&(e=b.UTILITIES.match(c,c.matching_widget),"matched"===e&&(t.push(c.matching_widget),f=e));f||h.some(function(a){e=void 0;if(!(0<=t.indexOf(a))){if(a!==
this&&!a.is_backside()){l&&l(a);e=b.UTILITIES.match(c,a);if("matched"===e)return t.push(a),f=e,c.matching_widget=a,!0;if(!e.is_widget)f=e;else if(!f||f.is_widget)f=e}void 0===f&&(f=c)}}.bind(this));if("matched"!==f)return this.match_status=f,!0}.bind(this)),"matched"!==this.match_status&&(t=void 0),this.set_backside_matched_widgets(t)));if("matched"===this.match_status)return f||(f=this.get_queue()||b.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),f.enqueue(this),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),
this.rerender(),this.get_next_robot()?this.get_next_robot().run():this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){f=this.get_next_robot().run();if("matched"===f)return f;f.is_widget||f.forEach(function(a){0>this.match_status.indexOf(a)&&this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(p=function(){this.set_waiting(!1);this.run()}.bind(this),this.match_status.forEach(function(a){a[0]?
a[0].run_when_non_empty(p,this):a.run_when_non_empty(p,this)}.bind(this)),this.set_waiting(!0));return this.match_status};c.set_waiting=function(a){var c=this.get_frontside_element();c&&(a?this.visible()&&(b.UTILITIES.add_animation_class(c,"toontalk-robot-waiting"),b.UTILITIES.give_tooltip(c,"This robot is waiting for a bird to deliver something.")):($(c).removeClass("toontalk-robot-waiting"),b.UTILITIES.give_tooltip(c,this.get_title())))};c.run_actions=function(){return this.stopped()?(this.get_first_in_team().set_running(!1),
!1):this.get_first_in_team().visible()?this.get_body().run_watched(this):this.get_body().run_unwatched(this)};c.drop_from_data_transfer=function(a,b){var c;a.is_top_level&&a.is_top_level()?(c=a.get_backside_widgets().slice(),setTimeout(function(){c.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=1E3;this.dropped_on(a,b.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};c.ignore_pick_up_or_drop=function(a){return this===a.get_widget()||
a.is_top_level()||this.get_parent_of_frontside()===a};c.picked_up=function(a,c,d){var f,g,h;if(!this.ignore_pick_up_or_drop(a))return a.get_infinite_stack&&a.get_infinite_stack()?(this.current_action_name="pick up a copy of",g=b.UTILITIES.get_dragee_copy()):this.current_action_name="pick up",d?(h=a,g=a.copy({fresh_copy:!0}),c=b.path.get_path_to_resource(g)):c=b.path.get_path_to(a,this,!0),c&&(d=Date.now(),f={time:d-this.time_of_last_step},this.time_of_last_step=d,f=b.robot_action.create(c,this.current_action_name,
f),this.add_step(f,h)),a.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(g||a),f};c.dropped_on=function(a,c){var d,f,g,h,p;if(!(this.ignore_pick_up_or_drop(a)||a.is_backside()&&this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===a)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(d=b.path.get_path_to(c,this))c.is_backside()?
(g=$(c.get_element()),f=g.offset(),h=g.width(),p=g.height(),g=$(a.get_frontside_element()).offset(),h=(g.left-f.left)/h,f=(g.top-f.top)/p,h=Math.max(0,Math.min(1,h)),f=Math.max(0,Math.min(1,f)),f={left_offset_fraction:h,top_offset_fraction:f}):f={},g=Date.now(),f.time=g-this.time_of_last_step,this.time_of_last_step=g,d=b.robot_action.create(d,this.current_action_name,f),this.add_step(d);a.last_action=this.current_action_name+" "+c.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};
c.dropped_on_text_area=function(a,b,c){h(a,"drop it on the text area of",this,c);a.last_action="drop it on the text area of "+b.get_type_name();this.set_thing_in_hand(void 0)};c.copied=function(a,b,c){c=c?"pick up a copy of":"copy";h(a,c,this,void 0,b);b.last_action=c};c.removed=function(a){var b;this.get_parent()&&(b=this.get_parent().get_widget());h(a,"remove",this);a.last_action="remove";b===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};
c.restored=function(a){h(a,"restore",this)};c.edited=function(a,b){h(a,"edit",this,b)};c.erased_widget=function(a){h(a,"change whether erased",this)};c.resized_widget=function(a,b,c,f,d){b===f&&c===d||h(a,"change size of",this,{x_factor:f/b,y_factor:d/c})};c.started_training_another=function(a){h(a,"start training",this)};c.finished_training_another=function(a){h(a,"stop training",this)};c.trained=function(a,b){h(a,"train",this,{step:b})};c.backside_opened=function(a){h(a,"open the backside",this)};
c.backside_closed=function(a){a.is_primary_backside()?h(a.get_widget(),"close the backside",this):this.removed(a)};c.button_clicked=function(a,b){h(b.get_widget(),"click the button of",this,{button_selector:a})};c.created_widget=function(a,c,d){this.add_newly_created_widget(a);a.get_parent()||this.add_to_top_level_backside(a,!1);this.add_step(b.robot_action.create(b.path.get_path_to_resource(a.copy()),"add a new widget to the work space",{button_selector:d,path_to_source:b.path.get_path_to(c,this)}))};
c.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};c.remove_from_container=function(a,b){var c=b.get_index_of&&a.get_parent_of_frontside()&&b.get_index_of(a),f=function(){b.removed_from_container(a,void 0,c,!0)};a=a.dereference();this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(f):f();this.add_newly_created_widget_if_new(a)};c.get_training_context=function(){return this.get_first_in_team().get_parent_of_frontside()&&this.get_first_in_team().get_parent_of_frontside().get_widget()};
c.add_step=function(a,b){this.get_body().add_step(a,b);this.update_title();"train"!==a.get_action_name()&&"start training"!==a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,a)};c.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var c=this.get_thing_in_hand(),d,f;b.debugging&&(this._debug_string=this.to_debug_string());d=a.get_element();c&&(f=c.get_element());!f&&this.carrying_tool&&(f=document.createElement("div"),$(f).addClass(this.carrying_tool));
b.UTILITIES.give_tooltip(d,this.get_title());$(d).addClass("toontalk-robot");$(d).children(".toontalk-held-by-robot").remove();f&&d.appendChild(f);this.match_status&&(this.match_status.is_widget?$(d).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(d).removeClass("toontalk-robot-not-matched"));d.setAttribute("toontalk_name",this.get_name());b.UTILITIES.set_timeout(function(){var a,h,p,l,t;f&&(t={position:"absolute"},$(f).addClass("toontalk-held-by-robot"),a=b.UTILITIES.get_element_width(f),
b.UTILITIES.get_element_height(f),p=b.UTILITIES.get_element_width(d),l=b.UTILITIES.get_element_height(d),c&&0===a&&(a=c.get_default_width?c.get_default_width():2*p,h=c.get_default_height?c.get_default_height():l/2,t.width=a,t.height=h),t.left=(p-a)/2,t.top=l/4,$(f).css(t),c&&c.rerender())})};c.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};c.add_newly_created_widget_if_new=function(a){if(a!==this.get_training_context()&&this!==a)return this.get_body().add_newly_created_widget_if_new(a)};
c.is_newly_created=function(a){return this.get_body().is_newly_created(a)};c.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-1]};c.get_title=function(){var a=this.get_description();if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?"Drag this robot to a work area.":this.toString()};c.toString=function(a){var c,d,f,g,h,p,l,t,q,u,e,B,y;if(a&&
"conditions"===a.role)return"any robot";if(a&&"match_status"===a.role)return"robot "+this.get_name();c=this.get_frontside_conditions();if(!c)return"an untrained robot";l=c.is_top_level();a||(a={});e=a.person;if(a&&a.resource){if(this.get_description())return'"'+this.get_description()+'"';a.person="third"}d=this.get_backside_conditions();g=this.get_body();p=h="";q=this.get_next_robot();l?u="When the workspace's green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
" is pressed":(t=b.UTILITIES.add_a_or_an(c.get_full_description({role:"conditions"})),u="When working on something that matches "+t);d&&(d.forEach(function(a){a&&(u+=" and\nif on the"+(l?" work area ":" back ")+" is "+b.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),f=!0)}),f&&(u+="\n"));if(this.being_trained){if(g.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";h="is being trained.\n";p="\n..."}g=h+u+(a&&"third"===a.person?
" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(g.toString({robot:this})||"do nothing")+p;if(a&&a.resource)return a.person=e,g.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(y=c.is_top_level()?"the work area I'm running on":"the "+c.get_type_name()+" I'm on the back of",this.match_status===c?B=y:this.match_status.has_ancestor(c)?B="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+y:(c.is_top_level()||(y="the "+
this.match_status.get_type_name()+" on "+y),d.some(function(a){if(this.match_status===a)return B="any "+a.get_type_name(!0)+" on ",c.is_top_level()||(B+="the back of "),B+=y,!0;if(this.match_status.has_ancestor(a))return B="any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+y,!0}.bind(this))),g="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+B+". Perhaps editing my conditions will help.\n"+
g):"matched"!==this.match_status&&(g="I'm waiting for something to be delivered to the nest that matches "+(this.match_status[0][1]?b.UTILITIES.add_a_or_an(this.match_status[0][1].toString()):b.UTILITIES.add_a_or_an(this.match_status[0].toString()))+" in my conditions (highlighted in yellow on my backside).\n"+g));q&&(g+="\nIf it doesn't match then the next robot will try to run.\n"+q.toString());return g};c.get_type_name=function(a){return a?"robots":"robot"};c.maintain_proportional_dimensions=function(){return!0};
c.matching_resource=function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&this.get_body().is_empty()&&a.get_body().is_empty()};c.get_top_level_context_description=function(a){var b=this.get_frontside_conditions().get_type_name();return"top-level"===b?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+b+" he's working on":"the "+b+" I'm working on"};c.get_help_URL=function(){return"docs/manual/robots.html"};c.drop_area_instructions=
function(){return this.get_next_robot()?"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};c.get_json=function(a,c,d){var f=this.get_frontside_conditions(),g=this.get_backside_conditions(),h,p=function(){var g=function(d,g){var e=function(a,b){c({type:"robot",frontside_conditions:a,backside_conditions:h,body:l,run_once:this.get_run_once(),next_robot:d,name:this.get_name(),speed:this.get_watched_speed()},b)}.bind(this);this.get_body().get_json(a,
function(c,d){l=c;f?f.is_top_level()?e({type:"top_level"},d):b.UTILITIES.get_json(f,a,e,d):e(void 0,d)},g)}.bind(this);this.get_next_robot()?b.UTILITIES.get_json(this.get_next_robot(),a,g,d):g(void 0,d)}.bind(this),l;g?(h=[],b.UTILITIES.get_json_of_array(g,h,0,a,p,d)):p()};b.creators_from_json.robot=function(a,c){var d,f,g,h;a.thing_in_hand&&(f=b.UTILITIES.create_from_json(a.thing_in_hand,c));a.next_robot&&(d=b.UTILITIES.create_from_json(a.next_robot,c));a.backside_conditions&&($.isArray(a.backside_conditions)?
h=b.UTILITIES.create_array_from_json(a.backside_conditions,c):a.semantic&&b.UTILITIES.available_types.forEach(function(c){a.semantic.backside_conditions[c]&&h.push(b.UTILITIES.get_json(a.semantic.backside_conditions[c],json_history))}));g=b.UTILITIES.create_from_json(a.frontside_conditions||a.bubble,c);d=b.robot.create(g,h,void 0,a.description,f,a.run_once,d,a.name,a.speed);c||(c={});c.robot=d;d.set_body(b.UTILITIES.create_from_json(a.body,c));return d};c.find_conditions_path=function(a,c,d){var f=
c.get_frontside_conditions(),g=f===a?"entire_condition":f.get_path_to&&f.get_path_to(a,d),f=b.path.get_path_to(c,d),h;g||(c=c.get_backside_conditions(),c.some(function(b){if(b&&(g=b.get_path_to(a,d)))return h=b,!0}));if(g)return b.robot.create_conditions_path(g,f,h);b.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};c.create_conditions_path=function(a,c,d){"string"===typeof d&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===
d)return d=a,!0});return{dereference_path:function(f){var g=b.path.dereference_path(c,f),g=d?d:g.get_frontside_conditions();return"entire_condition"===a?g:b.path.dereference_path(a,f,g)},toString:function(){var f="entire_condition"===a?"the ":b.path.toString(a)+" of the ";return d?f+d.toString()+" backside condition of "+b.path.toString(c):f+" front side condition of "+b.path.toString(c)},get_json:function(f,g,h){var p=function(b,h){c.get_json(f,function(b,c){var e=function(a,c){g({type:"path_to_robot_conditions",
backside_condition:d&&a,path_to_robot:b,path_within_conditions:a},c)};"entire_condition"===a?e("entire_condition",c):a.get_json(f,e,c)},h)};d?b.UTILITIES.get_json(d,f,p,h):p(void 0,h)}}};b.creators_from_json.path_to_robot_conditions=function(a){var c=b.UTILITIES.create_from_json(a.path_to_robot),d="entire_condition"===a.path_within_conditions?a.path_within_conditions:b.UTILITIES.create_from_json(a.path_within_conditions);a=a.backside_condition&&b.UTILITIES.create_from_json(a.backside_condition);return b.robot.create_conditions_path(d,
c,a)};return c}(window.TOONTALK);window.TOONTALK.robot_backside=function(b){var h=function(c,a,h,m){c=b.UTILITIES.create_text_element(c);var f=a.get_element(!0),g=document.createElement("div"),r=function(){var c;a.visible()&&($(f).parent().addClass("toontalk-conditions-container"),a.update_display(),c={width:$(g).width(),height:$(g).height(),left:"",top:""},a.use_scaling_transform?a.use_scaling_transform(c):a.is_backside()&&b.UTILITIES.scale_element(f,c.width,c.height,a.get_original_width()||$(f).width(),
a.get_original_height()||$(f).height(),void 0,c),$(f).css(c),a.rerender())};$(f).addClass("toontalk-conditions-contents "+m);h.match_status&&(h.match_status.is_widget?$(h.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==h.match_status&&h.match_status.forEach(function(a){$(a[1].get_element()).addClass("toontalk-conditions-waiting")}));g.appendChild(f);h=b.UTILITIES.create_horizontal_table(c,g);$(h).addClass("toontalk-conditions-panel");b.UTILITIES.run_when_dimensions_known(f,
function(){setTimeout(r,100)});return h},c=function(c,a){var k=a.get_frontside_conditions(),m=a.get_backside_conditions(),f=a.visible(),g;k&&(k.is_top_level()?0>c.firstChild.textContent.indexOf("I always run when the green flag")&&c.insertBefore(b.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),c.firstChild):0===$(c).find(".toontalk-frontside-conditions-area").length&&c.insertBefore(h("I run only if the thing I'm on the back of matches: ",
k,a,"toontalk-frontside-conditions-area"),c.firstChild),k.set_visible(f),k.rerender());m&&m.forEach(function(k){var m;k&&(m=k.is_backside()?"on-backside":k.get_type_name(),g="toontalk-backside-"+m+"-conditions-area",m="bird"===m?b.UTILITIES.create_text_element("And there is a bird on the back."):h("And if "+b.UTILITIES.add_a_or_an(m)+" matches: ",k,a,g),c.insertBefore(m,c.firstChild.nextSibling),k.set_visible(f),k.rerender())})};return{create:function(d){var a=b.backside.create(d),h=a.get_element(),
m=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},f=b.UTILITIES.create_check_box(!d.get_run_once(),"toontalk-run-once-check-box","When finished start again",m(d.get_run_once())),g="normal;original;double;half;very fast;very slow".split(";"),r=[1,0,2,.5,10,.25],p=function(a){a=g.indexOf(a);return r[a]},l=b.UTILITIES.create_select_menu("robot_speed",
g,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),t=b.UTILITIES.create_drop_area(d.drop_area_instructions()),q=d.get_next_robot(),u=b.backside.create_advanced_settings_button(a,d),e=a.update_display.bind(a),B=function(a,b){var c=a.get_frontside_element(!0),
e,d;a.get_default_width&&(e=a.get_default_width(),d=a.get_default_height(),$(c).css({left:"",top:"",width:e,height:d}));b.appendChild(c)},y=a.hide_backside,G=a.add_advanced_settings;a.hide_backside=function(a){y.call(this,a);d.being_trained&&d.training_finished()};$(t).data("drop_area_owner",d);f.button.addEventListener("click",function(a){var c=f.button.checked;d.set_run_once(!c);b.UTILITIES.give_tooltip(f.container,m(!c));d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:"set_run_once",
argument_1:!c,toString:"change to "+(c?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});a.stopPropagation()});$(l.menu).val(function(a){a=void 0!==a?r.indexOf(a):0;return g[a]}(d.get_watched_speed())).selectmenu("refresh");$(l.menu).on("selectmenuselect",function(a){d.set_watched_speed(p(a.target.value))});q&&B(q,t);t.addEventListener("drop",function(a){(a=b.UTILITIES.get_dragee())&&a.is_robot()&&(a.get_body().is_empty()?(a=a.open_backside(),$(a.get_element()).find(".toontalk-train-backside-button").click()):
(B(a,t),d.set_next_robot(a)))});a.get_next_robot_area=function(){return t};a.update_display=function(){var a=d.get_frontside_element();a&&b.UTILITIES.give_tooltip(a,d.get_title());e()};b.UTILITIES.when_attached(h,function(){var a=d.get_backside_conditions(),b=d.get_frontside_conditions();a&&a.forEach(function(a){a.set_visible(!0)});b&&b.set_visible(!0)});h.appendChild(this.create_train_button(a,d));c(h,d);h.appendChild(u);a.add_advanced_settings=function(){G.call(a,f.container,l.container,t)};return a},
create_train_button:function(d,a){var h=d.get_element();$(h);var m=$("<button>Train</button>").button(),f=!1;m.addClass("toontalk-train-backside-button");d.change_label_and_title_of_train_button=function(d){d?(m.button("option","label","Stop training "+a.get_name()),b.UTILITIES.give_tooltip(m.get(0),"Click to stop training this robot.")):a.get_body().is_empty()?(m.button("option","label","Train"),b.UTILITIES.give_tooltip(m.get(0),"Click to start training this robot.")):(m.button("option","label",
"Re-train "+a.get_name()),b.UTILITIES.give_tooltip(m.get(0),"Click to start training this robot all over again."));b.UTILITIES.visible_element(h)&&c(h,a)};d.change_label_and_title_of_train_button(f);m.get(0).addEventListener("click",function(b){f=!f;d.change_label_and_title_of_train_button(f);f?(a.initialize_backside_conditions(),a.get_body().reset_steps(),a.robot_started_training(a),a.training_started()):a.training_finished();b.stopPropagation()});return m.get(0)}}}(window.TOONTALK)})();(function(){var b=function(b){return"rotate"===b||"skewX"===b||"skewY"===b||"transform-origin-x"===b||"transform-origin-y"===b},h=function(c){return"transform-origin-x"===c||"transform-origin-y"===c?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+c:b(c)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+c:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+c};window.TOONTALK.element=function(c){var d=["left","top","width","height"],a=Object.create(c.widget),k=
function(a,b){var c,d;if(!a)return 0;"number"===typeof a&&(d=a);0===a.length&&(d=0);if("undefined"===typeof d&&(c=a.substring(a.length-1),0<="0123456789x".indexOf(c)&&(d=parseFloat(a),isNaN(d))))return;c=d;0<=["rotate","skewX","skewY"].indexOf(b)&&(c%=360,0>c&&(c+=360));return c},m=function(a,b){var c,d,h,k,m;if((b.left||b.top)&&!a.being_dragged&&(c=a.get_parent_of_frontside(),m=$(a.get_element()).width(),h=$(a.get_element()).height(),c))return b.left&&(d=c.is_element()?c.get_original_width():c.get_width(),
b.left<m/-2||b.left>d+m/2)&&(d=0<d?(b.left%d+d)%d:b.left,b.left!==d&&(b.left=d,k=!0)),b.top&&(c=c.is_element()?c.get_original_height():c.get_height(),b.top<h/-2||b.top>c+h/2)&&(h=0<c?(b.top%c+c)%c:b.top,b.top!==h&&(b.top=h,k=!0)),k};a.create=function(d,g,h,k,l,t,q,u){var e=Object.create(a),B=c.UTILITIES.generate_unique_id(),y=e.drag_started,G={},L={},z,M,E,I,S,F,A,J,K,w,O,Q,H,U,ca,R;g||(g=["left","top","width","height"]);e.is_element=function(){return!0};e.get_HTML=function(){return I};e.get_guid=
function(){return B};e.get_text=function(){var a,b;return void 0===S&&((a=this.get_frontside_element())?S=a.textContent:(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),S=a.textContent,$(a).remove()):S=b,""===S&&a&&"IMG"!==a.nodeName&&(this.update_display(),S=a.textContent),""===S)?this.get_HTML():S};e.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,e;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>c)break;b+=3;e=a.indexOf("target='_blank'",
b);if(0>e||e>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(I===a)return!1;I=c(a);if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element()?b.innerHTML=I.replace(/ /g,"&nbsp;"):b.innerHTML=I;F&&this.compute_original_dimensions(!0);return!0};e.set_HTML_from_sub_classes=e.set_HTML;
e.set_text=function(a){var b=this.get_frontside_element(),c=function(b){$(b).contents().each(function(){this.nodeType==Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};e.get_style_attributes=function(){return g};e.set_style_attributes=function(a){g=a};e.get_attribute_widgets_in_backside_table=function(){return G};e.set_attribute_widgets_in_backside_table=
function(a){G=a};e.get_original_copies=function(){return L};e.get_pending_css=function(){return O};e.get_transform_css=function(){return Q};e.add_to_css=function(a,c){b(a)?(Q||(Q={}),Q[a]=c):(O||(O={}),O[a]=c)};e.apply_css=function(){var a="",b,e;(O||Q)&&(b=this.get_frontside_element())&&!$(b).is(".toontalk-not-observable")&&(jQuery.contains(window.document,b)?(O?(O.width&&(K=O.width),O.height&&(w=O.height)):O={},O.position="absolute",Q&&("number"===typeof Q.rotate&&(a+="rotate("+Q.rotate+"deg)"),
"number"===typeof Q.skewX&&(a+="skewX("+Q.skewX+"deg)"),"number"===typeof Q.skewY&&(a+="skewY("+Q.skewY+"deg)"),"number"===typeof Q["transform-origin-x"]||"number"===typeof Q["transform-origin-y"])&&(O["transform-origin"]=(Q["transform-origin-x"]||0)+" "+(Q["transform-origin-y"]||0)),K||w?(U&&U.css({width:A,height:J}),this.is_plain_text_element()&&this.plain_text_dimensions(),$(b).css({width:"",height:""}),e=O,c.UTILITIES.run_when_dimensions_known(b,function(d){var f=this.get_parent_of_frontside();
m(this,e);$(b).is(".toontalk-conditions-contents")&&$(b.parentElement).is(".toontalk-conditions-container")&&(K=$(b.parentElement).width(),w=$(b.parentElement).height());(this.ok_to_set_dimensions()||this.location_constrained_by_container())&&c.UTILITIES.scale_element(b,K,w,A,J,a,e,d,!f);O=void 0}.bind(this))):(m(this,O),c.UTILITIES.add_transform_to_css(a,"",O,0>b.parentElement.className.indexOf("toontalk-box-hole")),$(b).css(O),O=void 0)):c.UTILITIES.when_attached(b,this.apply_css.bind(this)))};
e.on_update_display=function(a){H?H.push(a):H=[a]};e.fire_on_update_display_handlers=function(){H&&c.UTILITIES.set_timeout(function(){H.forEach(function(a,b){a()||H.splice(b,1)})})};e.get_image_element=function(){return U};e.set_image_element=function(a,b){U=$(a).find("img");0===U.length?U=void 0:($(b).width(U.width()),$(b).height(U.height()))};e.get_additional_classes=function(){return u};e.set_additional_classes=function(a){u=a};e.get_children=function(){return k};e.get_child=function(a){if(k)return k[a]};
e.set_sound_effect=function(a){z=a;z.volume=c.UTILITIES.get_audio_volume(z)};e.get_sound_effect=function(){return z};e.get_video_object=function(){var a;M||(a=this.get_frontside_element())&&(M=a.getElementsByTagName("video")[0]);return M};e.set_video_object=function(a){M=a};e.get_ignore_pointer_events=function(){return q};e.set_ignore_pointer_events=function(a){q=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":"auto"})};e.get_source_URL=function(){return E};
e.set_source_URL=function(a){if(E!==a)return E=a,this.refresh(),!0};e.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===A?c.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),function(){c.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,A,J,void 0,a)}.bind(this)):c.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,A,J,void 0,a)};e.add_standard_widget_functionality(e);ca=e.set_running.bind(e);
e.set_running=function(a,b){ca(a,b);Object.keys(G).forEach(function(c){G[c].set_running(a,b)});!a&&this.visible()&&(g.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());k.forEach(function(c){c.set_running(a,b)})};R=e.can_run.bind(e);e.can_run=function(){var a;if(R())return!0;Object.keys(G).some(function(b){if(G[b].can_run())return a=!0});if(a)return a;k.some(function(b){if(b.can_run())return a=!0});return a};e.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;
this.drag_y_offset=a.view.drag_y_offset;y.call(this,a,b)};e.update_display=function(){var a=this.get_frontside_element(!0);this.get_backside();var b=function(a){return this.get_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged)if(this.get_erased()){var e;e=$(a).parent(".toontalk-backside").is("*")?b="":b="100%";this.save_dimensions();$(a).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:b,height:e,
position:"",transform:""});$(a).parent(".toontalk-conditions-container").is("*")?c.UTILITIES.give_tooltip(a,"This is an element that has been erased. It will match any element."):c.UTILITIES.give_tooltip(a,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(a).is(".toontalk-erased-element")&&($(a).removeClass("toontalk-erased-element"),this.restore_dimensions()),this.initialize_element(),"undefined"===typeof A&&a.parentElement&&(this.is_plain_text_element()?
this.plain_text_dimensions():this.compute_original_dimensions()),this.apply_css(),k?k.forEach(function(b){a.appendChild(b.get_frontside_element(!0));b.set_visible(!0);b.update_display()}):k=[],this.fire_on_update_display_handlers(),c.open_backside_only_if_alt_key||c.UTILITIES.give_tooltip(a,"Click to see the backside where you can place robots or change the style of this "+b(a)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};e.initialize_element=function(){var a,b;!F&&(a=this.get_frontside_element())&&
($(a).children(".ui-resizable-handle"),I=this.get_HTML(),b=this.is_plain_text_element(),a.innerHTML=b?I.replace(/ /g,"&nbsp;"):I,$(a).addClass("toontalk-element-frontside"),b?((b=this.get_additional_classes())&&$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.location_constrained_by_container()||this.plain_text_dimensions()):$(a).addClass("toontalk-non-plain-text-element"),F=!0)};e.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};e.plain_text_dimensions=
function(){A=12*this.get_HTML().length;J=32;this.saved_width=A;this.saved_height=J};e.compute_original_dimensions=function(a){c.UTILITIES.original_dimensions(this,function(a,b){var c=this.get_parent_of_frontside();A=a;J=b;c&&c.get_box?c.get_box().rerender():(g.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),a)};e.get_attribute_from_current_css=function(a){var b,e;if("width"===a&&(K||A))return K||A;if("height"===a&&(w||J))return w||J;b=this.get_frontside_element(!0);
e=c.UTILITIES.get_style_numeric_property(b,a);""===e&&(e=$(b).css(a));if(!e)return 0;if("number"===typeof e){if(A&&w){if("left"===a)return e+(A-K)/2;if("top"===a)return e+(J-w)/2}return e}return"%"!==e.charAt(e.length-1)||"left"!==a&&"top"!==a?e:$(b).offset()[a]};e.get_original_width=function(){return A};e.get_original_height=function(){return J};e.increment_width=function(a){this.set_attribute("width",(K||A)+a)};e.increment_height=function(a){this.set_attribute("height",(w||J)+a)};e.get_width=function(){return K};
e.get_height=function(){return w};e.add_child=function(a){var b=$(a.get_frontside_element(!0)),e=$(this.get_frontside_element(!0)),d;k.push(a);a.set_parent_of_frontside(this);d=c.UTILITIES.set_position_relative_to_element(b,e,b.offset(),!0);a.is_element()&&a.set_location_attributes(d.left,d.top);e.get(0).dispatchEvent(c.UTILITIES.create_event("widget added",{element_widget:b.get(0),where:"front"}));this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)};e.removed_from_container=function(a,
b){var c=k.indexOf(a);0<=c&&k.splice(c,1)};e.set_HTML(d.toString());e.set_description(h);l&&("string"===typeof l?e.set_sound_effect(new Audio(l)):e.set_sound_effect(l));t&&("string"===typeof t?e.set_HTML("<video src='"+t+"'/>"):e.set_video_object(t));c.debugging&&(e._debug_id=c.UTILITIES.generate_unique_id(),e._debug_string=e.to_debug_string());k?k.forEach(function(a){a.set_parent_of_frontside(e)}):k=[];return e};a.copy=function(b){var d=this.get_style_attributes(),h=a.create(this.get_HTML(),d.slice(),
this.get_description(),c.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),k=this.get_attribute_widgets_in_backside_table(),l={},m=h.get_backside(this.visible());h.set_source_URL(this.get_source_URL());b&&(b.elements_copied||(b.elements_copied={}),b.elements_copied[this.get_guid()]=h);Object.keys(k).forEach(function(a){l[a]=k[a].copy(b);l[a].set_parent_of_frontside(m,!1,!0);h.set_attribute(a,this.get_attribute(a))}.bind(this));
h.set_attribute_widgets_in_backside_table(l);return this.add_to_copy(h,b)};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};a.match_with_any_element=function(){return"matched"};a.match_with_another_element_widget=function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();
if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};a.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};a.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};a.get_path_to=function(b,c){var d=this.get_children(),h=d.indexOf(b),k,m;if(0<=h)return a.path.create(h);d.forEach(function(d,h){d.get_path_to&&(m=d.get_path_to(b,c))&&(k=a.path.create(h),k.next=m)});return k};c.creators_from_json.element_path=
function(b,d){var h=a.path.create(b.index);b.next&&(h.next=c.UTILITIES.create_from_json(b.next,d));return h};a.dereference_path=function(a,b){var d,h;if(a){d=a.get_index&&a.get_index();if(!c.debugging||"number"===typeof d)if(h=this.get_children(),d=h[d]){if(d.dereference_contents&&!a.not_to_be_dereferenced)return d.dereference_contents(a.next||a,b);if(a.next){if(d.dereference_path)return d.dereference_path(a.next,b);c.UTILITIES.report_internal_error("Expected to refer to a child of "+d+" but it lacks a method to obtain "+
c.path.toString(a.next))}a.removing_widget&&(d.get_infinite_stack()||b.remove_from_container(d,this));return d}c.UTILITIES.report_internal_error(this+" unable to dereference the path: "+c.path.toString(a))}else return this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+c.UTILITIES.ordinal(a)+" widget "},get_json:function(b,c,d){c({type:"element_path",index:a,next:this.next&&this.next.get_json(b)},d)}}}};a.widget_side_dropped_on_me=function(a,b,c){if(a.is_backside())return!1;
this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};a.create_backside=function(){return c.element_backside.create(this)};a.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};a.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a),d;"left"===a?(d=this.get_frontside_element(),d=c.UTILITIES.translate_x(d)):"top"===a?(d=
this.get_frontside_element(),d=c.UTILITIES.translate_y(d)):d=0;return"undefined"!==typeof b&&"auto"!=b?b+d:this.get_attribute_from_current_css(a)+d};a.set_attribute=function(a,b,d,h){var l=this.get_frontside(!0).get_element(),m;if(!l)return!1;m="left"===a?c.UTILITIES.translate_x(l):"top"===a?c.UTILITIES.translate_y(l):0;l=this.get_attribute_from_pending_css(a);b-=m;if(l===b||"undefined"===typeof l&&(l=this.get_attribute_from_current_css(a),l===b))return!1;m=k(b,a);if("number"===typeof m){if(l==m)return!1;
c.logging&&0<=c.logging.indexOf("attribute:")&&0<=c.logging.indexOf(a)&&console.log("Attribute "+a+" set to "+m+" was "+l+" at "+Date.now()+" for "+this);b=m}d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:a,argument_2:b,toString:"change the '"+a+"' style to "+b+" of",button_selector:".toontalk-element-"+a+"-attribute-input"});this.add_to_css(a,b);h&&(b=this.get_style_attributes(),0>b.indexOf(a)&&b.push(a));this.rerender();return!0};a.dropped_on_style_attribute=
function(a,b,c,d){var h,k,m;if(a){h=a.toString();if(a.is_number()){k=this.get_attribute(b);if("number"===typeof k)m=k;else if("auto"===k)switch(b){case "left":m=$(this.get_frontside_element()).offset().left;break;case "top":m=$(this.get_frontside_element()).offset().top;break;default:m=0}else m=parseFloat(k);k=a.to_float();switch(h.substring(0,1)){case "-":h=m-k;break;case "*":h=m*k;break;case "/":h=m/k;break;case "^":h=Math.pow(m,k);break;default:h=m+k}this.set_attribute(b,h,!1);(c||d&&d.visible())&&
this.get_backside().render()}a.get_infinite_stack()||a.remove();c&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};a.get_attribute_widget_in_backside_table=function(a,b,c){var d=this.get_attribute_widgets_in_backside_table()[a];d||b||(d=this.create_attribute_widget(a,c),this.get_attribute_widgets_in_backside_table()[a]=d);return d};a.create_attribute_widget=function(a,b){var k=".toontalk-element-"+a+"-attribute-input",p=this.get_backside_element(),
l=this.get_attribute(a),t=this,q=function(a,b){var e=b.toString,d=b.equals,f=b.remove;L=b.update_display;b.element_widget=this;b.attribute=a;b.get_type_name=function(a){return a?"element attributes":"element attribute"};b.toString=function(){return e.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};b.get_default_description=function(){return"a number that is the "+this.attribute+" of "+this.get_attribute_owner().toString({plain_text:!0})+"."};b.get_custom_title_prefix=function(){return"I'm the '"+
this.attribute+"' attribute of "+this.get_attribute_owner()+".\nDrop a number on me or edit my backside to change my value. My backside has an info button to learn more."};b.equals=function(b){return a===b.attribute?this.equals(b.element_widget):d.call(this,b)};b.update_display=function(){var a,b,c;this.get_erased()||(a=this.get_attribute_owner(),a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_element()&&!a.being_dragged?(c={},b=bigrat.toDecimal(this.get_value()),c[this.attribute]=b,m(a,
c)&&this.set_value(c[this.attribute]),$(a.get_frontside_element()).css(c)):(a=a.get_attribute(this.attribute),isNaN(a)||G(a)));L.call(this)};y=b.copy.bind(b);b.copy=function(b){var c;if(b){if(b.just_value)return y(b);b.elements_copied&&(c=b.elements_copied[t.get_guid()])}return this.add_to_copy((c||t).create_attribute_widget(a),b)};b.get_json=function(b,e,d){c.UTILITIES.get_json(t,b,function(b,c){e({type:"attribute_widget",attribute_name:a,element:b},c)},d)};b.get_original_attribute_widget=function(){var b=
t.get_original_copies()[a];return b&&b[0]};b.is_attribute_widget_copy=function(b){var c=t.get_original_copies()[a];return c&&0<=c.indexOf(b)};b.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():t;if(!b.get_widget().is_element())return t;b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=
c.get_widget(),c=b.get_parent_of_backside();return b};b.remove=function(b,c){var e=t.get_original_copies()[a],d=e&&e.indexOf(this);0<=d&&e.splice(d,1);f.call(this,b,c)};b.get_help_URL=function(){return h(a)}}.bind(this),u=function(a,b){var e=c.number.create(0,1);q(a,e);e.set_value_from_decimal(b);e.set_format("decimal");e.set_value=function(b){try{var e=t.get_original_copies()[a],d="number"===typeof b?b:bigrat.toDecimal(b),f=bigrat.fromDecimal(d);this.get_attribute_owner().set_attribute(this.attribute,
d)&&e.forEach(function(a,b){a.set_value_from_sub_classes(f,!0)});return this.set_value_from_sub_classes(f,!1)}catch(g){return c.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+g),!1}};e.is_attribute_widget=function(){return!0};e.get_function_type=function(a){return a?"numbers":"number"};return e}.bind(this),e=function(a,b){var e=c.element.create(b);q(a,e);e.set_HTML=function(b){var c=t.get_original_copies()[a],e;this.get_attribute_owner().set_attribute(this.attribute,
b)&&c.forEach(function(a,c){e=a.set_HTML_from_sub_classes(b)});return e};e.get_function_type=function(a){return a?"elements":"element"};e.set_additional_classes("toontalk-string-attribute-widget");return e}.bind(this),B;B=0<=["background-color","color"].indexOf(a)?"string":"number";var y,G,L,z,M;p&&(k=$(p).find(k),0<k.length&&(k.get(0).toontalk_widget_side=this));if("number"===B){if(z=u(a,l),G=z.set_value_from_decimal.bind(z),0<=d.indexOf(a)&&(this.on_update_display(function(){z.rerender();return!0}),
"left"===a||"top"===a))M=function(b){var c,e,d;b.currentTarget.toontalk_widget_side===z.get_attribute_owner()&&(c=z.get_attribute_owner(),b.stopPropagation(),e=$(c.get_frontside_element()).closest(".toontalk-backside-of-top-level").offset(),e||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),e={left:0,top:0}),d=b.pageX-e.left-(c.drag_x_offset||0),e=b.pageY-e.top-(c.drag_y_offset||0),"left"===a?(b=d,c.set_attribute("top",e)):(b=
e,c.set_attribute("left",d)),z.set_value_from_decimal(b),L.call(z))},z.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",M);b&&b.get_widget().is_element()&&b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",M)})}else if("string"===B)z=e(a,l),G=z.set_HTML.bind(z);else{c.UTILITIES.report_internal_error("Unrecognized attribute type: "+B+" for "+a);return}(l=this.get_original_copies()[a])?
l.push(z):this.get_original_copies()[a]=[z];return z};c.creators_from_json.attribute_widget=function(a,b){return c.UTILITIES.create_from_json(a.element,b).create_attribute_widget(a.attribute_name,b)};c.creators_from_json.attribute_number=c.creators_from_json.attribute_widget;a.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};a.toString=function(a){var b,d,h;if(this.get_erased())return"any element";
b=function(b){var c="",d=function(a,b,c){var d=b.indexOf(a+"="),f,g;if(0<=d&&(f=b.indexOf("'",d),0<=f&&(g=b.indexOf("'",f+1)),0<=g))return b.substring(0,d)+a+"="+c+b.substring(g+1);d=b.indexOf(" ");return b.substring(0,d+1)+a+"="+c+" "+b.substring(d+1)};if(1<b.length&&"<"===b.charAt(0)){if(this.get_image_element())c="style='width: 60px; height: 40px;'";else{if(0===b.indexOf("<img "))return"<img width='60' height='40' "+b.substring(4);if(0<=b.indexOf("<iframe "))return b.indexOf("<iframe "),d("width",
d("height",b,"'60'"),"'80'")}a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'");return"<div "+c+">"+b+"</div>"}return'"'+b+'"'}.bind(this);d=function(){var a=this.get_HTML(),b=a.indexOf("alt="),c;return 0<=b&&(c=a.indexOf("'",b+5),0<=c)?"("+a.substring(b+5,c)+")":""}.bind(this);h=this.get_children();if(a&&!a.inside_tool_tip&&"conditions"!==a.role){if(a.for_json_div)return"";b=d();b||(b=(b=this.get_source_URL())?"whose text is the contents of "+b:(b=this.get_text())?'"'+b+'"':"")}else b=
b(this.get_HTML());h&&0<h.length&&(b+=" with "+c.UTILITIES.describe_widgets(h)+" on top");return"the element "+b};a.get_type_name=function(a){return a?"elements":"element"};a.get_help_URL=function(){return"docs/manual/elements.html"};a.get_json=function(a,b,d){var h=this.get_style_attributes(),k=c.UTILITIES.remove_z_index(this.get_HTML()),m=encodeURIComponent(k),q=[],u;100<=k.length?(a.shared_html||(a.shared_html=[]),k=a.shared_html.indexOf(m),0>k&&(k=a.shared_html.push(m)-1),u={shared_html_index:k}):
u=m;m=function(){var e=[],k=function(l){var m=function(){k(l+1)},t,z;l>=h.length?b({type:"element",html:u,attributes:h,attribute_values:h.map(this.get_attribute.bind(this)),attributes_backsides:e,additional_classes:this.get_additional_classes(),children:0<this.get_children().length&&q,sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()},
d,a):(t=h[l],(t=this.get_attribute_widget_in_backside_table(t,!0))?(z=[],e.push(z),c.UTILITIES.get_json_of_array(t.get_backside_widgets(),z,0,a,m,d)):(e.push(null),m()))}.bind(this);k(0)}.bind(this);0<this.get_children().length?c.UTILITIES.get_json_of_array(this.get_children(),q,0,a,m,d):m()};c.creators_from_json.element=function(b,d){var h=decodeURIComponent("string"===typeof b.html?b.html:d.shared_html&&d.shared_html[b.html.shared_html_index]),m,l,t,q;b.children&&(l=d.is_child,d.is_child=!0,m=c.UTILITIES.create_array_from_json(b.children,
d),d.is_child=l);if(!h&&(h="string"===typeof b.html?"No json.html recreating an element widget.":"additional_info.shared_html missing while recreating an element widget.",!c.debugging))throw h;q=a.create(h,b.attributes,b.description,m,b.sound_effect,b.video,b.ignore_pointer_events);t=d&&d.event?["left","top"]:[];b.attribute_values.forEach(function(a,e){var h=b.attributes[e],l=b.attributes_backsides&&b.attributes_backsides[e];(d.is_child||0>t.indexOf(h))&&(0!==a||"width"!==h&&"height"!==h)&&q.add_to_css(h,
k(a)||a);l&&(h=q.get_attribute_widget_in_backside_table(h,!1,d),c.UTILITIES.add_backside_widgets_from_json(h,l,d))}.bind(this));b.additional_classes&&q.set_additional_classes(b.additional_classes);b.source_URL&&(q.set_source_URL(b.source_URL),q.refresh());m&&c.UTILITIES.when_attached(function(){m.forEach(function(a,e){var d=b.children[e]&&b.children[e].widget&&b.children[e].widget.view;d&&c.UTILITIES.set_css(a.get_frontside_element(!0),{left:d.frontside_left,top:d.frontside_top})})});return q};a.create_attribute_path=
function(a,b){var d=c.path.get_path_to(a.element_widget,b,!0);return this.extend_attribute_path(d,a.attribute)};a.refresh=function(){this.get_source_URL()&&c.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};a.extend_attribute_path=function(a,b){return{dereference_path:function(c){return(c=a.dereference_path(c,c.get_top_level_context()||c.get_context()))&&c.get_widget().get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+
b+"' property of "+c.path.toString(a)},get_json:function(d,h,k){c.path.get_json(a,d,function(a,c){h({type:"path_to_style_attribute",attribute:b,element_widget_path:a},c)},k)}}};c.creators_from_json.path_to_style_attribute=function(b,d){var h=c.UTILITIES.create_from_json(b.element_widget_path,d);return a.extend_attribute_path(h,b.attribute)};a.set_size_attributes=function(a,b,d){d?(this.add_to_css("width",a),this.add_to_css("height",b)):(this.set_attribute("width",a),this.set_attribute("height",b));
c.UTILITIES.set_timeout(function(){this.rerender()}.bind(this))};a.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};a.receive_HTML_from_dropped=function(a){var b=a.get_text&&a.get_text();a.remove();if(this.set_HTML(b))return this.get_text()};a.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};a.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===
a?(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):"top"===a&&(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};a.remove_style_attribute=
function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return a}(window.TOONTALK);window.TOONTALK.element_backside=function(b){var d=function(a,d,f){var g;f.visible()&&(g=d.get_style_attributes(),d.get_frontside_element(),$(a).empty(),g.forEach(function(g){d.get_attribute(g);var h=document.createElement("tr"),l=document.createElement("td"),t=f.is_primary_backside()?d.get_attribute_widget_in_backside_table(g):
f.get_widget().create_attribute_widget(g),q=t.get_frontside_element(!0);t.set_parent_of_frontside(f,!1,!0);t.set_infinite_stack(!0);a.appendChild(h);h.appendChild(l);l.appendChild(b.UTILITIES.create_text_element(g));l=document.createElement("td");h.appendChild(l);t.set_visible(!0);$(q).addClass("toontalk-element-attribute");l.appendChild(q)}))},a=function(a,d){var f=$("<button>Add or remove my style attributes</button>").button();f.addClass("toontalk-show-attributes-chooser-button");f.get(0).addEventListener("click",
function(g){b.UTILITIES.visible_element(a)?($(a).hide(),f.button("option","label","Add or remove my style attributes"),b.UTILITIES.give_tooltip(f.get(0),"Click to add widgets for my style attributes.")):($(a).show(),f.button("option","label","Hide my style attributes list"),b.UTILITIES.give_tooltip(f.get(0),"Click to hide my list of attributes that can be added or removed."));d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",d)});b.UTILITIES.give_tooltip(f.get(0),
"Click to add widgets for my style attributes.");return f.get(0)};return{create:function(k){var m=b.backside.create(k),f=m.get_element();k.get_HTML();var g=document.createElement("table"),r=document.createElement("div"),p=a(r,k),l=b.backside.create_advanced_settings_button(m,k),t=b.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),
q=b.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),u=q?"get_HTML":"get_text",e=m.update_display.bind(m),B=m.add_advanced_settings,y,G,L,z,M,E,I,S,F,A;k.initialize_element();y=k[u]().trim();0<y.length&&!k.get_image_element()&&(L=function(a){(a=b.UTILITIES.input_area_drop_handler(a,k.receive_HTML_from_dropped.bind(k),k))&&k.robot_in_training()&&k.robot_in_training().dropped_on_text_area(a,k,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},
G=b.UTILITIES.create_text_area(y,"toontalk-html-input","My HTML is","Type here to edit the text.",L,void 0,!0),y=function(a){a=G.button.value.trim().replace(/\xA0/g," ");k.get_frontside_element();var b=q?"set_HTML":"set_text";k[b](a)&&k.robot_in_training()&&k.robot_in_training().edited(k,{setter_name:b,argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(G.container).css({width:"100%"}),L=60>=G.button.value.length?2:600>G.button.value.length?Math.ceil(G.button.value.length/
60):10,$(G.button).css({width:"95%",height:L+"em"}),G.button.addEventListener("change",y),G.button.addEventListener("mouseout",y),k.is_plain_text_element()&&f.appendChild(G.container),k.get_source_URL()&&(L=function(a){var e=b.UTILITIES.input_area_drop_handler(a,k.receive_URL_from_dropped.bind(k),k);e&&k.robot_in_training()&&k.robot_in_training().dropped_on_text_area(e,k,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});a.stopPropagation()},
y=function(a){a=z.button.value.trim().replace(/\xA0/g," ");k.get_frontside_element();k.set_source_URL(a)&&k.robot_in_training()&&k.robot_in_training().edited(k,{setter_name:"set_source_URL",argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},z=b.UTILITIES.create_text_input(k.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,L),z.button.addEventListener("change",y),z.button.addEventListener("mouseout",y),
f.appendChild(z.container)));m.update_style_attribute_chooser=function(){var a=function(a,e,f){var k=0<=f.get_style_attributes().indexOf(a),l=b.UTILITIES.create_check_box(k,"toontalk-style-attribute-check-box",a+"&nbsp;","Click to add or remove the '"+a+"' style attribute from my backside."),m="toontalk-style-attribute-check-box-for-"+a,k=b.UTILITIES.create_anchor_element("i",h(a)),q=document.createElement("li"),u=function(b){l.button.checked?f.add_style_attribute(a):f.remove_style_attribute(a);d(g,
f,f.get_backside());f.robot_in_training()&&f.robot_in_training().edited(f,{setter_name:l.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:a,toString:(l.button.checked?"add":"remove")+" a widget for the "+a+" attribute of",button_selector:"."+m})};$(k).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(k).css({color:"white"});k.translate=!1;k.lang="en";l.container.appendChild(k);$(l.button).addClass(m);l.button.addEventListener("click",u);l.button.addEventListener("touchstart",
function(a){l.button.checked=!l.button.checked;u(a)});q.appendChild(l.container);e.appendChild(q)},e=function(b,c,d){var f,g;"string"===typeof b?a(b,c,d):b.label?(f=document.createElement("h3"),f.textContent=b.label,g=document.createElement("ul"),c.appendChild(f),c.appendChild(g),e(b.sub_menus,g,d)):b.forEach(function(a){e(a,c,d)})};$(r).is(".ui-accordion")&&$(r).accordion("destroy");$(r).empty();e([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},
{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],r,k);$(r).accordion({active:0,heightStyle:"content"});return r};m.get_attributes_chooser=function(){return r};m.add_advanced_settings=function(){var a;B.call(m);a=$(f).children(".toontalk-advanced-settings-table");
0<a.length&&(a.get(0).appendChild(t.container),a.get(0).appendChild(r),a.get(0).appendChild(p),k.is_plain_text_element()||a.get(0).appendChild(G.container))};(I=k.get_sound_effect())?(S=function(){m.visible()&&(I.paused?(b.UTILITIES.give_tooltip(M.get(0),"Click to begin playing this sound."),M.button("option","label","Play sound")):(b.UTILITIES.give_tooltip(M.get(0),"Click to pause this sound."),M.button("option","label","Pause sound")))},M=$("<button>Play sound</button>").button(),M.addClass("toontalk-play-sound-effect-button"),
y=function(a){I.paused?(b.UTILITIES.play_audio(I),I.addEventListener("ended",S)):I.pause();S();k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",k)},M.get(0).addEventListener("click",y),S(),f.appendChild(M.get(0))):k.get_video_object()&&(F=k.get_video_object(),A=function(a){m.visible()&&(F.paused?(b.UTILITIES.give_tooltip(E.get(0),"Click to begin playing this video."),E.button("option","label","Play video")):(b.UTILITIES.give_tooltip(E.get(0),"Click to pause this video."),
E.button("option","label","Pause video")))},E=$("<button>Play video</button>").button(),E.addClass("toontalk-play-video-button"),y=function(a){F.paused?(F.play(),F.addEventListener("ended",A)):F.pause();A();k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-play-video-button",k)},E.get(0).addEventListener("click",y),A(),f.appendChild(E.get(0)));m.update_style_attribute_chooser();d(g,k,m);f.appendChild(g);f.appendChild(l);$(r).hide();$(r).addClass("toontalk-attributes-chooser");
m.update_display=function(){G&&$(G.button).val(k[u]());d(g,k,m);b.UTILITIES.visible_element(r)&&m.update_style_attribute_chooser();k.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});e()};$(f).find(".toontalk-hide-backside-button").each(function(a,b){b.addEventListener("click",function(){$(r).hide()})});t.button.checked=!k.get_ignore_pointer_events();t.button.addEventListener("click",function(){k.set_ignore_pointer_events(!t.button.checked)});t.button.addEventListener("touchstart",
function(){t.button.checked=!t.button.checked;k.set_ignore_pointer_events(!t.button.checked)});return m}}}(window.TOONTALK);window.TOONTALK.element["function"]=function(b){var d=b.create_function_table();d.add_function_object("join text",function(a,h,m){var f="";return d.typed_bird_function(a,function(){for(i=0;i<arguments.length;i++)f+=arguments[i].get_text();return b.element.create(f)},[void 0],void 0,"join",h,m)},"The bird will return with a new element that is made by joining all the elements and numbers.",
"join",["any number of numbers or elements"]);d.add_function_object("part of text",function(a,h,m){return d.typed_bird_function(a,function(a,d,h){d=Math.round(d.to_float()-1);h=h&&Math.round(h.to_float()-1);return b.element.create(a.get_text().substring(d,h))},["element","number","number"],void 0,"part of text",h,m)},"The bird will return with a new element whose text is the part of the text of the first element (or number) beginning with the first number ending with the second number. 1 is for the first letter.",
"part",["an element followed by two postive numbers"]);d.add_function_object("length of text",function(a,h,m){return d.typed_bird_function(a,function(a){return b.number.create(a.get_text().length)},[void 0],1,"length of text",h,m)},"The bird will return with a number that is length of the text of the first element (or number).","length",["an element or number"]);d.add_function_object("text as number",function(a,h,m){return d.typed_bird_function(a,function(a){a=a.get_text();var d;d=a.indexOf("/");
0<=d?d=b.number.create(a.substring(0,d),a.substring(d+1,a.length)):(d=b.number.create(0),d.set_value_from_decimal(a));return d},[void 0],1,"text as number",h,m)},"The bird will return with a number that has the same text as the element. Arithmetic can be done on the result unlike the original text.","text as number",["an element"]);d.add_function_object("go to page",function(a,b,c){return d.typed_bird_function(a,function(a){this.robot_in_training()?c.display_message("Robot trained to replace current URL."):
window.location.assign(a.get_text())},["element"],1,"replace page",b,c)},"The bird will cause the current page to be replaced by the new URL. The back button should return to the current page.","page",["an element containing a URL"]);d.add_function_object("speak",b.widget.get_speak_function(d),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);d.add_function_object("listen",b.widget.get_listen_function(d),"The bird will cause the browser to listen to the next thing said and give the words to the bird in the first hole. If there is an error and there is a bird in the second hole it will be given the error message. If you put a number between 0 and 1 in the third hole then only recognitions with at least that confidence will be considered. if you put words or phrases separted by | then the recogniser will expect one of those words or phrases.",
"listen",[]);d.add_function_object("show message",function(a,h,m){return d.typed_bird_function(a,function(a){this.robot_in_training()?m.display_message("Robot trained to display: "+a.get_text()):b.UTILITIES.display_message(a.get_text())},["element"],1,"show message",h,m)},"The bird will cause what is in the second box hole to be displayed.","display",["a widget"]);return d.get_function_table()}(window.TOONTALK)})();window.TOONTALK.sensor=function(b){var h=Object.create(b.widget),c=function(b,a){"element"===b.get_type_name()&&(b.set_additional_classes("toontalk-string-value-from-sensor"),a.visible()&&b.rerender())};h.create=function(d,a,h,m,f,g,r){var p=b.nest.create(h,m,"sensor",void 0,void 0,r||"sensor"),l=p.get_json,t=p.update_display,q=p.set_running,u=p.copy,e=a.split(" "),B,y=function(a){switch(typeof a){case "number":a=b.number.create(Math.round(a),1);break;case "string":a=b.element.create(a,void 0,void 0,
void 0,void 0,void 0,"toontalk-string-value-from-sensor");c(a,p);break;case "boolean":a=b.element.create(a.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");c(a,p);break}return a},G=function(a){var c,e,f;if(p.get_active()){c=B(a);e=p.get_attributes();f=p.visible();a=$(p.get_frontside_element()).closest(".toontalk-backside-of-top-level");if(1===c.length){if(c=y(c[0]),"undefined"===typeof c)return}else c=b.box.create(c.length,!0,c.map(y),"the values of the "+b.UTILITIES.conjunction(e)+
" attributes of "+b.UTILITIES.add_a_or_an(d)+" event.",e.join(";"));f?(f=b.bird.create(p),p.add_to_top_level_backside(f),c.render(),f.animate_delivery_to(c,p,p,a.width()/2,a.height())):p.add_to_contents(c)}}.bind(this),L;p.is_sensor=function(){return!0};p.copy=function(a){var c;if(a&&a.just_value&&this.has_contents())return u.call(this,a);c=a?b.sensor.create(d,this.get_attributes_string(),h,void 0,a.copying_resource||f,g,this.get_name()):b.sensor.create(d,this.get_attributes_string(),h,void 0,f,g,
this.get_name());c=p.add_to_copy(c,a);c.set_active(this.get_active());return c};p.get_json=function(a,c,e){var h=function(e,h){var k;e.type="sensor";e.event_name=d;e.attribute=this.get_attributes_string();e.active=f;g?(k=function(a){e.sensor_of=a;c(e,h)},b.UTILITIES.get_json(g,a,k,h)):c(e,h)}.bind(this);l.call(this,a,h,e)};p.update_display=function(){var a=$(this.get_frontside_element());t.call(this);f||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):
(a.addClass("toontalk-sensor-inactive-nest"),a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};p.get_type_name=function(a){return a?"sensors":"sensor"};p.get_help_URL=function(){return"docs/manual/sensors.html"};p.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+d+" events"};p.get_class_name_with_color=function(a){return a};p.get_active=function(){return!0===f};p.restore_active=function(){"temporarily false"===f&&this.set_active(!0)};
p.set_active=function(a,b){if(f!==a||b)!0===a?g?g.get_frontside_element(!0).addEventListener(d,G):window.addEventListener(d,G):g?g.get_frontside_element(!0).removeEventListener(d,G):window.removeEventListener(d,G),f=a};p.set_running=function(a){this.set_active(a);q.call(this,a)};p.set_active(f,!0);p.create_backside=function(){return b.sensor_backside.create(this)};p.get_event_name=function(){return d};p.set_event_name=function(a){var b=f;d&&f&&this.set_active(!1);d=a;b&&this.set_active(!0)};p.get_attributes=
function(){return e};p.set_attributes=function(a){e=a.split(" ")};p.get_attributes_string=function(){return e.join(" ")};p.match=function(a){this.last_match=a;return this};p.set_sensor_of=function(a){g=a};p.get_custom_title_prefix=function(){var a="When a '"+d+"' event"+(g?" to "+g:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";f?this.get_backside()||(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the 'Listening to events' check box on my back is ticked.";
return a};p.get_default_description=function(){return g?"a sensor for "+g.get_default_description():"a sensor for this document."};L=p.can_run;p.can_run=function(a){return!a||L.call(this,a)};B=function(a){return p.get_attributes().map(function(c){var e=a[c];if("key"===c&&void 0===e){if(e=a.keyIdentifier,0===e.indexOf("U+"))return String.fromCharCode(a.keyCode)}else if("undefined"===typeof e){if(a.detail&&a.detail.element_widget&&("widget"===c||"back"===c))return c=b.UTILITIES.widget_side_of_element(a.detail.element_widget).create_backside(),
c.save_dimensions(),c;if(a.detail&&a.detail.element_widget&&"front"===c)return b.UTILITIES.widget_side_of_element(a.detail.element_widget);if(a.detail&&void 0!==a.detail[c])return"value changed"===a.type?b.number.create_from_bigrat(a.detail[c]):a.detail[c];e="No such attribute for "+p;p.display_message(e,{display_on_backside_if_possible:!0})}return e})};return p};b.creators_from_json.sensor=function(d,a){var h=b.sensor.create(d.event_name,d.attribute,d.description,[],!1,void 0,d.name),m;d.sensor_of?
b.UTILITIES.set_timeout(function(){h.set_sensor_of(b.UTILITIES.create_from_json(d.sensor_of,a));h.set_active(d.active)}):h.set_active(d.active);0<d.contents.length&&setTimeout(function(){m=b.UTILITIES.create_array_from_json(d.contents,a);h.set_contents(m);m.forEach(function(a){c(a.get_widget(),h)});h.rerender()},500);return h};return h}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(b){return{create:function(h){var c=b.UTILITIES.create_text_input(h.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+h.get_event_name()),d=b.UTILITIES.create_text_input(h.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
a=b.UTILITIES.create_check_box(h.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),k=b.nest_backside.create(h),m=k.get_element(),f=function(){h.set_event_name(c.button.value.trim())},g=function(){h.set_attributes(d.button.value.trim())},r=b.backside.create_advanced_settings_button(k,h),p=function(b){var c=a.button.checked;h.set_active(c);h.robot_in_training()&&h.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:c,toString:"change to "+(c?"active":"inactive")+" of the "+h,button_selector:".toontalk-sensor-active-check-box"});h.render();b.stopPropagation()},l=k.add_advanced_settings;m.appendChild(r);k.add_advanced_settings=function(){var b;c.button.addEventListener("change",f);d.button.addEventListener("change",g);a.button.addEventListener("click",p);l.call(k,c.container,d.container);b=$(m).children(".toontalk-advanced-settings-table");0<b.length&&b.get(0).appendChild(a.container)};return k}}}(window.TOONTALK);window.TOONTALK.tool=function(b){document.addEventListener("mousemove",function(c){b.tool.pageX=c.pageX;b.tool.pageY=c.pageY});var h;return{get_widget_side_under_tool:function(){return h},add_listeners:function(c,d){var a,k,m,f,g,r=function(e){var g=c.getBoundingClientRect();d.set_held&&d.set_held(!0);f=g.height;e&&e.preventDefault();setTimeout(function(){d.held&&!d.held()||$(c).addClass("toontalk-tool-held")},200);a=$(c).offset();document.addEventListener("mousemove",l);document.addEventListener("touchmove",
l);document.addEventListener("mouseup",t);document.addEventListener("touchend",t);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_down at "+Date.now());m=k=0;$(".ui-tooltip").each(function(){$(this).hide()})},p=function(a){var f=c.getBoundingClientRect();d.held&&d.held()||r(a);k=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",a)-f.left;m=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",a)-f.top},l=function(a){h=b.UTILITIES.find_widget_side_on_page(a,
c,k,m-f/2);var d,l,u;a.preventDefault();h&&h.is_of_type("empty hole")&&(h=h.get_parent_of_frontside());$(".ui-tooltip").each(function(){$(this).hide()});l=q(a);u=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",a)-l.deltaX-k;a=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",a)-l.deltaY-m;c.style.left=u+"px";c.style.top=a+"px";b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_move at "+Date.now()+" now at "+c.style.left+", "+c.style.top);if(h&&h.get_widget().is_top_level())g&&
(b.UTILITIES.remove_highlight(),g=void 0);else{if(h&&(d=h.get_element(),d===g))return;g=d;b.UTILITIES.highlight_element(g)}},t=function(a){var d=b.UTILITIES.find_widget_side_on_page(a,c,k,m-f/2);a.preventDefault();u(c.toontalk_tool,d)}.bind(this),q=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,deltaY:c}},u=function(e,d){var f;d&&d.is_of_type("empty hole")&&(d=d.get_parent_of_frontside());
e.set_held&&e.set_held(!1);g&&b.UTILITIES.remove_highlight();d&&d.top_level_widget&&(f=d.top_level_widget(),e.apply_tool(d,event),f.backup_all());!d&&e.nothing_under_tool&&e.nothing_under_tool();$(c).removeClass("toontalk-tool-held");$(c).addClass("toontalk-tool-returning");b.UTILITIES.add_one_shot_event_handler(c,"transitionend",1E3,function(){$(c).removeClass("toontalk-tool-returning")});a&&b.UTILITIES.set_timeout(function(){c.style.left=a.left+"px";c.style.top=a.top+"px"});document.removeEventListener("mousemove",
l);document.removeEventListener("touchmove",l);document.removeEventListener("mouseup",t);document.removeEventListener("touchend",t);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_up at "+Date.now(),alert(b.debugging),b.debugging="touch")};c.addEventListener("mousedown",p);c.addEventListener("touchstart",p);return r}}}(window.TOONTALK);window.TOONTALK.vacuum=function(b){var h=Object.create(null),c={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},d={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},a={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},k=!1,m;h.create=function(){var f,g,r,p=[],l=function(a){r!==a&&(r=a,b.sounds&&b.sounds.click.play(),$(f).removeClass(g),
g=d[r],$(f).addClass(g),t())},t=function(){"restore"===r&&0===p.length?b.UTILITIES.give_tooltip(f,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):b.UTILITIES.give_tooltip(f,c[r])};document.addEventListener("keyup",function(a){var c=String.fromCharCode(a.keyCode);if(a.altKey){if(0>"SsEeRrAa".split("").indexOf(c))return;f||(h.the_vacuum.get_element(),$(f).css({left:b.tool.pageX,top:b.tool.pageY}),document.body.appendChild(f));m()}h.the_vacuum.held()&&
("s"===c||"S"===c?l("suck"):"e"===c||"E"===c?l("erase"):"r"===c||"R"===c?l("restore"):"a"===c||"A"===c?l("suck_all"):b.sounds&&b.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){h.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});b.vacuum.the_vacuum={apply_tool:function(a,c){var e=a.get_widget(),d=function(a){c&&e.robot_in_training()&&e.robot_in_training().removed(a);a.is_primary_backside&&a.is_primary_backside()?a.hide_backside():
a===e.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):(e.is_bird()&&b.sounds&&b.sounds.bird_fly.pause(),a.is_backside()||(a.save_dimensions_of(a),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),p.push(a),a.set_running&&a.set_running(!1),a.is_backside()||a.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove(c,!0))},g,h,k;"suck"===r?a.remove&&!a.get_widget().is_top_level()&&
(d(a),b.sounds&&b.sounds.vacuum_suck.play()):"erase"===r||"restore"===r&&a.get_erased&&a.get_erased()?a.is_top_level()||(g=!a.get_erased(),b.sounds&&(g?b.sounds.vacuum_suck.play():b.sounds.vacuum_spit.play()),a.set_erased(g,!0),c&&e.robot_in_training()&&e.robot_in_training().erased_widget(a,g)):"restore"===r?0<p.length&&(g=p.pop(),g.restore_dimensions(),k=a.add_to_top_level_backside(g),c&&e.robot_in_training()&&e.robot_in_training().restored(g),k.toontalk_widget_side=g,h=$(f).offset(),h.left-=$(k).width(),
b.UTILITIES.set_absolute_position(k,h),g.this_and_walk_children&&(g.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),b.sounds&&b.sounds.vacuum_spit.play())):"suck_all"===r&&(g=a.top_level_widget(),h=g.get_backside_widgets().slice(),0<h.length&&b.sounds&&(b.sounds.vacuum_suck.play(),b.sounds.bird_fly.pause()),b.UTILITIES.for_each_batch(h,function(a){a&&e!==e.robot_in_training()&&d(a)}),g.set_backside_widgets([]))},nothing_under_tool:function(){l(a[r])},get_element:function(){f||
(f=document.createElement("div"),$(f).addClass("toontalk-vacuum"),m=b.tool.add_listeners(f,this),l("suck"),t(),f.toontalk_tool=b.vacuum.the_vacuum);return f},held:function(){return k},set_held:function(a){var c=function(){b.UTILITIES.listen_for_speech({commands:"suck | erase | restore | remove all",success_callback:function(a,d){var f,g;if("remove all"===a)l("suck_all");else if("suck"===a||"erase"===a||"restore"===a)l(a);else return console.log("ignoring "+a),!1;f=$(".toontalk-highlight");if(0<f.length)(f=
b.UTILITIES.widget_side_of_jquery(f))&&f.top_level_widget&&(g=f.top_level_widget(),this.apply_tool(f,d),g.backup_all(),c());else if("restore"===a||"remove all"===a)g=b.tool.get_widget_side_under_tool(),this.apply_tool(g,d);return!0}.bind(this)})}.bind(this);(k=a)?c():b.UTILITIES.stop_listening_for_speech()}};return b.vacuum.the_vacuum};b.creators_from_json.vacuum=function(a,c){var d=b.vacuum.create();a.mode&&b.UTILITIES.set_timeout(function(){d.set_mode(a.mode)});return d};return h}(window.TOONTALK);window.TOONTALK.wand=function(b){var h=Object.create(null);h.create=function(){var c=!1,d,a={apply_tool:function(a){var c;a.is_top_level()||(b.sounds&&b.sounds.magic.play(),c=a.add_copy_to_container(),c.update_display(),a.robot_in_training()&&a.robot_in_training().copied(a,c,!1))},get_element:function(){d||(d=document.createElement("div"),$(d).addClass("toontalk-wand"),b.UTILITIES.give_tooltip(d,"I'm a magic wand. Drag me over the thing you want me to copy."),b.tool.add_listeners(d,this),d.toontalk_tool=
a);return d},held:function(){return c},set_held:function(a){var d=function(){b.UTILITIES.listen_for_speech({commands:"copy | abracadabra",success_callback:function(a,c){var h,k;h=$(".toontalk-highlight");0<h.length&&(h=b.UTILITIES.widget_side_of_jquery(h))&&h.top_level_widget&&(k=h.top_level_widget(),this.apply_tool(h,c),k.backup_all(),d());return!0}.bind(this)})}.bind(this);(c=a)?d():b.UTILITIES.stop_listening_for_speech()}};return a};b.creators_from_json.wand=function(){return b.wand.create()};
return h}(window.TOONTALK);window.TOONTALK.SETTINGS=function(b){var h=[],c=function(c,m,f){var g=[];b.UTILITIES.create_local_files_table(function(r){var p=function(a,g){var h=function(a){a||g.newPanel.appendChild(b.UTILITIES.create_text_element("Error connecting to cloud"))},e=g.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();g.newPanel.is(".toontalk-programs-in-cloud-table")?e?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):d(g.newPanel,"program",c,f,h):g.newPanel.is(".toontalk-pages-in-cloud-table")?
e?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):d(g.newPanel,"page",c,f,h):($("#tab-0_info").show(),$("#tab-0_wrapper").show())},l;g[0]="Programs stored in browser";h[0]=r;m?(g[1]="Programs in cloud",h[1]=b.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),g[2]="Published pages",h[2]=b.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table"),l=b.UTILITIES.create_tabs(g,h),f.appendChild(l),$(l).on("tabsactivate",p)):f.appendChild(b.UTILITIES.create_tabs(g,h));a(c,
r,!0,f);$(r).on("draw.dt",function(){a(c,r,!1,f)})})},d=function(c,d,f,g,h){b.google_drive.get_toontalk_files(!1,d,function(p){var l;"string"===typeof p?l=p:p.error&&(l=p.error.message);l?"Need to authorize"===l||"Login Required"===l?b.google_drive.authorize(h):(console.log(l),console.log("Google drive status: "+b.google_drive.get_status()),h(null)):(l="program"===d&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",b.UTILITIES.become_file_data_table(c,p.items,!0,l),c.on("draw.dt",
function(){a(f,c.get(0),!0,g)}),h(c.get(0)))})},a=function(a,b,c,d){var h=function(b){var h=function(){$(d).remove()},m=function(){a.set_setting("program_name",b.target.textContent);a.load(c,h)}.bind(this);a.save(!0,void 0,m)};b=$(b).find(".toontalk-file-load-button-without-click-handler");b.each(function(a,b){b.addEventListener("click",h)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(a){var d=document.createElement("div"),f=a.get_backside_element(),g=a.get_setting("program_name"),
h=b.UTILITIES.create_text_input(g,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),p=b.UTILITIES.create_close_button(function(){$(d).remove()},"Click to close the settings panel."),l=b.UTILITIES.create_text_element("How should your program be saved?"),t=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_google_drive"),"toontalk-save-setting","Save automatically to my Google Drive",'Check this if you want your programs automatically saved to a "ToonTalk Programs" folder in your Google Drive.'),
q=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage","Check this if you want your programs automatically saved in this browser's local storage."),u=b.UTILITIES.create_button("Save to Google Drive now","toontalk-save-button","Click to save your program now to your Google Drive account.",function(){a.save(!0,{google_drive:!0})}),e=b.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button",
"Click to save your program now to this browser's local storage.",function(){a.save(!0,{local_storage:!0})}),B=b.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){b.google_drive.authorize(function(){$(B).remove()})}),y=b.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){a.display_message("Creating your web page...");
a.publish(L,G.button.checked)}),G=b.UTILITIES.create_check_box(a.get_setting("publish_as_workspace"),"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),L=function(c,e){var d=document.createElement("span"),f=b.google_drive.google_drive_url(c.id);b.TRANSLATION_ENABLED&&(f=b.UTILITIES.add_URL_parameter(f,"translate","1"));d.innerHTML="Published: <a href='"+f+"' target='_blank'>"+a.get_setting("program_name")+
"</a>";f=$(h.container).children("tr");a.display_message("Your web page is ready for you to edit. Just click on the link.");0<f.length&&f.get(0).appendChild(b.UTILITIES.create_table_entry(d))},z=document.createElement("div"),M=b.google_drive&&"undefined"!==typeof gapi?b.google_drive.get_status():"Google Drive API not loaded",E=!0,I=b.UTILITIES.create_vertical_table(y,G.container),S=$(h.container).children("tr");$(d).addClass("toontalk-settings-panel").css({width:$(f).width()+29,height:$(f).height()+
50,left:-2,top:-25,"z-index":9999999});d.appendChild(p);h.button.addEventListener("change",function(){var c=h.button.value.trim();g!==c&&a.save(!0,void 0,function(){g=c;a.set_setting("program_name",c);a.load(!0,function(){setTimeout(function(){$(d).css({"z-index":b.UTILITIES.next_z_index()})},500)},function(){a.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();a.display_message("Your program was copied and the new copy's name is '"+a.get_setting("program_name")+"'.")})})})});t.button.addEventListener("click",
function(b){a.save(!0,{auto_save_to_google_drive:q.button.checked,gooogle_drive:!0});a.set_setting("auto_save_to_google_drive",t.button.checked);t.button.checked?$(u).hide():$(u).show()});q.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_local_storage:q.button.checked,local_storage:!0});a.set_setting("auto_save_to_local_storage",q.button.checked);q.button.checked?$(e).hide():$(e).show()});G.button.addEventListener("click",function(b){a.set_setting("publish_as_workspace",G.button.checked)});
d.appendChild(z);$(l).css({"font-weight":"bold","font-size":24,color:"navy"});z.appendChild(l);z.appendChild(h.container);z.appendChild(t.container);z.appendChild(q.container);t.container.appendChild(b.UTILITIES.create_space());t.container.appendChild(u);a.get_setting("auto_save_to_google_drive")&&$(u).hide();q.container.appendChild(b.UTILITIES.create_space());q.container.appendChild(e);a.get_setting("auto_save_to_local_storage")&&$(e).hide();"Need to authorize"===M?(t.container.appendChild(b.UTILITIES.create_space()),
t.container.appendChild(B)):"Authorized"!==M&&"Ready"!==M&&"Authorized but not yet ready"!==M&&(E=!1,a.set_setting("google_drive_unavailable",!0),setTimeout(function(){t.button.disabled=!0;$(y).button("option","disabled",!0);$(u).button("option","disabled",!0);b.UTILITIES.give_tooltip(t.container,"Inactivated because attempt to connect to Google Drive returned: "+M);y.title=t.container.title;u.title=t.container.title},1));0<S.length&&S.get(0).appendChild(b.UTILITIES.create_table_entry(I));c(a,E,d);
f.appendChild(d)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",auto_save_to_google_drive:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(b){var h=[],c=0,d=!1,a=!1;return{pending_update:function(a){0<=h.indexOf(a)||(h.push(a),this.update_display())},update_display:function(){var k;a||document.hidden||0===h.length||(k=Date.now(),k<c?(a=!0,setTimeout(this.update_display_workhorse.bind(this),c-k)):d||(a=!0,b.UTILITIES.set_timeout(function(){this.update_display_workhorse(k)}.bind(this))))},update_display_workhorse:function(k){var m=h,f=function(a,b){$(a).children().each(function(a,c){$(c).is(".toontalk-side")&&
($(c).css({"z-index":b+1}),f(c,b+1))})};h=[];d=!0;a=!1;c=(k|Date.now())+50;b.UTILITIES.for_each_batch(m,function(a){var c=a.get_element&&a.get_element(),d,h,k;if(a.visible()||$(c).is(".toontalk-top-level-resource"))$(c).show(),a.update_display(),a.get_backside&&(h=a.get_backside())&&h.visible()&&h.update_display(),setTimeout(function(){b.UTILITIES.use_custom_tooltip(c)}),d=$(c).parent().closest(".toontalk-side"),d.is("*")&&0===d.find(".toontalk-side-animating, .toontalk-side-appearing").length&&(h=
b.UTILITIES.get_style_numeric_property(c,"z-index"),k=b.UTILITIES.get_style_numeric_property(d.get(0),"z-index"),k||(k=b.UTILITIES.next_z_index(),d.css({"z-index":k})),!h||d.is(".toontalk-backside-of-top-level")?(h=b.UTILITIES.next_z_index(),$(c).css({"z-index":h})):h>=k&&(h=k+1,$(c).css({"z-index":h})),f(c,h)),c&&!$(c).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&
b.UTILITIES.set_timeout(function(){d.is(".toontalk-box-hole")?$(c).is(".ui-resizable")&&$(c).resizable("destroy"):$(c).is(".ui-resizable")||b.UTILITIES.make_resizable($(c),a)})});d=!1;0<h.length&&(a=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(b){b.creators_from_json.body=function(h,c){var d=b.actions.create();c.body=d;d.initialise_steps(b.UTILITIES.create_array_from_json(h.steps,c));return d};return{create:function(h){var c=Object.create(this),d=[];h||(h=[]);c.copy=function(){return b.actions.create(b.UTILITIES.copy_array(h))};c.get_steps=function(){return h};c.initialise_steps=function(a){h=a};c.is_empty=function(){return 0===h.length};c.reset_steps=function(){h=[];this.reset_newly_created_widgets()};
c.reset_newly_created_widgets=function(){b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+d.length);d=[]};c.add_step=function(a,c){a?(h.push(a),c&&this.add_newly_created_widget_if_new(c)):b.UTILITIES.report_internal_error("Attempt to add an undefined step.")};c.add_newly_created_widget_if_new=function(a){0<=d.indexOf(a)||this.add_newly_created_widget(a)};c.add_newly_created_widget=function(a){b.debugging&&0<=d.indexOf(a)?console.log("add_newly_created_widget called with not new widget."):
(d.push(a),b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Added "+a.to_debug_string(50)+" to list of newly_created_widgets. Length is "+d.length))};c.is_newly_created=function(a){return 0<=d.indexOf(a)};c.get_newly_created_widgets=function(){return d};c.get_path_to=function(a,c,h){var f,g;d.some(function(d,p){if(d===a||h&&d===a)return f=b.newly_created_widgets_path.create(p),!0;if(d.get_path_to&&(g=d.get_path_to(a,c)))return f=b.newly_created_widgets_path.create(p),f.next=g,!0});return f};
c.dereference_path=function(a){b.debugging&&!d[a]&&b.UTILITIES.report_internal_error("Expected to find the "+b.UTILITIES.ordinal(a)+" newly created widget.");return d[a]};return c},run_unwatched:function(h,c){var d=this.get_steps();b.logging&&0<=b.logging.indexOf("run")&&console.log(h.to_debug_string(50)+" running unwatched");c||(c=0);h.run_next_step=function(a){if(c<d.length){var k=d[c];c++;b.logging&&0<=b.logging.indexOf("event")&&console.log(k+" (unwatched) at "+Date.now()+" by robot "+h.get_name());
a?(h.run_watched_step_end_listeners(),k.run_watched(h)):k.run_unwatched(h)}else h.set_running_or_in_run_queue(!1),h.run_body_finished_listeners(),h.get_run_once()?h.get_first_in_team().set_running(!1):h.get_first_in_team().run()};h.run_next_step()},run_watched:function(h){var c=this.get_steps(),d=h.get_frontside_element(),a,k,m=d.parentElement,f=h.get_first_in_team(),g=function(){var a=f.visible()&&0!==f.get_maximum_step_duration(),c=function(){a&&(m&&m.appendChild(d),h.set_animating(!1));f===h?b.UTILITIES.set_absolute_position(d,
p):(b.UTILITIES.set_css(d,{position:"static"}),k.get_backside(!0).get_next_robot_area().appendChild(d));h.get_run_once()?f.set_running(!1):h.stopped()?$(d).removeClass(".toontalk-side-animating"):f.run();h.rerender()};a?(d.parentElement||h.get_parent_of_frontside().get_frontside_element().appendChild(d),b.UTILITIES.animate_to_absolute_position(d,p,c,h&&h.transform_animation_speed(b.UTILITIES.default_animation_speed))):(h.set_animating(!1),c(),h===f&&h.get_context().add_backside_widget(h),$(h.get_frontside_element()).remove())},
r=0,p=$(d).offset(),l=$(d).offset(),t=$(d).width(),q=$(d).height(),u=h.get_first_in_team().top_level_widget(),e=$(d).closest(".toontalk-backside-of-top-level").offset(),B=h.get_context().get_backside(),y,G;b.logging&&0<=b.logging.indexOf("run")&&console.log(h.to_debug_string(50)+" running watched");y=(k=h.get_previous_robot())?$(k.get_backside(!0).get_next_robot_area()):$(B.get_backside_element(!0));!b.UTILITIES.is_attached(d)&&k&&(k.open_backside(),k.get_backside().set_advanced_settings_showing(!0),
(a=d.parentElement)||(a=y.get(0)),h.set_visible(!0),h.update_display(),h.add_body_finished_listener(function(){a&&a.appendChild(d);$(d).css({left:"",top:"",position:"","z-index":""})}));0===t&&($(d).css({width:"",height:""}),t=h.saved_width||$(d).width(),q=h.saved_height||$(d).height());e||(e={left:0,top:0});0<y.length&&(G=y.get(0).getBoundingClientRect(),p.left<G.left-e.left||p.top<G.top-e.top||p.left+t>G.right+e.left||p.top+q>G.bottom+e.top)&&(p=y.offset(),p.left+=y.width()/2,p.top+=y.height()-
q,l=p);h.start_offset=l;u.get_backside_element().appendChild(d);b.UTILITIES.set_absolute_position(d,p);h.run_next_step=function(){B&&!document.hidden&&(B.visible()||b.UTILITIES.visible_element(B.get_element()))?setTimeout(function(){h.run_watched_step_end_listeners();if(r<c.length&&!h.stopped()){var a=c[r];r++;b.logging&&0<=b.logging.indexOf("event")&&console.log(a+" (watched)");a.run_watched(h)}else h.set_running_or_in_run_queue(!1),g(),h.run_body_finished_listeners()},h.transform_step_duration(50)):
(h.set_running_or_in_run_queue(!1),h.set_animating(!1),$(d).css({width:"",height:""}),d.style.transitionDuration="",m&&m.appendChild(d),this.run_unwatched(h,r))}.bind(this);h.set_animating(!0,p);h.run_next_step();return!0},toString:function(b){for(var c="",d=this.get_steps().map(function(a){return a&&a.toString(b)});""===d[d.length-1];)d.pop();d.forEach(function(a,b){a&&(c+=a,c=b===d.length-2?c+" and \n":b<d.length-2?c+", \n":c+".")});return c},get_json:function(h,c,d){var a=[];b.UTILITIES.get_json_of_array(this.get_steps(),
a,0,h,function(){c({type:"body",steps:a},d)},d)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(b){b.creators_from_json.newly_created_widgets_path=function(h){return b.newly_created_widgets_path.create(h.index)};return{create:function(h){return{dereference_path:function(c){var d=c.get_body().dereference_path(h),a;if(this.next)return b.path.dereference_path(this.next,c,d);this.removing_widget&&((a=d.get_parent_of_frontside())&&a.is_hole()&&(a=a.get_parent_of_frontside()),a&&a.removed_from_container&&c.remove_from_container(d,a));return d},toString:function(){return"the "+
b.UTILITIES.ordinal(h)+" new widget"},get_json:function(b,d,a){d({type:"newly_created_widgets_path",index:h},a)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(b){var h=function(a,b,c){if(!c||!c.running_watched||!a.get_backside())return!0;a.get_backside().hide_backside()},c={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b,c){c&&c.running_watched||a.set_parent(void 0);b.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b){var c=a.copy();b.add_newly_created_widget(c);b.set_thing_in_hand(c);return!0},"drop it on":function(a,c,e){var d;if(a)if(d=c.get_thing_in_hand()){if(d.drop_on)return b.debugging&&
d===a&&b.UTILITIES.report_internal_error("Dropping something on itself! "+a),a.visible()||$(d.get_frontside_element()).remove(),d.drop_on(a,void 0,c),c.set_thing_in_hand(void 0),a.rerender(),c.add_newly_created_widget_if_new(d),d.robot_waiting_before_next_step===c?(e&&e.running_watched||(d.robot_waiting_before_next_step=void 0),!1):!0;b.debugging&&b.UTILITIES.report_internal_error("Thing in robot's hand ("+d+") doesn't handle 'drop_on'. Robot that "+c)}else!c.being_trained&&b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+
c.toString()+"' is executing drop_on but has nothing in its hand.");else b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(a,c,e){var d;if(a){if(d=c.get_thing_in_hand())return c.set_thing_in_hand(void 0),a[e.setter](d),!0;b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else b.UTILITIES.report_internal_error("The robot that '"+
c.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},remove:function(a,b){a.remove();a===b?b.set_stopped(!0):b.add_newly_created_widget_if_new(a);return!0},restore:function(a,b){b.add_to_top_level_backside(a);return!0},"change whether erased":function(a,b,c){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;a.display_message("Robot is unable to erase "+a)},edit:function(a,c,e){if(a[e.setter_name])return e.argument_2?a[e.setter_name].call(a,e.argument_1,
e.argument_2,a.visible()):a[e.setter_name].call(a,e.argument_1,a.visible()),!0;b.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c){return!0},"add to the top-level backside":function(a,c,e){var d;if(!e||!e.running_watched){d=c.top_level_widget();d.add_backside_widget(a);e=c.get_context();if(!e.visible())return;d=d.get_backside_element();e=a.get_frontside_element(!0);$(e).css(b.UTILITIES.random_location_inside(d,50));d.appendChild(e);a.animate_to_element(d,void 0,
c.transform_animation_speed(b.UTILITIES.default_animation_speed))}return!0},"add a new widget to the work space":function(a,c,d){c.get_context().is_top_level()?(d=c.add_to_top_level_backside(a),c=$(c.get_frontside_element()).offset(),a.update_display(),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c,!0)):a.drop_on(c.get_context().get_backside(!0),void 0,c,!0);return!0},"start training":function(a,b,c){c&&c.running_watched||(a.initialize_backside_conditions(),a.get_body().reset_steps(),
b.robot_started_training(a));a.training_started(b);return!0},"stop training":function(a,b,c){a.training_finished();return!0},train:function(a,b,c){a.add_step(c.step);return!0},"open the backside":function(){return!0},"open the backside of":function(){return!0},"close the backside of":h,"close the backside":h,"click the button of":function(a,b,c){".toontalk-green-flag"!==c.button_selector||c&&c.running_watched||a.set_running(!0);return!0}},d=function(a,c,d,f){var h=c.get_thing_in_hand(),g=c.get_frontside_element(),
k=a.get_element(),l=function(a,b,c){return c.some(function(c){if(Math.abs(c-a)<=b)return!0})},m,p,r,t,F,A,J;k||(k=b.UTILITIES.find_resource_equal_to_widget(a,c));b.UTILITIES.is_attached(k)&&c.visible()?(m=k.getBoundingClientRect(),f&&f.left_offset_fraction?(c.original_animation_left_offset||(c.original_animation_left_offset=[]),c.original_animation_top_offset||(c.original_animation_top_offset=[]),t=f.left_offset_fraction*m.width,F=f.top_offset_fraction*m.height,h&&(A=h.get_element(),b.UTILITIES.visible_element(A)&&
(J=$(A).offset(),g=$(g).offset(),t-=J.left-g.left,F-=J.top-g.top)),h&&l(t,c.last_thing_in_hand_width,c.original_animation_left_offset)&&0<=c.original_animation_top_offset.indexOf(F)?(t=c.animation_left_offset+c.last_thing_in_hand_width,F=c.animation_top_offset,t>=m.width&&(t=0,F+=c.max_thing_in_hand_height,F>=m.height&&(F=0)),b.UTILITIES.when_attached(A,function(){c.last_thing_in_hand_width=b.UTILITIES.get_element_width(A);"undefined"===typeof c.max_thing_in_hand_height&&(c.max_thing_in_hand_height=
0);c.max_thing_in_hand_height=Math.max(c.max_thing_in_hand_height,$(A).height())})):(c.original_animation_left_offset.push(t),0>c.original_animation_top_offset.indexOf(F)&&c.original_animation_top_offset.push(F),c.last_thing_in_hand_width=b.UTILITIES.get_element_width(A),c.max_thing_in_hand_height=b.UTILITIES.get_element_height(A)),k.animation_left_offset=t,k.animation_top_offset=F,c.animation_left_offset=t,c.animation_top_offset=F):(p=m.width/2,r=m.height/2),c.animate_to_widget(a,d,c.transform_animation_speed(.25),
p,r,!0,c.transform_original_step_duration(f&&f.time),c)):d()},a=function(a,b,c,f){d(a,b,function(){a.open_backside(c);p(a,b)},f)},k=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},m=function(a,c,d,f,h,g){var l=k(a,f);c.get_frontside_element();var m=function(){d(l);$(l).addClass("ui-state-active");if(".toontalk-select-function"===f||".toontalk-box-size-input"===f)l.value=h.argument_1;setTimeout(function(){$(l).removeClass("ui-state-active");c.run_next_step(!0)},g)},r=function(){var d;
b.UTILITIES.visible_element(l)||(d=a.get_backside(!0),d.set_advanced_settings_showing(!0,d.get_element()));c.animate_to_element(l,m,c.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)};l&&b.UTILITIES.visible_element(l)||!a.open_backside||!c.animate_consequences_of_actions()?r():a.open_backside(r,c.transform_step_duration(500))&&p(a,c)},f=function(a,c,d,f,h){var k=b.UTILITIES.closest_element($("."+h),$(c.get_frontside_element()).offset()),l=function(){g(a,c,d,f)};k&&c.animate_consequences_of_actions()&&
0<$("."+h).length?c.animate_to_element(k,l,c.transform_animation_speed(b.UTILITIES.default_animation_speed),0,0,!0):l()},g=function(a,c,d,f){c.get_frontside_element();var h=function(){c.carrying_tool=void 0;c.update_display();d();c.run_next_step(!0)},g;c.animate_consequences_of_actions()?(c.carrying_tool=f,c.update_display(),f=c.transform_animation_speed(b.UTILITIES.default_animation_speed/2),a?c.animate_to_element(a.get_element(),h,f,0,0,!0):(g=c.top_level_widget().get_element(),a=$(g).offset(),
a.left+=$(g).width()*(.1+.8*Math.random()),a.top+=$(g).height()*(.1+.8*Math.random()),c.animate_to_absolute_position(a,h,f,!0))):(d(),c.run_next_step(!0))},h=function(a,b,c){var d=a.get_parent_of_frontside();f(a,b,function(){c();d&&"top-level"!==d.get_widget().get_type_name()&&d.update_display&&d.update_display();a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")},r=function(a,b,c){a.open_backside(function(){c();b.run_next_step(!0)});p(a,b)},p=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&
a.get_backside().hide_backside()})},l=function(a,b,c,d){d=b.transform_original_step_duration(d&&d.time);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();c();b.run_next_step(!0)},d)},t={copy:function(a,b,c){f(a,b,function(){c();a.add_copy_to_container(b.get_recently_created_widget())},"toontalk-wand-small","toontalk-wand")},"pick up":function(a,c,e,f){var h=function(){e();c.animate_consequences_of_actions()&&c.update_display();c.run_next_step(!0)};b.debugging&&
"empty hole"===a.get_type_name()?b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):a.save_dimensions()&&c.animate_consequences_of_actions()?d(a,c,h,f):h()},"pick up a copy of":function(a,c,e,f){d(a,c,function(){var d;e();c.animate_consequences_of_actions()&&(d=c.get_recently_created_widget())&&(d.set_visible(!0),b.UTILITIES.copy_frontside_dimensions(a,d),c.update_display());c.run_next_step(!0)},f)},"drop it on":function(c,f,e,h){var g=f.get_thing_in_hand(),k,l;g?(b.debugging&&
g===c&&b.UTILITIES.report_internal_error("Dropping something on itself!"),k=g.get_element(!0),g.set_visible(f.visible()),l=function(){var a;$(k).removeClass("toontalk-held-by-robot");g.drop_on&&(f.animate_consequences_of_actions()&&!b.UTILITIES.visible_element(k)&&(a=$(f.get_frontside_element()).closest(".toontalk-backside-of-top-level"),0<a.length&&a.get(0).appendChild(k)),f.rerender());e();g.drop_on&&g.visible()&&(b.UTILITIES.set_absolute_position(k,$(k).offset()),g.restore_dimensions());g.robot_waiting_before_next_step!==
f&&f.run_next_step(!0)},c.is_backside()&&!b.UTILITIES.visible_element(c.get_element())?a(c.get_widget(),f,l,h):d(c,f,l,h)):(b.debugging&&(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+f)),d(c,f,e,h))},"drop it on the text area of":function(c,f,e,h){var g=f.get_thing_in_hand(),k,l,m,p;g?(k=g.get_element(!0),g.set_visible(f.visible()),l=function(){var a;$(k).removeClass("toontalk-held-by-robot");e();g.remove();a=c.get_parent_of_frontside().get_widget();
a.is_hole()&&(a=a.get_parent_of_frontside());a.is_top_level()?c.render():a.render();f.set_thing_in_hand(void 0);f.run_next_step(!0)},m=function(){return $(c.get_backside_element()).find(h.area_selector).get(0)},f.rerender(),b.UTILITIES.visible_element(c.get_backside_element())?(p=m(),f.animate_to_element(p,l,f.transform_animation_speed(b.UTILITIES.default_animation_speed/2),0,0,!0)):a(c,f,function(){p=m();f.animate_to_element(p,l,f.transform_animation_speed(b.UTILITIES.default_animation_speed/2),
0,0,!0)},h)):(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+f),d(c,f,e,h))},remove:h,"change whether erased":h,restore:function(a,c,d){f(void 0,c,function(){b.UTILITIES.set_css(a.get_element(!0),$(c.get_frontside_element()).position());d()},"toontalk-vacuum-ready-small","toontalk-vacuum")},edit:function(a,b,c,d){m(a,b,function(){a.get_backside()&&a.get_backside().update_display();c()},d.button_selector,d,b.transform_step_duration(200))},
"change size of":function(a,c,d,f){var h=a.get_frontside_element();h?c.animate_to_element(h,function(){var b=h.getBoundingClientRect(),g=b.width*f.x_factor,b=b.height*f.y_factor,k=c.transform_step_duration(1E3);$(h).addClass("toontalk-animating-element");h.style.transitionDuration=k+"ms";h.style.width=g+"px";h.style.height=b+"px";setTimeout(function(){$(h).removeClass("toontalk-animating-element");h.style.transitionDuration="";d();a.render();c.run_next_step(!0)},k)},c.transform_animation_speed(b.UTILITIES.default_animation_speed),
0,0,!0):(d(),c.run_next_step(!0))},"add to the top-level backside":function(a,b,c){c();b.run_next_step(!0)},"add a new widget to the work space":function(a,c,d,f){f&&f.button_selector?(a=b.path.dereference_path(f.path_to_source,c),m(a,c,d,f.button_selector,f,c.transform_step_duration(3E3))):(d(),c.run_next_step(!0))},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");
a.toontalk_followed_by={element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step(!0)},"stop training":function(a,c,d,f){var h=a.get_frontside_element();m(a,c,function(){var f=function(){h.toontalk_return_to=void 0;a.get_backside().change_label_and_title_of_train_button(!1);$(h).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");h.toontalk_followed_by=void 0;setTimeout(d,c.transform_step_duration(1500))};h.toontalk_return_to?
b.UTILITIES.animate_to_absolute_position(h,h.toontalk_return_to,f,c.transform_animation_speed(b.UTILITIES.default_animation_speed)):f()},".toontalk-train-backside-button",f,c.transform_step_duration(1E3))},train:function(a,b,c,d){var f=function(){c();b.run_next_step(!0)};(d=d.step.run_watched)?(a.run_next_step=f,a.set_context(a.get_parent_of_frontside().get_widget()),d(a)):f()},"open the backside":r,"open the backside of":r,"close the backside of":l,"close the backside":l,"click the button of":function(a,
b,c,d){m(a,b,function(d){$(d).is(".toontalk-settings-backside-button")&&">"===d.innerText&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().set_advanced_settings_showing(!1,a.get_backside_element())});$(d).click();c()},d.button_selector)}};b.creators_from_json.robot_action=function(a,c){return a.additional_info?b.robot_action.create(b.UTILITIES.create_from_json(a.path,c),a.action_name,b.UTILITIES.create_keys_from_json(a.additional_info,c)):b.robot_action.create(b.UTILITIES.create_from_json(a.path,
c),a.action_name)};return{create:function(a,d,e){var f=Object.create(this),h=c[d],g=t[d];if(g)return a||b.UTILITIES.report_internal_error("path undefined in "+d+" action"),h||b.UTILITIES.report_internal_error("no run_function for "+d),f.get_action_name=function(){return d},f.get_additional_info=function(){return e},f.run_unwatched=function(c){var d=b.path.dereference_path(a,c);if(!d)return b.UTILITIES.report_internal_error("Unable to dereference path: "+b.path.toString(a)+" in context: "+c.get_context()),
!1;b.logging&&0<=b.logging.indexOf("event")&&(d.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+d.wait_until_this_nest_receives_something.to_debug_string(50)+"("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)):console.log("   "+d.to_debug_string(50)+" ("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)));d.wait_until_this_nest_receives_something?d.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.visible()?
this.run_watched(c):this.run_unwatched(c)}.bind(this),c):h(d,c,e)&&c.run_next_step()},f.run_watched=function(c){var d=b.path.dereference_path(a,c),f=function(){if(!c.stopped()||c.being_trained)e||(e={}),e.running_watched=!0,h(d,c,e)};d?(b.logging&&0<=b.logging.indexOf("event")&&console.log("   "+d+" ("+b.path.toString(a)+" "+(d.to_debug_string?d.to_debug_string(50):d)+" by watched "+c.to_debug_string(50)+(c.animate_consequences_of_actions()?"":" finishing instantly")),d.wait_until_this_nest_receives_something?
(d.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.set_waiting(!1);this.run_watched(c)}.bind(this),c),c.set_waiting(!0),TOONTALK.UTILITIES.visible_element(c.get_context().get_backside_element())||c.get_frontside().remove()):g(d,c,f,e)):b.UTILITIES.report_internal_error("Unable to dereference the path: "+b.path.toString(a)+" in context: "+c.get_context())},f.toString=function(c){var f="",h="",g=d,k;if("open the backside"===d||"close the backside"===d)d+=" of";if("click the button of"===
d)switch(e.button_selector){case ".toontalk-green-flag":g="click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" of";break;case ".toontalk-stop-sign":g="click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":g="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":g="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":g=
"click the button to add or remove attributes of ";break;case ".toontalk-remove-backside-and-widget-buttton":g="click the button to remove the back and front of ";break;default:g="click a button of"}if("add a new widget to the work space"===d)return d.replace("a new widget",b.path.toString(a));if("add to the top-level backside"===d)return"";c||(c={});k=b.path.toString(a,c);if("edit"===d||"drop it on the text area of"===d)f=" ("+e.toString+")";else if("train"===d){f=e.step.toString({person:"third"});
if(""===f)return f;f=" to "+f;h="- ";c&&c.robot_being_trained_description&&(k=c.robot_being_trained_description)}else"start training"===d?c&&(c.robot_being_trained_description="it"):"stop training"===d&&(k=c.robot_being_trained_description,c.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(d)){if(0<=k.indexOf("hole of"))return h+g+" what is in "+k+f;if(0===k.indexOf("a When"))return k=k.substring(3),
k=b.UTILITIES.remove_encoded_HTML(k),k=b.UTILITIES.elide(k,80,1),"."===k[k.length-1]&&(k=k.substring(0,k.length-1)),h+g+" a robot who w"+k+f+"\n"}return h+g+" "+k+f},f.get_json=function(c,f,h){var g=function(e,h){b.path.get_json(a,c,function(a,b){f({type:"robot_action",action_name:d,path:a,additional_info:e},b)},h)};e?b.UTILITIES.get_json_of_keys(e,["running_watched"],g,h):g(void 0,h)},f;b.UTILITIES.report_internal_error("No watched function for "+d)}}}(window.TOONTALK);window.TOONTALK.queue=function(b){var h={create:function(){var c=Object.create(this);c.to_run=b.UTILITIES.create_queue();c.run_function=c.run.bind(c);return c},enqueue:function(b){b.running_or_in_run_queue()||(b.set_running_or_in_run_queue(!0),this.to_run.enqueue(b)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var c=Date.now()+h.maximum_run,d;for(this.running=!0;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<c;)d=this.to_run.dequeue(),d.run_actions();this.to_run.isEmpty()?this.running=!1:b.UTILITIES.set_timeout(this.run_function)}};return h}(window.TOONTALK);window.TOONTALK.path=function(b){var h;b.creators_from_json["path.to_entire_context"]=function(c,d){return b.path.to_entire_context()};b.creators_from_json["path.to_thing_in_hand"]=function(){return b.path.to_thing_in_hand()};b.creators_from_json["path.to_widget_on_nest"]=function(){return b.path.to_widget_on_nest()};b.creators_from_json["path.top_level_backside"]=function(){return b.path.top_level_backside};b.creators_from_json["path.to_backside_widget_of_context"]=function(c,d){return"undefined"===
typeof c.backside_index?b.path.get_path_to_backside_widget_of_context(c.type_name,d&&d.robot):b.path.get_path_to_backside_index_of_context(c.backside_index,c.type_name,d&&d.robot)};b.creators_from_json["path.to_resource"]=function(c,d){return b.path.get_path_to_resource(b.UTILITIES.create_from_json(c.resource,d))};return{get_path_to:function(c,d,a){var h=function(c,d){var h=d.get_training_context(),k=d.get_body(),p=function(a){a=a.get_widget();var e;if(a===c||a.top_contents_is&&a.top_contents_is(c))return d.add_to_backside_conditions(a),
l=b.path.get_path_to_backside_widget_of_context(a,d),l.is_backside=q,!0;if(a.get_path_to&&(e=a.get_path_to(c,d)))return e.is_backside=q,d.add_to_backside_conditions(a),l=b.path.get_path_to_backside_widget_of_context(a,d),l.next=e,!0},l,t,q;c.is_primary_backside&&c.is_primary_backside()&&(q=!0,c=c.get_widget());if(h===c)return l=b.path.to_entire_context(),l.is_backside=q,l;if(d.get_thing_in_hand()===c)return b.path.to_thing_in_hand();t=c.get_type_name();if("top-level"===t)return b.path.top_level_backside;
if(l=k.get_path_to(c,d,a))return l.is_backside=q,l;if("element attribute"===t&&c.is_attribute_widget_copy(c))return l=b.element.create_attribute_path(c,d),l.is_backside=q,l;if(b.debugging&&!h)b.UTILITIES.report_internal_error("No context to compute the path");else{if(h.get_path_to&&(k=h.get_path_to(c,d)))return k.is_backside=q,l=b.path.to_entire_context(),l.next=k,l;h.get_backside_widgets().some(p);if(l)return l.is_backside=q,l;if(h=c.ancestor_of_type("robot"))return b.robot.find_conditions_path(c,
h,d);l=b.path.get_path_to_resource(c.derefernce().copy());l.is_backside=q;return l}}(c,d,a);h&&c.dereference_contents&&(b.path.path_end(h).not_to_be_dereferenced=!0);!h||"pick up"!==d.current_action_name&&"remove"!==d.current_action_name||(b.path.path_end(h).removing_widget=!0);return h},path_end:function(b){for(;b.next;)b=b.next;return b},dereference_path:function(b,d,a){var h;b?b.dereference_path?h=b.dereference_path(d,a):a&&a.dereference_path&&(h=a.dereference_path(b,d)):h=a||d.get_context();return h&&
b&&b.is_backside?h.get_backside(!0):h},continue_dereferencing_path:function(b,d,a){void 0===d&&a.context_is_backside()&&(d=a.get_top_level_context());void 0===d&&(d=a.get_context());return b.next?d.dereference_contents&&!b.next.not_to_be_dereferenced?(d=d.dereference_contents(b.next,a))&&b.is_backside?d.get_backside(!0):d:(d=d.dereference_path(b.next,a))&&b.next.is_backside?d.get_backside(!0):d:d.dereference_contents&&!b.not_to_be_dereferenced?(d=d.dereference_contents(b,a))&&b.is_backside?d.get_backside(!0):
d:d},toString:function(c,d){var a="",h;if(!c)return"undefined path";c.is_backside&&(a="the backside of ");d||(d={});h=d.resource;d.resource=!0;c.next?(b.path.toString(c.next,d),a=a+b.path.toString(c.next,d).trim()+" of "+c.toString(d)):a+=c.toString(d);d.resource=h;return a},get_json:function(c,d,a,h){var m,f;c.get_json?(m=function(h,k){c.is_widget&&(h=c.add_to_json(h,d));c.next&&(f=function(a){h.next_path=a},b.path.get_json(c.next,d,f,k));c.removing_widget&&(h.removing_widget=!0);c.not_to_be_dereferenced&&
(h.not_to_be_dereferenced=!0);if(!0===c.is_backside||c.is_backside&&c.is_backside())h.is_backside=!0;a(h,k)},c.get_json(d,m,h)):a(c,h)},to_entire_context:function(c){return{dereference_path:function(c,a){return b.path.continue_dereferencing_path(this,a,c)},toString:function(b){return b&&b.robot?b.robot.get_top_level_context_description(b):b&&"third"===b.person?"what he's working on":"what I'm working on"},get_json:function(b,a,c){a({type:"path.to_entire_context"},c)}}},to_widget_on_nest:function(){return{dereference_path:function(c,
d){return b.path.continue_dereferencing_path(this,d,c)},toString:function(){return"what is on the nest"},get_json:function(b,d,a){d({type:"path.to_widget_on_nest"},a)}}},to_thing_in_hand:function(){return{dereference_path:function(c,d){return b.path.continue_dereferencing_path(this,c.get_thing_in_hand(),c)},toString:function(){return"what I'm holding"},get_json:function(b,d,a){d({type:"path.to_thing_in_hand"},a)}}},get_path_to_resource:function(c){c||console.error("Widget missing in get_path_to_resource.");
c=c.get_widget();return{dereference_path:function(d){var a=c.copy({copying_resource:!0}),h,m,f;d.add_newly_created_widget(a);d.visible()&&(h=b.UTILITIES.find_resource_equal_to_widget(c,d))&&(a.save_dimensions_of(b.UTILITIES.widget_side_of_element(h)),f=a.get_frontside_element(),m=$(h).position(),b.UTILITIES.set_timeout(function(){$(f).css({left:m.left,top:m.top,width:$(h).width(),height:$(h).height()})}));return a},toString:function(d){return b.UTILITIES.add_a_or_an(c.toString(d))},get_json:function(d,
a,h){c.get_json(b.UTILITIES.fresh_json_history(d),function(b,c){a({type:"path.to_resource",resource:b},c)},h)}}},get_path_to_backside_widget_of_context:function(c,d){return"string"===typeof c?{dereference_path:function(a){var d=a.get_context(),h=a.get_backside_widget_of_type(c,d);h||d.get_backside_widgets().some(function(b){if(b.get_widget().is_of_type(c)&&!a.is_newly_created(b.get_widget()))return h=b.get_widget(),!0});if(h)return b.path.continue_dereferencing_path(this,h,a)},toString:function(a){a=
(a&&a.robot&&a.robot.get_backside_conditions()?a.robot.get_backside_conditions()[c]:b.UTILITIES.add_a_or_an(c))+" on the back of what I'm working on";return this.removing_widget?"what is on "+a:a},get_json:function(a,b,d){b({type:"path.to_backside_widget_of_context",type_name:c},d)}}:this.get_path_to_backside_index_of_context(d.get_backside_condition_index(c),c.get_type_name(),d)},get_path_to_backside_index_of_context:function(c,d,a){return{dereference_path:function(a){var h=a.get_backside_matched_widgets()[c],
f;if(h)return this.removing_widget&&((f=h.get_parent_of_frontside())&&f.is_hole()&&(f=f.get_parent_of_frontside()),f&&f.removed_from_container&&"nest"!==d&&a.remove_from_container(h,f)),b.path.continue_dereferencing_path(this,h,a);b.debugging&&console.log("can this happen?")},toString:function(c){var h=(c=(c=a.get_frontside_conditions())&&c.is_top_level())?"work area":"back of what",h=b.UTILITIES.add_a_or_an(d||"thing")+" on the "+h+" I'm working on";return!this.removing_widget||c&&"nest"!==d?h:"what is on "+
h},get_json:function(a,b,f){b({type:"path.to_backside_widget_of_context",type_name:d,backside_index:c},f)}}},process_path_json:function(c,d,a){d.next_path&&(c.next=b.UTILITIES.create_from_json(d.next_path,a));d.removing_widget&&(c.removing_widget=!0);d.not_to_be_dereferenced&&(c.not_to_be_dereferenced=!0);d.is_backside&&(c.is_backside=!0)},top_level_backside:{dereference_path:function(c){if(c=c.get_context().ancestor_of_type("top-level"))return c;h||(h=b.widget.create_top_level_widget());return h},
toString:function(){return"the top-level backside"},get_json:function(b,d,a){d({type:"path.top_level_backside"},a)}}}}(window.TOONTALK);window.TOONTALK.publish=function(b){var h=function(b,d,a){var h='<!DOCTYPE html>\n<html>\n<head>\n<script src="https://toontalk.github.io/ToonTalk/toontalk.js?published=1">\x3c/script>\n<title>\n'+b+"</title>\n</head>\n<body>\n";d.forEach(function(b,c){h+='<div class="toontalk-edit" name="content">\n'+b+"\n</div>\n";a[c]&&(h+=a[c])});return h+="</body>\n</html>\n"};return{publish_widget:function(c,d,a,k){var m=b.google_drive.get_status(),f=["Edit this. Select text for formatting."],g=function(a){(a=
a&&a.items&&0<a.items.length&&a.items[0])?k(a,p):(a=h(c,f,p),b.google_drive.upload_file(r,"html",a,k))},r,p;"Ready"===m?(r=d.get_setting("program_name"),a?b.UTILITIES.get_json_top_level(d,function(a){d.set_setting("program_name",r+" (published version)");p=[b.UTILITIES.toontalk_json_div(a,d)];d.set_setting("program_name",r)}):(a=d.get_backside_widgets(),p=[],a.forEach(function(a,c){a.visible()&&b.UTILITIES.get_json_top_level(a,function(c){c.view&&(c.view.saved_width=void 0,c.view.saved_height=void 0);
p.push(b.UTILITIES.toontalk_json_div(c,a.get_widget()));f.push("")})})),b.google_drive.get_toontalk_files(b.google_drive.full_file_name(r,"page"),"page",g)):(console.log("Unable to publish to Google Drive because: "+m),k(null))},republish:function(c){b.google_drive.insert_or_update_file(void 0,c.file_id,"page",h(c.title,c.editable_contents,c.widgets_json),function(){console.log("Published page '"+c.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(b){var h=b.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",c=b.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",d="Need to authorize",a,k;return{handle_client_load:function(a){0>window.location.href.indexOf(c)?(d="Connections to Google Drive are configured for the following domain only: "+c+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",a&&
a(d)):setTimeout(function(){b.google_drive.check_authorization(a)})},check_authorization:function(a){d="Awaiting authorization";gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(c){b.google_drive.handle_authorization_result(c,a)})},handle_authorization_result:function(a,c){a&&!a.error?(d="Authorized but not yet ready",gapi.client.load("drive","v2",function(){b.google_drive.get_folder_ids(function(){d="Ready"})}),c&&c()):(d="Need to authorize",c&&
c(d))},authorize:function(a){gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(c){b.google_drive.handle_authorization_result(c,a)})},get_folder_ids:function(c){b.google_drive.get_folder_id(!0,function(d){a=d;b.google_drive.get_folder_id(!1,function(a){k=a;c()})})},get_folder_id:function(c,d){var h=c?"ToonTalk Programs":"ToonTalk Pages",r=function(a){var k=function(a){a&&a.id?d(a.id):console.error("Failure to create folder '"+h+"'. Response was "+
a)};(a=a&&a.items&&0<a.items.length&&a.items[0].id)?d(a):c?b.google_drive.create_folder("ToonTalk Programs",!1,k):b.google_drive.create_folder("ToonTalk Pages",!0,k)};c&&a?d(a):!c&&k?d(k):b.google_drive.fetch_folder_id(h,r)},get_status:function(){return d},connection_to_google_drive_possible:function(){return 0!==d.indexOf("Connections to Google Drive are configured for the following domain only: ")&&!b.CHROME_APP},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",
params:a}).execute(b)},fetch_folder_id:function(a,c){b.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},c)},get_toontalk_files:function(a,c,d){"undefined"===typeof gapi?d("Google Drive API not available."):(c="properties has {key='ToonTalkType' and value='"+c+"' and visibility='PUBLIC'} and trashed = false",a&&(c+=" and title='"+a+"'"),b.google_drive.list_files({q:c},d))},get_toontalk_program_file:function(c,d){b.google_drive.list_files({q:"'"+
a+"' in parents and trashed = false and title='"+c+"'"},function(a){a&&a.items&&0<a.items.length?d(a.items[0]):d(null)})},upload_file:function(a,c,d,h){var k="json"===c?"program":"page",l=a+"."+c;b.google_drive.get_toontalk_files(l,k,function(a){gapi.client.load("drive","v2",function(){var c=a&&a.items&&0<a.items.length&&a.items[0].id;h||(h=function(a){a.error&&(console.log("Google drive status: "+b.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message));console.log("File "+
a.title+" ("+a.id+") "+(c?"updated":"created"))});c?b.google_drive.insert_or_update_file(void 0,c,k,d,h):b.google_drive.insert_or_update_file(l,void 0,k,d,h)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(c,d,h,r,p){var l={title:c,mimeType:"text/html"};l.parents=[{kind:"drive#fileLink",id:"program"===h?a:k}];r="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(l)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
r+"\r\n---------314159265358979323846--";c?(c="/upload/drive/v2/files",l="POST"):(c="/upload/drive/v2/files/"+d,l="PUT");gapi.client.request({path:c,method:l,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:r}).execute(function(a){d||b.google_drive.insert_property(a.id,"ToonTalkType",h,"PUBLIC");p&&p(a)})},create_folder:function(a,b,c){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){c(a)})}:c)},download_file:function(a,b){if(a.downloadUrl){var c=gapi.auth.getToken().access_token,d=new XMLHttpRequest;d.open("GET",a.downloadUrl);d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=function(){b(null)};d.send()}else b(null)},google_drive_url:function(a){return"https://googledrive.com/host/"+a+"/"},insert_property:function(a,
b,c,d){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:c,visibility:d}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(b){var h={},c=!1,d=100,a=(new Date).getTime(),k=[],m=[],f,g=[],r=new MutationObserver(function(a){a.forEach(function(a){var b,c;for(b=0;b<a.addedNodes.length;b++)c=a.addedNodes.item(b),1===c.nodeType&&setTimeout(function(){!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0,c.toontalk_run_even_if_not_observable=
void 0);$(c).find(".toontalk-has-attached-callback").each(function(a,b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)})})})}),p=function(a,b,c){var d;if(a){d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},l=function(a,c){b.debugging+="\n"+a;console.log(a);c&&(alert(b.debugging),b.debugging="touch")},t=function(a){var b=a.indexOf("<div style='display:none;'>{"),
b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},q=function(a,c){if(!$(c).is(".toontalk-conditions-contents")){var d=$(c).closest(".toontalk-side"),e=h.get_mouse_or_first_touch_event_attribute("clientX",a),f=h.get_mouse_or_first_touch_event_attribute("clientY",a),g,k,l,m;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(a.dataTransfer&&a.dataTransfer.getData("text")&&0<a.dataTransfer.getData("text").length)){H=d||$(c);l=
h.widget_side_of_jquery(H);if(!l){l=h.widget_side_of_element(c);h.report_internal_error("Possible bug that "+H+" doesn't have a known owner.");if(!l){h.report_internal_error("The element doesn't have an owner either.");return}H=$(c)}l=l.get_selection();H=$(l.get_element());l.set_stopped&&l.set_stopped(!0);!l.save_dimensions||l.get_parent_of_frontside()&&!l.get_parent_of_frontside().get_widget().is_top_level()||l.save_dimensions();l.being_dragged=!0;g=H.get(0).getBoundingClientRect();m=H.is(".toontalk-top-level-resource");
$(c).removeClass("toontalk-wiggle");l.get_json&&(d=function(b){b.view.drag_x_offset=e-g.left;b.view.drag_y_offset=f-g.top;!b.view.frontside_width&&H.parent().is(".toontalk-backside")&&(b.view.frontside_width=H.width(),b.view.frontside_height=H.height());H.data("json",b);a.dataTransfer&&(k=h.toontalk_json_div(b,l),a.dataTransfer.effectAllowed=m?"copy":"move",a.dataTransfer.setData("text",k),h.is_internet_explorer()||a.dataTransfer.setData("text/html",k));l.drag_started&&l.drag_started(b,m)},a.dataTransfer&&
a.dataTransfer.setData("text","Sorry, it took too long to generate the data structure needed to reconstruct "+l+"."),b.UTILITIES.get_json_top_level(l,d,6E5));H.addClass("toontalk-being-dragged");(d=l.get_listeners("picked up"))&&d.map(function(a){a()});a.stopPropagation()}}},u=function(a,b){var c;if(!$(b).is(".toontalk-conditions-contents")){H||(H=$(a.target).closest(".toontalk-side"));if(c=h.widget_side_of_jquery(H))c.being_dragged=void 0,(c=c.get_listeners("dropped"))&&c.map(function(a){a()});H.is(".toontalk-frontside")&&
(H.parent().is(".toontalk-backside")?(c=H.data("json"))&&h.set_css(H,{width:c.view.frontside_width,height:c.view.frontside_height}):H.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||H.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||h.has_animating_image(H.get(0))||h.set_css(H,{width:"100%",height:"100%"}));F();a.stopPropagation()}},e=function(a){if(H)return h.widget_side_of_jquery(H);if(a)return a=h.data_transfer_json_object(a),
h.create_from_json(a)},B=function(a,c){var d=h.data_transfer_json_object(a),e=function(a,d){var e=h.create_from_json(a),f=document.createElement("div"),n=e.get_element(!0),g=$(c).closest(".toontalk-edit"),k=b.published_support.create_editable_text(),l=d.target;$(f).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");$(n).addClass("toontalk-top-level-resource").css({position:"relative",width:e.saved_width,height:e.saved_height});n.toontalk_widget_side=e;f.toontalk_widget_side=
e;f.appendChild(n);for($(f).insertAfter(g);l.nextSibling;)$(k).children(".froala-element").get(0).appendChild(l.nextSibling);$(k).insertAfter(f);e.set_visible(!0);e.render()},f=function(){var a;g.hide();a=document.elementFromPoint(t-window.pageXOffset-b.USABILITY_DRAG_OFFSET.x,u-window.pageYOffset-b.USABILITY_DRAG_OFFSET.y);g.show();if(a)return $(a).closest(".toontalk-side")},g,k,l,m,p,q,r,t,u;void 0===d&&H&&(d=H.data("json"));H&&H.data("json","");g=H;F();if(g||void 0!==d||a.dataTransfer.files||K(a)){if($(a.target).is(".toontalk-drop-area-instructions"))e=
$(a.target).parent();else if($(a.target).is(".toontalk-element-attribute-input")){if(e=$(a.target).closest(".toontalk-side"),k=h.widget_side_of_jquery(e)){f=g?h.widget_side_of_jquery(g):h.create_from_json(d);h.restore_resource(g,f);k.dropped_on_style_attribute(f,a.target.name,a);a.stopPropagation();return}}else if($(a.target).is(".toontalk-drop-area"))e=$(a.target);else{if(d&&$(a.currentTarget).is(".froala-element")){e(d,a);return}e=g&&g.is(".toontalk-backside")?$(a.target).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):
$(a.target).closest(".toontalk-side")}if(0!==e.length){t=h.get_mouse_or_first_touch_event_attribute("pageX",a);u=h.get_mouse_or_first_touch_event_attribute("pageY",a);if(e.is(".toontalk-top-level-resource"))if("touchend"===a.type){e=$(".toontalk-highlight");if(0===e.length||e.get(0)===g.get(0))e=f();if(!e||0===e.length)return}else return;p=e.offset();k=h.widget_side_of_jquery(e);if(g&&0<g.length&&!(k&&k.get_widget().get_infinite_stack&&k.get_widget().get_infinite_stack())&&(g.get(0)===e.get(0)||jQuery.contains(g.get(0),
e.get(0)))){if(g.is(".toontalk-backside-of-top-level"))return;e=$(".toontalk-highlight");if(0===e.length||e.get(0)===g.get(0))e=f();if(!e||0===e.length)return;p=e.offset();k=h.widget_side_of_jquery(e)}h.remove_highlight();d&&d.view&&d.view.drag_x_offset?(l=d.view.drag_x_offset,m=d.view.drag_y_offset):m=l=0;if(g&&0<g.length){if(!(k&&k.get_widget().get_infinite_stack&&k.get_widget().get_infinite_stack()||g.get(0)!==e.get(0)&&!jQuery.contains(g.get(0),e.get(0)))){h.set_css(g,{left:g.get(0).offsetLeft+
(a.layerX-l),top:g.get(0).offsetTop+(a.layerY-m)});a.stopPropagation();return}f=h.widget_side_of_jquery(g);g.parent().is(".toontalk-drop-area")?(g.removeClass("toontalk-widget-in-drop_area"),g.parent().data("drop_area_owner").set_next_robot(void 0)):((r=f&&f.get_parent())?(q=$(r.get_element()),!f.is_backside()&&f.get_widget().get_infinite_stack&&f.get_widget().get_infinite_stack()?(q=f.get_widget().saved_width,r=f.get_widget().saved_height,f=b.UTILITIES.get_dragee_copy(),f.get_widget().saved_width=
q,f.get_widget().saved_height=r,q=g.width(),r=g.height(),g=$(f.get_element(!0)),e.is(".toontalk-backside")&&h.set_css(g,{width:d.view.frontside_width||q,height:d.view.frontside_height||r})):r.removed_from_container&&(q.is(".toontalk-backside")?r.remove_backside_widget(f,!0):(r.removed_from_container(f,a),f.restore_dimensions&&!r.is_empty_hole()&&f.restore_dimensions()))):h.restore_resource(g,f),f&&f.robot_in_training()&&f.robot_in_training().add_newly_created_widget_if_new(f))}else{if(0<a.dataTransfer.files.length){for(d=
0;d<a.dataTransfer.files.length;d++)z(a.dataTransfer.files[d],e,k,p,a);a.stopPropagation();return}if(K(a)){M(a.dataTransfer.getData("URL"),e,k,p,a);a.stopPropagation();return}f=h.create_from_json(d,{event:a});if(!f){d?h.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):b.debugging&&console.log("No data transfer in drop.");a.stopPropagation();return}f.robot_in_training()&&f.robot_in_training().drop_from_data_transfer(f);g=$(f.get_element(!0));f.is_primary_backside&&f.is_primary_backside()&&
(h.set_css(g,{width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width}),f.apply_backside_geometry())}k&&f.get_widget()===k.get_widget()||L(e,g,f,k,p,a,d,l,m)}}else a.dataTransfer?h.report_internal_error("Drop failed since unable to parse as JSON."):h.report_internal_error("Drop failed since there is no event.dataTransfer"),a.stopPropagation()},y=function(a,b){a.addEventListener("drop",function(a){var c=e(a);h.restore_resource(h.get_$dragee(),
c);b(a)})},G=function(a,b){var c;c=h.get_$dragee();var d;d=c&&c.is(".toontalk-backside")?$(b).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):$(b).closest(".toontalk-side");c=!d.is("*")||d.is(".toontalk-backside-of-top-level")||d.closest(".toontalk-top-level-resource").is("*")||d.is(".toontalk-being-dragged")||c&&A(d.get(0),c.get(0))?void 0:d;if(c)return h.highlight_element(c.get(0),a),c.get(0)},L=function(a,c,d,e,f,g,k,l,m){var p=h.get_mouse_or_first_touch_event_attribute("pageX",
g),q=h.get_mouse_or_first_touch_event_attribute("pageY",g),r,t,u,w;l||(l=0);m||(m=0);d.set_visible(!0);k&&k.semantic&&k.semantic.running&&h.set_timeout(function(){d.set_running(!0)},100);if(a.is(".toontalk-backside")){if(d.get_widget().is_top_level()){r=k.semantic.backside_widgets;t=k.shared_widgets;u=a.get(0);(l=e.robot_in_training())&&l.drop_from_data_transfer(d,e);l=d.get_widget().get_backside_widgets().slice();b.UTILITIES.for_each_batch(l,function(a,b){var c=a.get_widget(),f,n,g,k,l,v,m;d.remove_backside_widget(a);
f=0<=r[b].widget.shared_widget_index?t[r[b].widget.shared_widget_index].view:r[b].widget.view;n=a.get_element(!0);a.is_backside()?(g=f.backside_left,k=f.backside_top,l=f.backside_width,v=f.backside_height):(g=f.frontside_left,k=f.frontside_top,l=f.frontside_width,v=f.frontside_height);e.add_backside_widget(a);u.appendChild(n);m=$(n).position();w={left:m.left+g,top:m.top+k,width:l,height:v};h.constrain_css_to_fit_inside(u,w);h.set_css(n,w);d.set_location_attributes&&c.set_location_attributes(w.left,
w.top);a.is_backside()&&(c.backside_geometry=f.backside_geometry,c.apply_backside_geometry())}.bind(this));return}if(!e){h.report_internal_error("No target_widget");return}d?e.widget_side_dropped_on_me(d,g):h.report_internal_error("No source_widget");g=p-(f.left+(l||0));a=q-(f.top+(m||0));w={left:h.left_as_percent(g,c.get(0)),top:h.top_as_percent(a,c.get(0))};h.set_css(c,w);!d.is_backside()&&d.set_location_attributes&&d.set_location_attributes(g,a);k&&k.semantic&&k.semantic.running&&!h.get_$dragee()&&
d.set_running(!0)}else if(a.is(".toontalk-drop-area"))c.addClass("toontalk-widget-in-drop_area"),0<a.length&&a.get(0).appendChild(c.get(0)),c.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(h.widget_side_of_jquery(c));else{if(c.is(".toontalk-backside-of-top-level"))return;if(e||g.changedTouches){u=a.closest(".toontalk-backside-of-top-level").get(0);!u&&g.changedTouches&&(k=document.elementFromPoint(p-window.pageXOffset,q-window.pageYOffset),(u=$(k).is(".toontalk-backside-of-top-level")?
k:$(k).closest(".toontalk-backside-of-top-level").get(0))||(u=$(".toontalk-backside-of-top-level").get(0)),e=h.widget_side_of_element(u).get_backside());if(!u)return;u.appendChild(c.get(0));k=$(u).offset();w={left:p-(k.left+l+b.USABILITY_DRAG_OFFSET.x),top:q-(k.top+m+b.USABILITY_DRAG_OFFSET.y)};h.set_css(c,w);d.drop_on&&d.drop_on(e,g)||e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(d,g)||(c=a.closest(".toontalk-backside-of-top-level"),0<c.length&&(e=h.widget_side_of_jquery(c))&&e.widget_side_dropped_on_me(d,
g))}else{h.report_internal_error("target widget missing");return}}b.logging&&0<=b.logging.indexOf("drop")&&(console.log("Drop of "+d._debug_id+" on "+e._debug_id),console.log("Left: "+w.left+"; top: "+w.top+"; page_x: "+p+"; page_y: "+q+"; drag_x_offset: "+l+"; drag_y_offset: "+m));h.remove_highlight()},z=function(a,c,d,e,f){var g=new FileReader,k=0===a.type.indexOf("image"),l=0===a.type.indexOf("audio"),m=0===a.type.indexOf("video"),p,q,r;g.onloadend=function(){if(k)p=b.element.create("<img src='"+
g.result+"' alt='"+a.name+"'/>");else if(l)p=b.element.create(a.name+" sound"),p.set_sound_effect(new Audio(g.result));else if(m)p=b.element.create("<video src='"+g.result+"' alt='"+a.name+"'/>");else{if(q=t(g.result))try{r=JSON.parse(q),p=h.create_from_json(r)}catch(u){}p||(p=b.element.create(g.result))}p&&p.robot_in_training()&&p.robot_in_training().drop_from_data_transfer(p,d);L(c,$(p.get_frontside_element(!0)),p,d,e,f,r)};k||l||m?g.readAsDataURL(a):g.readAsText(a)},M=function(a,c,d,e,f){var g=
function(a,c,e,f){var n=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),L(c,$(a.get_frontside_element(!0)),a,d,e,f))};h.create_widget_from_URL(a,n,function(c){var d=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");d?n(b.element.create(d)):(h.display_message("Error: "+c+". When trying to fetch "+a),console.log(c))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&g(a,c,e,f)})},E=function(a,b){var c=$("<div class='"+a+"'>");h.run_when_dimensions_known(c.get(0),
function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},I=function(){var a=h.get_path_to_toontalk_folder()+"sounds/",c=function(b){b=new Audio(a+b);b.volume=h.get_audio_volume(b);return b};b.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),
event_ignored:c("PLOP.mp3")};b.sounds.bird_fly.loop=!0},S=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},F=function(){H&&(H.removeClass("toontalk-being-dragged"),h.set_timeout(function(){ca=U=H=void 0}))},A=function(a,b){if(a===b)return!0;if(a.parentNode)return A(a.parentNode,b)},J=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",
k,l;if(0>f)return a;for(;0<=f;){k=f+d.length;l=a.indexOf(e,k);if(0>l)return h.report_internal_error("Expected title to have matching pairs of "+d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(k,l));c=l+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},K=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},w=!1,O=[],Q=[],H,U,ca,R,D;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window?(a.stopPropagation(),
0<O.length&&O.shift()()):a.data.editable_contents&&b.publish.republish(a.data)},!1);r.observe(window.document,{childList:!0,subtree:!0});h.available_types="number box element robot nest sensor top-level".split(" ");h.create_from_json=function(a,c,d){var e=function(a,b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},f,g,k,l,m;if(a){c||(c={});c.guid_to_nest_table||(c.guid_to_nest_table=
{});a.shared_widgets&&(c.json_of_shared_widgets=a.shared_widgets,c.shared_widgets=[]);a.shared_html&&(c.shared_html=a.shared_html);if(a.widget)return(f=h.create_from_json(a.widget,c))&&a.is_backside?f.get_backside(!0):f;if(c&&c.shared_widgets&&0<=a.shared_widget_index){if(d=c.shared_widgets[a.shared_widget_index])return d;d=c.json_of_shared_widgets[a.shared_widget_index];f=h.create_from_json(d,c,!0);return e(f,c,a.shared_widget_index)}(k=a.semantic)||(k=a);l=a.view;if(0<=k.shared_widget_index){if(!c.json_of_shared_widgets){h.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");
return}f=h.create_from_json(c.json_of_shared_widgets[k.shared_widget_index],c,!0);return e(f,c,k.shared_widget_index)}if(b.creators_from_json[k.type]){c||(c={});l?c.json_view=l:l=c.json_view;if(b.debugging)f=b.creators_from_json[k.type](k,c);else try{f=b.creators_from_json[k.type](k,c)}catch(p){console.error(p.stack),h.report_internal_error("Unable to recreate a "+k.type+". Error is "+p)}f&&!f.is_widget&&b.path.process_path_json(f,a,c);if(f&&f.get_backside){k.erased&&(b.widget.erasable(f),f.set_erased(k.erased));
k.infinite_stack&&f.set_infinite_stack(k.infinite_stack);k.open_backside_only_if_stopped&&f.set_open_backside_only_if_stopped(!0);if(l){if(l.frontside_width)if(g=f.get_element()){if(f.ok_to_set_dimensions())if(m={width:l.frontside_width,height:l.frontside_height},"element"===k.type)f.on_update_display(function(){h.set_css(g,m)});else h.set_css(g,m)}else l.saved_width||(f.saved_width=l.frontside_width,f.saved_height=l.frontside_height);l.saved_width&&(f.saved_width=l.saved_width,f.saved_height=l.saved_height);
l.backside_geometry&&(f.backside_geometry=l.backside_geometry);f.json_view=l}k.backside_widgets&&(d?f.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(f,k.backside_widgets,c)}.bind(this):this.add_backside_widgets_from_json(f,k.backside_widgets,c))}return f}h.report_internal_error("JSON type '"+k.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};h.add_backside_widgets_from_json=function(a,b,c){var d;b&&(d=this.create_array_from_json(b,
c),a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a})))};h.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?h.create_from_json(a,b):a});return c};h.get_json_of_array=function(a,b,c,d,e,f){var g,k;c>=a.length?e():(g=a[c])?g.is_primary_backside&&g.is_primary_backside()?(k=function(f,h){b.push({widget:f,
is_backside:!0});this.get_json_of_array(a,b,c+1,d,e,h)}.bind(this),h.get_json(g.get_widget(),d,k,f)):g.is_widget?(k=function(g,k){b.push({widget:g});0===c%100&&(!h.maximum_json_generation_duration||Date.now()-f>h.maximum_json_generation_duration)?h.set_timeout(function(){this.get_json_of_array(a,b,c+1,d,e,k)}.bind(this)):this.get_json_of_array(a,b,c+1,d,e,k)}.bind(this),h.get_json(g,d,k,f)):(k=function(f,h){b.push(f);this.get_json_of_array(a,b,c+1,d,e,h)}.bind(this),g.get_json(d,k,f)):h.get_json_of_array(a,
b,c+1,d,e,f)};h.fresh_json_history=function(a){var b={widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=a.shared_html);return b};h.get_json_top_level=function(a,b,c){var d=this.fresh_json_history();h.maximum_json_generation_duration=c;h.get_json(a,d,function(c){0<d.shared_widgets.length&&(c.shared_widgets=d.shared_widgets.map(function(b,e){var f=function(a){a=d.widgets_encountered.indexOf(a);return d.json_of_widgets_encountered[a]},g=function(a){return f(d.shared_widgets[a])},
k=f(b);if(a===b)return k={semantic:k.semantic,view:k.view,version:k.version},c.semantic={shared_widget_index:e},k;c.semantic&&h.tree_replace_once(c.semantic,k,{shared_widget_index:e},g,h.generate_unique_id());return k}));c.shared_html=d.shared_html;b(c)},Date.now())};h.get_json=function(a,c,d,e){var f,g,k;b.debugging&&!c?h.report_internal_error("no json_history"):(f=c.shared_widgets.indexOf(a),0<=f?d({shared_widget_index:f},e):(f=c.widgets_encountered.indexOf(a),0<=f?(f=h.insert_ancestors_last(a,
c.shared_widgets),d({shared_widget_index:f},e)):(f=c.widgets_encountered.push(a)-1,(g=a.is_primary_backside&&a.is_primary_backside())&&(a=a.get_widget()),k=function(b,e){a.add_to_json&&(b=a.add_to_json(b,c));c.json_of_widgets_encountered[f]=b;a.add_backside_widgets_to_json?a.add_backside_widgets_to_json(b,c,function(){d(b,e)},e):d(b,e)},Date.now()-e<=h.maximum_json_generation_duration?a.get_json(c,k,e):setTimeout(function(){a.get_json(c,k,Date.now())}))))};h.get_json_of_keys=function(a,b,c,d){var e;
b||(b=[]);Object.keys(a).forEach(function(c){0>b.indexOf(c)&&(e||(e={}),a[c].get_json?a[c].get_json(void 0,function(a,b){e[c]={json:a}},d):e[c]=a[c])});c(e,d)};h.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?h.create_from_json(a[d].json,b):a[d]});return c};h.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).forEach(function(h){if(f=a[h]){if(f===b)return a[h]=c,!0;if("shared_widget_index"===
h){if(this.tree_replace_once(d(f),b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};h.insert_ancestors_last=function(a,b){var c=a.get_widget(),d=-1;b.some(function(a,b){if(c.has_ancestor(a))return d=b,!0});0>d&&(d=b.length);b.splice(d,0,c);return d};h.toontalk_json_div=function(a,b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name(),c=c.toString({for_json_div:!0}),
f;"top-level"===e?b.is_backside()?(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),e+=h.describe_widgets(d))):e="a top-level widget":(e=h.add_a_or_an(e),b.is_backside()&&(e="the back of "+e));c&&(d=c.indexOf("data:image/"),0<d&&(f=c.indexOf("alt=",d),0>f&&(f=c.indexOf(">",d)),c=c.substring(0,d+20)+" ... "+c.substring(f)));return"<div class='toontalk-json' translate='no' style='display:none'>\nThis will be replaced by "+
e+".\n"+(c?c+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,h.clean_json,"  ")+"</div></div>"};h.describe_widgets=function(a){var b="",c=a.length;a.forEach(function(a){c--;b+=h.add_a_or_an(a.get_type_name());1===c?b+=", and ":1<c&&(b+=", ")});return b};h.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};h.strip_trailling_digits=function(a){var b;
if(0===a.length)return a;b=a[a.length-1];return"0"<=b&&"9">=b?h.strip_trailling_digits(a.substring(0,a.length-2)):a};h.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:b};h.create_widget_from_URL=function(a,c,d){var e=function(h){try{var g=this.getResponseHeader("content-type"),k,l;if(!g)if(l=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),0===a.indexOf(l))g="";else{d&&d("Could not determine the contents type of the url");
f.removeEventListener("readystatechange",e);return}0===g.indexOf("audio")?(k=b.element.create(a),k.set_sound_effect(new Audio(a))):0===g.indexOf("image")?k=b.element.create("<img src='"+a+"'>"):0===g.indexOf("video")?k=b.element.create("<video src='"+a+" ' width='320' height='240'>"):0===g.indexOf("text")&&0>g.indexOf("text/html")?this.responseText&&(k=b.element.create(this.responseText),k.set_source_URL(a)):k=b.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");
k&&c(k)}catch(m){d&&d(m),c()}f.removeEventListener("readystatechange",e)},f=new XMLHttpRequest;f.addEventListener("readystatechange",e);f.open("GET",a,!0);try{f.send()}catch(g){d?d(g):(h.display_message("Error trying to GET "+a+" "+g),console.error(g.stack))}};h.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};h.copy_widget_sides=function(a,b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):
c.push(d))});return c};h.copy_array=function(a){return a.slice()};h.generate_unique_id=function(){a+=1;return"toontalk_id_"+a};h.get_style_property=function(a,b){var c;if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle){if(a.parentElement)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);document.body.appendChild(a);c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b);document.body.removeChild(a);return c}};h.get_style_numeric_property=function(a,
b){var c=this.get_style_property(a,b),d;if("string"===typeof c){d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;c=parseFloat(c,10);return isNaN(c)?void 0:c}return c};h.get_element_width=function(a){return a?a.getBoundingClientRect().width:0};h.get_element_height=function(a){return a?a.getBoundingClientRect().height:0};h.data_transfer_json_object=function(a){var c,d;if(a.dataTransfer&&!(0<a.dataTransfer.files.length||
K(a))){try{c=a.dataTransfer.getData("text/html")}catch(e){c=a.dataTransfer.getData("text")}if(!c||c.match(/[\u3400-\u9FBF]/))c=a.dataTransfer.getData("text");if(c){if(a=t(c))try{return JSON.parse(a)}catch(e){h.report_internal_error("Exception parsing "+a+"\n"+e.toString())}a=b.element.create("");a.get_frontside_element(!0);a.set_HTML(c);a.get_json(h.fresh_json_history(),function(a,b,c){0<=a.html.shared_html_index&&(a.html=c.shared_html[a.html.shared_html_index]);d=a});return d}}};h.drag_and_drop=
function(a){var b;h.draggable(a);h.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,h.enable_touch_events(a,b))};h.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){q(b,a)});a.addEventListener("dragend",function(b){u(b,a)})};h.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",function(b){b.preventDefault();B(b,
a);b.stopPropagation()});a.addEventListener("dragenter",function(c){var d=G(c,a);d&&b!==d&&h.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!h.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(h.remove_highlight(b),b=void 0);a.stopPropagation()})};h.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");
b.appendChild(d);h.can_receive_drops(b);return b};h.process_json_elements=function(a,c){var d,e,f,g,k,l,m,p,q;a||(a=$(".toontalk-json"),c=0);if(0!==a.length&&(q=function(){if(g){d.textContent="";$(d).css({display:""});if(g.get_type_name)if(g.is_top_level())m=g.get_backside(!0),l=m.get_element(),$(d).replaceWith(l),$(l).css({width:g.json_view?g.json_view.backside_width:f.view.backside_width,height:g.json_view?g.json_view.backside_height:f.view.backside_height,"background-color":f.view.background_color,
"border-width":f.view.border_width}),g.json_view=void 0;else{if($(d).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),k=g.get_frontside_element(!0))$(k).addClass("toontalk-top-level-resource").css({position:"relative",width:g.saved_width,height:g.saved_height}),d.toontalk_widget_side=g,d.appendChild(k)}else d.appendChild(g.get_element());g.set_active&&g.set_active(!1);g.set_visible&&g.set_visible(!0);setTimeout(function(){g.update_display&&g.update_display();f.semantic.running&&
g.set_running(!0)},1)}else h.report_internal_error("Could not recreate a widget from this JSON: "+e);c<a.length-1&&h.process_json_elements(a,c+1)},d=a.get(c),e=d.textContent))if(e=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),f=JSON.parse(e),f.semantic&&"top_level"===f.semantic.type&&!b.no_local_storage&&!b.reset&&f.load_most_recent_program)try{p=function(a){a?h.retrieve_object(a,function(a){a&&(f=a,g=h.create_from_json(f),q())}):(g=h.create_from_json(f),q())},h.retrieve_string("toontalk-last-key",
p)}catch(r){p="Error reading previous state. Error message is "+r,h.is_internet_explorer()?console.error("window.localStorage in IE11 not available with file://...: "+p):h.display_message(p)}else g=h.create_from_json(f),q()};h.relative_position_from_absolute_position=function(a,b){for(var c=a.parentElement,d=b.left,e=b.top,f;c&&"html"!==c.nodeType;)f=$(c).position(),d-=f.left,e-=f.top,c=c.parentElement;return{left:d,top:e}};h.set_absolute_position=function(a,b){var c=h.relative_position_from_absolute_position(a,
b);h.set_css(a,{left:c.left,top:c.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=c.left+"px",a.style.top=c.top+"px")};h.set_position_relative_to_top_level_backside=function(a,b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-backside-of-top-level"),b,c)};h.set_position_relative_to_element=function(a,c,d,e){var f=c.offset(),g,k,l;c.get(0).appendChild(a.get(0));f||(f={left:0,top:0});g=d.left-f.left;d=d.top-f.top;e&&(e=b.UTILITIES.get_element_width(a.get(0)),
f=b.UTILITIES.get_element_height(a.get(0)),k=b.UTILITIES.get_element_width(c.get(0)),l=b.UTILITIES.get_element_height(c.get(0)),g>k-e&&(g=k-e),0>g&&(g=0),d>l-f&&(d=l-f),0>d&&(d=0));g=h.scale_left(g,c.get(0));d=h.scale_top(d,c.get(0));c={left:g,top:d,position:"absolute"};a.is(".toontalk-side-animating")?(a.get(0).style.left=g+"px",a.get(0).style.top=d+"px",h.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=
""})):h.set_css(a,c);return c};h.restore_resource=function(a,c){var d,e;a&&a.is(".toontalk-top-level-resource")&&(d=h.get_resource_copy()||c.copy({fresh_copy:!0}),e=d.get_frontside_element(!0),h.set_css(e,{width:a.width(),height:a.height()}),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),
a.css({position:"absolute"}),a.get(0).parentElement.appendChild(e),b.DISPLAY_UPDATES.pending_update(d),c.set_active&&(c.set_active(!0),d.set_active(!1)))};h.closest_element=function(a,c){var d,e;if(!c)return a.get(0);d=Number.MAX_VALUE;a.each(function(a,f){var h=$(f).offset(),h=b.UTILITIES.distance(h,c);d>h&&(e=f,d=h)});return e};h.find_resource_equal_to_widget=function(a,b){var c=Number.MAX_VALUE,d=$(b.get_frontside_element()).offset(),e;$(".toontalk-top-level-resource.toontalk-side").each(function(b,
f){var g=h.widget_side_of_jquery($(f));g&&(a.equals&&a.equals(g)||a.matching_resource&&a.matching_resource(g)||a.get_type_name()===g.get_type_name()&&"matched"===a.match(g))&&(a.is_hole()||g.get_backside_widgets().length===a.get_backside_widgets().length)&&(g=h.distance($(f).offset(),d),c>g&&(e=f,c=g))});return e};h.set_position_is_absolute=function(a,b,c){var d,e;b?(b=h.get_style_numeric_property(a,"left"),d=h.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-
e.left,b-=$(a).width()/2),"auto"===d&&(d=c.pageY-e.top,d-=90)),h.set_css(a,{left:h.left_as_percent(b,a),top:h.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};h.left_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:h.adjust_left_if_scaled(a,b);return 100*($(c).offset().left-window.pageXOffset+a-d.left)/d.width+"%"};h.top_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);
if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:h.adjust_top_if_scaled(a,b);return 100*($(c).offset().top+-window.pageYOffset+a-d.top)/d.height+"%"};h.adjust_left_if_scaled=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a-(d-c.get_attribute("width"))/2:a};h.adjust_top_if_scaled=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&
c.get_attribute?a-(d-c.get_attribute("height"))/2:a};h.scale_left=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a*d/c.get_attribute("width"):a};h.scale_top=function(a,b){var c=h.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a*d/c.get_attribute("height"):a};h.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";
case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";case 11:return"eleventh";case 12:return"twelfth";case 13:return"thirteenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};h.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};h.give_tooltip=function(a,b){a&&(a.title=b,h.use_custom_tooltip(a))};h.use_custom_tooltip=function(a){var c=
$(a),d;c.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){var e;0>a.top&&(a.top=0,e=c.offset(),e.left<$(window).width()/2?a.left=e.left+c.width()+10:(a.left=0,d=e.left-40));"bottom"===b.vertical?(c.is(".toontalk-robot")?a.top-=30:c.is(".toontalk-number")?a.top-=30:c.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);h.set_css(this,a)}},open:function(c,
e){var f=e.tooltip.get(0),g=f.textContent,k=$(a).is(".toontalk-robot"),l;g===a.toontalk_previous_text?(e.tooltip.remove(),b.speak&&window.speechSynthesis.cancel()):(f.innerHTML=J(g,decodeURIComponent),b.speak&&(window.speechSynthesis.cancel(),k||(l=function(b){if(f===D||void 0===D)a.toontalk_previous_text=g}),h.speak(f.innerText,l)),D&&$(D).remove(),D=f,b.balloons?(100<g.length&&(l=Math.min(800,d||$(window).width()-100),$(f).position(),e.tooltip.css({maxWidth:l})),e.tooltip.css({"z-index":99999999}),
e.tooltip.find(".toontalk-iframe-container").removeClass("toontalk-iframe-container"),setTimeout(function(){k||(a.toontalk_previous_text=g);e.tooltip.remove();$(f).data("ui-tooltip")&&($(f).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),h.use_custom_tooltip(a));D=void 0},g.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))):e.tooltip.remove())},close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),h.use_custom_tooltip(a));D=void 0}})};
h.speak=function(a,c,d,e,f,k){var l=new SpeechSynthesisUtterance(a),m=window.speechSynthesis.getVoices(),p=function(a){for(var b=[],c=function(a){var b,c;if(200>a.length)return a.length+1;b=a.substring(0,200);c=b.lastIndexOf(". ")||b.lastIndexOf(".\n");if(0<c)return c+2;c=b.lastIndexOf(".");if(c===b.length-1)return c+1;c=b.lastIndexOf(", ");if(0<c)return c+2;c=b.lastIndexOf(" ");return 0<c?c+1:Math.min(a.length+1,200)},d;0<a.length;)d=c(a),1<d&&b.push(a.substring(0,d-1)),a=a.substring(d);return b},
q,r,t;0===m.length?window.speechSynthesis.onvoiceschanged=function(){h.speak(a,c,d,e,f,k);window.speechSynthesis.onvoiceschanged=void 0}:200<a.length?(r=p(a),r.forEach(function(a,b){var g;b===r.length-1?g=c:0===b&&(g=function(){});h.speak(a,g,d,e,f,k)})):(t=g.push(l)-1,l.volume=void 0===d?Math.min(1,3*b.volume):d,l.pitch=void 0===e?1.2:e,l.rate=void 0===f?.75:f,q=b.TRANSLATION_ENABLED&&google&&google.translate?google.translate.TranslateElement().f:navigator.language,m.some(function(a){if(0===a.lang.indexOf(q)){l.lang=
a.lang;l.voice=a;if(0===k||void 0===k)return!0;k--}}),c&&(l.onend=function(){g.splice(t,1);c();l.onend=void 0},setTimeout(function(){l.onend&&!window.speechSynthesis.speaking&&(h.display_message("Browser did not begin speaking after waiting 20 seconds. Continuing as if speech occurred."),l.onend())},2E4)),window.speechSynthesis.speak(l))};h.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"+a+"decodeURIComponent</span>")};h.remove_encoded_HTML=
function(a){return J(a,function(){return""})};h.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};h.default_animation_speed=.5;h.animate_to_absolute_position=function(a,b,c,d,e,f){var g=$(a).offset(),k=$(a).position(),l=h.distance(b,g);0===f||0===d?(h.set_absolute_position(a,b),c&&c()):($(a).css({"z-index":h.next_z_index()}),f||(f=Math.round(l/(d||h.default_animation_speed))),$(a).addClass("toontalk-side-animating"),
a.style.transitionDuration=f+"ms",l=k.left+(b.left-g.left),g=k.top+(b.top-g.top),a.style.left=l+"px",a.style.top=g+"px",a.toontalk_followed_by&&(b.left+=a.toontalk_followed_by.left_offset,b.top+=a.toontalk_followed_by.top_offset,h.animate_to_absolute_position(a.toontalk_followed_by.element,b,void 0,d,e)),document.hidden&&(f=0),e?setTimeout(c,f):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";c&&c()},f))};h.distance=function(a,b){var c=a.left-b.left,
d=a.top-b.top;return Math.sqrt(c*c+d*d)};h.highlight_element=function(a,b,c){var d;if(a){h.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=h.widget_side_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){h.remove_highlight(a)},c))}};h.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};
h.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};h.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};h.constrain_css_to_fit_inside=function(a,b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=h.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,
0),d):(c=h.extract_percentage_from_string(b.top),"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};h.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(b){}};h.next_z_index=function(){d++;return d};h.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b+" toontalk-button");a.get(0).addEventListener("click",d);h.give_tooltip(a.get(0),c);return a.get(0)};h.create_close_button=
function(a,b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button toontalk-button");c.addEventListener("click",a);h.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};h.check_radio_button=function(a){var b=$(a.button).closest(".ui-buttonset");0<b.length&&b.find(".ui-state-active").removeClass("ui-state-active").prop("checked",!1);$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};h.create_alert_element=function(a){a=
h.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};h.create_text_element=function(a){var b=document.createElement("div");b.innerHTML=a;$(b).addClass("ui-widget");return b};h.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};h.create_anchor_element=function(a,c){var d=document.createElement("a");d.innerHTML=a;b.TRANSLATION_ENABLED&&(c=h.add_URL_parameter(c,"translate","1"));d.href=c;d.target="_blank";return d};
h.create_text_input=function(a,b,c,d,e,f,g){var k=document.createElement("input"),l;k.type="text";k.className=b;k.value=a;h.give_tooltip(k,d);f&&(k.type=f);c?(a=document.createElement("label"),a.innerHTML=c,k.id=h.generate_unique_id(),a.htmlFor=k.id,e&&(l=h.create_anchor_element("i",e),$(l).addClass("toontalk-help-button toontalk-button notranslate"),l.translate=!1),c=h.create_horizontal_table(a,k,l),$(a).addClass("ui-widget")):c=k;$(k).button().addClass("toontalk-text-input").css({"background-color":"white"});
k.addEventListener("touchstart",function(){$(k).select()});g&&y(k,g);h.use_custom_tooltip(k);return{container:c,button:k}};h.create_text_area=function(a,b,c,d,e,f,g){var k=document.createElement("textarea");k.className=b;k.value=a;h.give_tooltip(k,d);a=document.createElement("label");a.innerHTML=c;k.id=h.generate_unique_id();a.htmlFor=k.id;c=g?h.create_vertical_table(a,k):h.create_horizontal_table(a,k);$(k).button().addClass("toontalk-text-area").css({background:"white"});k.addEventListener("touchstart",
function(){$(k).select()});e&&y(k,e);$(a).addClass("ui-widget");h.use_custom_tooltip(k);return{container:c,button:k}};h.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();if(c=e(a)){if(c.is_backside())return;if(d=b(c,a))$(a.currentTarget).trigger("change"),a.currentTarget.value=d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};h.create_radio_button=function(a,b,c,d,e,f){var g=document.createElement("div"),k=document.createElement("input"),l=document.createElement("label");
k.type="radio";g.className=c+" toontalk-button";k.name=a;k.value=b;l.innerHTML=d;k.id=h.generate_unique_id();l.htmlFor=k.id;g.appendChild(k);g.appendChild(l);h.give_tooltip(g,e);f||$(k).button();h.use_custom_tooltip(k);return{container:g,button:k,label:l}};h.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),k=document.createElement("select"),l=document.createElement("label");k.className=c;k.name=a;k.id=h.generate_unique_id();l.innerHTML=d;l.htmlFor=k.id;g.appendChild(l);
g.appendChild(k);h.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&h.give_tooltip(c,f[b]);k.appendChild(c)});$(k).selectmenu({width:"50%",open:function(){$(".ui-selectmenu-open").css({"z-index":9999999});setTimeout(function(){$(".ui-selectmenu-open").find(".ui-menu-item").each(function(a,c){var d;f&&(d=b.indexOf(c.textContent),0<=d&&f[d]&&h.give_tooltip(c,f[d]))})})}});$(l).addClass("ui-widget");h.use_custom_tooltip(k);return{container:g,
menu:k,label:l}};h.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b+" toontalk-button";f.checked=a;g.innerHTML=c;f.id=h.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);h.give_tooltip(e,d);h.use_custom_tooltip(f);return{container:e,button:f,label:g}};h.create_horizontal_table=function(){var a=document.createElement("table"),b,c,d;
c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),d.appendChild(arguments[b]));return a};h.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=h.create_row(arguments[b]),a.appendChild(c));return a};h.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)arguments[c]&&a.appendChild(arguments[c]);
b.appendChild(a);return a};h.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};h.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if($(arguments[a].label).is(".ui-state-focus"))return arguments[a]};h.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+a},c.addEventListener("error",
d));return c};h.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);b.forEach(function(a){c.appendChild(a)});
$(c).tabs();return c};h.add_iframe_popup=function(a){var b=document.createElement("iframe"),c=document.createElement("div");$(c).addClass("toontalk-close-popup-frame-button").button();c.addEventListener("click",function(a){$(b).remove();$(c).remove();a.stopPropagation()});c.innerHTML="Return to ToonTalk";$(b).addClass("toontalk-popup-frame");b.src=a;document.body.appendChild(c);document.body.appendChild(b)};h.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');
a&&b.addClass(a);return b.get(0)};h.become_file_data_table=function(a,c,d,e){$(a).DataTable({data:c,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,c,f,g){a=d?a.substring(0,a.length-5):a;c=d?b.google_drive.google_drive_url(f.id):"Click to load this program.";if(e)return"<div class='"+e+"' title='"+c+"'id='"+f.id+"'>"+a+"</div>";b.TRANSLATION_ENABLED&&(c=h.add_URL_parameter(c,"translate","1"));return"<a href='"+c+"'target='_blank' title='Click to open published page.'>"+
a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};h.get_local_files_data=function(a){h.get_all_locally_stored_program_names(function(b){var c=[],d=function(e){var f=b[e];h.get_local_storage_meta_data(f,function(g){g&&c.push({title:f,modifiedDate:g.last_modified,createdDate:g.created,
fileSize:g.file_size});e<b.length?d(e+1):a(c)})};d(0)})};h.create_local_files_table=function(a){h.get_local_files_data(function(b){var c=h.create_file_data_table();h.when_attached(c,function(){h.become_file_data_table(c,b,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});a(c)})};h.get_$dragee=function(){return H};h.get_dragee=function(){return H&&b.UTILITIES.widget_side_of_jquery(H)};h.get_resource_copy=function(){return ca};h.get_dragee_copy=function(){if(U)return U;
var a=h.get_dragee();if(a&&!a.is_backside()&&(a.get_infinite_stack()||H.is(".toontalk-top-level-resource")))return U||(H.is(".toontalk-top-level-resource")?(U=a,ca=a.copy({fresh_copy:!0})):U=a.add_copy_to_container(void 0,-1E3,-1E3)),U};h.add_URL_parameter=function(a,b,c){a=h.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?"&":"?";return a+d+b+"="+c};h.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);
a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};h.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};h.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};
h.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};h.each_top_level_widget=function(a){$(".toontalk-backside-of-top-level").each(function(b,c){a(h.widget_side_of_element(c).get_widget())})};h.backup_all_top_level_widgets=function(a){h.each_top_level_widget(function(b){b.save(a)})};h.make_resizable=function(a,b){var c,d;a.resizable({start:function(a,b){c=b.originalSize.width;d=b.originalSize.height},
resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},handles:"n,e,s,w"})};h.match=function(a,b){var c;if(void 0===a)return"matched";b=b.dereference();c=a.match(b);return c.is_widget&&b.matched_by?b.matched_by(a):
c};h.current_URL=function(){return window.location.pathname};h.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};h.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&h.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};h.copy_frontside_dimensions=function(a,b){var c=a.get_widget().get_frontside_element(),d;c&&(d=b.get_frontside_element(!0))&&h.set_css(d,{width:$(c).width(),height:$(c).height()})};
h.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?h.scale_element(a,c,d,c,d):h.scale_element(a,$(b).width(),$(b).height(),c,d)};h.scale_element=function(a,c,d,e,f,g,k,l,m){var p,q;$(a).is(".toontalk-not-observable")&&(p=b.UTILITIES.widget_side_of_element(a))&&p.render();e||(q=$(a).children("img"),e=q.is("*")?q.width():$(a).width());f||(q||(q=$(a).children("img")),f=q.is("*")?q.height():$(a).height());p=c&&0!==e?c/e:a.toontalk_x_scale||1;q=d&&0!==f?d/f:a.toontalk_y_scale||1;0===
p&&(p=1);0===q&&(q=1);a.toontalk_x_scale=p;a.toontalk_y_scale=q;l=(l=l&&l!==document.body?l:a.parentElement)&&0>l.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var r="";k||(k={});"number"===typeof k.left&&(k.left-=(e-c)/2,m=!0);"number"===typeof k.top&&(k.top-=(f-d)/2,m=!0);!m&&l?(c&&(a.toontalk_translate_x=(c-e)/2,r+="translateX("+a.toontalk_translate_x+"px) "),d&&(a.toontalk_translate_y=(d-f)/2,r+="translateY("+a.toontalk_translate_y+"px) ")):(a.toontalk_translate_x=
void 0,a.toontalk_translate_y=void 0);h.add_transform_to_css((g||"")+" scale("+p+", "+q+")",r,k,l);k.width=e;k.height=f;h.set_css(a,k);return{x_scale:p,y_scale:q}};h.translate_x=function(a){return p("toontalk_translate_x","toontalk_x_scale")};h.translate_y=function(a){return p("toontalk_translate_y","toontalk_y_scale")};h.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),h.set_css_transform(c,b+a))};h.set_css_transform=
function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};h.run_when_dimensions_known=function(a,b,c){var d=a.parentElement,e=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")},f;!c&&$(a).width()&&e(d)?setTimeout(function(){b(d)}):(f=function(c){setTimeout(function(){var g=$(a).width(),k=$(a).height();g&&k?e(a.parentElement)?(b(d),d?d.appendChild(a):a.parentElement===document.body&&$(a).remove(),$(a).removeClass("toontalk-not-observable")):
h.run_when_dimensions_known(a,b,!0):setTimeout(function(){h.widget_side_of_element(a);1E4>c&&f(2*c)},c)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),c&&h.set_css(a,{width:"",height:"",transform:""}),f(1))};h.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&h.run_when_dimensions_known(d,function(){var a=$(d).children("img");a.is("*")?b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};h.relative_position=function(a,
b){var c,d;if(!h.is_attached(a))return{left:0,top:0};c=$(a).offset();b&&(d=$(b).offset(),c.left-=d.left,c.top-=d.top);return c};h.add_animation_class=function(a,b){h.set_css(a,{width:"",height:""});$(a).addClass(b)};h.widget_side_of_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget_side};h.widget_side_of_element=function(a){return a.toontalk_widget_side};h.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||
a.css("o-animation"))&&0!==a.indexOf("none")};h.display_message=function(a,c){var d=h.create_alert_element(a),e=function(){$(d).remove()},f;c||(c={});if(c.only_if_new)if(0>Q.indexOf(a))Q.push(a);else return;$(".toontalk-alert-element").remove();b.debugging&&(console.log(c.plain_text||a),console.trace());if(c.element||c.second_choice_element)f=$(c.element).closest(".toontalk-backside"),0===f.length&&(f=$(c.second_choice_element).closest(".toontalk-backside")),0<f.length&&($(d).addClass("toontalk-local-alert"),
f.append(d));c.element&&0!==f.length||document.body.insertBefore(d,document.body.firstChild);b.speak&&(window.speechSynthesis.cancel(),h.speak(c.plain_text||d.textContent));d.addEventListener("click",e);c.duration||(0<=a.indexOf("<")?c.duration=5E3:c.duration=Math.max(2E3,a.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)));setTimeout(e,c.duration)};h.display_tooltip=function(a){h.use_custom_tooltip(a.get(0));a.tooltip("open")};h.report_internal_error=function(a){console.error(a);console.trace();
b.debugging&&h.display_message("Error: "+a)};h.get_current_url_boolean_parameter=function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};h.get_current_url_numeric_parameter=function(a,b){var c=h.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};h.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",
c);0>d&&(d=window.location.href.length);return window.location.href.substring(c,d)};h.get_path_to_toontalk_folder=function(){return b.TOONTALK_URL};h.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};f=h.is_browser_of_type("MSIE")||h.is_browser_of_type("Trident");h.is_internet_explorer=function(){return f};h.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};h.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};h.remove_z_index=
function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$(a);a.attr("z-index","");return a.html()};h.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b=!1,c=function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),d.innerHTML="Run all tests",h.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),d.innerHTML=
"Stop all tests");b=!b},d;0!==a.length&&(a.button(),d=a.get(0),d.innerHTML="Run all tests",a.get(0).addEventListener("click",c))};h.set_timeout=function(a,b){b||h.is_internet_explorer()?setTimeout(a,b):(O.push(a),window.postMessage("zero-timeout-message","*"))};h.get_first_property=function(a){return Object.keys(a)[0]};h.get_all_locally_stored_program_names=function(a){h.retrieve_object("toontalk-all-program-names",function(b){if(b)a(b);else return a([])})};h.set_all_locally_stored_program_names=
function(a){h.store_object("toontalk-all-program-names",a,function(){})};h.get_local_storage_meta_data=function(a,b){var c=h.local_storage_program_meta_data_key(a);try{h.retrieve_object(c,b)}catch(d){b()}};h.local_storage_program_key=function(a){return"toontalk-json: "+a};h.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};b.CHROME_APP?(h.store_object=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);e[a]=JSON.stringify(c,
h.clean_json);chrome.storage.local.set(e,d);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by set "+a)},h.store_string=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a);e[a]=c;chrome.storage.local.set(e,d);b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a)},h.retrieve_object=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&
0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+a);c(d[a]&&JSON.parse(d[a]))})},h.retrieve_string=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved string "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+
a);c(d&&d[a])})}):(h.store_object=function(a,c,d){b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);window.localStorage.setItem(a,JSON.stringify(c,h.clean_json));d&&d()},h.store_string=function(a,b,c){window.localStorage.setItem(a,b);c&&c();chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by setItem "+a)},h.retrieve_object=function(a,c){var d=window.localStorage.getItem(a);b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+
(d&&d.substring(0,100))+"... with key "+a);c(d&&JSON.parse(d))},h.retrieve_string=function(a,c){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved string "+(window.localStorage.getItem(a)&&window.localStorage.getItem(a).substring(0,100))+"... with key "+a);c(window.localStorage.getItem(a))});h.enable_editor=function(a,b,c,d){(function(a,b){var c=function(a){a.data.editor_enabled_for&&a.data.editor_enabled_for===b&&(e=!0,window.removeEventListener("message",c))},d=function(a,b){e||
setTimeout(function(){a();d(a,b)},500)},e=!1;window.addEventListener("message",c);d(a,b)})(function(){a.postMessage({save_edits_to:window.location.href,file_id:c,widgets_json:d},"*")},c)};h.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};h.enable_touch_events=function(a,c){var d=a,e=function(e){var q;e.preventDefault();m&&(e.stopPropagation(),q=e.changedTouches[0],p&&(p.being_dragged=!1),$(a).removeClass("toontalk-being-dragged"),m+c>=Date.now()?(e=document.createEvent("MouseEvent"),
e.initMouseEvent("click",!0,!0,window,1,q.screenX,q.screenY,q.clientX,q.clientY,!1,!1,!1,!1,0,null),q.target.dispatchEvent(e),p&&p.location_constrained_by_container()?$(a).css({left:"",top:""}):h.set_absolute_position(a,{left:k.left,top:k.top}),b.logging&&0===b.logging.indexOf("touch")&&l("touch end treated as click "+a.id,!0)):(u(e,a),b.logging&&0===b.logging.indexOf("touch")&&l("drag ended "+a.id),B(e,a),b.logging&&0===b.logging.indexOf("touch")&&l("drop happened "+a.id),b.logging&&0===b.logging.indexOf("touch")&&
l("",!0),h.set_absolute_position(a,{left:q.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:q.pageY-g-b.USABILITY_DRAG_OFFSET.y})),m=void 0,a=d)},f=0,g=0,k,m,p,r;a.addEventListener("touchstart",function(c){var d=c.changedTouches[0],e,v,r;k=$(a).offset();0===b.USABILITY_DRAG_OFFSET.y&&(b.USABILITY_DRAG_OFFSET.y=25);b.logging&&0===b.logging.indexOf("touch")&&l("touch start "+a.id);c.preventDefault();if("TEXTAREA"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||$(c.srcElement).is(".ui-resizable-handle"))b.logging&&
0===b.logging.indexOf("touch")&&l("touch start ignored due to tag name or class "+a.id);else if((e=h.find_widget_side_on_page(c.changedTouches[0],void 0,0,0))&&e.is_of_type("empty hole")&&(e=e.get_parent_of_frontside()),e&&e.get_frontside_element()!==a)b.logging&&0===b.logging.indexOf("touch")&&l("touch start ignored since has child who is really touched: "+h.widget_side_of_element(a));else{m=Date.now();b.logging&&0===b.logging.indexOf("touch")&&l("touch start of "+a.id+" at "+m);c.stopPropagation();
if(p=h.widget_side_of_element(a))p.being_dragged=!0;p&&p.get_infinite_stack()?(v=p.copy(),p.set_infinite_stack(!1),v.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(v=p.copy(),p.add_copy_to_container(v,0,0),r=$(a).offset(),a=v.get_frontside_element(!0));v&&(p.add_copy_to_container(v,0,0),p.robot_in_training()&&p.robot_in_training().copied(p,v,!1));$(a).css({"z-index":99999999});r||(r=$(a).offset());q(c,a);f=d.pageX-r.left;g=d.pageY-r.top;b.logging&&0===b.logging.indexOf("touch")&&
l("drag started "+a.id)}},!0);a.addEventListener("touchmove",function(c){var d=c.changedTouches[0];if(m){c.preventDefault();h.set_absolute_position(a,{left:d.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:d.pageY-g-b.USABILITY_DRAG_OFFSET.y});c=h.find_widget_side_on_page(d,a,b.USABILITY_DRAG_OFFSET.x,b.USABILITY_DRAG_OFFSET.y);if(r&&r!==c){var e=r.get_frontside_element();h.remove_highlight(e);r=void 0}c&&(G(d,c.get_element()),r=c);b.logging&&0===b.logging.indexOf("touch")&&l("dragged to "+(d.pageX-f)+", "+
(d.pageY-g)+" "+a.id)}},!0);a.addEventListener("touchend",e,!0);a.addEventListener("touchcancel",e,!0)};h.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};h.find_widget_side_on_page=function(a,b,c,d){var e=h.get_mouse_or_first_touch_event_attribute("pageX",a);a=h.get_mouse_or_first_touch_event_attribute("pageY",a);var f;b&&$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for(b&&$(b).show();c&&!c.toontalk_widget_side&&
!$(c).is(".toontalk-backside")&&!$(c).is(".toontalk-button")&&!$(c).is(".ui-button");)c=c.parentNode;c&&(f=c.toontalk_widget_side);if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),f};h.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-backside-of-top-level").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return h.widget_side_of_element(c)};h.set_css=function(a,b){var c,d;if(b){if(c=
h.widget_side_of_element(a))d=c.dereference(),$(a).is(".toontalk-temporarily-set-down")||(c.location_constrained_by_container()?(b.left="",b.top=""):d.is_plain_text_element()&&(b.width="",b.height=""));0===b.width&&(b.width="");0===b.height&&(b.height="");!b.transform&&"number"===typeof b.width&&"number"===typeof b.height&&d&&d.use_scaling_transform?d.use_scaling_transform(b):$(a).css(b)}};h.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};h.conjunction=function(a,
b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?h.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};h.insert_function_bird_documentation=function(a,b){var c=TOONTALK[a]["function"],d=Object.keys(c),e="<table class='toontalk-function-bird-documentation-table'>";d.forEach(function(a,b){e+="<tr><td><div id='bird_id_"+b+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+
c[a].title+"</td></tr>"});e+="</table>";$(b).html(e);d.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e&&(e.id=encodeURIComponent(b))})};h.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=h.widget_side_of_element(b);c&&c.update_display(!0)})};h.visible_element=function(a){return a&&null!==a.offsetParent};h.get_audio_volume=
function(a){var c=document.hidden?0:b.volume;0===c&&k.push({audio_object:a,volume:a.volume});return c};h.play_audio=function(a){a.play();m.push(a);a.addEventListener("ended",function(){var b=m.indexOf(a);0<=b&&m.splice(b,1)})};h.mute_audio_objects_playing=function(){m.forEach(function(a){k.push({audio_object:a,volume:a.volume});a.volume=0});m=[]};h.stop_audio_objects=function(){m.forEach(function(a){a.pause();a.currentTime=0})};h.restore_audio_volumes=function(){k.forEach(function(a){a.audio_object.volume=
a.volume;m.push(a.audio_object)});k=[]};h.is_attached=function(a){return jQuery.contains(window.document,a)};h.when_attached=function(a,b,c){var d=a.toontalk_attached_callback;jQuery.contains(window.document,a)&&!c?b():(a.toontalk_attached_callback=function(){d&&d();b();$(a).removeClass("toontalk-has-attached-callback");a.toontalk_attached_callback=void 0},c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};h.create_event=function(a,b){var c;try{c=new CustomEvent(a,
{detail:b})}catch(d){c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!1,!1,b)}return c};h.create_queue=function(){var a=[],c=0;return{getLength:function(){return a.length-c},isEmpty:function(){return 0==a.length},enqueue:function(c){var d=0==a.length;a.push(c);b.logging&&0<=b.logging.indexOf("queue")&&console.log(c._debug_string+" enqueued");return d},dequeue:function(){var d;if(0!=a.length)return d=a[c],b.logging&&0<=b.logging.indexOf("queue")&&console.log(d._debug_string+" dequeued"),
2*++c>=a.length&&(a=a.slice(c),c=0),d},peek:function(){return 0<a.length?a[c]:void 0},does_any_item_satisfy:function(b){var d;for(d=c;d<a.length;d++)if(b(a[d]))return!0;return!1}}};h.number_to_words=function(a){var b=a.indexOf("/"),c=function(a){var b="  half third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth seventeenth eighteenth nineteenth twentieth".split(" ");if(20>=a)return b[a];if(0===a%10&&100>a)return"thirtieth fortieth fiftieth sixtieth seventieth eightieth ninetieth".split(" ")[a/
10-3];if(100===a)return"hundredth";if(1E3===a)return"thousandth";if(1E4===a)return"ten thousandth";if(1E5===a)return"hundred thousandth";if(1E6===a)return"millionth";if(1E7===a)return"ten millionth";if(1E8===a)return"hundred millionth";if(1E9===a)return"billionth"},d,e;if(0>b)return h.integer_to_words(a);d=a.substring(0,b);e="1"!==d&&"-1"!==d;return b+3>=a.length||!e&&b+11>=a.length?(c=c(parseInt(a.substring(b+1))))?h.integer_to_words(d)+" "+c+(e?"s":""):h.integer_to_words(d)+" over "+h.integer_to_words(a.substring(b+
1)):h.integer_to_words(a.substring(0,b))+" over "+h.integer_to_words(a.substring(b+1))};h.integer_to_words=function(a){var b="",c=" un duo tre quattuor quin se septe octo nove".split(" "),d="   *   sx mn  mx".split(" "),e=" deci viginti triginta quadraginta quinquaginta sexaginta septuaginta octoginta nonaginta".split(" "),f=" n ms ns ns ns n n mx m".split(" "),g=" centi ducenti trecenti quadringenti quingenti sescenti septingenti octingenti nongenti".split(" "),h=" nx n ns ns ns n n mx m".split(" "),
k=" milli dumilli tremilli quadrinmilli quinmilli sesmilli septinmilli octinmilli nonmilli".split(" "),l=" decimilli vigintimilli trigintamilli quadragintanmilli quinquagintamilli sexagintamilli septuagintamilli octogintamilli nonagintamilli".split(" "),m=" centimilli ducentimilli trecentimilli quadringentimilli quingentimilli sescentimilli septingentimilli octingentimilli nongentimilli".split(" "),p=" milli-milli milli-dumilli milli-tremilli milli-quadrinmilli milli-quinmilli milli-sesmilli milli-septinmilli milli-octinmilli milli-nonmilli".split(" "),
q="thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion".split(" "),r,t,u,w,y,z,A,B,D,E,F,G,H=function(c){var d=0,e="",f;for(f=0;f<c;f++)if("0"!==a[f]||0<d)e+=a[f],d++;if(e){c=b;e=parseInt(e);f=" one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen twenty".split(" ");var g=" ten twenty thirty forty fifty sixty seventy eighty ninety".split(" "),h="";100<=e&&(h+=f[Math.floor(e/100)]+
" hundred",e%=100,0<e&&10>e&&(h+=" and"));20<e?(""!=h&&(h+=" "),h+=g[Math.floor(e/10)],e%=10,0<e&&(h+="-")):""!=h&&0<e&&(h+=" ");0<e&&(h+=f[e]);b=c+h.toString()}return d},I=function(a,b){var c,d;if(void 0!==a&&void 0!==b)for(c=0;c<a.length;c++)for(d=0;d<b.length;d++)if(a[c]==b[d]||"*"===a[c]&&("s"===b[d]||"x"===b[d]))return b[d]};"-"===a[0]&&(b+="negative ",a=a.substring(1));for(;0<a.length&&"0"===a[0];)a=a.substring(1);if(0===a.length)return"zero";for(r=a.length;;){" "!==b[b.length-1]&&(b+=" ");
if(4>r){0===H(r)&&","===b.substring(b.length-1)&&(b=b.substring(0,b.length-1));break}t=r-4;u=1+t%3;w=H(u);a=a.substring(u);r-=u;0<w&&(" "!==b[b.length-1]&&(b+=" "),y=Math.floor(t/3),u=y%10,10>y?b+=q[y]:(w=Math.floor(y/10%10),t=Math.floor(y/100%10),A=Math.floor(y/1E3%10),B=Math.floor(y/1E4%10),D=Math.floor(y/1E5%10),E=Math.floor(y/1E6%10),F=c[u],y=e[w],G=g[t],A=k[A],B=l[B],D=m[D],E=p[E],z=void 0,F&&(b+=F,z=d[u]),y&&((u=I(z,f[w]))&&(b+=u),z=void 0,b+=y),G&&((u=I(z,h[t]))&&(b+=u),z=void 0,b+=G),b+=A,
b+=B,b+=D,b+=E,"a"===b[b.length-1]&&(b=b.substring(0,b.length-2)+"i"),b+="llion"),b+=",")}b=b.trim();c=b.lastIndexOf(", ");if(0<=c)return b.substring(0,c)+" and"+b.substring(c+1);","===b[b.length-1]&&(b=b.substring(0,b.length-1));return b};h.test_number_to_words=function(a){var b,c;for(b=0;b<a;b++)c=Math.round(1E9*Math.random()),console.log(c+" = "+h.number_to_words(c.toString()))};h.for_each_batch=function(a,b,c,d){var e;if(0!==a.length){void 0===d&&(d=0);c||(c=100);for(e=Math.min(a.length,d+c);d<
e;d++)b(a[d],d);e<a.length&&h.set_timeout(function(){h.for_each_batch(a,b,c,e)})}};h.random_location_inside=function(a,b){var c=a.getBoundingClientRect();return{left:Math.random()*(c.width-b),top:Math.random()*(c.height-b)}};h.element_width=function(a){var b=$(a);if(b.is(".toontalk-conditions-contents"))return 240;if(!b.is(".toontalk-not-observable"))return a.getBoundingClientRect().width};h.element_height=function(a){var b=$(a);if(b.is(".toontalk-conditions-contents"))return 60;if(!b.is(".toontalk-not-observable"))return a.getBoundingClientRect().height};
h.resizable_and_scalable=function(a,b){var c=1,d=1,e;$(a).resizable({start:function(a,b){e={width:b.size.width,height:b.size.height}},resize:function(f,g){var h={width:g.size.width,height:g.size.height};$(a).is(".toontalk-backside-of-top-level")||(c*=h.width/e.width,d*=h.height/e.height,b(c,d),e=h)},handles:"n,e,s,w,se,ne,sw,nw"})};h.listen_for_speech=function(a){var c,d,e,f,g,k,l,m;b.listen&&(c=a.commands||"",d=a.minimum_confidence||0,e=e||webkitSpeechGrammarList,window.speechSynthesis.speaking?
setTimeout(function(){h.listen_for_speech(a)},1E3):(a.descriptions_acceptable&&(c+=" | I am | I'm "),a.names_acceptable&&(c+=" | My name is | call me "),f="#JSGF V1.0; grammar commands; public <commands> = "+c+";",e=new e,g=function(){try{R.start()}catch(a){}},w=!0,R="undefined"===typeof SpeechRecognition?new webkitSpeechRecognition:new SpeechRecognition,e.addFromString(f,1),R.grammars=e,R.continuous=!1,R.lang="en-US",R.interimResults=!1,R.maxAlternatives=5,R.onresult=function(b){var e;for(m=0;m<
b.results[0].length;m++)if(b.results[0][m].confidence>=d&&(e=b.results[0][m].transcript.toLowerCase(),!c||0<=c.indexOf(e+" |")||0<=c.indexOf("| "+e)||a.numbers_acceptable&&!isNaN(parseFloat(e))||a.descriptions_acceptable&&(0===e.indexOf("i am")||0===e.indexOf("i'm"))||a.names_acceptable&&(0===e.indexOf("my name is")||0===e.indexOf("call me")))){k=b.results[0][m].transcript.toLowerCase();l=b.results[0][m].confidence;break}window.speechSynthesis.speaking?console.log("Ignoring speech since synthesising speech. "+
(k||"")):k?(console.log(k+" confidence : "+l),a.descriptions_acceptable&&a.widget&&h.spoken_command_is_a_description(k,a.widget)?a.widget.rerender():a.names_acceptable&&a.widget&&h.spoken_command_is_a_naming(k,a.widget)?a.widget.rerender():a.success_callback&&a.success_callback(k,b)):console.log("confidence too low");R.stop()},R.onend=function(){w&&g()},R.onnomatch=function(b){a.fail_callback&&a.fail_callback(b)},R.onerror=function(b){"no-speech"===b.error&&a.fail_callback&&a.fail_callback(b)},w&&
g()))};h.stop_listening_for_speech=function(){R.stop();w=!1};h.spoken_command_is_a_description=function(a,b){var c;0===a.indexOf("i am")?c=a.substring(5):0===a.indexOf("i'm")&&(c=a.substring(4));if(c)return(h.get_dragee_copy()||b).set_description(c,!0,!0),h.display_message("The description of the "+b.get_type_name()+' is now "'+c+'"'),!0};h.spoken_command_is_a_naming=function(a,b){var c;if(b.get_name&&(0===a.indexOf("my name is ")?c=a.substring(11):0===a.indexOf("call me ")&&(c=a.substring(8)),c))return(h.get_dragee_copy()||
b).set_name(c,!0,!0),h.display_message("The name of the "+b.get_type_name()+' is now "'+c+'"'),!0};h.initialize=function(a){a=new MutationObserver(function(a){a.forEach(function(a){(a=$(a.target).closest(".toontalk-translation-element").get(0))&&a.toontalk_callback&&(a.toontalk_callback(a.innerText),a.innerText="",a.toontalk_callback=void 0)})});var d=function(){var a=function(a,c,d,e,f){a=document.getElementById(a);var g;a&&(b.CHROME_APP?(g=function(a){h.add_iframe_popup(c)},g=h.create_button(d,
"toontalk-manual-button",e,g)):(g=document.createElement("a"),g.innerHTML=d,g.href=c,g.title=e,g.target="_blank",$(g).addClass("ui-widget toontalk-help-link"),h.use_custom_tooltip(g)),a.appendChild(g),$(g).css(f))};a("toontalk-manual-button","docs/manual/index.html?reset=1","Learn about ToonTalk","Click to visit the page that introduces everything.",{background:"yellow"});a("toontalk-manual-tour","docs/tours/tour1.html?reset=1","Watch a tour of ToonTalk","Click to visit a page that replays a tour.",
{background:"pink"});a("toontalk-manual-whats-new","docs/manual/whats-new.html?reset=1","What's new?","Click to visit see what has changed recently.",{background:"cyan"})},e=function(a){try{window.speechSynthesis.cancel()}catch(c){}try{h.backup_all_top_level_widgets(!0)}catch(c){b.UTILITIES.report_internal_error(c)}},f,g;c||(f=function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget_side;c&&c.set_running&&c.set_running(!1)})},b.debugging=h.get_current_url_parameter("debugging"),
b.logging=h.get_current_url_parameter("log"),b.volume=h.get_current_url_numeric_parameter("volume",10)/100,0<b.volume&&I(),b.puzzle=h.get_current_url_boolean_parameter("puzzle",!1),b.open_backside_only_if_alt_key=h.get_current_url_boolean_parameter("alt_key_to_open_backside",b.puzzle),b.reset=h.get_current_url_boolean_parameter("reset",b.puzzle),b.speak=h.get_current_url_boolean_parameter("speak",!1),b.listen=h.get_current_url_boolean_parameter("listen",!1),b.speak&&!window.speechSynthesis&&(b.speak=
!1,h.display_message("This browser doesn't support speech output. speak=1 in URL ignored.")),b.balloons=h.get_current_url_boolean_parameter("balloons",!0),h.process_json_elements(),window.document.addEventListener("click",f),b.DEFAULT_QUEUE=window.TOONTALK.queue.create(),b.DEFAULT_QUEUE.start(),b.CHROME_APP?chrome.runtime.onSuspend.addListener(e):window.addEventListener("beforeunload",e),b.TRANSLATION_ENABLED=h.get_current_url_boolean_parameter("translate",!1),b.TRANSLATION_ENABLED?($("a").each(function(a,
b){b.href=h.add_URL_parameter(b.href,"translate","1")}),$("#google_translate_element").is("*")||(e=document.createElement("div"),e.id="google_translate_element",document.body.insertBefore(e,document.body.firstChild)),document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]),S("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"),g=document.createElement("div"),g.className="toontalk-translation-element",
document.body.appendChild(g),a.observe(g,{characterData:!0,subtree:!0}),h.translate=function(a,b){g.innerHTML=a;g.toontalk_callback=b}):$("#google_translate_element").remove(),b.vacuum.the_vacuum||b.vacuum.create(),h.add_test_all_button(),d(),E("toontalk-robot",b.robot),E("toontalk-empty-nest",b.nest),E("toontalk-bird-static",b.bird),$("[title]").each(function(a,b){h.use_custom_tooltip(b)}),TOONTALK.RUNNING_LOCALLY||(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e;a[e]=a[e]||function(){(a[e].q=
a[e].q||[]).push(arguments)};a[e].l=1*new Date;f=b.createElement(c);g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,g)}(window,document,"script",b.CHROME_APP?TOONTALK.TOONTALK_URL+"libraries/analytics.js":"https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-57964541-1","auto"),b.CHROME_APP?(ga("set","checkProtocolTask",function(){}),ga("require","displayfeatures"),ga("send","pageview","/options.html")):ga("send","pageview")),document.addEventListener("visibilitychange",
function(){document.hidden?h.mute_audio_objects_playing():(h.rerender_all(),h.restore_audio_volumes())}),setTimeout(function(){b.DISPLAY_UPDATES.update_display()},100),c=!0,document.dispatchEvent(b.UTILITIES.create_event("toontalk_initialized",{})))};h.do_after_initialization=function(a){c?a():document.addEventListener("toontalk_initialized",a)};return h}(window.TOONTALK);window.initialize_toontalk=window.TOONTALK.UTILITIES.initialize;
