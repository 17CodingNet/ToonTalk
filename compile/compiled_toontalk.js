var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(b,h,f){if(null==b)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return b+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,h,f){b!=Array.prototype&&b!=Object.prototype&&(b[h]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,h,f,g){if(h){f=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var e=b[g];e in f||(f[e]={});f=f[e]}b=b[b.length-1];g=f[b];h=h(g);h!=g&&null!=h&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("String.prototype.repeat",function(b){return b?b:function(b){var f=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var g="";b;)if(b&1&&(g+=f),b>>>=1)f+=f;return g}},"es6","es3");$jscomp.findInternal=function(b,h,f){b instanceof String&&(b=String(b));for(var g=b.length,e=0;e<g;e++){var a=b[e];if(h.call(f,a,e,b))return{i:e,v:a}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,f){return $jscomp.findInternal(this,b,f).v}},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var h=0;return $jscomp.iteratorPrototype(function(){return h<b.length?{done:!1,value:b[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,h){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var f=0,g={next:function(){if(f<b.length){var e=f++;return{value:h(e,b[e]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.polyfill("Object.is",function(b){return b?b:function(b,f){return b===f?0!==b||1/b===1/f:b!==b&&f!==f}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(b,f){var g=this;g instanceof String&&(g=String(g));var e=g.length;for(f=f||0;f<e;f++)if(g[f]==b||Object.is(g[f],b))return!0;return!1}},"es7","es3");
$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(b,f){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,f||0)}},"es6","es3");
(function(b){if("undefined"===typeof exports)if("function"===typeof define&&"object"===typeof define.amd&&define.amd){var h={};define(function(){return h})}else h="undefined"!==typeof window?window:b;else h=exports;(function(b){var f,e,a,c,d,k={greatest_common_divisor:function(a,b){if(1===b||1===a)return 1;for(var c;0!==b;){c=b;b=a%b;if(!isFinite(b))return 0;a=c}return a}};k.gcd=k.greatest_common_divisor;k.fromRandom=function(a){return Math.random()*(1<<a)>>>0};k.fromMillitime=function(){return+new Date};
k.fromUnixtime=function(){return.001*k.fromMillitime()|0};"undefined"!==typeof b&&(b.integer=k);(function(a){function b(a,n,e){if(e!==c)return a instanceof b?a:"undefined"===typeof a?d:b.parse(a);for(a=a||[];a.length&&!a[a.length-1];)--a.length;this._d=a;this._s=a.length?n||1:0}var c={};b._construct=function(a,d){return new b(a,d,c)};b.base=1E7;b.base_log10=7;var d=new b([],0,c);b.ZERO=d;var n=new b([1],1,c);b.ONE=n;var e=new b(n._d,-1,c);b.M_ONE=e;b._0=d;b._1=n;b.small=[d,n,new b([2],1,c),new b([3],
1,c),new b([4],1,c),new b([5],1,c),new b([6],1,c),new b([7],1,c),new b([8],1,c),new b([9],1,c),new b([10],1,c),new b([11],1,c),new b([12],1,c),new b([13],1,c),new b([14],1,c),new b([15],1,c),new b([16],1,c),new b([17],1,c),new b([18],1,c),new b([19],1,c),new b([20],1,c),new b([21],1,c),new b([22],1,c),new b([23],1,c),new b([24],1,c),new b([25],1,c),new b([26],1,c),new b([27],1,c),new b([28],1,c),new b([29],1,c),new b([30],1,c),new b([31],1,c),new b([32],1,c),new b([33],1,c),new b([34],1,c),new b([35],
1,c),new b([36],1,c)];b.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");b.prototype.toString=function(a){a=+a||10;if(2>a||36<a)throw Error("illegal radix "+a+".");if(0===this._s)return"0";if(10===a){a=0>this._s?"-":"";a+=this._d[this._d.length-1].toString();for(var c=this._d.length-2;0<=c;c--){for(var d=this._d[c].toString();7>d.length;)d="0"+d;a+=d}return a}c=b.digits;a=b.small[a];d=this._s;for(var n=this.abs(),e=[],f;0!==n._s;)f=n.divRem(a),n=f[0],f=f[1],e.push(c[f.valueOf()]);return(0>
d?"-":"")+e.reverse().join("")};b.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,
/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];b.parse=function(a,n){function e(b){b=b.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return b.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(b,a,c,d,n){n=+n;var e=0>n,f=c.length+n;b=(e?c:d).length;n=(n=Math.abs(n))>=b?n-b+e:0;b=Array(n+1).join("0");c+=d;return(a||"")+(e?c=b+c:c+=b).substr(0,f+=e?b.length:0)+(f<c.length?"."+c.substr(f):"")})}var f;a=a.toString();if("undefined"===typeof n||10===+n)a=e(a);
if(f=(new RegExp("^([+\\-]?)("+("undefined"===typeof n?"0[xcb]":16==n?"0x":8==n?"0c":2==n?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(a)){a=f[1]||"+";var g=f[2]||"";f=f[3]||"";if("undefined"===typeof n)n="0x"===g||"0X"===g?16:"0c"===g||"0C"===g?8:"0b"===g||"0B"===g?2:10;else if(2>n||36<n)throw Error("Illegal radix "+n+".");n=+n;if(!b.radixRegex[n].test(f))throw Error("Bad digit for radix "+n);f=f.replace(/^0+/,"").split("");if(0===f.length)return d;a="-"===a?-1:1;if(10==n){for(g=[];7<=f.length;)g.push(parseInt(f.splice(f.length-
b.base_log10,b.base_log10).join(""),10));g.push(parseInt(f.join(""),10));return new b(g,a,c)}g=d;n=b.small[n];for(var u=b.small,k=0;k<f.length;k++)g=g.multiply(n).add(u[parseInt(f[k],36)]);return new b(g._d,a,c)}throw Error("Invalid BigInteger format: "+a);};b.prototype.add=function(a){if(0===this._s)return b(a);a=b(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.subtract(a);var d=this._d;a=a._d;for(var n=d.length,e=a.length,f=Array(Math.max(n,e)+1),g=Math.min(n,e),u=0,k=0;k<
g;k++)u=d[k]+a[k]+u,f[k]=u%1E7,u=u/1E7|0;e>n&&(d=a,n=e);for(k=g;u&&k<n;k++)u=d[k]+u,f[k]=u%1E7,u=u/1E7|0;for(u&&(f[k]=u);k<n;k++)f[k]=d[k];return new b(f,this._s,c)};b.prototype.negate=function(){return new b(this._d,-this._s|0,c)};b.prototype.abs=function(){return 0>this._s?this.negate():this};b.prototype.subtract=function(a){if(0===this._s)return b(a).negate();a=b(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.add(a);var n=this;0>this._s&&(n=new b(a._d,1,c),a=new b(this._d,
1,c));var e=n.compareAbs(a);if(0===e)return d;if(0>e){var f=a;a=n;n=f}n=n._d;a=a._d;f=n.length;var g=a.length,k=Array(f),u=0,m;for(m=0;m<g;m++){var l=n[m]-u-a[m];0>l?(l+=1E7,u=1):u=0;k[m]=l}for(m=g;m<f;m++){l=n[m]-u;if(0>l)l+=1E7;else{k[m++]=l;break}k[m]=l}for(;m<f;m++)k[m]=n[m];return new b(k,e,c)};(function(){function a(a,d){a=a._d;for(var n=a.slice(),e=0;;){var f=(a[e]||0)+1;n[e]=f%1E7;if(9999999>=f)break;++e}return new b(n,d,c)}function d(a,d){a=a._d;for(var n=a.slice(),e=0;;){var f=(a[e]||0)-
1;if(0>f)n[e]=f+1E7;else{n[e]=f;break}++e}return new b(n,d,c)}b.prototype.next=function(){switch(this._s){case 0:return n;case -1:return d(this,-1);default:return a(this,1)}};b.prototype.prev=function(){switch(this._s){case 0:return e;case -1:return a(this,-1);default:return d(this,1)}}})();b.prototype.compareAbs=function(a){if(this===a)return 0;if(!(a instanceof b)){if(!isFinite(a))return isNaN(a)?a:-1;a=b(a)}if(0===this._s)return 0!==a._s?-1:0;if(0===a._s)return 1;var c=this._d.length,d=a._d.length;
if(c<d)return-1;if(c>d)return 1;d=this._d;a=a._d;for(--c;0<=c;c--)if(d[c]!==a[c])return d[c]<a[c]?-1:1;return 0};b.prototype.compare=function(a){if(this===a)return 0;a=b(a);return 0===this._s?-a._s:this._s===a._s?this.compareAbs(a)*this._s:this._s};b.prototype.isUnit=function(){return this===n||this===e||1===this._d.length&&1===this._d[0]};b.prototype.multiply=function(a){if(0===this._s)return d;a=b(a);if(0===a._s)return d;if(this.isUnit())return 0>this._s?a.negate():a;if(a.isUnit())return 0>a._s?
this.negate():this;if(this===a)return this.square();var n=this._d.length>=a._d.length,e=(n?this:a)._d;n=(n?a:this)._d;var f=e.length,g=n.length,k=f+g,u=Array(k),m;for(m=0;m<k;m++)u[m]=0;for(m=0;m<g;m++){k=0;for(var l=n[m],t=f+m,r,h=m;h<t;h++)r=u[h]+l*e[h-m]+k,k=r/1E7|0,u[h]=r%1E7|0;k&&(r=u[h]+k,u[h]=r%1E7)}return new b(u,this._s*a._s,c)};b.prototype.multiplySingleDigit=function(a){if(0===a||0===this._s)return d;if(1===a)return this;var n;if(1===this._d.length)return n=this._d[0]*a,1E7<=n?new b([n%
1E7|0,n/1E7|0],1,c):new b([n],1,c);if(2===a)return this.add(this);if(this.isUnit())return new b([a],1,c);var e=this._d,f=e.length;n=f+1;for(var g=Array(n),k=0;k<n;k++)g[k]=0;for(var u=k=0;u<f;u++)n=a*e[u]+k,k=n/1E7|0,g[u]=n%1E7|0;k&&(g[u]=k);return new b(g,1,c)};b.prototype.square=function(){if(0===this._s)return d;if(this.isUnit())return n;var a=this._d,e=a.length,f=Array(e+e+1),g;for(g=0;g<e;g++){var k=2*g;var u=a[g]*a[g];var m=u/1E7|0;f[k]=u%1E7;f[k+1]=m}for(g=0;g<e;g++){m=0;k=2*g+1;for(var l=
g+1;l<e;l++,k++)u=a[l]*a[g]*2+f[k]+m,m=u/1E7|0,f[k]=u%1E7;k=e+g;u=m+f[k];m=u/1E7|0;f[k]=u%1E7;f[k+1]+=m}return new b(f,1,c)};b.prototype.quotient=function(a){return this.divRem(a)[0]};b.prototype.divide=b.prototype.quotient;b.prototype.remainder=function(a){return this.divRem(a)[1]};b.prototype.divRem=function(a){a=b(a);if(0===a._s)throw Error("Divide by zero");if(0===this._s)return[d,d];if(1===a._d.length)return this.divRemSmall(a._s*a._d[0]);switch(this.compareAbs(a)){case 0:return[this._s===a._s?
n:e,d];case -1:return[d,this]}var f=this._s*a._s,g=a.abs(),k=this._d,u=k.length,m=[],l=new b([],0,c);for(l._s=1;u;)if(l._d.unshift(k[--u]),0>l.compareAbs(a))m.push(0);else{if(0===l._s)var t=0;else{var r=l._d.length;t=g._d.length;r=1E7*l._d[r-1]+l._d[r-2];t=1E7*g._d[t-1]+g._d[t-2];l._d.length>g._d.length&&(r=1E7*(r+1));t=Math.ceil(r/t)}do{r=g.multiplySingleDigit(t);if(0>=r.compareAbs(l))break;t--}while(t);m.push(t);t&&(t=l.subtract(r),l._d=t._d.slice(),0===l._d.length&&(l._s=0))}return[new b(m.reverse(),
f,c),new b(l._d,this._s,c)]};b.prototype.divRemSmall=function(a){a=+a;if(0===a)throw Error("Divide by zero");var n=this._s*(0>a?-1:1);a=Math.abs(a);if(1>a||1E7<=a)throw Error("Argument out of range");if(0===this._s)return[d,d];if(1===a||-1===a)return[1===n?this.abs():new b(this._d,n,c),d];if(1===this._d.length){var e=new b([this._d[0]/a|0],1,c);a=new b([this._d[0]%a|0],1,c);0>n&&(e=e.negate());0>this._s&&(a=a.negate());return[e,a]}var f=this._d.slice();e=Array(f.length);for(var g=0,k=0,u=0,m;f.length;)g=
1E7*g+f[f.length-1],g<a?(e[u++]=0,f.pop(),k=1E7*k+g):(m=0===g?0:g/a|0,k=g-a*m,(e[u++]=m)?(f.pop(),g=k):f.pop());a=new b([k],1,c);0>this._s&&(a=a.negate());return[new b(e.reverse(),n,c),a]};b.prototype.isEven=function(){var a=this._d;return 0===this._s||0===a.length||0===a[0]%2};b.prototype.isOdd=function(){return!this.isEven()};b.prototype.sign=function(){return this._s};b.prototype.isPositive=function(){return 0<this._s};b.prototype.isNegative=function(){return 0>this._s};b.prototype.isZero=function(){return 0===
this._s};b.prototype.exp10=function(a){a=+a;if(0===a)return this;if(Math.abs(a)>Number(f))throw Error("exponent too large in BigInteger.exp10");if(0<a){for(var n=new b(this._d.slice(),this._s,c);7<=a;a-=7)n._d.unshift(0);if(0==a)return n;n._s=1;n=n.multiplySingleDigit(Math.pow(10,a));return 0>this._s?n.negate():n}if(-a>=7*this._d.length)return d;n=new b(this._d.slice(),this._s,c);for(a=-a;7<=a;a-=7)n._d.shift();return 0==a?n:n.divRemSmall(Math.pow(10,a))[0]};b.prototype.pow=function(a){if(this.isUnit())return 0<
this._s?this:b(a).isOdd()?this:this.negate();a=b(a);if(0===a._s)return n;if(0>a._s){if(0===this._s)throw Error("Divide by zero");return d}if(0===this._s)return d;if(a.isUnit())return this;if(0<a.compareAbs(f))throw Error("exponent too large in BigInteger.pow");for(var c=this,e=n,g=b.small[2];a.isPositive()&&(!a.isOdd()||(e=e.multiply(c),!a.isUnit()));)c=c.square(),a=a.quotient(g);return e};b.prototype.modPow=function(a,c){for(var d=n,e=this;a.isPositive();)a.isOdd()&&(d=d.multiply(e).remainder(c)),
a=a.quotient(b.small[2]),a.isPositive()&&(e=e.square().remainder(c));return d};b.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var a=this._d.length;if(30>7*a)return Math.log(this.valueOf());var d=Math.ceil(30/7),n=this._d.slice(a-d);return Math.log((new b(n,1,c)).valueOf())+(a-d)*Math.log(1E7)};b.prototype.valueOf=function(){return parseInt(this.toString(),10)};b.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var f=b(2147483647);b.MAX_EXP=
f;(function(){function a(a){return function(c){return a.call(b(c))}}function c(a){return function(c,d){return a.call(b(c),b(d))}}function d(a){return function(c,d,n){return a.call(b(c),b(d),b(n))}}(function(){var n,e="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),f="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),g=["modPow"];for(n=0;n<e.length;n++){var k=e[n];b[k]=a(b.prototype[k])}for(n=
0;n<f.length;n++)k=f[n],b[k]=c(b.prototype[k]);for(n=0;n<g.length;n++)k=g[n],b[k]=d(b.prototype[k]);b.exp10=function(a,c){return b(a).exp10(c)}})()})();a.BigInteger=b})("undefined"!==typeof b?b:this);var t={greatest_common_divisor:function(a,b){if(b.isUnit()||a.isUnit())return BigInteger.ONE;for(var c;!b.isZero();)c=b,b=a.remainder(b),a=c;return a},create:function(){return[0]},clone:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b},copy:function(a,b){a=[];for(var c=0,d=b.length;c<
d;c++)a[c]=b[c];return a},abs:function(a,b){a[0]=Math.abs(b[0]);return a},str:function(a){return a[0].toString()},toInteger:function(a){return out[0]},fromInteger:function(a){return[parseInt(a)]}};t.ZERO=t.fromInteger(0);t.ONE=t.fromInteger(1);"undefined"!==typeof b&&(b.bigint=t);d||(d=Array);c||(c=Math.pow(2,56));a||(a=16777216);var m={EPSILON:2E-16};m.MAX_LOOPS=a;m.create=function(){var a=new d(2);a[0]=0;a[1]=1;return a};m.clone=function(a){var b=new d(2);b[0]=a[0];b[1]=a[1];return b};m.fromValues=
function(a,b){var c=new d(2);c[0]=a;c[1]=b;return m.normalize(c,c)};m.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};m.set=function(a,b,c){a[0]=b;a[1]=c;return m.normalize(a,a)};m.abs=function(a,b){a[0]=Math.abs(b[0]);a[1]=b[1];return a};m.invert=function(a,b){var c=b[0];a[0]=b[1];a[1]=c;return a};m.reciprocal=m.invert;m.add=function(a,b,c){b[1]===c[1]?(a[0]=b[0]+c[0],a[1]=b[1]):(a[0]=b[0]*c[1]+c[0]*b[1],a[1]=b[1]*c[1]);return m.normalize(a,a)};m.subtract=function(a,b,c){b[1]===c[1]?(a[0]=b[0]-
c[0],a[1]=b[1]):(a[0]=b[0]*c[1]-c[0]*b[1],a[1]=b[1]*c[1]);return m.normalize(a,a)};m.sub=m.subtract;m.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return m.normalize(a,a)};m.mul=m.multiply;m.mediant=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return m.normalize(a,a)};m.divide=function(a,b,c){a[0]=b[0]*c[1];a[1]=b[1]*c[0];return m.normalize(a,a)};m.div=m.divide;m.equals=function(a,b){return 0===a[0]&&0===b[0]||0===a[1]&&0===b[1]?!0:a[0]===b[0]&&a[1]===b[1]};m.approximates=function(a,b){if(m.equals(a,
b))return!0;var c=m.create();m.sub(c,a,b);m.abs(c,c);return m.isLessThan(c,m.INFINITESIMAL)};m.isGreaterThan=function(a,b){return m.equals(a,b)?!1:a[0]*b[1]>b[0]*a[1]};m.isLessThan=function(a,b){return m.equals(a,b)?!1:a[0]*b[1]<b[0]*a[1]};m.isNegative=function(a){return 0>a[0]};m.min=function(a,b,c){m.isLessThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};m.max=function(a,b,c){m.isGreaterThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};m.scalar_multiply=function(a,b,
c){a[0]=b[0]*c;a[1]=b[1];return m.normalize(a,a)};m.scalar_divide=function(a,b,c){a[0]=b[0];a[1]=b[1]*c;return m.normalize(a,a)};m.normalize=function(a,b){if(isNaN(b[0])||isNaN(b[1])||0===b[0]&&0===b[1])return a[0]=0,a[1]=0,a;if(0===b[0])return a[0]=0,a[1]=1,a;if(0===b[1])return a[0]=1,a[1]=0,a;if(b[0]===b[1])return a[0]=1,a[1]=1,a;0<b[1]?(a[0]=b[0],a[1]=b[1]):(a[0]=-b[0],a[1]=-b[1]);b=k.greatest_common_divisor(Math.abs(a[0]),a[1]);1<b&&(a[0]/=b,a[1]/=b);return a};m.opposite=function(a,b){a[0]=-b[0];
a[1]=b[1];return a};m.negative=m.opposite;m.neg=m.opposite;m.power=function(a,b,c){2===c?(a[0]=b[0]*b[0],a[1]=b[1]*b[1]):0<c?(a[0]=Math.pow(b[0],c),a[1]=Math.pow(b[1],c)):0>c?(c=Math.abs(c),a[0]=Math.pow(b[1],c),a[1]=Math.pow(b[0],c)):m.copy(a,m.ONE);return m.normalize(a,a)};m.pow=m.power;m.sqrt=function(a,b){return m.nthRoot(a,b,2)};m.nthRoot=function(a,b,c){if(m.equals(b,m.ZERO))return m.copy(a,m.ZERO);if(m.equals(b,m.ONE))return m.copy(a,m.ONE);if(m.equals(b,m.INFINITY))return m.copy(a,m.INFINITY);
if(m.equals(b,m.INFINULL))return m.copy(a,m.INFINULL);var d=m.isNegative(b);d&&(b[0]=-b[0]);a=m.copy(a,m.ONE);for(var n=[1,0,0,1],e=m.clone(m.ONE),f=m.MAX_LOOPS;!m.approximates(b,e)&&f--;)m.isLessThan(b,e)?(n[0]+=n[1],n[2]+=n[3]):(n[1]+=n[0],n[3]+=n[2]),a[0]=n[0]+n[1],a[1]=n[2]+n[3],m.pow(e,a,c);d&&(b[0]=-b[0],1===c%2&&m.neg(a,a));return a};m.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};m.str=function(a){return 1===a[1]?a[0].toString():a[0]+"/"+a[1]};m.toDecimal=function(a){return a[0]/a[1]};m.dec=
m.toDecimal;m.toInteger=function(a){return Math.round(m.toDecimal(a))};m.round=m.toInteger;m.floor=function(a){return Math.floor(m.toDecimal(a))};m.ceil=function(a){return Math.ceil(m.toDecimal(a))};m.fromInteger_copy=function(a,b){a[0]=parseInt(b);a[1]=1;return a};m.fromInteger=function(a){return m.fromInteger_copy(m.create(),a)};m.fromIntegerInverse_copy=function(a,b){a[0]=1;a[1]=parseInt(b);0>a[1]&&(a[0]=-a[0],a[1]=-a[1]);return a};m.fromIntegerInverse=function(a){return m.fromIntegerInverse_copy(m.create(),
a)};m.fromDecimal=function(a){return m.fromDecimal_copy(m.create(),a)};m.fromDecimal_copy=function(a,b){b=parseFloat(b);if(isNaN(b))return m.copy(a,m.INFINULL);if(Infinity===b)return m.copy(a,m.INFINITY);if(Math.abs(b)<m.EPSILON)return m.copy(a,m.ZERO);if(Math.abs(b-1)<m.EPSILON)return m.copy(a,m.ONE);if(Math.abs(b%1)<m.EPSILON)return m.fromInteger_copy(a,b);if(Math.abs(1/b%1)<m.EPSILON)return m.fromIntegerInverse_copy(a,Math.round(1/b));m.copy(a,m.ONE);for(var c=[1,0,0,1],d=b,e,n=m.MAX_LOOPS;n--&&
Math.abs(b-m.toDecimal(a))>m.EPSILON;){e=Math.floor(d);a[0]=e*c[0]+c[2];a[1]=e*c[1]+c[3];if(d===e)break;d=1/(d-e);c[2]=c[0];c[3]=c[1];c[0]=a[0];c[1]=a[1]}return a};m.fromRandom=function(a){a[0]=0xfffffffffffff*Math.random()<<0;a[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return m.normalize(a,a)};m.sin=function(a,b){if(0===b[1])return m.copy(a,m.ZERO);m.scalar_multiply(a,b,2);var c=m.create();m.pow(c,b,2);m.add(c,c,m.ONE);m.divide(a,a,c);return a};m.cos=function(a,b){if(0===b[1])return m.neg(a,
m.ONE);var c=m.create();m.pow(c,b,2);m.sub(a,m.ONE,c);b=m.create();m.add(b,m.ONE,c);m.divide(a,a,b);return a};m.tan=function(a,b){m.scalar_multiply(a,b,2);var c=m.create();m.pow(c,b,2);m.scalar_multiply(c,c,2);m.add(a,a,c);m.pow(c,b,4);m.sub(c,m.ONE,c);m.divide(a,a,c);return a};m.toEgyptian=function(a){a=m.clone(a);m.abs(a,a);var b=m.floor(a);b&&m.sub(a,a,m.fromInteger(b));if(!a[0])return b.toString();b||(b="");var c=1;for(m.create();1!==a[0];){c++;var d=m.fromValues(1,c);m.isGreaterThan(a,d)&&(b&&
(b+=" + "),b+=m.str(d),m.sub(a,a,d))}return a?b?b+" + "+m.str(a):m.str(a):b?b:"0"};m.toBabylonian=function(a){var b="",c=m.toDecimal(a);a=parseInt(c);c-=a;for(var d=0,e=0;0<a;)(d=a%60)&&(b=d+" * 60^"+e+(b?" + ":"")+b),a=(a-d)/60,e++;for(e=-1;0<c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+e),e--);return b?b:"0"};m.traceSternBrocot=function(a){var b="";if(m.equals(a,m.ZERO)||m.equals(a,m.ONE)||m.equals(a,m.INFINITY)||m.equals(a,m.INFINULL))return b;a=m.clone(a);m.isNegative(a)&&
(a[0]=-a[0]);for(var c=m.clone(m.ONE),d=[1,0,0,1],e=0,n=0,f=m.MAX_LOOPS;!m.approximates(a,c)&&f--;)m.isLessThan(a,c)?(d[0]+=d[1],d[2]+=d[3],n++,e&&(b+="R",1!==e&&(b+=e),e=0,b+=" ")):(d[1]+=d[0],d[3]+=d[2],e++,n&&(b+="L",1!==n&&(b+=n),n=0,b+=" ")),c[0]=d[0]+d[1],c[1]=d[2]+d[3];n?(b+="L",1!==n&&(b+=n)):e&&(b+="R",1!==e&&(b+=e));0>f&&(b+="...");return b};m.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(m.equals(a,m.ZERO))return[0];if(m.equals(a,m.ONE))return[1];if(m.equals(a,
m.NEGONE))return[-1];if(m.equals(a,m.INFINITY))return[1,0];if(m.equals(a,m.INFINULL))return[0,0];a=m.clone(a);var c=m.isNegative(a);c&&(a[0]=-a[0]);for(var d=m.clone(m.ONE),e=[1,0,0,1],n=1,f=[0],g=f.length-1;!m.equals(a,d)&&b--;)m.isLessThan(a,d)?(-1===n?f[g]++:(n=-1,f.push(1),g++),e[0]+=e[1],e[2]+=e[3]):(1===n?f[g]++:(n=1,f.push(1),g++),e[1]+=e[0],e[3]+=e[2]),d[0]=e[0]+e[1],d[1]=e[2]+e[3];0>b?f.push(0):f[g]++;if(c)for(var k in f)f[k]=-f[k];return f};m.fromContinuedFraction=function(a,b){m.fromInteger_copy(a,
b[b.length-1]);for(var c=b.length-2;-1<c;c--)m.invert(a,a),m.add(a,m.fromInteger(b[c]),a);return a};m.dump=function(a){m.create();return"rat\t"+m.str(a)+"\n~\t"+m.toDecimal(a)+"\nCF:\t["+m.toContinuedFraction(a)+"]\n"};m.ZERO=m.fromInteger(0);m.ONE=m.fromInteger(1);m.NEGONE=m.fromInteger(-1);m.INFINITY=m.fromValues(1,0);m.INFINULL=m.fromValues(0,0);m.INFINITESIMAL=m.clone([1,c]);m.PI=m.fromValues(1320192667429,420230377710);"undefined"!==typeof b&&(b.rat=m);e||(e=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"));
f||(f=1073741824);var l={EPSILON:2E-16};l.MAX_LOOPS=f;l.create=function(){var a=[];a[0]=BigInteger.ZERO;a[1]=BigInteger.ONE;return a};l.clone=function(a){var b=[];b[0]=a[0];b[1]=a[1];return b};l.fromValues=function(a,b){var c=[];c[0]=new BigInteger(a);c[1]=new BigInteger(b);return l.normalize(c,c)};l.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};l.set=function(a,b,c){a[0]=b;a[1]=c;return l.normalize(a,a)};l.toRat=function(a,b){return m.set(a,b[0].toJSValue(),b[1].toJSValue())};l.fromRat=function(a,
b){return l.set(a,BigInteger(b[0]),BigInteger(b[1]))};l.abs=function(a,b){a[0]=b[0].abs();a[1]=b[1];return a};l.invert=function(a,b){var c=b[0];a[0]=b[1];a[1]=c;return a};l.reciprocal=l.invert;l.add=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].add(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).add(c[0].multiply(b[1])),a[1]=b[1].multiply(c[1]));return l.normalize(a,a)};l.subtract=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].subtract(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).subtract(c[0].multiply(b[1])),
a[1]=b[1].multiply(c[1]));return l.normalize(a,a)};l.sub=l.subtract;l.multiply=function(a,b,c){a[0]=b[0].multiply(c[0]);a[1]=b[1].multiply(c[1]);return l.normalize(a,a)};l.mul=l.multiply;l.mediant=function(a,b,c){a[0]=b[0].add(c[0]);a[1]=b[1].add(c[1]);return l.normalize(a,a)};l.divide=function(a,b,c){a[0]=b[0].multiply(c[1]);a[1]=b[1].multiply(c[0]);return l.normalize(a,a)};l.div=l.divide;l.equals=function(a,b){return a[0].isZero()&&b[0].isZero()||a[1].isZero()&&b[1].isZero()?!0:0===a[0].compare(b[0])&&
0===a[1].compare(b[1])};l.approximates=function(a,b){if(l.equals(a,b))return!0;var c=l.create();l.sub(c,a,b);l.abs(c,c);return l.isLessThan(c,l.INFINITESIMAL)};l.isGreaterThan=function(a,b){return l.equals(a,b)?!1:0<a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};l.isLessThan=function(a,b){return l.equals(a,b)?!1:0>a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};l.isNegative=function(a){return a[0].isNegative()};l.min=function(a,b,c){l.isLessThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);
return a};l.max=function(a,b,c){l.isGreaterThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};l.scalar_multiply=function(a,b,c){a[0]=b[0].multiply(c);a[1]=b[1];return l.normalize(a,a)};l.scalar_divide=function(a,b,c){a[0]=b[0];a[1]=b[1].multiply(c);return l.normalize(a,a)};l.normalize=function(a,b){if(b[0].isZero()||b[1].isZero())return b;if(0===b[0].compare(b[1]))return l.clone(l.ONE);if(b[1].isNegative())a[0]=b[0].negate(),a[1]=b[1].negate();else if(a[0]=b[0],a[1]=b[1],a[1].isZero())return a;
b=t.greatest_common_divisor(a[0].abs(),a[1]);0<b.compare(BigInteger.ONE)&&(a[0]=a[0].quotient(b),a[1]=a[1].quotient(b));return a};l.opposite=function(a,b){a[0]=b[0].negate();a[1]=b[1];return a};l.negative=l.opposite;l.neg=l.opposite;l.power=function(a,b,c){2===c?(a[0]=b[0].square(),a[1]=b[1].square()):0<c?(a[0]=b[0].pow(c),a[1]=b[1].pow(c)):0>c?(c=Math.abs(c),a[0]=b[1].pow(c),a[1]=b[0].pow(c)):l.copy(a,l.ONE);return a};l.pow=l.power;l.sqrt=function(a,b){return l.nthRoot(a,b,2)};l.nthRoot=function(a,
b,c){if(l.equals(b,l.ZERO))return l.copy(a,l.ZERO);if(l.equals(b,l.ONE))return l.copy(a,l.ONE);if(l.equals(b,l.INFINITY))return l.copy(a,l.INFINITY);if(l.equals(b,l.INFINULL))return l.copy(a,l.INFINULL);var d=l.isNegative(b);d&&(b[0]=b[0].negate());l.copy(a,l.ONE);for(var e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=l.clone(l.ONE),n=f;!l.approximates(b,g)&&n--;)l.isLessThan(b,g)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),a[0]=e[0].add(e[1]),
a[1]=e[2].add(e[3]),l.pow(g,a,c);d&&(b[0]=b[0].negate(),1===c%2&&l.neg(a,a));return a};l.dot=function(a,b){return a[0].multiply(b[0]).add(a[1].multiply(b[1]))};l.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};l.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};l.dec=l.toDecimal;l.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};l.round=l.toInteger;l.toBigInteger=function(a){return a[0].quotient(a[1])};l.floor=
function(a){return Math.floor(l.toDecimal(a))};l.ceil=function(a){return Math.ceil(l.toDecimal(a))};l.fromInteger_copy=function(a,b){a[0]=BigInteger(b);a[1]=BigInteger.ONE;return a};l.fromInteger=function(a){return l.fromInteger_copy(l.create(),a)};l.fromIntegerInverse_copy=function(a,b){a[0]=BigInteger.ONE;a[1]=BigInteger(b);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};l.fromIntegerInverse=function(a){return l.fromIntegerInverse_copy(l.create(),a)};l.fromDecimal=function(a){return l.fromDecimal_copy(l.create(),
a)};l.fromDecimal_copy=function(a,b){b=parseFloat(b);if(isNaN(b))return l.copy(a,l.INFINULL);if(Infinity===b)return l.copy(a,l.INFINITY);if(Math.abs(b)<l.EPSILON)return l.copy(a,l.ZERO);if(Math.abs(b-1)<l.EPSILON)return l.copy(a,l.ONE);if(Math.abs(b%1)<l.EPSILON)return l.fromInteger_copy(a,b);if(Math.abs(1/b%1)<l.EPSILON)return l.fromIntegerInverse_copy(a,Math.round(1/b));l.copy(a,l.ONE);var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=b;BigInteger(1);for(var e=l.MAX_LOOPS;e--&&Math.abs(b-
l.toDecimal(a))>l.EPSILON;){var f=BigInteger(Math.floor(d));a[0]=f.multiply(c[0]).add(c[2]);a[1]=f.multiply(c[1]).add(c[3]);if(f=d-parseInt(f.toString(),10))d=1/f;else{if(b.toString()===l.toDecimal(a))break;d=(c=(b.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;l.add(a,l.fromInteger(c[1]),l.fromValues(c[2],Math.pow(10,d)));break}c[2]=c[0];c[3]=c[1];c[0]=a[0];c[1]=a[1]}return a};l.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<
0);a[1]=BigInteger(Math.abs(0xfffffffffffff*Math.random()<<0));return l.normalize(a,a)};l.sin=function(a,b){if(b[1].isZero())return l.copy(a,l.ZERO);l.scalar_multiply(a,b,2);var c=l.create();l.pow(c,b,2);l.add(c,c,l.ONE);l.divide(a,a,c);return a};l.cos=function(a,b){if(b[1].isZero())return l.neg(a,l.ONE);var c=l.create();l.pow(c,b,2);l.sub(a,l.ONE,c);b=l.create();l.add(b,l.ONE,c);l.divide(a,a,b);return a};l.tan=function(a,b){l.scalar_multiply(a,b,2);var c=l.create();l.pow(c,b,2);l.scalar_multiply(c,
c,2);l.add(a,a,c);l.pow(c,b,4);l.sub(c,l.ONE,c);l.divide(a,a,c);return a};l.toEgyptian=function(a){a=l.clone(a);l.abs(a,a);var b=l.floor(a);b&&l.sub(a,a,l.fromInteger(b));if(!a[0])return b.toString();b||(b="");var c=1;for(l.create();1!==a[0];){c++;var d=l.fromValues(1,c);l.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=l.str(d),l.sub(a,a,d))}return a?b?b+" + "+l.str(a):l.str(a):b?b:"0"};l.toBabylonian=function(a){var b="",c=l.toDecimal(a);a=parseInt(c);c-=a;for(var d=0,e=0;0<a;)(d=a%60)&&(b=d+" * 60^"+e+(b?
" + ":"")+b),a=(a-d)/60,e++;for(e=-1;0<c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+e),e--);return b?b:"0"};l.traceSternBrocot=function(a){var b="";if(l.equals(a,l.ZERO)||l.equals(a,l.ONE)||l.equals(a,l.INFINITY)||l.equals(a,l.INFINULL))return b;a=l.clone(a);l.isNegative(a)&&(a[0]=a[0].negate());for(var c=l.clone(l.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=0,f=0,g=65536;!l.equals(a,c)&&g--;)l.isLessThan(a,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),
f++,e&&(b+="R",1!==e&&(b+=e),e=0,b+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),e++,f&&(b+="L",1!==f&&(b+=f),f=0,b+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);f?(b+="L",1!==f&&(b+=f)):e&&(b+="R",1!==e&&(b+=e));0>g&&(b+="...");return b};l.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(l.equals(a,l.ZERO))return[0];if(l.equals(a,l.ONE))return[1];if(l.equals(a,l.NEGONE))return[-1];if(l.equals(a,l.INFINITY))return[1,0];if(l.equals(a,l.INFINULL))return[0,0];a=l.clone(a);
var c=l.isNegative(a);c&&(a[0]=a[0].negate());for(var d=l.clone(l.ONE),e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=1,g=[0],k=g.length-1;!l.equals(a,d)&&b--;)l.isLessThan(a,d)?(-1===f?g[k]++:(f=-1,g.push(1),k++),e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(1===f?g[k]++:(f=1,g.push(1),k++),e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),d[0]=e[0].add(e[1]),d[1]=e[2].add(e[3]);0>b?g.push(0):g[k]++;if(c)for(var n in g)g[n]=-g[n];return g};l.fromContinuedFraction=function(a,b){l.fromInteger_copy(a,
b[b.length-1]);for(var c=b.length-2;-1<c;c--)l.invert(a,a),l.add(a,l.fromInteger(b[c]),a);return a};l.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return l.fromInteger_copy(a,factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(l.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)l.scalar_multiply(a,a,++c);return a};l.dump=function(a){return"bigrat\t"+l.str(a)+"\n~\t"+l.toDecimal(a)+"\nCF:\t["+l.toContinuedFraction(a)+"]\n"};l.ZERO=l.fromInteger(0);l.ONE=l.fromInteger(1);
l.NEGONE=l.fromInteger(-1);l.INFINITY=l.fromValues(1,0);l.INFINULL=l.fromValues(0,0);l.INFINITESIMAL=l.clone([new BigInteger(1),e]);l.PI=l.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof b&&(b.bigrat=l);var h=function(a,b){this.a=m.fromValues(parseInt(a),parseInt(b))};h.prototype.toString=function(){return m.str(this.a)};h.prototype.toContinuedFraction=function(a){return m.toContinuedFraction(this.a,a)};h.prototype.invert=function(){return m.invert(this.a)};h.prototype.reciprocal=h.prototype.invert;h.prototype.add=function(a){var b=m.create();m.add(b,this.a,a.a);return new h(b[0],b[1])};h.prototype.plus=h.prototype.add;h.prototype.subtract=function(a){var b=m.create();
m.sub(b,this.a,a.a);return new h(b[0],b[1])};h.prototype.sub=h.prototype.subtract;h.prototype.minus=h.prototype.subtract;h.prototype.multiply=function(a){var b=m.create();m.mul(b,this.a,a.a);return new h(b[0],b[1])};h.prototype.mul=h.prototype.multiply;h.prototype.times=h.prototype.multiply;h.prototype.mediant=function(a){var b=m.create();m.mediant(b,this.a,a.a);return new h(b[0],b[1])};h.prototype.divide=function(a){var b=m.create();m.div(b,this.a,a.a);return new h(b[0],b[1])};h.prototype.div=h.prototype.divide;
h.prototype.divided_by=h.prototype.divide;h.prototype.power=function(a){var b=m.create();m.pow(b,this.a,a);return new h(b[0],b[1])};h.prototype.pow=h.prototype.power;h.prototype.dump=function(){return m.dump(this.a)};h.prototype.toRat=function(){return m.clone(this.a)};h.prototype.toDecimal=function(){return m.toDecimal(this.a)};h.fromRat=function(a){var b=new h;b.a[0]=a[0];b.a[1]=a[1];return b};h.fromInteger=function(a){return h.fromRat(m.fromInteger(a))};h.fromIntegerInverse=function(a){return h.fromRat(m.fromIntegerInverse(a))};
h.fromDecimal=function(a){return h.fromRat(m.fromDecimal(a))};h.fromContinuedFraction=function(a){return h.fromRat(m.fromContinuedFraction(m.create(),a))};"undefined"!==typeof b&&(b.rational=h);var r={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<r.GREEK.length?r.GREEK[this.i++]:"?"}}};"undefined"!==typeof b&&(b.alpha=r);e={};e.FINE_STRUCTURE=l.fromValues(30223,4141639);
e.a=e.FINE_STRUCTURE;e.FINE_STRUCTURE_ALT=l.fromValues(13355891,1830237867);e.PLANK=l.fromValues(662606957,1E42);e.h=e.PLANK;e.hBAR=l.fromValues(1054571726,1E43);e.GRAVITATIONAL=l.fromValues(667384,1E16);e.G=e.GRAVITATIONAL;e.SPEED_OF_LIGHT=l.fromInteger(299792458);e.c=e.SPEED_OF_LIGHT;"undefined"!==typeof b&&(b.physics=e);var v={create:function(){return[[],[]]},fromValues:function(a){var b=v.create();b[0]=a.slice();a=v.countDimensions(b);for(b[1]=Array(a);a--;)b[1][a]=0;return v.normalize(b,b)},
mergeDimension:function(a,b,c){a[0]=[b.slice()];a[1].push(0);for(var d in c)a[0].push(c[d]);return a},evaluate:function(a,b,c){l.copy(a,l.ZERO);var d=v.countDimensions(b);if(0===d)return"0";if(1===d)for(var e in b[0]){if(b[0][e]){d=l.fromInteger(b[0][e]);var f=l.pow(l.create(),l.fromInteger(c[0]),b[1][0]+ +e);l.mul(d,d,f);l.add(a,a,d)}}else if(2===d)for(var g in b[0])for(e in b[0][g]){if(b[0][g][e]){d=l.fromInteger(b[0][g][e]);f=l.pow(l.create(),l.fromInteger(c[0]),b[1][1]+ +e);var k=l.pow(l.create(),
l.fromInteger(c[1]),b[1][0]+ +g);l.mul(d,d,f);l.mul(d,d,k);l.add(a,a,d)}}else if(3===d)for(var n in b[0])for(g in b[0][n])for(e in b[0][n][g]){if(b[0][n][g][e]){d=l.fromInteger(b[0][n][g][e]);f=l.pow(l.create(),l.fromInteger(c[0]),b[1][2]+ +e);k=l.pow(l.create(),l.fromInteger(c[1]),b[1][1]+ +g);var m=l.pow(l.create(),l.fromInteger(c[1]),b[1][0]+ +n);l.mul(d,d,f);l.mul(d,d,k);l.mul(d,d,m);l.add(a,a,d)}}else alert("unsupported dimension "+d);return a},derivatives:function(a){return[]},forEachNonZeroElement:function(a,
b){a=a.slice();for(b=0;"object"===typeof a[0];)a=a[0].slice(),b++;for(var c=b+1;0<c;--c){print(Array(c).join("[0]"));a=eval("(a"+Array(c).join("[0]")+")");for(var d in a)for(var e=b+2;0<e;--e)print(a[d])}return""},str:function(a){var b="",c=new r.iterator,d=c.next(),e=c.next();c=c.next();var f=v.countDimensions(a);if(0===f)b+=a.toString();else if(1===f)for(var g in a[0]){if(a[0][g]){b?b+=" "+(0>a[0][g]?"-":"+")+" ":0>a[0][g]&&(b+="-");f=Math.abs(a[0][g]);var k=a[1][0]+ +g;if(1!==f||0===k)b+=f;0!==
k&&(b+=d+(1===k?"":"<sup>"+k+"</sup>"))}}else if(2===f)for(var m in a[0])for(g in a[0][m]){if(a[0][m][g]){b?b+=" "+(0>a[0][m][g]?"-":"+")+" ":0>a[0][m][g]&&(b+="-");f=Math.abs(a[0][m][g]);k=a[1][1]+ +g;var n=a[1][0]+ +m;if(1!==f||0===n&&0===k)b+=f;0!==k&&(b+=d+(1===k?"":"<sup>"+k+"</sup>"));0!==n&&(b+=e+(1===n?"":"<sup>"+n+"</sup>"))}}else if(3===f)for(var l in a[0])for(m in a[0][l])for(g in a[0][l][m]){if(a[0][l][m][g]){b?b+=" "+(0>a[0][l][m][g]?"-":"+")+" ":0>a[0][l][m][g]&&(b+="-");f=Math.abs(a[0][l][m][g]);
k=a[1][2]+ +g;n=a[1][1]+ +m;var t=a[1][0]+ +l;if(1!==f||0===t&&0===n&&0===k)b+=f;0!==k&&(b+=d+(1===k?"":"<sup>"+k+"</sup>"));0!==n&&(b+=e+(1===n?"":"<sup>"+n+"</sup>"));0!==t&&(b+=c+(1===t?"":"<sup>"+t+"</sup>"))}}else alert("unsupported dimension "+f);""===b&&(b="0");return b},getJSFormula:function(a){var b="";var c=v.countDimensions(a);if(0===c)return"0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d],c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")")));else if(2===
c)for(var e in a[0])for(d in a[0][e]){if(a[0][e][d]){b&&(b+="+");b+=a[0][e][d];c=a[1][1]+ +d;var f=a[1][0]+ +e;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==f&&(b=1===f?b+"*m[1]":b+("*Math.pow(m[1],"+f+")"))}}else if(3===c)for(var g in a[0])for(e in a[0][g])for(d in a[0][g][e]){if(a[0][g][e][d]){b&&(b+="+");b+=a[0][g][e][d];c=a[1][2]+ +d;f=a[1][1]+ +e;var k=a[1][0]+ +g;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==f&&(b=1===f?b+"*m[1]":b+("*Math.pow(m[1],"+f+")"));0!==k&&
(b=1===k?b+"*m[2]":b+("*Math.pow(m[2],"+k+")"))}}else alert("unsupported dimension "+c);""===b&&(b="0");return b}};String.prototype.repeat=function(a){return Array(a+1).join(this)};v.getGLSLFormula=function(a){var b="";var c=v.countDimensions(a);if(0===c)return"0.0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d]+".0",c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var e in a[0])for(d in a[0][e]){if(a[0][e][d]){b&&
(b+="+");b+=a[0][e][d]+".0";c=a[1][1]+ +d;var f=a[1][0]+ +e;0!==c&&(b=1===c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==f&&(b=1===f?b+"*m_1":1<f?b+"*m_1".repeat(f):b+("*pow(1.0"+"*m_1".repeat(Math.abs(f))+",-1.0)"))}}else alert("unsupported dimension "+c);""===b&&(b="0.0");return b};v.toJSON=function(a){return JSON.stringify(a)};v.fromJSON=function(a){return JSON.parse(a)};v.normalize=function(a,b){return b};v.binary_operation=function(a,b,c,d){a=v.create();
var e=v.countDimensions(b),f=v.countDimensions(c);b[1][g]!==c[1][g]&&alert("adding polyrats only works if the offsets are the same (for now)");if(1===e&&1===f){for(var g in b[0])a[0][g]="undefined"===typeof c[0][g]?b[0][g]:d(b[0][g],c[0][g]);for(g in c[0])"undefined"===typeof b[0][g]&&(a[0][g]=c[0][g]);for(g in a[0])"undefined"===typeof b[0][g]&&"undefined"===typeof c[0][g]&&(a[0][g]=null)}else alert("unsupported dimension "+e);for(g=e;g--;)a[1][g]=b[1][g];return a};v.add=function(a,b,c){return v.binary_operation(a,
b,c,function(a,b){return a+b})};v.subtract=function(a,b,c){return v.binary_operation(a,b,c,function(a,b){return a-b})};v.sub=v.subtract;v.multiply=function(a,b,c){return a};v.mul=v.multiply;v.divide=function(a,b,c){return a};v.div=v.divide;v.equals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};v.countDimensions=function(a){return"object"===typeof a[0]?v._countDimensions(a[0],1):0};v._countDimensions=function(a,b){return"object"===typeof a[0]?v._countDimensions(a[0],++b):b};v.ZERO=v.fromValues([0]);
v.IDENTITY=v.fromValues([1]);v.ONE=v.IDENTITY;"undefined"!==typeof b&&(b.polyrat=v)})(h)})(this);/*
   Copyright 2008-2016 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
 DataTables 1.10.13
 ?2008-2016 SpryMedia Ltd - datatables.net/license
*/
(function(b){"function"===typeof define&&define.amd?define(["jquery"],function(h){return b(h,window,document)}):"object"===typeof exports?module.exports=function(h,f){h||(h=window);f||(f="undefined"!==typeof window?require("jquery"):require("jquery")(h));return b(f,h,h.document)}:b(jQuery,window,document)})(function(b,h,f,g){function e(a){var c,d,x={};b.each(a,function(b,f){(c=b.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(c[1]+" ")&&(d=b.replace(c[0],c[2].toLowerCase()),
x[d]=b,"o"===c[1]&&e(a[b]))});a._hungarianMap=x}function a(c,d,f){c._hungarianMap||e(c);var x;b.each(d,function(e,p){x=c._hungarianMap[e];x===g||!f&&d[x]!==g||("o"===x.charAt(0)?(d[x]||(d[x]={}),b.extend(!0,d[x],d[e]),a(c[x],d[x],f)):d[x]=d[e])})}function c(a){var b=E.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&c&&"No data available in table"===b.sEmptyTable&&oa(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&c&&"Loading..."===b.sLoadingRecords&&oa(a,a,"sZeroRecords","sLoadingRecords");
a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&eb(a)}function d(b){ka(b,"ordering","bSort");ka(b,"orderMulti","bSortMulti");ka(b,"orderClasses","bSortClasses");ka(b,"orderCellsTop","bSortCellsTop");ka(b,"order","aaSorting");ka(b,"orderFixed","aaSortingFixed");ka(b,"paging","bPaginate");ka(b,"pagingType","sPaginationType");ka(b,"pageLength","iDisplayLength");ka(b,"searching","bFilter");"boolean"===typeof b.sScrollX&&(b.sScrollX=b.sScrollX?"100%":"");"boolean"===typeof b.scrollX&&
(b.scrollX=b.scrollX?"100%":"");if(b=b.aoSearchCols)for(var c=0,d=b.length;c<d;c++)b[c]&&a(E.models.oSearch,b[c])}function k(a){ka(a,"orderable","bSortable");ka(a,"orderData","aDataSort");ka(a,"orderSequence","asSorting");ka(a,"orderDataType","sortDataType");var c=a.aDataSort;c&&!b.isArray(c)&&(a.aDataSort=[c])}function t(a){if(!E.__browser){var c={};E.__browser=c;var d=b("<div/>").css({position:"fixed",top:0,left:-1*b(h).scrollLeft(),height:1,width:1,overflow:"hidden"}).append(b("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(b("<div/>").css({width:"100%",height:10}))).appendTo("body"),e=d.children(),f=e.children();c.barWidth=e[0].offsetWidth-e[0].clientWidth;c.bScrollOversize=100===f[0].offsetWidth&&100!==e[0].clientWidth;c.bScrollbarLeft=1!==Math.round(f.offset().left);c.bBounding=d[0].getBoundingClientRect().width?!0:!1;d.remove()}b.extend(a.oBrowser,E.__browser);a.oScroll.iBarWidth=E.__browser.barWidth}function m(a,b,c,d,e,f){var x=!1;if(c!==g){var p=c;x=!0}for(;d!==
e;)a.hasOwnProperty(d)&&(p=x?b(p,a[d],d,a):a[d],x=!0,d+=f);return p}function l(a,c){var d=E.defaults.column,e=a.aoColumns.length;d=b.extend({},E.models.oColumn,d,{nTh:c?c:f.createElement("th"),sTitle:d.sTitle?d.sTitle:c?c.innerHTML:"",aDataSort:d.aDataSort?d.aDataSort:[e],mData:d.mData?d.mData:e,idx:e});a.aoColumns.push(d);d=a.aoPreSearchCols;d[e]=b.extend({},E.models.oSearch,d[e]);w(a,e,b(c).data())}function w(c,d,e){d=c.aoColumns[d];var f=c.oClasses,x=b(d.nTh);if(!d.sWidthOrig){d.sWidthOrig=x.attr("width")||
null;var p=(x.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);p&&(d.sWidthOrig=p[1])}e!==g&&null!==e&&(k(e),a(E.defaults.column,e),e.mDataProp===g||e.mData||(e.mData=e.mDataProp),e.sType&&(d._sManualType=e.sType),e.className&&!e.sClass&&(e.sClass=e.className),b.extend(d,e),oa(d,e,"sWidth","sWidthOrig"),e.iDataSort!==g&&(d.aDataSort=[e.iDataSort]),oa(d,e,"aDataSort"));var q=d.mData,m=Q(q),l=d.mRender?Q(d.mRender):null;e=function(a){return"string"===typeof a&&-1!==a.indexOf("@")};d._bAttrSrc=b.isPlainObject(q)&&
(e(q.sort)||e(q.type)||e(q.filter));d._setter=null;d.fnGetData=function(a,b,c){var d=m(a,b,g,c);return l&&b?l(d,b,a,c):d};d.fnSetData=function(a,b,c){return C(q)(a,b,c)};"number"!==typeof q&&(c._rowReadObject=!0);c.oFeatures.bSort||(d.bSortable=!1,x.addClass(f.sSortableNone));c=-1!==b.inArray("asc",d.asSorting);e=-1!==b.inArray("desc",d.asSorting);d.bSortable&&(c||e)?c&&!e?(d.sSortingClass=f.sSortableAsc,d.sSortingClassJUI=f.sSortJUIAscAllowed):!c&&e?(d.sSortingClass=f.sSortableDesc,d.sSortingClassJUI=
f.sSortJUIDescAllowed):(d.sSortingClass=f.sSortable,d.sSortingClassJUI=f.sSortJUI):(d.sSortingClass=f.sSortableNone,d.sSortingClassJUI="")}function r(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Na(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;""===b.sY&&""===b.sX||Ba(a);W(a,null,"column-sizing",[a])}function v(a,b){a=y(a,"bVisible");return"number"===typeof a[b]?a[b]:null}function n(a,c){a=y(a,"bVisible");c=b.inArray(c,a);return-1!==c?c:null}function u(a){var c=
0;b.each(a.aoColumns,function(a,d){d.bVisible&&"none"!==b(d.nTh).css("display")&&c++});return c}function y(a,c){var d=[];b.map(a.aoColumns,function(a,b){a[c]&&d.push(b)});return d}function z(a){var b=a.aoColumns,c=a.aoData,d=E.ext.type.detect,e,f,x;var p=0;for(e=b.length;p<e;p++){var k=b[p];var q=[];if(!k.sType&&k._sManualType)k.sType=k._sManualType;else if(!k.sType){var m=0;for(f=d.length;m<f;m++){var l=0;for(x=c.length;l<x;l++){q[l]===g&&(q[l]=N(a,l,p,"type"));var n=d[m](q[l],a);if(!n&&m!==d.length-
1)break;if("html"===n)break}if(n){k.sType=n;break}}k.sType||(k.sType="string")}}}function M(a,c,d,e){var f,p,x,k=a.aoColumns;if(c)for(f=c.length-1;0<=f;f--){var q=c[f];var m=q.targets!==g?q.targets:q.aTargets;b.isArray(m)||(m=[m]);var n=0;for(p=m.length;n<p;n++)if("number"===typeof m[n]&&0<=m[n]){for(;k.length<=m[n];)l(a);e(m[n],q)}else if("number"===typeof m[n]&&0>m[n])e(k.length+m[n],q);else if("string"===typeof m[n]){var t=0;for(x=k.length;t<x;t++)("_all"==m[n]||b(k[t].nTh).hasClass(m[n]))&&e(t,
q)}}if(d)for(f=0,a=d.length;f<a;f++)e(f,d[f])}function B(a,c,d,e){var f=a.aoData.length,p=b.extend(!0,{},E.models.oRow,{src:d?"dom":"data",idx:f});p._aData=c;a.aoData.push(p);for(var x=a.aoColumns,k=0,q=x.length;k<q;k++)x[k].sType=null;a.aiDisplayMaster.push(f);c=a.rowIdFn(c);c!==g&&(a.aIds[c]=p);!d&&a.oFeatures.bDeferRender||R(a,f,d,e);return f}function G(a,c){var d;c instanceof b||(c=b(c));return c.map(function(b,c){d=D(a,c);return B(a,d.data,c,d.cells)})}function N(a,b,c,d){var e=a.iDraw,f=a.aoColumns[c],
p=a.aoData[b]._aData,x=f.sDefaultContent,k=f.fnGetData(p,d,{settings:a,row:b,col:c});if(k===g)return a.iDrawError!=e&&null===x&&(qa(a,0,"Requested unknown parameter "+("function"==typeof f.mData?"{function}":"'"+f.mData+"'")+" for row "+b+", column "+c,4),a.iDrawError=e),x;if((k===p||null===k)&&null!==x&&d!==g)k=x;else if("function"===typeof k)return k.call(p);return null===k&&"display"==d?"":k}function J(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d,{settings:a,row:b,col:c})}function K(a){return b.map(a.match(/(\\.|[^\.])+/g)||
[""],function(a){return a.replace(/\\\./g,".")})}function Q(a){if(b.isPlainObject(a)){var c={};b.each(a,function(a,b){b&&(c[a]=Q(b))});return function(a,b,d,e){var f=c[b]||c._;return f!==g?f(a,b,d,e):a}}if(null===a)return function(a){return a};if("function"===typeof a)return function(b,c,d,e){return a(b,c,d,e)};if("string"!==typeof a||-1===a.indexOf(".")&&-1===a.indexOf("[")&&-1===a.indexOf("("))return function(b,c){return b[a]};var d=function(a,c,e){if(""!==e){var f=K(e);for(var p=0,x=f.length;p<
x;p++){e=f[p].match(xa);var k=f[p].match(sa);if(e){f[p]=f[p].replace(xa,"");""!==f[p]&&(a=a[f[p]]);k=[];f.splice(0,p+1);f=f.join(".");if(b.isArray(a))for(p=0,x=a.length;p<x;p++)k.push(d(a[p],c,f));a=e[0].substring(1,e[0].length-1);a=""===a?k:k.join(a);break}else if(k){f[p]=f[p].replace(sa,"");a=a[f[p]]();continue}if(null===a||a[f[p]]===g)return g;a=a[f[p]]}}return a};return function(b,c){return d(b,c,a)}}function C(a){if(b.isPlainObject(a))return C(a._);if(null===a)return function(){};if("function"===
typeof a)return function(b,c,d){a(b,"set",c,d)};if("string"!==typeof a||-1===a.indexOf(".")&&-1===a.indexOf("[")&&-1===a.indexOf("("))return function(b,c){b[a]=c};var c=function(a,d,e){e=K(e);var f=e[e.length-1];for(var p,x,k=0,q=e.length-1;k<q;k++){p=e[k].match(xa);x=e[k].match(sa);if(p){e[k]=e[k].replace(xa,"");a[e[k]]=[];f=e.slice();f.splice(0,k+1);p=f.join(".");if(b.isArray(d))for(x=0,q=d.length;x<q;x++)f={},c(f,d[x],p),a[e[k]].push(f);else a[e[k]]=d;return}x&&(e[k]=e[k].replace(sa,""),a=a[e[k]](d));
if(null===a[e[k]]||a[e[k]]===g)a[e[k]]={};a=a[e[k]]}if(f.match(sa))a[f.replace(sa,"")](d);else a[f.replace(xa,"")]=d};return function(b,d){return c(b,d,a)}}function I(a){return ma(a.aoData,"_aData")}function O(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0;a.aIds={}}function T(a,b,c){for(var d=-1,e=0,f=a.length;e<f;e++)a[e]==b?d=e:a[e]>b&&a[e]--; -1!=d&&c===g&&a.splice(d,1)}function F(a,b,c,d){var e=a.aoData[b],f,p=function(c,d){for(;c.childNodes.length;)c.removeChild(c.firstChild);
c.innerHTML=N(a,b,d,"display")};if("dom"!==c&&(c&&"auto"!==c||"dom"!==e.src)){var k=e.anCells;if(k)if(d!==g)p(k[d],d);else for(c=0,f=k.length;c<f;c++)p(k[c],c)}else e._aData=D(a,e,d,d===g?g:e._aData).data;e._aSortData=null;e._aFilterData=null;p=a.aoColumns;if(d!==g)p[d].sType=null;else{c=0;for(f=p.length;c<f;c++)p[c].sType=null;V(a,e)}}function D(a,c,d,e){var f=[],p=c.firstChild,k,x=0,q,m=a.aoColumns,l=a._rowReadObject;e=e!==g?e:l?{}:[];var n=function(a,b){if("string"===typeof a){var c=a.indexOf("@");
-1!==c&&(c=a.substring(c+1),C(a)(e,b.getAttribute(c)))}},t=function(a){if(d===g||d===x)k=m[x],q=b.trim(a.innerHTML),k&&k._bAttrSrc?(C(k.mData._)(e,q),n(k.mData.sort,a),n(k.mData.type,a),n(k.mData.filter,a)):l?(k._setter||(k._setter=C(k.mData)),k._setter(e,q)):e[x]=q;x++};if(p)for(;p;){var r=p.nodeName.toUpperCase();if("TD"==r||"TH"==r)t(p),f.push(p);p=p.nextSibling}else for(f=c.anCells,p=0,r=f.length;p<r;p++)t(f[p]);(c=c.firstChild?c:c.nTr)&&(c=c.getAttribute("id"))&&C(a.rowId)(e,c);return{data:e,
cells:f}}function R(a,c,d,e){var p=a.aoData[c],k=p._aData,g=[],x;if(null===p.nTr){var q=d||f.createElement("tr");p.nTr=q;p.anCells=g;q._DT_RowIndex=c;V(a,p);var m=0;for(x=a.aoColumns.length;m<x;m++){var l=a.aoColumns[m];var n=d?e[m]:f.createElement(l.sCellType);n._DT_CellIndex={row:c,column:m};g.push(n);d&&!l.mRender&&l.mData===m||b.isPlainObject(l.mData)&&l.mData._===m+".display"||(n.innerHTML=N(a,c,m,"display"));l.sClass&&(n.className+=" "+l.sClass);l.bVisible&&!d?q.appendChild(n):!l.bVisible&&
d&&n.parentNode.removeChild(n);l.fnCreatedCell&&l.fnCreatedCell.call(a.oInstance,n,N(a,c,m),k,c,m)}W(a,"aoRowCreatedCallback",null,[q,k,c])}p.nTr.setAttribute("role","row")}function V(a,c){var d=c.nTr,e=c._aData;if(d){if(a=a.rowIdFn(e))d.id=a;e.DT_RowClass&&(a=e.DT_RowClass.split(" "),c.__rowc=c.__rowc?Ca(c.__rowc.concat(a)):a,b(d).removeClass(c.__rowc.join(" ")).addClass(e.DT_RowClass));e.DT_RowAttr&&b(d).attr(e.DT_RowAttr);e.DT_RowData&&b(d).data(e.DT_RowData)}}function aa(a){var c,d,e=a.nTHead,
f=a.nTFoot,p=0===b("th, td",e).length,k=a.oClasses,g=a.aoColumns;p&&(d=b("<tr/>").appendTo(e));var x=0;for(c=g.length;x<c;x++){var q=g[x];var m=b(q.nTh).addClass(q.sClass);p&&m.appendTo(d);a.oFeatures.bSort&&(m.addClass(q.sSortingClass),!1!==q.bSortable&&(m.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Oa(a,q.nTh,x)));q.sTitle!=m[0].innerHTML&&m.html(q.sTitle);Pa(a,"header")(a,m,q,k)}p&&H(a.aoHeader,e);b(e).find(">tr").attr("role","row");b(e).find(">tr>th, >tr>td").addClass(k.sHeaderTH);
b(f).find(">tr>th, >tr>td").addClass(k.sFooterTH);if(null!==f)for(a=a.aoFooter[0],x=0,c=a.length;x<c;x++)q=g[x],q.nTf=a[x].cell,q.sClass&&b(q.nTf).addClass(q.sClass)}function X(a,c,d){var e,f,p=[],k=[],x=a.aoColumns.length;if(c){d===g&&(d=!1);var q=0;for(e=c.length;q<e;q++){p[q]=c[q].slice();p[q].nTr=c[q].nTr;for(f=x-1;0<=f;f--)a.aoColumns[f].bVisible||d||p[q].splice(f,1);k.push([])}q=0;for(e=p.length;q<e;q++){if(a=p[q].nTr)for(;f=a.firstChild;)a.removeChild(f);f=0;for(c=p[q].length;f<c;f++){var m=
x=1;if(k[q][f]===g){a.appendChild(p[q][f].cell);for(k[q][f]=1;p[q+x]!==g&&p[q][f].cell==p[q+x][f].cell;)k[q+x][f]=1,x++;for(;p[q][f+m]!==g&&p[q][f].cell==p[q][f+m].cell;){for(d=0;d<x;d++)k[q+d][f+m]=1;m++}b(p[q][f].cell).attr("rowspan",x).attr("colspan",m)}}}}}function ba(a){var c=W(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==b.inArray(!1,c))na(a,!1);else{c=[];var d=0,e=a.asStripeClasses,f=e.length,p=a.oLanguage,k=a.iInitDisplayStart,x="ssp"==ha(a),q=a.aiDisplay;a.bDrawing=!0;k!==g&&-1!==k&&(a._iDisplayStart=
x?k:k>=a.fnRecordsDisplay()?0:k,a.iInitDisplayStart=-1);k=a._iDisplayStart;var m=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,na(a,!1);else if(!x)a.iDraw++;else if(!a.bDestroying&&!A(a))return;if(0!==q.length)for(p=x?a.aoData.length:m,x=x?0:k;x<p;x++){var l=q[x],n=a.aoData[l];null===n.nTr&&R(a,l);l=n.nTr;if(0!==f){var t=e[d%f];n._sRowStripe!=t&&(b(l).removeClass(n._sRowStripe).addClass(t),n._sRowStripe=t)}W(a,"aoRowCallback",null,[l,n._aData,d,x]);c.push(l);d++}else d=p.sZeroRecords,
1==a.iDraw&&"ajax"==ha(a)?d=p.sLoadingRecords:p.sEmptyTable&&0===a.fnRecordsTotal()&&(d=p.sEmptyTable),c[0]=b("<tr/>",{"class":f?e[0]:""}).append(b("<td />",{valign:"top",colSpan:u(a),"class":a.oClasses.sRowEmpty}).html(d))[0];W(a,"aoHeaderCallback","header",[b(a.nTHead).children("tr")[0],I(a),k,m,q]);W(a,"aoFooterCallback","footer",[b(a.nTFoot).children("tr")[0],I(a),k,m,q]);e=b(a.nTBody);e.children().detach();e.append(b(c));W(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=
!1}}function p(a,b){var c=a.oFeatures,d=c.bFilter;c.bSort&&fb(a);d?ia(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;ba(a);a._drawHold=!1}function q(a){var c=a.oClasses,d=b(a.nTable);d=b("<div/>").insertBefore(d);var e=a.oFeatures,f=b("<div/>",{id:a.sTableId+"_wrapper","class":c.sWrapper+(a.nTFoot?"":" "+c.sNoFooter)});a.nHolding=d[0];a.nTableWrapper=f[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var p=a.sDom.split(""),k,g,x,q,m,l,n=0;n<
p.length;n++){k=null;g=p[n];if("<"==g){x=b("<div/>")[0];q=p[n+1];if("'"==q||'"'==q){m="";for(l=2;p[n+l]!=q;)m+=p[n+l],l++;"H"==m?m=c.sJUIHeader:"F"==m&&(m=c.sJUIFooter);-1!=m.indexOf(".")?(q=m.split("."),x.id=q[0].substr(1,q[0].length-1),x.className=q[1]):"#"==m.charAt(0)?x.id=m.substr(1,m.length-1):x.className=m;n+=l}f.append(x);f=b(x)}else if(">"==g)f=f.parent();else if("l"==g&&e.bPaginate&&e.bLengthChange)k=gb(a);else if("f"==g&&e.bFilter)k=hb(a);else if("r"==g&&e.bProcessing)k=ib(a);else if("t"==
g)k=jb(a);else if("i"==g&&e.bInfo)k=kb(a);else if("p"==g&&e.bPaginate)k=lb(a);else if(0!==E.ext.feature.length)for(x=E.ext.feature,l=0,q=x.length;l<q;l++)if(g==x[l].cFeature){k=x[l].fnInit(a);break}k&&(x=a.aanFeatures,x[g]||(x[g]=[]),x[g].push(k),f.append(k))}d.replaceWith(f);a.nHolding=null}function H(a,c){c=b(c).children("tr");var d,e,f;a.splice(0,a.length);var p=0;for(f=c.length;p<f;p++)a.push([]);p=0;for(f=c.length;p<f;p++){var k=c[p];for(d=k.firstChild;d;){if("TD"==d.nodeName.toUpperCase()||
"TH"==d.nodeName.toUpperCase()){var g=1*d.getAttribute("colspan");var x=1*d.getAttribute("rowspan");g=g&&0!==g&&1!==g?g:1;x=x&&0!==x&&1!==x?x:1;var q=0;for(e=a[p];e[q];)q++;var m=q;var l=1===g?!0:!1;for(e=0;e<g;e++)for(q=0;q<x;q++)a[p+q][m+e]={cell:d,unique:l},a[p+q].nTr=k}d=d.nextSibling}}}function S(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],H(c,b)));b=0;for(var e=c.length;b<e;b++)for(var f=0,p=c[b].length;f<p;f++)!c[b][f].unique||d[f]&&a.bSortCellsTop||(d[f]=c[b][f].cell);return d}function P(a,
c,d){W(a,"aoServerParams","serverParams",[c]);if(c&&b.isArray(c)){var e={},f=/(.*?)\[\]$/;b.each(c,function(a,b){(a=b.name.match(f))?(a=a[0],e[a]||(e[a]=[]),e[a].push(b.value)):e[b.name]=b.value});c=e}var p=a.ajax,k=a.oInstance,g=function(b){W(a,null,"xhr",[a,b,a.jqXHR]);d(b)};if(b.isPlainObject(p)&&p.data){var x=p.data;var q=b.isFunction(x)?x(c,a):x;c=b.isFunction(x)&&q?q:b.extend(!0,c,q);delete p.data}q={data:c,success:function(b){var c=b.error||b.sError;c&&qa(a,0,c);a.json=b;g(b)},dataType:"json",
cache:!1,type:a.sServerMethod,error:function(c,d,e){e=W(a,null,"xhr",[a,null,a.jqXHR]);-1===b.inArray(!0,e)&&("parsererror"==d?qa(a,0,"Invalid JSON response",1):4===c.readyState&&qa(a,0,"Ajax error",7));na(a,!1)}};a.oAjaxData=c;W(a,null,"preXhr",[a,c]);a.fnServerData?a.fnServerData.call(k,a.sAjaxSource,b.map(c,function(a,b){return{name:b,value:a}}),g,a):a.sAjaxSource||"string"===typeof p?a.jqXHR=b.ajax(b.extend(q,{url:p||a.sAjaxSource})):b.isFunction(p)?a.jqXHR=p.call(k,c,g,a):(a.jqXHR=b.ajax(b.extend(q,
p)),p.data=x)}function A(a){return a.bAjaxDataGet?(a.iDraw++,na(a,!0),P(a,fa(a),function(b){da(a,b)}),!1):!0}function fa(a){var c=a.aoColumns,d=c.length,e=a.oFeatures,f=a.oPreviousSearch,p=a.aoPreSearchCols,k=[],g=ta(a);var x=a._iDisplayStart;var q=!1!==e.bPaginate?a._iDisplayLength:-1;var m=function(a,b){k.push({name:a,value:b})};m("sEcho",a.iDraw);m("iColumns",d);m("sColumns",ma(c,"sName").join(","));m("iDisplayStart",x);m("iDisplayLength",q);var l={draw:a.iDraw,columns:[],order:[],start:x,length:q,
search:{value:f.sSearch,regex:f.bRegex}};for(x=0;x<d;x++){var n=c[x];var t=p[x];q="function"==typeof n.mData?"function":n.mData;l.columns.push({data:q,name:n.sName,searchable:n.bSearchable,orderable:n.bSortable,search:{value:t.sSearch,regex:t.bRegex}});m("mDataProp_"+x,q);e.bFilter&&(m("sSearch_"+x,t.sSearch),m("bRegex_"+x,t.bRegex),m("bSearchable_"+x,n.bSearchable));e.bSort&&m("bSortable_"+x,n.bSortable)}e.bFilter&&(m("sSearch",f.sSearch),m("bRegex",f.bRegex));e.bSort&&(b.each(g,function(a,b){l.order.push({column:b.col,
dir:b.dir});m("iSortCol_"+a,b.col);m("sSortDir_"+a,b.dir)}),m("iSortingCols",g.length));c=E.ext.legacy.ajax;return null===c?a.sAjaxSource?k:l:c?k:l}function da(a,b){var c=function(a,c){return b[a]!==g?b[a]:b[c]},d=ua(a,b),e=c("sEcho","draw"),f=c("iTotalRecords","recordsTotal");c=c("iTotalDisplayRecords","recordsFiltered");if(e){if(1*e<a.iDraw)return;a.iDraw=1*e}O(a);a._iRecordsTotal=parseInt(f,10);a._iRecordsDisplay=parseInt(c,10);e=0;for(f=d.length;e<f;e++)B(a,d[e]);a.aiDisplay=a.aiDisplayMaster.slice();
a.bAjaxDataGet=!1;ba(a);a._bInitComplete||Da(a,b);a.bAjaxDataGet=!0;na(a,!1)}function ua(a,c){a=b.isPlainObject(a.ajax)&&a.ajax.dataSrc!==g?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===a?c.aaData||c[a]:""!==a?Q(a)(c):c}function hb(a){var c=a.oClasses,d=a.sTableId,e=a.oLanguage,p=a.oPreviousSearch,k=a.aanFeatures,g='<input type="search" class="'+c.sFilterInput+'"/>',x=e.sSearch;x=x.match(/_INPUT_/)?x.replace("_INPUT_",g):x+g;c=b("<div/>",{id:k.f?null:d+"_filter","class":c.sFilter}).append(b("<label/>").append(x));
k=function(){var b=this.value?this.value:"";b!=p.sSearch&&(ia(a,{sSearch:b,bRegex:p.bRegex,bSmart:p.bSmart,bCaseInsensitive:p.bCaseInsensitive}),a._iDisplayStart=0,ba(a))};g=null!==a.searchDelay?a.searchDelay:"ssp"===ha(a)?400:0;var q=b("input",c).val(p.sSearch).attr("placeholder",e.sSearchPlaceholder).on("keyup.DT search.DT input.DT paste.DT cut.DT",g?Qa(k,g):k).on("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",d);b(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{q[0]!==
f.activeElement&&q.val(p.sSearch)}catch(Xb){}});return c[0]}function ia(a,b,c){var d=a.oPreviousSearch,e=a.aoPreSearchCols,f=function(a){d.sSearch=a.sSearch;d.bRegex=a.bRegex;d.bSmart=a.bSmart;d.bCaseInsensitive=a.bCaseInsensitive},p=function(a){return a.bEscapeRegex!==g?!a.bEscapeRegex:a.bRegex};z(a);if("ssp"!=ha(a)){Ra(a,b.sSearch,c,p(b),b.bSmart,b.bCaseInsensitive);f(b);for(b=0;b<e.length;b++)Ea(a,e[b].sSearch,b,p(e[b]),e[b].bSmart,e[b].bCaseInsensitive);Fa(a)}else f(b);a.bFiltered=!0;W(a,null,
"search",[a])}function Fa(a){for(var c=E.ext.search,d=a.aiDisplay,e,f,p=0,k=c.length;p<k;p++){for(var g=[],q=0,x=d.length;q<x;q++)f=d[q],e=a.aoData[f],c[p](a,e._aFilterData,f,e._aData,q)&&g.push(f);d.length=0;b.merge(d,g)}}function Ea(a,b,c,d,e,f){if(""!==b){var p=[],k=a.aiDisplay;d=va(b,d,e,f);for(e=0;e<k.length;e++)b=a.aoData[k[e]]._aFilterData[c],d.test(b)&&p.push(k[e]);a.aiDisplay=p}}function Ra(a,b,c,d,e,f){d=va(b,d,e,f);f=a.oPreviousSearch.sSearch;var p=a.aiDisplayMaster;e=[];0!==E.ext.search.length&&
(c=!0);var k=mb(a);if(0>=b.length)a.aiDisplay=p.slice();else{if(k||c||f.length>b.length||0!==b.indexOf(f)||a.bSorted)a.aiDisplay=p.slice();b=a.aiDisplay;for(c=0;c<b.length;c++)d.test(a.aoData[b[c]]._sFilterRow)&&e.push(b[c]);a.aiDisplay=e}}function va(a,c,d,e){a=c?a:Sa(a);d&&(a="^(?=.*?"+b.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(a){if('"'===a.charAt(0)){var b=a.match(/^"(.*)"$/);a=b?b[1]:a}return a.replace('"',"")}).join(")(?=.*?")+").*$");return new RegExp(a,e?"i":"")}function mb(a){var b=a.aoColumns,
c,d,e=E.ext.type.search;var f=!1;var p=0;for(c=a.aoData.length;p<c;p++){var k=a.aoData[p];if(!k._aFilterData){var g=[];var q=0;for(d=b.length;q<d;q++){f=b[q];if(f.bSearchable){var x=N(a,p,q,"filter");e[f.sType]&&(x=e[f.sType](x));null===x&&(x="");"string"!==typeof x&&x.toString&&(x=x.toString())}else x="";x.indexOf&&-1!==x.indexOf("&")&&(Ga.innerHTML=x,x=Kb?Ga.textContent:Ga.innerText);x.replace&&(x=x.replace(/[\r\n]/g,""));g.push(x)}k._aFilterData=g;k._sFilterRow=g.join("  ");f=!0}}return f}function nb(a){return{search:a.sSearch,
smart:a.bSmart,regex:a.bRegex,caseInsensitive:a.bCaseInsensitive}}function ob(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function kb(a){var c=a.sTableId,d=a.aanFeatures.i,e=b("<div/>",{"class":a.oClasses.sInfo,id:d?null:c+"_info"});d||(a.aoDrawCallback.push({fn:pb,sName:"information"}),e.attr("role","status").attr("aria-live","polite"),b(a.nTable).attr("aria-describedby",c+"_info"));return e[0]}function pb(a){var c=a.aanFeatures.i;if(0!==c.length){var d=
a.oLanguage,e=a._iDisplayStart+1,f=a.fnDisplayEnd(),p=a.fnRecordsTotal(),k=a.fnRecordsDisplay(),g=k?d.sInfo:d.sInfoEmpty;k!==p&&(g+=" "+d.sInfoFiltered);g+=d.sInfoPostFix;g=qb(a,g);d=d.fnInfoCallback;null!==d&&(g=d.call(a.oInstance,a,e,f,p,k,g));b(c).html(g)}}function qb(a,b){var c=a.fnFormatNumber,d=a._iDisplayStart+1,e=a._iDisplayLength,f=a.fnRecordsDisplay(),p=-1===e;return b.replace(/_START_/g,c.call(a,d)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,
c.call(a,f)).replace(/_PAGE_/g,c.call(a,p?1:Math.ceil(d/e))).replace(/_PAGES_/g,c.call(a,p?1:Math.ceil(f/e)))}function ya(a){var b=a.iInitDisplayStart,c=a.aoColumns;var d=a.oFeatures;var e=a.bDeferLoading;if(a.bInitialised){q(a);aa(a);X(a,a.aoHeader);X(a,a.aoFooter);na(a,!0);d.bAutoWidth&&Na(a);var f=0;for(d=c.length;f<d;f++){var k=c[f];k.sWidth&&(k.nTh.style.width=Z(k.sWidth))}W(a,null,"preInit",[a]);p(a);c=ha(a);if("ssp"!=c||e)"ajax"==c?P(a,[],function(c){var d=ua(a,c);for(f=0;f<d.length;f++)B(a,
d[f]);a.iInitDisplayStart=b;p(a);na(a,!1);Da(a,c)},a):(na(a,!1),Da(a))}else setTimeout(function(){ya(a)},200)}function Da(a,b){a._bInitComplete=!0;(b||a.oInit.aaData)&&r(a);W(a,null,"plugin-init",[a,b]);W(a,"aoInitComplete","init",[a,b])}function Ta(a,b){b=parseInt(b,10);a._iDisplayLength=b;Ua(a);W(a,null,"length",[a,b])}function gb(a){var c=a.oClasses,d=a.sTableId,e=a.aLengthMenu,f=b.isArray(e[0]),p=f?e[0]:e;e=f?e[1]:e;f=b("<select/>",{name:d+"_length","aria-controls":d,"class":c.sLengthSelect});
for(var k=0,g=p.length;k<g;k++)f[0][k]=new Option(e[k],p[k]);var q=b("<div><label/></div>").addClass(c.sLength);a.aanFeatures.l||(q[0].id=d+"_length");q.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",f[0].outerHTML));b("select",q).val(a._iDisplayLength).on("change.DT",function(c){Ta(a,b(this).val());ba(a)});b(a.nTable).on("length.dt.DT",function(c,d,e){a===d&&b("select",q).val(e)});return q[0]}function lb(a){var c=a.sPaginationType,d=E.ext.pager[c],e="function"===typeof d,f=function(a){ba(a)};
c=b("<div/>").addClass(a.oClasses.sPaging+c)[0];var p=a.aanFeatures;e||d.fnInit(a,c,f);p.p||(c.id=a.sTableId+"_paginate",a.aoDrawCallback.push({fn:function(a){if(e){var b=a._iDisplayStart,c=a._iDisplayLength,k=a.fnRecordsDisplay(),g=-1===c;b=g?0:Math.ceil(b/c);c=g?1:Math.ceil(k/c);k=d(b,c);var q;g=0;for(q=p.p.length;g<q;g++)Pa(a,"pageButton")(a,p.p[g],g,k,b,c)}else d.fnUpdate(a,f)},sName:"pagination"}));return c}function Va(a,b,c){var d=a._iDisplayStart,e=a._iDisplayLength,f=a.fnRecordsDisplay();
0===f||-1===e?d=0:"number"===typeof b?(d=b*e,d>f&&(d=0)):"first"==b?d=0:"previous"==b?(d=0<=e?d-e:0,0>d&&(d=0)):"next"==b?d+e<f&&(d+=e):"last"==b?d=Math.floor((f-1)/e)*e:qa(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==d;a._iDisplayStart=d;b&&(W(a,null,"page",[a]),c&&ba(a));return b}function ib(a){return b("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function na(a,c){a.oFeatures.bProcessing&&
b(a.aanFeatures.r).css("display",c?"block":"none");W(a,null,"processing",[a,c])}function jb(a){var c=b(a.nTable);c.attr("role","grid");var d=a.oScroll;if(""===d.sX&&""===d.sY)return a.nTable;var e=d.sX,f=d.sY,p=a.oClasses,k=c.children("caption"),g=k.length?k[0]._captionSide:null,q=b(c[0].cloneNode(!1)),m=b(c[0].cloneNode(!1)),l=c.children("tfoot");l.length||(l=null);q=b("<div/>",{"class":p.sScrollWrapper}).append(b("<div/>",{"class":p.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,
width:e?e?Z(e):null:"100%"}).append(b("<div/>",{"class":p.sScrollHeadInner}).css({"box-sizing":"content-box",width:d.sXInner||"100%"}).append(q.removeAttr("id").css("margin-left",0).append("top"===g?k:null).append(c.children("thead"))))).append(b("<div/>",{"class":p.sScrollBody}).css({position:"relative",overflow:"auto",width:e?Z(e):null}).append(c));l&&q.append(b("<div/>",{"class":p.sScrollFoot}).css({overflow:"hidden",border:0,width:e?e?Z(e):null:"100%"}).append(b("<div/>",{"class":p.sScrollFootInner}).append(m.removeAttr("id").css("margin-left",
0).append("bottom"===g?k:null).append(c.children("tfoot")))));c=q.children();var n=c[0];p=c[1];var x=l?c[2]:null;if(e)b(p).on("scroll.DT",function(a){a=this.scrollLeft;n.scrollLeft=a;l&&(x.scrollLeft=a)});b(p).css(f&&d.bCollapse?"max-height":"height",f);a.nScrollHead=n;a.nScrollBody=p;a.nScrollFoot=x;a.aoDrawCallback.push({fn:Ba,sName:"scrolling"});return q[0]}function Ba(a){var c=a.oScroll,d=c.sX,e=c.sXInner,f=c.sY;c=c.iBarWidth;var p=b(a.nScrollHead),k=p[0].style,q=p.children("div"),m=q[0].style,
l=q.children("table");q=a.nScrollBody;var n=b(q),x=q.style,t=b(a.nScrollFoot).children("div"),h=t.children("table"),H=b(a.nTHead),u=b(a.nTable),w=u[0],y=w.style,C=a.nTFoot?b(a.nTFoot):null,A=a.oBrowser,P=A.bScrollOversize,B=ma(a.aoColumns,"nTh"),O=[],M=[],z=[],J=[],I,T=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};var da=q.scrollHeight>q.clientHeight;if(a.scrollBarVis!==da&&a.scrollBarVis!==g)a.scrollBarVis=da,r(a);else{a.scrollBarVis=
da;u.children("thead, tfoot").remove();if(C){var X=C.clone().prependTo(u);var fa=C.find("tr");X=X.find("tr")}var G=H.clone().prependTo(u);H=H.find("tr");da=G.find("tr");G.find("th, td").removeAttr("tabindex");d||(x.width="100%",p[0].style.width="100%");b.each(S(a,G),function(b,c){I=v(a,b);c.style.width=a.aoColumns[I].sWidth});C&&pa(function(a){a.style.width=""},X);p=u.outerWidth();""===d?(y.width="100%",P&&(u.find("tbody").height()>q.offsetHeight||"scroll"==n.css("overflow-y"))&&(y.width=Z(u.outerWidth()-
c)),p=u.outerWidth()):""!==e&&(y.width=Z(e),p=u.outerWidth());pa(T,da);pa(function(a){z.push(a.innerHTML);O.push(Z(b(a).css("width")))},da);pa(function(a,c){-1!==b.inArray(a,B)&&(a.style.width=O[c])},H);b(da).height(0);C&&(pa(T,X),pa(function(a){J.push(a.innerHTML);M.push(Z(b(a).css("width")))},X),pa(function(a,b){a.style.width=M[b]},fa),b(X).height(0));pa(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+z[b]+"</div>";a.style.width=O[b]},da);C&&pa(function(a,
b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+J[b]+"</div>";a.style.width=M[b]},X);u.outerWidth()<p?(fa=q.scrollHeight>q.offsetHeight||"scroll"==n.css("overflow-y")?p+c:p,P&&(q.scrollHeight>q.offsetHeight||"scroll"==n.css("overflow-y"))&&(y.width=Z(fa-c)),""!==d&&""===e||qa(a,1,"Possible column misalignment",6)):fa="100%";x.width=Z(fa);k.width=Z(fa);C&&(a.nScrollFoot.style.width=Z(fa));!f&&P&&(x.height=Z(w.offsetHeight+c));d=u.outerWidth();l[0].style.width=Z(d);
m.width=Z(d);e=u.height()>q.clientHeight||"scroll"==n.css("overflow-y");f="padding"+(A.bScrollbarLeft?"Left":"Right");m[f]=e?c+"px":"0px";C&&(h[0].style.width=Z(d),t[0].style.width=Z(d),t[0].style[f]=e?c+"px":"0px");u.children("colgroup").insertBefore(u.children("thead"));n.scroll();!a.bSorted&&!a.bFiltered||a._drawHold||(q.scrollTop=0)}}function pa(a,b,c){for(var d=0,e=0,f=b.length,p,k;e<f;){p=b[e].firstChild;for(k=c?c[e].firstChild:null;p;)1===p.nodeType&&(c?a(p,k,d):a(p,d),d++),p=p.nextSibling,
k=c?k.nextSibling:null;e++}}function Na(a){var c=a.nTable,d=a.aoColumns,e=a.oScroll,f=e.sY,p=e.sX,k=e.sXInner,g=d.length,q=y(a,"bVisible"),m=b("th",a.nTHead),l=c.getAttribute("width"),n=c.parentNode,x=!1,t,H=a.oBrowser;e=H.bScrollOversize;(t=c.style.width)&&-1!==t.indexOf("%")&&(l=t);for(t=0;t<q.length;t++){var w=d[q[t]];null!==w.sWidth&&(w.sWidth=rb(w.sWidthOrig,n),x=!0)}if(e||!x&&!p&&!f&&g==u(a)&&g==m.length)for(t=0;t<g;t++)q=v(a,t),null!==q&&(d[q].sWidth=Z(m.eq(t).width()));else{g=b(c).clone().css("visibility",
"hidden").removeAttr("id");g.find("tbody tr").remove();var C=b("<tr/>").appendTo(g.find("tbody"));g.find("thead, tfoot").remove();g.append(b(a.nTHead).clone()).append(b(a.nTFoot).clone());g.find("tfoot th, tfoot td").css("width","");m=S(a,g.find("thead")[0]);for(t=0;t<q.length;t++)w=d[q[t]],m[t].style.width=null!==w.sWidthOrig&&""!==w.sWidthOrig?Z(w.sWidthOrig):"",w.sWidthOrig&&p&&b(m[t]).append(b("<div/>").css({width:w.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(t=0;t<
q.length;t++)x=q[t],w=d[x],b(sb(a,x)).clone(!1).append(w.sContentPadding).appendTo(C);b("[name]",g).removeAttr("name");w=b("<div/>").css(p||f?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(g).appendTo(n);p&&k?g.width(k):p?(g.css("width","auto"),g.removeAttr("width"),g.width()<n.clientWidth&&l&&g.width(n.clientWidth)):f?g.width(n.clientWidth):l&&g.width(l);for(t=f=0;t<q.length;t++)n=b(m[t]),k=n.outerWidth()-n.width(),n=H.bBounding?Math.ceil(m[t].getBoundingClientRect().width):
n.outerWidth(),f+=n,d[q[t]].sWidth=Z(n-k);c.style.width=Z(f);w.remove()}l&&(c.style.width=Z(l));!l&&!p||a._reszEvt||(c=function(){b(h).on("resize.DT-"+a.sInstance,Qa(function(){r(a)}))},e?setTimeout(c,1E3):c(),a._reszEvt=!0)}function rb(a,c){if(!a)return 0;a=b("<div/>").css("width",Z(a)).appendTo(c||f.body);c=a[0].offsetWidth;a.remove();return c}function sb(a,c){var d=tb(a,c);if(0>d)return null;var e=a.aoData[d];return e.nTr?e.anCells[c]:b("<td/>").html(N(a,d,c,"display"))[0]}function tb(a,b){for(var c,
d=-1,e=-1,f=0,p=a.aoData.length;f<p;f++)c=N(a,f,b,"display")+"",c=c.replace(Lb,""),c=c.replace(/&nbsp;/g," "),c.length>d&&(d=c.length,e=f);return e}function Z(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function ta(a){var c=[],d=a.aoColumns;var e=a.aaSortingFixed;var f=b.isPlainObject(e);var p=[];var k=function(a){a.length&&!b.isArray(a[0])?p.push(a):b.merge(p,a)};b.isArray(e)&&k(e);f&&e.pre&&k(e.pre);k(a.aaSorting);f&&e.post&&k(e.post);for(a=0;a<p.length;a++){var q=
p[a][0];k=d[q].aDataSort;e=0;for(f=k.length;e<f;e++){var m=k[e];var l=d[m].sType||"string";p[a]._idx===g&&(p[a]._idx=b.inArray(p[a][1],d[m].asSorting));c.push({src:q,col:m,dir:p[a][1],index:p[a]._idx,type:l,formatter:E.ext.type.order[l+"-pre"]})}}return c}function fb(a){var b,c=[],d=E.ext.type.order,e=a.aoData,f=0,p=a.aiDisplayMaster;z(a);var k=ta(a);var g=0;for(b=k.length;g<b;g++){var q=k[g];q.formatter&&f++;ub(a,q.col)}if("ssp"!=ha(a)&&0!==k.length){g=0;for(b=p.length;g<b;g++)c[p[g]]=g;f===k.length?
p.sort(function(a,b){var d,f=k.length,p=e[a]._aSortData,g=e[b]._aSortData;for(d=0;d<f;d++){var q=k[d];var m=p[q.col];var l=g[q.col];m=m<l?-1:m>l?1:0;if(0!==m)return"asc"===q.dir?m:-m}m=c[a];l=c[b];return m<l?-1:m>l?1:0}):p.sort(function(a,b){var f,p=k.length,g=e[a]._aSortData,q=e[b]._aSortData;for(f=0;f<p;f++){var m=k[f];var l=g[m.col];var n=q[m.col];m=d[m.type+"-"+m.dir]||d["string-"+m.dir];l=m(l,n);if(0!==l)return l}l=c[a];n=c[b];return l<n?-1:l>n?1:0})}a.bSorted=!0}function vb(a){var b=a.aoColumns,
c=ta(a);a=a.oLanguage.oAria;for(var d=0,e=b.length;d<e;d++){var f=b[d];var p=f.asSorting;var k=f.sTitle.replace(/<.*?>/g,"");var g=f.nTh;g.removeAttribute("aria-sort");f.bSortable&&(0<c.length&&c[0].col==d?(g.setAttribute("aria-sort","asc"==c[0].dir?"ascending":"descending"),f=p[c[0].index+1]||p[0]):f=p[0],k+="asc"===f?a.sSortAscending:a.sSortDescending);g.setAttribute("aria-label",k)}}function Wa(a,c,d,e){var f=a.aaSorting,k=a.aoColumns[c].asSorting,q=function(a,c){var d=a._idx;d===g&&(d=b.inArray(a[1],
k));return d+1<k.length?d+1:c?null:0};"number"===typeof f[0]&&(f=a.aaSorting=[f]);d&&a.oFeatures.bSortMulti?(d=b.inArray(c,ma(f,"0")),-1!==d?(c=q(f[d],!0),null===c&&1===f.length&&(c=0),null===c?f.splice(d,1):(f[d][1]=k[c],f[d]._idx=c)):(f.push([c,k[0],0]),f[f.length-1]._idx=0)):f.length&&f[0][0]==c?(c=q(f[0]),f.length=1,f[0][1]=k[c],f[0]._idx=c):(f.length=0,f.push([c,k[0]]),f[0]._idx=0);p(a);"function"==typeof e&&e(a)}function Oa(a,b,c,d){var e=a.aoColumns[c];Xa(b,{},function(b){!1!==e.bSortable&&
(a.oFeatures.bProcessing?(na(a,!0),setTimeout(function(){Wa(a,c,b.shiftKey,d);"ssp"!==ha(a)&&na(a,!1)},0)):Wa(a,c,b.shiftKey,d))})}function Ha(a){var c=a.aLastSort,d=a.oClasses.sSortColumn,e=ta(a),f=a.oFeatures,p;if(f.bSort&&f.bSortClasses){f=0;for(p=c.length;f<p;f++){var k=c[f].src;b(ma(a.aoData,"anCells",k)).removeClass(d+(2>f?f+1:3))}f=0;for(p=e.length;f<p;f++)k=e[f].src,b(ma(a.aoData,"anCells",k)).addClass(d+(2>f?f+1:3))}a.aLastSort=e}function ub(a,b){var c=a.aoColumns[b],d=E.ext.order[c.sSortDataType],
e;d&&(e=d.call(a.oInstance,a,b,n(a,b)));for(var f,p=E.ext.type.order[c.sType+"-pre"],k=0,g=a.aoData.length;k<g;k++)if(c=a.aoData[k],c._aSortData||(c._aSortData=[]),!c._aSortData[b]||d)f=d?e[k]:N(a,k,b,"sort"),c._aSortData[b]=p?p(f):f}function Ia(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var c={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:b.extend(!0,[],a.aaSorting),search:nb(a.oPreviousSearch),columns:b.map(a.aoColumns,function(b,c){return{visible:b.bVisible,search:nb(a.aoPreSearchCols[c])}})};
W(a,"aoStateSaveParams","stateSaveParams",[a,c]);a.oSavedState=c;a.fnStateSaveCallback.call(a.oInstance,a,c)}}function wb(a,c,d){var e,f,p=a.aoColumns;c=function(c){if(c&&c.time){var q=W(a,"aoStateLoadParams","stateLoadParams",[a,k]);if(-1===b.inArray(!1,q)&&(q=a.iStateDuration,!(0<q&&c.time<+new Date-1E3*q||c.columns&&p.length!==c.columns.length))){a.oLoadedState=b.extend(!0,{},k);c.start!==g&&(a._iDisplayStart=c.start,a.iInitDisplayStart=c.start);c.length!==g&&(a._iDisplayLength=c.length);c.order!==
g&&(a.aaSorting=[],b.each(c.order,function(b,c){a.aaSorting.push(c[0]>=p.length?[0,c[1]]:c)}));c.search!==g&&b.extend(a.oPreviousSearch,ob(c.search));if(c.columns)for(e=0,f=c.columns.length;e<f;e++)q=c.columns[e],q.visible!==g&&(p[e].bVisible=q.visible),q.search!==g&&b.extend(a.aoPreSearchCols[e],ob(q.search));W(a,"aoStateLoaded","stateLoaded",[a,k])}}d()};if(a.oFeatures.bStateSave){var k=a.fnStateLoadCallback.call(a.oInstance,a,c);k!==g&&c(k)}else d()}function Ja(a){var c=E.settings;a=b.inArray(a,
ma(c,"nTable"));return-1!==a?c[a]:null}function qa(a,b,c,d){c="DataTables warning: "+(a?"table id="+a.sTableId+" - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(b)h.console&&console.log&&console.log(c);else if(b=E.ext,b=b.sErrMode||b.errMode,a&&W(a,null,"error",[a,d,c]),"alert"==b)alert(c);else{if("throw"==b)throw Error(c);"function"==typeof b&&b(a,d,c)}}function oa(a,c,d,e){b.isArray(d)?b.each(d,function(d,e){b.isArray(e)?oa(a,c,e[0],e[1]):oa(a,
c,e)}):(e===g&&(e=d),c[d]!==g&&(a[e]=c[d]))}function xb(a,c,d){var e;for(e in c)if(c.hasOwnProperty(e)){var f=c[e];b.isPlainObject(f)?(b.isPlainObject(a[e])||(a[e]={}),b.extend(!0,a[e],f)):d&&"data"!==e&&"aaData"!==e&&b.isArray(f)?a[e]=f.slice():a[e]=f}return a}function Xa(a,c,d){b(a).on("click.DT",c,function(b){a.blur();d(b)}).on("keypress.DT",c,function(a){13===a.which&&(a.preventDefault(),d(a))}).on("selectstart.DT",function(){return!1})}function ja(a,b,c,d){c&&a[b].push({fn:c,sName:d})}function W(a,
c,d,e){var f=[];c&&(f=b.map(a[c].slice().reverse(),function(b,c){return b.fn.apply(a.oInstance,e)}));null!==d&&(c=b.Event(d+".dt"),b(a.nTable).trigger(c,e),f.push(c.result));return f}function Ua(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),d=a._iDisplayLength;b>=c&&(b=c-d);b-=b%d;if(-1===d||0>b)b=0;a._iDisplayStart=b}function Pa(a,c){a=a.renderer;var d=E.ext.renderer[c];return b.isPlainObject(a)&&a[c]?d[a[c]]||d._:"string"===typeof a?d[a]||d._:d._}function ha(a){return a.oFeatures.bServerSide?"ssp":
a.ajax||a.sAjaxSource?"ajax":"dom"}function za(a,b){var c=yb.numbers_length,d=Math.floor(c/2);b<=c?a=wa(0,b):a<=d?(a=wa(0,c-2),a.push("ellipsis"),a.push(b-1)):(a>=b-1-d?a=wa(b-(c-2),b):(a=wa(a-d+2,a+d-1),a.push("ellipsis"),a.push(b-1)),a.splice(0,0,"ellipsis"),a.splice(0,0,0));a.DT_el="span";return a}function eb(a){b.each({num:function(b){return Ka(b,a)},"num-fmt":function(b){return Ka(b,a,Ya)},"html-num":function(b){return Ka(b,a,La)},"html-num-fmt":function(b){return Ka(b,a,La,Ya)}},function(b,
c){ca.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(ca.type.search[b+a]=ca.type.search.html)})}function zb(a){return function(){var b=[Ja(this[E.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return E.ext.internal[a].apply(this,b)}}var E=function(e){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new U(Ja(this[ca.iApiIndex])):new U(this)};this.fnAddData=function(a,c){var d=this.api(!0);a=b.isArray(a)&&
(b.isArray(a[0])||b.isPlainObject(a[0]))?d.rows.add(a):d.row.add(a);(c===g||c)&&d.draw();return a.flatten().toArray()};this.fnAdjustColumnSizing=function(a){var b=this.api(!0).columns.adjust(),c=b.settings()[0],d=c.oScroll;a===g||a?b.draw(!1):""===d.sX&&""===d.sY||Ba(c)};this.fnClearTable=function(a){var b=this.api(!0).clear();(a===g||a)&&b.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,b,c){var d=this.api(!0);a=d.rows(a);var e=a.settings()[0],f=e.aoData[a[0][0]];
a.remove();b&&b.call(this,e,f);(c===g||c)&&d.draw();return f};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(a)};this.fnFilter=function(a,b,c,d,e,f){e=this.api(!0);null===b||b===g?e.search(a,c,d,f):e.column(b).search(a,c,d,f);e.draw()};this.fnGetData=function(a,b){var c=this.api(!0);if(a!==g){var d=a.nodeName?a.nodeName.toLowerCase():"";return b!==g||"td"==d||"th"==d?c.cell(a,b).data():c.row(a).data()||null}return c.data().toArray()};this.fnGetNodes=
function(a){var b=this.api(!0);return a!==g?b.row(a).node():b.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(a,b){a=this.api(!0).page(a);(b===g||
b)&&a.draw(!1)};this.fnSetColumnVis=function(a,b,c){a=this.api(!0).column(a).visible(b);(c===g||c)&&a.columns.adjust().draw()};this.fnSettings=function(){return Ja(this[ca.iApiIndex])};this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,b,c,d,e){var f=this.api(!0);c===g||null===c?f.row(b).data(a):f.cell(b,c).data(a);(e===g||e)&&f.columns.adjust();(d===g||d)&&f.draw();return 0};this.fnVersionCheck=ca.fnVersionCheck;
var f=this,p=e===g,q=this.length;p&&(e={});this.oApi=this.internal=ca.internal;for(var m in E.ext.internal)m&&(this[m]=zb(m));this.each(function(){var m={},n=1<q?xb(m,e,!0):e,r=0,h;m=this.getAttribute("id");var v=!1,x=E.defaults,u=b(this);if("table"!=this.nodeName.toLowerCase())qa(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{d(x);k(x.column);a(x,x,!0);a(x.column,x.column,!0);a(x,b.extend(n,u.data()));var la=E.settings;r=0;for(h=la.length;r<h;r++){var y=la[r];if(y.nTable==this||
y.nTHead.parentNode==this||y.nTFoot&&y.nTFoot.parentNode==this){var C=n.bRetrieve!==g?n.bRetrieve:x.bRetrieve;if(p||C)return y.oInstance;if(n.bDestroy!==g?n.bDestroy:x.bDestroy){y.oInstance.fnDestroy();break}else{qa(y,0,"Cannot reinitialise DataTable",3);return}}if(y.sTableId==this.id){la.splice(r,1);break}}if(null===m||""===m)this.id=m="DataTables_Table_"+E.ext._unique++;var A=b.extend(!0,{},E.models.oSettings,{sDestroyWidth:u[0].style.width,sInstance:m,sTableId:m});A.nTable=this;A.oApi=f.internal;
A.oInit=n;la.push(A);A.oInstance=1===f.length?f:u.dataTable();d(n);n.oLanguage&&c(n.oLanguage);n.aLengthMenu&&!n.iDisplayLength&&(n.iDisplayLength=b.isArray(n.aLengthMenu[0])?n.aLengthMenu[0][0]:n.aLengthMenu[0]);n=xb(b.extend(!0,{},x),n);oa(A.oFeatures,n,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));oa(A,n,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu",
"sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);oa(A.oScroll,n,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);oa(A.oLanguage,n,"fnInfoCallback");ja(A,"aoDrawCallback",
n.fnDrawCallback,"user");ja(A,"aoServerParams",n.fnServerParams,"user");ja(A,"aoStateSaveParams",n.fnStateSaveParams,"user");ja(A,"aoStateLoadParams",n.fnStateLoadParams,"user");ja(A,"aoStateLoaded",n.fnStateLoaded,"user");ja(A,"aoRowCallback",n.fnRowCallback,"user");ja(A,"aoRowCreatedCallback",n.fnCreatedRow,"user");ja(A,"aoHeaderCallback",n.fnHeaderCallback,"user");ja(A,"aoFooterCallback",n.fnFooterCallback,"user");ja(A,"aoInitComplete",n.fnInitComplete,"user");ja(A,"aoPreDrawCallback",n.fnPreDrawCallback,
"user");A.rowIdFn=Q(n.rowId);t(A);var P=A.oClasses;n.bJQueryUI?(b.extend(P,E.ext.oJUIClasses,n.oClasses),n.sDom===x.sDom&&"lfrtip"===x.sDom&&(A.sDom='<"H"lfr>t<"F"ip>'),A.renderer)?b.isPlainObject(A.renderer)&&!A.renderer.header&&(A.renderer.header="jqueryui"):A.renderer="jqueryui":b.extend(P,E.ext.classes,n.oClasses);u.addClass(P.sTable);A.iInitDisplayStart===g&&(A.iInitDisplayStart=n.iDisplayStart,A._iDisplayStart=n.iDisplayStart);null!==n.iDeferLoading&&(A.bDeferLoading=!0,m=b.isArray(n.iDeferLoading),
A._iRecordsDisplay=m?n.iDeferLoading[0]:n.iDeferLoading,A._iRecordsTotal=m?n.iDeferLoading[1]:n.iDeferLoading);var O=A.oLanguage;b.extend(!0,O,n.oLanguage);O.sUrl&&(b.ajax({dataType:"json",url:O.sUrl,success:function(d){c(d);a(x.oLanguage,d);b.extend(!0,O,d);ya(A)},error:function(){ya(A)}}),v=!0);null===n.asStripeClasses&&(A.asStripeClasses=[P.sStripeOdd,P.sStripeEven]);m=A.asStripeClasses;var z=u.children("tbody").find("tr").eq(0);-1!==b.inArray(!0,b.map(m,function(a,b){return z.hasClass(a)}))&&
(b("tbody tr",this).removeClass(m.join(" ")),A.asDestroyStripes=m.slice());m=[];la=this.getElementsByTagName("thead");0!==la.length&&(H(A.aoHeader,la[0]),m=S(A));if(null===n.aoColumns)for(la=[],r=0,h=m.length;r<h;r++)la.push(null);else la=n.aoColumns;r=0;for(h=la.length;r<h;r++)l(A,m?m[r]:null);M(A,n.aoColumnDefs,la,function(a,b){w(A,a,b)});if(z.length){var J=function(a,b){return null!==a.getAttribute("data-"+b)?b:null};b(z[0]).children("th, td").each(function(a,b){var c=A.aoColumns[a];if(c.mData===
a){var d=J(b,"sort")||J(b,"order");b=J(b,"filter")||J(b,"search");if(null!==d||null!==b)c.mData={_:a+".display",sort:null!==d?a+".@data-"+d:g,type:null!==d?a+".@data-"+d:g,filter:null!==b?a+".@data-"+b:g},w(A,a)}})}var I=A.oFeatures;m=function(){if(n.aaSorting===g){var a=A.aaSorting;r=0;for(h=a.length;r<h;r++)a[r][1]=A.aoColumns[r].asSorting[0]}Ha(A);I.bSort&&ja(A,"aoDrawCallback",function(){if(A.bSorted){var a=ta(A),c={};b.each(a,function(a,b){c[b.src]=b.dir});W(A,null,"order",[A,a,c]);vb(A)}});
ja(A,"aoDrawCallback",function(){(A.bSorted||"ssp"===ha(A)||I.bDeferRender)&&Ha(A)},"sc");a=u.children("caption").each(function(){this._captionSide=b(this).css("caption-side")});var c=u.children("thead");0===c.length&&(c=b("<thead/>").appendTo(u));A.nTHead=c[0];c=u.children("tbody");0===c.length&&(c=b("<tbody/>").appendTo(u));A.nTBody=c[0];c=u.children("tfoot");0===c.length&&0<a.length&&(""!==A.oScroll.sX||""!==A.oScroll.sY)&&(c=b("<tfoot/>").appendTo(u));0===c.length||0===c.children().length?u.addClass(P.sNoFooter):
0<c.length&&(A.nTFoot=c[0],H(A.aoFooter,A.nTFoot));if(n.aaData)for(r=0;r<n.aaData.length;r++)B(A,n.aaData[r]);else(A.bDeferLoading||"dom"==ha(A))&&G(A,b(A.nTBody).children("tr"));A.aiDisplay=A.aiDisplayMaster.slice();A.bInitialised=!0;!1===v&&ya(A)};n.bStateSave?(I.bStateSave=!0,ja(A,"aoDrawCallback",Ia,"state_save"),wb(A,n,m)):m()}});f=null;return this},ca,L,Y,Za={},Ab=/[\r\n]/g,La=/<.*?>/g,Mb=/^\d{2,4}[\.\/\-]\d{1,2}[\.\/\-]\d{1,2}([T ]{1}\d{1,2}[:\.]\d{2}([\.:]\d{2})?)?$/,Nb=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\|\$|\^|\-)/g,
Ya=/[',$\u00a3\u20ac\u00a5%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,ra=function(a){return a&&!0!==a&&"-"!==a?!1:!0},Bb=function(a){var b=parseInt(a,10);return!isNaN(b)&&isFinite(a)?b:null},Cb=function(a,b){Za[b]||(Za[b]=new RegExp(Sa(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(Za[b],"."):a},$a=function(a,b,c){var d="string"===typeof a;if(ra(a))return!0;b&&d&&(a=Cb(a,b));c&&d&&(a=a.replace(Ya,""));return!isNaN(parseFloat(a))&&isFinite(a)},Db=function(a,b,c){return ra(a)?!0:
ra(a)||"string"===typeof a?$a(a.replace(La,""),b,c)?!0:null:null},ma=function(a,b,c){var d=[],e=0,f=a.length;if(c!==g)for(;e<f;e++)a[e]&&a[e][b]&&d.push(a[e][b][c]);else for(;e<f;e++)a[e]&&d.push(a[e][b]);return d},Aa=function(a,b,c,d){var e=[],f=0,p=b.length;if(d!==g)for(;f<p;f++)a[b[f]][c]&&e.push(a[b[f]][c][d]);else for(;f<p;f++)e.push(a[b[f]][c]);return e},wa=function(a,b){var c=[];if(b===g){b=0;var d=a}else d=b,b=a;for(a=b;a<d;a++)c.push(a);return c},Eb=function(a){for(var b=[],c=0,d=a.length;c<
d;c++)a[c]&&b.push(a[c]);return b},Ca=function(a){var b=[],c=a.length,d,e=0;var f=0;a:for(;f<c;f++){var p=a[f];for(d=0;d<e;d++)if(b[d]===p)continue a;b.push(p);e++}return b};E.util={throttle:function(a,b){var c=b!==g?b:200,d,e;return function(){var b=this,f=+new Date,p=arguments;d&&f<d+c?(clearTimeout(e),e=setTimeout(function(){d=g;a.apply(b,p)},c)):(d=f,a.apply(b,p))}},escapeRegex:function(a){return a.replace(Nb,"\\$1")}};var ka=function(a,b,c){a[b]!==g&&(a[c]=a[b])},xa=/\[.*?\]$/,sa=/\(\)$/,Sa=
E.util.escapeRegex,Ga=b("<div>")[0],Kb=Ga.textContent!==g,Lb=/<.*?>/g,Qa=E.util.throttle,Fb=[],ea=Array.prototype,Ob=function(a){var c,d=E.settings,e=b.map(d,function(a,b){return a.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase()){var f=b.inArray(a,e);return-1!==f?[d[f]]:null}if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?c=b(a):a instanceof b&&(c=a)}else return[];if(c)return c.map(function(a){f=b.inArray(this,e);
return-1!==f?d[f]:null}).toArray()};var U=function(a,c){if(!(this instanceof U))return new U(a,c);var d=[],e=function(a){(a=Ob(a))&&(d=d.concat(a))};if(b.isArray(a))for(var f=0,p=a.length;f<p;f++)e(a[f]);else e(a);this.context=Ca(d);c&&b.merge(this,c);this.selector={rows:null,cols:null,opts:null};U.extend(this,this,Fb)};E.Api=U;b.extend(U.prototype,{any:function(){return 0!==this.count()},concat:ea.concat,context:[],count:function(){return this.flatten().length},each:function(a){for(var b=0,c=this.length;b<
c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new U(b[a],this[a]):null},filter:function(a){var b=[];if(ea.filter)b=ea.filter.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new U(this.context,b)},flatten:function(){var a=[];return new U(this.context,a.concat.apply(a,this.toArray()))},join:ea.join,indexOf:ea.indexOf||function(a,b){b=b||0;for(var c=this.length;b<c;b++)if(this[b]===a)return b;
return-1},iterator:function(a,b,c,d){var e=[],f,p,k=this.context,q,m=this.selector;"string"===typeof a&&(d=c,c=b,b=a,a=!1);var n=0;for(f=k.length;n<f;n++){var l=new U(k[n]);if("table"===b){var t=c.call(l,k[n],n);t!==g&&e.push(t)}else if("columns"===b||"rows"===b)t=c.call(l,k[n],this[n],n),t!==g&&e.push(t);else if("column"===b||"column-rows"===b||"row"===b||"cell"===b){var r=this[n];"column-rows"===b&&(q=Ma(k[n],m.opts));var h=0;for(p=r.length;h<p;h++)t=r[h],t="cell"===b?c.call(l,k[n],t.row,t.column,
n,h):c.call(l,k[n],t,n,h,q),t!==g&&e.push(t)}}return e.length||d?(a=new U(k,a?e.concat.apply([],e):e),b=a.selector,b.rows=m.rows,b.cols=m.cols,b.opts=m.opts,a):this},lastIndexOf:ea.lastIndexOf||function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(ea.map)b=ea.map.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)b.push(a.call(this,this[c],c));return new U(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},
pop:ea.pop,push:ea.push,reduce:ea.reduce||function(a,b){return m(this,a,b,0,this.length,1)},reduceRight:ea.reduceRight||function(a,b){return m(this,a,b,this.length-1,-1,-1)},reverse:ea.reverse,selector:null,shift:ea.shift,sort:ea.sort,splice:ea.splice,toArray:function(){return ea.slice.call(this)},to$:function(){return b(this)},toJQuery:function(){return b(this)},unique:function(){return new U(this.context,Ca(this))},unshift:ea.unshift});U.extend=function(a,c,d){if(d.length&&c&&(c instanceof U||c.__dt_wrapper)){var e,
f=function(a,b,c){return function(){var d=b.apply(a,arguments);U.extend(d,d,c.methodExt);return d}};var p=0;for(e=d.length;p<e;p++){var k=d[p];c[k.name]="function"===typeof k.val?f(a,k.val,k):b.isPlainObject(k.val)?{}:k.val;c[k.name].__dt_wrapper=!0;U.extend(a,c[k.name],k.propExt)}}};U.register=L=function(a,c){if(b.isArray(a))for(var d=0,e=a.length;d<e;d++)U.register(a[d],c);else{e=a.split(".");var f=Fb,p;a=0;for(d=e.length;a<d;a++){var k=(p=-1!==e[a].indexOf("()"))?e[a].replace("()",""):e[a];a:{var g=
0;for(var q=f.length;g<q;g++)if(f[g].name===k){g=f[g];break a}g=null}g||(g={name:k,val:{},methodExt:[],propExt:[]},f.push(g));a===d-1?g.val=c:f=p?g.methodExt:g.propExt}}};U.registerPlural=Y=function(a,c,d){U.register(a,d);U.register(c,function(){var a=d.apply(this,arguments);return a===this?this:a instanceof U?a.length?b.isArray(a[0])?new U(a.context,a[0]):a[0]:g:a})};var Pb=function(a,c){if("number"===typeof a)return[c[a]];var d=b.map(c,function(a,b){return a.nTable});return b(d).filter(a).map(function(a){a=
b.inArray(this,d);return c[a]}).toArray()};L("tables()",function(a){return a?new U(Pb(a,this.context)):this});L("table()",function(a){a=this.tables(a);var b=a.context;return b.length?new U(b[0]):a});Y("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});Y("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});Y("tables().header()","table().header()",function(){return this.iterator("table",
function(a){return a.nTHead},1)});Y("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});Y("tables().containers()","table().container()",function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});L("draw()",function(a){return this.iterator("table",function(b){"page"===a?ba(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),p(b,!1===a))})});L("page()",function(a){return a===g?this.page.info().page:this.iterator("table",
function(b){Va(b,a)})});L("page.info()",function(a){if(0===this.context.length)return g;a=this.context[0];var b=a._iDisplayStart,c=a.oFeatures.bPaginate?a._iDisplayLength:-1,d=a.fnRecordsDisplay(),e=-1===c;return{page:e?0:Math.floor(b/c),pages:e?1:Math.ceil(d/c),start:b,end:a.fnDisplayEnd(),length:c,recordsTotal:a.fnRecordsTotal(),recordsDisplay:d,serverSide:"ssp"===ha(a)}});L("page.len()",function(a){return a===g?0!==this.context.length?this.context[0]._iDisplayLength:g:this.iterator("table",function(b){Ta(b,
a)})});var Gb=function(a,b,c){if(c){var d=new U(a);d.one("draw",function(){c(d.ajax.json())})}if("ssp"==ha(a))p(a,b);else{na(a,!0);var e=a.jqXHR;e&&4!==e.readyState&&e.abort();P(a,[],function(c){O(a);c=ua(a,c);for(var d=0,e=c.length;d<e;d++)B(a,c[d]);p(a,b);na(a,!1)})}};L("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});L("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});L("ajax.reload()",function(a,b){return this.iterator("table",function(c){Gb(c,
!1===b,a)})});L("ajax.url()",function(a){var c=this.context;if(a===g){if(0===c.length)return g;c=c[0];return c.ajax?b.isPlainObject(c.ajax)?c.ajax.url:c.ajax:c.sAjaxSource}return this.iterator("table",function(c){b.isPlainObject(c.ajax)?c.ajax.url=a:c.ajax=a})});L("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Gb(c,!1===b,a)})});var ab=function(a,c,d,e,f){var p=[],k,q,m;var n=typeof c;c&&"string"!==n&&"function"!==n&&c.length!==g||(c=[c]);n=0;for(q=c.length;n<q;n++){var l=
c[n]&&c[n].split&&!c[n].match(/[\[\(:]/)?c[n].split(","):[c[n]];var t=0;for(m=l.length;t<m;t++)(k=d("string"===typeof l[t]?b.trim(l[t]):l[t]))&&k.length&&(p=p.concat(k))}a=ca.selector[a];if(a.length)for(n=0,q=a.length;n<q;n++)p=a[n](e,f,p);return Ca(p)},bb=function(a){a||(a={});a.filter&&a.search===g&&(a.search=a.filter);return b.extend({search:"none",order:"current",page:"all"},a)},cb=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a[0].length=1,a.length=1,a.context=
[a.context[b]],a;a.length=0;return a},Ma=function(a,c){var d=[],e=a.aiDisplay;var f=a.aiDisplayMaster;var p=c.search;var k=c.order;c=c.page;if("ssp"==ha(a))return"removed"===p?[]:wa(0,f.length);if("current"==c)for(f=a._iDisplayStart,a=a.fnDisplayEnd();f<a;f++)d.push(e[f]);else if("current"==k||"applied"==k)d="none"==p?f.slice():"applied"==p?e.slice():b.map(f,function(a,c){return-1===b.inArray(a,e)?a:null});else if("index"==k||"original"==k)for(f=0,a=a.aoData.length;f<a;f++)"none"==p?d.push(f):(k=
b.inArray(f,e),(-1===k&&"removed"==p||0<=k&&"applied"==p)&&d.push(f));return d},Qb=function(a,c,d){var e;return ab("row",c,function(c){var f=Bb(c);if(null!==f&&!d)return[f];e||(e=Ma(a,d));if(null!==f&&-1!==b.inArray(f,e))return[f];if(null===c||c===g||""===c)return e;if("function"===typeof c)return b.map(e,function(b){var d=a.aoData[b];return c(b,d._aData,d.nTr)?b:null});f=Eb(Aa(a.aoData,e,"nTr"));if(c.nodeName){if(c._DT_RowIndex!==g)return[c._DT_RowIndex];if(c._DT_CellIndex)return[c._DT_CellIndex.row];
f=b(c).closest("*[data-dt-row]");return f.length?[f.data("dt-row")]:[]}if("string"===typeof c&&"#"===c.charAt(0)){var p=a.aIds[c.replace(/^#/,"")];if(p!==g)return[p.idx]}return b(f).filter(c).map(function(){return this._DT_RowIndex}).toArray()},a,d)};L("rows()",function(a,c){a===g?a="":b.isPlainObject(a)&&(c=a,a="");c=bb(c);var d=this.iterator("table",function(b){return Qb(b,a,c)},1);d.selector.rows=a;d.selector.opts=c;return d});L("rows().nodes()",function(){return this.iterator("row",function(a,
b){return a.aoData[b].nTr||g},1)});L("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return Aa(a.aoData,b,"_aData")},1)});Y("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){b=b.aoData[c];return"search"===a?b._aFilterData:b._aSortData},1)});Y("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){F(b,c,a)})});Y("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,b){return b},
1)});Y("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,d=0,e=c.length;d<e;d++)for(var f=0,p=this[d].length;f<p;f++){var k=c[d].rowIdFn(c[d].aoData[this[d][f]]._aData);b.push((!0===a?"#":"")+k)}return new U(c,b)});Y("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,c,d){var e=b.aoData,f=e[c],p,k;e.splice(c,1);var q=0;for(p=e.length;q<p;q++){var m=e[q];var n=m.anCells;null!==m.nTr&&(m.nTr._DT_RowIndex=q);if(null!==n)for(m=0,k=n.length;m<k;m++)n[m]._DT_CellIndex.row=
q}T(b.aiDisplayMaster,c);T(b.aiDisplay,c);T(a[d],c,!1);Ua(b);c=b.rowIdFn(f._aData);c!==g&&delete b.aIds[c]});this.iterator("table",function(a){for(var b=0,c=a.aoData.length;b<c;b++)a.aoData[b].idx=b});return this});L("rows.add()",function(a){var c=this.iterator("table",function(b){var c,d=[];var e=0;for(c=a.length;e<c;e++){var f=a[e];f.nodeName&&"TR"===f.nodeName.toUpperCase()?d.push(G(b,f)[0]):d.push(B(b,f))}return d},1),d=this.rows(-1);d.pop();b.merge(d,c);return d});L("row()",function(a,b){return cb(this.rows(a,
b))});L("row().data()",function(a){var b=this.context;if(a===g)return b.length&&this.length?b[0].aoData[this[0]]._aData:g;b[0].aoData[this[0]]._aData=a;F(b[0],this[0],"data");return this});L("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});L("row.add()",function(a){a instanceof b&&a.length&&(a=a[0]);var c=this.iterator("table",function(b){return a.nodeName&&"TR"===a.nodeName.toUpperCase()?G(b,a)[0]:B(b,a)});return this.row(c[0])});var Rb=
function(a,c,d,e){var f=[],p=function(c,d){if(b.isArray(c)||c instanceof b)for(var e=0,k=c.length;e<k;e++)p(c[e],d);else c.nodeName&&"tr"===c.nodeName.toLowerCase()?f.push(c):(e=b("<tr><td/></tr>").addClass(d),b("td",e).addClass(d).html(c)[0].colSpan=u(a),f.push(e[0]))};p(d,e);c._details&&c._details.detach();c._details=b(f);c._detailsShow&&c._details.insertAfter(c.nTr)},db=function(a,b){var c=a.context;c.length&&(a=c[0].aoData[b!==g?b:a[0]])&&a._details&&(a._details.remove(),a._detailsShow=g,a._details=
g)},Hb=function(a,b){var c=a.context;c.length&&a.length&&(a=c[0].aoData[a[0]],a._details&&((a._detailsShow=b)?a._details.insertAfter(a.nTr):a._details.detach(),Sb(c[0])))},Sb=function(a){var b=new U(a),c=a.aoData;b.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<ma(c,"_details").length&&(b.on("draw.dt.DT_details",function(d,e){a===e&&b.rows({page:"current"}).eq(0).each(function(a){a=c[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),b.on("column-visibility.dt.DT_details",
function(b,d,e,f){if(a===d)for(d=u(d),e=0,f=c.length;e<f;e++)b=c[e],b._details&&b._details.children("td[colspan]").attr("colspan",d)}),b.on("destroy.dt.DT_details",function(d,e){if(a===e)for(d=0,e=c.length;d<e;d++)c[d]._details&&db(b,d)}))};L("row().child()",function(a,b){var c=this.context;if(a===g)return c.length&&this.length?c[0].aoData[this[0]]._details:g;!0===a?this.child.show():!1===a?db(this):c.length&&this.length&&Rb(c[0],c[0].aoData[this[0]],a,b);return this});L(["row().child.show()","row().child().show()"],
function(a){Hb(this,!0);return this});L(["row().child.hide()","row().child().hide()"],function(){Hb(this,!1);return this});L(["row().child.remove()","row().child().remove()"],function(){db(this);return this});L("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Tb=/^([^:]+):(name|visIdx|visible)$/,Ib=function(a,b,c,d,e){c=[];d=0;for(var f=e.length;d<f;d++)c.push(N(a,e[d],b));return c},Ub=function(a,c,d){var e=a.aoColumns,
f=ma(e,"sName"),p=ma(e,"nTh");return ab("column",c,function(c){var k=Bb(c);if(""===c)return wa(e.length);if(null!==k)return[0<=k?k:e.length+k];if("function"===typeof c){var g=Ma(a,d);return b.map(e,function(b,d){return c(d,Ib(a,d,0,0,g),p[d])?d:null})}var q="string"===typeof c?c.match(Tb):"";if(q)switch(q[2]){case "visIdx":case "visible":k=parseInt(q[1],10);if(0>k){var m=b.map(e,function(a,b){return a.bVisible?b:null});return[m[m.length+k]]}return[v(a,k)];case "name":return b.map(f,function(a,b){return a===
q[1]?b:null});default:return[]}if(c.nodeName&&c._DT_CellIndex)return[c._DT_CellIndex.column];k=b(p).filter(c).map(function(){return b.inArray(this,p)}).toArray();if(k.length||!c.nodeName)return k;k=b(c).closest("*[data-dt-column]");return k.length?[k.data("dt-column")]:[]},a,d)};L("columns()",function(a,c){a===g?a="":b.isPlainObject(a)&&(c=a,a="");c=bb(c);var d=this.iterator("table",function(b){return Ub(b,a,c)},1);d.selector.cols=a;d.selector.opts=c;return d});Y("columns().header()","column().header()",
function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});Y("columns().footer()","column().footer()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});Y("columns().data()","column().data()",function(){return this.iterator("column-rows",Ib,1)});Y("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});Y("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",
function(b,c,d,e,f){return Aa(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});Y("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,d,e){return Aa(a.aoData,e,"anCells",b)},1)});Y("columns().visible()","column().visible()",function(a,c){var d=this.iterator("column",function(c,d){if(a===g)return c.aoColumns[d].bVisible;var e=c.aoColumns,f=e[d],p=c.aoData,k;if(a!==g&&f.bVisible!==a){if(a){var q=b.inArray(!0,ma(e,"bVisible"),d+1);var m=0;for(k=
p.length;m<k;m++){var n=p[m].nTr;e=p[m].anCells;n&&n.insertBefore(e[d],e[q]||null)}}else b(ma(c.aoData,"anCells",d)).detach();f.bVisible=a;X(c,c.aoHeader);X(c,c.aoFooter);Ia(c)}});a!==g&&(this.iterator("column",function(b,d){W(b,null,"column-visibility",[b,d,a,c])}),(c===g||c)&&this.columns.adjust());return d});Y("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?n(b,c):c},1)});L("columns.adjust()",function(){return this.iterator("table",
function(a){r(a)},1)});L("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return v(c,b);if("fromData"===a||"toVisible"===a)return n(c,b)}});L("column()",function(a,b){return cb(this.columns(a,b))});var Vb=function(a,c,d){var e=a.aoData,f=Ma(a,d),p=Eb(Aa(e,f,"anCells")),k=b([].concat.apply([],p)),q,m=a.aoColumns.length,n,l,t,r,h,v;return ab("cell",c,function(c){var d="function"===typeof c;if(null===c||c===g||d){n=[];l=0;for(t=f.length;l<
t;l++)for(q=f[l],r=0;r<m;r++)h={row:q,column:r},d?(v=e[q],c(h,N(a,q,r),v.anCells?v.anCells[r]:null)&&n.push(h)):n.push(h);return n}if(b.isPlainObject(c))return[c];d=k.filter(c).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray();if(d.length||!c.nodeName)return d;v=b(c).closest("*[data-dt-row]");return v.length?[{row:v.data("dt-row"),column:v.data("dt-column")}]:[]},a,d)};L("cells()",function(a,c,d){b.isPlainObject(a)&&(a.row===g?(d=a,a=null):(d=c,c=null));b.isPlainObject(c)&&
(d=c,c=null);if(null===c||c===g)return this.iterator("table",function(b){return Vb(b,a,bb(d))});var e=this.columns(c,d),f=this.rows(a,d),p,k,q,m,n,l=this.iterator("table",function(a,b){p=[];k=0;for(q=f[b].length;k<q;k++)for(m=0,n=e[b].length;m<n;m++)p.push({row:f[b][k],column:e[b][m]});return p},1);b.extend(l.selector,{cols:c,rows:a,opts:d});return l});Y("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(a,b,c){return(a=a.aoData[b])&&a.anCells?a.anCells[c]:g},1)});L("cells().data()",
function(){return this.iterator("cell",function(a,b,c){return N(a,b,c)},1)});Y("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,d){return b.aoData[c][a][d]},1)});Y("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return N(b,c,d,a)},1)});Y("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,b,c){return{row:b,column:c,columnVisible:n(a,c)}},
1)});Y("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){F(b,c,a,d)})});L("cell()",function(a,b,c){return cb(this.cells(a,b,c))});L("cell().data()",function(a){var b=this.context,c=this[0];if(a===g)return b.length&&c.length?N(b[0],c[0].row,c[0].column):g;J(b[0],c[0].row,c[0].column,a);F(b[0],c[0].row,"data",c[0].column);return this});L("order()",function(a,c){var d=this.context;if(a===g)return 0!==d.length?d[0].aaSorting:g;"number"===typeof a?a=[[a,
c]]:a.length&&!b.isArray(a[0])&&(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});L("order.listener()",function(a,b,c){return this.iterator("table",function(d){Oa(d,a,b,c)})});L("order.fixed()",function(a){if(!a){var c=this.context;c=c.length?c[0].aaSortingFixed:g;return b.isArray(c)?{pre:c}:c}return this.iterator("table",function(c){c.aaSortingFixed=b.extend(!0,{},a)})});L(["columns().order()","column().order()"],function(a){var c=this;return this.iterator("table",
function(d,e){var f=[];b.each(c[e],function(b,c){f.push([c,a])});d.aaSorting=f})});L("search()",function(a,c,d,e){var f=this.context;return a===g?0!==f.length?f[0].oPreviousSearch.sSearch:g:this.iterator("table",function(f){f.oFeatures.bFilter&&ia(f,b.extend({},f.oPreviousSearch,{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===d?!0:d,bCaseInsensitive:null===e?!0:e}),1)})});Y("columns().search()","column().search()",function(a,c,d,e){return this.iterator("column",function(f,p){var k=f.aoPreSearchCols;
if(a===g)return k[p].sSearch;f.oFeatures.bFilter&&(b.extend(k[p],{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===d?!0:d,bCaseInsensitive:null===e?!0:e}),ia(f,f.oPreviousSearch,1))})});L("state()",function(){return this.context.length?this.context[0].oSavedState:null});L("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});L("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null});L("state.save()",function(){return this.iterator("table",
function(a){Ia(a)})});E.versionCheck=E.fnVersionCheck=function(a){var b=E.version.split(".");a=a.split(".");for(var c,d,e=0,f=a.length;e<f;e++)if(c=parseInt(b[e],10)||0,d=parseInt(a[e],10)||0,c!==d)return c>d;return!0};E.isDataTable=E.fnIsDataTable=function(a){var c=b(a).get(0),d=!1;if(a instanceof E.Api)return!0;b.each(E.settings,function(a,e){a=e.nScrollHead?b("table",e.nScrollHead)[0]:null;var f=e.nScrollFoot?b("table",e.nScrollFoot)[0]:null;if(e.nTable===c||a===c||f===c)d=!0});return d};E.tables=
E.fnTables=function(a){var c=!1;b.isPlainObject(a)&&(c=a.api,a=a.visible);var d=b.map(E.settings,function(c){if(!a||a&&b(c.nTable).is(":visible"))return c.nTable});return c?new U(d):d};E.camelToHungarian=a;L("$()",function(a,c){c=this.rows(c).nodes();c=b(c);return b([].concat(c.filter(a).toArray(),c.find(a).toArray()))});b.each(["on","one","off"],function(a,c){L(c+"()",function(){var a=Array.prototype.slice.call(arguments);a[0]=b.map(a[0].split(/\s/),function(a){return a.match(/\.dt\b/)?a:a+".dt"}).join(" ");
var d=b(this.tables().nodes());d[c].apply(d,a);return this})});L("clear()",function(){return this.iterator("table",function(a){O(a)})});L("settings()",function(){return new U(this.context,this.context)});L("init()",function(){var a=this.context;return a.length?a[0].oInit:null});L("data()",function(){return this.iterator("table",function(a){return ma(a.aoData,"_aData")}).flatten()});L("destroy()",function(a){a=a||!1;return this.iterator("table",function(c){var d=c.nTableWrapper.parentNode,e=c.oClasses,
f=c.nTable,p=c.nTBody,k=c.nTHead,g=c.nTFoot,q=b(f);p=b(p);var m=b(c.nTableWrapper),n=b.map(c.aoData,function(a){return a.nTr}),l;c.bDestroying=!0;W(c,"aoDestroyCallback","destroy",[c]);a||(new U(c)).columns().visible(!0);m.off(".DT").find(":not(tbody *)").off(".DT");b(h).off(".DT-"+c.sInstance);f!=k.parentNode&&(q.children("thead").detach(),q.append(k));g&&f!=g.parentNode&&(q.children("tfoot").detach(),q.append(g));c.aaSorting=[];c.aaSortingFixed=[];Ha(c);b(n).removeClass(c.asStripeClasses.join(" "));
b("th, td",k).removeClass(e.sSortable+" "+e.sSortableAsc+" "+e.sSortableDesc+" "+e.sSortableNone);c.bJUI&&(b("th span."+e.sSortIcon+", td span."+e.sSortIcon,k).detach(),b("th, td",k).each(function(){var a=b("div."+e.sSortJUIWrapper,this);b(this).append(a.contents());a.detach()}));p.children().detach();p.append(n);k=a?"remove":"detach";q[k]();m[k]();!a&&d&&(d.insertBefore(f,c.nTableReinsertBefore),q.css("width",c.sDestroyWidth).removeClass(e.sTable),(l=c.asDestroyStripes.length)&&p.children().each(function(a){b(this).addClass(c.asDestroyStripes[a%
l])}));d=b.inArray(c,E.settings);-1!==d&&E.settings.splice(d,1)})});b.each(["column","row","cell"],function(a,b){L(b+"s().every()",function(a){var c=this.selector.opts,d=this;return this.iterator(b,function(e,f,p,k,q){a.call(d[b](f,"cell"===b?p:c,"cell"===b?c:g),f,p,k,q)})})});L("i18n()",function(a,c,d){var e=this.context[0];a=Q(a)(e.oLanguage);a===g&&(a=c);d!==g&&b.isPlainObject(a)&&(a=a[d]!==g?a[d]:a._);return a.replace("%d",d)});E.version="1.10.13";E.settings=[];E.models={};E.models.oSearch={bCaseInsensitive:!0,
sSearch:"",bRegex:!1,bSmart:!0};E.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};E.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,
sTitle:null,sType:null,sWidth:null,sWidthOrig:null};E.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,
fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(la){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===
a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(Wb){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",
sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:b.extend({},E.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",
renderer:null,rowId:"DT_RowId"};e(E.defaults);E.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};e(E.defaults.column);E.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,
bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],
aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:g,oAjaxData:g,
fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==ha(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ha(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=
this._iDisplayLength,b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,e=this.oFeatures,f=e.bPaginate;return e.bServerSide?!1===f||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!f||c>d||-1===a?d:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};E.ext=ca={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},
header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:E.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:E.version};b.extend(ca,{afnFiltering:ca.search,aTypes:ca.type.detect,ofnSearch:ca.type.search,oSort:ca.type.order,afnSortData:ca.order,aoFeatures:ca.feature,oApi:ca.internal,oStdClasses:ca.classes,oPagination:ca.pager});b.extend(E.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",
sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",
sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});b.extend(E.ext.oJUIClasses,E.ext.classes,{sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"ui-state-disabled",
sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:"ui-state-default sorting_asc",sSortDesc:"ui-state-default sorting_desc",sSortable:"ui-state-default sorting",sSortableAsc:"ui-state-default sorting_asc_disabled",sSortableDesc:"ui-state-default sorting_desc_disabled",sSortableNone:"ui-state-default sorting_disabled",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",
sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead ui-state-default",sScrollFoot:"dataTables_scrollFoot ui-state-default",sHeaderTH:"ui-state-default",sFooterTH:"ui-state-default",sJUIHeader:"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix ui-corner-tl ui-corner-tr",sJUIFooter:"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix ui-corner-bl ui-corner-br"});
var yb=E.ext.pager;b.extend(yb,{simple:function(a,b){return["previous","next"]},full:function(a,b){return["first","previous","next","last"]},numbers:function(a,b){return[za(a,b)]},simple_numbers:function(a,b){return["previous",za(a,b),"next"]},full_numbers:function(a,b){return["first","previous",za(a,b),"next","last"]},first_last_numbers:function(a,b){return["first",za(a,b),"last"]},_numbers:za,numbers_length:7});b.extend(!0,E.ext.renderer,{pageButton:{_:function(a,c,d,e,p,k){var q=a.oClasses,m=a.oLanguage.oPaginate,
n=a.oLanguage.oAria.paginate||{},l,t,r=0,h=function(c,e){var f,g=function(b){Va(a,b.data.action,!0)};var v=0;for(f=e.length;v<f;v++){var H=e[v];if(b.isArray(H)){var u=b("<"+(H.DT_el||"div")+"/>").appendTo(c);h(u,H)}else{l=null;t="";switch(H){case "ellipsis":c.append('<span class="ellipsis">&#x2026;</span>');break;case "first":l=m.sFirst;t=H+(0<p?"":" "+q.sPageButtonDisabled);break;case "previous":l=m.sPrevious;t=H+(0<p?"":" "+q.sPageButtonDisabled);break;case "next":l=m.sNext;t=H+(p<k-1?"":" "+q.sPageButtonDisabled);
break;case "last":l=m.sLast;t=H+(p<k-1?"":" "+q.sPageButtonDisabled);break;default:l=H+1,t=p===H?q.sPageButtonActive:""}null!==l&&(u=b("<a>",{"class":q.sPageButton+" "+t,"aria-controls":a.sTableId,"aria-label":n[H],"data-dt-idx":r,tabindex:a.iTabIndex,id:0===d&&"string"===typeof H?a.sTableId+"_"+H:null}).html(l).appendTo(c),Xa(u,{action:H},g),r++)}}};try{var v=b(c).find(f.activeElement).data("dt-idx")}catch(Yb){}h(b(c).empty(),e);v!==g&&b(c).find("[data-dt-idx="+v+"]").focus()}}});b.extend(E.ext.type.detect,
[function(a,b){b=b.oLanguage.sDecimal;return $a(a,b)?"num"+b:null},function(a,b){if(a&&!(a instanceof Date)&&!Mb.test(a))return null;b=Date.parse(a);return null!==b&&!isNaN(b)||ra(a)?"date":null},function(a,b){b=b.oLanguage.sDecimal;return $a(a,b,!0)?"num-fmt"+b:null},function(a,b){b=b.oLanguage.sDecimal;return Db(a,b)?"html-num"+b:null},function(a,b){b=b.oLanguage.sDecimal;return Db(a,b,!0)?"html-num-fmt"+b:null},function(a,b){return ra(a)||"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);
b.extend(E.ext.type.search,{html:function(a){return ra(a)?a:"string"===typeof a?a.replace(Ab," ").replace(La,""):""},string:function(a){return ra(a)?a:"string"===typeof a?a.replace(Ab," "):a}});var Ka=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Cb(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};b.extend(ca.type.order,{"date-pre":function(a){return Date.parse(a)||-Infinity},"html-pre":function(a){return ra(a)?"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():
a+""},"string-pre":function(a){return ra(a)?"":"string"===typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});eb("");b.extend(!0,E.ext.renderer,{header:{_:function(a,c,d,e){b(a.nTable).on("order.dt.DT",function(b,f,p,k){a===f&&(b=d.idx,c.removeClass(d.sSortingClass+" "+e.sSortAsc+" "+e.sSortDesc).addClass("asc"==k[b]?e.sSortAsc:"desc"==k[b]?e.sSortDesc:d.sSortingClass))})},jqueryui:function(a,c,
d,e){b("<div/>").addClass(e.sSortJUIWrapper).append(c.contents()).append(b("<span/>").addClass(e.sSortIcon+" "+d.sSortingClassJUI)).appendTo(c);b(a.nTable).on("order.dt.DT",function(b,f,p,k){a===f&&(b=d.idx,c.removeClass(e.sSortAsc+" "+e.sSortDesc).addClass("asc"==k[b]?e.sSortAsc:"desc"==k[b]?e.sSortDesc:d.sSortingClass),c.find("span."+e.sSortIcon).removeClass(e.sSortJUIAsc+" "+e.sSortJUIDesc+" "+e.sSortJUI+" "+e.sSortJUIAscAllowed+" "+e.sSortJUIDescAllowed).addClass("asc"==k[b]?e.sSortJUIAsc:"desc"==
k[b]?e.sSortJUIDesc:d.sSortingClassJUI))})}}});var Jb=function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):a};E.render={number:function(a,b,c,d,e){return{display:function(f){if("number"!==typeof f&&"string"!==typeof f)return f;var p=0>f?"-":"",k=parseFloat(f);if(isNaN(k))return Jb(f);k=k.toFixed(c);f=Math.abs(k);k=parseInt(f,10);f=c?b+(f-k).toFixed(c).substring(2):"";return p+(d||"")+k.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f+(e||"")}}},text:function(){return{display:Jb}}};
b.extend(E.ext.internal,{_fnExternApiFunc:zb,_fnBuildAjax:P,_fnAjaxUpdate:A,_fnAjaxParameters:fa,_fnAjaxUpdateDraw:da,_fnAjaxDataSrc:ua,_fnAddColumn:l,_fnColumnOptions:w,_fnAdjustColumnSizing:r,_fnVisibleToColumnIndex:v,_fnColumnIndexToVisible:n,_fnVisbleColumns:u,_fnGetColumns:y,_fnColumnTypes:z,_fnApplyColumnDefs:M,_fnHungarianMap:e,_fnCamelToHungarian:a,_fnLanguageCompat:c,_fnBrowserDetect:t,_fnAddData:B,_fnAddTr:G,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==g?b._DT_RowIndex:null},
_fnNodeToColumnIndex:function(a,c,d){return b.inArray(d,a.aoData[c].anCells)},_fnGetCellData:N,_fnSetCellData:J,_fnSplitObjNotation:K,_fnGetObjectDataFn:Q,_fnSetObjectDataFn:C,_fnGetDataMaster:I,_fnClearTable:O,_fnDeleteIndex:T,_fnInvalidate:F,_fnGetRowElements:D,_fnCreateTr:R,_fnBuildHead:aa,_fnDrawHead:X,_fnDraw:ba,_fnReDraw:p,_fnAddOptionsHtml:q,_fnDetectHeader:H,_fnGetUniqueThs:S,_fnFeatureHtmlFilter:hb,_fnFilterComplete:ia,_fnFilterCustom:Fa,_fnFilterColumn:Ea,_fnFilter:Ra,_fnFilterCreateSearch:va,
_fnEscapeRegex:Sa,_fnFilterData:mb,_fnFeatureHtmlInfo:kb,_fnUpdateInfo:pb,_fnInfoMacros:qb,_fnInitialise:ya,_fnInitComplete:Da,_fnLengthChange:Ta,_fnFeatureHtmlLength:gb,_fnFeatureHtmlPaginate:lb,_fnPageChange:Va,_fnFeatureHtmlProcessing:ib,_fnProcessingDisplay:na,_fnFeatureHtmlTable:jb,_fnScrollDraw:Ba,_fnApplyToChildren:pa,_fnCalculateColumnWidths:Na,_fnThrottle:Qa,_fnConvertToWidth:rb,_fnGetWidestNode:sb,_fnGetMaxLenString:tb,_fnStringToCss:Z,_fnSortFlatten:ta,_fnSort:fb,_fnSortAria:vb,_fnSortListener:Wa,
_fnSortAttachListener:Oa,_fnSortingClasses:Ha,_fnSortData:ub,_fnSaveState:Ia,_fnLoadState:wb,_fnSettingsFromNode:Ja,_fnLog:qa,_fnMap:oa,_fnBindAction:Xa,_fnCallbackReg:ja,_fnCallbackFire:W,_fnLengthOverflow:Ua,_fnRenderer:Pa,_fnDataSource:ha,_fnRowAttributes:V,_fnCalculateEnd:function(){}});b.fn.dataTable=E;E.$=b;b.fn.dataTableSettings=E.settings;b.fn.dataTableExt=E.ext;b.fn.DataTable=function(a){return b(this).dataTable(a).api()};b.each(E,function(a,c){b.fn.DataTable[a]=c});return b.fn.dataTable});/*
 jQuery UI - v1.12.1 - 2016-12-12
 http://jqueryui.com
 Includes: widget.js, position.js, disable-selection.js, form-reset-mixin.js, keycode.js, labels.js, unique-id.js, widgets/resizable.js, widgets/accordion.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/menu.js, widgets/mouse.js, widgets/selectmenu.js, widgets/tabs.js, widgets/tooltip.js
 Copyright jQuery Foundation and other contributors; Licensed MIT  jQuery UI Widget 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Position 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license

 http://api.jqueryui.com/position/
 jQuery UI Disable Selection 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Form Reset Mixin 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Keycode 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Labels 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Unique ID 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Mouse 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Resizable 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Accordion 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Controlgroup 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Checkboxradio 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Button 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Menu 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Selectmenu 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Tabs 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Tooltip 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):b(jQuery)})(function(b){b.ui=b.ui||{};b.ui.version="1.12.1";var h=0,f=Array.prototype.slice;b.cleanData=function(a){return function(c){var d,e,f;for(f=0;null!=(e=c[f]);f++)try{(d=b._data(e,"events"))&&d.remove&&b(e).triggerHandler("remove")}catch(m){}a(c)}}(b.cleanData);b.widget=function(a,c,d){var e={},f=a.split(".")[0];a=a.split(".")[1];var g=f+"-"+a;d||(d=c,c=b.Widget);b.isArray(d)&&(d=b.extend.apply(null,[{}].concat(d)));
b.expr[":"][g.toLowerCase()]=function(a){return!!b.data(a,g)};b[f]=b[f]||{};var l=b[f][a];var h=b[f][a]=function(a,b){if(!this._createWidget)return new h(a,b);arguments.length&&this._createWidget(a,b)};b.extend(h,l,{version:d.version,_proto:b.extend({},d),_childConstructors:[]});var r=new c;r.options=b.widget.extend({},r.options);b.each(d,function(a,d){b.isFunction(d)?e[a]=function(){function b(){return c.prototype[a].apply(this,arguments)}function e(b){return c.prototype[a].apply(this,b)}return function(){var a=
this._super,c=this._superApply;this._super=b;this._superApply=e;var f=d.apply(this,arguments);this._super=a;this._superApply=c;return f}}():e[a]=d});h.prototype=b.widget.extend(r,{widgetEventPrefix:l?r.widgetEventPrefix||a:a},e,{constructor:h,namespace:f,widgetName:a,widgetFullName:g});l?(b.each(l._childConstructors,function(a,c){a=c.prototype;b.widget(a.namespace+"."+a.widgetName,h,c._proto)}),delete l._childConstructors):c._childConstructors.push(h);b.widget.bridge(a,h);return h};b.widget.extend=
function(a){for(var c=f.call(arguments,1),d=0,e=c.length,g,m;d<e;d++)for(g in c[d])m=c[d][g],c[d].hasOwnProperty(g)&&void 0!==m&&(b.isPlainObject(m)?a[g]=b.isPlainObject(a[g])?b.widget.extend({},a[g],m):b.widget.extend({},m):a[g]=m);return a};b.widget.bridge=function(a,c){var d=c.prototype.widgetFullName||a;b.fn[a]=function(e){var k="string"===typeof e,g=f.call(arguments,1),l=this;k?this.length||"instance"!==e?this.each(function(){var c=b.data(this,d);if("instance"===e)return l=c,!1;if(!c)return b.error("cannot call methods on "+
a+" prior to initialization; attempted to call method '"+e+"'");if(!b.isFunction(c[e])||"_"===e.charAt(0))return b.error("no such method '"+e+"' for "+a+" widget instance");var f=c[e].apply(c,g);if(f!==c&&void 0!==f)return l=f&&f.jquery?l.pushStack(f.get()):f,!1}):l=void 0:(g.length&&(e=b.widget.extend.apply(null,[e].concat(g))),this.each(function(){var a=b.data(this,d);a?(a.option(e||{}),a._init&&a._init()):b.data(this,d,new c(e,this))}));return l}};b.Widget=function(){};b.Widget._childConstructors=
[];b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(a,c){c=b(c||this.defaultElement||this)[0];this.element=b(c);this.uuid=h++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=b();this.hoverable=b();this.focusable=b();this.classesElementLookup={};c!==this&&(b.data(c,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===c&&this.destroy()}}),this.document=
b(c.style?c.ownerDocument:c.document||c),this.window=b(this.document[0].defaultView||this.document[0].parentWindow));this.options=b.widget.extend({},this.options,this._getCreateOptions(),a);this._create();this.options.disabled&&this._setOptionDisabled(this.options.disabled);this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:b.noop,_create:b.noop,_init:b.noop,destroy:function(){var a=this;this._destroy();b.each(this.classesElementLookup,
function(b,d){a._removeClass(d,b)});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace)},_destroy:b.noop,widget:function(){return this.element},option:function(a,c){var d=a,e;if(0===arguments.length)return b.widget.extend({},this.options);if("string"===typeof a){d={};var f=a.split(".");a=f.shift();if(f.length){var g=d[a]=b.widget.extend({},this.options[a]);for(e=0;e<f.length-
1;e++)g[f[e]]=g[f[e]]||{},g=g[f[e]];a=f.pop();if(1===arguments.length)return void 0===g[a]?null:g[a];g[a]=c}else{if(1===arguments.length)return void 0===this.options[a]?null:this.options[a];d[a]=c}}this._setOptions(d);return this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){"classes"===a&&this._setOptionClasses(b);this.options[a]=b;"disabled"===a&&this._setOptionDisabled(b);return this},_setOptionClasses:function(a){var c;for(c in a){var d=
this.classesElementLookup[c];if(a[c]!==this.options.classes[c]&&d&&d.length){var e=b(d.get());this._removeClass(d,c);e.addClass(this._classes({element:e,keys:c,classes:a,add:!0}))}}},_setOptionDisabled:function(a){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!a);a&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},
_classes:function(a){function c(c,f){var k;for(k=0;k<c.length;k++){var g=e.classesElementLookup[c[k]]||b();g=a.add?b(b.unique(g.get().concat(a.element.get()))):b(g.not(a.element).get());e.classesElementLookup[c[k]]=g;d.push(c[k]);f&&a.classes[c[k]]&&d.push(a.classes[c[k]])}}var d=[],e=this;a=b.extend({element:this.element,classes:this.options.classes||{}},a);this._on(a.element,{remove:"_untrackClassesElement"});a.keys&&c(a.keys.match(/\S+/g)||[],!0);a.extra&&c(a.extra.match(/\S+/g)||[]);return d.join(" ")},
_untrackClassesElement:function(a){var c=this;b.each(c.classesElementLookup,function(d,e){-1!==b.inArray(a.target,e)&&(c.classesElementLookup[d]=b(e.not(a.target).get()))})},_removeClass:function(a,b,d){return this._toggleClass(a,b,d,!1)},_addClass:function(a,b,d){return this._toggleClass(a,b,d,!0)},_toggleClass:function(a,b,d,e){e="boolean"===typeof e?e:d;var c="string"===typeof a||null===a;a={extra:c?b:d,keys:c?a:b,element:c?this.element:a,add:e};a.element.toggleClass(this._classes(a),e);return this},
_on:function(a,c,d){var e,f=this;"boolean"!==typeof a&&(d=c,c=a,a=!1);d?(c=e=b(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget());b.each(d,function(d,k){function g(){if(a||!0!==f.options.disabled&&!b(this).hasClass("ui-state-disabled"))return("string"===typeof k?f[k]:k).apply(f,arguments)}"string"!==typeof k&&(g.guid=k.guid=k.guid||g.guid||b.guid++);var m=d.match(/^([\w:-]*)\s*(.*)$/);d=m[1]+f.eventNamespace;if(m=m[2])e.on(d,m,g);else c.on(d,g)})},_off:function(a,c){c=(c||
"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.off(c).off(c);this.bindings=b(this.bindings.not(a).get());this.focusable=b(this.focusable.not(a).get());this.hoverable=b(this.hoverable.not(a).get())},_delay:function(a,b){var c=this;return setTimeout(function(){return("string"===typeof a?c[a]:a).apply(c,arguments)},b||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(a){this._addClass(b(a.currentTarget),null,"ui-state-hover")},mouseleave:function(a){this._removeClass(b(a.currentTarget),
null,"ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(a){this._addClass(b(a.currentTarget),null,"ui-state-focus")},focusout:function(a){this._removeClass(b(a.currentTarget),null,"ui-state-focus")}})},_trigger:function(a,c,d){var e,f=this.options[a];d=d||{};c=b.Event(c);c.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();c.target=this.element[0];if(a=c.originalEvent)for(e in a)e in c||(c[e]=a[e]);this.element.trigger(c,
d);return!(b.isFunction(f)&&!1===f.apply(this.element[0],[c].concat(d))||c.isDefaultPrevented())}};b.each({show:"fadeIn",hide:"fadeOut"},function(a,c){b.Widget.prototype["_"+a]=function(d,e,f){"string"===typeof e&&(e={effect:e});var k=e?!0===e||"number"===typeof e?c:e.effect||c:a;e=e||{};"number"===typeof e&&(e={duration:e});var g=!b.isEmptyObject(e);e.complete=f;e.delay&&d.delay(e.delay);if(g&&b.effects&&b.effects.effect[k])d[a](e);else if(k!==a&&d[k])d[k](e.duration,e.easing,f);else d.queue(function(c){b(this)[a]();
f&&f.call(d[0]);c()})}});(function(){function a(a,b,c){return[parseFloat(a[0])*(v.test(a[0])?b/100:1),parseFloat(a[1])*(v.test(a[1])?c/100:1)]}function c(a){var c=a[0];return 9===c.nodeType?{width:a.width(),height:a.height(),offset:{top:0,left:0}}:b.isWindow(c)?{width:a.width(),height:a.height(),offset:{top:a.scrollTop(),left:a.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:a.outerWidth(),height:a.outerHeight(),offset:a.offset()}}var d,e=Math.max,f=Math.abs,
g=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,r=/^\w+/,v=/%$/,n=b.fn.position;b.position={scrollbarWidth:function(){if(void 0!==d)return d;var a=b("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>");var c=a.children()[0];b("body").append(a);var e=c.offsetWidth;a.css("overflow","scroll");c=c.offsetWidth;e===c&&(c=a[0].clientWidth);a.remove();return d=e-c},getScrollInfo:function(a){var c=a.isWindow||
a.isDocument?"":a.element.css("overflow-x"),d=a.isWindow||a.isDocument?"":a.element.css("overflow-y");c="scroll"===c||"auto"===c&&a.width<a.element[0].scrollWidth;return{width:"scroll"===d||"auto"===d&&a.height<a.element[0].scrollHeight?b.position.scrollbarWidth():0,height:c?b.position.scrollbarWidth():0}},getWithinInfo:function(a){var c=b(a||window),d=b.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:d||e?{left:0,top:0}:b(a).offset(),scrollLeft:c.scrollLeft(),
scrollTop:c.scrollTop(),width:c.outerWidth(),height:c.outerHeight()}}};b.fn.position=function(d){if(!d||!d.of)return n.apply(this,arguments);d=b.extend({},d);var k=b(d.of),m=b.position.getWithinInfo(d.within),t=b.position.getScrollInfo(m),v=(d.collision||"flip").split(" "),u={};var w=c(k);k[0].preventDefault&&(d.at="left top");var J=w.width;var K=w.height;var Q=w.offset;var C=b.extend({},Q);b.each(["my","at"],function(){var a=(d[this]||"").split(" ");1===a.length&&(a=g.test(a[0])?a.concat(["center"]):
l.test(a[0])?["center"].concat(a):["center","center"]);a[0]=g.test(a[0])?a[0]:"center";a[1]=l.test(a[1])?a[1]:"center";var b=h.exec(a[0]);var c=h.exec(a[1]);u[this]=[b?b[0]:0,c?c[0]:0];d[this]=[r.exec(a[0])[0],r.exec(a[1])[0]]});1===v.length&&(v[1]=v[0]);"right"===d.at[0]?C.left+=J:"center"===d.at[0]&&(C.left+=J/2);"bottom"===d.at[1]?C.top+=K:"center"===d.at[1]&&(C.top+=K/2);var I=a(u.at,J,K);C.left+=I[0];C.top+=I[1];return this.each(function(){var c,g=b(this),n=g.outerWidth(),l=g.outerHeight(),r=
parseInt(b.css(this,"marginLeft"),10)||0,h=parseInt(b.css(this,"marginTop"),10)||0,w=n+r+(parseInt(b.css(this,"marginRight"),10)||0)+t.width,y=l+h+(parseInt(b.css(this,"marginBottom"),10)||0)+t.height,B=b.extend({},C),p=a(u.my,g.outerWidth(),g.outerHeight());"right"===d.my[0]?B.left-=n:"center"===d.my[0]&&(B.left-=n/2);"bottom"===d.my[1]?B.top-=l:"center"===d.my[1]&&(B.top-=l/2);B.left+=p[0];B.top+=p[1];var q={marginLeft:r,marginTop:h};b.each(["left","top"],function(a,c){if(b.ui.position[v[a]])b.ui.position[v[a]][c](B,
{targetWidth:J,targetHeight:K,elemWidth:n,elemHeight:l,collisionPosition:q,collisionWidth:w,collisionHeight:y,offset:[I[0]+p[0],I[1]+p[1]],my:d.my,at:d.at,within:m,elem:g})});d.using&&(c=function(a){var b=Q.left-B.left,c=b+J-n,p=Q.top-B.top,q=p+K-l,m={target:{element:k,left:Q.left,top:Q.top,width:J,height:K},element:{element:g,left:B.left,top:B.top,width:n,height:l},horizontal:0>c?"left":0<b?"right":"center",vertical:0>q?"top":0<p?"bottom":"middle"};J<n&&f(b+c)<J&&(m.horizontal="center");K<l&&f(p+
q)<K&&(m.vertical="middle");e(f(b),f(c))>e(f(p),f(q))?m.important="horizontal":m.important="vertical";d.using.call(this,a,m)});g.offset(b.extend(B,{using:c}))})};b.ui.position={fit:{left:function(a,b){var c=b.within,d=c.isWindow?c.scrollLeft:c.offset.left,f=c.width,k=a.left-b.collisionPosition.marginLeft;c=d-k;var g=k+b.collisionWidth-f-d;b.collisionWidth>f?0<c&&0>=g?(b=a.left+c+b.collisionWidth-f-d,a.left+=c-b):a.left=0<g&&0>=c?d:c>g?d+f-b.collisionWidth:d:a.left=0<c?a.left+c:0<g?a.left-g:e(a.left-
k,a.left)},top:function(a,b){var c=b.within,d=c.isWindow?c.scrollTop:c.offset.top,f=b.within.height,k=a.top-b.collisionPosition.marginTop;c=d-k;var g=k+b.collisionHeight-f-d;b.collisionHeight>f?0<c&&0>=g?(b=a.top+c+b.collisionHeight-f-d,a.top+=c-b):a.top=0<g&&0>=c?d:c>g?d+f-b.collisionHeight:d:a.top=0<c?a.top+c:0<g?a.top-g:e(a.top-k,a.top)}},flip:{left:function(a,b){var c=b.within,d=c.offset.left+c.scrollLeft,e=c.width,k=c.isWindow?c.scrollLeft:c.offset.left,g=a.left-b.collisionPosition.marginLeft;
c=g-k;var m=g+b.collisionWidth-e-k;g="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0;var n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,l=-2*b.offset[0];if(0>c){if(b=a.left+g+n+l+b.collisionWidth-e-d,0>b||b<f(c))a.left+=g+n+l}else 0<m&&(b=a.left-b.collisionPosition.marginLeft+g+n+l-k,0<b||f(b)<m)&&(a.left+=g+n+l)},top:function(a,b){var c=b.within,d=c.offset.top+c.scrollTop,e=c.height,k=c.isWindow?c.scrollTop:c.offset.top,g=a.top-b.collisionPosition.marginTop;c=g-
k;var m=g+b.collisionHeight-e-k;g="top"===b.my[1]?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0;var n="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,l=-2*b.offset[1];if(0>c){if(b=a.top+g+n+l+b.collisionHeight-e-d,0>b||b<f(c))a.top+=g+n+l}else 0<m&&(b=a.top-b.collisionPosition.marginTop+g+n+l-k,0<b||f(b)<m)&&(a.top+=g+n+l)}},flipfit:{left:function(){b.ui.position.flip.left.apply(this,arguments);b.ui.position.fit.left.apply(this,arguments)},top:function(){b.ui.position.flip.top.apply(this,
arguments);b.ui.position.fit.top.apply(this,arguments)}}}})();b.fn.extend({disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(a+".ui-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});b.fn.form=function(){return"string"===typeof this[0].form?this.closest("form"):b(this[0].form)};b.ui.formResetMixin={_formResetHandler:function(){var a=b(this);
setTimeout(function(){var c=a.data("ui-form-reset-instances");b.each(c,function(){this.refresh()})})},_bindFormResetHandler:function(){this.form=this.element.form();if(this.form.length){var a=this.form.data("ui-form-reset-instances")||[];if(!a.length)this.form.on("reset.ui-form-reset",this._formResetHandler);a.push(this);this.form.data("ui-form-reset-instances",a)}},_unbindFormResetHandler:function(){if(this.form.length){var a=this.form.data("ui-form-reset-instances");a.splice(b.inArray(this,a),1);
a.length?this.form.data("ui-form-reset-instances",a):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}};b.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};b.ui.escapeSelector=function(){var a=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(b){return b.replace(a,"\\$1")}}();b.fn.labels=function(){var a;if(this[0].labels&&this[0].labels.length)return this.pushStack(this[0].labels);
var c=this.eq(0).parents("label");if(a=this.attr("id")){var d=this.eq(0).parents().last();d=d.add(d.length?d.siblings():this.siblings());a="label[for='"+b.ui.escapeSelector(a)+"']";c=c.add(d.find(a).addBack(a))}return this.pushStack(c)};b.fn.extend({uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&b(this).removeAttr("id")})}});b.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());
var g=!1;b(document).on("mouseup",function(){g=!1});b.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.on("mousedown."+this.widgetName,function(b){return a._mouseDown(b)}).on("click."+this.widgetName,function(c){if(!0===b.data(c.target,a.widgetName+".preventClickEvent"))return b.removeData(c.target,a.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1});this.started=!1},_mouseDestroy:function(){this.element.off("."+
this.widgetName);this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(a){if(!g){this._mouseMoved=!1;this._mouseStarted&&this._mouseUp(a);this._mouseDownEvent=a;var c=this,d=1===a.which,e="string"===typeof this.options.cancel&&a.target.nodeName?b(a.target).closest(this.options.cancel).length:!1;if(!d||e||!this._mouseCapture(a))return!0;this.mouseDelayMet=!this.options.delay;this.mouseDelayMet||
(this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=!1!==this._mouseStart(a),!this._mouseStarted))return a.preventDefault(),!0;!0===b.data(a.target,this.widgetName+".preventClickEvent")&&b.removeData(a.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(a){return c._mouseMove(a)};this._mouseUpDelegate=function(a){return c._mouseUp(a)};this.document.on("mousemove."+
this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate);a.preventDefault();return g=!0}},_mouseMove:function(a){if(this._mouseMoved){if(b.ui.ie&&(!document.documentMode||9>document.documentMode)&&!a.button)return this._mouseUp(a);if(!a.which)if(a.originalEvent.altKey||a.originalEvent.ctrlKey||a.originalEvent.metaKey||a.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(a)}if(a.which||a.button)this._mouseMoved=
!0;if(this._mouseStarted)return this._mouseDrag(a),a.preventDefault();this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&((this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,a))?this._mouseDrag(a):this._mouseUp(a));return!this._mouseStarted},_mouseUp:function(a){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);this._mouseStarted&&(this._mouseStarted=!1,a.target===this._mouseDownEvent.target&&b.data(a.target,this.widgetName+
".preventClickEvent",!0),this._mouseStop(a));this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer);g=this.ignoreMissingWhich=!1;a.preventDefault()},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});
b.ui.plugin={add:function(a,c,d){var e;a=b.ui[a].prototype;for(e in d)a.plugins[e]=a.plugins[e]||[],a.plugins[e].push([c,d[e]])},call:function(a,b,d,e){if((b=a.plugins[b])&&(e||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(e=0;e<b.length;e++)a.options[b[e][0]]&&b[e][1].apply(a.element,d)}};b.widget("ui.resizable",b.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},
containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(a){return parseFloat(a)||0},_isNumber:function(a){return!isNaN(parseFloat(a))},_hasScroll:function(a,c){if("hidden"===b(a).css("overflow"))return!1;c=c&&"left"===c?"scrollLeft":"scrollTop";if(0<a[c])return!0;a[c]=1;var d=0<a[c];a[c]=0;return d},_create:function(){var a=this.options,c=this;this._addClass("ui-resizable");b.extend(this,
{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)){this.element.wrap(b("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));
this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance"));this.elementIsWrapper=!0;var d={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")};this.element.css(d);this.originalElement.css("margin",0);this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",
zoom:1,display:"block"}));this.originalElement.css(d);this._proportionallyResize()}this._setupHandles();if(a.autoHide)b(this.element).on("mouseenter",function(){a.disabled||(c._removeClass("ui-resizable-autohide"),c._handles.show())}).on("mouseleave",function(){a.disabled||c.resizing||(c._addClass("ui-resizable-autohide"),c._handles.hide())});this._mouseInit()},_destroy:function(){this._mouseDestroy();var a=function(a){b(a).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};
if(this.elementIsWrapper){a(this.element);var c=this.element;this.originalElement.css({position:c.css("position"),width:c.outerWidth(),height:c.outerHeight(),top:c.css("top"),left:c.css("left")}).insertAfter(c);c.remove()}this.originalElement.css("resize",this.originalResizeStyle);a(this.originalElement);return this},_setOption:function(a,b){this._super(a,b);switch(a){case "handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var a=this.options,c,d=this;this.handles=a.handles||
(b(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");this._handles=b();if(this.handles.constructor===String){"all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var e=this.handles.split(",");this.handles={};for(c=0;c<e.length;c++){var f=b.trim(e[c]);var g="ui-resizable-"+f;var l=b("<div>");this._addClass(l,"ui-resizable-handle "+
g);l.css({zIndex:a.zIndex});this.handles[f]=".ui-resizable-"+f;this.element.append(l)}}this._renderAxis=function(a){var c;a=a||this.element;for(c in this.handles){if(this.handles[c].constructor===String)this.handles[c]=this.element.children(this.handles[c]).first().show();else if(this.handles[c].jquery||this.handles[c].nodeType)this.handles[c]=b(this.handles[c]),this._on(this.handles[c],{mousedown:d._mouseDown});if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)){var e=
b(this.handles[c],this.element);var f=/sw|ne|nw|se|n|s/.test(c)?e.outerHeight():e.outerWidth();e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join("");a.css(e,f);this._proportionallyResize()}this._handles=this._handles.add(this.handles[c])}};this._renderAxis(this.element);this._handles=this._handles.add(this.element.find(".ui-resizable-handle"));this._handles.disableSelection();this._handles.on("mouseover",function(){d.resizing||(this.className&&(l=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),
d.axis=l&&l[1]?l[1]:"se")});a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(a){var c,d=!1;for(c in this.handles){var e=b(this.handles[c])[0];if(e===a.target||b.contains(e,a.target))d=!0}return!this.options.disabled&&d},_mouseStart:function(a){var c=this.options,d=this.element;this.resizing=!0;this._renderProxy();var e=this._num(this.helper.css("left"));var f=this._num(this.helper.css("top"));c.containment&&
(e+=b(c.containment).scrollLeft()||0,f+=b(c.containment).scrollTop()||0);this.offset=this.helper.offset();this.position={left:e,top:f};this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:d.width(),height:d.height()};this.originalSize=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.sizeDiff={width:d.outerWidth()-d.width(),height:d.outerHeight()-d.height()};this.originalPosition={left:e,top:f};this.originalMousePosition=
{left:a.pageX,top:a.pageY};this.aspectRatio="number"===typeof c.aspectRatio?c.aspectRatio:this.originalSize.width/this.originalSize.height||1;e=b(".ui-resizable-"+this.axis).css("cursor");b("body").css("cursor","auto"===e?this.axis+"-resize":e);this._addClass("ui-resizable-resizing");this._propagate("start",a);return!0},_mouseDrag:function(a){var c=this.originalMousePosition;var d=a.pageX-c.left||0;c=a.pageY-c.top||0;var e=this._change[this.axis];this._updatePrevProperties();if(!e)return!1;d=e.apply(this,
[a,d,c]);this._updateVirtualBoundaries(a.shiftKey);if(this._aspectRatio||a.shiftKey)d=this._updateRatio(d,a);d=this._respectSize(d,a);this._updateCache(d);this._propagate("resize",a);d=this._applyChanges();!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();b.isEmptyObject(d)||(this._updatePrevProperties(),this._trigger("resize",a,this.ui()),this._applyChanges());return!1},_mouseStop:function(a){this.resizing=!1;var c,d=this.options;if(this._helper){var e=this._proportionallyResizeElements;
e=(c=e.length&&/textarea/i.test(e[0].nodeName))&&this._hasScroll(e[0],"left")?0:this.sizeDiff.height;c=c?0:this.sizeDiff.width;c={width:this.helper.width()-c,height:this.helper.height()-e};e=parseFloat(this.element.css("left"))+(this.position.left-this.originalPosition.left)||null;var f=parseFloat(this.element.css("top"))+(this.position.top-this.originalPosition.top)||null;d.animate||this.element.css(b.extend(c,{top:f,left:e}));this.helper.height(this.size.height);this.helper.width(this.size.width);
this._helper&&!d.animate&&this._proportionallyResize()}b("body").css("cursor","auto");this._removeClass("ui-resizable-resizing");this._propagate("stop",a);this._helper&&this.helper.remove();return!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var a={};this.position.top!==this.prevPosition.top&&(a.top=this.position.top+"px");this.position.left!==this.prevPosition.left&&
(a.left=this.position.left+"px");this.size.width!==this.prevSize.width&&(a.width=this.size.width+"px");this.size.height!==this.prevSize.height&&(a.height=this.size.height+"px");this.helper.css(a);return a},_updateVirtualBoundaries:function(a){var b=this.options;b={minWidth:this._isNumber(b.minWidth)?b.minWidth:0,maxWidth:this._isNumber(b.maxWidth)?b.maxWidth:Infinity,minHeight:this._isNumber(b.minHeight)?b.minHeight:0,maxHeight:this._isNumber(b.maxHeight)?b.maxHeight:Infinity};if(this._aspectRatio||
a){a=b.minHeight*this.aspectRatio;var d=b.minWidth/this.aspectRatio;var e=b.maxHeight*this.aspectRatio;var f=b.maxWidth/this.aspectRatio;a>b.minWidth&&(b.minWidth=a);d>b.minHeight&&(b.minHeight=d);e<b.maxWidth&&(b.maxWidth=e);f<b.maxHeight&&(b.maxHeight=f)}this._vBoundaries=b},_updateCache:function(a){this.offset=this.helper.offset();this._isNumber(a.left)&&(this.position.left=a.left);this._isNumber(a.top)&&(this.position.top=a.top);this._isNumber(a.height)&&(this.size.height=a.height);this._isNumber(a.width)&&
(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,d=this.size,e=this.axis;this._isNumber(a.height)?a.width=a.height*this.aspectRatio:this._isNumber(a.width)&&(a.height=a.width/this.aspectRatio);"sw"===e&&(a.left=b.left+(d.width-a.width),a.top=null);"nw"===e&&(a.top=b.top+(d.height-a.height),a.left=b.left+(d.width-a.width));return a},_respectSize:function(a){var b=this._vBoundaries,d=this.axis,e=this._isNumber(a.width)&&b.maxWidth&&b.maxWidth<a.width,f=this._isNumber(a.height)&&
b.maxHeight&&b.maxHeight<a.height,g=this._isNumber(a.width)&&b.minWidth&&b.minWidth>a.width,l=this._isNumber(a.height)&&b.minHeight&&b.minHeight>a.height,h=this.originalPosition.left+this.originalSize.width,r=this.originalPosition.top+this.originalSize.height,v=/sw|nw|w/.test(d);d=/nw|ne|n/.test(d);g&&(a.width=b.minWidth);l&&(a.height=b.minHeight);e&&(a.width=b.maxWidth);f&&(a.height=b.maxHeight);g&&v&&(a.left=h-b.minWidth);e&&v&&(a.left=h-b.maxWidth);l&&d&&(a.top=r-b.minHeight);f&&d&&(a.top=r-b.maxHeight);
a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null;return a},_getPaddingPlusBorderDimensions:function(a){var b=0,d=[],e=[a.css("borderTopWidth"),a.css("borderRightWidth"),a.css("borderBottomWidth"),a.css("borderLeftWidth")];for(a=[a.css("paddingTop"),a.css("paddingRight"),a.css("paddingBottom"),a.css("paddingLeft")];4>b;b++)d[b]=parseFloat(e[b])||0,d[b]+=parseFloat(a[b])||0;return{height:d[0]+d[2],width:d[1]+d[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var a,
b=0,d=this.helper||this.element;b<this._proportionallyResizeElements.length;b++)a=this._proportionallyResizeElements[b],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(a)),a.css({height:d.height()-this.outerDimensions.height||0,width:d.width()-this.outerDimensions.width||0})},_renderProxy:function(){var a=this.options;this.elementOffset=this.element.offset();this._helper?(this.helper=this.helper||b("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,
this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++a.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){return{left:this.originalPosition.left+b,width:this.originalSize.width-b}},n:function(a,b,d){return{top:this.originalPosition.top+d,height:this.originalSize.height-
d}},s:function(a,b,d){return{height:this.originalSize.height+d}},se:function(a,c,d){return b.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[a,c,d]))},sw:function(a,c,d){return b.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[a,c,d]))},ne:function(a,c,d){return b.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[a,c,d]))},nw:function(a,c,d){return b.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[a,c,d]))}},
_propagate:function(a,c){b.ui.plugin.call(this,a,[c,this.ui()]);"resize"!==a&&this._trigger(a,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});b.ui.plugin.add("resizable","animate",{stop:function(a){var c=b(this).resizable("instance"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),
g=f&&c._hasScroll(e[0],"left")?0:c.sizeDiff.height;f={width:c.size.width-(f?0:c.sizeDiff.width),height:c.size.height-g};g=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null;var l=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null;c.element.animate(b.extend(f,l&&g?{top:l,left:g}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseFloat(c.element.css("width")),height:parseFloat(c.element.css("height")),top:parseFloat(c.element.css("top")),
left:parseFloat(c.element.css("left"))};e&&e.length&&b(e[0]).css({width:d.width,height:d.height});c._updateCache(d);c._propagate("resize",a)}})}});b.ui.plugin.add("resizable","containment",{start:function(){var a=b(this).resizable("instance"),c=a.element;var d=a.options.containment;if(c=d instanceof b?d.get(0):/parent/.test(d)?c.parent().get(0):d)if(a.containerElement=b(c),/document/.test(d)||d===document)a.containerOffset={left:0,top:0},a.containerPosition={left:0,top:0},a.parentData={element:b(document),
left:0,top:0,width:b(document).width(),height:b(document).height()||document.body.parentNode.scrollHeight};else{var e=b(c);var f=[];b(["Top","Right","Left","Bottom"]).each(function(b,c){f[b]=a._num(e.css("padding"+c))});a.containerOffset=e.offset();a.containerPosition=e.position();a.containerSize={height:e.innerHeight()-f[3],width:e.innerWidth()-f[1]};d=a.containerOffset;var g=a.containerSize.height;var l=a.containerSize.width;l=a._hasScroll(c,"left")?c.scrollWidth:l;g=a._hasScroll(c)?c.scrollHeight:
g;a.parentData={element:c,left:d.left,top:d.top,width:l,height:g}}},resize:function(a){var c=b(this).resizable("instance");var d=c.options;var e=c.containerOffset;var f=c.position;a=c._aspectRatio||a.shiftKey;var g={top:0,left:0},l=c.containerElement,h=!0;l[0]!==document&&/static/.test(l.css("position"))&&(g=e);f.left<(c._helper?e.left:0)&&(c.size.width+=c._helper?c.position.left-e.left:c.position.left-g.left,a&&(c.size.height=c.size.width/c.aspectRatio,h=!1),c.position.left=d.helper?e.left:0);f.top<
(c._helper?e.top:0)&&(c.size.height+=c._helper?c.position.top-e.top:c.position.top,a&&(c.size.width=c.size.height*c.aspectRatio,h=!1),c.position.top=c._helper?e.top:0);d=c.containerElement.get(0)===c.element.parent().get(0);f=/relative|absolute/.test(c.containerElement.css("position"));d&&f?(c.offset.left=c.parentData.left+c.position.left,c.offset.top=c.parentData.top+c.position.top):(c.offset.left=c.element.offset().left,c.offset.top=c.element.offset().top);d=Math.abs(c.sizeDiff.width+(c._helper?
c.offset.left-g.left:c.offset.left-e.left));e=Math.abs(c.sizeDiff.height+(c._helper?c.offset.top-g.top:c.offset.top-e.top));d+c.size.width>=c.parentData.width&&(c.size.width=c.parentData.width-d,a&&(c.size.height=c.size.width/c.aspectRatio,h=!1));e+c.size.height>=c.parentData.height&&(c.size.height=c.parentData.height-e,a&&(c.size.width=c.size.height*c.aspectRatio,h=!1));h||(c.position.left=c.prevPosition.left,c.position.top=c.prevPosition.top,c.size.width=c.prevSize.width,c.size.height=c.prevSize.height)},
stop:function(){var a=b(this).resizable("instance"),c=a.options,d=a.containerOffset,e=a.containerPosition,f=a.containerElement,g=b(a.helper),l=g.offset(),h=g.outerWidth()-a.sizeDiff.width;g=g.outerHeight()-a.sizeDiff.height;a._helper&&!c.animate&&/relative/.test(f.css("position"))&&b(this).css({left:l.left-e.left-d.left,width:h,height:g});a._helper&&!c.animate&&/static/.test(f.css("position"))&&b(this).css({left:l.left-e.left-d.left,width:h,height:g})}});b.ui.plugin.add("resizable","alsoResize",{start:function(){var a=
b(this).resizable("instance").options;b(a.alsoResize).each(function(){var a=b(this);a.data("ui-resizable-alsoresize",{width:parseFloat(a.width()),height:parseFloat(a.height()),left:parseFloat(a.css("left")),top:parseFloat(a.css("top"))})})},resize:function(a,c){a=b(this).resizable("instance");var d=a.originalSize,e=a.originalPosition,f={height:a.size.height-d.height||0,width:a.size.width-d.width||0,top:a.position.top-e.top||0,left:a.position.left-e.left||0};b(a.options.alsoResize).each(function(){var a=
b(this),d=b(this).data("ui-resizable-alsoresize"),e={},g=a.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];b.each(g,function(a,b){(a=(d[b]||0)+(f[b]||0))&&0<=a&&(e[b]=a||null)});a.css(e)})},stop:function(){b(this).removeData("ui-resizable-alsoresize")}});b.ui.plugin.add("resizable","ghost",{start:function(){var a=b(this).resizable("instance"),c=a.size;a.ghost=a.originalElement.clone();a.ghost.css({opacity:.25,display:"block",position:"relative",height:c.height,
width:c.width,margin:0,left:0,top:0});a._addClass(a.ghost,"ui-resizable-ghost");!1!==b.uiBackCompat&&"string"===typeof a.options.ghost&&a.ghost.addClass(this.options.ghost);a.ghost.appendTo(a.helper)},resize:function(){var a=b(this).resizable("instance");a.ghost&&a.ghost.css({position:"relative",height:a.size.height,width:a.size.width})},stop:function(){var a=b(this).resizable("instance");a.ghost&&a.helper&&a.helper.get(0).removeChild(a.ghost.get(0))}});b.ui.plugin.add("resizable","grid",{resize:function(){var a=
b(this).resizable("instance"),c=a.options,d=a.size,e=a.originalSize,f=a.originalPosition,g=a.axis,l="number"===typeof c.grid?[c.grid,c.grid]:c.grid,h=l[0]||1,r=l[1]||1,v=Math.round((d.width-e.width)/h)*h;d=Math.round((d.height-e.height)/r)*r;var n=e.width+v,u=e.height+d,y=c.maxWidth&&c.maxWidth<n,z=c.maxHeight&&c.maxHeight<u,M=c.minWidth&&c.minWidth>n,B=c.minHeight&&c.minHeight>u;c.grid=l;M&&(n+=h);B&&(u+=r);y&&(n-=h);z&&(u-=r);if(/^(se|s|e)$/.test(g))a.size.width=n,a.size.height=u;else if(/^(ne)$/.test(g))a.size.width=
n,a.size.height=u,a.position.top=f.top-d;else if(/^(sw)$/.test(g))a.size.width=n,a.size.height=u,a.position.left=f.left-v;else{if(0>=u-r||0>=n-h)var G=a._getPaddingPlusBorderDimensions(this);0<u-r?(a.size.height=u,a.position.top=f.top-d):(u=r-G.height,a.size.height=u,a.position.top=f.top+e.height-u);0<n-h?(a.size.width=n,a.position.left=f.left-v):(n=h-G.width,a.size.width=n,a.position.left=f.left+e.width-n)}}});b.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top",
"ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",
height:"show"},_create:function(){var a=this.options;this.prevShow=this.prevHide=b();this._addClass("ui-accordion","ui-widget ui-helper-reset");this.element.attr("role","tablist");a.collapsible||!1!==a.active&&null!=a.active||(a.active=0);this._processPanels();0>a.active&&(a.active+=this.headers.length);this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():b()}},_createIcons:function(){var a=this.options.icons;if(a){var c=b("<span>");
this._addClass(c,"ui-accordion-header-icon","ui-icon "+a.header);c.prependTo(this.headers);c=this.active.children(".ui-accordion-header-icon");this._removeClass(c,a.header)._addClass(c,null,a.activeHeader)._addClass(this.headers,"ui-accordion-icons")}},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons");this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){this.element.removeAttr("role");this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId();
this._destroyIcons();var a=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId();"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){"active"===a?this._activate(b):("event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b||!1!==this.options.active||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons()))},_setOptionDisabled:function(a){this._super(a);
this.element.attr("aria-disabled",a);this._toggleClass(null,"ui-state-disabled",!!a);this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!a)},_keydown:function(a){if(!a.altKey&&!a.ctrlKey){var c=b.ui.keyCode,d=this.headers.length,e=this.headers.index(a.target),f=!1;switch(a.keyCode){case c.RIGHT:case c.DOWN:f=this.headers[(e+1)%d];break;case c.LEFT:case c.UP:f=this.headers[(e-1+d)%d];break;case c.SPACE:case c.ENTER:this._eventHandler(a);break;case c.HOME:f=this.headers[0];
break;case c.END:f=this.headers[d-1]}f&&(b(a.target).attr("tabIndex",-1),b(f).attr("tabIndex",0),b(f).trigger("focus"),a.preventDefault())}},_panelKeyDown:function(a){a.keyCode===b.ui.keyCode.UP&&a.ctrlKey&&b(a.currentTarget).prev().trigger("focus")},refresh:function(){var a=this.options;this._processPanels();!1===a.active&&!0===a.collapsible||!this.headers.length?(a.active=!1,this.active=b()):!1===a.active?this._activate(0):this.active.length&&!b.contains(this.element[0],this.active[0])?this.headers.length===
this.headers.find(".ui-state-disabled").length?(a.active=!1,this.active=b()):this._activate(Math.max(0,a.active-1)):a.active=this.headers.index(this.active);this._destroyIcons();this._refresh()},_processPanels:function(){var a=this.headers,b=this.panels;this.headers=this.element.find(this.options.header);this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default");this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide();this._addClass(this.panels,
"ui-accordion-content","ui-helper-reset ui-widget-content");b&&(this._off(a.not(this.headers)),this._off(b.not(this.panels)))},_refresh:function(){var a=this.options,c=a.heightStyle,d=this.element.parent();this.active=this._findActive(a.active);this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed");this._addClass(this.active.next(),"ui-accordion-content-active");this.active.next().show();this.headers.attr("role","tab").each(function(){var a=
b(this),c=a.uniqueId().attr("id"),d=a.next(),e=d.uniqueId().attr("id");a.attr("aria-controls",e);d.attr("aria-labelledby",c)}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide();this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0);this._createIcons();this._setupEvents(a.event);
if("fill"===c){var e=d.height();this.element.siblings(":visible").each(function(){var a=b(this),c=a.css("position");"absolute"!==c&&"fixed"!==c&&(e-=a.outerHeight(!0))});this.headers.each(function(){e-=b(this).outerHeight(!0)});this.headers.next().each(function(){b(this).height(Math.max(0,e-b(this).innerHeight()+b(this).height()))}).css("overflow","auto")}else"auto"===c&&(e=0,this.headers.next().each(function(){var a=b(this).is(":visible");a||b(this).show();e=Math.max(e,b(this).css("height","").height());
a||b(this).hide()}).height(e))},_activate:function(a){a=this._findActive(a)[0];a!==this.active[0]&&(a=a||this.active[0],this._eventHandler({target:a,currentTarget:a,preventDefault:b.noop}))},_findActive:function(a){return"number"===typeof a?this.headers.eq(a):b()},_setupEvents:function(a){var c={keydown:"_keydown"};a&&b.each(a.split(" "),function(a,b){c[b]="_eventHandler"});this._off(this.headers.add(this.headers.next()));this._on(this.headers,c);this._on(this.headers.next(),{keydown:"_panelKeyDown"});
this._hoverable(this.headers);this._focusable(this.headers)},_eventHandler:function(a){var c,d=this.options,e=this.active,f=b(a.currentTarget),g=(c=f[0]===e[0])&&d.collapsible,l=g?b():f.next(),h=e.next();l={oldHeader:e,oldPanel:h,newHeader:g?b():f,newPanel:l};a.preventDefault();c&&!d.collapsible||!1===this._trigger("beforeActivate",a,l)||(d.active=g?!1:this.headers.index(f),this.active=c?b():f,this._toggle(l),this._removeClass(e,"ui-accordion-header-active","ui-state-active"),d.icons&&(a=e.children(".ui-accordion-header-icon"),
this._removeClass(a,null,d.icons.activeHeader)._addClass(a,null,d.icons.header)),c||(this._removeClass(f,"ui-accordion-header-collapsed")._addClass(f,"ui-accordion-header-active","ui-state-active"),d.icons&&(c=f.children(".ui-accordion-header-icon"),this._removeClass(c,null,d.icons.header)._addClass(c,null,d.icons.activeHeader)),this._addClass(f.next(),"ui-accordion-content-active")))},_toggle:function(a){var c=a.newPanel,d=this.prevShow.length?this.prevShow:a.oldPanel;this.prevShow.add(this.prevHide).stop(!0,
!0);this.prevShow=c;this.prevHide=d;this.options.animate?this._animate(c,d,a):(d.hide(),c.show(),this._toggleComplete(a));d.attr({"aria-hidden":"true"});d.prev().attr({"aria-selected":"false","aria-expanded":"false"});c.length&&d.length?d.prev().attr({tabIndex:-1,"aria-expanded":"false"}):c.length&&this.headers.filter(function(){return 0===parseInt(b(this).attr("tabIndex"),10)}).attr("tabIndex",-1);c.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},
_animate:function(a,b,d){var c,e,f=this,g=0,h=a.css("box-sizing"),r=a.length&&(!b.length||a.index()<b.index()),v=this.options.animate||{};r=r&&v.down||v;var n=function(){f._toggleComplete(d)};"number"===typeof r&&(e=r);"string"===typeof r&&(c=r);c=c||r.easing||v.easing;e=e||r.duration||v.duration;if(!b.length)return a.animate(this.showProps,e,c,n);if(!a.length)return b.animate(this.hideProps,e,c,n);var u=a.show().outerHeight();b.animate(this.hideProps,{duration:e,easing:c,step:function(a,b){b.now=
Math.round(a)}});a.hide().animate(this.showProps,{duration:e,easing:c,complete:n,step:function(a,c){c.now=Math.round(a);"height"!==c.prop?"content-box"===h&&(g+=c.now):"content"!==f.options.heightStyle&&(c.now=Math.round(u-b.outerHeight()-g),g=0)}})},_toggleComplete:function(a){var b=a.oldPanel,d=b.prev();this._removeClass(b,"ui-accordion-content-active");this._removeClass(d,"ui-accordion-header-active")._addClass(d,"ui-accordion-header-collapsed");b.length&&(b.parent()[0].className=b.parent()[0].className);
this._trigger("activate",null,a)}});var e=/ui-corner-([a-z]){2,6}/g;b.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role",
"toolbar");this.refresh()},_destroy:function(){this._callChildMethod("destroy");this.childWidgets.removeData("ui-controlgroup-data");this.element.removeAttr("role");this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var a=this,c=[];b.each(this.options.items,function(d,e){var f={};e&&("controlgroupLabel"===d?(e=a.element.find(e),e.each(function(){var a=b(this);a.children(".ui-controlgroup-label-contents").length||
a.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),a._addClass(e,null,"ui-widget ui-widget-content ui-state-default"),c=c.concat(e.get())):b.fn[d]&&(f=a["_"+d+"Options"]?a["_"+d+"Options"]("middle"):{classes:{}},a.element.find(e).each(function(){var e=b(this),g=e[d]("instance"),k=b.widget.extend({},f);"button"===d&&e.parent(".ui-spinner").length||(g||(g=e[d]()[d]("instance")),g&&(k.classes=a._resolveClassesValues(k.classes,g)),e[d](k),k=e[d]("widget"),b.data(k[0],"ui-controlgroup-data",
g?g:e[d]("instance")),c.push(k[0]))})))});this.childWidgets=b(b.unique(c));this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(a){this.childWidgets.each(function(){var c=b(this).data("ui-controlgroup-data");if(c&&c[a])c[a]()})},_updateCornerClass:function(a,b){b=this._buildSimpleOptions(b,"label").classes.label;this._removeClass(a,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all");this._addClass(a,null,b)},_buildSimpleOptions:function(a,
b){var c="vertical"===this.options.direction,e={classes:{}};e.classes[b]={middle:"",first:"ui-corner-"+(c?"top":"left"),last:"ui-corner-"+(c?"bottom":"right"),only:"ui-corner-all"}[a];return e},_spinnerOptions:function(a){a=this._buildSimpleOptions(a,"ui-spinner");a.classes["ui-spinner-up"]="";a.classes["ui-spinner-down"]="";return a},_buttonOptions:function(a){return this._buildSimpleOptions(a,"ui-button")},_checkboxradioOptions:function(a){return this._buildSimpleOptions(a,"ui-checkboxradio-label")},
_selectmenuOptions:function(a){var b="vertical"===this.options.direction;return{width:b?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(b?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(b?"top":"left")},last:{"ui-selectmenu-button-open":b?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(b?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[a]}},
_resolveClassesValues:function(a,c){var d={};b.each(a,function(f){var g=c.options.classes[f]||"";g=b.trim(g.replace(e,""));d[f]=(g+" "+a[f]).replace(/\s+/g," ")});return d},_setOption:function(a,b){"direction"===a&&this._removeClass("ui-controlgroup-"+this.options.direction);this._super(a,b);"disabled"===a?this._callChildMethod(b?"disable":"enable"):this.refresh()},refresh:function(){var a=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction);"horizontal"===this.options.direction&&
this._addClass(null,"ui-helper-clearfix");this._initWidgets();var c=this.childWidgets;this.options.onlyVisible&&(c=c.filter(":visible"));c.length&&(b.each(["first","last"],function(b,e){(b=c[e]().data("ui-controlgroup-data"))&&a["_"+b.widgetName+"Options"]?(e=a["_"+b.widgetName+"Options"](1===c.length?"only":e),e.classes=a._resolveClassesValues(e.classes,b),b.element[b.widgetName](e)):a._updateCornerClass(c[e](),e)}),this._callChildMethod("refresh"))}});b.widget("ui.checkboxradio",[b.ui.formResetMixin,
{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var a=this,c=this._super()||{};this._readType();var d=this.element.labels();this.label=b(d[d.length-1]);this.label.length||b.error("No label found for checkboxradio widget");this.originalLabel="";this.label.contents().not(this.element[0]).each(function(){a.originalLabel+=3===this.nodeType?b(this).text():this.outerHTML});
this.originalLabel&&(c.label=this.originalLabel);d=this.element[0].disabled;null!=d&&(c.disabled=d);return c},_create:function(){var a=this.element[0].checked;this._bindFormResetHandler();null==this.options.disabled&&(this.options.disabled=this.element[0].disabled);this._setOption("disabled",this.options.disabled);this._addClass("ui-checkboxradio","ui-helper-hidden-accessible");this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget");"radio"===this.type&&this._addClass(this.label,
"ui-checkboxradio-radio-label");this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel);this._enhance();a&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover"));this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},
_readType:function(){var a=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type;"input"===a&&/radio|checkbox/.test(this.type)||b.error("Can't create checkboxradio on element.nodeName="+a+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var a=this.element[0].name,c="input[name='"+b.ui.escapeSelector(a)+"']";return a?(this.form.length?b(this.form[0].elements).filter(c):b(c).filter(function(){return 0===
b(this).form().length})).not(this.element):b([])},_toggleClasses:function(){var a=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",a);this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",a)._toggleClass(this.icon,null,"ui-icon-blank",!a);"radio"===this.type&&this._getRadioGroup().each(function(){var a=b(this).checkboxradio("instance");a&&a._removeClass(a.label,"ui-checkboxradio-checked","ui-state-active")})},
_destroy:function(){this._unbindFormResetHandler();this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(a,b){if("label"!==a||b)this._super(a,b),"disabled"===a?(this._toggleClass(this.label,null,"ui-state-disabled",b),this.element[0].disabled=b):this.refresh()},_updateIcon:function(a){var c="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=b("<span>"),this.iconSpace=b("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===
this.type?(c+=a?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,a?"ui-icon-blank":"ui-icon-check")):c+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",c),a||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var a=this.label.contents().not(this.element[0]);this.icon&&(a=a.not(this.icon[0]));
this.iconSpace&&(a=a.not(this.iconSpace[0]));a.remove();this.label.append(this.options.label)},refresh:function(){var a=this.element[0].checked,b=this.element[0].disabled;this._updateIcon(a);this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",a);null!==this.options.label&&this._updateLabel();b!==this.options.disabled&&this._setOptions({disabled:b})}}]);b.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,
icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var a=this._super()||{};this.isInput=this.element.is("input");var b=this.element[0].disabled;null!=b&&(a.disabled=b);if(this.originalLabel=this.isInput?this.element.val():this.element.html())a.label=this.originalLabel;return a},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0);null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1);this.hasTitle=
!!this.element.attr("title");this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label));this._addClass("ui-button","ui-widget");this._setOption("disabled",this.options.disabled);this._enhance();this.element.is("a")&&this._on({keyup:function(a){a.keyCode===b.ui.keyCode.SPACE&&(a.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||
this.element.attr("role","button");this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title");this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(a,c){var d=(a="iconPosition"!==a)?this.options.iconPosition:c,e="top"===d||"bottom"===d;this.icon?a&&this._removeClass(this.icon,null,this.options.icon):(this.icon=b("<span>"),this._addClass(this.icon,"ui-button-icon",
"ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only"));a&&this._addClass(this.icon,null,c);this._attachIcon(d);e?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=b("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(d))},_destroy:function(){this.element.removeAttr("role");this.icon&&this.icon.remove();
this.iconSpace&&this.iconSpace.remove();this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(a){this.icon[/^(?:end|bottom)/.test(a)?"before":"after"](this.iconSpace)},_attachIcon:function(a){this.element[/^(?:end|bottom)/.test(a)?"append":"prepend"](this.icon)},_setOptions:function(a){var b=void 0===a.icon?this.options.icon:a.icon;(void 0===a.showLabel?this.options.showLabel:a.showLabel)||b||(a.showLabel=!0);this._super(a)},_setOption:function(a,b){"icon"===a&&(b?this._updateIcon(a,
b):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove()));"iconPosition"===a&&this._updateIcon(a,b);"showLabel"===a&&(this._toggleClass("ui-button-icon-only",null,!b),this._updateTooltip());"label"===a&&(this.isInput?this.element.val(b):(this.element.html(b),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition))));this._super(a,b);"disabled"===a&&(this._toggleClass(null,"ui-state-disabled",b),(this.element[0].disabled=b)&&this.element.blur())},
refresh:function(){var a=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");a!==this.options.disabled&&this._setOptions({disabled:a});this._updateTooltip()}});!1!==b.uiBackCompat&&(b.widget("ui.button",b.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text);!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel);
this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end");this._super()},_setOption:function(a,b){"text"===a?this._super("showLabel",b):("showLabel"===a&&(this.options.text=b),"icon"===a&&(this.options.icons.primary=b),"icons"===a&&(b.primary?(this._super("icon",
b.primary),this._super("iconPosition","beginning")):b.secondary&&(this._super("icon",b.secondary),this._super("iconPosition","end"))),this._superApply(arguments))}}),b.fn.button=function(a){return function(){if(!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type"))return a.apply(this,arguments);b.ui.checkboxradio||b.error("Checkboxradio widget missing");return 0===arguments.length?this.checkboxradio({icon:!1}):
this.checkboxradio.apply(this,arguments)}}(b.fn.button),b.fn.buttonset=function(){b.ui.controlgroup||b.error("Controlgroup widget missing");if("option"===arguments[0]&&"items"===arguments[1]&&arguments[2])return this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]);if("option"===arguments[0]&&"items"===arguments[1])return this.controlgroup.apply(this,[arguments[0],"items.button"]);"object"===typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items});
return this.controlgroup.apply(this,arguments)});b.ui.safeActiveElement=function(a){try{var b=a.activeElement}catch(d){b=a.body}b||(b=a.body);b.nodeName||(b=a.body);return b};b.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=!1;this.element.uniqueId().attr({role:this.options.role,
tabIndex:0});this._addClass("ui-menu","ui-widget ui-widget-content");this._on({"mousedown .ui-menu-item":function(a){a.preventDefault()},"click .ui-menu-item":function(a){var c=b(a.target),d=b(b.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&c.not(".ui-state-disabled").length&&(this.select(a),a.isPropagationStopped()||(this.mouseHandled=!0),c.has(".ui-menu").length?this.expand(a):!this.element.is(":focus")&&d.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&
1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(a){if(!this.previousFilter){var c=b(a.target).closest(".ui-menu-item"),d=b(a.currentTarget);c[0]===d[0]&&(this._removeClass(d.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(a,d))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(a,b){var c=this.active||this.element.find(this.options.items).eq(0);b||this.focus(a,c)},blur:function(a){this._delay(function(){b.contains(this.element[0],
b.ui.safeActiveElement(this.document[0]))||this.collapseAll(a)})},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(a){this._closeOnDocumentClick(a)&&this.collapseAll(a);this.mouseHandled=!1}})},_destroy:function(){var a=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show();
a.children().each(function(){var a=b(this);a.data("ui-menu-submenu-caret")&&a.remove()})},_keydown:function(a){var c=!0;switch(a.keyCode){case b.ui.keyCode.PAGE_UP:this.previousPage(a);break;case b.ui.keyCode.PAGE_DOWN:this.nextPage(a);break;case b.ui.keyCode.HOME:this._move("first","first",a);break;case b.ui.keyCode.END:this._move("last","last",a);break;case b.ui.keyCode.UP:this.previous(a);break;case b.ui.keyCode.DOWN:this.next(a);break;case b.ui.keyCode.LEFT:this.collapse(a);break;case b.ui.keyCode.RIGHT:this.active&&
!this.active.is(".ui-state-disabled")&&this.expand(a);break;case b.ui.keyCode.ENTER:case b.ui.keyCode.SPACE:this._activate(a);break;case b.ui.keyCode.ESCAPE:this.collapse(a);break;default:c=!1;var d=this.previousFilter||"";var e=!1;var f=96<=a.keyCode&&105>=a.keyCode?(a.keyCode-96).toString():String.fromCharCode(a.keyCode);clearTimeout(this.filterTimer);f===d?e=!0:f=d+f;d=this._filterMenuItems(f);d=e&&-1!==d.index(this.active.next())?this.active.nextAll(".ui-menu-item"):d;d.length||(f=String.fromCharCode(a.keyCode),
d=this._filterMenuItems(f));d.length?(this.focus(a,d),this.previousFilter=f,this.filterTimer=this._delay(function(){delete this.previousFilter},1E3)):delete this.previousFilter}c&&a.preventDefault()},_activate:function(a){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(a):this.select(a))},refresh:function(){var a=this,c=this.options.icons.submenu;var d=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,
!!this.element.find(".ui-icon").length);var e=d.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var d=b(this),e=d.prev(),f=b("<span>").data("ui-menu-submenu-caret",!0);a._addClass(f,"ui-menu-icon","ui-icon "+c);e.attr("aria-haspopup","true").prepend(f);d.attr("aria-labelledby",e.attr("id"))});this._addClass(e,"ui-menu","ui-widget ui-widget-content ui-front");e=d.add(this.element).find(this.options.items);e.not(".ui-menu-item").each(function(){var c=
b(this);a._isDivider(c)&&a._addClass(c,"ui-menu-divider","ui-widget-content")});d=e.not(".ui-menu-item, .ui-menu-divider");var f=d.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()});this._addClass(d,"ui-menu-item")._addClass(f,"ui-menu-item-wrapper");e.filter(".ui-state-disabled").attr("aria-disabled","true");this.active&&!b.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(a,
b){if("icons"===a){var c=this.element.find(".ui-menu-icon");this._removeClass(c,null,this.options.icons.submenu)._addClass(c,null,b.submenu)}this._super(a,b)},_setOptionDisabled:function(a){this._super(a);this.element.attr("aria-disabled",String(a));this._toggleClass(null,"ui-state-disabled",!!a)},focus:function(a,b){this.blur(a,a&&"focus"===a.type);this._scrollIntoView(b);this.active=b.first();var c=this.active.children(".ui-menu-item-wrapper");this._addClass(c,null,"ui-state-active");this.options.role&&
this.element.attr("aria-activedescendant",c.attr("id"));c=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper");this._addClass(c,null,"ui-state-active");a&&"keydown"===a.type?this._close():this.timer=this._delay(function(){this._close()},this.delay);c=b.children(".ui-menu");c.length&&a&&/^mouse/.test(a.type)&&this._startOpening(c);this.activeMenu=b.parent();this._trigger("focus",a,{item:b})},_scrollIntoView:function(a){if(this._hasScroll()){var c=parseFloat(b.css(this.activeMenu[0],
"borderTopWidth"))||0;var d=parseFloat(b.css(this.activeMenu[0],"paddingTop"))||0;c=a.offset().top-this.activeMenu.offset().top-c-d;d=this.activeMenu.scrollTop();var e=this.activeMenu.height();a=a.outerHeight();0>c?this.activeMenu.scrollTop(d+c):c+a>e&&this.activeMenu.scrollTop(d+c-e+a)}},blur:function(a,b){b||clearTimeout(this.timer);this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",a,{item:this.active}),this.active=null)},
_startOpening:function(a){clearTimeout(this.timer);"true"===a.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close();this._open(a)},this.delay))},_open:function(a){var c=b.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(a.parents(".ui-menu")).hide().attr("aria-hidden","true");a.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(a,c){clearTimeout(this.timer);this.timer=this._delay(function(){var d=
c?this.element:b(a&&a.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element);this._close(d);this.blur(a);this._removeClass(d.find(".ui-state-active"),null,"ui-state-active");this.activeMenu=d},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element);a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(a){return!b(a.target).closest(".ui-menu").length},_isDivider:function(a){return!/[^\-\u2014\u2013\s]/.test(a.text())},
collapse:function(a){var b=this.active&&this.active.parent().closest(".ui-menu-item",this.element);b&&b.length&&(this._close(),this.focus(a,b))},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();b&&b.length&&(this._open(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},
isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,d){var c;this.active&&(c="first"===a||"last"===a?this.active["first"===a?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[a+"All"](".ui-menu-item").eq(0));c&&c.length&&this.active||(c=this.activeMenu.find(this.options.items)[b]());this.focus(d,c)},nextPage:function(a){var c;if(!this.active)this.next(a);else if(!this.isLastItem())if(this._hasScroll()){var d=this.active.offset().top;var e=
this.element.height();this.active.nextAll(".ui-menu-item").each(function(){c=b(this);return 0>c.offset().top-d-e});this.focus(a,c)}else this.focus(a,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())},previousPage:function(a){var c;if(!this.active)this.next(a);else if(!this.isFirstItem())if(this._hasScroll()){var d=this.active.offset().top;var e=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){c=b(this);return 0<c.offset().top-d+e});this.focus(a,c)}else this.focus(a,
this.activeMenu.find(this.options.items).first())},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(a){this.active=this.active||b(a.target).closest(".ui-menu-item");var c={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(a,!0);this._trigger("select",a,c)},_filterMenuItems:function(a){a=a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");var c=new RegExp("^"+a,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return c.test(b.trim(b(this).children(".ui-menu-item-wrapper").text()))})}});
b.widget("ui.selectmenu",[b.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var a=this.element.uniqueId().attr("id");this.ids={element:a,button:a+"-button",menu:a+"-menu"};
this._drawButton();this._drawMenu();this._bindFormResetHandler();this._rendered=!1;this.menuItems=b()},_drawButton:function(){var a=this,c=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button);this._on(this.labels,{click:function(a){this.button.focus();a.preventDefault()}});this.element.hide();this.button=b("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false",
"aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element);this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget");var d=b("<span>").appendTo(this.button);this._addClass(d,"ui-selectmenu-icon","ui-icon "+this.options.icons.button);this.buttonItem=this._renderButtonItem(c).appendTo(this.button);!1!==this.options.width&&this._resizeButton();this._on(this.button,this._buttonEvents);
this.button.one("focusin",function(){a._rendered||a._refreshMenu()})},_drawMenu:function(){var a=this;this.menu=b("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu});this.menuWrap=b("<div>").append(this.menu);this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front");this.menuWrap.appendTo(this._appendTo());this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(b,d){b.preventDefault();a._setSelection();a._select(d.item.data("ui-selectmenu-item"),
b)},focus:function(b,d){d=d.item.data("ui-selectmenu-item");null!=a.focusIndex&&d.index!==a.focusIndex&&(a._trigger("focus",b,{item:d}),a.isOpen||a._select(d,b));a.focusIndex=d.index;a.button.attr("aria-activedescendant",a.menuItems.eq(d.index).attr("id"))}}).menu("instance");this.menuInstance._off(this.menu,"mouseleave");this.menuInstance._closeOnDocumentClick=function(){return!1};this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu();this.buttonItem.replaceWith(this.buttonItem=
this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{}));null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var a=this.element.find("option");this.menu.empty();this._parseOptions(a);this._renderMenu(this.menu,this.items);this.menuInstance.refresh();this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper");this._rendered=!0;a.length&&(a=this._getSelectedItem(),this.menuInstance.focus(null,a),this._setAria(a.data("ui-selectmenu-item")),
this._setOption("disabled",this.element.prop("disabled")))},open:function(a){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",a)))},_position:function(){this.menuWrap.position(b.extend({of:this.button},
this.options.position))},close:function(a){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",a))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(a){var c=b("<span>");this._setText(c,a.label);this._addClass(c,"ui-selectmenu-text");return c},_renderMenu:function(a,c){var d=this,e="";b.each(c,function(c,f){f.optgroup!==e&&(c=b("<li>",{text:f.optgroup}),d._addClass(c,"ui-selectmenu-optgroup",
"ui-menu-divider"+(f.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),c.appendTo(a),e=f.optgroup);d._renderItemData(a,f)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-selectmenu-item",b)},_renderItem:function(a,c){var d=b("<li>"),e=b("<div>",{title:c.element.attr("title")});c.disabled&&this._addClass(d,null,"ui-state-disabled");this._setText(e,c.label);return d.append(e).appendTo(a)},_setText:function(a,b){b?a.text(b):a.html("&#160;")},_move:function(a,
b){var c=".ui-menu-item";if(this.isOpen)var e=this.menuItems.eq(this.focusIndex).parent("li");else e=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),c+=":not(.ui-state-disabled)";a="first"===a||"last"===a?e["first"===a?"prevAll":"nextAll"](c).eq(-1):e[a+"All"](c).eq(0);a.length&&this.menuInstance.focus(b,a)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(a){this[this.isOpen?"close":"open"](a)},_setSelection:function(){if(this.range){if(window.getSelection){var a=
window.getSelection();a.removeAllRanges();a.addRange(this.range)}else this.range.select();this.button.focus()}},_documentClick:{mousedown:function(a){this.isOpen&&(b(a.target).closest(".ui-selectmenu-menu, #"+b.ui.escapeSelector(this.ids.button)).length||this.close(a))}},_buttonEvents:{mousedown:function(){if(window.getSelection){var a=window.getSelection();a.rangeCount&&(this.range=a.getRangeAt(0))}else this.range=document.selection.createRange()},click:function(a){this._setSelection();this._toggle(a)},
keydown:function(a){var c=!0;switch(a.keyCode){case b.ui.keyCode.TAB:case b.ui.keyCode.ESCAPE:this.close(a);c=!1;break;case b.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(a);break;case b.ui.keyCode.UP:a.altKey?this._toggle(a):this._move("prev",a);break;case b.ui.keyCode.DOWN:a.altKey?this._toggle(a):this._move("next",a);break;case b.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(a):this._toggle(a);break;case b.ui.keyCode.LEFT:this._move("prev",a);break;case b.ui.keyCode.RIGHT:this._move("next",
a);break;case b.ui.keyCode.HOME:case b.ui.keyCode.PAGE_UP:this._move("first",a);break;case b.ui.keyCode.END:case b.ui.keyCode.PAGE_DOWN:this._move("last",a);break;default:this.menu.trigger(a),c=!1}c&&a.preventDefault()}},_selectFocusedItem:function(a){var b=this.menuItems.eq(this.focusIndex).parent("li");b.hasClass("ui-state-disabled")||this._select(b.data("ui-selectmenu-item"),a)},_select:function(a,b){var c=this.element[0].selectedIndex;this.element[0].selectedIndex=a.index;this.buttonItem.replaceWith(this.buttonItem=
this._renderButtonItem(a));this._setAria(a);this._trigger("select",b,{item:a});a.index!==c&&this._trigger("change",b,{item:a});this.close(b)},_setAria:function(a){a=this.menuItems.eq(a.index).attr("id");this.button.attr({"aria-labelledby":a,"aria-activedescendant":a});this.menu.attr("aria-activedescendant",a)},_setOption:function(a,b){if("icons"===a){var c=this.button.find("span.ui-icon");this._removeClass(c,null,this.options.icons.button)._addClass(c,null,b.button)}this._super(a,b);"appendTo"===
a&&this.menuWrap.appendTo(this._appendTo());"width"===a&&this._resizeButton()},_setOptionDisabled:function(a){this._super(a);this.menuInstance.option("disabled",a);this.button.attr("aria-disabled",a);this._toggleClass(this.button,null,"ui-state-disabled",a);this.element.prop("disabled",a);a?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var a=this.options.appendTo;a&&(a=a.jquery||a.nodeType?b(a):this.document.find(a).eq(0));a&&a[0]||(a=this.element.closest(".ui-front, dialog"));
a.length||(a=this.document[0].body);return a},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen);this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen);this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var a=this.options.width;!1===a?this.button.css("width",""):(null===a&&(a=this.element.show().outerWidth(),
this.element.hide()),this.button.outerWidth(a))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var a=this._super();a.disabled=this.element.prop("disabled");return a},_parseOptions:function(a){var c=this,d=[];a.each(function(a,e){d.push(c._parseOption(b(e),a))});this.items=d},_parseOption:function(a,b){var c=a.parent("optgroup");return{element:a,index:b,value:a.val(),label:a.text(),optgroup:c.attr("label")||
"",disabled:c.prop("disabled")||a.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler();this.menuWrap.remove();this.button.remove();this.element.show();this.element.removeUniqueId();this.labels.attr("for",this.ids.element)}}]);b.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,
show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var a=/#.*$/;return function(b){var c=b.href.replace(a,"");var e=location.href.replace(a,"");try{c=decodeURIComponent(c)}catch(t){}try{e=decodeURIComponent(e)}catch(t){}return 1<b.hash.length&&c===e}}(),_create:function(){var a=this,c=this.options;this.running=!1;this._addClass("ui-tabs","ui-widget ui-widget-content");this._toggleClass("ui-tabs-collapsible",null,c.collapsible);this._processTabs();c.active=this._initialActive();
b.isArray(c.disabled)&&(c.disabled=b.unique(c.disabled.concat(b.map(this.tabs.filter(".ui-state-disabled"),function(b){return a.tabs.index(b)}))).sort());this.active=!1!==this.options.active&&this.anchors.length?this._findActive(c.active):b();this._refresh();this.active.length&&this.load(c.active)},_initialActive:function(){var a=this.options.active,c=this.options.collapsible,d=location.hash.substring(1);null===a&&(d&&this.tabs.each(function(c,e){if(b(e).attr("aria-controls")===d)return a=c,!1}),
null===a&&(a=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null===a||-1===a)&&(a=this.tabs.length?0:!1);!1!==a&&(a=this.tabs.index(this.tabs.eq(a)),-1===a&&(a=c?!1:0));!c&&!1===a&&this.anchors.length&&(a=0);return a},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):b()}},_tabKeydown:function(a){var c=b(b.ui.safeActiveElement(this.document[0])).closest("li"),d=this.tabs.index(c),e=!0;if(!this._handlePageNav(a)){switch(a.keyCode){case b.ui.keyCode.RIGHT:case b.ui.keyCode.DOWN:d++;
break;case b.ui.keyCode.UP:case b.ui.keyCode.LEFT:e=!1;d--;break;case b.ui.keyCode.END:d=this.anchors.length-1;break;case b.ui.keyCode.HOME:d=0;break;case b.ui.keyCode.SPACE:a.preventDefault();clearTimeout(this.activating);this._activate(d);return;case b.ui.keyCode.ENTER:a.preventDefault();clearTimeout(this.activating);this._activate(d===this.options.active?!1:d);return;default:return}a.preventDefault();clearTimeout(this.activating);d=this._focusNextTab(d,e);a.ctrlKey||a.metaKey||(c.attr("aria-selected",
"false"),this.tabs.eq(d).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",d)},this.delay))}},_panelKeydown:function(a){!this._handlePageNav(a)&&a.ctrlKey&&a.keyCode===b.ui.keyCode.UP&&(a.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(a){if(a.altKey&&a.keyCode===b.ui.keyCode.PAGE_UP)return this._activate(this._focusNextTab(this.options.active-1,!1)),!0;if(a.altKey&&a.keyCode===b.ui.keyCode.PAGE_DOWN)return this._activate(this._focusNextTab(this.options.active+
1,!0)),!0},_findNextTab:function(a,c){function d(){a>e&&(a=0);0>a&&(a=e);return a}for(var e=this.tabs.length-1;-1!==b.inArray(d(),this.options.disabled);)a=c?a+1:a-1;return a},_focusNextTab:function(a,b){a=this._findNextTab(a,b);this.tabs.eq(a).trigger("focus");return a},_setOption:function(a,b){"active"===a?this._activate(b):(this._super(a,b),"collapsible"===a&&(this._toggleClass("ui-tabs-collapsible",null,b),b||!1!==this.options.active||this._activate(0)),"event"===a&&this._setupEvents(b),"heightStyle"===
a&&this._setupHeightStyle(b))},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var a=this.options,c=this.tablist.children(":has(a[href])");a.disabled=b.map(c.filter(".ui-state-disabled"),function(a){return c.index(a)});this._processTabs();!1!==a.active&&this.anchors.length?this.active.length&&!b.contains(this.tablist[0],this.active[0])?this.tabs.length===a.disabled.length?(a.active=!1,this.active=b()):this._activate(this._findNextTab(Math.max(0,
a.active-1),!1)):a.active=this.tabs.index(this.active):(a.active=!1,this.active=b());this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"});this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",
tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var a=this,c=this.tabs,d=this.anchors,e=this.panels;this.tablist=this._getList().attr("role","tablist");this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header");this.tablist.on("mousedown"+this.eventNamespace,"> li",function(a){b(this).is(".ui-state-disabled")&&
a.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){b(this).closest("li").is(".ui-state-disabled")&&this.blur()});this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1});this._addClass(this.tabs,"ui-tabs-tab","ui-state-default");this.anchors=this.tabs.map(function(){return b("a",this)[0]}).attr({role:"presentation",tabIndex:-1});this._addClass(this.anchors,"ui-tabs-anchor");this.panels=b();this.anchors.each(function(c,d){var e=b(d).uniqueId().attr("id"),
f=b(d).closest("li"),g=f.attr("aria-controls");if(a._isLocal(d)){c=d.hash;d=c.substring(1);var k=a.element.find(a._sanitizeSelector(c))}else d=f.attr("aria-controls")||b({}).uniqueId()[0].id,k=a.element.find("#"+d),k.length||(k=a._createPanel(d),k.insertAfter(a.panels[c-1]||a.tablist)),k.attr("aria-live","polite");k.length&&(a.panels=a.panels.add(k));g&&f.data("ui-tabs-aria-controls",g);f.attr({"aria-controls":d,"aria-labelledby":e});k.attr("aria-labelledby",e)});this.panels.attr("role","tabpanel");
this._addClass(this.panels,"ui-tabs-panel","ui-widget-content");c&&(this._off(c.not(this.tabs)),this._off(d.not(this.anchors)),this._off(e.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(a){return b("<div>").attr("id",a).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(a){var c,d;b.isArray(a)&&(a.length?a.length===this.anchors.length&&(a=!0):a=!1);for(d=0;c=this.tabs[d];d++)c=b(c),!0===a||-1!==b.inArray(d,a)?(c.attr("aria-disabled",
"true"),this._addClass(c,null,"ui-state-disabled")):(c.removeAttr("aria-disabled"),this._removeClass(c,null,"ui-state-disabled"));this.options.disabled=a;this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===a)},_setupEvents:function(a){var c={};a&&b.each(a.split(" "),function(a,b){c[b]="_eventHandler"});this._off(this.anchors.add(this.tabs).add(this.panels));this._on(!0,this.anchors,{click:function(a){a.preventDefault()}});this._on(this.anchors,c);this._on(this.tabs,{keydown:"_tabKeydown"});
this._on(this.panels,{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs)},_setupHeightStyle:function(a){var c=this.element.parent();if("fill"===a){var d=c.height();d-=this.element.outerHeight()-this.element.height();this.element.siblings(":visible").each(function(){var a=b(this),c=a.css("position");"absolute"!==c&&"fixed"!==c&&(d-=a.outerHeight(!0))});this.element.children().not(this.panels).each(function(){d-=b(this).outerHeight(!0)});this.panels.each(function(){b(this).height(Math.max(0,
d-b(this).innerHeight()+b(this).height()))}).css("overflow","auto")}else"auto"===a&&(d=0,this.panels.each(function(){d=Math.max(d,b(this).height("").height())}).height(d))},_eventHandler:function(a){var c=this.options,d=this.active,e=b(a.currentTarget).closest("li"),f=e[0]===d[0],g=f&&c.collapsible,l=g?b():this._getPanelForTab(e),h=d.length?this._getPanelForTab(d):b();d={oldTab:d,oldPanel:h,newTab:g?b():e,newPanel:l};a.preventDefault();e.hasClass("ui-state-disabled")||e.hasClass("ui-tabs-loading")||
this.running||f&&!c.collapsible||!1===this._trigger("beforeActivate",a,d)||(c.active=g?!1:this.tabs.index(e),this.active=f?b():e,this.xhr&&this.xhr.abort(),h.length||l.length||b.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(e),a),this._toggle(a,d))},_toggle:function(a,c){function d(){f.running=!1;f._trigger("activate",a,c)}function e(){f._addClass(c.newTab.closest("li"),"ui-tabs-active","ui-state-active");g.length&&f.options.show?f._show(g,f.options.show,
d):(g.show(),d())}var f=this,g=c.newPanel,l=c.oldPanel;this.running=!0;l.length&&this.options.hide?this._hide(l,this.options.hide,function(){f._removeClass(c.oldTab.closest("li"),"ui-tabs-active","ui-state-active");e()}):(this._removeClass(c.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),l.hide(),e());l.attr("aria-hidden","true");c.oldTab.attr({"aria-selected":"false","aria-expanded":"false"});g.length&&l.length?c.oldTab.attr("tabIndex",-1):g.length&&this.tabs.filter(function(){return 0===
b(this).attr("tabIndex")}).attr("tabIndex",-1);g.attr("aria-hidden","false");c.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(a){a=this._findActive(a);a[0]!==this.active[0]&&(a.length||(a=this.active),a=a.find(".ui-tabs-anchor")[0],this._eventHandler({target:a,currentTarget:a,preventDefault:b.noop}))},_findActive:function(a){return!1===a?b():this.tabs.eq(a)},_getIndex:function(a){"string"===typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+
b.ui.escapeSelector(a)+"']")));return a},_destroy:function(){this.xhr&&this.xhr.abort();this.tablist.removeAttr("role").off(this.eventNamespace);this.anchors.removeAttr("role tabIndex").removeUniqueId();this.tabs.add(this.panels).each(function(){b.data(this,"ui-tabs-destroy")?b(this).remove():b(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")});this.tabs.each(function(){var a=b(this),c=a.data("ui-tabs-aria-controls");c?a.attr("aria-controls",
c).removeData("ui-tabs-aria-controls"):a.removeAttr("aria-controls")});this.panels.show();"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(a){var c=this.options.disabled;!1!==c&&(void 0===a?c=!1:(a=this._getIndex(a),c=b.isArray(c)?b.map(c,function(b){return b!==a?b:null}):b.map(this.tabs,function(b,c){return c!==a?c:null})),this._setOptionDisabled(c))},disable:function(a){var c=this.options.disabled;if(!0!==c){if(void 0===a)c=!0;else{a=this._getIndex(a);if(-1!==
b.inArray(a,c))return;c=b.isArray(c)?b.merge([a],c).sort():[a]}this._setOptionDisabled(c)}},load:function(a,c){a=this._getIndex(a);var d=this,e=this.tabs.eq(a);a=e.find(".ui-tabs-anchor");var f=this._getPanelForTab(e),g={tab:e,panel:f},l=function(a,b){"abort"===b&&d.panels.stop(!1,!0);d._removeClass(e,"ui-tabs-loading");f.removeAttr("aria-busy");a===d.xhr&&delete d.xhr};this._isLocal(a[0])||(this.xhr=b.ajax(this._ajaxSettings(a,c,g)))&&"canceled"!==this.xhr.statusText&&(this._addClass(e,"ui-tabs-loading"),
f.attr("aria-busy","true"),this.xhr.done(function(a,b,e){setTimeout(function(){f.html(a);d._trigger("load",c,g);l(e,b)},1)}).fail(function(a,b){setTimeout(function(){l(a,b)},1)}))},_ajaxSettings:function(a,c,d){var e=this;return{url:a.attr("href").replace(/#.*$/,""),beforeSend:function(a,f){return e._trigger("beforeLoad",c,b.extend({jqXHR:a,ajaxSettings:f},d))}}},_getPanelForTab:function(a){a=b(a).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+a))}});!1!==b.uiBackCompat&&
b.widget("ui.tabs",b.ui.tabs,{_processTabs:function(){this._superApply(arguments);this._addClass(this.tabs,"ui-tab")}});b.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var a=b(this).attr("title")||"";return b("<a>").text(a).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(a,c){var d=(a.attr("aria-describedby")||
"").split(/\s+/);d.push(c);a.data("ui-tooltip-id",c).attr("aria-describedby",b.trim(d.join(" ")))},_removeDescribedBy:function(a){var c=a.data("ui-tooltip-id"),d=(a.attr("aria-describedby")||"").split(/\s+/);c=b.inArray(c,d);-1!==c&&d.splice(c,1);a.removeData("ui-tooltip-id");(d=b.trim(d.join(" ")))?a.attr("aria-describedby",d):a.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};this.liveRegion=b("<div>").attr({role:"log",
"aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body);this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible");this.disabledTitles=b([])},_setOption:function(a,c){var d=this;this._super(a,c);"content"===a&&b.each(this.tooltips,function(a,b){d._updateContent(b.element)})},_setOptionDisabled:function(a){this[a?"_disable":"_enable"]()},_disable:function(){var a=this;b.each(this.tooltips,function(c,d){c=b.Event("blur");c.target=c.currentTarget=d.element[0];a.close(c,
!0)});this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var a=b(this);if(a.is("[title]"))return a.data("ui-tooltip-title",a.attr("title")).removeAttr("title")}))},_enable:function(){this.disabledTitles.each(function(){var a=b(this);a.data("ui-tooltip-title")&&a.attr("title",a.data("ui-tooltip-title"))});this.disabledTitles=b([])},open:function(a){var c=this,d=b(a?a.target:this.element).closest(this.options.items);d.length&&!d.data("ui-tooltip-id")&&
(d.attr("title")&&d.data("ui-tooltip-title",d.attr("title")),d.data("ui-tooltip-open",!0),a&&"mouseover"===a.type&&d.parents().each(function(){var a=b(this);if(a.data("ui-tooltip-open")){var d=b.Event("blur");d.target=d.currentTarget=this;c.close(d,!0)}a.attr("title")&&(a.uniqueId(),c.parents[this.id]={element:this,title:a.attr("title")},a.attr("title",""))}),this._registerCloseHandlers(a,d),this._updateContent(d,a))},_updateContent:function(a,b){var c=this.options.content;var e=this,f=b?b.type:null;
if("string"===typeof c||c.nodeType||c.jquery)return this._open(b,a,c);(c=c.call(a[0],function(c){e._delay(function(){a.data("ui-tooltip-open")&&(b&&(b.type=f),this._open(b,a,c))})}))&&this._open(b,a,c)},_open:function(a,c,d){function e(a){g.of=a;l.is(":hidden")||l.position(g)}var f,g=b.extend({},this.options.position);if(d)if(f=this._find(c))f.tooltip.find(".ui-tooltip-content").html(d);else{c.is("[title]")&&(a&&"mouseover"===a.type?c.attr("title",""):c.removeAttr("title"));f=this._tooltip(c);var l=
f.tooltip;this._addDescribedBy(c,l.attr("id"));l.find(".ui-tooltip-content").html(d);this.liveRegion.children().hide();d=b("<div>").html(l.find(".ui-tooltip-content").html());d.removeAttr("name").find("[name]").removeAttr("name");d.removeAttr("id").find("[id]").removeAttr("id");d.appendTo(this.liveRegion);this.options.track&&a&&/^mouse/.test(a.type)?(this._on(this.document,{mousemove:e}),e(a)):l.position(b.extend({of:c},this.options.position));l.hide();this._show(l,this.options.show);if(this.options.track&&
this.options.show&&this.options.show.delay)var h=this.delayedShow=setInterval(function(){l.is(":visible")&&(e(g.of),clearInterval(h))},b.fx.interval);this._trigger("open",a,{tooltip:l})}},_registerCloseHandlers:function(a,c){var d={keyup:function(a){a.keyCode===b.ui.keyCode.ESCAPE&&(a=b.Event(a),a.currentTarget=c[0],this.close(a,!0))}};c[0]!==this.element[0]&&(d.remove=function(){this._removeTooltip(this._find(c).tooltip)});a&&"mouseover"!==a.type||(d.mouseleave="close");a&&"focusin"!==a.type||(d.focusout=
"close");this._on(!0,c,d)},close:function(a){var c=this,d=b(a?a.currentTarget:this.element),e=this._find(d);if(e){var f=e.tooltip;e.closing||(clearInterval(this.delayedShow),d.data("ui-tooltip-title")&&!d.attr("title")&&d.attr("title",d.data("ui-tooltip-title")),this._removeDescribedBy(d),e.hiding=!0,f.stop(!0),this._hide(f,this.options.hide,function(){c._removeTooltip(b(this))}),d.removeData("ui-tooltip-open"),this._off(d,"mouseleave focusout keyup"),d[0]!==this.element[0]&&this._off(d,"remove"),
this._off(this.document,"mousemove"),a&&"mouseleave"===a.type&&b.each(this.parents,function(a,d){b(d.element).attr("title",d.title);delete c.parents[a]}),e.closing=!0,this._trigger("close",a,{tooltip:f}),e.hiding||(e.closing=!1))}else d.removeData("ui-tooltip-open")},_tooltip:function(a){var c=b("<div>").attr("role","tooltip"),d=b("<div>").appendTo(c),e=c.uniqueId().attr("id");this._addClass(d,"ui-tooltip-content");this._addClass(c,"ui-tooltip","ui-widget ui-widget-content");c.appendTo(this._appendTo(a));
return this.tooltips[e]={element:a,tooltip:c}},_find:function(a){return(a=a.data("ui-tooltip-id"))?this.tooltips[a]:null},_removeTooltip:function(a){a.remove();delete this.tooltips[a.attr("id")]},_appendTo:function(a){a=a.closest(".ui-front, dialog");a.length||(a=this.document[0].body);return a},_destroy:function(){var a=this;b.each(this.tooltips,function(c,d){var e=b.Event("blur");d=d.element;e.target=e.currentTarget=d[0];a.close(e,!0);b("#"+c).remove();d.data("ui-tooltip-title")&&(d.attr("title")||
d.attr("title",d.data("ui-tooltip-title")),d.removeData("ui-tooltip-title"))});this.liveRegion.remove()}});!1!==b.uiBackCompat&&b.widget("ui.tooltip",b.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var a=this._superApply(arguments);this.options.tooltipClass&&a.tooltip.addClass(this.options.tooltipClass);return a}})});/*
 jQuery UI Touch Punch 0.2.3

 Copyright 2011?2014, Dave Furfero
 Dual licensed under the MIT or GPL Version 2 licenses.

 Depends:
  jquery.ui.widget.js
  jquery.ui.mouse.js
*/
!function(b){function h(a,b){if(!(1<a.originalEvent.touches.length)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(d)}}if(b.support.touch="ontouchend"in document,b.support.touch){var f,g=b.ui.mouse.prototype,e=g._mouseInit,a=g._mouseDestroy;g._touchStart=function(a){!f&&this._mouseCapture(a.originalEvent.changedTouches[0])&&(f=!0,this._touchMoved=
!1,h(a,"mouseover"),h(a,"mousemove"),h(a,"mousedown"))};g._touchMove=function(a){f&&(this._touchMoved=!0,h(a,"mousemove"))};g._touchEnd=function(a){f&&(h(a,"mouseup"),h(a,"mouseout"),this._touchMoved||h(a,"click"),f=!1)};g._mouseInit=function(){this.element.bind({touchstart:b.proxy(this,"_touchStart"),touchmove:b.proxy(this,"_touchMove"),touchend:b.proxy(this,"_touchEnd")});e.call(this)};g._mouseDestroy=function(){this.element.unbind({touchstart:b.proxy(this,"_touchStart"),touchmove:b.proxy(this,
"_touchMove"),touchend:b.proxy(this,"_touchEnd")});a.call(this)}}}(jQuery);window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(b){return function(){var h={};return{check_message:function(f){var g={};if(!f.is_box())return this.report_error("Function birds can only respond to boxes. One was given "+b.UTILITIES.add_a_or_an(f.get_type_name()));g.box_size=f.get_size();if(1>g.box_size)return this.report_error("Function birds can only respond to boxes with holes.");var e=f.get_hole_contents(0);if(!e)return this.report_error("Function birds can only respond to boxes with something in the first hole.");
if(e.is_box()){g.bird=e.get_hole_contents(0);if(2<e.get_size()&&(g.error_bird=e.get_hole_contents(2),g.error_bird&&!g.error_bird.is_bird()))return this.report_error("A function bird received a box with a box in its first hole that should only contain birds. It contains "+b.UTILITIES.add_a_or_an(g.message_return_bird.get_type_name())+".",g.bird.is_bird()&&g);if(!g.bird)return this.report_error("Function birds can only respond to boxes with a box in the first hole if the box's first hole contains a bird. It is empty.",
g);if(!g.bird.is_bird())return this.report_error("Function birds can only respond to boxes with a box in the first hole if the box's first hole contains a bird. The first hole contains "+b.UTILITIES.add_a_or_an(g.bird.get_type_name())+".",g);if(1<e.get_size()&&(g.message_return_bird=e.get_hole_contents(1),g.message_return_bird&&!g.message_return_bird.is_bird()))return this.report_error("A function bird received a box with a box in its first hole that should only contain birds. It contains "+b.UTILITIES.add_a_or_an(g.message_return_bird.get_type_name())+
".",g)}else if(e.is_bird())g.bird=e;else return this.report_error("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+b.UTILITIES.add_a_or_an(e.get_type_name())+".",g);g.message=f;return g},report_error:function(f,g){b.UTILITIES.display_message(f);g&&(g.error_bird||g.bird)&&(g.error_bird||g.bird).widget_side_dropped_on_me(b.element.create(f),{});g&&g.message_return_bird&&g.message_return_bird.widget_side_dropped_on_me(g.message,void 0);return f},process_response:function(b,
g,e,a){b&&(a.do_not_run_next_step=!0,a.by_function_bird=!0,g.message_return_bird||(a.temporary_bird=!0),g.bird.widget_side_dropped_on_me(b,a),g&&g.message_return_bird&&g.message_return_bird.widget_side_dropped_on_me(g.message,a));g.message_return_bird||e.remove({do_not_remove_children:!0,remove_backside:!0})},process_message:function(b,g,e){var a=this.check_message(b);if("string"!==typeof a)return g=g(a,e),!a.message_return_bird&&1<b.get_size()&&b.get_hole_contents(1)&&b.get_hole_contents(1).is_nest()&&
b.get_hole_contents(1).has_contents()&&(e.do_not_remove_children=!0,e.do_not_remove_frontside=!0,b.get_hole_contents(1).dereference().remove(e)),this.process_response(g,a,b,e),g},type_check:function(f,g,e,a,c,d){if(g.is_nest()&&!g.has_contents())throw b.sounds&&b.sounds.bird_fly.pause(),d&&d.make_message_nests_delivery_targets&&(g.set_visible(!0),b.UTILITIES.set_css(g.get_element(),$(c.message.get_element()).offset())),{wait_for_nest_to_receive_something:g};return f?g?g.dereference().is_of_type(f)?
!0:this.report_error("The '"+e+"' bird can only respond to boxes with "+b.UTILITIES.add_a_or_an(f)+" in the "+b.UTILITIES.ordinal(a)+" hole. The "+b.UTILITIES.ordinal(a)+" hole contains "+b.UTILITIES.add_a_or_an(g.get_type_name()+"."),c):this.report_error("The '"+e+"' bird can only respond to boxes with "+b.UTILITIES.add_a_or_an(f)+" in the "+b.UTILITIES.ordinal(a)+" hole. The "+b.UTILITIES.ordinal(a)+" hole is empty.",c):!0},number_check:function(b,g,e,a,c){return this.type_check("number",b,g,e,
a,c)},n_ary_widget_function:function(f,g,e,a,c){var d=function(c,d){var k;if(1===c.box_size)return g();var l=1;if(k=f.get_hole_contents(l)){if(k=k.dereference(),!0===this.number_check(k,a,l,c,d)){c.message_return_bird&&(k=k.copy());for(l++;l<c.box_size;){d=f.get_hole_contents(l);if(!d){this.report_error("The '"+a+"' bird could not work because the "+b.UTILITIES.ordinal(l-1)+" number is missing.",c);return}d=d.dereference();if(!0!==this.number_check(d,a,l,c))return;e.call(k,d);l++}return k}}else this.report_error("The '"+
a+"' bird could not work because the first number is missing.",c)}.bind(this);return this.process_message(f,d,c)},n_ary_function:function(f,g,e,a,c){var d=function(c){var d,k;if(c.box_size<e+1)this.report_error("The '"+a+"' bird can only respond to boxes with at least "+(e+1)+" holes. Not "+c.box_size+" holes.",c);else{var l=[];for(d=1;d<c.box_size;){var h=f.get_hole_contents(d);if(!h){this.report_error("The '"+a+"' bird stopped becaused the "+b.UTILITIES.ordinal(d)+" hole is empty.",c);return}h=
h.dereference();if(!0!==this.number_check(h,a,d,c))return;h.get_approximate&&h.get_approximate()&&(k=!0);l.push(h.get_value());d++}c=g.apply(null,l);k&&(c.set_approximate(!0),c.set_format("decimal"));return c}}.bind(this);return this.process_message(f,d,c)},typed_bird_function:function(f,g,e,a,c,d,k){var h=function(m){var l,h;if(0<=d&&m.box_size<d+1)this.report_error("The '"+a+"' bird can only respond to boxes with "+(d+1)+" or more holes. Not "+m.box_size+" holes.",m);else{var r=[];var v=1;for(l=
k?k:m.box_size-1;v<l+1;){var n=f.get_hole_contents(v);if(v<=d&&!n){this.report_error("The '"+a+"' bird found nothing in the "+b.UTILITIES.ordinal(v)+" hole.",m);return}if(n){n=n.dereference();v<=e.length&&(h=e[v-1]);if(!0!==this.type_check(h,n,a,v,m,c))return;r.push(n)}else r.push(void 0);v++}r.push(m);return g.apply(f,r)}}.bind(this);return this.process_message(f,h,c)},numeric_javascript_function_to_widget_function:function(f,g,e){return function(){var a=b.number.ZERO(b.number.function_bird_results_default_format);
a.set_value_from_decimal(f.apply(null,b.UTILITIES.map_arguments(arguments,e||bigrat.toDecimal)));g&&(a.set_approximate(!0),a.set_format("decimal"));return a}},bigrat_function_to_widget_function:function(f,g){return function(){var e=b.number.create_from_bigrat(f.apply(null,arguments));g&&g(arguments)&&(e.set_approximate(!0),e.set_format("decimal"));return e}},add_function_object:function(f,g,e,a,c){h[f]={name:f,short_name:a||f,respond_to_message:g,get_description:c?1===c.length?function(){return"If you give me a box with another bird and "+
b.UTILITIES.add_a_or_an(c[0])+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+b.UTILITIES.conjunction(c,!0)+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."},
toString:function(){return b.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:e}},get_function_table:function(){return h}}}}(window.TOONTALK);window.TOONTALK.widget=function(b){var h=function(b){if(b=this.get_frontside(b))return b.get_element()};b.creators_from_json.top_level=function(f){f=b.widget.create_top_level_widget(f.settings);f.get_backside(!0);return f};return{add_standard_widget_functionality:function(f){var g=function(){return!1},e;this.add_sides_functionality(f);this.runnable(f);this.stackable(f);this.animatable(f);this.has_title(f);this.has_parent(f);this.has_backside_widgets(f);this.has_description(f);this.has_listeners(f);
this.droppable(f);this.erasable(f);f.this_and_walk_children=function(a){a(f)&&f.walk_children&&f.walk_children(a)};f.walk_children&&(f.walk_children_now_or_later=function(a,c){c&&c>b.maximum_recursion_depth?setTimeout(function(){this.walk_children(function(b){return a(b,0)})}.bind(this)):this.walk_children(function(b){return a(b,c?c+1:1)})}.bind(this));f.top_level_widget=function(){var a;if(e)return e;if(this.is_top_level())return this;if(e=b.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")))return e=
e.get_widget();if(a=this.get_parent_of_frontside()||this.get_parent_of_backside())return e=a.get_widget().top_level_widget();a=$(".toontalk-backside-of-top-level");if(0<a.length)return e=b.UTILITIES.widget_side_of_element(b.UTILITIES.closest_element(a,$(this.get_frontside_element()).offset())).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return e=this.create_top_level_widget()};f.is_of_type||(f.is_of_type=function(a){return this.get_type_name()===a});
f.dereference||(f.dereference=function(){return this});f.get_default_description||(f.get_default_description=function(){return b.UTILITIES.add_a_or_an(this.get_type_name())+"."});f.is_number||(f.is_number=g);f.is_box||(f.is_box=g);f.is_empty_hole||(f.is_empty_hole=g);f.is_hole||(f.is_hole=g);f.is_scale||(f.is_scale=g);f.is_bird||(f.is_bird=g);f.is_nest||(f.is_nest=g);f.is_robot||(f.is_robot=g);f.is_element||(f.is_element=g);f.is_sensor||(f.is_sensor=g);f.is_function_nest||(f.is_function_nest=g);f.is_plain_text_element||
(f.is_plain_text_element=g);f.is_attribute_widget||(f.is_attribute_widget=g);f.maintain_proportional_dimensions||(f.maintain_proportional_dimensions=g);f.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};f.set_name&&(f.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});!b.debugging&&!b.logging||f.to_debug_string||(f.to_debug_string=function(a){var b=this.get_parent_widget_of_frontside(),d=this._debug_id,e=this.get_description();
e=e?e+" ":"";d||(d=b&&b.id?"id of parent is "+b.id:"");e&&(e+=" ");return(this.toString({plain_text:!0})+" ("+e+(this.get_name&&this.get_name()+" "||"")+d+")").substring(0,a)});f.is_top_level=g;f.is_widget=!0},erasable:function(b){var f;b.get_erased||(b.get_erased=function(){return f});b.set_erased||(b.set_erased=function(b,a){f=b;a&&this.rerender()})},add_sides_functionality:function(f){var g,e,a;f.get_frontside||(f.get_frontside=function(a){a&&!g&&(g=b.frontside.create(f));return g},f.is_resizable||
(f.is_resizable=function(){return!1}),f.save_dimensions=function(){return this.save_dimensions_of(this)},f.save_dimensions_of=function(a){if(a.is_resizable()){if(a.is_element()){if(!this.get_original_width())return;var b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0}},f.restore_dimensions=function(){var a=this.get_frontside_element(!0);if(0<this.saved_width){if(this.ok_to_set_dimensions())this.use_scaling_transform?
this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):b.UTILITIES.set_css(a,{width:this.saved_width,height:this.saved_height});else{var d={width:"",height:""};b.UTILITIES.set_css_transform(d,"");b.UTILITIES.set_css(a,d)}this.saved_height=this.saved_width=void 0}else a&&(this.is_bird()||this.is_nest()||this.is_robot())&&b.UTILITIES.set_css(a,{width:"",height:""})},f.get_width=function(){return b.UTILITIES.get_element_width(f.get_frontside_element())},
f.get_height=function(){return b.UTILITIES.get_element_height(f.get_frontside_element())});f.get_backside||(f.get_backside=function(a){a&&!e&&(e=this.create_backside(),this.backside_widgets_json_views&&e.add_backside_widgets(this.get_backside_widgets(),this.backside_widgets_json_views));return e});f.set_backside||(f.set_backside=function(a){e=a});f.forget_backside||(f.forget_backside=function(){var a;if(e){if(a=e.get_element())$(a).remove(),a.toontalk_widget_side=void 0;e=void 0}});f.create_backside||
(f.create_backside=function(){return b.backside.create(f)});f.get_open_backside_only_if_stopped||(f.get_open_backside_only_if_stopped=function(){return a});f.set_open_backside_only_if_stopped||(f.set_open_backside_only_if_stopped=function(b){a=b})},runnable:function(f){var g=!1,e=!1;f.get_running||(f.get_running=function(a){var b=!1;if(a)return g;if(g)if(a=this.get_backside_widgets(),0===a.length)g=!1;else for(a.some(function(a){if(a&&a.get_widget().get_running())return b=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);
if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return b});f.is_ok_to_run||(f.is_ok_to_run=function(){return e},f.set_ok_to_run=function(a){e=a});f.set_running||(f.set_running=function(a,c,d){var k=g===a,h;e=a;var m=this.get_backside_widgets();(g=a)&&b.logging&&0<=b.logging.indexOf("running")&&console.log(this._debug_string.substring(0,100)+" running.");this.get_backside()&&!k&&this.get_backside().run_status_changed(g);0<m.length&&b.UTILITIES.set_timeout(function(){b.UTILITIES.for_each_batch(m,
function(e){e&&(h=e.get_widget(),e.is_backside()&&(0<=this.get_backside_widgets().indexOf(h)||!e.is_primary_backside())||(!h.is_robot()||h.being_trained||h.get_body().is_empty()?h.set_running&&(!c&&e.is_backside()&&"top-level"!==f.get_type_name()?h.set_running(a,f,!0):h.set_running(a)):g?(g&&b.logging&&0<=b.logging.indexOf("running")&&console.log(h._debug_string.substring(0,100)+" running."),h.set_stopped(!1),h.run(f,d,c),h.set_ok_to_run(!0)):(h.set_stopped(!0),h.set_running(!1)),h.rerender()))}.bind(this))}.bind(this));
this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(g);return!0});this.is_robot()&&!this.get_body().is_empty()&&(g?f.get_parent_of_backside()&&(this.set_stopped(!1),this.run(f.get_parent_of_backside().get_widget())):this.set_stopped(!0));k||this.rerender()})},droppable:function(b){b.drop_on||(b.drop_on=function(b,e){if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,e);console.log("No handler for drop of '"+this+"' on '"+b+"'")})},stackable:function(b){var f=
!1;b.get_infinite_stack||(b.get_infinite_stack=function(){return f});b.set_infinite_stack||(b.set_infinite_stack=function(e){var a=b.get_backside_element(),c=b.get_frontside_element();f=e;a&&$(a).find(".toontalk-infinite-stack-check-box").prop("checked",e);c&&(e?$(c).addClass("toontalk-infinite-stack"):$(c).removeClass("toontalk-infinite-stack"))})},animatable:function(f){if(!f.animate_to_widget){var g=function(e,a){var c=e.get_element();c&&(e.is_backside()||b.UTILITIES.visible_element(c))||(c=b.UTILITIES.find_resource_equal_to_widget(e,
a));return c};f.animate_to_widget=function(b,a,c,d,f,h,m,l){var e=function(){this.animate_to_element(g(b,l),a,c,d,f,h,m&&Math.max(0,m-100));this.rerender()}.bind(this);m?setTimeout(e,100):e()}}f.animate_to_element||(f.animate_to_element=function(e,a,c,d,f,g,m){var k=$(e).offset(),h=this.get_frontside_element(),r=$(e).is(".toontalk-backside");if(e&&b.UTILITIES.visible_element(e)&&0!==c){if("number"===typeof e.animation_left_offset)d=e.animation_left_offset;else if("undefined"===typeof d||r)d=(b.UTILITIES.get_element_width(e)-
b.UTILITIES.get_element_width(h))*Math.random();if("number"===typeof e.animation_top_offset)f=e.animation_top_offset;else if("undefined"===typeof f||r)f=(b.UTILITIES.get_element_height(e)-b.UTILITIES.get_element_height(h))*Math.random();k=k?{left:k.left+d,top:k.top+f}:{left:0,top:0};this.animate_to_absolute_position(k,a,c,g,m)}else a&&a()});f.animate_to_absolute_position||(f.animate_to_absolute_position=function(e,a,c,d,f){b.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),e,a,
c,d,f)})},has_title:function(f){f.get_title||(f.get_title=function(){var f=this.get_type_name(),e=this.get_backside(),a=this.get_frontside_element(),c=this.get_description(),d="";$(a).is(".toontalk-top-level-resource")?d=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":e&&e.get_element()&&b.UTILITIES.visible_element(e.get_element())||b.open_backside_only_if_alt_key||
(d=this.can_run&&this.can_run({widgets_considered:[],robots_only:!0})?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my backside and then click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+".":"Click to see my backside.");
c&&(c="I'm "+c,d=d?c+"\n"+d:c);if(this.get_erased())return this.get_title_of_erased_widget();d=this.get_custom_title_prefix&&!$(a).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+d:"I'm "+b.UTILITIES.add_a_or_an(f)+". "+d;d=d.trim();0>".?!".indexOf(d[d.length-1])&&(d+=".");return d});f.update_title=function(){var f=this.get_frontside_element();f&&b.UTILITIES.give_tooltip(f,this.get_title())}},inside_conditions_container:function(){return $(this.get_frontside_element()).closest(".toontalk-conditions-container").is("*")},
directly_inside_conditions_container:function(){return $(this.get_frontside_element()).parent(".toontalk-conditions-container").is("*")},get_title_of_erased_widget:function(){var b=this.get_type_name();return this.inside_conditions_container()?"I'm an erased "+b+".\nI'll match with any other "+b+".":"I'm an erased "+b+".\nDusty the Vacuum can restore me to normal."},has_parent:function(f){var g=[],e,a,c,d;f.get_parent_of_frontside=function(){return c&&e?e.get_backside(!0):e};f.get_parent_widget_of_frontside=
function(){return e};f.get_containing_widget=function(){return e&&e.is_hole()?e.get_parent_widget_of_frontside():this.get_parent_of_frontside()||this};f.parent_of_frontside_is_backside=function(){return c};f.set_parent_of_frontside=function(a,b,d){var f=e;c=b;e!==a&&(e=a,!f||d||b||(f.get_widget().remove_backside_widget(this,!0),a&&a.add_backside_widget&&a.add_backside_widget(this)),g.forEach(function(a){a(f,e)}))};f.add_parent_of_frontside_change_listener=function(a){g.push(a)};f.remove_parent_of_frontside_change_listener=
function(a){a=g.indexOf(a);0<=a&&g.splice(a,1)};f.get_parent_of_backside=function(){return d&&a?a.get_backside(!0):a};f.set_parent_of_backside=function(b,c,e){void 0===b&&!e&&d&&a&&a.get_widget().remove_backside_widget(this.get_backside(),!0);a=b;d=c};f.parent_of_backside_is_backside=function(){return d};f.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};f.closest_visible_ancestor_or_frontside=
function(){for(var a=this,c;a&&!b.UTILITIES.visible_element(a.get_frontside_element());)c=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=c.get_widget()):a=a.get_parent_of_frontside();return a||this};f.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};f.has_ancestor=function(a){var b;return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};f.has_ancestor_either_side=
function(a){var c;if(this===a||this===a.get_backside())return!0;if(c=this.get_parent_of_frontside())return c.has_ancestor_either_side(a);if(c=this.get_parent_of_backside())try{return c.has_ancestor_either_side(a)}catch(m){if(b.UTILITIES.is_stack_overflow(error))return!1;console.error("widget.has_ancestor_either_side encountered this error: "+m.message)}return!1};f.remove_from_parent_of_frontside=function(a){e&&(e.is_backside()?e.remove_backside_widget(this,!a):e.removed_from_container?c?e.remove_backside_widget(this,
!0):e.removed_from_container(this,a):e.get_backside()&&e.remove_backside_widget(this,!a))}},has_description:function(b){var f;b.get_description||(b.get_description=function(){return f});b.set_description||(b.set_description=function(b,a,c){if(f===b||!f&&""===b)return!1;f=b;a&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_description",argument_1:b,toString:"change the description to '"+b+"'' of the "+this.get_type_name(),button_selector:".toontalk-description-input"});
return!0});b.receive_description_from_dropped=function(b){if(b.get_text&&(b=b.get_text(),this.set_description(b,!0)))return this.get_description()}},has_name:function(f){var g;f.get_name||(f.get_name=function(){"string"!==typeof g&&f.generate_name&&(g=f.generate_name());return g});f.set_name||(f.set_name=function(e,a,c){if(g===e||"string"!==typeof e)return!1;g=e;b.UTILITIES.set_css(this.get_element(),{"font-size":this.name_font_size()});a&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,
{setter_name:"set_name",argument_1:e,toString:"change the name of the "+this.get_type_name()+' to "'+g+'"',button_selector:".toontalk-name-input"});return!0});this.has_name_font_size(f)},has_name_font_size:function(f){f.get_name_width||(f.get_name_width=function(b){return.5*(b||this.get_width())});f.get_name_height||(f.get_name_height=function(b){return.5*(b||this.get_height())});f.name_font_size||(f.name_font_size=function(f,e){return b.UTILITIES.font_size(this.get_name(),this.get_name_width(f),
{height:this.get_name_height(e)})})},has_listeners:function(f){var g={};f.add_listener||(f.add_listener=function(b,a){var c=g[b];c?0>c.indexOf(a)&&c.push(a):g[b]=[a]});f.remove_listener||(f.remove_listener=function(e,a,c){if(e=g[e])if(a=e.indexOf(a),0<=a){e.splice(a,1);return}!c&&b.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});f.get_listeners||(f.get_listeners=function(b){return g[b]})},add_speech_listeners:function(f){b.listen&&(f.widget=this,this.add_listener("picked up",
function(){b.UTILITIES.listen_for_speech(f)}),this.add_listener("dropped",function(){b.UTILITIES.stop_listening_for_speech()}))},get_full_description:function(b){if(this.get_erased&&this.get_erased())return b&&"conditions"===b.role?"any "+this.get_type_name():"erased "+this.get_type_name();var f=this.get_description(b);b=this.toString(b);return f?b+" ("+f+")":b},remove:function(b){var f=this.get_backside(),e=this.get_frontside(),a=this.get_parent_of_frontside(),c=function(a){b.do_not_remove_children?
(a.hide_backside&&a.hide_backside(),a.walk_children&&a.walk_children(c)):a.remove&&a.remove(b);return!0};b||(b={});f&&(b.remove_backside||this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level())&&f.hide_backside();e&&!b.do_not_remove_frontside&&e.remove();a&&this.remove_from_parent_of_frontside(b.event);this.get_running()&&this.set_running(!1);this.set_visible(!1);this.walk_children&&this.walk_children(c)},get_frontside_element:h,get_element:h,get_backside_element:function(b){if(b=
this.get_backside&&this.get_backside(b))return b.get_element()},add_to_json:function(f,g){var e,a;if(f){if(f.view){var c=f;g=f.view;f=f.semantic}else g={},c={semantic:f,view:g};c.version=1;this.get_erased&&this.get_erased()&&(f.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(f.infinite_stack=!0);this.get_open_backside_only_if_stopped&&this.get_open_backside_only_if_stopped()&&(f.open_backside_only_if_stopped=!0);this.get_running&&this.get_running()&&(f.running=!0);var d=this.get_parent_widget_of_frontside();
if(!d||this.parent_of_frontside_is_backside()||d.is_element())if(a=this.get_frontside_element&&this.get_frontside_element()){var k=$(a).width();0!==k&&this.is_resizable()&&!$(a).is(".toontalk-plain-text-element")&&(g.frontside_width=$(a).width(),g.frontside_height=$(a).height());0!==k&&(g.frontside_left=b.UTILITIES.get_style_numeric_property(a,"left"),g.frontside_top=b.UTILITIES.get_style_numeric_property(a,"top")||e&&e.frontside_top,void 0===g.frontside_left&&(e=d&&d.get_widget().get_backside_widgets_json_views()))&&
(a=this.get_parent_of_frontside().get_backside_widgets().indexOf(this),0<=a&&e[a]&&(g.frontside_left=e[a].frontside_left,g.frontside_top=e[a].frontside_top))}if(a=this.get_backside()){if(d=a.get_element()){if(a.get_backside_dimensions()||a.is_top_level())g.backside_width=$(d).width(),g.backside_height=$(d).height();g.backside_left||(a.json_view&&"undefined"!==typeof a.json_view.backside_left?(g.backside_left=a.json_view.backside_left,g.backside_top=a.json_view.backside_top):(e=$(d).position(),g.backside_left=
e.left,g.backside_top=e.top),"&lt;"===$(d).find(".toontalk-settings-backside-button").html()&&(g.advanced_settings_open=!0))}a.get_backside_dimensions()&&(g.backside_geometry=a.get_backside_dimensions())}!g.backside_geometry&&this.backside_geometry&&(g.backside_geometry=this.backside_geometry);void 0===g.frontside_left&&this.json_view&&(g.frontside_left=this.json_view.frontside_left,g.frontside_top=this.json_view.frontside_top);f.description=this.get_description&&this.get_description();g.saved_width=
this.saved_width;g.saved_height=this.saved_height;return c}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(f,g,e,a,c){var d=this.get_backside_widgets(),k,h;c>=b.maximum_recursion_depth?b.UTILITIES.avoid_stack_overflow(function(){this.add_backside_widgets_to_json(f,g,e,Date.now(),0)}.bind(this)):0<d.length?(f.semantic.backside_widgets=[],(k=this.get_backside_widgets_json_views())&&k.forEach(function(a,b){if(h=f.semantic.backside_widgets[b]){if(0<=h.widget.shared_widget_index){b=
g.widgets_encountered.indexOf(g.shared_widgets[h.widget.shared_widget_index]);if(!g.json_of_widgets_encountered[b])return;b=g.json_of_widgets_encountered[b].view}else b=h.widget.view;h.is_backside?a.backside_left&&(b.backside_left=a.backside_left,b.backside_top=a.backside_top):a.frontside_left&&(b.frontside_left=a.frontside_left,b.frontside_top=a.frontside_top)}else d[b].json_view=k[b]}),b.UTILITIES.get_json_of_array(d,f.semantic.backside_widgets,0,g,e,a,c+1)):e(c+1)},has_backside_widgets:function(f){var g=
[];f.get_backside_widgets=function(){return g};f.add_backside_widget=function(e,a){if(e){var c=this.get_backside(!0);if(b.debugging){if(e===this){b.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");return}if(e.get_widget()===this){b.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}g?0>g.indexOf(e)&&g.push(e):g=[e];b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Added "+e+" to backside widgets of "+
this+". Number of backside widgets is "+g.length);e.is_backside()?e.set_parent_of_backside(c,!0):e.set_parent_of_frontside(this,!0);!c.visible()||a&&a.robot&&!a.robot.visible()||e.set_visible(!0)}else b.debugging&&b.UTILITIES.report_internal_error("adding undefined to backside widgets.")};f.remove_all_backside_widgets=function(){g&&b.UTILITIES.for_each_batch(g.slice(),function(b){b.remove()})};f.remove_backside_widget=function(e,a){var c=g.indexOf(e);0>c?a||b.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+
e.get_widget()+" ("+e.get_widget()._debug_id+")"):(g.splice(c,1),b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Removed "+e+" from backside widgets of "+this+". Number of backside widgets is "+g.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(c,1),e.is_backside()?(a=e.get_parent())&&a.get_widget()===this&&e.set_parent_of_backside(void 0,!0,!0):(a=e.get_parent_of_frontside())&&a.get_widget()===this&&e.set_parent_of_frontside(void 0,void 0,!0),e.set_visible(!1))};
f.set_backside_widgets=function(e,a){var c=this.get_backside(),d=c&&c.visible();g=e;b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Set backside widgets "+g.length+" widgets of "+(d?"visible ":"invisible ")+this);0<g.length&&(c?c.add_backside_widgets(g,a):this.backside_widgets_json_views=a,b.UTILITIES.for_each_batch(g,function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),d&&a.set_visible(d))}.bind(this)))}},get_backside_widgets_json_views:function(b){!this.backside_widgets_json_views&&
b&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(b){var f=!1,e;this.get_backside_widgets().some(function(a){if(!a)return!1;e=a.get_widget();if(e.get_body&&!e.get_body().is_empty())return f=!0;b?b.depth?(b=Object.assign?Object.assign({},b):b,b.depth++):b.depth=1:b={depth:1};if(e.can_run(b))return f=!0});this.walk_children_now_or_later&&this.walk_children_now_or_later(function(a,c){b?(b=Object.assign?Object.assign({},b):b,b.depth=c):b={depth:c};if(a.can_run&&
a.can_run(b))f=!0;else return!0},b&&b.depth);return f},add_to_copy:function(f,g){this.get_erased&&this.get_erased()&&(f.set_erased||b.widget.erasable(f),f.set_erased(this.get_erased()));if(!g||!g.just_value){var e=this.get_backside_widgets();0<e.length&&f.set_backside_widgets(b.UTILITIES.copy_widget_sides(e,g),this.get_backside_widgets_json_views())}f.set_running(this.get_running());return f},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(f,
g,e){var a=this.visible();f||(f=this.copy({}));var c=this.get_frontside_element(a);var d=f.get_element(a);var k=$(c).closest(".toontalk-backside");var h=f.ok_to_set_dimensions();0===k.length&&(k=$(this.top_level_widget().get_backside_element()));var m=b.UTILITIES.widget_side_of_jquery(k);a&&("undefined"===typeof g&&(g=30),"undefined"===typeof e&&(e=30),a=b.UTILITIES.relative_position(c,k.get(0)),0<k.length&&k.get(0).appendChild(d),c={width:h?$(c).width():"",height:h?$(c).height():"","z-index":b.UTILITIES.next_z_index()},
g=a.left+g,e=a.top+e,f.is_plain_text_element()?f.set_location_attributes(g,e):(c.left=g,c.top=e),b.UTILITIES.set_css(d,c));m&&m.add_backside_widget(f);return f},visible:function(){var b;return document.hidden?!1:(b=this.get_frontside())?b.visible():!1},set_visible:function(b,g){var e=this.get_frontside(b);e&&e.set_visible(b,g)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(b){this.set_parent_of_frontside(b)},drag_started:function(b,
g){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,g)},match:function(b){console.assert(!1,"match not implemented for "+b.toString())},removed:function(f){b.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(f,g){var e=this.get_backside();if(e&&b.UTILITIES.visible_element(e.get_element()))$(e.get_element()).css({opacity:1}),f&&f();else{var a=f&&function(){setTimeout(f)};var c=function(c,
d){b.UTILITIES.set_timeout(function(){$(c).addClass("toontalk-side-appearing");"number"!==typeof g&&(g=0);b.UTILITIES.add_one_shot_event_handler(c,"transitionend",g||2500,function(){$(c).removeClass("toontalk-side-appearing");a&&a()});$(c).css({left:r,top:v,opacity:d});this.apply_backside_geometry()}.bind(this))}.bind(this);var d=this.get_frontside_element(!0);var k=$(d).parent();for(e=$(d);0<k.length&&!k.is(".toontalk-backside");)e=k,k=k.parent();e.get(0);e=this.get_backside(!0);var h=e.get_element();
h.toontalk_widget_side=e;var m=$(d).offset();var l=k.offset();var w=k.width();l||(l={left:0,top:0});$(h).css({left:m.left-l.left,top:m.top-l.top,opacity:.01});0<k.length?k.get(0).appendChild(h):($(h).css({textAlign:"left"}),d.appendChild(h));(k=b.UTILITIES.widget_side_of_jquery(k))&&k.add_backside_widget(e);k=this.is_element()?this.get_attribute("height"):$(d).height();d=$(h).width();var r=m.left-l.left;r+d>w&&(r=Math.max(0,w-d));var v=m.top-l.top+k+34;this.is_box()&&(v+=28);c(h,"inherit");e.set_visible(!0);
var n=this.get_backside_widgets();0<n.length&&n.forEach(function(a){if(a.is_backside()&&0<=n.indexOf(a.get_widget()))a.hide_backside();else{a.set_visible(!0);var c=a.get_element(!0);c.remove();try{h.appendChild(c)}catch(z){b.UTILITIES.report_internal_error("A backside is contained in one its backside widgets. This makes no sense. "+this+" should not be part of "+a+". "+z+" In open_backside. ")}}}.bind(this));return e}},hide_backside:function(){var b=this.get_backside();b&&b.hide_backside()},apply_backside_geometry:function(){var b=
this.get_backside(!0),g=b.get_element();this.backside_geometry&&g&&(b.scale_backside(g,this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),b.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(b){this.top_level_widget().robot_started_training(b)},
robot_finished_training:function(){this.top_level_widget().robot_finished_training()},backup_all:function(b){var f=this.top_level_widget();f&&f.save(b)},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},constrained_by_container:function(){var b;return this.is_nest()||this.being_dragged?!1:(b=this.get_parent_of_frontside())&&(b.is_hole()||b.is_nest()||b.is_robot())?!0:!1},close_button_ok:function(b){return"top-level"!==
this.get_type_name()&&!$(b).is(".toontalk-top-level-resource")&&!$(b).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(b,g){var e=this.top_level_widget();b||(b=this);var a=b.get_element(!0);e.add_backside_widget(b);e.get_backside_element().appendChild(a);b.render();g&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,e);return a},get_selection:function(){return this},display_message:function(f,g){g||(g={});g.display_on_backside_if_possible?
(g.element=this.get_backside_element(),g.second_choice_element=this.get_frontside_element()):g.element=this.get_frontside_element();b.UTILITIES.display_message(f,g);return f},get_speak_function:function(f){return function(g,e){var a,c,d,k,h;if(window.speechSynthesis){var m=f.check_message(g);if("string"!==typeof m)if(2>m.box_size)f.report_error("Speaking birds need a box with two or more holes.",m);else return(a=g.get_hole_contents(2))&&(a=a.to_float&&a.to_float()),(c=g.get_hole_contents(3))&&(c=
c.to_float&&c.to_float()),(d=g.get_hole_contents(4))&&(d=d.to_float&&d.to_float()),(k=g.get_hole_contents(5))&&(k=k.to_float&&k.to_float()),(h=g.get_hole_contents(6))&&(h=h.get_text&&h.get_text()),function(l){if(l){l=l.get_widget();var t=l.get_text?l.get_text(!0):l.toString();if(b.TRANSLATION_ENABLED)b.UTILITIES.translate(t,function(l){r=function(a){var c=b.element.create(l,[],"a response to speaking '"+t+"'");e.event=a;f.process_response(c,m,g,e)};b.UTILITIES.speak(l,{when_finished:r,volume:a,pitch:c,
rate:d,voice_number:k,language:h,no_translation:!0})});else{var r=function(a){var c=b.element.create(t,[],"a response to speaking '"+t+"'");e.event=a;f.process_response(c,m,g,e)};b.UTILITIES.speak(t,{when_finished:r,volume:a,pitch:c,rate:d,voice_number:k,language:h})}}else f.report_error("Speaking birds need something in the second box hole that they can speak.",m)}(g.get_hole_contents(1)),!0}else f.report_error("This browser doesn't support speech output. Try another browser such as Chrome.",m)}},
get_listen_function:function(f,g){return function(e,a){var c,d;if(window.webkitSpeechRecognition||window.SpeechRecognition){var k=f.check_message(e);if("string"!==typeof k)if(1>k.box_size)f.report_error("Listening birds need a box with one or two holes.",k);else{if(c=e.get_hole_contents(1))c=c&&c.to_float&&c.to_float(),0>c?c=0:1<c&&(c=1);g||(d=e.get_hole_contents(2))&&(d=d.get_text());var h=g?function(c){c=parseFloat(c);isNaN(c)||(c=b.number.create_from_bigrat(bigrat.fromDecimal(c)),c.set_description("a number that was heard"),
f.process_response(c,k,e,a),b.UTILITIES.stop_listening_for_speech())}:function(c){c=b.element.create(c,[],"what was spoken");f.process_response(c,k,e,a);b.UTILITIES.stop_listening_for_speech()};b.UTILITIES.listen_for_speech({commands:d,minimum_confidence:c,numbers_acceptable:g,success_callback:h,fail_callback:function(a){f.report_error(a.error,k);b.UTILITIES.stop_listening_for_speech()}});return!0}}else f.report_error("A listening bird can't listen because this browser doesn't support speech input. Try another browser such as Chrome.",
k)}},get_description_function:function(f){return function(g,e){var a=f.check_message(g);if("string"!==typeof a)if(1>a.box_size)f.report_error("Listening birds need a box with two holes.",a);else return function(c){var d=function(d){d=b.element.create(d,[],c.toString());f.process_response(d,a,g,e)};c=c.get_widget();var k=c.get_text?c.get_text(!0):c.toString();b.TRANSLATION_ENABLED?b.UTILITIES.translate(k,function(a){d(a)}):d(k)}(g.get_hole_contents(1)),!0}},create_top_level_widget:function(f){var g=
Object.create(b.widget),e=[],a=function(){return!1},c=!1;f||(f={});g.is_top_level=function(){return!0};g.is_number=a;g.is_box=a;g.is_empty_hole=a;g.is_scale=a;g.is_bird=a;g.is_nest=a;g.is_robot=a;g.is_element=a;g.is_sensor=a;g.is_function_nest=a;g.is_hole=a;g.is_plain_text_element=a;g.is_attribute_widget=a;g.ok_to_set_dimensions=a;g.get_json=function(a,b,c,e){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");b({semantic:{type:"top_level",
settings:f},view:{background_color:a}},c,e+1)};g.get_type_name=function(){return"top-level"};g.is_of_type=function(a){return"top-level"===a};g.toString=function(){return"top level widget"};g.get_description=function(){};g.match=function(){return"matched"};g.update_display=function(){this.get_backside_widgets()&&b.UTILITIES.for_each_batch(this.get_backside_widgets().filter(function(a){return a&&a.visible()}),function(a){a.render()})};g.copy=function(){return this};g.visible=function(){return!document.hidden};
g.get_parent_of_frontside=function(){};g.get_parent_of_backside=function(){};g.closest_visible_ancestor=function(){return this};g.get_infinite_stack=function(){return!1};g.get_listeners=function(){return[]};g.top_level_widget=function(){return this};if(b.debugging||b.logging)g.to_debug_string=function(a){var b=$(this.get_backside_element()).offset();return("top-level widget at "+Math.round(b.left)+", "+Math.round(b.top)).substring(0,a)};g.add_sides_functionality(g);g.runnable(g);g.has_parent(g);g.has_backside_widgets(g);
g.removed_from_container=function(a,b){this.robot_in_training()||this.remove_backside_widget(a,!0)};g.widget_side_dropped_on_me=function(a,b){return this.get_backside().widget_side_dropped_on_me(a,b)};g.get_element=function(){return this.get_backside().get_element()};g.get_setting=function(a,c){"undefined"!==typeof f[a]||c||(f[a]=b.DEFAULT_SETTINGS&&b.DEFAULT_SETTINGS[a]);return f[a]};g.set_setting=function(a,b){f[a]=b};g.open_settings=function(){b.SETTINGS.open(g)};g.robot_in_training=function(){if(0<
e.length)return e[e.length-1]};g.robot_training_this_robot=function(){if(1<e.length)return e[e.length-2]};g.robot_started_training=function(a){e.push(a)};g.robot_finished_training=function(){e.pop()};g.save=function(a,e,f){var d=this.get_setting("program_name",b.reset),g=function(a){c=!1;if(k)if(h=b.google_drive.get_status(),"Ready"===h){try{var g=JSON.stringify(a,b.UTILITIES.clean_JSON)}catch(u){b.UTILITIES.is_stack_overflow(u)?b.UTILITIES.display_message("Unable to store your project because the depth of widget nesting exceeds the size of the stack.  Perhaps you can launch this browser or another with a larger stack size.",
{only_if_new:!0}):b.UTILITIES.display_message("Unable to store your project because of the error: "+u.message,{only_if_new:!0})}b.google_drive.upload_file(d,"json",g,f);f=void 0}else b.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===h?(b.UTILITIES.display_message("Unable to save to your Google Drive because you need to log in. Click on the settings icon <span class='toontalk-settings-icon'></span> to log in.",{only_if_new:!0}),b.UTILITIES.display_tooltip($(".toontalk-settings-button"))):
console.log("Unable to save to Google Drive because: "+h));e.local_storage&&this.save_to_local_storage(a);f&&f()}.bind(this),k,h;!c&&d&&(e||(e={}),"undefined"===typeof e.google_drive&&(e.google_drive=b.google_drive&&this.get_setting("save_to_google_drive")&&this.get_setting("auto_save_to_cloud")),"undefined"===typeof e.local_storage&&(e.local_storage=this.get_setting("auto_save_to_local_storage")),a?(k=e.google_drive&&!this.get_setting("google_drive_unavailable"))||e.local_storage?(c=!0,b.UTILITIES.get_json_top_level(this,
g)):f&&f():setTimeout(function(){this.save(!0,e,f)}.bind(this),100))};g.publish=function(a,c){b.publish.publish_widget(this.get_setting("program_name"),this,c,a)};g.save_to_local_storage=function(a,c){var d=this.get_setting("program_name"),e=b.UTILITIES.local_storage_program_key(d),f=b.UTILITIES.local_storage_program_meta_data_key(d),g=function(g){k=JSON.stringify(a,b.UTILITIES.clean_json);g||(g={created:c});g.last_modified=c;g.file_size=k.length;b.UTILITIES.store_object(f,g);b.UTILITIES.store_string(e,
k);b.UTILITIES.store_string("toontalk-last-key",e);b.UTILITIES.get_all_locally_stored_program_names(function(a){0>a.indexOf(d)&&(a.push(d),b.UTILITIES.set_all_locally_stored_program_names(a))})},k;c||(c=Date.now());try{b.UTILITIES.retrieve_object(f,g)}catch(v){g=k?"Failed to save state to local storage since it requires "+k.length+" bytes. Error message is "+v:"Error while saving to local storage. Error message is "+v,b.UTILITIES.is_internet_explorer()?console.error("Unresolved difficulties using window.localStorage in IE11: "+
g):b.UTILITIES.display_message(g),this.last_local_storage_error=g}};g.load=function(a,c,e){var d=this.get_setting("program_name"),f=d+".json",g=b.UTILITIES.local_storage_program_key(d),k=this.download_callback(c,e);c=function(a){a?b.google_drive.download_file(a,k):b.UTILITIES.retrieve_string(g,k)};a&&b.google_drive&&"Ready"===b.google_drive.get_status()?b.google_drive.get_toontalk_program_file(f,c):b.UTILITIES.retrieve_string(g,k)};g.download_callback=function(a,c){return function(d){if(d)try{var e=
b.UTILITIES.parse_json(d);this.remove_all_backside_widgets();b.UTILITIES.add_backside_widgets_from_json(this,e.semantic.backside_widgets,{json_of_shared_widgets:e.shared_widgets,shared_widgets:[],shared_html:e.shared_html});a&&a()}catch(l){b.UTILITIES.display_message("Error encountered loading "+d+": "+l)}else c&&c()}.bind(this)};g.walk_children=function(){};g.render=function(){};g.constrained_by_container=function(){return!1};g.dereference=function(){return this};g.is_widget=!0;b.debugging&&(g._debug_id=
b.UTILITIES.generate_unique_id(),g._debug_string="Top-level widget");g.get_backside(!0).set_visible(!0);return g}}}(window.TOONTALK);window.TOONTALK.backside=function(b){var h=function(f){var g=f.get_widget(),e=g.get_backside_widgets(),a=g.get_backside_widgets_json_views(!0);f.get_backside_dimensions();var c=f.get_element();b.UTILITIES.for_each_batch(e,function(d,e){var f=d.get_element();if(f){a[e]||(a[e]={});if(d.start_offset&&f.parentElement){var g=b.UTILITIES.relative_position_from_absolute_position(f.parentElement,d.start_offset);d.start_offset=void 0}else g=$(f).position();d.is_backside()?(a[e].backside_left=b.UTILITIES.left_as_percent(g.left,
f),a[e].backside_top=b.UTILITIES.top_as_percent(g.top,f),h(d)):(a[e].frontside_left=b.UTILITIES.left_as_percent(g.left,f,c),a[e].frontside_top=b.UTILITIES.top_as_percent(g.top,f,c))}})};return{create:function(f){var g=Object.create(this),e=document.createElement("div"),a=$(e),c=1,d=1,k=document.createElement("div"),h=document.createElement("div"),m=f.get_help_URL&&f.get_help_URL(),l=function(a){a?($(k).addClass("toontalk-green-flag-active toontalk-button").removeClass("toontalk-green-flag-inactive toontalk-button"),
$(h).addClass("toontalk-stop-sign-inactive toontalk-button").removeClass("toontalk-stop-sign-active toontalk-button")):($(k).addClass("toontalk-green-flag-inactive toontalk-button").removeClass("toontalk-green-flag-active toontalk-button"),$(h).addClass("toontalk-stop-sign-active toontalk-button").removeClass("toontalk-stop-sign-inactive toontalk-button"))},w=this.create_description_label(g,f),r=function(){var a=f.get_running()?"To stop this click on the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):
f.can_run()?"Click this to start this running.":"There is nothing to run on this.";b.UTILITIES.give_tooltip(k,a)},v=function(){var a=f.get_running()?"Click to stop this from running.":f.can_run()?"This has stopped. Click on the flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";b.UTILITIES.give_tooltip(h,a)},n=function(a){D?(b.UTILITIES.add_iframe_popup(m),a.stopPropagation()):(R.href=m,R.target="_blank")},
u=!1,y,z,M,B,G,N,J,K,Q,C,I;b.TRANSLATION_ENABLED&&m&&(m=b.UTILITIES.add_URL_parameter(m,"translate","1"));if(f.close_button_ok(e)){var O=function(c){var d=function(){f.robot_in_training()&&f.robot_in_training()!==f&&f.robot_in_training().backside_closed(g);g.is_primary_backside()?g.hide_backside(c):g.remove()},k;if(f.get_running()){var p=f.get_backside_widgets();p.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(d),k=a,!0});k?(k.add_body_finished_listener(function(){k.visible()?
a.css({opacity:1}):(f.forget_backside(),b.DEFAULT_QUEUE.start());d()}),g.set_visible(!1)):d();a.css({opacity:1});a.addClass("toontalk-animating-element");a.css({opacity:0});b.UTILITIES.add_one_shot_event_handler(e,"transitionend",2E3,function(){f.forget_backside()})}else d();c.stopPropagation()};var T=(T=f.get_description())?"the "+f.get_type_name()+" who "+T:"the "+f.get_type_name();var F=b.UTILITIES.create_close_button(O,"Click to remove this backside of "+T+".");e.appendChild(F)}$(k).addClass("toontalk-green-flag toontalk-green-flag-inactive");
k.addEventListener("click",function(a){f.can_run()?(l(!0),f.set_running(!0),v(),b.DEFAULT_QUEUE.start()):f.is_top_level()?b.UTILITIES.display_message("There is nothing to run.",{element:a.target}):b.UTILITIES.display_message("This "+f.get_type_name()+" has nothing to run. Add some robots on the back.",{element:a.target});f.robot_in_training()&&f.robot_in_training().button_clicked(".toontalk-green-flag",f);a.stopPropagation()});k.addEventListener("mouseenter",v);$(h).addClass("toontalk-stop-sign toontalk-stop-sign-active");
h.addEventListener("click",function(a){l(!1);f.set_running(!1);r();f.robot_in_training()&&f.robot_in_training().button_clicked(".toontalk-stop-sign",f);a.stopPropagation();f.is_top_level()&&b.UTILITIES.stop_audio_objects();f.backup_all()});h.addEventListener("mouseenter",r);e.appendChild(k);e.appendChild(h);b.UTILITIES.use_custom_tooltip(k);b.UTILITIES.use_custom_tooltip(h);if(m){var D=0>m.indexOf("://");var R=document.createElement(D?"div":"a");$(R).addClass("toontalk-help-button notranslate toontalk-widget-help-button");
R.addEventListener("click",n);R.innerHTML="i";R.translate=!1;b.UTILITIES.give_tooltip(R,"Click to learn more about "+f.get_type_name(!0,!0)+".");e.appendChild(R)}w&&e.appendChild(w);if(f.is_top_level()){var V=document.createElement("div");$(V).addClass("toontalk-settings-button");V.addEventListener("click",function(a){f.open_settings();a.stopPropagation()});e.appendChild(V);b.UTILITIES.give_tooltip(V,"Click to change settings or open a different program.")}a.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+
f.get_type_name());a.css({"z-index":b.UTILITIES.next_z_index()});b.UTILITIES.when_attached(e,function(){if(g.inside_conditions_container()){$(k).hide();$(h).hide();$(R).hide();$(F).hide();var a="This will match "+g.toString()+".";g.rerender()}else f.is_robot()?a="On the back of the robot you can change the conditions and setting of the robot.":f.is_top_level()?a="This is a work area where you can drag things.":(I=f.toString({inside_tool_tip:!0}),a="You are pointing to the back of "+b.UTILITIES.add_a_or_an(I)+
" You can put robots on the back to make it come 'alive'.");b.UTILITIES.give_tooltip(e,a)});g.get_element=function(){return e};g.get_backside_element=function(){return e};g.get_widget=function(){return f};g.is_resizable=function(){return!0};g.visible=function(){return document.hidden?!1:B};g.set_visible=function(a,b){B=a;!f.is_top_level()&&this.is_primary_backside()&&(this.get_backside_widgets().forEach(function(c){c&&c!==this&&c.set_visible(a,b?b+1:1)}.bind(this)),B&&this.render())};g.get_erased=
function(){return y};g.set_erased=function(a,b,c){if(!a||c||this.inside_conditions_container())y=a,b&&this.rerender()};f.get_backside||(f.get_backside=function(){return g});g.is_primary_backside=function(){return this===this.get_widget().get_backside()};g.inside_conditions_container=function(){return $(this.get_element()).closest(".toontalk-conditions-panel, .toontalk-conditions-container").is("*")};g.get_width=function(){return b.UTILITIES.get_element_width(this.get_element())};g.get_height=function(){return b.UTILITIES.get_element_height(this.get_element())};
g.is_widget=!0;g.get_backside_widgets=function(){return f.get_backside_widgets()};g.get_parent_of_backside=function(){return this.is_primary_backside()?f.get_parent_of_backside():M&&z?z.get_backside(!0):z};g.set_parent_of_backside=function(a,b){!a&&z&&M&&z.remove_backside_widget(this,!0);this.is_primary_backside()&&f.set_parent_of_backside(a,b);z=a;M=b};g.get_parent_of_frontside=function(){return f.get_parent_of_frontside()};g.is_parent_backside=function(){return f.is_parent_backside()};g.get_frontside=
function(a){return f.get_frontside(a)};g.get_frontside_element=function(a){return f.get_frontside_element(a)};g.get_description_text_area=function(){return Q};g.set_description_text_area=function(a){Q=a};g.get_name_text_input=function(){return C};g.set_name_text_input=function(a){C=a};g.removed_from_container=function(a,b,c,d){g.get_widget().robot_in_training()||this.remove_backside_widget(a,d)};g.drop_on=function(a,b){return a.widget_side_dropped_on_me&&a.widget_side_dropped_on_me(this,b)};g.widget_side_dropped_on_me=
function(a,c){var d,p;if(a===this)return(this.get_parent()||this.top_level_widget().get_backside()).widget_side_dropped_on_me(a,c);if(c.robot&&c.robot.visible()&&!this.visible())this.add_backside_widget(a,c),a.dropped_on_other&&a.dropped_on_other(this,c);else{if(this.visible()&&(!c.robot||c.robot.visible())){b.sounds&&c.event&&b.sounds.drop.play();var g=a.get_element(this.visible());a.rerender();c.event?(e.appendChild(g),b.UTILITIES.set_position_is_absolute(g,!0,c.event)):(c.robot&&(d=$(c.robot.get_frontside_element()).offset()),
d||(d=$(g).offset()),e.appendChild(g),!d||0===d.left&&0===d.top||b.UTILITIES.set_absolute_position(g,d))}f.robot_in_training()&&!c.ignore_training&&c.event&&setTimeout(function(){f.robot_in_training()&&f.robot_in_training().dropped_on(a,this,c.event)}.bind(this));a.is_backside()&&a.get_widget().is_element()&&f.is_element()&&(d=a.get_widget(),d.set_backside(void 0),d.remove(c.event),d.set_backside(a));this.add_backside_widget(a,c);a.dropped_on_other&&a.dropped_on_other(this,c);c.event&&a.get_body&&
a.get_body().is_empty()&&!a.being_trained?setTimeout(function(){(p=a.open_backside())&&$(p.get_element()).find(".toontalk-train-backside-button").click()}):c.event&&!a.is_backside()&&this.get_frontside_element()&&!a.is_sensor()&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:g,where:"back"}));c.event&&a.get_widget().backup_all();c.event&&this.get_widget().is_top_level()&&!a.is_backside()&&!a.is_sensor()&&window.dispatchEvent(b.UTILITIES.create_event("widget added",
{element_widget:g,here:"back"}));c.robot&&!c.robot.visible()&&this.visible()&&c.robot.add_body_finished_listener(function(){var b=function(){c=a.get_element(!0);e.appendChild(c);a.set_visible(!0);a.update_display();$(c).css(this.get_free_location(a))}.bind(this),c;a.get_parent()===this&&(a.get_running()?setTimeout(function(){a.get_parent()&&b()},500):b())}.bind(this));!a.is_backside()&&a.is_robot()&&this.get_widget().get_running()&&!this.is_top_level()&&this.get_widget().set_running(!0);return!0}};
g.add_backside_widget=function(a,b){return this.get_widget().add_backside_widget(a,b)};g.add_backside_widgets=function(a,c){if(0!==a.length){b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Adding "+a.length+" backside widgets to "+this);var d=a.slice();b.UTILITIES.set_timeout(function(){var e=this.visible(),g=this.get_element(),k,n,m,h;b.UTILITIES.for_each_batch(d,function(d,p){if(d)if(b.debugging&&d.get_widget()===f)b.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),
a.splice(p,1);else{c&&(m=c[p]);k=d.get_element(!0);if(!k.parentElement){try{g.appendChild(k)}catch(ua){b.UTILITIES.report_internal_error("A backside is contained in one its backside widgets. This makes no sense. "+this+" should not be part of "+d+". "+ua+" In add_backside_widgets. This has been delayed so possibily things have changed since scheduled. ")}b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Widget element added to backside element.")}k.toontalk_widget_side=d;m&&(d.is_backside()?
(n=d.get_widget().get_backside(!0),h={left:m.backside_left,top:m.backside_top},d.get_widget().apply_backside_geometry(),m.advanced_settings_open&&n.set_advanced_settings_showing(!0,n.get_element())):(0===m.frontside_width&&(m.frontside_width=""),0===m.frontside_height&&(m.frontside_height=""),h={left:m.frontside_left,top:m.frontside_top},!k.style.transform&&d.is_resizable()&&(h.width=m.frontside_width||m.saved_width,h.height=m.frontside_height||m.saved_height)),b.UTILITIES.constrain_css_to_fit_inside(g,
h),$(k).css(h));d.set_visible(e);d.get_widget().rerender()}}.bind(this))}.bind(this),100)}};g.get_backside_dimensions=function(){if(1!==c||1!==d)return{x_scale:c,y_scale:d,original_width:G,original_height:N}};g.set_dimensions=function(a){c=a.x_scale;d=a.y_scale;a.original_width&&(G=a.original_width);a.original_height&&(N=a.original_height)};g.scale_to_fit=function(a,e){a=b.UTILITIES.scale_to_fit(a,e,450,150);c=a.x_scale;d=a.y_scale};g.scale_to=function(a,e){a=b.UTILITIES.scale_element(this.get_element(!0),
a,e,450,150);c=a.x_scale;d=a.y_scale};g.get_original_width=function(){return G};g.get_original_height=function(){return N};g.get_advanced_settings_showing=function(){return u};g.set_advanced_settings_showing=function(a){var c=this.get_element(),d=$(c).children(".toontalk-settings-backside-button"),e=$(c).children(".toontalk-advanced-settings-table");0===e.length&&this.add_advanced_settings&&(this.add_advanced_settings(),e=$(c).children(".toontalk-advanced-settings-table"));(u=a)?(e.show(),$(c).addClass("toontalk-backside-showing-advanced-settings"),
d.html("<"),b.UTILITIES.give_tooltip(d.get(0),"Click to hide the advanced settings."),this.get_backside_widgets().forEach(function(a){$(a.get_element()).hide()}),c.saved_width=c.style.width,c.saved_height=c.style.height,$(c).css({width:"",height:""})):(e.hide(),$(c).removeClass("toontalk-backside-showing-advanced-settings"),d.html(">"),b.UTILITIES.give_tooltip(d.get(0),"Click to show the advanced settings."),this.get_backside_widgets().forEach(function(a){$(a.get_element()).show()}),$(c).css({width:c.saved_width,
height:c.saved_height}))};g.run_status_changed=function(a){l(a)};b.UTILITIES.when_attached(F||e,function(){b.UTILITIES.get_element_width(e);b.UTILITIES.get_element_height(e);var a=$(h).width();var c=(c=$(F).width())?c+14:0;$(h).css({right:c});$(k).css({right:c+a+6});var d=$(k).width();R&&($(R).css({right:c+a+d+12}),b.UTILITIES.use_custom_tooltip(R));if(V){var f=$(R).width()||0;$(V).css({right:c+a+d+f+12})}F&&b.UTILITIES.use_custom_tooltip(F)});g.save_dimensions=function(){J=c;K=d;return!0};g.restore_dimensions=
function(){this.get_element();J&&(c=J);K&&(d=K);this.render_current_scale()};g.render_current_scale=function(){this.scale_backside(e,c,d,G,N);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();$(e).find("[title]").each(function(a,c){b.UTILITIES.use_custom_tooltip(c)})};g.compare_with=function(a){return this.get_widget().compare_with&&this.get_widget().compare_with(a)};if(b.debugging||b.logging)g.to_debug_string=function(a){return("backside of "+this.get_widget().to_debug_string()).substring(0,
a)};e.toontalk_widget_side=g;b.UTILITIES.drag_and_drop(e);b.UTILITIES.resizable_and_scalable(e,function(a,b){g.get_advanced_settings_showing()||(g.set_dimensions({x_scale:a,y_scale:b}),g.render_current_scale())},G,N);e.addEventListener("mouseenter",function(a){a=f.get_frontside();var c=f.get_parent_of_backside();!a||c&&!c.get_widget().is_top_level()?b.frontside.clear_selection_feedback_stack():b.UTILITIES.highlight_element(a.get_element())});e.addEventListener("mouseleave",function(a){f.is_top_level()||
b.UTILITIES.remove_highlight()});g.update_display=function(a){var c=this.get_description_text_area(),d=this.get_name_text_input(),f=e.getBoundingClientRect(),q;c&&(q=this.get_widget().get_description())&&(c.button.value=q);d&&(d.button.value=this.get_widget().get_name());this.get_erased()?$(e).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():$(e).find().show();a&&b.UTILITIES.for_each_batch(this.get_backside_widgets().filter(function(a){return!a.get_frontside()}),
function(a){var c=a.get_element(!0);a.set_visible(!0);b.UTILITIES.set_css(c,{left:(f.width-50)*Math.random(),top:(f.height-50)*Math.random()});e.appendChild(c);a.update_display()});g.display_updated()};g.display_updated=function(){$(this.get_element());G||(G=b.UTILITIES.get_element_width(e));N||(N=b.UTILITIES.get_element_height(e))};g.add_to_top_level_backside=function(a,b){return this.get_widget().add_to_top_level_backside(a,b)};f.get_backside_widgets&&(w=f.get_backside_widgets(),g.add_backside_widgets(w,
f.get_backside_widgets_json_views()));if(b.debugging||b.together)e.id=f.get_frontside_element(!0).id+"_backside";b.debugging&&(g._debug_id=f._debug_id+"_backside",g._debug_string="backside of "+f._debug_string);return g},toString:function(){return this.get_erased()?"any backside":"backside of "+this.get_widget()},get_full_description:function(b){return this.get_erased()?"any backside":"backside of "+this.get_widget().get_full_description(b)},remove_element:function(){$(this.get_element()).remove()},
get_free_location:function(b,g){var e=this.get_element(),a=e.getBoundingClientRect(),c=$(e).position(),d=function(a,b){return e===document.elementFromPoint(a,b)&&e===document.elementFromPoint(a+h.width,b)&&e===document.elementFromPoint(a,b+h.height)&&e===document.elementFromPoint(a+h.width,b+h.height)},f;if(b){var h=b.get_element(!0).getBoundingClientRect();0===h.width&&(h=b.get_default_width?{width:b.get_default_width(),height:b.get_default_height()}:{width:g&&g.default_width||100,height:g&&g.default_height||
100})}else h={width:g&&g.default_width||100,height:g&&g.default_height||100};if(g&&g.try_first&&d(g.try_first.left+c.left-window.pageXOffset,g.try_first.top+c.top-window.pageYOffset))return g.try_first;b=g&&void 0!==g.margin_fraction?g.margin_fraction:.05;var m=1-2*b;g=c.left+a.width*b-window.pageXOffset;var l=c.top+a.height*b-window.pageYOffset;var w=g;var r=g+a.width*(1-b)-h.width;for(f=l+a.height*(1-b)-h.height;l<f;){if(d(g,l))return{left:g+window.pageXOffset-c.left,top:l+window.pageYOffset-c.top};
g+=1.2*h.width;g>r&&(g=w,l+=1.2*h.height)}return{left:a.width*b+Math.random()*(a.width-h.width)*m,top:a.height*b+Math.random()*(a.height-h.height)*m}},create_infinite_stack_check_box:function(f,g){f=b.UTILITIES.create_check_box(g.get_infinite_stack(),"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+g.get_type_name()+" to be copied instead of moved.");var e=function(a){var b=!g.get_infinite_stack();g.set_infinite_stack(b);if(g.robot_in_training()){var d=b?"change dragging to make a copy of ":
"change dragging back to moving for ";g.robot_in_training().edited(g,{setter_name:"set_infinite_stack",argument_1:b,toString:d,button_selector:".toontalk-infinite-stack-check-box"})}a.stopPropagation()};f.button.addEventListener("click",e);f.button.addEventListener("touchstart",e);return f},create_parent_selection_check_box:function(f,g){var e=function(){var a=g.get_parent();if(a&&(a.is_nest()||a.is_hole()||a.is_element()))return a.is_hole()?a.get_parent_of_frontside():a},a=e(),c=function(a){return"Drag the "+
a.get_type_name()+" I'm on when dragging"},d=function(a){return"Check this if you want to drag the "+a.get_type_name()+" when you move this widget."};if(a){var k=b.UTILITIES.create_check_box(g.get_infinite_stack(),"toontalk-parent-selection-check-box",c(a),d(a));var h=function(a){var b=e();b?(b!==a&&m(b),k.button.disabled=!1,$(k.label).removeClass("ui-state-disabled"),k.container.title=d(b)):w()},m=function(a){k.label.innerHTML=c(a);k.button.innerHTML=d(a)},l=function(){h();return g},w=function(){k.button.checked=
!1;k.button.disabled=!0;$(k.label).addClass("ui-state-disabled");k.container.title="Widget moved so this has been disabled. Close and re-open the backside to refresh."};k.button.checked=g!==g.get_selection();k.button.checked||(g.get_selection=l);k.button.addEventListener("click",function(b){var c=e();e()?(c!==a&&m(c),g.get_selection=k.button.checked?function(){var a=e();h();return a?a.get_selection():g}:l,b.stopPropagation()):w()});return k}},create_click_opens_backside_check_box:function(f,g){var e=
b.UTILITIES.create_check_box(g.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box","Mouse click opens this backside only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors.");f=function(a){var b=!g.get_open_backside_only_if_stopped();g.set_open_backside_only_if_stopped(b);e.button.checked=b;if(g.robot_in_training()){var d=b?"change the response to a mouse click to open only if stopped the backside of ":
"change the response to a mouse click to always open the backside of ";g.robot_in_training().edited(g,{setter_name:"set_open_backside_only_if_stopped",argument_1:b,toString:d,button_selector:".toontalk-click-opens-backside-check-box"})}a.stopPropagation()};e.button.addEventListener("click",f);e.button.addEventListener("touchstart",f);return e},create_description_label:function(f,g){if(f=g.get_description())return b.UTILITIES.create_text_element("I'm the backside of a "+g.get_type_name()+" that is "+
f)},add_description_setting:function(f){var g=this.get_widget(),e=g.get_type_name(),a=b.UTILITIES.create_text_area(g.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+e+".",function(a){(a=b.UTILITIES.input_area_drop_handler(a,g.receive_description_from_dropped.bind(g),g))&&g.robot_in_training()&&g.robot_in_training().dropped_on_text_area(a,g,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})});
e=function(){var b=a.button.value.trim();g.set_description(b,!0,!0)};$(a.button).val(g.get_description());a.button.addEventListener("change",e);a.button.addEventListener("mouseout",e);this.set_description_text_area(a);(f||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(a.container));g.get_description()||a.button.setAttribute("placeholder",g.get_default_description())},add_name_setting:function(f){var g=this.get_widget(),e=g.get_type_name(),a=b.UTILITIES.create_text_input(g.get_name(),
"toontalk-name-input",g.get_name_input_label?g.get_name_input_label():"My name is ",g.get_name_input_title?g.get_name_input_title():"Edit the name of this "+e+". There is not much room so keep it short.",void 0,"text",function(a){(a=g.receive_name_from_dropped&&b.UTILITIES.input_area_drop_handler(a,g.receive_name_from_dropped.bind(g),g))&&g.robot_in_training()&&g.robot_in_training().dropped_on_text_area(a,g,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})});
e=function(){g.set_name&&g.set_name(a.button.value.trim(),!0,!0)};a.button.addEventListener("change",e);a.button.addEventListener("mouseout",e);this.set_name_text_input(a);(f||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(a.container))},add_advanced_settings:function(){var f=this.get_widget(),g=this.create_infinite_stack_check_box(this,f),e=this.create_parent_selection_check_box(this,f),a=this.create_click_opens_backside_check_box(this,f),c=f.get_type_name(),d=$("<button>Make a sensor nest</button>").button(),
k=$("<button>Make a function bird</button>").button(),h=document.createElement("table"),m=this.get_element(),l=function(a,c){var d=a.get_frontside_element(!0);f.add_to_top_level_backside(a,!1);a=c.offset();a.left-=120;0>a.left&&(a.left=0);b.UTILITIES.set_absolute_position(d,a)};$(m).find(".toontalk-settings-backside-button").get(0);var w;$(h).addClass("toontalk-advanced-settings-table");d.addClass("toontalk-make-sensor_nest_button toontalk-button");d.get(0).addEventListener("click",function(a){var c=
b.sensor.create("click","which",void 0,void 0,!0,f);l(c,d);f.robot_in_training()&&f.robot_in_training().created_widget(c,f,".toontalk-make-sensor_nest_button");a.stopPropagation()});d.attr("title","Click to create a nest which receives messages when events happen to this "+f.get_type_name()+".");k.addClass("toontalk-make-function_bird_button toontalk-button");k.get(0).addEventListener("click",function(a){var d=f.get_function_type&&f.get_function_type();d=b.bird.create_function(d||c);l(d,k);f.robot_in_training()&&
f.robot_in_training().created_widget(d,f,".toontalk-make-function_bird_button");a.stopPropagation()});f.is_number()||f.is_box()&&!f.is_scale()||f.is_element()?k.attr("title","Click to get a bird that flies to functions of "+f.get_type_name(!0)+"."):(k.attr("title","There are no functions that operate on "+f.get_type_name(!0)+" (yet)."),k.button("option","disabled",!0));if(0<arguments.length)for(w=0;w<arguments.length;w++)h.appendChild(arguments[w]);this.get_description_text_area()||this.add_description_setting(h);
f.set_name&&!this.get_name_text_input()&&this.add_name_setting(h);h.appendChild(b.UTILITIES.create_row(d.get(0),k.get(0),g.container,e&&e.container,a.container));this.is_primary_backside()||(g=$("<button>Remove me and my widget</button>").button(),g.get(0).addEventListener("click",function(){f.robot_in_training()&&(f.robot_in_training().removed(f),f.robot_in_training().removed(this));this.remove();f.remove()}.bind(this)),g.attr("title","Click to remove this "+f.get_type_name()+" and its backside."),
g.addClass("toontalk-remove-backside-and-widget-button"),b.UTILITIES.use_custom_tooltip(g.get(0)),h.appendChild(g.get(0)));b.UTILITIES.use_custom_tooltip(d.get(0));b.UTILITIES.use_custom_tooltip(k.get(0));m.appendChild(h)},get_type_name:function(){return"backside of "+b.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(f){var g;var e=$(this.get_element());if(0!==e.length){var a=this.get_widget();(g=a.robot_in_training())&&g.get_training_context()===a&&(g.hide_backside(),
$(g.get_backside_element()).find(".toontalk-train-backside-button").click(),a.add_to_top_level_backside(g.get_first_in_team()));var c=a.get_frontside_element(f&&a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_top_level());g=e.position();var d=e.parent().closest(".toontalk-backside");var k=function(d){var e=$(c).position(),g=function(){t&&(this.set_parent_of_backside(void 0,!0),t.is_backside()||t.removed_from_container(this,f,void 0,!0),a.forget_backside&&a.forget_backside());d.remove();
f&&a.backup_all()}.bind(this);b.UTILITIES.visible_element(d)?"0"===d.css("opacity")?(d.removeClass("toontalk-animating-element"),d.remove()):(d.addClass("toontalk-side-appearing"),b.UTILITIES.add_one_shot_event_handler(d.get(0),"transitionend",2500,g),b.UTILITIES.set_css(d,{left:e&&e.left,top:e&&e.top,opacity:.1})):g()}.bind(this);var t=a.get_parent_of_backside();b.UTILITIES.remove_highlight();h(this);a.backside_geometry=this.get_backside_dimensions();k(e);this.set_visible(!1);f&&c&&!b.UTILITIES.visible_element(c)&&
(g&&b.UTILITIES.set_css(c,{left:g.left,top:g.top}),!(e=b.UTILITIES.widget_side_of_jquery(d))||a.is_robot()&&e.get_widget().is_robot()&&a.get_first_in_team()===e.get_widget().get_first_in_team()||(e.widget_side_dropped_on_me(a,{event:f,ignore_training:!0}),a.render()));b.UTILITIES.for_each_batch(a.get_backside_widgets(),function(a){a.set_visible(!1)});if(a.on_backside_hidden)a.on_backside_hidden()}},create_advanced_settings_button:function(f,g){var e=document.createElement("div"),a=$(e);e.innerHTML=
"&gt;";a.addClass("toontalk-settings-backside-button toontalk-button toontalk-button-style");a.css({"z-index":b.UTILITIES.next_z_index()});e.addEventListener("click",function(b){f.set_advanced_settings_showing(!f.get_advanced_settings_showing(),f.get_element(),a);b.stopPropagation();g.robot_in_training()&&g.robot_in_training().button_clicked(".toontalk-settings-backside-button",g)});b.UTILITIES.give_tooltip(a.get(0),"Click to see the advanced settings of this "+g.get_type_name()+".");return e},scale_backside:function(f,
g,e,a,c){var d=Math.min(1,g,e);1===g&&1===e?!this.get_parent()||this.get_parent().is_backside()?b.UTILITIES.set_css(f,{width:a,height:c,transform:"","transform-origin":""}):b.UTILITIES.set_css(f,{width:"",height:""}):b.UTILITIES.set_css(f,{transform:"scale("+d+", "+d+")","transform-origin":"left top",width:a*g/d,height:c*e/d})},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&b.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(b,g){return this.get_widget().remove_backside_widget(b,
g)},top_level_widget:function(){return this.get_widget().top_level_widget()},robot_in_training:function(){return this.get_widget().robot_in_training()},remove:function(b){var f;this.is_primary_backside()?this.get_widget().remove():((f=this.get_parent_of_backside())&&(f.is_backside()?f.remove_backside_widget(this,!b):f.removed_from_container&&(f.is_backside()?f.remove_backside_widget(this,!0):f.removed_from_container(this,b))),this.set_parent_of_backside(void 0),(b=this.get_element())&&$(b).remove())},
match:function(b){if(b.is_backside()){if(this.get_erased())return"matched";var f=this.get_widget();b=f.match(b.get_widget());return b===f?this:b}b.last_match=this;return b},add_copy_to_container:function(b,g,e){return this.get_widget().add_copy_to_container(b||this.copy(),g,e)},has_ancestor:function(b){var f;return this===b?!0:(f=this.get_parent_of_backside())?f.has_ancestor(b):!1},has_ancestor_either_side:function(b){if(this===b||this===b.get_backside())return!0;var f=this.get_parent_of_frontside();
try{if(f||(f=this.get_parent_of_backside()))return f.has_ancestor_either_side(b)}catch(e){console.error("widget.has_ancestor_either_side encountered this error: "+e.message)}return!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},set_parent:function(b){this.set_parent_of_backside(b)},maintain_proportional_dimensions:function(){return!1},constrained_by_container:function(){return!1},
set_running:function(){},can_run:function(b){return this.get_widget().can_run(b)},dereference:function(){return this},is_of_type:function(b){return this.get_widget().is_of_type(b)},is_top_level:function(){return this.get_widget().is_top_level()},ok_to_set_dimensions:function(){return!1},add_listener:function(b,g){this.get_widget().add_listener(b,g)},remove_listener:function(b,g,e){this.get_widget().remove_listener(b,g,e)},get_listeners:function(b){return this.get_widget().get_listeners(b)},is_hole:function(){return!1},
is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},is_robot:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},get_infinite_stack:function(){return!1},drag_started:function(b,g){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,g)},get_json:function(f,g,e,a){var c=this.get_backside_dimensions(),
d=$(this.get_element()).position();h(this);var k=c?{width:c.original_width,height:c.original_height,transform:"scale("+c.x_scale+", "+c.y_scale+")","transform-origin":"left top 0px",left:d.left,top:d.top}:d;c=function(a,b,c){g({type:"backside",my_widget:a,css:k,erased:this.get_erased(),view:{}},b,c+1)}.bind(this);b.UTILITIES.get_json(this.get_widget(),f,c,e,a+1)},get_selection:function(){return this}}}(window.TOONTALK);
TOONTALK.creators_from_json.backside=function(b,h){h=TOONTALK.UTILITIES.create_from_json(b.my_widget,h).create_backside();var f=h.get_element();TOONTALK.UTILITIES.set_css(f,b.css);b.erased&&h.set_erased(b.erased,!1,!0);return h};window.TOONTALK.frontside=function(b){var h=[];return{create:function(f){var g=Object.create(this),e=document.createElement("div"),a=$(e),c=function(c){if(!($(c.target).is(".ui-resizable-handle")||"click"===c.type&&1!==c.which||f.get_open_backside_only_if_stopped()&&f.get_running())){if(a.is(".toontalk-top-level-resource")&&!c.altKey)f.set_running(!f.get_running());else{if(b.open_backside_only_if_alt_key&&!c.altKey)return;f.open_backside(void 0,c.togetherjsInternal&&0);f.robot_in_training()&&f.robot_in_training().backside_opened(f);
f.backup_all()}c.stopPropagation()}},d=function(a,c){var d=a.get_backside();a=(a.is_empty_hole()?wiget.get_parent_of_frontside():a).get_selection().get_frontside_element();a=$(a);d&&b.UTILITIES.highlight_element(d.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");a.is(".toontalk-top-level-resource")||a.addClass("toontalk-wiggle");c.stopPropagation()},k;$(e).addClass("toontalk-frontside toontalk-side");f.get_infinite_stack()&&$(e).addClass("toontalk-infinite-stack");e.toontalk_widget_side=
f;b.UTILITIES.drag_and_drop(e);g.get_element=function(){return e};g.get_widget=function(){return f};g.visible=function(){return k};g.set_visible=function(a,c){var d=this.get_widget();(k=a)&&b.UTILITIES.when_attached(this.get_element(!0),d.render.bind(d));d.walk_children_now_or_later&&d.walk_children_now_or_later(function(b,c){b.set_visible(a,c);return!0},c)};e.addEventListener("click",c);e.addEventListener("touchstart",c);e.addEventListener("mouseenter",function(a){d(f,a);0<=h.indexOf(f)?h=[]:h.push(f)});
e.addEventListener("mouseleave",function(a){var c=f.get_backside(),e=f.is_empty_hole()?wiget.get_parent_of_frontside():f;c&&b.UTILITIES.remove_highlight();$(e.get_frontside_element()).removeClass("toontalk-wiggle");h.pop();0<h.length&&d(h[h.length-1],a)});b.debugging&&(e.id=f._debug_id);return g},update_display:function(){return this.get_widget().update_display()},remove:function(){var b=this.get_element();$(b).remove();b.toontalk_widget_side=null},clear_selection_feedback_stack:function(){h=[]}}}(window.TOONTALK);(function(b){var h=180/Math.PI,f=Math.log(10),g=bigrat.fromInteger(10),e=bigrat.fromValues(1,2),a=bigrat.fromValues(-1,2),c=bigrat.fromInteger(360),d=bigrat.fromDecimal(2*Math.PI),k=Math.log10?Math.log10:function(a){return Math.log(a)/f},t=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},m=function(a){var c=t(a),d=b.number.ZERO(b.number.function_bird_results_default_format),e=b.number.ZERO(b.number.function_bird_results_default_format);
d.set_value(c.integer_part);e.set_value(c.fractional_part);return b.box.create(2,!0,[d,e],"The integer and fraction parts of "+a.toString().replace(",","/"))},l=function(a,b){a=bigrat.divide(bigrat.create(),a,b);var c=t(a);return bigrat.multiply(a,c.fractional_part,b)},w=function(b){b=t(b);return bigrat.isLessThan(b.fractional_part,a)?bigrat.subtract(b.integer_part,b.integer_part,bigrat.ONE):bigrat.isLessThan(b.fractional_part,bigrat.ZERO)||bigrat.isLessThan(b.fractional_part,e)?b.integer_part:bigrat.add(b.integer_part,
b.integer_part,bigrat.ONE)},r=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},v=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(b.widget),c=function(a,b,c,d){var e="",f=100;c=50/c;b/=1+b;if(d)for(d=0;f>=c&&
d<a.length;)e=e+"<span class='toontalk-digit' style='font-size:"+f+"%'>"+a[d]+"</span>",d+=1,"-"!==a[d]&&(f*=b);else for(d=a.length-1;f>=c&&0<d;)e="<span class='toontalk-digit' style='font-size:"+f+"%'>"+a[d]+"</span>"+e,--d,"-"!==a[d]&&(f*=b);return e},d=function(a,b){return 0>a?0:Math.ceil(Math.log(.5/b)/Math.log(a/(1+a)))},e=function(a,b,d){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+
e(a,1.25*b,.8*d)+"</span>";b=b/2-1;return c(a,b,d,!0)+c(a,b,d,!1)},f=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?f(a.substring(0,a.length-1)):a},h=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},m=function(a){switch(a){case "+":return"";case "-":return"&minus;&thinsp;";case "*":return"&times;&thinsp;";case "/":return"&divide;&thinsp;";case "=":return"&equals;&thinsp;";case "^":return"^";default:return b.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}},l=function(a){switch(a){case "+":return"toontalk-plus-radio-button";case "-":return"toontalk-minus-radio-button";case "*":return"toontalk-times-radio-button";case "/":return"toontalk-divide-radio-button";
case "=":return"toontalk-set-equal-radio-button";default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}},r=function(a){switch(a){case "decimal":return"toontalk-decimal-radio-button";case "proper_fraction":return"toontalk-proper-fraction-radio-button";case "improper_fraction":return"toontalk-improper-fraction-radio-button";case "scientific_notation":return"toontalk-scientific-notation-radio-button";default:return b.UTILITIES.report_internal_error("Unsupported number format: "+
a),""}},v=function(a,b){switch(a){case "+":return"add "+b+" to";case "-":return"subtract "+b+" from";case "*":return"multiply "+b+" with";case "/":return"divide "+b+" into"}},t=function(a){switch(a){case "+":return"addition";case "-":return"subtraction";case "*":return"multiplication";case "/":return"division";case "=":return"equality";default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";
a.create=function(c,d,e,f,g,k){var m=Object.create(a),n=h(c,d);e||(e="+");m.is_number=function(){return!0};m.set_value=function(a,c){if(c||!bigrat.equals(n,a))return this.fire_value_change_listeners(n,a),(c=this.get_frontside_element())&&c.dispatchEvent(b.UTILITIES.create_event("value changed",{old_value:n,new_value:a})),n=a,this.rerender(),b.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&b.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),
this};m.set_value_from_sub_classes=m.set_value;m.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed");if(c){var d={type:"value_changed",old_value:a,new_value:b};c.forEach(function(a){a(d)})}};m.get_value=function(){return n};m.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));b.debugging&&"0,0"===this.get_value().toString()&&b.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};m.copy=function(b){return this.add_to_copy(a.create(n[0],
n[1],e,f,g,k),b)};m.get_format=function(){return f||a.default_format};m.set_format=function(a,b,c){f=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_format",argument_1:a,toString:"by changing the format to "+a,button_selector:"."+r(a)});return this};m.get_operator=function(){return e};m.set_operator=function(a,b,c){e=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_operator",argument_1:a,
toString:"by changing the operator to "+t(a),button_selector:"."+l(a)});return this};m.get_approximate=function(){return k};m.set_approximate=function(a,b){k=a;b&&this.rerender();return this};a.add_standard_widget_functionality(m);m.set_description(g);if(b.listen){var v,u,C;m.add_speech_listeners({commands:"add | plus | sum | addition | subtract | subtraction | take away | times | multiply | multiplication | divide | division | equal | equals | decimal number | decimal | mixed number | mixed | improper fraction | improper | fraction | scientific notation | scientific",
numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var c=b.UTILITIES.get_dragee_copy()||m;switch(a){case "add":case "plus":case "sum":case "addition":c.set_operator("+",!0,!0);break;case "subtract":case "take away":case "subtraction":c.set_operator("-",!0,!0);break;case "times":case "multiply":case "multiplication":c.set_operator("*",!0,!0);break;case "divide":case "divides":case "divide by":case "division":c.set_operator("/",!0,!0);break;case "equal":case "equals":c.set_operator("=",
!0,!0);break;case "decimal number":case "decimal":c.set_format("decimal",!0,!0);break;case "mixed number":case "mixed":c.set_format("mixed_number",!0,!0);break;case "improper fraction":case "improper":case "fraction":c.set_format("improper_fraction",!0,!0);break;case "scientific notation":case "scientific":c.set_format("scientific_notation",!0,!0);break;default:v=parseFloat(a),isNaN(v)?console.log("did not understand spoken command: '"+a+"'"):(c.set_value_from_decimal(v),c.robot_in_training()&&c.robot_in_training().edited(c,
{setter_name:"set_value_from_decimal",argument_1:v,toString:"by changing its value to "+v,button_selector:".toontalk-numerator-input"}))}c.update_display();u="You are now holding "+c.get_text(!0);u!==C&&(m.display_message("You are now holding "+c.get_frontside_element(!0).innerHTML,{display_on_backside_if_possible:!0,duration:4E3,plain_text:u}),C=u)}})}b.debugging&&(m._debug_string=m.toString(),m._debug_id=b.UTILITIES.generate_unique_id(),n._debug_id_new=m._debug_id);return m};a.create_from_bigrat=
function(a){var c=b.number.ZERO();c.set_value(a);return c};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(h(a,b))};a.set_numerator=function(a){return this.set_value(h(a,this.get_value()[1].toString()))};a.set_numerator_to_float=function(a){return this.set_value(bigrat.divide(this.get_value(),bigrat.fromDecimal(a),this.denominator()),!0)};a.set_denominator=function(a){return this.set_value(h(this.get_value()[0].toString(),a))};
a.set_denominator_to_float=function(a){return this.set_value(bigrat.divide(this.get_value(),this.numerator(),bigrat.fromDecimal(a)),!0)};a.ONE=function(){return b.number.create(1)};a.ZERO=function(a){return b.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};a.compare_with_number=
function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),c=function(a,b){var c=a.indexOf('style="');return 0<=c?a.substring(0,c+7)+b+a.substring(c+7):a},d=28,e;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string(50));a=a.get_element();if($(a).is(".toontalk-conditions-contents"))var f=$(a);else if($(a).parent().is(".toontalk-backside, .toontalk-json, .toontalk-robot")){f=
$(a);var g=!0}else if($(a).parent().is(".toontalk-element-frontside")){f=$(a);var k=g=!0}else f=$(a).parent().is(".toontalk-scale-half")?$(a):$(a).parent();0===f.length&&(d=this.get_parent_of_frontside())&&(d.get_widget().is_hole()&&(d=d.get_parent_of_frontside()),f=$(d.get_frontside_element()));1===b.nest.CONTENTS_WIDTH_FACTOR&&1===b.nest.CONTENTS_HEIGHT_FACTOR&&f.is(".toontalk-nest")&&f.parent().is(".toontalk-box-hole")&&!f.parent().is(".toontalk-scale-half")&&(f=f.parent());if($(a).is(".toontalk-carried-by-bird"))var m=
e=100;else if($(a).is(".toontalk-element-attribute"))e=200,m=32;else if(g&&(a===f.get(0)||f.is(".toontalk-top-level-resource")))e=$(a).width(),m=$(a).height(),e&&m||(e=this.saved_width||this.get_default_width(),m=this.saved_heieght||this.get_default_height(),$(a).css({width:e,height:m}));else{0<f.length&&(e=f.width(),m=f.height());if(0===e||0===m||0===f.length){b.logging&&0<=b.logging.indexOf("display")&&0<f.length&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());
b.UTILITIES.is_attached(a)||b.UTILITIES.when_attached(a,this.update_display.bind(this));return}f.is(".toontalk-nest")&&(e*=b.nest.CONTENTS_WIDTH_FACTOR,m*=b.nest.CONTENTS_HEIGHT_FACTOR)}var h=$(a).children(".toontalk-widget");h.is("*")?h=h.get(0):(h=document.createElement("div"),a.appendChild(h));$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");d=this.get_border_size(e,m);k||(4===d?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):
8===d?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):16===d?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number"));k=m-2*d;g=this.to_HTML(e/(k*b.FONT_ASPECT_RATIO),e,m,k,this.get_format(),!0,this.get_operator(),g);b.UTILITIES.on_a_nest_in_a_box(a)&&(g=c(g,"width:"+(e-2*d)+"px;"),g=c(g,"height:"+(m-2*d)+"px;"));h.innerHTML=g;h.translate=!1;$(h).addClass("toontalk-widget notranslate");f.is(".toontalk-box-hole")&&
$(a).css({width:"",height:""});$(a).is(".toontalk-conditions-contents")&&$(a).css({width:b.UTILITIES.get_toontalk_css_numeric_attribute("width",".toontalk-conditions-container")-2*d,height:b.UTILITIES.get_toontalk_css_numeric_attribute("height",".toontalk-conditions-container")-2*d});b.UTILITIES.give_tooltip(a,this.get_title())};a.get_default_width=function(){return 76};a.get_default_height=function(){return 55};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?
16:32};a.to_HTML=function(a,h,n,l,r,v,t,u){var w=!1!==v?" toontalk-top-level-number":"",B=4,y=a,p;this.is_attribute_widget&&this.is_attribute_widget()?w+=" toontalk-attribute-number":this.get_approximate()&&!this.get_erased()&&(w+=" toontalk-approximate-number");u&&(w+=" toontalk-number-size-unconstrained-by-container");var q=t?m(t):"";y||(y=4);l||(l=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+w+'" style="font-size: '+l+'px;"></div>';if(0<q.length){--y;
if(p="-"===t&&(this.is_negative()||this.is_zero())&&(this.is_integer()||"improper_fraction"!==r&&"proper_fraction"!==r&&"mixed_number"!==r))--y,q+="&nbsp;";2>y&&(l*=Math.max(1,y)/2,y=2)}if(this.is_integer()&&"scientific_notation"!==r){try{var H=bigrat.toBigInteger(this.get_value()).toString()}catch(fa){b.UTILITIES.report_internal_error("Error converting number to a string: "+fa),H="0"}v=H.length;0<q.length&&v++;4>y&&v>y&&(r=Math.min(4,v),l*=y/r,y=r);return'<div class="toontalk-number toontalk-integer'+
w+'" style="font-size: '+l+'px;">'+q+e(H,y,l)+"</div>"}if(this.get_approximate()||this.is_attribute_widget()){if("decimal"===r)var S=bigrat.toDecimal(this.get_value()).toString();else if("scientific_notation"===r&&(S=bigrat.toDecimal(this.get_value()).toExponential(),H=S.indexOf("e"),0<=H)){var P=S.substring(H+1);S=S.substring(0,H)}if(S)return v=S.length,y>v&&(y=v),0<q.length&&v++,P&&(y-=3+P.length/2),"scientific_notation"===r&&(B+=2),y<B&&v>y&&(r=Math.min(B,v),l=0>=y?Math.max(1,y)/r*l:Math.max(2,
y)/r*l),y=P?'&times;10<sup style="font-size: '+l/2+'px;">'+P+"</sup>":"",l=Math.min(l,h/(b.FONT_ASPECT_RATIO*v)),'<div class="toontalk-number toontalk-approximate-number'+w+'" style="font-size: '+l+'px;">'+q+'<div style="margin-top: '+(n-l)/2+'px">'+S+"</div>"+y+"</div>"}S=' style="font-size:'+.45*l+'px;"';if("improper_fraction"===r||!r)return l='<table class="toontalk-number toontalk-improper-fraction'+w+'"'+S+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+e(this.numerator_string(),
2*y,l)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+e(this.denominator_string(),2*y,l)+"</td></tr></table>",""===q?l:"<table class='toontalk-operator-and-fraction'"+S+"><tr><td style='width: 20%;'>"+q+"</td><td>"+l+"</td></tr></table>";if("mixed_number"===r||"proper_fraction"===r){q=this.integer_part();if(q.is_zero())return this.to_HTML(y,
h,n,l,"improper_fraction",v,t);P=this.copy({just_value:!0}).subtract(q).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+w+'"'+S+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+q.to_HTML(y/2,h,n,l,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+P.to_HTML(y/2,h,n,l,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===r)return 4>y&&(l*=Math.max(1,y)/4,y=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+
w+'" style="font-size: '+l+'px;">'+q+this.decimal_string(y,l)+"</div>";if("scientific_notation"===r){B=bigrat.isNegative(this.get_value());H=this.get_value();p=bigrat.abs(bigrat.create(),H);P=bigrat.isLessThan(p,bigrat.ONE);if(bigrat.equals(H,bigrat.ZERO))P=0;else{if(P){var A=bigrat.divide(bigrat.create(),bigrat.ONE,p);H=bigrat.toBigInteger(A)}else H=bigrat.toBigInteger(p);H=H.toString();P=P?0===A[1].compare(BigInteger.ONE)?-H.length+1:-H.length:H.length-1}A=6+(0===P?1:Math.ceil(k(Math.abs(P)))/2);
B&&A++;if(a<A+1)return this.to_HTML(A+1,h,n,l*a/(A+1),r,v,t,u);h=d(y-(Math.min(A,y/2)+1),l);P<h?(n=bigrat.power(bigrat.create(),g,h-P),n=bigrat.multiply(bigrat.create(),this.get_value(),n),h=bigrat.toBigInteger(n).toString().substring(0,h+1)):h=bigrat.toBigInteger(this.get_value()).toString().substring(0,h+1);if(this.is_integer()||this.is_reciprocal_of_integer())h=f(h);B?(n=h.substring(0,2),h=h.substring(2)):(n=h.substring(0,1),h=h.substring(1));y=c(h,y*(1-A/y),l,!0);0<y.length&&(y="<span class='toontalk-decimal-point'>.</span>"+
y);return'<table class="toontalk-number toontalk-scientific_notation'+w+'"'+S+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+w+'" style="font-size: '+.9*l+'px;">'+q+n+y+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+l+'px;"> &times;10<sup style="font-size: '+l/2+'px;">'+P+"</sup></div></td></tr></table>"}};a.get_default_description=function(){return this.get_approximate()?
"a number from an approximate calculation.":"a number."};a.is_resizable=function(){return!0};a.drop_on=function(a,b){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,c){var d;if(!a.is_backside()){if(a.visible()&&this.visible()&&(c.event||c.robot)){if(c.robot){if(!c.robot.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(a,
c);a.robot_waiting_before_next_step=c.robot}var e=document.createElement("div");$(e).addClass("toontalk-bammer-down");var f=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level");e.style.left="-10px";e.style.top=f.height()+"px";0<f.length&&f.get(0).appendChild(e);var g=this.get_frontside_element();var k=$(g).offset();k.left-=.75*$(e).width();k.left+=.5*$(g).width()+.1*$(e).width();k.top-=.5*$(g).height()+.4*$(e).height();g=function(){b.sounds&&b.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,
c)&&c.robot&&(this.rerender(),c.robot.run_next_step());c.event&&this.backup_all();$(e).removeClass("toontalk-bammer-down");b.UTILITIES.set_timeout(function(){var a=f.offset();a||(a={left:0,top:0});$(e).addClass("toontalk-bammer-away");k.left=a.left+f.width()-100;k.top=a.top+f.height()+100;d=function(){$(e).remove()};b.UTILITIES.animate_to_absolute_position(e,k,d,c.robot&&c.robot.transform_animation_speed(b.animation_settings.BAMMER_ANIMATION_SPEED));$(e).css({opacity:.01})})}.bind(this);b.UTILITIES.animate_to_absolute_position(e,
k,g,c.robot&&c.robot.transform_animation_speed(b.animation_settings.BAMMER_ANIMATION_SPEED));$(a.get_frontside_element(!0)).css({"z-index":b.UTILITIES.next_z_index()});$(e).css({opacity:1,"z-index":b.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c)}};a.number_dropped_on_me_semantics=function(a,c){c&&c.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove({remove_backside:!0});switch(a.get_operator()){case "+":return this.add(a);
case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a,c);case "=":return this.set_value(a.get_value());case "^":return this.power(a);default:b.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_side_dropped_on_me=function(a,c){if(a.number_dropped_on_me)return this.number_dropped_on_me(a,c);(a=a.get_frontside_element())&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",
{element_widget:a,where:"front"}));return!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.divide=function(a,c){if(a.is_zero())return a="Can't divide by zero. Operation ignored.",c&&c.robot&&(a+=
" Caused by the robot who "+c.robot),b.UTILITIES.display_message(a),this;this.set_value(bigrat.divide(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),
!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};a.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(a){var b="";if(this.get_erased())return"erased number";"+"===this.get_operator()||a&&a.without_operator||(b=this.get_operator());return b+bigrat.str(this.get_value())};a.get_text=function(a){var c=this.get_format(),d=
"";switch(this.get_operator()){case "-":d="subtract ";break;case "*":d="multiply by ";break;case "/":d="divide by ";break;case "=":d="make what I'm dropped on equal to "}if(this.get_approximate()||this.is_attribute_widget&&this.is_attribute_widget())return"approximately "+bigrat.toDecimal(this.get_value()).toString();if(this.is_integer()||"improper_fraction"===c)return a?d+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):d+this.toString({without_operator:!0});c=this.integer_part();
if(c.is_zero())return a?d+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):d+this.toString({without_operator:!0});var e=this.copy({just_value:!0}).subtract(c).absolute_value();return a?d+b.UTILITIES.number_to_words(c.toString({without_operator:!0}))+(a?" and ":" ")+b.UTILITIES.number_to_words(e.toString({without_operator:!0})):d+c+" "+e};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};
a.get_json=function(a,c,d,e){c({type:"number",operator:this.get_operator(),numerator:b.UTILITIES.string_to_array(this.numerator_string(),100),denominator:b.UTILITIES.string_to_array(this.denominator_string(),100),format:this.get_format(),approximate:this.get_approximate()},d,e+1)};b.creators_from_json.number=function(b){if(b)return Array.isArray(b.numerator)&&(b.numerator=b.numerator.join("")),Array.isArray(b.denominator)&&(b.denominator=b.denominator.join("")),a.create(b.numerator,b.denominator,
b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};a.is_reciprocal_of_integer=function(){return 0===this.get_value()[0].compare(BigInteger.ONE)&&0!==this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],
BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};a.decimal_string=function(b,k){if(this.is_integer())return this.numerator_string();var h=this.get_value();var m=a.create(h[0],h[1]);var n=m.integer_part();h=n.toString();"0"===h&&this.is_negative()&&(h="-"+h);var l=m.get_value();bigrat.subtract(l,l,n.get_value());n=b-(Math.min(h.length,b/2)+
1);m=d(n,k);b=Math.min(h.length,b/2);bigrat.isNegative(l)&&bigrat.abs(l,l);var r=bigrat.fromValues(l[0],1);l=bigrat.fromValues(l[1],1);if(bigrat.equals(r,bigrat.ZERO))m="0";else{var v="",t=bigrat.create();bigrat.create();var u=bigrat.create();for(bigrat.multiply(r,r,g);m>v.length;){if(bigrat.isLessThan(r,l))v+="0";else{bigrat.divide(t,r,l);var w=bigrat.toBigInteger(t);v+=w.toString();bigrat.subtract(u,t,bigrat.fromValues(w,1));bigrat.multiply(r,u,l);if(bigrat.equals(r,bigrat.ZERO)){v=f(v);break}}bigrat.multiply(r,
r,g)}m=v}n=m.length<n?m:c(m,n,k,!0);return e(h,b,k)+"<span class='toontalk-decimal-point'>.</span>"+n};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.get_widget().match_with_any_number)return a.get_widget().match_with_any_number();this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===this.get_operator())return"matched";
a.last_match=this;return a};a.get_custom_title_prefix=function(){var a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"/"===this.get_operator()?"Drop me on another number I'll divide him by my value.":"Drop me on another number and I'll "+v(this.get_operator(),"myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+b.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=
function(){return{create:function(a){var c=b.backside.create(a),d=c.get_element(),e=document.createElement("div"),f=a.numerator_string(),g=a.denominator_string(),k=b.UTILITIES.create_text_area(f,"toontalk-numerator-input","","Type here to edit the numerator",void 0,"number"),h=b.UTILITIES.create_text_area(g,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),m=b.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number",
"Display number as a decimal.",!0),l=b.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction.",!0),n=b.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction.",!0),r=b.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button",
"Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",!0),v=b.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",!0),t=b.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",!0),w=b.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),F=b.UTILITIES.create_radio_button("operator",
"/","toontalk-divide-radio-button","&divide;","I will divide what I'm dropped on.",!0),D=b.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",!0),R=function(b){var c=k.button.value.trim(),d=h.button.value.trim(),e=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",
replacement:e(a,b).replacement};a=e(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",replacement:a.replace(/[^\d]*/g,"")}};if(c!==f||d!==g){var p=e(c,"numerator");if(p.message){var q=parseFloat(c);if(isNaN(q))a.display_message(p.message,{display_on_backside_if_possible:!0}),c=p.replacement;else var m=bigrat.fromDecimal(q)}if("0"===d)a.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1.",
{display_on_backside_if_possible:!0}),d="1";else if(p=e(d,"denominator"),p.message){var l=parseFloat(d);if(isNaN(l))a.display_message(p.message,{display_on_backside_if_possible:!0}),d=p.replacement||"1";else var n=bigrat.fromDecimal(l)}if(m&&n)a.set_value(bigrat.divide(a.get_value(),m,n),!0);else if(m)a.set_value(bigrat.divide(a.get_value(),m,bigrat.fromValues(d,1)),!0);else if(n)a.set_value(bigrat.divide(a.get_value(),bigrat.fromValues(c,1),n),!0);else if(!a.set_from_values(c,d)&&!isNaN(l))return;
f=a.numerator_string();g=a.denominator_string();a.robot_in_training()&&(b=b.target.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:n?"set_denominator_to_float":"set_denominator",argument_1:d,toString:"by changing the value of the denominator to "+d,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:m?"set_numerator_to_float":"set_numerator",argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+
b}));a.rerender()}},V=function(){var c=b.UTILITIES.selected_radio_button(m,l,n,r);c&&(c=c.button.value,a.set_format(c,!0,!0))},aa=function(){var c=b.UTILITIES.selected_radio_button(v,t,w,F,D);c&&(c=c.button.value,a.set_operator(c,!0,!0))},X=b.UTILITIES.create_horizontal_table(k.container,e,h.container),ba=b.UTILITIES.create_div(m,l,n,r),p=b.UTILITIES.create_div(v,t,w,F,D),q=b.backside.create_advanced_settings_button(c,a),H=c.update_display.bind(c),S=c.add_advanced_settings,P=function(){switch(a.get_format()){case "decimal":return m;
case "improper_fraction":return n;case "mixed_number":case "proper_fraction":return l;case "scientific_notation":return r}},A=function(){switch(a.get_operator()){case "+":return v;case "-":return t;case "*":return w;case "/":return F;case "=":return D}};e.innerHTML="/";$(e).addClass("ui-widget");k.button.addEventListener("change",R);k.button.addEventListener("mouseout",R);k.button.addEventListener("mouseenter",function(){f=k.button.value.trim()});h.button.addEventListener("change",R);h.button.addEventListener("mouseout",
R);h.button.addEventListener("mouseenter",function(){g=h.button.value.trim()});d.appendChild(X);d.appendChild(q);m.button.addEventListener("change",V);l.button.addEventListener("change",V);n.button.addEventListener("change",V);r.button.addEventListener("change",V);b.UTILITIES.check_radio_button(P());b.UTILITIES.check_radio_button(A());v.button.addEventListener("change",aa);t.button.addEventListener("change",aa);w.button.addEventListener("change",aa);F.button.addEventListener("change",aa);D.button.addEventListener("change",
aa);c.update_display=function(){$(k.button).val(a.numerator_string());$(h.button).val(a.denominator_string());b.UTILITIES.check_radio_button(P());b.UTILITIES.check_radio_button(A());H()};c.add_advanced_settings=function(){S.call(c,ba,p);$(ba).controlgroup().removeClass("ui-controlgroup");$(p).controlgroup().removeClass("ui-controlgroup")};b.UTILITIES.when_attached(d,function(){c.is_primary_backside()||a.add_listener("value_changed",function(){c.rerender()})});return c}}}();window.TOONTALK.number.function=
function(){var a=b.create_function_table(),e=function(a){return bigrat.toDecimal(l(a,c))},f=function(a){return bigrat.toDecimal(l(a,d))},g=function(){return!0};a.add_function_object("sum",function(c,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.add,"sum",d)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",function(c,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.subtract,"difference",d)},"The bird will return with the result of subtracting the numbers in the box from the first number.",
"-");a.add_function_object("product",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.multiply,"product",d)},"The bird will return with the product of the numbers in the box.","\u00c3\u0192\u00c6\u2019\u00c3\u00a2\u00e2\u201a\u00ac\u00e2\u20ac\u009d");a.add_function_object("division",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.divide,"division",d)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00c3\u0192\u00c6\u2019\u00c3\u201a\u00c2\u00b7");
a.add_function_object("modulo",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(l),2,"modulo",c)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.minimum,"minimum",d)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(c,
d){return a.n_ary_widget_function(c,b.number.ONE,b.number.maximum,"maximum",d)},"The bird will return with the largest of the numbers in the box.","max");a.add_function_object("absolute value",function(c,d){return a.n_ary_function(c,function(a){var d=b.number.ZERO(c.get_hole_contents(1).get_format());bigrat.abs(d.get_value(),a);return d},1,"absolute value",d)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c){return a.n_ary_function(b,
a.bigrat_function_to_widget_function(function(a,b){a=bigrat.power(bigrat.create(),a,b[0].valueOf());b=b[1].valueOf();return 1===b?a:bigrat.nthRoot(bigrat.create(),a,b)},function(a){return 0!==a[1][1].compare(BigInteger.ONE)}),2,"power",c)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):
Math.log(arguments[0])/Math.log(arguments[1])},g),1,"logarithm",c)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).","log");a.add_function_object("random",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?
Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.","rand");a.add_function_object("round",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(w),
1,"round",c)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(r),1,"floor",c)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(v),1,"ceiling",c)},"The bird will return the smallest integer greater than or equal to the number.","ceil");a.add_function_object("delay",
function(c,d){var e=Date.now(),f=a.check_message(c);if("string"!==typeof f)if(2>f.box_size)a.report_error("Delay function birds need a number in the second hole saying how long to wait.",f);else{var g=c.get_hole_contents(1).to_float();setTimeout(function(){var g=b.number.ZERO(b.number.function_bird_results_default_format);g.set_value_from_decimal((Date.now()-e)/1E3);g.set_approximate(!0);a.process_response(g,f,c,d)},1E3*g);return!0}},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");
a.add_function_object("integer and fraction parts",function(b,c){return a.n_ary_function(b,m,1,"integer and fraction parts",c)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/h)},!0,e),1,"sine",c)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",
function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/h)},!0,e),1,"cosine",c)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return h*Math.atan(a)},!0),1,"arc tangent",c)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.",
"atan");a.add_function_object("arc tangent of y and x",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return h*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.","atan2");a.add_function_object("sine (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,
!0,f),1,"sine (in radians)",c)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,f),1,"cosine (in radians)",c)},"The bird will return with an approximation of the cosine of the number (in radians).","cos rad");a.add_function_object("arc tangent (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,
!0),1,"arc tangent (in radians)",c)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",c)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.",
"atan2 rad");a.add_function_object("turn into words",b.widget.get_description_function(a),"The bird will return with words describing what is in the second hole.","describe",["a widget"]);a.add_function_object("speak",b.widget.get_speak_function(a),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);a.add_function_object("listen for a number",b.widget.get_listen_function(a,!0),"The bird will cause the browser to listen to the next number said and give the number to the bird in the first hole. If you put a number between 0 and 1 in the second hole then only recognitions with at least that confidence will be considered. ","listen",[]);return a.get_function_table()}()})(window.TOONTALK);(function(b){var h=function(f,g,e,a){if(f&&0<=e&&f.maintain_proportional_dimensions()&&f.get_default_width){var c=f.get_default_width();f=f.get_default_height();e/c>=a/f?(c=c*a/f,e={left:(e-c)/2,top:0,width:c,height:a}):(c=f*e/c,e={left:0,top:(a-c)/2,width:e,height:c})}else f.is_backside()&&(f.update_display(),f.scale_to(e,.92*a)),e={left:0,top:0};b.UTILITIES.set_css(g,e)};window.TOONTALK.box=function(b){var f=Object.create(b.widget);f.create=function(e,a,c,d,g){var k=Object.create(f),m=[];"undefined"===
typeof a&&(a=!0);k.is_box=function(){return!0};k.get_horizontal=function(){return a};k.set_horizontal=function(b,c,d){a=b;c&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_horizontal",argument_1:b,toString:"by changing the orientation to "+(b?"horizontal":"vertical"),button_selector:b?".toontalk-horiztonal-radio-button":"toontalk-vertical-radio-button"});return this};k.get_hole=
function(a){return m[a]};k.get_hole_contents=function(a){return m[a]&&m[a].get_contents()};k.set_hole=function(a,c,d){m[a].set_contents(c);if(d){c&&c.save_dimensions();d=this.get_frontside_element();a=$(d).children(".toontalk-hole-number-"+a);a.empty();if(!c)return;var e=this.get_hole_dimensions();d=c.get_element(!0);0<a.length&&a.get(0).appendChild(d);h(c,d,e.width,e.height);$(d).find("iframe").attr("width",e.width).attr("height",e.height-20);c.rerender()}this.rerender();b.debugging&&(this._debug_string=
this.to_debug_string())};k.get_holes=function(){return m};k.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=void 0}.bind(this)};k.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};k.set_contents=
function(a){b.UTILITIES.for_each_batch(a,function(a,b){m[b].set_contents(a)})};k.get_size=function(){return e};k.set_size=function(a,c,d){var f;if(e===a||0>a||isNaN(a)||a>Number.MAX_SAFE_INTEGER)return!1;var g=this.visible();m.length=a;if(a>e)for(f=e;f<a;f++)m[f]=b.box_hole.create(f),m[f].set_parent_of_frontside(k),m[f].set_visible(g);e=a;c&&(this.constrained_by_container()?(c=this.get_parent_of_frontside(),c.is_hole()&&(c=c.get_parent_of_frontside()),c.rerender()):this.rerender());(c=this.get_listeners("contents_or_properties_changed"))&&
c.forEach(function(b){b({type:"contents_or_properties_changed",new_size:a})});d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_size",argument_1:a,oString:"by changing the number of holes to "+a+" of the box",button_selector:".toontalk-box-size-input"});b.debugging&&(this._debug_string=this.to_debug_string());return!0};k.get_hole_dimensions=function(){var c=this.get_frontside_element(),d=$(c).width()||b.box.get_default_width();c=$(c).height()||b.box.get_default_height();
return a?{width:d/e,height:c}:{width:d,height:c/e}};k.receive_size_from_dropped=function(a,c){if(a.is_number())return c=b.number.create(this.get_size()),c.number_dropped_on_me_semantics(a),a=Math.max(0,Math.round(c.to_float())),this.set_size(a),a.toString()};k.copy=function(b){b||(b={});var c=m.map(function(a){if(a=a.get_contents())return a.copy(b)});c=f.create(e,a,c,this.get_description(),this.get_name());return this.add_to_copy(c,b)};k.generate_name=function(){for(var a="",b=this.get_size();0<b;)a+=
";",b--;return a};k.add_standard_widget_functionality(k);k.has_name(k);k.set_name(g);for(g=0;g<e;g++)m[g]=b.box_hole.create(g),m[g].set_parent_of_frontside(k);k.set_description(d);if(b.listen){var l,w,r;k.add_speech_listeners({commands:"left to right | horizontal | top to bottom | vertical",numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var c=b.UTILITIES.get_dragee_copy()||k;switch(a){case "left to right":case "horizontal":c.set_horizontal(!0,!0,!0);break;case "top to bottom":case "vertical":c.set_horizontal(!1,
!0,!0);break;default:l=parseInt(a),isNaN(l)?console.log("did not understand '"+a+"'"):c.set_size(l,!0,!0)}c.update_display(!0);a=c.get_size();w="You are now holding a "+(c.get_horizontal()?"horizontal":"vertical")+" box with "+(1<a?a+" holes":0===a?"no holes":"one hole")+".";w!==r&&(k.display_message(w,{display_on_backside_if_possible:!0,duration:4E3}),r=w)}})}c&&k.set_contents(c);b.debugging&&(k._debug_id=b.UTILITIES.generate_unique_id(),k._debug_string=k.to_debug_string());return k};f.create_backside=
function(){return b.box_backside.create(this)};f.equals=function(b){return b.equals_box&&this.get_type_name()===b.get_type_name()&&b.equals_box(this)};f.equals_box=function(b){var a=this.get_size(),c;if(a!==b.get_size())return!1;for(c=0;c<a;c++){var d=this.get_hole_contents(c);var e=b.get_hole_contents(c);if(!d&&e||d&&!e||d&&e&&(!d.equals||!d.equals(e)))return!1}return!0};f.compare_with=function(b){if(b.compare_with_box)return-1*b.compare_with_box(this)};f.compare_with_box=function(b){var a=this.get_size(),
c=b.get_size();if(a>c)return 1;if(a<c)return-1;for(c=0;c<a;c++){var d=this.get_hole_contents(c);var e=b.get_hole_contents(c);if(d&&!e)return 1;if(!d&&e)return-1;if(d&&e)if(d.compare_with){if(d=d.compare_with(e),1===d||-1===d)return d}else return}return 0};f.match=function(b){if(this.get_erased&&this.get_erased()){if(b.get_widget().match_with_any_box)return b.get_widget().match_with_any_box();this.last_match=b;return this}return b.match_with_this_box?b.match_with_this_box(this):(this.last_match=b,
this)};f.match_with_any_box=function(){return"matched"};f.match_with_this_box=function(e){var a=this.get_size(),c=[],d,f,g;if(a!==e.get_size())return e.last_match=this,e;for(d=0;d<a;d++)if(g=e.get_hole_contents(d))if(f=this.get_hole_contents(d)){f=b.UTILITIES.match(g,f);if(f.is_widget)return f;"matched"!==f&&(c=0===c.length?f:c.concat(f))}else if(f=this.get_contents_temporarily_removed(d))c.push(f);else return e.last_match=this,e;return 0<c.length?c:"matched"};f.toString=function(b){var a="",c=this.get_size(),
d,e=this.get_type_name()+" that looks like ";for(d=0;d<c;d++){var f=this.get_hole(d);a+=f.get_full_description(b);d<c-1&&(a+=" | ")}return e+"["+a.replace(e,"")+"]"};f.get_type_name=function(b){return b?"boxes":"box"};f.get_default_description=function(){return"a box for holding things."};f.get_help_URL=function(){return"docs/manual/boxes.html"};f.get_json=function(e,a,c,d){var f=[],g=function(c,d,k){var h;if(c>=this.get_size())a({type:"box",size:this.get_size(),contents:f,horizontal:this.get_horizontal(),
name:this.get_name()},d,k+1);else if(h=this.get_hole_contents(c))if(h.is_primary_backside&&h.is_primary_backside()){var m=function(a,b,d){f.push({widget:a,is_backside:!0});g(c+1,b,d+1)}.bind(this);b.UTILITIES.get_json(h.get_widget(),e,m,d,k+1)}else h.is_widget?(m=function(a,b,d){f.push({widget:a});g(c+1,b,d+1)}.bind(this),b.UTILITIES.get_json(h,e,m,d,k+1)):(m=function(a,b,d){f.push(a);g(c+1,b,d+1)}.bind(this),h.get_json(e,m,d,k+1));else f.push(null),g(c+1,d,k+1)}.bind(this);g(0,c,d+1)};f.walk_children=
function(b){var a=this.get_size(),c,d;for(c=0;c<a;c++)if(d=this.get_hole_contents(c)){if(!b(d))break}else if(!b(this.get_hole(c)))break};b.creators_from_json.box=function(e,a){if(e)return f.create(e.size,e.horizontal,b.UTILITIES.create_array_from_json(e.contents,a),e.description,e.name)};f.update_display=function(){var e=this.get_frontside(!0).get_element(),a=this.get_size(),c=b.UTILITIES.get_style_numeric_property(e,"z-index"),d=function(g,k,m){var l=k.get_contents(),r=(l||k).get_element(!0),v=$(g).parents(".toontalk-box-hole"),
t=function(){$(g).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(B/=b.nest.CONTENTS_WIDTH_FACTOR,G/=b.nest.CONTENTS_HEIGHT_FACTOR)};if(g.parentElement){if(f){var u=0;if(0<v.length||$(e).is(".toontalk-conditions-contents")){var B=n-2*z/a;var G=y-2*z}else B=n,G=y;t();var N=B*m;1<m&&(N+=z*(m-1))}else N=0,0<v.length||$(e).is(".toontalk-conditions-contents")?(B=n-2*z,G=y-2*z/a):(B=n,G=y),t(),u=G*m,1<m&&(u+=z*(m-1));setTimeout(function(){b.UTILITIES.set_css(g,{left:N,top:u,width:B,height:G,
"z-index":"number"===typeof c&&c+a-m});l&&l.render()});w[m]&&g.setAttribute("toontalk_name",w[m]);!b.UTILITIES.has_animating_image(r)&&0<m&&($(g).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(g).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),f?$(g).addClass(M+"-left"):$(g).addClass(M+
"-top"));if(g!==r&&l&&l.get_parent()===k){h(l,r,B,G);$(k.element).find("iframe").attr("width",B).attr("height",G-20);try{g.appendChild(r)}catch(D){b.UTILITIES.report_internal_error(D+". Avoided a circularity involving a box hole.")}k.get_contents().rerender()}k.is_element()&&(v={width:B,height:G},r=k.get_contents(),r.is_plain_text_element()?$(r.get_frontside_element()).css({"font-size":b.UTILITIES.font_size(r.get_text(),B,{height:G}),width:"",height:""}):$(r.get_frontside_element()).css(v),r=r.dereference(),
r.set_size_attributes(B,G,!0),$(g).css(v))}else setTimeout(function(){d(g,k,m)})},f=this.get_horizontal();$(e).is(".toontalk-box");var g=this.constrained_by_container(),m=function(){var c=$(e).children(".toontalk-box-hole");$(e).is(".toontalk-conditions-contents")?b.UTILITIES.set_css(e,{width:v-2*z,height:u-2*z}):this.directly_inside_conditions_container()||$(e).parent().is(".toontalk-scale-half")||(10>v||10>u||!$(e).parent(".toontalk-box-hole").is("*")?b.UTILITIES.set_css(e,{width:v,height:u}):b.UTILITIES.set_css(e,
{width:"",height:""}));10>v||10>u||(c.length===a?c.each(function(a,b){var c=this.get_hole(a);c&&d(b,c,a)}.bind(this)):(c.remove(),this.get_holes().forEach(function(a,b){r=a.get_element();$(r).addClass("toontalk-hole-number-"+b);a.get_contents()&&a.get_contents().rerender();d(r,a,b);e.appendChild(r)})));g||$(e).children(".ui-resizable-handle").css({right:-z,bottom:-z})}.bind(this),l=function(){var c=function(a){if(a.parentElement)return $(a.parentElement).is(".toontalk-box-hole")?a.parentElement:c(a.parentElement)},
d=c(e)||e;d=$(e).parent().is(".toontalk-scale-half")?e:d;g?(v=$(d).width(),u=$(d).height()):v=this.directly_inside_conditions_container()&&b.UTILITIES.get_toontalk_css_numeric_attribute("width",".toontalk-conditions-container")||!$(d).is(".toontalk-carried-by-bird")&&b.UTILITIES.get_style_numeric_property(d,"width")||this.saved_width||b.box.get_default_width();void 0===u&&(u=this.directly_inside_conditions_container()&&b.UTILITIES.get_toontalk_css_numeric_attribute("height",".toontalk-conditions-container")||
!$(d).is(".toontalk-carried-by-bird")&&b.UTILITIES.get_style_numeric_property(d,"height")||this.saved_height||b.box.get_default_height());f?(n=0===a?0:v/a,y=u):(n=v,y=u/a)}.bind(this),w=this.get_name().split(";"),r,v,n,u,y;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(e).addClass("toontalk-box");$(e).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");
b.UTILITIES.give_tooltip(e,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string());if(this.get_erased())$(e).addClass("toontalk-box-erased"),$(e).children(".toontalk-side").remove();else if($(e).removeClass("toontalk-box-erased"),l(),10>v||10>u)m();else{var z=this.get_border_size(n,y);var M=4===z?"toontalk-box-eighth-size-border":8===z?"toontalk-box-quarter-size-border":16===z?"toontalk-box-half-size-border":"toontalk-box-full-size-border";0===a?M+=" toontalk-zero-hole-box":f?n-=
(a-1)*z/a:y-=(a-1)*z/a;$(e).addClass(M);b.UTILITIES.set_timeout(m)}};f.get_default_width=function(){return 164};f.get_default_height=function(){return 68};f.get_border_size=function(b,a){if(0===b)return b=$(this.get_frontside_element()).width(),16>=b?8:32>=b?16:32;if(!b&&!a){var c=this.get_size();b=$(this.get_frontside_element()).width();a=$(this.get_frontside_element()).height();this.get_horizontal()?b=0===c?0:b/c:a=0===c?0:a/this.get_size()}return 32>=b||32>=a?4:64>=b||64>=a?8:128>=b||128>=a?16:
32};f.is_resizable=function(){return!0};f.get_name_input_label=function(){return"The labels of my holes are"};f.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};f.drop_on=function(b,a){if(b.box_dropped_on_me){var c=b.box_dropped_on_me&&b.box_dropped_on_me(this,a);a.event&&b.rerender();c&&this.remove();return c}if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,a);console.log("No handler for drop of "+
this+" on "+b)};f.box_dropped_on_me=function(b,a){console.log("box on box not yet implemented");return!1};f.widget_side_dropped_on_me=function(e,a){var c=this.which_hole(a.event),d=this.get_size();if(void 0===c&&a.robot)if(0<d)1<d&&b.UTILITIES.display_message("Robot "+a.robot.get_name()+" wasn't trained to know which hole of "+this+" to drop "+e+" on. Random hole chosen."),c=Math.floor(Math.random()*d);else{b.UTILITIES.display_message("Robot "+a.robot.get_name()+" can't drop "+e+" on "+this+" because it has no holes.");
return}if(0<=c)return d=this.get_hole(c),(c=d.get_contents())?e.drop_on(c,a):d.widget_side_dropped_on_me(e,a);0===d?b.UTILITIES.display_message("Can't drop "+e+" on "+this+" because it has no holes."):b.UTILITIES.report_internal_error(e+" dropped on "+this+" but no event was provided.")};f.get_index_of=function(b){return b.get_parent_of_frontside()&&b.get_parent_of_frontside().get_index&&b.get_parent_of_frontside().get_index()};f.name_font_size=function(b,a){if(0===this.get_size())return 0;this.get_horizontal()?
(a=(a||this.get_height())/6,b=(b||this.get_width())/(8*this.get_size())):(a=(a||this.get_height())/(6*this.get_size()),b=(b||this.get_width())/8);return Math.min(b,a)};f.removed_from_container=function(b,a){a=!!a;var c=this.get_index_of(b);0<=c&&(this.set_hole(c,void 0,a),a&&(this.rerender(),b.restore_dimensions()))};f.get_path_to=function(e,a){var c=this.get_size(),d;if("empty hole"===e.get_type_name()){a=e.get_parent_of_frontside();var f=b.box.path.create(e.get_index());if(a===this)return f;e=this.get_path_to(a);
if(!e)return;e.next=f;return e}for(d=0;d<c;d++)if(f=this.get_hole_contents(d)||this.get_contents_temporarily_removed(d)){if(e===f||f.top_contents_is&&f.top_contents_is(e))return b.box.path.create(d);if(f.get_path_to&&(f=f.get_path_to(e,a)))return e=b.box.path.create(d),e.next=f,e}};f.element_to_highlight=function(b){b=this.which_hole(b,!0);var a;if(0>b||0===this.get_size())return this.get_frontside_element();b=this.get_hole(b);return(a=b.get_contents())?a.get_frontside_element():b.get_frontside_element()};
f.which_hole=function(b){var a=this.get_horizontal(),c=this.get_frontside_element(),d=this.get_size();if(0!==d){var e=$(c).offset();c=a?$(c).width()/d:$(c).height()/d;var f=a?e.left:e.top;if(b)for(e=0;e<d;e++)if(f+=c,(a?b.pageX<=f:b.pageY<=f)||e+1===d)return e}};f.dereference_path=function(e,a,c){if(e){!e.get_index&&e.next&&(e=e.next);var d=e.get_index&&e.get_index();if(c||"undefined"!==typeof d){if(!b.debugging||"number"===typeof d){if(c=this.get_hole_contents(d)){if(c.dereference_contents&&!e.not_to_be_dereferenced)return c.dereference_contents(e.next||
e,a);if(e.next){if(c.dereference_path)return c.dereference_path(e.next,a);b.UTILITIES.report_internal_error("Expected to refer to a part of "+c+" but it lacks a method to obtain "+b.path.toString(e.next))}if(e.removing_widget){if("empty hole"===c.get_type_name()){b.UTILITIES.display_message("Robot is trying to remove something from an empty hole. ",{only_if_new:!0});return}c.get_infinite_stack()||a.remove_from_container(c,this)}return c}if(e.removing_widget){b.UTILITIES.display_message("Robot is trying to remove something from an empty hole. ",
{only_if_new:!0});return}return this.get_hole(d)}b.UTILITIES.display_message(this+" unable to dereference the path: "+b.path.toString(e),{only_if_new:!0})}}else return this};f.path={create:function(e){return{get_index:function(){return e},toString:function(){return"scale"===this.true_type?0===e?"the left pan ":"the right pan ":"the "+b.UTILITIES.ordinal(e)+" hole "},get_json:function(a,b,d,f){var c=function(a,c,d){b({type:"box_path",index:e,true_type:this.true_type,next:a},c,d+1)}.bind(this);this.next?
this.next.get_json(a,c,d,f+1):c(void 0,d,f+1)}}}};f.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};b.creators_from_json.box_path=function(e,a){var c=f.path.create(e.index);e.next&&(c.next=b.UTILITIES.create_from_json(e.next,a));e.true_type&&(c.true_type=e.true_type);return c};return f}(window.TOONTALK);window.TOONTALK.box_backside=function(b){return{create:function(f){var e=b.backside.create(f),a=b.UTILITIES.create_text_input(f.get_size().toString(),"toontalk-box-size-input",
"Number of holes","Type here to edit the number of holes.",void 0,"number",function(a){if(a=b.UTILITIES.input_area_drop_handler(a,f.receive_size_from_dropped.bind(f),f))f.rerender(),f.robot_in_training()&&f.robot_in_training().dropped_on_text_area(a,f,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),c=b.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-horiztonal-radio-button","Left to right","Show box horizontally.",
!0),d=b.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-vertical-radio-button","Top to bottom","Show box vertically.",!0),g=function(){var b=parseInt(a.button.value.trim(),10);f.set_size(b,!0,!0)},h=function(){var a=b.UTILITIES.selected_radio_button(c,d);a&&f.set_horizontal("horizontal"===a.button.value,!0,!0)},m=e.get_element(),l=b.backside.create_advanced_settings_button(e,f),w=e.update_display.bind(e),r=b.UTILITIES.create_div(c,d);a.button.addEventListener("change",g);a.button.addEventListener("mouseout",
g);c.button.addEventListener("change",h);d.button.addEventListener("change",h);e.update_display=function(){a.button.value=f.get_size().toString();f.get_horizontal()?b.UTILITIES.check_radio_button(c):b.UTILITIES.check_radio_button(d);w()};b.UTILITIES.when_attached(m,function(){e.is_primary_backside()||f.add_listener("contents_or_properties_changed",function(){e.rerender()})});m.appendChild(a.container);m.appendChild(r);$(r).controlgroup().removeClass("ui-controlgroup");m.appendChild(l);e.rerender();
return e}}}(window.TOONTALK);window.TOONTALK.box_hole=function(b){return{create:function(f){var e=Object.create(this),a,c;e.is_hole=function(){return!0};e.is_empty_hole=function(){return!a};e.constrained_by_container=function(){return!1};e.get_element=function(){c||(c=document.createElement("div"),c.className="toontalk-box-hole toontalk-frontside toontalk-side",c.toontalk_widget_side=e);return c};e.get_frontside=function(b){return a?a.get_frontside(b):this.get_element()};e.get_backside_widgets=function(){return a?
a.get_backside_widgets():[]};e.get_frontside_element=function(a){return this.get_element()};e.get_frontside=function(){return this};e.get_width=function(){return $(this.get_element()).width()};e.get_height=function(){return $(this.get_element()).height()};e.widget_side_dropped_on_me=function(a,c){var d=this.get_parent_of_frontside(),e=this.get_contents(),f;if(e)return e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(a,c);a.dropped_on_other&&a.dropped_on_other(this,c);if(c.event){b.sounds&&
b.sounds.fall_inside.play();e=this.get_element();var g=a.is_plain_text_element();var k=a.get_element();$(k).css({"z-index":b.UTILITIES.next_z_index()});var h=$(k.parentElement).offset();g||(k.style.left=c.event.pageX-h.left+"px",k.style.top=c.event.pageY-h.top+"px",$(k).addClass("toontalk-animating-element"));if(f=b.UTILITIES.is_attached(e)){var n=$(e).offset();k.style.width=e.style.width;k.style.height=e.style.height;k.style.left=n.left-h.left+"px";k.style.top=n.top-h.top+"px"}else k.style.width=
0,k.style.height=0;n=function(){$(k).removeClass("toontalk-animating-element");this.set_contents(a);f?(d.render(),a.render()):k.remove();c.event&&d.backup_all()}.bind(this);setTimeout(n,g||b.UTILITIES.has_animating_image(k)?0:1200);d.robot_in_training()&&d.robot_in_training().dropped_on(a,this);a.save_dimensions&&a.set_size_attributes&&a.set_size_attributes($(e).width(),$(e).height());a.is_backside()||d.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:k,
where:"front",index:this.get_index()}))}else d.rerender(),this.set_contents(a,c);return!0};e.get_json=function(){return null};e.add_to_json=function(a){return a};e.copy=function(a){return b.box_hole.create(f)};e.match=function(){return"matched"};e.get_type_name=function(b){return a?a.get_type_name(b):b?"empty holes":"empty hole"};e.name_font_size=function(){return this.get_box().name_font_size()};e.is_of_type=function(b){return a?a.is_of_type(b):"empty hole"===b};e.get_box=function(){return this.get_parent_of_frontside()};
e.update_display=function(){if(a){var b=this.get_frontside_element();h(a,a.get_element(!0),$(b).width(),$(b).height())}};e.dereference=function(){return a?a.dereference():this};e.can_run=function(b){return a&&a.can_run(b)};e.get_index=function(){return f};e.get_contents=function(){return a};e.set_contents=function(c,e){var d=this.get_listeners("contents_or_properties_changed");d&&(a!==c&&d.forEach(function(b){b({type:"contents_or_properties_changed",old_value:a,new_value:c})}),a&&d.forEach(function(b){a.remove_listener("contents_or_properties_changed",
b,!0)}),c&&d.forEach(function(a){c.add_listener("contents_or_properties_changed",a)}));a&&a.set_parent(void 0);(a=c)?(a.set_parent(this),b.debugging&&(this._debug_string="A hole containing "+a.to_debug_string()),e&&e.robot&&!e.robot.visible()||a.set_visible(this.visible())):b.debugging&&(this._debug_string=this.to_debug_string())};e.get_contents_dimensions=function(){return{width:$(this.get_frontside_element()).width(),height:$(this.get_frontside_element()).height()}};e.visible=function(){return this.get_parent_of_frontside().visible()};
e.set_visible=function(b,c){a&&a.set_visible(b,c?c+1:1)};e.remove=function(){a&&a.remove()};e.render=function(){a&&b.DISPLAY_UPDATES.pending_update(this)};e.rerender=function(){if(a&&this.visible())return this.render()};e.set_running=function(b){a&&a.set_running(b)};e.set_parent=function(b){a&&a.set_parent(b)};e.maintain_proportional_dimensions=function(){if(a)return a.maintain_proportional_dimensions()};e.removed_from_container=function(c,e,f,g){a?(e&&a.restore_dimensions(),this.set_contents(void 0),
e&&this.get_parent_of_frontside().render()):g&&b.UTILITIES.report_internal_error("Holes can't be removed from containers.")};e.temporarily_remove_contents=function(b,c){if(a)return this.get_parent_of_frontside().temporarily_remove_contents(b,c)};e.toString=function(){return a?a.toString():"_"};e.get_description=function(){return a?a.get_description():"_"};e.get_full_description=function(b){return a?a.get_full_description(b):"_"};e.is_backside=function(){return!1};e.get_widget=function(){return this.get_parent_of_frontside()};
e.is_number=function(){return a?a.is_number():!1};e.is_box=function(){return a?a.is_box():!1};e.is_scale=function(){return a?a.is_scale():!1};e.is_bird=function(){return a?a.is_bird():!1};e.is_nest=function(){return a?a.is_nest():!1};e.is_robot=function(){return a?a.is_robot():!1};e.is_element=function(){return a?a.dereference().is_element():!1};e.get_original_width=function(){if(a&&a.get_original_width)return a.get_original_width()};e.get_original_height=function(){if(a&&a.get_original_height)return a.get_original_height()};
e.is_sensor=function(){return a?a.is_sensor():!1};e.is_top_level=function(){return!1};e.is_plain_text_element=function(){return!1};e.get_active=function(){return a?a.get_active():!1};e.set_active=function(b,c){a&&a.set_active(b,c)};b.widget.has_parent(e);b.widget.has_listeners(e);if(b.debugging||b.logging)e.to_debug_string=function(c){var d=("the "+b.UTILITIES.ordinal(f)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box")).substring(0,
c);return a?d+" which contains "+a.to_debug_string(c):d+" which is empty"},e._debug_string=e.to_debug_string();return e}}}(window.TOONTALK);window.TOONTALK.box.function=function(){var f=b.create_function_table();f.add_function_object("box hole",function(g,e){return f.typed_bird_function(g,function(a,c,d){var e=Math.round(a.to_float());if(1>e)f.report_error("The 'box hole' function bird cannot find the "+b.UTILITIES.ordinal(e-1)+" hole. She only accepts positive numbers.",d);else if(e>c.get_size())f.report_error("The 'box hole' function bird cannot cannot find the "+
b.UTILITIES.ordinal(a-1)+" hole. The box only has "+c.get_size()+" holes.",d);else{if(c=c.get_hole_contents(e-1))return d.message_return_bird?c.copy():c;f.report_error("The 'box hole' function bird cannot cannot find anything in the "+b.UTILITIES.ordinal(a-1)+" hole. It is empty.",d)}},["number","box"],"box hole",e,2,2)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. Use 1 for the first hole.","hole",["number","box"]);f.add_function_object("count holes",
function(g,e){return f.typed_bird_function(g,function(a){return b.number.create(a.get_size())},["box"],"count holes",e,1,1)},"The bird will return with the number of holes the box has.","count holes",["box"]);f.add_function_object("fill hole",function(g,e){return f.typed_bird_function(g,function(a,c,d,e){var g=Math.round(a.to_float());if(1>g)f.report_error("The fill hole function bird cannot fill the "+b.UTILITIES.ordinal(a)+" hole. She only accepts positive numbers.",e);else return e.message_return_bird&&
(c=c.copy(),d=d.copy()),g>c.get_size()&&c.set_size(g),c.set_hole(g-1,d),c},["number","box",void 0],"fill hole",e,3,3)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);f.add_function_object("split box",function(g,e){return f.typed_bird_function(g,function(a,c,d){var e=Math.round(a.to_float()),g=c.get_size();if(0>e)f.report_error("The box split function bird cannot split the box after "+
a+" holes. She only accepts zero or positive numbers.",d);else if(e>g)f.report_error("The box split function bird cannot split the box after "+a+" holes. The box only has "+g+" holes.",d);else{c.get_holes();a=g-e;g=b.box.create(a);var h;for(h=0;h<a;h++)g.set_hole(h,c.get_hole_contents(h+e));d.message_return_bird&&(c=c.copy());c.set_size(e);return b.box.create(2,!1,[c,g])}},["number","box"],"split box",e,2,2)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.",
"split",["number","box"]);f.add_function_object("merge boxes",function(g,e){return f.typed_bird_function(g,function(){var a=0,c,d;if(1===arguments.length)return b.box.create(0);var e=arguments[arguments.length-1];var f=arguments[0];e.message_return_bird&&(f=f.copy());for(c=0;c<arguments.length-1;c++)a+=arguments[c].get_size();var g=f.get_size();f.set_size(a);for(c=1;c<arguments.length-1;c++){var h=arguments[c].get_size();for(a=0;a<h;a++){if(d=arguments[c].get_hole_contents(a))e.message_return_bird&&
(d=d.copy()),f.set_hole(g,d);g++}}return f},["box"],"merge boxes",e)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);f.add_function_object("get window property",function(g,e){return f.typed_bird_function(g,function(a,c){var d=window,e=a.get_size(),g=function(){var d="window",g;for(g=0;g<e;g++){l=a.get_hole_contents(g);if(!l||!l.get_text){f.report_error("The 'get window property' bird could not get the text of the "+b.UTILITIES.ordinal(g)+" hole.",
c);return}d+="."+l.get_text().trim()}return d},h;for(h=0;h<e;h++){var l=a.get_hole_contents(h);if(!l||!l.get_text){f.report_error("The 'get window property' bird could not get the text of the "+b.UTILITIES.ordinal(h)+" hole.",c);return}try{d=d[l.get_text().trim()]}catch(w){f.report_error("Error trying to find the value of "+g()+". "+w,c);return}}if(void 0===d)f.report_error("Error no value for "+g()+exception,c);else return"number"===typeof d?b.number.create(d):b.element.create(d.toString())},["box"],
"window property",e,1,1)},"The bird will return with the value of the property accessed by each of the property names in the box.","win prop",["box"]);f.add_function_object("set window property",function(g,e){return f.typed_bird_function(g,function(a,c,d){var e=window,g=a.get_size(),h=function(c){var e="window",g;for(g=0;g<c;g++){r=a.get_hole_contents(g);if(!r||!r.get_text){f.report_error("The 'set window property' bird could not get the text of the "+b.UTILITIES.ordinal(g)+" hole.",d);return}e+=
"."+r.get_text().trim()}return e},l,w;for(l=0;l<g-1;l++){var r=a.get_hole_contents(l);if(!r||!r.get_text){f.report_error("The 'set window property' bird could not get the text of the "+b.UTILITIES.ordinal(l)+" hole.",d);return}try{e=e[r.get_text().trim()]}catch(n){f.report_error("Error trying to find the property of "+h(g-1)+". "+n,d);return}}e||(w="Property missing of "+h(g-1));if(!w)try{var v=c.to_float?c.to_float():c.get_text?c.get_text():c.toString();r=a.get_hole_contents(g-1);if(!r||!r.get_text){f.report_error("The 'set window property' bird could not get the text of the "+
b.UTILITIES.ordinal(l)+" hole.",d);return}e[r.get_text().trim()]=v}catch(n){w="Unable to set the value of "+h(g)+" to value of "+c}if(w)f.report_error(w,d);else return c},["box",void 0],"set window property",e,2,2)},"The bird will set the value of the property accessed by each of the property names in the box in the second hole to the value of the widget in the third hole.","set win prop",["box"]);return f.get_function_table()}()})(window.TOONTALK);(function(){var b,h,f,g;window.TOONTALK.bird=function(e){var a=Object.create(e.widget),c=function(a,b,c){var d=a.get_function_type();a=a.get_function_object();var f=Object.keys(TOONTALK[d]["function"]),g=f.map(function(a){return TOONTALK[d]["function"][a].title});f=e.UTILITIES.create_select_menu("functions",f,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",g);b=b.get_element();var k;a&&$(f.menu).val(a.name).selectmenu("refresh");
$(f.menu).on("selectmenuselect",function(a){c.set_function_name(a.target.value);c.get_description()||(k=$(c.get_backside_element()).find(".toontalk-description-input"),0<k.length&&k.get(0).setAttribute("placeholder",c.get_default_description()))});$(f.menu).selectmenu("menuWidget").addClass("toontalk-select-menu");b.insertBefore(f.container,b.firstChild)};a.create=function(d,f,h){var k=[],l=[];h||(h=Object.create(a));h.set_nest=function(a,b){if(d===b||void 0===d)d=a};h.is_bird=function(){return!0};
h.widget_side_dropped_on_me=function(a,b){if(this.get_infinite_stack()){var c=this.add_copy_to_container();return c.widget_side_dropped_on_me(a,b)}if(d){if(d.has_ancestor(a))return a.display_message("Bird can't take its nest to its nest!"),!1;if(!(d.visible()||this.visible()||d.any_nest_copies_visible())||b.robot&&b.robot.visible()&&!b.robot.animate_consequences_of_actions()){var f=function(){try{d.add_to_contents(a,b)}catch(y){if(y.wait_for_nest_to_receive_something)y.wait_for_nest_to_receive_something.run_when_non_empty(f,
this);else throw console.error(y.stack),y;}};f();b.robot&&b.robot===a.robot_waiting_before_next_step&&(a.robot_waiting_before_next_step=void 0,b.robot.run_next_step())}else{b.by_function_bird||a.save_dimensions();var g=this.get_frontside_element();setTimeout(function(){$(g).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside()&&this.get_parent_of_frontside().rerender()}.bind(this));a.set_visible(d.visible());
b.robot&&!b.do_not_run_next_step&&(a.robot_waiting_before_next_step=b.robot,b.robot.run_next_step&&(c=function(c){c&&c();a.robot_waiting_before_next_step=void 0;b.robot.run_next_step()}));b.after_delivery_continuation=e.UTILITIES.join_continuations(b.after_delivery_continuation,c);d.animate_bird_delivery(a,this,b)}}else b.robot&&!b.robot.visible()?a.remove():this.animate_delivery_to(a);b.event&&!b.by_function_bird&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);return!0};h.animate_delivery_to=
function(a,b,c){c||(c={});if(a){var f=c.nest_recieving_message,g=c.after_delivery_continuation,h=this.get_parent_of_frontside(),m=this.get_frontside_element(!0),r=$(m).position();$(m).width();var v=this.closest_visible_ancestor_or_frontside(),t=$(v.get_frontside_element()).offset(),w=function(){e.sounds&&e.sounds.bird_fly.pause();f||a.remove();if(c.temporary_bird)this.remove();else{var b=function(){$(m).removeClass("toontalk-bird-morph-to-static");$(m).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
h&&h.get_widget().rerender()}.bind(this);m.style.position=aa;e.UTILITIES.set_css(m,r);R&&R.appendChild(m);h&&(h.get_widget().is_top_level()?this.rerender():h.get_widget().rerender());if(O&&(X.remove_backside_widget(this,!0),O(),k)){var d=k;k=[];l=[];d.forEach(function(a){a()})}e.UTILITIES.add_animation_class(m,"toontalk-bird-morph-to-static");e.UTILITIES.add_one_shot_event_handler(m,"animationend",1E3,b)}g&&g();c.event&&this.backup_all()}.bind(this),J=function(){var b=function(a){e.UTILITIES.set_timeout(function(){this.fly_to(t,
function(){a&&a();w&&w()},c)}.bind(this))}.bind(this);if(f)try{c.delivery_bird=this,f.add_to_contents(a,{ignore_copies:!0,make_message_nests_delivery_targets:f.is_function_nest()}),b()}catch(ia){if(ia.wait_for_nest_to_receive_something){ia.wait_for_nest_to_receive_something.run_when_non_empty(J,this);var d=w;w=function(){d&&d();ia.wait_for_nest_to_receive_something.remove()};g&&(g(),g=void 0);return}e.sounds&&e.sounds.bird_fly.pause();console.error(ia.stack);throw ia;}else this.is_function_bird()||
g&&g();Q($(m).offset())}.bind(this),K=function(a,b){b||(b=e.UTILITIES.widget_side_of_element(a));this.element_to_display_when_flying=a;b&&(this.update_display(),setTimeout(function(){b.update_display()}));$(a).addClass("toontalk-carried-by-bird");$(a).removeClass("toontalk-temporarily-set-down");e.UTILITIES.set_timeout(function(){var c={left:"",top:"",position:""};b&&!b.use_scaling_transform&&(c.width="",c.height="");1<a.toontalk_x_scale&&(c["font-size"]="inherit");e.UTILITIES.set_css(a,c);this.update_display()}.bind(this))}.bind(this),
Q=function(b){if(this.element_to_display_when_flying){$(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird");if(b){var c={"z-index":e.UTILITIES.next_z_index()};0<this.element_to_display_when_flying.width_before_carry&&(c.width=this.element_to_display_when_flying.width_before_carry);0<this.element_to_display_when_flying.height_before_carry&&(c.height=this.element_to_display_when_flying.height_before_carry);1<this.element_to_display_when_flying.toontalk_x_scale&&(c["font-size"]=
"inherit");e.UTILITIES.set_css(this.element_to_display_when_flying,c);this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying);e.UTILITIES.set_absolute_position(this.element_to_display_when_flying,b);(b=a.get_parent_of_frontside())&&!b.is_backside()&&b.rerender()}else $(this.element_to_display_when_flying).remove();this.element_to_display_when_flying=void 0;this.update_display()}}.bind(this),C,I,O,T;f||(f=d);if(f||this.visible()){c.delay=e.animation_settings.PAUSE_BETWEEN_BIRD_STEPS;
$(m).removeClass("toontalk-bird-gimme");if(a){var F=a.get_element(!0);K(F,a)}b&&!b.is_function_nest()&&(C=b.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());if(!b||this.visible()||b.visible()&&(b.is_function_nest()||e.UTILITIES.visible_element(C))){e.sounds&&e.sounds.bird_fly.play();$(m).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));if(b&&!b.is_function_nest()){var D=$(C).offset();f.get_frontside_element&&(I=$(f.get_frontside_element()).closest(".toontalk-backside-of-top-level"))}I&&
I.is("*")||(I=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level"));(b=I.offset())||(b={left:0,top:0});c.starting_left?t={left:c.starting_left+b.left,top:c.starting_top+b.top}:0===t.left&&0===t.top&&(t={left:a?-F.clientWidth:-1E3,top:b.top+I.height()/2});D||(D={left:F?-2*F.clientWidth:-1E3,top:b.top+I.height()/2});var R=m.parentElement;v=$(m).width();var V=$(m).height();var aa=m.style.position;m.style.position="absolute";var X=this.top_level_widget();h&&h.temporarily_remove_contents&&
(O=h.temporarily_remove_contents(this,!0))&&this.get_widget().add_to_top_level_backside(this);0<I.length&&I.get(0).appendChild(m);e.UTILITIES.set_css(m,{left:c.starting_left||t.left-b.left,top:c.starting_top||t.top-b.top,width:v,height:V});e.logging&&0<=e.logging.indexOf("bird")&&console.log(this.to_debug_string(50)+" from "+(c.starting_left||t.left-b.left)+", "+(c.starting_top||t.top-b.top)+" to "+D.left+", "+D.top);f&&(T=f.get_contents_element&&f.get_contents_element());if(T&&f.visible()&&(!c.robot||
c.robot.animate_consequences_of_actions())){v=$(C).width();V=$(C).height();var ba=$(C).offset();b.max_left=b.left+I.width();b.max_top=b.top+I.height();D={left:D.left+v,top:D.top+V};var p={left:Math.min(ba.left+v,b.max_left-v),top:Math.min(ba.top+V,b.max_top-V)},q={left:Math.max(ba.left-v,b.left),top:Math.max(ba.top-V,b.top)};D=function(){var b=function(){f.visible()?(f.set_locked(!0),this.fly_to(ba,H,c)):(c.delivery_bird=this,c.ignore_copies=!0,f.add_to_contents(a,c),g&&(g(),g=void 0))}.bind(this);
$(F).addClass("toontalk-temporarily-set-down");Q(p);f.get_locked()?f.run_when_unlocked(b):b()}.bind(this);var H=function(){K(T);this.fly_to(q,S,c)}.bind(this),S=function(){$(T).addClass("toontalk-temporarily-set-down");Q(q);this.fly_to(p,P,c)}.bind(this),P=function(){K(F,a);this.fly_to(ba,A,c)}.bind(this),A=function(){var b=f.get_contents_dimensions();a.is_plain_text_element()&&$(F).addClass("toontalk-temporarily-set-down");Q(ba);a.is_plain_text_element()||e.UTILITIES.set_css(a.get_element(),b);this.fly_to(q,
fa,c)}.bind(this),fa=function(){K(T);this.fly_to(ba,da,c)}.bind(this),da=function(){$(F).removeClass("toontalk-temporarily-set-down");f.set_locked(!1);Q();f.update_display();J()}.bind(this);this.fly_to(p,D,c)}else this.fly_to(D,J,c)}else c.delivery_bird=this,c.ignore_copies=!0,f.add_to_contents(a,c),c.temporary_bird&&this.remove()}else a.remove(),this.remove()}else c.after_delivery_continuation&&c.after_delivery_continuation(),e.debugging&&(console.error("animate_delivery_to called with undefined message_side."),
console.trace())};h.get_json=function(a,b,c,f){if(d){var g=function(a,c,d){b({type:"bird",nest:a},c,d+1)};e.UTILITIES.get_json(d,a,g,c,f+1)}else b({type:"bird"},c,f+1)};h.copy=function(a){var c,e;if(a)if(a.just_value)var f=this.create(void 0,this.get_description());else{if((e=d&&d.get_guid())&&a.nests_copied&&a.nests_copied[e]){f=a.nests_copied[e][0];g.call(f);for(c=1;c<a.nests_copied[e].length;c++)b.call(a.nests_copied[e][c],f);f=this.create(f,this.get_description())}else f=this.create(d,this.get_description());
a.birds_copied||(a.birds_copied={});e&&(a.birds_copied[e]||(a.birds_copied[e]=[]),a.birds_copied[e].push(f))}else f=d&&d.is_function_nest()?this.create(d.copy(),this.get_description()):this.create(d,this.get_description());return this.add_to_copy(f,a)};h.run_when_non_empty=function(a,b){0>l.indexOf(b)&&(k.push(a),l.push(b))};h.create_backside=function(){var a=e.bird_backside.create(this);d&&d.is_function_nest()&&c(d,a,this);return a};h.get_help_URL=function(){return d&&d.is_function_nest()?"docs/manual/function-birds.html":
"docs/manual/birds-nests.html"};h.is_function_bird=function(){return d&&d.is_function_nest()};h.get_custom_title_prefix=function(){var a;return d?d.is_function_nest()&&(a=d.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":"This bird no longer knows where her nest is. She'll get rid of anything you give her."};h.toString=function(a){return d?d.is_function_nest&&d.is_function_nest()?d.get_function_object().toString():d.get_name()?"bird named '"+d.get_name()+
"'":"bird":a&&"conditions"===a.role?"any bird":"bird without a nest"};h.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird a box to compute the '"+d.get_function_object().name+"' of "+this.get_function_type(!0)+".":"a bird who takes things to her nest."};h.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var b=a.get_element();b.setAttribute("toontalk_name",this.get_name());e.UTILITIES.give_tooltip(b,this.get_title());$(b).is(".toontalk-bird, .toontalk-side-animating")||
($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),b.addEventListener("dragenter",function(a){0<=b.className.indexOf("toontalk-bird-static")&&($(b).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),e.UTILITIES.add_animation_class(b,"toontalk-bird-gimme"))}.bind(this)),b.addEventListener("dragleave",function(a){$(b).is(".toontalk-bird-gimme")&&($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),
this.get_parent_of_frontside()&&this.get_parent_of_frontside().render())}.bind(this)));if(this.element_to_display_when_flying){this.has_ancestor(e.UTILITIES.widget_side_of_element(this.element_to_display_when_flying))&&this.top_level_widget().get_backside_element().appendChild(b);try{b!==this.element_to_display_when_flying&&b.appendChild(this.element_to_display_when_flying)}catch(v){e.UTILITIES.report_internal_error("Error attaching 'message' to bird. Message className is "+this.element_to_display_when_flying.className+
". Error is "+v)}}else $(b).children(".toontalk-side").remove();e.UTILITIES.set_css(b,{"font-size":this.name_font_size()})};h.set_function_name=function(a){d&&d.is_function_nest()&&d.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};h.get_function_type=function(a){return d.get_function_type(a)};h.get_class_name_with_color=
function(a){return d&&d.get_class_name_with_color?d.get_class_name_with_color(a):a};h.get_name=function(){return d?d.get_name():""};d&&d.set_name&&(h.set_name=function(a,b,c){return d.set_name(a,b,c)});h.has_name_font_size(h);h.get_name_height=function(a){return.3*(a||this.get_height())};h.is_nest_visible=function(){return d&&d.visible()};h.add_standard_widget_functionality(h);h.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});h.set_description(f);e.debugging&&(h._debug_id=e.UTILITIES.generate_unique_id(),
h._debug_string=h.to_debug_string());return h};a.create_function=function(b,c,f){if("undefined"===typeof e[b].function)throw b="Unable to create function bird for type: "+b,e.UTILITIES.report_internal_error(b),b;return a.create(e.nest.create_function(c,b,f||e.UTILITIES.get_first_property(e[b].function)))};a.match=function(a){if(a.get_widget().match_with_any_bird)return a.get_widget().match_with_any_bird(this);this.last_match=a;return this};a.match_with_any_bird=function(){return"matched"};a.fly_to=
function(a,b,c){var d=this.get_frontside_element(),f=$(d).offset(),g="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*(Math.atan2(a.top-f.top,a.left-f.left)/Math.PI+1))%8];$(d).position();var h=function(){$(d).removeClass(g);c.delay&&this.visible()?setTimeout(b,c.robot?c.robot.transform_step_duration(c.delay):c.delay):b()}.bind(this);f=function(){$(d).removeClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"));e.UTILITIES.add_animation_class(d,g);this.animate_to_absolute_position(a,h,c.robot&&c.robot.transform_animation_speed(e.animation_settings.BIRD_ANIMATION_SPEED))}.bind(this);this.visible()?setTimeout(f,1):f()};a.get_type_name=function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};a.maintain_proportional_dimensions=function(){return!0};a.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};
a.drop_on=function(a,b){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b)};e.creators_from_json.bird=function(b,c,f){return b?e.bird.create(e.UTILITIES.create_from_json(b.nest,c,f),b.description):Object.create(a)};return a}(window.TOONTALK);window.TOONTALK.bird_backside=function(b){return{create:function(a){var c=b.backside.create(a);c.add_description_setting();c.add_name_setting();c.get_element().appendChild(b.backside.create_advanced_settings_button(c,a));return c}}}(window.TOONTALK);
window.TOONTALK.nest=function(e){var a=Object.create(e.widget),c,d,k=0,t=0;a.default_maximum_capacity=10;a.maximum_capacity=a.default_maximum_capacity;a.create=function(m,l,w,r,v,n,u){var y=[],z=[],M=[],B;u||(u=Object.create(a));l||(l=[]);v||(k++,v=k);b=function(a){r&&f.call(r,this);r=a;w=a.get_guid();h.call(a,this)};g=function(){r&&f.call(r,this);r=void 0;w=e.UTILITIES.generate_unique_id();this.set_name(this.generate_name())};h=function(a){c||(c=e.UTILITIES.generate_unique_id());this[c](a)};f=function(a){c||
(c=e.UTILITIES.generate_unique_id());this[c](a,!0)};u.is_nest=function(){return!0};u.get_guid=function(){return w};u.matched_by=function(a){return 0<l.length?e.UTILITIES.match(a,l[0]):[[this,a]]};u.run_when_non_empty=function(a,b){0<l.length?a(l[0]):0>M.indexOf(b)&&(y.push(a),M.push(b))};u.dereference=function(){return 0<l.length?l[0]:this};u.match=function(a){if(0<l.length)return l[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};u.add_to_contents=
function(b,c){var d=l.push(b);var f=this.visible();c||(c={});d>a.maximum_capacity&&c.robot&&c.robot_removed_contents_since_empty&&!c.robot.visible()&&!f&&(e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" postponing addition of "+b.to_debug_string(50)+" by "+c.robot.to_debug_string(50)+". Stack is "+l.length+" long. "+z.length+" previously postponed."),c.robot.add_body_finished_listener(function(){c.robot.set_stopped(!0);z.push(function(){c.robot.set_stopped(!1);c.robot.run_actions()})}));
e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+b.to_debug_string()+" nest now contains "+l.length+" widgets.");b.is_backside()?b.set_parent_of_backside(this):b.set_parent_of_frontside(this);B&&!c.ignore_copies&&(c.delivery_bird?B.forEach(function(a){a.has_ancestor(b.get_widget())||a.animate_bird_delivery(e.UTILITIES.copy_side(b),c.delivery_bird,c)}):B.forEach(function(a){a.has_ancestor(b.get_widget())||a.add_to_contents(e.UTILITIES.copy_side(b,!1,!0),c)}));1===
d?(0<y.length&&(d=y,y=[],M=[],d.forEach(function(a){a(b)})),b.set_visible(f),f?this.get_containing_widget().rerender():b.hide()):(b.hide(),b.set_visible(!1));c.event&&this.backup_all();this.rerender()};u.animate_bird_delivery=function(a,b,c){if(void 0!==this.get_parent_of_frontside()||b.visible()){if(b.animate_delivery_to(a,this,c),B){var d=$(b.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position();var f=b.get_parent_of_frontside()&&b.get_parent_of_frontside().get_element();
var g=this.visible();B.forEach(function(h){var k=e.UTILITIES.copy_side(a,!1,g);if(!h.has_ancestor(a.get_widget()))if(d&&(h.visible()||g)){var m=b.copy({just_value:!0});var l=m.get_frontside_element(!0);f&&f.appendChild(l);m.animate_delivery_to(k,h,{starting_left:d.left,starting_top:d.top,nest_recieving_message:h,temporary_bird:!0,robot:c.robot})}else h.add_to_contents(k,c)})}}else a.remove(),c.after_delivery_continuation&&c.after_delivery_continuation()};u.get_contents_element=function(){if(0<l.length)return l[0].get_element()};
u.get_locked=function(){return this.locked_for_animating_deliveries};u.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};u.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};u.removed_from_container=function(b,c,d){b=l.shift();e.logging&&0<=e.logging.indexOf("nest")&&(b?console.log(this.to_debug_string(50)+" removed "+
b.to_debug_string()+" remaining widgets is "+l.length):console.log(this.to_debug_string(50)+" nothing left to remove."));if(b)return b.is_backside()?b.set_parent_of_backside(void 0):b.get_widget().set_parent_of_frontside(void 0),this.visible()&&(b.restore_dimensions&&b.restore_dimensions(),0<l.length&&(l[0].set_visible(!0),$(l[0].get_element()).show()),this.get_containing_widget().is_top_level()?this.render():this.get_containing_widget().render()),l.length<=a.maximum_capacity&&0<z.length&&(e.logging&&
0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" running "+z.length+" postponed additions. Stack is "+l.length+" long."),a.maximum_capacity=Number.MAX_VALUE,z.forEach(function(a){a()}),a.maximum_capacity=a.default_maximum_capacity,z=[]),b;d&&e.UTILITIES.report_internal_error("Nothing removed from nest!")};u.dereference_path=function(a,b){if(0===l.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(l&&"function"===typeof l[0].dereference_path)return l[0].dereference_path(a,
b);b.display_message("Robot expected to find something on a nest that it could get "+e.path.toString(a)+". But the nest is empty or contains something else.");return this};u.dereference_contents=function(a,b){var c;if(0===l.length)return{wait_until_this_nest_receives_something:this};if(a.removing_widget){var d=l[0];b.remove_from_container(d,this);if(this.visible()){var f=this.get_frontside_element();a=$(f).offset();var g=$(f).closest(".toontalk-backside-of-top-level");(c=g.offset())||(c={left:0,top:0});
var h=d.get_element(!0);var k=$(f).width();f=$(f).height();var m=.1*k+a.left-c.left;var n=.1*f+a.top-c.top;e.UTILITIES.set_css(h,{width:k*e.nest.CONTENTS_WIDTH_FACTOR,height:f*e.nest.CONTENTS_HEIGHT_FACTOR});d.render();0<g.length&&b.add_watched_step_end_listeners(function(){d.get_parent()&&(g.get(0).appendChild(h),e.UTILITIES.set_css(h,{left:m,top:n}))})}return d}return a.next?l[0].get_widget().dereference_path&&(d=l[0].get_widget().dereference_path(a.next,b))?d:e.path.continue_dereferencing_path(a.next,
l[0].get_widget(),b):l[0].get_widget()};u.get_json=function(a,b,c,d){var f=[],g=function(){var g=function(a,c,d){b({type:"nest",contents:f,guid:w,original_nest:a,serial_number:v,name:this.get_name()},c,d+1)}.bind(this);r?e.UTILITIES.get_json(r,a,g,c,d+1):g(void 0,c,d+1)}.bind(this);e.UTILITIES.get_json_of_array(l,f,0,a,g,c,d+1)};u.copy=function(a){if(a&&a.just_value){if(0<l.length){var c=l[0].copy(a);if(!a.copy_covered_nests)return c}var d=e.nest.create(this.get_description(),[],"in a robot's condition",
void 0,v,this.get_name());c&&d.add_to_contents(c);return d}c=e.UTILITIES.copy_widget_sides(l,a);if(a)if(a.fresh_copy)d=e.nest.create(this.get_description(),c,w&&e.UTILITIES.generate_unique_id());else{var f=r||this;if(a.birds_copied&&a.birds_copied[w]){var g=f.get_guid();a.nests_copied&&a.nests_copied[g]?(d=a.nests_copied[g][0].copy(),a.nests_copied[g].forEach(function(a){b.call(a,d)})):d=e.nest.create(this.get_description(),c,e.UTILITIES.generate_unique_id(),void 0,void 0,this.generate_name());a.birds_copied[w].forEach(function(a){a.set_nest(d,
this);e.debugging&&(a._debug_string=a.to_debug_string())}.bind(this))}else d=e.nest.create(this.get_description(),c,w,f,v,this.get_name()),g=w;a.nests_copied||(a.nests_copied={});a.nests_copied[f]?a.nests_copied[g].push(d):a.nests_copied[g]=[d]}else d=e.nest.create(this.get_description(),c,w,r||this,v,this.get_name());return this.add_to_copy(d,a)};u.has_contents=function(){return 0<l.length};u.set_contents=function(a){l=a};u.dropped_on_other=function(a,b){var c,d,f,g;if(!w){w=e.UTILITIES.generate_unique_id();
e.debugging&&(this._debug_string=this.to_debug_string());var h=e.bird.create(this);if(b.robot){b.robot.add_newly_created_widget(h);if(!this.visible())return;this.robot_waiting_before_next_step=b.robot}b.event&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(h);e.sounds&&setTimeout(function(){e.sounds.hatching.play()},1E3);this.rerender();var k=this.get_frontside_element(!0);e.UTILITIES.add_animation_class(k,"toontalk-hatch-egg");var m=function(){if(a.is_backside())var m=
a;else if((m=e.UTILITIES.widget_side_of_jquery($(k).closest(".toontalk-backside-of-top-level")))||(m=e.UTILITIES.widget_side_of_jquery($(a.get_widget().get_frontside_element(!0)).closest(".toontalk-backside-of-top-level"))),m)m=m.is_backside()?m:m.get_backside();else{e.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");return}var l=m.get_element();var n=$(l).offset();c=h.get_frontside_element(!0);$(c).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
e.UTILITIES.add_animation_class(c,"toontalk-fly-southwest");d=e.UTILITIES.relative_position(k,l);e.UTILITIES.set_css(c,{left:d.left,top:d.top});b.event&&this.robot_in_training()&&(b.ignore_training=!0);m.widget_side_dropped_on_me(h,b);$(k).removeClass("toontalk-hatch-egg").addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&(e.UTILITIES.set_css(k,{left:d.left-
5,top:d.top+45}),this.get_parent_of_frontside().render());g=function(){$(c).removeClass("toontalk-fly-southwest");e.UTILITIES.set_timeout(function(){e.UTILITIES.add_animation_class(c,"toontalk-fly-down");$(c).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));f=function(){var a=function(){$(c).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);
$(c).removeClass("toontalk-fly-down");e.UTILITIES.add_animation_class(c,"toontalk-bird-morph-to-static");e.UTILITIES.add_one_shot_event_handler(c,"animationend",1E3,a);b.robot&&(this.robot_waiting_before_next_step=void 0,b.robot.run_next_step());h.update_display()}.bind(this);e.UTILITIES.add_one_shot_event_handler(k,"animationend",1E3,f)}.bind(this))}.bind(this);$(c).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));h.animate_to_absolute_position({left:Math.max(10,
d.left-70)+n.left,top:Math.max(10,d.top+70)+n.top},g,b.robot&&b.robot.transform_animation_speed(e.animation_settings.BIRD_ANIMATION_SPEED));this.rerender()}.bind(this);e.UTILITIES.add_one_shot_event_handler(k,"animationend",2E3,m)}return!0};u.widget_side_dropped_on_me=function(a,b){b.event&&a.save_dimensions&&a.save_dimensions();0===l.length?(this.add_to_contents(a,b),a.dropped_on_other?a.dropped_on_other(this,b):b.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(l[0],
b);return!0};u.drop_on=function(a,b){return a.widget_side_dropped_on_me?(a.widget_side_dropped_on_me(this,b),!0):!1};u.element_to_highlight=function(){return 0===l.length?this.get_frontside_element():l[0].get_frontside_element()};u.update_display=function(){var a=this.get_frontside(!0),b=this.get_backside();var c=a.get_element();if(0<l.length){c.setAttribute("toontalk_name","");var d=l[0];if(d.is_backside()){var f=d.get_element(!0);d.update_display();d.scale_to_fit(f,c)}else d.set_visible(!0),d.render(),
f=l[0].get_element(!0),$(f).show();e.UTILITIES.when_attached(f,function(){var a=this.get_contents_dimensions();if(a){var b=$(c).width();var g=$(c).height();e.UTILITIES.set_css(f,{width:a.width,height:a.height,left:b*(1-e.nest.CONTENTS_WIDTH_FACTOR)/2,top:g*(1-e.nest.CONTENTS_HEIGHT_FACTOR)/2});d.set_size_attributes&&d.set_size_attributes(a.width,a.height);d.render()}}.bind(this));$(c).parent().is(".toontalk-box-hole")&&!$(c).parent().is(".toontalk-scale-half")?(c.parentElement.appendChild(f),$(f).css({"z-index":e.UTILITIES.next_z_index()})):
c.appendChild(f);$(c).addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest"));l[0].is_backside()?d.set_parent_of_backside(this):d.set_parent_of_frontside(this)}else c.setAttribute("toontalk_name",this.get_name()),w?($(c).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(c).addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest"))):e.UTILITIES.add_animation_class(c,this.get_class_name_with_color("toontalk-nest-with-egg")),
e.UTILITIES.set_css(c,{"font-size":this.name_font_size()});e.UTILITIES.give_tooltip(c,this.get_title());$(c).addClass("toontalk-nest");b&&b.rerender()};c||(c=e.UTILITIES.generate_unique_id());u[c]=function(a,b){if(!B){if(b)return;B=[]}b?B.splice(B.indexOf(a),1):B.push(a)};u.get_contents_dimensions=function(){var a=this.get_frontside_element();var b=$(a).parent().is(".toontalk-box-hole")&&!$(a).parent().is(".toontalk-scale-half")?a.parentElement:a;a=$(b).width();b=$(b).height();a*=e.nest.CONTENTS_WIDTH_FACTOR;
b*=e.nest.CONTENTS_HEIGHT_FACTOR;var c=l[0];if(c){var d=c.is_box()?1:2;c=c.get_border_size?d*c.get_border_size(a,b):0;return{width:a-c,height:b-c}}};u.get_path_to=function(a,b){if(0<l.length){var c=l[0].get_widget();if(c===a)return e.path.to_widget_on_nest();if(c.get_path_to){var d=e.path.to_widget_on_nest();if(a=c.get_path_to(a,b))return d.next=a,d}}};u.walk_children=function(a){if(0<l.length)return a(l[0])};u.top_contents_is=function(a){return 0<l.length&&l[0]===a};u.any_nest_copies_visible=function(){var a=
!1;if(!B)return!1;B.some(function(b){b.visible()&&(a=!0)});return a};u.compare_with=function(a){if(0<l.length){if(l[0].compare_with)return l[0].compare_with(a);e.UTILITIES.report_internal_error("Nest contains something that doesn't understand 'compare_with'. It is "+l[0])}else if(a.compare_with_nest)return-1*a.compare_with_nest(this)};u.compare_with_nest=function(a){return 0===l.length?0:1};u.compare_with_number=function(a){return 0<l.length?l[0].compare_with(a):-1};u.get_class_name_with_color=function(a){return v?
a+["","-magenta","-yellow"][v%3]:a};u.generate_name=function(){t++;return n&&"#"!==n[0]?e.UTILITIES.strip_trailling_digits(n).trim()+" "+t:"#"+t};u.has_name(u);u.get_name_width=function(a){return.8*(a||this.get_width())};u.get_name_height=function(a){return.5*(a||this.get_height())};var G=u.set_name;u.set_name=function(a,b,c){var d=this.get_name();if(!G.call(this,a,b,c))return!1;b&&$(".toontalk-bird").each(function(){if(this.getAttribute("toontalk_name")===d){var b=e.UTILITIES.widget_side_of_element(this);
e.UTILITIES.set_css(b.get_element(),{"font-size":e.UTILITIES.font_size(a,.4*b.get_width(),{height:.6*b.get_height()})});b.rerender()}})};u.compare_with_box=u.compare_with_number;u.compare_with_scale=u.compare_with_number;u.add_standard_widget_functionality(u);d||(d=u.remove);u.remove=function(){d.call(this);r&&f.call(r,this)};u.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});var N=u.set_visible;u.set_visible=function(a,b){N.call(this,a,b);a||this.set_locked(!1)};u.set_name(n);
u.set_description(m);e.debugging&&(u._debug_id=e.UTILITIES.generate_unique_id(),u._debug_string=u.to_debug_string());r&&w&&(c||(c=e.UTILITIES.generate_unique_id()),r[c](u));return u};a.create_function=function(a,b,c){var d=function(){return!1},f=e[b]&&e[b].function&&e[b].function[c];d={is_nest:function(){return!0},get_function_type:function(a){return e[b].get_type_name(a)},get_function_object:function(){return f},set_function_name:function(a){if(c===a)return!1;c=a;f=e[b]&&e[b].function&&e[b].function[c];
this.add_to_contents=f.respond_to_message;return!0},is_function_nest:function(){return!0},copy:function(){return e.nest.create_function(a,b,c)},animate_bird_delivery:function(a,b,c){b.animate_delivery_to(a,this,c)},get_json:function(a,c,d,g){c({type:"function_nest",function_type:b,function_name:f?f.name:e.UTILITIES.get_first_property(e[b].function)},d,g+1)},add_to_json:e.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return f.short_name},get_backside_widgets:function(){return[]},
has_ancestor:d,visible:d,any_nest_copies_visible:d,is_backside:d};e.widget.has_parent(d);e.widget.has_description(d);e.widget.add_sides_functionality(d);d.set_description(a);f?(d.add_to_contents=f.respond_to_message,e.debugging&&(d._debug_id=e.UTILITIES.generate_unique_id(),d._debug_string="a function nest that "+f.toString())):e.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+b+"."+c+" is not defined.");return d};e.creators_from_json.function_nest=function(a,b){if(a)return e.nest.create_function(a.description,
a.function_type,a.function_name)};a.create_backside=function(){return e.nest_backside.create(this)};a.match_nest_with_nest=function(a){return"matched"};a.toString=function(){return this.get_name()?"nest named '"+this.get_name()+"'":"nest"};a.get_default_description=function(){return"a nest that receives things from its birds."};a.get_help_URL=function(){return"docs/manual/birds-nests.html"};a.get_type_name=function(a){return a?"nests":"nest"};a.maintain_proportional_dimensions=function(){return!0};
a.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};a.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};e.creators_from_json.nest=function(b,c,d){if(!b)return Object.create(a);d||(d=!b.original_nest&&b.guid&&c&&c.guid_to_nest_table&&c.guid_to_nest_table[b.guid]);d=e.nest.create(b.description,[],b.guid,b.original_nest&&e.UTILITIES.create_from_json(b.original_nest,c),b.serial_number,b.name,d);d.set_contents(e.UTILITIES.create_array_from_json(b.contents,
c));return c.guid_to_nest_table[b.guid]=d};a.CONTENTS_WIDTH_FACTOR=1;a.CONTENTS_HEIGHT_FACTOR=1;return a}(window.TOONTALK);window.TOONTALK.nest_backside=function(b){return{create:function(a){a=b.backside.create(a);a.add_description_setting();a.add_name_setting();return a}}}(window.TOONTALK)})();window.TOONTALK.scale=function(b){var h=Object.create(b.widget);h.create=function(f,g,e,a,c){var d=function(){e.rerender()},h=function(){return e.get_contents_dimensions()};e||(e=b.box.create(2,void 0,f,g,c||""));var t=e.get_json;var m=e.copy;var l=e.get_path_to;e.is_scale=function(){return!0};e.copy=function(a){this.get_name();a||(a={});var c=m.call(this,a);c=b.scale.create(void 0,void 0,c,a.just_value&&this.get_state());return e.add_to_copy(c,a)};e.get_json=function(a,b,c,d){var e=function(a,c,
d){a.type="scale";a.inactive_state=this.get_inactive_state();b(a,c,d+1)}.bind(this);t.call(this,a,e,c,d+1)};e.get_path_to=function(a,b){if(a=l.call(this,a,b))a.true_type="scale";return a};e.drop_on=function(a,b){if(a&&a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b)};e.widget_side_dropped_on_me=function(a,b){var c=this.get_hole_contents(0),d=this.get_hole_contents(1);a.dropped_on_other&&a.dropped_on_other(this,b);if(c&&!d)return this.get_hole(1).widget_side_dropped_on_me(a,b),
!0;if(!c&&(d||!b.event))return this.get_hole(0).widget_side_dropped_on_me(a,b),!0;var e=this.which_hole(b.event,!1);if(0===e){if(c){if(c.drop_on)return a.drop_on(c,b);return}}else if(d){if(d.drop_on)return a.drop_on(d,b);return}if(this.get_hole(e))return this.get_hole(e).widget_side_dropped_on_me(a,b),!0};e.which_hole=function(a,c){var d=e.get_frontside_element(),f=$(d).offset();d=b.UTILITIES.get_element_width(d);a=a.clientX-(f.left+d/2);c=c?d/10:0;return-a>c?0:a>c?1:-1};e.get_inactive_state=function(){return a};
e.update_display=function(){var a=this.get_frontside_element(!0),c=$(a),d=$(a).children(".toontalk-scale-half"),e=$(a).parent();e=e.is(".toontalk-backside")||c.is(".toontalk-conditions-contents")?a:e.get(0);var f=$(e).width()||c.width(),g=$(e).height()||c.height(),k=function(a,c,d){var e=c.get_contents(),k=(e||c).get_element(!0);b.UTILITIES.set_css(a,{left:d*f*.5,top:0,width:.5*f,height:g});if(a!==k){var l=0===d?-.05*f:.15*f;d="toontalk-scale-balanced"===m?.1*g:0===d&&"toontalk-scale-left_heavier"===
m||1===d&&"toontalk-scale-right_heavier"===m?.25*g:1===d&&"toontalk-scale-left_heavier"===m||0===d&&"toontalk-scale-right_heavier"===m?-.1*g:.2*g;var n=.4*f;var r=.4*g;$(k).css({left:l,top:d,width:n,height:r});$(a).css({width:n,height:r});e&&(e.set_location_attributes&&e.set_location_attributes(l,d),e.set_size_attributes&&e.set_size_attributes(n,r),e.is_backside()&&(e.update_display(),e.scale_to(n,r)),e.set_visible(!0),e.render());a.appendChild(k);c.get_contents_dimensions=h;c.is_scale_pan=function(){return!0}}};
if(c.is(".toontalk-top-level-resource"))var m="toontalk-scale-balanced";else{var l=this.get_state();m="undefined"===typeof l?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][l+1]}c.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");c.addClass(m);c.addClass("toontalk-scale");0===f&&(f=1);0===g&&(g=1);$(e).is(".toontalk-top-level-resource")||$(a).is(".toontalk-top-level-resource")||
(c=b.UTILITIES.scale_to_fit(a,e,123,91),f/=c.x_scale,g/=c.y_scale);2===d.length?d.each(function(a,c){b.UTILITIES.set_timeout(function(){k(c,this.get_hole(a),a)}.bind(this))}.bind(this)):(this.get_holes().forEach(function(b,c){var d=b.get_element();b.get_contents();0===c?$(d).addClass("toontalk-left_scale  toontalk-scale-half"):$(d).addClass("toontalk-right_scale toontalk-scale-half");a.appendChild(d);b.update_display()}),setTimeout(function(){this.render()}.bind(this),100));b.UTILITIES.give_tooltip(a,
this.get_title());b.debugging&&(this._debug_string=this.to_debug_string())};e.get_contents_dimensions=function(){var a=this.get_frontside_element(!0),b=$(a).parent(),c=b.is(".toontalk-backside")||$(a).is(".toontalk-conditions-contents")?a:b.get(0);b=$(c).width()||$(a).width();a=$(c).height()||$(a).height();return{width:.4*b,height:.4*a}};e.render=function(){b.DISPLAY_UPDATES.pending_update(this)};e.get_type_name=function(a){return a?"scales":"scale"};e.get_help_URL=function(){return"docs/manual/scales.html"};
e.is_resizable=function(){return!1};e.toString=function(){var a=this.get_hole_contents(0),c=this.get_hole_contents(1);switch(this.get_state()){case -1:var d="scale leaning to the right";break;case 1:d="scale leaning to the left";break;case 0:d="balanced scale";break;default:if(d="unbalanced scale",!e&&!f)return d}var e=a?"contains "+b.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";var f=c?"contains "+b.UTILITIES.add_a_or_an(c.get_full_description()):"is empty";return d+" and the left pan "+
e+" and the right pan "+f};e.create_backside=function(){return b.scale_backside.create(this)};e.get_state=function(){var a=this.get_inactive_state();if(a)return a;a=this.get_hole_contents(0);var b=this.get_hole_contents(1);if(a||b)if(a)if(b){if(a=a.dereference(),b=b.dereference(),a.get_widget().compare_with)return a.get_widget().compare_with(b.get_widget())}else return 1;else return-1};e.match=function(a){if(a.get_widget().match_with_scale)return a.get_widget().match_with_scale(this);this.last_match=
a;return this};e.match_with_scale=function(a){var b;return(b=this.get_hole_contents(0))&&b.is_nest()&&!b.has_contents()||(b=this.get_hole_contents(1))&&b.is_nest()&&!b.has_contents()?[[b,this]]:this.get_state()!==a.get_state()?(a.last_match=this,a):this.match_with_this_scale(a)};e.match_with_this_scale=function(a){var c=[],d,e,f;for(d=0;2>d;d++)if(f=a.get_hole_contents(d))if(e=this.get_hole_contents(d)){e=b.UTILITIES.match(f,e.dereference());if(e.is_widget)return e;"matched"!==e&&(c=0===c.length?
e:c.concat(e))}else if(e=this.get_contents_temporarily_removed(d))c.push(e);else return a.last_match=this,a;return 0<c.length?c:"matched"};e.match_with_this_box=function(a){a.last_match=this;return a};e.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};e.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};e.get_name_input_label=void 0;e.generate_name=function(){return""};e.get_custom_title_prefix=function(){var a=
this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};e.get_default_description=function(){return"a scale for comparing things."};var w=e.set_visible;e.set_visible=function(a,b){var c=function(a){a.new_value&&
a.new_value.add_listener("value_changed",d);a.old_value&&a.old_value.remove_listener("value_changed",d,!0)};w.call(this,a,b?b+1:1);a?(e.get_hole(0).add_listener("contents_or_properties_changed",c),e.get_hole(1).add_listener("contents_or_properties_changed",c)):(e.get_hole(0).remove_listener("contents_or_properties_changed",c,!0),e.get_hole(1).remove_listener("contents_or_properties_changed",c,!0));e.get_hole_contents(0)&&e.get_hole_contents(0).add_listener("value_changed",d);e.get_hole_contents(1)&&
e.get_hole_contents(1).add_listener("value_changed",d)};e.set_name=void 0;b.debugging&&(e._debug_id=b.UTILITIES.generate_unique_id(),e._debug_string=e.to_debug_string());return e};b.creators_from_json.scale=function(f,g){if(f)return h.create(b.UTILITIES.create_array_from_json(f.contents,g),f.description,void 0,f.inactive_state,f.name)};return h}(window.TOONTALK);
window.TOONTALK.scale_backside=function(b){return{create:function(h){var f=b.backside.create(h);f.add_description_setting();f.get_element().appendChild(b.backside.create_advanced_settings_button(f,h));return f}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(b){var h=function(e,a,c,d,f){c.current_action_name=a;if(e=b.path.get_path_to(e,c,!0)){d||(d={});var g=Date.now();d.time=g-c.time_of_last_step;c.time_of_last_step=g;c.add_step(b.robot_action.create(e,a,d),f)}else console.log("No path found for "+a);c.current_action_name=void 0},f=Object.create(b.widget),g=0;f.create=function(e,a,c,d,g,h,m,l,w){var k=Object.create(f),v,n,t=[],y=[],z,M,B,G,N,J,K,Q,C;c||(c=b.actions.create());v||(v=k);e&&e.set_parent_of_frontside(k);
k.is_robot=function(){return!0};k.get_frontside_conditions=function(){return e};k.set_frontside_conditions=function(a){(e=a)&&!e.is_top_level()&&e.set_parent_of_frontside(this)};k.get_backside_matched_widgets=function(){return C};k.set_backside_matched_widgets=function(a){C=a};k.get_matched_backside_widget=function(a){if(C)return C[K.indexOf(a)]};k.get_backside_widget_of_type=function(a,b){var c;if(C)return C[a];if(b=b&&b.get_backside_widgets())return b.some(function(b){if(b.is_of_type(a)&&0>this.get_newly_created_widgets().indexOf(b))return c=
b,!0}.bind(this)),c};k.get_backside_conditions=function(){return a};k.set_backside_conditions=function(c){$.isArray(c)?a=c.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(a=[],b.UTILITIES.available_types.forEach(function(b){c[b]&&a.push(c[b])}));a&&a.forEach(function(a){a.is_backside()?a.set_parent_of_backside(this):(b.widget.erasable(a),a.set_parent_of_frontside(this))}.bind(this))};a&&k.set_backside_conditions(a);k.initialize_backside_conditions=function(){var a=this.get_training_context();
K=a?a.get_backside_widgets().slice():[];Q=b.UTILITIES.copy_widget_sides(K,{just_value:!0});this.set_backside_conditions([])};k.add_to_backside_conditions=function(c){var d;0<=this.get_newly_created_widgets().indexOf(c)||(a||(a=[]),c=K.indexOf(c),0<=c&&(d=Q[c]),d&&0>a.indexOf(d)&&(a.push(d),b.widget.erasable(d)))};k.get_backside_condition_index=function(a){if(C){var b=C.indexOf(a);0>b&&(b=C.length,C.push(a))}else b=0,C=[a];return b};k.get_body=function(){return c};k.set_body=function(a){c=a};k.get_running=
function(){return N||this.is_ok_to_run()};k.running_or_in_run_queue=function(){return N};k.set_running_or_in_run_queue=function(a){N=a};k.stopped=function(){return J};k.set_stopped=function(a){J&&(N=!1);if(J!==a){if(J=a)this.run_body_finished_listeners(),this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.set_animating(!1),this.rerender());this.get_next_robot()&&this.get_next_robot().set_stopped(a)}};k.drop_thing_in_hand=function(){g&&(g.drop_on(this.top_level_widget(),
{robot:this}),this.set_thing_in_hand(void 0))};k.finish_cycle_immediately=function(a){var b=function(){this.set_visible(!1);a&&a()}.bind(this);this.add_body_finished_listener(b)};k.get_context=function(){return z};k.set_context=function(a){z=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};k.context_is_backside=function(){return M};k.set_context_is_backside=function(a){M=a;this.get_next_robot()&&this.get_next_robot().set_context_is_backside(a)};k.get_top_level_context=function(){return B};
k.set_top_level_context=function(a){B=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};k.get_queue=function(){return G};k.set_queue=function(a){G=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};k.animate_consequences_of_actions=function(){return this.visible()&&!this.stopped()};k.transform_step_duration=function(a){return!this.visible()||this.stopped()||z&&!z.get_backside()?0:a&&w?a/w:a};k.transform_original_step_duration=function(a){if(!this.visible()||this.stopped()||
z&&!z.get_backside())return 0;if(0===w)return a};k.transform_animation_speed=function(a){return z&&!z.get_backside()||!this.visible()||this.stopped()?0:w?a*w:a};k.set_animating=function(a,c){var d=this.get_frontside_element();a&&b.UTILITIES.visible_element(d)?(c||(c=$(d).offset()),$(d).css({width:"",height:"","z-index":b.UTILITIES.next_z_index()}),b.UTILITIES.set_position_relative_to_top_level_backside(d,c),a=$(d).closest(".toontalk-backside-of-top-level"),0<a.length&&a.get(0).appendChild(d),$(d).addClass("toontalk-robot-animating"),
setTimeout(function(){$(d).addClass("toontalk-side-animating")},2E3)):$(d).removeClass("toontalk-robot-animating toontalk-side-animating")};k.add_body_finished_listener=function(a){t.push(a)};k.run_body_finished_listeners=function(){t.forEach(function(a){a()});t=[]};k.add_watched_step_end_listeners=function(a){y.push(a)};k.run_watched_step_end_listeners=function(){y.forEach(function(a){a()});y=[]};k.get_thing_in_hand=function(){return g};k.set_thing_in_hand=function(a){if(b.debugging){if(a&&"empty hole"===
a.get_type_name()){b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");return}b.logging&&0<=b.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string(50)+" now has in his hand "+(a?a.to_debug_string(50):"nothing"))}a&&!a.constrained_by_container()&&a.save_dimensions();g=a};k.get_next_robot=function(){return m};k.set_next_robot=function(a){var c=this.get_backside_element();a===this?b.UTILITIES.report_internal_error("Ignoring attempt to make a robot its next robot in the team. "+
a):(a&&a.set_first_in_team(this.get_first_in_team()),!a&&m&&(m.set_first_in_team(m),m.set_previous_robot(void 0)),(m=a)&&m.set_previous_robot(this),c&&($(c).find(".toontalk-drop-area-instructions").get(0).innerHTML=this.drop_area_instructions()))};k.get_previous_robot=function(){return n};k.set_previous_robot=function(a){n=a};k.get_first_in_team=function(){return v};k.set_first_in_team=function(a){v=a;m&&m.set_first_in_team(a)};k.walk_children=function(a){var b;m&&!a(m)||!(b=this.get_frontside_conditions())||
b.is_top_level()||a(b)};k.get_run_once=function(){return h};k.set_run_once=function(a){h=a;this.update_title();return!0};k.get_watched_speed=function(){return w};k.set_watched_speed=function(a){w=a;return!0};k.can_run=function(a){return!0};k.training_started=function(a){var c=this.get_training_context();c?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(c.copy({just_value:!0})),this.initialize_backside_conditions(),a||($("*").css({cursor:"url("+
b.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost-robot")),this.update_title(),a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):b.UTILITIES.report_internal_error("Robot started training but can't find its 'context'. Best to remove this robot and train a fresh robot.  robot_training_this_robot is "+
a+" robot is "+f)};k.training_finished=function(){if(this.being_trained){var a;var c=this.get_body().get_newly_created_widgets();for(a=0;a<c.length;a++){var d=c[a];"copy"===d.last_action&&this.add_step(b.robot_action.create(b.newly_created_widgets_path.create(a),"add to the top-level backside"))}$(this.get_frontside_element()).removeClass("toontalk-ghost-robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):
$("*").css({cursor:""})}};if(b.debugging||b.logging)k.to_debug_string=function(a){var c=this.get_frontside_conditions&&this.get_frontside_conditions();return("Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(c?b.UTILITIES.add_a_or_an(c.toString()):"anything")).substring(0,a)};m&&k.set_next_robot(m);k.add_standard_widget_functionality(k);var I=k.remove_backside_widget.bind(k);k.has_name(k);k.set_name(l);k.set_description(d);b.listen&&k.add_speech_listeners({descriptions_acceptable:!0,
names_acceptable:!0});k.remove_backside_widget=function(a,b){var c=this.get_frontside_conditions(),d;a===c?this.set_frontside_conditions(void 0):(d=this.get_backside_conditions())&&d.some(function(b,c){if(a===b)return d.splice(c,1),!0})||I(a,b)};b.debugging&&(k._debug_id=b.UTILITIES.generate_unique_id(),k._debug_string=k.to_debug_string());return k};f.create_backside=function(){return b.robot_backside.create(this)};f.copy=function(e){var a=this.get_frontside_conditions(),c=this.get_backside_conditions();
a=a?a.copy({just_value:!0}):void 0;var d=this.get_next_robot();d=d?d.copy(e):void 0;var f;c&&(f=b.UTILITIES.copy_widgets(c,{just_value:!0}));c=this.create(a,f,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),d,(!e||!e.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(c,e)};f.match=function(b){if(b.get_widget().is_robot()){var a=this.get_body().is_empty();var c=b.get_widget().get_body().is_empty();if(a===c)return"matched"}this.last_match=
b;return this};f.generate_name=function(){g++;return"#"+g.toString()};f.run=function(e,a,c,d){var f=this.get_frontside_conditions(),g,h;if(this.being_trained||this.running_or_in_run_queue())return this;if((h=this.get_backside())&&h.visible()&&f){var l=function(a){$(a.get_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")};
l(f);this.rerender()}e?(this.set_context(e),this.set_context_is_backside(a),this.set_top_level_context(c),this.set_queue(d)):e=this.get_context();this.match_status=b.UTILITIES.match(f,this.get_context());if("matched"===this.match_status){var w=[];(f=this.get_backside_conditions())&&0<f.length&&((g=e.get_backside_widgets())&&f.some(function(a){if(a.matching_widget&&a.matching_widget.get_parent===e){var c=b.UTILITIES.match(a,a.matching_widget);if("matched"===c){w.push(a.matching_widget);var d=c}}d||
g.some(function(e){c=void 0;if(!(0<=w.indexOf(e))){if(e!==this&&!e.is_backside()){l&&l(e);c=b.UTILITIES.match(a,e);if("matched"===c)return w.push(e),d=c,a.matching_widget=e,!0;if(!c.is_widget)d=c;else if(!d||d.is_widget)d=c}void 0===d&&(d=a)}}.bind(this));if("matched"!==d)return this.match_status=d,!0}.bind(this)),"matched"!==this.match_status&&(w=void 0),this.set_backside_matched_widgets(w))}if("matched"===this.match_status){if(this.get_body().is_empty())return;d||(d=this.get_queue()||b.DEFAULT_QUEUE);
this.get_body().reset_newly_created_widgets();d.enqueue(this);return this.match_status}if(this.match_status){if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),this.rerender(),this.get_next_robot()?this.get_next_robot().run(e,a,c,d):this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_element()).addClass("toontalk-conditions-waiting")})}if(this.get_next_robot()){a=this.get_next_robot().run(e,a,c,d);if("matched"===
a)return a;a.is_widget||a.forEach(function(a){0>this.match_status.indexOf(a)&&this.match_status.push(a)}.bind(this))}if(this.get_first_in_team()===this){var r=function(){this.set_waiting(!1);this.run()}.bind(this);this.match_status.forEach(function(a){a[0]?a[0].run_when_non_empty(r,this):a.run_when_non_empty(r,this)}.bind(this));this.set_waiting(!0)}return this.match_status};f.set_waiting=function(e){var a=this.get_frontside_element();a&&(e?this.visible()&&!this.stopped()&&(b.UTILITIES.add_animation_class(a,
"toontalk-robot-waiting"),b.UTILITIES.give_tooltip(a,"This robot is waiting for a bird to deliver something.")):($(a).removeClass("toontalk-robot-waiting"),b.UTILITIES.give_tooltip(a,this.get_title())))};f.run_actions=function(){if(this.stopped())return this.get_first_in_team().set_running(!1),!1;if(this.get_first_in_team().visible())return this.get_body().run_watched(this);this.set_parent_of_frontside(this.get_context());return this.get_body().run_unwatched(this)};f.drop_from_data_transfer=function(b,
a){if(b.is_top_level&&b.is_top_level()){var c=b.get_backside_widgets().slice();setTimeout(function(){c.forEach(function(b){this.picked_up(b,void 0,!0);this.time_of_last_step-=1E3;this.dropped_on(b,a.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))}else this.data_transfer=b};f.ignore_pick_up_or_drop=function(b){return this===b.get_widget()||b.is_top_level()||this.get_parent_of_frontside()===b};f.picked_up=function(e,a,c){if(!this.ignore_pick_up_or_drop(e)){if(e.get_infinite_stack&&
e.get_infinite_stack()){this.current_action_name="pick up a copy of";var d=b.UTILITIES.get_dragee_copy()}else this.current_action_name="pick up";if(c){var f=e;d=e.copy({fresh_copy:!0});a=b.path.get_path_to_resource(d)}else a=b.path.get_path_to(e,this,!0);if(a){c=Date.now();var g={time:c-this.time_of_last_step};this.time_of_last_step=c;g=b.robot_action.create(a,this.current_action_name,g);this.add_step(g,f)}e.last_action=this.current_action_name;this.current_action_name=void 0;this.set_thing_in_hand(d||
e);return g}};f.dropped_on=function(e,a){var c,d;if(!(this.ignore_pick_up_or_drop(e)||e.is_backside()&&this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===e)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(c=b.path.get_path_to(a,this)){if(a.is_backside()){var f=$(a.get_element());if(d=f.offset()){var g=f.width();f=f.height();var h=$(e.get_frontside_element()).offset();
g=(h.left-d.left)/g;d=(h.top-d.top)/f;g=Math.max(0,Math.min(1,g));d=Math.max(0,Math.min(1,d));h={left_offset_fraction:g,top_offset_fraction:d}}}else h={};d=Date.now();h.time=d-this.time_of_last_step;this.time_of_last_step=d;c=b.robot_action.create(c,this.current_action_name,h);this.add_step(c)}e.last_action=this.current_action_name+" "+a.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};f.dropped_on_text_area=function(b,a,c){h(b,"drop it on the text area of",this,c);
b.last_action="drop it on the text area of "+a.get_type_name();this.set_thing_in_hand(void 0)};f.copied=function(b,a,c){c=c?"pick up a copy of":"copy";h(b,c,this,void 0,a);a.last_action=c};f.removed=function(b){var a;this.get_parent()&&(a=this.get_parent().get_widget());h(b,"remove",this);b.last_action="remove";a===b||b===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(b)};f.restored=function(b){h(b,"restore",this)};f.edited=function(b,
a){h(b,"edit",this,a)};f.erased_widget=function(b){h(b,"change whether erased",this)};f.resized_widget=function(b,a,c,d,f){a===d&&c===f||h(b,"change size of",this,{x_factor:d/a,y_factor:f/c})};f.started_training_another=function(b){h(b,"start training",this)};f.finished_training_another=function(b){h(b,"stop training",this)};f.trained=function(b,a){h(b,"train",this,{step:a})};f.backside_opened=function(b){h(b,"open the backside",this)};f.backside_closed=function(b){b.is_primary_backside()?h(b.get_widget(),
"close the backside",this):this.removed(b)};f.button_clicked=function(b,a){h(a.get_widget(),"click the button of",this,{button_selector:b})};f.created_widget=function(e,a,c){this.add_newly_created_widget(e);e.get_parent()||this.add_to_top_level_backside(e,!1);this.add_step(b.robot_action.create(b.path.get_path_to_resource(e.copy()),"add a new widget to the work space",{button_selector:c,path_to_source:b.path.get_path_to(a,this)}))};f.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};
f.remove_from_container=function(b,a){var c=a.get_index_of&&b.get_parent_of_frontside()&&a.get_index_of(b),d=function(){a.removed_from_container(b,void 0,c,!0)};b=b.dereference();this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(d):d();this.add_newly_created_widget_if_new(b)};f.get_training_context=function(){return this.get_first_in_team().get_parent_of_frontside()&&this.get_first_in_team().get_parent_of_frontside().get_widget()};f.add_step=function(b,a){this.get_body().add_step(b,
a);this.update_title();"train"!==b.get_action_name()&&"start training"!==b.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,b)};f.update_display=function(){var e=this.get_frontside(!0);this.get_backside();var a=this.get_thing_in_hand(),c;b.debugging&&(this._debug_string=this.to_debug_string());var d=e.get_element();a&&(c=a.get_element());!c&&this.carrying_tool&&(c=document.createElement("div"),$(c).addClass(this.carrying_tool));b.UTILITIES.give_tooltip(d,
this.get_title());$(d).addClass("toontalk-robot");$(d).children(".toontalk-held-by-robot").remove();if(c)try{d.appendChild(c)}catch(k){}this.match_status&&(this.match_status.is_widget?$(d).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(d).removeClass("toontalk-robot-not-matched"));d.setAttribute("toontalk_name",this.get_name());b.UTILITIES.set_timeout(function(){if(c){var e={position:"absolute"};$(c).addClass("toontalk-held-by-robot");var f=b.UTILITIES.get_element_width(c);b.UTILITIES.get_element_height(c);
var g=b.UTILITIES.get_element_width(d);var h=b.UTILITIES.get_element_height(d);if(a&&0===f){f=a.get_default_width?a.get_default_width():2*g;var w=a.get_default_height?a.get_default_height():h/2;e.width=f;e.height=w}e.left=(g-f)/2;e.top=h/4;$(c).css(e);a&&a.rerender()}});b.UTILITIES.set_css(d,{"font-size":this.name_font_size()})};f.add_newly_created_widget=function(b){return this.get_body().add_newly_created_widget(b)};f.add_newly_created_widget_if_new=function(b){if(b!==this.get_training_context()&&
this!==b)return this.get_body().add_newly_created_widget_if_new(b)};f.is_newly_created=function(b){return this.get_body().is_newly_created(b)};f.get_recently_created_widget=function(){var b=this.get_body().get_newly_created_widgets();return b[b.length-1]};f.get_title=function(){var b=this.get_description();if(b)return b="I'm "+b,0>b.lastIndexOf(".")&&(b+="."),b+"\n"+this.toString();b=this.get_frontside_element();return $(b).is(".toontalk-top-level-resource")?"Drag this robot to a work area.":this.toString()};
f.toString=function(e){var a,c;if(e&&"conditions"===e.role)return"any robot";if(e&&"match_status"===e.role)return"robot "+this.get_name();var d="function"===typeof this.get_frontside_conditions&&this.get_frontside_conditions();var f="function"===typeof this.get_backside_conditions&&this.get_backside_conditions();if(!d&&!f)return"an untrained robot";var g=d&&d.is_top_level();e||(e={});var h=e.person;if(e&&e.resource){if(this.get_description())return'"'+this.get_description()+'"';e.person="third"}var l=
this.get_body();var w=c="";var r=this.get_next_robot();if(g)var v="When the workspace's green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" is pressed";else if(d){var n=b.UTILITIES.add_a_or_an(d.get_full_description({role:"conditions"}));v="When working on something that matches "+n}f&&(f.forEach(function(c){c&&(v+=" and\nif on the"+(g?" work area ":" back ")+" is "+b.UTILITIES.add_a_or_an(c.get_full_description({role:"conditions"})),a=!0)}),a&&(v+="\n"));
v||(v="");if(this.being_trained){if(l.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";c="is being trained.\n";w="\n..."}try{var u=l.toString({robot:this})}catch(M){u=b.UTILITIES.is_stack_overflow(M)?"...":"Describing the actions caused this error: "+M.message}l=c+v+(e&&"third"===e.person?" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(u||"do nothing")+w;if(e&&e.resource)return e.person=h,l.replace(/\n/g," ");if(this.match_status)if(this.match_status.is_widget&&
d){var y=d.is_top_level()?"the work area I'm running on":"the "+d.get_type_name()+" I'm on the back of";if(this.match_status===d)var z=y;else this.match_status.has_ancestor(d)?z="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+y:(d.is_top_level()||(y="the "+this.match_status.get_type_name()+" on "+y),f.some(function(a){if(this.match_status===a)return z="any "+a.get_type_name(!0)+" on ",d.is_top_level()||(z+="the back of "),z+=y,!0;if(this.match_status.has_ancestor(a))return z=
"any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+y,!0}.bind(this)));l="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+z+". Perhaps editing my conditions will help.\n"+l}else"matched"!==this.match_status&&(l="I'm waiting for something to be delivered to the nest that matches "+(0<this.match_status[0].length&&this.match_status[0][1]?b.UTILITIES.add_a_or_an(this.match_status[0][1].toString()):
b.UTILITIES.add_a_or_an(this.match_status[0].toString()))+" in my conditions (highlighted in yellow on my backside).\n"+l);r&&(l+="<p>If it doesn't match then the next robot will try to run.<p><p>"+r.toString()+"</p>");return l};f.get_type_name=function(b){return b?"robots":"robot"};f.maintain_proportional_dimensions=function(){return!0};f.matching_resource=function(b){return b.is_robot()&&!this.get_frontside_conditions()&&!b.get_frontside_conditions()&&this.get_body().is_empty()&&b.get_body().is_empty()};
f.get_top_level_context_description=function(b){var a=this.get_frontside_conditions();a=a?a.get_type_name():"top-level";return"top-level"===a?b&&"third"===b.person?"his workspace":"my workspace":b&&"third"===b.person?"the "+a+" he's working on":"the "+a+" I'm working on"};f.get_help_URL=function(){return"docs/manual/robots.html"};f.drop_area_instructions=function(){return this.get_next_robot()?"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};
f.get_name_height=function(b){return.4*(b||this.get_height())};f.get_contents_dimensions=function(){return{width:240,height:60}};f.get_json=function(e,a,c,d){var f=this.get_frontside_conditions(),g=this.get_backside_conditions(),h=function(){var g=function(c,d,g){var h=function(b,d,e){a({type:"robot",frontside_conditions:b,backside_conditions:w,body:l,run_once:this.get_run_once(),next_robot:c,name:this.get_name(),speed:this.get_watched_speed()},d,e+1)}.bind(this);this.get_body().get_json(e,function(a,
c,d){l=a;f?f.is_top_level()?h({type:"top_level"},c,d+1):b.UTILITIES.get_json(f,e,h,c,d+1):h(void 0,c,d+1)},d,g+1)}.bind(this);this.get_next_robot()?b.UTILITIES.get_json(this.get_next_robot(),e,g,c,d+1):g(void 0,c,d+1)}.bind(this),l;if(g){var w=[];b.UTILITIES.get_json_of_array(g,w,0,e,h,c,d+1)}else h()};b.creators_from_json.robot=function(e,a){if(e){var c,d,f;e.thing_in_hand&&(d=b.UTILITIES.create_from_json(e.thing_in_hand,a));e.next_robot&&(c=b.UTILITIES.create_from_json(e.next_robot,a));e.backside_conditions&&
($.isArray(e.backside_conditions)?f=b.UTILITIES.create_array_from_json(e.backside_conditions,a):e.semantic&&b.UTILITIES.available_types.forEach(function(a){e.semantic.backside_conditions[a]&&f.push(b.UTILITIES.get_json(e.semantic.backside_conditions[a],json_history))}));var g=b.UTILITIES.create_from_json(e.frontside_conditions||e.bubble,a);c=b.robot.create(g,f,void 0,e.description,d,e.run_once,c,e.name,e.speed);a||(a={});a.robot=c;c.set_body(b.UTILITIES.create_from_json(e.body,a));return c}};f.find_conditions_path=
function(e,a,c){var d=a.get_frontside_conditions(),f=d===e?"entire_condition":d&&d.get_path_to&&d.get_path_to(e,c);d=b.path.get_path_to(a,c);var g;if(!f){var h=a.get_backside_conditions();h.some(function(b){if(b&&b!==c&&b!==a&&(f=b.get_path_to(e,c)))return g=b,!0})}if(f)return b.robot.create_conditions_path(f,d,g);b.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};f.create_conditions_path=function(e,a,c){"string"===typeof c&&this.get_backside_conditions().some(function(a){if(a&&
a.get_type_name()===c)return c=a,!0});return{dereference_path:function(d){var f=b.path.dereference_path(a,d);f=c?c:f.get_frontside_conditions();return"entire_condition"===e?f:b.path.dereference_path(e,d,f)},toString:function(){var d="entire_condition"===e?"the ":b.path.toString(e)+" of the ";return c?d+c.toString()+" backside condition of "+b.path.toString(a):d+" front side condition of "+b.path.toString(a)},get_json:function(d,f,g,h){var k=function(b,g,h){a.get_json(d,function(a,b,g){var h=function(b,
d,e){f({type:"path_to_robot_conditions",backside_condition:c&&b,path_to_robot:a,path_within_conditions:b},d,e+1)};"entire_condition"===e?h("entire_condition",b,g+1):e.get_json(d,h,b,g+1)},g,h+1)};c?b.UTILITIES.get_json(c,d,k,g,h+1):k(void 0,g,h+1)}}};b.creators_from_json.path_to_robot_conditions=function(e){var a=b.UTILITIES.create_from_json(e.path_to_robot),c="entire_condition"===e.path_within_conditions?e.path_within_conditions:b.UTILITIES.create_from_json(e.path_within_conditions);e=e.backside_condition&&
b.UTILITIES.create_from_json(e.backside_condition);return b.robot.create_conditions_path(c,a,e)};return f}(window.TOONTALK);window.TOONTALK.robot_backside=function(b){var h=function(f,e,a,c){f=b.UTILITIES.create_text_element(f);var d=e.get_element(!0),g=document.createElement("div"),h=function(){$(d).parent().addClass("toontalk-conditions-container");if(e.visible()){e.update_display();var a={width:$(g).width(),height:$(g).height(),left:"",top:""};e.use_scaling_transform?e.use_scaling_transform(a):
e.is_backside()&&b.UTILITIES.scale_element(d,a.width,a.height,e.get_original_width()||$(d).width(),e.get_original_height()||$(d).height(),void 0,a);$(d).is(".toontalk-box")||$(d).is(".toontalk-image-element")||$(d).is(".toontalk-number")||$(d).css(a);e.rerender()}};$(d).addClass("toontalk-conditions-contents "+c);a.match_status&&(a.match_status.is_widget?$(a.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==a.match_status&&a.match_status.forEach(function(a){$(a[1].get_element()).addClass("toontalk-conditions-waiting")}));
g.appendChild(d);a=b.UTILITIES.create_horizontal_table(f,g);$(a).addClass("toontalk-conditions-panel");b.UTILITIES.run_when_dimensions_known(d,function(){setTimeout(h,100)});return a},f=function(f,e){var a=e.get_frontside_conditions(),c=e.get_backside_conditions(),d=e.visible(),g;a&&(a.is_top_level()?0>f.firstChild.textContent.indexOf("I always run when the green flag")&&f.insertBefore(b.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),
f.firstChild):0>f.firstChild.textContent.indexOf("I run only if the thing I'm on the back of matches: ")&&f.insertBefore(h("I run only if the thing I'm on the back of matches: ",a,e,"toontalk-frontside-conditions-area"),f.firstChild),a.set_visible(d),a.rerender());c&&0===$(f).find(".toontalk-backside-condition").length&&c.forEach(function(a){if(a){var c=a.is_backside()?"on-backside":a.get_type_name();g="toontalk-backside-"+c+"-conditions-area toontalk-backside-condition";if("bird"===c){if(0===$(f).find(".toontalk-bird-on-back-condition").length){var k=
b.UTILITIES.create_text_element("And there is a bird on the back.");$(k).addClass("toontalk-bird-on-back-condition toontalk-backside-condition")}}else k=h("And if "+b.UTILITIES.add_a_or_an(c)+" matches: ",a,e,g);k&&f.insertBefore(k,f.firstChild.nextSibling);a.set_visible(d);a.rerender()}})};return{create:function(g){var e=b.backside.create(g),a=e.get_element(),c=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},
d=b.UTILITIES.create_check_box(!g.get_run_once(),"toontalk-run-once-check-box","When finished start again",c(g.get_run_once())),h="normal;original;double;half;very fast;very slow".split(";"),t=[1,0,2,.5,10,.25],m=function(a){a=h.indexOf(a);return t[a]},l=b.UTILITIES.create_select_menu("robot_speed",h,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),
w=b.UTILITIES.create_drop_area(g.drop_area_instructions()),r=g.get_next_robot(),v=b.backside.create_advanced_settings_button(e,g),n=e.update_display.bind(e),u=function(a,b){var c=a.get_frontside_element(!0);if(a.get_default_width){var d=a.get_default_width();a=a.get_default_height();$(c).css({left:"",top:"",width:d,height:a})}b.appendChild(c)},y=e.hide_backside,z=e.add_advanced_settings;e.hide_backside=function(a){y.call(this,a);g.being_trained&&g.training_finished()};$(w).data("drop_area_owner",
g);d.button.addEventListener("click",function(a){var e=d.button.checked;g.set_run_once(!e);b.UTILITIES.give_tooltip(d.container,c(!e));g.robot_in_training()&&g.robot_in_training().edited(g,{setter_name:"set_run_once",argument_1:!e,toString:"change to "+(e?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});a.stopPropagation()});$(l.menu).val(function(a){a=void 0!==a?t.indexOf(a):0;return h[a]}(g.get_watched_speed())).selectmenu("refresh");$(l.menu).on("selectmenuselect",
function(a){g.set_watched_speed(m(a.target.value))});r&&u(r,w);w.addEventListener("drop",function(a){(a=b.UTILITIES.get_dragee())&&a.is_robot()&&(a.get_body().is_empty()?(a=a.open_backside())&&$(a.get_element()).find(".toontalk-train-backside-button").click():(u(a,w),g.set_next_robot(a)))});e.get_next_robot_area=function(){return w};e.update_display=function(){var a=g.get_frontside_element();a&&b.UTILITIES.give_tooltip(a,g.get_title());this.change_label_and_title_of_train_button(this.get_widget().being_trained);
n()};b.UTILITIES.when_attached(a,function(){var a=g.get_backside_conditions(),b=g.get_frontside_conditions();a&&a.forEach(function(a){a.set_visible(!0)});b&&b.set_visible(!0)});a.appendChild(this.create_train_button(e,g));f(a,g);a.appendChild(v);e.add_advanced_settings=function(){z.call(e,d.container,l.container,w)};return e},create_train_button:function(g,e){var a=g.get_element();$(a);var c=$("<button>Train</button>").button(),d=!1;c.addClass("toontalk-train-backside-button toontalk-button-style");
g.change_label_and_title_of_train_button=function(d){jQuery.contains(window.document,c.get(0))&&(c.is(".ui-button")||c.button(),d?(c.button("option","label","Stop training "+e.get_name()),b.UTILITIES.give_tooltip(c.get(0),"Click to stop training this robot.")):e.get_body().is_empty()?(c.button("option","label","Train"),b.UTILITIES.give_tooltip(c.get(0),"Click to start training this robot.")):(c.button("option","label","Re-train "+e.get_name()),b.UTILITIES.give_tooltip(c.get(0),"Click to start training this robot all over again.")),
b.UTILITIES.visible_element(a)&&f(a,e))};g.change_label_and_title_of_train_button(d);c.get(0).addEventListener("click",function(a){d=!d;g.change_label_and_title_of_train_button(d);d?(e.initialize_backside_conditions(),e.get_body().reset_steps(),e.robot_started_training(e),e.training_started()):e.training_finished();a.stopPropagation()});c.css({display:"block"});return c.get(0)}}}(window.TOONTALK)})();(function(){var b=function(b){return"rotate"===b||"skewX"===b||"skewY"===b||"transform-origin-x"===b||"transform-origin-y"===b},h=function(f){return"transform-origin-x"===f||"transform-origin-y"===f?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+f:b(f)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+f:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+f};window.TOONTALK.element=function(f){var g=["left","top","width","height"],e=Object.create(f.widget),a=
function(a,b){var c;if(!a)return 0;"number"===typeof a&&(c=a);0===a.length&&(c=0);if("undefined"===typeof c){var d=a.substring(a.length-1);if(0<="0123456789x".indexOf(d)&&(c=parseFloat(a),isNaN(c)))return}a=c;0<=["rotate","skewX","skewY"].indexOf(b)?(b=a%360,0>b&&(b+=360)):b=a;return b},c=function(a,b){if((b.left||b.top)&&!a.being_dragged){var c=a.get_parent_of_frontside();var d=$(a.get_element()).width();a=$(a.get_element()).height();if(c){if(b.left){var e=c.is_element()?c.get_original_width():c.get_width();
if(b.left<d/-2||b.left>e+d/2)if(d=0<e?(b.left%e+e)%e:b.left,b.left!==d){b.left=d;var f=!0}}b.top&&(c=c.is_element()?c.get_original_height():c.get_height(),b.top<a/-2||b.top>c+a/2)&&(c=0<c?(b.top%c+c)%c:b.top,b.top!==c&&(b.top=c,f=!0));return f}}};e.create=function(a,g,h,m,l,w,r,v){var d=Object.create(e),k=f.UTILITIES.generate_unique_id(),t=d.drag_started,z={},M={},B,G,N,J,K,Q,C,I,O,T,F,D,R;g||(g=["left","top","width","height"]);d.is_element=function(){return!0};d.is_resizable=function(){return!0};
d.get_HTML=function(){return J};d.get_guid=function(){return k};d.get_text=function(){var a,b;return void 0===K&&((a=this.get_frontside_element())?K=a.textContent:(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),K=a.textContent,$(a).remove()):K=b,""===K&&a&&"IMG"!==a.nodeName&&(this.update_display(),K=a.textContent),""===K)?this.get_HTML():K};d.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=
a.indexOf(">",b);if(0>c)break;b+=3;d=a.indexOf("target='_blank'",b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");""===a&&(a="&thinsp;");return a}.bind(this);if(J===a)return!1;this.initialize_element();J=c(a);K=void 0;if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element();b.innerHTML=
J;Q&&this.compute_original_dimensions(!0);return!0};d.set_HTML_from_sub_classes=d.set_HTML;d.set_text=function(a){var b=this.get_frontside_element(),c=function(d){d=$(d).contents();0===d.length?b.textContent=a:d.each(function(){this.nodeType==Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};d.get_style_attributes=function(){return g};d.set_style_attributes=
function(a){g=a};d.get_attribute_widgets_in_backside_table=function(){return z};d.set_attribute_widgets_in_backside_table=function(a){z=a};d.get_original_copies=function(){return M};d.get_pending_css=function(){return F};d.get_transform_css=function(){return D};d.add_to_css=function(a,c){b(a)?(D||(D={}),D[a]=c):(F||(F={}),F[a]=c)};d.apply_css=function(){var a="",b,d,e;if((d=this.get_frontside_element())&&!$(d).is(".toontalk-not-observable"))if(jQuery.contains(window.document,d)){if(this.is_plain_text_element()){F||
(F={});(e=(b=this.get_parent())&&(b.is_nest()||b.is_hole()||b.is_robot()))?(b=this.get_parent().get_contents_dimensions(),O=b.width,T=b.height,this.plain_text_dimensions(O,T)):b=O?{width:O,height:T}:{width:f.UTILITIES.get_element_width(d),height:f.UTILITIES.get_element_height(d)};if(b.width&&e){F["font-size"]=f.UTILITIES.font_size(this.get_text(),b.width,{height:b.height});F.width=b.width;F.height=b.height;F.transform="";$(d).css(F);F=void 0;return}F.width||F.height?F["font-size"]=f.UTILITIES.font_size(this.get_text(),
F.width||b.width,{height:F.height||b.height}):(F["font-size"]="",F.width="",F.height="");if(!D){$(d).css(F);return}}if(F||D)if(F?(F.width&&(O=F.width),F.height&&(T=F.height)):F={},F.position="absolute",D&&("number"===typeof D.rotate&&(a+="rotate("+D.rotate+"deg)"),"number"===typeof D.skewX&&(a+="skewX("+D.skewX+"deg)"),"number"===typeof D.skewY&&(a+="skewY("+D.skewY+"deg)"),"number"===typeof D["transform-origin-x"]||"number"===typeof D["transform-origin-y"])&&(F["transform-origin"]=(D["transform-origin-x"]||
0)+" "+(D["transform-origin-y"]||0)),$(d).is(".toontalk-conditions-contents")&&this.is_image_element())$(d).children("img").css({"max-width":"100%",height:"100%"}),$(d).css({transform:""}),F=void 0;else if(O||T)if(c(this,F),a&&f.UTILITIES.add_transform_to_css(a,"",F,0>d.parentElement.className.indexOf("toontalk-box-hole")),!this.constrained_by_container()&&this.is_plain_text_element())$(d).css(F);else{$(d).css({width:"",height:""});var g=F;f.UTILITIES.run_when_dimensions_known(d,function(b){var e=
this.get_parent_of_frontside();c(this,g);$(d).is(".toontalk-conditions-contents")&&this.directly_inside_conditions_container()&&(O=f.UTILITIES.get_toontalk_css_numeric_attribute("width",".toontalk-conditions-container"),T=f.UTILITIES.get_toontalk_css_numeric_attribute("height",".toontalk-conditions-container"));(this.ok_to_set_dimensions()||this.constrained_by_container())&&f.UTILITIES.scale_element(d,O,T,C,I,a,g,b,!e);F=void 0}.bind(this))}else c(this,F),f.UTILITIES.add_transform_to_css(a,"",F,0>
d.parentElement.className.indexOf("toontalk-box-hole")),$(d).css(F),F=void 0}else f.UTILITIES.when_attached(d,this.apply_css.bind(this))};d.on_update_display=function(a){R?R.push(a):R=[a]};d.fire_on_update_display_handlers=function(){R&&f.UTILITIES.set_timeout(function(){R.forEach(function(a,b){a()||R.splice(b,1)})})};d.is_image_element=function(){return 0<$(this.get_frontside_element()).children("img").length};d.get_additional_classes=function(){return v};d.set_additional_classes=function(a){v=a};
d.get_children=function(){return m};d.get_child=function(a){if(m)return m[a]};d.set_sound_effect=function(a){B=a;B.volume=f.UTILITIES.get_audio_volume(B)};d.get_sound_effect=function(){return B};d.get_video_object=function(){var a;G||(a=this.get_frontside_element())&&(G=a.getElementsByTagName("video")[0]);return G};d.set_video_object=function(a){G=a};d.get_ignore_pointer_events=function(){return r};d.set_ignore_pointer_events=function(a){r=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?
"none":"auto"})};d.get_source_URL=function(){return N};d.set_source_URL=function(a,b){if(N!==a)return N=a,b||this.refresh(),!0};d.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===C?f.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),function(){f.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,C,I,void 0,a)}.bind(this)):f.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,C,I,void 0,a)};
d.add_standard_widget_functionality(d);var V=d.set_running.bind(d);d.set_running=function(a,b){V(a,b);Object.keys(z).forEach(function(c){z[c].set_running(a,b)});!a&&this.visible()&&(g.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());m.forEach(function(c){c.set_running(a,b)})};var aa=d.can_run.bind(d);d.can_run=function(a){var b=a&&a.widgets_considered,c;"undefined"===typeof b&&(b=[]);if(0<=b.indexOf(this))return!1;b.push(this);if(aa(a))return!0;Object.keys(z).some(function(b){if(z[b].can_run(a))return c=
!0}.bind(this));if(c)return c;m.some(function(b){if(b.can_run(a))return c=!0});return c};d.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;t.call(this,a,b)};d.update_display=function(){var a=this.get_frontside_element(!0);this.get_backside();var b=function(a){return this.is_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged&&!$(e).is(".toontalk-has-attached-callback"))if(this.get_erased()){var c=
$(a).parent(".toontalk-backside").is("*")?b="":b="100%";this.save_dimensions();$(a).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:b,height:c,position:"",transform:""});this.inside_conditions_container()?f.UTILITIES.give_tooltip(a,"This is an element that has been erased. It will match any element."):f.UTILITIES.give_tooltip(a,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(a).is(".toontalk-erased-element")&&
($(a).removeClass("toontalk-erased-element"),this.restore_dimensions()),Q||this.initialize_element(),this.is_plain_text_element()&&(this.constrained_by_container()?$(a).css({width:"",height:""}):this.plain_text_dimensions()),"undefined"===typeof C&&a.parentElement&&(this.is_plain_text_element()?this.plain_text_dimensions():this.compute_original_dimensions()),this.apply_css(),m?m.forEach(function(b){try{a.appendChild(b.get_frontside_element(!0))}catch(H){}b.set_visible(!0);b.update_display()}):m=[],
this.fire_on_update_display_handlers(),f.open_backside_only_if_alt_key||f.UTILITIES.give_tooltip(a,"Click to see the backside where you can place robots or change the style of this "+b(a)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};d.initialize_element=function(){var a=this.get_frontside_element(),b;a&&(J=this.get_HTML(),a.innerHTML=J,$(a).addClass("toontalk-element-frontside"),this.is_plain_text_element()?((b=this.get_additional_classes())&&$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element")):
this.is_image_element()?$(a).addClass("toontalk-image-element"):$(a).addClass("toontalk-non-plain-text-element"),Q=!0)};d.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};d.plain_text_dimensions=function(a,b){this.constrained_by_container()||(this.get_frontside_element(),C=a||12*this.get_text().length,I=b||32,this.saved_width=C,this.saved_height=I)};d.compute_original_dimensions=function(a){f.UTILITIES.original_dimensions(this,function(a,b){var c=this.get_parent_of_frontside();
C=a;I=b;c&&c.get_box?c.get_box().rerender():(g.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),a)};d.get_attribute_from_current_css=function(a){if("width"===a&&(O||C))return O||C;if("height"===a&&(T||I))return T||I;var b=this.get_frontside_element(!0);var c=f.UTILITIES.get_style_numeric_property(b,a);""===c&&(c=$(b).css(a));if(!c)return 0;if("number"===typeof c){if(C&&T){if("left"===a)return c+(C-O)/2;if("top"===a)return c+(I-T)/2}return c}return"%"!==
c.charAt(c.length-1)||"left"!==a&&"top"!==a?c:$(b).offset()[a]};d.get_original_width=function(){return C};d.get_original_height=function(){return I};d.increment_width=function(a){this.set_attribute("width",(O||C)+a)};d.increment_height=function(a){this.set_attribute("height",(T||I)+a)};d.get_width=function(){return O};d.get_height=function(){return T};d.add_child=function(a){var b=$(a.get_frontside_element(!0)),c=$(this.get_frontside_element(!0));m.push(a);a.set_parent_of_frontside(this);var d=f.UTILITIES.set_position_relative_to_element(b,
c,b.offset(),!0);a.is_element()&&a.set_location_attributes(d.left,d.top);c.get(0).dispatchEvent(f.UTILITIES.create_event("widget added",{element_widget:b.get(0),where:"front"}));this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)};d.removed_from_container=function(a,b){a=m.indexOf(a);0<=a&&m.splice(a,1)};d.set_HTML(a.toString());d.set_description(h);l&&("string"===typeof l?(0>l.indexOf("http")&&0>l.indexOf("data:")&&(l=f.TOONTALK_URL+l),d.set_sound_effect(new Audio(l))):d.set_sound_effect(l));
w&&("string"===typeof w?d.set_HTML("<video src='"+w+"'/>"):d.set_video_object(w));f.debugging&&(d._debug_id=f.UTILITIES.generate_unique_id(),d._debug_string=d.to_debug_string());m?m.forEach(function(a){a.set_parent_of_frontside(d)}):m=[];return d};e.copy=function(a){var b=this.get_style_attributes(),c=e.create(this.get_HTML(),b.slice(),this.get_description(),f.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),d=this.get_attribute_widgets_in_backside_table(),
g={},h=c.get_backside(this.visible());c.set_source_URL(this.get_source_URL());a&&(a.elements_copied||(a.elements_copied={}),a.elements_copied[this.get_guid()]=c);Object.keys(d).forEach(function(b){g[b]=d[b].copy(a);g[b].set_parent_of_frontside(h,!1,!0);c.set_attribute(b,this.get_attribute(b))}.bind(this));c.set_attribute_widgets_in_backside_table(g);return this.add_to_copy(c,a)};e.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();
this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};e.match_with_any_element=function(){return"matched"};e.match_with_another_element_widget=function(a){if(this.get_HTML()===a.get_HTML())return"matched";var b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};e.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};e.compare_with_other_element=
function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};e.get_path_to=function(a,b){var c=this.get_children(),d=c.indexOf(a),f,g;if(0<=d)return e.path.create(d);c.forEach(function(c,d){c.get_path_to&&(g=c.get_path_to(a,b))&&(f=e.path.create(d),f.next=g)});return f};f.creators_from_json.element_path=function(a,b){var c=e.path.create(a.index);a.next&&(c.next=f.UTILITIES.create_from_json(a.next,b));return c};e.dereference_path=function(a,b){if(a){var c=a.get_index&&a.get_index();
if(!f.debugging||"number"===typeof c){var d=this.get_children();if(c=d[c]){if(c.dereference_contents&&!a.not_to_be_dereferenced)return c.dereference_contents(a.next||a,b);if(a.next){if(c.dereference_path)return c.dereference_path(a.next,b);f.UTILITIES.report_internal_error("Expected to refer to a child of "+c+" but it lacks a method to obtain "+f.path.toString(a.next))}a.removing_widget&&(c.get_infinite_stack()||b.remove_from_container(c,this));return c}}f.UTILITIES.display_message(this+" unable to dereference the path: "+
f.path.toString(a),{only_if_new:!0})}else return this};e.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+f.UTILITIES.ordinal(a)+" widget "},get_json:function(b,c,d,e){c({type:"element_path",index:a,next:this.next&&this.next.get_json(b)},d,e+1)}}}};e.widget_side_dropped_on_me=function(a,b){if(a.is_backside())return!1;this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};
e.create_backside=function(){return f.element_backside.create(this)};e.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};e.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a);if("left"===a){var c=this.get_frontside_element();c=f.UTILITIES.translate_x(c)}else"top"===a?(c=this.get_frontside_element(),c=f.UTILITIES.translate_y(c)):c=0;return"undefined"!==typeof b&&"auto"!=b?b+c:this.get_attribute_from_current_css(a)+
c};e.set_attribute=function(b,c,e,g){var d=this.get_frontside(!0).get_element(),h=function(a){var c=this.get_original_copies()[b];c&&c.forEach(function(b){b.set_value_from_sub_classes(bigrat.fromDecimal(a))})}.bind(this);if(!d)return!1;var k="left"===b?f.UTILITIES.translate_x(d):"top"===b?f.UTILITIES.translate_y(d):0;d=this.get_attribute_from_pending_css(b);c-=k;if(d===c||"undefined"===typeof d&&(d=this.get_attribute_from_current_css(b),d===c))return!1;k=a(c,b);if("number"===typeof k){if(d==k)return!1;
f.logging&&0<=f.logging.indexOf("attribute:")&&0<=f.logging.indexOf(b)&&console.log("Attribute "+b+" set to "+k+" was "+d+" at "+Date.now()+" for "+this);c=k;"left"!==b&&"top"!==b||h(c)}e&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:b,argument_2:c,toString:"change the '"+b+"' style to "+c+" of",button_selector:".toontalk-element-"+b+"-attribute-input"});this.constrained_by_container()||(this.add_to_css(b,c),g&&(c=this.get_style_attributes(),
0>c.indexOf(b)&&c.push(b)),this.rerender());return!0};e.dropped_on_style_attribute=function(a,b,c){if(a){var d=a.toString();if(a.is_number()){var e=this.get_attribute(b);if("number"===typeof e)var f=e;else if("auto"===e)switch(b){case "left":f=$(this.get_frontside_element()).offset().left;break;case "top":f=$(this.get_frontside_element()).offset().top;break;default:f=0}else f=parseFloat(e);e=a.to_float();switch(d.substring(0,1)){case "-":d=f-e;break;case "*":d=f*e;break;case "/":d=f/e;break;case "^":d=
Math.pow(f,e);break;default:d=f+e}this.set_attribute(b,d,!1);(c.event||c.robot&&c.robot.visible())&&this.get_backside().render()}a.get_infinite_stack()||a.remove();c.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};e.get_attribute_widget_in_backside_table=function(a,b,c){var d=this.get_attribute_widgets_in_backside_table()[a];d||b||(d=this.create_attribute_widget(a,c),this.get_attribute_widgets_in_backside_table()[a]=d);return d};e.create_attribute_widget=
function(a,b){var d=".toontalk-element-"+a+"-attribute-input",e=this.get_backside_element();b=this.get_attribute(a);var k=this,w=function(a,b){var d=b.toString,e=b.equals,g=b.remove;y=b.update_display;b.element_widget=this;b.attribute=a;b.get_type_name=function(a){return a?"element attributes":"element attribute"};b.toString=function(){return d.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};b.get_default_description=function(){return"a number that is the "+this.attribute+" of "+
this.get_attribute_owner().toString({plain_text:!0})+"."};b.get_custom_title_prefix=function(){return"I'm the '"+this.attribute+"' attribute of "+this.get_attribute_owner().toString({inside_tool_tip:!0})+" \nDrop a number on me or edit my backside to change my value. My backside has an info button to learn more."};b.equals=function(b){return a===b.attribute?this.equals(b.element_widget):e.call(this,b)};b.update_display=function(){if(!this.get_erased()){var a=this.get_attribute_owner();if(a.get_parent_of_frontside()&&
a.get_parent_of_frontside().is_element()&&!a.being_dragged&&!a.constrained_by_container()){var b={};var d=bigrat.toDecimal(this.get_value());b[this.attribute]=d;c(a,b)&&this.set_value(b[this.attribute]);$(a.get_frontside_element()).css(b)}else a=a.get_attribute(this.attribute),isNaN(a)||M(a)}y.call(this)};u=b.copy.bind(b);b.copy=function(b){var c;if(b){if(b.just_value)return u(b);b.elements_copied&&(c=b.elements_copied[k.get_guid()])}return this.add_to_copy((c||k).create_attribute_widget(a),b)};b.get_json=
function(b,c,d,e){f.UTILITIES.get_json(k,b,function(b,d,e){c({type:"attribute_widget",attribute_name:a,element:b},d,e+1)},d,e+1)};b.get_original_attribute_widget=function(){var b=k.get_original_copies()[a];return b&&b[0]};b.is_attribute_widget_copy=function(b){var c=k.get_original_copies()[a];return c&&0<=c.indexOf(b)};b.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside())return b.is_backside()?b:b.is_nest()?void 0:a(b.get_widget())},b;var c=a(this);if(!c)return(c=this.get_original_attribute_widget())&&
c!==this?c.get_attribute_owner():k;if(!c.get_widget().is_element())return k;c=c.get_widget();for(b=c.get_parent_of_backside();b&&b.get_widget().is_element();)c=b.get_widget(),b=c.get_parent_of_backside();return c};b.remove=function(b,c){var d=k.get_original_copies()[a],e=d&&d.indexOf(this);0<=e&&d.splice(e,1);g.call(this,b,c)};b.get_help_URL=function(){return h(a)}}.bind(this),r=function(a,b){var c=f.number.create(0,1);w(a,c);c.set_value_from_decimal(b);c.set_format("decimal");c.set_value=function(b){try{var c=
k.get_original_copies()[a],d="number"===typeof b?b:bigrat.toDecimal(b),e=bigrat.fromDecimal(d);this.get_attribute_owner().set_attribute(this.attribute,d)&&c.forEach(function(a,b){a.set_value_from_sub_classes(e,!0)});return this.set_value_from_sub_classes(e,!1)}catch(O){return f.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+O),!1}};c.is_attribute_widget=function(){return!0};c.get_function_type=function(a){return a?"numbers":"number"};return c}.bind(this),
v=function(a,b){b=f.element.create(b);w(a,b);b.set_HTML=function(b){var c=k.get_original_copies()[a],d;this.get_attribute_owner().set_attribute(this.attribute,b)&&c.forEach(function(a,c){d=a.set_HTML_from_sub_classes(b)});return d};b.get_function_type=function(a){return a?"elements":"element"};b.set_additional_classes("toontalk-string-attribute-widget");return b}.bind(this);var n=0<=["background-color","color"].indexOf(a)?"string":"number";var u,y;e&&(d=$(e).find(d),0<d.length&&(d.get(0).toontalk_widget_side=
this));if("number"===n){var z=r(a,b);var M=z.set_value_from_decimal.bind(z);if(0<=g.indexOf(a)&&(this.on_update_display(function(){z.rerender();return!0}),"left"===a||"top"===a)){var B=function(b){if(b.currentTarget.toontalk_widget_side===z.get_attribute_owner()){var c=z.get_attribute_owner();b.stopPropagation();var d=$(c.get_frontside_element()).closest(".toontalk-backside-of-top-level").offset();d||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),
d={left:0,top:0});var e=b.pageX-d.left-(c.drag_x_offset||0);d=b.pageY-d.top-(c.drag_y_offset||0);"left"===a?(b=e,c.set_attribute("top",d)):(b=d,c.set_attribute("left",e));z.set_value_from_decimal(b);y.call(z)}};z.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",B);b&&b.get_widget().is_element()&&b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",B)})}}else if("string"===n)z=v(a,b),M=
z.set_HTML.bind(z);else{f.UTILITIES.report_internal_error("Unrecognized attribute type: "+n+" for "+a);return}(b=this.get_original_copies()[a])?b.push(z):this.get_original_copies()[a]=[z];return z};f.creators_from_json.attribute_widget=function(a,b){if(a)return f.UTILITIES.create_from_json(a.element,b).create_attribute_widget(a.attribute_name,b)};f.creators_from_json.attribute_number=f.creators_from_json.attribute_widget;e.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=
this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};e.toString=function(a){if(this.get_erased())return"any element";var b=function(b){var c="",d=function(a,b,c){var d=b.indexOf(a+"="),e;if(0<=d){var f=b.indexOf("'",d);0<=f&&(e=b.indexOf("'",f+1));if(0<=e)return b.substring(0,d)+a+"="+c+b.substring(e+1)}d=b.indexOf(" ");return b.substring(0,d+1)+a+"="+c+" "+b.substring(d+1)};if(1<b.length&&"<"===b.charAt(0)){if(0===b.indexOf("<img "))return"<img width='60' height='40' "+
b.substring(4);if(this.is_image_element())c="style='width: 60px; height: 40px;'";else if(0<=b.indexOf("<iframe "))return b.indexOf("<iframe "),d("width",d("height",b,"'60'"),"'80'");a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'");return"<div "+c+">"+b+"</div>"}return'"'+b+'"'}.bind(this);var c=function(){var a=this.get_HTML(),b=a.indexOf("alt=");if(0<=b){var c=a.indexOf("'",b+5);if(0<=c)return"("+a.substring(b+5,c)+")"}return""}.bind(this);var d=this.get_children();if(a&&!a.inside_tool_tip&&
"conditions"!==a.role){if(a.for_json_div)return"";b=c();b||(b=(b=this.get_source_URL())?"whose text is the contents of "+b:(b=this.get_text())?'"'+b+'"':"")}else b=b(this.get_HTML());d&&0<d.length&&(b+=" with "+f.UTILITIES.describe_widgets(d)+" on top");return"the element "+b};e.get_type_name=function(a){return a?"elements":"element"};e.get_help_URL=function(){return"docs/manual/elements.html"};e.get_json=function(a,b,c,e){var d=this.get_style_attributes(),g=f.UTILITIES.remove_z_index(this.get_HTML()),
h=encodeURIComponent(g),k=[];if(100<=g.length){a.shared_html||(a.shared_html=[]);g=a.shared_html.indexOf(h);0>g&&(g=a.shared_html.push(f.UTILITIES.string_to_array(h,100))-1);var m={shared_html_index:g}}else m=f.UTILITIES.string_to_array(h,100);h=function(){var g=[],h=function(l){var n=function(){h(l+1)},r;if(l>=d.length)b({type:"element",html:m,attributes:d,attribute_values:d.map(this.get_attribute.bind(this)),attributes_backsides:g,additional_classes:this.get_additional_classes(),children:0<this.get_children().length&&
k,sound_effect:this.get_sound_effect()&&f.UTILITIES.string_to_array(this.get_sound_effect().src,100),video:this.get_video_object()&&f.UTILITIES.string_to_array(this.get_video_object().src,100),ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()},c,e+1,a);else if(r=this.get_attribute_widget_in_backside_table(d[l],!0)){var v=[];g.push(v);f.UTILITIES.get_json_of_array(r.get_backside_widgets(),v,0,a,n,c,e+1)}else g.push(null),n()}.bind(this);h(0)}.bind(this);
0<this.get_children().length?f.UTILITIES.get_json_of_array(this.get_children(),k,0,a,h,c,e+1):h()};f.creators_from_json.element=function(b,c){if(b){Array.isArray(b.html)&&(b.html=b.html.join(""));var d=decodeURIComponent("string"===typeof b.html?b.html:c.shared_html&&c.shared_html[b.html.shared_html_index]);if(b.children){var g=c.is_child;c.is_child=!0;var h=f.UTILITIES.create_array_from_json(b.children,c);c.is_child=g}if(void 0===d&&(d="string"===typeof b.html?"No json.html recreating an element widget.":
"additional_info.shared_html missing while recreating an element widget.",!f.debugging))throw Error(d);b.sound_effect&&Array.isArray(b.sound_effect)&&(b.sound_effect=b.sound_effect.join(""));b.video&&Array.isArray(b.video)&&(b.video=b.video.join(""));var k=e.create(d,b.attributes,b.description,h,b.sound_effect,b.video,b.ignore_pointer_events);var r=c&&c.event?["left","top"]:[];b.attribute_values.forEach(function(d,e){var g=b.attributes[e];e=b.attributes_backsides&&b.attributes_backsides[e];(c.is_child||
0>r.indexOf(g))&&(0!==d||"width"!==g&&"height"!==g)&&k.add_to_css(g,a(d)||d);e&&(d=k.get_attribute_widget_in_backside_table(g,!1,c),f.UTILITIES.add_backside_widgets_from_json(d,e,c))}.bind(this));b.additional_classes&&k.set_additional_classes(b.additional_classes);b.source_URL&&(k.set_source_URL(b.source_URL),k.refresh());h&&f.UTILITIES.when_attached(function(){h.forEach(function(a,c){(c=b.children[c]&&b.children[c].widget&&b.children[c].widget.view)&&f.UTILITIES.set_css(a.get_frontside_element(!0),
{left:c.frontside_left,top:c.frontside_top})})});return k}};e.create_attribute_path=function(a,b){b=f.path.get_path_to(a.element_widget,b,!0);return this.extend_attribute_path(b,a.attribute)};e.refresh=function(){this.get_source_URL()&&f.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};e.extend_attribute_path=function(a,b){return{dereference_path:function(c){return(c=a.dereference_path(c,c.get_top_level_context()||c.get_context()))&&c.get_widget().get_attribute_widget_in_backside_table(b)},
toString:function(){return"the '"+b+"' property of "+f.path.toString(a)},get_json:function(c,d,e,g){f.path.get_json(a,c,function(a,c,e){d({type:"path_to_style_attribute",attribute:b,element_widget_path:a},c,e+1)},e,g+1)}}};f.creators_from_json.path_to_style_attribute=function(a,b){b=f.UTILITIES.create_from_json(a.element_widget_path,b);return e.extend_attribute_path(b,a.attribute)};e.set_size_attributes=function(a,b,c){c?(this.add_to_css("width",a),this.add_to_css("height",b)):(this.set_attribute("width",
a),this.set_attribute("height",b));f.UTILITIES.set_timeout(function(){this.rerender();$(this.get_frontside_element()).find("iframe").attr("width",a).attr("height",b-20)}.bind(this))};e.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};e.receive_HTML_from_dropped=function(a){var b=a.get_text&&a.get_text();a.remove();if(this.set_HTML(b))return this.get_text()};e.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};
e.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):"top"===a&&(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));
return!0};e.remove_style_attribute=function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return e}(window.TOONTALK);window.TOONTALK.element_backside=function(b){var f=function(a,c,d){if(d.visible()){var e=c.get_style_attributes();c.get_frontside_element();$(a).empty();e.forEach(function(e){c.get_attribute(e);var f=document.createElement("tr"),g=document.createElement("td"),h=d.is_primary_backside()?c.get_attribute_widget_in_backside_table(e):
d.get_widget().create_attribute_widget(e),k=h.get_frontside_element(!0);h.set_parent_of_frontside(d,!1,!0);h.set_infinite_stack(!0);a.appendChild(f);f.appendChild(g);g.appendChild(b.UTILITIES.create_text_element(e));g=document.createElement("td");f.appendChild(g);h.set_visible(!0);$(k).addClass("toontalk-element-attribute");g.appendChild(k)})}},e=function(a,c){var d=$("<button>Add or remove my style attributes</button>").button();d.addClass("toontalk-show-attributes-chooser-button");d.get(0).addEventListener("click",
function(e){b.UTILITIES.visible_element(a)?($(a).hide(),d.button("option","label","Add or remove my style attributes"),b.UTILITIES.give_tooltip(d.get(0),"Click to add widgets for my style attributes.")):($(a).show(),d.button("option","label","Hide my style attributes list"),b.UTILITIES.give_tooltip(d.get(0),"Click to hide my list of attributes that can be added or removed."));c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",c)});b.UTILITIES.give_tooltip(d.get(0),
"Click to add widgets for my style attributes.");return d.get(0)};return{create:function(a){var c=b.backside.create(a),d=c.get_element();a.get_HTML();var g=document.createElement("table"),t=document.createElement("div"),m=e(t,a),l=b.backside.create_advanced_settings_button(c,a),w=b.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),
r=b.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),v=r?"get_HTML":"get_text",n=c.update_display.bind(c),u=c.add_advanced_settings,y;a.initialize_element();var z=a[v]().trim();if(0<z.length&&!a.is_image_element()){var M=function(c){(c=b.UTILITIES.input_area_drop_handler(c,a.receive_HTML_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(c,a,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})};
var B=b.UTILITIES.create_text_area(z,"toontalk-html-input","My HTML is","Type here to edit the text.",M,void 0,!0);z=function(b){b=B.button.value.trim().replace(/\xA0/g," ");a.get_frontside_element();var c=r?"set_HTML":"set_text";a[c](b)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:c,argument_1:b,toString:'change the text to "'+b+'"',button_selector:".toontalk-html-input"})};$(B.container).css({width:"100%"});M=60>=B.button.value.length?2:600>B.button.value.length?Math.ceil(B.button.value.length/
60):10;$(B.button).css({width:"95%",height:M+"em"});B.button.addEventListener("change",z);B.button.addEventListener("mouseout",z);a.is_plain_text_element()&&d.appendChild(B.container);if(a.get_source_URL()){M=function(c){var d=b.UTILITIES.input_area_drop_handler(c,a.receive_URL_from_dropped.bind(a),a);d&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(d,a,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});c.stopPropagation()};
z=function(b){b=G.button.value.trim().replace(/\xA0/g," ");a.get_frontside_element();a.set_source_URL(b)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_source_URL",argument_1:b,toString:'change the source URL to "'+b+'"',button_selector:".toontalk-URL-input"})};var G=b.UTILITIES.create_text_input(a.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,M);G.button.addEventListener("change",z);G.button.addEventListener("mouseout",
z);d.appendChild(G.container)}}c.update_style_attribute_chooser=function(){var c=function(a,c,d){var e=0<=d.get_style_attributes().indexOf(a),k=b.UTILITIES.create_check_box(e,"toontalk-style-attribute-check-box",a+"&nbsp;","Click to add or remove the '"+a+"' style attribute from my backside."),m="toontalk-style-attribute-check-box-for-"+a;e=b.UTILITIES.create_anchor_element("i",h(a));var l=document.createElement("li"),n=function(b){k.button.checked?d.add_style_attribute(a):d.remove_style_attribute(a);
f(g,d,d.get_backside());d.robot_in_training()&&d.robot_in_training().edited(d,{setter_name:k.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:a,toString:(k.button.checked?"add":"remove")+" a widget for the "+a+" attribute of",button_selector:"."+m})};$(e).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(e).css({color:"white"});e.translate=!1;e.lang="en";k.container.appendChild(e);$(k.button).addClass(m);k.button.addEventListener("click",n);k.button.addEventListener("touchstart",
function(a){k.button.checked=!k.button.checked;n(a)});l.appendChild(k.container);c.appendChild(l)},d=function(a,b,e){if("string"===typeof a)c(a,b,e);else if(a.label){var f=document.createElement("h3");f.textContent=a.label;var g=document.createElement("ul");b.appendChild(f);b.appendChild(g);d(a.sub_menus,g,e)}else a.forEach(function(a){d(a,b,e)})};$(t).is(".ui-accordion")&&$(t).accordion("destroy");$(t).empty();d([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},
{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],t,a);$(t).accordion({active:0,heightStyle:"content"});return t};c.get_attributes_chooser=function(){return t};c.add_advanced_settings=function(){u.call(c);var b=$(d).children(".toontalk-advanced-settings-table");
0<b.length&&(b.get(0).appendChild(w.container),b.get(0).appendChild(t),b.get(0).appendChild(m),B&&!a.is_plain_text_element()&&b.get(0).appendChild(B.container))};if(y=a.get_sound_effect()){var N=function(){c.visible()&&(y.paused?(b.UTILITIES.give_tooltip(J.get(0),"Click to begin playing this sound."),J.button("option","label","Play sound")):(b.UTILITIES.give_tooltip(J.get(0),"Click to pause this sound."),J.button("option","label","Pause sound")))};var J=$("<button>Play sound</button>").button();J.addClass("toontalk-play-sound-effect-button");
z=function(c){y.paused?(b.UTILITIES.play_audio(y),y.addEventListener("ended",N)):y.pause();N();a.robot_in_training()&&a.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",a)};J.get(0).addEventListener("click",z);N();d.appendChild(J.get(0))}else if(a.get_video_object()){var K=a.get_video_object();var Q=function(a){c.visible()&&(K.paused?(b.UTILITIES.give_tooltip(C.get(0),"Click to begin playing this video."),C.button("option","label","Play video")):(b.UTILITIES.give_tooltip(C.get(0),
"Click to pause this video."),C.button("option","label","Pause video")))};var C=$("<button>Play video</button>").button();C.addClass("toontalk-play-video-button");z=function(b){K.paused?(K.play(),K.addEventListener("ended",Q)):K.pause();Q();a.robot_in_training()&&a.robot_in_training().button_clicked(".toontalk-play-video-button",a)};C.get(0).addEventListener("click",z);Q();d.appendChild(C.get(0))}c.update_style_attribute_chooser();f(g,a,c);0<a.get_style_attributes().length?d.appendChild(g):a.is_plain_text_element()||
d.appendChild(b.UTILITIES.create_text_element("No attributes enabled. Click the <span class='toontalk-button-style'>></span> button to see the advanced options."));d.appendChild(l);$(t).hide();$(t).addClass("toontalk-attributes-chooser");c.update_display=function(){B&&$(B.button).val(a[v]());f(g,a,c);b.UTILITIES.visible_element(t)&&c.update_style_attribute_chooser();a.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});n()};$(d).find(".toontalk-hide-backside-button").each(function(a,
b){b.addEventListener("click",function(){$(t).hide()})});w.button.checked=!a.get_ignore_pointer_events();w.button.addEventListener("click",function(){a.set_ignore_pointer_events(!w.button.checked)});w.button.addEventListener("touchstart",function(){w.button.checked=!w.button.checked;a.set_ignore_pointer_events(!w.button.checked)});return c}}}(window.TOONTALK);window.TOONTALK.element.function=function(b){var f=b.create_function_table(),e=function(a){return a?b.UTILITIES.add_a_or_an(a.get_type_name()):
"an empty hole"};f.add_function_object("join text",function(a,c){var d="";return f.typed_bird_function(a,function(){var a=arguments[arguments.length-1];for(i=0;i<arguments.length-1;i++){if(!arguments[i]||!arguments[i].get_text){f.report_error("The 'join text' bird is unable to turn "+e(arguments[i])+" into text to join.",a);return}d+=arguments[i].get_text()}return b.element.create(d)},[void 0],"join",c)},"The bird will return with a new element that is made by joining all the elements and numbers.",
"join",["any number of numbers or elements"]);f.add_function_object("part of text",function(a,c){return f.typed_bird_function(a,function(a,c,e,g){if(c&&c.to_float)return c=Math.round(c.to_float()-1),e=e&&e.to_float&&Math.round(e.to_float()-1),b.element.create(a.get_text().substring(c,e));f.report_error("The 'part of text' bird is unable to find the text in the second hole. ",g||e)},["element","number","number"],"part of text",c,2,3)},"The bird will return with a new element whose text is the part of the text of the first element (or number) beginning with the first number ending with the second number. 1 is for the first letter.",
"part",["an element followed by two postive numbers"]);f.add_function_object("length of text",function(a,c){return f.typed_bird_function(a,function(a,c){if(a.get_text)return b.number.create(a.get_text().length);f.report_error("The 'length of text' bird could not turn "+e(a)+" into a text to find its length.",c)},[void 0],"length of text",c,1)},"The bird will return with a number that is length of the text of the first element (or number).","length",["an element or number"]);f.add_function_object("text as number",
function(a,c){return f.typed_bird_function(a,function(a,c){if(a&&a.get_text)return a=a.get_text(),c=a.indexOf("/"),0<=c?c=b.number.create(a.substring(0,c),a.substring(c+1,a.length)):(c=b.number.create(0),c.set_value_from_decimal(a)),c;f.report_error("The 'text as number' bird could not turn "+e(a)+" into a text to turn it into a number.",c)},[void 0],"text as number",c,1,1)},"The bird will return with a number that has the same text as the element. Arithmetic can be done on the result unlike the original text.",
"text as number",["an element"]);f.add_function_object("read page",function(a,c){return f.typed_bird_function(a,function(d,g){if(d.get_text){var h=d.get_text();b.UTILITIES.download_file(h,function(d){null===d&&(d="Unable to read "+h);d=b.element.create(d,[],"what was in "+h);f.process_response(d,g,a,c)})}else f.report_error("The 'read page' bird could not turn "+e(d)+" into a text to use it as a URL.",g)},["element"],"read page",c,1,1)},"The bird will return with the contents of the URL.","read URL",
["an element containing a URL"]);f.add_function_object("go to page",function(a,b){return f.typed_bird_function(a,function(a,b){this.robot_in_training()?this.robot_in_training().display_message("Robot trained to replace current URL."):a.get_text?window.location.assign(a.get_text()):f.report_error("The 'go to page' bird could not turn "+e(a)+" into a text to use it as a URL.",b)},["element"],"replace page",b,1,1)},"The bird will cause the current page to be replaced by the new URL. The back button should return to the current page.",
"page",["an element containing a URL"]);f.add_function_object("speak",b.widget.get_speak_function(f),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number, and language</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.","speak",["a widget"]);f.add_function_object("listen",b.widget.get_listen_function(f),
"The bird will cause the browser to listen to the next thing said and give the words to the bird in the first hole. If you put a number between 0 and 1 in the second hole then only recognitions with at least that confidence will be considered. if you put in the third hole words or phrases separted by | then the recogniser will expect one of those words or phrases.","listen",[]);f.add_function_object("show message",function(a,c){return f.typed_bird_function(a,function(a,c,e,f,g){var d=c&&c.to_float?
{duration:1E3*c.to_float()}:{duration:1E4};d.user_initiated=!0;if(this.robot_in_training())this.robot_in_training().display_message("Robot trained to display: "+a.get_text(),d);else if(a.is_plain_text_element())b.UTILITIES.display_message(a.get_text(),d);else{var h=a.get_frontside_element();a.is_resizable()&&(a.remove({do_not_remove_children:!0}),c=e?e.to_float():240,f=f?f.to_float():80,b.UTILITIES.set_css(h,{width:c,height:f,left:-1E3,top:-1E3}),a.set_size_attributes&&a.set_size_attributes(c,f),
document.body.appendChild(h));a.update_display();setTimeout(function(){$(h).css({left:"",top:""});b.UTILITIES.display_message(h.outerHTML,d);$(h).remove()},1E3)}},[void 0,"number","number","number"],"show message",c,1,4)},"The bird will cause what is in the second box hole to be displayed. The third hole can be a number indicating how many seconds the message should be displayed. The 4th and 5th hole can contain the width and height.","display",["a widget","number"]);return f.get_function_table()}(window.TOONTALK)})();window.TOONTALK.sensor=function(b){var h=Object.create(b.widget),f=function(b,e){"element"===b.get_type_name()&&(b.set_additional_classes("toontalk-string-value-from-sensor"),e.visible()&&b.rerender())};h.create=function(g,e,a,c,d,h,t){var k=b.nest.create(a,c,"sensor",void 0,void 0,t||"sensor"),l=k.get_json,w=k.update_display,r=k.set_running,v=k.copy,n=e.split(" "),u=function(a){switch(typeof a){case "number":a=b.number.create(Math.round(a),1);break;case "string":a=b.element.create(a,void 0,void 0,
void 0,void 0,void 0,"toontalk-string-value-from-sensor");f(a,k);break;case "boolean":a=b.element.create(a.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor"),f(a,k)}return a},y=function(a){if(k.get_active()){var c=M(a);var d=k.get_attributes();var e=k.visible();a=$(k.get_frontside_element()).closest(".toontalk-backside-of-top-level");if(1===c.length){if(c=u(c[0]),"undefined"===typeof c)return}else c=b.box.create(c.length,!0,c.map(u),"the values of the "+b.UTILITIES.conjunction(d)+
" attributes of "+b.UTILITIES.add_a_or_an(g)+" event.",d.join(";"));e?(e=b.bird.create(k),k.add_to_top_level_backside(e),c.render(),e.animate_delivery_to(c,k,{nest_recieving_message:k,temporary_bird:!0,starting_left:a.width()/2,starting_top:a.height()})):k.add_to_contents(c)}}.bind(this);k.is_sensor=function(){return!0};k.copy=function(c){if(c&&c.just_value&&this.has_contents())return v.call(this,c);var e=c?b.sensor.create(g,this.get_attributes_string(),a,void 0,c.copying_resource||d,h,this.get_name()):
b.sensor.create(g,this.get_attributes_string(),a,void 0,d,h,this.get_name());e=k.add_to_copy(e,c);e.set_active(this.get_active());return e};k.get_json=function(a,c,e,f){var k=function(e,f,k){e.type="sensor";e.event_name=g;e.attribute=this.get_attributes_string();e.active=d;if(h){var l=function(a){e.sensor_of=a;c(e,f,k+1)};b.UTILITIES.get_json(h,a,l,f,k+1)}else c(e,f,k+1)}.bind(this);l.call(this,a,k,e,f+1)};k.update_display=function(){var a=$(this.get_frontside_element());w.call(this);d||a.is(".toontalk-top-level-resource")?
(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):(a.addClass("toontalk-sensor-inactive-nest"),a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};k.get_type_name=function(a){return a?"sensors":"sensor"};k.get_help_URL=function(){return"docs/manual/sensors.html"};k.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+g+" events"};k.get_class_name_with_color=function(a){return a};k.get_active=
function(){return!0===d};k.restore_active=function(){"temporarily false"===d&&this.set_active(!0)};k.set_active=function(a,b){if(d!==a||b)!0===a?h?h.get_frontside_element(!0).addEventListener(g,y):window.addEventListener(g,y):h?h.get_frontside_element(!0).removeEventListener(g,y):window.removeEventListener(g,y),d=a};k.set_running=function(a){this.set_active(a);r.call(this,a)};k.set_active(d,!0);k.create_backside=function(){return b.sensor_backside.create(this)};k.get_event_name=function(){return g};
k.set_event_name=function(a){var b=d;g&&d&&this.set_active(!1);g=a;b&&this.set_active(!0)};k.get_attributes=function(){return n};k.set_attributes=function(a){n=a.split(" ")};k.get_attributes_string=function(){return n.join(" ")};k.match=function(a){this.last_match=a;return this};k.set_sensor_of=function(a){h=a};k.get_custom_title_prefix=function(){var a="When a '"+g+"' event"+(h?" to "+h:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";d?this.get_backside()||
(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the green flag <span class='toontalk-green-flag-icon'></span> is clicked or the 'Listening to events' check box on my back is ticked.";return a};k.get_default_description=function(){return h?"a sensor for "+h.get_default_description():"a sensor for this document."};var z=k.can_run;k.can_run=function(a){return!(a&&a.robots_only)||z.call(this,a)};var M=function(a){return k.get_attributes().map(function(c){var d=
a[c];if("key"===c&&void 0===d){if((d=a.keyIdentifier)&&0===d.indexOf("U+"))return String.fromCharCode(a.keyCode)}else if("undefined"===typeof d){if(a.detail&&a.detail.element_widget&&("widget"===c||"back"===c))return c=b.UTILITIES.widget_side_of_element(a.detail.element_widget).create_backside(),c.save_dimensions(),c;if(a.detail&&a.detail.element_widget&&"front"===c)return b.UTILITIES.widget_side_of_element(a.detail.element_widget);if(a.detail&&void 0!==a.detail[c])return"value changed"===a.type?
b.number.create_from_bigrat(a.detail[c]):a.detail[c];d="No such attribute for "+k;k.display_message(d,{display_on_backside_if_possible:!0})}return d})};return k};b.creators_from_json.sensor=function(g,e){if(g){var a=b.sensor.create(g.event_name,g.attribute,g.description,[],!1,void 0,g.name),c;g.sensor_of?b.UTILITIES.set_timeout(function(){a.set_sensor_of(b.UTILITIES.create_from_json(g.sensor_of,e));a.set_active(g.active)}):a.set_active(g.active);0<g.contents.length&&setTimeout(function(){c=b.UTILITIES.create_array_from_json(g.contents,
e);a.set_contents(c);c.forEach(function(b){f(b.get_widget(),a)});a.rerender()},500);return a}};return h}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(b){return{create:function(h){var f=b.UTILITIES.create_text_input(h.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+h.get_event_name()),g=b.UTILITIES.create_text_input(h.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
e=b.UTILITIES.create_check_box(h.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),a=b.nest_backside.create(h),c=a.get_element(),d=function(){h.set_event_name(f.button.value.trim())},k=function(){h.set_attributes(g.button.value.trim())},t=b.backside.create_advanced_settings_button(a,h),m=function(a){var b=e.button.checked;h.set_active(b);h.robot_in_training()&&h.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:b,toString:"change to "+(b?"active":"inactive")+" of the "+h,button_selector:".toontalk-sensor-active-check-box"});h.render();a.stopPropagation()},l=a.add_advanced_settings;c.appendChild(t);a.add_advanced_settings=function(){f.button.addEventListener("change",d);g.button.addEventListener("change",k);e.button.addEventListener("click",m);l.call(a,f.container,g.container);var b=$(c).children(".toontalk-advanced-settings-table");0<b.length&&b.get(0).appendChild(e.container)};return a}}}(window.TOONTALK);window.TOONTALK.tool=function(b){document.addEventListener("mousemove",function(f){b.tool.pageX=f.pageX;b.tool.pageY=f.pageY});var h,f;return{get_widget_side_under_tool:function(){return h},set_last_event_type:function(b){f=b},add_listeners:function(g,e){var a,c,d,k,t,m=function(h){var l=g.getBoundingClientRect();f=void 0;e.set_held&&e.set_held(!0);k=l.height;h&&h.preventDefault();setTimeout(function(){e.held&&!e.held()||$(g).addClass("toontalk-tool-held")},200);a=$(g).offset();document.addEventListener("mousemove",
w);document.addEventListener("touchmove",w);document.addEventListener("mouseup",r);document.addEventListener("touchend",r);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_down at "+Date.now());d=c=0;$(".ui-tooltip").each(function(){$(this).hide()})},l=function(a){var f=g.getBoundingClientRect();e.held&&e.held()||m(a);c=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",a)-f.left;d=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",a)-f.top},w=function(a){h=
b.UTILITIES.find_widget_side_on_page(a,g,c,d-k/2);a.preventDefault();h&&h.is_of_type("empty hole")&&(h=h.get_parent_of_frontside());$(".ui-tooltip").each(function(){$(this).hide()});var e=v(a);var f=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",a)-e.deltaX-c;a=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",a)-e.deltaY-d;g.style.left=f+"px";g.style.top=a+"px";b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_move at "+Date.now()+" now at "+g.style.left+
", "+g.style.top);if(h&&h.get_widget().is_top_level())t&&(b.UTILITIES.remove_highlight(),t=void 0);else{if(h){var l=h.get_element();if(l===t)return}t=l;b.UTILITIES.highlight_element(t)}},r=function(a){var e=b.UTILITIES.find_widget_side_on_page(a,g,c,d-k/2);a.preventDefault();n(g.toontalk_tool,e,a)}.bind(this),v=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,deltaY:c}},
n=function(c,d,e){d&&d.is_of_type("empty hole")&&(d=d.get_parent_of_frontside());t&&b.UTILITIES.remove_highlight();if(d&&d.top_level_widget&&(void 0===f||f===e.type)){var h=d.top_level_widget();c.apply_tool(d,e);f=e.type;h.backup_all()}!d&&c.nothing_under_tool&&c.nothing_under_tool();c.set_held&&c.set_held(!1);$(g).removeClass("toontalk-tool-held");$(g).addClass("toontalk-tool-returning");b.UTILITIES.add_one_shot_event_handler(g,"transitionend",1E3,function(){$(g).removeClass("toontalk-tool-returning")});
a&&b.UTILITIES.set_timeout(function(){g.style.left=a.left+"px";g.style.top=a.top+"px"});document.removeEventListener("mousemove",w);document.removeEventListener("touchmove",w);document.removeEventListener("mouseup",r);document.removeEventListener("touchend",r);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_up at "+Date.now(),alert(b.debugging),b.debugging="touch")};g.addEventListener("mousedown",l);g.addEventListener("touchstart",l);return m}}}(window.TOONTALK);window.TOONTALK.vacuum=function(b){var h=Object.create(null),f={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},g={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},e={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},a=!1,c;h.create=function(){var d,k,t,m=[],l=function(a,c){t!==a&&(t=a,!c&&b.sounds&&b.sounds.click.play(),$(d).removeClass(k),
k=g[t],$(d).addClass(k),w())},w=function(){"restore"===t&&0===m.length?b.UTILITIES.give_tooltip(d,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):b.UTILITIES.give_tooltip(d,f[t])};document.addEventListener("keyup",function(a){var e=String.fromCharCode(a.keyCode);if(a.altKey){if(0>"SsEeRrAa".split("").indexOf(e))return;d||(h.the_vacuum.get_element(),$(d).css({left:b.tool.pageX,top:b.tool.pageY}),document.body.appendChild(d));c()}h.the_vacuum.held()&&
("s"===e||"S"===e?l("suck"):"e"===e||"E"===e?l("erase"):"r"===e||"R"===e?l("restore"):"a"===e||"A"===e?l("suck_all"):b.sounds&&b.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){h.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});b.vacuum.the_vacuum={apply_tool:function(a,c){var e=a.get_widget(),f=function(a){c&&e.robot_in_training()&&e.robot_in_training().removed(a);a.is_primary_backside&&a.is_primary_backside()?a.hide_backside():
a===e.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):(e.is_bird()&&b.sounds&&b.sounds.bird_fly.pause(),a.is_backside()||(a.save_dimensions_of(a),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),m.push(a),a.set_running&&a.set_running(!1),a.is_backside()||a.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove({event:c,do_not_remove_children:!0}))};b.tool.set_last_event_type(c.type);
if("suck"===t)a.remove&&!a.get_widget().is_top_level()&&(f(a),b.sounds&&b.sounds.vacuum_suck.play());else if("erase"===t||"restore"===t&&a.get_erased&&a.get_erased()){if(!a.is_top_level()){var g=!a.get_erased();b.sounds&&(g?b.sounds.vacuum_suck.play():b.sounds.vacuum_spit.play());a.set_erased(g,!0);c&&e.robot_in_training()&&e.robot_in_training().erased_widget(a,g)}}else if("restore"===t){if(0<m.length){g=m.pop();g.restore_dimensions();var h=a.add_to_top_level_backside(g);c&&e.robot_in_training()&&
e.robot_in_training().restored(g);h.toontalk_widget_side=g;a=$(d).offset();a.left-=$(h).width();b.UTILITIES.set_absolute_position(h,a);g.this_and_walk_children&&(g.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),b.sounds&&b.sounds.vacuum_spit.play())}}else"suck_all"===t&&(g=a.top_level_widget(),a=g.get_backside_widgets().slice(),0<a.length&&b.sounds&&(b.sounds.vacuum_suck.play(),b.sounds.bird_fly.pause()),b.UTILITIES.for_each_batch(a,function(a){a&&e!==e.robot_in_training()&&
f(a)}),g.set_backside_widgets([]))},nothing_under_tool:function(){l(e[t])},get_element:function(){d||(d=document.createElement("div"),$(d).addClass("toontalk-vacuum"),c=b.tool.add_listeners(d,this),l("suck",!0),w(),d.toontalk_tool=b.vacuum.the_vacuum);return d},held:function(){return a},set_held:function(c){var d=function(){b.UTILITIES.listen_for_speech({commands:"suck | erase | restore | remove all",success_callback:function(a,c){if("remove all"===a)l("suck_all");else if("suck"===a||"erase"===a||
"restore"===a)l(a);else return console.log("ignoring "+a),!1;var e=$(".toontalk-highlight");if(0<e.length)(a=b.UTILITIES.widget_side_of_jquery(e))&&a.top_level_widget&&(e=a.top_level_widget(),this.apply_tool(a,c),e.backup_all(),d());else if("restore"===a||"remove all"===a)e=b.tool.get_widget_side_under_tool(),this.apply_tool(e,c);return!0}.bind(this)})}.bind(this);(a=c)?d():b.UTILITIES.stop_listening_for_speech()},set_mode:function(a){l(a)}};return b.vacuum.the_vacuum};b.creators_from_json.vacuum=
function(a,c){var d=b.vacuum.create();a.mode&&b.UTILITIES.set_timeout(function(){d.set_mode(a.mode)});return d};return h}(window.TOONTALK);window.TOONTALK.wand=function(b){var h=Object.create(null);h.create=function(){var f=!1,g,e={apply_tool:function(a,c){a.is_top_level()||(b.sounds&&b.sounds.magic.play(),c=a.add_copy_to_container(),c.update_display(),a.robot_in_training()&&a.robot_in_training().copied(a,c,!1))},get_element:function(){g||(g=document.createElement("div"),$(g).addClass("toontalk-wand"),b.UTILITIES.give_tooltip(g,"I'm a magic wand. Drag me over the thing you want me to copy."),b.tool.add_listeners(g,this),g.toontalk_tool=
e);return g},held:function(){return f},set_held:function(a){var c=function(){b.UTILITIES.listen_for_speech({commands:"copy | abracadabra",success_callback:function(a,e){a=$(".toontalk-highlight");if(0<a.length&&(a=b.UTILITIES.widget_side_of_jquery(a))&&a.top_level_widget){var d=a.top_level_widget();this.apply_tool(a,e);b.tool.set_last_event_type(e.type);d.backup_all();c()}return!0}.bind(this)})}.bind(this);(f=a)?c():b.UTILITIES.stop_listening_for_speech()}};return e};b.creators_from_json.wand=function(){return b.wand.create()};
return h}(window.TOONTALK);window.TOONTALK.SETTINGS=function(b){var h=[],f=function(a,b){Dropbox.choose({success:b,linkType:"direct",extensions:a})},g=function(c,d,g){var k=[];b.UTILITIES.create_local_files_table(function(m){var l=function(a,d){a=function(a){a||d.newPanel.append(b.UTILITIES.create_text_element("Error connecting to cloud. Have you logged in?"))};var h=d.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();0<d.newTab.find(".toontalk-programs-in-cloud-tab-label").length?c.get_setting("save_to_dropbox")?
f([".tt.json"],function(a){b.UTILITIES.download_file(a[0].link,c.download_callback(function(){$(g).remove()}))}):h?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):e(d.newPanel,"program",c,g,a):0<d.newTab.find(".toontalk-pages-in-cloud-tab-label").length?c.get_setting("save_to_dropbox")?f([".tt.html"],function(a){d.newPanel.before($("<p><a href='"+a[0].link+"' target='_blank'>Click to open "+a[0].name+"</a></p>"))}):h?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):e(d.newPanel,"page",c,
g,a):($("#tab-0_info").show(),$("#tab-0_wrapper").show())};k[0]="Programs stored in browser";h[0]=m;if(d){k[1]=b.UTILITIES.create_text_element("Programs in cloud","toontalk-programs-in-cloud-tab-label");k[2]=b.UTILITIES.create_text_element("Published pages","toontalk-pages-in-cloud-tab-label");c.get_setting("save_to_google_drive")?(h[1]=b.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),h[2]=b.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table")):(h[1]=b.UTILITIES.create_text_element("Choose a file to load."),
h[2]=b.UTILITIES.create_text_element("Choose a page to display."));var t=b.UTILITIES.create_tabs(k,h);g.appendChild(t);$(t).on("tabsactivate",l)}else g.appendChild(b.UTILITIES.create_tabs(k,h));a(c,m,!0,g);$(m).on("draw.dt",function(){a(c,m,!1,g)})})},e=function(c,d,e,f,g){b.google_drive.get_toontalk_files(!1,d,function(h){if("string"===typeof h)var k=h;else h.error&&(k=h.error.message);k?"Need to authorize"===k||"Login Required"===k?b.google_drive.authorize(g):(console.log(k),console.log("Google drive status: "+
b.google_drive.get_status()),g(null)):(b.UTILITIES.become_file_data_table(c,h.items,!0,"program"===d&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler"),a(e,c.get(0),!0,f),c.on("draw.dt",function(){a(e,c.get(0),!0,f)}),g(c.get(0)))})},a=function(a,b,e,f){var c=function(b){var c=function(){$(f).remove()},d=function(){a.set_setting("program_name",b.target.textContent);a.load(e,c)}.bind(this);a.save(!0,void 0,d)};b=$(b).find(".toontalk-file-load-button-without-click-handler");
b.each(function(a,b){b.addEventListener("click",c)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(a){var c=document.createElement("div"),e=a.get_backside_element(),f=a.get_setting("program_name"),h=b.UTILITIES.create_text_input(f,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),l=b.UTILITIES.create_close_button(function(){$(c).remove()},"Click to close the settings panel."),w=
b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.speak?b.CHROME_APP?"Turn off spoken help":"Reload with speaking turned off":b.CHROME_APP?"Turn on spoken help":"Reload with spoken help",b.speak?"Check this if you no longer want spoken help.":"Check this if you would like ToonTalk to speak to you."),r=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.balloons?b.CHROME_APP?"Turn off help balloons":"Reload with no balloon help":b.CHROME_APP?"Turn on help balloons":
"Reload with balloon help",b.balloons?"Check this if you no longer want ToonTalk to display balloons giving tips and help.":"Check this if you would like ToonTalk to display balloons giving tips and help."),v=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.listen?b.CHROME_APP?"Turn off voice commands":"Reload with voice commands turned off":b.CHROME_APP?"Turn on voice commands":"Reload with <a href='docs/manual/voice-commands.html' target = '_blank'>voice commands</a> turned on",
b.listen?"Check this if you no longer want ToonTalk to listen to voice commands.":"Check this if you would like ToonTalk to listen for voice commadns."),n=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.TRANSLATION_ENABLED?b.CHROME_APP?"Turn off translation from English":"Reload with no translation from English":b.CHROME_APP?"Turn on translation":"Reload with over one hundred languages that ToonTalk can be translated to",b.TRANSLATION_ENABLED?"Check this if you no longer want ToonTalk to display a choice of languages.":
"Check this if you would like ToonTalk to display a menu of languages for the interface to be translated to."),u=b.UTILITIES.create_text_element("Saving and loading options"),y=b.UTILITIES.create_check_box(a.get_setting("save_to_dropbox"),"toontalk-save-setting","When saving to the cloud use my Dropbox account",'Check this if you want your programs saved to a "ToonTalk Reborn" folder in the "Apps" folder in your Dropbox.'),z=b.UTILITIES.create_check_box(a.get_setting("save_to_google_drive"),"toontalk-save-setting",
"When saving to the cloud use my Google Drive account",'Check this if you want your programs saved to a "ToonTalk Programs" folder in your Google Drive.'),M=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_cloud"),"toontalk-save-setting","Save automatically to cloud storage","Check this if you want your programs to Dropbox or Google Drive when your program changes."),B=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage",
"Check this if you want your programs automatically saved in this browser's local storage."),G=b.UTILITIES.create_button("Save to cloud storage now","toontalk-save-button","Click to save your program now to your Dropbox or your Google Drive account.",function(){a.save(!0,{google_drive:a.get_setting("save_to_google_drive"),dropbox:a.get_setting("save_to_dropbox")})}),N=b.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button","Click to save your program now to this browser's local storage.",
function(){a.save(!0,{local_storage:!0})}),J=b.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){b.google_drive.authorize(function(){$(J).remove()})}),K=b.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){a.display_message("Creating your web page...",{dont_log:!0});a.publish(C,Q.button.checked)}),Q=b.UTILITIES.create_check_box(a.get_setting("publish_as_workspace"),
"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),C=function(c,d){if(c){var e=a.get_setting("program_name");d=document.createElement("span");c=b.google_drive.google_drive_url(c.id,!0);d.innerHTML="Published <a href='"+c+"' target='_blank' title='Click to visit or edit.'>"+e+"</a>";c=$(h.container).children("tr");a.display_message("Your web page is ready for you to edit. Just click on the link.",
{dont_log:!0});0<c.length&&c.get(0).appendChild(b.UTILITIES.create_table_entry(d))}},I=document.createElement("div"),O=b.google_drive&&"undefined"!==typeof gapi?b.google_drive.get_status():"Google Drive API not loaded",T=!0,F=function(){$(c).remove();setTimeout(function(){window.TOONTALK.SETTINGS.open(a)})},D=b.UTILITIES.create_vertical_table(K,Q.container),R=function(a,c){return function(){window.location.assign(b.UTILITIES.add_URL_parameter(window.location.href,a,c?"0":"1"))}},V=function(a){return function(){b.UTILITIES.set_parameter(a,
!b[a])}},aa=function(a,c){return b.CHROME_APP?V(c):R(a,b[c])},X=$(h.container).children("tr");$(c).addClass("toontalk-settings-panel").css({width:$(e).width()+29,height:$(e).height()+50,left:-2,top:-25,"z-index":9999999});c.appendChild(l);h.button.addEventListener("change",function(){var d=h.button.value.trim();f!==d&&a.save(!0,void 0,function(){f=d;a.set_setting("program_name",d);a.load(!0,function(){setTimeout(function(){$(c).css({"z-index":b.UTILITIES.next_z_index()})},500)},function(){a.save(!0,
void 0,function(){$(".toontalk-settings-panel").remove();a.display_message("Your program was copied and the new copy's name is '"+a.get_setting("program_name")+"'.",{dont_log:!0})})})})});w.button.addEventListener("click",aa("speak","speak"));v.button.addEventListener("click",aa("listen","listen"));r.button.addEventListener("click",aa("balloons","balloons"));n.button.addEventListener("click",aa("translate","TRANSLATION_ENABLED"));z.button.addEventListener("click",function(b){a.save(!0,{save_to_google_drive:z.button.checked,
gooogle_drive:!0});a.set_setting("save_to_google_drive",z.button.checked);z.button.checked?($(G).hide(),y.button.checked=!1,a.set_setting("save_to_dropbox",!1),F()):y.button.checked?$(G).show():($(G).hide(),M.button.checked=!1)});y.button.addEventListener("click",function(b){a.save(!0,{save_to_dropbox:y.button.checked,dropbox:!0});a.set_setting("save_to_dropbox",y.button.checked);y.button.checked?($(G).hide(),z.button.checked=!1,a.set_setting("save_to_google_drive",!1),F()):z.button.checked?$(G).show():
($(G).hide(),M.button.checked=!1)});M.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_cloud:M.button.checked,google_drive:a.set_setting("save_to_google_drive"),dropbox:a.set_setting("save_to_dropbox")});a.set_setting("auto_save_to_cloud",M.button.checked);M.button.checked?$(G).hide():y.button.checked||z.button.checked?$(G).show():$(G).hide()});B.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_local_storage:B.button.checked,local_storage:!0});a.set_setting("auto_save_to_local_storage",
B.button.checked);B.button.checked?$(N).hide():$(N).show()});Q.button.addEventListener("click",function(b){a.set_setting("publish_as_workspace",Q.button.checked)});c.appendChild(I);$(u).css({"font-weight":"bold","font-size":24,color:"navy"});I.appendChild(w.container);I.appendChild(r.container);b.CHROME_APP||(I.appendChild(v.container),I.appendChild(n.container));I.appendChild(u);I.appendChild(h.container);b.CHROME_APP||(I.appendChild(z.container),I.appendChild(M.container),I.appendChild(B.container));
z.container.appendChild(b.UTILITIES.create_space());z.container.appendChild(G);y.container.appendChild(b.UTILITIES.create_space());y.container.appendChild(G);a.get_setting("auto_save_to_cloud")&&$(G).hide();B.container.appendChild(b.UTILITIES.create_space());B.container.appendChild(N);a.get_setting("auto_save_to_local_storage")&&$(N).hide();a.get_setting("save_to_google_drive")?"Need to authorize"===O?(z.container.appendChild(b.UTILITIES.create_space()),z.container.appendChild(J)):"Authorized"!==
O&&"Ready"!==O&&"Authorized but not yet ready"!==O?(T=!1,a.set_setting("google_drive_unavailable",!0),setTimeout(function(){z.button.disabled=!0;$(K).button("option","disabled",!0);$(G).button("option","disabled",!0);b.UTILITIES.give_tooltip(z.container,"Inactivated because attempt to connect to Google Drive returned: "+O);K.title=z.container.title;G.title=z.container.title},1)):a.set_setting("google_drive_unavailable",!1):a.get_setting("save_to_dropbox")&&(T=!0);0<X.length&&X.get(0).appendChild(b.UTILITIES.create_table_entry(D));
g(a,T,c);e.appendChild(c)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",save_to_google_drive:!0,auto_save_to_cloud:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(b){var h=[],f=0,g=!1,e=!1;return{pending_update:function(a){0<=h.indexOf(a)||(h.push(a),this.update_display())},update_display:function(){if(!e&&!document.hidden&&0!==h.length){var a=Date.now();a<f?(e=!0,setTimeout(this.update_display_workhorse.bind(this),f-a)):g||(e=!0,b.UTILITIES.set_timeout(function(){this.update_display_workhorse(a)}.bind(this)))}},update_display_workhorse:function(a){var c=h;h=[];g=!0;e=!1;f=(a|Date.now())+50;b.UTILITIES.for_each_batch(c,
function(a){var c=a.get_element&&a.get_element(),d;if(c&&(a.visible()||$(c).is(".toontalk-top-level-resource")))if($(c).is(".toontalk-not-observable"))b.DISPLAY_UPDATES.pending_update(a);else if($(c).is(".toontalk-has-attached-callback"))c.parentElement&&c.toontalk_attached_callback&&(c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0);else{$(c).show();a.update_display();a.get_backside&&(d=a.get_backside())&&d.visible()&&d.update_display();setTimeout(function(){b.UTILITIES.use_custom_tooltip(c)});
var e=$(c).parent().closest(".toontalk-side");c&&!$(c).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&b.UTILITIES.set_timeout(function(){if(e.is(".toontalk-box-hole")||e.is(".toontalk-nest"))$(c).children(".ui-resizable-handle").hide();else if($(c).is(".ui-resizable"))$(c).children(".ui-resizable-handle").show();else if(b.UTILITIES.make_resizable($(c),
a),a.is_box()){var d=a.get_border_size();$(c).children(".ui-resizable-handle").css({right:-d,bottom:-d})}})}});g=!1;0<h.length&&(e=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(b){b.creators_from_json.body=function(h,f){var g=b.actions.create();f.body=g;g.initialise_steps(b.UTILITIES.create_array_from_json(h.steps,f));return g};return{create:function(h){var f=Object.create(this),g=[];h||(h=[]);f.copy=function(){return b.actions.create(b.UTILITIES.copy_array(h))};f.get_steps=function(){return h};f.initialise_steps=function(b){h=b};f.is_empty=function(){return 0===h.length};f.reset_steps=function(){h=[];this.reset_newly_created_widgets()};
f.reset_newly_created_widgets=function(){b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+g.length);g=[]};f.add_step=function(e,a){e?(h.push(e),a&&this.add_newly_created_widget_if_new(a)):b.UTILITIES.report_internal_error("Attempt to add an undefined step.")};f.add_newly_created_widget_if_new=function(b){0<=g.indexOf(b)||this.add_newly_created_widget(b)};f.add_newly_created_widget=function(e){b.debugging&&0<=g.indexOf(e)?console.log("add_newly_created_widget called with not new widget."):
(g.push(e),b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Added "+e.to_debug_string(50)+" to list of newly_created_widgets. Length is "+g.length))};f.is_newly_created=function(b){return 0<=g.indexOf(b)};f.get_newly_created_widgets=function(){return g};f.get_path_to=function(e,a,c){var d,f;g.some(function(g,h){if(g===e||c&&g===e)return d=b.newly_created_widgets_path.create(h),!0;if(g.get_path_to&&(f=g.get_path_to(e,a)))return d=b.newly_created_widgets_path.create(h),d.next=f,!0});return d};
f.dereference_path=function(e){b.debugging&&!g[e]&&b.UTILITIES.report_internal_error("Expected to find the "+b.UTILITIES.ordinal(e)+" newly created widget.");return g[e]};return f},run_unwatched:function(h,f){var g=this.get_steps();b.logging&&0<=b.logging.indexOf("run")&&console.log(h.to_debug_string(50)+" running unwatched");f||(f=0);h.run_next_step=function(e){if(f<g.length){var a=g[f];f++;b.logging&&0<=b.logging.indexOf("event")&&console.log(a+" (unwatched) at "+Date.now()+" by robot "+h.get_name()+
" "+h._debug_id);e?(h.run_watched_step_end_listeners(),a.run_watched(h)):a.run_unwatched(h)}else this.stopped()||(h.set_running_or_in_run_queue(!1),h.run_body_finished_listeners(),h.get_run_once()?h.get_first_in_team().set_running(!1):h.get_first_in_team().run())};h.run_next_step()},run_watched:function(h){var f=this.get_steps(),g=h.get_frontside_element(),e=g.parentElement,a=h.get_first_in_team(),c=0,d=$(g).offset(),k=$(g).offset(),t=$(g).width(),m=$(g).height();h.get_first_in_team().top_level_widget();
var l=$(g).closest(".toontalk-backside-of-top-level").offset(),w=h.get_context().get_backside(),r=h.get_parent(),v,n;b.logging&&0<=b.logging.indexOf("run")&&console.log(h.to_debug_string(50)+" running watched");var u=(v=h.get_previous_robot())?$(v.get_backside(!0).get_next_robot_area()):w&&$(w.get_backside_element(!0));if(!b.UTILITIES.is_attached(g)&&v){var y=g.parentElement;!y&&u&&(y=u.get(0));for(n=v.get_first_in_team();n!==h;)n.open_backside(),n.get_backside().set_advanced_settings_showing(!0),
function(){var a=n;setTimeout(function(){a.get_backside()&&(a.get_backside().set_advanced_settings_showing(!1),a.hide_backside())},2E3)}(),v=n.get_frontside_element(),d=$(v).offset(),0!==d.left&&0!==d.top&&void 0===l&&(k={left:d.left,top:d.top},l=d),n=n.get_next_robot();h.set_visible(!0);h.update_display();h.add_body_finished_listener(function(){y&&TOONTALK.UTILITIES.is_attached(y)?y.appendChild(g):r||h.remove({do_not_remove_frontside:!0});$(g).css({left:"",top:"",position:"","z-index":""})})}h.add_body_finished_listener(function(){var c=
a.visible(),f=function(){c&&(e&&(e.appendChild(g),h.set_parent_of_frontside(b.UTILITIES.widget_side_of_element(e))),h.set_animating(!1));a===h?b.UTILITIES.set_absolute_position(g,d):(b.UTILITIES.set_css(g,{position:"static"}),u&&0<u.length&&u.append(g));h.get_run_once()?a.set_running(!1):h.stopped()?$(g).removeClass(".toontalk-side-animating"):a.run();h.rerender()};c?(!g.parentElement&&h.get_parent_of_frontside()&&h.get_parent_of_frontside().get_frontside_element(!0).appendChild(g),b.UTILITIES.animate_to_absolute_position(g,
d,f,h&&h.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED))):(h.set_animating(!1),f(),h===a&&h.get_context().add_backside_widget(h),$(h.get_frontside_element()).remove())});0===t&&($(g).css({width:"",height:""}),t=h.saved_width||$(g).width(),m=h.saved_height||$(g).height());l||(l={left:0,top:0});u&&0<u.length&&b.UTILITIES.is_attached(u.get(0))&&(v=u.get(0).getBoundingClientRect(),d.left<v.left-l.left||d.top<v.top-l.top||d.left+t>v.right+l.left||d.top+m>v.bottom+l.top)&&(d=u.offset(),
d.left+=u.width()/2,d.top+=u.height()-m,k=d);h.start_offset=k;h.add_to_top_level_backside();b.UTILITIES.set_absolute_position(g,d);h.run_next_step=function(){!w||document.hidden||!w.visible()&&!b.UTILITIES.visible_element(w.get_element())||h.stopped()?(h.set_running_or_in_run_queue(!1),h.set_animating(!1),$(g).css({width:"",height:""}),g.style.transitionDuration="",e&&e.appendChild(g),this.run_unwatched(h,c)):setTimeout(function(){h.run_watched_step_end_listeners();if(c<f.length){var a=f[c];c++;b.logging&&
0<=b.logging.indexOf("event")&&console.log(a+" (watched)");a.run_watched(h)}else h.set_running_or_in_run_queue(!1),h.run_body_finished_listeners()},h.transform_step_duration(b.animation_settings.PAUSE_BETWEEN_STEPS))}.bind(this);h.set_animating(!0,d);h.run_next_step();return!0},toString:function(b){for(var f="",g=this.get_steps().map(function(e){return e&&e.toString(b)});""===g[g.length-1];)g.pop();g.forEach(function(b,a){b&&(f+=b,f=a===g.length-2?f+" and \n":a<g.length-2?f+", \n":f+".")});return f},
get_json:function(h,f,g,e){var a=[];b.UTILITIES.get_json_of_array(this.get_steps(),a,0,h,function(){f({type:"body",steps:a},g,e+1)},g,e+1)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(b){b.creators_from_json.newly_created_widgets_path=function(h){return b.newly_created_widgets_path.create(h.index)};return{create:function(h){return{dereference_path:function(f){var g=f.get_body().dereference_path(h),e;if(this.next)return b.path.dereference_path(this.next,f,g);this.removing_widget&&g&&((e=g.get_parent_of_frontside())&&e.is_hole()&&(e=e.get_parent_of_frontside()),e&&e.removed_from_container&&f.remove_from_container(g,e));return g},
toString:function(){return"the "+b.UTILITIES.ordinal(h)+" new widget"},get_json:function(b,g,e,a){g({type:"newly_created_widgets_path",index:h},e,a+1)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(b){var h=function(a,b,c){if(!c||!c.running_watched||!a.get_backside())return!0;a.get_backside().hide_backside()},f={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,c,d){if(a.is_empty_hole&&a.is_empty_hole())b.UTILITIES.report_internal_error("The following robot is trying to pick up an empty hole.\n"+c);else{if(a.get_infinite_stack())return f["pick up a copy of"](a,c);d&&d.running_watched||a.set_parent(void 0);c.set_thing_in_hand(a);
return!0}},"pick up a copy of":function(a,b){a=a.copy();b.add_newly_created_widget(a);b.set_thing_in_hand(a);return!0},"drop it on":function(a,c,d){var e;if(a)if(e=c.get_thing_in_hand()){if(e.drop_on)return b.debugging&&e===a&&b.UTILITIES.report_internal_error("Dropping something on itself! "+a),a.visible()||$(e.get_frontside_element()).remove(),e.drop_on(a,{robot:c}),c.set_thing_in_hand(void 0),a.rerender(),c.add_newly_created_widget_if_new(e),e.robot_waiting_before_next_step===c?(d&&d.running_watched||
(e.robot_waiting_before_next_step=void 0),!1):!0;b.debugging&&b.UTILITIES.report_internal_error("Thing in robot's hand ("+e+") doesn't handle 'drop_on'. Robot that "+c)}else!c.being_trained&&b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but has nothing in its hand.");else b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(a,
c,d){var e;if(a){if(e=c.get_thing_in_hand())return c.set_thing_in_hand(void 0),a[d.setter](e),!0;b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},remove:function(a,b){a.remove();a===b?b.set_stopped(!0):b.add_newly_created_widget_if_new(a);return!0},restore:function(a,
b){b.add_to_top_level_backside(a);a.get_element().toontalk_widget_side=a;return!0},"change whether erased":function(a,b,c){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;a.display_message("Robot is unable to erase "+a)},edit:function(a,c,d){if(a[d.setter_name])return d.argument_2?a[d.setter_name].call(a,d.argument_1,d.argument_2,a.visible()):a[d.setter_name].call(a,d.argument_1,a.visible()),!0;b.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c){return!0},
"add to the top-level backside":function(a,c,d){if(!d||!d.running_watched){d=c.top_level_widget();d.add_backside_widget(a);var e=c.get_context();if(!e.visible())return;var f=d.get_backside_element();e=a.get_frontside_element(!0);a.update_display();f.appendChild(e);a.animate_to_element(f,void 0,c.transform_animation_speed(b.animation_settings.ANIMATION_SPEED));d.get_backside&&$(e).css(d.get_backside().get_free_location(a))}return!0},"add a new widget to the work space":function(a,c,d){if(c.get_context())return c.get_context().is_top_level()?
(d=c.add_to_top_level_backside(a),c=$(c.get_frontside_element()).offset(),a.update_display(),b.UTILITIES.set_position_relative_to_top_level_backside(d,c,!0)):a.drop_on(c.get_context().get_backside(!0),{robot:c}),!0;b.UTILITIES.report_internal_error("Robot has no context in 'add a new widget to the work space'. Robot is "+c+" and widget is "+a)},"start training":function(a,c,d){if(a.is_robot())return d&&d.running_watched||(a.initialize_backside_conditions(),a.get_body().reset_steps(),c.robot_started_training(a)),
a.training_started(c),!0;b.UTILITIES.report_internal_error("Expected to train a robot but found instead "+a)},"stop training":function(a,b,c){a.training_finished();return!0},train:function(a,c,d){if(a.add_step)return a.add_step(d.step),!0;b.UTILITIES.report_internal_error("Cannot peform a training step because cannot train a non-robot.")},"open the backside":function(){return!0},"open the backside of":function(){return!0},"close the backside of":h,"close the backside":h,"click the button of":function(a,
b,c){".toontalk-green-flag"===c.button_selector?a.set_running(!0):".toontalk-stop-sign"===c.button_selector&&a.set_running(!1);return!0}},g=function(a,c,d,e){var f=c.get_thing_in_hand(),g=c.get_frontside_element(),h=a.get_element();h||(h=b.UTILITIES.find_resource_equal_to_widget(a,c));if(b.UTILITIES.is_attached(h)&&c.visible()&&!c.stopped()){var k=h.getBoundingClientRect();if(e&&e.left_offset_fraction){c.original_animation_left_offset||(c.original_animation_left_offset=[]);c.original_animation_top_offset||
(c.original_animation_top_offset=[]);k={left:e.left_offset_fraction*k.width,top:e.top_offset_fraction*k.height};if(f){var l=f.get_element();b.UTILITIES.visible_element(l)&&(l=$(l).offset(),g=$(g).offset(),k.left-=l.left-g.left,k.top-=l.top-g.top)}a.get_backside&&(f=a.get_backside().get_free_location(f,{try_first:k}),h.animation_left_offset=f.left,h.animation_top_offset=f.top,c.animation_left_offset=f.left,c.animation_top_offset=f.top)}else{var m=k.width/2;var n=k.height/2}c.animate_to_widget(a,d,
c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),m,n,!0,c.transform_original_step_duration(e&&e.time),c)}else d()},e=function(a,b,c,d){g(a,b,function(){a.open_backside(c);m(a,b)},d)},a=function(a,b){var c=a.get_backside_element(!0),d=$(c).find(b).get(0);if(d)return d;a.get_backside().set_advanced_settings_showing(!0);return $(c).find(b).get(0)},c=function(c,d,e,f,g,h){var k=a(c,f);d.get_frontside_element();var l=k&&b.UTILITIES.visible_element(k),n=function(){e(k);$(k).addClass("ui-state-active");
if(".toontalk-select-function"===f||".toontalk-box-size-input"===f)k.value=g.argument_1;setTimeout(function(){$(k).removeClass("ui-state-active");b.UTILITIES.remove_highlight();d.run_next_step(!0)},h)},r=function(){if(!b.UTILITIES.visible_element(k)){var a=c.get_backside(!0);a.set_advanced_settings_showing(!0,a.get_element())}d.animate_to_element(k,n,d.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0,d.transform_original_step_duration(g&&g.time))};b.UTILITIES.highlight_element(c.get_frontside_element());
!l&&c.open_backside&&d.animate_consequences_of_actions()?c.open_backside(r,d.transform_step_duration(b.animation_settings.OPEN_BACKSIDE_DURATION))&&m(c,d):r()},d=function(a,c,d,e,f){var g=b.UTILITIES.closest_element($("."+f),$(c.get_frontside_element()).offset()),h=function(){k(a,c,d,e)};g&&c.animate_consequences_of_actions()&&0<$("."+f).length?c.animate_to_element(g,h,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0):h()},k=function(a,c,d,e){c.get_frontside_element();
var f=function(){c.carrying_tool=void 0;c.update_display();d();c.run_next_step(!0)};if(c.animate_consequences_of_actions())if(c.carrying_tool=e,c.update_display(),e=c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),a)c.animate_to_element(a.get_element(),f,e,0,0,!0);else{var g=c.top_level_widget().get_element();a=$(g).offset();a.left+=$(g).width()*(.1+.8*Math.random());a.top+=$(g).height()*(.1+.8*Math.random());c.animate_to_absolute_position(a,f,e,!0)}else d(),c.run_next_step(!0)};
h=function(a,b,c){var e=a.get_parent_of_frontside();d(a,b,function(){c();e&&"top-level"!==e.get_widget().get_type_name()&&e.update_display&&e.update_display();a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")};var t=function(a,c,d){a.open_backside(function(){d();c.run_next_step(!0)},b.animation_settings.OPEN_BACKSIDE_DURATION);m(a,c)},m=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},l=function(a,c,d,e){e=e&&e.time?c.transform_original_step_duration(e.time):
c.transform_step_duration(b.animation_settings.CLOSE_BACKSIDE_DURATION);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();d();c.run_next_step(!0)},e)},w={copy:function(a,c,e){d(a,c,function(){a.add_copy_to_container?(e(),a.add_copy_to_container(c.get_recently_created_widget())):b.UTILITIES.display_message("Unable to copy "+b.UTILITIES.add_a_or_an(a.get_type_name())+" by robot named "+c.get_name())},"toontalk-wand-small","toontalk-wand")},"pick up":function(a,
c,d,e){var f=function(){d();c.animate_consequences_of_actions()&&c.update_display();c.run_next_step(!0)};b.debugging&&"empty hole"===a.get_type_name()?b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):a.save_dimensions()&&c.animate_consequences_of_actions()?g(a,c,f,e):f()},"pick up a copy of":function(a,c,d,e){g(a,c,function(){var e;d();c.animate_consequences_of_actions()&&(e=c.get_recently_created_widget())&&(e.set_visible(!0),b.UTILITIES.copy_frontside_dimensions(a,e),
c.update_display());c.run_next_step(!0)},e)},"drop it on":function(a,c,d,f){var h=c.get_thing_in_hand();if(h){b.debugging&&h===a&&b.UTILITIES.report_internal_error("Dropping something on itself!");var k=h.get_element(!0);h.set_visible(c.visible());var l=function(){$(k).removeClass("toontalk-held-by-robot");if(h.drop_on){if(c.animate_consequences_of_actions()&&!b.UTILITIES.visible_element(k)){var a=$(c.get_frontside_element()).closest(".toontalk-backside-of-top-level");0<a.length&&a.get(0).appendChild(k)}c.rerender()}d();
h.drop_on&&h.visible()&&(b.UTILITIES.set_absolute_position(k,$(k).offset()),h.restore_dimensions());h.robot_waiting_before_next_step!==c&&c.run_next_step(!0)};a.is_backside()&&!b.UTILITIES.visible_element(a.get_element())?e(a.get_widget(),c,l,f):g(a,c,l,f)}else b.debugging&&(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+c)),g(a,c,d,f)},"drop it on the text area of":function(a,c,d,f){var h=c.get_thing_in_hand();if(h){var k=h.get_element(!0);
h.set_visible(c.visible());var l=function(){$(k).removeClass("toontalk-held-by-robot");d();h.remove();var b=a.get_parent_of_frontside().get_widget();b.is_hole()&&(b=b.get_parent_of_frontside());b.is_top_level()?a.render():b.render();c.set_thing_in_hand(void 0);c.run_next_step(!0)};var m=function(){return $(a.get_backside_element()).find(f.area_selector).get(0)};c.rerender();if(b.UTILITIES.visible_element(a.get_backside_element())){var n=m();c.animate_to_element(n,l,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED/
2),0,0,!0)}else e(a,c,function(){n=m();c.animate_to_element(n,l,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED/2),0,0,!0)},f)}else b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+c),g(a,c,d,f)},remove:h,"change whether erased":h,restore:function(a,c,e){d(void 0,c,function(){b.UTILITIES.set_css(a.get_element(!0),$(c.get_frontside_element()).position());e()},"toontalk-vacuum-ready-small","toontalk-vacuum")},edit:function(a,
d,e,f){c(a,d,function(){a.get_backside()&&a.get_backside().update_display();e()},f.button_selector,f,d.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))},"change size of":function(a,c,d,e){var f=a.get_frontside_element();f?c.animate_to_element(f,function(){var g=f.getBoundingClientRect(),h=g.width*e.x_factor;g=g.height*e.y_factor;var k=c.transform_step_duration(b.animation_settings.CHANGE_SIZE_DURATION);$(f).addClass("toontalk-animating-element");f.style.transitionDuration=k+"ms";f.style.width=
h+"px";f.style.height=g+"px";setTimeout(function(){$(f).removeClass("toontalk-animating-element");f.style.transitionDuration="";d();a.render();c.run_next_step(!0)},k)},c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0):(d(),c.run_next_step(!0))},"add to the top-level backside":function(a,b,c){c();b.run_next_step(!0)},"add a new widget to the work space":function(a,d,e,f){f&&f.button_selector?(a=b.path.dereference_path(f.path_to_source,d),c(a,d,e,f.button_selector,f,d.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))):
(e(),d.run_next_step(!0))},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by={element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step(!0)},"stop training":function(a,d,e,f){var g=a.get_frontside_element();c(a,d,function(){var c=function(){g.toontalk_return_to=
void 0;a.get_backside()&&a.get_backside().change_label_and_title_of_train_button(!1);$(g).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");g.toontalk_followed_by=void 0;setTimeout(e,d.transform_step_duration(b.animation_settings.STOP_TRAINING_DELAY))};g.toontalk_return_to?b.UTILITIES.animate_to_absolute_position(g,g.toontalk_return_to,c,d.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED)):c()},".toontalk-train-backside-button",f,d.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))},
train:function(a,c,d,e){var f=function(){d();c.run_next_step(!0)};(e=e.step.run_watched)?(a.run_next_step=f,a.get_parent_of_frontside()?a.set_context(a.get_parent_of_frontside().get_widget()):b.UTILITIES.report_internal_error("Robot being trained by a robot that doesn't know its parent widget.  robot_being_trained is "+a+" robot is "+c),e(a)):f()},"open the backside":t,"open the backside of":t,"close the backside of":l,"close the backside":l,"click the button of":function(a,b,d,e){c(a,b,function(c){$(c).is(".toontalk-settings-backside-button")&&
">"===c.innerText&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().set_advanced_settings_showing(!1,a.get_backside_element())});".toontalk-green-flag"!==e.button_selector&&".toontalk-stop-sign"!==e.button_selector&&$(c).click();d()},e.button_selector,e)}};b.creators_from_json.robot_action=function(a,c){return a.additional_info?b.robot_action.create(b.UTILITIES.create_from_json(a.path,c),a.action_name,b.UTILITIES.create_keys_from_json(a.additional_info,c)):b.robot_action.create(b.UTILITIES.create_from_json(a.path,
c),a.action_name)};return{create:function(a,c,d){var e=Object.create(this),g=f[c],h=w[c];if(h)return a||b.UTILITIES.report_internal_error("path undefined in "+c+" action"),g||b.UTILITIES.report_internal_error("no run_function for "+c),e.get_action_name=function(){return c},e.get_additional_info=function(){return d},e.run_unwatched=function(c){var e=b.path.dereference_path(a,c);if(!e)return b.UTILITIES.report_internal_error("Unable to dereference path: "+b.path.toString(a)+", the back of "+c.get_context()+
". This could be because this robot ("+c+") was trained in a very different situation.",{dont_log_exception:!0}),!1;b.logging&&0<=b.logging.indexOf("event")&&(e.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+e.wait_until_this_nest_receives_something.to_debug_string(50)+"("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)+" "+c._debug_id):console.log("   "+e.to_debug_string(50)+" ("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)+
" "+c._debug_id));e.wait_until_this_nest_receives_something?e.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.visible()?this.run_watched(c):this.run_unwatched(c)}.bind(this),c):(d&&(d.running_watched=!1),g(e,c,d)&&c.run_next_step())},e.run_watched=function(c){var e;c.stopped?c.stopped()&&!c.being_trained?this.run_unwatched(c):(e=b.path.dereference_path(a,c))?(b.logging&&0<=b.logging.indexOf("event")&&console.log("   "+e+" ("+b.path.toString(a)+" "+(e.to_debug_string?e.to_debug_string(50):
e)+" by watched "+c.to_debug_string(50)+" "+c._debug_id+(c.animate_consequences_of_actions()?"":" finishing instantly")),e.wait_until_this_nest_receives_something?(e.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.set_waiting(!1);this.run_watched(c)}.bind(this),c),c.set_waiting(!0),TOONTALK.UTILITIES.visible_element(c.get_context().get_backside_element())||c.get_frontside().remove()):(d&&(d.running_watched=!0),h(e,c,function(){d||(d={});d.running_watched=!0;g(e,c,d)},d))):
b.UTILITIES.display_message("Unable to dereference the path: "+b.path.toString(a)+" in context: "+c.get_context(),{only_if_new:!0}):b.UTILITIES.report_internal_error("Watched action not passed its robot. Was passed "+c+" and action is "+this)},e.toString=function(e){var f="",g="",h=c;if("open the backside"===c||"close the backside"===c)c+=" of";if("click the button of"===c)switch(d.button_selector){case ".toontalk-green-flag":h="click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
" of";break;case ".toontalk-stop-sign":h="click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":h="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":h="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":h="click the button to add or remove attributes of ";break;case ".toontalk-remove-backside-and-widget-button":h="click the button to remove the back and front of ";
break;default:h="click a button of"}if("add a new widget to the work space"===c)return c.replace("a new widget",b.path.toString(a));if("add to the top-level backside"===c)return"";e||(e={});var k=b.path.toString(a,e);if("edit"===c||"drop it on the text area of"===c)f=" ("+d.toString+")";else if("train"===c){f=d.step.toString({person:"third"});if(""===f)return f;f=" to "+f;g="- ";e&&e.robot_being_trained_description&&(k=e.robot_being_trained_description)}else"start training"===c?e&&(e.robot_being_trained_description=
"it"):"stop training"===c&&(k=e.robot_being_trained_description,e.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(c)){if(0<=k.indexOf("hole of"))return g+h+" what is in "+k+f;if(0===k.indexOf("a When"))return k=k.substring(3),k=b.UTILITIES.remove_encoded_HTML(k),k=b.UTILITIES.elide(k,80,1),"."===k[k.length-1]&&(k=k.substring(0,k.length-1)),g+h+" a robot who "+k+f+"\n"}return g+h+" "+k+f},
e.get_json=function(e,f,g,h){var k=function(d,g,h){b.path.get_json(a,e,function(a,b,e){f({type:"robot_action",action_name:c,path:a,additional_info:d},b,e+1)},g,h+1)};d?b.UTILITIES.get_json_of_keys(d,["running_watched"],k,g,h+1):k(void 0,g,h+1)},e;b.UTILITIES.report_internal_error("No watched function for "+c)}}}(window.TOONTALK);window.TOONTALK.queue=function(b){var h={create:function(){var f=Object.create(this);f.to_run=b.UTILITIES.create_queue();f.run_function=f.run.bind(f);return f},enqueue:function(b){b.running_or_in_run_queue()||(b.set_running_or_in_run_queue(!0),this.to_run.enqueue(b)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var f=Date.now()+h.maximum_run;for(this.running=!0;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<f;){var g=this.to_run.dequeue();g.run_actions()}this.to_run.isEmpty()?this.running=!1:b.UTILITIES.set_timeout(this.run_function)}};return h}(window.TOONTALK);window.TOONTALK.path=function(b){var h;b.creators_from_json["path.to_entire_context"]=function(f,g){return b.path.to_entire_context()};b.creators_from_json["path.to_self"]=function(f,g){return b.path.to_self()};b.creators_from_json["path.to_thing_in_hand"]=function(){return b.path.to_thing_in_hand()};b.creators_from_json["path.to_widget_on_nest"]=function(){return b.path.to_widget_on_nest()};b.creators_from_json["path.top_level_backside"]=function(){return b.path.top_level_backside};b.creators_from_json["path.to_backside_widget_of_context"]=
function(f,g){return"undefined"===typeof f.backside_index?b.path.get_path_to_backside_widget_of_context(f.type_name,g&&g.robot):b.path.get_path_to_backside_index_of_context(f.backside_index,f.type_name,g&&g.robot)};b.creators_from_json["path.to_resource"]=function(f,g){return b.path.get_path_to_resource(b.UTILITIES.create_from_json(f.resource,g))};return{get_path_to:function(f,g,e){var a=function(a,d){var c=d.get_training_context(),f=d.get_body();if(a.is_primary_backside&&a.is_primary_backside()){var g=
!0;a=a.get_widget()}if(c===a){var h=b.path.to_entire_context();h.is_backside=g;return h}if(d===a||d.get_first_in_team()===a)return b.path.to_self();if(d.get_thing_in_hand()===a)return b.path.to_thing_in_hand();var w=a.get_type_name();if("top-level"===w)return b.path.top_level_backside;if(h=f.get_path_to(a,d,e))return h.is_backside=g,h;if("element attribute"===w&&a.is_attribute_widget_copy(a))return h=b.element.create_attribute_path(a,d),h.is_backside=g,h;if(c){if(c.get_path_to&&(f=c.get_path_to(a,
d)))return f.is_backside=g,h=b.path.to_entire_context(),h.next=f,h;c.get_backside_widgets().some(function(c){c=c.get_widget();var e;if(c===a||c.top_contents_is&&c.top_contents_is(a))return d.add_to_backside_conditions(c),h=b.path.get_path_to_backside_widget_of_context(c,d),h.is_backside=g,!0;if(c.get_path_to&&(e=c.get_path_to(a,d)))return e.is_backside=g,d.add_to_backside_conditions(c),h=b.path.get_path_to_backside_widget_of_context(c,d),h.next=e,!0});if(h)return h.is_backside=g,h;if((c=!a.is_robot()&&
a.ancestor_of_type&&a.ancestor_of_type("robot"))&&c!==a)return b.robot.find_conditions_path(a,c,d);if(h=b.path.get_path_to_resource(a.dereference().copy()))h.is_backside=g;return h}b.UTILITIES.report_internal_error("function"==="No context to compute the path. Widget is "+a+" robot is "+d+". Robot parent is"+typeof this.get_parent_widget_of_frontside?this.get_parent_widget_of_frontside():"Cannot access its parent. Type is "+typeof this+" and type of get_parent_widget_of_frontside is "+typeof this.get_parent_widget_of_frontside)}(f,
g,e);a&&f.dereference_contents&&(b.path.path_end(a).not_to_be_dereferenced=!0);!a||"pick up"!==g.current_action_name&&"remove"!==g.current_action_name||(b.path.path_end(a).removing_widget=!0);return a},path_end:function(b){for(;b.next;)b=b.next;return b},dereference_path:function(b,g,e){var a;b?b.dereference_path?a=b.dereference_path(g,e):e&&e.dereference_path&&(a=e.dereference_path(b,g)):a=e||g.get_context();return a&&b&&b.is_backside?a.get_backside(!0):a},continue_dereferencing_path:function(b,
g,e){void 0===g&&e.context_is_backside()&&(g=e.get_top_level_context());void 0===g&&(g=e.get_context());return b.next?g.dereference_contents&&!b.next.not_to_be_dereferenced?(g=g.dereference_contents(b,e))&&b.is_backside?g.get_backside(!0):g:(g=g.dereference_path(b.next,e))&&b.next.is_backside?g.get_backside(!0):g:g.dereference_contents&&!b.not_to_be_dereferenced?(g=g.dereference_contents(b,e))&&b.is_backside?g.get_backside(!0):g:g},toString:function(f,g){var e="";if(!f)return"undefined path";f.is_backside&&
(e="the backside of ");g||(g={});var a=g.resource;g.resource=!0;f.next?(b.path.toString(f.next,g),f=e+b.path.toString(f.next,g).trim()+" of "+f.toString(g)):f=e+f.toString(g);g.resource=a;return f},get_json:function(f,g,e,a,c){var d;f.get_json?f.get_json(g,function(a,c,h){f.is_widget&&(a=f.add_to_json(a,g));f.next&&(d=function(b){a.next_path=b},b.path.get_json(f.next,g,d,c,h+1));f.removing_widget&&(a.removing_widget=!0);f.not_to_be_dereferenced&&(a.not_to_be_dereferenced=!0);if(!0===f.is_backside||
f.is_backside&&f.is_backside())a.is_backside=!0;e(a,c,h+1)},a,c+1):e(f,a,c+1)},to_entire_context:function(f){return{dereference_path:function(f,e){return b.path.continue_dereferencing_path(this,e,f)},toString:function(b){return b&&b.robot?b.robot.get_top_level_context_description(b):b&&"third"===b.person?"what he's working on":"what I'm working on"},get_json:function(b,e,a,c){e({type:"path.to_entire_context"},a,c+1)}}},to_self:function(){return{dereference_path:function(b,g){return b.get_first_in_team()},
toString:function(b){return"myself"},get_json:function(b,g,e,a){g({type:"path.to_self"},e,a+1)}}},to_widget_on_nest:function(){return{dereference_path:function(f,g){return b.path.continue_dereferencing_path(this,g,f)},toString:function(){return"what is on the nest"},get_json:function(b,g,e,a){g({type:"path.to_widget_on_nest"},e,a+1)}}},to_thing_in_hand:function(){return{dereference_path:function(f,g){return b.path.continue_dereferencing_path(this,f.get_thing_in_hand(),f)},toString:function(){return"what I'm holding"},
get_json:function(b,g,e,a){g({type:"path.to_thing_in_hand"},e,a+1)}}},get_path_to_resource:function(f){var g;if(f){if(g=f.get_widget())return{dereference_path:function(e){var a=g.copy({copying_resource:!0}),c;e.add_newly_created_widget(a);if(e.visible()&&(c=b.UTILITIES.find_resource_equal_to_widget(g,e))){a.save_dimensions_of(b.UTILITIES.widget_side_of_element(c));var d=a.get_frontside_element();var f=$(c).position();b.UTILITIES.set_timeout(function(){$(d).css({left:f.left,top:f.top,width:$(c).width(),
height:$(c).height()})})}return a},toString:function(e){return b.UTILITIES.add_a_or_an(g.toString(e))},get_json:function(e,a,c,d){g.get_json(b.UTILITIES.fresh_json_history(e),function(b,c,d){a({type:"path.to_resource",resource:b},c,d+1)},c,d+1)}}}else console.error("Widget missing in get_path_to_resource.")},get_path_to_backside_widget_of_context:function(f,g){return"string"===typeof f?{dereference_path:function(e){var a=e.get_context(),c=e.get_backside_widget_of_type(f,a);c||a.get_backside_widgets().some(function(a){if(a.get_widget().is_of_type(f)&&
!e.is_newly_created(a.get_widget()))return c=a.get_widget(),!0});if(c)return b.path.continue_dereferencing_path(this,c,e)},toString:function(e){e=(e&&e.robot&&e.robot.get_backside_conditions()?e.robot.get_backside_conditions()[f]:b.UTILITIES.add_a_or_an(f))+" on the back of what I'm working on";return this.removing_widget?"what is on "+e:e},get_json:function(b,a,c,d){a({type:"path.to_backside_widget_of_context",type_name:f},c,d+1)}}:this.get_path_to_backside_index_of_context(g.get_backside_condition_index(f),
f.get_type_name(),g)},get_path_to_backside_index_of_context:function(f,g,e){return{dereference_path:function(a){var c=a.get_backside_matched_widgets()[f],d=function(a,b){var c;b.some(function(b){if(b.get_type_name()===a){if(c)return c=void 0,!0;c=b.dereference()}});return c};c&&c.get_type_name()!==g&&(c=d(g,a.get_backside_matched_widgets()));if(this.next)return b.path.dereference_path(this.next,a,c);if(c)return this.removing_widget&&((d=c.get_parent_of_frontside())&&d.is_hole()&&(d=d.get_parent_of_frontside()),
d&&d.removed_from_container&&"nest"!==g&&a.remove_from_container(c,d)),b.path.continue_dereferencing_path(this,c,a);b.debugging&&console.log("can this happen?")},toString:function(a){var c=(a=(a=e.get_frontside_conditions())&&a.is_top_level())?"work area":"back of what";c=b.UTILITIES.add_a_or_an(g||"thing")+" on the "+c+" I'm working on";return!this.removing_widget||a&&"nest"!==g?c:"what is on "+c},get_json:function(a,b,d,e){b({type:"path.to_backside_widget_of_context",type_name:g,backside_index:f},
d,e+1)}}},process_path_json:function(f,g,e){g.next_path&&(f.next=b.UTILITIES.create_from_json(g.next_path,e));g.removing_widget&&(f.removing_widget=!0);g.not_to_be_dereferenced&&(f.not_to_be_dereferenced=!0);g.is_backside&&(f.is_backside=!0)},top_level_backside:{dereference_path:function(f){if(f=f.get_context().ancestor_of_type&&f.get_context().ancestor_of_type("top-level"))return f;h||(h=b.widget.create_top_level_widget());return h},toString:function(){return"the top-level backside"},get_json:function(b,
g,e,a){g({type:"path.top_level_backside"},e,a+1)}}}}(window.TOONTALK);window.TOONTALK.publish=function(b){var h=function(b,g,e){var a='<!DOCTYPE html>\n<html>\n<head>\n<script src="https://toontalk.github.io/ToonTalk/toontalk.js?published=1">\x3c/script>\n<title>\n'+b+"</title>\n</head>\n<body>\n";g.forEach(function(b,d){a+='<div class="toontalk-edit" contenteditable="true">\n'+b+"\n</div>\n";e[d]&&(a+=e[d])});return a+="</body>\n</html>\n"};return{publish_widget:function(f,g,e,a){var c=b.google_drive.get_status(),d=["Edit this. Select text for formatting."],k=function(c){(c=
c&&c.items&&0<c.items.length&&c.items[0])?a(c,m):(c=h(f,d,m),b.google_drive.upload_file(t,"html",c,a))};if("Ready"===c){var t=g.get_setting("program_name");if(e)b.UTILITIES.get_json_top_level(g,function(a){g.set_setting("program_name",t+" (published version)");m=[b.UTILITIES.toontalk_json_div(a,g)];g.set_setting("program_name",t)});else{e=g.get_backside_widgets();var m=[];e.forEach(function(a,c){a.visible()&&b.UTILITIES.get_json_top_level(a,function(c){c.view&&(c.view.saved_width=void 0,c.view.saved_height=
void 0);m.push(b.UTILITIES.toontalk_json_div(c,a.get_widget()));d.push("")})})}b.google_drive.get_toontalk_files(b.google_drive.full_file_name(t,"page"),"page",k)}else console.log("Unable to publish to Google Drive because: "+c),a(null)},republish:function(f){b.google_drive.insert_or_update_file(void 0,f.file_id,"page",h(f.title,f.editable_contents,f.widgets_json),function(){console.log("Published page '"+f.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK?window.TOONTALK.google_drive.handle_client_load():setTimeout(handle_client_load,1E3)}
window.TOONTALK.google_drive=function(b){var h=b.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",f=b.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",g="Need to authorize",e,a;return{handle_client_load:function(a){0>window.location.href.indexOf(f)?(g="Connections to Google Drive are configured for the following domain only: "+f+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",
a?a(g):console.log(g)):setTimeout(function(){b.google_drive.check_authorization(a)})},check_authorization:function(a){g="Awaiting authorization";gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(c){b.google_drive.handle_authorization_result(c,a)})},handle_authorization_result:function(a,d){a&&!a.error?(g="Authorized but not yet ready",gapi.client.load("drive","v2",function(){b.google_drive.get_folder_ids(function(){g="Ready";"undefined"!==typeof CKEDITOR&&
$(".toontalk-edit").each(function(a,c){CKEDITOR.inline(c);b.UTILITIES.can_receive_drops(c)})})}),d&&d()):(g="Need to authorize",d&&d(g))},authorize:function(a){gapi.auth.authorize({client_id:h,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(c){b.google_drive.handle_authorization_result(c,a)})},get_folder_ids:function(c){b.google_drive.get_folder_id(!0,function(d){e=d;b.google_drive.get_folder_id(!1,function(b){a=b;c()})})},get_folder_id:function(c,d){var f=c?"ToonTalk Programs":
"ToonTalk Pages",g=function(a){var e=function(a){a&&a.id?d(a.id):(console.error("Failure to create folder '"+f+"'. Response follows."),console.error(a))};(a=a&&a.items&&0<a.items.length&&a.items[0].id)?d(a):c?b.google_drive.create_folder("ToonTalk Programs",!1,e):b.google_drive.create_folder("ToonTalk Pages",!0,e)};c&&e?d(e):!c&&a?d(a):b.google_drive.fetch_folder_id(f,g)},get_status:function(){return g},connection_to_google_drive_possible:function(){return 0!==g.indexOf("Connections to Google Drive are configured for the following domain only: ")&&
!b.CHROME_APP},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",params:a}).execute(b)},fetch_folder_id:function(a,d){b.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},d)},get_toontalk_files:function(a,d,e){"undefined"===typeof gapi?e("Google Drive API not available."):(d="properties has {key='ToonTalkType' and value='"+d+"' and visibility='PUBLIC'} and trashed = false",a&&(d+=" and title='"+a+"'"),
b.google_drive.list_files({q:d},e))},get_toontalk_program_file:function(a,d){b.google_drive.list_files({q:"'"+e+"' in parents and trashed = false and title='"+a+"'"},function(a){a&&a.items&&0<a.items.length?d(a.items[0]):d(null)})},upload_file:function(a,d,e,f){var c="json"===d?"program":"page",g=a+"."+d;b.google_drive.get_toontalk_files(g,c,function(a){gapi.client.load("drive","v2",function(){var d=a&&a.items&&0<a.items.length&&a.items[0].id;f||(f=function(a){a.error?(console.log("Google drive status: "+
b.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message)):b.debugging&&console.log("File "+a.title+" ("+a.id+") "+(d?"updated":"created"))});d?b.google_drive.insert_or_update_file(void 0,d,c,e,f):b.google_drive.insert_or_update_file(g,void 0,c,e,f)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(c,d,f,g,h){var k={title:c,mimeType:"text/html"};k.parents=[{kind:"drive#fileLink",id:"program"===f?e:a}];g=
"\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(k)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+g+"\r\n---------314159265358979323846--";if(c){k="/upload/drive/v2/files";var m="POST"}else k="/upload/drive/v2/files/"+d,m="PUT";gapi.client.request({path:k,method:m,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:g}).execute(function(a){d||b.google_drive.insert_property(a.id,
"ToonTalkType",f,"PUBLIC");a.error?console.log("Unable to access file "+(c||d)+" due to error: "+a.error.message):h&&h(a)})},create_folder:function(a,b,e){void 0===gapi.client.drive?console.log("Expected gapi.client.drive to be defined to accesss Google drive."):gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){e(a)})}:
e)},download_file:function(a,d){if(a.downloadUrl){var c=gapi.auth.getToken().access_token;b.UTILITIES.download_file(a.downloadUrl,d,c)}else d(null)},google_drive_url:function(a,d){return"function"===typeof b.cross_origin_url_function?(a=b.cross_origin_url_function("https://drive.google.com/uc?id="+a),b.TOONTALK_URL+"published.html"+window.location.search+(window.location.search?"&":"?")+"replace-with-url="+encodeURIComponent(a)):"https://drive.google.com/uc?export=download&id="+a},insert_property:function(a,
b,e,f){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:e,visibility:f}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){window.TOONTALK.translate_element=new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(b){var h={},f=!1,g=100,e=[],a=[],c=new MutationObserver(function(a){a.forEach(function(a){var b;for(b=0;b<a.addedNodes.length;b++){var c=a.addedNodes.item(b);if(1===c.nodeType){if(!c.toontalk_widget_side&&$(c).is(".toontalk-side")){$(c).remove();break}setTimeout(function(){!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),c.toontalk_attached_callback=
void 0,c.toontalk_run_even_if_not_observable=void 0);$(c).find(".toontalk-has-attached-callback").each(function(a,b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)})})}$(c.parentElement).is(".toontalk-frontside")?$(c).css({"z-index":""}):$(c.parentElement).is(".toontalk-backside")&&$(c).css({"z-index":h.next_z_index()})}})}),d=function(){var a=new MutationObserver(function(a){a.forEach(function(a){(a=
$(a.target).closest(".toontalk-translation-element").get(0))&&a.toontalk_callback&&(a.toontalk_callback(a.innerText),a.innerText="",a.toontalk_callback=void 0)})});$("a").each(function(a,b){b.href=h.add_URL_parameter(b.href,"translate","1")});if(!$("#google_translate_element").is("*")){var c=document.createElement("div");c.id="google_translate_element";document.body.insertBefore(c,document.body.firstChild)}document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]);
b.CHROME_APP||N("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit");var d=document.createElement("div");d.className="toontalk-translation-element";document.body.appendChild(d);a.observe(d,{characterData:!0,subtree:!0});h.translate=function(a,b){d.innerHTML=a;d.toontalk_callback=b}},k=function(a,b,c){if(a){var d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},t=function(a,c){b.debugging+="\n"+a;console.log(a);
c&&(alert(b.debugging),b.debugging="touch")},m=function(a){var b=a.indexOf("<div style='display:none;'>{");b=0>b?a.indexOf("{"):b+27;var c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},l=function(a){var c=a.currentTarget;if(!$(c).is(".toontalk-conditions-contents")){var d=$(c).closest(".toontalk-side"),e=h.get_mouse_or_first_touch_event_attribute("clientX",a),f=h.get_mouse_or_first_touch_event_attribute("clientY",a),g;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");
if(!(a.dataTransfer&&a.dataTransfer.getData("text")&&0<a.dataTransfer.getData("text").length&&0!=a.dataTransfer.getData("text").indexOf("data:"))){D=d||$(c);var p=h.widget_side_of_jquery(D);if(!p){p=h.widget_side_of_element(c);h.report_internal_error("Possible bug that "+D+" doesn't have a known owner.");if(!p){h.report_internal_error("The element doesn't have an owner either.");return}D=$(c)}p=p.get_selection();D=$(p.get_element());h.get_dragee_copy()&&h.get_dragee_copy().render();p.set_stopped&&
p.set_stopped(!0);!p.save_dimensions||p.get_parent_of_frontside()&&!p.get_parent_of_frontside().get_widget().is_top_level()||p.save_dimensions();p.being_dragged=!0;var k=D.get(0).getBoundingClientRect();var l=D.is(".toontalk-top-level-resource");$(c).removeClass("toontalk-wiggle");p.get_json&&(c=function(b){b.view.drag_x_offset=e-k.left;b.view.drag_y_offset=f-k.top;!b.view.frontside_width&&D.parent().is(".toontalk-backside")&&(b.view.frontside_width=D.width(),b.view.frontside_height=D.height());D&&
D.data("json",b);if(a.dataTransfer)try{g=h.toontalk_json_div(b,p),a.dataTransfer.effectAllowed=l?"copy":"move",a.dataTransfer.setData("text",g),h.is_internet_explorer()||a.dataTransfer.setData("text/html",g)}catch(ia){}p.drag_started&&p.drag_started(b,l)},b.UTILITIES.get_json_top_level(p,c,6E5));D.addClass("toontalk-being-dragged");(c=p.get_listeners("picked up"))&&c.map(function(a){a()});a.stopPropagation()}}},w=function(a){var b;if(!$(a.currentTarget).is(".toontalk-conditions-contents")){D||(D=
$(a.target).closest(".toontalk-side"));if(b=h.widget_side_of_jquery(D))b.being_dragged=void 0,(b=b.get_listeners("dropped"))&&b.map(function(a){a()});D.is(".toontalk-frontside")&&(D.parent().is(".toontalk-backside")?(b=D.data("json"))&&h.set_css(D,{width:b.view.frontside_width,height:b.view.frontside_height}):D.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||D.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||
h.has_animating_image(D.get(0))||h.set_css(D,{width:"100%",height:"100%"}));J();a.stopPropagation()}},r=function(a){if(D)return h.widget_side_of_jquery(D);if(a)return a=h.data_transfer_json_object(a),h.create_from_json(a)},v=function(a){var c=a.currentTarget,d=h.data_transfer_json_object(a),e=function(a,d){a=h.create_from_json(a);d=document.createElement("div");var e=a.get_element(!0),f=$(c).closest(".toontalk-edit"),g=b.published_support.create_editable_text();$(d).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");
$(e).addClass("toontalk-top-level-resource").css({position:"relative",width:a.saved_width,height:a.saved_height});e.toontalk_widget_side=a;d.toontalk_widget_side=a;d.appendChild(e);$(d).insertAfter(f);$(g).insertAfter(d);CKEDITOR.inline(g);h.can_receive_drops(g);a.set_visible(!0);a.render()},f=function(){k.hide();var a=document.elementFromPoint(m-window.pageXOffset-b.USABILITY_DRAG_OFFSET.x,n-window.pageYOffset-b.USABILITY_DRAG_OFFSET.y);k.show();if(a)return $(a).closest(".toontalk-side")},g,p;void 0===
d&&D&&(d=D.data("json"));D&&D.data("json","");var k=D;J();if(k||void 0!==d||a.dataTransfer.files||C(a)){if($(a.target).is(".toontalk-drop-area-instructions"))e=$(a.target).parent();else if($(a.target).is(".toontalk-element-attribute-input")){if(e=$(a.target).closest(".toontalk-side"),g=h.widget_side_of_jquery(e)){var l=k?h.widget_side_of_jquery(k):h.create_from_json(d);h.restore_resource(k,l);g.dropped_on_style_attribute(l,a.target.name,a);a.stopPropagation();return}}else if($(a.target).is(".toontalk-drop-area"))e=
$(a.target);else{if(d&&$(a.currentTarget).is(".toontalk-edit")){e(d,a);return}k&&k.is(".toontalk-backside")?e=$(a.target).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):(e=$(a.target).closest(".toontalk-side"),0<e.length&&k&&K(e.get(0),k.get(0))&&(e=k.parent().closest(".toontalk-side")))}if(0!==e.length){var m=h.get_mouse_or_first_touch_event_attribute("pageX",a);var n=h.get_mouse_or_first_touch_event_attribute("pageY",a);if(e.is(".toontalk-top-level-resource"))if("touchend"===
a.type){e=$(".toontalk-highlight");if(0===e.length||e.get(0)===k.get(0))e=f();if(!e||0===e.length)return}else return;var r=e.offset();g=h.widget_side_of_jquery(e);if(k&&0<k.length&&!(g&&g.get_widget().get_infinite_stack&&g.get_widget().get_infinite_stack())&&(k.get(0)===e.get(0)||jQuery.contains(k.get(0),e.get(0)))){if(k.is(".toontalk-backside-of-top-level"))return;e=$(".toontalk-highlight");if(0===e.length||e.get(0)===k.get(0))e=f();if(!e||0===e.length)return;r=e.offset();f=h.widget_side_of_jquery(e);
if(!g||g.is_backside()&&f.is_backside()||!g.is_backside()&&!f.is_backside())g=f}h.remove_highlight();if(d&&d.view&&d.view.drag_x_offset){f=d.view.drag_x_offset;var t=d.view.drag_y_offset}else t=f=0;if(k&&0<k.length){if(!(g&&g.get_widget().get_infinite_stack&&g.get_widget().get_infinite_stack()||k.get(0)!==e.get(0)&&!jQuery.contains(k.get(0),e.get(0)))){h.set_css(k,{left:k.get(0).offsetLeft+(a.layerX-f),top:k.get(0).offsetTop+(a.layerY-t)});a.stopPropagation();return}l=h.widget_side_of_jquery(k);if(k.parent().is(".toontalk-drop-area"))k.removeClass("toontalk-widget-in-drop_area"),
"function"===typeof k.parent&&k.parent().data("drop_area_owner").set_next_robot(void 0);else{if(p=l&&l.get_parent()){var u=$(p.get_element());!l.is_backside()&&l.get_widget().get_infinite_stack&&l.get_widget().get_infinite_stack()?(u=l.get_widget().saved_width,p=l.get_widget().saved_height,l=h.get_dragee_copy(),l.get_widget().saved_width=u,l.get_widget().saved_height=p,u=k.width(),p=k.height(),k=$(l.get_element(!0)),e.is(".toontalk-backside")&&h.set_css(k,{width:d.view.frontside_width||u,height:d.view.frontside_height||
p}),l.update_display()):p.removed_from_container&&(u.is(".toontalk-backside")?p.remove_backside_widget(l,!0):(p.removed_from_container(l,a),l.restore_dimensions&&!p.is_empty_hole()&&l.restore_dimensions()))}else h.restore_resource(k,l);l&&l.robot_in_training()&&l.robot_in_training().add_newly_created_widget_if_new(l)}}else{if(d)l=h.create_from_json(d,{event:a});else{if(0<a.dataTransfer.files.length){for(d=0;d<a.dataTransfer.files.length;d++)z(a.dataTransfer.files[d],e,g,r,a);a.stopPropagation();return}if(C(a)){M(a.dataTransfer.getData("URL"),
e,g,r,a);a.stopPropagation();return}}if(!l){d?h.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):b.debugging&&console.log("No data transfer in drop.");a.stopPropagation();return}l.robot_in_training()&&l.robot_in_training().drop_from_data_transfer(l);k=$(l.get_element(!0));l.is_primary_backside&&l.is_primary_backside()&&(h.set_css(k,{width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width}),
l.apply_backside_geometry())}g&&l&&!l.is_backside()&&l.get_widget()===g.get_widget()||l&&y(e,k,l,g,r,a,d,f,t)}}else a.dataTransfer?h.report_internal_error("Drop failed since unable to parse as JSON."):h.report_internal_error("Drop failed since there is no event.dataTransfer"),a.stopPropagation()},n=function(a,b){a.addEventListener("drop",function(a){var c=r(a);h.restore_resource(h.get_$dragee(),c);b(a)});h.can_receive_drops(a)},u=function(a,b){var c=h.get_$dragee();var d=c&&c.is(".toontalk-backside")?
$(b).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):$(b).closest(".toontalk-side");$(b).is(".toontalk-drop-area")&&c.is(".toontalk-robot")?($(b).addClass("toontalk-highlight"),b=void 0):($(b).is(".toontalk-box-size-input")||$(b).is(".toontalk-numerator-input")||$(b).is(".toontalk-denominator-input"))&&c.is(".toontalk-number")?($(b).addClass("toontalk-highlight"),b=void 0):b=!d.is("*")||d.is(".toontalk-backside-of-top-level")||d.closest(".toontalk-top-level-resource").is("*")||
d.is(".toontalk-being-dragged")||c&&K(d.get(0),c.get(0))?void 0:d;if(b)return h.highlight_element(b.get(0),a),b.get(0)},y=function(a,c,d,e,f,g,k,l,m){var p=h.get_mouse_or_first_touch_event_attribute("pageX",g),q=h.get_mouse_or_first_touch_event_attribute("pageY",g);l||(l=0);m||(m=0);d.set_visible(!0);k&&k.semantic&&k.semantic.running&&h.set_timeout(function(){d.set_running(!0)},100);if(a.is(".toontalk-backside")){if(d.get_widget().is_top_level()){var H=k.semantic.backside_widgets;var n=k.shared_widgets;
var A=a.get(0);(l=e.robot_in_training())&&l.drop_from_data_transfer(d,e);l=d.get_backside_widgets().slice();b.UTILITIES.for_each_batch(l,function(a,b){var c=a.get_widget();d.remove_backside_widget(a);b=0<=H[b].widget.shared_widget_index?n[H[b].widget.shared_widget_index].view:H[b].widget.view;var f=a.get_element(!0);if(!K(f,A)){if(a.is_backside()){var g=b.backside_left;var p=b.backside_top;var k=b.backside_width;var q=b.backside_height}else g=b.frontside_left,p=b.frontside_top,k=b.frontside_width,
q=b.frontside_height;e.add_backside_widget(a);A.appendChild(f);var l=$(f).position();S={left:l.left+g,top:l.top+p};a.is_resizable()&&(S.width=k,S.height=q);h.constrain_css_to_fit_inside(A,S);h.set_css(f,S);d.set_location_attributes&&c.set_location_attributes(S.left,S.top);a.is_backside()&&(c.backside_geometry=b.backside_geometry,c.apply_backside_geometry())}}.bind(this));e.top_level_widget().backup_all();return}if(!e){h.report_internal_error("No target_widget");return}d?e.widget_side_dropped_on_me(d,
{event:g}):h.report_internal_error("No source_widget");g=p-(f.left+(l||0));a=q-(f.top+(m||0));var S={left:h.left_as_percent(g,c.get(0)),top:h.top_as_percent(a,c.get(0))};h.set_css(c,S);!d.is_backside()&&d.set_location_attributes&&d.set_location_attributes(g,a);k&&k.semantic&&k.semantic.running&&!h.get_$dragee()&&d.set_running(!0)}else if(a.is(".toontalk-drop-area"))c.addClass("toontalk-widget-in-drop_area"),0<a.length&&a.get(0).appendChild(c.get(0)),c.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(h.widget_side_of_jquery(c));
else{if(c.is(".toontalk-backside-of-top-level"))return;if(e||g.changedTouches){A=a.closest(".toontalk-backside-of-top-level").get(0);!A&&g.changedTouches&&(k=document.elementFromPoint(p-window.pageXOffset,q-window.pageYOffset),(A=$(k).is(".toontalk-backside-of-top-level")?k:$(k).closest(".toontalk-backside-of-top-level").get(0))||(A=$(".toontalk-backside-of-top-level").get(0)),e=h.widget_side_of_element(A).get_backside());if(!A)return;A.appendChild(c.get(0));k=$(A).offset();S={left:p-(k.left+l+b.USABILITY_DRAG_OFFSET.x),
top:q-(k.top+m+b.USABILITY_DRAG_OFFSET.y)};h.set_css(c,S);d.remove_from_parent_of_frontside&&d.remove_from_parent_of_frontside(g);d.set_visible(!0);d.drop_on&&d.drop_on(e,{event:g})||e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(d,{event:g})||(c=a.closest(".toontalk-backside-of-top-level"),0<c.length&&(e=h.widget_side_of_jquery(c))&&e.widget_side_dropped_on_me(d,{event:g}))}else{console.log("Warning: when handling a drop event the target widget was missing.");return}}b.logging&&0<=b.logging.indexOf("drop")&&
(console.log("Drop of "+d._debug_id+" on "+e._debug_id),console.log("Left: "+S.left+"; top: "+S.top+"; page_x: "+p+"; page_y: "+q+"; drag_x_offset: "+l+"; drag_y_offset: "+m));h.remove_highlight()},z=function(a,c,d,e,f){var g=new FileReader,p=0===a.type.indexOf("image"),k=0===a.type.indexOf("audio"),q=0===a.type.indexOf("video"),l,H,n;g.onloadend=function(){if(p)l=b.element.create("<img src='"+g.result+"' class = 'toontalk-image' alt='"+a.name+"'/>");else if(k){l=b.element.create(a.name+" sound");
var A=new Audio(g.result);A.addEventListener("event",function(a){h.display_message("Error trying to play a sound: "+a.message)});l.set_sound_effect(A)}else if(q)l=b.element.create("<video src='"+g.result+"' alt='"+a.name+"'/>");else{if(H=m(g.result))try{(n=h.parse_json(H))&&(l=h.create_from_json(n))}catch(Ra){}l||(l=b.element.create(g.result))}l&&l.robot_in_training()&&l.robot_in_training().drop_from_data_transfer(l,d);y(c,$(l.get_frontside_element(!0)),l,d,e,f,n)};p||k||q?g.readAsDataURL(a):g.readAsText(a)},
M=function(a,c,d,e,f){var g,p=function(a,c,e,f){var p=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),y(c,$(a.get_frontside_element(!0)),a,d,e,f))};h.create_widget_from_URL(a,p,function(c){var d=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");d?(g=d,p(b.element.create(d))):(d=g?b.element.create("<div class='toontalk-iframe-container'><iframe srcdoc='"+g+"' width='480' height='320'></iframe></div>"):b.element.create("<div class='toontalk-iframe-container'><iframe src='"+
a+"' width='480' height='480'></iframe></div>"),p(d),console.log("Error loading URL. Loading it in an iframe instead. URL is "+a),console.log(c))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&p(a,c,e,f)})},B=function(a,b){var c=$("<div class='"+a+"'>");h.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},G=function(){var a=h.get_path_to_toontalk_folder()+"sounds/",c=function(b){b=new Audio(a+
b);b.volume=h.get_audio_volume(b);return b};try{b.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),event_ignored:c("PLOP.mp3")},b.sounds.bird_fly.loop=!0}catch(H){}},N=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},J=function(){D&&(D.removeClass("toontalk-being-dragged"),
h.set_timeout(function(){V=R=D=void 0}))},K=function(a,b){if(a===b)return!0;if(a.parentNode)return K(a.parentNode,b)},Q=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="";if(0>f)return a;for(;0<=f;){var p=f+d.length;var k=a.indexOf(e,p);if(0>k)return h.report_internal_error("Expected title to have matching pairs of "+d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(p,k));c=
k+e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},C=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},I=function(a){var c=h.get_current_url_parameter("replace-with-url");if(c){var d=decodeURIComponent(c);h.download_file(d,function(c){var e;if(c)if(e=O(c,"body")){if(c=O(c,"title",!0))document.title=c;c=document.createElement("div");c.innerHTML=e;document.body.appendChild(c);a();0<=d.indexOf("drive.google.com")&&b.google_drive.connection_to_google_drive_possible()&&
(e=decodeURIComponent(d),e=e.substring(e.lastIndexOf("id=")+3),$(".toontalk-edit").attr("contenteditable",!0),b.published_support&&b.published_support.send_edit_updates(e))}else h.display_message("Expected contents of "+d+" to contain a body element.");else h.display_message("Unable to read contents of "+d)},"object"==typeof gapi&&gapi.auth&&gapi.auth.getToken()&&gapi.auth.getToken().access_token)}else h.display_message("Expected a url=... parameter in the URL.")},O=function(a,b,c){var d=a.indexOf("<"+
b);if(!(0>d)){var e=a.indexOf("</"+b+">");if(!(0>e))return c?a.substring(d+2+b.length,e):a.substring(d,e+3+b.length)}},T=[],F=[],D,R,V,aa,X;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window&&(a.stopPropagation(),0<T.length&&(a=T.shift(),"function"===typeof a&&a()))},!1);c.observe(window.document,{childList:!0,subtree:!0});h.available_types="number box element robot nest sensor top-level".split(" ");h.create_from_json=function(a,c,d,e){var f=function(a,
b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},g,p,k;if(a){c||(c={});c.guid_to_nest_table||(c.guid_to_nest_table={});a.shared_widgets&&(c.json_of_shared_widgets=a.shared_widgets,c.shared_widgets=[]);a.shared_html&&(a.shared_html=a.shared_html.map(function(a){return Array.isArray(a)?a.join(""):a}),c.shared_html=a.shared_html);if(a.widget)return(g=h.create_from_json(a.widget,c))&&
a.is_backside?g.get_backside(!0):g;if(c&&c.shared_widgets&&0<=a.shared_widget_index){if(d=c.shared_widgets[a.shared_widget_index])return d;d=c.json_of_shared_widgets[a.shared_widget_index];g=b.creators_from_json[d.semantic.type]();c.shared_widgets[a.shared_widget_index]=g;g=h.create_from_json(d,c,g,!0);return f(g,c,a.shared_widget_index)}(k=a.semantic)||(k=a);var q=a.view;if(0<=k.shared_widget_index){if(!c.json_of_shared_widgets){h.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");
return}g=h.create_from_json(c.json_of_shared_widgets[k.shared_widget_index],c,d,!0);return f(g,c,k.shared_widget_index)}if(k.type){if(b.creators_from_json[k.type]){c||(c={});q?c.json_view=q:q=c.json_view;if(b.debugging)g=b.creators_from_json[k.type](k,c,d);else try{g=b.creators_from_json[k.type](k,c,d)}catch(ia){console.error(ia.stack),h.report_internal_error("Unable to recreate a "+k.type+". Error is "+ia+". JSON is "+JSON.stringify(a,h.clean_json,"  "))}g&&!g.is_widget&&b.path.process_path_json(g,
a,c);if(g&&g.get_backside){k.erased&&(b.widget.erasable(g),g.set_erased(k.erased));k.infinite_stack&&g.set_infinite_stack(k.infinite_stack);k.open_backside_only_if_stopped&&g.set_open_backside_only_if_stopped(!0);if(q){if(q.frontside_width)if(p=g.get_element()){if(g.ok_to_set_dimensions()){var l={width:q.frontside_width,height:q.frontside_height};if("element"===k.type)g.on_update_display(function(){h.set_css(p,l)});else h.set_css(p,l)}}else!q.saved_width&&g.is_resizable()&&(g.saved_width=q.frontside_width,
g.saved_height=q.frontside_height);q.saved_width&&g.is_resizable()&&(g.saved_width=q.saved_width,g.saved_height=q.saved_height);q.backside_geometry&&(g.backside_geometry=q.backside_geometry);g.json_view=q}k.backside_widgets&&(e?g.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(g,k.backside_widgets,c)}.bind(this):this.add_backside_widgets_from_json(g,k.backside_widgets,c))}return g}h.report_internal_error("JSON type '"+k.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}else b.UTILITIES.report_internal_error("No type attribute given in "+
JSON.stringify(k,h.clean_json,"  "))}};h.add_backside_widgets_from_json=function(a,b,c){if(b){var d=this.create_array_from_json(b,c);a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a}))}};h.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?h.create_from_json(a,b):a});return c};h.get_json_of_array=
function(a,c,d,e,f,g,k){var p;if(k>b.maximum_recursion_depth)throw{toontalk_continuation:function(){h.get_json_of_array(a,c,d,e,f,Date.now(),0)}};if(d>=a.length)f(k+1);else if(p=a[d])if(p.is_primary_backside&&p.is_primary_backside()){var q=function(b,g,p){c.push({widget:b,is_backside:!0});this.get_json_of_array(a,c,d+1,e,f,g,p+1)}.bind(this);h.get_json(p.get_widget(),e,q,g,k+1)}else p.is_widget?(q=function(p,k,q){c.push({widget:p});q>b.maximum_recursion_depth||0===d%100&&(!h.maximum_json_generation_duration||
Date.now()-g>h.maximum_json_generation_duration)?h.set_timeout(function(){this.get_json_of_array(a,c,d+1,e,f,k,0)}.bind(this)):this.get_json_of_array(a,c,d+1,e,f,k,q+1)}.bind(this),h.get_json(p,e,q,g,k+1)):(q=function(b,g,p){c.push(b);this.get_json_of_array(a,c,d+1,e,f,g,p+1)}.bind(this),p.get_json(e,q,g,k+1));else h.get_json_of_array(a,c,d+1,e,f,g,k+1)};h.fresh_json_history=function(a){var b={widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=
a.shared_html);return b};h.get_json_top_level=function(a,b,c){var d=this.fresh_json_history(),e=function(c){var e=function(a){a=d.widgets_encountered.indexOf(a);return d.json_of_widgets_encountered[a]},f=function(a){return e(d.shared_widgets[a])},g=d.shared_widgets.map(e);if(0<d.shared_widgets.length&&c.semantic){g=d.shared_widgets.map(e);c.shared_widgets=d.shared_widgets.map(function(b,c){c=e(b);return a===b?{semantic:c.semantic,view:c.view,version:c.version}:c});var p=d.shared_widgets.slice().sort(function(a,
b){return a.is_nest()?-1:b.is_nest()?1:a.has_ancestor_either_side(b)?-1:b.has_ancestor_either_side(a)?1:0});p.map(function(a){a=d.shared_widgets.indexOf(a);h.tree_replace_once(c.semantic,g[a],{shared_widget_index:a},f,h.generate_unique_number())});a===p[p.length-1]&&(c.semantic={shared_widget_index:d.shared_widgets.indexOf(a)})}c.shared_html=d.shared_html;b(c)};h.maximum_json_generation_duration=c;try{h.get_json(a,d,e,Date.now(),0)}catch(A){if(A.toontalk_continuation)A.toontalk_continuation();else throw A;
}};h.get_json=function(a,c,d,e,f){if(b.debugging&&!c)h.report_internal_error("no json_history");else{void 0===f&&(f=0);var g=c.shared_widgets.indexOf(a);if(0<=g)d({shared_widget_index:g},e,f+1);else if(g=c.widgets_encountered.indexOf(a),0<=g)g=c.shared_widgets.push(a)-1,d({shared_widget_index:g},e,f+1);else{g=c.widgets_encountered.push(a)-1;a.is_primary_backside&&a.is_primary_backside()&&(a=a.get_widget());var p=function(b,e,f){a.add_to_json&&(b=a.add_to_json(b,c));c.json_of_widgets_encountered[g]=
b;if(a.add_backside_widgets_to_json){var p=function(a){d(b,e,a+1)};a.add_backside_widgets_to_json(b,c,p,e,f+1)}else d(b,e,f+1)};if(Date.now()-e<=h.maximum_json_generation_duration&&f<b.maximum_recursion_depth)try{a.get_json(c,p,e,f+1)}catch(da){if(da.toontalk_continuation)throw da;if(h.is_stack_overflow(da))throw{toontalk_continuation:function(){a.get_json(c,p,Date.now(),0)}};h.display_message("Failed to save your project due to error: "+da.message,{only_if_new:!0})}else h.avoid_stack_overflow(function(){a.get_json(c,
p,Date.now(),0)})}}};h.avoid_stack_overflow=function(a){h.set_timeout(function(){try{a()}catch(q){if(q.toontalk_continuation)q.toontalk_continuation();else throw q;}})};h.get_json_of_keys=function(a,c,d,e,f){var g;c||(c=[]);Object.keys(a).forEach(function(d){0>c.indexOf(d)&&(g||(g={}),a[d].get_json?b.path.get_json(a[d],void 0,function(a,b,c){g[d]={json:a}},e,f+1):g[d]=a[d])});d(g,e,f+1)};h.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?h.create_from_json(a[d].json,
b):a[d]});return c};h.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).some(function(g){f=a[g];if(null!==f){if(f===b)return a[g]=c,!0;if("shared_widget_index"!==g&&!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};h.toontalk_json_div=function(a,b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name();c=c.toString({for_json_div:!0});
"top-level"===e?b.is_backside()?(a.semantic&&(a.semantic.settings=void 0),e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),e+=h.describe_widgets(d))):e="a top-level widget":(e=h.add_a_or_an(e),b.is_backside()&&(e="the back of "+e));c&&(b=c.indexOf("data:image/"),0<b&&(d=c.indexOf("alt=",b),0>d&&(d=c.indexOf(">",b)),c=c.substring(0,b+20)+" ... "+c.substring(d)));try{return"<div class='toontalk-json notranslate' translate='no' style='display:none'>\nThis will be replaced by "+
e+".\n"+(c?c+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,h.clean_json,"  ")+"</div></div>"}catch(A){return h.is_stack_overflow(A)?"<div>\n"+e+" is nested too deep to create a JSON string to save it.\nYou may be able to launch your browser with a larger stack.\n"+(c?c+"\n":"")+"</div>":"<div>\n"+e+" triggered the following error during save: "+A.message+(c?c+"\n":"")+"</div>"}};h.describe_widgets=function(a){var b="",c=a.length;a.forEach(function(a){c--;b+=h.add_a_or_an(a.get_type_name());
1===c?b+=", and ":1<c&&(b+=", ")});return b};h.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};h.strip_trailling_digits=function(a){if(0===a.length)return a;var b=a[a.length-1];return"0"<=b&&"9">=b?h.strip_trailling_digits(a.substring(0,a.length-2)):a};h.clean_json=function(a,b){if("id_of_tree_replace_once_task"!==a)return"number"!==typeof b||"left_offset_fraction"!==
a&&"top_offset_fraction"!==a&&"drag_x_offset"!==a&&"drag_y_offset"!==a?b:parseFloat(b.toPrecision(3))};h.create_widget_from_URL=function(a,c,d,e){var f=function(k){try{var q=this.getResponseHeader("content-type");if(!q){var l=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");if(0===a.indexOf(l))q="";else{d&&(d("Could not determine the contents type of the url"),d=function(){});p.removeEventListener("load",f);return}}if(0===q.indexOf("audio")||
g(e,"audio")){var m=b.element.create(e||a);var n=new Audio(e||a);n.addEventListener("event",function(b){h.display_message("Error trying to play a sound from "+(e||a)+". Errror is "+b.message)});m.set_sound_effect(n)}else 0===q.indexOf("image")||g(e,"image")?m=b.element.create("<img src='"+(e||a)+"' class = 'toontalk-image' alt='"+a+"'/>"):0===q.indexOf("video")||g(e,"video")?m=b.element.create("<video src='"+(e||a)+" ' width='320' height='240'>"):0===q.indexOf("text")&&(0>q.indexOf("text/html")||
a.indexOf(".txt")===a.length-4)?this.responseText&&(m=b.element.create(this.responseText),m.set_source_URL(a,!0)):m=b.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");m&&c(m)}catch(Ea){d&&(d(Ea),d=function(){}),c()}p.removeEventListener("load",f)},g=function(a,b){var c=a.lastIndexOf(".");if(0<=c)switch(a=a.substring(c+1),c=a.indexOf("?"),0<c&&(a=a.substring(0,c)),b){case "image":return"png jpg jpeg gif PNG JPG JPEG GIF".split(" ").includes(a);
case "audio":return["wav","mp3","WAV","MP3"].includes(a);case "video":return["mp4","MP4"].includes(a)}},p=new XMLHttpRequest;p.addEventListener("load",f);p.open("GET",a,!0);p.onerror=function(e){b.is_already_cross_origin_url&&!b.is_already_cross_origin_url(a)?h.create_widget_from_URL(b.cross_origin_url_function(a),c,d,a):d?(d(e),d=function(){}):(h.display_message("Error trying to GET "+a+" "+e),e.stack&&console.error(e.stack))};p.send()};h.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=
a[d]&&a[d].copy(b);return c};h.copy_widget_sides=function(a,b){var c=[];a.forEach(function(a){if(a){var d=a.get_widget().copy(b);a.is_backside()?c.push(d.get_backside(!0)):c.push(d)}});return c};h.copy_array=function(a){return a.slice()};h.generate_unique_id=function(){X+=1;return"toontalk_id_"+X};h.generate_unique_number=function(){return X+=1};h.get_style_property=function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle){if(a.parentElement)return document.defaultView.getComputedStyle(a,
null).getPropertyValue(b);document.body.appendChild(a);b=document.defaultView.getComputedStyle(a,null).getPropertyValue(b);document.body.removeChild(a);return b}};h.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b);if("string"===typeof c){var d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;a=parseFloat(c,10);return isNaN(a)?void 0:a}return c};h.get_element_width=function(a){return a?a.getBoundingClientRect().width:
0};h.get_element_height=function(a){return a?a.getBoundingClientRect().height:0};h.cached_selectors={};h.get_toontalk_css=function(a){var b;if(h.cached_selectors[a])return h.cached_selectors[a];for(b=0;b<document.styleSheets.length;b++){var c=document.styleSheets[b];if(c.href&&0<=c.href.indexOf("toontalk.css")){a:{if(c=c.cssRules)for(b=0;b<c.length;b++)if(c[b].selectorText===a){h.cached_selectors[a]=c[b].cssText;a=c[b].cssText;break a}a=void 0}return a}}};h.get_toontalk_css_attribute=function(a,b){b=
h.get_toontalk_css(b);if(b){var c=b.indexOf(a+": ");if(!(0>c))return c+=(a+": ").length,a=b.indexOf(";",c),b.substring(c,a)}};h.get_toontalk_css_numeric_attribute=function(a,b){if(a=h.get_toontalk_css_attribute(a,b))if(b=a.indexOf("px"),0<=b)return+a.substring(0,b)};h.data_transfer_json_object=function(a){var c,d;if(a.dataTransfer){try{var e=a.dataTransfer.getData("text/html")}catch(P){e=a.dataTransfer.getData("text")}if(!e||e.match(/[\u3400-\u9FBF]/))e=a.dataTransfer.getData("text");if(e){if(c=m(e)){if(d=
h.parse_json(c))return d}else if(0<a.dataTransfer.files.length||C(a))return;a=b.element.create("");a.get_frontside_element(!0);e&&"<"===e[0]?a.set_HTML(e):a.set_text(e);a.get_json(h.fresh_json_history(),function(a,b,c,e){0<=a.html.shared_html_index&&(a.html=e.shared_html[a.html.shared_html_index]);d=a},Date.now(),0);return d}}};h.parse_json=function(a){try{return JSON.parse(a)}catch(q){h.is_stack_overflow(q)?h.report_internal_error("Exception parsing JSON because the widgets are too deeply nested. Perhaps you can launch the browser with a larger stack size."):
h.report_internal_error("Exception parsing JSON "+q.toString()+" error: "+a)}};h.is_stack_overflow=function(a){return 0===a.message.indexOf("Maximum call stack size exceeded")||0===a.message.indexOf("Stack overflow at line")||0===a.message.indexOf("Too much recursion")||0===a.message.indexOf("Abort (control stack overflow)")};h.drag_and_drop=function(a){h.draggable(a);h.can_receive_drops(a);if(!$(a).is(".toontalk-backside-of-top-level")){var b=$(a).is(".toontalk-top-level-resource")?0:500;h.enable_touch_events(a,
b)}};h.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(a){l(a)});a.addEventListener("dragend",function(a){w(a)});b.together&&(["dragstart","dragend","drag"].forEach(function(b){a.addEventListener(b,h.together_send_message)}),a.addEventListener("drag",function(a){a.simulatedEventMessage&&($(a.target).is(".toontalk-top-level-resource")?$(a.target).css({left:a.pageX-(a.simulatedEventMessage.offsetLeft+a.simulatedEventMessage.dragXOffset),top:a.pageY-(a.simulatedEventMessage.offsetTop+
a.simulatedEventMessage.dragYOffset)}):h.set_position_relative_to_top_level_backside(a.target,{left:a.clientX-a.simulatedEventMessage.dragXOffset,top:a.clientY-a.simulatedEventMessage.dragYOffset}))}))};h.can_receive_drops=function(a){a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",function(a){a.preventDefault();v(a);a.stopPropagation()});b.together&&a.addEventListener("drop",h.together_send_message);h.can_give_mouse_enter_feedback(a)};h.can_give_mouse_enter_feedback=
function(a){var b;a.addEventListener("dragenter",function(c){var d=u(c,a);d&&b!==d&&h.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!h.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(h.remove_highlight(b),b=void 0);a.stopPropagation()})};h.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");
b.appendChild(d);h.can_receive_drops(b);return b};h.process_json_elements=function(a,c,d){var e,f,g,p,k,l;a||(a=$(".toontalk-json"),c=0);if(0!==a.length){var q=function(b){if(g){m.textContent="";$(m).css({display:""});if(g.get_type_name)if(g.is_top_level())l=g.get_backside(!0),k=l.get_element(),$(m).replaceWith(k),$(k).css({width:g.json_view?g.json_view.backside_width:f.view.backside_width,height:g.json_view?g.json_view.backside_height:f.view.backside_height,"background-color":f.view.background_color,
"border-width":f.view.border_width}),g.json_view=void 0;else{if($(m).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),p=g.get_frontside_element(!0))$(p).addClass("toontalk-top-level-resource").css({position:"relative",width:g.saved_width,height:g.saved_height}),m.toontalk_widget_side=g,m.appendChild(p)}else m.appendChild(g.get_element());g.set_active&&g.set_active(!1);setTimeout(function(){g.update_display&&g.update_display();f.semantic.running&&g.set_running(!0)},100)}else h.report_internal_error("Could not recreate a widget from this JSON: "+
e);c<a.length-1&&h.process_json_elements(a,c+1,b+1)};var m=a.get(c);if(e=m.textContent)if(e=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),f=h.parse_json(e))if(f.semantic&&"top_level"===f.semantic.type&&!b.no_local_storage&&!b.reset&&f.load_most_recent_program){var n=function(a){var c=function(){try{g=h.create_from_json(f)}catch(va){console.error(va.stack),console.trace(),h.report_internal_error("An error occurred loading the saved state. Sorry. the error is "+va+" JSON is "+JSON.stringify(f)),
g=b.widget.create_top_level_widget()}d>=b.maximum_recursion_depth?h.avoid_stack_overflow(function(){q(0)}):q(d?d+1:1)};a&&"null"!==a?h.retrieve_object(a,function(a){a&&(f=a,c())}):c()};h.retrieve_string("toontalk-last-key",n)}else(g=h.create_from_json(f))&&g.set_visible&&K(m,document.body)&&g.set_visible(!0),d>=b.maximum_recursion_depth?h.avoid_stack_overflow(function(){q(0)}):q(d?d+1:1)}};h.relative_position_from_absolute_position=function(a,b){a=a.parentElement;var c=b.left;b=b.top;for(var d;a&&
"html"!==a.nodeType;)d=$(a).position(),c-=d.left,b-=d.top,a=a.parentElement;return{left:c,top:b}};h.set_absolute_position=function(a,b){b=h.relative_position_from_absolute_position(a,b);h.set_css(a,{left:b.left,top:b.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=b.left+"px",a.style.top=b.top+"px")};h.set_position_relative_to_top_level_backside=function(a,b,c){a=$(a);var d=a.closest(".toontalk-backside-of-top-level");0===d.length&&(d=$(".toontalk-backside-of-top-level"));
return this.set_position_relative_to_element(a,d,b,c)};h.set_position_relative_to_element=function(a,c,d,e){if(0===c.length)console.log("utilities.set_position_relative_to_element called with a parent element. Ignoring it.");else{var f=c.offset();c.get(0).appendChild(a.get(0));f||(f={left:0,top:0});var g=d.left-f.left;d=d.top-f.top;if(e){e=b.UTILITIES.get_element_width(a.get(0));f=b.UTILITIES.get_element_height(a.get(0));var p=b.UTILITIES.get_element_width(c.get(0));var k=b.UTILITIES.get_element_height(c.get(0));
g>p-e&&(g=p-e);0>g&&(g=0);d>k-f&&(d=k-f);0>d&&(d=0)}g=h.scale_left(g,c.get(0));d=h.scale_top(d,c.get(0));c={left:g,top:d,position:"absolute"};a.is(".toontalk-side-animating")?(a.get(0).style.left=g+"px",a.get(0).style.top=d+"px",h.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=""})):h.set_css(a,c);return c}};h.restore_resource=function(a,c){if(a&&a.is(".toontalk-top-level-resource")){var d=h.get_resource_copy()||
c.copy({fresh_copy:!0});var e=d.get_frontside_element(!0);a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container");a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container");$(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"});a.css({position:"absolute"});h.set_css(e,{width:a.width(),height:a.height()});a.get(0).parentElement.appendChild(e);b.DISPLAY_UPDATES.pending_update(d);c.set_active&&
(c.set_active(!0),d.set_active(!1))}};h.closest_element=function(a,c){var d;if(!c)return a.get(0);var e=Number.MAX_VALUE;a.each(function(a,f){a=$(f).offset();a=b.UTILITIES.distance(a,c);e>a&&(d=f,e=a)});return d};h.find_resource_equal_to_widget=function(a,b){var c=Number.MAX_VALUE,d=$(b.get_frontside_element()).offset(),e;$(".toontalk-top-level-resource.toontalk-side").each(function(b,f){(b=h.widget_side_of_jquery($(f)))&&(a.equals&&a.equals(b)||a.matching_resource&&a.matching_resource(b)||a.get_type_name()===
b.get_type_name()&&"matched"===a.match(b))&&(a.is_hole()||b.get_backside_widgets().length===a.get_backside_widgets().length)&&(b=h.distance($(f).offset(),d),c>b&&(e=f,c=b))});return e};h.set_position_is_absolute=function(a,b,c){if(b){b=h.get_style_numeric_property(a,"left");var d=h.get_style_numeric_property(a,"top");if(c){var e=$(a.parentElement).offset();"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2);"auto"===d&&(d=c.pageY-e.top,d-=90)}h.set_css(a,{left:h.left_as_percent(b,a),top:h.top_as_percent(d,
a),position:"absolute"})}else a.style.position="static"};h.left_as_percent=function(a,b,c){!c&&b&&(c=b.parentElement);if(!b||!c)return a;var d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:h.adjust_left_if_scaled(a,b);return 100*Math.min(($(c).offset().left-window.pageXOffset+a-d.left)/d.width,1-$(b).width()/d.width)+"%"};h.top_as_percent=function(a,b,c){!c&&b&&(c=b.parentElement);if(!b||!c)return a;var d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:h.adjust_top_if_scaled(a,
b);return 100*Math.min(($(c).offset().top+-window.pageYOffset+a-d.top)/d.height,1-$(b).height()/d.height)+"%"};h.adjust_left_if_scaled=function(a,b){b=h.widget_side_of_element(b);var c;return b&&b.get_original_width&&(c=b.get_original_width())&&b.get_attribute?a-(c-b.get_attribute("width"))/2:a};h.adjust_top_if_scaled=function(a,b){b=h.widget_side_of_element(b);var c;return b&&b.get_original_height&&(c=b.get_original_height())&&b.get_attribute?a-(c-b.get_attribute("height"))/2:a};h.scale_left=function(a,
b){b=h.widget_side_of_element(b);var c;return b&&b.get_original_width&&(c=b.get_original_width())&&b.get_attribute?a*c/b.get_attribute("width"):a};h.scale_top=function(a,b){b=h.widget_side_of_element(b);var c;return b&&b.get_original_height&&(c=b.get_original_height())&&b.get_attribute?a*c/b.get_attribute("height"):a};h.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";
case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";case 11:return"eleventh";case 12:return"twelfth";case 13:return"thirteenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};h.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};h.give_tooltip=function(a,b){a&&(a.title=b,h.use_custom_tooltip(a))};h.use_custom_tooltip=function(a){var c=$(a),d;"function"==typeof c.tooltip&&(h.widget_side_of_element(a)&&
h.widget_side_of_element(a).get_title&&(a.title=h.widget_side_of_element(a).get_title()),c.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){var e=c.offset();0>a.top&&(a.top=0);e.left<$(window).width()/2?a.left=e.left+c.width()+10:(a.left=0,d=e.left-40);"bottom"===b.vertical?(c.is(".toontalk-robot")?a.top-=30:c.is(".toontalk-number")?a.top-=30:c.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.min(a.left,$(window).width()-
100);a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);h.set_css(this,a)}},open:function(c,e){var f=e.tooltip.get(0);c=f.textContent;var g=$(a).is(".toontalk-robot"),k;f.innerHTML=Q(c,decodeURIComponent);b.speak&&(window.speechSynthesis.cancel(),g||(k=function(a){}),h.speak(f.innerText,{when_finished:k}));aa&&$(aa).remove();aa=f;b.balloons?(100<c.length&&(k=Math.min(800,d||$(window).width()-100),$(f).position(),e.tooltip.css({maxWidth:k})),e.tooltip.css({"z-index":99999999}),
e.tooltip.find(".toontalk-iframe-container").removeClass("toontalk-iframe-container"),setTimeout(function(){e.tooltip.remove();$(f).data("ui-tooltip")&&($(f).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),h.use_custom_tooltip(a));aa=void 0},c.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))):e.tooltip.remove()},close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),h.use_custom_tooltip(a));aa=void 0}}))};h.speak=function(a,c){var d=
window.speechSynthesis.getVoices(),e=function(a){for(var b=[],c=function(a){if(200>a.length)return a.length+1;var b=a.substring(0,200);var c=b.lastIndexOf(". ")||b.lastIndexOf(".\n");if(0<c)return c+2;c=b.lastIndexOf(".");if(c===b.length-1)return c+1;c=b.lastIndexOf(", ");if(0<c)return c+2;c=b.lastIndexOf(" ");return 0<c?c+1:Math.min(a.length+1,200)},d;0<a.length;)d=c(a),1<d&&b.push(a.substring(0,d-1)),a=a.substring(d);return b};if(f)if(c||(c={}),0===d.length)window.speechSynthesis.onvoiceschanged=
function(){h.speak(a,c);window.speechSynthesis.onvoiceschanged=void 0};else if(h.translate&&!c.no_translation)h.translate(a,function(a){c.no_translation=!0;h.speak(a,c)});else if(200<a.length)d=e(a),d.forEach(function(a,b){0===b&&(c.when_finished=function(){});h.speak(a,c)});else{d=void 0===c.pitch?1.2:c.pitch;e=void 0===c.volume?Math.min(1,3*b.volume):c.volume;var g=void 0===c.rate?.75:c.rate,k=void 0===c.voice_number?0:c.voice_number,p=c.language||0<document.getElementsByClassName("goog-te-menu-value").length&&
document.getElementsByClassName("goog-te-menu-value")[0].firstChild.innerText;ecraft2learn.speak(a,d,g,k,e,p,c.when_finished)}};h.translation_language_code=function(){return b.TRANSLATION_ENABLED&&google&&google.translate&&google.translate.TranslateElement?google.translate.TranslateElement().c:navigator.language};h.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"+a+"decodeURIComponent</span>")};h.remove_encoded_HTML=function(a){return Q(a,
function(){return""})};h.join_continuations=function(a,b){return a?b?function(){b(a)}:a:b};h.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};h.animate_to_absolute_position=function(a,c,d,e,f,g){var k=$(a).offset(),p=$(a).position(),l=h.distance(c,k);0===g||0===e?(h.set_absolute_position(a,c),d&&d()):($(a).css({"z-index":h.next_z_index()}),g||(g=Math.round(l/(e||b.animation_settings.ANIMATION_SPEED))),
$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=g+"ms",l=p.left+(c.left-k.left),k=p.top+(c.top-k.top),a.style.left=l+"px",a.style.top=k+"px",a.toontalk_followed_by&&(c.left+=a.toontalk_followed_by.left_offset,c.top+=a.toontalk_followed_by.top_offset,h.animate_to_absolute_position(a.toontalk_followed_by.element,c,void 0,e,f)),document.hidden&&(g=0),f?setTimeout(d,g):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";d&&d()},g))};h.distance=
function(a,b){var c=a.left-b.left;a=a.top-b.top;return Math.sqrt(c*c+a*a)};h.highlight_element=function(a,b,c){if(a){h.remove_highlight();if(!$(a).is(".toontalk-backside")){var d=h.widget_side_of_element(a);if(!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a))return}$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){h.remove_highlight(a)},c))}};h.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};
h.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};h.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};h.constrain_css_to_fit_inside=function(a,b){var c=$(a).width();0!==c&&(a=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=h.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,
0),a):(c=h.extract_percentage_from_string(b.top),"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};h.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(q){}};h.next_z_index=function(){g++;return g};h.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();var e=a.get(0);a.addClass(b+" toontalk-button");e.addEventListener("click",d);h.give_tooltip(e,c);return e};h.create_close_button=
function(a,b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button toontalk-button");c.addEventListener("click",a);h.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};h.check_radio_button=function(a){var b=$(a.button).closest(".ui-controlgroup");0<b.length&&b.find(".ui-state-active").removeClass("ui-state-active").prop("checked",!1);$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};h.create_alert_element=function(a){a=
Q(a,decodeURIComponent);var b=h.create_text_element(a);0===$(b).children().length||0<=a.indexOf("<")?$(b).addClass("toontalk-alert-element"):$(b).children().addClass("toontalk-alert-element");return b};h.create_text_element=function(a,b){var c=document.createElement("div");c.innerHTML=a;$(c).addClass("ui-widget");b&&$(c).addClass(b);return c};h.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};h.create_anchor_element=function(a,
c){var d=document.createElement("a");d.innerHTML=a;b.TRANSLATION_ENABLED&&(c=h.add_URL_parameter(c,"translate","1"));d.href=c;d.target="_blank";return d};h.create_text_input=function(a,b,c,d,e,f,g){var k=document.createElement("input");k.type="text";k.className=b;k.value=a;h.give_tooltip(k,d);f&&(k.type=f);if(c){a=document.createElement("label");a.innerHTML=c;k.id=h.generate_unique_id();a.htmlFor=k.id;if(e){var p=h.create_anchor_element("i",e);$(p).addClass("toontalk-help-button toontalk-button notranslate");
p.translate=!1}c=h.create_horizontal_table(a,k,p);$(a).addClass("ui-widget")}else c=k;k.classList.add("toontalk-text-with-button-style","ui-corner-all","ui-widget","toontalk-text-area");k.addEventListener("touchstart",function(){$(k).select()});g&&n(k,g);h.use_custom_tooltip(k);return{container:c,button:k}};h.create_text_area=function(a,b,c,d,e,f,g){var k=document.createElement("textarea");k.className=b;k.value=a;h.give_tooltip(k,d);a=document.createElement("label");a.innerHTML=c;k.id=h.generate_unique_id();
a.htmlFor=k.id;c=g?h.create_vertical_table(a,k):h.create_horizontal_table(a,k);k.classList.add("toontalk-text-with-button-style","ui-corner-all","ui-widget","toontalk-text-area");k.addEventListener("touchstart",function(){$(k).select()});e&&n(k,e);$(a).addClass("ui-widget");h.use_custom_tooltip(k);return{container:c,button:k}};h.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();if(c=r(a)){if(c.is_backside())return;if(d=b(c,a))$(a.currentTarget).trigger("change"),a.currentTarget.value=
d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};h.create_radio_button=function(a,b,c,d,e,f){f=document.createElement("div");var g=document.createElement("input"),k=document.createElement("label");g.type="radio";g.className=c+" toontalk-button";g.name=a;g.value=b;k.innerHTML=d;g.id=h.generate_unique_id();k.htmlFor=g.id;f.appendChild(g);f.appendChild(k);h.give_tooltip(f,e);$(g).checkboxradio({icon:!1}).addClass("toontalk-button");h.use_custom_tooltip(g);return{container:f,button:g,label:k}};
h.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),k=document.createElement("select"),p=document.createElement("label");k.className=c;k.name=a;k.id=h.generate_unique_id();p.innerHTML=d;p.htmlFor=k.id;g.appendChild(p);g.appendChild(k);h.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&h.give_tooltip(c,f[b]);k.appendChild(c)});$(k).selectmenu({width:"50%",open:function(){$(".ui-selectmenu-open").css({"z-index":9999999});
setTimeout(function(){$(".ui-selectmenu-open").find(".ui-menu-item").each(function(a,c){f&&(a=b.indexOf(c.textContent),0<=a&&f[a]&&h.give_tooltip(c,f[a]))})})}});$(p).addClass("ui-widget");h.use_custom_tooltip(k);return{container:g,menu:k,label:p}};h.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b+" toontalk-button";f.checked=a;g.innerHTML=c;f.id=h.generate_unique_id();g.htmlFor=
f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);h.give_tooltip(e,d);h.use_custom_tooltip(f);return{container:e,button:f,label:g}};h.create_div=function(){var a=document.createElement("div"),b;for(b=0;b<arguments.length;b++)arguments[b]&&(arguments[b].container?(a.appendChild(arguments[b].button),a.appendChild(arguments[b].label)):a.appendChild(arguments[b]));return a};h.create_horizontal_table=function(){var a=document.createElement("table"),b;var c=document.createElement("tr");
a.appendChild(c);for(b=0;b<arguments.length;b++)if(arguments[b]){var d=document.createElement("td");c.appendChild(d);d.appendChild(arguments[b])}return a};h.create_vertical_table=function(){var a=document.createElement("table"),b;for(b=0;b<arguments.length;b++)if(arguments[b]){var c=h.create_row(arguments[b]);a.appendChild(c)}return a};h.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)arguments[c]&&a.appendChild(arguments[c]);
b.appendChild(a);return a};h.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};h.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if(arguments[a].button.checked)return arguments[a]};h.create_image=function(a,b){var c=document.createElement("img");c.src=a;b&&$(c).addClass(b);if(0===a.indexOf("images/")){var d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+a};c.addEventListener("error",d)}return c};
h.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a");if("string"===typeof a){var h=document.createElement("span");h.innerHTML=a}else h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);b.forEach(function(a){c.appendChild(a)});
$(c).tabs();return c};h.add_iframe_popup=function(a){var b=document.createElement("iframe"),c=document.createElement("div");$(c).addClass("toontalk-close-popup-frame-button").button();c.addEventListener("click",function(a){$(b).remove();$(c).remove();a.stopPropagation()});c.innerHTML="Return to ToonTalk";$(b).addClass("toontalk-popup-frame");b.src=a;document.body.appendChild(c);document.body.appendChild(b)};h.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');
a&&b.addClass(a);return b.get(0)};h.become_file_data_table=function(a,c,d,e){$(a).DataTable({data:c,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,c,f,g){a=d?a.substring(0,a.length-5):a;c=d?b.google_drive.google_drive_url(f.id):"Click to load this program.";if(e)return"<div class='"+e+"' title='"+c+"'id='"+f.id+"'>"+a+"</div>";b.TRANSLATION_ENABLED&&(c=h.add_URL_parameter(c,"translate","1"));return"<a href='"+c+"'target='_blank' title='Click to open published page.'>"+
a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};h.get_local_files_data=function(a){h.get_all_locally_stored_program_names(function(b){var c=[],d=function(e){var f=b[e];h.get_local_storage_meta_data(f,function(g){g&&c.push({title:f,modifiedDate:g.last_modified,createdDate:g.created,
fileSize:g.file_size});e<b.length?d(e+1):a(c)})};d(0)})};h.create_local_files_table=function(a){h.get_local_files_data(function(b){var c=h.create_file_data_table();h.when_attached(c,function(){h.become_file_data_table(c,b,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});a(c)})};h.get_$dragee=function(){return D};h.get_dragee=function(){return D&&b.UTILITIES.widget_side_of_jquery(D)};h.get_resource_copy=function(){return V};h.get_dragee_copy=function(){if(R)return R;
var a=h.get_dragee();if(a&&!a.is_backside()&&(a.get_infinite_stack()||D.is(".toontalk-top-level-resource")))return R||(D.is(".toontalk-top-level-resource")?(R=a,V=a.copy({fresh_copy:!0})):R=a.add_copy_to_container(void 0,-1E3,-1E3)),R};h.add_URL_parameter=function(a,b,c){a=h.remove_URL_parameter(a,b);var d=a.indexOf("?");return a+(0<=d?"&":"?")+b+"="+c};h.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"=");0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;b=a.indexOf("&",c+1);0>b&&(b=a.length);
a=a.substring(0,c)+a.substring(b);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};h.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};h.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};
h.maximum_string_length=function(a,b){if(a.length<=b)return a;var c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};h.each_top_level_widget=function(a){$(".toontalk-backside-of-top-level").each(function(b,c){a(h.widget_side_of_element(c).get_widget())})};h.backup_all_top_level_widgets=function(a){h.each_top_level_widget(function(b){b.save(a)})};h.make_resizable=function(a,b){var c,d,e;a.resizable({start:function(b,f){d=f.originalSize.width;e=f.originalSize.height;
c=a.get(0).onclick},resize:function(c,f){a.is(".toontalk-element-frontside")&&(f.size.width!=d&&(b.increment_width(f.size.width-d),d=f.size.width),f.size.height!=e&&(b.increment_height(f.size.height-e),e=f.size.height));b.rerender()},stop:function(f,g){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,d,e,g.size.width,g.size.height);f.originalEvent.stopPropagation();setTimeout(function(){a.get(0).onclick=c},100)},handles:b.is_box()?"se":"n,e,s,w"});a.children(".ui-resizable-handle").css("z-index",
9999)};h.match=function(a,b){if(void 0===a)return"matched";if(a.is_nest())var c=a.match(b);else if(b=b.dereference(),c=a.match(b),c.is_widget&&b.matched_by)return b.matched_by(a);return c};h.current_URL=function(){return window.location.pathname};h.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};h.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&h.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():
b};h.copy_frontside_dimensions=function(a,b){(a=a.get_widget().get_frontside_element())&&(b=b.get_frontside_element(!0))&&h.set_css(b,{width:$(a).width(),height:$(a).height()})};h.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?h.scale_element(a,c,d,c,d):h.scale_element(a,$(b).width(),$(b).height(),c,d)};h.scale_element=function(a,c,d,e,f,g,k,l,m){var p=$(a).find("iframe");if(0<p.length)return p.attr("width",c).attr("height",d-20),{x_scale:1,y_scale:1};$(a).is(".toontalk-not-observable")&&
(p=b.UTILITIES.widget_side_of_element(a))&&p.render();if(!e){var q=$(a).children("img");e=q.is("*")?q.width():$(a).width()}f||(q||(q=$(a).children("img")),f=q.is("*")?q.height():$(a).height());q=c&&0!==e?c/e:a.toontalk_x_scale||1;p=d&&0!==f?d/f:a.toontalk_y_scale||1;0===q&&(q=1);0===p&&(p=1);a.toontalk_x_scale=q;a.toontalk_y_scale=p;l=(l=l&&l!==document.body?l:a.parentElement)&&0>l.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var n="";k||(k={});"number"===typeof k.left&&
(k.left-=(e-c)/2,m=!0);"number"===typeof k.top&&(k.top-=(f-d)/2,m=!0);!m&&l?(c&&(a.toontalk_translate_x=(c-e)/2,n+="translateX("+a.toontalk_translate_x+"px) "),d&&(a.toontalk_translate_y=(d-f)/2,n+="translateY("+a.toontalk_translate_y+"px) ")):(a.toontalk_translate_x=void 0,a.toontalk_translate_y=void 0);h.add_transform_to_css((g||"")+" scale("+q+", "+p+")",n,k,l);k.width=e;k.height=f;h.set_css(a,k);return{x_scale:q,y_scale:p}};h.translate_x=function(a){return k("toontalk_translate_x","toontalk_x_scale")};
h.translate_y=function(a){return k("toontalk_translate_y","toontalk_y_scale")};h.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),h.set_css_transform(c,b+a))};h.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};h.run_when_dimensions_known=function(a,c,d){var e=a.parentElement,f=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")&&
!$(a).is(".toontalk-nest")};if(!d&&$(a).width()&&(f(e)||$(a).is(".toontalk-element-frontside")))setTimeout(function(){c(e)});else{var g=function(d){setTimeout(function(){var k=$(a).width(),l=$(a).height();k&&l?f(a.parentElement)?($(a).removeClass("toontalk-not-observable"),c(e),e?(e.appendChild(a),b.UTILITIES.widget_side_of_element(a).rerender()):a.parentElement===document.body&&$(a).remove()):h.run_when_dimensions_known(a,c,!0):setTimeout(function(){h.widget_side_of_element(a);1E4>d&&g(2*d)},d)})};
$(a).addClass("toontalk-not-observable");document.body.appendChild(a);d&&h.set_css(a,{width:"",height:"",transform:""});g(1)}};h.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&h.run_when_dimensions_known(d,function(){var a=$(d).children("img");a.is("*")?b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};h.relative_position=function(a,b){if(!h.is_attached(a))return{left:0,top:0};a=$(a).offset();b&&(b=$(b).offset(),a.left-=b.left,a.top-=
b.top);return a};h.add_animation_class=function(a,b){h.set_css(a,{width:"",height:""});$(a).addClass(b)};h.widget_side_of_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget_side};h.widget_side_of_element=function(a){return a.toontalk_widget_side};h.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};h.display_message=function(a,c){var d=h.create_alert_element(a),
e=function(){$(d).remove();$(".toontalk-help-link").css({opacity:""})};c||(c={});if(c.only_if_new)if(0>F.indexOf(a))F.push(a);else return a;$(".toontalk-alert-element").text($(".toontalk-alert-element").text()+"..."+a);!b.debugging||c.user_initiated||c.dont_log||(console.log(c.plain_text||a),console.trace());if(c.element||c.second_choice_element){var f=$(c.element).closest(".toontalk-backside");0===f.length&&(f=$(c.second_choice_element).closest(".toontalk-backside"));0<f.length&&($(d).addClass("toontalk-local-alert"),
f.append(d))}c.element&&0!==f.length||($(".toontalk-help-link").css({opacity:0}),document.body.insertBefore(d,document.body.firstChild));b.speak&&(window.speechSynthesis.cancel(),h.speak(c.plain_text||d.textContent));d.addEventListener("click",e);c.duration||(0<=a.indexOf("<")?c.duration=5E3:c.duration=Math.max(2E3,a.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)));setTimeout(e,c.duration);return a};h.display_tooltip=function(a){a.each(function(){h.use_custom_tooltip(this)});a.tooltip("open")};
h.report_internal_error=function(a,c){console.error(a);console.trace();b.debugging&&h.display_message("Error: "+a);"object"!==typeof Raven||c&&c.dont_log_exception||Raven.captureException(a.toString())};h.get_current_url_boolean_parameter=function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};h.get_current_url_numeric_parameter=function(a,b){a=h.get_current_url_parameter(a);if("undefined"===typeof a)return b;try{return parseInt(a,10)}catch(H){return 0}};
h.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"=");if(0>c)return b;a=c+a.length+1;b=window.location.href.indexOf("&",a);0>b&&(b=window.location.href.length);return window.location.href.substring(a,b)};h.get_path_to_toontalk_folder=function(){return b.TOONTALK_URL};h.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};var ba=h.is_browser_of_type("MSIE")||h.is_browser_of_type("Trident");h.is_internet_explorer=function(){return ba};h.add_position=
function(a,b){return{left:a.left+b.left,top:a.top+b.top}};h.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};h.remove_z_index=function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;a=$("<div>"+a+"</div>");a.attr("z-index","");return a.html()};h.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b=!1;if(0!==a.length){a.button();var c=a.get(0);c.innerHTML="Run all tests";a.get(0).addEventListener("click",function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&
$(this).click()}),c.innerHTML="Run all tests",h.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),c.innerHTML="Stop all tests");b=!b})}};h.set_timeout=function(a,b){b||h.is_internet_explorer()?setTimeout(a,b):(T.push(a),window.postMessage("zero-timeout-message","*"))};h.get_first_property=function(a){return Object.keys(a)[0]};h.get_all_locally_stored_program_names=function(a){h.retrieve_object("toontalk-all-program-names",
function(b){if(b)a(b);else return a([])})};h.set_all_locally_stored_program_names=function(a){h.store_object("toontalk-all-program-names",a,function(){})};h.get_local_storage_meta_data=function(a,b){a=h.local_storage_program_meta_data_key(a);try{h.retrieve_object(a,b)}catch(H){b()}};h.local_storage_program_key=function(a){return"toontalk-json: "+a};h.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};b.CHROME_APP?(h.store_object=function(a,c,d){var e={};b.logging&&0<=
b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);e[a]=JSON.stringify(c,h.clean_json);chrome.storage.local.set(e,d);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by set "+a)},h.store_string=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a);e[a]=c;chrome.storage.local.set(e,d);b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+
a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by store_string "+a)},h.retrieve_object=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+a);c(d[a]&&h.parse_json(d[a]))})},h.retrieve_string=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&
console.log("Retrieved string "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+a);c(d&&d[a])})}):"undefined"!==typeof window.localStorage&&window.localStorage?(h.store_object=function(a,c,d){b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);try{var e=JSON.stringify(c,h.clean_json)}catch(P){h.is_stack_overflow(P)?b.UTILITIES.display_message("Unable to store your project because the depth of widget nesting exceeds the size of the stack.  Perhaps you can launch this browser or another with a larger stack size.",
{only_if_new:!0}):b.UTILITIES.display_message("Unable to store your project because of the error: "+P.message,{only_if_new:!0})}try{window.localStorage.setItem(a,e)}catch(P){b.UTILITIES.display_message("Unable to store your project to the browser's local storage. You can save to Google Drive if you have an account. Otherwise drag your project to Wordpad or the like. The error message is: "+P,{only_if_new:!0})}d&&d()},h.store_string=function(a,c,d){try{window.localStorage.setItem(a,c)}catch(S){b.UTILITIES.display_message("Unable to store your project to the browser's local storage. You can save to Google Drive if you have an account. Otherwise drag your project to Wordpad or the like. The error message is: "+
S,{only_if_new:!0})}d&&d()},h.retrieve_object=function(a,c){try{var d=window.localStorage.getItem(a);b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d&&d.substring(0,100))+"... with key "+a);c(d&&h.parse_json(d))}catch(S){b.UTILITIES.display_message("Unable to read from the browser's local storage. You can read and save to Google Drive if you have an account. The error message is: "+S,{only_if_new:!0})}},h.retrieve_string=function(a,c){try{b.logging&&0<=b.logging.indexOf("retrieve")&&
console.log("Retrieved string "+(window.localStorage.getItem(a)&&window.localStorage.getItem(a).substring(0,100))+"... with key "+a),c(window.localStorage.getItem(a))}catch(H){b.UTILITIES.display_message("Unable to read from the browser's local storage. You can read and save to Google Drive if you have an account. The error message is: "+H,{only_if_new:!0})}}):(h.store_object=function(){console.log("Browser local storage not available in this browser. Nothing stored")},h.store_string=h.store_object,
h.retrieve_object=function(a,b){b()},h.retrieve_string=h.retrieve_object);h.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};h.enable_touch_events=function(a,c){var d=a,e=function(e){e.preventDefault();if(m){e.stopPropagation();var l=e.changedTouches[0];p&&(p.being_dragged=!1);$(a).removeClass("toontalk-being-dragged");m+c>=Date.now()?(e=document.createEvent("MouseEvent"),e.initMouseEvent("click",!0,!0,window,1,l.screenX,l.screenY,l.clientX,l.clientY,!1,!1,!1,
!1,0,null),l.target.dispatchEvent(e),p&&p.constrained_by_container()?$(a).css({left:"",top:""}):h.set_absolute_position(a,{left:k.left,top:k.top}),b.logging&&0===b.logging.indexOf("touch")&&t("touch end treated as click "+a.id,!0)):(w(e,a),b.logging&&0===b.logging.indexOf("touch")&&t("drag ended "+a.id),v(e),b.logging&&0===b.logging.indexOf("touch")&&t("drop happened "+a.id),b.logging&&0===b.logging.indexOf("touch")&&t("",!0),h.set_absolute_position(a,{left:l.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:l.pageY-
g-b.USABILITY_DRAG_OFFSET.y}));m=void 0;a=d}},f=0,g=0,k,m,p,n;a.addEventListener("touchstart",function(c){var d=c.changedTouches[0],e;k=$(a).offset();0===b.USABILITY_DRAG_OFFSET.y&&(b.USABILITY_DRAG_OFFSET.y=25);b.logging&&0===b.logging.indexOf("touch")&&t("touch start "+a.id);c.preventDefault();if("TEXTAREA"===c.target.tagName||"INPUT"===c.target.tagName||$(c.target).is(".ui-resizable-handle"))b.logging&&0===b.logging.indexOf("touch")&&t("touch start ignored due to tag name or class "+a.id);else if((e=
h.find_widget_side_on_page(c.changedTouches[0],void 0,0,0))&&e.is_of_type("empty hole")&&(e=e.get_parent_of_frontside()),e&&e.get_frontside_element()!==a)b.logging&&0===b.logging.indexOf("touch")&&t("touch start ignored since has child who is really touched: "+h.widget_side_of_element(a));else{m=Date.now();b.logging&&0===b.logging.indexOf("touch")&&t("touch start of "+a.id+" at "+m);c.stopPropagation();if(p=h.widget_side_of_element(a))p.being_dragged=!0;if(p&&p.get_infinite_stack()){var n=p.copy();
p.set_infinite_stack(!1);n.set_infinite_stack(!0)}else if($(a).is(".toontalk-top-level-resource")){n=p.copy();p.add_copy_to_container(n,0,0);var q=$(a).offset();a=n.get_frontside_element(!0)}n&&(p.add_copy_to_container(n,0,0),p.robot_in_training()&&p.robot_in_training().copied(p,n,!1));$(a).css({"z-index":99999999});q||(q=$(a).offset());l(c);f=d.pageX-q.left;g=d.pageY-q.top;b.logging&&0===b.logging.indexOf("touch")&&t("drag started "+a.id)}},!0);a.addEventListener("touchmove",function(c){var d=c.changedTouches[0];
if(m){c.preventDefault();h.set_absolute_position(a,{left:d.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:d.pageY-g-b.USABILITY_DRAG_OFFSET.y});c=h.find_widget_side_on_page(d,a,b.USABILITY_DRAG_OFFSET.x,b.USABILITY_DRAG_OFFSET.y);if(n&&n!==c){var e=n.get_frontside_element();h.remove_highlight(e);n=void 0}c&&(u(d,c.get_element()),n=c);b.logging&&0===b.logging.indexOf("touch")&&t("dragged to "+(d.pageX-f)+", "+(d.pageY-g)+" "+a.id)}},!0);a.addEventListener("touchend",e,!0);a.addEventListener("touchcancel",e,
!0)};h.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b.simulatedEventMessage&&"undefined"!==typeof b.simulatedEventMessage[a]?b.simulatedEventMessage[a]:b[a]};h.find_widget_side_on_page=function(a,b,c,d){var e=h.get_mouse_or_first_touch_event_attribute("pageX",a);a=h.get_mouse_or_first_touch_event_attribute("pageY",a);b&&$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for(b&&$(b).show();c&&!c.toontalk_widget_side&&
!$(c).is(".toontalk-backside")&&!$(c).is(".toontalk-button")&&!$(c).is(".ui-button");)c=c.parentNode;if(c)var f=c.toontalk_widget_side;if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),f};h.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-backside-of-top-level").each(function(){var b=$(this).offset();b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return h.widget_side_of_element(c)};h.set_css=function(a,b){var c;if(b&&
a){if(c=h.widget_side_of_element(a)){var d=c.dereference();b.width&&!b["font-size"]&&(c.is_hole()?b["font-size"]=c.name_font_size(b.width,b.height):d.name_font_size&&(b["font-size"]=d.name_font_size(b.width,b.height)));if(!$(a).is(".toontalk-temporarily-set-down"))if(c.constrained_by_container())b.left="",b.top="";else if(c.is_plain_text_element()||c.is_nest()&&d.is_plain_text_element())b.width="",b.height=""}0===b.width&&(b.width="");0===b.height&&(b.height="");b.transform||"number"!==typeof b.width||
"number"!==typeof b.height||!d||d.is_plain_text_element()&&d.constrained_by_container()||!d.use_scaling_transform?$(a).css(b):(c!==d&&$(a).css(b),d.use_scaling_transform(b))}};h.font_size=function(a,c,d){if(!a||!c)return 0;d||(d={});var e=a.split(/[\s\-]/);var f=e.map(function(a){return a.length}).reduce(function(a,b){return Math.max(a,b)},-Infinity);c/=b.FONT_ASPECT_RATIO*(f+(d.margin||0));if(1===e.length)return d.height?Math.min(c,d.height):c;a=Math.ceil(a.length/f);c*a>.9*d.height&&(c*=Math.sqrt(d.height/
(c*a*1.2)),c*=.9);return c};h.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};h.conjunction=function(a,b){return a.map(function(c,d){if("undefined"===typeof c)return"anything";c=b?h.add_a_or_an(c):c;return d===a.length-2?c+" and ":d===a.length-1?c:c+", "}).join("")};h.insert_function_bird_documentation=function(a,b){var c=TOONTALK[a]["function"],d=Object.keys(c),e="<table class='toontalk-function-bird-documentation-table'>";d.forEach(function(a,b){e+="<tr><td><div id='bird_id_"+
b+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+c[a].title+"</td></tr>"});e+="</table>";$(b).html(e);d.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e&&(e.id=encodeURIComponent(b))})};h.rerender_all=function(){$(".toontalk-side").each(function(a,b){(a=h.widget_side_of_element(b))&&
a.update_display(!0)})};h.visible_element=function(a){return a&&null!==a.offsetParent};h.get_audio_volume=function(a){var c=document.hidden?0:b.volume;0===c&&e.push({audio_object:a,volume:a.volume});return c};h.play_audio=function(b){b.play();a.push(b);b.addEventListener("ended",function(){var c=a.indexOf(b);0<=c&&a.splice(c,1)})};h.mute_audio_objects_playing=function(){a.forEach(function(a){e.push({audio_object:a,volume:a.volume});a.volume=0});a=[]};h.stop_audio_objects=function(){a.forEach(function(a){a.pause();
try{a.currentTime=0}catch(q){}})};h.restore_audio_volumes=function(){e.forEach(function(b){b.audio_object.volume=b.volume;a.push(b.audio_object)});e=[]};h.is_attached=function(a){return jQuery.contains(window.document,a)};h.when_attached=function(a,b,c){var d=a.toontalk_attached_callback;jQuery.contains(window.document,a)&&!c?b():(a.toontalk_attached_callback=function(){d&&d();b();$(a).removeClass("toontalk-has-attached-callback");a.toontalk_attached_callback=void 0;a.toontalk_widget_side&&a.toontalk_widget_side.rerender()},
c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};h.create_event=function(a,b){try{var c=new CustomEvent(a,{detail:b})}catch(S){c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!1,!1,b)}return c};h.create_queue=function(){var a=[],c=0;return{getLength:function(){return a.length-c},isEmpty:function(){return 0==a.length},enqueue:function(c){var d=0==a.length;a.push(c);b.logging&&0<=b.logging.indexOf("queue")&&console.log(c._debug_string+" enqueued");
return d},dequeue:function(){if(0!=a.length){var d=a[c];b.logging&&0<=b.logging.indexOf("queue")&&console.log(d._debug_string+" dequeued");2*++c>=a.length&&(a=a.slice(c),c=0);return d}},peek:function(){return 0<a.length?a[c]:void 0},does_any_item_satisfy:function(b){var d;for(d=c;d<a.length;d++)if(b(a[d]))return!0;return!1}}};h.number_to_words=function(a){var b=a.indexOf("/"),c=function(a){var b="  half third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth seventeenth eighteenth nineteenth twentieth".split(" ");
if(20>=a)return b[a];if(0===a%10&&100>a)return"thirtieth fortieth fiftieth sixtieth seventieth eightieth ninetieth".split(" ")[a/10-3];if(100===a)return"hundredth";if(1E3===a)return"thousandth";if(1E4===a)return"ten thousandth";if(1E5===a)return"hundred thousandth";if(1E6===a)return"millionth";if(1E7===a)return"ten millionth";if(1E8===a)return"hundred millionth";if(1E9===a)return"billionth"};if(0>b)return h.integer_to_words(a);var d=a.substring(0,b);var e="1"!==d&&"-1"!==d;return b+3>=a.length||!e&&
b+11>=a.length?(c=c(parseInt(a.substring(b+1))))?h.integer_to_words(d)+" "+c+(e?"s":""):h.integer_to_words(d)+" over "+h.integer_to_words(a.substring(b+1)):h.integer_to_words(a.substring(0,b))+" over "+h.integer_to_words(a.substring(b+1))};h.integer_to_words=function(a){var b="",c=" un duo tre quattuor quin se septe octo nove".split(" "),d="   *   sx mn  mx".split(" "),e=" deci viginti triginta quadraginta quinquaginta sexaginta septuaginta octoginta nonaginta".split(" "),f=" n ms ns ns ns n n mx m".split(" "),
g=" centi ducenti trecenti quadringenti quingenti sescenti septingenti octingenti nongenti".split(" "),h=" nx n ns ns ns n n mx m".split(" "),k=" milli dumilli tremilli quadrinmilli quinmilli sesmilli septinmilli octinmilli nonmilli".split(" "),l=" decimilli vigintimilli trigintamilli quadragintanmilli quinquagintamilli sexagintamilli septuagintamilli octogintamilli nonagintamilli".split(" "),m=" centimilli ducentimilli trecentimilli quadringentimilli quingentimilli sescentimilli septingentimilli octingentimilli nongentimilli".split(" "),
p=" milli-milli milli-dumilli milli-tremilli milli-quadrinmilli milli-quinmilli milli-sesmilli milli-septinmilli milli-octinmilli milli-nonmilli".split(" "),n="thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion".split(" "),r,t=function(c){var d=0,e="",f;for(f=0;f<c;f++)if("0"!==a[f]||0<d)e+=a[f],d++;if(e){c=b;e=parseInt(e);f=" one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen twenty".split(" ");
var g=" ten twenty thirty forty fifty sixty seventy eighty ninety".split(" "),h="";100<=e&&(h+=f[Math.floor(e/100)]+" hundred",e%=100,0<e&&10>e&&(h+=" and"));20<e?(""!=h&&(h+=" "),h+=g[Math.floor(e/10)],e%=10,0<e&&(h+="-")):""!=h&&0<e&&(h+=" ");0<e&&(h+=f[e]);b=c+h.toString()}return d},u=function(a,b){var c,d;if(void 0!==a&&void 0!==b)for(c=0;c<a.length;c++)for(d=0;d<b.length;d++)if(a[c]==b[d]||"*"===a[c]&&("s"===b[d]||"x"===b[d]))return b[d]};"-"===a[0]&&(b+="negative ",a=a.substring(1));for(;0<
a.length&&"0"===a[0];)a=a.substring(1);if(0===a.length)return"zero";for(r=a.length;;){" "!==b[b.length-1]&&(b+=" ");if(4>r){0===t(r)&&","===b.substring(b.length-1)&&(b=b.substring(0,b.length-1));break}var v=r-4;var w=1+v%3;var y=t(w);a=a.substring(w);r-=w;if(0<y){" "!==b[b.length-1]&&(b+=" ");var z=Math.floor(v/3);w=z%10;if(10>z)b+=n[z];else{y=Math.floor(z/10%10);v=Math.floor(z/100%10);var B=Math.floor(z/1E3%10);var C=Math.floor(z/1E4%10);var D=Math.floor(z/1E5%10);var F=Math.floor(z/1E6%10);var G=
c[w];z=e[y];var I=g[v];B=k[B];C=l[C];D=m[D];F=p[F];var J=void 0;G&&(b+=G,J=d[w]);z&&((w=u(J,f[y]))&&(b+=w),J=void 0,b+=z);I&&((w=u(J,h[v]))&&(b+=w),J=void 0,b+=I);b+=B;b+=C;b+=D;b+=F;"a"===b[b.length-1]&&(b=b.substring(0,b.length-2)+"i");b+="llion"}b+=","}}b=b.trim();c=b.lastIndexOf(", ");if(0<=c)return b.substring(0,c)+" and"+b.substring(c+1);","===b[b.length-1]&&(b=b.substring(0,b.length-1));return b};h.test_number_to_words=function(a){var b;for(b=0;b<a;b++){var c=Math.round(1E9*Math.random());
console.log(c+" = "+h.number_to_words(c.toString()))}};h.for_each_batch=function(a,b,c,d){var e;if(0!==a.length){void 0===d&&(d=0);c||(c=100);var f=Math.min(a.length,d+c);for(e=d;e<f;e++)try{b(a[e],e)}catch(fa){if(h.is_stack_overflow(fa)){h.set_timeout(function(){h.for_each_batch(a,b,c,e)});return}throw fa;}f<a.length&&h.set_timeout(function(){h.for_each_batch(a,b,c,f)})}};h.element_width=function(a){var c=$(a);if(c.is(".toontalk-conditions-contents"))return b.UTILITIES.get_toontalk_css_numeric_attribute("width",
".toontalk-conditions-container");if(!c.is(".toontalk-not-observable"))return $(a).width()};h.element_height=function(a){var c=$(a);if(c.is(".toontalk-conditions-contents"))return b.UTILITIES.get_toontalk_css_numeric_attribute("height",".toontalk-conditions-container");if(!c.is(".toontalk-not-observable"))return $(a).height()};h.resizable_and_scalable=function(a,b){var c=1,d=1,e;$(a).resizable({start:function(a,b){e={width:b.size.width,height:b.size.height}},resize:function(f,g){f={width:g.size.width,
height:g.size.height};$(a).is(".toontalk-backside-of-top-level")||(c*=f.width/e.width,d*=f.height/e.height,b(c,d),e=f)},handles:"n,e,s,w,se,ne,sw,nw"})};h.string_to_array=function(a,b){for(var c=[];a.length>b;)c.push(a.substr(0,b)),a=a.substr(b);c.push(a);return c};h.listen_for_speech=function(a){if(b.listen)if(window.speechSynthesis.speaking)setTimeout(function(){h.listen_for_speech(a)},1E3);else{var c=a.language||0<document.getElementsByClassName("goog-te-menu-value").length&&document.getElementsByClassName("goog-te-menu-value")[0].firstChild.innerText;
ecraft2learn.start_speech_recognition(function(b,c){a.descriptions_acceptable&&a.widget&&h.spoken_command_is_a_description(b,a.widget)?a.widget.rerender():a.names_acceptable&&a.widget&&h.spoken_command_is_a_naming(b,a.widget)?a.widget.rerender():a.success_callback&&a.success_callback(b,c)},a.fail_callback,void 0,c)}};h.stop_listening_for_speech=function(){ecraft2learn.stop_speech_recognition&&ecraft2learn.stop_speech_recognition()};h.spoken_command_is_a_description=function(a,b){var c;0===a.indexOf("i am")?
c=a.substring(5):0===a.indexOf("i'm")&&(c=a.substring(4));if(c)return(h.get_dragee_copy()||b).set_description(c,!0,!0),h.display_message("The description of the "+b.get_type_name()+' is now "'+c+'"'),!0};h.spoken_command_is_a_naming=function(a,b){var c;if(b.get_name&&(0===a.indexOf("my name is ")?c=a.substring(11):0===a.indexOf("call me ")&&(c=a.substring(8)),c))return(h.get_dragee_copy()||b).set_name(c,!0,!0),h.display_message("The name of the "+b.get_type_name()+' is now "'+c+'"'),!0};h.download_file=
function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a);c&&d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=function(){b(null)};d.send()};h.set_parameter=function(a,c){b[a]=c;"TRANSLATION_ENABLED"===a&&c&&d()};h.together_send_message=function(a){if(!(a.simulatedEventMessage||"drag"===a.type&&$(a.target).is(".toontalk-backside-of-top-level"))&&TogetherJS.require){var b=TogetherJS.require("elementFinder"),c=$(a.target).data("json"),d=["pageX","pageY"];
a instanceof MouseEvent&&(d=d.concat("altKey button buttons clientX clientY ctrlKey metaKey movementX movementY region screenX screenY shiftKey".split(" ")));var e={type:a.type+"_together",event_class:a.constructor.name,event_type:a.type,offsetLeft:a.target.offsetLeft,offsetTop:a.target.offsetTop,dragXOffset:c?c.view.drag_x_offset:0,dragYOffset:c?c.view.drag_y_offset:0,target:b.elementLocation(a.target),currentTarget:b.elementLocation(a.currentTarget),relatedTarget:a.relatedTarget&&b.elementLocation(a.relatedTarget)};
d.forEach(function(b){e[b]=a[b]});TogetherJS.send(e)}};h.initialize=function(a){var c=function(){var a=function(a,c,d,e,f){a=document.getElementById(a);if(a){if(b.CHROME_APP){var g=function(a){h.add_iframe_popup(c)};g=h.create_button(d,"toontalk-manual-button",e,g)}else g=document.createElement("a"),g.innerHTML=d,g.title=e,c&&(g.href=c,g.target="_blank"),$(g).addClass("ui-widget toontalk-help-link"),h.use_custom_tooltip(g);a.appendChild(g);$(g).css(f);return g}};a("toontalk-manual-button","docs/manual/index.html?reset=1",
"Learn","Click to visit the page that introduces everything.",{background:"yellow"});a("toontalk-manual-tour","docs/tours/tour1.html?reset=1","Watch","Click to visit a page that replays a tour.",{background:"pink"});a("toontalk-manual-whats-new","docs/manual/whats-new.html?reset=1","What's new?","Click to visit see what has changed recently.",{background:"cyan"});if(b.together){var c=a("toontalk-together-button",void 0,"Work with others","Click to work with someone else.",{background:"orange"});c["data-end-togetherjs-html"]=
"Stop collaborating";c.addEventListener("click",function(){TogetherJS(c)},!1);window.TogetherJSConfig_on_close=function(){c.innerHTML="Work with others";c.title="Click to start collaborating with others."};window.TogetherJSConfig_on_ready=function(){c.innerHTML="Work alone";c.title="Click to stop collaborating."};TogetherJS.hub.on("togetherjs.hello-back",window.TogetherJSConfig_on_ready);var d=function(a){if(a.sameUrl){var b=TogetherJS.require("elementFinder");try{var c="drop"===a.event_type?b.findElement(a.currentTarget):
b.findElement(a.target),d="MouseEvent"===a.event_class?new MouseEvent(a.event_type,a):new DragEvent(a.event_type,a);d.simulatedEventMessage=a;c.dispatchEvent(d)}catch(Fa){console.error(Fa)}}};["dragstart_together","dragend_together","drop_together","drag_together"].forEach(function(a){TogetherJS.hub.on(a,d)})}},e=function(a){try{window.speechSynthesis.cancel()}catch(A){}try{h.backup_all_top_level_widgets(!0)}catch(A){b.UTILITIES.report_internal_error(A)}};a=function(){g=function(a){$(".toontalk-top-level-resource-container").each(function(a,
b){(a=b.toontalk_widget_side)&&a.set_running&&a.set_running(!1)})};b.debugging=h.get_current_url_parameter("debugging");b.logging=h.get_current_url_parameter("log");b.together=h.get_current_url_boolean_parameter("together",!1);b.maximum_recursion_depth=100;b.volume=h.get_current_url_numeric_parameter("volume",10)/100;b.puzzle=h.get_current_url_boolean_parameter("puzzle",!1);b.open_backside_only_if_alt_key=h.get_current_url_boolean_parameter("alt_key_to_open_backside",b.puzzle);b.reset=h.get_current_url_boolean_parameter("reset",
b.puzzle);b.speak=h.get_current_url_boolean_parameter("speak",!1);b.listen=h.get_current_url_boolean_parameter("listen",!1);b.speak&&!window.speechSynthesis&&(b.speak=!1,h.display_message("This browser doesn't support speech output. speak=1 in URL ignored."));b.listen&&"undefined"===typeof SpeechRecognition&&"undefined"===typeof webkitSpeechRecognition&&(b.listen=!1,h.display_message("This browser doesn't support speech input. listen=1 in URL ignored."));b.balloons=h.get_current_url_boolean_parameter("balloons",
!0);b.TRANSLATION_ENABLED=h.get_current_url_boolean_parameter("translate",!1);b.FONT_ASPECT_RATIO=.64;b.animation_settings||(b.animation_settings={BIRD_ANIMATION_SPEED:.5,ROBOT_ANIMATION_SPEED:.25,BAMMER_ANIMATION_SPEED:.75,ANIMATION_SPEED:.5,OPEN_BACKSIDE_DURATION:500,CHANGE_SIZE_DURATION:1E3,BUTTON_USE_DELAY:200,STOP_TRAINING_DELAY:1500,PAUSE_BETWEEN_STEPS:50,PAUSE_BETWEEN_BIRD_STEPS:50});window.document.addEventListener("click",g);b.DEFAULT_QUEUE=window.TOONTALK.queue.create();b.DEFAULT_QUEUE.start();
b.CHROME_APP?chrome.runtime.onSuspend.addListener(e):window.addEventListener("beforeunload",e);b.TRANSLATION_ENABLED?d():$("#google_translate_element").remove();b.vacuum.the_vacuum||b.vacuum.create();h.add_test_all_button();c();B("toontalk-robot",b.robot);B("toontalk-empty-nest",b.nest);B("toontalk-bird-static",b.bird);$("[title]").each(function(a,b){h.use_custom_tooltip(b)});TOONTALK.RUNNING_LOCALLY||(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)};
a[e].l=1*new Date;f=b.createElement(c);g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,g)}(window,document,"script",b.CHROME_APP?TOONTALK.TOONTALK_URL+"libraries/analytics.js":"https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-57964541-1","auto"),b.CHROME_APP?(ga("set","checkProtocolTask",function(){}),ga("require","displayfeatures"),ga("send","pageview","/options.html")):ga("send","pageview"));document.addEventListener("visibilitychange",function(){document.hidden?
h.mute_audio_objects_playing():(h.rerender_all(),h.restore_audio_volumes())});setTimeout(function(){b.DISPLAY_UPDATES.update_display()},100);"undefined"===typeof b.cross_origin_url_function?h.download_file("https://toontalk.appspot.com/p/https%3A%2F%2Fdrive.google.com%2Fuc%3Fid%3D0B0taMM6vlEqQaWprd2d1ZnlmQWs",function(a){a&&"working"===a.trim()&&(b.cross_origin_url_function=function(a){return"https://toontalk.appspot.com/p/"+encodeURIComponent(a)},b.is_already_cross_origin_url=function(a){return 0===
a.indexOf("https://toontalk.appspot.com/p/")});h.process_json_elements()}):h.process_json_elements();X=b.together?1:(new Date).getTime();f=!0;document.dispatchEvent(b.UTILITIES.create_event("toontalk_initialized",{}));0<b.volume&&setTimeout(G)};var g;f||(h.get_current_url_parameter("replace-with-url")?I(a):a())};h.do_after_initialization=function(a){f?a():document.addEventListener("toontalk_initialized",a)};return h}(window.TOONTALK);window.initialize_toontalk=window.TOONTALK.UTILITIES.initialize;
