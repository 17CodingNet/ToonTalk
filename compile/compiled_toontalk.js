(function(b){var g;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(g={},define(function(){return g})):g="undefined"!==typeof window?window:b:g=exports;(function(b){var c={greatest_common_divisor:function(h,b){if(1===b||1===h)return 1;for(var a;0!==b;){a=b;b=h%b;if(!isFinite(b))return 0;h=a}return h}};c.gcd=c.greatest_common_divisor;c.fromRandom=function(h){return Math.random()*(1<<h)>>>0};c.fromMillitime=function(){return+new Date};c.fromUnixtime=
function(){return.001*c.fromMillitime()|0};"undefined"!==typeof b&&(b.integer=c);(function(h){function b(h,c,f){if(f!==a)return h instanceof b?h:"undefined"===typeof h?d:b.parse(h);for(h=h||[];h.length&&!h[h.length-1];)--h.length;this._d=h;this._s=h.length?c||1:0}var a={};b._construct=function(h,d){return new b(h,d,a)};b.base=1E7;b.base_log10=7;var d=new b([],0,a);b.ZERO=d;var c=new b([1],1,a);b.ONE=c;var f=new b(c._d,-1,a);b.M_ONE=f;b._0=d;b._1=c;b.small=[d,c,new b([2],1,a),new b([3],1,a),new b([4],
1,a),new b([5],1,a),new b([6],1,a),new b([7],1,a),new b([8],1,a),new b([9],1,a),new b([10],1,a),new b([11],1,a),new b([12],1,a),new b([13],1,a),new b([14],1,a),new b([15],1,a),new b([16],1,a),new b([17],1,a),new b([18],1,a),new b([19],1,a),new b([20],1,a),new b([21],1,a),new b([22],1,a),new b([23],1,a),new b([24],1,a),new b([25],1,a),new b([26],1,a),new b([27],1,a),new b([28],1,a),new b([29],1,a),new b([30],1,a),new b([31],1,a),new b([32],1,a),new b([33],1,a),new b([34],1,a),new b([35],1,a),new b([36],
1,a)];b.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");b.prototype.toString=function(h){h=+h||10;if(2>h||36<h)throw Error("illegal radix "+h+".");if(0===this._s)return"0";if(10===h){h=0>this._s?"-":"";h+=this._d[this._d.length-1].toString();for(var a=this._d.length-2;0<=a;a--){for(var d=this._d[a].toString();7>d.length;)d="0"+d;h+=d}return h}a=b.digits;h=b.small[h];for(var d=this._s,c=this.abs(),f=[],e;0!==c._s;)e=c.divRem(h),c=e[0],e=e[1],f.push(a[e.valueOf()]);return(0>d?"-":"")+f.reverse().join("")};
b.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];b.parse=function(h,c){function f(b){b=b.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return b.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(b,h,a,d,c){c=+c;var f=0>c,e=a.length+c;b=(f?a:d).length;c=(c=Math.abs(c))>=b?c-b+f:0;b=Array(c+1).join("0");a+=d;return(h||"")+(f?a=b+a:a+=b).substr(0,e+=f?b.length:0)+(e<a.length?"."+a.substr(e):"")})}h=h.toString();if("undefined"===typeof c||10===+c)h=f(h);var e=(new RegExp("^([+\\-]?)("+("undefined"===
typeof c?"0[xcb]":16==c?"0x":8==c?"0c":2==c?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(h);if(e){var k=e[1]||"+",l=e[2]||"",e=e[3]||"";if("undefined"===typeof c)c="0x"===l||"0X"===l?16:"0c"===l||"0C"===l?8:"0b"===l||"0B"===l?2:10;else if(2>c||36<c)throw Error("Illegal radix "+c+".");c=+c;if(!b.radixRegex[c].test(e))throw Error("Bad digit for radix "+c);e=e.replace(/^0+/,"").split("");if(0===e.length)return d;k="-"===k?-1:1;if(10==c){for(l=[];7<=e.length;)l.push(parseInt(e.splice(e.length-b.base_log10,
b.base_log10).join(""),10));l.push(parseInt(e.join(""),10));return new b(l,k,a)}l=d;c=b.small[c];for(var n=b.small,m=0;m<e.length;m++)l=l.multiply(c).add(n[parseInt(e[m],36)]);return new b(l._d,k,a)}throw Error("Invalid BigInteger format: "+h);};b.prototype.add=function(h){if(0===this._s)return b(h);h=b(h);if(0===h._s)return this;if(this._s!==h._s)return h=h.negate(),this.subtract(h);var d=this._d;h=h._d;for(var c=d.length,f=h.length,e=Array(Math.max(c,f)+1),k=Math.min(c,f),l=0,n=0;n<k;n++)l=d[n]+
h[n]+l,e[n]=l%1E7,l=l/1E7|0;f>c&&(d=h,c=f);for(n=k;l&&n<c;n++)l=d[n]+l,e[n]=l%1E7,l=l/1E7|0;for(l&&(e[n]=l);n<c;n++)e[n]=d[n];return new b(e,this._s,a)};b.prototype.negate=function(){return new b(this._d,-this._s|0,a)};b.prototype.abs=function(){return 0>this._s?this.negate():this};b.prototype.subtract=function(h){if(0===this._s)return b(h).negate();h=b(h);if(0===h._s)return this;if(this._s!==h._s)return h=h.negate(),this.add(h);var c=this;0>this._s&&(c=new b(h._d,1,a),h=new b(this._d,1,a));var f=
c.compareAbs(h);if(0===f)return d;if(0>f){var e=h;h=c;c=e}c=c._d;h=h._d;var e=c.length,k=h.length,l=Array(e),n=0,m,t;for(m=0;m<k;m++)t=c[m]-n-h[m],0>t?(t+=1E7,n=1):n=0,l[m]=t;for(m=k;m<e;m++){t=c[m]-n;if(0>t)t+=1E7;else{l[m++]=t;break}l[m]=t}for(;m<e;m++)l[m]=c[m];return new b(l,f,a)};(function(){function h(c,d){for(var f=c._d,e=f.slice(),k=0;;){var l=(f[k]||0)+1;e[k]=l%1E7;if(9999999>=l)break;++k}return new b(e,d,a)}function d(h,c){for(var f=h._d,e=f.slice(),k=0;;){var l=(f[k]||0)-1;if(0>l)e[k]=
l+1E7;else{e[k]=l;break}++k}return new b(e,c,a)}b.prototype.next=function(){switch(this._s){case 0:return c;case -1:return d(this,-1);default:return h(this,1)}};b.prototype.prev=function(){switch(this._s){case 0:return f;case -1:return h(this,-1);default:return d(this,1)}}})();b.prototype.compareAbs=function(h){if(this===h)return 0;if(!(h instanceof b)){if(!isFinite(h))return isNaN(h)?h:-1;h=b(h)}if(0===this._s)return 0!==h._s?-1:0;if(0===h._s)return 1;var a=this._d.length,c=h._d.length;if(a<c)return-1;
if(a>c)return 1;c=this._d;h=h._d;for(--a;0<=a;a--)if(c[a]!==h[a])return c[a]<h[a]?-1:1;return 0};b.prototype.compare=function(h){if(this===h)return 0;h=b(h);return 0===this._s?-h._s:this._s===h._s?this.compareAbs(h)*this._s:this._s};b.prototype.isUnit=function(){return this===c||this===f||1===this._d.length&&1===this._d[0]};b.prototype.multiply=function(h){if(0===this._s)return d;h=b(h);if(0===h._s)return d;if(this.isUnit())return 0>this._s?h.negate():h;if(h.isUnit())return 0>h._s?this.negate():this;
if(this===h)return this.square();var c=this._d.length>=h._d.length,f=(c?this:h)._d,c=(c?h:this)._d,e=f.length,k=c.length,l=e+k,n=Array(l),m;for(m=0;m<l;m++)n[m]=0;for(m=0;m<k;m++){for(var l=0,t=c[m],g=e+m,r,p=m;p<g;p++)r=n[p]+t*f[p-m]+l,l=r/1E7|0,n[p]=r%1E7|0;l&&(r=n[p]+l,n[p]=r%1E7)}return new b(n,this._s*h._s,a)};b.prototype.multiplySingleDigit=function(h){if(0===h||0===this._s)return d;if(1===h)return this;var c;if(1===this._d.length)return c=this._d[0]*h,1E7<=c?new b([c%1E7|0,c/1E7|0],1,a):new b([c],
1,a);if(2===h)return this.add(this);if(this.isUnit())return new b([h],1,a);var f=this._d,e=f.length;c=e+1;for(var k=Array(c),l=0;l<c;l++)k[l]=0;for(var n=l=0;n<e;n++)c=h*f[n]+l,l=c/1E7|0,k[n]=c%1E7|0;l&&(k[n]=l);return new b(k,1,a)};b.prototype.square=function(){if(0===this._s)return d;if(this.isUnit())return c;var h=this._d,f=h.length,e=Array(f+f+1),k,l,n,m;for(m=0;m<f;m++)n=2*m,k=h[m]*h[m],l=k/1E7|0,e[n]=k%1E7,e[n+1]=l;for(m=0;m<f;m++){l=0;n=2*m+1;for(var t=m+1;t<f;t++,n++)k=h[t]*h[m]*2+e[n]+l,
l=k/1E7|0,e[n]=k%1E7;n=f+m;k=l+e[n];l=k/1E7|0;e[n]=k%1E7;e[n+1]+=l}return new b(e,1,a)};b.prototype.quotient=function(h){return this.divRem(h)[0]};b.prototype.divide=b.prototype.quotient;b.prototype.remainder=function(h){return this.divRem(h)[1]};b.prototype.divRem=function(h){h=b(h);if(0===h._s)throw Error("Divide by zero");if(0===this._s)return[d,d];if(1===h._d.length)return this.divRemSmall(h._s*h._d[0]);switch(this.compareAbs(h)){case 0:return[this._s===h._s?c:f,d];case -1:return[d,this]}var e=
this._s*h._s,k=h.abs(),l=this._d,n=l.length,m=[],t,g=new b([],0,a);for(g._s=1;n;)if(g._d.unshift(l[--n]),0>g.compareAbs(h))m.push(0);else{if(0===g._s)t=0;else{var r=g._d.length;t=k._d.length;r=1E7*g._d[r-1]+g._d[r-2];t=1E7*k._d[t-1]+k._d[t-2];g._d.length>k._d.length&&(r=1E7*(r+1));t=Math.ceil(r/t)}do{r=k.multiplySingleDigit(t);if(0>=r.compareAbs(g))break;t--}while(t);m.push(t);t&&(t=g.subtract(r),g._d=t._d.slice(),0===g._d.length&&(g._s=0))}return[new b(m.reverse(),e,a),new b(g._d,this._s,a)]};b.prototype.divRemSmall=
function(h){h=+h;if(0===h)throw Error("Divide by zero");var c=this._s*(0>h?-1:1);h=Math.abs(h);if(1>h||1E7<=h)throw Error("Argument out of range");if(0===this._s)return[d,d];if(1===h||-1===h)return[1===c?this.abs():new b(this._d,c,a),d];if(1===this._d.length){var f=new b([this._d[0]/h|0],1,a);h=new b([this._d[0]%h|0],1,a);0>c&&(f=f.negate());0>this._s&&(h=h.negate());return[f,h]}for(var e=this._d.slice(),f=Array(e.length),k=0,l=0,n=0,m;e.length;)k=1E7*k+e[e.length-1],k<h?(f[n++]=0,e.pop(),l=1E7*l+
k):(m=0===k?0:k/h|0,l=k-h*m,(f[n++]=m)?(e.pop(),k=l):e.pop());h=new b([l],1,a);0>this._s&&(h=h.negate());return[new b(f.reverse(),c,a),h]};b.prototype.isEven=function(){var h=this._d;return 0===this._s||0===h.length||0===h[0]%2};b.prototype.isOdd=function(){return!this.isEven()};b.prototype.sign=function(){return this._s};b.prototype.isPositive=function(){return 0<this._s};b.prototype.isNegative=function(){return 0>this._s};b.prototype.isZero=function(){return 0===this._s};b.prototype.exp10=function(h){h=
+h;if(0===h)return this;if(Math.abs(h)>Number(e))throw Error("exponent too large in BigInteger.exp10");if(0<h){for(var c=new b(this._d.slice(),this._s,a);7<=h;h-=7)c._d.unshift(0);if(0==h)return c;c._s=1;c=c.multiplySingleDigit(Math.pow(10,h));return 0>this._s?c.negate():c}if(-h>=7*this._d.length)return d;c=new b(this._d.slice(),this._s,a);for(h=-h;7<=h;h-=7)c._d.shift();return 0==h?c:c.divRemSmall(Math.pow(10,h))[0]};b.prototype.pow=function(h){if(this.isUnit())return 0<this._s?this:b(h).isOdd()?
this:this.negate();h=b(h);if(0===h._s)return c;if(0>h._s){if(0===this._s)throw Error("Divide by zero");return d}if(0===this._s)return d;if(h.isUnit())return this;if(0<h.compareAbs(e))throw Error("exponent too large in BigInteger.pow");for(var a=this,f=c,k=b.small[2];h.isPositive()&&(!h.isOdd()||(f=f.multiply(a),!h.isUnit()));)a=a.square(),h=h.quotient(k);return f};b.prototype.modPow=function(h,a){for(var d=c,f=this;h.isPositive();)h.isOdd()&&(d=d.multiply(f).remainder(a)),h=h.quotient(b.small[2]),
h.isPositive()&&(f=f.square().remainder(a));return d};b.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var h=this._d.length;if(30>7*h)return Math.log(this.valueOf());var c=Math.ceil(30/7),d=this._d.slice(h-c);return Math.log((new b(d,1,a)).valueOf())+(h-c)*Math.log(1E7)};b.prototype.valueOf=function(){return parseInt(this.toString(),10)};b.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var e=b(2147483647);b.MAX_EXP=e;(function(){function h(a){return function(h){return a.call(b(h))}}
function a(h){return function(a,c){return h.call(b(a),b(c))}}function c(h){return function(a,c,d){return h.call(b(a),b(c),b(d))}}(function(){var d,f,e="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),k="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),l=["modPow"];for(d=0;d<e.length;d++)f=e[d],b[f]=h(b.prototype[f]);for(d=0;d<k.length;d++)f=k[d],b[f]=a(b.prototype[f]);for(d=0;d<l.length;d++)f=
l[d],b[f]=c(b.prototype[f]);b.exp10=function(h,a){return b(h).exp10(a)}})()})();h.BigInteger=b})("undefined"!==typeof b?b:this);var a={greatest_common_divisor:function(h,b){if(b.isUnit()||h.isUnit())return BigInteger.ONE;for(var a;!b.isZero();)a=b,b=h.remainder(b),h=a;return h},create:function(){return[0]},clone:function(h){for(var b=[],a=0,c=h.length;a<c;a++)b[a]=h[a];return b},copy:function(h,b){h=[];for(var a=0,c=b.length;a<c;a++)h[a]=b[a];return h},abs:function(h,b){h[0]=Math.abs(b[0]);return h},
str:function(h){return h[0].toString()},toInteger:function(h){return out[0]},fromInteger:function(h){return[parseInt(h)]}};a.ZERO=a.fromInteger(0);a.ONE=a.fromInteger(1);"undefined"!==typeof b&&(b.bigint=a);if(!k)var k=Array;if(!l)var l=Math.pow(2,56);if(!e)var e=16777216;var f={EPSILON:2E-16};f.MAX_LOOPS=e;f.create=function(){var h=new k(2);h[0]=0;h[1]=1;return h};f.clone=function(h){var b=new k(2);b[0]=h[0];b[1]=h[1];return b};f.fromValues=function(h,b){var a=new k(2);a[0]=h;a[1]=b;return f.normalize(a,
a)};f.copy=function(h,b){h[0]=b[0];h[1]=b[1];return h};f.set=function(h,b,a){h[0]=b;h[1]=a;return f.normalize(h,h)};f.abs=function(h,b){h[0]=Math.abs(b[0]);h[1]=b[1];return h};f.invert=function(h,b){var a=b[0];h[0]=b[1];h[1]=a;return h};f.reciprocal=f.invert;f.add=function(h,b,a){b[1]===a[1]?(h[0]=b[0]+a[0],h[1]=b[1]):(h[0]=b[0]*a[1]+a[0]*b[1],h[1]=b[1]*a[1]);return f.normalize(h,h)};f.subtract=function(h,b,a){b[1]===a[1]?(h[0]=b[0]-a[0],h[1]=b[1]):(h[0]=b[0]*a[1]-a[0]*b[1],h[1]=b[1]*a[1]);return f.normalize(h,
h)};f.sub=f.subtract;f.multiply=function(h,b,a){h[0]=b[0]*a[0];h[1]=b[1]*a[1];return f.normalize(h,h)};f.mul=f.multiply;f.mediant=function(h,b,a){h[0]=b[0]+a[0];h[1]=b[1]+a[1];return f.normalize(h,h)};f.divide=function(h,b,a){h[0]=b[0]*a[1];h[1]=b[1]*a[0];return f.normalize(h,h)};f.div=f.divide;f.equals=function(h,b){return 0===h[0]&&0===b[0]||0===h[1]&&0===b[1]?!0:h[0]===b[0]&&h[1]===b[1]};f.approximates=function(h,b){if(f.equals(h,b))return!0;var a=f.create();f.sub(a,h,b);f.abs(a,a);return f.isLessThan(a,
f.INFINITESIMAL)};f.isGreaterThan=function(h,b){return f.equals(h,b)?!1:h[0]*b[1]>b[0]*h[1]};f.isLessThan=function(h,b){return f.equals(h,b)?!1:h[0]*b[1]<b[0]*h[1]};f.isNegative=function(h){return 0>h[0]};f.min=function(h,b,a){f.isLessThan(b,a)?(h[0]=b[0],h[1]=b[1]):(h[0]=a[0],h[1]=a[1]);return h};f.max=function(h,b,a){f.isGreaterThan(b,a)?(h[0]=b[0],h[1]=b[1]):(h[0]=a[0],h[1]=a[1]);return h};f.scalar_multiply=function(h,b,a){h[0]=b[0]*a;h[1]=b[1];return f.normalize(h,h)};f.scalar_divide=function(h,
b,a){h[0]=b[0];h[1]=b[1]*a;return f.normalize(h,h)};f.normalize=function(h,b){if(isNaN(b[0])||isNaN(b[1])||0===b[0]&&0===b[1])return h[0]=0,h[1]=0,h;if(0===b[0])return h[0]=0,h[1]=1,h;if(0===b[1])return h[0]=1,h[1]=0,h;if(b[0]===b[1])return h[0]=1,h[1]=1,h;0<b[1]?(h[0]=b[0],h[1]=b[1]):(h[0]=-b[0],h[1]=-b[1]);var a=c.greatest_common_divisor(Math.abs(h[0]),h[1]);1<a&&(h[0]/=a,h[1]/=a);return h};f.opposite=function(h,b){h[0]=-b[0];h[1]=b[1];return h};f.negative=f.opposite;f.neg=f.opposite;f.power=function(h,
b,a){2===a?(h[0]=b[0]*b[0],h[1]=b[1]*b[1]):0<a?(h[0]=Math.pow(b[0],a),h[1]=Math.pow(b[1],a)):0>a?(a=Math.abs(a),h[0]=Math.pow(b[1],a),h[1]=Math.pow(b[0],a)):f.copy(h,f.ONE);return f.normalize(h,h)};f.pow=f.power;f.sqrt=function(h,b){return f.nthRoot(h,b,2)};f.nthRoot=function(b,a,c){if(f.equals(a,f.ZERO))return f.copy(b,f.ZERO);if(f.equals(a,f.ONE))return f.copy(b,f.ONE);if(f.equals(a,f.INFINITY))return f.copy(b,f.INFINITY);if(f.equals(a,f.INFINULL))return f.copy(b,f.INFINULL);var d=f.isNegative(a);
d&&(a[0]=-a[0]);b=f.copy(b,f.ONE);for(var e=[1,0,0,1],k=f.clone(f.ONE),l=f.MAX_LOOPS;!f.approximates(a,k)&&l--;)f.isLessThan(a,k)?(e[0]+=e[1],e[2]+=e[3]):(e[1]+=e[0],e[3]+=e[2]),b[0]=e[0]+e[1],b[1]=e[2]+e[3],f.pow(k,b,c);d&&(a[0]=-a[0],1===c%2&&f.neg(b,b));return b};f.dot=function(b,a){return b[0]*a[0]+b[1]*a[1]};f.str=function(b){return 1===b[1]?b[0].toString():b[0]+"/"+b[1]};f.toDecimal=function(b){return b[0]/b[1]};f.dec=f.toDecimal;f.toInteger=function(b){return Math.round(f.toDecimal(b))};f.round=
f.toInteger;f.floor=function(b){return Math.floor(f.toDecimal(b))};f.ceil=function(b){return Math.ceil(f.toDecimal(b))};f.fromInteger_copy=function(b,a){b[0]=parseInt(a);b[1]=1;return b};f.fromInteger=function(b){return f.fromInteger_copy(f.create(),b)};f.fromIntegerInverse_copy=function(b,a){b[0]=1;b[1]=parseInt(a);0>b[1]&&(b[0]=-b[0],b[1]=-b[1]);return b};f.fromIntegerInverse=function(b){return f.fromIntegerInverse_copy(f.create(),b)};f.fromDecimal=function(b){return f.fromDecimal_copy(f.create(),
b)};f.fromDecimal_copy=function(b,a){a=parseFloat(a);if(isNaN(a))return f.copy(b,f.INFINULL);if(Infinity===a)return f.copy(b,f.INFINITY);if(Math.abs(a)<f.EPSILON)return f.copy(b,f.ZERO);if(Math.abs(a-1)<f.EPSILON)return f.copy(b,f.ONE);if(Math.abs(a%1)<f.EPSILON)return f.fromInteger_copy(b,a);if(Math.abs(1/a%1)<f.EPSILON)return f.fromIntegerInverse_copy(b,Math.round(1/a));f.copy(b,f.ONE);for(var c=[1,0,0,1],d=a,e=1,k=f.MAX_LOOPS;k--&&Math.abs(a-f.toDecimal(b))>f.EPSILON;){e=Math.floor(d);b[0]=e*c[0]+
c[2];b[1]=e*c[1]+c[3];if(d===e)break;d=1/(d-e);c[2]=c[0];c[3]=c[1];c[0]=b[0];c[1]=b[1]}return b};f.fromRandom=function(b){b[0]=0xfffffffffffff*Math.random()<<0;b[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return f.normalize(b,b)};f.sin=function(b,a){if(0===a[1])return f.copy(b,f.ZERO);f.scalar_multiply(b,a,2);var c=f.create();f.pow(c,a,2);f.add(c,c,f.ONE);f.divide(b,b,c);return b};f.cos=function(b,a){if(0===a[1])return f.neg(b,f.ONE);var c=f.create();f.pow(c,a,2);f.sub(b,f.ONE,c);var d=f.create();
f.add(d,f.ONE,c);f.divide(b,b,d);return b};f.tan=function(b,a){f.scalar_multiply(b,a,2);var c=f.create();f.pow(c,a,2);f.scalar_multiply(c,c,2);f.add(b,b,c);f.pow(c,a,4);f.sub(c,f.ONE,c);f.divide(b,b,c);return b};f.toEgyptian=function(b){b=f.clone(b);f.abs(b,b);var a=f.floor(b);a&&f.sub(b,b,f.fromInteger(a));if(!b[0])return a.toString();a||(a="");for(var c=1,d=f.create();1!==b[0];)c++,d=f.fromValues(1,c),f.isGreaterThan(b,d)&&(a&&(a+=" + "),a+=f.str(d),f.sub(b,b,d));return b?a?a+" + "+f.str(b):f.str(b):
a?a:"0"};f.toBabylonian=function(b){var a="",c=f.toDecimal(b);b=parseInt(c);for(var c=c-b,d=0,e=0;0<b;)(d=b%60)&&(a=d+" * 60^"+e+(a?" + ":"")+a),b=(b-d)/60,e++;for(e=-1;0<c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(a+=(a?" + ":"")+d+" * 60^"+e),e--);return a?a:"0"};f.traceSternBrocot=function(b){var a="";if(f.equals(b,f.ZERO)||f.equals(b,f.ONE)||f.equals(b,f.INFINITY)||f.equals(b,f.INFINULL))return a;b=f.clone(b);f.isNegative(b)&&(b[0]=-b[0]);for(var c=f.clone(f.ONE),d=[1,0,0,1],e=0,k=0,l=f.MAX_LOOPS;!f.approximates(b,
c)&&l--;)f.isLessThan(b,c)?(d[0]+=d[1],d[2]+=d[3],k++,e&&(a+="R",1!==e&&(a+=e),e=0,a+=" ")):(d[1]+=d[0],d[3]+=d[2],e++,k&&(a+="L",1!==k&&(a+=k),k=0,a+=" ")),c[0]=d[0]+d[1],c[1]=d[2]+d[3];k?(a+="L",1!==k&&(a+=k)):e&&(a+="R",1!==e&&(a+=e));0>l&&(a+="...");return a};f.toContinuedFraction=function(b,a){a="undefined"===typeof a?65536:parseInt(a);if(f.equals(b,f.ZERO))return[0];if(f.equals(b,f.ONE))return[1];if(f.equals(b,f.NEGONE))return[-1];if(f.equals(b,f.INFINITY))return[1,0];if(f.equals(b,f.INFINULL))return[0,
0];var c=f.clone(b),d=f.isNegative(c);d&&(c[0]=-c[0]);for(var e=f.clone(f.ONE),k=[1,0,0,1],l=1,n=[0],m=n.length-1;!f.equals(c,e)&&a--;)f.isLessThan(c,e)?(-1===l?n[m]++:(l=-1,n.push(1),m++),k[0]+=k[1],k[2]+=k[3]):(1===l?n[m]++:(l=1,n.push(1),m++),k[1]+=k[0],k[3]+=k[2]),e[0]=k[0]+k[1],e[1]=k[2]+k[3];0>a?n.push(0):n[m]++;if(d)for(var t in n)n[t]=-n[t];return n};f.fromContinuedFraction=function(b,a){f.fromInteger_copy(b,a[a.length-1]);for(var c=a.length-2;-1<c;c--)f.invert(b,b),f.add(b,f.fromInteger(a[c]),
b);return b};f.dump=function(b){f.create();return"rat\t"+f.str(b)+"\n~\t"+f.toDecimal(b)+"\nCF:\t["+f.toContinuedFraction(b)+"]\n"};f.ZERO=f.fromInteger(0);f.ONE=f.fromInteger(1);f.NEGONE=f.fromInteger(-1);f.INFINITY=f.fromValues(1,0);f.INFINULL=f.fromValues(0,0);f.INFINITESIMAL=f.clone([1,l]);f.PI=f.fromValues(1320192667429,420230377710);"undefined"!==typeof b&&(b.rat=f);if(!t)var t=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!g)var g=1073741824;var m={EPSILON:2E-16};m.MAX_LOOPS=g;m.create=
function(){var b=[];b[0]=BigInteger.ZERO;b[1]=BigInteger.ONE;return b};m.clone=function(b){var a=[];a[0]=b[0];a[1]=b[1];return a};m.fromValues=function(b,a){var c=[];c[0]=new BigInteger(b);c[1]=new BigInteger(a);return m.normalize(c,c)};m.copy=function(b,a){b[0]=a[0];b[1]=a[1];return b};m.set=function(b,a,c){b[0]=a;b[1]=c;return m.normalize(b,b)};m.toRat=function(b,a){return f.set(b,a[0].toJSValue(),a[1].toJSValue())};m.fromRat=function(b,a){return m.set(b,BigInteger(a[0]),BigInteger(a[1]))};m.abs=
function(b,a){b[0]=a[0].abs();b[1]=a[1];return b};m.invert=function(b,a){var c=a[0];b[0]=a[1];b[1]=c;return b};m.reciprocal=m.invert;m.add=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].add(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).add(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return m.normalize(b,b)};m.subtract=function(b,a,c){0===a[1].compare(c[1])?(b[0]=a[0].subtract(c[0]),b[1]=a[1]):(b[0]=a[0].multiply(c[1]).subtract(c[0].multiply(a[1])),b[1]=a[1].multiply(c[1]));return m.normalize(b,
b)};m.sub=m.subtract;m.multiply=function(b,a,c){b[0]=a[0].multiply(c[0]);b[1]=a[1].multiply(c[1]);return m.normalize(b,b)};m.mul=m.multiply;m.mediant=function(b,a,c){b[0]=a[0].add(c[0]);b[1]=a[1].add(c[1]);return m.normalize(b,b)};m.divide=function(b,a,c){b[0]=a[0].multiply(c[1]);b[1]=a[1].multiply(c[0]);return m.normalize(b,b)};m.div=m.divide;m.equals=function(b,a){return b[0].isZero()&&a[0].isZero()||b[1].isZero()&&a[1].isZero()?!0:0===b[0].compare(a[0])&&0===b[1].compare(a[1])};m.approximates=
function(b,a){if(m.equals(b,a))return!0;var c=m.create();m.sub(c,b,a);m.abs(c,c);return m.isLessThan(c,m.INFINITESIMAL)};m.isGreaterThan=function(b,a){return m.equals(b,a)?!1:0<b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};m.isLessThan=function(b,a){return m.equals(b,a)?!1:0>b[0].multiply(a[1]).compare(a[0].multiply(b[1]))};m.isNegative=function(b){return b[0].isNegative()};m.min=function(b,a,c){m.isLessThan(a,c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};m.max=function(b,a,c){m.isGreaterThan(a,
c)?(b[0]=a[0],b[1]=a[1]):(b[0]=c[0],b[1]=c[1]);return b};m.scalar_multiply=function(b,a,c){b[0]=a[0].multiply(c);b[1]=a[1];return m.normalize(b,b)};m.scalar_divide=function(b,a,c){b[0]=a[0];b[1]=a[1].multiply(c);return m.normalize(b,b)};m.normalize=function(b,c){if(c[0].isZero()||c[1].isZero())return c;if(0===c[0].compare(c[1]))return m.clone(m.ONE);if(c[1].isNegative())b[0]=c[0].negate(),b[1]=c[1].negate();else if(b[0]=c[0],b[1]=c[1],b[1].isZero())return b;var d=a.greatest_common_divisor(b[0].abs(),
b[1]);0<d.compare(BigInteger.ONE)&&(b[0]=b[0].quotient(d),b[1]=b[1].quotient(d));return b};m.opposite=function(b,a){b[0]=a[0].negate();b[1]=a[1];return b};m.negative=m.opposite;m.neg=m.opposite;m.power=function(b,a,c){2===c?(b[0]=a[0].square(),b[1]=a[1].square()):0<c?(b[0]=a[0].pow(c),b[1]=a[1].pow(c)):0>c?(c=Math.abs(c),b[0]=a[1].pow(c),b[1]=a[0].pow(c)):m.copy(b,m.ONE);return b};m.pow=m.power;m.sqrt=function(b,a){return m.nthRoot(b,a,2)};m.nthRoot=function(b,a,c){if(m.equals(a,m.ZERO))return m.copy(b,
m.ZERO);if(m.equals(a,m.ONE))return m.copy(b,m.ONE);if(m.equals(a,m.INFINITY))return m.copy(b,m.INFINITY);if(m.equals(a,m.INFINULL))return m.copy(b,m.INFINULL);var d=m.isNegative(a);d&&(a[0]=a[0].negate());m.copy(b,m.ONE);for(var e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=m.clone(m.ONE),k=g;!m.approximates(a,f)&&k--;)m.isLessThan(a,f)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),b[0]=e[0].add(e[1]),b[1]=e[2].add(e[3]),m.pow(f,b,c);d&&(a[0]=
a[0].negate(),1===c%2&&m.neg(b,b));return b};m.dot=function(b,a){return b[0].multiply(a[0]).add(b[1].multiply(a[1]))};m.str=function(b){return 0===b[1].compare(BigInteger.ONE)?b[0].toString():b[0].toString()+"/"+b[1].toString()};m.toDecimal=function(b){return b[0].toJSValue()/b[1].toJSValue()};m.dec=m.toDecimal;m.toInteger=function(b){return b[0].quotient(b[1]).toJSValue()};m.round=m.toInteger;m.toBigInteger=function(b){return b[0].quotient(b[1])};m.floor=function(b){return Math.floor(m.toDecimal(b))};
m.ceil=function(b){return Math.ceil(m.toDecimal(b))};m.fromInteger_copy=function(b,a){b[0]=BigInteger(a);b[1]=BigInteger.ONE;return b};m.fromInteger=function(b){return m.fromInteger_copy(m.create(),b)};m.fromIntegerInverse_copy=function(b,a){b[0]=BigInteger.ONE;b[1]=BigInteger(a);b[1].isNegative()&&(b[0]=b[0].negate(),b[1]=b[1].negate());return b};m.fromIntegerInverse=function(b){return m.fromIntegerInverse_copy(m.create(),b)};m.fromDecimal=function(b){return m.fromDecimal_copy(m.create(),b)};m.fromDecimal_copy=
function(b,a){a=parseFloat(a);if(isNaN(a))return m.copy(b,m.INFINULL);if(Infinity===a)return m.copy(b,m.INFINITY);if(Math.abs(a)<m.EPSILON)return m.copy(b,m.ZERO);if(Math.abs(a-1)<m.EPSILON)return m.copy(b,m.ONE);if(Math.abs(a%1)<m.EPSILON)return m.fromInteger_copy(b,a);if(Math.abs(1/a%1)<m.EPSILON)return m.fromIntegerInverse_copy(b,Math.round(1/a));m.copy(b,m.ONE);for(var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=a,e=BigInteger(1),f=m.MAX_LOOPS;f--&&Math.abs(a-m.toDecimal(b))>
m.EPSILON;){e=BigInteger(Math.floor(d));b[0]=e.multiply(c[0]).add(c[2]);b[1]=e.multiply(c[1]).add(c[3]);if(e=d-parseInt(e.toString(),10))d=1/e;else{if(a.toString()===m.toDecimal(b))break;d=(c=(a.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;m.add(b,m.fromInteger(c[1]),m.fromValues(c[2],Math.pow(10,d)));break}c[2]=c[0];c[3]=c[1];c[0]=b[0];c[1]=b[1]}return b};m.fromRandom=function(b){b[0]=BigInteger(0xfffffffffffff*Math.random()<<0);b[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return m.normalize(b,b)};m.sin=function(b,a){if(a[1].isZero())return m.copy(b,m.ZERO);m.scalar_multiply(b,a,2);var c=m.create();m.pow(c,a,2);m.add(c,c,m.ONE);m.divide(b,b,c);return b};m.cos=function(b,a){if(a[1].isZero())return m.neg(b,m.ONE);var c=m.create();m.pow(c,a,2);m.sub(b,m.ONE,c);var d=m.create();m.add(d,m.ONE,c);m.divide(b,b,d);return b};m.tan=function(b,a){m.scalar_multiply(b,a,2);var c=m.create();m.pow(c,a,2);m.scalar_multiply(c,c,2);m.add(b,b,c);m.pow(c,a,4);m.sub(c,
m.ONE,c);m.divide(b,b,c);return b};m.toEgyptian=function(b){b=m.clone(b);m.abs(b,b);var a=m.floor(b);a&&m.sub(b,b,m.fromInteger(a));if(!b[0])return a.toString();a||(a="");for(var c=1,d=m.create();1!==b[0];)c++,d=m.fromValues(1,c),m.isGreaterThan(b,d)&&(a&&(a+=" + "),a+=m.str(d),m.sub(b,b,d));return b?a?a+" + "+m.str(b):m.str(b):a?a:"0"};m.toBabylonian=function(b){var a="",c=m.toDecimal(b);b=parseInt(c);for(var c=c-b,d=0,e=0;0<b;)(d=b%60)&&(a=d+" * 60^"+e+(a?" + ":"")+a),b=(b-d)/60,e++;for(e=-1;0<
c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(a+=(a?" + ":"")+d+" * 60^"+e),e--);return a?a:"0"};m.traceSternBrocot=function(b){var a="";if(m.equals(b,m.ZERO)||m.equals(b,m.ONE)||m.equals(b,m.INFINITY)||m.equals(b,m.INFINULL))return a;b=m.clone(b);m.isNegative(b)&&(b[0]=b[0].negate());for(var c=m.clone(m.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=0,f=0,k=65536;!m.equals(b,c)&&k--;)m.isLessThan(b,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),f++,e&&(a+="R",1!==e&&(a+=e),e=
0,a+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),e++,f&&(a+="L",1!==f&&(a+=f),f=0,a+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);f?(a+="L",1!==f&&(a+=f)):e&&(a+="R",1!==e&&(a+=e));0>k&&(a+="...");return a};m.toContinuedFraction=function(b,a){a="undefined"===typeof a?65536:parseInt(a);if(m.equals(b,m.ZERO))return[0];if(m.equals(b,m.ONE))return[1];if(m.equals(b,m.NEGONE))return[-1];if(m.equals(b,m.INFINITY))return[1,0];if(m.equals(b,m.INFINULL))return[0,0];var c=m.clone(b),d=m.isNegative(c);d&&
(c[0]=c[0].negate());for(var e=m.clone(m.ONE),f=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],k=1,l=[0],n=l.length-1;!m.equals(c,e)&&a--;)m.isLessThan(c,e)?(-1===k?l[n]++:(k=-1,l.push(1),n++),f[0]=f[0].add(f[1]),f[2]=f[2].add(f[3])):(1===k?l[n]++:(k=1,l.push(1),n++),f[1]=f[1].add(f[0]),f[3]=f[3].add(f[2])),e[0]=f[0].add(f[1]),e[1]=f[2].add(f[3]);0>a?l.push(0):l[n]++;if(d)for(var t in l)l[t]=-l[t];return l};m.fromContinuedFraction=function(b,a){m.fromInteger_copy(b,a[a.length-1]);for(var c=
a.length-2;-1<c;c--)m.invert(b,b),m.add(b,m.fromInteger(a[c]),b);return b};m.fromFactorial=function(b,a){if("undefined"!==typeof factorial.PREPARED[a])return m.fromInteger_copy(b,factorial.PREPARED[a]);var c=factorial.PREPARED.length-1;for(m.fromInteger_copy(b,factorial.PREPARED[c]);c<a;)m.scalar_multiply(b,b,++c);return b};m.dump=function(b){return"bigrat\t"+m.str(b)+"\n~\t"+m.toDecimal(b)+"\nCF:\t["+m.toContinuedFraction(b)+"]\n"};m.ZERO=m.fromInteger(0);m.ONE=m.fromInteger(1);m.NEGONE=m.fromInteger(-1);
m.INFINITY=m.fromValues(1,0);m.INFINULL=m.fromValues(0,0);m.INFINITESIMAL=m.clone([new BigInteger(1),t]);m.PI=m.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof b&&(b.bigrat=m);var u=function(b,a){this.a=f.fromValues(parseInt(b),parseInt(a))};u.prototype.toString=function(){return f.str(this.a)};u.prototype.toContinuedFraction=function(b){return f.toContinuedFraction(this.a,b)};u.prototype.invert=function(){return f.invert(this.a)};u.prototype.reciprocal=u.prototype.invert;u.prototype.add=function(b){var a=f.create();f.add(a,this.a,b.a);return new u(a[0],a[1])};u.prototype.plus=u.prototype.add;u.prototype.subtract=function(b){var a=f.create();
f.sub(a,this.a,b.a);return new u(a[0],a[1])};u.prototype.sub=u.prototype.subtract;u.prototype.minus=u.prototype.subtract;u.prototype.multiply=function(b){var a=f.create();f.mul(a,this.a,b.a);return new u(a[0],a[1])};u.prototype.mul=u.prototype.multiply;u.prototype.times=u.prototype.multiply;u.prototype.mediant=function(b){var a=f.create();f.mediant(a,this.a,b.a);return new u(a[0],a[1])};u.prototype.divide=function(b){var a=f.create();f.div(a,this.a,b.a);return new u(a[0],a[1])};u.prototype.div=u.prototype.divide;
u.prototype.divided_by=u.prototype.divide;u.prototype.power=function(b){var a=f.create();f.pow(a,this.a,b);return new u(a[0],a[1])};u.prototype.pow=u.prototype.power;u.prototype.dump=function(){return f.dump(this.a)};u.prototype.toRat=function(){return f.clone(this.a)};u.prototype.toDecimal=function(){return f.toDecimal(this.a)};u.fromRat=function(b){var a=new u;a.a[0]=b[0];a.a[1]=b[1];return a};u.fromInteger=function(b){return u.fromRat(f.fromInteger(b))};u.fromIntegerInverse=function(b){return u.fromRat(f.fromIntegerInverse(b))};
u.fromDecimal=function(b){return u.fromRat(f.fromDecimal(b))};u.fromContinuedFraction=function(b){return u.fromRat(f.fromContinuedFraction(f.create(),b))};"undefined"!==typeof b&&(b.rational=u);var r={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<r.GREEK.length?r.GREEK[this.i++]:"?"}}};"undefined"!==typeof b&&(b.alpha=r);l={};l.FINE_STRUCTURE=m.fromValues(30223,4141639);
l.a=l.FINE_STRUCTURE;l.FINE_STRUCTURE_ALT=m.fromValues(13355891,1830237867);l.PLANK=m.fromValues(662606957,1E42);l.h=l.PLANK;l.hBAR=m.fromValues(1054571726,1E43);l.GRAVITATIONAL=m.fromValues(667384,1E16);l.G=l.GRAVITATIONAL;l.SPEED_OF_LIGHT=m.fromInteger(299792458);l.c=l.SPEED_OF_LIGHT;"undefined"!==typeof b&&(b.physics=l);var n={create:function(){return[[],[]]},fromValues:function(b){var a=n.create();a[0]=b.slice();b=n.countDimensions(a);for(a[1]=Array(b);b--;)a[1][b]=0;return n.normalize(a,a)},
mergeDimension:function(b,a,c){b[0]=[a.slice()];b[1].push(0);for(var d in c)b[0].push(c[d]);return b},evaluate:function(b,a,c){m.copy(b,m.ZERO);var d=n.countDimensions(a);if(0===d)return"0";if(1===d)for(var e in a[0]){if(a[0][e]){var d=m.fromInteger(a[0][e]),f=m.pow(m.create(),m.fromInteger(c[0]),a[1][0]+ +e);m.mul(d,d,f);m.add(b,b,d)}}else if(2===d)for(var k in a[0])for(e in a[0][k]){if(a[0][k][e]){var d=m.fromInteger(a[0][k][e]),f=m.pow(m.create(),m.fromInteger(c[0]),a[1][1]+ +e),l=m.pow(m.create(),
m.fromInteger(c[1]),a[1][0]+ +k);m.mul(d,d,f);m.mul(d,d,l);m.add(b,b,d)}}else if(3===d)for(var t in a[0])for(k in a[0][t])for(e in a[0][t][k]){if(a[0][t][k][e]){var d=m.fromInteger(a[0][t][k][e]),f=m.pow(m.create(),m.fromInteger(c[0]),a[1][2]+ +e),l=m.pow(m.create(),m.fromInteger(c[1]),a[1][1]+ +k),g=m.pow(m.create(),m.fromInteger(c[1]),a[1][0]+ +t);m.mul(d,d,f);m.mul(d,d,l);m.mul(d,d,g);m.add(b,b,d)}}else alert("unsupported dimension "+d);return b},derivatives:function(b){return[]},forEachNonZeroElement:function(b,
a){for(var c=b.slice(),d=0;"object"===typeof c[0];)c=c[0].slice(),d++;for(var e=d+1;0<e;--e){print(Array(e).join("[0]"));var c=eval("(a"+Array(e).join("[0]")+")"),f;for(f in c)for(var k=d+2;0<k;--k)print(c[f])}return""},str:function(b){var a="",c=new r.iterator,d=c.next(),e=c.next(),c=c.next(),f=n.countDimensions(b);if(0===f)a+=b.toString();else if(1===f)for(var k in b[0]){if(b[0][k]){a?a+=" "+(0>b[0][k]?"-":"+")+" ":0>b[0][k]&&(a+="-");var f=Math.abs(b[0][k]),l=b[1][0]+ +k;if(1!==f||0===l)a+=f;0!==
l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"))}}else if(2===f)for(var m in b[0])for(k in b[0][m]){if(b[0][m][k]){a?a+=" "+(0>b[0][m][k]?"-":"+")+" ":0>b[0][m][k]&&(a+="-");var f=Math.abs(b[0][m][k]),l=b[1][1]+ +k,t=b[1][0]+ +m;if(1!==f||0===t&&0===l)a+=f;0!==l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==t&&(a+=e+(1===t?"":"<sup>"+t+"</sup>"))}}else if(3===f)for(var g in b[0])for(m in b[0][g])for(k in b[0][g][m]){if(b[0][g][m][k]){a?a+=" "+(0>b[0][g][m][k]?"-":"+")+" ":0>b[0][g][m][k]&&(a+="-");var f=Math.abs(b[0][g][m][k]),
l=b[1][2]+ +k,t=b[1][1]+ +m,p=b[1][0]+ +g;if(1!==f||0===p&&0===t&&0===l)a+=f;0!==l&&(a+=d+(1===l?"":"<sup>"+l+"</sup>"));0!==t&&(a+=e+(1===t?"":"<sup>"+t+"</sup>"));0!==p&&(a+=c+(1===p?"":"<sup>"+p+"</sup>"))}}else alert("unsupported dimension "+f);""===a&&(a="0");return a},getJSFormula:function(b){var a="",c=n.countDimensions(b);if(0===c)return"0";if(1===c)for(var d in b[0])b[0][d]&&(a&&(a+="+"),a+=b[0][d],c=b[1][0]+ +d,0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var e in b[0])for(d in b[0][e]){if(b[0][e][d]){a&&
(a+="+");var a=a+b[0][e][d],c=b[1][1]+ +d,f=b[1][0]+ +e;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==f&&(a=1===f?a+"*m[1]":a+("*Math.pow(m[1],"+f+")"))}}else if(3===c)for(var k in b[0])for(e in b[0][k])for(d in b[0][k][e]){if(b[0][k][e][d]){a&&(a+="+");var a=a+b[0][k][e][d],c=b[1][2]+ +d,f=b[1][1]+ +e,l=b[1][0]+ +k;0!==c&&(a=1===c?a+"*m[0]":a+("*Math.pow(m[0],"+c+")"));0!==f&&(a=1===f?a+"*m[1]":a+("*Math.pow(m[1],"+f+")"));0!==l&&(a=1===l?a+"*m[2]":a+("*Math.pow(m[2],"+l+")"))}}else alert("unsupported dimension "+
c);""===a&&(a="0");return a}};String.prototype.repeat=function(b){return Array(b+1).join(this)};n.getGLSLFormula=function(b){var a="",c=n.countDimensions(b);if(0===c)return"0.0";if(1===c)for(var d in b[0])b[0][d]&&(a&&(a+="+"),a+=b[0][d]+".0",c=b[1][0]+ +d,0!==c&&(a=1===c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var e in b[0])for(d in b[0][e]){if(b[0][e][d]){a&&(a+="+");var a=a+(b[0][e][d]+".0"),c=b[1][1]+ +d,f=b[1][0]+ +e;0!==c&&(a=1===
c?a+"*m_0":1<c?a+"*m_0".repeat(c):a+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==f&&(a=1===f?a+"*m_1":1<f?a+"*m_1".repeat(f):a+("*pow(1.0"+"*m_1".repeat(Math.abs(f))+",-1.0)"))}}else alert("unsupported dimension "+c);""===a&&(a="0.0");return a};n.toJSON=function(b){return JSON.stringify(b)};n.fromJSON=function(b){return JSON.parse(b)};n.normalize=function(b,a){return a};n.binary_operation=function(b,a,c,d){b=n.create();var e=n.countDimensions(a),f=n.countDimensions(c);a[1][k]!==c[1][k]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===e&&1===f){for(var k in a[0])b[0][k]="undefined"===typeof c[0][k]?a[0][k]:d(a[0][k],c[0][k]);for(k in c[0])"undefined"===typeof a[0][k]&&(b[0][k]=c[0][k]);for(k in b[0])"undefined"===typeof a[0][k]&&"undefined"===typeof c[0][k]&&(b[0][k]=null)}else alert("unsupported dimension "+e);for(k=e;k--;)b[1][k]=a[1][k];return b};n.add=function(b,a,c){return n.binary_operation(b,a,c,function(b,a){return b+a})};n.subtract=function(b,
a,c){return n.binary_operation(b,a,c,function(b,a){return b-a})};n.sub=n.subtract;n.multiply=function(b,a,c){return b};n.mul=n.multiply;n.divide=function(b,a,c){return b};n.div=n.divide;n.equals=function(b,a){return b[0]===a[0]&&b[1]===a[1]};n.countDimensions=function(b){return"object"===typeof b[0]?n._countDimensions(b[0],1):0};n._countDimensions=function(b,a){return"object"===typeof b[0]?n._countDimensions(b[0],++a):a};n.ZERO=n.fromValues([0]);n.IDENTITY=n.fromValues([1]);n.ONE=n.IDENTITY;"undefined"!==
typeof b&&(b.polyrat=n)})(g)})(this);(function(b){"function"===typeof define&&define.amd?define(["jquery"],function(g){return b(g,window,document)}):"object"===typeof exports?module.exports=function(g,d){g||(g=window);d||(d="undefined"!==typeof window?require("jquery"):require("jquery")(g));return b(d,g,g.document)}:b(jQuery,window,document)})(function(b,g,d,c){function a(c){var d,e,f={};b.each(c,function(b){(d=b.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(d[1]+" ")&&(e=b.replace(d[0],d[2].toLowerCase()),
f[e]=b,"o"===d[1]&&a(c[b]))});c._hungarianMap=f}function k(d,e,f){d._hungarianMap||a(d);var h;b.each(e,function(a){h=d._hungarianMap[a];h===c||!f&&e[h]!==c||("o"===h.charAt(0)?(e[h]||(e[h]={}),b.extend(!0,e[h],e[a]),k(d[h],e[h],f)):e[h]=e[a])})}function l(b){var a=D.defaults.oLanguage,c=b.sZeroRecords;!b.sEmptyTable&&c&&"No data available in table"===a.sEmptyTable&&na(b,b,"sZeroRecords","sEmptyTable");!b.sLoadingRecords&&c&&"Loading..."===a.sLoadingRecords&&na(b,b,"sZeroRecords","sLoadingRecords");
b.sInfoThousands&&(b.sThousands=b.sInfoThousands);(b=b.sDecimal)&&eb(b)}function e(b){ka(b,"ordering","bSort");ka(b,"orderMulti","bSortMulti");ka(b,"orderClasses","bSortClasses");ka(b,"orderCellsTop","bSortCellsTop");ka(b,"order","aaSorting");ka(b,"orderFixed","aaSortingFixed");ka(b,"paging","bPaginate");ka(b,"pagingType","sPaginationType");ka(b,"pageLength","iDisplayLength");ka(b,"searching","bFilter");"boolean"===typeof b.sScrollX&&(b.sScrollX=b.sScrollX?"100%":"");"boolean"===typeof b.scrollX&&
(b.scrollX=b.scrollX?"100%":"");if(b=b.aoSearchCols)for(var a=0,c=b.length;a<c;a++)b[a]&&k(D.models.oSearch,b[a])}function f(a){ka(a,"orderable","bSortable");ka(a,"orderData","aDataSort");ka(a,"orderSequence","asSorting");ka(a,"orderDataType","sortDataType");var c=a.aDataSort;c&&!b.isArray(c)&&(a.aDataSort=[c])}function t(a){if(!D.__browser){var c={};D.__browser=c;var d=b("<div/>").css({position:"fixed",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(b("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(b("<div/>").css({width:"100%",height:10}))).appendTo("body"),e=d.children(),f=e.children();c.barWidth=e[0].offsetWidth-e[0].clientWidth;c.bScrollOversize=100===f[0].offsetWidth&&100!==e[0].clientWidth;c.bScrollbarLeft=1!==Math.round(f.offset().left);c.bBounding=d[0].getBoundingClientRect().width?!0:!1;d.remove()}b.extend(a.oBrowser,D.__browser);a.oScroll.iBarWidth=D.__browser.barWidth}function p(b,a,d,e,f,h){var q,k=!1;for(d!==c&&(q=d,k=!0);e!==f;)b.hasOwnProperty(e)&&
(q=k?a(q,b[e],e,b):b[e],k=!0,e+=h);return q}function m(a,c){var e=D.defaults.column,f=a.aoColumns.length,e=b.extend({},D.models.oColumn,e,{nTh:c?c:d.createElement("th"),sTitle:e.sTitle?e.sTitle:c?c.innerHTML:"",aDataSort:e.aDataSort?e.aDataSort:[f],mData:e.mData?e.mData:f,idx:f});a.aoColumns.push(e);e=a.aoPreSearchCols;e[f]=b.extend({},D.models.oSearch,e[f]);u(a,f,b(c).data())}function u(a,d,e){d=a.aoColumns[d];var h=a.oClasses,q=b(d.nTh);if(!d.sWidthOrig){d.sWidthOrig=q.attr("width")||null;var l=
(q.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);l&&(d.sWidthOrig=l[1])}e!==c&&null!==e&&(f(e),k(D.defaults.column,e),e.mDataProp!==c&&!e.mData&&(e.mData=e.mDataProp),e.sType&&(d._sManualType=e.sType),e.className&&!e.sClass&&(e.sClass=e.className),b.extend(d,e),na(d,e,"sWidth","sWidthOrig"),e.iDataSort!==c&&(d.aDataSort=[e.iDataSort]),na(d,e,"aDataSort"));var n=d.mData,v=F(n),m=d.mRender?F(d.mRender):null;e=function(b){return"string"===typeof b&&-1!==b.indexOf("@")};d._bAttrSrc=b.isPlainObject(n)&&
(e(n.sort)||e(n.type)||e(n.filter));d.fnGetData=function(b,a,d){var e=v(b,a,c,d);return m&&a?m(e,a,b,d):e};d.fnSetData=function(b,a,c){return w(n)(b,a,c)};"number"!==typeof n&&(a._rowReadObject=!0);a.oFeatures.bSort||(d.bSortable=!1,q.addClass(h.sSortableNone));a=-1!==b.inArray("asc",d.asSorting);e=-1!==b.inArray("desc",d.asSorting);d.bSortable&&(a||e)?a&&!e?(d.sSortingClass=h.sSortableAsc,d.sSortingClassJUI=h.sSortJUIAscAllowed):!a&&e?(d.sSortingClass=h.sSortableDesc,d.sSortingClassJUI=h.sSortJUIDescAllowed):
(d.sSortingClass=h.sSortable,d.sSortingClassJUI=h.sSortJUI):(d.sSortingClass=h.sSortableNone,d.sSortingClassJUI="")}function r(b){if(!1!==b.oFeatures.bAutoWidth){var a=b.aoColumns;Pa(b);for(var c=0,d=a.length;c<d;c++)a[c].nTh.style.width=a[c].sWidth}a=b.oScroll;""===a.sY&&""===a.sX||wa(b);X(b,null,"column-sizing",[b])}function n(b,a){var c=x(b,"bVisible");return"number"===typeof c[a]?c[a]:null}function h(a,c){var d=x(a,"bVisible"),d=b.inArray(c,d);return-1!==d?d:null}function C(b){return x(b,"bVisible").length}
function x(a,c){var d=[];b.map(a.aoColumns,function(b,a){b[c]&&d.push(a)});return d}function y(b){var a=b.aoColumns,d=b.aoData,e=D.ext.type.detect,f,h,q,k,l,n,v,m,t;f=0;for(h=a.length;f<h;f++)if(v=a[f],t=[],!v.sType&&v._sManualType)v.sType=v._sManualType;else if(!v.sType){q=0;for(k=e.length;q<k;q++){l=0;for(n=d.length;l<n;l++){t[l]===c&&(t[l]=E(b,l,f,"type"));m=e[q](t[l],b);if(!m&&q!==e.length-1)break;if("html"===m)break}if(m){v.sType=m;break}}v.sType||(v.sType="string")}}function K(a,d,e,f){var h,
q,k,l,n,v,t=a.aoColumns;if(d)for(h=d.length-1;0<=h;h--){v=d[h];var g=v.targets!==c?v.targets:v.aTargets;b.isArray(g)||(g=[g]);q=0;for(k=g.length;q<k;q++)if("number"===typeof g[q]&&0<=g[q]){for(;t.length<=g[q];)m(a);f(g[q],v)}else if("number"===typeof g[q]&&0>g[q])f(t.length+g[q],v);else if("string"===typeof g[q])for(l=0,n=t.length;l<n;l++)("_all"==g[q]||b(t[l].nTh).hasClass(g[q]))&&f(l,v)}if(e)for(h=0,a=e.length;h<a;h++)f(h,e[h])}function z(a,d,e,f){var h=a.aoData.length,q=b.extend(!0,{},D.models.oRow,
{src:e?"dom":"data",idx:h});q._aData=d;a.aoData.push(q);for(var k=a.aoColumns,l=0,v=k.length;l<v;l++)k[l].sType=null;a.aiDisplayMaster.push(h);d=a.rowIdFn(d);d!==c&&(a.aIds[d]=q);!e&&a.oFeatures.bDeferRender||U(a,h,e,f);return h}function L(a,c){var d;c instanceof b||(c=b(c));return c.map(function(b,c){d=Q(a,c);return z(a,d.data,c,d.cells)})}function E(b,a,d,e){var f=b.iDraw,h=b.aoColumns[d],q=b.aoData[a]._aData,k=h.sDefaultContent,l=h.fnGetData(q,e,{settings:b,row:a,col:d});if(l===c)return b.iDrawError!=
f&&null===k&&(qa(b,0,"Requested unknown parameter "+("function"==typeof h.mData?"{function}":"'"+h.mData+"'")+" for row "+a+", column "+d,4),b.iDrawError=f),k;if((l===q||null===l)&&null!==k)l=k;else if("function"===typeof l)return l.call(q);return null===l&&"display"==e?"":l}function A(b,a,c,d){b.aoColumns[c].fnSetData(b.aoData[a]._aData,d,{settings:b,row:a,col:c})}function M(a){return b.map(a.match(/(\\.|[^\.])+/g)||[""],function(b){return b.replace(/\\./g,".")})}function F(a){if(b.isPlainObject(a)){var d=
{};b.each(a,function(b,a){a&&(d[b]=F(a))});return function(b,a,e,f){var h=d[a]||d._;return h!==c?h(b,a,e,f):b}}if(null===a)return function(b){return b};if("function"===typeof a)return function(b,c,d,e){return a(b,c,d,e)};if("string"===typeof a&&(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var e=function(a,d,f){var h,da;if(""!==f){da=M(f);for(var q=0,k=da.length;q<k;q++){f=da[q].match(xa);h=da[q].match(ta);if(f){da[q]=da[q].replace(xa,"");""!==da[q]&&(a=a[da[q]]);h=[];da.splice(0,
q+1);da=da.join(".");if(b.isArray(a))for(q=0,k=a.length;q<k;q++)h.push(e(a[q],d,da));a=f[0].substring(1,f[0].length-1);a=""===a?h:h.join(a);break}else if(h){da[q]=da[q].replace(ta,"");a=a[da[q]]();continue}if(null===a||a[da[q]]===c)return c;a=a[da[q]]}}return a};return function(b,c){return e(b,c,a)}}return function(b){return b[a]}}function w(a){if(b.isPlainObject(a))return w(a._);if(null===a)return function(){};if("function"===typeof a)return function(b,c,d){a(b,"set",c,d)};if("string"===typeof a&&
(-1!==a.indexOf(".")||-1!==a.indexOf("[")||-1!==a.indexOf("("))){var d=function(a,e,f){f=M(f);var h;h=f[f.length-1];for(var da,q,k=0,l=f.length-1;k<l;k++){da=f[k].match(xa);q=f[k].match(ta);if(da){f[k]=f[k].replace(xa,"");a[f[k]]=[];h=f.slice();h.splice(0,k+1);da=h.join(".");if(b.isArray(e))for(q=0,l=e.length;q<l;q++)h={},d(h,e[q],da),a[f[k]].push(h);else a[f[k]]=e;return}q&&(f[k]=f[k].replace(ta,""),a=a[f[k]](e));if(null===a[f[k]]||a[f[k]]===c)a[f[k]]={};a=a[f[k]]}if(h.match(ta))a[h.replace(ta,"")](e);
else a[h.replace(xa,"")]=e};return function(b,c){return d(b,c,a)}}return function(b,c){b[a]=c}}function B(b){return ma(b.aoData,"_aData")}function I(b){b.aoData.length=0;b.aiDisplayMaster.length=0;b.aiDisplay.length=0;b.aIds={}}function O(b,a,d){for(var e=-1,f=0,h=b.length;f<h;f++)b[f]==a?e=f:b[f]>a&&b[f]--; -1!=e&&d===c&&b.splice(e,1)}function H(b,a,d,e){var f=b.aoData[a],h,q=function(c,d){for(;c.childNodes.length;)c.removeChild(c.firstChild);c.innerHTML=E(b,a,d,"display")};if("dom"!==d&&(d&&"auto"!==
d||"dom"!==f.src)){var k=f.anCells;if(k)if(e!==c)q(k[e],e);else for(d=0,h=k.length;d<h;d++)q(k[d],d)}else f._aData=Q(b,f,e,e===c?c:f._aData).data;f._aSortData=null;f._aFilterData=null;q=b.aoColumns;if(e!==c)q[e].sType=null;else{d=0;for(h=q.length;d<h;d++)q[d].sType=null;W(b,f)}}function Q(a,d,e,f){var h=[],q=d.firstChild,k,l,v=0,n,m=a.aoColumns,t=a._rowReadObject;f=f!==c?f:t?{}:[];var g=function(b,a){if("string"===typeof b){var c=b.indexOf("@");-1!==c&&(c=b.substring(c+1),w(b)(f,a.getAttribute(c)))}},
G=function(a){if(e===c||e===v)l=m[v],n=b.trim(a.innerHTML),l&&l._bAttrSrc?(w(l.mData._)(f,n),g(l.mData.sort,a),g(l.mData.type,a),g(l.mData.filter,a)):t?(l._setter||(l._setter=w(l.mData)),l._setter(f,n)):f[v]=n;v++};if(q)for(;q;){k=q.nodeName.toUpperCase();if("TD"==k||"TH"==k)G(q),h.push(q);q=q.nextSibling}else for(h=d.anCells,q=0,k=h.length;q<k;q++)G(h[q]);(d=d.firstChild?d:d.nTr)&&(d=d.getAttribute("id"))&&w(a.rowId)(f,d);return{data:f,cells:h}}function U(b,a,c,e){var f=b.aoData[a],h=f._aData,q=
[],k,l,v,n,m;if(null===f.nTr){k=c||d.createElement("tr");f.nTr=k;f.anCells=q;k._DT_RowIndex=a;W(b,f);n=0;for(m=b.aoColumns.length;n<m;n++){v=b.aoColumns[n];l=c?e[n]:d.createElement(v.sCellType);l._DT_CellIndex={row:a,column:n};q.push(l);if(!c||v.mRender||v.mData!==n)l.innerHTML=E(b,a,n,"display");v.sClass&&(l.className+=" "+v.sClass);v.bVisible&&!c?k.appendChild(l):!v.bVisible&&c&&l.parentNode.removeChild(l);v.fnCreatedCell&&v.fnCreatedCell.call(b.oInstance,l,E(b,a,n),h,a,n)}X(b,"aoRowCreatedCallback",
null,[k,h,a])}f.nTr.setAttribute("role","row")}function W(a,c){var d=c.nTr,e=c._aData;if(d){var f=a.rowIdFn(e);f&&(d.id=f);e.DT_RowClass&&(f=e.DT_RowClass.split(" "),c.__rowc=c.__rowc?Ca(c.__rowc.concat(f)):f,b(d).removeClass(c.__rowc.join(" ")).addClass(e.DT_RowClass));e.DT_RowAttr&&b(d).attr(e.DT_RowAttr);e.DT_RowData&&b(d).data(e.DT_RowData)}}function V(a){var c,d,e,f,h,q=a.nTHead,k=a.nTFoot,l=0===b("th, td",q).length,v=a.oClasses,n=a.aoColumns;l&&(f=b("<tr/>").appendTo(q));c=0;for(d=n.length;c<
d;c++)h=n[c],e=b(h.nTh).addClass(h.sClass),l&&e.appendTo(f),a.oFeatures.bSort&&(e.addClass(h.sSortingClass),!1!==h.bSortable&&(e.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Qa(a,h.nTh,c))),h.sTitle!=e[0].innerHTML&&e.html(h.sTitle),Ra(a,"header")(a,e,h,v);l&&R(a.aoHeader,q);b(q).find(">tr").attr("role","row");b(q).find(">tr>th, >tr>td").addClass(v.sHeaderTH);b(k).find(">tr>th, >tr>td").addClass(v.sFooterTH);if(null!==k)for(a=a.aoFooter[0],c=0,d=a.length;c<d;c++)h=n[c],h.nTf=a[c].cell,
h.sClass&&b(h.nTf).addClass(h.sClass)}function J(a,d,e){var f,h,q,k=[],l=[],v=a.aoColumns.length,n;if(d){e===c&&(e=!1);f=0;for(h=d.length;f<h;f++){k[f]=d[f].slice();k[f].nTr=d[f].nTr;for(q=v-1;0<=q;q--)a.aoColumns[q].bVisible||e||k[f].splice(q,1);l.push([])}f=0;for(h=k.length;f<h;f++){if(a=k[f].nTr)for(;q=a.firstChild;)a.removeChild(q);q=0;for(d=k[f].length;q<d;q++)if(n=v=1,l[f][q]===c){a.appendChild(k[f][q].cell);for(l[f][q]=1;k[f+v]!==c&&k[f][q].cell==k[f+v][q].cell;)l[f+v][q]=1,v++;for(;k[f][q+
n]!==c&&k[f][q].cell==k[f][q+n].cell;){for(e=0;e<v;e++)l[f+e][q+n]=1;n++}b(k[f][q].cell).attr("rowspan",v).attr("colspan",n)}}}}function ca(a){var d=X(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==b.inArray(!1,d))la(a,!1);else{var d=[],e=0,f=a.asStripeClasses,h=f.length,q=a.oLanguage,k=a.iInitDisplayStart,l="ssp"==ia(a),v=a.aiDisplay;a.bDrawing=!0;k!==c&&-1!==k&&(a._iDisplayStart=l?k:k>=a.fnRecordsDisplay()?0:k,a.iInitDisplayStart=-1);var k=a._iDisplayStart,n=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=
!1,a.iDraw++,la(a,!1);else if(l){if(!a.bDestroying&&!G(a))return}else a.iDraw++;if(0!==v.length)for(q=l?a.aoData.length:n,l=l?0:k;l<q;l++){var m=v[l],t=a.aoData[m];null===t.nTr&&U(a,m);m=t.nTr;if(0!==h){var g=f[e%h];t._sRowStripe!=g&&(b(m).removeClass(t._sRowStripe).addClass(g),t._sRowStripe=g)}X(a,"aoRowCallback",null,[m,t._aData,e,l]);d.push(m);e++}else e=q.sZeroRecords,1==a.iDraw&&"ajax"==ia(a)?e=q.sLoadingRecords:q.sEmptyTable&&0===a.fnRecordsTotal()&&(e=q.sEmptyTable),d[0]=b("<tr/>",{"class":h?
f[0]:""}).append(b("<td />",{valign:"top",colSpan:C(a),"class":a.oClasses.sRowEmpty}).html(e))[0];X(a,"aoHeaderCallback","header",[b(a.nTHead).children("tr")[0],B(a),k,n,v]);X(a,"aoFooterCallback","footer",[b(a.nTFoot).children("tr")[0],B(a),k,n,v]);f=b(a.nTBody);f.children().detach();f.append(b(d));X(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function fa(b,a){var c=b.oFeatures,d=c.bFilter;c.bSort&&fb(b);d?sa(b,b.oPreviousSearch):b.aiDisplay=b.aiDisplayMaster.slice();
!0!==a&&(b._iDisplayStart=0);b._drawHold=a;ca(b);b._drawHold=!1}function ba(a){var c=a.oClasses,d=b(a.nTable),d=b("<div/>").insertBefore(d),e=a.oFeatures,f=b("<div/>",{id:a.sTableId+"_wrapper","class":c.sWrapper+(a.nTFoot?"":" "+c.sNoFooter)});a.nHolding=d[0];a.nTableWrapper=f[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var h=a.sDom.split(""),q,k,l,v,n,m,t=0;t<h.length;t++){q=null;k=h[t];if("<"==k){l=b("<div/>")[0];v=h[t+1];if("'"==v||'"'==v){n="";for(m=2;h[t+m]!=v;)n+=h[t+m],m++;"H"==n?n=
c.sJUIHeader:"F"==n&&(n=c.sJUIFooter);-1!=n.indexOf(".")?(v=n.split("."),l.id=v[0].substr(1,v[0].length-1),l.className=v[1]):"#"==n.charAt(0)?l.id=n.substr(1,n.length-1):l.className=n;t+=m}f.append(l);f=b(l)}else if(">"==k)f=f.parent();else if("l"==k&&e.bPaginate&&e.bLengthChange)q=gb(a);else if("f"==k&&e.bFilter)q=ya(a);else if("r"==k&&e.bProcessing)q=hb(a);else if("t"==k)q=ib(a);else if("i"==k&&e.bInfo)q=jb(a);else if("p"==k&&e.bPaginate)q=kb(a);else if(0!==D.ext.feature.length)for(l=D.ext.feature,
m=0,v=l.length;m<v;m++)if(k==l[m].cFeature){q=l[m].fnInit(a);break}q&&(l=a.aanFeatures,l[k]||(l[k]=[]),l[k].push(q),f.append(q))}d.replaceWith(f);a.nHolding=null}function R(a,c){var d=b(c).children("tr"),e,f,h,q,k,l,v,n,m,t;a.splice(0,a.length);h=0;for(l=d.length;h<l;h++)a.push([]);h=0;for(l=d.length;h<l;h++)for(e=d[h],f=e.firstChild;f;){if("TD"==f.nodeName.toUpperCase()||"TH"==f.nodeName.toUpperCase()){n=1*f.getAttribute("colspan");m=1*f.getAttribute("rowspan");n=n&&0!==n&&1!==n?n:1;m=m&&0!==m&&
1!==m?m:1;q=0;for(k=a[h];k[q];)q++;v=q;t=1===n?!0:!1;for(k=0;k<n;k++)for(q=0;q<m;q++)a[h+q][v+k]={cell:f,unique:t},a[h+q].nTr=e}f=f.nextSibling}}function q(b,a,c){var d=[];c||(c=b.aoHeader,a&&(c=[],R(c,a)));a=0;for(var e=c.length;a<e;a++)for(var f=0,h=c[a].length;f<h;f++)!c[a][f].unique||d[f]&&b.bSortCellsTop||(d[f]=c[a][f].cell);return d}function v(a,c,d){X(a,"aoServerParams","serverParams",[c]);if(c&&b.isArray(c)){var e={},f=/(.*?)\[\]$/;b.each(c,function(b,a){var c=a.name.match(f);c?(c=c[0],e[c]||
(e[c]=[]),e[c].push(a.value)):e[a.name]=a.value});c=e}var h,q=a.ajax,k=a.oInstance,l=function(b){X(a,null,"xhr",[a,b,a.jqXHR]);d(b)};if(b.isPlainObject(q)&&q.data){h=q.data;var n=b.isFunction(h)?h(c,a):h;c=b.isFunction(h)&&n?n:b.extend(!0,c,n);delete q.data}n={data:c,success:function(b){var c=b.error||b.sError;c&&qa(a,0,c);a.json=b;l(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(c,d){var e=X(a,null,"xhr",[a,null,a.jqXHR]);-1===b.inArray(!0,e)&&("parsererror"==d?qa(a,0,"Invalid JSON response",
1):4===c.readyState&&qa(a,0,"Ajax error",7));la(a,!1)}};a.oAjaxData=c;X(a,null,"preXhr",[a,c]);a.fnServerData?a.fnServerData.call(k,a.sAjaxSource,b.map(c,function(b,a){return{name:a,value:b}}),l,a):a.sAjaxSource||"string"===typeof q?a.jqXHR=b.ajax(b.extend(n,{url:q||a.sAjaxSource})):b.isFunction(q)?a.jqXHR=q.call(k,c,l,a):(a.jqXHR=b.ajax(b.extend(n,q)),q.data=h)}function G(b){return b.bAjaxDataGet?(b.iDraw++,la(b,!0),v(b,N(b),function(a){Y(b,a)}),!1):!0}function N(a){var c=a.aoColumns,d=c.length,
e=a.oFeatures,f=a.oPreviousSearch,q=a.aoPreSearchCols,h,k=[],l,n,v,m=ua(a);h=a._iDisplayStart;l=!1!==e.bPaginate?a._iDisplayLength:-1;var t=function(b,a){k.push({name:b,value:a})};t("sEcho",a.iDraw);t("iColumns",d);t("sColumns",ma(c,"sName").join(","));t("iDisplayStart",h);t("iDisplayLength",l);var g={draw:a.iDraw,columns:[],order:[],start:h,length:l,search:{value:f.sSearch,regex:f.bRegex}};for(h=0;h<d;h++)n=c[h],v=q[h],l="function"==typeof n.mData?"function":n.mData,g.columns.push({data:l,name:n.sName,
searchable:n.bSearchable,orderable:n.bSortable,search:{value:v.sSearch,regex:v.bRegex}}),t("mDataProp_"+h,l),e.bFilter&&(t("sSearch_"+h,v.sSearch),t("bRegex_"+h,v.bRegex),t("bSearchable_"+h,n.bSearchable)),e.bSort&&t("bSortable_"+h,n.bSortable);e.bFilter&&(t("sSearch",f.sSearch),t("bRegex",f.bRegex));e.bSort&&(b.each(m,function(b,a){g.order.push({column:a.col,dir:a.dir});t("iSortCol_"+b,a.col);t("sSortDir_"+b,a.dir)}),t("iSortingCols",m.length));c=D.ext.legacy.ajax;return null===c?a.sAjaxSource?k:
g:c?k:g}function Y(b,a){var d=T(b,a),e=a.sEcho!==c?a.sEcho:a.draw,f=a.iTotalRecords!==c?a.iTotalRecords:a.recordsTotal,h=a.iTotalDisplayRecords!==c?a.iTotalDisplayRecords:a.recordsFiltered;if(e){if(1*e<b.iDraw)return;b.iDraw=1*e}I(b);b._iRecordsTotal=parseInt(f,10);b._iRecordsDisplay=parseInt(h,10);e=0;for(f=d.length;e<f;e++)z(b,d[e]);b.aiDisplay=b.aiDisplayMaster.slice();b.bAjaxDataGet=!1;ca(b);b._bInitComplete||Da(b,a);b.bAjaxDataGet=!0;la(b,!1)}function T(a,d){var e=b.isPlainObject(a.ajax)&&a.ajax.dataSrc!==
c?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===e?d.aaData||d[e]:""!==e?F(e)(d):d}function ya(a){var c=a.oClasses,e=a.sTableId,f=a.oLanguage,h=a.oPreviousSearch,q=a.aanFeatures,k='<input type="search" class="'+c.sFilterInput+'"/>',l=f.sSearch,l=l.match(/_INPUT_/)?l.replace("_INPUT_",k):l+k,c=b("<div/>",{id:q.f?null:e+"_filter","class":c.sFilter}).append(b("<label/>").append(l)),q=function(){var b=this.value?this.value:"";b!=h.sSearch&&(sa(a,{sSearch:b,bRegex:h.bRegex,bSmart:h.bSmart,bCaseInsensitive:h.bCaseInsensitive}),
a._iDisplayStart=0,ca(a))},k=null!==a.searchDelay?a.searchDelay:"ssp"===ia(a)?400:0,n=b("input",c).val(h.sSearch).attr("placeholder",f.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",k?Ea(q,k):q).bind("keypress.DT",function(b){if(13==b.keyCode)return!1}).attr("aria-controls",e);b(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{n[0]!==d.activeElement&&n.val(h.sSearch)}catch(e){}});return c[0]}function sa(b,a,d){var e=b.oPreviousSearch,f=b.aoPreSearchCols,h=function(b){e.sSearch=
b.sSearch;e.bRegex=b.bRegex;e.bSmart=b.bSmart;e.bCaseInsensitive=b.bCaseInsensitive};y(b);if("ssp"!=ia(b)){lb(b,a.sSearch,d,a.bEscapeRegex!==c?!a.bEscapeRegex:a.bRegex,a.bSmart,a.bCaseInsensitive);h(a);for(a=0;a<f.length;a++)mb(b,f[a].sSearch,a,f[a].bEscapeRegex!==c?!f[a].bEscapeRegex:f[a].bRegex,f[a].bSmart,f[a].bCaseInsensitive);nb(b)}else h(a);b.bFiltered=!0;X(b,null,"search",[b])}function nb(a){for(var c=D.ext.search,d=a.aiDisplay,e,f,h=0,q=c.length;h<q;h++){for(var k=[],l=0,n=d.length;l<n;l++)f=
d[l],e=a.aoData[f],c[h](a,e._aFilterData,f,e._aData,l)&&k.push(f);d.length=0;b.merge(d,k)}}function mb(b,a,c,d,e,f){if(""!==a){var h=b.aiDisplay;d=Sa(a,d,e,f);for(e=h.length-1;0<=e;e--)a=b.aoData[h[e]]._aFilterData[c],d.test(a)||h.splice(e,1)}}function lb(b,a,c,d,e,f){d=Sa(a,d,e,f);e=b.oPreviousSearch.sSearch;f=b.aiDisplayMaster;var h;0!==D.ext.search.length&&(c=!0);h=ob(b);if(0>=a.length)b.aiDisplay=f.slice();else{if(h||c||e.length>a.length||0!==a.indexOf(e)||b.bSorted)b.aiDisplay=f.slice();a=b.aiDisplay;
for(c=a.length-1;0<=c;c--)d.test(b.aoData[a[c]]._sFilterRow)||a.splice(c,1)}}function Sa(a,c,d,e){a=c?a:Fa(a);d&&(a="^(?=.*?"+b.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(b){if('"'===b.charAt(0)){var a=b.match(/^"(.*)"$/);b=a?a[1]:b}return b.replace('"',"")}).join(")(?=.*?")+").*$");return RegExp(a,e?"i":"")}function Fa(b){return b.replace(Mb,"\\$1")}function ob(b){var a=b.aoColumns,c,d,e,f,h,q,k,l,n=D.ext.type.search;c=!1;d=0;for(f=b.aoData.length;d<f;d++)if(l=b.aoData[d],!l._aFilterData){q=[];
e=0;for(h=a.length;e<h;e++)c=a[e],c.bSearchable?(k=E(b,d,e,"filter"),n[c.sType]&&(k=n[c.sType](k)),null===k&&(k=""),"string"!==typeof k&&k.toString&&(k=k.toString())):k="",k.indexOf&&-1!==k.indexOf("&")&&(Ga.innerHTML=k,k=Nb?Ga.textContent:Ga.innerText),k.replace&&(k=k.replace(/[\r\n]/g,"")),q.push(k);l._aFilterData=q;l._sFilterRow=q.join("  ");c=!0}return c}function pb(b){return{search:b.sSearch,smart:b.bSmart,regex:b.bRegex,caseInsensitive:b.bCaseInsensitive}}function qb(b){return{sSearch:b.search,
bSmart:b.smart,bRegex:b.regex,bCaseInsensitive:b.caseInsensitive}}function jb(a){var c=a.sTableId,d=a.aanFeatures.i,e=b("<div/>",{"class":a.oClasses.sInfo,id:d?null:c+"_info"});d||(a.aoDrawCallback.push({fn:rb,sName:"information"}),e.attr("role","status").attr("aria-live","polite"),b(a.nTable).attr("aria-describedby",c+"_info"));return e[0]}function rb(a){var c=a.aanFeatures.i;if(0!==c.length){var d=a.oLanguage,e=a._iDisplayStart+1,f=a.fnDisplayEnd(),h=a.fnRecordsTotal(),q=a.fnRecordsDisplay(),k=
q?d.sInfo:d.sInfoEmpty;q!==h&&(k+=" "+d.sInfoFiltered);k+=d.sInfoPostFix;k=sb(a,k);d=d.fnInfoCallback;null!==d&&(k=d.call(a.oInstance,a,e,f,h,q,k));b(c).html(k)}}function sb(b,a){var c=b.fnFormatNumber,d=b._iDisplayStart+1,e=b._iDisplayLength,f=b.fnRecordsDisplay(),h=-1===e;return a.replace(/_START_/g,c.call(b,d)).replace(/_END_/g,c.call(b,b.fnDisplayEnd())).replace(/_MAX_/g,c.call(b,b.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(b,f)).replace(/_PAGE_/g,c.call(b,h?1:Math.ceil(d/e))).replace(/_PAGES_/g,
c.call(b,h?1:Math.ceil(f/e)))}function za(b){var a,c,d=b.iInitDisplayStart,e=b.aoColumns,f;c=b.oFeatures;var h=b.bDeferLoading;if(b.bInitialised){ba(b);V(b);J(b,b.aoHeader);J(b,b.aoFooter);la(b,!0);c.bAutoWidth&&Pa(b);a=0;for(c=e.length;a<c;a++)f=e[a],f.sWidth&&(f.nTh.style.width=aa(f.sWidth));X(b,null,"preInit",[b]);fa(b);e=ia(b);if("ssp"!=e||h)"ajax"==e?v(b,[],function(c){var e=T(b,c);for(a=0;a<e.length;a++)z(b,e[a]);b.iInitDisplayStart=d;fa(b);la(b,!1);Da(b,c)},b):(la(b,!1),Da(b))}else setTimeout(function(){za(b)},
200)}function Da(b,a){b._bInitComplete=!0;(a||b.oInit.aaData)&&r(b);X(b,null,"plugin-init",[b,a]);X(b,"aoInitComplete","init",[b,a])}function Ta(b,a){var c=parseInt(a,10);b._iDisplayLength=c;Ua(b);X(b,null,"length",[b,c])}function gb(a){for(var c=a.oClasses,d=a.sTableId,e=a.aLengthMenu,f=b.isArray(e[0]),h=f?e[0]:e,e=f?e[1]:e,f=b("<select/>",{name:d+"_length","aria-controls":d,"class":c.sLengthSelect}),q=0,k=h.length;q<k;q++)f[0][q]=new Option(e[q],h[q]);var l=b("<div><label/></div>").addClass(c.sLength);
a.aanFeatures.l||(l[0].id=d+"_length");l.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",f[0].outerHTML));b("select",l).val(a._iDisplayLength).bind("change.DT",function(){Ta(a,b(this).val());ca(a)});b(a.nTable).bind("length.dt.DT",function(c,d,e){a===d&&b("select",l).val(e)});return l[0]}function kb(a){var c=a.sPaginationType,d=D.ext.pager[c],e="function"===typeof d,f=function(b){ca(b)},c=b("<div/>").addClass(a.oClasses.sPaging+c)[0],h=a.aanFeatures;e||d.fnInit(a,c,f);h.p||(c.id=a.sTableId+
"_paginate",a.aoDrawCallback.push({fn:function(b){if(e){var a=b._iDisplayStart,c=b._iDisplayLength,q=b.fnRecordsDisplay(),k=-1===c,a=k?0:Math.ceil(a/c),c=k?1:Math.ceil(q/c),q=d(a,c),l,k=0;for(l=h.p.length;k<l;k++)Ra(b,"pageButton")(b,h.p[k],k,q,a,c)}else d.fnUpdate(b,f)},sName:"pagination"}));return c}function Va(b,a,c){var d=b._iDisplayStart,e=b._iDisplayLength,f=b.fnRecordsDisplay();0===f||-1===e?d=0:"number"===typeof a?(d=a*e,d>f&&(d=0)):"first"==a?d=0:"previous"==a?(d=0<=e?d-e:0,0>d&&(d=0)):"next"==
a?d+e<f&&(d+=e):"last"==a?d=Math.floor((f-1)/e)*e:qa(b,0,"Unknown paging action: "+a,5);a=b._iDisplayStart!==d;b._iDisplayStart=d;a&&(X(b,null,"page",[b]),c&&ca(b));return a}function hb(a){return b("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function la(a,c){a.oFeatures.bProcessing&&b(a.aanFeatures.r).css("display",c?"block":"none");X(a,null,"processing",[a,c])}function ib(a){var c=b(a.nTable);
c.attr("role","grid");var d=a.oScroll;if(""===d.sX&&""===d.sY)return a.nTable;var e=d.sX,f=d.sY,h=a.oClasses,q=c.children("caption"),k=q.length?q[0]._captionSide:null,l=b(c[0].cloneNode(!1)),n=b(c[0].cloneNode(!1)),v=c.children("tfoot");v.length||(v=null);l=b("<div/>",{"class":h.sScrollWrapper}).append(b("<div/>",{"class":h.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:e?e?aa(e):null:"100%"}).append(b("<div/>",{"class":h.sScrollHeadInner}).css({"box-sizing":"content-box",
width:d.sXInner||"100%"}).append(l.removeAttr("id").css("margin-left",0).append("top"===k?q:null).append(c.children("thead"))))).append(b("<div/>",{"class":h.sScrollBody}).css({position:"relative",overflow:"auto",width:e?aa(e):null}).append(c));v&&l.append(b("<div/>",{"class":h.sScrollFoot}).css({overflow:"hidden",border:0,width:e?e?aa(e):null:"100%"}).append(b("<div/>",{"class":h.sScrollFootInner}).append(n.removeAttr("id").css("margin-left",0).append("bottom"===k?q:null).append(c.children("tfoot")))));
var c=l.children(),m=c[0],h=c[1],t=v?c[2]:null;if(e)b(h).on("scroll.DT",function(){var b=this.scrollLeft;m.scrollLeft=b;v&&(t.scrollLeft=b)});b(h).css(f&&d.bCollapse?"max-height":"height",f);a.nScrollHead=m;a.nScrollBody=h;a.nScrollFoot=t;a.aoDrawCallback.push({fn:wa,sName:"scrolling"});return l[0]}function wa(a){var d=a.oScroll,e=d.sX,f=d.sXInner,h=d.sY,d=d.iBarWidth,k=b(a.nScrollHead),l=k[0].style,v=k.children("div"),m=v[0].style,t=v.children("table"),v=a.nScrollBody,g=b(v),G=v.style,p=b(a.nScrollFoot).children("div"),
N=p.children("table"),u=b(a.nTHead),T=b(a.nTable),C=T[0],Y=C.style,w=a.nTFoot?b(a.nTFoot):null,E=a.oBrowser,z=E.bScrollOversize,I,x,B,J,K=[],O=[],sa=[],A,ya=function(b){b=b.style;b.paddingTop="0";b.paddingBottom="0";b.borderTopWidth="0";b.borderBottomWidth="0";b.height=0};x=v.scrollHeight>v.clientHeight;a.scrollBarVis!==x&&a.scrollBarVis!==c?(a.scrollBarVis=x,r(a)):(a.scrollBarVis=x,T.children("thead, tfoot").remove(),J=u.clone().prependTo(T),u=u.find("tr"),x=J.find("tr"),J.find("th, td").removeAttr("tabindex"),
w&&(B=w.clone().prependTo(T),I=w.find("tr"),B=B.find("tr")),e||(G.width="100%",k[0].style.width="100%"),b.each(q(a,J),function(b,c){A=n(a,b);c.style.width=a.aoColumns[A].sWidth}),w&&pa(function(b){b.style.width=""},B),k=T.outerWidth(),""===e?(Y.width="100%",z&&(T.find("tbody").height()>v.offsetHeight||"scroll"==g.css("overflow-y"))&&(Y.width=aa(T.outerWidth()-d)),k=T.outerWidth()):""!==f&&(Y.width=aa(f),k=T.outerWidth()),pa(ya,x),pa(function(a){sa.push(a.innerHTML);K.push(aa(b(a).css("width")))},
x),pa(function(b,a){b.style.width=K[a]},u),b(x).height(0),w&&(pa(ya,B),pa(function(a){O.push(aa(b(a).css("width")))},B),pa(function(b,a){b.style.width=O[a]},I),b(B).height(0)),pa(function(b,a){b.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+sa[a]+"</div>";b.style.width=K[a]},x),w&&pa(function(b,a){b.innerHTML="";b.style.width=O[a]},B),T.outerWidth()<k?(I=v.scrollHeight>v.offsetHeight||"scroll"==g.css("overflow-y")?k+d:k,z&&(v.scrollHeight>v.offsetHeight||"scroll"==
g.css("overflow-y"))&&(Y.width=aa(I-d)),""!==e&&""===f||qa(a,1,"Possible column misalignment",6)):I="100%",G.width=aa(I),l.width=aa(I),w&&(a.nScrollFoot.style.width=aa(I)),!h&&z&&(G.height=aa(C.offsetHeight+d)),e=T.outerWidth(),t[0].style.width=aa(e),m.width=aa(e),f=T.height()>v.clientHeight||"scroll"==g.css("overflow-y"),h="padding"+(E.bScrollbarLeft?"Left":"Right"),m[h]=f?d+"px":"0px",w&&(N[0].style.width=aa(e),p[0].style.width=aa(e),p[0].style[h]=f?d+"px":"0px"),g.scroll(),!a.bSorted&&!a.bFiltered||
a._drawHold||(v.scrollTop=0))}function pa(b,a,c){for(var d=0,e=0,f=a.length,h,q;e<f;){h=a[e].firstChild;for(q=c?c[e].firstChild:null;h;)1===h.nodeType&&(c?b(h,q,d):b(h,d),d++),h=h.nextSibling,q=c?q.nextSibling:null;e++}}function Pa(a){var c=a.nTable,d=a.aoColumns,e=a.oScroll,f=e.sY,h=e.sX,k=e.sXInner,l=d.length,v=x(a,"bVisible"),m=b("th",a.nTHead),t=c.getAttribute("width"),G=c.parentNode,p=!1,N,u,T=a.oBrowser,e=T.bScrollOversize;(N=c.style.width)&&-1!==N.indexOf("%")&&(t=N);for(N=0;N<v.length;N++)u=
d[v[N]],null!==u.sWidth&&(u.sWidth=tb(u.sWidthOrig,G),p=!0);if(e||!p&&!h&&!f&&l==C(a)&&l==m.length)for(N=0;N<l;N++)v=n(a,N),null!==v&&(d[v].sWidth=aa(m.eq(N).width()));else{l=b(c).clone().css("visibility","hidden").removeAttr("id");l.find("tbody tr").remove();var Y=b("<tr/>").appendTo(l.find("tbody"));l.find("thead, tfoot").remove();l.append(b(a.nTHead).clone()).append(b(a.nTFoot).clone());l.find("tfoot th, tfoot td").css("width","");m=q(a,l.find("thead")[0]);for(N=0;N<v.length;N++)u=d[v[N]],m[N].style.width=
null!==u.sWidthOrig&&""!==u.sWidthOrig?aa(u.sWidthOrig):"",u.sWidthOrig&&h&&b(m[N]).append(b("<div/>").css({width:u.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(N=0;N<v.length;N++)p=v[N],u=d[p],b(ub(a,p)).clone(!1).append(u.sContentPadding).appendTo(Y);u=b("<div/>").css(h||f?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(l).appendTo(G);h&&k?l.width(k):h?(l.css("width","auto"),l.removeAttr("width"),l.width()<G.clientWidth&&t&&l.width(G.clientWidth)):
f?l.width(G.clientWidth):t&&l.width(t);for(N=f=0;N<v.length;N++)G=b(m[N]),k=G.outerWidth()-G.width(),G=T.bBounding?Math.ceil(m[N].getBoundingClientRect().width):G.outerWidth(),f+=G,d[v[N]].sWidth=aa(G-k);c.style.width=aa(f);u.remove()}t&&(c.style.width=aa(t));!t&&!h||a._reszEvt||(c=function(){b(g).bind("resize.DT-"+a.sInstance,Ea(function(){r(a)}))},e?setTimeout(c,1E3):c(),a._reszEvt=!0)}function Ea(b,a){var d=a!==c?a:200,e,f;return function(){var a=this,h=+new Date,q=arguments;e&&h<e+d?(clearTimeout(f),
f=setTimeout(function(){e=c;b.apply(a,q)},d)):(e=h,b.apply(a,q))}}function tb(a,c){if(!a)return 0;var e=b("<div/>").css("width",aa(a)).appendTo(c||d.body),f=e[0].offsetWidth;e.remove();return f}function ub(a,c){var d=vb(a,c);if(0>d)return null;var e=a.aoData[d];return e.nTr?e.anCells[c]:b("<td/>").html(E(a,d,c,"display"))[0]}function vb(b,a){for(var c,d=-1,e=-1,f=0,h=b.aoData.length;f<h;f++)c=E(b,f,a,"display")+"",c=c.replace(Ob,""),c=c.replace(/&nbsp;/g," "),c.length>d&&(d=c.length,e=f);return e}
function aa(b){return null===b?"0px":"number"==typeof b?0>b?"0px":b+"px":b.match(/\d$/)?b+"px":b}function ua(a){var d,e,f=[],h=a.aoColumns,q,k,l,v;d=a.aaSortingFixed;e=b.isPlainObject(d);var n=[];q=function(a){a.length&&!b.isArray(a[0])?n.push(a):b.merge(n,a)};b.isArray(d)&&q(d);e&&d.pre&&q(d.pre);q(a.aaSorting);e&&d.post&&q(d.post);for(a=0;a<n.length;a++)for(v=n[a][0],q=h[v].aDataSort,d=0,e=q.length;d<e;d++)k=q[d],l=h[k].sType||"string",n[a]._idx===c&&(n[a]._idx=b.inArray(n[a][1],h[k].asSorting)),
f.push({src:v,col:k,dir:n[a][1],index:n[a]._idx,type:l,formatter:D.ext.type.order[l+"-pre"]});return f}function fb(b){var a,c,d=[],e=D.ext.type.order,f=b.aoData,h=0,q,k=b.aiDisplayMaster,l;y(b);l=ua(b);a=0;for(c=l.length;a<c;a++)q=l[a],q.formatter&&h++,wb(b,q.col);if("ssp"!=ia(b)&&0!==l.length){a=0;for(c=k.length;a<c;a++)d[k[a]]=a;h===l.length?k.sort(function(b,a){var c,e,h,q,k=l.length,v=f[b]._aSortData,n=f[a]._aSortData;for(h=0;h<k;h++)if(q=l[h],c=v[q.col],e=n[q.col],c=c<e?-1:c>e?1:0,0!==c)return"asc"===
q.dir?c:-c;c=d[b];e=d[a];return c<e?-1:c>e?1:0}):k.sort(function(b,a){var c,h,q,k,v=l.length,n=f[b]._aSortData,m=f[a]._aSortData;for(q=0;q<v;q++)if(k=l[q],c=n[k.col],h=m[k.col],k=e[k.type+"-"+k.dir]||e["string-"+k.dir],c=k(c,h),0!==c)return c;c=d[b];h=d[a];return c<h?-1:c>h?1:0})}b.bSorted=!0}function xb(b){var a,c,d=b.aoColumns,e=ua(b);b=b.oLanguage.oAria;for(var f=0,h=d.length;f<h;f++){c=d[f];var q=c.asSorting;a=c.sTitle.replace(/<.*?>/g,"");var k=c.nTh;k.removeAttribute("aria-sort");c.bSortable&&
(0<e.length&&e[0].col==f?(k.setAttribute("aria-sort","asc"==e[0].dir?"ascending":"descending"),c=q[e[0].index+1]||q[0]):c=q[0],a+="asc"===c?b.sSortAscending:b.sSortDescending);k.setAttribute("aria-label",a)}}function Wa(a,d,e,f){var h=a.aaSorting,q=a.aoColumns[d].asSorting,k=function(a,d){var e=a._idx;e===c&&(e=b.inArray(a[1],q));return e+1<q.length?e+1:d?null:0};"number"===typeof h[0]&&(h=a.aaSorting=[h]);e&&a.oFeatures.bSortMulti?(e=b.inArray(d,ma(h,"0")),-1!==e?(d=k(h[e],!0),null===d&&1===h.length&&
(d=0),null===d?h.splice(e,1):(h[e][1]=q[d],h[e]._idx=d)):(h.push([d,q[0],0]),h[h.length-1]._idx=0)):h.length&&h[0][0]==d?(d=k(h[0]),h.length=1,h[0][1]=q[d],h[0]._idx=d):(h.length=0,h.push([d,q[0]]),h[0]._idx=0);fa(a);"function"==typeof f&&f(a)}function Qa(b,a,c,d){var e=b.aoColumns[c];Xa(a,{},function(a){!1!==e.bSortable&&(b.oFeatures.bProcessing?(la(b,!0),setTimeout(function(){Wa(b,c,a.shiftKey,d);"ssp"!==ia(b)&&la(b,!1)},0)):Wa(b,c,a.shiftKey,d))})}function Ha(a){var c=a.aLastSort,d=a.oClasses.sSortColumn,
e=ua(a),f=a.oFeatures,h,q;if(f.bSort&&f.bSortClasses){f=0;for(h=c.length;f<h;f++)q=c[f].src,b(ma(a.aoData,"anCells",q)).removeClass(d+(2>f?f+1:3));f=0;for(h=e.length;f<h;f++)q=e[f].src,b(ma(a.aoData,"anCells",q)).addClass(d+(2>f?f+1:3))}a.aLastSort=e}function wb(b,a){var c=b.aoColumns[a],d=D.ext.order[c.sSortDataType],e;d&&(e=d.call(b.oInstance,b,a,h(b,a)));for(var f,q=D.ext.type.order[c.sType+"-pre"],k=0,l=b.aoData.length;k<l;k++)if(c=b.aoData[k],c._aSortData||(c._aSortData=[]),!c._aSortData[a]||
d)f=d?e[k]:E(b,k,a,"sort"),c._aSortData[a]=q?q(f):f}function Ia(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var c={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:b.extend(!0,[],a.aaSorting),search:pb(a.oPreviousSearch),columns:b.map(a.aoColumns,function(b,c){return{visible:b.bVisible,search:pb(a.aoPreSearchCols[c])}})};X(a,"aoStateSaveParams","stateSaveParams",[a,c]);a.oSavedState=c;a.fnStateSaveCallback.call(a.oInstance,a,c)}}function yb(a){var d,e,f=a.aoColumns;if(a.oFeatures.bStateSave){var h=
a.fnStateLoadCallback.call(a.oInstance,a);if(h&&h.time&&(d=X(a,"aoStateLoadParams","stateLoadParams",[a,h]),-1===b.inArray(!1,d)&&(d=a.iStateDuration,!(0<d&&h.time<+new Date-1E3*d)&&f.length===h.columns.length))){a.oLoadedState=b.extend(!0,{},h);h.start!==c&&(a._iDisplayStart=h.start,a.iInitDisplayStart=h.start);h.length!==c&&(a._iDisplayLength=h.length);h.order!==c&&(a.aaSorting=[],b.each(h.order,function(b,c){a.aaSorting.push(c[0]>=f.length?[0,c[1]]:c)}));h.search!==c&&b.extend(a.oPreviousSearch,
qb(h.search));d=0;for(e=h.columns.length;d<e;d++){var q=h.columns[d];q.visible!==c&&(f[d].bVisible=q.visible);q.search!==c&&b.extend(a.aoPreSearchCols[d],qb(q.search))}X(a,"aoStateLoaded","stateLoaded",[a,h])}}}function Ja(a){var c=D.settings;a=b.inArray(a,ma(c,"nTable"));return-1!==a?c[a]:null}function qa(b,a,c,d){c="DataTables warning: "+(b?"table id="+b.sTableId+" - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(a)g.console&&console.log&&console.log(c);
else if(a=D.ext,a=a.sErrMode||a.errMode,b&&X(b,null,"error",[b,d,c]),"alert"==a)alert(c);else{if("throw"==a)throw Error(c);"function"==typeof a&&a(b,d,c)}}function na(a,d,e,f){b.isArray(e)?b.each(e,function(c,e){b.isArray(e)?na(a,d,e[0],e[1]):na(a,d,e)}):(f===c&&(f=e),d[e]!==c&&(a[f]=d[e]))}function zb(a,c,d){var e,f;for(f in c)c.hasOwnProperty(f)&&(e=c[f],b.isPlainObject(e)?(b.isPlainObject(a[f])||(a[f]={}),b.extend(!0,a[f],e)):a[f]=d&&"data"!==f&&"aaData"!==f&&b.isArray(e)?e.slice():e);return a}
function Xa(a,c,d){b(a).bind("click.DT",c,function(b){a.blur();d(b)}).bind("keypress.DT",c,function(b){13===b.which&&(b.preventDefault(),d(b))}).bind("selectstart.DT",function(){return!1})}function ja(b,a,c,d){c&&b[a].push({fn:c,sName:d})}function X(a,c,d,e){var f=[];c&&(f=b.map(a[c].slice().reverse(),function(b){return b.fn.apply(a.oInstance,e)}));null!==d&&(c=b.Event(d+".dt"),b(a.nTable).trigger(c,e),f.push(c.result));return f}function Ua(b){var a=b._iDisplayStart,c=b.fnDisplayEnd(),d=b._iDisplayLength;
a>=c&&(a=c-d);a-=a%d;if(-1===d||0>a)a=0;b._iDisplayStart=a}function Ra(a,c){var d=a.renderer,e=D.ext.renderer[c];return b.isPlainObject(d)&&d[c]?e[d[c]]||e._:"string"===typeof d?e[d]||e._:e._}function ia(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function Ka(a,b){var c=[],c=Ab.numbers_length,d=Math.floor(c/2);b<=c?c=va(0,b):a<=d?(c=va(0,c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-d?c=va(b-(c-2),b):(c=va(a-d+2,a+d-1),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),
c.splice(0,0,0));c.DT_el="span";return c}function eb(a){b.each({num:function(b){return La(b,a)},"num-fmt":function(b){return La(b,a,Ya)},"html-num":function(b){return La(b,a,Ma)},"html-num-fmt":function(b){return La(b,a,Ma,Ya)}},function(b,c){ea.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(ea.type.search[b+a]=ea.type.search.html)})}function Bb(b){return function(){var a=[Ja(this[D.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return D.ext.internal[b].apply(this,a)}}var D,ea,S,P,
Z,Za={},Cb=/[\r\n]/g,Ma=/<.*?>/g,Pb=/^[\w\+\-]/,Qb=/[\w\+\-]$/,Mb=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),Ya=/[',$\u00a3\u20ac\u00a5%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,ra=function(b){return b&&!0!==b&&"-"!==b?!1:!0},Db=function(b){var a=parseInt(b,10);return!isNaN(a)&&isFinite(b)?a:null},Eb=function(b,a){Za[a]||(Za[a]=RegExp(Fa(a),"g"));return"string"===typeof b&&"."!==a?b.replace(/\./g,"").replace(Za[a],"."):b},$a=function(b,a,c){var d="string"===typeof b;
if(ra(b))return!0;a&&d&&(b=Eb(b,a));c&&d&&(b=b.replace(Ya,""));return!isNaN(parseFloat(b))&&isFinite(b)},Fb=function(b,a,c){return ra(b)?!0:ra(b)||"string"===typeof b?$a(b.replace(Ma,""),a,c)?!0:null:null},ma=function(b,a,d){var e=[],f=0,h=b.length;if(d!==c)for(;f<h;f++)b[f]&&b[f][a]&&e.push(b[f][a][d]);else for(;f<h;f++)b[f]&&e.push(b[f][a]);return e},Aa=function(b,a,d,e){var f=[],h=0,q=a.length;if(e!==c)for(;h<q;h++)b[a[h]][d]&&f.push(b[a[h]][d][e]);else for(;h<q;h++)f.push(b[a[h]][d]);return f},
va=function(b,a){var d=[],e;a===c?(a=0,e=b):(e=a,a=b);for(var f=a;f<e;f++)d.push(f);return d},Gb=function(b){for(var a=[],c=0,d=b.length;c<d;c++)b[c]&&a.push(b[c]);return a},Ca=function(b){var a=[],c,d,e=b.length,f,h=0;d=0;a:for(;d<e;d++){c=b[d];for(f=0;f<h;f++)if(a[f]===c)continue a;a.push(c);h++}return a},ka=function(b,a,d){b[a]!==c&&(b[d]=b[a])},xa=/\[.*?\]$/,ta=/\(\)$/,Ga=b("<div>")[0],Nb=Ga.textContent!==c,Ob=/<.*?>/g;D=function(a){this.$=function(b,a){return this.api(!0).$(b,a)};this._=function(b,
a){return this.api(!0).rows(b,a).data()};this.api=function(b){return b?new S(Ja(this[ea.iApiIndex])):new S(this)};this.fnAddData=function(a,d){var e=this.api(!0),f=b.isArray(a)&&(b.isArray(a[0])||b.isPlainObject(a[0]))?e.rows.add(a):e.row.add(a);(d===c||d)&&e.draw();return f.flatten().toArray()};this.fnAdjustColumnSizing=function(b){var a=this.api(!0).columns.adjust(),d=a.settings()[0],e=d.oScroll;b===c||b?a.draw(!1):(""!==e.sX||""!==e.sY)&&wa(d)};this.fnClearTable=function(b){var a=this.api(!0).clear();
(b===c||b)&&a.draw()};this.fnClose=function(b){this.api(!0).row(b).child.hide()};this.fnDeleteRow=function(b,a,d){var e=this.api(!0);b=e.rows(b);var f=b.settings()[0],h=f.aoData[b[0][0]];b.remove();a&&a.call(this,f,h);(d===c||d)&&e.draw();return h};this.fnDestroy=function(b){this.api(!0).destroy(b)};this.fnDraw=function(b){this.api(!0).draw(b)};this.fnFilter=function(b,a,d,e,f,h){f=this.api(!0);null===a||a===c?f.search(b,d,e,h):f.column(a).search(b,d,e,h);f.draw()};this.fnGetData=function(b,a){var d=
this.api(!0);if(b!==c){var e=b.nodeName?b.nodeName.toLowerCase():"";return a!==c||"td"==e||"th"==e?d.cell(b,a).data():d.row(b).data()||null}return d.data().toArray()};this.fnGetNodes=function(b){var a=this.api(!0);return b!==c?a.row(b).node():a.rows().nodes().flatten().toArray()};this.fnGetPosition=function(b){var a=this.api(!0),c=b.nodeName.toUpperCase();return"TR"==c?a.row(b).index():"TD"==c||"TH"==c?(b=a.cell(b).index(),[b.row,b.columnVisible,b.column]):null};this.fnIsOpen=function(b){return this.api(!0).row(b).child.isShown()};
this.fnOpen=function(b,a,c){return this.api(!0).row(b).child(a,c).show().child()[0]};this.fnPageChange=function(b,a){var d=this.api(!0).page(b);(a===c||a)&&d.draw(!1)};this.fnSetColumnVis=function(b,a,d){b=this.api(!0).column(b).visible(a);(d===c||d)&&b.columns.adjust().draw()};this.fnSettings=function(){return Ja(this[ea.iApiIndex])};this.fnSort=function(b){this.api(!0).order(b).draw()};this.fnSortListener=function(b,a,c){this.api(!0).order.listener(b,a,c)};this.fnUpdate=function(b,a,d,e,f){var h=
this.api(!0);d===c||null===d?h.row(a).data(b):h.cell(a,d).data(b);(f===c||f)&&h.columns.adjust();(e===c||e)&&h.draw();return 0};this.fnVersionCheck=ea.fnVersionCheck;var d=this,h=a===c,v=this.length;h&&(a={});this.oApi=this.internal=ea.internal;for(var n in D.ext.internal)n&&(this[n]=Bb(n));this.each(function(){var n={},n=1<v?zb(n,a,!0):a,g=0,G,r=this.getAttribute("id"),p=!1,N=D.defaults,T=b(this);if("table"!=this.nodeName.toLowerCase())qa(null,0,"Non-table node initialisation ("+this.nodeName+")",
2);else{e(N);f(N.column);k(N,N,!0);k(N.column,N.column,!0);k(N,b.extend(n,T.data()));var C=D.settings,g=0;for(G=C.length;g<G;g++){var Y=C[g];if(Y.nTable==this||Y.nTHead.parentNode==this||Y.nTFoot&&Y.nTFoot.parentNode==this){g=n.bRetrieve!==c?n.bRetrieve:N.bRetrieve;if(h||g)return Y.oInstance;if(n.bDestroy!==c?n.bDestroy:N.bDestroy){Y.oInstance.fnDestroy();break}else{qa(Y,0,"Cannot reinitialise DataTable",3);return}}if(Y.sTableId==this.id){C.splice(g,1);break}}if(null===r||""===r)this.id=r="DataTables_Table_"+
D.ext._unique++;var w=b.extend(!0,{},D.models.oSettings,{sDestroyWidth:T[0].style.width,sInstance:r,sTableId:r});w.nTable=this;w.oApi=d.internal;w.oInit=n;C.push(w);w.oInstance=1===d.length?d:T.dataTable();e(n);n.oLanguage&&l(n.oLanguage);n.aLengthMenu&&!n.iDisplayLength&&(n.iDisplayLength=b.isArray(n.aLengthMenu[0])?n.aLengthMenu[0][0]:n.aLengthMenu[0]);n=zb(b.extend(!0,{},N),n);na(w.oFeatures,n,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));
na(w,n,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);na(w.oScroll,n,[["sScrollX","sX"],["sScrollXInner",
"sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);na(w.oLanguage,n,"fnInfoCallback");ja(w,"aoDrawCallback",n.fnDrawCallback,"user");ja(w,"aoServerParams",n.fnServerParams,"user");ja(w,"aoStateSaveParams",n.fnStateSaveParams,"user");ja(w,"aoStateLoadParams",n.fnStateLoadParams,"user");ja(w,"aoStateLoaded",n.fnStateLoaded,"user");ja(w,"aoRowCallback",n.fnRowCallback,"user");ja(w,"aoRowCreatedCallback",n.fnCreatedRow,"user");ja(w,"aoHeaderCallback",n.fnHeaderCallback,"user");ja(w,"aoFooterCallback",
n.fnFooterCallback,"user");ja(w,"aoInitComplete",n.fnInitComplete,"user");ja(w,"aoPreDrawCallback",n.fnPreDrawCallback,"user");w.rowIdFn=F(n.rowId);t(w);r=w.oClasses;n.bJQueryUI?(b.extend(r,D.ext.oJUIClasses,n.oClasses),n.sDom===N.sDom&&"lfrtip"===N.sDom&&(w.sDom='<"H"lfr>t<"F"ip>'),w.renderer)?b.isPlainObject(w.renderer)&&!w.renderer.header&&(w.renderer.header="jqueryui"):w.renderer="jqueryui":b.extend(r,D.ext.classes,n.oClasses);T.addClass(r.sTable);w.iInitDisplayStart===c&&(w.iInitDisplayStart=
n.iDisplayStart,w._iDisplayStart=n.iDisplayStart);null!==n.iDeferLoading&&(w.bDeferLoading=!0,g=b.isArray(n.iDeferLoading),w._iRecordsDisplay=g?n.iDeferLoading[0]:n.iDeferLoading,w._iRecordsTotal=g?n.iDeferLoading[1]:n.iDeferLoading);var I=w.oLanguage;b.extend(!0,I,n.oLanguage);""!==I.sUrl&&(b.ajax({dataType:"json",url:I.sUrl,success:function(a){l(a);k(N.oLanguage,a);b.extend(!0,I,a);za(w)},error:function(){za(w)}}),p=!0);null===n.asStripeClasses&&(w.asStripeClasses=[r.sStripeOdd,r.sStripeEven]);
var g=w.asStripeClasses,E=T.children("tbody").find("tr").eq(0);-1!==b.inArray(!0,b.map(g,function(b){return E.hasClass(b)}))&&(b("tbody tr",this).removeClass(g.join(" ")),w.asDestroyStripes=g.slice());C=[];g=this.getElementsByTagName("thead");0!==g.length&&(R(w.aoHeader,g[0]),C=q(w));if(null===n.aoColumns)for(Y=[],g=0,G=C.length;g<G;g++)Y.push(null);else Y=n.aoColumns;g=0;for(G=Y.length;g<G;g++)m(w,C?C[g]:null);K(w,n.aoColumnDefs,Y,function(b,a){u(w,b,a)});if(E.length){var x=function(b,a){return null!==
b.getAttribute("data-"+a)?a:null};b(E[0]).children("th, td").each(function(b,a){var d=w.aoColumns[b];if(d.mData===b){var e=x(a,"sort")||x(a,"order"),f=x(a,"filter")||x(a,"search");if(null!==e||null!==f)d.mData={_:b+".display",sort:null!==e?b+".@data-"+e:c,type:null!==e?b+".@data-"+e:c,filter:null!==f?b+".@data-"+f:c},u(w,b)}})}var B=w.oFeatures;n.bStateSave&&(B.bStateSave=!0,yb(w,n),ja(w,"aoDrawCallback",Ia,"state_save"));if(n.aaSorting===c)for(C=w.aaSorting,g=0,G=C.length;g<G;g++)C[g][1]=w.aoColumns[g].asSorting[0];
Ha(w);B.bSort&&ja(w,"aoDrawCallback",function(){if(w.bSorted){var a=ua(w),c={};b.each(a,function(b,a){c[a.src]=a.dir});X(w,null,"order",[w,a,c]);xb(w)}});ja(w,"aoDrawCallback",function(){(w.bSorted||"ssp"===ia(w)||B.bDeferRender)&&Ha(w)},"sc");g=T.children("caption").each(function(){this._captionSide=T.css("caption-side")});G=T.children("thead");0===G.length&&(G=b("<thead/>").appendTo(this));w.nTHead=G[0];G=T.children("tbody");0===G.length&&(G=b("<tbody/>").appendTo(this));w.nTBody=G[0];G=T.children("tfoot");
0===G.length&&0<g.length&&(""!==w.oScroll.sX||""!==w.oScroll.sY)&&(G=b("<tfoot/>").appendTo(this));0===G.length||0===G.children().length?T.addClass(r.sNoFooter):0<G.length&&(w.nTFoot=G[0],R(w.aoFooter,w.nTFoot));if(n.aaData)for(g=0;g<n.aaData.length;g++)z(w,n.aaData[g]);else(w.bDeferLoading||"dom"==ia(w))&&L(w,b(w.nTBody).children("tr"));w.aiDisplay=w.aiDisplayMaster.slice();w.bInitialised=!0;!1===p&&za(w)}});d=null;return this};var Hb=[],ha=Array.prototype,Rb=function(a){var c,d,e=D.settings,f=b.map(e,
function(b){return b.nTable});if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return c=b.inArray(a,f),-1!==c?[e[c]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?d=b(a):a instanceof b&&(d=a)}else return[];if(d)return d.map(function(){c=b.inArray(this,f);return-1!==c?e[c]:null}).toArray()};S=function(a,c){if(!(this instanceof S))return new S(a,c);var d=[],e=function(b){(b=Rb(b))&&(d=d.concat(b))};if(b.isArray(a))for(var f=
0,h=a.length;f<h;f++)e(a[f]);else e(a);this.context=Ca(d);c&&b.merge(this,c);this.selector={rows:null,cols:null,opts:null};S.extend(this,this,Hb)};D.Api=S;b.extend(S.prototype,{any:function(){return 0!==this.count()},concat:ha.concat,context:[],count:function(){return this.flatten().length},each:function(b){for(var a=0,c=this.length;a<c;a++)b.call(this,this[a],a,this);return this},eq:function(b){var a=this.context;return a.length>b?new S(a[b],this[b]):null},filter:function(b){var a=[];if(ha.filter)a=
ha.filter.call(this,b,this);else for(var c=0,d=this.length;c<d;c++)b.call(this,this[c],c,this)&&a.push(this[c]);return new S(this.context,a)},flatten:function(){var b=[];return new S(this.context,b.concat.apply(b,this.toArray()))},join:ha.join,indexOf:ha.indexOf||function(b,a){for(var c=a||0,d=this.length;c<d;c++)if(this[c]===b)return c;return-1},iterator:function(b,a,d,e){var f=[],h,q,k,l,n,v=this.context,m,t,g=this.selector;"string"===typeof b&&(e=d,d=a,a=b,b=!1);q=0;for(k=v.length;q<k;q++){var G=
new S(v[q]);if("table"===a)h=d.call(G,v[q],q),h!==c&&f.push(h);else if("columns"===a||"rows"===a)h=d.call(G,v[q],this[q],q),h!==c&&f.push(h);else if("column"===a||"column-rows"===a||"row"===a||"cell"===a)for(t=this[q],"column-rows"===a&&(m=Na(v[q],g.opts)),l=0,n=t.length;l<n;l++)h=t[l],h="cell"===a?d.call(G,v[q],h.row,h.column,q,l):d.call(G,v[q],h,q,l,m),h!==c&&f.push(h)}return f.length||e?(b=new S(v,b?f.concat.apply([],f):f),a=b.selector,a.rows=g.rows,a.cols=g.cols,a.opts=g.opts,b):this},lastIndexOf:ha.lastIndexOf||
function(a,b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(ha.map)b=ha.map.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)b.push(a.call(this,this[c],c));return new S(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},pop:ha.pop,push:ha.push,reduce:ha.reduce||function(a,b){return p(this,a,b,0,this.length,1)},reduceRight:ha.reduceRight||function(a,b){return p(this,a,b,this.length-1,-1,-1)},reverse:ha.reverse,selector:null,
shift:ha.shift,sort:ha.sort,splice:ha.splice,toArray:function(){return ha.slice.call(this)},to$:function(){return b(this)},toJQuery:function(){return b(this)},unique:function(){return new S(this.context,Ca(this))},unshift:ha.unshift});S.extend=function(a,c,d){if(d.length&&c&&(c instanceof S||c.__dt_wrapper)){var e,f,h,q=function(a,b,c){return function(){var d=b.apply(a,arguments);S.extend(d,d,c.methodExt);return d}};e=0;for(f=d.length;e<f;e++)h=d[e],c[h.name]="function"===typeof h.val?q(a,h.val,h):
b.isPlainObject(h.val)?{}:h.val,c[h.name].__dt_wrapper=!0,S.extend(a,c[h.name],h.propExt)}};S.register=P=function(a,c){if(b.isArray(a))for(var d=0,e=a.length;d<e;d++)S.register(a[d],c);else for(var f=a.split("."),h=Hb,q,k,d=0,e=f.length;d<e;d++){q=(k=-1!==f[d].indexOf("()"))?f[d].replace("()",""):f[d];var l;a:{l=0;for(var n=h.length;l<n;l++)if(h[l].name===q){l=h[l];break a}l=null}l||(l={name:q,val:{},methodExt:[],propExt:[]},h.push(l));d===e-1?l.val=c:h=k?l.methodExt:l.propExt}};S.registerPlural=
Z=function(a,d,e){S.register(a,e);S.register(d,function(){var a=e.apply(this,arguments);return a===this?this:a instanceof S?a.length?b.isArray(a[0])?new S(a.context,a[0]):a[0]:c:a})};P("tables()",function(a){var c;if(a){c=S;var d=this.context;if("number"===typeof a)a=[d[a]];else{var e=b.map(d,function(a){return a.nTable});a=b(e).filter(a).map(function(){var a=b.inArray(this,e);return d[a]}).toArray()}c=new c(a)}else c=this;return c});P("table()",function(a){a=this.tables(a);var b=a.context;return b.length?
new S(b[0]):a});Z("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});Z("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});Z("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});Z("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});Z("tables().containers()","table().container()",
function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});P("draw()",function(a){return this.iterator("table",function(b){"page"===a?ca(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),fa(b,!1===a))})});P("page()",function(a){return a===c?this.page.info().page:this.iterator("table",function(b){Va(b,a)})});P("page.info()",function(){if(0===this.context.length)return c;var a=this.context[0],b=a._iDisplayStart,d=a.oFeatures.bPaginate?a._iDisplayLength:-1,e=a.fnRecordsDisplay(),
f=-1===d;return{page:f?0:Math.floor(b/d),pages:f?1:Math.ceil(e/d),start:b,end:a.fnDisplayEnd(),length:d,recordsTotal:a.fnRecordsTotal(),recordsDisplay:e,serverSide:"ssp"===ia(a)}});P("page.len()",function(a){return a===c?0!==this.context.length?this.context[0]._iDisplayLength:c:this.iterator("table",function(b){Ta(b,a)})});var Ib=function(a,b,c){if(c){var d=new S(a);d.one("draw",function(){c(d.ajax.json())})}if("ssp"==ia(a))fa(a,b);else{la(a,!0);var e=a.jqXHR;e&&4!==e.readyState&&e.abort();v(a,[],
function(c){I(a);c=T(a,c);for(var d=0,e=c.length;d<e;d++)z(a,c[d]);fa(a,b);la(a,!1)})}};P("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});P("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});P("ajax.reload()",function(a,b){return this.iterator("table",function(c){Ib(c,!1===b,a)})});P("ajax.url()",function(a){var d=this.context;if(a===c){if(0===d.length)return c;d=d[0];return d.ajax?b.isPlainObject(d.ajax)?d.ajax.url:d.ajax:d.sAjaxSource}return this.iterator("table",
function(c){b.isPlainObject(c.ajax)?c.ajax.url=a:c.ajax=a})});P("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Ib(c,!1===b,a)})});var ab=function(a,d,e,f,h){var q=[],k,l,n,v,m,t;n=typeof d;d&&"string"!==n&&"function"!==n&&d.length!==c||(d=[d]);n=0;for(v=d.length;n<v;n++)for(l=d[n]&&d[n].split?d[n].split(","):[d[n]],m=0,t=l.length;m<t;m++)(k=e("string"===typeof l[m]?b.trim(l[m]):l[m]))&&k.length&&(q=q.concat(k));a=ea.selector[a];if(a.length)for(n=0,v=a.length;n<v;n++)q=
a[n](f,h,q);return Ca(q)},bb=function(a){a||(a={});a.filter&&a.search===c&&(a.search=a.filter);return b.extend({search:"none",order:"current",page:"all"},a)},cb=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Na=function(a,c){var d,e,f,h=[],q=a.aiDisplay;d=a.aiDisplayMaster;var k=c.search;e=c.order;f=c.page;if("ssp"==ia(a))return"removed"===k?[]:va(0,d.length);if("current"==f)for(d=a._iDisplayStart,
e=a.fnDisplayEnd();d<e;d++)h.push(q[d]);else if("current"==e||"applied"==e)h="none"==k?d.slice():"applied"==k?q.slice():b.map(d,function(a){return-1===b.inArray(a,q)?a:null});else if("index"==e||"original"==e)for(d=0,e=a.aoData.length;d<e;d++)"none"==k?h.push(d):(f=b.inArray(d,q),(-1===f&&"removed"==k||0<=f&&"applied"==k)&&h.push(d));return h};P("rows()",function(a,d){a===c?a="":b.isPlainObject(a)&&(d=a,a="");d=bb(d);var e=this.iterator("table",function(e){var f=d;return ab("row",a,function(a){var d=
Db(a);if(null!==d&&!f)return[d];var h=Na(e,f);if(null!==d&&-1!==b.inArray(d,h))return[d];if(!a)return h;if("function"===typeof a)return b.map(h,function(b){var c=e.aoData[b];return a(b,c._aData,c.nTr)?b:null});d=Gb(Aa(e.aoData,h,"nTr"));return a.nodeName&&-1!==b.inArray(a,d)?[a._DT_RowIndex]:"string"===typeof a&&"#"===a.charAt(0)&&(h=e.aIds[a.replace(/^#/,"")],h!==c)?[h.idx]:b(d).filter(a).map(function(){return this._DT_RowIndex}).toArray()},e,f)},1);e.selector.rows=a;e.selector.opts=d;return e});
P("rows().nodes()",function(){return this.iterator("row",function(a,b){return a.aoData[b].nTr||c},1)});P("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return Aa(a.aoData,b,"_aData")},1)});Z("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var d=b.aoData[c];return"search"===a?d._aFilterData:d._aSortData},1)});Z("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){H(b,c,a)})});Z("rows().indexes()",
"row().index()",function(){return this.iterator("row",function(a,b){return b},1)});Z("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,d=0,e=c.length;d<e;d++)for(var f=0,h=this[d].length;f<h;f++){var q=c[d].rowIdFn(c[d].aoData[this[d][f]]._aData);b.push((!0===a?"#":"")+q)}return new S(c,b)});Z("rows().remove()","row().remove()",function(){var a=this;this.iterator("row",function(b,d,e){var f=b.aoData,h=f[d],q,k,l,n,v;f.splice(d,1);q=0;for(k=f.length;q<k;q++)if(l=f[q],v=l.anCells,
null!==l.nTr&&(l.nTr._DT_RowIndex=q),null!==v)for(l=0,n=v.length;l<n;l++)v[l]._DT_CellIndex.row=q;O(b.aiDisplayMaster,d);O(b.aiDisplay,d);O(a[e],d,!1);Ua(b);d=b.rowIdFn(h._aData);d!==c&&delete b.aIds[d]});this.iterator("table",function(a){for(var b=0,c=a.aoData.length;b<c;b++)a.aoData[b].idx=b});return this});P("rows.add()",function(a){var c=this.iterator("table",function(b){var c,d,e,f=[];d=0;for(e=a.length;d<e;d++)c=a[d],c.nodeName&&"TR"===c.nodeName.toUpperCase()?f.push(L(b,c)[0]):f.push(z(b,c));
return f},1),d=this.rows(-1);d.pop();b.merge(d,c);return d});P("row()",function(a,b){return cb(this.rows(a,b))});P("row().data()",function(a){var b=this.context;if(a===c)return b.length&&this.length?b[0].aoData[this[0]]._aData:c;b[0].aoData[this[0]]._aData=a;H(b[0],this[0],"data");return this});P("row().node()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});P("row.add()",function(a){a instanceof b&&a.length&&(a=a[0]);var c=this.iterator("table",function(b){return a.nodeName&&
"TR"===a.nodeName.toUpperCase()?L(b,a)[0]:z(b,a)});return this.row(c[0])});var db=function(a,b){var d=a.context;d.length&&(d=d[0].aoData[b!==c?b:a[0]])&&d._details&&(d._details.remove(),d._detailsShow=c,d._details=c)},Jb=function(a,b){var c=a.context;if(c.length&&a.length){var d=c[0].aoData[a[0]];if(d._details){(d._detailsShow=b)?d._details.insertAfter(d.nTr):d._details.detach();var e=c[0],f=new S(e),h=e.aoData;f.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");0<ma(h,
"_details").length&&(f.on("draw.dt.DT_details",function(a,b){e===b&&f.rows({page:"current"}).eq(0).each(function(a){a=h[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),f.on("column-visibility.dt.DT_details",function(a,b){if(e===b)for(var c,d=C(b),f=0,q=h.length;f<q;f++)c=h[f],c._details&&c._details.children("td[colspan]").attr("colspan",d)}),f.on("destroy.dt.DT_details",function(a,b){if(e===b)for(var c=0,d=h.length;c<d;c++)h[c]._details&&db(f,c)}))}}};P("row().child()",function(a,d){var e=this.context;
if(a===c)return e.length&&this.length?e[0].aoData[this[0]]._details:c;if(!0===a)this.child.show();else if(!1===a)db(this);else if(e.length&&this.length){var f=e[0],e=e[0].aoData[this[0]],h=[],q=function(a,c){if(b.isArray(a)||a instanceof b)for(var d=0,e=a.length;d<e;d++)q(a[d],c);else a.nodeName&&"tr"===a.nodeName.toLowerCase()?h.push(a):(d=b("<tr><td/></tr>").addClass(c),b("td",d).addClass(c).html(a)[0].colSpan=C(f),h.push(d[0]))};q(a,d);e._details&&e._details.remove();e._details=b(h);e._detailsShow&&
e._details.insertAfter(e.nTr)}return this});P(["row().child.show()","row().child().show()"],function(){Jb(this,!0);return this});P(["row().child.hide()","row().child().hide()"],function(){Jb(this,!1);return this});P(["row().child.remove()","row().child().remove()"],function(){db(this);return this});P("row().child.isShown()",function(){var a=this.context;return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Sb=/^(.+):(name|visIdx|visible)$/,Kb=function(a,b,c,d,e){c=[];d=0;for(var f=
e.length;d<f;d++)c.push(E(a,e[d],b));return c};P("columns()",function(a,d){a===c?a="":b.isPlainObject(a)&&(d=a,a="");d=bb(d);var e=this.iterator("table",function(c){var e=a,f=d,h=c.aoColumns,q=ma(h,"sName"),k=ma(h,"nTh");return ab("column",e,function(a){var d=Db(a);if(""===a)return va(h.length);if(null!==d)return[0<=d?d:h.length+d];if("function"===typeof a){var e=Na(c,f);return b.map(h,function(b,d){return a(d,Kb(c,d,0,0,e),k[d])?d:null})}var l="string"===typeof a?a.match(Sb):"";if(l)switch(l[2]){case "visIdx":case "visible":d=
parseInt(l[1],10);if(0>d){var v=b.map(h,function(a,b){return a.bVisible?b:null});return[v[v.length+d]]}return[n(c,d)];case "name":return b.map(q,function(a,b){return a===l[1]?b:null})}else return b(k).filter(a).map(function(){return b.inArray(this,k)}).toArray()},c,f)},1);e.selector.cols=a;e.selector.opts=d;return e});Z("columns().header()","column().header()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});Z("columns().footer()","column().footer()",function(){return this.iterator("column",
function(a,b){return a.aoColumns[b].nTf},1)});Z("columns().data()","column().data()",function(){return this.iterator("column-rows",Kb,1)});Z("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});Z("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,d,e,f){return Aa(b.aoData,f,"search"===a?"_aFilterData":"_aSortData",c)},1)});Z("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",
function(a,b,c,d,e){return Aa(a.aoData,e,"anCells",b)},1)});Z("columns().visible()","column().visible()",function(a,d){return this.iterator("column",function(e,f){if(a===c)return e.aoColumns[f].bVisible;var h=e.aoColumns,q=h[f],k=e.aoData,l,n,v;if(a!==c&&q.bVisible!==a){if(a){var m=b.inArray(!0,ma(h,"bVisible"),f+1);l=0;for(n=k.length;l<n;l++)v=k[l].nTr,h=k[l].anCells,v&&v.insertBefore(h[f],h[m]||null)}else b(ma(e.aoData,"anCells",f)).detach();q.bVisible=a;J(e,e.aoHeader);J(e,e.aoFooter);if(d===c||
d)r(e),(e.oScroll.sX||e.oScroll.sY)&&wa(e);X(e,null,"column-visibility",[e,f,a,d]);Ia(e)}})});Z("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?h(b,c):c},1)});P("columns.adjust()",function(){return this.iterator("table",function(a){r(a)},1)});P("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return n(c,b);if("fromData"===a||"toVisible"===a)return h(c,b)}});P("column()",
function(a,b){return cb(this.columns(a,b))});P("cells()",function(a,d,e){b.isPlainObject(a)&&(a.row===c?(e=a,a=null):(e=d,d=null));b.isPlainObject(d)&&(e=d,d=null);if(null===d||d===c)return this.iterator("table",function(d){var f=a,h=bb(e),q=d.aoData,k=Na(d,h),l=Gb(Aa(q,k,"anCells")),n=b([].concat.apply([],l)),v,m=d.aoColumns.length,t,g,G,r,p,N;return ab("cell",f,function(a){var e="function"===typeof a;if(null===a||a===c||e){t=[];g=0;for(G=k.length;g<G;g++)for(v=k[g],r=0;r<m;r++)p={row:v,column:r},
e?(N=q[v],a(p,E(d,v,r),N.anCells?N.anCells[r]:null)&&t.push(p)):t.push(p);return t}return b.isPlainObject(a)?[a]:n.filter(a).map(function(a,b){return{row:b._DT_CellIndex.row,column:b._DT_CellIndex.column}}).toArray()},d,h)});var f=this.columns(d,e),h=this.rows(a,e),q,k,l,n,v,m=this.iterator("table",function(a,b){q=[];k=0;for(l=h[b].length;k<l;k++)for(n=0,v=f[b].length;n<v;n++)q.push({row:h[b][k],column:f[b][n]});return q},1);b.extend(m.selector,{cols:d,rows:a,opts:e});return m});Z("cells().nodes()",
"cell().node()",function(){return this.iterator("cell",function(a,b,d){return(a=a.aoData[b].anCells)?a[d]:c},1)});P("cells().data()",function(){return this.iterator("cell",function(a,b,c){return E(a,b,c)},1)});Z("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",function(b,c,d){return b.aoData[c][a][d]},1)});Z("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return E(b,c,d,a)},1)});Z("cells().indexes()",
"cell().index()",function(){return this.iterator("cell",function(a,b,c){return{row:b,column:c,columnVisible:h(a,c)}},1)});Z("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){H(b,c,a,d)})});P("cell()",function(a,b,c){return cb(this.cells(a,b,c))});P("cell().data()",function(a){var b=this.context,d=this[0];if(a===c)return b.length&&d.length?E(b[0],d[0].row,d[0].column):c;A(b[0],d[0].row,d[0].column,a);H(b[0],d[0].row,"data",d[0].column);return this});
P("order()",function(a,d){var e=this.context;if(a===c)return 0!==e.length?e[0].aaSorting:c;"number"===typeof a?a=[[a,d]]:b.isArray(a[0])||(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});P("order.listener()",function(a,b,c){return this.iterator("table",function(d){Qa(d,a,b,c)})});P("order.fixed()",function(a){if(!a){var d=this.context,d=d.length?d[0].aaSortingFixed:c;return b.isArray(d)?{pre:d}:d}return this.iterator("table",function(c){c.aaSortingFixed=
b.extend(!0,{},a)})});P(["columns().order()","column().order()"],function(a){var c=this;return this.iterator("table",function(d,e){var f=[];b.each(c[e],function(b,c){f.push([c,a])});d.aaSorting=f})});P("search()",function(a,d,e,f){var h=this.context;return a===c?0!==h.length?h[0].oPreviousSearch.sSearch:c:this.iterator("table",function(c){c.oFeatures.bFilter&&sa(c,b.extend({},c.oPreviousSearch,{sSearch:a+"",bRegex:null===d?!1:d,bSmart:null===e?!0:e,bCaseInsensitive:null===f?!0:f}),1)})});Z("columns().search()",
"column().search()",function(a,d,e,f){return this.iterator("column",function(h,q){var k=h.aoPreSearchCols;if(a===c)return k[q].sSearch;h.oFeatures.bFilter&&(b.extend(k[q],{sSearch:a+"",bRegex:null===d?!1:d,bSmart:null===e?!0:e,bCaseInsensitive:null===f?!0:f}),sa(h,h.oPreviousSearch,1))})});P("state()",function(){return this.context.length?this.context[0].oSavedState:null});P("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});P("state.loaded()",
function(){return this.context.length?this.context[0].oLoadedState:null});P("state.save()",function(){return this.iterator("table",function(a){Ia(a)})});D.versionCheck=D.fnVersionCheck=function(a){var b=D.version.split(".");a=a.split(".");for(var c,d,e=0,f=a.length;e<f;e++)if(c=parseInt(b[e],10)||0,d=parseInt(a[e],10)||0,c!==d)return c>d;return!0};D.isDataTable=D.fnIsDataTable=function(a){var c=b(a).get(0),d=!1;b.each(D.settings,function(a,e){var f=e.nScrollHead?b("table",e.nScrollHead)[0]:null,h=
e.nScrollFoot?b("table",e.nScrollFoot)[0]:null;if(e.nTable===c||f===c||h===c)d=!0});return d};D.tables=D.fnTables=function(a){var c=!1;b.isPlainObject(a)&&(c=a.api,a=a.visible);var d=b.map(D.settings,function(c){if(!a||a&&b(c.nTable).is(":visible"))return c.nTable});return c?new S(d):d};D.util={throttle:Ea,escapeRegex:Fa};D.camelToHungarian=k;P("$()",function(a,c){var d=this.rows(c).nodes(),d=b(d);return b([].concat(d.filter(a).toArray(),d.find(a).toArray()))});b.each(["on","one","off"],function(a,
c){P(c+"()",function(){var a=Array.prototype.slice.call(arguments);a[0].match(/\.dt\b/)||(a[0]+=".dt");var d=b(this.tables().nodes());d[c].apply(d,a);return this})});P("clear()",function(){return this.iterator("table",function(a){I(a)})});P("settings()",function(){return new S(this.context,this.context)});P("init()",function(){var a=this.context;return a.length?a[0].oInit:null});P("data()",function(){return this.iterator("table",function(a){return ma(a.aoData,"_aData")}).flatten()});P("destroy()",
function(a){a=a||!1;return this.iterator("table",function(c){var d=c.nTableWrapper.parentNode,e=c.oClasses,f=c.nTable,h=c.nTBody,q=c.nTHead,k=c.nTFoot,l=b(f),h=b(h),n=b(c.nTableWrapper),v=b.map(c.aoData,function(a){return a.nTr}),m;c.bDestroying=!0;X(c,"aoDestroyCallback","destroy",[c]);a||(new S(c)).columns().visible(!0);n.unbind(".DT").find(":not(tbody *)").unbind(".DT");b(g).unbind(".DT-"+c.sInstance);f!=q.parentNode&&(l.children("thead").detach(),l.append(q));k&&f!=k.parentNode&&(l.children("tfoot").detach(),
l.append(k));c.aaSorting=[];c.aaSortingFixed=[];Ha(c);b(v).removeClass(c.asStripeClasses.join(" "));b("th, td",q).removeClass(e.sSortable+" "+e.sSortableAsc+" "+e.sSortableDesc+" "+e.sSortableNone);c.bJUI&&(b("th span."+e.sSortIcon+", td span."+e.sSortIcon,q).detach(),b("th, td",q).each(function(){var a=b("div."+e.sSortJUIWrapper,this);b(this).append(a.contents());a.detach()}));h.children().detach();h.append(v);q=a?"remove":"detach";l[q]();n[q]();!a&&d&&(d.insertBefore(f,c.nTableReinsertBefore),l.css("width",
c.sDestroyWidth).removeClass(e.sTable),(m=c.asDestroyStripes.length)&&h.children().each(function(a){b(this).addClass(c.asDestroyStripes[a%m])}));d=b.inArray(c,D.settings);-1!==d&&D.settings.splice(d,1)})});b.each(["column","row","cell"],function(a,b){P(b+"s().every()",function(a){var d=this.selector.opts,e=this;return this.iterator(b,function(f,h,q,k,l){a.call(e[b](h,"cell"===b?q:d,"cell"===b?d:c),h,q,k,l)})})});P("i18n()",function(a,d,e){var f=this.context[0];a=F(a)(f.oLanguage);a===c&&(a=d);e!==
c&&b.isPlainObject(a)&&(a=a[e]!==c?a[e]:a._);return a.replace("%d",e)});D.version="1.10.10";D.settings=[];D.models={};D.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};D.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};D.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,
mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};D.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,
bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?
sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(b){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(c){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",
sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},
oSearch:b.extend({},D.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};a(D.defaults);D.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,
sType:null,sWidth:null};a(D.defaults.column);D.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],
aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,
searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:c,oAjaxData:c,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],
fnRecordsTotal:function(){return"ssp"==ia(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ia(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=this._iDisplayLength,b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,e=this.oFeatures,f=e.bPaginate;return e.bServerSide?!1===f||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!f||c>d||-1===a?d:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,
aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};D.ext=ea={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:D.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:D.version};b.extend(ea,{afnFiltering:ea.search,aTypes:ea.type.detect,ofnSearch:ea.type.search,oSort:ea.type.order,afnSortData:ea.order,
aoFeatures:ea.feature,oApi:ea.internal,oStdClasses:ea.classes,oPagination:ea.pager});b.extend(D.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",
sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",
sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Oa="",Oa="",oa=Oa+"ui-state-default",Ba=Oa+"css_right ui-icon ui-icon-",Lb=Oa+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";b.extend(D.ext.oJUIClasses,D.ext.classes,{sPageButton:"fg-button ui-button "+oa,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",
sSortAsc:oa+" sorting_asc",sSortDesc:oa+" sorting_desc",sSortable:oa+" sorting",sSortableAsc:oa+" sorting_asc_disabled",sSortableDesc:oa+" sorting_desc_disabled",sSortableNone:oa+" sorting_disabled",sSortJUIAsc:Ba+"triangle-1-n",sSortJUIDesc:Ba+"triangle-1-s",sSortJUI:Ba+"carat-2-n-s",sSortJUIAscAllowed:Ba+"carat-1-n",sSortJUIDescAllowed:Ba+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+oa,sScrollFoot:"dataTables_scrollFoot "+
oa,sHeaderTH:oa,sFooterTH:oa,sJUIHeader:Lb+" ui-corner-tl ui-corner-tr",sJUIFooter:Lb+" ui-corner-bl ui-corner-br"});var Ab=D.ext.pager;b.extend(Ab,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},numbers:function(a,b){return[Ka(a,b)]},simple_numbers:function(a,b){return["previous",Ka(a,b),"next"]},full_numbers:function(a,b){return["first","previous",Ka(a,b),"next","last"]},_numbers:Ka,numbers_length:7});b.extend(!0,D.ext.renderer,{pageButton:{_:function(a,
c,e,f,h,q){var k=a.oClasses,l=a.oLanguage.oPaginate,n=a.oLanguage.oAria.paginate||{},v,m,t=0,g=function(c,d){var f,G,r,p,N=function(b){Va(a,b.data.action,!0)};f=0;for(G=d.length;f<G;f++)if(p=d[f],b.isArray(p))r=b("<"+(p.DT_el||"div")+"/>").appendTo(c),g(r,p);else{v=null;m="";switch(p){case "ellipsis":c.append('<span class="ellipsis">&#x2026;</span>');break;case "first":v=l.sFirst;m=p+(0<h?"":" "+k.sPageButtonDisabled);break;case "previous":v=l.sPrevious;m=p+(0<h?"":" "+k.sPageButtonDisabled);break;
case "next":v=l.sNext;m=p+(h<q-1?"":" "+k.sPageButtonDisabled);break;case "last":v=l.sLast;m=p+(h<q-1?"":" "+k.sPageButtonDisabled);break;default:v=p+1,m=h===p?k.sPageButtonActive:""}null!==v&&(r=b("<a>",{"class":k.sPageButton+" "+m,"aria-controls":a.sTableId,"aria-label":n[p],"data-dt-idx":t,tabindex:a.iTabIndex,id:0===e&&"string"===typeof p?a.sTableId+"_"+p:null}).html(v).appendTo(c),Xa(r,{action:p},N),t++)}},G;try{G=b(c).find(d.activeElement).data("dt-idx")}catch(r){}g(b(c).empty(),f);G&&b(c).find("[data-dt-idx="+
G+"]").focus()}}});b.extend(D.ext.type.detect,[function(a,b){var c=b.oLanguage.sDecimal;return $a(a,c)?"num"+c:null},function(a){if(!(!a||a instanceof Date||Pb.test(a)&&Qb.test(a)))return null;var b=Date.parse(a);return null!==b&&!isNaN(b)||ra(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return $a(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Fb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Fb(a,c,!0)?"html-num-fmt"+c:null},function(a){return ra(a)||
"string"===typeof a&&-1!==a.indexOf("<")?"html":null}]);b.extend(D.ext.type.search,{html:function(a){return ra(a)?a:"string"===typeof a?a.replace(Cb," ").replace(Ma,""):""},string:function(a){return ra(a)?a:"string"===typeof a?a.replace(Cb," "):a}});var La=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Eb(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};b.extend(ea.type.order,{"date-pre":function(a){return Date.parse(a)||0},"html-pre":function(a){return ra(a)?
"":a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+""},"string-pre":function(a){return ra(a)?"":"string"===typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});eb("");b.extend(!0,D.ext.renderer,{header:{_:function(a,c,d,e){b(a.nTable).on("order.dt.DT",function(b,f,h,q){a===f&&(b=d.idx,c.removeClass(d.sSortingClass+" "+e.sSortAsc+" "+e.sSortDesc).addClass("asc"==q[b]?e.sSortAsc:"desc"==q[b]?e.sSortDesc:
d.sSortingClass))})},jqueryui:function(a,c,d,e){b("<div/>").addClass(e.sSortJUIWrapper).append(c.contents()).append(b("<span/>").addClass(e.sSortIcon+" "+d.sSortingClassJUI)).appendTo(c);b(a.nTable).on("order.dt.DT",function(b,f,h,q){a===f&&(b=d.idx,c.removeClass(e.sSortAsc+" "+e.sSortDesc).addClass("asc"==q[b]?e.sSortAsc:"desc"==q[b]?e.sSortDesc:d.sSortingClass),c.find("span."+e.sSortIcon).removeClass(e.sSortJUIAsc+" "+e.sSortJUIDesc+" "+e.sSortJUI+" "+e.sSortJUIAscAllowed+" "+e.sSortJUIDescAllowed).addClass("asc"==
q[b]?e.sSortJUIAsc:"desc"==q[b]?e.sSortJUIDesc:d.sSortingClassJUI))})}}});D.render={number:function(a,b,c,d,e){return{display:function(f){if("number"!==typeof f&&"string"!==typeof f)return f;var h=0>f?"-":"",q=parseFloat(f);if(isNaN(q))return f;f=Math.abs(q);q=parseInt(f,10);f=c?b+(f-q).toFixed(c).substring(2):"";return h+(d||"")+q.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+f+(e||"")}}},text:function(){return{display:function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,
"&quot;"):a}}}};b.extend(D.ext.internal,{_fnExternApiFunc:Bb,_fnBuildAjax:v,_fnAjaxUpdate:G,_fnAjaxParameters:N,_fnAjaxUpdateDraw:Y,_fnAjaxDataSrc:T,_fnAddColumn:m,_fnColumnOptions:u,_fnAdjustColumnSizing:r,_fnVisibleToColumnIndex:n,_fnColumnIndexToVisible:h,_fnVisbleColumns:C,_fnGetColumns:x,_fnColumnTypes:y,_fnApplyColumnDefs:K,_fnHungarianMap:a,_fnCamelToHungarian:k,_fnLanguageCompat:l,_fnBrowserDetect:t,_fnAddData:z,_fnAddTr:L,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==c?b._DT_RowIndex:
null},_fnNodeToColumnIndex:function(a,c,d){return b.inArray(d,a.aoData[c].anCells)},_fnGetCellData:E,_fnSetCellData:A,_fnSplitObjNotation:M,_fnGetObjectDataFn:F,_fnSetObjectDataFn:w,_fnGetDataMaster:B,_fnClearTable:I,_fnDeleteIndex:O,_fnInvalidate:H,_fnGetRowElements:Q,_fnCreateTr:U,_fnBuildHead:V,_fnDrawHead:J,_fnDraw:ca,_fnReDraw:fa,_fnAddOptionsHtml:ba,_fnDetectHeader:R,_fnGetUniqueThs:q,_fnFeatureHtmlFilter:ya,_fnFilterComplete:sa,_fnFilterCustom:nb,_fnFilterColumn:mb,_fnFilter:lb,_fnFilterCreateSearch:Sa,
_fnEscapeRegex:Fa,_fnFilterData:ob,_fnFeatureHtmlInfo:jb,_fnUpdateInfo:rb,_fnInfoMacros:sb,_fnInitialise:za,_fnInitComplete:Da,_fnLengthChange:Ta,_fnFeatureHtmlLength:gb,_fnFeatureHtmlPaginate:kb,_fnPageChange:Va,_fnFeatureHtmlProcessing:hb,_fnProcessingDisplay:la,_fnFeatureHtmlTable:ib,_fnScrollDraw:wa,_fnApplyToChildren:pa,_fnCalculateColumnWidths:Pa,_fnThrottle:Ea,_fnConvertToWidth:tb,_fnGetWidestNode:ub,_fnGetMaxLenString:vb,_fnStringToCss:aa,_fnSortFlatten:ua,_fnSort:fb,_fnSortAria:xb,_fnSortListener:Wa,
_fnSortAttachListener:Qa,_fnSortingClasses:Ha,_fnSortData:wb,_fnSaveState:Ia,_fnLoadState:yb,_fnSettingsFromNode:Ja,_fnLog:qa,_fnMap:na,_fnBindAction:Xa,_fnCallbackReg:ja,_fnCallbackFire:X,_fnLengthOverflow:Ua,_fnRenderer:Ra,_fnDataSource:ia,_fnRowAttributes:W,_fnCalculateEnd:function(){}});b.fn.dataTable=D;D.$=b;b.fn.dataTableSettings=D.settings;b.fn.dataTableExt=D.ext;b.fn.DataTable=function(a){return b(this).dataTable(a).api()};b.each(D,function(a,c){b.fn.DataTable[a]=c});return b.fn.dataTable});window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(b){return function(){var g={};return{check_message:function(d){var c={},a;if(!d.is_box())return this.report_error("Function birds can only respond to boxes. One was given "+b.UTILITIES.add_a_or_an(d.get_type_name()));c.box_size=d.get_size();if(1>c.box_size)return this.report_error("Function birds can only respond to boxes with holes.");a=d.get_hole_contents(0);if(!a)return this.report_error("Function birds can only respond to boxes with something in the first hole.");
if(a.is_box()){c.bird=a.get_hole_contents(0);if(2<a.get_size()&&(c.error_bird=a.get_hole_contents(2),c.error_bird&&!c.error_bird.is_bird()))return this.report_error("A function bird received a box with a box in its first hole that should only contain birds. It contains "+b.UTILITIES.add_a_or_an(c.message_return_bird.get_type_name())+".",c.bird.is_bird()&&c);if(!c.bird)return this.report_error("Function birds can only respond to boxes with a box in the first hole if the box's first hole contains a bird. It is empty.",
c);if(!c.bird.is_bird())return this.report_error("Function birds can only respond to boxes with a box in the first hole if the box's first hole contains a bird. The first hole contains "+b.UTILITIES.add_a_or_an(c.bird.get_type_name())+".",c);if(1<a.get_size()&&(c.message_return_bird=a.get_hole_contents(1),c.message_return_bird&&!c.message_return_bird.is_bird()))return this.report_error("A function bird received a box with a box in its first hole that should only contain birds. It contains "+b.UTILITIES.add_a_or_an(c.message_return_bird.get_type_name())+
".",c)}else if(a.is_bird())c.bird=a;else return this.report_error("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+b.UTILITIES.add_a_or_an(a.get_type_name())+".",c);c.message=d;return c},report_error:function(d,c){b.UTILITIES.display_message(d);c&&(c.error_bird||c.bird)&&(c.error_bird||c.bird).widget_side_dropped_on_me(b.element.create(d),{});c&&c.message_return_bird&&c.message_return_bird.widget_side_dropped_on_me(c.message,void 0);return d},process_response:function(b,
c,a,k){b&&(k.do_not_run_next_step=!0,k.by_function_bird=!0,c.message_return_bird||(k.temporary_bird=!0),c.bird.widget_side_dropped_on_me(b,k),c&&c.message_return_bird&&c.message_return_bird.widget_side_dropped_on_me(c.message,k));c.message_return_bird||a.remove({do_not_remove_children:!0})},process_message:function(b,c,a){var k=this.check_message(b);if("string"!==typeof k)return c=c(k),!k.message_return_bird&&1<b.get_size()&&b.get_hole_contents(1)&&(a.do_not_remove_children=!0,a.do_not_remove_frontside=
!0,b.get_hole_contents(1).remove(a)),this.process_response(c,k,b,a),c},type_check:function(d,c,a,k,l){if(c.is_nest()&&!c.has_contents())throw b.sounds&&b.sounds.bird_fly.pause(),{wait_for_nest_to_receive_something:c};return d?c?c.dereference().is_of_type(d)?!0:this.report_error("The '"+a+"' bird can only respond to boxes with "+b.UTILITIES.add_a_or_an(d)+" in the "+b.UTILITIES.ordinal(k)+" hole. The "+b.UTILITIES.ordinal(k)+" hole contains "+b.UTILITIES.add_a_or_an(c.get_type_name()+"."),l):this.report_error("The '"+
a+"' bird can only respond to boxes with "+b.UTILITIES.add_a_or_an(d)+" in the "+b.UTILITIES.ordinal(k)+" hole. The "+b.UTILITIES.ordinal(k)+" hole is empty.",l):!0},number_check:function(b,c,a,k){return this.type_check("number",b,c,a,k)},n_ary_widget_function:function(d,c,a,k,l){var e=function(e){var l,g,m;if(1===e.box_size)return c();g=1;if(m=d.get_hole_contents(g)){if(m=m.dereference(),!0===this.number_check(m,k,g,e)){e.message_return_bird&&(m=m.copy());for(g++;g<e.box_size;){l=d.get_hole_contents(g);
if(!l){this.report_error("The '"+k+"' bird could not work because the "+b.UTILITIES.ordinal(g-1)+" number is missing.",e);return}l=l.dereference();if(!0!==this.number_check(l,k,g,e))return;a.call(m,l);g++}return m}}else this.report_error("The '"+k+"' bird could not work because the first number is missing.",e)}.bind(this);return this.process_message(d,e,l)},n_ary_function:function(d,c,a,k,l){var e=function(e){var l,g,m,u;if(e.box_size<a+1)this.report_error("The '"+k+"' bird can only respond to boxes with at least "+
(a+1)+" holes. Not "+e.box_size+" holes.",e);else{m=[];for(g=1;g<e.box_size;){l=d.get_hole_contents(g);if(!l){this.report_error("The '"+k+"' bird stopped becaused the "+b.UTILITIES.ordinal(g)+" hole is empty.",e);return}l=l.dereference();if(!0!==this.number_check(l,k,g,e))return;l.get_approximate&&l.get_approximate()&&(u=!0);m.push(l.get_value());g++}e=c.apply(null,m);u&&(e.set_approximate(!0),e.set_format("decimal"));return e}}.bind(this);return this.process_message(d,e,l)},typed_bird_function:function(d,
c,a,k,l,e,f){var g=function(l){var m,g,t,n,h;if(0<=e&&l.box_size<e+1)this.report_error("The '"+k+"' bird can only respond to boxes with "+(e+1)+" or more holes. Not "+l.box_size+" holes.",l);else{n=[];g=1;for(t=f?f:l.box_size-1;g<t+1;){m=d.get_hole_contents(g);if(g<=e&&!m){this.report_error("The '"+k+"' bird found nothing in the "+b.UTILITIES.ordinal(g)+" hole.",l);return}if(m){m=m.dereference();g<=a.length&&(h=a[g-1]);if(!0!==this.type_check(h,m,k,g,l))return;n.push(m)}else n.push(void 0);g++}n.push(l);
return c.apply(d,n)}}.bind(this);return this.process_message(d,g,l)},numeric_javascript_function_to_widget_function:function(d,c,a){return function(){var k=b.number.ZERO(b.number.function_bird_results_default_format);k.set_value_from_decimal(d.apply(null,b.UTILITIES.map_arguments(arguments,a||bigrat.toDecimal)));c&&(k.set_approximate(!0),k.set_format("decimal"));return k}},bigrat_function_to_widget_function:function(d,c){return function(){var a=b.number.create_from_bigrat(d.apply(null,arguments));
c&&c(arguments)&&(a.set_approximate(!0),a.set_format("decimal"));return a}},add_function_object:function(d,c,a,k,l){g[d]={name:d,short_name:k||d,respond_to_message:c,get_description:l?1===l.length?function(){return"If you give me a box with another bird and "+b.UTILITIES.add_a_or_an(l[0])+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+b.UTILITIES.conjunction(l,!0)+
" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."},toString:function(){return b.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:a}},get_function_table:function(){return g}}}}(window.TOONTALK);window.TOONTALK.widget=function(b){var g=function(b){if(b=this.get_frontside&&this.get_frontside(b))return b.get_element()};b.creators_from_json.top_level=function(d){d=b.widget.create_top_level_widget(d.settings);d.get_backside(!0);return d};return{add_standard_widget_functionality:function(d){var c=function(){return!1},a;this.add_sides_functionality(d);this.runnable(d);this.stackable(d);this.animatable(d);this.has_title(d);this.has_parent(d);this.has_backside_widgets(d);this.has_description(d);
this.has_listeners(d);this.droppable(d);this.erasable(d);d.this_and_walk_children=function(a){a(d)&&d.walk_children&&d.walk_children(a)};d.top_level_widget=function(){var c;if(a)return a;if(this.is_top_level())return this;if(a=b.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")))return a=a.get_widget();if(c=this.get_parent_of_frontside()||this.get_parent_of_backside())return a=c.get_widget().top_level_widget();c=$(".toontalk-backside-of-top-level");
if(0<c.length)return a=b.UTILITIES.widget_side_of_element(b.UTILITIES.closest_element(c,$(this.get_frontside_element()).offset())).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return a=this.create_top_level_widget()};d.is_of_type||(d.is_of_type=function(a){return this.get_type_name()===a});d.dereference||(d.dereference=function(){return this});d.get_default_description||(d.get_default_description=function(){return b.UTILITIES.add_a_or_an(this.get_type_name())+
"."});d.is_number||(d.is_number=c);d.is_box||(d.is_box=c);d.is_empty_hole||(d.is_empty_hole=c);d.is_hole||(d.is_hole=c);d.is_scale||(d.is_scale=c);d.is_bird||(d.is_bird=c);d.is_nest||(d.is_nest=c);d.is_robot||(d.is_robot=c);d.is_element||(d.is_element=c);d.is_sensor||(d.is_sensor=c);d.is_function_nest||(d.is_function_nest=c);d.is_plain_text_element||(d.is_plain_text_element=c);d.is_attribute_widget||(d.is_attribute_widget=c);d.maintain_proportional_dimensions||(d.maintain_proportional_dimensions=
c);d.ok_to_set_dimensions=function(){return!this.is_plain_text_element()};d.set_name&&(d.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});!b.debugging&&!b.logging||d.to_debug_string||(d.to_debug_string=function(a){var b=this.get_parent_widget_of_frontside(),c=this._debug_id,d=this.get_description(),d=d?d+" ":"";c||(c=b&&b.id?"id of parent is "+b.id:"");d&&(d+=" ");return(this.toString({plain_text:!0})+" ("+d+(this.get_name&&this.get_name()+
" "||"")+c+")").substring(0,a)});d.is_top_level=c;d.is_widget=!0},erasable:function(b){var c;b.get_erased||(b.get_erased=function(){return c});b.set_erased||(b.set_erased=function(a,b){c=a;b&&this.rerender()})},add_sides_functionality:function(d){var c,a,k;d.get_frontside||(d.get_frontside=function(a){a&&!c&&(c=b.frontside.create(d));return c},d.save_dimensions=function(){return this.save_dimensions_of(this)},d.save_dimensions_of=function(a){var b;if(a.is_element()){if(!this.get_original_width())return;
b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0},d.restore_dimensions=function(){var a,c;0<this.saved_width&&(a=this.get_frontside_element(!0),this.ok_to_set_dimensions()?this.use_scaling_transform?this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):b.UTILITIES.set_css(a,
{width:this.saved_width,height:this.saved_height}):(c={width:"",height:""},b.UTILITIES.set_css_transform(c,""),b.UTILITIES.set_css(a,c)),this.saved_height=this.saved_width=void 0)},d.get_width=function(){return b.UTILITIES.get_element_width(d.get_frontside_element())},d.get_height=function(){return b.UTILITIES.get_element_height(d.get_frontside_element())});d.get_backside||(d.get_backside=function(b){b&&!a&&(a=this.create_backside(),this.backside_widgets_json_views&&a.add_backside_widgets(this.get_backside_widgets(),
this.backside_widgets_json_views));return a});d.set_backside||(d.set_backside=function(b){a=b});d.forget_backside||(d.forget_backside=function(){var b;if(a){if(b=a.get_element())$(b).remove(),b.toontalk_widget_side=void 0;a=void 0}});d.create_backside||(d.create_backside=function(){return b.backside.create(d)});d.get_open_backside_only_if_stopped||(d.get_open_backside_only_if_stopped=function(){return k});d.set_open_backside_only_if_stopped||(d.set_open_backside_only_if_stopped=function(a){k=a})},
runnable:function(d){var c=!1,a=!1;d.get_running||(d.get_running=function(a){var b=!1;if(a)return c;if(c)if(a=this.get_backside_widgets(),0===a.length)c=!1;else for(a.some(function(a){if(a&&(a=a.get_widget(),a.get_running()))return b=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return b});d.is_ok_to_run||(d.is_ok_to_run=function(){return a},d.set_ok_to_run=function(b){a=
b});d.set_running||(d.set_running=function(k,l,e){var f=c===k,g,p;a=k;g=this.get_backside_widgets();(c=k)&&b.logging&&0<=b.logging.indexOf("running")&&console.log(this._debug_string.substring(0,100)+" running.");this.get_backside()&&!f&&this.get_backside().run_status_changed(c);b.UTILITIES.for_each_batch(g,function(a){a&&(p=a.get_widget(),a.is_backside()&&(0<=this.get_backside_widgets().indexOf(p)||!a.is_primary_backside())||(!p.is_robot()||p.being_trained||p.get_body().is_empty()?p.set_running&&
(!l&&a.is_backside()&&"top-level"!==d.get_type_name()?p.set_running(k,d,!0):p.set_running(k)):c?(c&&b.logging&&0<=b.logging.indexOf("running")&&console.log(p._debug_string.substring(0,100)+" running."),p.set_stopped(!1),p.run(d,e,l),p.set_ok_to_run(!0)):(p.set_stopped(!0),p.set_running(!1)),p.rerender()))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(c);return!0});this.is_robot()&&(c?d.get_parent_of_backside()&&(this.set_stopped(!1),this.run(d.get_parent_of_backside().get_widget())):
this.set_stopped(!0));f||this.rerender()})},droppable:function(b){b.drop_on||(b.drop_on=function(b,a){if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,a);console.log("No handler for drop of '"+this+"' on '"+b+"'")})},stackable:function(b){var c=!1;b.get_infinite_stack||(b.get_infinite_stack=function(){return c});b.set_infinite_stack||(b.set_infinite_stack=function(a){var k=b.get_backside_element(),l=b.get_frontside_element();c=a;k&&$(k).find(".toontalk-infinite-stack-check-box").prop("checked",
a);l&&(a?$(l).addClass("toontalk-infinite-stack"):$(l).removeClass("toontalk-infinite-stack"))})},animatable:function(d){var c;d.animate_to_widget||(c=function(a,c){var d=a.get_element();d&&(a.is_backside()||b.UTILITIES.visible_element(d))||(d=b.UTILITIES.find_resource_equal_to_widget(a,c));return d},d.animate_to_widget=function(a,b,d,e,f,g,p,m){var u=function(){this.animate_to_element(c(a,m),b,d,e,f,g,p&&Math.max(0,p-100));this.rerender()}.bind(this);p?setTimeout(u,100):u()});d.animate_to_element||
(d.animate_to_element=function(a,c,d,e,f,g,p){var m=$(a).offset(),u=this.get_frontside_element(),r=$(a).is(".toontalk-backside");if(a&&b.UTILITIES.visible_element(a)&&0!==d){if("number"===typeof a.animation_left_offset)e=a.animation_left_offset;else if("undefined"===typeof e||r)e=(b.UTILITIES.get_element_width(a)-b.UTILITIES.get_element_width(u))*Math.random();if("number"===typeof a.animation_top_offset)f=a.animation_top_offset;else if("undefined"===typeof f||r)f=(b.UTILITIES.get_element_height(a)-
b.UTILITIES.get_element_height(u))*Math.random();m?(m.left+=e,m.top+=f):m={left:0,top:0};this.animate_to_absolute_position(m,c,d,g,p)}else c&&c()});d.animate_to_absolute_position||(d.animate_to_absolute_position=function(a,c,d,e,f){b.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),a,c,d,e,f)})},has_title:function(d){d.get_title||(d.get_title=function(){var c=this.get_type_name(),a=this.get_backside(),d=this.get_frontside_element(),l=this.get_description(),e="";$(d).is(".toontalk-top-level-resource")?
e=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":a&&a.get_element()&&b.UTILITIES.visible_element(a.get_element())||b.open_backside_only_if_alt_key||(e=this.can_run&&this.can_run(!0)?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+
" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my backside and then click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+".":"Click to see my backside.");l&&(l="I'm "+l,e=e?l+"\n"+e:l);if(this.get_erased())return this.get_title_of_erased_widget();e=this.get_custom_title_prefix&&!$(d).is(".toontalk-top-level-resource")?this.get_custom_title_prefix()+"\n"+e:"I'm "+b.UTILITIES.add_a_or_an(c)+". "+e;
e=e.trim();0>".?!".indexOf(e[e.length-1])&&(e+=".");return e});d.update_title=function(){var c=this.get_frontside_element();c&&b.UTILITIES.give_tooltip(c,this.get_title())}},inside_conditions_container:function(){return $(this.get_frontside_element()).closest(".toontalk-conditions-container").is("*")},get_title_of_erased_widget:function(){var b=this.get_type_name();return this.inside_conditions_container()?"I'm an erased "+b+".\nI'll match with any other "+b+".":"I'm an erased "+b+".\nDusty the Vacuum can restore me to normal."},
has_parent:function(d){var c=[],a,k,l,e;d.get_parent_of_frontside=function(){return l&&a?a.get_backside(!0):a};d.get_parent_widget_of_frontside=function(){return a};d.get_containing_widget=function(){return a&&a.is_hole()?a.get_parent_widget_of_frontside():this.get_parent_of_frontside()||this};d.parent_of_frontside_is_backside=function(){return l};d.set_parent_of_frontside=function(b,d,e){var k=a;l=d;a!==b&&(a=b,k&&!e&&!d&&k.is_backside()&&k.get_widget().remove_backside_widget(this,!0),c.forEach(function(b){b(k,
a)}))};d.add_parent_of_frontside_change_listener=function(a){c.push(a)};d.remove_parent_of_frontside_change_listener=function(a){a=c.indexOf(a);0<=a&&c.splice(a,1)};d.get_parent_of_backside=function(){return e&&k?k.get_backside(!0):k};d.set_parent_of_backside=function(a,b,c){void 0===a&&!c&&e&&k&&k.get_widget().remove_backside_widget(this.get_backside(),!0);k=a;e=b};d.parent_of_backside_is_backside=function(){return e};d.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?
a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};d.closest_visible_ancestor_or_frontside=function(){for(var a=this,c;a&&!b.UTILITIES.visible_element(a.get_frontside_element());)c=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=c.get_widget()):a=a.get_parent_of_frontside();return a||this};d.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};d.has_ancestor=function(a){var b;
return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};d.remove_from_parent_of_frontside=function(b){a&&(a.is_backside()?a.remove_backside_widget(this,!b):a.removed_from_container?l?a.remove_backside_widget(this,!0):a.removed_from_container(this,b):a.get_backside()&&a.remove_backside_widget(this,!b))}},has_description:function(b){var c;b.get_description||(b.get_description=function(){return c});b.set_description||(b.set_description=function(a,b,d){if(c===a||!c&&""===a)return!1;
c=a;b&&this.rerender();d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_description",argument_1:a,toString:"change the description to '"+a+"'' of the "+this.get_type_name(),button_selector:".toontalk-description-input"});return!0});b.receive_description_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_description(a,!0)))return this.get_description()}},has_name:function(d){var c;d.get_name||(d.get_name=function(){"string"!==typeof c&&d.generate_name&&
(c=d.generate_name());return c});d.set_name||(d.set_name=function(a,d,l){if(c===a||"string"!==typeof a)return!1;c=a;b.UTILITIES.set_css(this.get_element(),{"font-size":this.name_font_size()});d&&this.rerender();l&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_name",argument_1:a,toString:"change the name of the "+this.get_type_name()+' to "'+c+'"',button_selector:".toontalk-name-input"});return!0});this.has_name_font_size(d)},has_name_font_size:function(d){d.get_name_width||
(d.get_name_width=function(b){return.5*(b||this.get_width())});d.get_name_height||(d.get_name_height=function(b){return.5*(b||this.get_height())});d.name_font_size||(d.name_font_size=function(c,a){return b.UTILITIES.font_size(this.get_name(),this.get_name_width(c),{height:this.get_name_height(a)})})},has_listeners:function(d){var c={};d.add_listener||(d.add_listener=function(a,b){var d=c[a];d?0>d.indexOf(b)&&d.push(b):c[a]=[b]});d.remove_listener||(d.remove_listener=function(a,d,l){if(a=c[a])if(d=
a.indexOf(d),0<=d){a.splice(d,1);return}!l&&b.debugging&&console.log("Listener of type "+type_name+" could not be removed.")});d.get_listeners||(d.get_listeners=function(a){return c[a]})},add_speech_listeners:function(d){b.listen&&(d.widget=this,this.add_listener("picked up",function(){b.UTILITIES.listen_for_speech(d)}),this.add_listener("dropped",function(){b.UTILITIES.stop_listening_for_speech()}))},get_full_description:function(b){var c;if(this.get_erased&&this.get_erased())return b&&"conditions"===
b.role?"any "+this.get_type_name():"erased "+this.get_type_name();c=this.get_description(b);b=this.toString(b);return c?b+" ("+c+")":b},remove:function(b){var c=this.get_backside(),a=this.get_frontside(),k=this.get_parent_of_frontside();b||(b={});c&&(b.remove_backside||this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level())&&c.hide_backside();a&&!b.do_not_remove_frontside&&a.remove();k&&this.remove_from_parent_of_frontside(b.event);this.get_running()&&this.set_running(!1);this.set_visible(!1);
this.walk_children&&!b.do_not_remove_children&&this.walk_children(function(a){a.remove&&a.remove();return!0})},get_frontside_element:g,get_element:g,get_backside_element:function(b){if(b=this.get_backside&&this.get_backside(b))return b.get_element()},add_to_json:function(d,c){var a,k,l,e,f,g;if(d){d.view?(k=d,a=d.view,d=d.semantic):(a={},k={semantic:d,view:a});k.version=1;this.get_erased&&this.get_erased()&&(d.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(d.infinite_stack=!0);this.get_open_backside_only_if_stopped&&
this.get_open_backside_only_if_stopped()&&(d.open_backside_only_if_stopped=!0);this.get_running&&this.get_running()&&(d.running=!0);f=this.get_parent_widget_of_frontside();if(!f||this.parent_of_frontside_is_backside()||f.is_element())if(e=this.get_frontside_element&&this.get_frontside_element())if(g=$(e).width(),$(e).is(".toontalk-plain-text-element")||0===g||(a.frontside_width=$(e).width(),a.frontside_height=$(e).height()),0!==g&&(a.frontside_left=b.UTILITIES.get_style_numeric_property(e,"left"),
a.frontside_top=b.UTILITIES.get_style_numeric_property(e,"top")||l&&l.frontside_top,void 0===a.frontside_left&&(l=f&&f.get_widget().get_backside_widgets_json_views())))e=this.get_parent_of_frontside().get_widget().get_backside_widgets().indexOf(this),0<=e&&l[e]&&(a.frontside_left=l[e].frontside_left,a.frontside_top=l[e].frontside_top);if(e=this.get_backside()){if(f=e.get_element()){if(e.get_backside_dimensions()||e.is_top_level())a.backside_width=$(f).width(),a.backside_height=$(f).height();a.backside_left||
(l=$(f).position(),a.backside_left=l.left,a.backside_top=l.top,"&lt;"===$(f).find(".toontalk-settings-backside-button").html()&&(a.advanced_settings_open=!0))}e.get_backside_dimensions()&&(a.backside_geometry=e.get_backside_dimensions())}!a.backside_geometry&&this.backside_geometry&&(a.backside_geometry=this.backside_geometry);void 0===a.frontside_left&&this.json_view&&(a.frontside_left=this.json_view.frontside_left,a.frontside_top=this.json_view.frontside_top);d.description=this.get_description&&
this.get_description();a.saved_width=this.saved_width;a.saved_height=this.saved_height;return k}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(d,c,a,k){var l=this.get_backside_widgets(),e,f;0<l.length?(d.semantic.backside_widgets=[],(e=this.get_backside_widgets_json_views())&&e.forEach(function(a,b){var k;if(f=d.semantic.backside_widgets[b]){if(0<=f.widget.shared_widget_index){k=c.widgets_encountered.indexOf(c.shared_widgets[f.widget.shared_widget_index]);if(!c.json_of_widgets_encountered[k])return;
k=c.json_of_widgets_encountered[k].view}else k=f.widget.view;f.is_backside?a.backside_left&&(k.backside_left=a.backside_left,k.backside_top=a.backside_top):a.frontside_left&&(k.frontside_left=a.frontside_left,k.frontside_top=a.frontside_top)}else l[b].json_view=e[b]}),b.UTILITIES.get_json_of_array(l,d.semantic.backside_widgets,0,c,a,k)):a()},has_backside_widgets:function(d){var c=[];d.get_backside_widgets=function(){return c};d.add_backside_widget=function(a){var d;if(a){d=this.get_backside(!0);if(b.debugging){if(a===
this){b.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");return}if(a.get_widget()===this){b.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}c?0>c.indexOf(a)&&c.push(a):c=[a];b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Added "+a+" to backside widgets of "+this+". Number of backside widgets is "+c.length);a.is_backside()?a.set_parent_of_backside(d,!0):a.set_parent_of_frontside(this,
!0);d.visible()&&a.set_visible(!0)}else b.debugging&&b.UTILITIES.report_internal_error("adding undefined to backside widgets.")};d.remove_all_backside_widgets=function(){c&&b.UTILITIES.for_each_batch(c.slice(),function(a){a.remove()})};d.remove_backside_widget=function(a,d){var l=c.indexOf(a);0>l?d||b.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+a.get_widget()+" ("+a.get_widget()._debug_id+")"):(c.splice(l,1),b.logging&&0<=b.logging.indexOf("backside-widgets")&&
console.log("Removed "+a+" from backside widgets of "+this+". Number of backside widgets is "+c.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(l,1),a.is_backside()?(l=a.get_parent())&&l.get_widget()===this&&a.set_parent_of_backside(void 0,!0,!0):(l=a.get_parent_of_frontside())&&l.get_widget()===this&&a.set_parent_of_frontside(void 0,void 0,!0),a.set_visible(!1))};d.set_backside_widgets=function(a,d){var l=this.get_backside(),e=l&&l.visible();c=a;b.logging&&0<=b.logging.indexOf("backside-widgets")&&
console.log("Set backside widgets "+c.length+" widgets of "+(e?"visible ":"invisible ")+this);0<c.length&&(l?l.add_backside_widgets(c,d):this.backside_widgets_json_views=d,b.UTILITIES.for_each_batch(c,function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),e&&a.set_visible(e))}.bind(this)))}},get_backside_widgets_json_views:function(b){!this.backside_widgets_json_views&&b&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var b=
!1,c;this.get_backside_widgets().some(function(a){if(!a)return!1;c=a.get_widget();if(c.get_body&&!c.get_body().is_empty()||c.can_run())return b=!0});this.walk_children&&this.walk_children(function(a){if(a.can_run())b=!0;else return!0});return b},add_to_copy:function(d,c){var a;this.get_erased&&this.get_erased()&&(d.set_erased||b.widget.erasable(d),d.set_erased(this.get_erased()));c&&c.just_value||(a=this.get_backside_widgets(),0<a.length&&d.set_backside_widgets(b.UTILITIES.copy_widget_sides(a,c),
this.get_backside_widgets_json_views()));d.set_running(this.get_running());return d},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(d,c,a){var k=this.visible(),l,e,f,g,p;d||(d=this.copy({}));l=this.get_frontside_element(k);e=d.get_element(k);f=$(l).closest(".toontalk-backside");g=d.ok_to_set_dimensions();0===f.length&&(f=$(this.top_level_widget().get_backside_element()));p=b.UTILITIES.widget_side_of_jquery(f);k&&("undefined"===
typeof c&&(c=30),"undefined"===typeof a&&(a=30),k=b.UTILITIES.relative_position(l,f.get(0)),0<f.length&&f.get(0).appendChild(e),b.UTILITIES.set_css(e,{width:g?$(l).width():"",height:g?$(l).height():"",left:k.left+c,top:k.top+a,"z-index":b.UTILITIES.next_z_index()}));p&&p.add_backside_widget(d);return d},visible:function(){var b;return document.hidden?!1:(b=this.get_frontside())?b.visible():!1},set_visible:function(b){var c=this.get_frontside(b);c&&c.set_visible(b)},is_backside:function(){return!1},
get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(b){this.set_parent_of_frontside(b)},drag_started:function(b,c){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,c)},match:function(b){console.assert(!1,"match not implemented for "+b.toString())},removed:function(d){b.UTILITIES.report_internal_error("removed not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(d,c){var a=this.get_backside(),k,
l,e,f,g,p,m,u,r,n,h;if(a&&b.UTILITIES.visible_element(a.get_element()))$(a.get_element()).css({opacity:1}),d&&d();else{k=d&&function(){setTimeout(d)};l=function(a,d){b.UTILITIES.set_timeout(function(){$(a).addClass("toontalk-side-appearing");b.UTILITIES.add_one_shot_event_handler(a,"transitionend",c||2500,function(){$(a).removeClass("toontalk-side-appearing");k&&k()});$(a).css({left:m,top:u,opacity:d});this.apply_backside_geometry()}.bind(this))}.bind(this);f=this.get_frontside_element(!0);g=$(f).parent();
for(a=$(f);0<g.length&&!g.is(".toontalk-backside");)a=g,g=g.parent();a.get(0);a=this.get_backside(!0);e=a.get_element();e.toontalk_widget_side=a;r=$(f).offset();n=g.offset();h=g.width();n||(n={left:0,top:0});$(e).css({left:r.left-n.left,top:r.top-n.top,opacity:.01});0<g.length?g.get(0).appendChild(e):($(e).css({textAlign:"left"}),f.appendChild(e));(g=b.UTILITIES.widget_side_of_jquery(g))&&g.add_backside_widget(a);g=this.is_element()?this.get_attribute("height"):$(f).height();f=$(e).width();m=r.left-
n.left;m+f>h&&(m=Math.max(0,h-f));u=r.top-n.top+g+34;this.is_box()&&(u+=28);l(e,"inherit");a.set_visible(!0);p=this.get_backside_widgets();0<p.length&&p.forEach(function(a){a.is_backside()&&0<=p.indexOf(a.get_widget())?a.hide_backside():(a.set_visible(!0),e.appendChild(a.get_element(!0)))}.bind(this));return a}},hide_backside:function(){var b=this.get_backside();b&&b.hide_backside()},apply_backside_geometry:function(){var b=this.get_backside(!0),c=b.get_element();this.backside_geometry&&c&&(b.scale_backside(c,
this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),b.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(b){this.top_level_widget().robot_started_training(b)},robot_finished_training:function(){this.top_level_widget().robot_finished_training()},
backup_all:function(b){var c=this.top_level_widget();c&&c.save(b)},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},constrained_by_container:function(){var b;return this.is_nest()||this.being_dragged?!1:(b=this.get_parent_of_frontside())&&(b.is_hole()||b.is_nest()||b.is_robot())?!0:!1},close_button_ok:function(b){return"top-level"!==this.get_type_name()&&!$(b).is(".toontalk-top-level-resource")&&
!$(b).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(b,c){var a=this.top_level_widget(),k;b||(b=this);k=b.get_element(!0);a.add_backside_widget(b);a.get_backside_element().appendChild(k);b.render();c&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,a);return k},get_selection:function(){return this},display_message:function(d,c){c||(c={});c.display_on_backside_if_possible?(c.element=this.get_backside_element(),c.second_choice_element=
this.get_frontside_element()):c.element=this.get_frontside_element();b.UTILITIES.display_message(d,c);return d},get_speak_function:function(d){return function(c,a){var k=function(k){var u,r;k?(k=k.get_widget(),u=k.get_text?k.get_text(!0):k.toString(),b.TRANSLATION_ENABLED?b.UTILITIES.translate(u,function(k){r=function(e){var f=b.element.create(k,[],"a response to speaking '"+u+"'");a.event=e;d.process_response(f,l,c,a)};b.UTILITIES.speak(k,{when_finished:r,volume:e,pitch:f,rate:g,voice_number:p})}):
(r=function(e){var f=b.element.create(u,[],"a response to speaking '"+u+"'");a.event=e;d.process_response(f,l,c,a)},b.UTILITIES.speak(u,{when_finished:r,volume:e,pitch:f,rate:g,voice_number:p}))):d.report_error("Speaking birds need something in the second box hole that they can speak.",l)},l,e,f,g,p;if(window.speechSynthesis){if(l=d.check_message(c),"string"!==typeof l)if(2>l.box_size)d.report_error("Speaking birds need a box with two or more holes.",l);else return(e=c.get_hole_contents(2))&&(e=e&&
e.to_float&&e.to_float()),(f=c.get_hole_contents(3))&&(f=f&&f.to_float&&f.to_float()),(g=c.get_hole_contents(4))&&(g=g&&g.to_float&&g.to_float()),(p=c.get_hole_contents(5))&&(p=p&&p.to_float&&p.to_float()),k(c.get_hole_contents(1)),!0}else d.report_error("This browser doesn't support speech output. Try another browser such as Chrome.",l)}},get_listen_function:function(d,c){return function(a,k){var l,e,f,g,p;window.webkitSpeechRecognition||window.SpeechRecognition||(d.report_error("A listening bird can't listen because this browser doesn't support speech input. Try another browser such as Chrome.",
l),returns);l=d.check_message(a);if("string"!==typeof l)if(1>l.box_size)d.report_error("Listening birds need a box with one or two holes.",l);else{if(g=a.get_hole_contents(1))g=g&&g.to_float&&g.to_float(),0>g?g=0:1<g&&(g=1);c||(p=a.get_hole_contents(2))&&(p=p.get_text());e=c?function(c){c=parseFloat(c);isNaN(c)||(c=b.number.create_from_bigrat(bigrat.fromDecimal(c)),c.set_description("a number that was heard"),d.process_response(c,l,a,k),b.UTILITIES.stop_listening_for_speech())}:function(c){c=b.element.create(c,
[],"what was spoken");d.process_response(c,l,a,k);b.UTILITIES.stop_listening_for_speech()};f=function(a){d.report_error(a.error,l);b.UTILITIES.stop_listening_for_speech()};b.UTILITIES.listen_for_speech({commands:p,minimum_confidence:g,numbers_acceptable:c,success_callback:e,fail_callback:f});return!0}}},get_description_function:function(d){return function(c,a){var k=function(e){var f,k;k=function(f){f=b.element.create(f,[],e.toString());d.process_response(f,l,c,a)};e=e.get_widget();f=e.get_text?e.get_text(!0):
e.toString();b.TRANSLATION_ENABLED?b.UTILITIES.translate(f,function(a){k(a)}):k(f)},l=d.check_message(c);if("string"!==typeof l)if(1>l.box_size)d.report_error("Listening birds need a box with two holes.",l);else return k(c.get_hole_contents(1)),!0}},create_top_level_widget:function(d){var c=Object.create(b.widget),a=[],k=function(){return!1},l=!1;d||(d={});c.is_top_level=function(){return!0};c.is_number=k;c.is_box=k;c.is_empty_hole=k;c.is_scale=k;c.is_bird=k;c.is_nest=k;c.is_robot=k;c.is_element=
k;c.is_sensor=k;c.is_function_nest=k;c.is_hole=k;c.is_plain_text_element=k;c.is_attribute_widget=k;c.ok_to_set_dimensions=k;c.get_json=function(a,b,c){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");b({semantic:{type:"top_level",settings:d},view:{background_color:a}},c)};c.get_type_name=function(){return"top-level"};c.is_of_type=function(a){return"top-level"===a};c.toString=function(){return"top level widget"};c.get_description=
function(){};c.match=function(){return"matched"};c.update_display=function(){this.get_backside_widgets()&&b.UTILITIES.for_each_batch(this.get_backside_widgets().filter(function(a){return a&&a.visible()}),function(a){a.render()})};c.copy=function(){return this};c.visible=function(){return!document.hidden};c.get_parent_of_frontside=function(){};c.get_parent_of_backside=function(){};c.closest_visible_ancestor=function(){return this};c.get_infinite_stack=function(){return!1};c.get_listeners=function(){return[]};
c.top_level_widget=function(){return this};if(b.debugging||b.logging)c.to_debug_string=function(a){var b=$(this.get_backside_element()).offset();return("top-level widget at "+Math.round(b.left)+", "+Math.round(b.top)).substring(0,a)};c.add_sides_functionality(c);c.runnable(c);c.has_parent(c);c.has_backside_widgets(c);c.removed_from_container=function(a,b){this.robot_in_training()||this.remove_backside_widget(a,!0)};c.widget_side_dropped_on_me=function(a,b){return this.get_backside().widget_side_dropped_on_me(a,
b)};c.get_element=function(){return this.get_backside().get_element()};c.get_setting=function(a,c){"undefined"!==typeof d[a]||c||(d[a]=b.DEFAULT_SETTINGS&&b.DEFAULT_SETTINGS[a]);return d[a]};c.set_setting=function(a,b){d[a]=b};c.open_settings=function(){b.SETTINGS.open(c)};c.robot_in_training=function(){if(0<a.length)return a[a.length-1]};c.robot_training_this_robot=function(){if(1<a.length)return a[a.length-2]};c.robot_started_training=function(b){a.push(b)};c.robot_finished_training=function(){a.pop()};
c.save=function(a,c,d){var k=this.get_setting("program_name",b.reset),g=function(a){l=!1;u&&(r=b.google_drive.get_status(),"Ready"===r?(b.google_drive.upload_file(k,"json",JSON.stringify(a,b.UTILITIES.clean_JSON),d),d=void 0):b.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===r?(b.UTILITIES.display_message("Unable to save to your Google Drive because you need to log in. Click on the settings icon <span class='toontalk-settings-icon'></span> to log in.",{only_if_new:!0}),
b.UTILITIES.display_tooltip($(".toontalk-settings-button"))):console.log("Unable to save to Google Drive because: "+r)));c.local_storage&&this.save_to_local_storage(a);d&&d()}.bind(this),u,r;!l&&k&&(c||(c={}),"undefined"===typeof c.google_drive&&(c.google_drive=b.google_drive&&this.get_setting("save_to_google_drive")&&this.get_setting("auto_save_to_cloud")),"undefined"===typeof c.local_storage&&(c.local_storage=this.get_setting("auto_save_to_local_storage")),a?(u=c.google_drive&&!this.get_setting("google_drive_unavailable"))||
c.local_storage?(l=!0,b.UTILITIES.get_json_top_level(this,g)):d&&d():setTimeout(function(){this.save(!0,c,d)}.bind(this),100))};c.publish=function(a,c){b.publish.publish_widget(this.get_setting("program_name"),this,c,a)};c.save_to_local_storage=function(a,c){var d=this.get_setting("program_name"),k=b.UTILITIES.local_storage_program_key(d),l=b.UTILITIES.local_storage_program_meta_data_key(d),g=function(n){r=JSON.stringify(a,b.UTILITIES.clean_json);n||(n={created:c});n.last_modified=c;n.file_size=r.length;
b.UTILITIES.store_object(l,n);b.UTILITIES.store_string(k,r);b.UTILITIES.store_string("toontalk-last-key",k);b.UTILITIES.get_all_locally_stored_program_names(function(a){0>a.indexOf(d)&&(a.push(d),b.UTILITIES.set_all_locally_stored_program_names(a))})},r;c||(c=Date.now());try{b.UTILITIES.retrieve_object(l,g)}catch(n){g=r?"Failed to save state to local storage since it requires "+r.length+" bytes. Error message is "+n:"Error while saving to local storage. Error message is "+n,b.UTILITIES.is_internet_explorer()?
console.error("Unresolved difficulties using window.localStorage in IE11: "+g):b.UTILITIES.display_message(g),this.last_local_storage_error=g}};c.load=function(a,c,d){var k=this.get_setting("program_name"),l=k+".json",g=b.UTILITIES.local_storage_program_key(k),r=this.download_callback(c,d);c=function(a){a?b.google_drive.download_file(a,r):b.UTILITIES.retrieve_string(g,r)};a&&b.google_drive&&"Ready"===b.google_drive.get_status()?b.google_drive.get_toontalk_program_file(l,c):b.UTILITIES.retrieve_string(g,
r)};c.download_callback=function(a,c){return function(d){var k;if(d)try{k=JSON.parse(d),this.remove_all_backside_widgets(),b.UTILITIES.add_backside_widgets_from_json(this,k.semantic.backside_widgets,{json_of_shared_widgets:k.shared_widgets,shared_widgets:[],shared_html:k.shared_html}),a&&a()}catch(l){b.UTILITIES.display_message("Error encountered loading : "+l)}else c&&c()}.bind(this)};c.walk_children=function(){};c.render=function(){};c.constrained_by_container=function(){return!1};c.dereference=
function(){return this};c.is_widget=!0;b.debugging&&(c._debug_id=b.UTILITIES.generate_unique_id(),c._debug_string="Top-level widget");c.get_backside(!0).set_visible(!0);return c}}}(window.TOONTALK);window.TOONTALK.backside=function(b){var g=function(d){var c=d.get_widget(),a=c.get_backside_widgets(),k=c.get_backside_widgets_json_views(!0);d.get_backside_dimensions();var l=d.get_element();b.UTILITIES.for_each_batch(a,function(a,c){var d=a.get_element(),p;d&&(k[c]||(k[c]={}),a.start_offset&&d.parentElement?(p=b.UTILITIES.relative_position_from_absolute_position(d.parentElement,a.start_offset),a.start_offset=void 0):p=$(d).position(),a.is_backside()?(k[c].backside_left=b.UTILITIES.left_as_percent(p.left,
d),k[c].backside_top=b.UTILITIES.top_as_percent(p.top,d),g(a)):(k[c].frontside_left=b.UTILITIES.left_as_percent(p.left,d,l),k[c].frontside_top=b.UTILITIES.top_as_percent(p.top,d,l)))})};return{create:function(d){var c=Object.create(this),a=document.createElement("div"),k=$(a),l=1,e=1,f=document.createElement("div"),g=document.createElement("div"),p=d.get_help_URL&&d.get_help_URL(),m=function(a){a?($(f).addClass("toontalk-green-flag-active toontalk-button").removeClass("toontalk-green-flag-inactive toontalk-button"),
$(g).addClass("toontalk-stop-sign-inactive toontalk-button").removeClass("toontalk-stop-sign-active toontalk-button")):($(f).addClass("toontalk-green-flag-inactive toontalk-button").removeClass("toontalk-green-flag-active toontalk-button"),$(g).addClass("toontalk-stop-sign-active toontalk-button").removeClass("toontalk-stop-sign-inactive toontalk-button"))},u=this.create_description_label(c,d),r=function(){var a;a=d.get_running()?"To stop this click on the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):
d.can_run()?"Click this to start this running.":"There is nothing to run on this.";b.UTILITIES.give_tooltip(f,a)},n=function(){var a;a=d.get_running()?"Click to stop this from running.":d.can_run()?"This has stopped. Click on the flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";b.UTILITIES.give_tooltip(g,a)},h=function(a){U?(b.UTILITIES.add_iframe_popup(p),a.stopPropagation()):(B.href=p,B.target="_blank")},
C=!1,x,y,K,z,L,E,A,M,F,w,B,I,O,H,Q,U,W;b.TRANSLATION_ENABLED&&p&&(p=b.UTILITIES.add_URL_parameter(p,"translate","1"));d.close_button_ok(a)&&(O=function(e){var f=function(){d.robot_in_training()&&d.robot_in_training()!==d&&d.robot_in_training().backside_closed(c);c.is_primary_backside()?c.hide_backside(e):c.remove()},h,l;d.get_running()?(h=d.get_backside_widgets(),h.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(f),l=a,!0}),l?(l.add_body_finished_listener(function(){l.visible()?
k.css({opacity:1}):(d.forget_backside(),b.DEFAULT_QUEUE.start());f()}),c.set_visible(!1)):f(),k.css({opacity:1}),k.addClass("toontalk-animating-element"),k.css({opacity:0}),b.UTILITIES.add_one_shot_event_handler(a,"transitionend",2E3,function(){d.forget_backside()})):f();e.stopPropagation()},I=(I=d.get_description())?"the "+d.get_type_name()+" who "+I:"the "+d.get_type_name(),w=b.UTILITIES.create_close_button(O,"Click to remove this backside of "+I+"."),a.appendChild(w));$(f).addClass("toontalk-green-flag toontalk-green-flag-inactive");
f.addEventListener("click",function(a){d.can_run()?(m(!0),d.set_running(!0),n(),b.DEFAULT_QUEUE.start()):d.is_top_level()?b.UTILITIES.display_message("There is nothing to run.",{element:a.target}):b.UTILITIES.display_message("This "+d.get_type_name()+" has nothing to run. Add some robots on the back.",{element:a.target});d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-green-flag",d);a.stopPropagation()});f.addEventListener("mouseenter",n);$(g).addClass("toontalk-stop-sign toontalk-stop-sign-active");
g.addEventListener("click",function(a){m(!1);d.set_running(!1);r();d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-stop-sign",d);a.stopPropagation();d.is_top_level()&&b.UTILITIES.stop_audio_objects()});g.addEventListener("mouseenter",r);a.appendChild(f);a.appendChild(g);b.UTILITIES.use_custom_tooltip(f);b.UTILITIES.use_custom_tooltip(g);p&&(U=0>p.indexOf("://"),B=document.createElement(U?"div":"a"),$(B).addClass("toontalk-help-button notranslate toontalk-widget-help-button"),
B.addEventListener("click",h),B.innerHTML="i",B.translate=!1,b.UTILITIES.give_tooltip(B,"Click to learn more about "+d.get_type_name(!0,!0)+"."),a.appendChild(B));u&&a.appendChild(u);d.is_top_level()&&(z=document.createElement("div"),$(z).addClass("toontalk-settings-button"),z.addEventListener("click",function(a){d.open_settings();a.stopPropagation()}),a.appendChild(z),b.UTILITIES.give_tooltip(z,"Click to change settings or open a different program."));k.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+
d.get_type_name());k.css({"z-index":b.UTILITIES.next_z_index()});b.UTILITIES.when_attached(a,function(){var e;c.inside_conditions_container()?($(f).hide(),$(g).hide(),$(B).hide(),$(w).hide(),e="This will match "+c.toString()+".",c.rerender()):d.is_robot()?e="On the back of the robot you can change the conditions and setting of the robot.":d.is_top_level()?e="This is a work area where you can drag things.":(W=d.toString({inside_tool_tip:!0}),e="You are pointing to the back of "+b.UTILITIES.add_a_or_an(W)+
" You can put robots on the back to make it come 'alive'.");b.UTILITIES.give_tooltip(a,e)});c.get_element=function(){return a};c.get_backside_element=function(){return a};c.get_widget=function(){return d};c.visible=function(){return document.hidden?!1:L};c.set_visible=function(a){L=a;!d.is_top_level()&&this.is_primary_backside()&&(this.get_widget().get_backside_widgets().forEach(function(b){b&&b!==this&&b.set_visible(a)}.bind(this)),L&&this.render())};c.get_erased=function(){return x};c.set_erased=
function(a,b,c){if(!a||c||this.inside_conditions_container())x=a,b&&this.rerender()};d.get_backside||(d.get_backside=function(){return c});c.is_primary_backside=function(){return this===this.get_widget().get_backside()};c.inside_conditions_container=function(){return $(this.get_element()).closest(".toontalk-conditions-panel, .toontalk-conditions-container").is("*")};c.get_width=function(){return b.UTILITIES.get_element_width(this.get_element())};c.get_height=function(){return b.UTILITIES.get_element_height(this.get_element())};
c.is_widget=!0;c.get_parent_of_backside=function(){return this.is_primary_backside()?d.get_parent_of_backside():K&&y?y.get_backside(!0):y};c.set_parent_of_backside=function(a,b){!a&&y&&K&&y.remove_backside_widget(this,!0);this.is_primary_backside()&&d.set_parent_of_backside(a,b);y=a;K=b};c.get_parent_of_frontside=function(){return d.get_parent_of_frontside()};c.is_parent_backside=function(){return d.is_parent_backside()};c.get_frontside=function(a){return d.get_frontside(a)};c.get_frontside_element=
function(a){return d.get_frontside_element(a)};c.get_description_text_area=function(){return H};c.set_description_text_area=function(a){H=a};c.get_name_text_input=function(){return Q};c.set_name_text_input=function(a){Q=a};c.removed_from_container=function(a,b,d,e){c.get_widget().robot_in_training()||this.remove_backside_widget(a,e)};c.drop_on=function(a,b){return a.widget_side_dropped_on_me&&a.widget_side_dropped_on_me(this,b)};c.widget_side_dropped_on_me=function(c,e){var f,h,k;if(e.robot&&e.robot.visible()&&
!this.visible())this.add_backside_widget(c),c.dropped_on_other&&c.dropped_on_other(this,e);else return this.visible()&&(b.sounds&&e.event&&b.sounds.drop.play(),h=c.get_element(this.visible()),c.rerender(),e.event?(a.appendChild(h),b.UTILITIES.set_position_is_absolute(h,!0,e.event)):(e.robot&&(f=$(e.robot.get_frontside_element()).offset()),f||(f=$(h).offset()),a.appendChild(h),!f||0===f.left&&0===f.top||b.UTILITIES.set_absolute_position(h,f))),this.get_widget().is_top_level()&&(e.robot&&!e.robot.visible()&&
$(h).addClass("toontalk-widget-added-to-backside-by-unwatched-robot"),!e.event||c.is_backside()||c.is_sensor()||window.dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:h,here:"back"}))),d.robot_in_training()&&!e.ignore_training&&e.event&&setTimeout(function(){d.robot_in_training().dropped_on(c,this,e.event)}.bind(this)),c.is_backside()&&c.get_widget().is_element()&&d.is_element()&&(f=c.get_widget(),f.set_backside(void 0),f.remove(e.event),f.set_backside(c)),this.add_backside_widget(c),
c.dropped_on_other&&c.dropped_on_other(this,e),e.event&&c.get_body&&c.get_body().is_empty()&&!c.being_trained?setTimeout(function(){(k=c.open_backside())&&$(k.get_element()).find(".toontalk-train-backside-button").click()}):event&&!c.is_backside()&&this.get_frontside_element()&&!c.is_sensor()&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:h,where:"back"})),e.event&&c.get_widget().backup_all(),!c.is_backside()&&c.is_robot()&&this.get_widget().get_running()&&
!this.is_top_level()&&this.get_widget().set_running(!0),!0};c.add_backside_widget=function(a){return this.get_widget().add_backside_widget(a)};c.add_backside_widgets=function(a,c){var e;0!==a.length&&(b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Adding "+a.length+" backside widgets to "+this),e=a.slice(),b.UTILITIES.set_timeout(function(){var f=this.visible(),h=this.get_element(),k,q,l,n;b.UTILITIES.for_each_batch(e,function(e,g){e&&(b.debugging&&e.get_widget()===d?(b.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),
a.splice(g,1)):(c&&(l=c[g]),k=e.get_element(!0),k.parentElement||(h.appendChild(k),b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Widget element added to backside element.")),k.toontalk_widget_side=e,l&&(e.is_backside()?(q=e.get_widget().get_backside(!0),n={left:l.backside_left,top:l.backside_top,width:l.backside_width,height:l.backside_height},e.get_widget().apply_backside_geometry(),l.advanced_settings_open&&q.set_advanced_settings_showing(!0,q.get_element())):(0===l.frontside_width&&
(l.frontside_width=""),0===l.frontside_height&&(l.frontside_height=""),n={left:l.frontside_left,top:l.frontside_top,width:k.style.transform?"":l.frontside_width||l.saved_width,height:k.style.transform?"":l.frontside_height||l.saved_height}),b.UTILITIES.constrain_css_to_fit_inside(h,n),$(k).css(n)),e.set_visible(f),e.get_widget().rerender()))})}.bind(this),100))};c.get_backside_dimensions=function(){if(1!==l||1!==e)return{x_scale:l,y_scale:e,original_width:E,original_height:A}};c.set_dimensions=function(a){l=
a.x_scale;e=a.y_scale;a.original_width&&(E=a.original_width);a.original_height&&(A=a.original_height)};c.scale_to_fit=function(a,c){var d=b.UTILITIES.scale_to_fit(a,c,550,200);l=d.x_scale;e=d.y_scale};c.scale_to=function(a,c){var d=b.UTILITIES.scale_element(this.get_element(!0),a,c,550,200);l=d.x_scale;e=d.y_scale};c.get_original_width=function(){return E};c.get_original_height=function(){return A};c.get_advanced_settings_showing=function(){return C};c.set_advanced_settings_showing=function(a){var c=
this.get_element(),d=$(c).children(".toontalk-settings-backside-button"),e=$(c).children(".toontalk-advanced-settings-table");0===e.length&&this.add_advanced_settings&&(this.add_advanced_settings(),e=$(c).children(".toontalk-advanced-settings-table"));(C=a)?(e.show(),d.html("<"),b.UTILITIES.give_tooltip(d.get(0),"Click to hide the advanced settings."),$(c).find(".toontalk-side").not(".toontalk-element-attribute").not(".toontalk-conditions-contents").hide(),c.saved_width=c.style.width,c.saved_height=
c.style.height,$(c).css({width:"",height:""})):(e.hide(),d.html(">"),b.UTILITIES.give_tooltip(d.get(0),"Click to show the advanced settings."),$(c).find(".toontalk-side").not(".toontalk-element-attribute").not(".toontalk-conditions-contents").show(),$(c).css({width:c.saved_width,height:c.saved_height}))};c.run_status_changed=function(a){m(a)};b.UTILITIES.when_attached(w||a,function(){var c,d,e,h;b.UTILITIES.get_element_width(a);b.UTILITIES.get_element_height(a);c=$(g).width();d=(d=$(w).width())?d+
14:0;$(g).css({right:d});$(f).css({right:d+c+6});e=$(f).width();B&&($(B).css({right:d+c+e+12}),b.UTILITIES.use_custom_tooltip(B));z&&(h=$(B).width()||0,$(z).css({right:d+c+e+h+12}));w&&b.UTILITIES.use_custom_tooltip(w)});c.save_dimensions=function(){M=l;F=e;return!0};c.restore_dimensions=function(){this.get_element();M&&(l=M);F&&(e=F);this.render_current_scale()};c.render_current_scale=function(){this.scale_backside(a,l,e,E,A);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();
$(a).find("[title]").each(function(a,c){b.UTILITIES.use_custom_tooltip(c)})};c.compare_with=function(a){return this.get_widget().compare_with&&this.get_widget().compare_with(a)};if(b.debugging||b.logging)c.to_debug_string=function(a){return("backside of "+this.get_widget().to_debug_string()).substring(0,a)};a.toontalk_widget_side=c;b.UTILITIES.drag_and_drop(a);b.UTILITIES.resizable_and_scalable(a,function(a,b){c.get_advanced_settings_showing()||(c.set_dimensions({x_scale:a,y_scale:b}),c.render_current_scale())},
E,A);a.addEventListener("mouseenter",function(a){a=d.get_frontside();var c=d.get_parent_of_backside();!a||c&&!c.get_widget().is_top_level()||b.UTILITIES.highlight_element(a.get_element())});a.addEventListener("mouseleave",function(a){d.is_top_level()||b.UTILITIES.remove_highlight()});c.update_display=function(d){var e=this.get_description_text_area(),f=this.get_name_text_input(),h=a.getBoundingClientRect(),k;e&&(k=this.get_widget().get_description())&&(e.button.value=k);f&&(f.button.value=this.get_widget().get_name());
this.get_erased()?$(a).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():$(a).find().show();d&&b.UTILITIES.for_each_batch(this.get_widget().get_backside_widgets().filter(function(a){return!a.get_frontside()}),function(c){var d=c.get_element(!0);c.set_visible(!0);b.UTILITIES.set_css(d,{left:(h.width-50)*Math.random(),top:(h.height-50)*Math.random()});a.appendChild(d);c.update_display()});c.display_updated()};c.display_updated=
function(){$(this.get_element());E||(E=b.UTILITIES.get_element_width(a));A||(A=b.UTILITIES.get_element_height(a))};c.add_to_top_level_backside=function(a,b){return this.get_widget().add_to_top_level_backside(a,b)};d.get_backside_widgets&&(u=d.get_backside_widgets(),c.add_backside_widgets(u,d.get_backside_widgets_json_views()));b.debugging&&(a.id=d._debug_id,c._debug_id=d._debug_id,c._debug_string="backside of "+d._debug_string);return c},toString:function(){return this.get_erased()?"any backside":
"backside of "+this.get_widget()},get_full_description:function(b){return this.get_erased()?"any backside":"backside of "+this.get_widget().get_full_description(b)},remove_element:function(){$(this.get_element()).remove()},create_infinite_stack_check_box:function(d,c){var a=b.UTILITIES.create_check_box(c.get_infinite_stack(),"toontalk-infinite-stack-check-box","Copy when dragged.","Check this if you want the "+c.get_type_name()+" to be copied instead of moved."),k=function(a){var b=!c.get_infinite_stack(),
d;c.set_infinite_stack(b);c.robot_in_training()&&(d=b?"change dragging to make a copy of ":"change dragging back to moving for ",c.robot_in_training().edited(c,{setter_name:"set_infinite_stack",argument_1:b,toString:d,button_selector:".toontalk-infinite-stack-check-box"}));a.stopPropagation()};a.button.addEventListener("click",k);a.button.addEventListener("touchstart",k);return a},create_parent_selection_check_box:function(d,c){var a=function(){var a=c.get_parent();if(a&&(a.is_nest()||a.is_hole()||
a.is_element()))return a.is_hole()?a.get_parent_of_frontside():a},k=a(),l=function(a){return"Drag the "+a.get_type_name()+" I'm on when dragging"},e=function(a){return"Check this if you want to drag the "+a.get_type_name()+" when you move this widget."},f,g;if(k){f=b.UTILITIES.create_check_box(c.get_infinite_stack(),"toontalk-parent-selection-check-box",l(k),e(k));var p=function(b){var c=a();c?(c!==b&&m(c),f.button.disabled=!1,$(f.label).removeClass("ui-state-disabled"),f.container.title=e(c)):r()},
m=function(a){f.label.innerHTML=l(a);f.button.innerHTML=e(a)},u=function(){p();return c},r=function(){f.button.checked=!1;f.button.disabled=!0;$(f.label).addClass("ui-state-disabled");f.container.title="Widget moved so this has been disabled. Close and re-open the backside to refresh."};g=function(b){var d=a();a()?(d!==k&&m(d),c.get_selection=f.button.checked?function(){var b=a();p();return b?b.get_selection():c}:u,b.stopPropagation()):r()};f.button.checked=c!==c.get_selection();f.button.checked||
(c.get_selection=u);f.button.addEventListener("click",g);return f}},create_click_opens_backside_check_box:function(d,c){var a=b.UTILITIES.create_check_box(c.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box","Mouse click opens this backside only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors."),k=function(b){var d=!c.get_open_backside_only_if_stopped(),f;c.set_open_backside_only_if_stopped(d);
a.button.checked=d;c.robot_in_training()&&(f=d?"change the response to a mouse click to open only if stopped the backside of ":"change the response to a mouse click to always open the backside of ",c.robot_in_training().edited(c,{setter_name:"set_open_backside_only_if_stopped",argument_1:d,toString:f,button_selector:".toontalk-click-opens-backside-check-box"}));b.stopPropagation()};a.button.addEventListener("click",k);a.button.addEventListener("touchstart",k);return a},create_description_label:function(d,
c){var a=c.get_description();if(a)return b.UTILITIES.create_text_element("I'm the backside of a "+c.get_type_name()+" that is "+a)},add_description_setting:function(d){var c=this.get_widget(),a=c.get_type_name(),k=b.UTILITIES.create_text_area(c.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+a+".",function(a){(a=b.UTILITIES.input_area_drop_handler(a,c.receive_description_from_dropped.bind(c),c))&&c.robot_in_training()&&c.robot_in_training().dropped_on_text_area(a,
c,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})}),a=function(){var a=k.button.value.trim();c.set_description(a,!0,!0)};$(k.button).val(c.get_description());k.button.addEventListener("change",a);k.button.addEventListener("mouseout",a);this.set_description_text_area(k);(d||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(k.container));c.get_description()||k.button.setAttribute("placeholder",c.get_default_description())},
add_name_setting:function(d){var c=this.get_widget(),a=c.get_type_name(),k=b.UTILITIES.create_text_input(c.get_name(),"toontalk-name-input",c.get_name_input_label?c.get_name_input_label():"My name is ",c.get_name_input_title?c.get_name_input_title():"Edit the name of this "+a+". There is not much room so keep it short.",void 0,"text",function(a){(a=c.receive_name_from_dropped&&b.UTILITIES.input_area_drop_handler(a,c.receive_name_from_dropped.bind(c),c))&&c.robot_in_training()&&c.robot_in_training().dropped_on_text_area(a,
c,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})}),a=function(){c.set_name&&c.set_name(k.button.value.trim(),!0,!0)};k.button.addEventListener("change",a);k.button.addEventListener("mouseout",a);this.set_name_text_input(k);(d||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(k.container))},add_advanced_settings:function(){var d=this.get_widget(),c=this.create_infinite_stack_check_box(this,d),a=this.create_parent_selection_check_box(this,
d),k=this.create_click_opens_backside_check_box(this,d),l=d.get_type_name(),e=$("<button>Make a sensor nest</button>").button(),f=$("<button>Make a function bird</button>").button(),g=document.createElement("table"),p=this.get_element(),m=function(a,c){var e=a.get_frontside_element(!0),f;d.add_to_top_level_backside(a,!1);f=c.offset();f.left-=120;0>f.left&&(f.left=0);b.UTILITIES.set_absolute_position(e,f)};$(p).find(".toontalk-settings-backside-button").get(0);var u;$(g).addClass("toontalk-advanced-settings-table");
e.addClass("toontalk-make-sensor_nest_button toontalk-button");e.get(0).addEventListener("click",function(a){var c=b.sensor.create("click","which",void 0,void 0,!0,d);m(c,e);d.robot_in_training()&&d.robot_in_training().created_widget(c,d,".toontalk-make-sensor_nest_button");a.stopPropagation()});e.attr("title","Click to create a nest which receives messages when events happen to this "+d.get_type_name()+".");f.addClass("toontalk-make-function_bird_button toontalk-button");f.get(0).addEventListener("click",
function(a){var c=d.get_function_type&&d.get_function_type(),c=b.bird.create_function(c||l);m(c,f);d.robot_in_training()&&d.robot_in_training().created_widget(c,d,".toontalk-make-function_bird_button");a.stopPropagation()});d.is_number()||d.is_box()||d.is_element()?f.attr("title","Click to get a bird that flies to functions of "+d.get_type_name(!0)+"."):(f.attr("title","There are no functions that operate on "+d.get_type_name(!0)+" (yet)."),f.button("option","disabled",!0));if(0<arguments.length)for(u=
0;u<arguments.length;u++)g.appendChild(arguments[u]);this.get_description_text_area()||this.add_description_setting(g);d.set_name&&!this.get_name_text_input()&&this.add_name_setting(g);g.appendChild(b.UTILITIES.create_row(e.get(0),f.get(0),c.container,a&&a.container,k.container));this.is_primary_backside()||(c=$("<button>Remove me and my widget</button>").button(),c.get(0).addEventListener("click",function(){d.robot_in_training()&&(d.robot_in_training().removed(d),d.robot_in_training().removed(this));
this.remove();d.remove()}.bind(this)),c.attr("title","Click to remove this "+d.get_type_name()+" and its backside."),c.addClass("toontalk-remove-backside-and-widget-buttton"),b.UTILITIES.use_custom_tooltip(c.get(0)),g.appendChild(c.get(0)));b.UTILITIES.use_custom_tooltip(e.get(0));b.UTILITIES.use_custom_tooltip(f.get(0));p.appendChild(g)},get_type_name:function(){return"backside of "+b.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(d){var c,a,k,l,e,f,t;l=$(this.get_element());
if(0!==l.length&&(c=this.get_widget(),(a=c.robot_in_training())&&a.get_training_context()===c&&(a.hide_backside(),l.find(".toontalk-train-backside-button").click()),k=c.get_frontside_element(d&&c.get_parent_of_frontside()&&c.get_parent_of_frontside().is_top_level()),a=l.position(),e=l.parent().closest(".toontalk-backside"),f=function(a){var e=$(k).position(),f=function(){t&&(this.set_parent_of_backside(void 0,!0),t.is_backside()||t.removed_from_container(this,d,void 0,!0),c.forget_backside&&c.forget_backside());
a.remove();d&&c.backup_all()}.bind(this);b.UTILITIES.visible_element(a)?"0"===a.css("opacity")?(a.removeClass("toontalk-animating-element"),a.remove()):(a.addClass("toontalk-side-appearing"),b.UTILITIES.add_one_shot_event_handler(a.get(0),"transitionend",2500,f),b.UTILITIES.set_css(a,{left:e&&e.left,top:e&&e.top,opacity:.1})):f()}.bind(this),t=c.get_parent_of_backside(),b.UTILITIES.remove_highlight(),g(this),c.backside_geometry=this.get_backside_dimensions(),f(l),this.set_visible(!1),d&&k&&!b.UTILITIES.visible_element(k)&&
(a&&b.UTILITIES.set_css(k,{left:a.left,top:a.top}),!(l=b.UTILITIES.widget_side_of_jquery(e))||c.is_robot()&&l.get_widget().is_robot()&&c.get_first_in_team()===l.get_widget().get_first_in_team()||(l.widget_side_dropped_on_me(c,{event:d}),c.render())),b.UTILITIES.for_each_batch(c.get_backside_widgets(),function(a){a.set_visible(!1)}),c.on_backside_hidden))c.on_backside_hidden()},create_advanced_settings_button:function(d,c){var a=document.createElement("div"),k=$(a);a.innerHTML="&gt;";k.addClass("toontalk-settings-backside-button toontalk-button");
k.css({"z-index":b.UTILITIES.next_z_index()});k.get(0).addEventListener("click",function(a){d.set_advanced_settings_showing(!d.get_advanced_settings_showing(),d.get_element(),k);a.stopPropagation();c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-settings-backside-button",c)});b.UTILITIES.give_tooltip(k.get(0),"Click to see the advanced settings of this "+c.get_type_name()+".");return k.get(0)},scale_backside:function(d,c,a,k,l){var e=Math.min(1,c,a);1===c&&1===a?!this.get_parent()||
this.get_parent().is_backside()?b.UTILITIES.set_css(d,{width:k,height:l,transform:"","transform-origin":""}):b.UTILITIES.set_css(d,{width:"",height:""}):b.UTILITIES.set_css(d,{transform:"scale("+e+", "+e+")","transform-origin":"left top",width:k*c/e,height:l*a/e})},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&b.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(b,c){return this.get_widget().remove_backside_widget(b,c)},top_level_widget:function(){return this.get_widget().top_level_widget()},
robot_in_training:function(){return this.get_widget().robot_in_training()},remove:function(b){var c;this.is_primary_backside()?this.get_widget().remove():((c=this.get_parent_of_backside())&&(c.is_backside()?c.remove_backside_widget(this,!b):c.removed_from_container&&(c.is_backside()?c.remove_backside_widget(this,!0):c.removed_from_container(this,b))),this.set_parent_of_backside(void 0),(b=this.get_element())&&$(b).remove())},match:function(b){var c;if(b.is_backside()){if(this.get_erased())return"matched";
c=this.get_widget();b=c.match(b.get_widget());return b===c?this:b}b.last_match=this;return b},add_copy_to_container:function(b,c,a){return this.get_widget().add_copy_to_container(b||this.copy(),c,a)},has_ancestor:function(b){var c;return this===b?!0:(c=this.get_parent_of_backside())?c.has_ancestor(b):!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},set_parent:function(b){this.set_parent_of_backside(b)},
maintain_proportional_dimensions:function(){return!1},constrained_by_container:function(){return!1},set_running:function(){},can_run:function(){return this.get_widget().can_run()},dereference:function(){return this},is_of_type:function(b){return this.get_widget().is_of_type(b)},is_top_level:function(){return this.get_widget().is_top_level()},ok_to_set_dimensions:function(){return!1},add_listener:function(b,c){this.get_widget().add_listener(b,c)},remove_listener:function(b,c,a){this.get_widget().remove_listener(b,
c,a)},get_listeners:function(b){return this.get_widget().get_listeners(b)},is_hole:function(){return!1},is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},is_robot:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},get_infinite_stack:function(){return!1},drag_started:function(b,c){this.robot_in_training()&&
this.robot_in_training().picked_up(this,b,c)},get_json:function(d,c,a){var k=this.get_backside_dimensions(),l=$(this.get_element()).position(),e;g(this);e=k?{width:k.original_width,height:k.original_height,transform:"scale("+k.x_scale+", "+k.y_scale+")","transform-origin":"left top 0px",left:l.left,top:l.top}:l;k=function(a,b){c({type:"backside",my_widget:a,css:e,erased:this.get_erased(),view:{}},b)}.bind(this);b.UTILITIES.get_json(this.get_widget(),d,k,a)},get_selection:function(){return this}}}(window.TOONTALK);
TOONTALK.creators_from_json.backside=function(b,g){var d=TOONTALK.UTILITIES.create_from_json(b.my_widget,g).create_backside(),c=d.get_element();TOONTALK.UTILITIES.set_css(c,b.css);b.erased&&d.set_erased(b.erased,!1,!0);return d};window.TOONTALK.frontside=function(b){var g=[];return{create:function(d){var c=Object.create(this),a=document.createElement("div"),k=$(a),l=function(a){if(!($(a.target).is(".ui-resizable-handle")||"click"===a.type&&1!==a.which||d.get_open_backside_only_if_stopped()&&d.get_running())){if(k.is(".toontalk-top-level-resource")&&!a.altKey)d.set_running(!d.get_running());else{if(b.open_backside_only_if_alt_key&&!a.altKey)return;d.open_backside();d.robot_in_training()&&d.robot_in_training().backside_opened(d);
d.backup_all()}a.stopPropagation()}},e=function(a){var c=a.get_backside();a=(a.is_empty_hole()?wiget.get_parent_of_frontside():a).get_selection().get_frontside_element();a=$(a);c&&b.UTILITIES.highlight_element(c.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");a.is(".toontalk-top-level-resource")||a.addClass("toontalk-wiggle");event.stopPropagation()},f;$(a).addClass("toontalk-frontside toontalk-side");d.get_infinite_stack()&&$(a).addClass("toontalk-infinite-stack");a.toontalk_widget_side=
d;b.UTILITIES.drag_and_drop(a);c.get_element=function(){return a};c.get_widget=function(){return d};c.visible=function(){return f};c.set_visible=function(a){var c=this.get_widget();(f=a)&&b.UTILITIES.when_attached(this.get_element(!0),c.render.bind(c));c.walk_children&&c.walk_children(function(b){b.set_visible(a);return!0})};a.addEventListener("click",l);a.addEventListener("touchstart",l);a.addEventListener("mouseenter",function(a){e(d);0<=g.indexOf(d)?g=[]:g.push(d)});a.addEventListener("mouseleave",
function(a){a=d.get_backside();var c=d.is_empty_hole()?wiget.get_parent_of_frontside():d;a&&b.UTILITIES.remove_highlight();$(c.get_frontside_element()).removeClass("toontalk-wiggle");g.pop();0<g.length&&e(g[g.length-1])});b.debugging&&(a.id=d._debug_id);return c},update_display:function(){return this.get_widget().update_display()},remove:function(){var b=this.get_element();$(b).remove();b.toontalk_widget_side=null}}}(window.TOONTALK);(function(b){var g=180/Math.PI,d=Math.log(10),c=bigrat.fromInteger(10),a=bigrat.fromValues(1,2),k=bigrat.fromValues(-1,2),l=bigrat.fromInteger(360),e=bigrat.fromDecimal(2*Math.PI),f=Math.log10?Math.log10:function(a){return Math.log(a)/d},t=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},p=function(a){var c=t(a),d=b.number.ZERO(b.number.function_bird_results_default_format),e=b.number.ZERO(b.number.function_bird_results_default_format);
d.set_value(c.integer_part);e.set_value(c.fractional_part);return b.box.create(2,!0,[d,e],"The integer and fraction parts of "+a.toString().replace(",","/"))},m=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),d=t(c);return bigrat.multiply(c,d.fractional_part,b)},u=function(b){b=t(b);return bigrat.isLessThan(b.fractional_part,k)?bigrat.subtract(b.integer_part,b.integer_part,bigrat.ONE):bigrat.isLessThan(b.fractional_part,bigrat.ZERO)||bigrat.isLessThan(b.fractional_part,a)?b.integer_part:bigrat.add(b.integer_part,
b.integer_part,bigrat.ONE)},r=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},n=function(a){a=t(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(b.widget),d=function(a,b,c,d){var e="",f=100;c=50/c;b/=1+b;if(d)for(d=0;f>=c&&
d<a.length;)e=e+"<span class='toontalk-digit' style='font-size:"+f+"%'>"+a[d]+"</span>",d+=1,"-"!==a[d]&&(f*=b);else for(d=a.length-1;f>=c&&0<d;)e="<span class='toontalk-digit' style='font-size:"+f+"%'>"+a[d]+"</span>"+e,--d,"-"!==a[d]&&(f*=b);return e},e=function(a,b){return 0>a?0:Math.ceil(Math.log(.5/b)/Math.log(a/(1+a)))},k=function(a,b,c){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+
k(a,1.25*b,.8*c)+"</span>";b=b/2-1;return d(a,b,c,!0)+d(a,b,c,!1)},l=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?l(a.substring(0,a.length-1)):a},n=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},g=function(a){switch(a){case "+":return"";case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "=":return"&equals;";case "^":return"^";default:return b.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}},m=function(a){switch(a){case "+":return"toontalk-plus-radio-button";case "-":return"toontalk-minus-radio-button";case "*":return"toontalk-times-radio-button";case "/":return"toontalk-divide-radio-button";case "=":return"toontalk-set-equal-radio-button";
default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}},r=function(a){switch(a){case "decimal":return"toontalk-decimal-radio-button";case "proper_fraction":return"toontalk-proper-fraction-radio-button";case "improper_fraction":return"toontalk-improper-fraction-radio-button";case "scientific_notation":return"toontalk-scientific-notation-radio-button";default:return b.UTILITIES.report_internal_error("Unsupported number format: "+a),""}},t=function(a,b){switch(a){case "+":return"add "+
b+" to";case "-":return"subtract "+b+" from";case "*":return"multiply "+b+" with";case "/":return"divide "+b+" into"}},p=function(a){switch(a){case "+":return"addition";case "-":return"subtraction";case "*":return"multiplication";case "/":return"division";case "=":return"equality";default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";a.create=function(c,d,e,f,k,l){var g=Object.create(a),
t=n(c,d);e||(e="+");g.is_number=function(){return!0};g.set_value=function(a,c){var d;if(c||!bigrat.equals(t,a))return this.fire_value_change_listeners(t,a),(d=this.get_frontside_element())&&d.dispatchEvent(b.UTILITIES.create_event("value changed",{old_value:t,new_value:a})),t=a,this.rerender(),b.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&b.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),
this};g.set_value_from_sub_classes=g.set_value;g.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),d;c&&(d={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(d)}))};g.get_value=function(){return t};g.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));b.debugging&&"0,0"===this.get_value().toString()&&b.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};g.copy=function(b){return this.add_to_copy(a.create(t[0],
t[1],e,f,k,l),b)};g.get_format=function(){return f||a.default_format};g.set_format=function(a,b,c){f=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_format",argument_1:a,toString:"by changing the format to "+a,button_selector:"."+r(a)});return this};g.get_operator=function(){return e};g.set_operator=function(a,b,c){e=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_operator",argument_1:a,
toString:"by changing the operator to "+p(a),button_selector:"."+m(a)});return this};g.get_approximate=function(){return l};g.set_approximate=function(a,b){l=a;b&&this.rerender();return this};a.add_standard_widget_functionality(g);g.set_description(k);if(b.listen){var u,C,x;g.add_speech_listeners({commands:"add | plus | sum | addition | subtract | subtraction | take away | times | multiply | multiplication | divide | division | equal | equals | decimal number | decimal | mixed number | mixed | improper fraction | improper | fraction | scientific notation | scientific",
numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var c=b.UTILITIES.get_dragee_copy()||g;switch(a){case "add":case "plus":case "sum":case "addition":c.set_operator("+",!0,!0);break;case "subtract":case "take away":case "subtraction":c.set_operator("-",!0,!0);break;case "times":case "multiply":case "multiplication":c.set_operator("*",!0,!0);break;case "divide":case "divides":case "divide by":case "division":c.set_operator("/",!0,!0);break;case "equal":case "equals":c.set_operator("=",
!0,!0);break;case "decimal number":case "decimal":c.set_format("decimal",!0,!0);break;case "mixed number":case "mixed":c.set_format("mixed_number",!0,!0);break;case "improper fraction":case "improper":case "fraction":c.set_format("improper_fraction",!0,!0);break;case "scientific notation":case "scientific":c.set_format("scientific_notation",!0,!0);break;default:u=parseFloat(a),isNaN(u)?console.log("did not understand spoken command: '"+a+"'"):(c.set_value_from_decimal(u),c.robot_in_training()&&c.robot_in_training().edited(c,
{setter_name:"set_value_from_decimal",argument_1:u,toString:"by changing its value to "+u,button_selector:".toontalk-numerator-input"}))}c.update_display();C="You are now holding "+c.get_text(!0);C!==x&&(g.display_message("You are now holding "+c.get_frontside_element(!0).innerHTML,{display_on_backside_if_possible:!0,duration:4E3,plain_text:C}),x=C)}})}b.debugging&&(g._debug_string=g.toString(),g._debug_id=b.UTILITIES.generate_unique_id(),t._debug_id_new=g._debug_id);return g};a.create_from_bigrat=
function(a){var c=b.number.ZERO();c.set_value(a);return c};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(n(a,b))};a.set_numerator=function(a){return this.set_value(n(a,this.get_value()[1].toString()))};a.set_numerator_to_float=function(a){return this.set_value(bigrat.divide(this.get_value(),bigrat.fromDecimal(a),this.denominator()),!0)};a.set_denominator=function(a){return this.set_value(n(this.get_value()[0].toString(),a))};
a.set_denominator_to_float=function(a){return this.set_value(bigrat.divide(this.get_value(),this.numerator(),bigrat.fromDecimal(a)),!0)};a.ONE=function(){return b.number.create(1)};a.ZERO=function(a){return b.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};a.compare_with_number=
function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),c=function(a,b){var c=a.indexOf('style="');return 0<=c?a.substring(0,c+7)+b+a.substring(c+7):a},d=28,e,f,h,k,l,n;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string(50));a=a.get_element();$(a).is(".toontalk-conditions-contents")?e=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json, .toontalk-robot")?
(e=$(a),l=!0):$(a).parent().is(".toontalk-element-frontside")?(e=$(a),k=l=!0):e=$(a).parent().is(".toontalk-scale-half")?$(a):$(a).parent();0===e.length&&(d=this.get_parent_of_frontside())&&(d.get_widget().is_hole()&&(d=d.get_parent_of_frontside()),e=$(d.get_frontside_element()));1===b.nest.CONTENTS_WIDTH_FACTOR&&1===b.nest.CONTENTS_HEIGHT_FACTOR&&e.is(".toontalk-nest")&&e.parent().is(".toontalk-box-hole")&&!e.parent().is(".toontalk-scale-half")&&(e=e.parent());if($(a).is(".toontalk-carried-by-bird"))h=
f=100;else if($(a).is(".toontalk-element-attribute"))f=200,h=32;else if(l&&(a===e.get(0)||e.is(".toontalk-top-level-resource")))f=$(a).width(),h=$(a).height(),f&&h||(f=this.saved_width||76,h=this.saved_heieght||55,$(a).css({width:f,height:h}));else{0<e.length&&(f=e.width(),h=e.height());if(0===f||0===h||0===e.length){b.logging&&0<=b.logging.indexOf("display")&&0<e.length&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());b.UTILITIES.is_attached(a)||b.UTILITIES.when_attached(a,
this.update_display.bind(this));return}e.is(".toontalk-nest")&&(f*=b.nest.CONTENTS_WIDTH_FACTOR,h*=b.nest.CONTENTS_HEIGHT_FACTOR)}n=$(a).children(".toontalk-widget");n.is("*")?n=n.get(0):(n=document.createElement("div"),a.appendChild(n));$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");d=this.get_border_size(f,h);k||(4===d?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):
8===d?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):16===d?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number"));k=h-2*d;l=this.to_HTML(f/(k*b.FONT_ASPECT_RATIO),f,h,k,this.get_format(),!0,this.get_operator(),l);b.UTILITIES.on_a_nest_in_a_box(a)&&(l=c(l,"width:"+(f-2*d)+"px;"),l=c(l,"height:"+(h-2*d)+"px;"));n.innerHTML=l;n.translate=!1;$(n).addClass("toontalk-widget notranslate");e.is(".toontalk-box-hole")&&
$(a).css({width:"",height:""});$(a).is(".toontalk-conditions-contents")&&$(a).css({width:240-2*d,height:60-2*d});b.UTILITIES.give_tooltip(a,this.get_title())};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?16:32};a.to_HTML=function(a,h,n,m,r,t,p,u){var E=!1!==t?" toontalk-top-level-number":"",z=4,A=a,M,F,R,q,v,G;this.is_attribute_widget&&this.is_attribute_widget()?E+=" toontalk-attribute-number":this.get_approximate()&&!this.get_erased()&&(E+=" toontalk-approximate-number");
u&&(E+=" toontalk-number-size-unconstrained-by-container");R=p?g(p):"";A||(A=4);m||(m=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+E+'" style="font-size: '+m+'px;"></div>';if(0<R.length){--A;if(G="-"===p&&(this.is_negative()||this.is_zero())&&(this.is_integer()||"improper_fraction"!==r&&"proper_fraction"!==r&&"mixed_number"!==r))--A,R+="&nbsp;";2>A&&(m*=Math.max(1,A)/2,A=2)}if(this.is_integer()&&"scientific_notation"!==r){try{M=bigrat.toBigInteger(this.get_value()).toString()}catch(N){b.UTILITIES.report_internal_error("Error converting number to a string: "+
N),M="0"}t=M.length;0<R.length&&t++;4>A&&t>A&&(r=Math.min(4,t),m*=A/r,A=r);return'<div class="toontalk-number toontalk-integer'+E+'" style="font-size: '+m+'px;">'+R+k(M,A,m)+"</div>"}if(this.get_approximate()||this.is_attribute_widget())if("decimal"===r?F=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===r&&(F=bigrat.toDecimal(this.get_value()).toExponential(),M=F.indexOf("e"),0<=M&&(q=F.substring(M+1),F=F.substring(0,M))),F)return t=F.length,A>t&&(A=t),0<R.length&&t++,q&&(A-=
3+q.length/2),"scientific_notation"===r&&(z+=2),A<z&&t>A&&(r=Math.min(z,t),m=0>=A?Math.max(1,A)/r*m:Math.max(2,A)/r*m),A=q?'&times;10<sup style="font-size: '+m/2+'px;">'+q+"</sup>":"",m=Math.min(m,h/(b.FONT_ASPECT_RATIO*t)),'<div class="toontalk-number toontalk-approximate-number'+E+'" style="font-size: '+m+'px;">'+R+'<div style="margin-top: '+(n-m)/2+'px">'+F+"</div>"+A+"</div>";F=' style="font-size:'+.4*m+'px;"';if("improper_fraction"===r||!r)return m='<table class="toontalk-number toontalk-improper-fraction'+
E+'"'+F+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+k(this.numerator_string(),2*A,m)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+k(this.denominator_string(),2*A,m)+"</td></tr></table>",""===R?m:"<table class='toontalk-operator-and-fraction'"+F+"><tr><td>"+R+"</td><td>"+m+"</td></tr></table>";
if("mixed_number"===r||"proper_fraction"===r){R=this.integer_part();if(R.is_zero())return this.to_HTML(A,h,n,m,"improper_fraction",t,p);q=this.copy({just_value:!0}).subtract(R).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+E+'"'+F+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+R.to_HTML(A/2,h,n,m,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+q.to_HTML(A/2,h,n,m,"improper_fraction",!1)+
"</td></tr></table>"}if("decimal"===r)return 4>A&&(m*=Math.max(1,A)/4,A=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+E+'" style="font-size: '+m+'px;">'+R+this.decimal_string(A,m)+"</div>";if("scientific_notation"===r){z=bigrat.isNegative(this.get_value());M=this.get_value();G=bigrat.abs(bigrat.create(),M);q=bigrat.isLessThan(G,bigrat.ONE);bigrat.equals(M,bigrat.ZERO)?q=0:(q?(v=bigrat.divide(bigrat.create(),bigrat.ONE,G),M=bigrat.toBigInteger(v)):M=bigrat.toBigInteger(G),
M=M.toString(),q=q?0===v[1].compare(BigInteger.ONE)?-M.length+1:-M.length:M.length-1);v=6+(0===q?1:Math.ceil(f(Math.abs(q)))/2);z&&v++;if(a<v+1)return this.to_HTML(v+1,h,n,m*a/(v+1),r,t,p,u);h=e(A-(Math.min(v,A/2)+1),m);q<h?(n=bigrat.power(bigrat.create(),c,h-q),n=bigrat.multiply(bigrat.create(),this.get_value(),n),h=bigrat.toBigInteger(n).toString().substring(0,h+1)):h=bigrat.toBigInteger(this.get_value()).toString().substring(0,h+1);if(this.is_integer()||this.is_reciprocal_of_integer())h=l(h);n=
z?"-"+h.substring(0,1):h.substring(0,1);h=h.substring(1);A=d(h,A*(1-v/A),m,!0);0<A.length&&(A="<span class='toontalk-decimal-point'>.</span>"+A);return'<table class="toontalk-number toontalk-scientific_notation'+E+'"'+F+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+E+'" style="font-size: '+.9*m+'px;">'+R+n+A+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+m+'px;"> &times;10<sup style="font-size: '+
m/2+'px;">'+q+"</sup></div></td></tr></table>"}};a.get_default_description=function(){return this.get_approximate()?"a number from an approximate calculation.":"a number."};a.drop_on=function(a,b){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,c){var d,e,f,h,k;if(!a.is_backside()){if(a.visible()&&this.visible()&&
(c.event||c.robot)){if(c.robot){if(!c.robot.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(a,c);a.robot_waiting_before_next_step=c.robot}d=document.createElement("div");$(d).addClass("toontalk-bammer-down");e=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level");d.style.left="-10px";d.style.top=e.height()+"px";0<e.length&&e.get(0).appendChild(d);h=this.get_frontside_element();f=$(h).offset();f.left-=.75*$(d).width();f.left+=.5*$(h).width()+.1*$(d).width();
f.top-=.5*$(h).height()+.4*$(d).height();h=function(){b.sounds&&b.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,c)&&c.robot&&(this.rerender(),c.robot.run_next_step());c.event&&this.backup_all();$(d).removeClass("toontalk-bammer-down");b.UTILITIES.set_timeout(function(){var a=e.offset();a||(a={left:0,top:0});$(d).addClass("toontalk-bammer-away");f.left=a.left+e.width()-100;f.top=a.top+e.height()+100;k=function(){$(d).remove()};b.UTILITIES.animate_to_absolute_position(d,f,k,c.robot&&
c.robot.transform_animation_speed(b.animation_settings.BAMMER_ANIMATION_SPEED));$(d).css({opacity:.01})})}.bind(this);b.UTILITIES.animate_to_absolute_position(d,f,h,c.robot&&c.robot.transform_animation_speed(b.animation_settings.BAMMER_ANIMATION_SPEED));$(a.get_frontside_element(!0)).css({"z-index":b.UTILITIES.next_z_index()});$(d).css({opacity:1,"z-index":b.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c)}};a.number_dropped_on_me_semantics=function(a,c){c&&
c.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove({remove_backside:!0});switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "=":return this.set_value(a.get_value());case "^":return this.power(a);default:b.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_side_dropped_on_me=
function(a,c){var d;if(a.number_dropped_on_me)return this.number_dropped_on_me(a,c);(d=a.get_frontside_element())&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:d,where:"front"}));return!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),
this.get_value(),a.get_value()),!0);return this};a.divide=function(a){this.set_value(bigrat.divide(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),
!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};a.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(a){var b="";if(this.get_erased())return"erased number";"+"===this.get_operator()||a&&a.without_operator||(b=this.get_operator());return b+bigrat.str(this.get_value())};a.get_text=function(a){var c=this.get_format(),d=
"";switch(this.get_operator()){case "-":d="subtract ";break;case "*":d="multiply by ";break;case "/":d="divide by ";break;case "=":d="make what I'm dropped on equal to "}var e;if(this.get_approximate()||this.is_attribute_widget&&this.is_attribute_widget())return"approximately "+bigrat.toDecimal(this.get_value()).toString();if(this.is_integer()||"improper_fraction"===c)return a?d+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):d+this.toString({without_operator:!0});c=this.integer_part();
if(c.is_zero())return a?d+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):d+this.toString({without_operator:!0});e=this.copy({just_value:!0}).subtract(c).absolute_value();return a?d+b.UTILITIES.number_to_words(c.toString({without_operator:!0}))+(a?" and ":" ")+b.UTILITIES.number_to_words(e.toString({without_operator:!0})):d+c+" "+e};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};
a.get_json=function(a,b,c){b({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string(),format:this.get_format(),approximate:this.get_approximate()},c)};b.creators_from_json.number=function(b){if(b)return a.create(b.numerator,b.denominator,b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};a.is_reciprocal_of_integer=
function(){return 0===this.get_value()[0].compare(BigInteger.ONE)&&0!==this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};
a.decimal_string=function(b,f){var n,g,m,r,t;if(this.is_integer())return this.numerator_string();n=this.get_value();g=a.create(n[0],n[1]);m=g.integer_part();n=m.toString();"0"===n&&this.is_negative()&&(n="-"+n);r=g.get_value();bigrat.subtract(r,r,m.get_value());g=b-(Math.min(n.length,b/2)+1);t=e(g,f);m=Math.min(n.length,b/2);bigrat.isNegative(r)&&bigrat.abs(r,r);var p=bigrat.fromValues(r[0],1);r=bigrat.fromValues(r[1],1);if(bigrat.equals(p,bigrat.ZERO))t="0";else{var u="",E=bigrat.create(),z=bigrat.create(),
A=bigrat.create();for(bigrat.multiply(p,p,c);t>u.length;){if(bigrat.isLessThan(p,r))u+="0";else if(bigrat.divide(E,p,r),z=bigrat.toBigInteger(E),u+=z.toString(),bigrat.subtract(A,E,bigrat.fromValues(z,1)),bigrat.multiply(p,A,r),bigrat.equals(p,bigrat.ZERO)){u=l(u);break}bigrat.multiply(p,p,c)}t=u}g=t.length<g?t:d(t,g,f,!0);return k(n,m,f)+"<span class='toontalk-decimal-point'>.</span>"+g};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.get_widget().match_with_any_number)return a.get_widget().match_with_any_number();
this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===this.get_operator())return"matched";a.last_match=this;return a};a.get_custom_title_prefix=function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"/"===this.get_operator()?"Drop me on another number I'll divide him by my value.":
"Drop me on another number and I'll "+t(this.get_operator(),"myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+b.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=function(){return{create:function(a){var c=b.backside.create(a),d=c.get_element(),e=document.createElement("div"),f=a.numerator_string(),k=a.denominator_string(),l=b.UTILITIES.create_text_area(f,"toontalk-numerator-input",
"","Type here to edit the numerator",void 0,"number"),n=b.UTILITIES.create_text_area(k,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),g=b.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal.",!0),m=b.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction.",!0),
r=b.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction.",!0),t=b.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",!0),p=b.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",
!0),u=b.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",!0),O=b.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),H=b.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","I will divide what I'm dropped on.",!0),Q=b.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",
!0),U=function(b){var c=l.button.value.trim(),d=n.button.value.trim(),e,q,g,v,m=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:m(a,b).replacement};a=m(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",
replacement:a.replace(/[^\d]*/g,"")}},r;if(c!==f||d!==k){r=m(c,"numerator");r.message&&(e=parseFloat(c),isNaN(e)?(a.display_message(r.message,{display_on_backside_if_possible:!0}),c=r.replacement):q=bigrat.fromDecimal(e));"0"===d?(a.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1.",{display_on_backside_if_possible:!0}),d="1"):(r=m(d,"denominator"),r.message&&(g=parseFloat(d),isNaN(g)?(a.display_message(r.message,{display_on_backside_if_possible:!0}),
d=r.replacement||"1"):v=bigrat.fromDecimal(g)));if(q&&v)a.set_value(bigrat.divide(a.get_value(),q,v),!0);else if(q)a.set_value(bigrat.divide(a.get_value(),q,bigrat.fromValues(d,1)),!0);else if(v)a.set_value(bigrat.divide(a.get_value(),bigrat.fromValues(c,1),v),!0);else if(!a.set_from_values(c,d)&&!isNaN(g))return;f=a.numerator_string();k=a.denominator_string();a.robot_in_training()&&(b=b.srcElement.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:v?
"set_denominator_to_float":"set_denominator",argument_1:d,toString:"by changing the value of the denominator to "+d,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:q?"set_numerator_to_float":"set_numerator",argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+b}));a.rerender()}},W=function(){var c=b.UTILITIES.selected_radio_button(g,m,r,t).button.value;a.set_format(c,!0,!0)},V=function(){var c=b.UTILITIES.selected_radio_button(p,u,O,H,Q).button.value;
a.set_operator(c,!0,!0)},J=b.UTILITIES.create_horizontal_table(l.container,e,n.container),ca=b.UTILITIES.create_horizontal_table(g.container,m.container,r.container,t.container),fa=b.UTILITIES.create_horizontal_table(p.container,u.container,O.container,H.container,Q.container),ba=b.backside.create_advanced_settings_button(c,a),R=c.update_display.bind(c),q=c.add_advanced_settings,v=function(){switch(a.get_format()){case "decimal":return g;case "improper_fraction":return r;case "mixed_number":case "proper_fraction":return m;
case "scientific_notation":return t}},G=function(){switch(a.get_operator()){case "+":return p;case "-":return u;case "*":return O;case "/":return H;case "=":return Q}};e.innerHTML="/";$(e).addClass("ui-widget");l.button.addEventListener("change",U);l.button.addEventListener("mouseout",U);l.button.addEventListener("mouseenter",function(){f=l.button.value.trim()});n.button.addEventListener("change",U);n.button.addEventListener("mouseout",U);n.button.addEventListener("mouseenter",function(){k=n.button.value.trim()});
d.appendChild(J);d.appendChild(ba);g.button.addEventListener("change",W);m.button.addEventListener("change",W);r.button.addEventListener("change",W);t.button.addEventListener("change",W);b.UTILITIES.check_radio_button(v());b.UTILITIES.check_radio_button(G());p.button.addEventListener("change",V);u.button.addEventListener("change",V);O.button.addEventListener("change",V);H.button.addEventListener("change",V);Q.button.addEventListener("change",V);c.update_display=function(){$(l.button).val(a.numerator_string());
$(n.button).val(a.denominator_string());b.UTILITIES.check_radio_button(v());b.UTILITIES.check_radio_button(G());R()};c.add_advanced_settings=function(){q.call(c,ca,fa);$(ca).buttonset();$(fa).buttonset()};b.UTILITIES.when_attached(d,function(){c.is_primary_backside()||a.add_listener("value_changed",function(){c.rerender()})});return c}}}();window.TOONTALK.number["function"]=function(){var a=b.create_function_table(),c=function(a){return bigrat.toDecimal(m(a,l))},d=function(a){return bigrat.toDecimal(m(a,
e))},f=function(){return!0};a.add_function_object("sum",function(c,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.add,"sum",d)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",function(c,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.subtract,"difference",d)},"The bird will return with the result of subtracting the numbers in the box from the first number.","-");a.add_function_object("product",function(c,d){return a.n_ary_widget_function(c,
b.number.ONE,b.number.multiply,"product",d)},"The bird will return with the product of the numbers in the box.","\u00c3\u0192\u00c6\u2019\u00c3\u00a2\u00e2\u201a\u00ac\u00e2\u20ac\u009d");a.add_function_object("division",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.divide,"division",d)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00c3\u0192\u00c6\u2019\u00c3\u201a\u00c2\u00b7");a.add_function_object("modulo",function(b,
c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(m),2,"modulo",c)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.minimum,"minimum",d)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(c,d){return a.n_ary_widget_function(c,
b.number.ONE,b.number.maximum,"maximum",d)},"The bird will return with the largest of the numbers in the box.","max");a.add_function_object("absolute value",function(c,d){return a.n_ary_function(c,function(a){var d=b.number.ZERO(c.get_hole_contents(1).get_format());bigrat.abs(d.get_value(),a);return d},1,"absolute value",d)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(function(a,
b){var c=bigrat.power(bigrat.create(),a,b[0].valueOf()),d=b[1].valueOf();return 1===d?c:bigrat.nthRoot(bigrat.create(),c,d)},function(a){return 0!==a[1][1].compare(BigInteger.ONE)}),2,"power",c)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},
f),1,"logarithm",c)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).","log");a.add_function_object("random",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?
Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.","rand");a.add_function_object("round",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(u),1,"round",c)},"The bird will return the number rounded to the nearest integer.");
a.add_function_object("floor",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(r),1,"floor",c)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(n),1,"ceiling",c)},"The bird will return the smallest integer greater than or equal to the number.","ceil");a.add_function_object("delay",function(c,d){var e=Date.now(),f=a.check_message(c),
k;if("string"!==typeof f)if(2>f.box_size)a.report_error("Delay function birds need a number in the second hole saying how long to wait.",f);else return k=c.get_hole_contents(1).to_float(),setTimeout(function(){var k=b.number.ZERO(b.number.function_bird_results_default_format);k.set_value_from_decimal((Date.now()-e)/1E3);k.set_approximate(!0);a.process_response(k,f,c,d)},1E3*k),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");
a.add_function_object("integer and fraction parts",function(b,c){return a.n_ary_function(b,p,1,"integer and fraction parts",c)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(b,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/g)},!0,c),1,"sine",d)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",
function(b,d){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/g)},!0,c),1,"cosine",d)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return g*Math.atan(a)},!0),1,"arc tangent",c)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.",
"atan");a.add_function_object("arc tangent of y and x",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return g*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.","atan2");a.add_function_object("sine (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,
!0,d),1,"sine (in radians)",c)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,d),1,"cosine (in radians)",c)},"The bird will return with an approximation of the cosine of the number (in radians).","cos rad");a.add_function_object("arc tangent (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,
!0),1,"arc tangent (in radians)",c)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",c)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.",
"atan2 rad");a.add_function_object("turn into words",b.widget.get_description_function(a),"The bird will return with words describing what is in the second hole.","describe",["a widget"]);a.add_function_object("speak",b.widget.get_speak_function(a),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);a.add_function_object("listen for a number",b.widget.get_listen_function(a,!0),"The bird will cause the browser to listen to the next number said and give the number to the bird in the first hole. If you put a number between 0 and 1 in the second hole then only recognitions with at least that confidence will be considered. ","listen",[]);return a.get_function_table()}()})(window.TOONTALK);(function(b){var g=function(d,c,a,k){var l;d&&0<=a&&d.maintain_proportional_dimensions()&&d.get_default_width?(l=d.get_default_width(),d=d.get_default_height(),a/l>=k/d?(l=l*k/d,a={left:(a-l)/2,top:0,width:l,height:k}):(l=d*a/l,a={left:0,top:(k-l)/2,width:a,height:l})):(d.is_backside()&&(d.update_display(),d.scale_to(a,.92*k)),a={left:0,top:0});b.UTILITIES.set_css(c,a)};window.TOONTALK.box=function(b){var c=Object.create(b.widget);c.create=function(a,k,l,e,f){var t=Object.create(c),p=[];"undefined"===
typeof k&&(k=!0);t.is_box=function(){return!0};t.get_horizontal=function(){return k};t.set_horizontal=function(a,b,c){k=a;b&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_horizontal",argument_1:a,toString:"by changing the orientation to "+(a?"horizontal":"vertical"),button_selector:a?".toontalk-horiztonal-radio-button":"toontalk-vertical-radio-button"});return this};t.get_hole=
function(a){return p[a]};t.get_hole_contents=function(a){return p[a]&&p[a].get_contents()};t.set_hole=function(a,c,e){var f;p[a].set_contents(c);if(e){c&&c.save_dimensions();e=this.get_frontside_element();a=$(e).children(".toontalk-hole-number-"+a);a.empty();if(!c)return;f=this.get_hole_dimensions();e=c.get_element(!0);0<a.length&&a.get(0).appendChild(e);g(c,e,f.width,f.height);$(e).find("iframe").attr("width",f.width).attr("height",f.height-20);c.rerender()}this.rerender();b.debugging&&(this._debug_string=
this.to_debug_string())};t.get_holes=function(){return p};t.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=void 0}.bind(this)};t.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};t.set_contents=
function(a){b.UTILITIES.for_each_batch(a,function(a,b){p[b].set_contents(a)})};t.get_size=function(){return a};t.set_size=function(c,e,f){var k,l;if(a===c||0>c||isNaN(c))return!1;l=this.visible();p.length=c;if(c>a)for(k=a;k<c;k++)p[k]=b.box_hole.create(k),p[k].set_parent_of_frontside(t),p[k].set_visible(l);a=c;e&&this.rerender();(e=this.get_listeners("contents_or_properties_changed"))&&e.forEach(function(a){a({type:"contents_or_properties_changed",new_size:c})});f&&this.robot_in_training()&&this.robot_in_training().edited(this,
{setter_name:"set_size",argument_1:c,oString:"by changing the number of holes to "+c+" of the box",button_selector:".toontalk-box-size-input"});b.debugging&&(this._debug_string=this.to_debug_string());return!0};t.get_hole_dimensions=function(){var c=this.get_frontside_element(),e=$(c).width()||b.box.get_default_width(),c=$(c).height()||b.box.get_default_height();return k?{width:e/a,height:c}:{width:e,height:c/a}};t.receive_size_from_dropped=function(a,c){var e;if(a.is_number())return e=b.number.create(this.get_size()),
e.number_dropped_on_me_semantics(a),e=Math.max(0,Math.round(e.to_float())),this.set_size(e),e.toString()};t.copy=function(b){var d;b||(b={});d=p.map(function(a){if(a=a.get_contents())return a.copy(b)});d=c.create(a,k,d,this.get_description(),this.get_name());return this.add_to_copy(d,b)};t.generate_name=function(){for(var a="",b=this.get_size();0<b;)a+=";",b--;return a};t.add_standard_widget_functionality(t);t.has_name(t);t.set_name(f);for(f=0;f<a;f++)p[f]=b.box_hole.create(f),p[f].set_parent_of_frontside(t);
t.set_description(e);if(b.listen){var m,u,r;t.add_speech_listeners({commands:"left to right | horizontal | top to bottom | vertical",numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var c=b.UTILITIES.get_dragee_copy()||t;switch(a){case "left to right":case "horizontal":c.set_horizontal(!0,!0,!0);break;case "top to bottom":case "vertical":c.set_horizontal(!1,!0,!0);break;default:m=parseInt(a),isNaN(m)?console.log("did not understand '"+a+"'"):c.set_size(m,!0,!0)}c.update_display(!0);
a=c.get_size();u="You are now holding a "+(c.get_horizontal()?"horizontal":"vertical")+" box with "+(1<a?a+" holes":0===a?"no holes":"one hole")+".";u!==r&&(t.display_message(u,{display_on_backside_if_possible:!0,duration:4E3}),r=u)}})}l&&t.set_contents(l);b.debugging&&(t._debug_id=b.UTILITIES.generate_unique_id(),t._debug_string=t.to_debug_string());return t};c.create_backside=function(){return b.box_backside.create(this)};c.equals=function(a){return a.equals_box&&this.get_type_name()===a.get_type_name()&&
a.equals_box(this)};c.equals_box=function(a){var b=this.get_size(),c,d,f;if(b!==a.get_size())return!1;for(c=0;c<b;c++)if(d=this.get_hole_contents(c),f=a.get_hole_contents(c),!d&&f||d&&!f||d&&f&&(!d.equals||!d.equals(f)))return!1;return!0};c.compare_with=function(a){if(a.compare_with_box)return-1*a.compare_with_box(this)};c.compare_with_box=function(a){var b=this.get_size(),c=a.get_size(),d,f;if(b>c)return 1;if(b<c)return-1;for(c=0;c<b;c++){d=this.get_hole_contents(c);f=a.get_hole_contents(c);if(d&&
!f)return 1;if(!d&&f)return-1;if(d&&f)if(d.compare_with){if(d=d.compare_with(f),1===d||-1===d)return d}else return}return 0};c.match=function(a){if(this.get_erased&&this.get_erased()){if(a.get_widget().match_with_any_box)return a.get_widget().match_with_any_box();this.last_match=a;return this}return a.match_with_this_box?a.match_with_this_box(this):(this.last_match=a,this)};c.match_with_any_box=function(){return"matched"};c.match_with_this_box=function(a){var c=this.get_size(),l=[],e,f,g;if(c!==a.get_size())return a.last_match=
this,a;for(e=0;e<c;e++)if(g=a.get_hole_contents(e))if(f=this.get_hole_contents(e)){f=b.UTILITIES.match(g,f);if(f.is_widget)return f;"matched"!==f&&(l=0===l.length?f:l.concat(f))}else if(f=this.get_contents_temporarily_removed(e))l.push(f);else return a.last_match=this,a;return 0<l.length?l:"matched"};c.toString=function(a){var b="",c=this.get_size(),d,f,g=this.get_type_name()+" that looks like ";for(d=0;d<c;d++)f=this.get_hole(d),b+=f.get_full_description(a),d<c-1&&(b+=" | ");return g+"["+b.replace(g,
"")+"]"};c.get_type_name=function(a){return a?"boxes":"box"};c.get_default_description=function(){return"a box for holding things."};c.get_help_URL=function(){return"docs/manual/boxes.html"};c.get_json=function(a,c,l){var e=[],f=function(l,g){var m,u;l>=this.get_size()?c({type:"box",size:this.get_size(),contents:e,horizontal:this.get_horizontal(),name:this.get_name()},g):(m=this.get_hole_contents(l))?m.is_primary_backside&&m.is_primary_backside()?(u=function(a,b){e.push({widget:a,is_backside:!0});
f(l+1,b)}.bind(this),b.UTILITIES.get_json(m.get_widget(),a,u,g)):m.is_widget?(u=function(a,b){e.push({widget:a});f(l+1,b)}.bind(this),b.UTILITIES.get_json(m,a,u,g)):(u=function(a,b){e.push(a);f(l+1,b)}.bind(this),m.get_json(a,u,g)):(e.push(null),f(l+1,g))}.bind(this);f(0,l)};c.walk_children=function(a){var b=this.get_size(),c;for(c=0;c<b&&a(this.get_hole(c));c++);};b.creators_from_json.box=function(a,k){if(a)return c.create(a.size,a.horizontal,b.UTILITIES.create_array_from_json(a.contents,k),a.description,
a.name)};c.update_display=function(){var a=this.get_frontside(!0).get_element(),c=this.get_size(),l=b.UTILITIES.get_style_numeric_property(a,"z-index"),e=function(e,h,r){var t=h.get_contents(),p=(t||h).get_element(!0),u=$(e).parents(".toontalk-box-hole"),F=function(){$(e).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&(I/=b.nest.CONTENTS_WIDTH_FACTOR,O/=b.nest.CONTENTS_HEIGHT_FACTOR)},w,B,I,O;f?(B=0,0<u.length||$(a).is(".toontalk-conditions-contents")?(I=n-2*y/c,O=C-2*y):(I=n,O=
C),F(),w=I*r,1<r&&(w+=y*(r-1))):(w=0,0<u.length||$(a).is(".toontalk-conditions-contents")?(I=n-2*y,O=C-2*y/c):(I=n,O=C),F(),B=O*r,1<r&&(B+=y*(r-1)));setTimeout(function(){b.UTILITIES.set_css(e,{left:w,top:B,width:I,height:O,"z-index":"number"===typeof l&&l+c-r});t&&t.render()});m[r]&&e.setAttribute("toontalk_name",m[r]);!b.UTILITIES.has_animating_image(p)&&0<r&&($(e).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),
$(e).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),f?$(e).addClass(x+"-left"):$(e).addClass(x+"-top"));e!==p&&t.get_parent()===h&&(g(t,p,I,O),$(h.element).find("iframe").attr("width",I).attr("height",O-20),e.appendChild(p),h.get_contents().rerender());h.is_element()&&(p={width:I,height:O},h=h.get_contents(),h.is_plain_text_element()?$(h.get_frontside_element()).css({"font-size":b.UTILITIES.font_size(h.get_text(),
I,{height:O}),width:"",height:""}):$(h.get_frontside_element()).css(p),h=h.dereference(),h.set_size_attributes(I,O,!0),$(e).css(p))},f=this.get_horizontal();$(a).is(".toontalk-box");var t=function(){var f=$(a).children(".toontalk-box-hole");$(a).parent(".toontalk-conditions-container").is("*")||$(a).parent().is(".toontalk-scale-half")||($(a).parent(".toontalk-box-hole").is("*")?b.UTILITIES.set_css(a,{width:"",height:""}):$(a).is(".toontalk-conditions-contents")?b.UTILITIES.set_css(a,{width:r-2*y,
height:h-2*y}):b.UTILITIES.set_css(a,{width:r,height:h}));f.length===c?f.each(function(a,b){var c=this.get_hole(a);c&&e(b,c,a)}.bind(this)):(f.remove(),this.get_holes().forEach(function(b,c){u=b.get_element();$(u).addClass("toontalk-hole-number-"+c);b.get_contents()&&b.get_contents().update_display();e(u,b,c);a.appendChild(u)}))}.bind(this),p=function(){var e=function(a){if(a.parentElement)return $(a.parentElement).is(".toontalk-box-hole")?a.parentElement:e(a.parentElement)},l=e(a)||a,l=$(a).parent().is(".toontalk-scale-half")?
a:l;r=0===c?0:!$(l).is(".toontalk-carried-by-bird")&&b.UTILITIES.element_width(l)||this.saved_width||b.box.get_default_width();h=!$(l).is(".toontalk-carried-by-bird")&&b.UTILITIES.element_height(l)||this.saved_height||b.box.get_default_height();f?(n=0===c?0:r/c,C=h):(n=r,C=h/c)}.bind(this),m=this.get_name().split(";"),u,r,n,h,C,x,y;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(a).addClass("toontalk-box");$(a).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");
b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string());this.get_erased()?($(a).addClass("toontalk-box-erased"),$(a).children(".toontalk-side").remove()):($(a).removeClass("toontalk-box-erased"),p(),y=this.get_border_size(n,C),x=4===y?"toontalk-box-eighth-size-border":8===y?"toontalk-box-quarter-size-border":16===y?"toontalk-box-half-size-border":"toontalk-box-full-size-border",f?n-=(c-1)*y/c:C-=(c-1)*y/c,$(a).addClass(x),b.UTILITIES.set_timeout(t))};
c.get_default_width=function(){return 164};c.get_default_height=function(){return 68};c.get_border_size=function(a,b){var c;if(0===a)return c=$(this.get_frontside_element()).width(),16>=c?8:32>=c?16:32;a||(a=$(this.get_frontside_element()).width());b||(b=$(this.get_frontside_element()).height());return 32>=a||32>=b?4:64>=a||64>=b?8:128>=a||128>=b?16:32};c.get_name_input_label=function(){return"The labels of my holes are"};c.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};
c.drop_on=function(a,b){var c;if(a.box_dropped_on_me)return c=a.box_dropped_on_me&&a.box_dropped_on_me(this,b),b.event&&a.rerender(),c&&this.remove(),c;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b);console.log("No handler for drop of "+this+" on "+a)};c.box_dropped_on_me=function(a,b){console.log("box on box not yet implemented");return!1};c.widget_side_dropped_on_me=function(a,c){var l=this.which_hole(c.event),e;if(0<=l)return e=this.get_hole(l),(l=e.get_contents())?a.drop_on(l,
c):e.widget_side_dropped_on_me(a,c);b.UTILITIES.report_internal_error(a+" dropped on "+this+" but no event was provided.")};c.get_index_of=function(a){return a.get_parent_of_frontside()&&a.get_parent_of_frontside().get_index&&a.get_parent_of_frontside().get_index()};c.name_font_size=function(a,b){var c=0,d=0;if(0===this.get_size())return 0;this.get_horizontal()?(d=(b||this.get_height())/6,c=(a||this.get_width())/(8*this.get_size())):(d=(b||this.get_height())/(6*this.get_size()),c=(a||this.get_width())/
8);return Math.min(c,d)};c.removed_from_container=function(a,b){var c=!!b,d=this.get_index_of(a);0<=d&&(this.set_hole(d,void 0,c),c&&(this.rerender(),a.restore_dimensions()))};c.get_path_to=function(a,c){var l=this.get_size(),e,f;if("empty hole"===a.get_type_name()){l=a.get_parent_of_frontside();f=b.box.path.create(a.get_index());if(l===this)return f;l=this.get_path_to(l);if(!l)return;l.next=f;return l}for(e=0;e<l;e++)if(f=this.get_hole_contents(e)||this.get_contents_temporarily_removed(e)){if(a===
f||f.top_contents_is&&f.top_contents_is(a))return b.box.path.create(e);if(f.get_path_to&&(f=f.get_path_to(a,c)))return l=b.box.path.create(e),l.next=f,l}};c.element_to_highlight=function(a){a=this.which_hole(a,!0);var b;if(0>a||0===this.get_size())return this.get_frontside_element();a=this.get_hole(a);return(b=a.get_contents())?b.get_frontside_element():a.get_frontside_element()};c.which_hole=function(a){var b=this.get_horizontal(),c=this.get_frontside_element(),d=this.get_size(),f,g;if(0!==d&&(f=
$(c).offset(),c=b?$(c).width()/d:$(c).height()/d,g=b?f.left:f.top,a))for(f=0;f<d;f++)if(g+=c,(b?a.pageX<=g:a.pageY<=g)||f+1===d)return f};c.dereference_path=function(a,c){var l,e;if(a){l=a.get_index&&a.get_index();if(!b.debugging||"number"===typeof l){if(e=this.get_hole_contents(l)){if(e.dereference_contents&&!a.not_to_be_dereferenced)return e.dereference_contents(a.next||a,c);if(a.next){if(e.dereference_path)return e.dereference_path(a.next,c);b.UTILITIES.report_internal_error("Expected to refer to a part of "+
e+" but it lacks a method to obtain "+b.path.toString(a.next))}a.removing_widget&&("empty hole"===e.get_type_name()?b.UTILITIES.report_internal_error("Robot is trying to remove something from an empty hole. "):e.get_infinite_stack()||c.remove_from_container(e,this));return e}return this.get_hole(l)}b.UTILITIES.report_internal_error(this+" unable to dereference the path: "+b.path.toString(a))}else return this};c.path={create:function(a){return{get_index:function(){return a},toString:function(){return"scale"===
this.true_type?0===a?"the left pan ":"the right pan ":"the "+b.UTILITIES.ordinal(a)+" hole "},get_json:function(b,c,d){var f=function(b,d){c({type:"box_path",index:a,true_type:this.true_type,next:b},d)}.bind(this);this.next?this.next.get_json(b,f,d):f(void 0,d)}}}};c.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};b.creators_from_json.box_path=function(a,k){var l=c.path.create(a.index);a.next&&(l.next=b.UTILITIES.create_from_json(a.next,k));a.true_type&&(l.true_type=
a.true_type);return l};return c}(window.TOONTALK);window.TOONTALK.box_backside=function(b){return{create:function(c){var a=b.backside.create(c),k=b.UTILITIES.create_text_input(c.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(a){if(a=b.UTILITIES.input_area_drop_handler(a,c.receive_size_from_dropped.bind(c),c))c.rerender(),c.robot_in_training()&&c.robot_in_training().dropped_on_text_area(a,c,{area_selector:".toontalk-box-size-input",
setter:"receive_size_from_dropped",toString:"for the box's size"})}),l=b.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-horiztonal-radio-button","Left to right","Show box horizontally.",!0),e=b.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-vertical-radio-button","Top to bottom","Show box vertically.",!0),f=function(){var a=parseInt(k.button.value.trim(),10);c.set_size(a,!0,!0)},g=function(){var a="horizontal"===b.UTILITIES.selected_radio_button(l,e).button.value;
c.set_horizontal(a,!0,!0)},p=a.get_element(),m=b.backside.create_advanced_settings_button(a,c),u=a.update_display.bind(a),r=b.UTILITIES.create_horizontal_table(l.container,e.container);k.button.addEventListener("change",f);k.button.addEventListener("mouseout",f);l.button.addEventListener("change",g);e.button.addEventListener("change",g);a.update_display=function(){k.button.value=c.get_size().toString();c.get_horizontal()?b.UTILITIES.check_radio_button(l):b.UTILITIES.check_radio_button(e);u()};b.UTILITIES.when_attached(p,
function(){a.is_primary_backside()||c.add_listener("contents_or_properties_changed",function(){a.rerender()})});p.appendChild(k.container);p.appendChild(r);$(r).buttonset();p.appendChild(m);a.rerender();return a}}}(window.TOONTALK);window.TOONTALK.box_hole=function(b){return{create:function(c){var a=Object.create(this),k,l,e;a.is_hole=function(){return!0};a.is_empty_hole=function(){return!k};a.constrained_by_container=function(){return!1};a.get_element=function(){e||(e=document.createElement("div"),
e.className="toontalk-box-hole toontalk-frontside toontalk-side",e.toontalk_widget_side=a);return e};a.get_frontside=function(a){return k?k.get_frontside(a):this.get_element()};a.get_frontside_element=function(a){return this.get_element()};a.get_frontside=function(){return this};a.get_width=function(){return $(this.get_element()).width()};a.get_height=function(){return $(this.get_element()).height()};a.widget_side_dropped_on_me=function(a,c){var e=this.get_parent_of_frontside(),k=this.get_contents(),
l,g,n,h;if(k)return k.widget_side_dropped_on_me&&k.widget_side_dropped_on_me(a,c);a.dropped_on_other&&a.dropped_on_other(this,c);c.event?(b.sounds&&b.sounds.fall_inside.play(),k=this.get_element(),h=a.is_plain_text_element(),n=a.get_element(),$(n).css({"z-index":b.UTILITIES.next_z_index()}),g=$(n.parentElement).offset(),l=$(k).offset(),h||(n.style.left=c.event.pageX-g.left+"px",n.style.top=c.event.pageY-g.top+"px",$(n).addClass("toontalk-animating-element")),n.style.width=k.style.width,n.style.height=
k.style.height,n.style.left=l.left-g.left+"px",n.style.top=l.top-g.top+"px",l=function(){$(n).removeClass("toontalk-animating-element");this.set_contents(a);e.render();c.event&&e.backup_all()}.bind(this),setTimeout(l,h||b.UTILITIES.has_animating_image(n)?0:1200),e.robot_in_training()&&e.robot_in_training().dropped_on(a,this),a.save_dimensions&&a.set_size_attributes&&a.set_size_attributes($(k).width(),$(k).height()),a.is_backside()||e.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",
{element_widget:n,where:"front",index:this.get_index()}))):(e.rerender(),this.set_contents(a));return!0};a.get_json=function(){return null};a.add_to_json=function(a){return a};a.copy=function(a){return b.box_hole.create(c)};a.match=function(){return"matched"};a.get_type_name=function(a){return k?k.get_type_name(a):a?"empty holes":"empty hole"};a.name_font_size=function(){return this.get_box().name_font_size()};a.is_of_type=function(a){return k?k.is_of_type(a):"empty hole"===a};a.get_box=function(){return this.get_parent_of_frontside()};
a.update_display=function(){var a;k&&(a=this.get_frontside_element(),g(k,k.get_element(!0),$(a).width(),$(a).height()))};a.dereference=function(){return k?k.dereference():this};a.can_run=function(){return k&&k.can_run()};a.get_index=function(){return c};a.get_contents=function(){return k};a.set_contents=function(a){var c=this.get_listeners("contents_or_properties_changed");c&&(k!==a&&c.forEach(function(b){b({type:"contents_or_properties_changed",old_value:k,new_value:a})}),k&&c.forEach(function(a){k.remove_listener("contents_or_properties_changed",
a,!0)}),a&&c.forEach(function(b){a.add_listener("contents_or_properties_changed",b)}));k&&k.set_parent(void 0);(k=a)?(k.set_parent(this),b.debugging&&(this._debug_string="A hole containing "+k.to_debug_string()),k.set_visible(l)):b.debugging&&(this._debug_string=this.to_debug_string())};a.get_contents_dimensions=function(){return{width:$(this.get_frontside_element()).width(),height:$(this.get_frontside_element()).height()}};a.visible=function(){return this.get_parent_of_frontside().visible()};a.set_visible=
function(a){l=a;k&&k.set_visible(a)};a.remove=function(){k&&k.remove()};a.render=function(){k&&b.DISPLAY_UPDATES.pending_update(this)};a.rerender=function(){if(k&&this.visible())return this.render()};a.set_running=function(a){k&&k.set_running(a)};a.set_parent=function(a){k&&k.set_parent(a)};a.maintain_proportional_dimensions=function(){if(k)return k.maintain_proportional_dimensions()};a.removed_from_container=function(a,c,e,l){k?(c&&k.restore_dimensions(),this.set_contents(void 0),c&&this.get_parent_of_frontside().render()):
l&&b.UTILITIES.report_internal_error("Holes can't be removed from containers.")};a.temporarily_remove_contents=function(a,b){if(k)return this.get_parent_of_frontside().temporarily_remove_contents(a,b)};a.toString=function(){return k?k.toString():"_"};a.get_description=function(){return k?k.get_description():"_"};a.get_full_description=function(a){return k?k.get_full_description(a):"_"};a.is_backside=function(){return!1};a.get_widget=function(){return this.get_parent_of_frontside()};a.is_number=function(){return k?
k.is_number():!1};a.is_box=function(){return k?k.is_box():!1};a.is_scale=function(){return k?k.is_scale():!1};a.is_bird=function(){return k?k.is_bird():!1};a.is_nest=function(){return k?k.is_nest():!1};a.is_robot=function(){return k?k.is_robot():!1};a.is_element=function(){return k?k.dereference().is_element():!1};a.get_original_width=function(){if(k&&k.get_original_width)return k.get_original_width()};a.get_original_height=function(){if(k&&k.get_original_height)return k.get_original_height()};a.is_sensor=
function(){return k?k.is_sensor():!1};a.is_top_level=function(){return!1};a.is_plain_text_element=function(){return!1};a.get_active=function(){return k?k.get_active():!1};a.set_active=function(a,b){k&&k.set_active(a,b)};b.widget.has_parent(a);b.widget.has_listeners(a);if(b.debugging||b.logging)a.to_debug_string=function(a){var e=("the "+b.UTILITIES.ordinal(c)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box")).substring(0,a);return k?
e+" which contains "+k.to_debug_string(a):e+" which is empty"},a._debug_string=a.to_debug_string();return a}}}(window.TOONTALK);window.TOONTALK.box["function"]=function(){var d=b.create_function_table();d.add_function_object("box hole",function(c,a){return d.typed_bird_function(c,function(a,c,e){var f=Math.round(a.to_float());if(1>f)d.report_error("The 'box hole' function bird cannot find the "+b.UTILITIES.ordinal(f-1)+" hole. She only accepts positive numbers.",e);else if(f>c.get_size())d.report_error("The 'box hole' function bird cannot cannot find the "+
b.UTILITIES.ordinal(a-1)+" hole. The box only has "+c.get_size()+" holes.",e);else{if(c=c.get_hole_contents(f-1))return e.message_return_bird?c.copy():c;d.report_error("The 'box hole' function bird cannot cannot find anything in the "+b.UTILITIES.ordinal(a-1)+" hole. It is empty.",e)}},["number","box"],"box hole",a,2,2)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. Use 1 for the first hole.","hole",["number","box"]);d.add_function_object("count holes",
function(c,a){return d.typed_bird_function(c,function(a){return b.number.create(a.get_size())},["box"],"count holes",a,1,1)},"The bird will return with the number of holes the box has.","count holes",["box"]);d.add_function_object("fill hole",function(c,a){return d.typed_bird_function(c,function(a,c,e,f){var g=Math.round(a.to_float());if(1>g)d.report_error("The fill hole function bird cannot fill the "+b.UTILITIES.ordinal(a)+" hole. She only accepts positive numbers.",f);else return f.message_return_bird&&
(c=c.copy(),e=e.copy()),g>c.get_size()&&c.set_size(g),c.set_hole(g-1,e),c},["number","box",void 0],"fill hole",a,3,3)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);d.add_function_object("split box",function(c,a){return d.typed_bird_function(c,function(a,c,e){var f=Math.round(a.to_float()),g=c.get_size();if(0>f)d.report_error("The box split function bird cannot split the box after "+
a+" holes. She only accepts zero or positive numbers.",e);else if(f>g)d.report_error("The box split function bird cannot split the box after "+a+" holes. The box only has "+g+" holes.",e);else{c.get_holes();a=g-f;var g=b.box.create(a),p;for(p=0;p<a;p++)g.set_hole(p,c.get_hole_contents(p+f));e.message_return_bird&&(c=c.copy());c.set_size(f);return b.box.create(2,!1,[c,g])}},["number","box"],"split box",a,2,2)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.",
"split",["number","box"]);d.add_function_object("merge boxes",function(c,a){return d.typed_bird_function(c,function(){var a=0,c,d,f,g,p,m;if(1===arguments.length)return b.box.create(0);m=arguments[arguments.length-1];d=arguments[0];m.message_return_bird&&(d=d.copy());for(c=0;c<arguments.length-1;c++)a+=arguments[c].get_size();f=d.get_size();d.set_size(a);for(c=1;c<arguments.length-1;c++)for(g=arguments[c].get_size(),a=0;a<g;a++){if(p=arguments[c].get_hole_contents(a))m.message_return_bird&&(p=p.copy()),
d.set_hole(f,p);f++}return d},["box"],"merge boxes",a)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);d.add_function_object("get window property",function(c,a){return d.typed_bird_function(c,function(a,c){var e=window,f=a.get_size(),g=function(){var e="window",g;for(g=0;g<f;g++){m=a.get_hole_contents(g);if(!m||!m.get_text){d.report_error("The 'get window property' bird could not get the text of the "+b.UTILITIES.ordinal(g)+" hole.",c);return}e+=
"."+m.get_text().trim()}return e},p,m;for(p=0;p<f;p++){m=a.get_hole_contents(p);if(!m||!m.get_text){d.report_error("The 'get window property' bird could not get the text of the "+b.UTILITIES.ordinal(p)+" hole.",c);return}try{e=e[m.get_text().trim()]}catch(u){d.report_error("Error trying to find the value of "+g()+". "+u,c);return}}if(void 0===e)d.report_error("Error no value for "+g()+exception,c);else return"number"===typeof e?b.number.create(e):b.element.create(e.toString())},["box"],"window property",
a,1,1)},"The bird will return with the value of the property accessed by each of the property names in the box.","win prop",["box"]);d.add_function_object("set window property",function(c,a){return d.typed_bird_function(c,function(a,c,e){var f=window,g=a.get_size(),p=function(c){var f="window",l;for(l=0;l<c;l++){n=a.get_hole_contents(l);if(!n||!n.get_text){d.report_error("The 'set window property' bird could not get the text of the "+b.UTILITIES.ordinal(l)+" hole.",e);return}f+="."+n.get_text().trim()}return f},
m,u,r,n;for(m=0;m<g-1;m++){n=a.get_hole_contents(m);if(!n||!n.get_text){d.report_error("The 'set window property' bird could not get the text of the "+b.UTILITIES.ordinal(m)+" hole.",e);return}try{f=f[n.get_text().trim()]}catch(h){d.report_error("Error trying to find the property of "+p(g-1)+". "+h,e);return}}f||(r="Property missing of "+p(g-1));if(!r)try{u=c.to_float?c.to_float():c.get_text?c.get_text():c.toString();n=a.get_hole_contents(g-1);if(!n||!n.get_text){d.report_error("The 'set window property' bird could not get the text of the "+
b.UTILITIES.ordinal(m)+" hole.",e);return}f[n.get_text().trim()]=u}catch(h){r="Unable to set the value of "+p(g)+" to value of "+c}if(r)d.report_error(r,e);else return c},["box",void 0],"set window property",a,2,2)},"The bird will set the value of the property accessed by each of the property names in the box in the second hole to the value of the widget in the third hole.","set win prop",["box"]);return d.get_function_table()}()})(window.TOONTALK);(function(){var b,g,d,c;window.TOONTALK.bird=function(a){var d=Object.create(a.widget),l=function(b,c,d){var k=b.get_function_type();b=b.get_function_object();var l=Object.keys(TOONTALK[k]["function"]),g=l.map(function(a){return TOONTALK[k]["function"][a].title}),l=a.UTILITIES.create_select_menu("functions",l,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",g);c=c.get_element();var r;b&&$(l.menu).val(b.name).selectmenu("refresh");
$(l.menu).on("selectmenuselect",function(a){d.set_function_name(a.target.value);d.get_description()||(r=$(d.get_backside_element()).find(".toontalk-description-input"),0<r.length&&r.get(0).setAttribute("placeholder",d.get_default_description()))});$(l.menu).selectmenu("menuWidget").addClass("toontalk-select-menu");c.insertBefore(l.container,c.firstChild)};d.create=function(e,f,g){var p=[],m=[];g||(g=Object.create(d));g.set_nest=function(a,b){if(e===b||void 0===e)e=a};g.is_bird=function(){return!0};
g.widget_side_dropped_on_me=function(b,c){var d,f,k;if(e){if(e.has_ancestor(b))return b.display_message("Bird can't take its nest to its nest!"),!1;!(e.visible()||this.visible()||e.any_nest_copies_visible())||c.robot&&c.robot.visible()&&!c.robot.animate_consequences_of_actions()?(k=function(){try{e.add_to_contents(b,c)}catch(a){if(a.wait_for_nest_to_receive_something)a.wait_for_nest_to_receive_something.run_when_non_empty(k,this);else throw console.error(a.stack),a;}},k(),c.robot&&c.robot===b.robot_waiting_before_next_step&&
(b.robot_waiting_before_next_step=void 0,c.robot.run_next_step())):(c.by_function_bird||b.save_dimensions(),d=this.get_frontside_element(),setTimeout(function(){$(d).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside()&&this.get_parent_of_frontside().rerender()}.bind(this)),b.set_visible(e.visible()),c.robot&&!c.do_not_run_next_step&&(b.robot_waiting_before_next_step=c.robot,c.robot.run_next_step&&
(f=function(a){a&&a();b.robot_waiting_before_next_step=void 0;c.robot.run_next_step()})),c.after_delivery_continuation=a.UTILITIES.join_continuations(c.after_delivery_continuation,f),e.animate_bird_delivery(b,this,c))}else c.robot&&!c.robot.visible()?b.remove():this.animate_delivery_to(b);c.event&&!c.by_function_bird&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,this);return!0};g.animate_delivery_to=function(b,c,d){d||(d={});var f=d.nest_recieving_message,k=d.after_delivery_continuation,
l=this.get_parent_of_frontside(),g=this.get_frontside_element(!0),t=$(g).position();$(g).width();var z=this.closest_visible_ancestor_or_frontside(),L=$(z.get_frontside_element()).offset(),E=function(){var c,e;a.sounds&&a.sounds.bird_fly.pause();f||b.remove();d.temporary_bird?this.remove():(c=function(){$(g).removeClass("toontalk-bird-morph-to-static");$(g).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));l&&l.get_widget().rerender()}.bind(this),g.style.position=
O,a.UTILITIES.set_css(g,t),I&&I.appendChild(g),l&&(l.get_widget().is_top_level()?this.rerender():l.get_widget().rerender()),U&&(ca.remove_backside_widget(this,!0),U(),p&&(e=p,p=[],m=[],e.forEach(function(a){a()}))),a.UTILITIES.add_animation_class(g,"toontalk-bird-morph-to-static"),a.UTILITIES.add_one_shot_event_handler(g,"animationend",1E3,c));k&&k();d.event&&this.backup_all()}.bind(this),A=function(){var c=function(b){a.UTILITIES.set_timeout(function(){this.fly_to(L,function(){b&&b();E&&E()},d)}.bind(this))}.bind(this);
if(f)try{d.delivery_bird=this,d.ignore_copies=!0,this.is_function_bird()&&(d.after_delivery_continuation=c),f.add_to_contents(b,d),this.is_function_bird()||c()}catch(e){if(e.wait_for_nest_to_receive_something){e.wait_for_nest_to_receive_something.run_when_non_empty(A,this);c&&(c(),c=void 0);return}a.sounds&&a.sounds.bird_fly.pause();console.error(e.stack);throw e;}else this.is_function_bird()||c();F($(g).offset())}.bind(this),M=function(b,c){c||(c=a.UTILITIES.widget_side_of_element(b));this.element_to_display_when_flying=
b;c&&(this.update_display(),setTimeout(function(){c.update_display()}));$(b).addClass("toontalk-carried-by-bird");$(b).removeClass("toontalk-temporarily-set-down");a.UTILITIES.set_timeout(function(){var d={left:"",top:"",position:""};c&&!c.use_scaling_transform&&(d.width="",d.height="");1<b.toontalk_x_scale&&(d["font-size"]="inherit");a.UTILITIES.set_css(b,d);this.update_display()}.bind(this))}.bind(this),F=function(c){var d;this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),
c?(d={"z-index":a.UTILITIES.next_z_index()},0<this.element_to_display_when_flying.width_before_carry&&(d.width=this.element_to_display_when_flying.width_before_carry),0<this.element_to_display_when_flying.height_before_carry&&(d.height=this.element_to_display_when_flying.height_before_carry),1<this.element_to_display_when_flying.toontalk_x_scale&&(d["font-size"]="inherit"),a.UTILITIES.set_css(this.element_to_display_when_flying,d),this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying),
a.UTILITIES.set_absolute_position(this.element_to_display_when_flying,c),(c=b.get_parent_of_frontside())&&!c.is_backside()&&c.rerender()):$(this.element_to_display_when_flying).remove(),this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),w,B,I,O,H,Q,U,W,V,J,ca;f||(f=e);d.delay=a.animation_settings.PAUSE_BETWEEN_BIRD_STEPS;$(g).removeClass("toontalk-bird-gimme");J=b.get_element(!0);M(J,b);c&&!c.is_function_nest()&&(B=c.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element());
if(!c||this.visible()||c.visible()&&(c.is_function_nest()||a.UTILITIES.visible_element(B)))if(a.sounds&&a.sounds.bird_fly.play(),$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),c&&!c.is_function_nest()&&(w=$(B).offset(),f.get_frontside_element&&(Q=$(f.get_frontside_element()).closest(".toontalk-backside-of-top-level"))),Q&&Q.is("*")||(Q=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")),(c=Q.offset())||(c={left:0,top:0}),d.starting_left?
L={left:d.starting_left+c.left,top:d.starting_top+c.top}:0===L.left&&0===L.top&&(L={left:-J.clientWidth,top:c.top+Q.height()/2}),w||(w={left:-2*J.clientWidth,top:c.top+Q.height()/2}),I=g.parentElement,z=$(g).width(),H=$(g).height(),O=g.style.position,g.style.position="absolute",ca=this.top_level_widget(),l&&l.temporarily_remove_contents&&(U=l.temporarily_remove_contents(this,!0))&&this.get_widget().add_to_top_level_backside(this),0<Q.length&&Q.get(0).appendChild(g),a.UTILITIES.set_css(g,{left:d.starting_left||
L.left-c.left,top:d.starting_top||L.top-c.top,width:z,height:H}),a.logging&&0<=a.logging.indexOf("bird")&&console.log(this.to_debug_string(50)+" from "+(d.starting_left||L.left-c.left)+", "+(d.starting_top||L.top-c.top)+" to "+w.left+", "+w.top),f&&(W=f.get_contents_element&&f.get_contents_element()),W&&f.visible()&&(!d.robot||d.robot.animate_consequences_of_actions())){z=$(B).width();H=$(B).height();V=$(B).offset();c.max_left=c.left+Q.width();c.max_top=c.top+Q.height();w.left+=z;w.top+=H;var fa=
{left:Math.min(V.left+z,c.max_left-z),top:Math.min(V.top+H,c.max_top-H)},ba={left:Math.max(V.left-z,c.left),top:Math.max(V.top-H,c.top)};w=function(){var a=function(){f.visible()?(f.set_locked(!0),this.fly_to(V,R,d)):(d.delivery_bird=this,d.ignore_copies=!0,f.add_to_contents(b,d),k&&(k(),k=void 0))}.bind(this);$(J).addClass("toontalk-temporarily-set-down");F(fa);f.get_locked()?f.run_when_unlocked(a):a()}.bind(this);var R=function(){M(W);this.fly_to(ba,q,d)}.bind(this),q=function(){$(W).addClass("toontalk-temporarily-set-down");
F(ba);this.fly_to(fa,v,d)}.bind(this),v=function(){M(J,b);this.fly_to(V,G,d)}.bind(this),G=function(){var c=f.get_contents_dimensions();b.is_plain_text_element()&&$(J).addClass("toontalk-temporarily-set-down");F(V);b.is_plain_text_element()||a.UTILITIES.set_css(b.get_element(),c);this.fly_to(ba,N,d)}.bind(this),N=function(){M(W);this.fly_to(V,Y,d)}.bind(this),Y=function(){$(J).removeClass("toontalk-temporarily-set-down");f.set_locked(!1);F();f.update_display();A()}.bind(this);this.fly_to(fa,w,d)}else this.fly_to(w,
A,d);else d.delivery_bird=this,d.ignore_copies=!0,f.add_to_contents(b,d)};g.get_json=function(b,c,d){var f;e?(f=function(a,b){c({type:"bird",nest:a},b)},a.UTILITIES.get_json(e,b,f,d)):c({type:"bird"},d)};g.copy=function(a){var d,f,h;if(a)if(a.just_value)d=this.create(void 0,this.get_description());else{if((h=e&&e.get_guid())&&a.nests_copied&&a.nests_copied[h]){d=a.nests_copied[h][0];c.call(d);for(f=1;f<a.nests_copied[h].length;f++)b.call(a.nests_copied[h][f],d);d=this.create(d,this.get_description())}else d=
this.create(e,this.get_description());a.birds_copied||(a.birds_copied={});h&&(a.birds_copied[h]||(a.birds_copied[h]=[]),a.birds_copied[h].push(d))}else d=e&&e.is_function_nest()?this.create(e.copy(),this.get_description()):this.create(e,this.get_description());return this.add_to_copy(d,a)};g.run_when_non_empty=function(a,b){0>m.indexOf(b)&&(p.push(a),m.push(b))};g.create_backside=function(){var b=a.bird_backside.create(this);e&&e.is_function_nest()&&l(e,b,this);return b};g.get_help_URL=function(){return e&&
e.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};g.is_function_bird=function(){return e&&e.is_function_nest()};g.get_custom_title_prefix=function(){var a;return e?e.is_function_nest()&&(a=e.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":"This bird no longer knows where her nest is. She'll get rid of anything you give her."};g.toString=function(a){return e?e.is_function_nest&&e.is_function_nest()?e.get_function_object().toString():
"bird":a&&"conditions"===a.role?"any bird":"bird without a nest"};g.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird a box to compute the '"+e.get_function_object().name+"' of "+this.get_function_type(!0)+".":"a bird who takes things to her nest."};g.update_display=function(){var b=this.get_frontside(!0);this.get_backside();var c;c=b.get_element();c.setAttribute("toontalk_name",this.get_name());a.UTILITIES.give_tooltip(c,this.get_title());$(c).is(".toontalk-bird, .toontalk-side-animating")||
($(c).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),c.addEventListener("dragenter",function(b){0<=c.className.indexOf("toontalk-bird-static")&&($(c).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),a.UTILITIES.add_animation_class(c,"toontalk-bird-gimme"))}.bind(this)),c.addEventListener("dragleave",function(a){$(c).is(".toontalk-bird-gimme")&&($(c).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),
this.get_parent_of_frontside()&&this.get_parent_of_frontside().render())}.bind(this)));this.element_to_display_when_flying?(this.has_ancestor(a.UTILITIES.widget_side_of_element(this.element_to_display_when_flying))&&this.top_level_widget().get_backside_element().appendChild(c),c.appendChild(this.element_to_display_when_flying)):$(c).children(".toontalk-side").remove();a.UTILITIES.set_css(c,{"font-size":this.name_font_size()})};g.set_function_name=function(a){e&&e.is_function_nest()&&e.set_function_name(a)&&
(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};g.get_function_type=function(a){return e.get_function_type(a)};g.get_class_name_with_color=function(a){return e&&e.get_class_name_with_color?e.get_class_name_with_color(a):a};g.get_name=function(){return e?e.get_name():""};e&&e.set_name&&(g.set_name=function(a,b,c){return e.set_name(a,
b,c)});g.has_name_font_size(g);g.get_name_height=function(a){return.3*(a||this.get_height())};g.is_nest_visible=function(){return e&&e.visible()};g.add_standard_widget_functionality(g);g.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});g.set_description(f);a.debugging&&(g._debug_id=a.UTILITIES.generate_unique_id(),g._debug_string=g.to_debug_string());return g};d.create_function=function(b,c,l){return d.create(a.nest.create_function(c,b,l||a.UTILITIES.get_first_property(a[b]["function"])))};
d.match=function(a){if(a.get_widget().match_with_any_bird)return a.get_widget().match_with_any_bird(this);this.last_match=a;return this};d.match_with_any_bird=function(){return"matched"};d.fly_to=function(b,c,d){var k=this.get_frontside_element(),l=$(k).offset(),g="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*(Math.atan2(b.top-l.top,b.left-l.left)/Math.PI+
1))%8];$(k).position();var r=function(){$(k).removeClass(g);d.delay&&this.visible()?setTimeout(c,d.robot?d.robot.transform_step_duration(d.delay):d.delay):c()}.bind(this),l=function(){$(k).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));a.UTILITIES.add_animation_class(k,g);this.animate_to_absolute_position(b,r,d.robot&&d.robot.transform_animation_speed(a.animation_settings.BIRD_ANIMATION_SPEED))}.bind(this);this.visible()?setTimeout(l,1):l()};d.get_type_name=
function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};d.maintain_proportional_dimensions=function(){return!0};d.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};d.drop_on=function(a,b){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b)};a.creators_from_json.bird=function(b,c,l){return b?a.bird.create(a.UTILITIES.create_from_json(b.nest,c,l),b.description):Object.create(d)};return d}(window.TOONTALK);
window.TOONTALK.bird_backside=function(a){return{create:function(b){var c=a.backside.create(b);c.add_description_setting();c.add_name_setting();c.get_element().appendChild(a.backside.create_advanced_settings_button(c,b));return c}}}(window.TOONTALK);window.TOONTALK.nest=function(a){var k=Object.create(a.widget),l,e=0,f=0;k.default_maximum_capacity=10;k.maximum_capacity=k.default_maximum_capacity;k.create=function(t,p,m,u,r,n,h){var C=[],x=[],y=[],K,z,L;h||(h=Object.create(k));p||(p=[]);r||(e++,r=
e);b=function(a){u&&d.call(u,this);u=a;m=a.get_guid();g.call(a,this)};c=function(){u&&d.call(u,this);u=void 0;m=a.UTILITIES.generate_unique_id();this.set_name(this.generate_name())};g=function(b){l||(l=a.UTILITIES.generate_unique_id());this[l](b)};d=function(b){l||(l=a.UTILITIES.generate_unique_id());this[l](b,!0)};h.is_nest=function(){return!0};h.get_guid=function(){return m};h.matched_by=function(b){return 0<p.length?a.UTILITIES.match(b,p[0]):[[this,b]]};h.run_when_non_empty=function(a,b){0<p.length?
a(p[0]):0>y.indexOf(b)&&(C.push(a),y.push(b))};h.dereference=function(){return 0<p.length?p[0]:this};h.match=function(a){if(0<p.length)return p[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};h.add_to_contents=function(b,c){var d;d=p.push(b);var e=this.visible();c||(c={});d>k.maximum_capacity&&c.robot&&c.robot_removed_contents_since_empty&&!c.robot.visible()&&!e&&(a.logging&&0<=a.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+
" postponing addition of "+b.to_debug_string(50)+" by "+c.robot.to_debug_string(50)+". Stack is "+p.length+" long. "+x.length+" previously postponed."),c.robot.add_body_finished_listener(function(){c.robot.set_stopped(!0);x.push(function(){c.robot.set_stopped(!1);c.robot.run_actions()})}));a.logging&&0<=a.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+b.to_debug_string()+" nest now contains "+p.length+" widgets.");b.is_backside()?b.set_parent_of_backside(this):b.set_parent_of_frontside(this);
K&&!c.ignore_copies&&(c.delivery_bird?K.forEach(function(d){d.has_ancestor(b.get_widget())||d.animate_bird_delivery(a.UTILITIES.copy_side(b),c.delivery_bird,c)}):K.forEach(function(d){d.has_ancestor(b.get_widget())||d.add_to_contents(a.UTILITIES.copy_side(b,!1,!0),c)}));1===d?(0<C.length&&(d=C,C=[],y=[],d.forEach(function(a){a(b)})),b.set_visible(e),e?this.get_containing_widget().rerender():b.hide()):(b.hide(),b.set_visible(!1));c.event&&this.backup_all();this.rerender()};h.animate_bird_delivery=
function(b,c,d){var e,f,h;void 0!==this.get_parent_of_frontside()||c.visible()?(c.animate_delivery_to(b,this,d),K&&(e=$(c.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),f=c.get_parent_of_frontside().get_element(),h=this.visible(),K.forEach(function(k){var l=a.UTILITIES.copy_side(b,!1,h),g,n;k.has_ancestor(b.get_widget())||(e&&(k.visible()||h)?(g=c.copy({just_value:!0}),n=g.get_frontside_element(!0),f.appendChild(n),d.starting_left=e.left,d.starting_top=
e.top,d.nest_recieving_message=k,g.animate_delivery_to(l,k,d)):k.add_to_contents(l,d))}))):(b.remove(),d.after_delivery_continuation&&d.after_delivery_continuation())};h.get_contents_element=function(){if(0<p.length)return p[0].get_element()};h.get_locked=function(){return this.locked_for_animating_deliveries};h.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};h.run_when_unlocked=function(a){this.to_run_when_unlocked?
this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};h.removed_from_container=function(b,c,d){b=p.shift();a.logging&&0<=a.logging.indexOf("nest")&&(b?console.log(this.to_debug_string(50)+" removed "+b.to_debug_string()+" remaining widgets is "+p.length):console.log(this.to_debug_string(50)+" nothing left to remove."));if(b)return b.is_backside()?b.set_parent_of_backside(void 0):b.get_widget().set_parent_of_frontside(void 0),this.visible()&&(b.restore_dimensions&&b.restore_dimensions(),
0<p.length&&(p[0].set_visible(!0),$(p[0].get_element()).show()),this.get_containing_widget().is_top_level()?this.render():this.get_containing_widget().render()),p.length<=k.maximum_capacity&&0<x.length&&(a.logging&&0<=a.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" running "+x.length+" postponed additions. Stack is "+p.length+" long."),k.maximum_capacity=Number.MAX_VALUE,x.forEach(function(a){a()}),k.maximum_capacity=k.default_maximum_capacity,x=[]),b;d&&a.UTILITIES.report_internal_error("Nothing removed from nest!")};
h.dereference_path=function(b,c){if(0===p.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(p)return p[0].dereference_path(b,c);c.display_message("Robot expected to find something on a nest that it could get "+a.path.toString(b)+". But the nest is empty.");return this};h.dereference_contents=function(b,c){var d,e,f,h,k,l,g,n,m;return 0===p.length?{wait_until_this_nest_receives_something:this}:b.removing_widget?(d=p[0],c.remove_from_container(d,this),this.visible()&&
(l=this.get_frontside_element(),e=$(l).offset(),f=$(l).closest(".toontalk-backside-of-top-level"),(h=f.offset())||(h={left:0,top:0}),k=d.get_element(!0),g=$(l).width(),l=$(l).height(),n=.1*g+e.left-h.left,m=.1*l+e.top-h.top,a.UTILITIES.set_css(k,{width:g*a.nest.CONTENTS_WIDTH_FACTOR,height:l*a.nest.CONTENTS_HEIGHT_FACTOR}),0<f.length&&c.add_watched_step_end_listeners(function(){d.get_parent()&&(f.get(0).appendChild(k),a.UTILITIES.set_css(k,{left:n,top:m}))})),d):b.next?p[0].get_widget().dereference_path(b.next,
c):p[0].get_widget()};h.get_json=function(b,c,d){var e=[],f=function(){var f=function(a,b){c({type:"nest",contents:e,guid:m,original_nest:a,serial_number:r,name:this.get_name()},b)}.bind(this);u?a.UTILITIES.get_json(u,b,f,d):f(void 0,d)}.bind(this);a.UTILITIES.get_json_of_array(p,e,0,b,f,d)};h.copy=function(c){var d,e,f,h;if(c&&c.just_value){if(0<p.length&&(d=p[0].copy(c),!c.copy_covered_nests))return d;e=a.nest.create(this.get_description(),[],"in a robot's condition",void 0,r,this.get_name());d&&
e.add_to_contents(d);return e}d=a.UTILITIES.copy_widget_sides(p,c);c?c.fresh_copy?e=a.nest.create(this.get_description(),d,m&&a.UTILITIES.generate_unique_id()):(f=u||this,c.birds_copied&&c.birds_copied[m]?(h=f.get_guid(),c.nests_copied&&c.nests_copied[h]?(e=c.nests_copied[h][0].copy(),c.nests_copied[h].forEach(function(a){b.call(a,e)})):e=a.nest.create(this.get_description(),d,a.UTILITIES.generate_unique_id(),void 0,void 0,this.generate_name()),c.birds_copied[m].forEach(function(b){b.set_nest(e,this);
a.debugging&&(b._debug_string=b.to_debug_string())}.bind(this))):(e=a.nest.create(this.get_description(),d,m,f,r,this.get_name()),h=m),c.nests_copied||(c.nests_copied={}),c.nests_copied[f]?c.nests_copied[h].push(e):c.nests_copied[h]=[e]):e=a.nest.create(this.get_description(),d,m,u||this,r,this.get_name());return this.add_to_copy(e,c)};h.has_contents=function(){return 0<p.length};h.set_contents=function(a){p=a};h.dropped_on_other=function(b,c){var d,e,f,h,k,l,g;if(!m){m=a.UTILITIES.generate_unique_id();
a.debugging&&(this._debug_string=this.to_debug_string());d=a.bird.create(this);if(c.robot){c.robot.add_newly_created_widget(d);if(!this.visible())return;this.robot_waiting_before_next_step=c.robot}c.event&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(d);a.sounds&&setTimeout(function(){a.sounds.hatching.play()},1E3);this.rerender();e=this.get_frontside_element(!0);a.UTILITIES.add_animation_class(e,"toontalk-hatch-egg");k=function(){var k,n,m;if(b.is_backside())k=b;else if((k=
a.UTILITIES.widget_side_of_jquery($(e).closest(".toontalk-backside-of-top-level")))||(k=a.UTILITIES.widget_side_of_jquery($(b.get_widget().get_frontside_element(!0)).closest(".toontalk-backside-of-top-level"))),k)k=k.is_backside()?k:k.get_backside();else{a.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");return}n=k.get_element();m=$(n).offset();f=d.get_frontside_element(!0);$(f).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
a.UTILITIES.add_animation_class(f,"toontalk-fly-southwest");h=a.UTILITIES.relative_position(e,n);a.UTILITIES.set_css(f,{left:h.left,top:h.top});c.event&&this.robot_in_training()&&(c.ignore_training=!0);k.widget_side_dropped_on_me(d,c);$(e).removeClass("toontalk-hatch-egg").addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&a.UTILITIES.set_css(e,{left:h.left-
5,top:h.top+45});this.get_parent_of_frontside().render();g=function(){$(f).removeClass("toontalk-fly-southwest");a.UTILITIES.set_timeout(function(){a.UTILITIES.add_animation_class(f,"toontalk-fly-down");$(f).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));l=function(){var b=function(){$(f).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);
$(f).removeClass("toontalk-fly-down");a.UTILITIES.add_animation_class(f,"toontalk-bird-morph-to-static");a.UTILITIES.add_one_shot_event_handler(f,"animationend",1E3,b);c.robot&&(this.robot_waiting_before_next_step=void 0,c.robot.run_next_step());d.update_display()}.bind(this);a.UTILITIES.add_one_shot_event_handler(e,"animationend",1E3,l)}.bind(this))}.bind(this);$(f).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));d.animate_to_absolute_position({left:Math.max(10,
h.left-70)+m.left,top:Math.max(10,h.top+70)+m.top},g,c.robot&&c.robot.transform_animation_speed(a.animation_settings.BIRD_ANIMATION_SPEED));this.rerender()}.bind(this);a.UTILITIES.add_one_shot_event_handler(e,"animationend",2E3,k)}return!0};h.widget_side_dropped_on_me=function(a,b){event&&a.save_dimensions&&a.save_dimensions();0===p.length?(this.add_to_contents(a,b),a.dropped_on_other?a.dropped_on_other(this,b):b.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)):a.drop_on(p[0],
b);return!0};h.drop_on=function(a,b){return a.widget_side_dropped_on_me?(a.widget_side_dropped_on_me(this,b),!0):!1};h.element_to_highlight=function(){return 0===p.length?this.get_frontside_element():p[0].get_frontside_element()};h.update_display=function(){var b=this.get_frontside(!0),c=this.get_backside(),d,e,f,h,b=b.get_element();0<p.length?(b.setAttribute("toontalk_name",""),d=p[0],d.is_backside()?(h=d.get_element(!0),d.update_display(),d.scale_to_fit(h,b)):(d.set_visible(!0),d.render(),h=p[0].get_element(!0),
$(h).show()),e=$(b).width(),f=$(b).height(),0<e&&0<f&&a.UTILITIES.set_timeout(function(){var b=this.get_contents_dimensions();b&&(a.UTILITIES.set_css(h,{width:b.width,height:b.height,left:e*(1-a.nest.CONTENTS_WIDTH_FACTOR)/2,top:f*(1-a.nest.CONTENTS_HEIGHT_FACTOR)/2}),d.set_size_attributes&&d.set_size_attributes(b.width,b.height),d.render())}.bind(this),2),$(b).parent().is(".toontalk-box-hole")&&!$(b).parent().is(".toontalk-scale-half")?(b.parentElement.appendChild(h),$(h).css({"z-index":a.UTILITIES.next_z_index()})):
b.appendChild(h),$(b).addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest")),p[0].is_backside()?d.set_parent_of_backside(this):d.set_parent_of_frontside(this)):(b.setAttribute("toontalk_name",this.get_name()),m?($(b).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(b).addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest"))):a.UTILITIES.add_animation_class(b,this.get_class_name_with_color("toontalk-nest-with-egg")),
a.UTILITIES.set_css(b,{"font-size":this.name_font_size()}));a.UTILITIES.give_tooltip(b,this.get_title());$(b).addClass("toontalk-nest");c&&c.rerender()};l||(l=a.UTILITIES.generate_unique_id());h[l]=function(a,b){if(!K){if(b)return;K=[]}b?K.splice(K.indexOf(a),1):K.push(a)};h.get_contents_dimensions=function(){var b,c=this.get_frontside_element();b=$(c).parent().is(".toontalk-box-hole")&&!$(c).parent().is(".toontalk-scale-half")?c.parentElement:c;c=$(b).width();b=$(b).height();c*=a.nest.CONTENTS_WIDTH_FACTOR;
b*=a.nest.CONTENTS_HEIGHT_FACTOR;var d=p[0],e;if(d)return e=d.is_box()?1:2,d=d.get_border_size?e*d.get_border_size(c,b):0,{width:c-d,height:b-d}};h.get_path_to=function(b,c){var d,e;if(0<p.length){d=p[0].get_widget();if(d===b)return a.path.to_widget_on_nest();if(d.get_path_to&&(e=a.path.to_widget_on_nest(),d=d.get_path_to(b,c)))return e.next=d,e}};h.walk_children=function(a){if(0<p.length)return a(p[0])};h.top_contents_is=function(a){return 0<p.length&&p[0]===a};h.any_nest_copies_visible=function(){var a=
!1;if(!K)return!1;K.some(function(b){b.visible()&&(a=!0)});return a};h.compare_with=function(a){if(0<p.length)return p[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};h.compare_with_nest=function(a){return 0===p.length?0:1};h.compare_with_number=function(a){return 0<p.length?p[0].compare_with(a):-1};h.get_class_name_with_color=function(a){return r?a+["","-magenta","-yellow"][r%3]:a};h.generate_name=function(){f++;return n&&"#"!==n[0]?a.UTILITIES.strip_trailling_digits(n).trim()+
" "+f:"#"+f};h.has_name(h);h.get_name_width=function(a){return.8*(a||this.get_width())};h.get_name_height=function(a){return.5*(a||this.get_height())};z=h.set_name;h.set_name=function(b,c,d){var e=this.get_name();if(!z.call(this,b,c,d))return!1;c&&$(".toontalk-bird").each(function(){var c;this.getAttribute("toontalk_name")===e&&(c=a.UTILITIES.widget_side_of_element(this),a.UTILITIES.set_css(c.get_element(),{"font-size":a.UTILITIES.font_size(b,.4*c.get_width(),{height:.6*c.get_height()})}),c.rerender())})};
h.compare_with_box=h.compare_with_number;h.compare_with_scale=h.compare_with_number;h.add_standard_widget_functionality(h);h.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});L=h.set_visible;h.set_visible=function(a){L.call(this,a);a||this.set_locked(!1)};h.set_name(n);h.set_description(t);a.debugging&&(h._debug_id=a.UTILITIES.generate_unique_id(),h._debug_string=h.to_debug_string());u&&m&&(l||(l=a.UTILITIES.generate_unique_id()),u[l](h));return h};k.create_function=function(b,
c,d){var e=function(){return!1},f=a[c]&&a[c]["function"]&&a[c]["function"][d],e={get_function_type:function(b){return a[c].get_type_name(b)},get_function_object:function(){return f},set_function_name:function(b){if(d===b)return!1;d=b;f=a[c]&&a[c]["function"]&&a[c]["function"][d];this.add_to_contents=f.respond_to_message;return!0},is_function_nest:function(){return!0},copy:function(){return a.nest.create_function(b,c,d)},animate_bird_delivery:function(a,b,c){b.animate_delivery_to(a,this,c)},get_json:function(b,
d,e){d({type:"function_nest",function_type:c,function_name:f?f.name:a.UTILITIES.get_first_property(a[c]["function"])},e)},add_to_json:a.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return f.short_name},has_ancestor:e,visible:e,any_nest_copies_visible:e,is_backside:e};a.widget.has_parent(e);a.widget.has_description(e);a.widget.add_sides_functionality(e);e.set_description(b);f?(e.add_to_contents=f.respond_to_message,a.debugging&&(e._debug_id=a.UTILITIES.generate_unique_id(),
e._debug_string="a function nest that "+f.toString())):a.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+c+"."+d+" is not defined.");return e};a.creators_from_json.function_nest=function(b,c){if(b)return a.nest.create_function(b.description,b.function_type,b.function_name)};k.create_backside=function(){return a.nest_backside.create(this)};k.match_nest_with_nest=function(a){return"matched"};k.toString=function(){return"nest"};k.get_default_description=function(){return"a nest that receives things from its birds."};
k.get_help_URL=function(){return"docs/manual/birds-nests.html"};k.get_type_name=function(a){return a?"nests":"nest"};k.maintain_proportional_dimensions=function(){return!0};k.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};k.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};a.creators_from_json.nest=function(b,c,d){if(!b)return Object.create(k);d||(d=!b.original_nest&&b.guid&&c&&c.guid_to_nest_table&&c.guid_to_nest_table[b.guid]);
d=a.nest.create(b.description,[],b.guid,b.original_nest&&a.UTILITIES.create_from_json(b.original_nest,c),b.serial_number,b.name,d);d.set_contents(a.UTILITIES.create_array_from_json(b.contents,c));return c.guid_to_nest_table[b.guid]=d};k.CONTENTS_WIDTH_FACTOR=1;k.CONTENTS_HEIGHT_FACTOR=1;return k}(window.TOONTALK);window.TOONTALK.nest_backside=function(a){return{create:function(b){b=a.backside.create(b);b.add_description_setting();b.add_name_setting();return b}}}(window.TOONTALK)})();window.TOONTALK.scale=function(b){var g=Object.create(b.widget);g.create=function(d,c,a,k,l){var e=function(){a.rerender()},f=function(){return a.get_contents_dimensions()},g,p,m,u;a||(a=b.box.create(2,void 0,d,c,l||""));g=a.get_json;p=a.copy;m=a.get_path_to;a.is_scale=function(){return!0};a.copy=function(c){var d;this.get_name();c||(c={});d=p.call(this,c);d=b.scale.create(void 0,void 0,d,c.just_value&&this.get_state());return a.add_to_copy(d,c)};a.get_json=function(a,b,c){var d=function(a,c){a.type=
"scale";a.inactive_state=this.get_inactive_state();b(a,c)}.bind(this);g.call(this,a,d,c)};a.get_path_to=function(a,b){var c=m.call(this,a,b);c&&(c.true_type="scale");return c};a.drop_on=function(a,b){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b)};a.widget_side_dropped_on_me=function(a,b){var c=this.get_hole_contents(0),d=this.get_hole_contents(1),e;a.dropped_on_other&&a.dropped_on_other(this,b);if(c&&!d)return this.get_hole(1).widget_side_dropped_on_me(a,b),!0;if(!c&&(d||
!b.event))return this.get_hole(0).widget_side_dropped_on_me(a,b),!0;e=this.which_hole(b.event,!1);if(0===e){if(c){if(c.drop_on)return a.drop_on(c,b);return}}else if(d){if(d.drop_on)return a.drop_on(d,b);return}this.get_hole(e).widget_side_dropped_on_me(a,b);return!0};a.which_hole=function(c,d){var e=a.get_frontside_element(),f=$(e).offset(),e=b.UTILITIES.get_element_width(e),f=c.clientX-(f.left+e/2),e=d?e/10:0;return-f>e?0:f>e?1:-1};a.get_inactive_state=function(){return k};a.update_display=function(){var a=
this.get_frontside_element(!0),c=$(a),d=$(a).children(".toontalk-scale-half"),e=$(a).parent(),e=e.is(".toontalk-backside")||c.is(".toontalk-conditions-contents")?a:e.get(0),k=$(e).width()||c.width(),l=$(e).height()||c.height(),g=function(a,c,d){var e=c.get_contents(),h=(e||c).get_element(!0),g,n,m;b.UTILITIES.set_css(a,{left:d*k*.5,top:0,width:.5*k,height:l});a!==h&&(g=0===d?-.05*k:.15*k,d="toontalk-scale-balanced"===p?.1*l:0===d&&"toontalk-scale-left_heavier"===p||1===d&&"toontalk-scale-right_heavier"===
p?.25*l:1===d&&"toontalk-scale-left_heavier"===p||0===d&&"toontalk-scale-right_heavier"===p?-.1*l:.2*l,n=.4*k,m=.4*l,$(h).css({left:g,top:d,width:n,height:m}),$(a).css({width:n,height:m}),e&&(e.set_location_attributes&&e.set_location_attributes(g,d),e.set_size_attributes&&e.set_size_attributes(n,m),e.is_backside()&&(e.update_display(),e.scale_to(n,m)),e.render()),a.appendChild(h),c.get_contents_dimensions=f,c.is_scale_pan=function(){return!0})},m,p;c.is(".toontalk-top-level-resource")?p="toontalk-scale-balanced":
(m=this.get_state(),p="undefined"===typeof m?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][m+1]);c.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");c.addClass(p);c.addClass("toontalk-scale");0===k&&(k=1);0===l&&(l=1);$(e).is(".toontalk-top-level-resource")||$(a).is(".toontalk-top-level-resource")||(c=b.UTILITIES.scale_to_fit(a,e,123,91),k/=c.x_scale,l/=c.y_scale);
2===d.length?d.each(function(a,c){b.UTILITIES.set_timeout(function(){g(c,this.get_hole(a),a)}.bind(this))}.bind(this)):(this.get_holes().forEach(function(b,c){var d=b.get_element();b.get_contents();0===c?$(d).addClass("toontalk-left_scale  toontalk-scale-half"):$(d).addClass("toontalk-right_scale toontalk-scale-half");a.appendChild(d);b.update_display()}),setTimeout(function(){this.render()}.bind(this),100));b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string())};
a.get_contents_dimensions=function(){var a=this.get_frontside_element(!0),b=$(a).parent(),b=b.is(".toontalk-backside")||$frontside_element.is(".toontalk-conditions-contents")?a:b.get(0),a=$(b).width()||$frontside_element.width(),b=$(b).height()||$frontside_element.height();return{width:.4*a,height:.4*b}};a.render=function(){b.DISPLAY_UPDATES.pending_update(this)};a.get_type_name=function(a){return a?"scales":"scale"};a.get_help_URL=function(){return"docs/manual/scales.html"};a.toString=function(){var a=
this.get_hole_contents(0),c=this.get_hole_contents(1),d,e,f;switch(this.get_state()){case -1:d="scale leaning to the right";break;case 1:d="scale leaning to the left";break;case 0:d="balanced scale";break;default:if(d="unbalanced scale",!e&&!f)return d}e=a?"contains "+b.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";f=c?"contains "+b.UTILITIES.add_a_or_an(c.get_full_description()):"is empty";return d+" and the left pan "+e+" and the right pan "+f};a.create_backside=function(){return b.scale_backside.create(this)};
a.get_state=function(){var a=this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);b=this.get_hole_contents(1);if(a||b)if(a)if(b){if(a=a.dereference(),b=b.dereference(),a.get_widget().compare_with)return a.get_widget().compare_with(b.get_widget())}else return 1;else return-1};a.match=function(a){if(a.get_widget().match_with_scale)return a.get_widget().match_with_scale(this);this.last_match=a;return this};a.match_with_scale=function(a){var b;return(b=this.get_hole_contents(0))&&b.is_nest()&&
!b.has_contents()||(b=this.get_hole_contents(1))&&b.is_nest()&&!b.has_contents()?[[b,this]]:this.get_state()!==a.get_state()?(a.last_match=this,a):this.match_with_this_scale(a)};a.match_with_this_scale=function(a){var c=[],d,e,f;for(d=0;2>d;d++)if(f=a.get_hole_contents(d))if(e=this.get_hole_contents(d)){e=b.UTILITIES.match(f,e.dereference());if(e.is_widget)return e;"matched"!==e&&(c=0===c.length?e:c.concat(e))}else if(e=this.get_contents_temporarily_removed(d))c.push(e);else return a.last_match=this,
a;return 0<c.length?c:"matched"};a.match_with_this_box=function(a){a.last_match=this;return a};a.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};a.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};a.get_name_input_label=void 0;a.generate_name=function(){return""};a.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);if("undefined"===typeof a)return b&&
c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};a.get_default_description=function(){return"a scale for comparing things."};u=a.set_visible;a.set_visible=function(b){var c=function(a){a.new_value&&a.new_value.add_listener("value_changed",e);a.old_value&&a.old_value.remove_listener("value_changed",
e,!0)};u.call(this,b);b?(a.get_hole(0).add_listener("contents_or_properties_changed",c),a.get_hole(1).add_listener("contents_or_properties_changed",c)):(a.get_hole(0).remove_listener("contents_or_properties_changed",c,!0),a.get_hole(1).remove_listener("contents_or_properties_changed",c,!0));a.get_hole_contents(0)&&a.get_hole_contents(0).add_listener("value_changed",e);a.get_hole_contents(1)&&a.get_hole_contents(1).add_listener("value_changed",e)};a.set_name=void 0;b.debugging&&(a._debug_id=b.UTILITIES.generate_unique_id(),
a._debug_string=a.to_debug_string());return a};b.creators_from_json.scale=function(d,c){if(d)return g.create(b.UTILITIES.create_array_from_json(d.contents,c),d.description,void 0,d.inactive_state,d.name)};return g}(window.TOONTALK);window.TOONTALK.scale_backside=function(b){return{create:function(g){var d=b.backside.create(g);d.add_description_setting();d.get_element().appendChild(b.backside.create_advanced_settings_button(d,g));return d}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(b){var g=function(a,c,d,e,f){var g;d.current_action_name=c;(a=b.path.get_path_to(a,d,!0))?(e||(e={}),g=Date.now(),e.time=g-d.time_of_last_step,d.time_of_last_step=g,d.add_step(b.robot_action.create(a,c,e),f)):console.log("No path found for "+c);d.current_action_name=void 0},d=Object.create(b.widget),c=0;d.create=function(a,c,l,e,f,g,p,m,u){var r=Object.create(d),n,h,C,x=[],y=[],K,z,L,E,A,M,F,w,B;l||(l=b.actions.create());h||(h=r);a&&a.set_parent_of_frontside(r);
r.is_robot=function(){return!0};r.get_frontside_conditions=function(){return a};r.set_frontside_conditions=function(b){(a=b)&&a.set_parent_of_frontside(this)};r.get_backside_matched_widgets=function(){return B};r.set_backside_matched_widgets=function(a){B=a};r.get_matched_backside_widget=function(a){if(B)return B[F.indexOf(a)]};r.get_backside_widget_of_type=function(a,b){var c,d;if(B)return B[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&0>this.get_newly_created_widgets().indexOf(b))return d=
b,!0}.bind(this)),d};r.get_backside_conditions=function(){return c};r.set_backside_conditions=function(a){$.isArray(a)?c=a.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(c=[],b.UTILITIES.available_types.forEach(function(b){a[b]&&c.push(a[b])}));c&&c.forEach(function(a){a.is_backside()?a.set_parent_of_backside(this):(b.widget.erasable(a),a.set_parent_of_frontside(this))}.bind(this))};c&&r.set_backside_conditions(c);r.initialize_backside_conditions=function(){F=this.get_training_context().get_backside_widgets().slice();
w=b.UTILITIES.copy_widget_sides(F,{just_value:!0});this.set_backside_conditions([])};r.add_to_backside_conditions=function(a){var d;0<=this.get_newly_created_widgets().indexOf(a)||(c||(c=[]),a=F.indexOf(a),0<=a&&(d=w[a]),d&&0>c.indexOf(d)&&(c.push(d),b.widget.erasable(d)))};r.get_backside_condition_index=function(a){var b;B?(b=B.indexOf(a),0>b&&(b=B.length,B.push(a))):(b=0,B=[a]);return b};r.get_body=function(){return l};r.set_body=function(a){l=a};r.get_running=function(){return A||this.is_ok_to_run()};
r.running_or_in_run_queue=function(){return A};r.set_running_or_in_run_queue=function(a){A=a};r.stopped=function(){return M};r.set_stopped=function(a){M&&(A=!1);M!==a&&((M=a)&&this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.set_animating(!1),this.get_thing_in_hand()&&($(this.get_thing_in_hand().get_element()).removeClass("toontalk-held-by-robot"),this.drop_thing_in_hand()),this.rerender()),this.get_next_robot()&&this.get_next_robot().set_stopped(a))};r.drop_thing_in_hand=
function(){f&&(f.drop_on(this.top_level_widget(),{robot:this}),this.set_thing_in_hand(void 0))};r.finish_cycle_immediately=function(a){var b=function(){this.set_visible(!1);a&&a()}.bind(this);this.add_body_finished_listener(b)};r.get_context=function(){return K};r.set_context=function(a){K=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};r.context_is_backside=function(){return z};r.set_context_is_backside=function(a){z=a;this.get_next_robot()&&this.get_next_robot().set_context_is_backside(a)};
r.get_top_level_context=function(){return L};r.set_top_level_context=function(a){L=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};r.get_queue=function(){return E};r.set_queue=function(a){E=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};r.animate_consequences_of_actions=function(){return this.visible()};r.transform_step_duration=function(a){return!this.visible()||K&&!K.get_backside()?0:a&&u?a/u:a};r.transform_original_step_duration=function(a){if(!this.visible()||
K&&!K.get_backside())return 0;if(0===u)return a};r.transform_animation_speed=function(a){return K&&!K.get_backside()||!this.visible()?0:u?a*u:a};r.set_animating=function(a,c){var d=this.get_frontside_element(),e;a&&b.UTILITIES.visible_element(d)?(c||(c=$(d).offset()),$(d).css({width:"",height:"","z-index":b.UTILITIES.next_z_index()}),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c),e=$(d).closest(".toontalk-backside-of-top-level"),0<e.length&&e.get(0).appendChild(d),$(d).addClass("toontalk-robot-animating"),
setTimeout(function(){$(d).addClass("toontalk-side-animating")},2E3)):$(d).removeClass("toontalk-robot-animating toontalk-side-animating")};r.add_body_finished_listener=function(a){x.push(a)};r.run_body_finished_listeners=function(){x.forEach(function(a){a()});x=[]};r.add_watched_step_end_listeners=function(a){y.push(a)};r.run_watched_step_end_listeners=function(){y.forEach(function(a){a()});y=[]};r.get_thing_in_hand=function(){return f};r.set_thing_in_hand=function(a){if(b.debugging){if(a&&"empty hole"===
a.get_type_name()){b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");return}b.logging&&0<=b.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string(50)+" now has in his hand "+(a?a.to_debug_string(50):"nothing"))}a&&!a.constrained_by_container()&&a.save_dimensions();f=a};r.get_next_robot=function(){return p};r.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());!a&&p&&(p.set_first_in_team(p),p.set_previous_robot(void 0));
(p=a)&&p.set_previous_robot(this);b&&($(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=this.drop_area_instructions())};r.get_previous_robot=function(){return C};r.set_previous_robot=function(a){C=a};r.get_first_in_team=function(){return h};r.set_first_in_team=function(a){h=a;p&&p.set_first_in_team(a)};r.walk_children=function(a){var b;p&&!a(p)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};r.get_run_once=function(){return g};r.set_run_once=function(a){g=a;this.update_title();
return!0};r.get_watched_speed=function(){return u};r.set_watched_speed=function(a){u=a;return!0};r.can_run=function(){return this.get_frontside_conditions()&&this.get_frontside_conditions().is_top_level()||b.widget.can_run.call(this)};r.training_started=function(a){var c=this.get_training_context();c?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(c.copy({just_value:!0})),this.initialize_backside_conditions(),a||($("*").css({cursor:"url("+
b.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),this.update_title(),a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):b.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};r.training_finished=function(){if(this.being_trained){var a,c,d;a=this.get_body().get_newly_created_widgets();
for(c=0;c<a.length;c++)d=a[c],"drop it on top-level"!==d.last_action&&"copy"!==d.last_action||this.add_step(b.robot_action.create(b.newly_created_widgets_path.create(c),"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):$("*").css({cursor:""})}};if(b.debugging||
b.logging)r.to_debug_string=function(a){var c=this.get_frontside_conditions();return("Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(c?b.UTILITIES.add_a_or_an(c.toString()):"anything")).substring(0,a)};p&&r.set_next_robot(p);r.add_standard_widget_functionality(r);n=r.remove_backside_widget.bind(r);r.has_name(r);r.set_name(m);r.set_description(e);b.listen&&r.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});r.remove_backside_widget=function(a,
b){var c=this.get_frontside_conditions(),d;a===c?this.set_frontside_conditions(void 0):(d=this.get_backside_conditions())&&d.some(function(b,c){if(a===b)return d.splice(c,1),!0})||n(a,b)};b.debugging&&(r._debug_id=b.UTILITIES.generate_unique_id(),r._debug_string=r.to_debug_string());return r};d.create_backside=function(){return b.robot_backside.create(this)};d.copy=function(a){var c=this.get_frontside_conditions(),d=this.get_backside_conditions(),c=c?c.copy({just_value:!0}):void 0,e=this.get_next_robot(),
e=e?e.copy(a):void 0,f;d&&(f=b.UTILITIES.copy_widgets(d,{just_value:!0}));d=this.create(c,f,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),e,(!a||!a.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(d,a)};d.match=function(a){var b,c;if(a.get_widget().is_robot()&&(b=this.get_body().is_empty(),c=a.get_widget().get_body().is_empty(),b===c))return"matched";this.last_match=a;return this};d.generate_name=function(){c++;return"#"+c.toString()};
d.run=function(a,c,d,e){var f=this.get_frontside_conditions(),g,p,m,u,r;if(this.being_trained||this.running_or_in_run_queue())return this;(r=this.get_backside())&&r.visible()&&f&&(m=function(a){$(a.get_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},m(f),this.rerender());a?(this.set_context(a),this.set_context_is_backside(c),
this.set_top_level_context(d),this.set_queue(e)):a=this.get_context();this.match_status=b.UTILITIES.match(f,this.get_context());"matched"===this.match_status&&(u=[],(c=this.get_backside_conditions())&&0<c.length&&((g=a.get_backside_widgets())&&c.some(function(c){var d,e;c.matching_widget&&c.matching_widget.get_parent===a&&(d=b.UTILITIES.match(c,c.matching_widget),"matched"===d&&(u.push(c.matching_widget),e=d));e||g.some(function(a){d=void 0;if(!(0<=u.indexOf(a))){if(a!==this&&!a.is_backside()){m&&
m(a);d=b.UTILITIES.match(c,a);if("matched"===d)return u.push(a),e=d,c.matching_widget=a,!0;if(!d.is_widget)e=d;else if(!e||e.is_widget)e=d}void 0===e&&(e=c)}}.bind(this));if("matched"!==e)return this.match_status=e,!0}.bind(this)),"matched"!==this.match_status&&(u=void 0),this.set_backside_matched_widgets(u)));if("matched"===this.match_status)return e||(e=this.get_queue()||b.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),e.enqueue(this),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),
this.rerender(),this.get_next_robot()?this.get_next_robot().run():this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){e=this.get_next_robot().run();if("matched"===e)return e;e.is_widget||e.forEach(function(a){0>this.match_status.indexOf(a)&&this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(p=function(){this.set_waiting(!1);this.run()}.bind(this),this.match_status.forEach(function(a){a[0]?
a[0].run_when_non_empty(p,this):a.run_when_non_empty(p,this)}.bind(this)),this.set_waiting(!0));return this.match_status};d.set_waiting=function(a){var c=this.get_frontside_element();c&&(a?this.visible()&&(b.UTILITIES.add_animation_class(c,"toontalk-robot-waiting"),b.UTILITIES.give_tooltip(c,"This robot is waiting for a bird to deliver something.")):($(c).removeClass("toontalk-robot-waiting"),b.UTILITIES.give_tooltip(c,this.get_title())))};d.run_actions=function(){return this.stopped()?(this.get_first_in_team().set_running(!1),
!1):this.get_first_in_team().visible()?this.get_body().run_watched(this):this.get_body().run_unwatched(this)};d.drop_from_data_transfer=function(a,b){var c;a.is_top_level&&a.is_top_level()?(c=a.get_backside_widgets().slice(),setTimeout(function(){c.forEach(function(a){this.picked_up(a,void 0,!0);this.time_of_last_step-=1E3;this.dropped_on(a,b.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=a};d.ignore_pick_up_or_drop=function(a){return this===a.get_widget()||
a.is_top_level()||this.get_parent_of_frontside()===a};d.picked_up=function(a,c,d){var e,f,g;if(!this.ignore_pick_up_or_drop(a))return a.get_infinite_stack&&a.get_infinite_stack()?(this.current_action_name="pick up a copy of",f=b.UTILITIES.get_dragee_copy()):this.current_action_name="pick up",d?(g=a,f=a.copy({fresh_copy:!0}),c=b.path.get_path_to_resource(f)):c=b.path.get_path_to(a,this,!0),c&&(d=Date.now(),e={time:d-this.time_of_last_step},this.time_of_last_step=d,e=b.robot_action.create(c,this.current_action_name,
e),this.add_step(e,g)),a.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(f||a),e};d.dropped_on=function(a,c){var d,e,f,g,p;if(!(this.ignore_pick_up_or_drop(a)||a.is_backside()&&this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===a)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name="drop it on";if(d=b.path.get_path_to(c,this))c.is_backside()?
(f=$(c.get_element()),e=f.offset(),g=f.width(),p=f.height(),f=$(a.get_frontside_element()).offset(),g=(f.left-e.left)/g,e=(f.top-e.top)/p,g=Math.max(0,Math.min(1,g)),e=Math.max(0,Math.min(1,e)),e={left_offset_fraction:g,top_offset_fraction:e}):e={},f=Date.now(),e.time=f-this.time_of_last_step,this.time_of_last_step=f,d=b.robot_action.create(d,this.current_action_name,e),this.add_step(d);a.last_action=this.current_action_name+" "+c.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};
d.dropped_on_text_area=function(a,b,c){g(a,"drop it on the text area of",this,c);a.last_action="drop it on the text area of "+b.get_type_name();this.set_thing_in_hand(void 0)};d.copied=function(a,b,c){c=c?"pick up a copy of":"copy";g(a,c,this,void 0,b);b.last_action=c};d.removed=function(a){var b;this.get_parent()&&(b=this.get_parent().get_widget());g(a,"remove",this);a.last_action="remove";b===a||a===this?(this.add_to_top_level_backside(this.copy()),this.training_finished()):this.add_newly_created_widget_if_new(a)};
d.restored=function(a){g(a,"restore",this)};d.edited=function(a,b){g(a,"edit",this,b)};d.erased_widget=function(a){g(a,"change whether erased",this)};d.resized_widget=function(a,b,c,d,f){b===d&&c===f||g(a,"change size of",this,{x_factor:d/b,y_factor:f/c})};d.started_training_another=function(a){g(a,"start training",this)};d.finished_training_another=function(a){g(a,"stop training",this)};d.trained=function(a,b){g(a,"train",this,{step:b})};d.backside_opened=function(a){g(a,"open the backside",this)};
d.backside_closed=function(a){a.is_primary_backside()?g(a.get_widget(),"close the backside",this):this.removed(a)};d.button_clicked=function(a,b){g(b.get_widget(),"click the button of",this,{button_selector:a})};d.created_widget=function(a,c,d){this.add_newly_created_widget(a);a.get_parent()||this.add_to_top_level_backside(a,!1);this.add_step(b.robot_action.create(b.path.get_path_to_resource(a.copy()),"add a new widget to the work space",{button_selector:d,path_to_source:b.path.get_path_to(c,this)}))};
d.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};d.remove_from_container=function(a,b){var c=b.get_index_of&&a.get_parent_of_frontside()&&b.get_index_of(a),d=function(){b.removed_from_container(a,void 0,c,!0)};a=a.dereference();this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(d):d();this.add_newly_created_widget_if_new(a)};d.get_training_context=function(){return this.get_first_in_team().get_parent_of_frontside()&&this.get_first_in_team().get_parent_of_frontside().get_widget()};
d.add_step=function(a,b){this.get_body().add_step(a,b);this.update_title();"train"!==a.get_action_name()&&"start training"!==a.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,a)};d.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var c=this.get_thing_in_hand(),d,e;b.debugging&&(this._debug_string=this.to_debug_string());d=a.get_element();c&&(e=c.get_element());!e&&this.carrying_tool&&(e=document.createElement("div"),$(e).addClass(this.carrying_tool));
b.UTILITIES.give_tooltip(d,this.get_title());$(d).addClass("toontalk-robot");$(d).children(".toontalk-held-by-robot").remove();e&&d.appendChild(e);this.match_status&&(this.match_status.is_widget?$(d).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(d).removeClass("toontalk-robot-not-matched"));d.setAttribute("toontalk_name",this.get_name());b.UTILITIES.set_timeout(function(){var a,g,p,m,u;e&&(u={position:"absolute"},$(e).addClass("toontalk-held-by-robot"),a=b.UTILITIES.get_element_width(e),
b.UTILITIES.get_element_height(e),p=b.UTILITIES.get_element_width(d),m=b.UTILITIES.get_element_height(d),c&&0===a&&(a=c.get_default_width?c.get_default_width():2*p,g=c.get_default_height?c.get_default_height():m/2,u.width=a,u.height=g),u.left=(p-a)/2,u.top=m/4,$(e).css(u),c&&c.rerender())});b.UTILITIES.set_css(d,{"font-size":this.name_font_size()})};d.add_newly_created_widget=function(a){return this.get_body().add_newly_created_widget(a)};d.add_newly_created_widget_if_new=function(a){if(a!==this.get_training_context()&&
this!==a)return this.get_body().add_newly_created_widget_if_new(a)};d.is_newly_created=function(a){return this.get_body().is_newly_created(a)};d.get_recently_created_widget=function(){var a=this.get_body().get_newly_created_widgets();return a[a.length-1]};d.get_title=function(){var a=this.get_description();if(a)return a="I'm "+a,0>a.lastIndexOf(".")&&(a+="."),a+"\n"+this.toString();a=this.get_frontside_element();return $(a).is(".toontalk-top-level-resource")?"Drag this robot to a work area.":this.toString()};
d.toString=function(a){var c,d,e,f,g,p,m,u,r,n,h,C,x;if(a&&"conditions"===a.role)return"any robot";if(a&&"match_status"===a.role)return"robot "+this.get_name();c=this.get_frontside_conditions();if(!c)return"an untrained robot";m=c.is_top_level();a||(a={});h=a.person;if(a&&a.resource){if(this.get_description())return'"'+this.get_description()+'"';a.person="third"}d=this.get_backside_conditions();f=this.get_body();p=g="";r=this.get_next_robot();m?n="When the workspace's green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
" is pressed":(u=b.UTILITIES.add_a_or_an(c.get_full_description({role:"conditions"})),n="When working on something that matches "+u);d&&(d.forEach(function(a){a&&(n+=" and\nif on the"+(m?" work area ":" back ")+" is "+b.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),e=!0)}),e&&(n+="\n"));if(this.being_trained){if(f.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";g="is being trained.\n";p="\n..."}f=g+n+(a&&"third"===a.person?
" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(f.toString({robot:this})||"do nothing")+p;if(a&&a.resource)return a.person=h,f.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(x=c.is_top_level()?"the work area I'm running on":"the "+c.get_type_name()+" I'm on the back of",this.match_status===c?C=x:this.match_status.has_ancestor(c)?C="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+x:(c.is_top_level()||(x="the "+
this.match_status.get_type_name()+" on "+x),d.some(function(a){if(this.match_status===a)return C="any "+a.get_type_name(!0)+" on ",c.is_top_level()||(C+="the back of "),C+=x,!0;if(this.match_status.has_ancestor(a))return C="any "+this.match_status.toString()+" inside the "+a.get_type_name(!0)+" on the back of "+x,!0}.bind(this))),f="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+C+". Perhaps editing my conditions will help.\n"+
f):"matched"!==this.match_status&&(f="I'm waiting for something to be delivered to the nest that matches "+(this.match_status[0][1]?b.UTILITIES.add_a_or_an(this.match_status[0][1].toString()):b.UTILITIES.add_a_or_an(this.match_status[0].toString()))+" in my conditions (highlighted in yellow on my backside).\n"+f));r&&(f+="\nIf it doesn't match then the next robot will try to run.\n"+r.toString());return f};d.get_type_name=function(a){return a?"robots":"robot"};d.maintain_proportional_dimensions=function(){return!0};
d.matching_resource=function(a){return a.is_robot()&&!this.get_frontside_conditions()&&!a.get_frontside_conditions()&&this.get_body().is_empty()&&a.get_body().is_empty()};d.get_top_level_context_description=function(a){var b=this.get_frontside_conditions().get_type_name();return"top-level"===b?a&&"third"===a.person?"his workspace":"my workspace":a&&"third"===a.person?"the "+b+" he's working on":"the "+b+" I'm working on"};d.get_help_URL=function(){return"docs/manual/robots.html"};d.drop_area_instructions=
function(){return this.get_next_robot()?"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};d.get_name_height=function(a){return.4*(a||this.get_height())};d.get_contents_dimensions=function(){return{width:240,height:60}};d.get_json=function(a,c,d){var e=this.get_frontside_conditions(),f=this.get_backside_conditions(),g,p=function(){var f=function(d,f){var h=function(a,b){c({type:"robot",frontside_conditions:a,backside_conditions:g,body:m,
run_once:this.get_run_once(),next_robot:d,name:this.get_name(),speed:this.get_watched_speed()},b)}.bind(this);this.get_body().get_json(a,function(c,d){m=c;e?e.is_top_level()?h({type:"top_level"},d):b.UTILITIES.get_json(e,a,h,d):h(void 0,d)},f)}.bind(this);this.get_next_robot()?b.UTILITIES.get_json(this.get_next_robot(),a,f,d):f(void 0,d)}.bind(this),m;f?(g=[],b.UTILITIES.get_json_of_array(f,g,0,a,p,d)):p()};b.creators_from_json.robot=function(a,c){if(a){var d,e,f,g;a.thing_in_hand&&(e=b.UTILITIES.create_from_json(a.thing_in_hand,
c));a.next_robot&&(d=b.UTILITIES.create_from_json(a.next_robot,c));a.backside_conditions&&($.isArray(a.backside_conditions)?g=b.UTILITIES.create_array_from_json(a.backside_conditions,c):a.semantic&&b.UTILITIES.available_types.forEach(function(c){a.semantic.backside_conditions[c]&&g.push(b.UTILITIES.get_json(a.semantic.backside_conditions[c],json_history))}));f=b.UTILITIES.create_from_json(a.frontside_conditions||a.bubble,c);d=b.robot.create(f,g,void 0,a.description,e,a.run_once,d,a.name,a.speed);
c||(c={});c.robot=d;d.set_body(b.UTILITIES.create_from_json(a.body,c));return d}};d.find_conditions_path=function(a,c,d){var e=c.get_frontside_conditions(),f=e===a?"entire_condition":e.get_path_to&&e.get_path_to(a,d),e=b.path.get_path_to(c,d),g;f||(c=c.get_backside_conditions(),c.some(function(b){if(b&&(f=b.get_path_to(a,d)))return g=b,!0}));if(f)return b.robot.create_conditions_path(f,e,g);b.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};
d.create_conditions_path=function(a,c,d){"string"===typeof d&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===d)return d=a,!0});return{dereference_path:function(e){var f=b.path.dereference_path(c,e),f=d?d:f.get_frontside_conditions();return"entire_condition"===a?f:b.path.dereference_path(a,e,f)},toString:function(){var e="entire_condition"===a?"the ":b.path.toString(a)+" of the ";return d?e+d.toString()+" backside condition of "+b.path.toString(c):e+" front side condition of "+
b.path.toString(c)},get_json:function(e,f,g){var p=function(b,g){c.get_json(e,function(b,c){var h=function(a,c){f({type:"path_to_robot_conditions",backside_condition:d&&a,path_to_robot:b,path_within_conditions:a},c)};"entire_condition"===a?h("entire_condition",c):a.get_json(e,h,c)},g)};d?b.UTILITIES.get_json(d,e,p,g):p(void 0,g)}}};b.creators_from_json.path_to_robot_conditions=function(a){var c=b.UTILITIES.create_from_json(a.path_to_robot),d="entire_condition"===a.path_within_conditions?a.path_within_conditions:
b.UTILITIES.create_from_json(a.path_within_conditions);a=a.backside_condition&&b.UTILITIES.create_from_json(a.backside_condition);return b.robot.create_conditions_path(d,c,a)};return d}(window.TOONTALK);window.TOONTALK.robot_backside=function(b){var g=function(c,a,d,g){c=b.UTILITIES.create_text_element(c);var e=a.get_element(!0),f=document.createElement("div"),t=function(){var c;$(e).parent().addClass("toontalk-conditions-container");a.visible()&&(a.update_display(),c={width:$(f).width(),height:$(f).height(),
left:"",top:""},a.use_scaling_transform?a.use_scaling_transform(c):a.is_backside()&&b.UTILITIES.scale_element(e,c.width,c.height,a.get_original_width()||$(e).width(),a.get_original_height()||$(e).height(),void 0,c),$(e).is(".toontalk-box")||$(e).is(".toontalk-image-element")||$(e).is(".toontalk-number")||$(e).css(c),a.rerender())};$(e).addClass("toontalk-conditions-contents "+g);d.match_status&&(d.match_status.is_widget?$(d.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):
"matched"!==d.match_status&&d.match_status.forEach(function(a){$(a[1].get_element()).addClass("toontalk-conditions-waiting")}));f.appendChild(e);d=b.UTILITIES.create_horizontal_table(c,f);$(d).addClass("toontalk-conditions-panel");b.UTILITIES.run_when_dimensions_known(e,function(){setTimeout(t,100)});return d},d=function(c,a){var d=a.get_frontside_conditions(),l=a.get_backside_conditions(),e=a.visible(),f;d&&(d.is_top_level()?0>c.firstChild.textContent.indexOf("I always run when the green flag")&&
c.insertBefore(b.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),c.firstChild):0===$(c).find(".toontalk-frontside-conditions-area").length&&c.insertBefore(g("I run only if the thing I'm on the back of matches: ",d,a,"toontalk-frontside-conditions-area"),c.firstChild),d.set_visible(e),d.rerender());l&&l.forEach(function(d){var k,l;d&&(l=d.is_backside()?"on-backside":d.get_type_name(),f="toontalk-backside-"+l+"-conditions-area",
"bird"===l?0===$(c).find(".toontalk-bird-on-back-condition").length&&(k=b.UTILITIES.create_text_element("And there is a bird on the back."),$(k).addClass("toontalk-bird-on-back-condition")):k=g("And if "+b.UTILITIES.add_a_or_an(l)+" matches: ",d,a,f),k&&c.insertBefore(k,c.firstChild.nextSibling),d.set_visible(e),d.rerender())})};return{create:function(c){var a=b.backside.create(c),g=a.get_element(),l=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":
"Uncheck this if you want the robot to stop after finishing what he was trained to do."},e=b.UTILITIES.create_check_box(!c.get_run_once(),"toontalk-run-once-check-box","When finished start again",l(c.get_run_once())),f="normal;original;double;half;very fast;very slow".split(";"),t=[1,0,2,.5,10,.25],p=function(a){a=f.indexOf(a);return t[a]},m=b.UTILITIES.create_select_menu("robot_speed",f,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.",
"The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),u=b.UTILITIES.create_drop_area(c.drop_area_instructions()),r=c.get_next_robot(),n=b.backside.create_advanced_settings_button(a,c),h=a.update_display.bind(a),C=function(a,b){var c=a.get_frontside_element(!0),d,e;a.get_default_width&&(d=a.get_default_width(),e=a.get_default_height(),$(c).css({left:"",top:"",width:d,
height:e}));b.appendChild(c)},x=a.hide_backside,y=a.add_advanced_settings;a.hide_backside=function(a){x.call(this,a);c.being_trained&&c.training_finished()};$(u).data("drop_area_owner",c);e.button.addEventListener("click",function(a){var d=e.button.checked;c.set_run_once(!d);b.UTILITIES.give_tooltip(e.container,l(!d));c.robot_in_training()&&c.robot_in_training().edited(c,{setter_name:"set_run_once",argument_1:!d,toString:"change to "+(d?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});
a.stopPropagation()});$(m.menu).val(function(a){a=void 0!==a?t.indexOf(a):0;return f[a]}(c.get_watched_speed())).selectmenu("refresh");$(m.menu).on("selectmenuselect",function(a){c.set_watched_speed(p(a.target.value))});r&&C(r,u);u.addEventListener("drop",function(a){(a=b.UTILITIES.get_dragee())&&a.is_robot()&&(a.get_body().is_empty()?(a=a.open_backside(),$(a.get_element()).find(".toontalk-train-backside-button").click()):(C(a,u),c.set_next_robot(a)))});a.get_next_robot_area=function(){return u};
a.update_display=function(){var a=c.get_frontside_element();a&&b.UTILITIES.give_tooltip(a,c.get_title());h()};b.UTILITIES.when_attached(g,function(){var a=c.get_backside_conditions(),b=c.get_frontside_conditions();a&&a.forEach(function(a){a.set_visible(!0)});b&&b.set_visible(!0)});g.appendChild(this.create_train_button(a,c));d(g,c);g.appendChild(n);a.add_advanced_settings=function(){y.call(a,e.container,m.container,u)};return a},create_train_button:function(c,a){var g=c.get_element();$(g);var l=$("<button>Train</button>").button(),
e=!1;l.addClass("toontalk-train-backside-button");c.change_label_and_title_of_train_button=function(c){c?(l.button("option","label","Stop training "+a.get_name()),b.UTILITIES.give_tooltip(l.get(0),"Click to stop training this robot.")):a.get_body().is_empty()?(l.button("option","label","Train"),b.UTILITIES.give_tooltip(l.get(0),"Click to start training this robot.")):(l.button("option","label","Re-train "+a.get_name()),b.UTILITIES.give_tooltip(l.get(0),"Click to start training this robot all over again."));
b.UTILITIES.visible_element(g)&&d(g,a)};c.change_label_and_title_of_train_button(e);l.get(0).addEventListener("click",function(b){e=!e;c.change_label_and_title_of_train_button(e);e?(a.initialize_backside_conditions(),a.get_body().reset_steps(),a.robot_started_training(a),a.training_started()):a.training_finished();b.stopPropagation()});return l.get(0)}}}(window.TOONTALK)})();(function(){var b=function(b){return"rotate"===b||"skewX"===b||"skewY"===b||"transform-origin-x"===b||"transform-origin-y"===b},g=function(d){return"transform-origin-x"===d||"transform-origin-y"===d?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+d:b(d)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+d:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+d};window.TOONTALK.element=function(d){var c=["left","top","width","height"],a=Object.create(d.widget),k=
function(a,b){var c,d;if(!a)return 0;"number"===typeof a&&(d=a);0===a.length&&(d=0);if("undefined"===typeof d&&(c=a.substring(a.length-1),0<="0123456789x".indexOf(c)&&(d=parseFloat(a),isNaN(d))))return;c=d;0<=["rotate","skewX","skewY"].indexOf(b)&&(c%=360,0>c&&(c+=360));return c},l=function(a,b){var c,d,g,k,l;if((b.left||b.top)&&!a.being_dragged&&(c=a.get_parent_of_frontside(),l=$(a.get_element()).width(),g=$(a.get_element()).height(),c))return b.left&&(d=c.is_element()?c.get_original_width():c.get_width(),
b.left<l/-2||b.left>d+l/2)&&(d=0<d?(b.left%d+d)%d:b.left,b.left!==d&&(b.left=d,k=!0)),b.top&&(c=c.is_element()?c.get_original_height():c.get_height(),b.top<g/-2||b.top>c+g/2)&&(g=0<c?(b.top%c+c)%c:b.top,b.top!==g&&(b.top=g,k=!0)),k};a.create=function(c,f,g,k,m,u,r,n){var h=Object.create(a),C=d.UTILITIES.generate_unique_id(),x=h.drag_started,y={},K={},z,L,E,A,M,F,w,B,I,O,H,Q,U,W,V;f||(f=["left","top","width","height"]);h.is_element=function(){return!0};h.get_HTML=function(){return A};h.get_guid=function(){return C};
h.get_text=function(){var a,b;return void 0===M&&((a=this.get_frontside_element())?M=a.textContent:(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),M=a.textContent,$(a).remove()):M=b,""===M&&a&&"IMG"!==a.nodeName&&(this.update_display(),M=a.textContent),""===M)?this.get_HTML():M};h.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",b);if(0>c)break;b+=3;d=a.indexOf("target='_blank'",
b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");return a}.bind(this);if(A===a)return!1;A=c(a);M=void 0;if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element();b.innerHTML=A;F&&this.compute_original_dimensions(!0);return!0};h.set_HTML_from_sub_classes=h.set_HTML;h.set_text=function(a){var b=
this.get_frontside_element(),c=function(d){d=$(d).contents();0===d.length?b.textContent=a:d.each(function(){this.nodeType==Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};h.get_style_attributes=function(){return f};h.set_style_attributes=function(a){f=a};h.get_attribute_widgets_in_backside_table=function(){return y};h.set_attribute_widgets_in_backside_table=
function(a){y=a};h.get_original_copies=function(){return K};h.get_pending_css=function(){return H};h.get_transform_css=function(){return Q};h.add_to_css=function(a,c){b(a)?(Q||(Q={}),Q[a]=c):(H||(H={}),H[a]=c)};h.apply_css=function(){var a="",b,c,e,f;if((b=this.get_frontside_element())&&!$(b).is(".toontalk-not-observable"))if(jQuery.contains(window.document,b)){if(this.is_plain_text_element()){H||(H={});(f=(parent=this.get_parent())&&(parent.is_nest()||parent.is_hole()||parent.is_robot()))?(e=this.get_parent().get_contents_dimensions(),
I=e.width,O=e.height,this.plain_text_dimensions(I,O)):e=I?{width:I,height:O}:{width:d.UTILITIES.get_element_width(b),height:d.UTILITIES.get_element_height(b)};if(e.width&&f){H["font-size"]=d.UTILITIES.font_size(this.get_text(),e.width,{height:e.height});H.width=e.width;H.height=e.height;H.transform="";$(b).css(H);H=void 0;return}H.width||H.height?H["font-size"]=d.UTILITIES.font_size(this.get_text(),H.width||e.width,{height:H.height||e.height}):(H["font-size"]="",H.width="",H.height="");if(!Q){$(b).css(H);
return}}if(H||Q)H?(H.width&&(I=H.width),H.height&&(O=H.height)):H={},H.position="absolute",Q&&("number"===typeof Q.rotate&&(a+="rotate("+Q.rotate+"deg)"),"number"===typeof Q.skewX&&(a+="skewX("+Q.skewX+"deg)"),"number"===typeof Q.skewY&&(a+="skewY("+Q.skewY+"deg)"),"number"===typeof Q["transform-origin-x"]||"number"===typeof Q["transform-origin-y"])&&(H["transform-origin"]=(Q["transform-origin-x"]||0)+" "+(Q["transform-origin-y"]||0)),$(b).is(".toontalk-conditions-contents")&&this.is_image_element()?
($(b).children("img").css({"max-width":"100%",height:"100%"}),$(b).css({transform:""}),H=void 0):I||O?(l(this,H),a&&d.UTILITIES.add_transform_to_css(a,"",H,0>b.parentElement.className.indexOf("toontalk-box-hole")),this.constrained_by_container()||this.is_image_element()?($(b).css({width:"",height:""}),c=H,d.UTILITIES.run_when_dimensions_known(b,function(e){var f=this.get_parent_of_frontside();l(this,c);$(b).is(".toontalk-conditions-contents")&&$(b.parentElement).is(".toontalk-conditions-container")&&
(I=$(b.parentElement).width(),O=$(b.parentElement).height());(this.ok_to_set_dimensions()||this.constrained_by_container())&&d.UTILITIES.scale_element(b,I,O,w,B,a,c,e,!f);H=void 0}.bind(this))):$(b).css(H)):(l(this,H),d.UTILITIES.add_transform_to_css(a,"",H,0>b.parentElement.className.indexOf("toontalk-box-hole")),$(b).css(H),H=void 0)}else d.UTILITIES.when_attached(b,this.apply_css.bind(this))};h.on_update_display=function(a){U?U.push(a):U=[a]};h.fire_on_update_display_handlers=function(){U&&d.UTILITIES.set_timeout(function(){U.forEach(function(a,
b){a()||U.splice(b,1)})})};h.is_image_element=function(){return 0<$(this.get_frontside_element()).children("img").length};h.get_additional_classes=function(){return n};h.set_additional_classes=function(a){n=a};h.get_children=function(){return k};h.get_child=function(a){if(k)return k[a]};h.set_sound_effect=function(a){z=a;z.volume=d.UTILITIES.get_audio_volume(z)};h.get_sound_effect=function(){return z};h.get_video_object=function(){var a;L||(a=this.get_frontside_element())&&(L=a.getElementsByTagName("video")[0]);
return L};h.set_video_object=function(a){L=a};h.get_ignore_pointer_events=function(){return r};h.set_ignore_pointer_events=function(a){r=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":"auto"})};h.get_source_URL=function(){return E};h.set_source_URL=function(a){if(E!==a)return E=a,this.refresh(),!0};h.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===w?d.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),
function(){d.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,w,B,void 0,a)}.bind(this)):d.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,w,B,void 0,a)};h.add_standard_widget_functionality(h);W=h.set_running.bind(h);h.set_running=function(a,b){W(a,b);Object.keys(y).forEach(function(c){y[c].set_running(a,b)});!a&&this.visible()&&(f.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());k.forEach(function(c){c.set_running(a,
b)})};V=h.can_run.bind(h);h.can_run=function(){var a;if(V())return!0;Object.keys(y).some(function(b){if(y[b].can_run())return a=!0});if(a)return a;k.some(function(b){if(b.can_run())return a=!0});return a};h.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;x.call(this,a,b)};h.update_display=function(){var b=this.get_frontside_element(!0);this.get_backside();var c=function(a){return this.is_image_element()?"image":$(a).is(".toontalk-plain-text-element")?
"text":"element"}.bind(this);if(!this.being_dragged&&!$(a).is(".toontalk-has-attached-callback"))if(this.get_erased()){var e;e=$(b).parent(".toontalk-backside").is("*")?c="":c="100%";this.save_dimensions();$(b).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:c,height:e,position:"",transform:""});$(b).parent(".toontalk-conditions-container").is("*")?d.UTILITIES.give_tooltip(b,"This is an element that has been erased. It will match any element."):d.UTILITIES.give_tooltip(b,
"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(b).is(".toontalk-erased-element")&&($(b).removeClass("toontalk-erased-element"),this.restore_dimensions()),this.initialize_element(),"undefined"===typeof w&&b.parentElement&&(this.is_plain_text_element()?this.plain_text_dimensions():this.compute_original_dimensions()),this.apply_css(),k?k.forEach(function(a){b.appendChild(a.get_frontside_element(!0));a.set_visible(!0);a.update_display()}):k=
[],this.fire_on_update_display_handlers(),d.open_backside_only_if_alt_key||d.UTILITIES.give_tooltip(b,"Click to see the backside where you can place robots or change the style of this "+c(b)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};h.initialize_element=function(){var a,b;!F&&(a=this.get_frontside_element())&&($(a).children(".ui-resizable-handle"),A=this.get_HTML(),b=this.is_plain_text_element(),a.innerHTML=A,$(a).addClass("toontalk-element-frontside"),b?((b=this.get_additional_classes())&&
$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element"),this.constrained_by_container()?$(a).css({width:"",height:""}):this.plain_text_dimensions()):this.is_image_element()?$(a).addClass("toontalk-image-element"):$(a).addClass("toontalk-non-plain-text-element"),F=!0)};h.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};h.plain_text_dimensions=function(a,b){this.constrained_by_container()||(this.get_frontside_element(),w=a||12*this.get_text().length,
B=b||32,this.saved_width=w,this.saved_height=B)};h.compute_original_dimensions=function(a){d.UTILITIES.original_dimensions(this,function(a,b){var c=this.get_parent_of_frontside();w=a;B=b;c&&c.get_box?c.get_box().rerender():(f.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),a)};h.get_attribute_from_current_css=function(a){var b,c;if("width"===a&&(I||w))return I||w;if("height"===a&&(O||B))return O||B;b=this.get_frontside_element(!0);c=d.UTILITIES.get_style_numeric_property(b,
a);""===c&&(c=$(b).css(a));if(!c)return 0;if("number"===typeof c){if(w&&O){if("left"===a)return c+(w-I)/2;if("top"===a)return c+(B-O)/2}return c}return"%"!==c.charAt(c.length-1)||"left"!==a&&"top"!==a?c:$(b).offset()[a]};h.get_original_width=function(){return w};h.get_original_height=function(){return B};h.increment_width=function(a){this.set_attribute("width",(I||w)+a)};h.increment_height=function(a){this.set_attribute("height",(O||B)+a)};h.get_width=function(){return I};h.get_height=function(){return O};
h.add_child=function(a){var b=$(a.get_frontside_element(!0)),c=$(this.get_frontside_element(!0)),e;k.push(a);a.set_parent_of_frontside(this);e=d.UTILITIES.set_position_relative_to_element(b,c,b.offset(),!0);a.is_element()&&a.set_location_attributes(e.left,e.top);c.get(0).dispatchEvent(d.UTILITIES.create_event("widget added",{element_widget:b.get(0),where:"front"}));this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)};h.removed_from_container=function(a,b){var c=k.indexOf(a);0<=c&&
k.splice(c,1)};h.set_HTML(c.toString());h.set_description(g);m&&("string"===typeof m?h.set_sound_effect(new Audio(m)):h.set_sound_effect(m));u&&("string"===typeof u?h.set_HTML("<video src='"+u+"'/>"):h.set_video_object(u));d.debugging&&(h._debug_id=d.UTILITIES.generate_unique_id(),h._debug_string=h.to_debug_string());k?k.forEach(function(a){a.set_parent_of_frontside(h)}):k=[];return h};a.copy=function(b){var c=this.get_style_attributes(),g=a.create(this.get_HTML(),c.slice(),this.get_description(),
d.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),k=this.get_attribute_widgets_in_backside_table(),l={},u=g.get_backside(this.visible());g.set_source_URL(this.get_source_URL());b&&(b.elements_copied||(b.elements_copied={}),b.elements_copied[this.get_guid()]=g);Object.keys(k).forEach(function(a){l[a]=k[a].copy(b);l[a].set_parent_of_frontside(u,!1,!0);g.set_attribute(a,this.get_attribute(a))}.bind(this));g.set_attribute_widgets_in_backside_table(l);
return this.add_to_copy(g,b)};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?a.match_with_another_element_widget(this):(this.last_match=a,this)};a.match_with_any_element=function(){return"matched"};a.match_with_another_element_widget=function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";
a.last_match=this;return a};a.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};a.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());return 0>a?-1:0<a?1:a};a.get_path_to=function(b,c){var d=this.get_children(),g=d.indexOf(b),k,l;if(0<=g)return a.path.create(g);d.forEach(function(d,g){d.get_path_to&&(l=d.get_path_to(b,c))&&(k=a.path.create(g),k.next=l)});return k};d.creators_from_json.element_path=function(b,c){var g=
a.path.create(b.index);b.next&&(g.next=d.UTILITIES.create_from_json(b.next,c));return g};a.dereference_path=function(a,b){var c,g;if(a){c=a.get_index&&a.get_index();if(!d.debugging||"number"===typeof c)if(g=this.get_children(),c=g[c]){if(c.dereference_contents&&!a.not_to_be_dereferenced)return c.dereference_contents(a.next||a,b);if(a.next){if(c.dereference_path)return c.dereference_path(a.next,b);d.UTILITIES.report_internal_error("Expected to refer to a child of "+c+" but it lacks a method to obtain "+
d.path.toString(a.next))}a.removing_widget&&(c.get_infinite_stack()||b.remove_from_container(c,this));return c}d.UTILITIES.report_internal_error(this+" unable to dereference the path: "+d.path.toString(a))}else return this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+d.UTILITIES.ordinal(a)+" widget "},get_json:function(b,c,d){c({type:"element_path",index:a,next:this.next&&this.next.get_json(b)},d)}}}};a.widget_side_dropped_on_me=function(a,b){if(a.is_backside())return!1;
this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};a.create_backside=function(){return d.element_backside.create(this)};a.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};a.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a),c;"left"===a?(c=this.get_frontside_element(),c=d.UTILITIES.translate_x(c)):"top"===a?(c=
this.get_frontside_element(),c=d.UTILITIES.translate_y(c)):c=0;return"undefined"!==typeof b&&"auto"!=b?b+c:this.get_attribute_from_current_css(a)+c};a.set_attribute=function(a,b,c,g){var l=this.get_frontside(!0).get_element(),u=function(b){var c=this.get_original_copies()[a];c&&c.forEach(function(a){a.set_value_from_sub_classes(bigrat.fromDecimal(b))})}.bind(this),r;if(!l)return!1;r="left"===a?d.UTILITIES.translate_x(l):"top"===a?d.UTILITIES.translate_y(l):0;l=this.get_attribute_from_pending_css(a);
b-=r;if(l===b||"undefined"===typeof l&&(l=this.get_attribute_from_current_css(a),l===b))return!1;r=k(b,a);if("number"===typeof r){if(l==r)return!1;d.logging&&0<=d.logging.indexOf("attribute:")&&0<=d.logging.indexOf(a)&&console.log("Attribute "+a+" set to "+r+" was "+l+" at "+Date.now()+" for "+this);b=r;"left"!==a&&"top"!==a||u(b)}c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:a,argument_2:b,toString:"change the '"+a+"' style to "+b+" of",
button_selector:".toontalk-element-"+a+"-attribute-input"});this.constrained_by_container()||(this.add_to_css(a,b),g&&(b=this.get_style_attributes(),0>b.indexOf(a)&&b.push(a)),this.rerender());return!0};a.dropped_on_style_attribute=function(a,b,c){var d,g,k;if(a){d=a.toString();if(a.is_number()){g=this.get_attribute(b);if("number"===typeof g)k=g;else if("auto"===g)switch(b){case "left":k=$(this.get_frontside_element()).offset().left;break;case "top":k=$(this.get_frontside_element()).offset().top;
break;default:k=0}else k=parseFloat(g);g=a.to_float();switch(d.substring(0,1)){case "-":d=k-g;break;case "*":d=k*g;break;case "/":d=k/g;break;case "^":d=Math.pow(k,g);break;default:d=k+g}this.set_attribute(b,d,!1);(c.event||c.robot&&c.robot.visible())&&this.get_backside().render()}a.get_infinite_stack()||a.remove();c.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};a.get_attribute_widget_in_backside_table=function(a,b,c){var d=this.get_attribute_widgets_in_backside_table()[a];
d||b||(d=this.create_attribute_widget(a,c),this.get_attribute_widgets_in_backside_table()[a]=d);return d};a.create_attribute_widget=function(a,b){var k=".toontalk-element-"+a+"-attribute-input",p=this.get_backside_element(),m=this.get_attribute(a),u=this,r=function(a,b){var c=b.toString,e=b.equals,f=b.remove;K=b.update_display;b.element_widget=this;b.attribute=a;b.get_type_name=function(a){return a?"element attributes":"element attribute"};b.toString=function(){return c.call(this)+" ("+this.attribute+
" of "+this.get_attribute_owner()+")"};b.get_default_description=function(){return"a number that is the "+this.attribute+" of "+this.get_attribute_owner().toString({plain_text:!0})+"."};b.get_custom_title_prefix=function(){return"I'm the '"+this.attribute+"' attribute of "+this.get_attribute_owner().toString({inside_tool_tip:!0})+" \nDrop a number on me or edit my backside to change my value. My backside has an info button to learn more."};b.equals=function(b){return a===b.attribute?this.equals(b.element_widget):
e.call(this,b)};b.update_display=function(){var a,b,c;this.get_erased()||(a=this.get_attribute_owner(),a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_element()&&!a.being_dragged&&!a.constrained_by_container()?(c={},b=bigrat.toDecimal(this.get_value()),c[this.attribute]=b,l(a,c)&&this.set_value(c[this.attribute]),$(a.get_frontside_element()).css(c)):(a=a.get_attribute(this.attribute),isNaN(a)||y(a)));K.call(this)};x=b.copy.bind(b);b.copy=function(b){var c;if(b){if(b.just_value)return x(b);
b.elements_copied&&(c=b.elements_copied[u.get_guid()])}return this.add_to_copy((c||u).create_attribute_widget(a),b)};b.get_json=function(b,c,e){d.UTILITIES.get_json(u,b,function(b,d){c({type:"attribute_widget",attribute_name:a,element:b},d)},e)};b.get_original_attribute_widget=function(){var b=u.get_original_copies()[a];return b&&b[0]};b.is_attribute_widget_copy=function(b){var c=u.get_original_copies()[a];return c&&0<=c.indexOf(b)};b.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside()){if(b.is_backside())return b;
if(!b.is_nest())return a(b.get_widget())}},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():u;if(!b.get_widget().is_element())return u;b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=b.get_parent_of_backside();return b};b.remove=function(b,c){var d=u.get_original_copies()[a],e=d&&d.indexOf(this);0<=e&&d.splice(e,1);f.call(this,b,c)};b.get_help_URL=function(){return g(a)}}.bind(this),n=function(a,
b){var c=d.number.create(0,1);r(a,c);c.set_value_from_decimal(b);c.set_format("decimal");c.set_value=function(b){try{var c=u.get_original_copies()[a],e="number"===typeof b?b:bigrat.toDecimal(b),f=bigrat.fromDecimal(e);this.get_attribute_owner().set_attribute(this.attribute,e)&&c.forEach(function(a,b){a.set_value_from_sub_classes(f,!0)});return this.set_value_from_sub_classes(f,!1)}catch(h){return d.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+h),!1}};c.is_attribute_widget=
function(){return!0};c.get_function_type=function(a){return a?"numbers":"number"};return c}.bind(this),h=function(a,b){var c=d.element.create(b);r(a,c);c.set_HTML=function(b){var c=u.get_original_copies()[a],d;this.get_attribute_owner().set_attribute(this.attribute,b)&&c.forEach(function(a,c){d=a.set_HTML_from_sub_classes(b)});return d};c.get_function_type=function(a){return a?"elements":"element"};c.set_additional_classes("toontalk-string-attribute-widget");return c}.bind(this),C;C=0<=["background-color",
"color"].indexOf(a)?"string":"number";var x,y,K,z,L;p&&(k=$(p).find(k),0<k.length&&(k.get(0).toontalk_widget_side=this));if("number"===C){if(z=n(a,m),y=z.set_value_from_decimal.bind(z),0<=c.indexOf(a)&&(this.on_update_display(function(){z.rerender();return!0}),"left"===a||"top"===a))L=function(b){var c,d,f;b.currentTarget.toontalk_widget_side===z.get_attribute_owner()&&(c=z.get_attribute_owner(),b.stopPropagation(),d=$(c.get_frontside_element()).closest(".toontalk-backside-of-top-level").offset(),
d||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),d={left:0,top:0}),f=b.pageX-d.left-(c.drag_x_offset||0),d=b.pageY-d.top-(c.drag_y_offset||0),"left"===a?(b=f,c.set_attribute("top",d)):(b=d,c.set_attribute("left",f)),z.set_value_from_decimal(b),K.call(z))},z.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",L);b&&b.get_widget().is_element()&&
b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",L)})}else if("string"===C)z=h(a,m),y=z.set_HTML.bind(z);else{d.UTILITIES.report_internal_error("Unrecognized attribute type: "+C+" for "+a);return}(m=this.get_original_copies()[a])?m.push(z):this.get_original_copies()[a]=[z];return z};d.creators_from_json.attribute_widget=function(a,b){if(a)return d.UTILITIES.create_from_json(a.element,b).create_attribute_widget(a.attribute_name,b)};d.creators_from_json.attribute_number=
d.creators_from_json.attribute_widget;a.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};a.toString=function(a){var b,c,g;if(this.get_erased())return"any element";b=function(b){var c="",d=function(a,b,c){var d=b.indexOf(a+"="),e,f;if(0<=d&&(e=b.indexOf("'",d),0<=e&&(f=b.indexOf("'",e+1)),0<=f))return b.substring(0,d)+a+"="+c+b.substring(f+1);d=b.indexOf(" ");return b.substring(0,d+1)+
a+"="+c+" "+b.substring(d+1)};if(1<b.length&&"<"===b.charAt(0)){if(0===b.indexOf("<img "))return"<img width='60' height='40' "+b.substring(4);if(this.is_image_element())c="style='width: 60px; height: 40px;'";else if(0<=b.indexOf("<iframe "))return b.indexOf("<iframe "),d("width",d("height",b,"'60'"),"'80'");a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'");return"<div "+c+">"+b+"</div>"}return'"'+b+'"'}.bind(this);c=function(){var a=this.get_HTML(),b=a.indexOf("alt="),c;return 0<=
b&&(c=a.indexOf("'",b+5),0<=c)?"("+a.substring(b+5,c)+")":""}.bind(this);g=this.get_children();if(a&&!a.inside_tool_tip&&"conditions"!==a.role){if(a.for_json_div)return"";b=c();b||(b=(b=this.get_source_URL())?"whose text is the contents of "+b:(b=this.get_text())?'"'+b+'"':"")}else b=b(this.get_HTML());g&&0<g.length&&(b+=" with "+d.UTILITIES.describe_widgets(g)+" on top");return"the element "+b};a.get_type_name=function(a){return a?"elements":"element"};a.get_help_URL=function(){return"docs/manual/elements.html"};
a.get_json=function(a,b,c){var g=this.get_style_attributes(),k=d.UTILITIES.remove_z_index(this.get_HTML()),l=encodeURIComponent(k),r=[],n;100<=k.length?(a.shared_html||(a.shared_html=[]),k=a.shared_html.indexOf(l),0>k&&(k=a.shared_html.push(l)-1),n={shared_html_index:k}):n=l;l=function(){var h=[],k=function(l){var m=function(){k(l+1)},u,z;l>=g.length?b({type:"element",html:n,attributes:g,attribute_values:g.map(this.get_attribute.bind(this)),attributes_backsides:h,additional_classes:this.get_additional_classes(),
children:0<this.get_children().length&&r,sound_effect:this.get_sound_effect()&&this.get_sound_effect().src,video:this.get_video_object()&&this.get_video_object().src,ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()},c,a):(u=g[l],(u=this.get_attribute_widget_in_backside_table(u,!0))?(z=[],h.push(z),d.UTILITIES.get_json_of_array(u.get_backside_widgets(),z,0,a,m,c)):(h.push(null),m()))}.bind(this);k(0)}.bind(this);0<this.get_children().length?d.UTILITIES.get_json_of_array(this.get_children(),
r,0,a,l,c):l()};d.creators_from_json.element=function(b,c){if(b){var g=decodeURIComponent("string"===typeof b.html?b.html:c.shared_html&&c.shared_html[b.html.shared_html_index]),l,m,u,r;b.children&&(m=c.is_child,c.is_child=!0,l=d.UTILITIES.create_array_from_json(b.children,c),c.is_child=m);if(!g&&(g="string"===typeof b.html?"No json.html recreating an element widget.":"additional_info.shared_html missing while recreating an element widget.",!d.debugging))throw g;r=a.create(g,b.attributes,b.description,
l,b.sound_effect,b.video,b.ignore_pointer_events);u=c&&c.event?["left","top"]:[];b.attribute_values.forEach(function(a,h){var g=b.attributes[h],l=b.attributes_backsides&&b.attributes_backsides[h];(c.is_child||0>u.indexOf(g))&&(0!==a||"width"!==g&&"height"!==g)&&r.add_to_css(g,k(a)||a);l&&(g=r.get_attribute_widget_in_backside_table(g,!1,c),d.UTILITIES.add_backside_widgets_from_json(g,l,c))}.bind(this));b.additional_classes&&r.set_additional_classes(b.additional_classes);b.source_URL&&(r.set_source_URL(b.source_URL),
r.refresh());l&&d.UTILITIES.when_attached(function(){l.forEach(function(a,c){var f=b.children[c]&&b.children[c].widget&&b.children[c].widget.view;f&&d.UTILITIES.set_css(a.get_frontside_element(!0),{left:f.frontside_left,top:f.frontside_top})})});return r}};a.create_attribute_path=function(a,b){var c=d.path.get_path_to(a.element_widget,b,!0);return this.extend_attribute_path(c,a.attribute)};a.refresh=function(){this.get_source_URL()&&d.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&
this.set_HTML(a.get_HTML())}.bind(this))};a.extend_attribute_path=function(a,b){return{dereference_path:function(c){return(c=a.dereference_path(c,c.get_top_level_context()||c.get_context()))&&c.get_widget().get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+b+"' property of "+d.path.toString(a)},get_json:function(c,g,k){d.path.get_json(a,c,function(a,c){g({type:"path_to_style_attribute",attribute:b,element_widget_path:a},c)},k)}}};d.creators_from_json.path_to_style_attribute=
function(b,c){var g=d.UTILITIES.create_from_json(b.element_widget_path,c);return a.extend_attribute_path(g,b.attribute)};a.set_size_attributes=function(a,b,c){c?(this.add_to_css("width",a),this.add_to_css("height",b)):(this.set_attribute("width",a),this.set_attribute("height",b));d.UTILITIES.set_timeout(function(){this.rerender();$(this.get_frontside_element()).find("iframe").attr("width",a).attr("height",b-20)}.bind(this))};a.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",
b)};a.receive_HTML_from_dropped=function(a){var b=a.get_text&&a.get_text();a.remove();if(this.set_HTML(b))return this.get_text()};a.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};a.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):
"top"===a&&(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};a.remove_style_attribute=function(a){var b=this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return a}(window.TOONTALK);window.TOONTALK.element_backside=function(b){var c=
function(a,c,e){var f;e.visible()&&(f=c.get_style_attributes(),c.get_frontside_element(),$(a).empty(),f.forEach(function(f){c.get_attribute(f);var g=document.createElement("tr"),m=document.createElement("td"),u=e.is_primary_backside()?c.get_attribute_widget_in_backside_table(f):e.get_widget().create_attribute_widget(f),r=u.get_frontside_element(!0);u.set_parent_of_frontside(e,!1,!0);u.set_infinite_stack(!0);a.appendChild(g);g.appendChild(m);m.appendChild(b.UTILITIES.create_text_element(f));m=document.createElement("td");
g.appendChild(m);u.set_visible(!0);$(r).addClass("toontalk-element-attribute");m.appendChild(r)}))},a=function(a,c){var e=$("<button>Add or remove my style attributes</button>").button();e.addClass("toontalk-show-attributes-chooser-button");e.get(0).addEventListener("click",function(f){b.UTILITIES.visible_element(a)?($(a).hide(),e.button("option","label","Add or remove my style attributes"),b.UTILITIES.give_tooltip(e.get(0),"Click to add widgets for my style attributes.")):($(a).show(),e.button("option",
"label","Hide my style attributes list"),b.UTILITIES.give_tooltip(e.get(0),"Click to hide my list of attributes that can be added or removed."));c.robot_in_training()&&c.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",c)});b.UTILITIES.give_tooltip(e.get(0),"Click to add widgets for my style attributes.");return e.get(0)};return{create:function(k){var l=b.backside.create(k),e=l.get_element();k.get_HTML();var f=document.createElement("table"),t=document.createElement("div"),
p=a(t,k),m=b.backside.create_advanced_settings_button(l,k),u=b.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),r=b.UTILITIES.get_current_url_boolean_parameter("elementHTML",!0),n=r?"get_HTML":"get_text",h=l.update_display.bind(l),C=l.add_advanced_settings,x,y,K,z,L,E,A,M,F,w;k.initialize_element();x=k[n]().trim();
0<x.length&&!k.is_image_element()&&(K=function(a){(a=b.UTILITIES.input_area_drop_handler(a,k.receive_HTML_from_dropped.bind(k),k))&&k.robot_in_training()&&k.robot_in_training().dropped_on_text_area(a,k,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},y=b.UTILITIES.create_text_area(x,"toontalk-html-input","My HTML is","Type here to edit the text.",K,void 0,!0),x=function(a){a=y.button.value.trim().replace(/\xA0/g," ");k.get_frontside_element();
var b=r?"set_HTML":"set_text";k[b](a)&&k.robot_in_training()&&k.robot_in_training().edited(k,{setter_name:b,argument_1:a,toString:'change the text to "'+a+'"',button_selector:".toontalk-html-input"})},$(y.container).css({width:"100%"}),K=60>=y.button.value.length?2:600>y.button.value.length?Math.ceil(y.button.value.length/60):10,$(y.button).css({width:"95%",height:K+"em"}),y.button.addEventListener("change",x),y.button.addEventListener("mouseout",x),k.is_plain_text_element()&&e.appendChild(y.container),
k.get_source_URL()&&(K=function(a){var c=b.UTILITIES.input_area_drop_handler(a,k.receive_URL_from_dropped.bind(k),k);c&&k.robot_in_training()&&k.robot_in_training().dropped_on_text_area(c,k,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});a.stopPropagation()},x=function(a){a=z.button.value.trim().replace(/\xA0/g," ");k.get_frontside_element();k.set_source_URL(a)&&k.robot_in_training()&&k.robot_in_training().edited(k,{setter_name:"set_source_URL",
argument_1:a,toString:'change the source URL to "'+a+'"',button_selector:".toontalk-URL-input"})},z=b.UTILITIES.create_text_input(k.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,K),z.button.addEventListener("change",x),z.button.addEventListener("mouseout",x),e.appendChild(z.container)));l.update_style_attribute_chooser=function(){var a=function(a,e,h){var k=0<=h.get_style_attributes().indexOf(a),l=b.UTILITIES.create_check_box(k,"toontalk-style-attribute-check-box",
a+"&nbsp;","Click to add or remove the '"+a+"' style attribute from my backside."),m="toontalk-style-attribute-check-box-for-"+a,k=b.UTILITIES.create_anchor_element("i",g(a)),n=document.createElement("li"),r=function(b){l.button.checked?h.add_style_attribute(a):h.remove_style_attribute(a);c(f,h,h.get_backside());h.robot_in_training()&&h.robot_in_training().edited(h,{setter_name:l.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:a,toString:(l.button.checked?"add":"remove")+
" a widget for the "+a+" attribute of",button_selector:"."+m})};$(k).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(k).css({color:"white"});k.translate=!1;k.lang="en";l.container.appendChild(k);$(l.button).addClass(m);l.button.addEventListener("click",r);l.button.addEventListener("touchstart",function(a){l.button.checked=!l.button.checked;r(a)});n.appendChild(l.container);e.appendChild(n)},e=function(b,c,d){var f,h;"string"===typeof b?a(b,c,d):b.label?(f=document.createElement("h3"),
f.textContent=b.label,h=document.createElement("ul"),c.appendChild(f),c.appendChild(h),e(b.sub_menus,h,d)):b.forEach(function(a){e(a,c,d)})};$(t).is(".ui-accordion")&&$(t).accordion("destroy");$(t).empty();e([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},{label:"Color attributes",sub_menus:["background-color","color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},
{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],t,k);$(t).accordion({active:0,heightStyle:"content"});return t};l.get_attributes_chooser=function(){return t};l.add_advanced_settings=function(){var a;C.call(l);a=$(e).children(".toontalk-advanced-settings-table");0<a.length&&(a.get(0).appendChild(u.container),a.get(0).appendChild(t),a.get(0).appendChild(p),y&&!k.is_plain_text_element()&&a.get(0).appendChild(y.container))};(A=k.get_sound_effect())?
(M=function(){l.visible()&&(A.paused?(b.UTILITIES.give_tooltip(L.get(0),"Click to begin playing this sound."),L.button("option","label","Play sound")):(b.UTILITIES.give_tooltip(L.get(0),"Click to pause this sound."),L.button("option","label","Pause sound")))},L=$("<button>Play sound</button>").button(),L.addClass("toontalk-play-sound-effect-button"),x=function(a){A.paused?(b.UTILITIES.play_audio(A),A.addEventListener("ended",M)):A.pause();M();k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",
k)},L.get(0).addEventListener("click",x),M(),e.appendChild(L.get(0))):k.get_video_object()&&(F=k.get_video_object(),w=function(a){l.visible()&&(F.paused?(b.UTILITIES.give_tooltip(E.get(0),"Click to begin playing this video."),E.button("option","label","Play video")):(b.UTILITIES.give_tooltip(E.get(0),"Click to pause this video."),E.button("option","label","Pause video")))},E=$("<button>Play video</button>").button(),E.addClass("toontalk-play-video-button"),x=function(a){F.paused?(F.play(),F.addEventListener("ended",
w)):F.pause();w();k.robot_in_training()&&k.robot_in_training().button_clicked(".toontalk-play-video-button",k)},E.get(0).addEventListener("click",x),w(),e.appendChild(E.get(0)));l.update_style_attribute_chooser();c(f,k,l);0<k.get_style_attributes().length?e.appendChild(f):k.is_plain_text_element()||e.appendChild(b.UTILITIES.create_text_element("No attributes enabled. Click the '<' below to see the advanced options."));e.appendChild(m);$(t).hide();$(t).addClass("toontalk-attributes-chooser");l.update_display=
function(){y&&$(y.button).val(k[n]());c(f,k,l);b.UTILITIES.visible_element(t)&&l.update_style_attribute_chooser();k.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});h()};$(e).find(".toontalk-hide-backside-button").each(function(a,b){b.addEventListener("click",function(){$(t).hide()})});u.button.checked=!k.get_ignore_pointer_events();u.button.addEventListener("click",function(){k.set_ignore_pointer_events(!u.button.checked)});u.button.addEventListener("touchstart",
function(){u.button.checked=!u.button.checked;k.set_ignore_pointer_events(!u.button.checked)});return l}}}(window.TOONTALK);window.TOONTALK.element["function"]=function(b){var c=b.create_function_table(),a=function(a){return a?b.UTILITIES.add_a_or_an(a.get_type_name()):"an empty hole"};c.add_function_object("join text",function(g,l){var e="";return c.typed_bird_function(g,function(){var f=arguments[arguments.length-1];for(i=0;i<arguments.length-1;i++){if(!arguments[i]||!arguments[i].get_text){c.report_error("The 'join text' bird is unable to turn "+
a(arguments[i])+" into text to join.",f);return}e+=arguments[i].get_text()}return b.element.create(e)},[void 0],"join",l)},"The bird will return with a new element that is made by joining all the elements and numbers.","join",["any number of numbers or elements"]);c.add_function_object("part of text",function(a,g){return c.typed_bird_function(a,function(a,f,g,k){if(f&&f.to_float)return f=Math.round(f.to_float()-1),g=g&&g.to_float&&Math.round(g.to_float()-1),b.element.create(a.get_text().substring(f,
g));c.report_error("The 'part of text' bird is unable to find the text in the second hole. ",k||g)},["element","number","number"],"part of text",g,2,3)},"The bird will return with a new element whose text is the part of the text of the first element (or number) beginning with the first number ending with the second number. 1 is for the first letter.","part",["an element followed by two postive numbers"]);c.add_function_object("length of text",function(g,l){return c.typed_bird_function(g,function(e,
f){if(e.get_text)return b.number.create(e.get_text().length);c.report_error("The 'length of text' bird could not turn "+a(e)+" into a text to find its length.",f)},[void 0],"length of text",l,1)},"The bird will return with a number that is length of the text of the first element (or number).","length",["an element or number"]);c.add_function_object("text as number",function(g,l){return c.typed_bird_function(g,function(e,f){var g,k;if(e&&e.get_text)return g=e.get_text(),k=g.indexOf("/"),0<=k?k=b.number.create(g.substring(0,
k),g.substring(k+1,g.length)):(k=b.number.create(0),k.set_value_from_decimal(g)),k;c.report_error("The 'text as number' bird could not turn "+a(e)+" into a text to turn it into a number.",f)},[void 0],"text as number",l,1,1)},"The bird will return with a number that has the same text as the element. Arithmetic can be done on the result unlike the original text.","text as number",["an element"]);c.add_function_object("go to page",function(b,d){return c.typed_bird_function(b,function(b,d){this.robot_in_training()?
robot.display_message("Robot trained to replace current URL."):b.get_text?window.location.assign(b.get_text()):c.report_error("The 'go to page' bird could not turn "+a(b)+" into a text to use it as a URL.",d)},["element"],"replace page",d,1,1)},"The bird will cause the current page to be replaced by the new URL. The back button should return to the current page.","page",["an element containing a URL"]);c.add_function_object("speak",b.widget.get_speak_function(c),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);c.add_function_object("listen",b.widget.get_listen_function(c),"The bird will cause the browser to listen to the next thing said and give the words to the bird in the first hole. If you put a number between 0 and 1 in the saecond hole then only recognitions with at least that confidence will be considered. if you put in the third hole words or phrases separted by | then the recogniser will expect one of those words or phrases.","listen",[]);c.add_function_object("show message",
function(g,l){return c.typed_bird_function(g,function(e,f,g){var k;f&&f.to_float&&(k={duration:1E3*f.to_float()});this.robot_in_training()?robot.display_message("Robot trained to display: "+e.get_text(),k):(e.get_text||c.report_error("The 'show message' bird could not turn "+a(e)+" into a text to display it.",g),b.UTILITIES.display_message(e.get_text(),k))},["element","number"],"show message",l,1,2)},"The bird will cause what is in the second box hole to be displayed. The third hole can be a number indicating how many seconds the message should be displayed.",
"display",["a widget","number"]);return c.get_function_table()}(window.TOONTALK)})();window.TOONTALK.sensor=function(b){var g=Object.create(b.widget),d=function(b,a){"element"===b.get_type_name()&&(b.set_additional_classes("toontalk-string-value-from-sensor"),a.visible()&&b.rerender())};g.create=function(c,a,g,l,e,f,t){var p=b.nest.create(g,l,"sensor",void 0,void 0,t||"sensor"),m=p.get_json,u=p.update_display,r=p.set_running,n=p.copy,h=a.split(" "),C,x=function(a){switch(typeof a){case "number":a=b.number.create(Math.round(a),1);break;case "string":a=b.element.create(a,void 0,void 0,
void 0,void 0,void 0,"toontalk-string-value-from-sensor");d(a,p);break;case "boolean":a=b.element.create(a.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor");d(a,p);break}return a},y=function(a){var d,e,f;if(p.get_active()){d=C(a);e=p.get_attributes();f=p.visible();a=$(p.get_frontside_element()).closest(".toontalk-backside-of-top-level");if(1===d.length){if(d=x(d[0]),"undefined"===typeof d)return}else d=b.box.create(d.length,!0,d.map(x),"the values of the "+b.UTILITIES.conjunction(e)+
" attributes of "+b.UTILITIES.add_a_or_an(c)+" event.",e.join(";"));f?(f=b.bird.create(p),p.add_to_top_level_backside(f),d.render(),f.animate_delivery_to(d,p,p,a.width()/2,a.height())):p.add_to_contents(d)}}.bind(this),K;p.is_sensor=function(){return!0};p.copy=function(a){var d;if(a&&a.just_value&&this.has_contents())return n.call(this,a);d=a?b.sensor.create(c,this.get_attributes_string(),g,void 0,a.copying_resource||e,f,this.get_name()):b.sensor.create(c,this.get_attributes_string(),g,void 0,e,f,
this.get_name());d=p.add_to_copy(d,a);d.set_active(this.get_active());return d};p.get_json=function(a,d,h){var g=function(h,g){var k;h.type="sensor";h.event_name=c;h.attribute=this.get_attributes_string();h.active=e;f?(k=function(a){h.sensor_of=a;d(h,g)},b.UTILITIES.get_json(f,a,k,g)):d(h,g)}.bind(this);m.call(this,a,g,h)};p.update_display=function(){var a=$(this.get_frontside_element());u.call(this);e||a.is(".toontalk-top-level-resource")?(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):
(a.addClass("toontalk-sensor-inactive-nest"),a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};p.get_type_name=function(a){return a?"sensors":"sensor"};p.get_help_URL=function(){return"docs/manual/sensors.html"};p.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+c+" events"};p.get_class_name_with_color=function(a){return a};p.get_active=function(){return!0===e};p.restore_active=function(){"temporarily false"===e&&this.set_active(!0)};
p.set_active=function(a,b){if(e!==a||b)!0===a?f?f.get_frontside_element(!0).addEventListener(c,y):window.addEventListener(c,y):f?f.get_frontside_element(!0).removeEventListener(c,y):window.removeEventListener(c,y),e=a};p.set_running=function(a){this.set_active(a);r.call(this,a)};p.set_active(e,!0);p.create_backside=function(){return b.sensor_backside.create(this)};p.get_event_name=function(){return c};p.set_event_name=function(a){var b=e;c&&e&&this.set_active(!1);c=a;b&&this.set_active(!0)};p.get_attributes=
function(){return h};p.set_attributes=function(a){h=a.split(" ")};p.get_attributes_string=function(){return h.join(" ")};p.match=function(a){this.last_match=a;return this};p.set_sensor_of=function(a){f=a};p.get_custom_title_prefix=function(){var a="When a '"+c+"' event"+(f?" to "+f:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";e?this.get_backside()||(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the green flag <span class='toontalk-green-flag-icon'></span> is clicked or the 'Listening to events' check box on my back is ticked.";
return a};p.get_default_description=function(){return f?"a sensor for "+f.get_default_description():"a sensor for this document."};K=p.can_run;p.can_run=function(a){return!a||K.call(this,a)};C=function(a){return p.get_attributes().map(function(c){var d=a[c];if("key"===c&&void 0===d){if(d=a.keyIdentifier,0===d.indexOf("U+"))return String.fromCharCode(a.keyCode)}else if("undefined"===typeof d){if(a.detail&&a.detail.element_widget&&("widget"===c||"back"===c))return c=b.UTILITIES.widget_side_of_element(a.detail.element_widget).create_backside(),
c.save_dimensions(),c;if(a.detail&&a.detail.element_widget&&"front"===c)return b.UTILITIES.widget_side_of_element(a.detail.element_widget);if(a.detail&&void 0!==a.detail[c])return"value changed"===a.type?b.number.create_from_bigrat(a.detail[c]):a.detail[c];d="No such attribute for "+p;p.display_message(d,{display_on_backside_if_possible:!0})}return d})};return p};b.creators_from_json.sensor=function(c,a){if(c){var g=b.sensor.create(c.event_name,c.attribute,c.description,[],!1,void 0,c.name),l;c.sensor_of?
b.UTILITIES.set_timeout(function(){g.set_sensor_of(b.UTILITIES.create_from_json(c.sensor_of,a));g.set_active(c.active)}):g.set_active(c.active);0<c.contents.length&&setTimeout(function(){l=b.UTILITIES.create_array_from_json(c.contents,a);g.set_contents(l);l.forEach(function(a){d(a.get_widget(),g)});g.rerender()},500);return g}};return g}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(b){return{create:function(g){var d=b.UTILITIES.create_text_input(g.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+g.get_event_name()),c=b.UTILITIES.create_text_input(g.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
a=b.UTILITIES.create_check_box(g.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),k=b.nest_backside.create(g),l=k.get_element(),e=function(){g.set_event_name(d.button.value.trim())},f=function(){g.set_attributes(c.button.value.trim())},t=b.backside.create_advanced_settings_button(k,g),p=function(b){var c=a.button.checked;g.set_active(c);g.robot_in_training()&&g.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:c,toString:"change to "+(c?"active":"inactive")+" of the "+g,button_selector:".toontalk-sensor-active-check-box"});g.render();b.stopPropagation()},m=k.add_advanced_settings;l.appendChild(t);k.add_advanced_settings=function(){var b;d.button.addEventListener("change",e);c.button.addEventListener("change",f);a.button.addEventListener("click",p);m.call(k,d.container,c.container);b=$(l).children(".toontalk-advanced-settings-table");0<b.length&&b.get(0).appendChild(a.container)};return k}}}(window.TOONTALK);window.TOONTALK.tool=function(b){document.addEventListener("mousemove",function(c){b.tool.pageX=c.pageX;b.tool.pageY=c.pageY});var g,d;return{get_widget_side_under_tool:function(){return g},set_last_event_type:function(b){d=b},add_listeners:function(c,a){var k,l,e,f,t,p=function(h){var g=c.getBoundingClientRect();d=void 0;a.set_held&&a.set_held(!0);f=g.height;h&&h.preventDefault();setTimeout(function(){a.held&&!a.held()||$(c).addClass("toontalk-tool-held")},200);k=$(c).offset();document.addEventListener("mousemove",
u);document.addEventListener("touchmove",u);document.addEventListener("mouseup",r);document.addEventListener("touchend",r);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_down at "+Date.now());e=l=0;$(".ui-tooltip").each(function(){$(this).hide()})},m=function(d){var f=c.getBoundingClientRect();a.held&&a.held()||p(d);l=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",d)-f.left;e=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",d)-f.top},u=function(a){g=
b.UTILITIES.find_widget_side_on_page(a,c,l,e-f/2);var d,h,k;a.preventDefault();g&&g.is_of_type("empty hole")&&(g=g.get_parent_of_frontside());$(".ui-tooltip").each(function(){$(this).hide()});h=n(a);k=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",a)-h.deltaX-l;a=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",a)-h.deltaY-e;c.style.left=k+"px";c.style.top=a+"px";b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_move at "+Date.now()+" now at "+c.style.left+
", "+c.style.top);if(g&&g.get_widget().is_top_level())t&&(b.UTILITIES.remove_highlight(),t=void 0);else{if(g&&(d=g.get_element(),d===t))return;t=d;b.UTILITIES.highlight_element(t)}},r=function(a){var d=b.UTILITIES.find_widget_side_on_page(a,c,l,e-f/2);a.preventDefault();h(c.toontalk_tool,d,a)}.bind(this),n=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,deltaY:c}},h=function(a,
e,f){var h;e&&e.is_of_type("empty hole")&&(e=e.get_parent_of_frontside());t&&b.UTILITIES.remove_highlight();e&&e.top_level_widget&&(void 0===d||d===f.type)&&(h=e.top_level_widget(),a.apply_tool(e,f),d=f.type,h.backup_all());!e&&a.nothing_under_tool&&a.nothing_under_tool();a.set_held&&a.set_held(!1);$(c).removeClass("toontalk-tool-held");$(c).addClass("toontalk-tool-returning");b.UTILITIES.add_one_shot_event_handler(c,"transitionend",1E3,function(){$(c).removeClass("toontalk-tool-returning")});k&&
b.UTILITIES.set_timeout(function(){c.style.left=k.left+"px";c.style.top=k.top+"px"});document.removeEventListener("mousemove",u);document.removeEventListener("touchmove",u);document.removeEventListener("mouseup",r);document.removeEventListener("touchend",r);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_up at "+Date.now(),alert(b.debugging),b.debugging="touch")};c.addEventListener("mousedown",m);c.addEventListener("touchstart",m);return p}}}(window.TOONTALK);window.TOONTALK.vacuum=function(b){var g=Object.create(null),d={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},c={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},a={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},k=!1,l;g.create=function(){var e,f,t,p=[],m=function(a){t!==a&&(t=a,b.sounds&&b.sounds.click.play(),$(e).removeClass(f),
f=c[t],$(e).addClass(f),u())},u=function(){"restore"===t&&0===p.length?b.UTILITIES.give_tooltip(e,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):b.UTILITIES.give_tooltip(e,d[t])};document.addEventListener("keyup",function(a){var c=String.fromCharCode(a.keyCode);if(a.altKey){if(0>"SsEeRrAa".split("").indexOf(c))return;e||(g.the_vacuum.get_element(),$(e).css({left:b.tool.pageX,top:b.tool.pageY}),document.body.appendChild(e));l()}g.the_vacuum.held()&&
("s"===c||"S"===c?m("suck"):"e"===c||"E"===c?m("erase"):"r"===c||"R"===c?m("restore"):"a"===c||"A"===c?m("suck_all"):b.sounds&&b.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){g.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});b.vacuum.the_vacuum={apply_tool:function(a,c){var d=a.get_widget(),f=function(a){c&&d.robot_in_training()&&d.robot_in_training().removed(a);a.is_primary_backside&&a.is_primary_backside()?a.hide_backside():
a===d.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):(d.is_bird()&&b.sounds&&b.sounds.bird_fly.pause(),a.is_backside()||(a.save_dimensions_of(a),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),p.push(a),a.set_running&&a.set_running(!1),a.is_backside()||a.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove({event:c,do_not_remove_children:!0}))},g,k,
l;b.tool.set_last_event_type(c.type);"suck"===t?a.remove&&!a.get_widget().is_top_level()&&(f(a),b.sounds&&b.sounds.vacuum_suck.play()):"erase"===t||"restore"===t&&a.get_erased&&a.get_erased()?a.is_top_level()||(g=!a.get_erased(),b.sounds&&(g?b.sounds.vacuum_suck.play():b.sounds.vacuum_spit.play()),a.set_erased(g,!0),c&&d.robot_in_training()&&d.robot_in_training().erased_widget(a,g)):"restore"===t?0<p.length&&(g=p.pop(),g.restore_dimensions(),l=a.add_to_top_level_backside(g),c&&d.robot_in_training()&&
d.robot_in_training().restored(g),l.toontalk_widget_side=g,k=$(e).offset(),k.left-=$(l).width(),b.UTILITIES.set_absolute_position(l,k),g.this_and_walk_children&&(g.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),b.sounds&&b.sounds.vacuum_spit.play())):"suck_all"===t&&(g=a.top_level_widget(),k=g.get_backside_widgets().slice(),0<k.length&&b.sounds&&(b.sounds.vacuum_suck.play(),b.sounds.bird_fly.pause()),b.UTILITIES.for_each_batch(k,function(a){a&&d!==d.robot_in_training()&&
f(a)}),g.set_backside_widgets([]))},nothing_under_tool:function(){m(a[t])},get_element:function(){e||(e=document.createElement("div"),$(e).addClass("toontalk-vacuum"),l=b.tool.add_listeners(e,this),m("suck"),u(),e.toontalk_tool=b.vacuum.the_vacuum);return e},held:function(){return k},set_held:function(a){var c=function(){b.UTILITIES.listen_for_speech({commands:"suck | erase | restore | remove all",success_callback:function(a,d){var e,f;if("remove all"===a)m("suck_all");else if("suck"===a||"erase"===
a||"restore"===a)m(a);else return console.log("ignoring "+a),!1;e=$(".toontalk-highlight");if(0<e.length)(e=b.UTILITIES.widget_side_of_jquery(e))&&e.top_level_widget&&(f=e.top_level_widget(),this.apply_tool(e,d),f.backup_all(),c());else if("restore"===a||"remove all"===a)f=b.tool.get_widget_side_under_tool(),this.apply_tool(f,d);return!0}.bind(this)})}.bind(this);(k=a)?c():b.UTILITIES.stop_listening_for_speech()}};return b.vacuum.the_vacuum};b.creators_from_json.vacuum=function(a,c){var d=b.vacuum.create();
a.mode&&b.UTILITIES.set_timeout(function(){d.set_mode(a.mode)});return d};return g}(window.TOONTALK);window.TOONTALK.wand=function(b){var g=Object.create(null);g.create=function(){var d=!1,c,a={apply_tool:function(a,c){var d;a.is_top_level()||(b.sounds&&b.sounds.magic.play(),d=a.add_copy_to_container(),d.update_display(),a.robot_in_training()&&a.robot_in_training().copied(a,d,!1))},get_element:function(){c||(c=document.createElement("div"),$(c).addClass("toontalk-wand"),b.UTILITIES.give_tooltip(c,"I'm a magic wand. Drag me over the thing you want me to copy."),b.tool.add_listeners(c,this),c.toontalk_tool=
a);return c},held:function(){return d},set_held:function(a){var c=function(){b.UTILITIES.listen_for_speech({commands:"copy | abracadabra",success_callback:function(a,d){var g,k;g=$(".toontalk-highlight");0<g.length&&(g=b.UTILITIES.widget_side_of_jquery(g))&&g.top_level_widget&&(k=g.top_level_widget(),this.apply_tool(g,d),b.tool.set_last_event_type(d.type),k.backup_all(),c());return!0}.bind(this)})}.bind(this);(d=a)?c():b.UTILITIES.stop_listening_for_speech()}};return a};b.creators_from_json.wand=
function(){return b.wand.create()};return g}(window.TOONTALK);window.TOONTALK.SETTINGS=function(b){var g=[],d=function(a,b){Dropbox.choose({success:b,linkType:"direct",extensions:a})},c=function(c,e,f){var t=[];b.UTILITIES.create_local_files_table(function(p){var m=function(e,g){var h=function(a){a||g.newPanel.append(b.UTILITIES.create_text_element("Error connecting to cloud. Have you logged in?"))},k=g.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();0<g.newTab.find(".toontalk-programs-in-cloud-tab-label").length?c.get_setting("save_to_dropbox")?
d([".tt.json"],function(a){b.UTILITIES.download_file(a[0].link,c.download_callback(function(){$(f).remove()}))}):k?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):a(g.newPanel,"program",c,f,h):0<g.newTab.find(".toontalk-pages-in-cloud-tab-label").length?c.get_setting("save_to_dropbox")?d([".tt.html"],function(a){g.newPanel.before($("<p><a href='"+a[0].link+"' target='_blank'>Click to open "+a[0].name+"</a></p>"))}):k?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):a(g.newPanel,"page",c,
f,h):($("#tab-0_info").show(),$("#tab-0_wrapper").show())},u;t[0]="Programs stored in browser";g[0]=p;e?(t[1]=b.UTILITIES.create_text_element("Programs in cloud","toontalk-programs-in-cloud-tab-label"),t[2]=b.UTILITIES.create_text_element("Published pages","toontalk-pages-in-cloud-tab-label"),c.get_setting("save_to_google_drive")?(g[1]=b.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),g[2]=b.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table")):(g[1]=b.UTILITIES.create_text_element("Choose a file to load."),
g[2]=b.UTILITIES.create_text_element("Choose a page to display.")),u=b.UTILITIES.create_tabs(t,g),f.appendChild(u),$(u).on("tabsactivate",m)):f.appendChild(b.UTILITIES.create_tabs(t,g));k(c,p,!0,f);$(p).on("draw.dt",function(){k(c,p,!1,f)})})},a=function(a,c,d,g,p){b.google_drive.get_toontalk_files(!1,c,function(m){var u;"string"===typeof m?u=m:m.error&&(u=m.error.message);u?"Need to authorize"===u||"Login Required"===u?b.google_drive.authorize(p):(console.log(u),console.log("Google drive status: "+
b.google_drive.get_status()),p(null)):(u="program"===c&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler",b.UTILITIES.become_file_data_table(a,m.items,!0,u),k(d,a.get(0),!0,g),a.on("draw.dt",function(){k(d,a.get(0),!0,g)}),p(a.get(0)))})},k=function(a,b,c,d){var g=function(b){var e=function(){$(d).remove()},g=function(){a.set_setting("program_name",b.target.textContent);a.load(c,e)}.bind(this);a.save(!0,void 0,g)};b=$(b).find(".toontalk-file-load-button-without-click-handler");
b.each(function(a,b){b.addEventListener("click",g)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(a){var d=document.createElement("div"),f=a.get_backside_element(),g=a.get_setting("program_name"),k=b.UTILITIES.create_text_input(g,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),m=b.UTILITIES.create_close_button(function(){$(d).remove()},"Click to close the settings panel."),u=
b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.speak?b.CHROME_APP?"Turn off spoken help":"Reload with speaking turned off":b.CHROME_APP?"Turn on spoken help":"Reload with spoken help",b.speak?"Check this if you no longer want spoken help.":"Check this if you would like ToonTalk to speak to you."),r=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.balloons?b.CHROME_APP?"Turn off help balloons":"Reload with no balloon help":b.CHROME_APP?"Turn on help balloons":
"Reload with balloon help",b.balloons?"Check this if you no longer want ToonTalk to display balloons giving tips and help.":"Check this if you would like ToonTalk to display balloons giving tips and help."),n=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.listen?b.CHROME_APP?"Turn off voice commands":"Reload with voice commands turned off":b.CHROME_APP?"Turn on voice commands":"Reload with <a href='docs/manual/voice-commands.html' target = '_blank'>voice commands</a> turned on",
b.listen?"Check this if you no longer want ToonTalk to listen to voice commands.":"Check this if you would like ToonTalk to listen for voice commadns."),h=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.TRANSLATION_ENABLED?b.CHROME_APP?"Turn off translation from English":"Reload with no translation from English":b.CHROME_APP?"Turn on translation":"Reload with over one hundred languages that ToonTalk can be translated to",b.TRANSLATION_ENABLED?"Check this if you no longer want ToonTalk to display a choice of languages.":
"Check this if you would like ToonTalk to display a menu of languages for the interface to be translated to."),C=b.UTILITIES.create_text_element("Saving and loading options"),x=b.UTILITIES.create_check_box(a.get_setting("save_to_dropbox"),"toontalk-save-setting","When saving to the cloud use my Dropbox account",'Check this if you want your programs saved to a "ToonTalk Reborn" folder in the "Apps" folder in your Dropbox.'),y=b.UTILITIES.create_check_box(a.get_setting("save_to_google_drive"),"toontalk-save-setting",
"When saving to the cloud use my Google Drive account",'Check this if you want your programs saved to a "ToonTalk Programs" folder in your Google Drive.'),K=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_cloud"),"toontalk-save-setting","Save automatically to cloud storage","Check this if you want your programs to Dropbox or Google Drive when your program changes."),z=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage",
"Check this if you want your programs automatically saved in this browser's local storage."),L=b.UTILITIES.create_button("Save to cloud storage now","toontalk-save-button","Click to save your program now to your Dropbox or your Google Drive account.",function(){a.save(!0,{google_drive:a.get_setting("save_to_google_drive"),dropbox:a.get_setting("save_to_dropbox")})}),E=b.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button","Click to save your program now to this browser's local storage.",
function(){a.save(!0,{local_storage:!0})}),A=b.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){b.google_drive.authorize(function(){$(A).remove()})}),M=b.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){a.display_message("Creating your web page...");a.publish(w,F.button.checked)}),F=b.UTILITIES.create_check_box(a.get_setting("publish_as_workspace"),
"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),w=function(c,d){var e="Published '"+a.get_setting("program_name")+"': ",f=document.createElement("span"),q=document.createElement("span"),g=b.google_drive.google_drive_url(c.id),h=window.location.protocol+"//"+window.location.host+"/ToonTalk/published.html"+window.location.search+"&replace-with-url="+encodeURIComponent(b.google_drive.google_drive_url(c.id,
!0)),m=window.document.createElement("span");b.TRANSLATION_ENABLED&&(g=b.UTILITIES.add_URL_parameter(g,"translate","1"));f.innerHTML=e+"<a href='"+g+"' target='_blank'>Download</a>";q.innerHTML="&nbsp;or&nbsp;<a href='"+h+"' target='_blank'>Edit</a>";m.appendChild(f);m.appendChild(q);e=$(k.container).children("tr");a.display_message("Your web page is ready for you to edit. Just click on the link.");0<e.length&&e.get(0).appendChild(b.UTILITIES.create_table_entry(m))},B=document.createElement("div"),
I=b.google_drive&&"undefined"!==typeof gapi?b.google_drive.get_status():"Google Drive API not loaded",O=!0,H=function(){$(d).remove();setTimeout(function(){window.TOONTALK.SETTINGS.open(a)})},Q=b.UTILITIES.create_vertical_table(M,F.container),U=function(a,c){return function(){window.location.assign(b.UTILITIES.add_URL_parameter(window.location.href,a,c?"0":"1"))}},W=function(a){return function(){b.UTILITIES.set_parameter(a,!b[a])}},V=function(a,c){return b.CHROME_APP?W(c):U(a,b[c])},J=$(k.container).children("tr");
$(d).addClass("toontalk-settings-panel").css({width:$(f).width()+29,height:$(f).height()+50,left:-2,top:-25,"z-index":9999999});d.appendChild(m);k.button.addEventListener("change",function(){var c=k.button.value.trim();g!==c&&a.save(!0,void 0,function(){g=c;a.set_setting("program_name",c);a.load(!0,function(){setTimeout(function(){$(d).css({"z-index":b.UTILITIES.next_z_index()})},500)},function(){a.save(!0,void 0,function(){$(".toontalk-settings-panel").remove();a.display_message("Your program was copied and the new copy's name is '"+
a.get_setting("program_name")+"'.")})})})});u.button.addEventListener("click",V("speak","speak"));n.button.addEventListener("click",V("listen","listen"));r.button.addEventListener("click",V("balloons","balloons"));h.button.addEventListener("click",V("translate","TRANSLATION_ENABLED"));y.button.addEventListener("click",function(b){a.save(!0,{save_to_google_drive:y.button.checked,gooogle_drive:!0});a.set_setting("save_to_google_drive",y.button.checked);y.button.checked?($(L).hide(),x.button.checked=
!1,a.set_setting("save_to_dropbox",!1),H()):x.button.checked?$(L).show():($(L).hide(),K.button.checked=!1)});x.button.addEventListener("click",function(b){a.save(!0,{save_to_dropbox:x.button.checked,dropbox:!0});a.set_setting("save_to_dropbox",x.button.checked);x.button.checked?($(L).hide(),y.button.checked=!1,a.set_setting("save_to_google_drive",!1),H()):y.button.checked?$(L).show():($(L).hide(),K.button.checked=!1)});K.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_cloud:K.button.checked,
google_drive:a.set_setting("save_to_google_drive"),dropbox:a.set_setting("save_to_dropbox")});a.set_setting("auto_save_to_cloud",K.button.checked);K.button.checked?$(L).hide():x.button.checked||y.button.checked?$(L).show():$(L).hide()});z.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_local_storage:z.button.checked,local_storage:!0});a.set_setting("auto_save_to_local_storage",z.button.checked);z.button.checked?$(E).hide():$(E).show()});F.button.addEventListener("click",function(b){a.set_setting("publish_as_workspace",
F.button.checked)});d.appendChild(B);$(C).css({"font-weight":"bold","font-size":24,color:"navy"});B.appendChild(u.container);B.appendChild(r.container);b.CHROME_APP||(B.appendChild(n.container),B.appendChild(h.container));B.appendChild(C);B.appendChild(k.container);b.CHROME_APP||(B.appendChild(y.container),B.appendChild(K.container),B.appendChild(z.container));y.container.appendChild(b.UTILITIES.create_space());y.container.appendChild(L);x.container.appendChild(b.UTILITIES.create_space());x.container.appendChild(L);
a.get_setting("auto_save_to_cloud")&&$(L).hide();z.container.appendChild(b.UTILITIES.create_space());z.container.appendChild(E);a.get_setting("auto_save_to_local_storage")&&$(E).hide();a.get_setting("save_to_google_drive")?"Need to authorize"===I?(y.container.appendChild(b.UTILITIES.create_space()),y.container.appendChild(A)):"Authorized"!==I&&"Ready"!==I&&"Authorized but not yet ready"!==I?(O=!1,a.set_setting("google_drive_unavailable",!0),setTimeout(function(){y.button.disabled=!0;$(M).button("option",
"disabled",!0);$(L).button("option","disabled",!0);b.UTILITIES.give_tooltip(y.container,"Inactivated because attempt to connect to Google Drive returned: "+I);M.title=y.container.title;L.title=y.container.title},1)):a.set_setting("google_drive_unavailable",!1):a.get_setting("save_to_dropbox")&&(O=!0);0<J.length&&J.get(0).appendChild(b.UTILITIES.create_table_entry(Q));c(a,O,d);f.appendChild(d)}}}(window.TOONTALK);
window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",save_to_google_drive:!0,auto_save_to_cloud:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(b){var g=[],d=0,c=!1,a=!1;return{pending_update:function(a){0<=g.indexOf(a)||(g.push(a),this.update_display())},update_display:function(){var k;a||document.hidden||0===g.length||(k=Date.now(),k<d?(a=!0,setTimeout(this.update_display_workhorse.bind(this),d-k)):c||(a=!0,b.UTILITIES.set_timeout(function(){this.update_display_workhorse(k)}.bind(this))))},update_display_workhorse:function(k){var l=g,e=function(a,b){$(a).children().each(function(a,c){$(c).is(".toontalk-side")&&
($(c).css({"z-index":b+1}),e(c,b+1))})};g=[];c=!0;a=!1;d=(k|Date.now())+50;b.UTILITIES.for_each_batch(l,function(a){var c=a.get_element&&a.get_element(),d,g,k;c&&(a.visible()||$(c).is(".toontalk-top-level-resource"))&&($(c).is(".toontalk-not-observable")?b.DISPLAY_UPDATES.pending_update(a):$(c).is(".toontalk-has-attached-callback")?c.parentElement&&c.toontalk_attached_callback&&(c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0):($(c).show(),a.update_display(),a.get_backside&&(g=
a.get_backside())&&g.visible()&&g.update_display(),setTimeout(function(){b.UTILITIES.use_custom_tooltip(c)}),d=$(c).parent().closest(".toontalk-side"),d.is("*")&&0===d.find(".toontalk-side-animating, .toontalk-side-appearing").length&&(g=b.UTILITIES.get_style_numeric_property(c,"z-index"),k=b.UTILITIES.get_style_numeric_property(d.get(0),"z-index"),k||(k=b.UTILITIES.next_z_index(),d.css({"z-index":k})),!g||d.is(".toontalk-backside-of-top-level")?(g=b.UTILITIES.next_z_index(),$(c).css({"z-index":g})):
g>=k&&(g=k+1,$(c).css({"z-index":g})),e(c,g)),c&&!$(c).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&b.UTILITIES.set_timeout(function(){d.is(".toontalk-box-hole")?$(c).is(".ui-resizable")&&$(c).resizable("destroy"):$(c).is(".ui-resizable")||b.UTILITIES.make_resizable($(c),a)})))});c=!1;0<g.length&&(a=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),
50))}}}(window.TOONTALK);window.TOONTALK.actions=function(b){b.creators_from_json.body=function(g,d){var c=b.actions.create();d.body=c;c.initialise_steps(b.UTILITIES.create_array_from_json(g.steps,d));return c};return{create:function(g){var d=Object.create(this),c=[];g||(g=[]);d.copy=function(){return b.actions.create(b.UTILITIES.copy_array(g))};d.get_steps=function(){return g};d.initialise_steps=function(a){g=a};d.is_empty=function(){return 0===g.length};d.reset_steps=function(){g=[];this.reset_newly_created_widgets()};
d.reset_newly_created_widgets=function(){b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+c.length);c=[]};d.add_step=function(a,c){a?(g.push(a),c&&this.add_newly_created_widget_if_new(c)):b.UTILITIES.report_internal_error("Attempt to add an undefined step.")};d.add_newly_created_widget_if_new=function(a){0<=c.indexOf(a)||this.add_newly_created_widget(a)};d.add_newly_created_widget=function(a){b.debugging&&0<=c.indexOf(a)?console.log("add_newly_created_widget called with not new widget."):
(c.push(a),b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Added "+a.to_debug_string(50)+" to list of newly_created_widgets. Length is "+c.length))};d.is_newly_created=function(a){return 0<=c.indexOf(a)};d.get_newly_created_widgets=function(){return c};d.get_path_to=function(a,d,g){var e,f;c.some(function(c,p){if(c===a||g&&c===a)return e=b.newly_created_widgets_path.create(p),!0;if(c.get_path_to&&(f=c.get_path_to(a,d)))return e=b.newly_created_widgets_path.create(p),e.next=f,!0});return e};
d.dereference_path=function(a){b.debugging&&!c[a]&&b.UTILITIES.report_internal_error("Expected to find the "+b.UTILITIES.ordinal(a)+" newly created widget.");return c[a]};return d},run_unwatched:function(g,d){var c=this.get_steps();b.logging&&0<=b.logging.indexOf("run")&&console.log(g.to_debug_string(50)+" running unwatched");d||(d=0);g.run_next_step=function(a){if(!this.stopped())if(d<c.length){var k=c[d];d++;b.logging&&0<=b.logging.indexOf("event")&&console.log(k+" (unwatched) at "+Date.now()+" by robot "+
g.get_name());a?(g.run_watched_step_end_listeners(),k.run_watched(g)):k.run_unwatched(g)}else g.set_running_or_in_run_queue(!1),g.run_body_finished_listeners(),g.get_run_once()?g.get_first_in_team().set_running(!1):g.get_first_in_team().run()};g.run_next_step()},run_watched:function(g){var d=this.get_steps(),c=g.get_frontside_element(),a,k,l=c.parentElement,e=g.get_first_in_team(),f=function(){var a=e.visible(),d=function(){a&&(l&&l.appendChild(c),g.set_animating(!1));e===g?b.UTILITIES.set_absolute_position(c,
p):(b.UTILITIES.set_css(c,{position:"static"}),k.get_backside(!0).get_next_robot_area().appendChild(c));g.get_run_once()?e.set_running(!1):g.stopped()?$(c).removeClass(".toontalk-side-animating"):e.run();g.rerender()};a?(c.parentElement||g.get_parent_of_frontside().get_frontside_element().appendChild(c),b.UTILITIES.animate_to_absolute_position(c,p,d,g&&g.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED))):(g.set_animating(!1),d(),g===e&&g.get_context().add_backside_widget(g),$(g.get_frontside_element()).remove())},
t=0,p=$(c).offset(),m=$(c).offset(),u=$(c).width(),r=$(c).height(),n=g.get_first_in_team().top_level_widget(),h=$(c).closest(".toontalk-backside-of-top-level").offset(),C=g.get_context().get_backside(),x,y;b.logging&&0<=b.logging.indexOf("run")&&console.log(g.to_debug_string(50)+" running watched");x=(k=g.get_previous_robot())?$(k.get_backside(!0).get_next_robot_area()):$(C.get_backside_element(!0));!b.UTILITIES.is_attached(c)&&k&&(k.open_backside(),k.get_backside().set_advanced_settings_showing(!0),
(a=c.parentElement)||(a=x.get(0)),g.set_visible(!0),g.update_display(),g.add_body_finished_listener(function(){a&&a.appendChild(c);$(c).css({left:"",top:"",position:"","z-index":""})}));0===u&&($(c).css({width:"",height:""}),u=g.saved_width||$(c).width(),r=g.saved_height||$(c).height());h||(h={left:0,top:0});0<x.length&&(y=x.get(0).getBoundingClientRect(),p.left<y.left-h.left||p.top<y.top-h.top||p.left+u>y.right+h.left||p.top+r>y.bottom+h.top)&&(p=x.offset(),p.left+=x.width()/2,p.top+=x.height()-
r,m=p);g.start_offset=m;n.get_backside_element().appendChild(c);b.UTILITIES.set_absolute_position(c,p);g.run_next_step=function(){C&&!document.hidden&&(C.visible()||b.UTILITIES.visible_element(C.get_element()))?setTimeout(function(){var a;g.run_watched_step_end_listeners();t<d.length&&!g.stopped()?(a=d[t],t++,b.logging&&0<=b.logging.indexOf("event")&&console.log(a+" (watched)"),a.run_watched(g)):(g.set_running_or_in_run_queue(!1),f(),g.run_body_finished_listeners())},g.transform_step_duration(b.animation_settings.PAUSE_BETWEEN_STEPS)):
(g.set_running_or_in_run_queue(!1),g.set_animating(!1),$(c).css({width:"",height:""}),c.style.transitionDuration="",l&&l.appendChild(c),this.run_unwatched(g,t))}.bind(this);g.set_animating(!0,p);g.run_next_step();return!0},toString:function(b){for(var d="",c=this.get_steps().map(function(a){return a&&a.toString(b)});""===c[c.length-1];)c.pop();c.forEach(function(a,b){a&&(d+=a,d=b===c.length-2?d+" and \n":b<c.length-2?d+", \n":d+".")});return d},get_json:function(g,d,c){var a=[];b.UTILITIES.get_json_of_array(this.get_steps(),
a,0,g,function(){d({type:"body",steps:a},c)},c)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(b){b.creators_from_json.newly_created_widgets_path=function(g){return b.newly_created_widgets_path.create(g.index)};return{create:function(g){return{dereference_path:function(d){var c=d.get_body().dereference_path(g),a;if(this.next)return b.path.dereference_path(this.next,d,c);this.removing_widget&&((a=c.get_parent_of_frontside())&&a.is_hole()&&(a=a.get_parent_of_frontside()),a&&a.removed_from_container&&d.remove_from_container(c,a));return c},toString:function(){return"the "+
b.UTILITIES.ordinal(g)+" new widget"},get_json:function(b,c,a){c({type:"newly_created_widgets_path",index:g},a)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(b){var g=function(a,b,c){if(!c||!c.running_watched||!a.get_backside())return!0;a.get_backside().hide_backside()},d={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,b,c){if(a.get_infinite_stack())return d["pick up a copy of"](a,b);c&&c.running_watched||a.set_parent(void 0);b.set_thing_in_hand(a);return!0},"pick up a copy of":function(a,b){var c=a.copy();b.add_newly_created_widget(c);b.set_thing_in_hand(c);return!0},"drop it on":function(a,
c,d){var e;if(a)if(e=c.get_thing_in_hand()){if(e.drop_on)return b.debugging&&e===a&&b.UTILITIES.report_internal_error("Dropping something on itself! "+a),a.visible()||$(e.get_frontside_element()).remove(),e.drop_on(a,{robot:c}),c.set_thing_in_hand(void 0),a.rerender(),c.add_newly_created_widget_if_new(e),e.robot_waiting_before_next_step===c?(d&&d.running_watched||(e.robot_waiting_before_next_step=void 0),!1):!0;b.debugging&&b.UTILITIES.report_internal_error("Thing in robot's hand ("+e+") doesn't handle 'drop_on'. Robot that "+
c)}else!c.being_trained&&b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but has nothing in its hand.");else b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(a,c,d){var e;if(a){if(e=c.get_thing_in_hand())return c.set_thing_in_hand(void 0),a[d.setter](e),!0;b.UTILITIES.report_internal_error("The robot that '"+
c.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},remove:function(a,b){a.remove();a===b?b.set_stopped(!0):b.add_newly_created_widget_if_new(a);return!0},restore:function(a,b){b.add_to_top_level_backside(a);a.get_element().toontalk_widget_side=a;return!0},"change whether erased":function(a,b,c){if(a.set_erased)return a.set_erased(!a.get_erased()),
!0;a.display_message("Robot is unable to erase "+a)},edit:function(a,c,d){if(a[d.setter_name])return d.argument_2?a[d.setter_name].call(a,d.argument_1,d.argument_2,a.visible()):a[d.setter_name].call(a,d.argument_1,a.visible()),!0;b.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c){return!0},"add to the top-level backside":function(a,c,d){var e;if(!d||!d.running_watched){e=c.top_level_widget();e.add_backside_widget(a);d=c.get_context();if(!d.visible())return;
e=e.get_backside_element();d=a.get_frontside_element(!0);$(d).css(b.UTILITIES.random_location_inside(e,50));e.appendChild(d);a.animate_to_element(e,void 0,c.transform_animation_speed(b.animation_settings.ANIMATION_SPEED))}return!0},"add a new widget to the work space":function(a,c,d){c.get_context().is_top_level()?(d=c.add_to_top_level_backside(a),c=$(c.get_frontside_element()).offset(),a.update_display(),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c,!0)):a.drop_on(c.get_context().get_backside(!0),
{robot:c});return!0},"start training":function(a,b,c){c&&c.running_watched||(a.initialize_backside_conditions(),a.get_body().reset_steps(),b.robot_started_training(a));a.training_started(b);return!0},"stop training":function(a,b,c){a.training_finished();return!0},train:function(a,b,c){a.add_step(c.step);return!0},"open the backside":function(){return!0},"open the backside of":function(){return!0},"close the backside of":g,"close the backside":g,"click the button of":function(a,b,c){".toontalk-green-flag"!==
c.button_selector||c&&c.running_watched||a.set_running(!0);return!0}},c=function(a,c,d,e){var f=c.get_thing_in_hand(),g=c.get_frontside_element(),k=a.get_element(),l=function(a,b,c){return c.some(function(c){if(Math.abs(c-a)<=b)return!0})},m,p,t,u,F,w,B;k||(k=b.UTILITIES.find_resource_equal_to_widget(a,c));b.UTILITIES.is_attached(k)&&c.visible()?(m=k.getBoundingClientRect(),e&&e.left_offset_fraction?(c.original_animation_left_offset||(c.original_animation_left_offset=[]),c.original_animation_top_offset||
(c.original_animation_top_offset=[]),u=e.left_offset_fraction*m.width,F=e.top_offset_fraction*m.height,f&&(w=f.get_element(),b.UTILITIES.visible_element(w)&&(B=$(w).offset(),g=$(g).offset(),u-=B.left-g.left,F-=B.top-g.top)),f&&l(u,c.last_thing_in_hand_width,c.original_animation_left_offset)&&0<=c.original_animation_top_offset.indexOf(F)?(u=c.animation_left_offset+c.last_thing_in_hand_width,F=c.animation_top_offset,u>=m.width&&(u=0,F+=c.max_thing_in_hand_height,F>=m.height&&(F=0)),b.UTILITIES.when_attached(w,
function(){c.last_thing_in_hand_width=b.UTILITIES.get_element_width(w);"undefined"===typeof c.max_thing_in_hand_height&&(c.max_thing_in_hand_height=0);c.max_thing_in_hand_height=Math.max(c.max_thing_in_hand_height,$(w).height())})):(c.original_animation_left_offset.push(u),0>c.original_animation_top_offset.indexOf(F)&&c.original_animation_top_offset.push(F),c.last_thing_in_hand_width=b.UTILITIES.get_element_width(w),c.max_thing_in_hand_height=b.UTILITIES.get_element_height(w)),k.animation_left_offset=
u,k.animation_top_offset=F,c.animation_left_offset=u,c.animation_top_offset=F):(p=m.width/2,t=m.height/2),c.animate_to_widget(a,d,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),p,t,!0,c.transform_original_step_duration(e&&e.time),c)):d()},a=function(a,b,d,e){c(a,b,function(){a.open_backside(d);p(a,b)},e)},k=function(a,b){var c=a.get_backside_element(!0);return $(c).find(b).get(0)},l=function(a,c,d,e,f,g){var l=k(a,e);c.get_frontside_element();var m=l&&b.UTILITIES.visible_element(l),
t=function(){d(l);$(l).addClass("ui-state-active");if(".toontalk-select-function"===e||".toontalk-box-size-input"===e)l.value=f.argument_1;setTimeout(function(){$(l).removeClass("ui-state-active");b.UTILITIES.remove_highlight();c.run_next_step(!0)},g)},u=function(){var d;b.UTILITIES.visible_element(l)||(d=a.get_backside(!0),d.set_advanced_settings_showing(!0,d.get_element()));c.animate_to_element(l,t,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0,c.transform_original_step_duration(f&&
f.time))};b.UTILITIES.highlight_element(a.get_frontside_element());!m&&a.open_backside&&c.animate_consequences_of_actions()?a.open_backside(u,c.transform_step_duration(b.animation_settings.OPEN_BACKSIDE_DURATION))&&p(a,c):u()},e=function(a,c,d,e,g){var k=b.UTILITIES.closest_element($("."+g),$(c.get_frontside_element()).offset()),l=function(){f(a,c,d,e)};k&&c.animate_consequences_of_actions()&&0<$("."+g).length?c.animate_to_element(k,l,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),
0,0,!0):l()},f=function(a,c,d,e){c.get_frontside_element();var f=function(){c.carrying_tool=void 0;c.update_display();d();c.run_next_step(!0)},g;c.animate_consequences_of_actions()?(c.carrying_tool=e,c.update_display(),e=c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),a?c.animate_to_element(a.get_element(),f,e,0,0,!0):(g=c.top_level_widget().get_element(),a=$(g).offset(),a.left+=$(g).width()*(.1+.8*Math.random()),a.top+=$(g).height()*(.1+.8*Math.random()),c.animate_to_absolute_position(a,
f,e,!0))):(d(),c.run_next_step(!0))},g=function(a,b,c){var d=a.get_parent_of_frontside();e(a,b,function(){c();d&&"top-level"!==d.get_widget().get_type_name()&&d.update_display&&d.update_display();a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")},t=function(a,c,d){a.open_backside(function(){d();c.run_next_step(!0)},b.animation_settings.OPEN_BACKSIDE_DURATION);p(a,c)},p=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},m=function(a,
c,d,e){e=e&&e.time?c.transform_original_step_duration(e.time):c.transform_step_duration(b.animation_settings.CLOSE_BACKSIDE_DURATION);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();d();c.run_next_step(!0)},e)},u={copy:function(a,b,c){e(a,b,function(){c();a.add_copy_to_container(b.get_recently_created_widget())},"toontalk-wand-small","toontalk-wand")},"pick up":function(a,d,e,f){var g=function(){e();d.animate_consequences_of_actions()&&d.update_display();
d.run_next_step(!0)};b.debugging&&"empty hole"===a.get_type_name()?b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):a.save_dimensions()&&d.animate_consequences_of_actions()?c(a,d,g,f):g()},"pick up a copy of":function(a,d,e,f){c(a,d,function(){var c;e();d.animate_consequences_of_actions()&&(c=d.get_recently_created_widget())&&(c.set_visible(!0),b.UTILITIES.copy_frontside_dimensions(a,c),d.update_display());d.run_next_step(!0)},f)},"drop it on":function(d,e,f,g){var k=e.get_thing_in_hand(),
l,m;k?(b.debugging&&k===d&&b.UTILITIES.report_internal_error("Dropping something on itself!"),l=k.get_element(!0),k.set_visible(e.visible()),m=function(){var a;$(l).removeClass("toontalk-held-by-robot");k.drop_on&&(e.animate_consequences_of_actions()&&!b.UTILITIES.visible_element(l)&&(a=$(e.get_frontside_element()).closest(".toontalk-backside-of-top-level"),0<a.length&&a.get(0).appendChild(l)),e.rerender());f();k.drop_on&&k.visible()&&(b.UTILITIES.set_absolute_position(l,$(l).offset()),k.restore_dimensions());
k.robot_waiting_before_next_step!==e&&e.run_next_step(!0)},d.is_backside()&&!b.UTILITIES.visible_element(d.get_element())?a(d.get_widget(),e,m,g):c(d,e,m,g)):(b.debugging&&(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+e)),c(d,e,f,g))},"drop it on the text area of":function(d,e,f,g){var k=e.get_thing_in_hand(),l,m,p,t;k?(l=k.get_element(!0),k.set_visible(e.visible()),m=function(){var a;$(l).removeClass("toontalk-held-by-robot");f();k.remove();
a=d.get_parent_of_frontside().get_widget();a.is_hole()&&(a=a.get_parent_of_frontside());a.is_top_level()?d.render():a.render();e.set_thing_in_hand(void 0);e.run_next_step(!0)},p=function(){return $(d.get_backside_element()).find(g.area_selector).get(0)},e.rerender(),b.UTILITIES.visible_element(d.get_backside_element())?(t=p(),e.animate_to_element(t,m,e.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED/2),0,0,!0)):a(d,e,function(){t=p();e.animate_to_element(t,m,e.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED/
2),0,0,!0)},g)):(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+e),c(d,e,f,g))},remove:g,"change whether erased":g,restore:function(a,c,d){e(void 0,c,function(){b.UTILITIES.set_css(a.get_element(!0),$(c.get_frontside_element()).position());d()},"toontalk-vacuum-ready-small","toontalk-vacuum")},edit:function(a,c,d,e){l(a,c,function(){a.get_backside()&&a.get_backside().update_display();d()},e.button_selector,e,c.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))},
"change size of":function(a,c,d,e){var f=a.get_frontside_element();f?c.animate_to_element(f,function(){var g=f.getBoundingClientRect(),k=g.width*e.x_factor,g=g.height*e.y_factor,l=c.transform_step_duration(b.animation_settings.CHANGE_SIZE_DURATION);$(f).addClass("toontalk-animating-element");f.style.transitionDuration=l+"ms";f.style.width=k+"px";f.style.height=g+"px";setTimeout(function(){$(f).removeClass("toontalk-animating-element");f.style.transitionDuration="";d();a.render();c.run_next_step(!0)},
l)},c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0):(d(),c.run_next_step(!0))},"add to the top-level backside":function(a,b,c){c();b.run_next_step(!0)},"add a new widget to the work space":function(a,c,d,e){e&&e.button_selector?(a=b.path.dereference_path(e.path_to_source,c),l(a,c,d,e.button_selector,e,c.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))):(d(),c.run_next_step(!0))},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();
c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by={element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step(!0)},"stop training":function(a,c,d,e){var f=a.get_frontside_element();l(a,c,function(){var e=function(){f.toontalk_return_to=void 0;a.get_backside().change_label_and_title_of_train_button(!1);$(f).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");
f.toontalk_followed_by=void 0;setTimeout(d,c.transform_step_duration(b.animation_settings.STOP_TRAINING_DELAY))};f.toontalk_return_to?b.UTILITIES.animate_to_absolute_position(f,f.toontalk_return_to,e,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED)):e()},".toontalk-train-backside-button",e,c.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))},train:function(a,b,c,d){var e=function(){c();b.run_next_step(!0)};(d=d.step.run_watched)?(a.run_next_step=e,a.set_context(a.get_parent_of_frontside().get_widget()),
d(a)):e()},"open the backside":t,"open the backside of":t,"close the backside of":m,"close the backside":m,"click the button of":function(a,b,c,d){l(a,b,function(d){$(d).is(".toontalk-settings-backside-button")&&">"===d.innerText&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().set_advanced_settings_showing(!1,a.get_backside_element())});$(d).click();c()},d.button_selector,d)}};b.creators_from_json.robot_action=function(a,c){return a.additional_info?b.robot_action.create(b.UTILITIES.create_from_json(a.path,
c),a.action_name,b.UTILITIES.create_keys_from_json(a.additional_info,c)):b.robot_action.create(b.UTILITIES.create_from_json(a.path,c),a.action_name)};return{create:function(a,c,e){var f=Object.create(this),g=d[c],k=u[c];if(k)return a||b.UTILITIES.report_internal_error("path undefined in "+c+" action"),g||b.UTILITIES.report_internal_error("no run_function for "+c),f.get_action_name=function(){return c},f.get_additional_info=function(){return e},f.run_unwatched=function(c){var d=b.path.dereference_path(a,
c);if(!d)return b.UTILITIES.report_internal_error("Unable to dereference path: "+b.path.toString(a)+" in context: "+c.get_context()),!1;b.logging&&0<=b.logging.indexOf("event")&&(d.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+d.wait_until_this_nest_receives_something.to_debug_string(50)+"("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)):console.log("   "+d.to_debug_string(50)+" ("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)));
d.wait_until_this_nest_receives_something?d.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.visible()?this.run_watched(c):this.run_unwatched(c)}.bind(this),c):g(d,c,e)&&c.run_next_step()},f.run_watched=function(c){var d=b.path.dereference_path(a,c),f=function(){if(!c.stopped()||c.being_trained)e||(e={}),e.running_watched=!0,g(d,c,e)};d?(b.logging&&0<=b.logging.indexOf("event")&&console.log("   "+d+" ("+b.path.toString(a)+" "+(d.to_debug_string?d.to_debug_string(50):d)+" by watched "+
c.to_debug_string(50)+(c.animate_consequences_of_actions()?"":" finishing instantly")),d.wait_until_this_nest_receives_something?(d.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.set_waiting(!1);this.run_watched(c)}.bind(this),c),c.set_waiting(!0),TOONTALK.UTILITIES.visible_element(c.get_context().get_backside_element())||c.get_frontside().remove()):k(d,c,f,e)):b.UTILITIES.report_internal_error("Unable to dereference the path: "+b.path.toString(a)+" in context: "+c.get_context())},
f.toString=function(d){var f="",g="",k=c,l;if("open the backside"===c||"close the backside"===c)c+=" of";if("click the button of"===c)switch(e.button_selector){case ".toontalk-green-flag":k="click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" of";break;case ".toontalk-stop-sign":k="click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":k=
"click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":k="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":k="click the button to add or remove attributes of ";break;case ".toontalk-remove-backside-and-widget-buttton":k="click the button to remove the back and front of ";break;default:k="click a button of"}if("add a new widget to the work space"===c)return c.replace("a new widget",b.path.toString(a));if("add to the top-level backside"===
c)return"";d||(d={});l=b.path.toString(a,d);if("edit"===c||"drop it on the text area of"===c)f=" ("+e.toString+")";else if("train"===c){f=e.step.toString({person:"third"});if(""===f)return f;f=" to "+f;g="- ";d&&d.robot_being_trained_description&&(l=d.robot_being_trained_description)}else"start training"===c?d&&(d.robot_being_trained_description="it"):"stop training"===c&&(l=d.robot_being_trained_description,d.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(c)){if(0<=
l.indexOf("hole of"))return g+k+" what is in "+l+f;if(0===l.indexOf("a When"))return l=l.substring(3),l=b.UTILITIES.remove_encoded_HTML(l),l=b.UTILITIES.elide(l,80,1),"."===l[l.length-1]&&(l=l.substring(0,l.length-1)),g+k+" a robot who w"+l+f+"\n"}return g+k+" "+l+f},f.get_json=function(d,f,g){var k=function(e,g){b.path.get_json(a,d,function(a,b){f({type:"robot_action",action_name:c,path:a,additional_info:e},b)},g)};e?b.UTILITIES.get_json_of_keys(e,["running_watched"],k,g):k(void 0,g)},f;b.UTILITIES.report_internal_error("No watched function for "+
c)}}}(window.TOONTALK);window.TOONTALK.queue=function(b){var g={create:function(){var d=Object.create(this);d.to_run=b.UTILITIES.create_queue();d.run_function=d.run.bind(d);return d},enqueue:function(b){b.running_or_in_run_queue()||(b.set_running_or_in_run_queue(!0),this.to_run.enqueue(b)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var d=Date.now()+g.maximum_run,c;for(this.running=!0;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<d;)c=this.to_run.dequeue(),c.run_actions();this.to_run.isEmpty()?this.running=!1:b.UTILITIES.set_timeout(this.run_function)}};return g}(window.TOONTALK);window.TOONTALK.path=function(b){var g;b.creators_from_json["path.to_entire_context"]=function(d,c){return b.path.to_entire_context()};b.creators_from_json["path.to_thing_in_hand"]=function(){return b.path.to_thing_in_hand()};b.creators_from_json["path.to_widget_on_nest"]=function(){return b.path.to_widget_on_nest()};b.creators_from_json["path.top_level_backside"]=function(){return b.path.top_level_backside};b.creators_from_json["path.to_backside_widget_of_context"]=function(d,c){return"undefined"===
typeof d.backside_index?b.path.get_path_to_backside_widget_of_context(d.type_name,c&&c.robot):b.path.get_path_to_backside_index_of_context(d.backside_index,d.type_name,c&&c.robot)};b.creators_from_json["path.to_resource"]=function(d,c){return b.path.get_path_to_resource(b.UTILITIES.create_from_json(d.resource,c))};return{get_path_to:function(d,c,a){var g=function(c,d){var f=d.get_training_context(),g=d.get_body(),k=function(a){a=a.get_widget();var f;if(a===c||a.top_contents_is&&a.top_contents_is(c))return d.add_to_backside_conditions(a),
m=b.path.get_path_to_backside_widget_of_context(a,d),m.is_backside=r,!0;if(a.get_path_to&&(f=a.get_path_to(c,d)))return f.is_backside=r,d.add_to_backside_conditions(a),m=b.path.get_path_to_backside_widget_of_context(a,d),m.next=f,!0},m,u,r;c.is_primary_backside&&c.is_primary_backside()&&(r=!0,c=c.get_widget());if(f===c)return m=b.path.to_entire_context(),m.is_backside=r,m;if(d.get_thing_in_hand()===c)return b.path.to_thing_in_hand();u=c.get_type_name();if("top-level"===u)return b.path.top_level_backside;
if(m=g.get_path_to(c,d,a))return m.is_backside=r,m;if("element attribute"===u&&c.is_attribute_widget_copy(c))return m=b.element.create_attribute_path(c,d),m.is_backside=r,m;if(b.debugging&&!f)b.UTILITIES.report_internal_error("No context to compute the path");else{if(f.get_path_to&&(g=f.get_path_to(c,d)))return g.is_backside=r,m=b.path.to_entire_context(),m.next=g,m;f.get_backside_widgets().some(k);if(m)return m.is_backside=r,m;if(f=c.ancestor_of_type("robot"))return b.robot.find_conditions_path(c,
f,d);m=b.path.get_path_to_resource(c.dereference().copy());m.is_backside=r;return m}}(d,c,a);g&&d.dereference_contents&&(b.path.path_end(g).not_to_be_dereferenced=!0);!g||"pick up"!==c.current_action_name&&"remove"!==c.current_action_name||(b.path.path_end(g).removing_widget=!0);return g},path_end:function(b){for(;b.next;)b=b.next;return b},dereference_path:function(b,c,a){var g;b?b.dereference_path?g=b.dereference_path(c,a):a&&a.dereference_path&&(g=a.dereference_path(b,c)):g=a||c.get_context();
return g&&b&&b.is_backside?g.get_backside(!0):g},continue_dereferencing_path:function(b,c,a){void 0===c&&a.context_is_backside()&&(c=a.get_top_level_context());void 0===c&&(c=a.get_context());return b.next?c.dereference_contents&&!b.next.not_to_be_dereferenced?(c=c.dereference_contents(b.next,a))&&b.is_backside?c.get_backside(!0):c:(c=c.dereference_path(b.next,a))&&b.next.is_backside?c.get_backside(!0):c:c.dereference_contents&&!b.not_to_be_dereferenced?(c=c.dereference_contents(b,a))&&b.is_backside?
c.get_backside(!0):c:c},toString:function(d,c){var a="",g;if(!d)return"undefined path";d.is_backside&&(a="the backside of ");c||(c={});g=c.resource;c.resource=!0;d.next?(b.path.toString(d.next,c),a=a+b.path.toString(d.next,c).trim()+" of "+d.toString(c)):a+=d.toString(c);c.resource=g;return a},get_json:function(d,c,a,g){var l,e;d.get_json?(l=function(f,g){d.is_widget&&(f=d.add_to_json(f,c));d.next&&(e=function(a){f.next_path=a},b.path.get_json(d.next,c,e,g));d.removing_widget&&(f.removing_widget=
!0);d.not_to_be_dereferenced&&(f.not_to_be_dereferenced=!0);if(!0===d.is_backside||d.is_backside&&d.is_backside())f.is_backside=!0;a(f,g)},d.get_json(c,l,g)):a(d,g)},to_entire_context:function(d){return{dereference_path:function(c,a){return b.path.continue_dereferencing_path(this,a,c)},toString:function(b){return b&&b.robot?b.robot.get_top_level_context_description(b):b&&"third"===b.person?"what he's working on":"what I'm working on"},get_json:function(b,a,d){a({type:"path.to_entire_context"},d)}}},
to_widget_on_nest:function(){return{dereference_path:function(d,c){return b.path.continue_dereferencing_path(this,c,d)},toString:function(){return"what is on the nest"},get_json:function(b,c,a){c({type:"path.to_widget_on_nest"},a)}}},to_thing_in_hand:function(){return{dereference_path:function(d,c){return b.path.continue_dereferencing_path(this,d.get_thing_in_hand(),d)},toString:function(){return"what I'm holding"},get_json:function(b,c,a){c({type:"path.to_thing_in_hand"},a)}}},get_path_to_resource:function(d){d||
console.error("Widget missing in get_path_to_resource.");d=d.get_widget();return{dereference_path:function(c){var a=d.copy({copying_resource:!0}),g,l,e;c.add_newly_created_widget(a);c.visible()&&(g=b.UTILITIES.find_resource_equal_to_widget(d,c))&&(a.save_dimensions_of(b.UTILITIES.widget_side_of_element(g)),e=a.get_frontside_element(),l=$(g).position(),b.UTILITIES.set_timeout(function(){$(e).css({left:l.left,top:l.top,width:$(g).width(),height:$(g).height()})}));return a},toString:function(c){return b.UTILITIES.add_a_or_an(d.toString(c))},
get_json:function(c,a,g){d.get_json(b.UTILITIES.fresh_json_history(c),function(b,c){a({type:"path.to_resource",resource:b},c)},g)}}},get_path_to_backside_widget_of_context:function(d,c){return"string"===typeof d?{dereference_path:function(a){var c=a.get_context(),g=a.get_backside_widget_of_type(d,c);g||c.get_backside_widgets().some(function(b){if(b.get_widget().is_of_type(d)&&!a.is_newly_created(b.get_widget()))return g=b.get_widget(),!0});if(g)return b.path.continue_dereferencing_path(this,g,a)},
toString:function(a){a=(a&&a.robot&&a.robot.get_backside_conditions()?a.robot.get_backside_conditions()[d]:b.UTILITIES.add_a_or_an(d))+" on the back of what I'm working on";return this.removing_widget?"what is on "+a:a},get_json:function(a,b,c){b({type:"path.to_backside_widget_of_context",type_name:d},c)}}:this.get_path_to_backside_index_of_context(c.get_backside_condition_index(d),d.get_type_name(),c)},get_path_to_backside_index_of_context:function(d,c,a){return{dereference_path:function(a){var g=
a.get_backside_matched_widgets()[d],e;if(g)return this.removing_widget&&((e=g.get_parent_of_frontside())&&e.is_hole()&&(e=e.get_parent_of_frontside()),e&&e.removed_from_container&&"nest"!==c&&a.remove_from_container(g,e)),b.path.continue_dereferencing_path(this,g,a);b.debugging&&console.log("can this happen?")},toString:function(d){var g=(d=(d=a.get_frontside_conditions())&&d.is_top_level())?"work area":"back of what",g=b.UTILITIES.add_a_or_an(c||"thing")+" on the "+g+" I'm working on";return!this.removing_widget||
d&&"nest"!==c?g:"what is on "+g},get_json:function(a,b,e){b({type:"path.to_backside_widget_of_context",type_name:c,backside_index:d},e)}}},process_path_json:function(d,c,a){c.next_path&&(d.next=b.UTILITIES.create_from_json(c.next_path,a));c.removing_widget&&(d.removing_widget=!0);c.not_to_be_dereferenced&&(d.not_to_be_dereferenced=!0);c.is_backside&&(d.is_backside=!0)},top_level_backside:{dereference_path:function(d){if(d=d.get_context().ancestor_of_type("top-level"))return d;g||(g=b.widget.create_top_level_widget());
return g},toString:function(){return"the top-level backside"},get_json:function(b,c,a){c({type:"path.top_level_backside"},a)}}}}(window.TOONTALK);window.TOONTALK.publish=function(b){var g=function(b,c,a){var g='<!DOCTYPE html>\n<html>\n<head>\n<script src="https://toontalk.github.io/ToonTalk/toontalk.js?published=1">\x3c/script>\n<title>\n'+b+"</title>\n</head>\n<body>\n";c.forEach(function(b,c){g+='<div class="toontalk-edit" name="content">\n'+b+"\n</div>\n";a[c]&&(g+=a[c])});return g+="</body>\n</html>\n"};return{publish_widget:function(d,c,a,k){var l=b.google_drive.get_status(),e=["Edit this. Select text for formatting."],f=function(a){(a=
a&&a.items&&0<a.items.length&&a.items[0])?k(a,p):(a=g(d,e,p),b.google_drive.upload_file(t,"html",a,k))},t,p;"Ready"===l?(t=c.get_setting("program_name"),a?b.UTILITIES.get_json_top_level(c,function(a){c.set_setting("program_name",t+" (published version)");p=[b.UTILITIES.toontalk_json_div(a,c)];c.set_setting("program_name",t)}):(a=c.get_backside_widgets(),p=[],a.forEach(function(a,c){a.visible()&&b.UTILITIES.get_json_top_level(a,function(c){c.view&&(c.view.saved_width=void 0,c.view.saved_height=void 0);
p.push(b.UTILITIES.toontalk_json_div(c,a.get_widget()));e.push("")})})),b.google_drive.get_toontalk_files(b.google_drive.full_file_name(t,"page"),"page",f)):(console.log("Unable to publish to Google Drive because: "+l),k(null))},republish:function(d){b.google_drive.insert_or_update_file(void 0,d.file_id,"page",g(d.title,d.editable_contents,d.widgets_json),function(){console.log("Published page '"+d.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK.google_drive.handle_client_load()}
window.TOONTALK.google_drive=function(b){var g=b.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",d=b.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",c="Need to authorize",a,k;return{handle_client_load:function(a){0>window.location.href.indexOf(d)?(c="Connections to Google Drive are configured for the following domain only: "+d+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",a&&
a(c)):setTimeout(function(){b.google_drive.check_authorization(a)})},check_authorization:function(a){c="Awaiting authorization";gapi.auth.authorize({client_id:g,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(c){b.google_drive.handle_authorization_result(c,a)})},handle_authorization_result:function(a,d){a&&!a.error?(c="Authorized but not yet ready",gapi.client.load("drive","v2",function(){b.google_drive.get_folder_ids(function(){c="Ready"})}),d&&d()):(c="Need to authorize",d&&
d(c))},authorize:function(a){gapi.auth.authorize({client_id:g,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(c){b.google_drive.handle_authorization_result(c,a)})},get_folder_ids:function(c){b.google_drive.get_folder_id(!0,function(d){a=d;b.google_drive.get_folder_id(!1,function(a){k=a;c()})})},get_folder_id:function(c,d){var f=c?"ToonTalk Programs":"ToonTalk Pages",g=function(a){var g=function(a){a&&a.id?d(a.id):(console.error("Failure to create folder '"+f+"'. Response follows."),
console.error(a))};(a=a&&a.items&&0<a.items.length&&a.items[0].id)?d(a):c?b.google_drive.create_folder("ToonTalk Programs",!1,g):b.google_drive.create_folder("ToonTalk Pages",!0,g)};c&&a?d(a):!c&&k?d(k):b.google_drive.fetch_folder_id(f,g)},get_status:function(){return c},connection_to_google_drive_possible:function(){return 0!==c.indexOf("Connections to Google Drive are configured for the following domain only: ")&&!b.CHROME_APP},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",
method:"GET",params:a}).execute(b)},fetch_folder_id:function(a,c){b.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},c)},get_toontalk_files:function(a,c,d){"undefined"===typeof gapi?d("Google Drive API not available."):(c="properties has {key='ToonTalkType' and value='"+c+"' and visibility='PUBLIC'} and trashed = false",a&&(c+=" and title='"+a+"'"),b.google_drive.list_files({q:c},d))},get_toontalk_program_file:function(c,d){b.google_drive.list_files({q:"'"+
a+"' in parents and trashed = false and title='"+c+"'"},function(a){a&&a.items&&0<a.items.length?d(a.items[0]):d(null)})},upload_file:function(a,c,d,g){var k="json"===c?"program":"page",m=a+"."+c;b.google_drive.get_toontalk_files(m,k,function(a){gapi.client.load("drive","v2",function(){var c=a&&a.items&&0<a.items.length&&a.items[0].id;g||(g=function(a){a.error&&(console.log("Google drive status: "+b.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message));b.debugging&&
console.log("File "+a.title+" ("+a.id+") "+(c?"updated":"created"))});c?b.google_drive.insert_or_update_file(void 0,c,k,d,g):b.google_drive.insert_or_update_file(m,void 0,k,d,g)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(c,d,f,g,p){var m={title:c,mimeType:"text/html"};m.parents=[{kind:"drive#fileLink",id:"program"===f?a:k}];g="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(m)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+
g+"\r\n---------314159265358979323846--";c?(c="/upload/drive/v2/files",m="POST"):(c="/upload/drive/v2/files/"+d,m="PUT");gapi.client.request({path:c,method:m,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:g}).execute(function(a){d||b.google_drive.insert_property(a.id,"ToonTalkType",f,"PUBLIC");p&&p(a)})},create_folder:function(a,b,c){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?
function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){c(a)})}:c)},download_file:function(a,c){if(a.downloadUrl){var d=gapi.auth.getToken().access_token;b.UTILITIES.download_file(a.downloadUrl,c,d)}else c(null)},google_drive_url:function(a,c){return c?"https://www.googleapis.com/drive/v2/files/"+a+"?alt=media":"function"===typeof b.cross_origin_url_function?b.cross_origin_url_function("https://drive.google.com/uc?id="+a):
"https://drive.google.com/uc?export=download&id="+a},insert_property:function(a,b,c,d){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:c,visibility:d}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){window.TOONTALK.translate_element=new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(b){var g={},d=!1,c=100,a=(new Date).getTime(),k=[],l=[],e,f=[],t=new MutationObserver(function(a){a.forEach(function(a){var b,c;for(b=0;b<a.addedNodes.length;b++)if(c=a.addedNodes.item(b),1===c.nodeType){if(!c.toontalk_widget_side&&$(c).is(".toontalk-side")){$(c).remove();break}setTimeout(function(){!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),
c.toontalk_attached_callback=void 0,c.toontalk_run_even_if_not_observable=void 0);$(c).find(".toontalk-has-attached-callback").each(function(a,b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)})})}})}),p=function(){var a=new MutationObserver(function(a){a.forEach(function(a){(a=$(a.target).closest(".toontalk-translation-element").get(0))&&a.toontalk_callback&&(a.toontalk_callback(a.innerText),a.innerText=
"",a.toontalk_callback=void 0)})}),c,d;$("a").each(function(a,b){b.href=g.add_URL_parameter(b.href,"translate","1")});$("#google_translate_element").is("*")||(c=document.createElement("div"),c.id="google_translate_element",document.body.insertBefore(c,document.body.firstChild));document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]);b.CHROME_APP||F("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit");
d=document.createElement("div");d.className="toontalk-translation-element";document.body.appendChild(d);a.observe(d,{characterData:!0,subtree:!0});g.translate=function(a,b){d.innerHTML=a;d.toontalk_callback=b}},m=function(a,b,c){var d;if(a){d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},u=function(a,c){b.debugging+="\n"+a;console.log(a);c&&(alert(b.debugging),b.debugging="touch")},r=function(a){var b=a.indexOf("<div style='display:none;'>{"),
b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},n=function(a,c){if(!$(c).is(".toontalk-conditions-contents")){var d=$(c).closest(".toontalk-side"),e=g.get_mouse_or_first_touch_event_attribute("clientX",a),f=g.get_mouse_or_first_touch_event_attribute("clientY",a),h,k,l,m;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(a.dataTransfer&&a.dataTransfer.getData("text")&&0<a.dataTransfer.getData("text").length)){J=d||$(c);l=
g.widget_side_of_jquery(J);if(!l){l=g.widget_side_of_element(c);g.report_internal_error("Possible bug that "+J+" doesn't have a known owner.");if(!l){g.report_internal_error("The element doesn't have an owner either.");return}J=$(c)}l=l.get_selection();J=$(l.get_element());l.set_stopped&&l.set_stopped(!0);!l.save_dimensions||l.get_parent_of_frontside()&&!l.get_parent_of_frontside().get_widget().is_top_level()||l.save_dimensions();l.being_dragged=!0;h=J.get(0).getBoundingClientRect();m=J.is(".toontalk-top-level-resource");
$(c).removeClass("toontalk-wiggle");l.get_json&&(d=function(b){b.view.drag_x_offset=e-h.left;b.view.drag_y_offset=f-h.top;!b.view.frontside_width&&J.parent().is(".toontalk-backside")&&(b.view.frontside_width=J.width(),b.view.frontside_height=J.height());J.data("json",b);a.dataTransfer&&(k=g.toontalk_json_div(b,l),a.dataTransfer.effectAllowed=m?"copy":"move",a.dataTransfer.setData("text",k),g.is_internet_explorer()||a.dataTransfer.setData("text/html",k));l.drag_started&&l.drag_started(b,m)},a.dataTransfer&&
a.dataTransfer.setData("text","Sorry, it took too long to generate the data structure needed to reconstruct "+l+"."),b.UTILITIES.get_json_top_level(l,d,6E5));J.addClass("toontalk-being-dragged");(d=l.get_listeners("picked up"))&&d.map(function(a){a()});a.stopPropagation()}}},h=function(a,b){var c;if(!$(b).is(".toontalk-conditions-contents")){J||(J=$(a.target).closest(".toontalk-side"));if(c=g.widget_side_of_jquery(J))c.being_dragged=void 0,(c=c.get_listeners("dropped"))&&c.map(function(a){a()});J.is(".toontalk-frontside")&&
(J.parent().is(".toontalk-backside")?(c=J.data("json"))&&g.set_css(J,{width:c.view.frontside_width,height:c.view.frontside_height}):J.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||J.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||g.has_animating_image(J.get(0))||g.set_css(J,{width:"100%",height:"100%"}));w();a.stopPropagation()}},C=function(a){if(J)return g.widget_side_of_jquery(J);if(a)return a=g.data_transfer_json_object(a),
g.create_from_json(a)},x=function(a,c){var d=g.data_transfer_json_object(a),e=function(a,d){var e=g.create_from_json(a),f=document.createElement("div"),q=e.get_element(!0),h=$(c).closest(".toontalk-edit"),k=b.published_support.create_editable_text(),l=d.target;$(f).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");$(q).addClass("toontalk-top-level-resource").css({position:"relative",width:e.saved_width,height:e.saved_height});q.toontalk_widget_side=e;f.toontalk_widget_side=
e;f.appendChild(q);for($(f).insertAfter(h);l.nextSibling;)$(k).children(".froala-element").get(0).appendChild(l.nextSibling);$(k).insertAfter(f);e.set_visible(!0);e.render()},f=function(){var a;h.hide();a=document.elementFromPoint(u-window.pageXOffset-b.USABILITY_DRAG_OFFSET.x,t-window.pageYOffset-b.USABILITY_DRAG_OFFSET.y);h.show();if(a)return $(a).closest(".toontalk-side")},h,k,l,m,n,p,r,u,t;void 0===d&&J&&(d=J.data("json"));J&&J.data("json","");h=J;w();if(h||void 0!==d||a.dataTransfer.files||O(a)){if($(a.target).is(".toontalk-drop-area-instructions"))e=
$(a.target).parent();else if($(a.target).is(".toontalk-element-attribute-input")){if(e=$(a.target).closest(".toontalk-side"),k=g.widget_side_of_jquery(e)){f=h?g.widget_side_of_jquery(h):g.create_from_json(d);g.restore_resource(h,f);k.dropped_on_style_attribute(f,a.target.name,a);a.stopPropagation();return}}else if($(a.target).is(".toontalk-drop-area"))e=$(a.target);else{if(d&&$(a.currentTarget).is(".froala-element")){e(d,a);return}e=h&&h.is(".toontalk-backside")?$(a.target).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):
$(a.target).closest(".toontalk-side")}if(0!==e.length){u=g.get_mouse_or_first_touch_event_attribute("pageX",a);t=g.get_mouse_or_first_touch_event_attribute("pageY",a);if(e.is(".toontalk-top-level-resource"))if("touchend"===a.type){e=$(".toontalk-highlight");if(0===e.length||e.get(0)===h.get(0))e=f();if(!e||0===e.length)return}else return;n=e.offset();k=g.widget_side_of_jquery(e);if(h&&0<h.length&&!(k&&k.get_widget().get_infinite_stack&&k.get_widget().get_infinite_stack())&&(h.get(0)===e.get(0)||jQuery.contains(h.get(0),
e.get(0)))){if(h.is(".toontalk-backside-of-top-level"))return;e=$(".toontalk-highlight");if(0===e.length||e.get(0)===h.get(0))e=f();if(!e||0===e.length)return;n=e.offset();k=g.widget_side_of_jquery(e)}g.remove_highlight();d&&d.view&&d.view.drag_x_offset?(l=d.view.drag_x_offset,m=d.view.drag_y_offset):m=l=0;if(h&&0<h.length){if(!(k&&k.get_widget().get_infinite_stack&&k.get_widget().get_infinite_stack()||h.get(0)!==e.get(0)&&!jQuery.contains(h.get(0),e.get(0)))){g.set_css(h,{left:h.get(0).offsetLeft+
(a.layerX-l),top:h.get(0).offsetTop+(a.layerY-m)});a.stopPropagation();return}f=g.widget_side_of_jquery(h);h.parent().is(".toontalk-drop-area")?(h.removeClass("toontalk-widget-in-drop_area"),h.parent().data("drop_area_owner").set_next_robot(void 0)):((r=f&&f.get_parent())?(p=$(r.get_element()),!f.is_backside()&&f.get_widget().get_infinite_stack&&f.get_widget().get_infinite_stack()?(p=f.get_widget().saved_width,r=f.get_widget().saved_height,f=g.get_dragee_copy(),f.get_widget().saved_width=p,f.get_widget().saved_height=
r,p=h.width(),r=h.height(),h=$(f.get_element(!0)),e.is(".toontalk-backside")&&g.set_css(h,{width:d.view.frontside_width||p,height:d.view.frontside_height||r})):r.removed_from_container&&(p.is(".toontalk-backside")?r.remove_backside_widget(f,!0):(r.removed_from_container(f,a),f.restore_dimensions&&!r.is_empty_hole()&&f.restore_dimensions()))):g.restore_resource(h,f),f&&f.robot_in_training()&&f.robot_in_training().add_newly_created_widget_if_new(f))}else{if(0<a.dataTransfer.files.length){for(d=0;d<
a.dataTransfer.files.length;d++)L(a.dataTransfer.files[d],e,k,n,a);a.stopPropagation();return}if(O(a)){E(a.dataTransfer.getData("URL"),e,k,n,a);a.stopPropagation();return}f=g.create_from_json(d,{event:a});if(!f){d?g.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):b.debugging&&console.log("No data transfer in drop.");a.stopPropagation();return}f.robot_in_training()&&f.robot_in_training().drop_from_data_transfer(f);h=$(f.get_element(!0));f.is_primary_backside&&f.is_primary_backside()&&
(g.set_css(h,{width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,"border-width":d.view.border_width}),f.apply_backside_geometry())}k&&f&&f.get_widget()===k.get_widget()||z(e,h,f,k,n,a,d,l,m)}}else a.dataTransfer?g.report_internal_error("Drop failed since unable to parse as JSON."):g.report_internal_error("Drop failed since there is no event.dataTransfer"),a.stopPropagation()},y=function(a,b){a.addEventListener("drop",function(a){var c=C(a);g.restore_resource(g.get_$dragee(),
c);b(a)})},K=function(a,b){var c;c=g.get_$dragee();var d;d=c&&c.is(".toontalk-backside")?$(b).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):$(b).closest(".toontalk-side");c=!d.is("*")||d.is(".toontalk-backside-of-top-level")||d.closest(".toontalk-top-level-resource").is("*")||d.is(".toontalk-being-dragged")||c&&B(d.get(0),c.get(0))?void 0:d;if(c)return g.highlight_element(c.get(0),a),c.get(0)},z=function(a,c,d,e,f,h,k,l,m){var n=g.get_mouse_or_first_touch_event_attribute("pageX",
h),p=g.get_mouse_or_first_touch_event_attribute("pageY",h),r,u,t,w;l||(l=0);m||(m=0);d.set_visible(!0);k&&k.semantic&&k.semantic.running&&g.set_timeout(function(){d.set_running(!0)},100);if(a.is(".toontalk-backside")){if(d.get_widget().is_top_level()){r=k.semantic.backside_widgets;u=k.shared_widgets;t=a.get(0);(l=e.robot_in_training())&&l.drop_from_data_transfer(d,e);l=d.get_widget().get_backside_widgets().slice();b.UTILITIES.for_each_batch(l,function(a,b){var c=a.get_widget(),f,q,h,k,l,v,m;d.remove_backside_widget(a);
f=0<=r[b].widget.shared_widget_index?u[r[b].widget.shared_widget_index].view:r[b].widget.view;q=a.get_element(!0);a.is_backside()?(h=f.backside_left,k=f.backside_top,l=f.backside_width,v=f.backside_height):(h=f.frontside_left,k=f.frontside_top,l=f.frontside_width,v=f.frontside_height);e.add_backside_widget(a);t.appendChild(q);m=$(q).position();w={left:m.left+h,top:m.top+k,width:l,height:v};g.constrain_css_to_fit_inside(t,w);g.set_css(q,w);d.set_location_attributes&&c.set_location_attributes(w.left,
w.top);a.is_backside()&&(c.backside_geometry=f.backside_geometry,c.apply_backside_geometry())}.bind(this));e.top_level_widget().backup_all();return}if(!e){g.report_internal_error("No target_widget");return}d?e.widget_side_dropped_on_me(d,{event:h}):g.report_internal_error("No source_widget");h=n-(f.left+(l||0));a=p-(f.top+(m||0));w={left:g.left_as_percent(h,c.get(0)),top:g.top_as_percent(a,c.get(0))};g.set_css(c,w);!d.is_backside()&&d.set_location_attributes&&d.set_location_attributes(h,a);k&&k.semantic&&
k.semantic.running&&!g.get_$dragee()&&d.set_running(!0)}else if(a.is(".toontalk-drop-area"))c.addClass("toontalk-widget-in-drop_area"),0<a.length&&a.get(0).appendChild(c.get(0)),c.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(g.widget_side_of_jquery(c));else{if(c.is(".toontalk-backside-of-top-level"))return;if(e||h.changedTouches){t=a.closest(".toontalk-backside-of-top-level").get(0);!t&&h.changedTouches&&(k=document.elementFromPoint(n-window.pageXOffset,p-window.pageYOffset),(t=
$(k).is(".toontalk-backside-of-top-level")?k:$(k).closest(".toontalk-backside-of-top-level").get(0))||(t=$(".toontalk-backside-of-top-level").get(0)),e=g.widget_side_of_element(t).get_backside());if(!t)return;t.appendChild(c.get(0));k=$(t).offset();w={left:n-(k.left+l+b.USABILITY_DRAG_OFFSET.x),top:p-(k.top+m+b.USABILITY_DRAG_OFFSET.y)};g.set_css(c,w);d.remove_from_parent_of_frontside(h);d.set_visible(!0);d.drop_on&&d.drop_on(e,{event:h})||e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(d,
{event:h})||(c=a.closest(".toontalk-backside-of-top-level"),0<c.length&&(e=g.widget_side_of_jquery(c))&&e.widget_side_dropped_on_me(d,{event:h}))}else{g.report_internal_error("target widget missing");return}}b.logging&&0<=b.logging.indexOf("drop")&&(console.log("Drop of "+d._debug_id+" on "+e._debug_id),console.log("Left: "+w.left+"; top: "+w.top+"; page_x: "+n+"; page_y: "+p+"; drag_x_offset: "+l+"; drag_y_offset: "+m));g.remove_highlight()},L=function(a,c,d,e,f){var h=new FileReader,k=0===a.type.indexOf("image"),
l=0===a.type.indexOf("audio"),m=0===a.type.indexOf("video"),n,p,t;h.onloadend=function(){if(k)n=b.element.create("<img src='"+h.result+"' class = 'toontalk-image' alt='"+a.name+"'/>");else if(l)n=b.element.create(a.name+" sound"),n.set_sound_effect(new Audio(h.result));else if(m)n=b.element.create("<video src='"+h.result+"' alt='"+a.name+"'/>");else{if(p=r(h.result))try{t=JSON.parse(p),n=g.create_from_json(t)}catch(u){}n||(n=b.element.create(h.result))}n&&n.robot_in_training()&&n.robot_in_training().drop_from_data_transfer(n,
d);z(c,$(n.get_frontside_element(!0)),n,d,e,f,t)};k||l||m?h.readAsDataURL(a):h.readAsText(a)},E=function(a,c,d,e,f){var h,k=function(a,c,e,f){var q=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),z(c,$(a.get_frontside_element(!0)),a,d,e,f))};g.create_widget_from_URL(a,q,function(c){var d=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");d?(h=d,q(b.element.create(d))):(d=h?b.element.create("<div class='toontalk-iframe-container'><iframe srcdoc='"+
h+"' width='480' height='320'></iframe></div>"):b.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='480'></iframe></div>"),q(d),console.log("Error loading URL. Loading it in an iframe instead. URL is "+a),console.log(c))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&k(a,c,e,f)})},A=function(a,b){var c=$("<div class='"+a+"'>");g.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=
function(){return d}})},M=function(){var a=g.get_path_to_toontalk_folder()+"sounds/",c=function(b){b=new Audio(a+b);b.volume=g.get_audio_volume(b);return b};b.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),event_ignored:c("PLOP.mp3")};b.sounds.bird_fly.loop=!0},F=function(a){var b=document.createElement("script");
b.src=a;document.body.appendChild(b)},w=function(){J&&(J.removeClass("toontalk-being-dragged"),g.set_timeout(function(){fa=ca=J=void 0}))},B=function(a,b){if(a===b)return!0;if(a.parentNode)return B(a.parentNode,b)},I=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),h="",k,l;if(0>f)return a;for(;0<=f;){k=f+d.length;l=a.indexOf(e,k);if(0>l)return g.report_internal_error("Expected title to have matching pairs of "+
d+" and "+e),a;h+=a.substring(c,f)+b(a.substring(k,l));c=l+e.length;f=a.indexOf(d,c)}return h+=a.substring(c)},O=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},H=function(a){var c=g.get_current_url_parameter("replace-with-url");if(c){var d=decodeURIComponent(c);g.download_file(d,function(c){var e;if(c)if(e=Q(c,"body")){if(c=Q(c,"title",!0))document.title=c;c=document.createElement("div");c.innerHTML=e;document.body.appendChild(c);a();(0<=d.indexOf("googleapis.com")||
0<=d.indexOf("googleusercontents.com"))&&b.google_drive.connection_to_google_drive_possible()&&(e=d.substring(d.lastIndexOf("/")+1,d.indexOf("?")),$(".toontalk-edit").editable({inlineMode:!b.UTILITIES.get_current_url_boolean_parameter("edit",!1),imageUpload:!1,crossDomain:!0}),b.published_support.send_edit_updates(e))}else g.display_message("Expected contents of "+d+" to contain a body element.");else g.display_message("Unable to read contents of "+d)},gapi&&gapi.auth&&gapi.auth.getToken()&&gapi.auth.getToken().access_token)}else g.display_message("Expected a url=... parameter in the URL.")},
Q=function(a,b,c){var d=a.indexOf("<"+b),e;if(!(0>d||(e=a.indexOf("</"+b+">"),0>e)))return c?a.substring(d+2+b.length,e):a.substring(d,e+3+b.length)},U=!1,W=[],V=[],J,ca,fa,ba,R;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window&&(a.stopPropagation(),0<W.length&&W.shift()())},!1);t.observe(window.document,{childList:!0,subtree:!0});g.available_types="number box element robot nest sensor top-level".split(" ");g.create_from_json=function(a,c,d,e){var f=
function(a,b,c){(b.shared_widgets[c]=a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},h,k,l,m,n;if(a){c||(c={});c.guid_to_nest_table||(c.guid_to_nest_table={});a.shared_widgets&&(c.json_of_shared_widgets=a.shared_widgets,c.shared_widgets=[]);a.shared_html&&(c.shared_html=a.shared_html);if(a.widget)return(h=g.create_from_json(a.widget,c))&&a.is_backside?h.get_backside(!0):h;if(c&&c.shared_widgets&&0<=a.shared_widget_index){if(d=
c.shared_widgets[a.shared_widget_index])return d;d=c.json_of_shared_widgets[a.shared_widget_index];h=b.creators_from_json[d.semantic.type]();c.shared_widgets[a.shared_widget_index]=h;h=g.create_from_json(d,c,!0,h);return f(h,c,a.shared_widget_index)}(l=a.semantic)||(l=a);m=a.view;if(0<=l.shared_widget_index){if(!c.json_of_shared_widgets){g.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}h=g.create_from_json(c.json_of_shared_widgets[l.shared_widget_index],
c,!0,e);return f(h,c,l.shared_widget_index)}if(b.creators_from_json[l.type]){c||(c={});m?c.json_view=m:m=c.json_view;if(b.debugging)h=b.creators_from_json[l.type](l,c,e);else try{h=b.creators_from_json[l.type](l,c,e)}catch(p){console.error(p.stack),g.report_internal_error("Unable to recreate a "+l.type+". Error is "+p)}h&&!h.is_widget&&b.path.process_path_json(h,a,c);if(h&&h.get_backside){l.erased&&(b.widget.erasable(h),h.set_erased(l.erased));l.infinite_stack&&h.set_infinite_stack(l.infinite_stack);
l.open_backside_only_if_stopped&&h.set_open_backside_only_if_stopped(!0);if(m){if(m.frontside_width)if(k=h.get_element()){if(h.ok_to_set_dimensions())if(n={width:m.frontside_width,height:m.frontside_height},"element"===l.type)h.on_update_display(function(){g.set_css(k,n)});else g.set_css(k,n)}else m.saved_width||(h.saved_width=m.frontside_width,h.saved_height=m.frontside_height);m.saved_width&&(h.saved_width=m.saved_width,h.saved_height=m.saved_height);m.backside_geometry&&(h.backside_geometry=m.backside_geometry);
h.json_view=m}l.backside_widgets&&(d?h.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(h,l.backside_widgets,c)}.bind(this):this.add_backside_widgets_from_json(h,l.backside_widgets,c))}return h}g.report_internal_error("JSON type '"+l.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}};g.add_backside_widgets_from_json=function(a,b,c){var d;b&&(d=this.create_array_from_json(b,c),a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?
0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a})))};g.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?g.create_from_json(a,b):a});return c};g.get_json_of_array=function(a,b,c,d,e,f){var h,k;c>=a.length?e():(h=a[c])?h.is_primary_backside&&h.is_primary_backside()?(k=function(f,g){b.push({widget:f,is_backside:!0});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),
g.get_json(h.get_widget(),d,k,f)):h.is_widget?(k=function(h,k){b.push({widget:h});0===c%100&&(!g.maximum_json_generation_duration||Date.now()-f>g.maximum_json_generation_duration)?g.set_timeout(function(){this.get_json_of_array(a,b,c+1,d,e,k)}.bind(this)):this.get_json_of_array(a,b,c+1,d,e,k)}.bind(this),g.get_json(h,d,k,f)):(k=function(f,g){b.push(f);this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),h.get_json(d,k,f)):g.get_json_of_array(a,b,c+1,d,e,f)};g.fresh_json_history=function(a){var b={widgets_encountered:[],
shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=a.shared_html);return b};g.get_json_top_level=function(a,b,c){var d=this.fresh_json_history();g.maximum_json_generation_duration=c;g.get_json(a,d,function(c){0<d.shared_widgets.length&&(c.shared_widgets=d.shared_widgets.map(function(b,e){var f=function(a){a=d.widgets_encountered.indexOf(a);return d.json_of_widgets_encountered[a]},h=function(a){return f(d.shared_widgets[a])},k=f(b);if(a===b)return k={semantic:k.semantic,
view:k.view,version:k.version},c.semantic={shared_widget_index:e},k;c.semantic&&g.tree_replace_once(c.semantic,k,{shared_widget_index:e},h,g.generate_unique_id());return k}));c.shared_html=d.shared_html;b(c)},Date.now())};g.get_json=function(a,c,d,e){var f,h,k;b.debugging&&!c?g.report_internal_error("no json_history"):(f=c.shared_widgets.indexOf(a),0<=f?d({shared_widget_index:f},e):(f=c.widgets_encountered.indexOf(a),0<=f?(f=g.insert_ancestors_last(a,c.shared_widgets),d({shared_widget_index:f},e)):
(f=c.widgets_encountered.push(a)-1,(h=a.is_primary_backside&&a.is_primary_backside())&&(a=a.get_widget()),k=function(b,e){a.add_to_json&&(b=a.add_to_json(b,c));c.json_of_widgets_encountered[f]=b;a.add_backside_widgets_to_json?a.add_backside_widgets_to_json(b,c,function(){d(b,e)},e):d(b,e)},Date.now()-e<=g.maximum_json_generation_duration?a.get_json(c,k,e):setTimeout(function(){a.get_json(c,k,Date.now())}))))};g.get_json_of_keys=function(a,b,c,d){var e;b||(b=[]);Object.keys(a).forEach(function(c){0>
b.indexOf(c)&&(e||(e={}),a[c].get_json?a[c].get_json(void 0,function(a,b){e[c]={json:a}},d):e[c]=a[c])});c(e,d)};g.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?g.create_from_json(a[d].json,b):a[d]});return c};g.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).some(function(g){f=a[g];if(null!==f){if(f===b)return a[g]=c,!0;if("shared_widget_index"===g){if(this.tree_replace_once(d(f),
b,c,d,e))return!0}else if(!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};g.insert_ancestors_last=function(a,b){var c=a.get_widget(),d=-1;b.some(function(a,b){if(c.has_ancestor(a))return d=b,!0});0>d&&(d=b.length);b.splice(d,0,c);return d};g.toontalk_json_div=function(a,b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name(),c=c.toString({for_json_div:!0}),f;"top-level"===e?b.is_backside()?
(a.semantic.settings=void 0,e="a work area containing ",0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),e+=g.describe_widgets(d))):e="a top-level widget":(e=g.add_a_or_an(e),b.is_backside()&&(e="the back of "+e));c&&(d=c.indexOf("data:image/"),0<d&&(f=c.indexOf("alt=",d),0>f&&(f=c.indexOf(">",d)),c=c.substring(0,d+20)+" ... "+c.substring(f)));return"<div class='toontalk-json' translate='no' style='display:none'>\nThis will be replaced by "+e+".\n"+(c?c+
"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,g.clean_json,"  ")+"</div></div>"};g.describe_widgets=function(a){var b="",c=a.length;a.forEach(function(a){c--;b+=g.add_a_or_an(a.get_type_name());1===c?b+=", and ":1<c&&(b+=", ")});return b};g.elide=function(a,b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};g.strip_trailling_digits=function(a){var b;if(0===
a.length)return a;b=a[a.length-1];return"0"<=b&&"9">=b?g.strip_trailling_digits(a.substring(0,a.length-2)):a};g.clean_json=function(a,b){return"id_of_tree_replace_once_task"===a?void 0:"number"!==typeof b||"left_offset_fraction"!==a&&"top_offset_fraction"!==a&&"drag_x_offset"!==a&&"drag_y_offset"!==a?b:parseFloat(b.toPrecision(3))};g.create_widget_from_URL=function(a,c,d){var e=function(g){try{var h=this.getResponseHeader("content-type"),k,l;if(!h)if(l=window.location.protocol+"//"+window.location.hostname+
(window.location.port?":"+window.location.port:""),0===a.indexOf(l))h="";else{d&&(d("Could not determine the contents type of the url"),d=function(){});f.removeEventListener("readystatechange",e);return}0===h.indexOf("audio")?(k=b.element.create(a),k.set_sound_effect(new Audio(a))):0===h.indexOf("image")?k=b.element.create("<img src='"+a+"' class = 'toontalk-image' alt='"+a+"'/>"):0===h.indexOf("video")?k=b.element.create("<video src='"+a+" ' width='320' height='240'>"):0===h.indexOf("text")&&0>h.indexOf("text/html")?
this.responseText&&(k=b.element.create(this.responseText),k.set_source_URL(a)):k=b.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");k&&c(k)}catch(m){d&&(d(m),d=function(){}),c()}f.removeEventListener("readystatechange",e)},f=new XMLHttpRequest;f.addEventListener("readystatechange",e);f.open("GET",a,!0);f.onerror=function(b){d?(d(b),d=function(){}):(g.display_message("Error trying to GET "+a+" "+b),console.error(b.stack))};f.send()};
g.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};g.copy_widget_sides=function(a,b){var c=[];a.forEach(function(a){var d;a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};g.copy_array=function(a){return a.slice()};g.generate_unique_id=function(){a+=1;return"toontalk_id_"+a};g.get_style_property=function(a,b){var c;if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle){if(a.parentElement)return document.defaultView.getComputedStyle(a,
null).getPropertyValue(b);document.body.appendChild(a);c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b);document.body.removeChild(a);return c}};g.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;if("string"===typeof c){d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;c=parseFloat(c,10);return isNaN(c)?void 0:c}return c};g.get_element_width=function(a){return a?a.getBoundingClientRect().width:
0};g.get_element_height=function(a){return a?a.getBoundingClientRect().height:0};g.data_transfer_json_object=function(a){var c,d;if(a.dataTransfer&&!(0<a.dataTransfer.files.length||O(a))){try{c=a.dataTransfer.getData("text/html")}catch(e){c=a.dataTransfer.getData("text")}if(!c||c.match(/[\u3400-\u9FBF]/))c=a.dataTransfer.getData("text");if(c){if(a=r(c))try{return JSON.parse(a)}catch(e){g.report_internal_error("Exception parsing "+a+"\n"+e.toString())}a=b.element.create("");a.get_frontside_element(!0);
c&&"<"===c[0]?a.set_HTML(c):a.set_text(c);a.get_json(g.fresh_json_history(),function(a,b,c){0<=a.html.shared_html_index&&(a.html=c.shared_html[a.html.shared_html_index]);d=a});return d}}};g.drag_and_drop=function(a){var b;g.draggable(a);g.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,g.enable_touch_events(a,b))};g.draggable=function(a){$(a).attr("draggable",!0);a.addEventListener("dragstart",function(b){n(b,a)});a.addEventListener("dragend",
function(b){h(b,a)})};g.can_receive_drops=function(a){var b;a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",function(b){b.preventDefault();x(b,a);b.stopPropagation()});a.addEventListener("dragenter",function(c){var d=K(c,a);d&&b!==d&&g.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",function(a){b&&!g.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(g.remove_highlight(b),b=void 0);a.stopPropagation()})};
g.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");b.appendChild(d);g.can_receive_drops(b);return b};g.process_json_elements=function(a,c){var d,e,f,h,k,l,m,n,p;a||(a=$(".toontalk-json"),c=0);0!==a.length&&(n=function(){if(h){d.textContent="";$(d).css({display:""});if(h.get_type_name)if(h.is_top_level())m=h.get_backside(!0),l=m.get_element(),
$(d).replaceWith(l),$(l).css({width:h.json_view?h.json_view.backside_width:f.view.backside_width,height:h.json_view?h.json_view.backside_height:f.view.backside_height,"background-color":f.view.background_color,"border-width":f.view.border_width}),h.json_view=void 0;else{if($(d).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),k=h.get_frontside_element(!0))$(k).addClass("toontalk-top-level-resource").css({position:"relative",width:h.saved_width,height:h.saved_height}),
d.toontalk_widget_side=h,d.appendChild(k)}else d.appendChild(h.get_element());h.set_active&&h.set_active(!1);setTimeout(function(){h.update_display&&h.update_display();f.semantic.running&&h.set_running(!0)},1)}else g.report_internal_error("Could not recreate a widget from this JSON: "+e);c<a.length-1&&g.process_json_elements(a,c+1)},d=a.get(c),e=d.textContent)&&(e=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1),f=JSON.parse(e),f.semantic&&"top_level"===f.semantic.type&&!b.no_local_storage&&!b.reset&&
f.load_most_recent_program?(p=function(a){var c=function(){try{h=g.create_from_json(f)}catch(a){console.error(a.stack),console.trace(),g.report_internal_error("An error occurred loading the saved state. Sorry. Please report this. Error is "+a),h=b.widget.create_top_level_widget()}n()};a?g.retrieve_object(a,function(a){a&&(f=a,c())}):c()},g.retrieve_string("toontalk-last-key",p)):(h=g.create_from_json(f),n()))};g.relative_position_from_absolute_position=function(a,b){for(var c=a.parentElement,d=b.left,
e=b.top,f;c&&"html"!==c.nodeType;)f=$(c).position(),d-=f.left,e-=f.top,c=c.parentElement;return{left:d,top:e}};g.set_absolute_position=function(a,b){var c=g.relative_position_from_absolute_position(a,b);g.set_css(a,{left:c.left,top:c.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=c.left+"px",a.style.top=c.top+"px")};g.set_position_relative_to_top_level_backside=function(a,b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-backside-of-top-level"),
b,c)};g.set_position_relative_to_element=function(a,c,d,e){var f=c.offset(),h,k,l;c.get(0).appendChild(a.get(0));f||(f={left:0,top:0});h=d.left-f.left;d=d.top-f.top;e&&(e=b.UTILITIES.get_element_width(a.get(0)),f=b.UTILITIES.get_element_height(a.get(0)),k=b.UTILITIES.get_element_width(c.get(0)),l=b.UTILITIES.get_element_height(c.get(0)),h>k-e&&(h=k-e),0>h&&(h=0),d>l-f&&(d=l-f),0>d&&(d=0));h=g.scale_left(h,c.get(0));d=g.scale_top(d,c.get(0));c={left:h,top:d,position:"absolute"};a.is(".toontalk-side-animating")?
(a.get(0).style.left=h+"px",a.get(0).style.top=d+"px",g.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=""})):g.set_css(a,c);return c};g.restore_resource=function(a,c){var d,e;a&&a.is(".toontalk-top-level-resource")&&(d=g.get_resource_copy()||c.copy({fresh_copy:!0}),e=d.get_frontside_element(!0),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),
$(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),a.css({position:"absolute"}),g.set_css(e,{width:a.width(),height:a.height()}),a.get(0).parentElement.appendChild(e),b.DISPLAY_UPDATES.pending_update(d),c.set_active&&(c.set_active(!0),d.set_active(!1)))};g.closest_element=function(a,c){var d,e;if(!c)return a.get(0);d=Number.MAX_VALUE;a.each(function(a,f){var g=$(f).offset(),g=b.UTILITIES.distance(g,c);d>g&&(e=f,d=g)});return e};g.find_resource_equal_to_widget=
function(a,b){var c=Number.MAX_VALUE,d=$(b.get_frontside_element()).offset(),e;$(".toontalk-top-level-resource.toontalk-side").each(function(b,f){var h=g.widget_side_of_jquery($(f));h&&(a.equals&&a.equals(h)||a.matching_resource&&a.matching_resource(h)||a.get_type_name()===h.get_type_name()&&"matched"===a.match(h))&&(a.is_hole()||h.get_backside_widgets().length===a.get_backside_widgets().length)&&(h=g.distance($(f).offset(),d),c>h&&(e=f,c=h))});return e};g.set_position_is_absolute=function(a,b,c){var d,
e;b?(b=g.get_style_numeric_property(a,"left"),d=g.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===d&&(d=c.pageY-e.top,d-=90)),g.set_css(a,{left:g.left_as_percent(b,a),top:g.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};g.left_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:g.adjust_left_if_scaled(a,
b);return 100*Math.min(($(c).offset().left-window.pageXOffset+a-d.left)/d.width,1-$(b).width()/d.width)+"%"};g.top_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:g.adjust_top_if_scaled(a,b);return 100*Math.min(($(c).offset().top+-window.pageYOffset+a-d.top)/d.height,1-$(b).height()/d.height)+"%"};g.adjust_left_if_scaled=function(a,b){var c=g.widget_side_of_element(b),d;return c&&c.get_original_width&&
(d=c.get_original_width())&&c.get_attribute?a-(d-c.get_attribute("width"))/2:a};g.adjust_top_if_scaled=function(a,b){var c=g.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a-(d-c.get_attribute("height"))/2:a};g.scale_left=function(a,b){var c=g.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a*d/c.get_attribute("width"):a};g.scale_top=function(a,b){var c=g.widget_side_of_element(b),d;
return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a*d/c.get_attribute("height"):a};g.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";case 11:return"eleventh";case 12:return"twelfth";case 13:return"thirteenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":
a+"th"}};g.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};g.give_tooltip=function(a,b){a&&(a.title=b,g.use_custom_tooltip(a))};g.use_custom_tooltip=function(a){var c=$(a),d;c.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){var e;0>a.top&&(a.top=0,e=c.offset(),e.left<$(window).width()/2?a.left=e.left+c.width()+10:(a.left=0,d=e.left-40));"bottom"===b.vertical?(c.is(".toontalk-robot")?a.top-=30:c.is(".toontalk-number")?
a.top-=30:c.is(".toontalk-box")?a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);g.set_css(this,a)}},open:function(c,e){var f=e.tooltip.get(0),h=f.textContent,k=$(a).is(".toontalk-robot"),l;h===a.toontalk_previous_text?(e.tooltip.remove(),b.speak&&window.speechSynthesis.cancel()):(f.innerHTML=I(h,decodeURIComponent),b.speak&&(window.speechSynthesis.cancel(),k||(l=function(b){if(f===R||void 0===
R)a.toontalk_previous_text=h}),g.speak(f.innerText,{when_finished:l})),R&&$(R).remove(),R=f,b.balloons?(100<h.length&&(l=Math.min(800,d||$(window).width()-100),$(f).position(),e.tooltip.css({maxWidth:l})),e.tooltip.css({"z-index":99999999}),e.tooltip.find(".toontalk-iframe-container").removeClass("toontalk-iframe-container"),setTimeout(function(){k||(a.toontalk_previous_text=h);e.tooltip.remove();$(f).data("ui-tooltip")&&($(f).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),g.use_custom_tooltip(a));
R=void 0},h.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))):e.tooltip.remove())},close:function(){$(this).data("ui-tooltip")&&($(this).tooltip("destroy"),$("[role='log']").remove(),g.use_custom_tooltip(a));R=void 0}})};g.speak=function(a,c){var e=new SpeechSynthesisUtterance(a),h=window.speechSynthesis.getVoices(),k=function(a){for(var b=[],c=function(a){var b,c;if(200>a.length)return a.length+1;b=a.substring(0,200);c=b.lastIndexOf(". ")||b.lastIndexOf(".\n");if(0<c)return c+2;c=b.lastIndexOf(".");
if(c===b.length-1)return c+1;c=b.lastIndexOf(", ");if(0<c)return c+2;c=b.lastIndexOf(" ");return 0<c?c+1:Math.min(a.length+1,200)},d;0<a.length;)d=c(a),1<d&&b.push(a.substring(0,d-1)),a=a.substring(d);return b},l,m;d&&(c||(c={}),0===h.length?window.speechSynthesis.onvoiceschanged=function(){g.speak(a,c);window.speechSynthesis.onvoiceschanged=void 0}:g.translate&&!c.no_translation?g.translate(a,function(a){c.no_translation=!0;g.speak(a,c)}):200<a.length?(h=k(a),h.forEach(function(a,b){0===b&&(c.when_finished=
function(){});g.speak(a,c)})):(m=f.push(e)-1,e.volume=void 0===c.volume?Math.min(1,3*b.volume):c.volume,e.pitch=void 0===c.pitch?1.2:c.pitch,e.rate=void 0===c.rate?.75:c.rate,l=g.translation_language_code(),h.some(function(a){if(0===a.lang.indexOf(l)||""===a.lang){e.lang=a.lang;e.voice=a;if(0===c.voice_number||void 0===c.voice_number)return!0;c.voice_number--}}),c.when_finished&&(e.onend=function(){f.splice(m,1);c.when_finished();e.onend=void 0},setTimeout(function(){e.onend&&!window.speechSynthesis.speaking&&
(g.display_message("Browser did not begin speaking after waiting 20 seconds. Continuing as if speech occurred."),e.onend())},2E4)),window.speechSynthesis.speak(e)))};g.translation_language_code=function(){return b.TRANSLATION_ENABLED&&google&&google.translate&&google.translate.TranslateElement?google.translate.TranslateElement().c:navigator.language};g.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"+a+"decodeURIComponent</span>")};
g.remove_encoded_HTML=function(a){return I(a,function(){return""})};g.join_continuations=function(a,b){return a?b?function(){b(a)}:a:b};g.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};g.animate_to_absolute_position=function(a,c,d,e,f,h){var k=$(a).offset(),l=$(a).position(),m=g.distance(c,k);0===h||0===e?(g.set_absolute_position(a,c),d&&d()):($(a).css({"z-index":g.next_z_index()}),
h||(h=Math.round(m/(e||b.animation_settings.ANIMATION_SPEED))),$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=h+"ms",m=l.left+(c.left-k.left),k=l.top+(c.top-k.top),a.style.left=m+"px",a.style.top=k+"px",a.toontalk_followed_by&&(c.left+=a.toontalk_followed_by.left_offset,c.top+=a.toontalk_followed_by.top_offset,g.animate_to_absolute_position(a.toontalk_followed_by.element,c,void 0,e,f)),document.hidden&&(h=0),f?setTimeout(d,h):setTimeout(function(){$(a).removeClass("toontalk-side-animating");
a.style.transitionDuration="";d&&d()},h))};g.distance=function(a,b){var c=a.left-b.left,d=a.top-b.top;return Math.sqrt(c*c+d*d)};g.highlight_element=function(a,b,c){var d;if(a){g.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=g.widget_side_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){g.remove_highlight(a)},c))}};g.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):
$(".toontalk-highlight").removeClass("toontalk-highlight")};g.cursor_of_image=function(a){var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};g.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};g.constrain_css_to_fit_inside=function(a,b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=g.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,
0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,0),d):(c=g.extract_percentage_from_string(b.top),"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};g.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(b){}};g.next_z_index=function(){c++;return c};g.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b+" toontalk-button");a.get(0).addEventListener("click",
d);g.give_tooltip(a.get(0),c);return a.get(0)};g.create_close_button=function(a,b){var c=document.createElement("div"),d=document.createElement("div");$(c).addClass("toontalk-close-button toontalk-button");c.addEventListener("click",a);g.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};g.check_radio_button=function(a){var b=$(a.button).closest(".ui-buttonset");0<b.length&&b.find(".ui-state-active").removeClass("ui-state-active").prop("checked",!1);$(a.button).prop("checked",!0);
$(a.label).addClass("ui-state-active")};g.create_alert_element=function(a){a=g.create_text_element(a);$(a).addClass("toontalk-alert-element");return a};g.create_text_element=function(a,b){var c=document.createElement("div");c.innerHTML=a;$(c).addClass("ui-widget");b&&$(c).addClass(b);return c};g.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};g.create_anchor_element=function(a,c){var d=document.createElement("a");d.innerHTML=a;
b.TRANSLATION_ENABLED&&(c=g.add_URL_parameter(c,"translate","1"));d.href=c;d.target="_blank";return d};g.create_text_input=function(a,b,c,d,e,f,h){var k=document.createElement("input"),l;k.type="text";k.className=b;k.value=a;g.give_tooltip(k,d);f&&(k.type=f);c?(a=document.createElement("label"),a.innerHTML=c,k.id=g.generate_unique_id(),a.htmlFor=k.id,e&&(l=g.create_anchor_element("i",e),$(l).addClass("toontalk-help-button toontalk-button notranslate"),l.translate=!1),c=g.create_horizontal_table(a,
k,l),$(a).addClass("ui-widget")):c=k;$(k).button().addClass("toontalk-text-input").css({"background-color":"white"});k.addEventListener("touchstart",function(){$(k).select()});h&&y(k,h);g.use_custom_tooltip(k);return{container:c,button:k}};g.create_text_area=function(a,b,c,d,e,f,h){var k=document.createElement("textarea");k.className=b;k.value=a;g.give_tooltip(k,d);a=document.createElement("label");a.innerHTML=c;k.id=g.generate_unique_id();a.htmlFor=k.id;c=h?g.create_vertical_table(a,k):g.create_horizontal_table(a,
k);$(k).button().addClass("toontalk-text-area").css({background:"white"});k.addEventListener("touchstart",function(){$(k).select()});e&&y(k,e);$(a).addClass("ui-widget");g.use_custom_tooltip(k);return{container:c,button:k}};g.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();if(c=C(a)){if(c.is_backside())return;if(d=b(c,a))$(a.currentTarget).trigger("change"),a.currentTarget.value=d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};g.create_radio_button=function(a,b,c,d,
e,f){var h=document.createElement("div"),k=document.createElement("input"),l=document.createElement("label");k.type="radio";h.className=c+" toontalk-button";k.name=a;k.value=b;l.innerHTML=d;k.id=g.generate_unique_id();l.htmlFor=k.id;h.appendChild(k);h.appendChild(l);g.give_tooltip(h,e);f||$(k).button();g.use_custom_tooltip(k);return{container:h,button:k,label:l}};g.create_select_menu=function(a,b,c,d,e,f){var h=document.createElement("div"),k=document.createElement("select"),l=document.createElement("label");
k.className=c;k.name=a;k.id=g.generate_unique_id();l.innerHTML=d;l.htmlFor=k.id;h.appendChild(l);h.appendChild(k);g.give_tooltip(h,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&g.give_tooltip(c,f[b]);k.appendChild(c)});$(k).selectmenu({width:"50%",open:function(){$(".ui-selectmenu-open").css({"z-index":9999999});setTimeout(function(){$(".ui-selectmenu-open").find(".ui-menu-item").each(function(a,c){var d;f&&(d=b.indexOf(c.textContent),0<=d&&f[d]&&
g.give_tooltip(c,f[d]))})})}});$(l).addClass("ui-widget");g.use_custom_tooltip(k);return{container:h,menu:k,label:l}};g.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),h=document.createElement("label");f.type="checkbox";f.className=b+" toontalk-button";f.checked=a;h.innerHTML=c;f.id=g.generate_unique_id();h.htmlFor=f.id;$(h).addClass("ui-widget");e.appendChild(f);e.appendChild(h);g.give_tooltip(e,d);g.use_custom_tooltip(f);return{container:e,
button:f,label:h}};g.create_horizontal_table=function(){var a=document.createElement("table"),b,c,d;c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),c.appendChild(d),d.appendChild(arguments[b]));return a};g.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=g.create_row(arguments[b]),a.appendChild(c));return a};g.create_row=function(){var a=document.createElement("tr"),
b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)arguments[c]&&a.appendChild(arguments[c]);b.appendChild(a);return a};g.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);return b};g.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if($(arguments[a].label).is(".ui-state-focus"))return arguments[a]};g.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",
d);c.src="http://toontalk.github.io/ToonTalk/"+a},c.addEventListener("error",d));return c};g.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);
d.appendChild(f);b[c].id=e});c.appendChild(d);b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};g.add_iframe_popup=function(a){var b=document.createElement("iframe"),c=document.createElement("div");$(c).addClass("toontalk-close-popup-frame-button").button();c.addEventListener("click",function(a){$(b).remove();$(c).remove();a.stopPropagation()});c.innerHTML="Return to ToonTalk";$(b).addClass("toontalk-popup-frame");b.src=a;document.body.appendChild(c);document.body.appendChild(b)};g.create_file_data_table=
function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');a&&b.addClass(a);return b.get(0)};g.become_file_data_table=function(a,c,d,e){$(a).DataTable({data:c,autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,c,f,h){a=d?a.substring(0,a.length-5):a;c=d?b.google_drive.google_drive_url(f.id):"Click to load this program.";if(e)return"<div class='"+e+"' title='"+c+"'id='"+f.id+"'>"+a+"</div>";b.TRANSLATION_ENABLED&&(c=g.add_URL_parameter(c,"translate",
"1"));return"<a href='"+c+"'target='_blank' title='Click to open published page.'>"+a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};g.get_local_files_data=function(a){g.get_all_locally_stored_program_names(function(b){var c=[],d=function(e){var f=b[e];g.get_local_storage_meta_data(f,
function(g){g&&c.push({title:f,modifiedDate:g.last_modified,createdDate:g.created,fileSize:g.file_size});e<b.length?d(e+1):a(c)})};d(0)})};g.create_local_files_table=function(a){g.get_local_files_data(function(b){var c=g.create_file_data_table();g.when_attached(c,function(){g.become_file_data_table(c,b,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});a(c)})};g.get_$dragee=function(){return J};g.get_dragee=function(){return J&&b.UTILITIES.widget_side_of_jquery(J)};
g.get_resource_copy=function(){return fa};g.get_dragee_copy=function(){if(ca)return ca;var a=g.get_dragee();if(a&&!a.is_backside()&&(a.get_infinite_stack()||J.is(".toontalk-top-level-resource")))return ca||(J.is(".toontalk-top-level-resource")?(ca=a,fa=a.copy({fresh_copy:!0})):ca=a.add_copy_to_container(void 0,-1E3,-1E3)),ca};g.add_URL_parameter=function(a,b,c){a=g.remove_URL_parameter(a,b);var d;d=0<=a.indexOf("?")?"&":"?";return a+d+b+"="+c};g.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+
b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};g.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+
a:"an "+a};g.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};g.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};g.each_top_level_widget=function(a){$(".toontalk-backside-of-top-level").each(function(b,c){a(g.widget_side_of_element(c).get_widget())})};g.backup_all_top_level_widgets=function(a){g.each_top_level_widget(function(b){b.save(a)})};g.make_resizable=function(a,
b){var c,d;a.resizable({start:function(a,b){c=b.originalSize.width;d=b.originalSize.height},resize:function(e,f){a.is(".toontalk-element-frontside")&&(f.size.width!=c&&(b.increment_width(f.size.width-c),c=f.size.width),f.size.height!=d&&(b.increment_height(f.size.height-d),d=f.size.height));b.rerender()},stop:function(a,e){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,c,d,e.size.width,e.size.height)},handles:"n,e,s,w"})};g.match=function(a,b){var c,d;if(void 0===
a)return"matched";if(a.is_nest())d=a.match(b);else if(c=b.dereference(),d=a.match(c),d.is_widget&&c.matched_by)return c.matched_by(a);return d};g.current_URL=function(){return window.location.pathname};g.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};g.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&g.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};g.copy_frontside_dimensions=
function(a,b){var c=a.get_widget().get_frontside_element(),d;c&&(d=b.get_frontside_element(!0))&&g.set_css(d,{width:$(c).width(),height:$(c).height()})};g.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?g.scale_element(a,c,d,c,d):g.scale_element(a,$(b).width(),$(b).height(),c,d)};g.scale_element=function(a,c,d,e,f,h,k,l,m){var n=$(a).find("iframe"),p;if(0<n.length)n.attr("width",c).attr("height",d-20);else{$(a).is(".toontalk-not-observable")&&(n=b.UTILITIES.widget_side_of_element(a))&&
n.render();e||(p=$(a).children("img"),e=p.is("*")?p.width():$(a).width());f||(p||(p=$(a).children("img")),f=p.is("*")?p.height():$(a).height());p=c&&0!==e?c/e:a.toontalk_x_scale||1;n=d&&0!==f?d/f:a.toontalk_y_scale||1;0===p&&(p=1);0===n&&(n=1);a.toontalk_x_scale=p;a.toontalk_y_scale=n;l=(l=l&&l!==document.body?l:a.parentElement)&&0>l.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var r="";k||(k={});"number"===typeof k.left&&(k.left-=(e-c)/2,m=!0);"number"===typeof k.top&&
(k.top-=(f-d)/2,m=!0);!m&&l?(c&&(a.toontalk_translate_x=(c-e)/2,r+="translateX("+a.toontalk_translate_x+"px) "),d&&(a.toontalk_translate_y=(d-f)/2,r+="translateY("+a.toontalk_translate_y+"px) ")):(a.toontalk_translate_x=void 0,a.toontalk_translate_y=void 0);g.add_transform_to_css((h||"")+" scale("+p+", "+n+")",r,k,l);k.width=e;k.height=f;g.set_css(a,k);return{x_scale:p,y_scale:n}}};g.translate_x=function(a){return m("toontalk_translate_x","toontalk_x_scale")};g.translate_y=function(a){return m("toontalk_translate_y",
"toontalk_y_scale")};g.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||(c["transform-origin"]=d?"center center":"left top"),g.set_css_transform(c,b+a))};g.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};g.run_when_dimensions_known=function(a,c,d){var e=a.parentElement,f=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")&&!$(a).is(".toontalk-nest")},h;!d&&$(a).width()&&(f(e)||
$(a).is(".toontalk-element-frontside"))?setTimeout(function(){c(e)}):(h=function(d){setTimeout(function(){var k=$(a).width(),l=$(a).height();k&&l?f(a.parentElement)?($(a).removeClass("toontalk-not-observable"),c(e),e?(e.appendChild(a),b.UTILITIES.widget_side_of_element(a).rerender()):a.parentElement===document.body&&$(a).remove()):g.run_when_dimensions_known(a,c,!0):setTimeout(function(){g.widget_side_of_element(a);1E4>d&&h(2*d)},d)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),
d&&g.set_css(a,{width:"",height:"",transform:""}),h(1))};g.original_dimensions=function(a,b,c){var d=a.get_frontside_element();d.parentElement!==document.body&&g.run_when_dimensions_known(d,function(){var a=$(d).children("img");a.is("*")?b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};g.relative_position=function(a,b){var c,d;if(!g.is_attached(a))return{left:0,top:0};c=$(a).offset();b&&(d=$(b).offset(),c.left-=d.left,c.top-=d.top);return c};g.add_animation_class=function(a,b){g.set_css(a,
{width:"",height:""});$(a).addClass(b)};g.widget_side_of_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget_side};g.widget_side_of_element=function(a){return a.toontalk_widget_side};g.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};g.display_message=function(a,c){var d=g.create_alert_element(a),e=function(){$(d).remove();$(".toontalk-help-link").css({opacity:""})},
f;c||(c={});if(c.only_if_new)if(0>V.indexOf(a))V.push(a);else return a;$(".toontalk-alert-element").remove();b.debugging&&(console.log(c.plain_text||a),console.trace());if(c.element||c.second_choice_element)f=$(c.element).closest(".toontalk-backside"),0===f.length&&(f=$(c.second_choice_element).closest(".toontalk-backside")),0<f.length&&($(d).addClass("toontalk-local-alert"),f.append(d));c.element&&0!==f.length||($(".toontalk-help-link").css({opacity:0}),document.body.insertBefore(d,document.body.firstChild));
b.speak&&(window.speechSynthesis.cancel(),g.speak(c.plain_text||d.textContent));d.addEventListener("click",e);c.duration||(0<=a.indexOf("<")?c.duration=5E3:c.duration=Math.max(2E3,a.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)));setTimeout(e,c.duration);return a};g.display_tooltip=function(a){g.use_custom_tooltip(a.get(0));a.tooltip("open")};g.report_internal_error=function(a){console.error(a);console.trace();b.debugging&&g.display_message("Error: "+a)};g.get_current_url_boolean_parameter=
function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};g.get_current_url_numeric_parameter=function(a,b){var c=g.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(d){return 0}};g.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>d&&(d=window.location.href.length);return window.location.href.substring(c,
d)};g.get_path_to_toontalk_folder=function(){return b.TOONTALK_URL};g.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};e=g.is_browser_of_type("MSIE")||g.is_browser_of_type("Trident");g.is_internet_explorer=function(){return e};g.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};g.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};g.remove_z_index=function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;
a=$(a);a.attr("z-index","");return a.html()};g.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b=!1,c=function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),d.innerHTML="Run all tests",g.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),d.innerHTML="Stop all tests");b=!b},d;0!==a.length&&(a.button(),d=a.get(0),d.innerHTML=
"Run all tests",a.get(0).addEventListener("click",c))};g.set_timeout=function(a,b){b||g.is_internet_explorer()?setTimeout(a,b):(W.push(a),window.postMessage("zero-timeout-message","*"))};g.get_first_property=function(a){return Object.keys(a)[0]};g.get_all_locally_stored_program_names=function(a){g.retrieve_object("toontalk-all-program-names",function(b){if(b)a(b);else return a([])})};g.set_all_locally_stored_program_names=function(a){g.store_object("toontalk-all-program-names",a,function(){})};g.get_local_storage_meta_data=
function(a,b){var c=g.local_storage_program_meta_data_key(a);try{g.retrieve_object(c,b)}catch(d){b()}};g.local_storage_program_key=function(a){return"toontalk-json: "+a};g.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};b.CHROME_APP?(g.store_object=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);e[a]=JSON.stringify(c,g.clean_json);chrome.storage.local.set(e,d);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+
" caused by set "+a)},g.store_string=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a);e[a]=c;chrome.storage.local.set(e,d);b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a)},g.retrieve_object=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d[a]&&d[a].substring(0,100))+"... with key "+
a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+a);c(d[a]&&JSON.parse(d[a]))})},g.retrieve_string=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved string "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+a);c(d&&d[a])})}):(g.store_object=function(a,c,d){b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+
c+" with key "+a);window.localStorage.setItem(a,JSON.stringify(c,g.clean_json));d&&d()},g.store_string=function(a,b,c){window.localStorage.setItem(a,b);c&&c();chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by setItem "+a)},g.retrieve_object=function(a,c){var d=window.localStorage.getItem(a);b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d&&d.substring(0,100))+"... with key "+a);c(d&&JSON.parse(d))},g.retrieve_string=function(a,c){b.logging&&0<=b.logging.indexOf("retrieve")&&
console.log("Retrieved string "+(window.localStorage.getItem(a)&&window.localStorage.getItem(a).substring(0,100))+"... with key "+a);c(window.localStorage.getItem(a))});g.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};g.enable_touch_events=function(a,c){var d=a,e=function(e){var n;e.preventDefault();m&&(e.stopPropagation(),n=e.changedTouches[0],p&&(p.being_dragged=!1),$(a).removeClass("toontalk-being-dragged"),m+c>=Date.now()?(e=document.createEvent("MouseEvent"),
e.initMouseEvent("click",!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(e),p&&p.constrained_by_container()?$(a).css({left:"",top:""}):g.set_absolute_position(a,{left:l.left,top:l.top}),b.logging&&0===b.logging.indexOf("touch")&&u("touch end treated as click "+a.id,!0)):(h(e,a),b.logging&&0===b.logging.indexOf("touch")&&u("drag ended "+a.id),x(e,a),b.logging&&0===b.logging.indexOf("touch")&&u("drop happened "+a.id),b.logging&&0===b.logging.indexOf("touch")&&
u("",!0),g.set_absolute_position(a,{left:n.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:n.pageY-k-b.USABILITY_DRAG_OFFSET.y})),m=void 0,a=d)},f=0,k=0,l,m,p,r;a.addEventListener("touchstart",function(c){var d=c.changedTouches[0],e,h,v;l=$(a).offset();0===b.USABILITY_DRAG_OFFSET.y&&(b.USABILITY_DRAG_OFFSET.y=25);b.logging&&0===b.logging.indexOf("touch")&&u("touch start "+a.id);c.preventDefault();if("TEXTAREA"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||$(c.srcElement).is(".ui-resizable-handle"))b.logging&&
0===b.logging.indexOf("touch")&&u("touch start ignored due to tag name or class "+a.id);else if((e=g.find_widget_side_on_page(c.changedTouches[0],void 0,0,0))&&e.is_of_type("empty hole")&&(e=e.get_parent_of_frontside()),e&&e.get_frontside_element()!==a)b.logging&&0===b.logging.indexOf("touch")&&u("touch start ignored since has child who is really touched: "+g.widget_side_of_element(a));else{m=Date.now();b.logging&&0===b.logging.indexOf("touch")&&u("touch start of "+a.id+" at "+m);c.stopPropagation();
if(p=g.widget_side_of_element(a))p.being_dragged=!0;p&&p.get_infinite_stack()?(h=p.copy(),p.set_infinite_stack(!1),h.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(h=p.copy(),p.add_copy_to_container(h,0,0),v=$(a).offset(),a=h.get_frontside_element(!0));h&&(p.add_copy_to_container(h,0,0),p.robot_in_training()&&p.robot_in_training().copied(p,h,!1));$(a).css({"z-index":99999999});v||(v=$(a).offset());n(c,a);f=d.pageX-v.left;k=d.pageY-v.top;b.logging&&0===b.logging.indexOf("touch")&&
u("drag started "+a.id)}},!0);a.addEventListener("touchmove",function(c){var d=c.changedTouches[0];if(m){c.preventDefault();g.set_absolute_position(a,{left:d.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:d.pageY-k-b.USABILITY_DRAG_OFFSET.y});c=g.find_widget_side_on_page(d,a,b.USABILITY_DRAG_OFFSET.x,b.USABILITY_DRAG_OFFSET.y);if(r&&r!==c){var e=r.get_frontside_element();g.remove_highlight(e);r=void 0}c&&(K(d,c.get_element()),r=c);b.logging&&0===b.logging.indexOf("touch")&&u("dragged to "+(d.pageX-f)+", "+
(d.pageY-k)+" "+a.id)}},!0);a.addEventListener("touchend",e,!0);a.addEventListener("touchcancel",e,!0)};g.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};g.find_widget_side_on_page=function(a,b,c,d){var e=g.get_mouse_or_first_touch_event_attribute("pageX",a);a=g.get_mouse_or_first_touch_event_attribute("pageY",a);var f;b&&$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for(b&&$(b).show();c&&!c.toontalk_widget_side&&
!$(c).is(".toontalk-backside")&&!$(c).is(".toontalk-button")&&!$(c).is(".ui-button");)c=c.parentNode;c&&(f=c.toontalk_widget_side);if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),f};g.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-backside-of-top-level").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return g.widget_side_of_element(c)};g.set_css=function(a,b){var c,d;if(b&&
a){if(c=g.widget_side_of_element(a))if(d=c.dereference(),b.width&&!b["font-size"]&&(c.is_hole()?b["font-size"]=c.name_font_size(b.width,b.height):d.name_font_size&&(b["font-size"]=d.name_font_size(b.width,b.height))),!$(a).is(".toontalk-temporarily-set-down"))if(c.constrained_by_container())b.left="",b.top="";else if(c.is_plain_text_element()||c.is_nest()&&d.is_plain_text_element())b.width="",b.height="";0===b.width&&(b.width="");0===b.height&&(b.height="");b.transform||"number"!==typeof b.width||
"number"!==typeof b.height||!d||d.is_plain_text_element()&&d.constrained_by_container()||!d.use_scaling_transform?$(a).css(b):(c!==d&&$(a).css(b),d.use_scaling_transform(b))}};g.font_size=function(a,c,d){var e,f;if(!a||!c)return 0;d||(d={});e=a.split(/[\s\-]/);f=e.map(function(a){return a.length}).reduce(function(a,b){return Math.max(a,b)},-Infinity);c/=b.FONT_ASPECT_RATIO*(f+(d.margin||0));if(1===e.length)return d.height?Math.min(c,d.height):c;a=Math.ceil(a.length/f);c*a>.9*d.height&&(c*=Math.sqrt(d.height/
(c*a)),c*=.9);return c};g.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),d++;return e};g.conjunction=function(a,b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?g.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};g.insert_function_bird_documentation=function(a,b){var c=TOONTALK[a]["function"],d=Object.keys(c),e="<table class='toontalk-function-bird-documentation-table'>";d.forEach(function(a,b){e+="<tr><td><div id='bird_id_"+
b+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+c[a].title+"</td></tr>"});e+="</table>";$(b).html(e);d.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e&&(e.id=encodeURIComponent(b))})};g.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=g.widget_side_of_element(b);
c&&c.update_display(!0)})};g.visible_element=function(a){return a&&null!==a.offsetParent};g.get_audio_volume=function(a){var c=document.hidden?0:b.volume;0===c&&k.push({audio_object:a,volume:a.volume});return c};g.play_audio=function(a){a.play();l.push(a);a.addEventListener("ended",function(){var b=l.indexOf(a);0<=b&&l.splice(b,1)})};g.mute_audio_objects_playing=function(){l.forEach(function(a){k.push({audio_object:a,volume:a.volume});a.volume=0});l=[]};g.stop_audio_objects=function(){l.forEach(function(a){a.pause();
a.currentTime=0})};g.restore_audio_volumes=function(){k.forEach(function(a){a.audio_object.volume=a.volume;l.push(a.audio_object)});k=[]};g.is_attached=function(a){return jQuery.contains(window.document,a)};g.when_attached=function(a,b,c){var d=a.toontalk_attached_callback;jQuery.contains(window.document,a)&&!c?b():(a.toontalk_attached_callback=function(){d&&d();b();$(a).removeClass("toontalk-has-attached-callback");a.toontalk_attached_callback=void 0;a.toontalk_widget_side&&a.toontalk_widget_side.rerender()},
c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};g.create_event=function(a,b){var c;try{c=new CustomEvent(a,{detail:b})}catch(d){c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!1,!1,b)}return c};g.create_queue=function(){var a=[],c=0;return{getLength:function(){return a.length-c},isEmpty:function(){return 0==a.length},enqueue:function(c){var d=0==a.length;a.push(c);b.logging&&0<=b.logging.indexOf("queue")&&console.log(c._debug_string+" enqueued");
return d},dequeue:function(){var d;if(0!=a.length)return d=a[c],b.logging&&0<=b.logging.indexOf("queue")&&console.log(d._debug_string+" dequeued"),2*++c>=a.length&&(a=a.slice(c),c=0),d},peek:function(){return 0<a.length?a[c]:void 0},does_any_item_satisfy:function(b){var d;for(d=c;d<a.length;d++)if(b(a[d]))return!0;return!1}}};g.number_to_words=function(a){var b=a.indexOf("/"),c=function(a){var b="  half third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth seventeenth eighteenth nineteenth twentieth".split(" ");
if(20>=a)return b[a];if(0===a%10&&100>a)return"thirtieth fortieth fiftieth sixtieth seventieth eightieth ninetieth".split(" ")[a/10-3];if(100===a)return"hundredth";if(1E3===a)return"thousandth";if(1E4===a)return"ten thousandth";if(1E5===a)return"hundred thousandth";if(1E6===a)return"millionth";if(1E7===a)return"ten millionth";if(1E8===a)return"hundred millionth";if(1E9===a)return"billionth"},d,e;if(0>b)return g.integer_to_words(a);d=a.substring(0,b);e="1"!==d&&"-1"!==d;return b+3>=a.length||!e&&b+
11>=a.length?(c=c(parseInt(a.substring(b+1))))?g.integer_to_words(d)+" "+c+(e?"s":""):g.integer_to_words(d)+" over "+g.integer_to_words(a.substring(b+1)):g.integer_to_words(a.substring(0,b))+" over "+g.integer_to_words(a.substring(b+1))};g.integer_to_words=function(a){var b="",c=" un duo tre quattuor quin se septe octo nove".split(" "),d="   *   sx mn  mx".split(" "),e=" deci viginti triginta quadraginta quinquaginta sexaginta septuaginta octoginta nonaginta".split(" "),f=" n ms ns ns ns n n mx m".split(" "),
g=" centi ducenti trecenti quadringenti quingenti sescenti septingenti octingenti nongenti".split(" "),h=" nx n ns ns ns n n mx m".split(" "),k=" milli dumilli tremilli quadrinmilli quinmilli sesmilli septinmilli octinmilli nonmilli".split(" "),l=" decimilli vigintimilli trigintamilli quadragintanmilli quinquagintamilli sexagintamilli septuagintamilli octogintamilli nonagintamilli".split(" "),m=" centimilli ducentimilli trecentimilli quadringentimilli quingentimilli sescentimilli septingentimilli octingentimilli nongentimilli".split(" "),
n=" milli-milli milli-dumilli milli-tremilli milli-quadrinmilli milli-quinmilli milli-sesmilli milli-septinmilli milli-octinmilli milli-nonmilli".split(" "),p="thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion".split(" "),r,t,u,w,x,y,z,A,B,C,E,F,H=function(c){var d=0,e="",f;for(f=0;f<c;f++)if("0"!==a[f]||0<d)e+=a[f],d++;if(e){c=b;e=parseInt(e);f=" one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen twenty".split(" ");
var g=" ten twenty thirty forty fifty sixty seventy eighty ninety".split(" "),h="";100<=e&&(h+=f[Math.floor(e/100)]+" hundred",e%=100,0<e&&10>e&&(h+=" and"));20<e?(""!=h&&(h+=" "),h+=g[Math.floor(e/10)],e%=10,0<e&&(h+="-")):""!=h&&0<e&&(h+=" ");0<e&&(h+=f[e]);b=c+h.toString()}return d},I=function(a,b){var c,d;if(void 0!==a&&void 0!==b)for(c=0;c<a.length;c++)for(d=0;d<b.length;d++)if(a[c]==b[d]||"*"===a[c]&&("s"===b[d]||"x"===b[d]))return b[d]};"-"===a[0]&&(b+="negative ",a=a.substring(1));for(;0<
a.length&&"0"===a[0];)a=a.substring(1);if(0===a.length)return"zero";for(r=a.length;;){" "!==b[b.length-1]&&(b+=" ");if(4>r){0===H(r)&&","===b.substring(b.length-1)&&(b=b.substring(0,b.length-1));break}t=r-4;u=1+t%3;w=H(u);a=a.substring(u);r-=u;0<w&&(" "!==b[b.length-1]&&(b+=" "),x=Math.floor(t/3),u=x%10,10>x?b+=p[x]:(w=Math.floor(x/10%10),t=Math.floor(x/100%10),z=Math.floor(x/1E3%10),A=Math.floor(x/1E4%10),B=Math.floor(x/1E5%10),C=Math.floor(x/1E6%10),E=c[u],x=e[w],F=g[t],z=k[z],A=l[A],B=m[B],C=n[C],
y=void 0,E&&(b+=E,y=d[u]),x&&((u=I(y,f[w]))&&(b+=u),y=void 0,b+=x),F&&((u=I(y,h[t]))&&(b+=u),y=void 0,b+=F),b+=z,b+=A,b+=B,b+=C,"a"===b[b.length-1]&&(b=b.substring(0,b.length-2)+"i"),b+="llion"),b+=",")}b=b.trim();c=b.lastIndexOf(", ");if(0<=c)return b.substring(0,c)+" and"+b.substring(c+1);","===b[b.length-1]&&(b=b.substring(0,b.length-1));return b};g.test_number_to_words=function(a){var b,c;for(b=0;b<a;b++)c=Math.round(1E9*Math.random()),console.log(c+" = "+g.number_to_words(c.toString()))};g.for_each_batch=
function(a,b,c,d){var e;if(0!==a.length){void 0===d&&(d=0);c||(c=100);for(e=Math.min(a.length,d+c);d<e;d++)b(a[d],d);e<a.length&&g.set_timeout(function(){g.for_each_batch(a,b,c,e)})}};g.random_location_inside=function(a,b){var c=a.getBoundingClientRect();return{left:Math.random()*(c.width-b),top:Math.random()*(c.height-b)}};g.element_width=function(a){var b=$(a);if(b.is(".toontalk-conditions-contents"))return 240;if(!b.is(".toontalk-not-observable"))return a.getBoundingClientRect().width};g.element_height=
function(a){var b=$(a);if(b.is(".toontalk-conditions-contents"))return 60;if(!b.is(".toontalk-not-observable"))return a.getBoundingClientRect().height};g.resizable_and_scalable=function(a,b){var c=1,d=1,e;$(a).resizable({start:function(a,b){e={width:b.size.width,height:b.size.height}},resize:function(f,g){var h={width:g.size.width,height:g.size.height};$(a).is(".toontalk-backside-of-top-level")||(c*=h.width/e.width,d*=h.height/e.height,b(c,d),e=h)},handles:"n,e,s,w,se,ne,sw,nw"})};g.listen_for_speech=
function(a){var c,d,e,f,h,k,l,m;b.listen&&(c=a.commands||"",d=a.minimum_confidence||0,e=e||webkitSpeechGrammarList,window.speechSynthesis.speaking?setTimeout(function(){g.listen_for_speech(a)},1E3):(a.descriptions_acceptable&&(c+=" | I am | I'm "),a.names_acceptable&&(c+=" | My name is | call me "),f="#JSGF V1.0; grammar commands; public <commands> = "+c+";",e=new e,h=function(){try{ba.start()}catch(a){}},U=!0,ba="undefined"===typeof SpeechRecognition?new webkitSpeechRecognition:new SpeechRecognition,
e.addFromString(f,1),ba.grammars=e,ba.continuous=!1,ba.lang=g.translation_language_code(),ba.interimResults=!1,ba.maxAlternatives=5,ba.onresult=function(b){var e;for(m=0;m<b.results[0].length;m++)if(b.results[0][m].confidence>=d&&(e=b.results[0][m].transcript.toLowerCase(),!c||0<=c.indexOf(e+" |")||0<=c.indexOf("| "+e)||a.numbers_acceptable&&!isNaN(parseFloat(e))||a.descriptions_acceptable&&(0===e.indexOf("i am")||0===e.indexOf("i'm"))||a.names_acceptable&&(0===e.indexOf("my name is")||0===e.indexOf("call me")))){k=
b.results[0][m].transcript.toLowerCase();l=b.results[0][m].confidence;break}window.speechSynthesis.speaking?console.log("Ignoring speech since synthesising speech. "+(k||"")):k?(console.log(k+" confidence : "+l),a.descriptions_acceptable&&a.widget&&g.spoken_command_is_a_description(k,a.widget)?a.widget.rerender():a.names_acceptable&&a.widget&&g.spoken_command_is_a_naming(k,a.widget)?a.widget.rerender():a.success_callback&&a.success_callback(k,b)):console.log("confidence too low");ba.stop()},ba.onend=
function(){U&&h()},ba.onnomatch=function(b){a.fail_callback&&a.fail_callback(b)},ba.onerror=function(b){"no-speech"===b.error&&a.fail_callback&&a.fail_callback(b)},U&&h()))};g.stop_listening_for_speech=function(){ba&&(ba.stop(),U=!1)};g.spoken_command_is_a_description=function(a,b){var c;0===a.indexOf("i am")?c=a.substring(5):0===a.indexOf("i'm")&&(c=a.substring(4));if(c)return(g.get_dragee_copy()||b).set_description(c,!0,!0),g.display_message("The description of the "+b.get_type_name()+' is now "'+
c+'"'),!0};g.spoken_command_is_a_naming=function(a,b){var c;if(b.get_name&&(0===a.indexOf("my name is ")?c=a.substring(11):0===a.indexOf("call me ")&&(c=a.substring(8)),c))return(g.get_dragee_copy()||b).set_name(c,!0,!0),g.display_message("The name of the "+b.get_type_name()+' is now "'+c+'"'),!0};g.download_file=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a);c&&d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=function(){b(null)};d.send()};
g.set_parameter=function(a,c){b[a]=c;"TRANSLATION_ENABLED"===a&&c&&p()};g.initialize=function(a){var c=function(){var a=function(a,c,d,e,f){a=document.getElementById(a);var h;a&&(b.CHROME_APP?(h=function(a){g.add_iframe_popup(c)},h=g.create_button(d,"toontalk-manual-button",e,h)):(h=document.createElement("a"),h.innerHTML=d,h.href=c,h.title=e,h.target="_blank",$(h).addClass("ui-widget toontalk-help-link"),g.use_custom_tooltip(h)),a.appendChild(h),$(h).css(f))};a("toontalk-manual-button","docs/manual/index.html?reset=1",
"Learn about ToonTalk","Click to visit the page that introduces everything.",{background:"yellow"});a("toontalk-manual-tour","docs/tours/tour1.html?reset=1","Watch a tour of ToonTalk","Click to visit a page that replays a tour.",{background:"pink"});a("toontalk-manual-whats-new","docs/manual/whats-new.html?reset=1","What's new?","Click to visit see what has changed recently.",{background:"cyan"})},e=function(a){try{window.speechSynthesis.cancel()}catch(c){}try{g.backup_all_top_level_widgets(!0)}catch(c){b.UTILITIES.report_internal_error(c)}};
a=function(){f=function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget_side;c&&c.set_running&&c.set_running(!1)})};b.debugging=g.get_current_url_parameter("debugging");b.logging=g.get_current_url_parameter("log");b.volume=g.get_current_url_numeric_parameter("volume",10)/100;0<b.volume&&M();b.puzzle=g.get_current_url_boolean_parameter("puzzle",!1);b.open_backside_only_if_alt_key=g.get_current_url_boolean_parameter("alt_key_to_open_backside",b.puzzle);b.reset=
g.get_current_url_boolean_parameter("reset",b.puzzle);b.speak=g.get_current_url_boolean_parameter("speak",!1);b.listen=g.get_current_url_boolean_parameter("listen",!1);b.speak&&!window.speechSynthesis&&(b.speak=!1,g.display_message("This browser doesn't support speech output. speak=1 in URL ignored."));b.balloons=g.get_current_url_boolean_parameter("balloons",!0);b.TRANSLATION_ENABLED=g.get_current_url_boolean_parameter("translate",!1);b.FONT_ASPECT_RATIO=.64;b.animation_settings||(b.animation_settings=
{BIRD_ANIMATION_SPEED:.5,ROBOT_ANIMATION_SPEED:.25,BAMMER_ANIMATION_SPEED:.75,ANIMATION_SPEED:.5,OPEN_BACKSIDE_DURATION:500,CHANGE_SIZE_DURATION:1E3,BUTTON_USE_DELAY:200,STOP_TRAINING_DELAY:1500,PAUSE_BETWEEN_STEPS:50,PAUSE_BETWEEN_BIRD_STEPS:50});g.process_json_elements();window.document.addEventListener("click",f);b.DEFAULT_QUEUE=window.TOONTALK.queue.create();b.DEFAULT_QUEUE.start();b.CHROME_APP?chrome.runtime.onSuspend.addListener(e):window.addEventListener("beforeunload",e);b.TRANSLATION_ENABLED?
p():$("#google_translate_element").remove();b.vacuum.the_vacuum||b.vacuum.create();g.add_test_all_button();c();A("toontalk-robot",b.robot);A("toontalk-empty-nest",b.nest);A("toontalk-bird-static",b.bird);$("[title]").each(function(a,b){g.use_custom_tooltip(b)});TOONTALK.RUNNING_LOCALLY||(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)};a[e].l=1*new Date;f=b.createElement(c);g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,
g)}(window,document,"script",b.CHROME_APP?TOONTALK.TOONTALK_URL+"libraries/analytics.js":"https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-57964541-1","auto"),b.CHROME_APP?(ga("set","checkProtocolTask",function(){}),ga("require","displayfeatures"),ga("send","pageview","/options.html")):ga("send","pageview"));document.addEventListener("visibilitychange",function(){document.hidden?g.mute_audio_objects_playing():(g.rerender_all(),g.restore_audio_volumes())});setTimeout(function(){b.DISPLAY_UPDATES.update_display()},
100);"undefined"===typeof b.cross_origin_url_function&&g.download_file("http://crossorigin.me/https://drive.google.com/uc?id=0B0taMM6vlEqQaWprd2d1ZnlmQWs",function(a){"working"===a&&(b.cross_origin_url_function=function(a){return"http://crossorigin.me/"+a})});d=!0;document.dispatchEvent(b.UTILITIES.create_event("toontalk_initialized",{}))};var f;d||(g.get_current_url_parameter("replace-with-url")?H(a):a())};g.do_after_initialization=function(a){d?a():document.addEventListener("toontalk_initialized",
a)};return g}(window.TOONTALK);window.initialize_toontalk=window.TOONTALK.UTILITIES.initialize;
