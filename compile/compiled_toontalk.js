(function(b){var k;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(k={},define(function(){return k})):k="undefined"!==typeof window?window:b:k=exports;(function(b){var f={greatest_common_divisor:function(a,b){if(1===b||1===a)return 1;for(var c;0!==b;){c=b;b=a%b;if(!isFinite(b))return 0;a=c}return a}};f.gcd=f.greatest_common_divisor;f.fromRandom=function(a){return Math.random()*(1<<a)>>>0};f.fromMillitime=function(){return+new Date};f.fromUnixtime=
function(){return.001*f.fromMillitime()|0};"undefined"!==typeof b&&(b.integer=f);(function(a){function b(a,n,g){if(g!==c)return a instanceof b?a:"undefined"===typeof a?d:b.parse(a);for(a=a||[];a.length&&!a[a.length-1];)--a.length;this._d=a;this._s=a.length?n||1:0}var c={};b._construct=function(a,d){return new b(a,d,c)};b.base=1E7;b.base_log10=7;var d=new b([],0,c);b.ZERO=d;var n=new b([1],1,c);b.ONE=n;var g=new b(n._d,-1,c);b.M_ONE=g;b._0=d;b._1=n;b.small=[d,n,new b([2],1,c),new b([3],1,c),new b([4],
1,c),new b([5],1,c),new b([6],1,c),new b([7],1,c),new b([8],1,c),new b([9],1,c),new b([10],1,c),new b([11],1,c),new b([12],1,c),new b([13],1,c),new b([14],1,c),new b([15],1,c),new b([16],1,c),new b([17],1,c),new b([18],1,c),new b([19],1,c),new b([20],1,c),new b([21],1,c),new b([22],1,c),new b([23],1,c),new b([24],1,c),new b([25],1,c),new b([26],1,c),new b([27],1,c),new b([28],1,c),new b([29],1,c),new b([30],1,c),new b([31],1,c),new b([32],1,c),new b([33],1,c),new b([34],1,c),new b([35],1,c),new b([36],
1,c)];b.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");b.prototype.toString=function(a){a=+a||10;if(2>a||36<a)throw Error("illegal radix "+a+".");if(0===this._s)return"0";if(10===a){a=0>this._s?"-":"";a+=this._d[this._d.length-1].toString();for(var c=this._d.length-2;0<=c;c--){for(var d=this._d[c].toString();7>d.length;)d="0"+d;a+=d}return a}c=b.digits;a=b.small[a];for(var d=this._s,n=this.abs(),g=[],e;0!==n._s;)e=n.divRem(a),n=e[0],e=e[1],g.push(c[e.valueOf()]);return(0>d?"-":"")+g.reverse().join("")};
b.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,
/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];b.parse=function(a,n){function g(b){b=b.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return b.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(b,a,c,d,n){n=+n;var g=0>n,e=c.length+n;b=(g?c:d).length;n=(n=Math.abs(n))>=b?n-b+g:0;b=Array(n+1).join("0");c+=d;return(a||"")+(g?c=b+c:c+=b).substr(0,e+=g?b.length:0)+(e<c.length?"."+c.substr(e):"")})}a=a.toString();if("undefined"===typeof n||10===+n)a=g(a);var e=(new RegExp("^([+\\-]?)("+("undefined"===
typeof n?"0[xcb]":16==n?"0x":8==n?"0c":2==n?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i")).exec(a);if(e){var r=e[1]||"+",f=e[2]||"",e=e[3]||"";if("undefined"===typeof n)n="0x"===f||"0X"===f?16:"0c"===f||"0C"===f?8:"0b"===f||"0B"===f?2:10;else if(2>n||36<n)throw Error("Illegal radix "+n+".");n=+n;if(!b.radixRegex[n].test(e))throw Error("Bad digit for radix "+n);e=e.replace(/^0+/,"").split("");if(0===e.length)return d;r="-"===r?-1:1;if(10==n){for(f=[];7<=e.length;)f.push(parseInt(e.splice(e.length-b.base_log10,
b.base_log10).join(""),10));f.push(parseInt(e.join(""),10));return new b(f,r,c)}f=d;n=b.small[n];for(var h=b.small,m=0;m<e.length;m++)f=f.multiply(n).add(h[parseInt(e[m],36)]);return new b(f._d,r,c)}throw Error("Invalid BigInteger format: "+a);};b.prototype.add=function(a){if(0===this._s)return b(a);a=b(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.subtract(a);var d=this._d;a=a._d;for(var n=d.length,g=a.length,e=Array(Math.max(n,g)+1),r=Math.min(n,g),f=0,h=0;h<r;h++)f=d[h]+
a[h]+f,e[h]=f%1E7,f=f/1E7|0;g>n&&(d=a,n=g);for(h=r;f&&h<n;h++)f=d[h]+f,e[h]=f%1E7,f=f/1E7|0;for(f&&(e[h]=f);h<n;h++)e[h]=d[h];return new b(e,this._s,c)};b.prototype.negate=function(){return new b(this._d,-this._s|0,c)};b.prototype.abs=function(){return 0>this._s?this.negate():this};b.prototype.subtract=function(a){if(0===this._s)return b(a).negate();a=b(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.add(a);var n=this;0>this._s&&(n=new b(a._d,1,c),a=new b(this._d,1,c));var g=
n.compareAbs(a);if(0===g)return d;if(0>g){var e=a;a=n;n=e}n=n._d;a=a._d;var e=n.length,r=a.length,f=Array(e),h=0,m,l;for(m=0;m<r;m++)l=n[m]-h-a[m],0>l?(l+=1E7,h=1):h=0,f[m]=l;for(m=r;m<e;m++){l=n[m]-h;if(0>l)l+=1E7;else{f[m++]=l;break}f[m]=l}for(;m<e;m++)f[m]=n[m];return new b(f,g,c)};(function(){function a(a,d){for(var n=a._d,g=n.slice(),e=0;;){var f=(n[e]||0)+1;g[e]=f%1E7;if(9999999>=f)break;++e}return new b(g,d,c)}function d(a,d){for(var n=a._d,g=n.slice(),e=0;;){var f=(n[e]||0)-1;if(0>f)g[e]=
f+1E7;else{g[e]=f;break}++e}return new b(g,d,c)}b.prototype.next=function(){switch(this._s){case 0:return n;case -1:return d(this,-1);default:return a(this,1)}};b.prototype.prev=function(){switch(this._s){case 0:return g;case -1:return a(this,-1);default:return d(this,1)}}})();b.prototype.compareAbs=function(a){if(this===a)return 0;if(!(a instanceof b)){if(!isFinite(a))return isNaN(a)?a:-1;a=b(a)}if(0===this._s)return 0!==a._s?-1:0;if(0===a._s)return 1;var c=this._d.length,d=a._d.length;if(c<d)return-1;
if(c>d)return 1;d=this._d;a=a._d;for(--c;0<=c;c--)if(d[c]!==a[c])return d[c]<a[c]?-1:1;return 0};b.prototype.compare=function(a){if(this===a)return 0;a=b(a);return 0===this._s?-a._s:this._s===a._s?this.compareAbs(a)*this._s:this._s};b.prototype.isUnit=function(){return this===n||this===g||1===this._d.length&&1===this._d[0]};b.prototype.multiply=function(a){if(0===this._s)return d;a=b(a);if(0===a._s)return d;if(this.isUnit())return 0>this._s?a.negate():a;if(a.isUnit())return 0>a._s?this.negate():this;
if(this===a)return this.square();var n=this._d.length>=a._d.length,g=(n?this:a)._d,n=(n?a:this)._d,e=g.length,f=n.length,r=e+f,h=Array(r),m;for(m=0;m<r;m++)h[m]=0;for(m=0;m<f;m++){for(var r=0,l=n[m],q=e+m,k,z=m;z<q;z++)k=h[z]+l*g[z-m]+r,r=k/1E7|0,h[z]=k%1E7|0;r&&(k=h[z]+r,h[z]=k%1E7)}return new b(h,this._s*a._s,c)};b.prototype.multiplySingleDigit=function(a){if(0===a||0===this._s)return d;if(1===a)return this;var n;if(1===this._d.length)return n=this._d[0]*a,1E7<=n?new b([n%1E7|0,n/1E7|0],1,c):new b([n],
1,c);if(2===a)return this.add(this);if(this.isUnit())return new b([a],1,c);var g=this._d,e=g.length;n=e+1;for(var f=Array(n),r=0;r<n;r++)f[r]=0;for(var h=r=0;h<e;h++)n=a*g[h]+r,r=n/1E7|0,f[h]=n%1E7|0;r&&(f[h]=r);return new b(f,1,c)};b.prototype.square=function(){if(0===this._s)return d;if(this.isUnit())return n;var a=this._d,g=a.length,e=Array(g+g+1),f,r,h,m;for(m=0;m<g;m++)h=2*m,f=a[m]*a[m],r=f/1E7|0,e[h]=f%1E7,e[h+1]=r;for(m=0;m<g;m++){r=0;h=2*m+1;for(var l=m+1;l<g;l++,h++)f=a[l]*a[m]*2+e[h]+r,
r=f/1E7|0,e[h]=f%1E7;h=g+m;f=r+e[h];r=f/1E7|0;e[h]=f%1E7;e[h+1]+=r}return new b(e,1,c)};b.prototype.quotient=function(a){return this.divRem(a)[0]};b.prototype.divide=b.prototype.quotient;b.prototype.remainder=function(a){return this.divRem(a)[1]};b.prototype.divRem=function(a){a=b(a);if(0===a._s)throw Error("Divide by zero");if(0===this._s)return[d,d];if(1===a._d.length)return this.divRemSmall(a._s*a._d[0]);switch(this.compareAbs(a)){case 0:return[this._s===a._s?n:g,d];case -1:return[d,this]}var e=
this._s*a._s,f=a.abs(),r=this._d,h=r.length,m=[],l,q=new b([],0,c);for(q._s=1;h;)if(q._d.unshift(r[--h]),0>q.compareAbs(a))m.push(0);else{if(0===q._s)l=0;else{var k=q._d.length;l=f._d.length;k=1E7*q._d[k-1]+q._d[k-2];l=1E7*f._d[l-1]+f._d[l-2];q._d.length>f._d.length&&(k=1E7*(k+1));l=Math.ceil(k/l)}do{k=f.multiplySingleDigit(l);if(0>=k.compareAbs(q))break;l--}while(l);m.push(l);l&&(l=q.subtract(k),q._d=l._d.slice(),0===q._d.length&&(q._s=0))}return[new b(m.reverse(),e,c),new b(q._d,this._s,c)]};b.prototype.divRemSmall=
function(a){a=+a;if(0===a)throw Error("Divide by zero");var n=this._s*(0>a?-1:1);a=Math.abs(a);if(1>a||1E7<=a)throw Error("Argument out of range");if(0===this._s)return[d,d];if(1===a||-1===a)return[1===n?this.abs():new b(this._d,n,c),d];if(1===this._d.length){var g=new b([this._d[0]/a|0],1,c);a=new b([this._d[0]%a|0],1,c);0>n&&(g=g.negate());0>this._s&&(a=a.negate());return[g,a]}for(var e=this._d.slice(),g=Array(e.length),f=0,r=0,h=0,m;e.length;)f=1E7*f+e[e.length-1],f<a?(g[h++]=0,e.pop(),r=1E7*r+
f):(m=0===f?0:f/a|0,r=f-a*m,(g[h++]=m)?(e.pop(),f=r):e.pop());a=new b([r],1,c);0>this._s&&(a=a.negate());return[new b(g.reverse(),n,c),a]};b.prototype.isEven=function(){var a=this._d;return 0===this._s||0===a.length||0===a[0]%2};b.prototype.isOdd=function(){return!this.isEven()};b.prototype.sign=function(){return this._s};b.prototype.isPositive=function(){return 0<this._s};b.prototype.isNegative=function(){return 0>this._s};b.prototype.isZero=function(){return 0===this._s};b.prototype.exp10=function(a){a=
+a;if(0===a)return this;if(Math.abs(a)>Number(e))throw Error("exponent too large in BigInteger.exp10");if(0<a){for(var n=new b(this._d.slice(),this._s,c);7<=a;a-=7)n._d.unshift(0);if(0==a)return n;n._s=1;n=n.multiplySingleDigit(Math.pow(10,a));return 0>this._s?n.negate():n}if(-a>=7*this._d.length)return d;n=new b(this._d.slice(),this._s,c);for(a=-a;7<=a;a-=7)n._d.shift();return 0==a?n:n.divRemSmall(Math.pow(10,a))[0]};b.prototype.pow=function(a){if(this.isUnit())return 0<this._s?this:b(a).isOdd()?
this:this.negate();a=b(a);if(0===a._s)return n;if(0>a._s){if(0===this._s)throw Error("Divide by zero");return d}if(0===this._s)return d;if(a.isUnit())return this;if(0<a.compareAbs(e))throw Error("exponent too large in BigInteger.pow");for(var c=this,g=n,f=b.small[2];a.isPositive()&&(!a.isOdd()||(g=g.multiply(c),!a.isUnit()));)c=c.square(),a=a.quotient(f);return g};b.prototype.modPow=function(a,c){for(var d=n,g=this;a.isPositive();)a.isOdd()&&(d=d.multiply(g).remainder(c)),a=a.quotient(b.small[2]),
a.isPositive()&&(g=g.square().remainder(c));return d};b.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var a=this._d.length;if(30>7*a)return Math.log(this.valueOf());var d=Math.ceil(30/7),n=this._d.slice(a-d);return Math.log((new b(n,1,c)).valueOf())+(a-d)*Math.log(1E7)};b.prototype.valueOf=function(){return parseInt(this.toString(),10)};b.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var e=b(2147483647);b.MAX_EXP=e;(function(){function a(a){return function(c){return a.call(b(c))}}
function c(a){return function(c,d){return a.call(b(c),b(d))}}function d(a){return function(c,d,n){return a.call(b(c),b(d),b(n))}}(function(){var n,g,e="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),f="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),r=["modPow"];for(n=0;n<e.length;n++)g=e[n],b[g]=a(b.prototype[g]);for(n=0;n<f.length;n++)g=f[n],b[g]=c(b.prototype[g]);for(n=0;n<r.length;n++)g=
r[n],b[g]=d(b.prototype[g]);b.exp10=function(a,c){return b(a).exp10(c)}})()})();a.BigInteger=b})("undefined"!==typeof b?b:this);var e={greatest_common_divisor:function(a,b){if(b.isUnit()||a.isUnit())return BigInteger.ONE;for(var c;!b.isZero();)c=b,b=a.remainder(b),a=c;return a},create:function(){return[0]},clone:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b},copy:function(a,b){a=[];for(var c=0,d=b.length;c<d;c++)a[c]=b[c];return a},abs:function(a,b){a[0]=Math.abs(b[0]);return a},
str:function(a){return a[0].toString()},toInteger:function(a){return out[0]},fromInteger:function(a){return[parseInt(a)]}};e.ZERO=e.fromInteger(0);e.ONE=e.fromInteger(1);"undefined"!==typeof b&&(b.bigint=e);if(!a)var a=Array;if(!d)var d=Math.pow(2,56);if(!c)var c=16777216;var g={EPSILON:2E-16};g.MAX_LOOPS=c;g.create=function(){var b=new a(2);b[0]=0;b[1]=1;return b};g.clone=function(b){var c=new a(2);c[0]=b[0];c[1]=b[1];return c};g.fromValues=function(b,c){var d=new a(2);d[0]=b;d[1]=c;return g.normalize(d,
d)};g.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};g.set=function(a,b,c){a[0]=b;a[1]=c;return g.normalize(a,a)};g.abs=function(a,b){a[0]=Math.abs(b[0]);a[1]=b[1];return a};g.invert=function(a,b){var c=b[0];a[0]=b[1];a[1]=c;return a};g.reciprocal=g.invert;g.add=function(a,b,c){b[1]===c[1]?(a[0]=b[0]+c[0],a[1]=b[1]):(a[0]=b[0]*c[1]+c[0]*b[1],a[1]=b[1]*c[1]);return g.normalize(a,a)};g.subtract=function(a,b,c){b[1]===c[1]?(a[0]=b[0]-c[0],a[1]=b[1]):(a[0]=b[0]*c[1]-c[0]*b[1],a[1]=b[1]*c[1]);return g.normalize(a,
a)};g.sub=g.subtract;g.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return g.normalize(a,a)};g.mul=g.multiply;g.mediant=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return g.normalize(a,a)};g.divide=function(a,b,c){a[0]=b[0]*c[1];a[1]=b[1]*c[0];return g.normalize(a,a)};g.div=g.divide;g.equals=function(a,b){return 0===a[0]&&0===b[0]||0===a[1]&&0===b[1]?!0:a[0]===b[0]&&a[1]===b[1]};g.approximates=function(a,b){if(g.equals(a,b))return!0;var c=g.create();g.sub(c,a,b);g.abs(c,c);return g.isLessThan(c,
g.INFINITESIMAL)};g.isGreaterThan=function(a,b){return g.equals(a,b)?!1:a[0]*b[1]>b[0]*a[1]};g.isLessThan=function(a,b){return g.equals(a,b)?!1:a[0]*b[1]<b[0]*a[1]};g.isNegative=function(a){return 0>a[0]};g.min=function(a,b,c){g.isLessThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.max=function(a,b,c){g.isGreaterThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};g.scalar_multiply=function(a,b,c){a[0]=b[0]*c;a[1]=b[1];return g.normalize(a,a)};g.scalar_divide=function(a,
b,c){a[0]=b[0];a[1]=b[1]*c;return g.normalize(a,a)};g.normalize=function(a,b){if(isNaN(b[0])||isNaN(b[1])||0===b[0]&&0===b[1])return a[0]=0,a[1]=0,a;if(0===b[0])return a[0]=0,a[1]=1,a;if(0===b[1])return a[0]=1,a[1]=0,a;if(b[0]===b[1])return a[0]=1,a[1]=1,a;0<b[1]?(a[0]=b[0],a[1]=b[1]):(a[0]=-b[0],a[1]=-b[1]);var c=f.greatest_common_divisor(Math.abs(a[0]),a[1]);1<c&&(a[0]/=c,a[1]/=c);return a};g.opposite=function(a,b){a[0]=-b[0];a[1]=b[1];return a};g.negative=g.opposite;g.neg=g.opposite;g.power=function(a,
b,c){2===c?(a[0]=b[0]*b[0],a[1]=b[1]*b[1]):0<c?(a[0]=Math.pow(b[0],c),a[1]=Math.pow(b[1],c)):0>c?(c=Math.abs(c),a[0]=Math.pow(b[1],c),a[1]=Math.pow(b[0],c)):g.copy(a,g.ONE);return g.normalize(a,a)};g.pow=g.power;g.sqrt=function(a,b){return g.nthRoot(a,b,2)};g.nthRoot=function(a,b,c){if(g.equals(b,g.ZERO))return g.copy(a,g.ZERO);if(g.equals(b,g.ONE))return g.copy(a,g.ONE);if(g.equals(b,g.INFINITY))return g.copy(a,g.INFINITY);if(g.equals(b,g.INFINULL))return g.copy(a,g.INFINULL);var d=g.isNegative(b);
d&&(b[0]=-b[0]);a=g.copy(a,g.ONE);for(var n=[1,0,0,1],e=g.clone(g.ONE),f=g.MAX_LOOPS;!g.approximates(b,e)&&f--;)g.isLessThan(b,e)?(n[0]+=n[1],n[2]+=n[3]):(n[1]+=n[0],n[3]+=n[2]),a[0]=n[0]+n[1],a[1]=n[2]+n[3],g.pow(e,a,c);d&&(b[0]=-b[0],1===c%2&&g.neg(a,a));return a};g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};g.str=function(a){return 1===a[1]?a[0].toString():a[0]+"/"+a[1]};g.toDecimal=function(a){return a[0]/a[1]};g.dec=g.toDecimal;g.toInteger=function(a){return Math.round(g.toDecimal(a))};g.round=
g.toInteger;g.floor=function(a){return Math.floor(g.toDecimal(a))};g.ceil=function(a){return Math.ceil(g.toDecimal(a))};g.fromInteger_copy=function(a,b){a[0]=parseInt(b);a[1]=1;return a};g.fromInteger=function(a){return g.fromInteger_copy(g.create(),a)};g.fromIntegerInverse_copy=function(a,b){a[0]=1;a[1]=parseInt(b);0>a[1]&&(a[0]=-a[0],a[1]=-a[1]);return a};g.fromIntegerInverse=function(a){return g.fromIntegerInverse_copy(g.create(),a)};g.fromDecimal=function(a){return g.fromDecimal_copy(g.create(),
a)};g.fromDecimal_copy=function(a,b){b=parseFloat(b);if(isNaN(b))return g.copy(a,g.INFINULL);if(Infinity===b)return g.copy(a,g.INFINITY);if(Math.abs(b)<g.EPSILON)return g.copy(a,g.ZERO);if(Math.abs(b-1)<g.EPSILON)return g.copy(a,g.ONE);if(Math.abs(b%1)<g.EPSILON)return g.fromInteger_copy(a,b);if(Math.abs(1/b%1)<g.EPSILON)return g.fromIntegerInverse_copy(a,Math.round(1/b));g.copy(a,g.ONE);for(var c=[1,0,0,1],d=b,e,n=g.MAX_LOOPS;n--&&Math.abs(b-g.toDecimal(a))>g.EPSILON;){e=Math.floor(d);a[0]=e*c[0]+
c[2];a[1]=e*c[1]+c[3];if(d===e)break;d=1/(d-e);c[2]=c[0];c[3]=c[1];c[0]=a[0];c[1]=a[1]}return a};g.fromRandom=function(a){a[0]=0xfffffffffffff*Math.random()<<0;a[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return g.normalize(a,a)};g.sin=function(a,b){if(0===b[1])return g.copy(a,g.ZERO);g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.add(c,c,g.ONE);g.divide(a,a,c);return a};g.cos=function(a,b){if(0===b[1])return g.neg(a,g.ONE);var c=g.create();g.pow(c,b,2);g.sub(a,g.ONE,c);var d=g.create();
g.add(d,g.ONE,c);g.divide(a,a,d);return a};g.tan=function(a,b){g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.scalar_multiply(c,c,2);g.add(a,a,c);g.pow(c,b,4);g.sub(c,g.ONE,c);g.divide(a,a,c);return a};g.toEgyptian=function(a){a=g.clone(a);g.abs(a,a);var b=g.floor(a);b&&g.sub(a,a,g.fromInteger(b));if(!a[0])return b.toString();b||(b="");var c=1,d;for(g.create();1!==a[0];)c++,d=g.fromValues(1,c),g.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=g.str(d),g.sub(a,a,d));return a?b?b+" + "+g.str(a):g.str(a):
b?b:"0"};g.toBabylonian=function(a){var b="",c=g.toDecimal(a);a=parseInt(c);for(var c=c-a,d=0,e=0;0<a;)(d=a%60)&&(b=d+" * 60^"+e+(b?" + ":"")+b),a=(a-d)/60,e++;for(e=-1;0<c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+e),e--);return b?b:"0"};g.traceSternBrocot=function(a){var b="";if(g.equals(a,g.ZERO)||g.equals(a,g.ONE)||g.equals(a,g.INFINITY)||g.equals(a,g.INFINULL))return b;a=g.clone(a);g.isNegative(a)&&(a[0]=-a[0]);for(var c=g.clone(g.ONE),d=[1,0,0,1],e=0,n=0,f=g.MAX_LOOPS;!g.approximates(a,
c)&&f--;)g.isLessThan(a,c)?(d[0]+=d[1],d[2]+=d[3],n++,e&&(b+="R",1!==e&&(b+=e),e=0,b+=" ")):(d[1]+=d[0],d[3]+=d[2],e++,n&&(b+="L",1!==n&&(b+=n),n=0,b+=" ")),c[0]=d[0]+d[1],c[1]=d[2]+d[3];n?(b+="L",1!==n&&(b+=n)):e&&(b+="R",1!==e&&(b+=e));0>f&&(b+="...");return b};g.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(g.equals(a,g.ZERO))return[0];if(g.equals(a,g.ONE))return[1];if(g.equals(a,g.NEGONE))return[-1];if(g.equals(a,g.INFINITY))return[1,0];if(g.equals(a,g.INFINULL))return[0,
0];var c=g.clone(a),d=g.isNegative(c);d&&(c[0]=-c[0]);for(var e=g.clone(g.ONE),n=[1,0,0,1],f=1,h=[0],m=h.length-1;!g.equals(c,e)&&b--;)g.isLessThan(c,e)?(-1===f?h[m]++:(f=-1,h.push(1),m++),n[0]+=n[1],n[2]+=n[3]):(1===f?h[m]++:(f=1,h.push(1),m++),n[1]+=n[0],n[3]+=n[2]),e[0]=n[0]+n[1],e[1]=n[2]+n[3];0>b?h.push(0):h[m]++;if(d)for(var r in h)h[r]=-h[r];return h};g.fromContinuedFraction=function(a,b){g.fromInteger_copy(a,b[b.length-1]);for(var c=b.length-2;-1<c;c--)g.invert(a,a),g.add(a,g.fromInteger(b[c]),
a);return a};g.dump=function(a){g.create();return"rat\t"+g.str(a)+"\n~\t"+g.toDecimal(a)+"\nCF:\t["+g.toContinuedFraction(a)+"]\n"};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);g.NEGONE=g.fromInteger(-1);g.INFINITY=g.fromValues(1,0);g.INFINULL=g.fromValues(0,0);g.INFINITESIMAL=g.clone([1,d]);g.PI=g.fromValues(1320192667429,420230377710);"undefined"!==typeof b&&(b.rat=g);if(!m)var m=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!v)var v=1073741824;var l={EPSILON:2E-16};l.MAX_LOOPS=v;l.create=
function(){var a=[];a[0]=BigInteger.ZERO;a[1]=BigInteger.ONE;return a};l.clone=function(a){var b=[];b[0]=a[0];b[1]=a[1];return b};l.fromValues=function(a,b){var c=[];c[0]=new BigInteger(a);c[1]=new BigInteger(b);return l.normalize(c,c)};l.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};l.set=function(a,b,c){a[0]=b;a[1]=c;return l.normalize(a,a)};l.toRat=function(a,b){return g.set(a,b[0].toJSValue(),b[1].toJSValue())};l.fromRat=function(a,b){return l.set(a,BigInteger(b[0]),BigInteger(b[1]))};l.abs=
function(a,b){a[0]=b[0].abs();a[1]=b[1];return a};l.invert=function(a,b){var c=b[0];a[0]=b[1];a[1]=c;return a};l.reciprocal=l.invert;l.add=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].add(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).add(c[0].multiply(b[1])),a[1]=b[1].multiply(c[1]));return l.normalize(a,a)};l.subtract=function(a,b,c){0===b[1].compare(c[1])?(a[0]=b[0].subtract(c[0]),a[1]=b[1]):(a[0]=b[0].multiply(c[1]).subtract(c[0].multiply(b[1])),a[1]=b[1].multiply(c[1]));return l.normalize(a,
a)};l.sub=l.subtract;l.multiply=function(a,b,c){a[0]=b[0].multiply(c[0]);a[1]=b[1].multiply(c[1]);return l.normalize(a,a)};l.mul=l.multiply;l.mediant=function(a,b,c){a[0]=b[0].add(c[0]);a[1]=b[1].add(c[1]);return l.normalize(a,a)};l.divide=function(a,b,c){a[0]=b[0].multiply(c[1]);a[1]=b[1].multiply(c[0]);return l.normalize(a,a)};l.div=l.divide;l.equals=function(a,b){return a[0].isZero()&&b[0].isZero()||a[1].isZero()&&b[1].isZero()?!0:0===a[0].compare(b[0])&&0===a[1].compare(b[1])};l.approximates=
function(a,b){if(l.equals(a,b))return!0;var c=l.create();l.sub(c,a,b);l.abs(c,c);return l.isLessThan(c,l.INFINITESIMAL)};l.isGreaterThan=function(a,b){return l.equals(a,b)?!1:0<a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};l.isLessThan=function(a,b){return l.equals(a,b)?!1:0>a[0].multiply(b[1]).compare(b[0].multiply(a[1]))};l.isNegative=function(a){return a[0].isNegative()};l.min=function(a,b,c){l.isLessThan(b,c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};l.max=function(a,b,c){l.isGreaterThan(b,
c)?(a[0]=b[0],a[1]=b[1]):(a[0]=c[0],a[1]=c[1]);return a};l.scalar_multiply=function(a,b,c){a[0]=b[0].multiply(c);a[1]=b[1];return l.normalize(a,a)};l.scalar_divide=function(a,b,c){a[0]=b[0];a[1]=b[1].multiply(c);return l.normalize(a,a)};l.normalize=function(a,b){if(b[0].isZero()||b[1].isZero())return b;if(0===b[0].compare(b[1]))return l.clone(l.ONE);if(b[1].isNegative())a[0]=b[0].negate(),a[1]=b[1].negate();else if(a[0]=b[0],a[1]=b[1],a[1].isZero())return a;var c=e.greatest_common_divisor(a[0].abs(),
a[1]);0<c.compare(BigInteger.ONE)&&(a[0]=a[0].quotient(c),a[1]=a[1].quotient(c));return a};l.opposite=function(a,b){a[0]=b[0].negate();a[1]=b[1];return a};l.negative=l.opposite;l.neg=l.opposite;l.power=function(a,b,c){2===c?(a[0]=b[0].square(),a[1]=b[1].square()):0<c?(a[0]=b[0].pow(c),a[1]=b[1].pow(c)):0>c?(c=Math.abs(c),a[0]=b[1].pow(c),a[1]=b[0].pow(c)):l.copy(a,l.ONE);return a};l.pow=l.power;l.sqrt=function(a,b){return l.nthRoot(a,b,2)};l.nthRoot=function(a,b,c){if(l.equals(b,l.ZERO))return l.copy(a,
l.ZERO);if(l.equals(b,l.ONE))return l.copy(a,l.ONE);if(l.equals(b,l.INFINITY))return l.copy(a,l.INFINITY);if(l.equals(b,l.INFINULL))return l.copy(a,l.INFINULL);var d=l.isNegative(b);d&&(b[0]=b[0].negate());l.copy(a,l.ONE);for(var g=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],e=l.clone(l.ONE),f=v;!l.approximates(b,e)&&f--;)l.isLessThan(b,e)?(g[0]=g[0].add(g[1]),g[2]=g[2].add(g[3])):(g[1]=g[1].add(g[0]),g[3]=g[3].add(g[2])),a[0]=g[0].add(g[1]),a[1]=g[2].add(g[3]),l.pow(e,a,c);d&&(b[0]=
b[0].negate(),1===c%2&&l.neg(a,a));return a};l.dot=function(a,b){return a[0].multiply(b[0]).add(a[1].multiply(b[1]))};l.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};l.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};l.dec=l.toDecimal;l.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};l.round=l.toInteger;l.toBigInteger=function(a){return a[0].quotient(a[1])};l.floor=function(a){return Math.floor(l.toDecimal(a))};
l.ceil=function(a){return Math.ceil(l.toDecimal(a))};l.fromInteger_copy=function(a,b){a[0]=BigInteger(b);a[1]=BigInteger.ONE;return a};l.fromInteger=function(a){return l.fromInteger_copy(l.create(),a)};l.fromIntegerInverse_copy=function(a,b){a[0]=BigInteger.ONE;a[1]=BigInteger(b);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};l.fromIntegerInverse=function(a){return l.fromIntegerInverse_copy(l.create(),a)};l.fromDecimal=function(a){return l.fromDecimal_copy(l.create(),a)};l.fromDecimal_copy=
function(a,b){b=parseFloat(b);if(isNaN(b))return l.copy(a,l.INFINULL);if(Infinity===b)return l.copy(a,l.INFINITY);if(Math.abs(b)<l.EPSILON)return l.copy(a,l.ZERO);if(Math.abs(b-1)<l.EPSILON)return l.copy(a,l.ONE);if(Math.abs(b%1)<l.EPSILON)return l.fromInteger_copy(a,b);if(Math.abs(1/b%1)<l.EPSILON)return l.fromIntegerInverse_copy(a,Math.round(1/b));l.copy(a,l.ONE);var c=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],d=b,g;BigInteger(1);for(var e=l.MAX_LOOPS;e--&&Math.abs(b-l.toDecimal(a))>
l.EPSILON;){g=BigInteger(Math.floor(d));a[0]=g.multiply(c[0]).add(c[2]);a[1]=g.multiply(c[1]).add(c[3]);if(g=d-parseInt(g.toString(),10))d=1/g;else{if(b.toString()===l.toDecimal(a))break;d=(c=(b.toString()+"e+10").match(/(\d+)(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/))?Math.max(c[2]?c[2].length:0):0;l.add(a,l.fromInteger(c[1]),l.fromValues(c[2],Math.pow(10,d)));break}c[2]=c[0];c[3]=c[1];c[0]=a[0];c[1]=a[1]}return a};l.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*
Math.random()<<0));return l.normalize(a,a)};l.sin=function(a,b){if(b[1].isZero())return l.copy(a,l.ZERO);l.scalar_multiply(a,b,2);var c=l.create();l.pow(c,b,2);l.add(c,c,l.ONE);l.divide(a,a,c);return a};l.cos=function(a,b){if(b[1].isZero())return l.neg(a,l.ONE);var c=l.create();l.pow(c,b,2);l.sub(a,l.ONE,c);var d=l.create();l.add(d,l.ONE,c);l.divide(a,a,d);return a};l.tan=function(a,b){l.scalar_multiply(a,b,2);var c=l.create();l.pow(c,b,2);l.scalar_multiply(c,c,2);l.add(a,a,c);l.pow(c,b,4);l.sub(c,
l.ONE,c);l.divide(a,a,c);return a};l.toEgyptian=function(a){a=l.clone(a);l.abs(a,a);var b=l.floor(a);b&&l.sub(a,a,l.fromInteger(b));if(!a[0])return b.toString();b||(b="");var c=1,d;for(l.create();1!==a[0];)c++,d=l.fromValues(1,c),l.isGreaterThan(a,d)&&(b&&(b+=" + "),b+=l.str(d),l.sub(a,a,d));return a?b?b+" + "+l.str(a):l.str(a):b?b:"0"};l.toBabylonian=function(a){var b="",c=l.toDecimal(a);a=parseInt(c);for(var c=c-a,d=0,g=0;0<a;)(d=a%60)&&(b=d+" * 60^"+g+(b?" + ":"")+b),a=(a-d)/60,g++;for(g=-1;0<
c;)c*=60,d=parseInt(c+1E-13),c-=d,-1E-13>c||(d&&(b+=(b?" + ":"")+d+" * 60^"+g),g--);return b?b:"0"};l.traceSternBrocot=function(a){var b="";if(l.equals(a,l.ZERO)||l.equals(a,l.ONE)||l.equals(a,l.INFINITY)||l.equals(a,l.INFINULL))return b;a=l.clone(a);l.isNegative(a)&&(a[0]=a[0].negate());for(var c=l.clone(l.ONE),d=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],g=0,e=0,f=65536;!l.equals(a,c)&&f--;)l.isLessThan(a,c)?(d[0]=d[0].add(d[1]),d[2]=d[2].add(d[3]),e++,g&&(b+="R",1!==g&&(b+=g),g=
0,b+=" ")):(d[1]=d[1].add(d[0]),d[3]=d[3].add(d[2]),g++,e&&(b+="L",1!==e&&(b+=e),e=0,b+=" ")),c[0]=d[0].add(d[1]),c[1]=d[2].add(d[3]);e?(b+="L",1!==e&&(b+=e)):g&&(b+="R",1!==g&&(b+=g));0>f&&(b+="...");return b};l.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(l.equals(a,l.ZERO))return[0];if(l.equals(a,l.ONE))return[1];if(l.equals(a,l.NEGONE))return[-1];if(l.equals(a,l.INFINITY))return[1,0];if(l.equals(a,l.INFINULL))return[0,0];var c=l.clone(a),d=l.isNegative(c);d&&
(c[0]=c[0].negate());for(var g=l.clone(l.ONE),e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=1,h=[0],m=h.length-1;!l.equals(c,g)&&b--;)l.isLessThan(c,g)?(-1===f?h[m]++:(f=-1,h.push(1),m++),e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(1===f?h[m]++:(f=1,h.push(1),m++),e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),g[0]=e[0].add(e[1]),g[1]=e[2].add(e[3]);0>b?h.push(0):h[m]++;if(d)for(var n in h)h[n]=-h[n];return h};l.fromContinuedFraction=function(a,b){l.fromInteger_copy(a,b[b.length-1]);for(var c=
b.length-2;-1<c;c--)l.invert(a,a),l.add(a,l.fromInteger(b[c]),a);return a};l.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return l.fromInteger_copy(a,factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(l.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)l.scalar_multiply(a,a,++c);return a};l.dump=function(a){return"bigrat\t"+l.str(a)+"\n~\t"+l.toDecimal(a)+"\nCF:\t["+l.toContinuedFraction(a)+"]\n"};l.ZERO=l.fromInteger(0);l.ONE=l.fromInteger(1);l.NEGONE=l.fromInteger(-1);
l.INFINITY=l.fromValues(1,0);l.INFINULL=l.fromValues(0,0);l.INFINITESIMAL=l.clone([new BigInteger(1),m]);l.PI=l.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587","1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");
"undefined"!==typeof b&&(b.bigrat=l);var k=function(a,b){this.a=g.fromValues(parseInt(a),parseInt(b))};k.prototype.toString=function(){return g.str(this.a)};k.prototype.toContinuedFraction=function(a){return g.toContinuedFraction(this.a,a)};k.prototype.invert=function(){return g.invert(this.a)};k.prototype.reciprocal=k.prototype.invert;k.prototype.add=function(a){var b=g.create();g.add(b,this.a,a.a);return new k(b[0],b[1])};k.prototype.plus=k.prototype.add;k.prototype.subtract=function(a){var b=g.create();
g.sub(b,this.a,a.a);return new k(b[0],b[1])};k.prototype.sub=k.prototype.subtract;k.prototype.minus=k.prototype.subtract;k.prototype.multiply=function(a){var b=g.create();g.mul(b,this.a,a.a);return new k(b[0],b[1])};k.prototype.mul=k.prototype.multiply;k.prototype.times=k.prototype.multiply;k.prototype.mediant=function(a){var b=g.create();g.mediant(b,this.a,a.a);return new k(b[0],b[1])};k.prototype.divide=function(a){var b=g.create();g.div(b,this.a,a.a);return new k(b[0],b[1])};k.prototype.div=k.prototype.divide;
k.prototype.divided_by=k.prototype.divide;k.prototype.power=function(a){var b=g.create();g.pow(b,this.a,a);return new k(b[0],b[1])};k.prototype.pow=k.prototype.power;k.prototype.dump=function(){return g.dump(this.a)};k.prototype.toRat=function(){return g.clone(this.a)};k.prototype.toDecimal=function(){return g.toDecimal(this.a)};k.fromRat=function(a){var b=new k;b.a[0]=a[0];b.a[1]=a[1];return b};k.fromInteger=function(a){return k.fromRat(g.fromInteger(a))};k.fromIntegerInverse=function(a){return k.fromRat(g.fromIntegerInverse(a))};
k.fromDecimal=function(a){return k.fromRat(g.fromDecimal(a))};k.fromContinuedFraction=function(a){return k.fromRat(g.fromContinuedFraction(g.create(),a))};"undefined"!==typeof b&&(b.rational=k);var q={GREEK:"\u03b1\u03b2\u03b3\u03b4\u03bc\u03c0\u03c1\u03c2\u03c4\u03c6\u03c7\u03c8\u03c9\u0398\u03a6\u03a9".split(""),iterator:function(){this.i=0;this.next=function(){return this.i<q.GREEK.length?q.GREEK[this.i++]:"?"}}};"undefined"!==typeof b&&(b.alpha=q);d={};d.FINE_STRUCTURE=l.fromValues(30223,4141639);
d.a=d.FINE_STRUCTURE;d.FINE_STRUCTURE_ALT=l.fromValues(13355891,1830237867);d.PLANK=l.fromValues(662606957,1E42);d.h=d.PLANK;d.hBAR=l.fromValues(1054571726,1E43);d.GRAVITATIONAL=l.fromValues(667384,1E16);d.G=d.GRAVITATIONAL;d.SPEED_OF_LIGHT=l.fromInteger(299792458);d.c=d.SPEED_OF_LIGHT;"undefined"!==typeof b&&(b.physics=d);var t={create:function(){return[[],[]]},fromValues:function(a){var b=t.create();b[0]=a.slice();a=t.countDimensions(b);for(b[1]=Array(a);a--;)b[1][a]=0;return t.normalize(b,b)},
mergeDimension:function(a,b,c){a[0]=[b.slice()];a[1].push(0);for(var d in c)a[0].push(c[d]);return a},evaluate:function(a,b,c){l.copy(a,l.ZERO);var d=t.countDimensions(b);if(0===d)return"0";if(1===d)for(var g in b[0]){if(b[0][g]){var d=l.fromInteger(b[0][g]),e=l.pow(l.create(),l.fromInteger(c[0]),b[1][0]+ +g);l.mul(d,d,e);l.add(a,a,d)}}else if(2===d)for(var f in b[0])for(g in b[0][f]){if(b[0][f][g]){var d=l.fromInteger(b[0][f][g]),e=l.pow(l.create(),l.fromInteger(c[0]),b[1][1]+ +g),h=l.pow(l.create(),
l.fromInteger(c[1]),b[1][0]+ +f);l.mul(d,d,e);l.mul(d,d,h);l.add(a,a,d)}}else if(3===d)for(var m in b[0])for(f in b[0][m])for(g in b[0][m][f]){if(b[0][m][f][g]){var d=l.fromInteger(b[0][m][f][g]),e=l.pow(l.create(),l.fromInteger(c[0]),b[1][2]+ +g),h=l.pow(l.create(),l.fromInteger(c[1]),b[1][1]+ +f),n=l.pow(l.create(),l.fromInteger(c[1]),b[1][0]+ +m);l.mul(d,d,e);l.mul(d,d,h);l.mul(d,d,n);l.add(a,a,d)}}else alert("unsupported dimension "+d);return a},derivatives:function(a){return[]},forEachNonZeroElement:function(a,
b){for(var c=a.slice(),d=0;"object"===typeof c[0];)c=c[0].slice(),d++;for(var g=d+1;0<g;--g){print(Array(g).join("[0]"));var c=eval("(a"+Array(g).join("[0]")+")"),e;for(e in c)for(var f=d+2;0<f;--f)print(c[e])}return""},str:function(a){var b="",c=new q.iterator,d=c.next(),g=c.next(),c=c.next(),e=t.countDimensions(a);if(0===e)b+=a.toString();else if(1===e)for(var f in a[0]){if(a[0][f]){b?b+=" "+(0>a[0][f]?"-":"+")+" ":0>a[0][f]&&(b+="-");var e=Math.abs(a[0][f]),h=a[1][0]+ +f;if(1!==e||0===h)b+=e;0!==
h&&(b+=d+(1===h?"":"<sup>"+h+"</sup>"))}}else if(2===e)for(var m in a[0])for(f in a[0][m]){if(a[0][m][f]){b?b+=" "+(0>a[0][m][f]?"-":"+")+" ":0>a[0][m][f]&&(b+="-");var e=Math.abs(a[0][m][f]),h=a[1][1]+ +f,n=a[1][0]+ +m;if(1!==e||0===n&&0===h)b+=e;0!==h&&(b+=d+(1===h?"":"<sup>"+h+"</sup>"));0!==n&&(b+=g+(1===n?"":"<sup>"+n+"</sup>"))}}else if(3===e)for(var l in a[0])for(m in a[0][l])for(f in a[0][l][m]){if(a[0][l][m][f]){b?b+=" "+(0>a[0][l][m][f]?"-":"+")+" ":0>a[0][l][m][f]&&(b+="-");var e=Math.abs(a[0][l][m][f]),
h=a[1][2]+ +f,n=a[1][1]+ +m,k=a[1][0]+ +l;if(1!==e||0===k&&0===n&&0===h)b+=e;0!==h&&(b+=d+(1===h?"":"<sup>"+h+"</sup>"));0!==n&&(b+=g+(1===n?"":"<sup>"+n+"</sup>"));0!==k&&(b+=c+(1===k?"":"<sup>"+k+"</sup>"))}}else alert("unsupported dimension "+e);""===b&&(b="0");return b},getJSFormula:function(a){var b="",c=t.countDimensions(a);if(0===c)return"0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d],c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")")));else if(2===c)for(var g in a[0])for(d in a[0][g]){if(a[0][g][d]){b&&
(b+="+");var b=b+a[0][g][d],c=a[1][1]+ +d,e=a[1][0]+ +g;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==e&&(b=1===e?b+"*m[1]":b+("*Math.pow(m[1],"+e+")"))}}else if(3===c)for(var f in a[0])for(g in a[0][f])for(d in a[0][f][g]){if(a[0][f][g][d]){b&&(b+="+");var b=b+a[0][f][g][d],c=a[1][2]+ +d,e=a[1][1]+ +g,h=a[1][0]+ +f;0!==c&&(b=1===c?b+"*m[0]":b+("*Math.pow(m[0],"+c+")"));0!==e&&(b=1===e?b+"*m[1]":b+("*Math.pow(m[1],"+e+")"));0!==h&&(b=1===h?b+"*m[2]":b+("*Math.pow(m[2],"+h+")"))}}else alert("unsupported dimension "+
c);""===b&&(b="0");return b}};String.prototype.repeat=function(a){return Array(a+1).join(this)};t.getGLSLFormula=function(a){var b="",c=t.countDimensions(a);if(0===c)return"0.0";if(1===c)for(var d in a[0])a[0][d]&&(b&&(b+="+"),b+=a[0][d]+".0",c=a[1][0]+ +d,0!==c&&(b=1===c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)")));else if(2===c)for(var g in a[0])for(d in a[0][g]){if(a[0][g][d]){b&&(b+="+");var b=b+(a[0][g][d]+".0"),c=a[1][1]+ +d,e=a[1][0]+ +g;0!==c&&(b=1===
c?b+"*m_0":1<c?b+"*m_0".repeat(c):b+("*pow(1.0"+"*m_0".repeat(Math.abs(c))+",-1.0)"));0!==e&&(b=1===e?b+"*m_1":1<e?b+"*m_1".repeat(e):b+("*pow(1.0"+"*m_1".repeat(Math.abs(e))+",-1.0)"))}}else alert("unsupported dimension "+c);""===b&&(b="0.0");return b};t.toJSON=function(a){return JSON.stringify(a)};t.fromJSON=function(a){return JSON.parse(a)};t.normalize=function(a,b){return b};t.binary_operation=function(a,b,c,d){a=t.create();var g=t.countDimensions(b),e=t.countDimensions(c);b[1][f]!==c[1][f]&&
alert("adding polyrats only works if the offsets are the same (for now)");if(1===g&&1===e){for(var f in b[0])a[0][f]="undefined"===typeof c[0][f]?b[0][f]:d(b[0][f],c[0][f]);for(f in c[0])"undefined"===typeof b[0][f]&&(a[0][f]=c[0][f]);for(f in a[0])"undefined"===typeof b[0][f]&&"undefined"===typeof c[0][f]&&(a[0][f]=null)}else alert("unsupported dimension "+g);for(f=g;f--;)a[1][f]=b[1][f];return a};t.add=function(a,b,c){return t.binary_operation(a,b,c,function(a,b){return a+b})};t.subtract=function(a,
b,c){return t.binary_operation(a,b,c,function(a,b){return a-b})};t.sub=t.subtract;t.multiply=function(a,b,c){return a};t.mul=t.multiply;t.divide=function(a,b,c){return a};t.div=t.divide;t.equals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};t.countDimensions=function(a){return"object"===typeof a[0]?t._countDimensions(a[0],1):0};t._countDimensions=function(a,b){return"object"===typeof a[0]?t._countDimensions(a[0],++b):b};t.ZERO=t.fromValues([0]);t.IDENTITY=t.fromValues([1]);t.ONE=t.IDENTITY;"undefined"!==
typeof b&&(b.polyrat=t)})(k)})(this);/*
   Copyright 2008-2016 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
 DataTables 1.10.13
 ?2008-2016 SpryMedia Ltd - datatables.net/license
*/
(function(b){"function"===typeof define&&define.amd?define(["jquery"],function(k){return b(k,window,document)}):"object"===typeof exports?module.exports=function(k,f){k||(k=window);f||(f="undefined"!==typeof window?require("jquery"):require("jquery")(k));return b(f,k,k.document)}:b(jQuery,window,document)})(function(b,k,f,h){function e(a){var c,d,g={};b.each(a,function(b,x){(c=b.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(c[1]+" ")&&(d=b.replace(c[0],c[2].toLowerCase()),
g[d]=b,"o"===c[1]&&e(a[b]))});a._hungarianMap=g}function a(c,d,g){c._hungarianMap||e(c);var x;b.each(d,function(e,f){x=c._hungarianMap[e];x===h||!g&&d[x]!==h||("o"===x.charAt(0)?(d[x]||(d[x]={}),b.extend(!0,d[x],d[e]),a(c[x],d[x],g)):d[x]=d[e])})}function d(a){var b=F.defaults.oLanguage,c=a.sZeroRecords;!a.sEmptyTable&&c&&"No data available in table"===b.sEmptyTable&&pa(a,a,"sZeroRecords","sEmptyTable");!a.sLoadingRecords&&c&&"Loading..."===b.sLoadingRecords&&pa(a,a,"sZeroRecords","sLoadingRecords");
a.sInfoThousands&&(a.sThousands=a.sInfoThousands);(a=a.sDecimal)&&ib(a)}function c(b){la(b,"ordering","bSort");la(b,"orderMulti","bSortMulti");la(b,"orderClasses","bSortClasses");la(b,"orderCellsTop","bSortCellsTop");la(b,"order","aaSorting");la(b,"orderFixed","aaSortingFixed");la(b,"paging","bPaginate");la(b,"pagingType","sPaginationType");la(b,"pageLength","iDisplayLength");la(b,"searching","bFilter");"boolean"===typeof b.sScrollX&&(b.sScrollX=b.sScrollX?"100%":"");"boolean"===typeof b.scrollX&&
(b.scrollX=b.scrollX?"100%":"");if(b=b.aoSearchCols)for(var c=0,d=b.length;c<d;c++)b[c]&&a(F.models.oSearch,b[c])}function g(a){la(a,"orderable","bSortable");la(a,"orderData","aDataSort");la(a,"orderSequence","asSorting");la(a,"orderDataType","sortDataType");var c=a.aDataSort;c&&!b.isArray(c)&&(a.aDataSort=[c])}function m(a){if(!F.__browser){var c={};F.__browser=c;var d=b("<div/>").css({position:"fixed",top:0,left:-1*b(k).scrollLeft(),height:1,width:1,overflow:"hidden"}).append(b("<div/>").css({position:"absolute",
top:1,left:1,width:100,overflow:"scroll"}).append(b("<div/>").css({width:"100%",height:10}))).appendTo("body"),g=d.children(),e=g.children();c.barWidth=g[0].offsetWidth-g[0].clientWidth;c.bScrollOversize=100===e[0].offsetWidth&&100!==g[0].clientWidth;c.bScrollbarLeft=1!==Math.round(e.offset().left);c.bBounding=d[0].getBoundingClientRect().width?!0:!1;d.remove()}b.extend(a.oBrowser,F.__browser);a.oScroll.iBarWidth=F.__browser.barWidth}function v(a,b,c,d,g,e){var f,x=!1;c!==h&&(f=c,x=!0);for(;d!==g;)a.hasOwnProperty(d)&&
(f=x?b(f,a[d],d,a):a[d],x=!0,d+=e);return f}function l(a,c){var d=F.defaults.column,g=a.aoColumns.length,d=b.extend({},F.models.oColumn,d,{nTh:c?c:f.createElement("th"),sTitle:d.sTitle?d.sTitle:c?c.innerHTML:"",aDataSort:d.aDataSort?d.aDataSort:[g],mData:d.mData?d.mData:g,idx:g});a.aoColumns.push(d);d=a.aoPreSearchCols;d[g]=b.extend({},F.models.oSearch,d[g]);u(a,g,b(c).data())}function u(c,d,e){d=c.aoColumns[d];var f=c.oClasses,x=b(d.nTh);if(!d.sWidthOrig){d.sWidthOrig=x.attr("width")||null;var p=
(x.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);p&&(d.sWidthOrig=p[1])}e!==h&&null!==e&&(g(e),a(F.defaults.column,e),e.mDataProp===h||e.mData||(e.mData=e.mDataProp),e.sType&&(d._sManualType=e.sType),e.className&&!e.sClass&&(e.sClass=e.className),b.extend(d,e),pa(d,e,"sWidth","sWidthOrig"),e.iDataSort!==h&&(d.aDataSort=[e.iDataSort]),pa(d,e,"aDataSort"));var m=d.mData,l=Q(m),n=d.mRender?Q(d.mRender):null;e=function(a){return"string"===typeof a&&-1!==a.indexOf("@")};d._bAttrSrc=b.isPlainObject(m)&&
(e(m.sort)||e(m.type)||e(m.filter));d._setter=null;d.fnGetData=function(a,b,c){var d=l(a,b,h,c);return n&&b?n(d,b,a,c):d};d.fnSetData=function(a,b,c){return H(m)(a,b,c)};"number"!==typeof m&&(c._rowReadObject=!0);c.oFeatures.bSort||(d.bSortable=!1,x.addClass(f.sSortableNone));c=-1!==b.inArray("asc",d.asSorting);e=-1!==b.inArray("desc",d.asSorting);d.bSortable&&(c||e)?c&&!e?(d.sSortingClass=f.sSortableAsc,d.sSortingClassJUI=f.sSortJUIAscAllowed):!c&&e?(d.sSortingClass=f.sSortableDesc,d.sSortingClassJUI=
f.sSortJUIDescAllowed):(d.sSortingClass=f.sSortable,d.sSortingClassJUI=f.sSortJUI):(d.sSortingClass=f.sSortableNone,d.sSortingClassJUI="")}function q(a){if(!1!==a.oFeatures.bAutoWidth){var b=a.aoColumns;Oa(a);for(var c=0,d=b.length;c<d;c++)b[c].nTh.style.width=b[c].sWidth}b=a.oScroll;""===b.sY&&""===b.sX||Da(a);X(a,null,"column-sizing",[a])}function t(a,b){var c=z(a,"bVisible");return"number"===typeof c[b]?c[b]:null}function n(a,c){var d=z(a,"bVisible"),d=b.inArray(c,d);return-1!==d?d:null}function r(a){var c=
0;b.each(a.aoColumns,function(a,d){d.bVisible&&"none"!==b(d.nTh).css("display")&&c++});return c}function z(a,c){var d=[];b.map(a.aoColumns,function(a,b){a[c]&&d.push(b)});return d}function C(a){var b=a.aoColumns,c=a.aoData,d=F.ext.type.detect,g,e,f,x,p,m,l,n,q;g=0;for(e=b.length;g<e;g++)if(l=b[g],q=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){f=0;for(x=d.length;f<x;f++){p=0;for(m=c.length;p<m;p++){q[p]===h&&(q[p]=O(a,p,g,"type"));n=d[f](q[p],a);if(!n&&f!==d.length-1)break;
if("html"===n)break}if(n){l.sType=n;break}}l.sType||(l.sType="string")}}function A(a,c,d,g){var e,f,x,p,m,n,q=a.aoColumns;if(c)for(e=c.length-1;0<=e;e--){n=c[e];var w=n.targets!==h?n.targets:n.aTargets;b.isArray(w)||(w=[w]);f=0;for(x=w.length;f<x;f++)if("number"===typeof w[f]&&0<=w[f]){for(;q.length<=w[f];)l(a);g(w[f],n)}else if("number"===typeof w[f]&&0>w[f])g(q.length+w[f],n);else if("string"===typeof w[f])for(p=0,m=q.length;p<m;p++)("_all"==w[f]||b(q[p].nTh).hasClass(w[f]))&&g(p,n)}if(d)for(e=
0,a=d.length;e<a;e++)g(e,d[e])}function y(a,c,d,g){var e=a.aoData.length,f=b.extend(!0,{},F.models.oRow,{src:d?"dom":"data",idx:e});f._aData=c;a.aoData.push(f);for(var x=a.aoColumns,p=0,m=x.length;p<m;p++)x[p].sType=null;a.aiDisplayMaster.push(e);c=a.rowIdFn(c);c!==h&&(a.aIds[c]=f);!d&&a.oFeatures.bDeferRender||U(a,e,d,g);return e}function J(a,c){var d;c instanceof b||(c=b(c));return c.map(function(b,c){d=P(a,c);return y(a,d.data,c,d.cells)})}function O(a,b,c,d){var g=a.iDraw,e=a.aoColumns[c],f=a.aoData[b]._aData,
x=e.sDefaultContent,p=e.fnGetData(f,d,{settings:a,row:b,col:c});if(p===h)return a.iDrawError!=g&&null===x&&(ra(a,0,"Requested unknown parameter "+("function"==typeof e.mData?"{function}":"'"+e.mData+"'")+" for row "+b+", column "+c,4),a.iDrawError=g),x;if((p===f||null===p)&&null!==x&&d!==h)p=x;else if("function"===typeof p)return p.call(f);return null===p&&"display"==d?"":p}function G(a,b,c,d){a.aoColumns[c].fnSetData(a.aoData[b]._aData,d,{settings:a,row:b,col:c})}function R(a){return b.map(a.match(/(\\.|[^\.])+/g)||
[""],function(a){return a.replace(/\\\./g,".")})}function Q(a){if(b.isPlainObject(a)){var c={};b.each(a,function(a,b){b&&(c[a]=Q(b))});return function(a,b,d,g){var e=c[b]||c._;return e!==h?e(a,b,d,g):a}}if(null===a)return function(a){return a};if("function"===typeof a)return function(b,c,d,g){return a(b,c,d,g)};if("string"!==typeof a||-1===a.indexOf(".")&&-1===a.indexOf("[")&&-1===a.indexOf("("))return function(b,c){return b[a]};var d=function(a,c,g){var e,f;if(""!==g){f=R(g);for(var x=0,p=f.length;x<
p;x++){g=f[x].match(wa);e=f[x].match(ta);if(g){f[x]=f[x].replace(wa,"");""!==f[x]&&(a=a[f[x]]);e=[];f.splice(0,x+1);f=f.join(".");if(b.isArray(a))for(x=0,p=a.length;x<p;x++)e.push(d(a[x],c,f));a=g[0].substring(1,g[0].length-1);a=""===a?e:e.join(a);break}else if(e){f[x]=f[x].replace(ta,"");a=a[f[x]]();continue}if(null===a||a[f[x]]===h)return h;a=a[f[x]]}}return a};return function(b,c){return d(b,c,a)}}function H(a){if(b.isPlainObject(a))return H(a._);if(null===a)return function(){};if("function"===
typeof a)return function(b,c,d){a(b,"set",c,d)};if("string"!==typeof a||-1===a.indexOf(".")&&-1===a.indexOf("[")&&-1===a.indexOf("("))return function(b,c){b[a]=c};var c=function(a,d,g){g=R(g);var e;e=g[g.length-1];for(var f,x,p=0,m=g.length-1;p<m;p++){f=g[p].match(wa);x=g[p].match(ta);if(f){g[p]=g[p].replace(wa,"");a[g[p]]=[];e=g.slice();e.splice(0,p+1);f=e.join(".");if(b.isArray(d))for(x=0,m=d.length;x<m;x++)e={},c(e,d[x],f),a[g[p]].push(e);else a[g[p]]=d;return}x&&(g[p]=g[p].replace(ta,""),a=a[g[p]](d));
if(null===a[g[p]]||a[g[p]]===h)a[g[p]]={};a=a[g[p]]}if(e.match(ta))a[e.replace(ta,"")](d);else a[e.replace(wa,"")]=d};return function(b,d){return c(b,d,a)}}function D(a){return na(a.aoData,"_aData")}function L(a){a.aoData.length=0;a.aiDisplayMaster.length=0;a.aiDisplay.length=0;a.aIds={}}function S(a,b,c){for(var d=-1,g=0,e=a.length;g<e;g++)a[g]==b?d=g:a[g]>b&&a[g]--; -1!=d&&c===h&&a.splice(d,1)}function I(a,b,c,d){var g=a.aoData[b],e,f=function(c,d){for(;c.childNodes.length;)c.removeChild(c.firstChild);
c.innerHTML=O(a,b,d,"display")};if("dom"!==c&&(c&&"auto"!==c||"dom"!==g.src)){var x=g.anCells;if(x)if(d!==h)f(x[d],d);else for(c=0,e=x.length;c<e;c++)f(x[c],c)}else g._aData=P(a,g,d,d===h?h:g._aData).data;g._aSortData=null;g._aFilterData=null;f=a.aoColumns;if(d!==h)f[d].sType=null;else{c=0;for(e=f.length;c<e;c++)f[c].sType=null;W(a,g)}}function P(a,c,d,g){var e=[],f=c.firstChild,x,p,m=0,l,n=a.aoColumns,q=a._rowReadObject;g=g!==h?g:q?{}:[];var w=function(a,b){if("string"===typeof a){var c=a.indexOf("@");
-1!==c&&(c=a.substring(c+1),H(a)(g,b.getAttribute(c)))}},k=function(a){if(d===h||d===m)p=n[m],l=b.trim(a.innerHTML),p&&p._bAttrSrc?(H(p.mData._)(g,l),w(p.mData.sort,a),w(p.mData.type,a),w(p.mData.filter,a)):q?(p._setter||(p._setter=H(p.mData)),p._setter(g,l)):g[m]=l;m++};if(f)for(;f;){x=f.nodeName.toUpperCase();if("TD"==x||"TH"==x)k(f),e.push(f);f=f.nextSibling}else for(e=c.anCells,f=0,x=e.length;f<x;f++)k(e[f]);(c=c.firstChild?c:c.nTr)&&(c=c.getAttribute("id"))&&H(a.rowId)(g,c);return{data:g,cells:e}}
function U(a,c,d,g){var e=a.aoData[c],p=e._aData,x=[],h,m,l,n,q;if(null===e.nTr){h=d||f.createElement("tr");e.nTr=h;e.anCells=x;h._DT_RowIndex=c;W(a,e);n=0;for(q=a.aoColumns.length;n<q;n++)l=a.aoColumns[n],m=d?g[n]:f.createElement(l.sCellType),m._DT_CellIndex={row:c,column:n},x.push(m),d&&!l.mRender&&l.mData===n||b.isPlainObject(l.mData)&&l.mData._===n+".display"||(m.innerHTML=O(a,c,n,"display")),l.sClass&&(m.className+=" "+l.sClass),l.bVisible&&!d?h.appendChild(m):!l.bVisible&&d&&m.parentNode.removeChild(m),
l.fnCreatedCell&&l.fnCreatedCell.call(a.oInstance,m,O(a,c,n),p,c,n);X(a,"aoRowCreatedCallback",null,[h,p,c])}e.nTr.setAttribute("role","row")}function W(a,c){var d=c.nTr,g=c._aData;if(d){var e=a.rowIdFn(g);e&&(d.id=e);g.DT_RowClass&&(e=g.DT_RowClass.split(" "),c.__rowc=c.__rowc?Ea(c.__rowc.concat(e)):e,b(d).removeClass(c.__rowc.join(" ")).addClass(g.DT_RowClass));g.DT_RowAttr&&b(d).attr(g.DT_RowAttr);g.DT_RowData&&b(d).data(g.DT_RowData)}}function V(a){var c,d,g,e,f,p=a.nTHead,h=a.nTFoot,x=0===b("th, td",
p).length,m=a.oClasses,l=a.aoColumns;x&&(e=b("<tr/>").appendTo(p));c=0;for(d=l.length;c<d;c++)f=l[c],g=b(f.nTh).addClass(f.sClass),x&&g.appendTo(e),a.oFeatures.bSort&&(g.addClass(f.sSortingClass),!1!==f.bSortable&&(g.attr("tabindex",a.iTabIndex).attr("aria-controls",a.sTableId),Pa(a,f.nTh,c))),f.sTitle!=g[0].innerHTML&&g.html(f.sTitle),Qa(a,"header")(a,g,f,m);x&&ha(a.aoHeader,p);b(p).find(">tr").attr("role","row");b(p).find(">tr>th, >tr>td").addClass(m.sHeaderTH);b(h).find(">tr>th, >tr>td").addClass(m.sFooterTH);
if(null!==h)for(a=a.aoFooter[0],c=0,d=a.length;c<d;c++)f=l[c],f.nTf=a[c].cell,f.sClass&&b(f.nTf).addClass(f.sClass)}function M(a,c,d){var g,e,f,p=[],x=[],m=a.aoColumns.length,l;if(c){d===h&&(d=!1);g=0;for(e=c.length;g<e;g++){p[g]=c[g].slice();p[g].nTr=c[g].nTr;for(f=m-1;0<=f;f--)a.aoColumns[f].bVisible||d||p[g].splice(f,1);x.push([])}g=0;for(e=p.length;g<e;g++){if(a=p[g].nTr)for(;f=a.firstChild;)a.removeChild(f);f=0;for(c=p[g].length;f<c;f++)if(l=m=1,x[g][f]===h){a.appendChild(p[g][f].cell);for(x[g][f]=
1;p[g+m]!==h&&p[g][f].cell==p[g+m][f].cell;)x[g+m][f]=1,m++;for(;p[g][f+l]!==h&&p[g][f].cell==p[g][f+l].cell;){for(d=0;d<m;d++)x[g+d][f+l]=1;l++}b(p[g][f].cell).attr("rowspan",m).attr("colspan",l)}}}}function ca(a){var c=X(a,"aoPreDrawCallback","preDraw",[a]);if(-1!==b.inArray(!1,c))oa(a,!1);else{var c=[],d=0,g=a.asStripeClasses,e=g.length,f=a.oLanguage,p=a.iInitDisplayStart,x="ssp"==ia(a),m=a.aiDisplay;a.bDrawing=!0;p!==h&&-1!==p&&(a._iDisplayStart=x?p:p>=a.fnRecordsDisplay()?0:p,a.iInitDisplayStart=
-1);var p=a._iDisplayStart,l=a.fnDisplayEnd();if(a.bDeferLoading)a.bDeferLoading=!1,a.iDraw++,oa(a,!1);else if(!x)a.iDraw++;else if(!a.bDestroying&&!E(a))return;if(0!==m.length)for(f=x?a.aoData.length:l,x=x?0:p;x<f;x++){var n=m[x],q=a.aoData[n];null===q.nTr&&U(a,n);n=q.nTr;if(0!==e){var w=g[d%e];q._sRowStripe!=w&&(b(n).removeClass(q._sRowStripe).addClass(w),q._sRowStripe=w)}X(a,"aoRowCallback",null,[n,q._aData,d,x]);c.push(n);d++}else d=f.sZeroRecords,1==a.iDraw&&"ajax"==ia(a)?d=f.sLoadingRecords:
f.sEmptyTable&&0===a.fnRecordsTotal()&&(d=f.sEmptyTable),c[0]=b("<tr/>",{"class":e?g[0]:""}).append(b("<td />",{valign:"top",colSpan:r(a),"class":a.oClasses.sRowEmpty}).html(d))[0];X(a,"aoHeaderCallback","header",[b(a.nTHead).children("tr")[0],D(a),p,l,m]);X(a,"aoFooterCallback","footer",[b(a.nTFoot).children("tr")[0],D(a),p,l,m]);g=b(a.nTBody);g.children().detach();g.append(b(c));X(a,"aoDrawCallback","draw",[a]);a.bSorted=!1;a.bFiltered=!1;a.bDrawing=!1}}function ea(a,b){var c=a.oFeatures,d=c.bFilter;
c.bSort&&jb(a);d?ma(a,a.oPreviousSearch):a.aiDisplay=a.aiDisplayMaster.slice();!0!==b&&(a._iDisplayStart=0);a._drawHold=b;ca(a);a._drawHold=!1}function aa(a){var c=a.oClasses,d=b(a.nTable),d=b("<div/>").insertBefore(d),g=a.oFeatures,e=b("<div/>",{id:a.sTableId+"_wrapper","class":c.sWrapper+(a.nTFoot?"":" "+c.sNoFooter)});a.nHolding=d[0];a.nTableWrapper=e[0];a.nTableReinsertBefore=a.nTable.nextSibling;for(var f=a.sDom.split(""),p,h,m,x,l,n,q=0;q<f.length;q++){p=null;h=f[q];if("<"==h){m=b("<div/>")[0];
x=f[q+1];if("'"==x||'"'==x){l="";for(n=2;f[q+n]!=x;)l+=f[q+n],n++;"H"==l?l=c.sJUIHeader:"F"==l&&(l=c.sJUIFooter);-1!=l.indexOf(".")?(x=l.split("."),m.id=x[0].substr(1,x[0].length-1),m.className=x[1]):"#"==l.charAt(0)?m.id=l.substr(1,l.length-1):m.className=l;q+=n}e.append(m);e=b(m)}else if(">"==h)e=e.parent();else if("l"==h&&g.bPaginate&&g.bLengthChange)p=kb(a);else if("f"==h&&g.bFilter)p=ja(a);else if("r"==h&&g.bProcessing)p=lb(a);else if("t"==h)p=mb(a);else if("i"==h&&g.bInfo)p=nb(a);else if("p"==
h&&g.bPaginate)p=ob(a);else if(0!==F.ext.feature.length)for(m=F.ext.feature,n=0,x=m.length;n<x;n++)if(h==m[n].cFeature){p=m[n].fnInit(a);break}p&&(m=a.aanFeatures,m[h]||(m[h]=[]),m[h].push(p),e.append(p))}d.replaceWith(e);a.nHolding=null}function ha(a,c){var d=b(c).children("tr"),g,e,f,p,h,m,x,l,n,q;a.splice(0,a.length);f=0;for(m=d.length;f<m;f++)a.push([]);f=0;for(m=d.length;f<m;f++)for(g=d[f],e=g.firstChild;e;){if("TD"==e.nodeName.toUpperCase()||"TH"==e.nodeName.toUpperCase()){l=1*e.getAttribute("colspan");
n=1*e.getAttribute("rowspan");l=l&&0!==l&&1!==l?l:1;n=n&&0!==n&&1!==n?n:1;p=0;for(h=a[f];h[p];)p++;x=p;q=1===l?!0:!1;for(h=0;h<l;h++)for(p=0;p<n;p++)a[f+p][x+h]={cell:e,unique:q},a[f+p].nTr=g}e=e.nextSibling}}function p(a,b,c){var d=[];c||(c=a.aoHeader,b&&(c=[],ha(c,b)));b=0;for(var g=c.length;b<g;b++)for(var e=0,f=c[b].length;e<f;e++)!c[b][e].unique||d[e]&&a.bSortCellsTop||(d[e]=c[b][e].cell);return d}function w(a,c,d){X(a,"aoServerParams","serverParams",[c]);if(c&&b.isArray(c)){var g={},e=/(.*?)\[\]$/;
b.each(c,function(a,b){var c=b.name.match(e);c?(c=c[0],g[c]||(g[c]=[]),g[c].push(b.value)):g[b.name]=b.value});c=g}var f,p=a.ajax,h=a.oInstance,m=function(b){X(a,null,"xhr",[a,b,a.jqXHR]);d(b)};if(b.isPlainObject(p)&&p.data){f=p.data;var x=b.isFunction(f)?f(c,a):f;c=b.isFunction(f)&&x?x:b.extend(!0,c,x);delete p.data}x={data:c,success:function(b){var c=b.error||b.sError;c&&ra(a,0,c);a.json=b;m(b)},dataType:"json",cache:!1,type:a.sServerMethod,error:function(c,d,g){g=X(a,null,"xhr",[a,null,a.jqXHR]);
-1===b.inArray(!0,g)&&("parsererror"==d?ra(a,0,"Invalid JSON response",1):4===c.readyState&&ra(a,0,"Ajax error",7));oa(a,!1)}};a.oAjaxData=c;X(a,null,"preXhr",[a,c]);a.fnServerData?a.fnServerData.call(h,a.sAjaxSource,b.map(c,function(a,b){return{name:b,value:a}}),m,a):a.sAjaxSource||"string"===typeof p?a.jqXHR=b.ajax(b.extend(x,{url:p||a.sAjaxSource})):b.isFunction(p)?a.jqXHR=p.call(h,c,m,a):(a.jqXHR=b.ajax(b.extend(x,p)),p.data=f)}function E(a){return a.bAjaxDataGet?(a.iDraw++,oa(a,!0),w(a,K(a),
function(b){ba(a,b)}),!1):!0}function K(a){var c=a.aoColumns,d=c.length,g=a.oFeatures,e=a.oPreviousSearch,f=a.aoPreSearchCols,p,h=[],m,x,l,n=ua(a);p=a._iDisplayStart;m=!1!==g.bPaginate?a._iDisplayLength:-1;var q=function(a,b){h.push({name:a,value:b})};q("sEcho",a.iDraw);q("iColumns",d);q("sColumns",na(c,"sName").join(","));q("iDisplayStart",p);q("iDisplayLength",m);var w={draw:a.iDraw,columns:[],order:[],start:p,length:m,search:{value:e.sSearch,regex:e.bRegex}};for(p=0;p<d;p++)x=c[p],l=f[p],m="function"==
typeof x.mData?"function":x.mData,w.columns.push({data:m,name:x.sName,searchable:x.bSearchable,orderable:x.bSortable,search:{value:l.sSearch,regex:l.bRegex}}),q("mDataProp_"+p,m),g.bFilter&&(q("sSearch_"+p,l.sSearch),q("bRegex_"+p,l.bRegex),q("bSearchable_"+p,x.bSearchable)),g.bSort&&q("bSortable_"+p,x.bSortable);g.bFilter&&(q("sSearch",e.sSearch),q("bRegex",e.bRegex));g.bSort&&(b.each(n,function(a,b){w.order.push({column:b.col,dir:b.dir});q("iSortCol_"+a,b.col);q("sSortDir_"+a,b.dir)}),q("iSortingCols",
n.length));c=F.ext.legacy.ajax;return null===c?a.sAjaxSource?h:w:c?h:w}function ba(a,b){var c=function(a,c){return b[a]!==h?b[a]:b[c]},d=B(a,b),g=c("sEcho","draw"),e=c("iTotalRecords","recordsTotal"),c=c("iTotalDisplayRecords","recordsFiltered");if(g){if(1*g<a.iDraw)return;a.iDraw=1*g}L(a);a._iRecordsTotal=parseInt(e,10);a._iRecordsDisplay=parseInt(c,10);g=0;for(e=d.length;g<e;g++)y(a,d[g]);a.aiDisplay=a.aiDisplayMaster.slice();a.bAjaxDataGet=!1;ca(a);a._bInitComplete||Fa(a,b);a.bAjaxDataGet=!0;oa(a,
!1)}function B(a,c){var d=b.isPlainObject(a.ajax)&&a.ajax.dataSrc!==h?a.ajax.dataSrc:a.sAjaxDataProp;return"data"===d?c.aaData||c[d]:""!==d?Q(d)(c):c}function ja(a){var c=a.oClasses,d=a.sTableId,g=a.oLanguage,e=a.oPreviousSearch,p=a.aanFeatures,h='<input type="search" class="'+c.sFilterInput+'"/>',m=g.sSearch,m=m.match(/_INPUT_/)?m.replace("_INPUT_",h):m+h,c=b("<div/>",{id:p.f?null:d+"_filter","class":c.sFilter}).append(b("<label/>").append(m)),p=function(){var b=this.value?this.value:"";b!=e.sSearch&&
(ma(a,{sSearch:b,bRegex:e.bRegex,bSmart:e.bSmart,bCaseInsensitive:e.bCaseInsensitive}),a._iDisplayStart=0,ca(a))},h=null!==a.searchDelay?a.searchDelay:"ssp"===ia(a)?400:0,x=b("input",c).val(e.sSearch).attr("placeholder",g.sSearchPlaceholder).on("keyup.DT search.DT input.DT paste.DT cut.DT",h?Ra(p,h):p).on("keypress.DT",function(a){if(13==a.keyCode)return!1}).attr("aria-controls",d);b(a.nTable).on("search.dt.DT",function(b,c){if(a===c)try{x[0]!==f.activeElement&&x.val(e.sSearch)}catch(Xb){}});return c[0]}
function ma(a,b,c){var d=a.oPreviousSearch,g=a.aoPreSearchCols,e=function(a){d.sSearch=a.sSearch;d.bRegex=a.bRegex;d.bSmart=a.bSmart;d.bCaseInsensitive=a.bCaseInsensitive},f=function(a){return a.bEscapeRegex!==h?!a.bEscapeRegex:a.bRegex};C(a);if("ssp"!=ia(a)){xa(a,b.sSearch,c,f(b),b.bSmart,b.bCaseInsensitive);e(b);for(b=0;b<g.length;b++)Sa(a,g[b].sSearch,b,f(g[b]),g[b].bSmart,g[b].bCaseInsensitive);pb(a)}else e(b);a.bFiltered=!0;X(a,null,"search",[a])}function pb(a){for(var c=F.ext.search,d=a.aiDisplay,
g,e,f=0,p=c.length;f<p;f++){for(var h=[],m=0,x=d.length;m<x;m++)e=d[m],g=a.aoData[e],c[f](a,g._aFilterData,e,g._aData,m)&&h.push(e);d.length=0;b.merge(d,h)}}function Sa(a,b,c,d,g,e){if(""!==b){var f=[],p=a.aiDisplay;d=Ta(b,d,g,e);for(g=0;g<p.length;g++)b=a.aoData[p[g]]._aFilterData[c],d.test(b)&&f.push(p[g]);a.aiDisplay=f}}function xa(a,b,c,d,g,e){d=Ta(b,d,g,e);e=a.oPreviousSearch.sSearch;var f=a.aiDisplayMaster,p;g=[];0!==F.ext.search.length&&(c=!0);p=Ga(a);if(0>=b.length)a.aiDisplay=f.slice();else{if(p||
c||e.length>b.length||0!==b.indexOf(e)||a.bSorted)a.aiDisplay=f.slice();b=a.aiDisplay;for(c=0;c<b.length;c++)d.test(a.aoData[b[c]]._sFilterRow)&&g.push(b[c]);a.aiDisplay=g}}function Ta(a,c,d,g){a=c?a:Ua(a);d&&(a="^(?=.*?"+b.map(a.match(/"[^"]+"|[^ ]+/g)||[""],function(a){if('"'===a.charAt(0)){var b=a.match(/^"(.*)"$/);a=b?b[1]:a}return a.replace('"',"")}).join(")(?=.*?")+").*$");return new RegExp(a,g?"i":"")}function Ga(a){var b=a.aoColumns,c,d,g,e,f,p,h,m,x=F.ext.type.search;c=!1;d=0;for(e=a.aoData.length;d<
e;d++)if(m=a.aoData[d],!m._aFilterData){p=[];g=0;for(f=b.length;g<f;g++)c=b[g],c.bSearchable?(h=O(a,d,g,"filter"),x[c.sType]&&(h=x[c.sType](h)),null===h&&(h=""),"string"!==typeof h&&h.toString&&(h=h.toString())):h="",h.indexOf&&-1!==h.indexOf("&")&&(Ha.innerHTML=h,h=Lb?Ha.textContent:Ha.innerText),h.replace&&(h=h.replace(/[\r\n]/g,"")),p.push(h);m._aFilterData=p;m._sFilterRow=p.join("  ");c=!0}return c}function Va(a){return{search:a.sSearch,smart:a.bSmart,regex:a.bRegex,caseInsensitive:a.bCaseInsensitive}}
function ya(a){return{sSearch:a.search,bSmart:a.smart,bRegex:a.regex,bCaseInsensitive:a.caseInsensitive}}function nb(a){var c=a.sTableId,d=a.aanFeatures.i,g=b("<div/>",{"class":a.oClasses.sInfo,id:d?null:c+"_info"});d||(a.aoDrawCallback.push({fn:qb,sName:"information"}),g.attr("role","status").attr("aria-live","polite"),b(a.nTable).attr("aria-describedby",c+"_info"));return g[0]}function qb(a){var c=a.aanFeatures.i;if(0!==c.length){var d=a.oLanguage,g=a._iDisplayStart+1,e=a.fnDisplayEnd(),f=a.fnRecordsTotal(),
p=a.fnRecordsDisplay(),h=p?d.sInfo:d.sInfoEmpty;p!==f&&(h+=" "+d.sInfoFiltered);h+=d.sInfoPostFix;h=rb(a,h);d=d.fnInfoCallback;null!==d&&(h=d.call(a.oInstance,a,g,e,f,p,h));b(c).html(h)}}function rb(a,b){var c=a.fnFormatNumber,d=a._iDisplayStart+1,g=a._iDisplayLength,e=a.fnRecordsDisplay(),f=-1===g;return b.replace(/_START_/g,c.call(a,d)).replace(/_END_/g,c.call(a,a.fnDisplayEnd())).replace(/_MAX_/g,c.call(a,a.fnRecordsTotal())).replace(/_TOTAL_/g,c.call(a,e)).replace(/_PAGE_/g,c.call(a,f?1:Math.ceil(d/
g))).replace(/_PAGES_/g,c.call(a,f?1:Math.ceil(e/g)))}function za(a){var b,c,d=a.iInitDisplayStart,g=a.aoColumns,e;c=a.oFeatures;var f=a.bDeferLoading;if(a.bInitialised){aa(a);V(a);M(a,a.aoHeader);M(a,a.aoFooter);oa(a,!0);c.bAutoWidth&&Oa(a);b=0;for(c=g.length;b<c;b++)e=g[b],e.sWidth&&(e.nTh.style.width=Z(e.sWidth));X(a,null,"preInit",[a]);ea(a);g=ia(a);if("ssp"!=g||f)"ajax"==g?w(a,[],function(c){var g=B(a,c);for(b=0;b<g.length;b++)y(a,g[b]);a.iInitDisplayStart=d;ea(a);oa(a,!1);Fa(a,c)},a):(oa(a,
!1),Fa(a))}else setTimeout(function(){za(a)},200)}function Fa(a,b){a._bInitComplete=!0;(b||a.oInit.aaData)&&q(a);X(a,null,"plugin-init",[a,b]);X(a,"aoInitComplete","init",[a,b])}function Wa(a,b){var c=parseInt(b,10);a._iDisplayLength=c;Xa(a);X(a,null,"length",[a,c])}function kb(a){for(var c=a.oClasses,d=a.sTableId,g=a.aLengthMenu,e=b.isArray(g[0]),f=e?g[0]:g,g=e?g[1]:g,e=b("<select/>",{name:d+"_length","aria-controls":d,"class":c.sLengthSelect}),p=0,h=f.length;p<h;p++)e[0][p]=new Option(g[p],f[p]);
var m=b("<div><label/></div>").addClass(c.sLength);a.aanFeatures.l||(m[0].id=d+"_length");m.children().append(a.oLanguage.sLengthMenu.replace("_MENU_",e[0].outerHTML));b("select",m).val(a._iDisplayLength).on("change.DT",function(c){Wa(a,b(this).val());ca(a)});b(a.nTable).on("length.dt.DT",function(c,d,g){a===d&&b("select",m).val(g)});return m[0]}function ob(a){var c=a.sPaginationType,d=F.ext.pager[c],g="function"===typeof d,e=function(a){ca(a)},c=b("<div/>").addClass(a.oClasses.sPaging+c)[0],f=a.aanFeatures;
g||d.fnInit(a,c,e);f.p||(c.id=a.sTableId+"_paginate",a.aoDrawCallback.push({fn:function(a){if(g){var b=a._iDisplayStart,c=a._iDisplayLength,p=a.fnRecordsDisplay(),h=-1===c,b=h?0:Math.ceil(b/c),c=h?1:Math.ceil(p/c),p=d(b,c),m,h=0;for(m=f.p.length;h<m;h++)Qa(a,"pageButton")(a,f.p[h],h,p,b,c)}else d.fnUpdate(a,e)},sName:"pagination"}));return c}function Ya(a,b,c){var d=a._iDisplayStart,g=a._iDisplayLength,e=a.fnRecordsDisplay();0===e||-1===g?d=0:"number"===typeof b?(d=b*g,d>e&&(d=0)):"first"==b?d=0:
"previous"==b?(d=0<=g?d-g:0,0>d&&(d=0)):"next"==b?d+g<e&&(d+=g):"last"==b?d=Math.floor((e-1)/g)*g:ra(a,0,"Unknown paging action: "+b,5);b=a._iDisplayStart!==d;a._iDisplayStart=d;b&&(X(a,null,"page",[a]),c&&ca(a));return b}function lb(a){return b("<div/>",{id:a.aanFeatures.r?null:a.sTableId+"_processing","class":a.oClasses.sProcessing}).html(a.oLanguage.sProcessing).insertBefore(a.nTable)[0]}function oa(a,c){a.oFeatures.bProcessing&&b(a.aanFeatures.r).css("display",c?"block":"none");X(a,null,"processing",
[a,c])}function mb(a){var c=b(a.nTable);c.attr("role","grid");var d=a.oScroll;if(""===d.sX&&""===d.sY)return a.nTable;var g=d.sX,e=d.sY,f=a.oClasses,p=c.children("caption"),h=p.length?p[0]._captionSide:null,m=b(c[0].cloneNode(!1)),l=b(c[0].cloneNode(!1)),n=c.children("tfoot");n.length||(n=null);m=b("<div/>",{"class":f.sScrollWrapper}).append(b("<div/>",{"class":f.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:g?g?Z(g):null:"100%"}).append(b("<div/>",{"class":f.sScrollHeadInner}).css({"box-sizing":"content-box",
width:d.sXInner||"100%"}).append(m.removeAttr("id").css("margin-left",0).append("top"===h?p:null).append(c.children("thead"))))).append(b("<div/>",{"class":f.sScrollBody}).css({position:"relative",overflow:"auto",width:g?Z(g):null}).append(c));n&&m.append(b("<div/>",{"class":f.sScrollFoot}).css({overflow:"hidden",border:0,width:g?g?Z(g):null:"100%"}).append(b("<div/>",{"class":f.sScrollFootInner}).append(l.removeAttr("id").css("margin-left",0).append("bottom"===h?p:null).append(c.children("tfoot")))));
var c=m.children(),x=c[0],f=c[1],q=n?c[2]:null;if(g)b(f).on("scroll.DT",function(a){a=this.scrollLeft;x.scrollLeft=a;n&&(q.scrollLeft=a)});b(f).css(e&&d.bCollapse?"max-height":"height",e);a.nScrollHead=x;a.nScrollBody=f;a.nScrollFoot=q;a.aoDrawCallback.push({fn:Da,sName:"scrolling"});return m[0]}function Da(a){var c=a.oScroll,d=c.sX,g=c.sXInner,e=c.sY,c=c.iBarWidth,f=b(a.nScrollHead),m=f[0].style,l=f.children("div"),n=l[0].style,x=l.children("table"),l=a.nScrollBody,w=b(l),k=l.style,v=b(a.nScrollFoot).children("div"),
E=v.children("table"),r=b(a.nTHead),K=b(a.nTable),u=K[0],z=u.style,B=a.nTFoot?b(a.nTFoot):null,y=a.oBrowser,L=y.bScrollOversize,H=na(a.aoColumns,"nTh"),ba,D,A,G,M=[],ja=[],C=[],ma=[],S,J=function(a){a=a.style;a.paddingTop="0";a.paddingBottom="0";a.borderTopWidth="0";a.borderBottomWidth="0";a.height=0};D=l.scrollHeight>l.clientHeight;a.scrollBarVis!==D&&a.scrollBarVis!==h?(a.scrollBarVis=D,q(a)):(a.scrollBarVis=D,K.children("thead, tfoot").remove(),B&&(A=B.clone().prependTo(K),ba=B.find("tr"),A=A.find("tr")),
G=r.clone().prependTo(K),r=r.find("tr"),D=G.find("tr"),G.find("th, td").removeAttr("tabindex"),d||(k.width="100%",f[0].style.width="100%"),b.each(p(a,G),function(b,c){S=t(a,b);c.style.width=a.aoColumns[S].sWidth}),B&&qa(function(a){a.style.width=""},A),f=K.outerWidth(),""===d?(z.width="100%",L&&(K.find("tbody").height()>l.offsetHeight||"scroll"==w.css("overflow-y"))&&(z.width=Z(K.outerWidth()-c)),f=K.outerWidth()):""!==g&&(z.width=Z(g),f=K.outerWidth()),qa(J,D),qa(function(a){C.push(a.innerHTML);
M.push(Z(b(a).css("width")))},D),qa(function(a,c){-1!==b.inArray(a,H)&&(a.style.width=M[c])},r),b(D).height(0),B&&(qa(J,A),qa(function(a){ma.push(a.innerHTML);ja.push(Z(b(a).css("width")))},A),qa(function(a,b){a.style.width=ja[b]},ba),b(A).height(0)),qa(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+C[b]+"</div>";a.style.width=M[b]},D),B&&qa(function(a,b){a.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+ma[b]+"</div>";a.style.width=
ja[b]},A),K.outerWidth()<f?(ba=l.scrollHeight>l.offsetHeight||"scroll"==w.css("overflow-y")?f+c:f,L&&(l.scrollHeight>l.offsetHeight||"scroll"==w.css("overflow-y"))&&(z.width=Z(ba-c)),""!==d&&""===g||ra(a,1,"Possible column misalignment",6)):ba="100%",k.width=Z(ba),m.width=Z(ba),B&&(a.nScrollFoot.style.width=Z(ba)),!e&&L&&(k.height=Z(u.offsetHeight+c)),d=K.outerWidth(),x[0].style.width=Z(d),n.width=Z(d),g=K.height()>l.clientHeight||"scroll"==w.css("overflow-y"),e="padding"+(y.bScrollbarLeft?"Left":
"Right"),n[e]=g?c+"px":"0px",B&&(E[0].style.width=Z(d),v[0].style.width=Z(d),v[0].style[e]=g?c+"px":"0px"),K.children("colgroup").insertBefore(K.children("thead")),w.scroll(),!a.bSorted&&!a.bFiltered||a._drawHold||(l.scrollTop=0))}function qa(a,b,c){for(var d=0,g=0,e=b.length,f,p;g<e;){f=b[g].firstChild;for(p=c?c[g].firstChild:null;f;)1===f.nodeType&&(c?a(f,p,d):a(f,d),d++),f=f.nextSibling,p=c?p.nextSibling:null;g++}}function Oa(a){var c=a.nTable,d=a.aoColumns,g=a.oScroll,e=g.sY,f=g.sX,h=g.sXInner,
m=d.length,l=z(a,"bVisible"),n=b("th",a.nTHead),x=c.getAttribute("width"),w=c.parentNode,v=!1,E,K,u=a.oBrowser,g=u.bScrollOversize;(E=c.style.width)&&-1!==E.indexOf("%")&&(x=E);for(E=0;E<l.length;E++)K=d[l[E]],null!==K.sWidth&&(K.sWidth=sb(K.sWidthOrig,w),v=!0);if(g||!v&&!f&&!e&&m==r(a)&&m==n.length)for(E=0;E<m;E++)l=t(a,E),null!==l&&(d[l].sWidth=Z(n.eq(E).width()));else{m=b(c).clone().css("visibility","hidden").removeAttr("id");m.find("tbody tr").remove();var B=b("<tr/>").appendTo(m.find("tbody"));
m.find("thead, tfoot").remove();m.append(b(a.nTHead).clone()).append(b(a.nTFoot).clone());m.find("tfoot th, tfoot td").css("width","");n=p(a,m.find("thead")[0]);for(E=0;E<l.length;E++)K=d[l[E]],n[E].style.width=null!==K.sWidthOrig&&""!==K.sWidthOrig?Z(K.sWidthOrig):"",K.sWidthOrig&&f&&b(n[E]).append(b("<div/>").css({width:K.sWidthOrig,margin:0,padding:0,border:0,height:1}));if(a.aoData.length)for(E=0;E<l.length;E++)v=l[E],K=d[v],b(tb(a,v)).clone(!1).append(K.sContentPadding).appendTo(B);b("[name]",
m).removeAttr("name");K=b("<div/>").css(f||e?{position:"absolute",top:0,left:0,height:1,right:0,overflow:"hidden"}:{}).append(m).appendTo(w);f&&h?m.width(h):f?(m.css("width","auto"),m.removeAttr("width"),m.width()<w.clientWidth&&x&&m.width(w.clientWidth)):e?m.width(w.clientWidth):x&&m.width(x);for(E=e=0;E<l.length;E++)w=b(n[E]),h=w.outerWidth()-w.width(),w=u.bBounding?Math.ceil(n[E].getBoundingClientRect().width):w.outerWidth(),e+=w,d[l[E]].sWidth=Z(w-h);c.style.width=Z(e);K.remove()}x&&(c.style.width=
Z(x));!x&&!f||a._reszEvt||(c=function(){b(k).on("resize.DT-"+a.sInstance,Ra(function(){q(a)}))},g?setTimeout(c,1E3):c(),a._reszEvt=!0)}function sb(a,c){if(!a)return 0;var d=b("<div/>").css("width",Z(a)).appendTo(c||f.body),g=d[0].offsetWidth;d.remove();return g}function tb(a,c){var d=ub(a,c);if(0>d)return null;var g=a.aoData[d];return g.nTr?g.anCells[c]:b("<td/>").html(O(a,d,c,"display"))[0]}function ub(a,b){for(var c,d=-1,g=-1,e=0,f=a.aoData.length;e<f;e++)c=O(a,e,b,"display")+"",c=c.replace(Mb,
""),c=c.replace(/&nbsp;/g," "),c.length>d&&(d=c.length,g=e);return g}function Z(a){return null===a?"0px":"number"==typeof a?0>a?"0px":a+"px":a.match(/\d$/)?a+"px":a}function ua(a){var c,d,g=[],e=a.aoColumns,f,p,m,l;c=a.aaSortingFixed;d=b.isPlainObject(c);var n=[];f=function(a){a.length&&!b.isArray(a[0])?n.push(a):b.merge(n,a)};b.isArray(c)&&f(c);d&&c.pre&&f(c.pre);f(a.aaSorting);d&&c.post&&f(c.post);for(a=0;a<n.length;a++)for(l=n[a][0],f=e[l].aDataSort,c=0,d=f.length;c<d;c++)p=f[c],m=e[p].sType||
"string",n[a]._idx===h&&(n[a]._idx=b.inArray(n[a][1],e[p].asSorting)),g.push({src:l,col:p,dir:n[a][1],index:n[a]._idx,type:m,formatter:F.ext.type.order[m+"-pre"]});return g}function jb(a){var b,c,d=[],g=F.ext.type.order,e=a.aoData,f=0,p,h=a.aiDisplayMaster,m;C(a);m=ua(a);b=0;for(c=m.length;b<c;b++)p=m[b],p.formatter&&f++,vb(a,p.col);if("ssp"!=ia(a)&&0!==m.length){b=0;for(c=h.length;b<c;b++)d[h[b]]=b;f===m.length?h.sort(function(a,b){var c,g,f,p,h=m.length,l=e[a]._aSortData,n=e[b]._aSortData;for(f=
0;f<h;f++)if(p=m[f],c=l[p.col],g=n[p.col],c=c<g?-1:c>g?1:0,0!==c)return"asc"===p.dir?c:-c;c=d[a];g=d[b];return c<g?-1:c>g?1:0}):h.sort(function(a,b){var c,f,p,h,l=m.length,n=e[a]._aSortData,q=e[b]._aSortData;for(p=0;p<l;p++)if(h=m[p],c=n[h.col],f=q[h.col],h=g[h.type+"-"+h.dir]||g["string-"+h.dir],c=h(c,f),0!==c)return c;c=d[a];f=d[b];return c<f?-1:c>f?1:0})}a.bSorted=!0}function wb(a){var b,c,d=a.aoColumns,g=ua(a);a=a.oLanguage.oAria;for(var e=0,f=d.length;e<f;e++){c=d[e];var p=c.asSorting;b=c.sTitle.replace(/<.*?>/g,
"");var h=c.nTh;h.removeAttribute("aria-sort");c.bSortable&&(0<g.length&&g[0].col==e?(h.setAttribute("aria-sort","asc"==g[0].dir?"ascending":"descending"),c=p[g[0].index+1]||p[0]):c=p[0],b+="asc"===c?a.sSortAscending:a.sSortDescending);h.setAttribute("aria-label",b)}}function Za(a,c,d,g){var e=a.aaSorting,f=a.aoColumns[c].asSorting,p=function(a,c){var d=a._idx;d===h&&(d=b.inArray(a[1],f));return d+1<f.length?d+1:c?null:0};"number"===typeof e[0]&&(e=a.aaSorting=[e]);d&&a.oFeatures.bSortMulti?(d=b.inArray(c,
na(e,"0")),-1!==d?(c=p(e[d],!0),null===c&&1===e.length&&(c=0),null===c?e.splice(d,1):(e[d][1]=f[c],e[d]._idx=c)):(e.push([c,f[0],0]),e[e.length-1]._idx=0)):e.length&&e[0][0]==c?(c=p(e[0]),e.length=1,e[0][1]=f[c],e[0]._idx=c):(e.length=0,e.push([c,f[0]]),e[0]._idx=0);ea(a);"function"==typeof g&&g(a)}function Pa(a,b,c,d){var g=a.aoColumns[c];$a(b,{},function(b){!1!==g.bSortable&&(a.oFeatures.bProcessing?(oa(a,!0),setTimeout(function(){Za(a,c,b.shiftKey,d);"ssp"!==ia(a)&&oa(a,!1)},0)):Za(a,c,b.shiftKey,
d))})}function Ia(a){var c=a.aLastSort,d=a.oClasses.sSortColumn,g=ua(a),e=a.oFeatures,f,p;if(e.bSort&&e.bSortClasses){e=0;for(f=c.length;e<f;e++)p=c[e].src,b(na(a.aoData,"anCells",p)).removeClass(d+(2>e?e+1:3));e=0;for(f=g.length;e<f;e++)p=g[e].src,b(na(a.aoData,"anCells",p)).addClass(d+(2>e?e+1:3))}a.aLastSort=g}function vb(a,b){var c=a.aoColumns[b],d=F.ext.order[c.sSortDataType],g;d&&(g=d.call(a.oInstance,a,b,n(a,b)));for(var e,f=F.ext.type.order[c.sType+"-pre"],p=0,h=a.aoData.length;p<h;p++)if(c=
a.aoData[p],c._aSortData||(c._aSortData=[]),!c._aSortData[b]||d)e=d?g[p]:O(a,p,b,"sort"),c._aSortData[b]=f?f(e):e}function Ja(a){if(a.oFeatures.bStateSave&&!a.bDestroying){var c={time:+new Date,start:a._iDisplayStart,length:a._iDisplayLength,order:b.extend(!0,[],a.aaSorting),search:Va(a.oPreviousSearch),columns:b.map(a.aoColumns,function(b,c){return{visible:b.bVisible,search:Va(a.aoPreSearchCols[c])}})};X(a,"aoStateSaveParams","stateSaveParams",[a,c]);a.oSavedState=c;a.fnStateSaveCallback.call(a.oInstance,
a,c)}}function xb(a,c,d){var g,e,f=a.aoColumns;c=function(c){if(c&&c.time){var m=X(a,"aoStateLoadParams","stateLoadParams",[a,p]);if(-1===b.inArray(!1,m)&&(m=a.iStateDuration,!(0<m&&c.time<+new Date-1E3*m||c.columns&&f.length!==c.columns.length))){a.oLoadedState=b.extend(!0,{},p);c.start!==h&&(a._iDisplayStart=c.start,a.iInitDisplayStart=c.start);c.length!==h&&(a._iDisplayLength=c.length);c.order!==h&&(a.aaSorting=[],b.each(c.order,function(b,c){a.aaSorting.push(c[0]>=f.length?[0,c[1]]:c)}));c.search!==
h&&b.extend(a.oPreviousSearch,ya(c.search));if(c.columns)for(g=0,e=c.columns.length;g<e;g++)m=c.columns[g],m.visible!==h&&(f[g].bVisible=m.visible),m.search!==h&&b.extend(a.aoPreSearchCols[g],ya(m.search));X(a,"aoStateLoaded","stateLoaded",[a,p])}}d()};if(a.oFeatures.bStateSave){var p=a.fnStateLoadCallback.call(a.oInstance,a,c);p!==h&&c(p)}else d()}function Ka(a){var c=F.settings;a=b.inArray(a,na(c,"nTable"));return-1!==a?c[a]:null}function ra(a,b,c,d){c="DataTables warning: "+(a?"table id="+a.sTableId+
" - ":"")+c;d&&(c+=". For more information about this error, please see http://datatables.net/tn/"+d);if(b)k.console&&console.log&&console.log(c);else if(b=F.ext,b=b.sErrMode||b.errMode,a&&X(a,null,"error",[a,d,c]),"alert"==b)alert(c);else{if("throw"==b)throw Error(c);"function"==typeof b&&b(a,d,c)}}function pa(a,c,d,g){b.isArray(d)?b.each(d,function(d,g){b.isArray(g)?pa(a,c,g[0],g[1]):pa(a,c,g)}):(g===h&&(g=d),c[d]!==h&&(a[g]=c[d]))}function yb(a,c,d){var g,e;for(e in c)c.hasOwnProperty(e)&&(g=c[e],
b.isPlainObject(g)?(b.isPlainObject(a[e])||(a[e]={}),b.extend(!0,a[e],g)):d&&"data"!==e&&"aaData"!==e&&b.isArray(g)?a[e]=g.slice():a[e]=g);return a}function $a(a,c,d){b(a).on("click.DT",c,function(b){a.blur();d(b)}).on("keypress.DT",c,function(a){13===a.which&&(a.preventDefault(),d(a))}).on("selectstart.DT",function(){return!1})}function ka(a,b,c,d){c&&a[b].push({fn:c,sName:d})}function X(a,c,d,g){var e=[];c&&(e=b.map(a[c].slice().reverse(),function(b,c){return b.fn.apply(a.oInstance,g)}));null!==
d&&(c=b.Event(d+".dt"),b(a.nTable).trigger(c,g),e.push(c.result));return e}function Xa(a){var b=a._iDisplayStart,c=a.fnDisplayEnd(),d=a._iDisplayLength;b>=c&&(b=c-d);b-=b%d;if(-1===d||0>b)b=0;a._iDisplayStart=b}function Qa(a,c){var d=a.renderer,g=F.ext.renderer[c];return b.isPlainObject(d)&&d[c]?g[d[c]]||g._:"string"===typeof d?g[d]||g._:g._}function ia(a){return a.oFeatures.bServerSide?"ssp":a.ajax||a.sAjaxSource?"ajax":"dom"}function Aa(a,b){var c;c=zb.numbers_length;var d=Math.floor(c/2);b<=c?
c=va(0,b):a<=d?(c=va(0,c-2),c.push("ellipsis"),c.push(b-1)):(a>=b-1-d?c=va(b-(c-2),b):(c=va(a-d+2,a+d-1),c.push("ellipsis"),c.push(b-1)),c.splice(0,0,"ellipsis"),c.splice(0,0,0));c.DT_el="span";return c}function ib(a){b.each({num:function(b){return La(b,a)},"num-fmt":function(b){return La(b,a,ab)},"html-num":function(b){return La(b,a,Ma)},"html-num-fmt":function(b){return La(b,a,Ma,ab)}},function(b,c){da.type.order[b+a+"-pre"]=c;b.match(/^html\-/)&&(da.type.search[b+a]=da.type.search.html)})}function Ab(a){return function(){var b=
[Ka(this[F.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return F.ext.internal[a].apply(this,b)}}var F=function(e){this.$=function(a,b){return this.api(!0).$(a,b)};this._=function(a,b){return this.api(!0).rows(a,b).data()};this.api=function(a){return a?new T(Ka(this[da.iApiIndex])):new T(this)};this.fnAddData=function(a,c){var d=this.api(!0),g=b.isArray(a)&&(b.isArray(a[0])||b.isPlainObject(a[0]))?d.rows.add(a):d.row.add(a);(c===h||c)&&d.draw();return g.flatten().toArray()};this.fnAdjustColumnSizing=
function(a){var b=this.api(!0).columns.adjust(),c=b.settings()[0],d=c.oScroll;a===h||a?b.draw(!1):""===d.sX&&""===d.sY||Da(c)};this.fnClearTable=function(a){var b=this.api(!0).clear();(a===h||a)&&b.draw()};this.fnClose=function(a){this.api(!0).row(a).child.hide()};this.fnDeleteRow=function(a,b,c){var d=this.api(!0);a=d.rows(a);var g=a.settings()[0],e=g.aoData[a[0][0]];a.remove();b&&b.call(this,g,e);(c===h||c)&&d.draw();return e};this.fnDestroy=function(a){this.api(!0).destroy(a)};this.fnDraw=function(a){this.api(!0).draw(a)};
this.fnFilter=function(a,b,c,d,g,e){g=this.api(!0);null===b||b===h?g.search(a,c,d,e):g.column(b).search(a,c,d,e);g.draw()};this.fnGetData=function(a,b){var c=this.api(!0);if(a!==h){var d=a.nodeName?a.nodeName.toLowerCase():"";return b!==h||"td"==d||"th"==d?c.cell(a,b).data():c.row(a).data()||null}return c.data().toArray()};this.fnGetNodes=function(a){var b=this.api(!0);return a!==h?b.row(a).node():b.rows().nodes().flatten().toArray()};this.fnGetPosition=function(a){var b=this.api(!0),c=a.nodeName.toUpperCase();
return"TR"==c?b.row(a).index():"TD"==c||"TH"==c?(a=b.cell(a).index(),[a.row,a.columnVisible,a.column]):null};this.fnIsOpen=function(a){return this.api(!0).row(a).child.isShown()};this.fnOpen=function(a,b,c){return this.api(!0).row(a).child(b,c).show().child()[0]};this.fnPageChange=function(a,b){var c=this.api(!0).page(a);(b===h||b)&&c.draw(!1)};this.fnSetColumnVis=function(a,b,c){a=this.api(!0).column(a).visible(b);(c===h||c)&&a.columns.adjust().draw()};this.fnSettings=function(){return Ka(this[da.iApiIndex])};
this.fnSort=function(a){this.api(!0).order(a).draw()};this.fnSortListener=function(a,b,c){this.api(!0).order.listener(a,b,c)};this.fnUpdate=function(a,b,c,d,g){var e=this.api(!0);c===h||null===c?e.row(b).data(a):e.cell(b,c).data(a);(g===h||g)&&e.columns.adjust();(d===h||d)&&e.draw();return 0};this.fnVersionCheck=da.fnVersionCheck;var f=this,n=e===h,q=this.length;n&&(e={});this.oApi=this.internal=da.internal;for(var w in F.ext.internal)w&&(this[w]=Ab(w));this.each(function(){var w={},k=1<q?yb(w,e,
!0):e,v=0,E,w=this.getAttribute("id"),t=!1,x=F.defaults,r=b(this);if("table"!=this.nodeName.toLowerCase())ra(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{c(x);g(x.column);a(x,x,!0);a(x.column,x.column,!0);a(x,b.extend(k,r.data()));var K=F.settings,v=0;for(E=K.length;v<E;v++){var z=K[v];if(z.nTable==this||z.nTHead.parentNode==this||z.nTFoot&&z.nTFoot.parentNode==this){var hb=k.bRetrieve!==h?k.bRetrieve:x.bRetrieve;if(n||hb)return z.oInstance;if(k.bDestroy!==h?k.bDestroy:x.bDestroy){z.oInstance.fnDestroy();
break}else{ra(z,0,"Cannot reinitialise DataTable",3);return}}if(z.sTableId==this.id){K.splice(v,1);break}}if(null===w||""===w)this.id=w="DataTables_Table_"+F.ext._unique++;var B=b.extend(!0,{},F.models.oSettings,{sDestroyWidth:r[0].style.width,sInstance:w,sTableId:w});B.nTable=this;B.oApi=f.internal;B.oInit=k;K.push(B);B.oInstance=1===f.length?f:r.dataTable();c(k);k.oLanguage&&d(k.oLanguage);k.aLengthMenu&&!k.iDisplayLength&&(k.iDisplayLength=b.isArray(k.aLengthMenu[0])?k.aLengthMenu[0][0]:k.aLengthMenu[0]);
k=yb(b.extend(!0,{},x),k);pa(B.oFeatures,k,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" "));pa(B,k,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],
["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);pa(B.oScroll,k,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);pa(B.oLanguage,k,"fnInfoCallback");ka(B,"aoDrawCallback",k.fnDrawCallback,"user");ka(B,"aoServerParams",k.fnServerParams,"user");ka(B,"aoStateSaveParams",k.fnStateSaveParams,"user");ka(B,"aoStateLoadParams",k.fnStateLoadParams,"user");ka(B,"aoStateLoaded",k.fnStateLoaded,
"user");ka(B,"aoRowCallback",k.fnRowCallback,"user");ka(B,"aoRowCreatedCallback",k.fnCreatedRow,"user");ka(B,"aoHeaderCallback",k.fnHeaderCallback,"user");ka(B,"aoFooterCallback",k.fnFooterCallback,"user");ka(B,"aoInitComplete",k.fnInitComplete,"user");ka(B,"aoPreDrawCallback",k.fnPreDrawCallback,"user");B.rowIdFn=Q(k.rowId);m(B);var L=B.oClasses;k.bJQueryUI?(b.extend(L,F.ext.oJUIClasses,k.oClasses),k.sDom===x.sDom&&"lfrtip"===x.sDom&&(B.sDom='<"H"lfr>t<"F"ip>'),B.renderer)?b.isPlainObject(B.renderer)&&
!B.renderer.header&&(B.renderer.header="jqueryui"):B.renderer="jqueryui":b.extend(L,F.ext.classes,k.oClasses);r.addClass(L.sTable);B.iInitDisplayStart===h&&(B.iInitDisplayStart=k.iDisplayStart,B._iDisplayStart=k.iDisplayStart);null!==k.iDeferLoading&&(B.bDeferLoading=!0,w=b.isArray(k.iDeferLoading),B._iRecordsDisplay=w?k.iDeferLoading[0]:k.iDeferLoading,B._iRecordsTotal=w?k.iDeferLoading[1]:k.iDeferLoading);var H=B.oLanguage;b.extend(!0,H,k.oLanguage);H.sUrl&&(b.ajax({dataType:"json",url:H.sUrl,success:function(c){d(c);
a(x.oLanguage,c);b.extend(!0,H,c);za(B)},error:function(){za(B)}}),t=!0);null===k.asStripeClasses&&(B.asStripeClasses=[L.sStripeOdd,L.sStripeEven]);var w=B.asStripeClasses,ba=r.children("tbody").find("tr").eq(0);-1!==b.inArray(!0,b.map(w,function(a,b){return ba.hasClass(a)}))&&(b("tbody tr",this).removeClass(w.join(" ")),B.asDestroyStripes=w.slice());w=[];K=this.getElementsByTagName("thead");0!==K.length&&(ha(B.aoHeader,K[0]),w=p(B));if(null===k.aoColumns)for(K=[],v=0,E=w.length;v<E;v++)K.push(null);
else K=k.aoColumns;v=0;for(E=K.length;v<E;v++)l(B,w?w[v]:null);A(B,k.aoColumnDefs,K,function(a,b){u(B,a,b)});if(ba.length){var D=function(a,b){return null!==a.getAttribute("data-"+b)?b:null};b(ba[0]).children("th, td").each(function(a,b){var c=B.aoColumns[a];if(c.mData===a){var d=D(b,"sort")||D(b,"order"),g=D(b,"filter")||D(b,"search");if(null!==d||null!==g)c.mData={_:a+".display",sort:null!==d?a+".@data-"+d:h,type:null!==d?a+".@data-"+d:h,filter:null!==g?a+".@data-"+g:h},u(B,a)}})}var Ca=B.oFeatures,
w=function(){if(k.aaSorting===h){var a=B.aaSorting;v=0;for(E=a.length;v<E;v++)a[v][1]=B.aoColumns[v].asSorting[0]}Ia(B);Ca.bSort&&ka(B,"aoDrawCallback",function(){if(B.bSorted){var a=ua(B),c={};b.each(a,function(a,b){c[b.src]=b.dir});X(B,null,"order",[B,a,c]);wb(B)}});ka(B,"aoDrawCallback",function(){(B.bSorted||"ssp"===ia(B)||Ca.bDeferRender)&&Ia(B)},"sc");var a=r.children("caption").each(function(){this._captionSide=b(this).css("caption-side")}),c=r.children("thead");0===c.length&&(c=b("<thead/>").appendTo(r));
B.nTHead=c[0];c=r.children("tbody");0===c.length&&(c=b("<tbody/>").appendTo(r));B.nTBody=c[0];c=r.children("tfoot");0===c.length&&0<a.length&&(""!==B.oScroll.sX||""!==B.oScroll.sY)&&(c=b("<tfoot/>").appendTo(r));0===c.length||0===c.children().length?r.addClass(L.sNoFooter):0<c.length&&(B.nTFoot=c[0],ha(B.aoFooter,B.nTFoot));if(k.aaData)for(v=0;v<k.aaData.length;v++)y(B,k.aaData[v]);else(B.bDeferLoading||"dom"==ia(B))&&J(B,b(B.nTBody).children("tr"));B.aiDisplay=B.aiDisplayMaster.slice();B.bInitialised=
!0;!1===t&&za(B)};k.bStateSave?(Ca.bStateSave=!0,ka(B,"aoDrawCallback",Ja,"state_save"),xb(B,k,w)):w()}});f=null;return this},da,T,N,Y,bb={},Bb=/[\r\n]/g,Ma=/<.*?>/g,Nb=/^\d{2,4}[\.\/\-]\d{1,2}[\.\/\-]\d{1,2}([T ]{1}\d{1,2}[:\.]\d{2}([\.:]\d{2})?)?$/,Ob=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),ab=/[',$\u00a3\u20ac\u00a5%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi,sa=function(a){return a&&!0!==a&&"-"!==a?!1:!0},Cb=function(a){var b=parseInt(a,10);return!isNaN(b)&&
isFinite(a)?b:null},Db=function(a,b){bb[b]||(bb[b]=new RegExp(Ua(b),"g"));return"string"===typeof a&&"."!==b?a.replace(/\./g,"").replace(bb[b],"."):a},cb=function(a,b,c){var d="string"===typeof a;if(sa(a))return!0;b&&d&&(a=Db(a,b));c&&d&&(a=a.replace(ab,""));return!isNaN(parseFloat(a))&&isFinite(a)},Eb=function(a,b,c){return sa(a)?!0:sa(a)||"string"===typeof a?cb(a.replace(Ma,""),b,c)?!0:null:null},na=function(a,b,c){var d=[],g=0,e=a.length;if(c!==h)for(;g<e;g++)a[g]&&a[g][b]&&d.push(a[g][b][c]);
else for(;g<e;g++)a[g]&&d.push(a[g][b]);return d},Ba=function(a,b,c,d){var g=[],e=0,f=b.length;if(d!==h)for(;e<f;e++)a[b[e]][c]&&g.push(a[b[e]][c][d]);else for(;e<f;e++)g.push(a[b[e]][c]);return g},va=function(a,b){var c=[],d;b===h?(b=0,d=a):(d=b,b=a);for(var g=b;g<d;g++)c.push(g);return c},Fb=function(a){for(var b=[],c=0,d=a.length;c<d;c++)a[c]&&b.push(a[c]);return b},Ea=function(a){var b=[],c,d,g=a.length,e,f=0;d=0;a:for(;d<g;d++){c=a[d];for(e=0;e<f;e++)if(b[e]===c)continue a;b.push(c);f++}return b};
F.util={throttle:function(a,b){var c=b!==h?b:200,d,g;return function(){var b=this,e=+new Date,f=arguments;d&&e<d+c?(clearTimeout(g),g=setTimeout(function(){d=h;a.apply(b,f)},c)):(d=e,a.apply(b,f))}},escapeRegex:function(a){return a.replace(Ob,"\\$1")}};var la=function(a,b,c){a[b]!==h&&(a[c]=a[b])},wa=/\[.*?\]$/,ta=/\(\)$/,Ua=F.util.escapeRegex,Ha=b("<div>")[0],Lb=Ha.textContent!==h,Mb=/<.*?>/g,Ra=F.util.throttle,Gb=[],fa=Array.prototype,Pb=function(a){var c,d,g=F.settings,e=b.map(g,function(a,b){return a.nTable});
if(a){if(a.nTable&&a.oApi)return[a];if(a.nodeName&&"table"===a.nodeName.toLowerCase())return c=b.inArray(a,e),-1!==c?[g[c]]:null;if(a&&"function"===typeof a.settings)return a.settings().toArray();"string"===typeof a?d=b(a):a instanceof b&&(d=a)}else return[];if(d)return d.map(function(a){c=b.inArray(this,e);return-1!==c?g[c]:null}).toArray()};T=function(a,c){if(!(this instanceof T))return new T(a,c);var d=[],g=function(a){(a=Pb(a))&&(d=d.concat(a))};if(b.isArray(a))for(var e=0,f=a.length;e<f;e++)g(a[e]);
else g(a);this.context=Ea(d);c&&b.merge(this,c);this.selector={rows:null,cols:null,opts:null};T.extend(this,this,Gb)};F.Api=T;b.extend(T.prototype,{any:function(){return 0!==this.count()},concat:fa.concat,context:[],count:function(){return this.flatten().length},each:function(a){for(var b=0,c=this.length;b<c;b++)a.call(this,this[b],b,this);return this},eq:function(a){var b=this.context;return b.length>a?new T(b[a],this[a]):null},filter:function(a){var b=[];if(fa.filter)b=fa.filter.call(this,a,this);
else for(var c=0,d=this.length;c<d;c++)a.call(this,this[c],c,this)&&b.push(this[c]);return new T(this.context,b)},flatten:function(){var a=[];return new T(this.context,a.concat.apply(a,this.toArray()))},join:fa.join,indexOf:fa.indexOf||function(a,b){for(var c=b||0,d=this.length;c<d;c++)if(this[c]===a)return c;return-1},iterator:function(a,b,c,d){var g=[],e,f,p,m,l,n=this.context,w,q,k=this.selector;"string"===typeof a&&(d=c,c=b,b=a,a=!1);f=0;for(p=n.length;f<p;f++){var v=new T(n[f]);if("table"===
b)e=c.call(v,n[f],f),e!==h&&g.push(e);else if("columns"===b||"rows"===b)e=c.call(v,n[f],this[f],f),e!==h&&g.push(e);else if("column"===b||"column-rows"===b||"row"===b||"cell"===b)for(q=this[f],"column-rows"===b&&(w=Na(n[f],k.opts)),m=0,l=q.length;m<l;m++)e=q[m],e="cell"===b?c.call(v,n[f],e.row,e.column,f,m):c.call(v,n[f],e,f,m,w),e!==h&&g.push(e)}return g.length||d?(a=new T(n,a?g.concat.apply([],g):g),b=a.selector,b.rows=k.rows,b.cols=k.cols,b.opts=k.opts,a):this},lastIndexOf:fa.lastIndexOf||function(a,
b){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(a){var b=[];if(fa.map)b=fa.map.call(this,a,this);else for(var c=0,d=this.length;c<d;c++)b.push(a.call(this,this[c],c));return new T(this.context,b)},pluck:function(a){return this.map(function(b){return b[a]})},pop:fa.pop,push:fa.push,reduce:fa.reduce||function(a,b){return v(this,a,b,0,this.length,1)},reduceRight:fa.reduceRight||function(a,b){return v(this,a,b,this.length-1,-1,-1)},reverse:fa.reverse,selector:null,
shift:fa.shift,sort:fa.sort,splice:fa.splice,toArray:function(){return fa.slice.call(this)},to$:function(){return b(this)},toJQuery:function(){return b(this)},unique:function(){return new T(this.context,Ea(this))},unshift:fa.unshift});T.extend=function(a,c,d){if(d.length&&c&&(c instanceof T||c.__dt_wrapper)){var g,e,f,p=function(a,b,c){return function(){var d=b.apply(a,arguments);T.extend(d,d,c.methodExt);return d}};g=0;for(e=d.length;g<e;g++)f=d[g],c[f.name]="function"===typeof f.val?p(a,f.val,f):
b.isPlainObject(f.val)?{}:f.val,c[f.name].__dt_wrapper=!0,T.extend(a,c[f.name],f.propExt)}};T.register=N=function(a,c){if(b.isArray(a))for(var d=0,g=a.length;d<g;d++)T.register(a[d],c);else for(var e=a.split("."),f=Gb,p,h,d=0,g=e.length;d<g;d++){p=(h=-1!==e[d].indexOf("()"))?e[d].replace("()",""):e[d];var m;a:{m=0;for(var l=f.length;m<l;m++)if(f[m].name===p){m=f[m];break a}m=null}m||(m={name:p,val:{},methodExt:[],propExt:[]},f.push(m));d===g-1?m.val=c:f=h?m.methodExt:m.propExt}};T.registerPlural=
Y=function(a,c,d){T.register(a,d);T.register(c,function(){var a=d.apply(this,arguments);return a===this?this:a instanceof T?a.length?b.isArray(a[0])?new T(a.context,a[0]):a[0]:h:a})};var Qb=function(a,c){if("number"===typeof a)return[c[a]];var d=b.map(c,function(a,b){return a.nTable});return b(d).filter(a).map(function(a){a=b.inArray(this,d);return c[a]}).toArray()};N("tables()",function(a){return a?new T(Qb(a,this.context)):this});N("table()",function(a){a=this.tables(a);var b=a.context;return b.length?
new T(b[0]):a});Y("tables().nodes()","table().node()",function(){return this.iterator("table",function(a){return a.nTable},1)});Y("tables().body()","table().body()",function(){return this.iterator("table",function(a){return a.nTBody},1)});Y("tables().header()","table().header()",function(){return this.iterator("table",function(a){return a.nTHead},1)});Y("tables().footer()","table().footer()",function(){return this.iterator("table",function(a){return a.nTFoot},1)});Y("tables().containers()","table().container()",
function(){return this.iterator("table",function(a){return a.nTableWrapper},1)});N("draw()",function(a){return this.iterator("table",function(b){"page"===a?ca(b):("string"===typeof a&&(a="full-hold"===a?!1:!0),ea(b,!1===a))})});N("page()",function(a){return a===h?this.page.info().page:this.iterator("table",function(b){Ya(b,a)})});N("page.info()",function(a){if(0===this.context.length)return h;a=this.context[0];var b=a._iDisplayStart,c=a.oFeatures.bPaginate?a._iDisplayLength:-1,d=a.fnRecordsDisplay(),
g=-1===c;return{page:g?0:Math.floor(b/c),pages:g?1:Math.ceil(d/c),start:b,end:a.fnDisplayEnd(),length:c,recordsTotal:a.fnRecordsTotal(),recordsDisplay:d,serverSide:"ssp"===ia(a)}});N("page.len()",function(a){return a===h?0!==this.context.length?this.context[0]._iDisplayLength:h:this.iterator("table",function(b){Wa(b,a)})});var Hb=function(a,b,c){if(c){var d=new T(a);d.one("draw",function(){c(d.ajax.json())})}if("ssp"==ia(a))ea(a,b);else{oa(a,!0);var g=a.jqXHR;g&&4!==g.readyState&&g.abort();w(a,[],
function(c){L(a);c=B(a,c);for(var d=0,g=c.length;d<g;d++)y(a,c[d]);ea(a,b);oa(a,!1)})}};N("ajax.json()",function(){var a=this.context;if(0<a.length)return a[0].json});N("ajax.params()",function(){var a=this.context;if(0<a.length)return a[0].oAjaxData});N("ajax.reload()",function(a,b){return this.iterator("table",function(c){Hb(c,!1===b,a)})});N("ajax.url()",function(a){var c=this.context;if(a===h){if(0===c.length)return h;c=c[0];return c.ajax?b.isPlainObject(c.ajax)?c.ajax.url:c.ajax:c.sAjaxSource}return this.iterator("table",
function(c){b.isPlainObject(c.ajax)?c.ajax.url=a:c.ajax=a})});N("ajax.url().load()",function(a,b){return this.iterator("table",function(c){Hb(c,!1===b,a)})});var db=function(a,c,d,g,e){var f=[],p,m,l,n,w,q;l=typeof c;c&&"string"!==l&&"function"!==l&&c.length!==h||(c=[c]);l=0;for(n=c.length;l<n;l++)for(m=c[l]&&c[l].split&&!c[l].match(/[\[\(:]/)?c[l].split(","):[c[l]],w=0,q=m.length;w<q;w++)(p=d("string"===typeof m[w]?b.trim(m[w]):m[w]))&&p.length&&(f=f.concat(p));a=da.selector[a];if(a.length)for(l=
0,n=a.length;l<n;l++)f=a[l](g,e,f);return Ea(f)},eb=function(a){a||(a={});a.filter&&a.search===h&&(a.search=a.filter);return b.extend({search:"none",order:"current",page:"all"},a)},fb=function(a){for(var b=0,c=a.length;b<c;b++)if(0<a[b].length)return a[0]=a[b],a[0].length=1,a.length=1,a.context=[a.context[b]],a;a.length=0;return a},Na=function(a,c){var d,g,e,f=[],p=a.aiDisplay;d=a.aiDisplayMaster;var h=c.search;g=c.order;e=c.page;if("ssp"==ia(a))return"removed"===h?[]:va(0,d.length);if("current"==
e)for(d=a._iDisplayStart,g=a.fnDisplayEnd();d<g;d++)f.push(p[d]);else if("current"==g||"applied"==g)f="none"==h?d.slice():"applied"==h?p.slice():b.map(d,function(a,c){return-1===b.inArray(a,p)?a:null});else if("index"==g||"original"==g)for(d=0,g=a.aoData.length;d<g;d++)"none"==h?f.push(d):(e=b.inArray(d,p),(-1===e&&"removed"==h||0<=e&&"applied"==h)&&f.push(d));return f},Rb=function(a,c,d){var g;return db("row",c,function(c){var e=Cb(c);if(null!==e&&!d)return[e];g||(g=Na(a,d));if(null!==e&&-1!==b.inArray(e,
g))return[e];if(null===c||c===h||""===c)return g;if("function"===typeof c)return b.map(g,function(b){var d=a.aoData[b];return c(b,d._aData,d.nTr)?b:null});e=Fb(Ba(a.aoData,g,"nTr"));if(c.nodeName){if(c._DT_RowIndex!==h)return[c._DT_RowIndex];if(c._DT_CellIndex)return[c._DT_CellIndex.row];e=b(c).closest("*[data-dt-row]");return e.length?[e.data("dt-row")]:[]}if("string"===typeof c&&"#"===c.charAt(0)){var f=a.aIds[c.replace(/^#/,"")];if(f!==h)return[f.idx]}return b(e).filter(c).map(function(){return this._DT_RowIndex}).toArray()},
a,d)};N("rows()",function(a,c){a===h?a="":b.isPlainObject(a)&&(c=a,a="");c=eb(c);var d=this.iterator("table",function(b){return Rb(b,a,c)},1);d.selector.rows=a;d.selector.opts=c;return d});N("rows().nodes()",function(){return this.iterator("row",function(a,b){return a.aoData[b].nTr||h},1)});N("rows().data()",function(){return this.iterator(!0,"rows",function(a,b){return Ba(a.aoData,b,"_aData")},1)});Y("rows().cache()","row().cache()",function(a){return this.iterator("row",function(b,c){var d=b.aoData[c];
return"search"===a?d._aFilterData:d._aSortData},1)});Y("rows().invalidate()","row().invalidate()",function(a){return this.iterator("row",function(b,c){I(b,c,a)})});Y("rows().indexes()","row().index()",function(){return this.iterator("row",function(a,b){return b},1)});Y("rows().ids()","row().id()",function(a){for(var b=[],c=this.context,d=0,g=c.length;d<g;d++)for(var e=0,f=this[d].length;e<f;e++){var p=c[d].rowIdFn(c[d].aoData[this[d][e]]._aData);b.push((!0===a?"#":"")+p)}return new T(c,b)});Y("rows().remove()",
"row().remove()",function(){var a=this;this.iterator("row",function(b,c,d){var g=b.aoData,e=g[c],f,p,m,l,n;g.splice(c,1);f=0;for(p=g.length;f<p;f++)if(m=g[f],n=m.anCells,null!==m.nTr&&(m.nTr._DT_RowIndex=f),null!==n)for(m=0,l=n.length;m<l;m++)n[m]._DT_CellIndex.row=f;S(b.aiDisplayMaster,c);S(b.aiDisplay,c);S(a[d],c,!1);Xa(b);c=b.rowIdFn(e._aData);c!==h&&delete b.aIds[c]});this.iterator("table",function(a){for(var b=0,c=a.aoData.length;b<c;b++)a.aoData[b].idx=b});return this});N("rows.add()",function(a){var c=
this.iterator("table",function(b){var c,d,g,e=[];d=0;for(g=a.length;d<g;d++)c=a[d],c.nodeName&&"TR"===c.nodeName.toUpperCase()?e.push(J(b,c)[0]):e.push(y(b,c));return e},1),d=this.rows(-1);d.pop();b.merge(d,c);return d});N("row()",function(a,b){return fb(this.rows(a,b))});N("row().data()",function(a){var b=this.context;if(a===h)return b.length&&this.length?b[0].aoData[this[0]]._aData:h;b[0].aoData[this[0]]._aData=a;I(b[0],this[0],"data");return this});N("row().node()",function(){var a=this.context;
return a.length&&this.length?a[0].aoData[this[0]].nTr||null:null});N("row.add()",function(a){a instanceof b&&a.length&&(a=a[0]);var c=this.iterator("table",function(b){return a.nodeName&&"TR"===a.nodeName.toUpperCase()?J(b,a)[0]:y(b,a)});return this.row(c[0])});var Sb=function(a,c,d,g){var e=[],f=function(c,d){if(b.isArray(c)||c instanceof b)for(var g=0,p=c.length;g<p;g++)f(c[g],d);else c.nodeName&&"tr"===c.nodeName.toLowerCase()?e.push(c):(g=b("<tr><td/></tr>").addClass(d),b("td",g).addClass(d).html(c)[0].colSpan=
r(a),e.push(g[0]))};f(d,g);c._details&&c._details.detach();c._details=b(e);c._detailsShow&&c._details.insertAfter(c.nTr)},gb=function(a,b){var c=a.context;c.length&&(c=c[0].aoData[b!==h?b:a[0]])&&c._details&&(c._details.remove(),c._detailsShow=h,c._details=h)},Ib=function(a,b){var c=a.context;if(c.length&&a.length){var d=c[0].aoData[a[0]];d._details&&((d._detailsShow=b)?d._details.insertAfter(d.nTr):d._details.detach(),Tb(c[0]))}},Tb=function(a){var b=new T(a),c=a.aoData;b.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details");
0<na(c,"_details").length&&(b.on("draw.dt.DT_details",function(d,g){a===g&&b.rows({page:"current"}).eq(0).each(function(a){a=c[a];a._detailsShow&&a._details.insertAfter(a.nTr)})}),b.on("column-visibility.dt.DT_details",function(b,d,g,e){if(a===d)for(d=r(d),g=0,e=c.length;g<e;g++)b=c[g],b._details&&b._details.children("td[colspan]").attr("colspan",d)}),b.on("destroy.dt.DT_details",function(d,g){if(a===g)for(var e=0,f=c.length;e<f;e++)c[e]._details&&gb(b,e)}))};N("row().child()",function(a,b){var c=
this.context;if(a===h)return c.length&&this.length?c[0].aoData[this[0]]._details:h;!0===a?this.child.show():!1===a?gb(this):c.length&&this.length&&Sb(c[0],c[0].aoData[this[0]],a,b);return this});N(["row().child.show()","row().child().show()"],function(a){Ib(this,!0);return this});N(["row().child.hide()","row().child().hide()"],function(){Ib(this,!1);return this});N(["row().child.remove()","row().child().remove()"],function(){gb(this);return this});N("row().child.isShown()",function(){var a=this.context;
return a.length&&this.length?a[0].aoData[this[0]]._detailsShow||!1:!1});var Ub=/^([^:]+):(name|visIdx|visible)$/,Jb=function(a,b,c,d,g){c=[];d=0;for(var e=g.length;d<e;d++)c.push(O(a,g[d],b));return c},Vb=function(a,c,d){var g=a.aoColumns,e=na(g,"sName"),f=na(g,"nTh");return db("column",c,function(c){var p=Cb(c);if(""===c)return va(g.length);if(null!==p)return[0<=p?p:g.length+p];if("function"===typeof c){var h=Na(a,d);return b.map(g,function(b,d){return c(d,Jb(a,d,0,0,h),f[d])?d:null})}var m="string"===
typeof c?c.match(Ub):"";if(m)switch(m[2]){case "visIdx":case "visible":p=parseInt(m[1],10);if(0>p){var l=b.map(g,function(a,b){return a.bVisible?b:null});return[l[l.length+p]]}return[t(a,p)];case "name":return b.map(e,function(a,b){return a===m[1]?b:null});default:return[]}if(c.nodeName&&c._DT_CellIndex)return[c._DT_CellIndex.column];p=b(f).filter(c).map(function(){return b.inArray(this,f)}).toArray();if(p.length||!c.nodeName)return p;p=b(c).closest("*[data-dt-column]");return p.length?[p.data("dt-column")]:
[]},a,d)};N("columns()",function(a,c){a===h?a="":b.isPlainObject(a)&&(c=a,a="");c=eb(c);var d=this.iterator("table",function(b){return Vb(b,a,c)},1);d.selector.cols=a;d.selector.opts=c;return d});Y("columns().header()","column().header()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTh},1)});Y("columns().footer()","column().footer()",function(a,b){return this.iterator("column",function(a,b){return a.aoColumns[b].nTf},1)});Y("columns().data()","column().data()",
function(){return this.iterator("column-rows",Jb,1)});Y("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(a,b){return a.aoColumns[b].mData},1)});Y("columns().cache()","column().cache()",function(a){return this.iterator("column-rows",function(b,c,d,g,e){return Ba(b.aoData,e,"search"===a?"_aFilterData":"_aSortData",c)},1)});Y("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(a,b,c,d,g){return Ba(a.aoData,g,"anCells",
b)},1)});Y("columns().visible()","column().visible()",function(a,c){var d=this.iterator("column",function(c,d){if(a===h)return c.aoColumns[d].bVisible;var g=c.aoColumns,e=g[d],f=c.aoData,p,m,l;if(a!==h&&e.bVisible!==a){if(a){var n=b.inArray(!0,na(g,"bVisible"),d+1);p=0;for(m=f.length;p<m;p++)l=f[p].nTr,g=f[p].anCells,l&&l.insertBefore(g[d],g[n]||null)}else b(na(c.aoData,"anCells",d)).detach();e.bVisible=a;M(c,c.aoHeader);M(c,c.aoFooter);Ja(c)}});a!==h&&(this.iterator("column",function(b,d){X(b,null,
"column-visibility",[b,d,a,c])}),(c===h||c)&&this.columns.adjust());return d});Y("columns().indexes()","column().index()",function(a){return this.iterator("column",function(b,c){return"visible"===a?n(b,c):c},1)});N("columns.adjust()",function(){return this.iterator("table",function(a){q(a)},1)});N("column.index()",function(a,b){if(0!==this.context.length){var c=this.context[0];if("fromVisible"===a||"toData"===a)return t(c,b);if("fromData"===a||"toVisible"===a)return n(c,b)}});N("column()",function(a,
b){return fb(this.columns(a,b))});var Wb=function(a,c,d){var g=a.aoData,e=Na(a,d),f=Fb(Ba(g,e,"anCells")),p=b([].concat.apply([],f)),m,l=a.aoColumns.length,n,w,q,k,v,E;return db("cell",c,function(c){var d="function"===typeof c;if(null===c||c===h||d){n=[];w=0;for(q=e.length;w<q;w++)for(m=e[w],k=0;k<l;k++)v={row:m,column:k},d?(E=g[m],c(v,O(a,m,k),E.anCells?E.anCells[k]:null)&&n.push(v)):n.push(v);return n}if(b.isPlainObject(c))return[c];d=p.filter(c).map(function(a,b){return{row:b._DT_CellIndex.row,
column:b._DT_CellIndex.column}}).toArray();if(d.length||!c.nodeName)return d;E=b(c).closest("*[data-dt-row]");return E.length?[{row:E.data("dt-row"),column:E.data("dt-column")}]:[]},a,d)};N("cells()",function(a,c,d){b.isPlainObject(a)&&(a.row===h?(d=a,a=null):(d=c,c=null));b.isPlainObject(c)&&(d=c,c=null);if(null===c||c===h)return this.iterator("table",function(b){return Wb(b,a,eb(d))});var g=this.columns(c,d),e=this.rows(a,d),f,p,m,l,n,w=this.iterator("table",function(a,b){f=[];p=0;for(m=e[b].length;p<
m;p++)for(l=0,n=g[b].length;l<n;l++)f.push({row:e[b][p],column:g[b][l]});return f},1);b.extend(w.selector,{cols:c,rows:a,opts:d});return w});Y("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(a,b,c){return(a=a.aoData[b])&&a.anCells?a.anCells[c]:h},1)});N("cells().data()",function(){return this.iterator("cell",function(a,b,c){return O(a,b,c)},1)});Y("cells().cache()","cell().cache()",function(a){a="search"===a?"_aFilterData":"_aSortData";return this.iterator("cell",
function(b,c,d){return b.aoData[c][a][d]},1)});Y("cells().render()","cell().render()",function(a){return this.iterator("cell",function(b,c,d){return O(b,c,d,a)},1)});Y("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(a,b,c){return{row:b,column:c,columnVisible:n(a,c)}},1)});Y("cells().invalidate()","cell().invalidate()",function(a){return this.iterator("cell",function(b,c,d){I(b,c,a,d)})});N("cell()",function(a,b,c){return fb(this.cells(a,b,c))});N("cell().data()",
function(a){var b=this.context,c=this[0];if(a===h)return b.length&&c.length?O(b[0],c[0].row,c[0].column):h;G(b[0],c[0].row,c[0].column,a);I(b[0],c[0].row,"data",c[0].column);return this});N("order()",function(a,c){var d=this.context;if(a===h)return 0!==d.length?d[0].aaSorting:h;"number"===typeof a?a=[[a,c]]:a.length&&!b.isArray(a[0])&&(a=Array.prototype.slice.call(arguments));return this.iterator("table",function(b){b.aaSorting=a.slice()})});N("order.listener()",function(a,b,c){return this.iterator("table",
function(d){Pa(d,a,b,c)})});N("order.fixed()",function(a){if(!a){var c=this.context,c=c.length?c[0].aaSortingFixed:h;return b.isArray(c)?{pre:c}:c}return this.iterator("table",function(c){c.aaSortingFixed=b.extend(!0,{},a)})});N(["columns().order()","column().order()"],function(a){var c=this;return this.iterator("table",function(d,g){var e=[];b.each(c[g],function(b,c){e.push([c,a])});d.aaSorting=e})});N("search()",function(a,c,d,g){var e=this.context;return a===h?0!==e.length?e[0].oPreviousSearch.sSearch:
h:this.iterator("table",function(e){e.oFeatures.bFilter&&ma(e,b.extend({},e.oPreviousSearch,{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===d?!0:d,bCaseInsensitive:null===g?!0:g}),1)})});Y("columns().search()","column().search()",function(a,c,d,g){return this.iterator("column",function(e,f){var p=e.aoPreSearchCols;if(a===h)return p[f].sSearch;e.oFeatures.bFilter&&(b.extend(p[f],{sSearch:a+"",bRegex:null===c?!1:c,bSmart:null===d?!0:d,bCaseInsensitive:null===g?!0:g}),ma(e,e.oPreviousSearch,1))})});
N("state()",function(){return this.context.length?this.context[0].oSavedState:null});N("state.clear()",function(){return this.iterator("table",function(a){a.fnStateSaveCallback.call(a.oInstance,a,{})})});N("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null});N("state.save()",function(){return this.iterator("table",function(a){Ja(a)})});F.versionCheck=F.fnVersionCheck=function(a){var b=F.version.split(".");a=a.split(".");for(var c,d,g=0,e=a.length;g<e;g++)if(c=
parseInt(b[g],10)||0,d=parseInt(a[g],10)||0,c!==d)return c>d;return!0};F.isDataTable=F.fnIsDataTable=function(a){var c=b(a).get(0),d=!1;if(a instanceof F.Api)return!0;b.each(F.settings,function(a,g){var e=g.nScrollHead?b("table",g.nScrollHead)[0]:null,f=g.nScrollFoot?b("table",g.nScrollFoot)[0]:null;if(g.nTable===c||e===c||f===c)d=!0});return d};F.tables=F.fnTables=function(a){var c=!1;b.isPlainObject(a)&&(c=a.api,a=a.visible);var d=b.map(F.settings,function(c){if(!a||a&&b(c.nTable).is(":visible"))return c.nTable});
return c?new T(d):d};F.camelToHungarian=a;N("$()",function(a,c){var d=this.rows(c).nodes(),d=b(d);return b([].concat(d.filter(a).toArray(),d.find(a).toArray()))});b.each(["on","one","off"],function(a,c){N(c+"()",function(){var a=Array.prototype.slice.call(arguments);a[0]=b.map(a[0].split(/\s/),function(a){return a.match(/\.dt\b/)?a:a+".dt"}).join(" ");var d=b(this.tables().nodes());d[c].apply(d,a);return this})});N("clear()",function(){return this.iterator("table",function(a){L(a)})});N("settings()",
function(){return new T(this.context,this.context)});N("init()",function(){var a=this.context;return a.length?a[0].oInit:null});N("data()",function(){return this.iterator("table",function(a){return na(a.aoData,"_aData")}).flatten()});N("destroy()",function(a){a=a||!1;return this.iterator("table",function(c){var d=c.nTableWrapper.parentNode,g=c.oClasses,e=c.nTable,f=c.nTBody,p=c.nTHead,h=c.nTFoot,m=b(e),f=b(f),l=b(c.nTableWrapper),n=b.map(c.aoData,function(a){return a.nTr}),w;c.bDestroying=!0;X(c,
"aoDestroyCallback","destroy",[c]);a||(new T(c)).columns().visible(!0);l.off(".DT").find(":not(tbody *)").off(".DT");b(k).off(".DT-"+c.sInstance);e!=p.parentNode&&(m.children("thead").detach(),m.append(p));h&&e!=h.parentNode&&(m.children("tfoot").detach(),m.append(h));c.aaSorting=[];c.aaSortingFixed=[];Ia(c);b(n).removeClass(c.asStripeClasses.join(" "));b("th, td",p).removeClass(g.sSortable+" "+g.sSortableAsc+" "+g.sSortableDesc+" "+g.sSortableNone);c.bJUI&&(b("th span."+g.sSortIcon+", td span."+
g.sSortIcon,p).detach(),b("th, td",p).each(function(){var a=b("div."+g.sSortJUIWrapper,this);b(this).append(a.contents());a.detach()}));f.children().detach();f.append(n);p=a?"remove":"detach";m[p]();l[p]();!a&&d&&(d.insertBefore(e,c.nTableReinsertBefore),m.css("width",c.sDestroyWidth).removeClass(g.sTable),(w=c.asDestroyStripes.length)&&f.children().each(function(a){b(this).addClass(c.asDestroyStripes[a%w])}));d=b.inArray(c,F.settings);-1!==d&&F.settings.splice(d,1)})});b.each(["column","row","cell"],
function(a,b){N(b+"s().every()",function(a){var c=this.selector.opts,d=this;return this.iterator(b,function(g,e,f,p,m){a.call(d[b](e,"cell"===b?f:c,"cell"===b?c:h),e,f,p,m)})})});N("i18n()",function(a,c,d){var g=this.context[0];a=Q(a)(g.oLanguage);a===h&&(a=c);d!==h&&b.isPlainObject(a)&&(a=a[d]!==h?a[d]:a._);return a.replace("%d",d)});F.version="1.10.13";F.settings=[];F.models={};F.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0};F.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,
_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null,idx:-1};F.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null};F.defaults={aaData:null,aaSorting:[[0,
"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,
this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(a){try{return JSON.parse((-1===a.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+a.sInstance+"_"+location.pathname))}catch(hb){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(a,b){try{(-1===a.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+
a.sInstance+"_"+location.pathname,JSON.stringify(b))}catch(Ca){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",
sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:b.extend({},F.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null,rowId:"DT_RowId"};
e(F.defaults);F.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null};e(F.defaults.column);F.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,
bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1,bBounding:!1,barWidth:0},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aIds:{},aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],
aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:h,oAjaxData:h,fnServerData:null,
aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==ia(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==ia(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var a=
this._iDisplayLength,b=this._iDisplayStart,c=b+a,d=this.aiDisplay.length,g=this.oFeatures,e=g.bPaginate;return g.bServerSide?!1===e||-1===a?b+d:Math.min(b+a,this._iRecordsDisplay):!e||c>d||-1===a?d:c},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{},rowIdFn:null,rowId:null};F.ext=da={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},
header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:F.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:F.version};b.extend(da,{afnFiltering:da.search,aTypes:da.type.detect,ofnSearch:da.type.search,oSort:da.type.order,afnSortData:da.order,aoFeatures:da.feature,oApi:da.internal,oStdClasses:da.classes,oPagination:da.pager});b.extend(F.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",
sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",
sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});b.extend(F.ext.oJUIClasses,F.ext.classes,{sPageButton:"fg-button ui-button ui-state-default",sPageButtonActive:"ui-state-disabled",
sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:"ui-state-default sorting_asc",sSortDesc:"ui-state-default sorting_desc",sSortable:"ui-state-default sorting",sSortableAsc:"ui-state-default sorting_asc_disabled",sSortableDesc:"ui-state-default sorting_desc_disabled",sSortableNone:"ui-state-default sorting_disabled",sSortJUIAsc:"css_right ui-icon ui-icon-triangle-1-n",sSortJUIDesc:"css_right ui-icon ui-icon-triangle-1-s",
sSortJUI:"css_right ui-icon ui-icon-carat-2-n-s",sSortJUIAscAllowed:"css_right ui-icon ui-icon-carat-1-n",sSortJUIDescAllowed:"css_right ui-icon ui-icon-carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead ui-state-default",sScrollFoot:"dataTables_scrollFoot ui-state-default",sHeaderTH:"ui-state-default",sFooterTH:"ui-state-default",sJUIHeader:"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix ui-corner-tl ui-corner-tr",sJUIFooter:"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix ui-corner-bl ui-corner-br"});
var zb=F.ext.pager;b.extend(zb,{simple:function(a,b){return["previous","next"]},full:function(a,b){return["first","previous","next","last"]},numbers:function(a,b){return[Aa(a,b)]},simple_numbers:function(a,b){return["previous",Aa(a,b),"next"]},full_numbers:function(a,b){return["first","previous",Aa(a,b),"next","last"]},first_last_numbers:function(a,b){return["first",Aa(a,b),"last"]},_numbers:Aa,numbers_length:7});b.extend(!0,F.ext.renderer,{pageButton:{_:function(a,c,d,g,e,p){var m=a.oClasses,l=a.oLanguage.oPaginate,
n=a.oLanguage.oAria.paginate||{},w,q,k=0,v=function(c,g){var f,h,E,t,r=function(b){Ya(a,b.data.action,!0)};f=0;for(h=g.length;f<h;f++)if(t=g[f],b.isArray(t))E=b("<"+(t.DT_el||"div")+"/>").appendTo(c),v(E,t);else{w=null;q="";switch(t){case "ellipsis":c.append('<span class="ellipsis">&#x2026;</span>');break;case "first":w=l.sFirst;q=t+(0<e?"":" "+m.sPageButtonDisabled);break;case "previous":w=l.sPrevious;q=t+(0<e?"":" "+m.sPageButtonDisabled);break;case "next":w=l.sNext;q=t+(e<p-1?"":" "+m.sPageButtonDisabled);
break;case "last":w=l.sLast;q=t+(e<p-1?"":" "+m.sPageButtonDisabled);break;default:w=t+1,q=e===t?m.sPageButtonActive:""}null!==w&&(E=b("<a>",{"class":m.sPageButton+" "+q,"aria-controls":a.sTableId,"aria-label":n[t],"data-dt-idx":k,tabindex:a.iTabIndex,id:0===d&&"string"===typeof t?a.sTableId+"_"+t:null}).html(w).appendTo(c),$a(E,{action:t},r),k++)}},E;try{E=b(c).find(f.activeElement).data("dt-idx")}catch(Yb){}v(b(c).empty(),g);E!==h&&b(c).find("[data-dt-idx="+E+"]").focus()}}});b.extend(F.ext.type.detect,
[function(a,b){var c=b.oLanguage.sDecimal;return cb(a,c)?"num"+c:null},function(a,b){if(a&&!(a instanceof Date)&&!Nb.test(a))return null;var c=Date.parse(a);return null!==c&&!isNaN(c)||sa(a)?"date":null},function(a,b){var c=b.oLanguage.sDecimal;return cb(a,c,!0)?"num-fmt"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Eb(a,c)?"html-num"+c:null},function(a,b){var c=b.oLanguage.sDecimal;return Eb(a,c,!0)?"html-num-fmt"+c:null},function(a,b){return sa(a)||"string"===typeof a&&-1!==a.indexOf("<")?
"html":null}]);b.extend(F.ext.type.search,{html:function(a){return sa(a)?a:"string"===typeof a?a.replace(Bb," ").replace(Ma,""):""},string:function(a){return sa(a)?a:"string"===typeof a?a.replace(Bb," "):a}});var La=function(a,b,c,d){if(0!==a&&(!a||"-"===a))return-Infinity;b&&(a=Db(a,b));a.replace&&(c&&(a=a.replace(c,"")),d&&(a=a.replace(d,"")));return 1*a};b.extend(da.type.order,{"date-pre":function(a){return Date.parse(a)||-Infinity},"html-pre":function(a){return sa(a)?"":a.replace?a.replace(/<.*?>/g,
"").toLowerCase():a+""},"string-pre":function(a){return sa(a)?"":"string"===typeof a?a.toLowerCase():a.toString?a.toString():""},"string-asc":function(a,b){return a<b?-1:a>b?1:0},"string-desc":function(a,b){return a<b?1:a>b?-1:0}});ib("");b.extend(!0,F.ext.renderer,{header:{_:function(a,c,d,g){b(a.nTable).on("order.dt.DT",function(b,e,f,p){a===e&&(b=d.idx,c.removeClass(d.sSortingClass+" "+g.sSortAsc+" "+g.sSortDesc).addClass("asc"==p[b]?g.sSortAsc:"desc"==p[b]?g.sSortDesc:d.sSortingClass))})},jqueryui:function(a,
c,d,g){b("<div/>").addClass(g.sSortJUIWrapper).append(c.contents()).append(b("<span/>").addClass(g.sSortIcon+" "+d.sSortingClassJUI)).appendTo(c);b(a.nTable).on("order.dt.DT",function(b,e,f,p){a===e&&(b=d.idx,c.removeClass(g.sSortAsc+" "+g.sSortDesc).addClass("asc"==p[b]?g.sSortAsc:"desc"==p[b]?g.sSortDesc:d.sSortingClass),c.find("span."+g.sSortIcon).removeClass(g.sSortJUIAsc+" "+g.sSortJUIDesc+" "+g.sSortJUI+" "+g.sSortJUIAscAllowed+" "+g.sSortJUIDescAllowed).addClass("asc"==p[b]?g.sSortJUIAsc:"desc"==
p[b]?g.sSortJUIDesc:d.sSortingClassJUI))})}}});var Kb=function(a){return"string"===typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):a};F.render={number:function(a,b,c,d,g){return{display:function(e){if("number"!==typeof e&&"string"!==typeof e)return e;var f=0>e?"-":"",p=parseFloat(e);if(isNaN(p))return Kb(e);p=p.toFixed(c);e=Math.abs(p);p=parseInt(e,10);e=c?b+(e-p).toFixed(c).substring(2):"";return f+(d||"")+p.toString().replace(/\B(?=(\d{3})+(?!\d))/g,a)+e+(g||"")}}},text:function(){return{display:Kb}}};
b.extend(F.ext.internal,{_fnExternApiFunc:Ab,_fnBuildAjax:w,_fnAjaxUpdate:E,_fnAjaxParameters:K,_fnAjaxUpdateDraw:ba,_fnAjaxDataSrc:B,_fnAddColumn:l,_fnColumnOptions:u,_fnAdjustColumnSizing:q,_fnVisibleToColumnIndex:t,_fnColumnIndexToVisible:n,_fnVisbleColumns:r,_fnGetColumns:z,_fnColumnTypes:C,_fnApplyColumnDefs:A,_fnHungarianMap:e,_fnCamelToHungarian:a,_fnLanguageCompat:d,_fnBrowserDetect:m,_fnAddData:y,_fnAddTr:J,_fnNodeToDataIndex:function(a,b){return b._DT_RowIndex!==h?b._DT_RowIndex:null},_fnNodeToColumnIndex:function(a,
c,d){return b.inArray(d,a.aoData[c].anCells)},_fnGetCellData:O,_fnSetCellData:G,_fnSplitObjNotation:R,_fnGetObjectDataFn:Q,_fnSetObjectDataFn:H,_fnGetDataMaster:D,_fnClearTable:L,_fnDeleteIndex:S,_fnInvalidate:I,_fnGetRowElements:P,_fnCreateTr:U,_fnBuildHead:V,_fnDrawHead:M,_fnDraw:ca,_fnReDraw:ea,_fnAddOptionsHtml:aa,_fnDetectHeader:ha,_fnGetUniqueThs:p,_fnFeatureHtmlFilter:ja,_fnFilterComplete:ma,_fnFilterCustom:pb,_fnFilterColumn:Sa,_fnFilter:xa,_fnFilterCreateSearch:Ta,_fnEscapeRegex:Ua,_fnFilterData:Ga,
_fnFeatureHtmlInfo:nb,_fnUpdateInfo:qb,_fnInfoMacros:rb,_fnInitialise:za,_fnInitComplete:Fa,_fnLengthChange:Wa,_fnFeatureHtmlLength:kb,_fnFeatureHtmlPaginate:ob,_fnPageChange:Ya,_fnFeatureHtmlProcessing:lb,_fnProcessingDisplay:oa,_fnFeatureHtmlTable:mb,_fnScrollDraw:Da,_fnApplyToChildren:qa,_fnCalculateColumnWidths:Oa,_fnThrottle:Ra,_fnConvertToWidth:sb,_fnGetWidestNode:tb,_fnGetMaxLenString:ub,_fnStringToCss:Z,_fnSortFlatten:ua,_fnSort:jb,_fnSortAria:wb,_fnSortListener:Za,_fnSortAttachListener:Pa,
_fnSortingClasses:Ia,_fnSortData:vb,_fnSaveState:Ja,_fnLoadState:xb,_fnSettingsFromNode:Ka,_fnLog:ra,_fnMap:pa,_fnBindAction:$a,_fnCallbackReg:ka,_fnCallbackFire:X,_fnLengthOverflow:Xa,_fnRenderer:Qa,_fnDataSource:ia,_fnRowAttributes:W,_fnCalculateEnd:function(){}});b.fn.dataTable=F;F.$=b;b.fn.dataTableSettings=F.settings;b.fn.dataTableExt=F.ext;b.fn.DataTable=function(a){return b(this).dataTable(a).api()};b.each(F,function(a,c){b.fn.DataTable[a]=c});return b.fn.dataTable});/*
 jQuery UI - v1.12.1 - 2016-12-12
 http://jqueryui.com
 Includes: widget.js, position.js, disable-selection.js, form-reset-mixin.js, keycode.js, labels.js, unique-id.js, widgets/resizable.js, widgets/accordion.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/menu.js, widgets/mouse.js, widgets/selectmenu.js, widgets/tabs.js, widgets/tooltip.js
 Copyright jQuery Foundation and other contributors; Licensed MIT  jQuery UI Widget 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Position 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license

 http://api.jqueryui.com/position/
 jQuery UI Disable Selection 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Form Reset Mixin 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Keycode 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Labels 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Unique ID 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Mouse 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Resizable 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Accordion 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Controlgroup 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Checkboxradio 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Button 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Menu 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Selectmenu 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Tabs 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 jQuery UI Tooltip 1.12.1
 http://jqueryui.com

 Copyright jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):b(jQuery)})(function(b){b.ui=b.ui||{};b.ui.version="1.12.1";var k=0,f=Array.prototype.slice;b.cleanData=function(a){return function(d){var c,g,e;for(e=0;null!=(g=d[e]);e++)try{(c=b._data(g,"events"))&&c.remove&&b(g).triggerHandler("remove")}catch(v){}a(d)}}(b.cleanData);b.widget=function(a,d,c){var g,e,f,h={},k=a.split(".")[0];a=a.split(".")[1];var q=k+"-"+a;c||(c=d,d=b.Widget);b.isArray(c)&&(c=b.extend.apply(null,[{}].concat(c)));
b.expr[":"][q.toLowerCase()]=function(a){return!!b.data(a,q)};b[k]=b[k]||{};g=b[k][a];e=b[k][a]=function(a,b){if(!this._createWidget)return new e(a,b);arguments.length&&this._createWidget(a,b)};b.extend(e,g,{version:c.version,_proto:b.extend({},c),_childConstructors:[]});f=new d;f.options=b.widget.extend({},f.options);b.each(c,function(a,c){b.isFunction(c)?h[a]=function(){function b(){return d.prototype[a].apply(this,arguments)}function g(b){return d.prototype[a].apply(this,b)}return function(){var a=
this._super,d=this._superApply,e;this._super=b;this._superApply=g;e=c.apply(this,arguments);this._super=a;this._superApply=d;return e}}():h[a]=c});e.prototype=b.widget.extend(f,{widgetEventPrefix:g?f.widgetEventPrefix||a:a},h,{constructor:e,namespace:k,widgetName:a,widgetFullName:q});g?(b.each(g._childConstructors,function(a,c){var d=c.prototype;b.widget(d.namespace+"."+d.widgetName,e,c._proto)}),delete g._childConstructors):d._childConstructors.push(e);b.widget.bridge(a,e);return e};b.widget.extend=
function(a){for(var d=f.call(arguments,1),c=0,g=d.length,e,h;c<g;c++)for(e in d[c])h=d[c][e],d[c].hasOwnProperty(e)&&void 0!==h&&(b.isPlainObject(h)?a[e]=b.isPlainObject(a[e])?b.widget.extend({},a[e],h):b.widget.extend({},h):a[e]=h);return a};b.widget.bridge=function(a,d){var c=d.prototype.widgetFullName||a;b.fn[a]=function(g){var e="string"===typeof g,h=f.call(arguments,1),l=this;e?this.length||"instance"!==g?this.each(function(){var d,e=b.data(this,c);if("instance"===g)return l=e,!1;if(!e)return b.error("cannot call methods on "+
a+" prior to initialization; attempted to call method '"+g+"'");if(!b.isFunction(e[g])||"_"===g.charAt(0))return b.error("no such method '"+g+"' for "+a+" widget instance");d=e[g].apply(e,h);if(d!==e&&void 0!==d)return l=d&&d.jquery?l.pushStack(d.get()):d,!1}):l=void 0:(h.length&&(g=b.widget.extend.apply(null,[g].concat(h))),this.each(function(){var a=b.data(this,c);a?(a.option(g||{}),a._init&&a._init()):b.data(this,c,new d(g,this))}));return l}};b.Widget=function(){};b.Widget._childConstructors=
[];b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(a,d){d=b(d||this.defaultElement||this)[0];this.element=b(d);this.uuid=k++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=b();this.hoverable=b();this.focusable=b();this.classesElementLookup={};d!==this&&(b.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=
b(d.style?d.ownerDocument:d.document||d),this.window=b(this.document[0].defaultView||this.document[0].parentWindow));this.options=b.widget.extend({},this.options,this._getCreateOptions(),a);this._create();this.options.disabled&&this._setOptionDisabled(this.options.disabled);this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:b.noop,_create:b.noop,_init:b.noop,destroy:function(){var a=this;this._destroy();b.each(this.classesElementLookup,
function(b,c){a._removeClass(c,b)});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace)},_destroy:b.noop,widget:function(){return this.element},option:function(a,d){var c=a,g,e,f;if(0===arguments.length)return b.widget.extend({},this.options);if("string"===typeof a)if(c={},g=a.split("."),a=g.shift(),g.length){e=c[a]=b.widget.extend({},this.options[a]);for(f=0;f<g.length-1;f++)e[g[f]]=
e[g[f]]||{},e=e[g[f]];a=g.pop();if(1===arguments.length)return void 0===e[a]?null:e[a];e[a]=d}else{if(1===arguments.length)return void 0===this.options[a]?null:this.options[a];c[a]=d}this._setOptions(c);return this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){"classes"===a&&this._setOptionClasses(b);this.options[a]=b;"disabled"===a&&this._setOptionDisabled(b);return this},_setOptionClasses:function(a){var d,c,g;for(d in a)g=this.classesElementLookup[d],
a[d]!==this.options.classes[d]&&g&&g.length&&(c=b(g.get()),this._removeClass(g,d),c.addClass(this._classes({element:c,keys:d,classes:a,add:!0})))},_setOptionDisabled:function(a){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!a);a&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(a){function d(d,
e){var f,h;for(h=0;h<d.length;h++)f=g.classesElementLookup[d[h]]||b(),f=a.add?b(b.unique(f.get().concat(a.element.get()))):b(f.not(a.element).get()),g.classesElementLookup[d[h]]=f,c.push(d[h]),e&&a.classes[d[h]]&&c.push(a.classes[d[h]])}var c=[],g=this;a=b.extend({element:this.element,classes:this.options.classes||{}},a);this._on(a.element,{remove:"_untrackClassesElement"});a.keys&&d(a.keys.match(/\S+/g)||[],!0);a.extra&&d(a.extra.match(/\S+/g)||[]);return c.join(" ")},_untrackClassesElement:function(a){var d=
this;b.each(d.classesElementLookup,function(c,g){-1!==b.inArray(a.target,g)&&(d.classesElementLookup[c]=b(g.not(a.target).get()))})},_removeClass:function(a,b,c){return this._toggleClass(a,b,c,!1)},_addClass:function(a,b,c){return this._toggleClass(a,b,c,!0)},_toggleClass:function(a,b,c,g){g="boolean"===typeof g?g:c;var d="string"===typeof a||null===a;a={extra:d?b:c,keys:d?a:b,element:d?this.element:a,add:g};a.element.toggleClass(this._classes(a),g);return this},_on:function(a,d,c){var g,e=this;"boolean"!==
typeof a&&(c=d,d=a,a=!1);c?(d=g=b(d),this.bindings=this.bindings.add(d)):(c=d,d=this.element,g=this.widget());b.each(c,function(c,f){function h(){if(a||!0!==e.options.disabled&&!b(this).hasClass("ui-state-disabled"))return("string"===typeof f?e[f]:f).apply(e,arguments)}"string"!==typeof f&&(h.guid=f.guid=f.guid||h.guid||b.guid++);var m=c.match(/^([\w:-]*)\s*(.*)$/),l=m[1]+e.eventNamespace;if(m=m[2])g.on(l,m,h);else d.on(l,h)})},_off:function(a,d){d=(d||"").split(" ").join(this.eventNamespace+" ")+
this.eventNamespace;a.off(d).off(d);this.bindings=b(this.bindings.not(a).get());this.focusable=b(this.focusable.not(a).get());this.hoverable=b(this.hoverable.not(a).get())},_delay:function(a,b){var c=this;return setTimeout(function(){return("string"===typeof a?c[a]:a).apply(c,arguments)},b||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(a){this._addClass(b(a.currentTarget),null,"ui-state-hover")},mouseleave:function(a){this._removeClass(b(a.currentTarget),
null,"ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(a){this._addClass(b(a.currentTarget),null,"ui-state-focus")},focusout:function(a){this._removeClass(b(a.currentTarget),null,"ui-state-focus")}})},_trigger:function(a,d,c){var g,e=this.options[a];c=c||{};d=b.Event(d);d.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();d.target=this.element[0];if(a=d.originalEvent)for(g in a)g in d||(d[g]=a[g]);this.element.trigger(d,
c);return!(b.isFunction(e)&&!1===e.apply(this.element[0],[d].concat(c))||d.isDefaultPrevented())}};b.each({show:"fadeIn",hide:"fadeOut"},function(a,d){b.Widget.prototype["_"+a]=function(c,g,e){"string"===typeof g&&(g={effect:g});var f,h=g?!0===g||"number"===typeof g?d:g.effect||d:a;g=g||{};"number"===typeof g&&(g={duration:g});f=!b.isEmptyObject(g);g.complete=e;g.delay&&c.delay(g.delay);if(f&&b.effects&&b.effects.effect[h])c[a](g);else if(h!==a&&c[h])c[h](g.duration,g.easing,e);else c.queue(function(d){b(this)[a]();
e&&e.call(c[0]);d()})}});(function(){function a(a,b,c){return[parseFloat(a[0])*(t.test(a[0])?b/100:1),parseFloat(a[1])*(t.test(a[1])?c/100:1)]}function d(a){var c=a[0];return 9===c.nodeType?{width:a.width(),height:a.height(),offset:{top:0,left:0}}:b.isWindow(c)?{width:a.width(),height:a.height(),offset:{top:a.scrollTop(),left:a.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:a.outerWidth(),height:a.outerHeight(),offset:a.offset()}}var c,g=Math.max,e=Math.abs,
f=/left|center|right/,h=/top|center|bottom/,k=/[\+\-]\d+(\.[\d]+)?%?/,q=/^\w+/,t=/%$/,n=b.fn.position;b.position={scrollbarWidth:function(){if(void 0!==c)return c;var a,d,g=b("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>");d=g.children()[0];b("body").append(g);a=d.offsetWidth;g.css("overflow","scroll");d=d.offsetWidth;a===d&&(d=g[0].clientWidth);g.remove();return c=a-d},getScrollInfo:function(a){var c=a.isWindow||
a.isDocument?"":a.element.css("overflow-x"),d=a.isWindow||a.isDocument?"":a.element.css("overflow-y"),c="scroll"===c||"auto"===c&&a.width<a.element[0].scrollWidth;return{width:"scroll"===d||"auto"===d&&a.height<a.element[0].scrollHeight?b.position.scrollbarWidth():0,height:c?b.position.scrollbarWidth():0}},getWithinInfo:function(a){var c=b(a||window),d=b.isWindow(c[0]),g=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:g,offset:d||g?{left:0,top:0}:b(a).offset(),scrollLeft:c.scrollLeft(),
scrollTop:c.scrollTop(),width:c.outerWidth(),height:c.outerHeight()}}};b.fn.position=function(c){if(!c||!c.of)return n.apply(this,arguments);c=b.extend({},c);var m,l,v,t,r,u,G=b(c.of),R=b.position.getWithinInfo(c.within),Q=b.position.getScrollInfo(R),H=(c.collision||"flip").split(" "),D={};u=d(G);G[0].preventDefault&&(c.at="left top");l=u.width;v=u.height;t=u.offset;r=b.extend({},t);b.each(["my","at"],function(){var a=(c[this]||"").split(" "),b,d;1===a.length&&(a=f.test(a[0])?a.concat(["center"]):
h.test(a[0])?["center"].concat(a):["center","center"]);a[0]=f.test(a[0])?a[0]:"center";a[1]=h.test(a[1])?a[1]:"center";b=k.exec(a[0]);d=k.exec(a[1]);D[this]=[b?b[0]:0,d?d[0]:0];c[this]=[q.exec(a[0])[0],q.exec(a[1])[0]]});1===H.length&&(H[1]=H[0]);"right"===c.at[0]?r.left+=l:"center"===c.at[0]&&(r.left+=l/2);"bottom"===c.at[1]?r.top+=v:"center"===c.at[1]&&(r.top+=v/2);m=a(D.at,l,v);r.left+=m[0];r.top+=m[1];return this.each(function(){var d,f,h=b(this),n=h.outerWidth(),k=h.outerHeight(),q=parseInt(b.css(this,
"marginLeft"),10)||0,u=parseInt(b.css(this,"marginTop"),10)||0,z=n+q+(parseInt(b.css(this,"marginRight"),10)||0)+Q.width,y=k+u+(parseInt(b.css(this,"marginBottom"),10)||0)+Q.height,A=b.extend({},r),C=a(D.my,h.outerWidth(),h.outerHeight());"right"===c.my[0]?A.left-=n:"center"===c.my[0]&&(A.left-=n/2);"bottom"===c.my[1]?A.top-=k:"center"===c.my[1]&&(A.top-=k/2);A.left+=C[0];A.top+=C[1];d={marginLeft:q,marginTop:u};b.each(["left","top"],function(a,g){if(b.ui.position[H[a]])b.ui.position[H[a]][g](A,{targetWidth:l,
targetHeight:v,elemWidth:n,elemHeight:k,collisionPosition:d,collisionWidth:z,collisionHeight:y,offset:[m[0]+C[0],m[1]+C[1]],my:c.my,at:c.at,within:R,elem:h})});c.using&&(f=function(a){var b=t.left-A.left,d=b+l-n,f=t.top-A.top,m=f+v-k,q={target:{element:G,left:t.left,top:t.top,width:l,height:v},element:{element:h,left:A.left,top:A.top,width:n,height:k},horizontal:0>d?"left":0<b?"right":"center",vertical:0>m?"top":0<f?"bottom":"middle"};l<n&&e(b+d)<l&&(q.horizontal="center");v<k&&e(f+m)<v&&(q.vertical=
"middle");g(e(b),e(d))>g(e(f),e(m))?q.important="horizontal":q.important="vertical";c.using.call(this,a,q)});h.offset(b.extend(A,{using:f}))})};b.ui.position={fit:{left:function(a,b){var c=b.within,d=c.isWindow?c.scrollLeft:c.offset.left,e=c.width,f=a.left-b.collisionPosition.marginLeft,c=d-f,h=f+b.collisionWidth-e-d;b.collisionWidth>e?0<c&&0>=h?(d=a.left+c+b.collisionWidth-e-d,a.left+=c-d):a.left=0<h&&0>=c?d:c>h?d+e-b.collisionWidth:d:a.left=0<c?a.left+c:0<h?a.left-h:g(a.left-f,a.left)},top:function(a,
b){var c=b.within,d=c.isWindow?c.scrollTop:c.offset.top,e=b.within.height,f=a.top-b.collisionPosition.marginTop,c=d-f,h=f+b.collisionHeight-e-d;b.collisionHeight>e?0<c&&0>=h?(d=a.top+c+b.collisionHeight-e-d,a.top+=c-d):a.top=0<h&&0>=c?d:c>h?d+e-b.collisionHeight:d:a.top=0<c?a.top+c:0<h?a.top-h:g(a.top-f,a.top)}},flip:{left:function(a,b){var c=b.within,d=c.offset.left+c.scrollLeft,g=c.width,f=c.isWindow?c.scrollLeft:c.offset.left,h=a.left-b.collisionPosition.marginLeft,c=h-f,m=h+b.collisionWidth-g-
f,h="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,l="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,n=-2*b.offset[0];if(0>c){if(d=a.left+h+l+n+b.collisionWidth-g-d,0>d||d<e(c))a.left+=h+l+n}else 0<m&&(d=a.left-b.collisionPosition.marginLeft+h+l+n-f,0<d||e(d)<m)&&(a.left+=h+l+n)},top:function(a,b){var c=b.within,d=c.offset.top+c.scrollTop,g=c.height,f=c.isWindow?c.scrollTop:c.offset.top,h=a.top-b.collisionPosition.marginTop,c=h-f,m=h+b.collisionHeight-g-f,h="top"===
b.my[1]?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,l="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,n=-2*b.offset[1];if(0>c){if(d=a.top+h+l+n+b.collisionHeight-g-d,0>d||d<e(c))a.top+=h+l+n}else 0<m&&(d=a.top-b.collisionPosition.marginTop+h+l+n-f,0<d||e(d)<m)&&(a.top+=h+l+n)}},flipfit:{left:function(){b.ui.position.flip.left.apply(this,arguments);b.ui.position.fit.left.apply(this,arguments)},top:function(){b.ui.position.flip.top.apply(this,arguments);b.ui.position.fit.top.apply(this,
arguments)}}}})();b.fn.extend({disableSelection:function(){var a="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(a+".ui-disableSelection",function(a){a.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});b.fn.form=function(){return"string"===typeof this[0].form?this.closest("form"):b(this[0].form)};b.ui.formResetMixin={_formResetHandler:function(){var a=b(this);setTimeout(function(){var d=a.data("ui-form-reset-instances");
b.each(d,function(){this.refresh()})})},_bindFormResetHandler:function(){this.form=this.element.form();if(this.form.length){var a=this.form.data("ui-form-reset-instances")||[];if(!a.length)this.form.on("reset.ui-form-reset",this._formResetHandler);a.push(this);this.form.data("ui-form-reset-instances",a)}},_unbindFormResetHandler:function(){if(this.form.length){var a=this.form.data("ui-form-reset-instances");a.splice(b.inArray(this,a),1);a.length?this.form.data("ui-form-reset-instances",a):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}};
b.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};b.ui.escapeSelector=function(){var a=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(b){return b.replace(a,"\\$1")}}();b.fn.labels=function(){var a,d,c;if(this[0].labels&&this[0].labels.length)return this.pushStack(this[0].labels);c=this.eq(0).parents("label");if(d=this.attr("id"))a=this.eq(0).parents().last(),a=a.add(a.length?a.siblings():
this.siblings()),d="label[for='"+b.ui.escapeSelector(d)+"']",c=c.add(a.find(d).addBack(d));return this.pushStack(c)};b.fn.extend({uniqueId:function(){var a=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++a)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&b(this).removeAttr("id")})}});b.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var h=!1;b(document).on("mouseup",function(){h=!1});b.widget("ui.mouse",{version:"1.12.1",
options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.on("mousedown."+this.widgetName,function(b){return a._mouseDown(b)}).on("click."+this.widgetName,function(d){if(!0===b.data(d.target,a.widgetName+".preventClickEvent"))return b.removeData(d.target,a.widgetName+".preventClickEvent"),d.stopImmediatePropagation(),!1});this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName);this._mouseMoveDelegate&&this.document.off("mousemove."+
this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(a){if(!h){this._mouseMoved=!1;this._mouseStarted&&this._mouseUp(a);this._mouseDownEvent=a;var d=this,c=1===a.which,g="string"===typeof this.options.cancel&&a.target.nodeName?b(a.target).closest(this.options.cancel).length:!1;if(!c||g||!this._mouseCapture(a))return!0;this.mouseDelayMet=!this.options.delay;this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=
!0},this.options.delay));if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=!1!==this._mouseStart(a),!this._mouseStarted))return a.preventDefault(),!0;!0===b.data(a.target,this.widgetName+".preventClickEvent")&&b.removeData(a.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(a){return d._mouseMove(a)};this._mouseUpDelegate=function(a){return d._mouseUp(a)};this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,
this._mouseUpDelegate);a.preventDefault();return h=!0}},_mouseMove:function(a){if(this._mouseMoved){if(b.ui.ie&&(!document.documentMode||9>document.documentMode)&&!a.button)return this._mouseUp(a);if(!a.which)if(a.originalEvent.altKey||a.originalEvent.ctrlKey||a.originalEvent.metaKey||a.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(a)}if(a.which||a.button)this._mouseMoved=!0;if(this._mouseStarted)return this._mouseDrag(a),a.preventDefault();
this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&((this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,a))?this._mouseDrag(a):this._mouseUp(a));return!this._mouseStarted},_mouseUp:function(a){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);this._mouseStarted&&(this._mouseStarted=!1,a.target===this._mouseDownEvent.target&&b.data(a.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(a));this._mouseDelayTimer&&
(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer);h=this.ignoreMissingWhich=!1;a.preventDefault()},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}});b.ui.plugin={add:function(a,d,c){var g;a=b.ui[a].prototype;for(g in c)a.plugins[g]=
a.plugins[g]||[],a.plugins[g].push([d,c[g]])},call:function(a,b,c,g){if((b=a.plugins[b])&&(g||a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType))for(g=0;g<b.length;g++)a.options[b[g][0]]&&b[g][1].apply(a.element,c)}};b.widget("ui.resizable",b.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,
grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(a){return parseFloat(a)||0},_isNumber:function(a){return!isNaN(parseFloat(a))},_hasScroll:function(a,d){if("hidden"===b(a).css("overflow"))return!1;var c=d&&"left"===d?"scrollLeft":"scrollTop",g;if(0<a[c])return!0;a[c]=1;g=0<a[c];a[c]=0;return g},_create:function(){var a,d=this.options,c=this;this._addClass("ui-resizable");b.extend(this,{_aspectRatio:!!d.aspectRatio,
aspectRatio:d.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:d.helper||d.ghost||d.animate?d.helper||"ui-resizable-helper":null});this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(b("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=
this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,a={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(a),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",
zoom:1,display:"block"})),this.originalElement.css(a),this._proportionallyResize());this._setupHandles();if(d.autoHide)b(this.element).on("mouseenter",function(){d.disabled||(c._removeClass("ui-resizable-autohide"),c._handles.show())}).on("mouseleave",function(){d.disabled||c.resizing||(c._addClass("ui-resizable-autohide"),c._handles.hide())});this._mouseInit()},_destroy:function(){this._mouseDestroy();var a,d=function(a){b(a).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};
this.elementIsWrapper&&(d(this.element),a=this.element,this.originalElement.css({position:a.css("position"),width:a.outerWidth(),height:a.outerHeight(),top:a.css("top"),left:a.css("left")}).insertAfter(a),a.remove());this.originalElement.css("resize",this.originalResizeStyle);d(this.originalElement);return this},_setOption:function(a,b){this._super(a,b);switch(a){case "handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var a=this.options,d,c,g,e,f,h=this;this.handles=a.handles||
(b(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");this._handles=b();if(this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),g=this.handles.split(","),this.handles={},c=0;c<g.length;c++)d=b.trim(g[c]),e="ui-resizable-"+d,f=b("<div>"),this._addClass(f,"ui-resizable-handle "+e),f.css({zIndex:a.zIndex}),
this.handles[d]=".ui-resizable-"+d,this.element.append(f);this._renderAxis=function(a){var c,d,g;a=a||this.element;for(c in this.handles){if(this.handles[c].constructor===String)this.handles[c]=this.element.children(this.handles[c]).first().show();else if(this.handles[c].jquery||this.handles[c].nodeType)this.handles[c]=b(this.handles[c]),this._on(this.handles[c],{mousedown:h._mouseDown});this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(d=b(this.handles[c],
this.element),g=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),d=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),a.css(d,g),this._proportionallyResize());this._handles=this._handles.add(this.handles[c])}};this._renderAxis(this.element);this._handles=this._handles.add(this.element.find(".ui-resizable-handle"));this._handles.disableSelection();this._handles.on("mouseover",function(){h.resizing||(this.className&&(f=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),
h.axis=f&&f[1]?f[1]:"se")});a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(a){var d,c,g=!1;for(d in this.handles)if(c=b(this.handles[d])[0],c===a.target||b.contains(c,a.target))g=!0;return!this.options.disabled&&g},_mouseStart:function(a){var d,c,g=this.options,e=this.element;this.resizing=!0;this._renderProxy();d=this._num(this.helper.css("left"));c=this._num(this.helper.css("top"));g.containment&&
(d+=b(g.containment).scrollLeft()||0,c+=b(g.containment).scrollTop()||0);this.offset=this.helper.offset();this.position={left:d,top:c};this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:e.width(),height:e.height()};this.originalSize=this._helper?{width:e.outerWidth(),height:e.outerHeight()}:{width:e.width(),height:e.height()};this.sizeDiff={width:e.outerWidth()-e.width(),height:e.outerHeight()-e.height()};this.originalPosition={left:d,top:c};this.originalMousePosition=
{left:a.pageX,top:a.pageY};this.aspectRatio="number"===typeof g.aspectRatio?g.aspectRatio:this.originalSize.width/this.originalSize.height||1;d=b(".ui-resizable-"+this.axis).css("cursor");b("body").css("cursor","auto"===d?this.axis+"-resize":d);this._addClass("ui-resizable-resizing");this._propagate("start",a);return!0},_mouseDrag:function(a){var d,c=this.originalMousePosition;d=a.pageX-c.left||0;var c=a.pageY-c.top||0,g=this._change[this.axis];this._updatePrevProperties();if(!g)return!1;d=g.apply(this,
[a,d,c]);this._updateVirtualBoundaries(a.shiftKey);if(this._aspectRatio||a.shiftKey)d=this._updateRatio(d,a);d=this._respectSize(d,a);this._updateCache(d);this._propagate("resize",a);d=this._applyChanges();!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();b.isEmptyObject(d)||(this._updatePrevProperties(),this._trigger("resize",a,this.ui()),this._applyChanges());return!1},_mouseStop:function(a){this.resizing=!1;var d,c,g,e=this.options;this._helper&&(d=this._proportionallyResizeElements,
d=(c=d.length&&/textarea/i.test(d[0].nodeName))&&this._hasScroll(d[0],"left")?0:this.sizeDiff.height,c=c?0:this.sizeDiff.width,c={width:this.helper.width()-c,height:this.helper.height()-d},d=parseFloat(this.element.css("left"))+(this.position.left-this.originalPosition.left)||null,g=parseFloat(this.element.css("top"))+(this.position.top-this.originalPosition.top)||null,e.animate||this.element.css(b.extend(c,{top:g,left:d})),this.helper.height(this.size.height),this.helper.width(this.size.width),this._helper&&
!e.animate&&this._proportionallyResize());b("body").css("cursor","auto");this._removeClass("ui-resizable-resizing");this._propagate("stop",a);this._helper&&this.helper.remove();return!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var a={};this.position.top!==this.prevPosition.top&&(a.top=this.position.top+"px");this.position.left!==this.prevPosition.left&&
(a.left=this.position.left+"px");this.size.width!==this.prevSize.width&&(a.width=this.size.width+"px");this.size.height!==this.prevSize.height&&(a.height=this.size.height+"px");this.helper.css(a);return a},_updateVirtualBoundaries:function(a){var b,c,g,e;e=this.options;e={minWidth:this._isNumber(e.minWidth)?e.minWidth:0,maxWidth:this._isNumber(e.maxWidth)?e.maxWidth:Infinity,minHeight:this._isNumber(e.minHeight)?e.minHeight:0,maxHeight:this._isNumber(e.maxHeight)?e.maxHeight:Infinity};if(this._aspectRatio||
a)a=e.minHeight*this.aspectRatio,c=e.minWidth/this.aspectRatio,b=e.maxHeight*this.aspectRatio,g=e.maxWidth/this.aspectRatio,a>e.minWidth&&(e.minWidth=a),c>e.minHeight&&(e.minHeight=c),b<e.maxWidth&&(e.maxWidth=b),g<e.maxHeight&&(e.maxHeight=g);this._vBoundaries=e},_updateCache:function(a){this.offset=this.helper.offset();this._isNumber(a.left)&&(this.position.left=a.left);this._isNumber(a.top)&&(this.position.top=a.top);this._isNumber(a.height)&&(this.size.height=a.height);this._isNumber(a.width)&&
(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,c=this.size,g=this.axis;this._isNumber(a.height)?a.width=a.height*this.aspectRatio:this._isNumber(a.width)&&(a.height=a.width/this.aspectRatio);"sw"===g&&(a.left=b.left+(c.width-a.width),a.top=null);"nw"===g&&(a.top=b.top+(c.height-a.height),a.left=b.left+(c.width-a.width));return a},_respectSize:function(a){var b=this._vBoundaries,c=this.axis,g=this._isNumber(a.width)&&b.maxWidth&&b.maxWidth<a.width,e=this._isNumber(a.height)&&
b.maxHeight&&b.maxHeight<a.height,f=this._isNumber(a.width)&&b.minWidth&&b.minWidth>a.width,h=this._isNumber(a.height)&&b.minHeight&&b.minHeight>a.height,k=this.originalPosition.left+this.originalSize.width,q=this.originalPosition.top+this.originalSize.height,t=/sw|nw|w/.test(c),c=/nw|ne|n/.test(c);f&&(a.width=b.minWidth);h&&(a.height=b.minHeight);g&&(a.width=b.maxWidth);e&&(a.height=b.maxHeight);f&&t&&(a.left=k-b.minWidth);g&&t&&(a.left=k-b.maxWidth);h&&c&&(a.top=q-b.minHeight);e&&c&&(a.top=q-b.maxHeight);
a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null;return a},_getPaddingPlusBorderDimensions:function(a){var b=0,c=[],g=[a.css("borderTopWidth"),a.css("borderRightWidth"),a.css("borderBottomWidth"),a.css("borderLeftWidth")];for(a=[a.css("paddingTop"),a.css("paddingRight"),a.css("paddingBottom"),a.css("paddingLeft")];4>b;b++)c[b]=parseFloat(g[b])||0,c[b]+=parseFloat(a[b])||0;return{height:c[0]+c[2],width:c[1]+c[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var a,
b=0,c=this.helper||this.element;b<this._proportionallyResizeElements.length;b++)a=this._proportionallyResizeElements[b],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(a)),a.css({height:c.height()-this.outerDimensions.height||0,width:c.width()-this.outerDimensions.width||0})},_renderProxy:function(){var a=this.options;this.elementOffset=this.element.offset();this._helper?(this.helper=this.helper||b("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,
this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++a.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){return{left:this.originalPosition.left+b,width:this.originalSize.width-b}},n:function(a,b,c){return{top:this.originalPosition.top+c,height:this.originalSize.height-
c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(a,d,c){return b.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[a,d,c]))},sw:function(a,d,c){return b.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[a,d,c]))},ne:function(a,d,c){return b.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[a,d,c]))},nw:function(a,d,c){return b.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[a,d,c]))}},
_propagate:function(a,d){b.ui.plugin.call(this,a,[d,this.ui()]);"resize"!==a&&this._trigger(a,d,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});b.ui.plugin.add("resizable","animate",{stop:function(a){var d=b(this).resizable("instance"),c=d.options,g=d._proportionallyResizeElements,e=g.length&&/textarea/i.test(g[0].nodeName),
f=e&&d._hasScroll(g[0],"left")?0:d.sizeDiff.height,e={width:d.size.width-(e?0:d.sizeDiff.width),height:d.size.height-f},f=parseFloat(d.element.css("left"))+(d.position.left-d.originalPosition.left)||null,h=parseFloat(d.element.css("top"))+(d.position.top-d.originalPosition.top)||null;d.element.animate(b.extend(e,h&&f?{top:h,left:f}:{}),{duration:c.animateDuration,easing:c.animateEasing,step:function(){var c={width:parseFloat(d.element.css("width")),height:parseFloat(d.element.css("height")),top:parseFloat(d.element.css("top")),
left:parseFloat(d.element.css("left"))};g&&g.length&&b(g[0]).css({width:c.width,height:c.height});d._updateCache(c);d._propagate("resize",a)}})}});b.ui.plugin.add("resizable","containment",{start:function(){var a,d,c,g,e,f=b(this).resizable("instance"),h=f.element;c=f.options.containment;if(h=c instanceof b?c.get(0):/parent/.test(c)?h.parent().get(0):c)f.containerElement=b(h),/document/.test(c)||c===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:b(document),
left:0,top:0,width:b(document).width(),height:b(document).height()||document.body.parentNode.scrollHeight}):(a=b(h),d=[],b(["Top","Right","Left","Bottom"]).each(function(b,c){d[b]=f._num(a.css("padding"+c))}),f.containerOffset=a.offset(),f.containerPosition=a.position(),f.containerSize={height:a.innerHeight()-d[3],width:a.innerWidth()-d[1]},c=f.containerOffset,g=f.containerSize.height,e=f.containerSize.width,e=f._hasScroll(h,"left")?h.scrollWidth:e,g=f._hasScroll(h)?h.scrollHeight:g,f.parentData=
{element:h,left:c.left,top:c.top,width:e,height:g})},resize:function(a){var d,c,g,e=b(this).resizable("instance");d=e.options;c=e.containerOffset;g=e.position;a=e._aspectRatio||a.shiftKey;var f={top:0,left:0},h=e.containerElement,k=!0;h[0]!==document&&/static/.test(h.css("position"))&&(f=c);g.left<(e._helper?c.left:0)&&(e.size.width+=e._helper?e.position.left-c.left:e.position.left-f.left,a&&(e.size.height=e.size.width/e.aspectRatio,k=!1),e.position.left=d.helper?c.left:0);g.top<(e._helper?c.top:
0)&&(e.size.height+=e._helper?e.position.top-c.top:e.position.top,a&&(e.size.width=e.size.height*e.aspectRatio,k=!1),e.position.top=e._helper?c.top:0);d=e.containerElement.get(0)===e.element.parent().get(0);g=/relative|absolute/.test(e.containerElement.css("position"));d&&g?(e.offset.left=e.parentData.left+e.position.left,e.offset.top=e.parentData.top+e.position.top):(e.offset.left=e.element.offset().left,e.offset.top=e.element.offset().top);d=Math.abs(e.sizeDiff.width+(e._helper?e.offset.left-f.left:
e.offset.left-c.left));c=Math.abs(e.sizeDiff.height+(e._helper?e.offset.top-f.top:e.offset.top-c.top));d+e.size.width>=e.parentData.width&&(e.size.width=e.parentData.width-d,a&&(e.size.height=e.size.width/e.aspectRatio,k=!1));c+e.size.height>=e.parentData.height&&(e.size.height=e.parentData.height-c,a&&(e.size.width=e.size.height*e.aspectRatio,k=!1));k||(e.position.left=e.prevPosition.left,e.position.top=e.prevPosition.top,e.size.width=e.prevSize.width,e.size.height=e.prevSize.height)},stop:function(){var a=
b(this).resizable("instance"),d=a.options,c=a.containerOffset,e=a.containerPosition,f=a.containerElement,h=b(a.helper),l=h.offset(),k=h.outerWidth()-a.sizeDiff.width,h=h.outerHeight()-a.sizeDiff.height;a._helper&&!d.animate&&/relative/.test(f.css("position"))&&b(this).css({left:l.left-e.left-c.left,width:k,height:h});a._helper&&!d.animate&&/static/.test(f.css("position"))&&b(this).css({left:l.left-e.left-c.left,width:k,height:h})}});b.ui.plugin.add("resizable","alsoResize",{start:function(){var a=
b(this).resizable("instance").options;b(a.alsoResize).each(function(){var a=b(this);a.data("ui-resizable-alsoresize",{width:parseFloat(a.width()),height:parseFloat(a.height()),left:parseFloat(a.css("left")),top:parseFloat(a.css("top"))})})},resize:function(a,d){var c=b(this).resizable("instance"),e=c.originalSize,f=c.originalPosition,h={height:c.size.height-e.height||0,width:c.size.width-e.width||0,top:c.position.top-f.top||0,left:c.position.left-f.left||0};b(c.options.alsoResize).each(function(){var a=
b(this),c=b(this).data("ui-resizable-alsoresize"),e={},g=a.parents(d.originalElement[0]).length?["width","height"]:["width","height","top","left"];b.each(g,function(a,b){var d=(c[b]||0)+(h[b]||0);d&&0<=d&&(e[b]=d||null)});a.css(e)})},stop:function(){b(this).removeData("ui-resizable-alsoresize")}});b.ui.plugin.add("resizable","ghost",{start:function(){var a=b(this).resizable("instance"),d=a.size;a.ghost=a.originalElement.clone();a.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,
width:d.width,margin:0,left:0,top:0});a._addClass(a.ghost,"ui-resizable-ghost");!1!==b.uiBackCompat&&"string"===typeof a.options.ghost&&a.ghost.addClass(this.options.ghost);a.ghost.appendTo(a.helper)},resize:function(){var a=b(this).resizable("instance");a.ghost&&a.ghost.css({position:"relative",height:a.size.height,width:a.size.width})},stop:function(){var a=b(this).resizable("instance");a.ghost&&a.helper&&a.helper.get(0).removeChild(a.ghost.get(0))}});b.ui.plugin.add("resizable","grid",{resize:function(){var a,
d=b(this).resizable("instance"),c=d.options,e=d.size,f=d.originalSize,h=d.originalPosition,l=d.axis,k="number"===typeof c.grid?[c.grid,c.grid]:c.grid,q=k[0]||1,t=k[1]||1,n=Math.round((e.width-f.width)/q)*q,e=Math.round((e.height-f.height)/t)*t,r=f.width+n,z=f.height+e,C=c.maxWidth&&c.maxWidth<r,A=c.maxHeight&&c.maxHeight<z,y=c.minWidth&&c.minWidth>r,J=c.minHeight&&c.minHeight>z;c.grid=k;y&&(r+=q);J&&(z+=t);C&&(r-=q);A&&(z-=t);if(/^(se|s|e)$/.test(l))d.size.width=r,d.size.height=z;else if(/^(ne)$/.test(l))d.size.width=
r,d.size.height=z,d.position.top=h.top-e;else if(/^(sw)$/.test(l))d.size.width=r,d.size.height=z,d.position.left=h.left-n;else{if(0>=z-t||0>=r-q)a=d._getPaddingPlusBorderDimensions(this);0<z-t?(d.size.height=z,d.position.top=h.top-e):(z=t-a.height,d.size.height=z,d.position.top=h.top+f.height-z);0<r-q?(d.size.width=r,d.position.left=h.left-n):(r=q-a.width,d.size.width=r,d.position.left=h.left+f.width-r)}}});b.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top",
"ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",
height:"show"},_create:function(){var a=this.options;this.prevShow=this.prevHide=b();this._addClass("ui-accordion","ui-widget ui-helper-reset");this.element.attr("role","tablist");a.collapsible||!1!==a.active&&null!=a.active||(a.active=0);this._processPanels();0>a.active&&(a.active+=this.headers.length);this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():b()}},_createIcons:function(){var a,d=this.options.icons;d&&(a=b("<span>"),this._addClass(a,
"ui-accordion-header-icon","ui-icon "+d.header),a.prependTo(this.headers),a=this.active.children(".ui-accordion-header-icon"),this._removeClass(a,d.header)._addClass(a,null,d.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons");this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var a;this.element.removeAttr("role");this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId();
this._destroyIcons();a=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId();"content"!==this.options.heightStyle&&a.css("height","")},_setOption:function(a,b){"active"===a?this._activate(b):("event"===a&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(b)),this._super(a,b),"collapsible"!==a||b||!1!==this.options.active||this._activate(0),"icons"===a&&(this._destroyIcons(),b&&this._createIcons()))},_setOptionDisabled:function(a){this._super(a);
this.element.attr("aria-disabled",a);this._toggleClass(null,"ui-state-disabled",!!a);this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!a)},_keydown:function(a){if(!a.altKey&&!a.ctrlKey){var d=b.ui.keyCode,c=this.headers.length,e=this.headers.index(a.target),f=!1;switch(a.keyCode){case d.RIGHT:case d.DOWN:f=this.headers[(e+1)%c];break;case d.LEFT:case d.UP:f=this.headers[(e-1+c)%c];break;case d.SPACE:case d.ENTER:this._eventHandler(a);break;case d.HOME:f=this.headers[0];
break;case d.END:f=this.headers[c-1]}f&&(b(a.target).attr("tabIndex",-1),b(f).attr("tabIndex",0),b(f).trigger("focus"),a.preventDefault())}},_panelKeyDown:function(a){a.keyCode===b.ui.keyCode.UP&&a.ctrlKey&&b(a.currentTarget).prev().trigger("focus")},refresh:function(){var a=this.options;this._processPanels();!1===a.active&&!0===a.collapsible||!this.headers.length?(a.active=!1,this.active=b()):!1===a.active?this._activate(0):this.active.length&&!b.contains(this.element[0],this.active[0])?this.headers.length===
this.headers.find(".ui-state-disabled").length?(a.active=!1,this.active=b()):this._activate(Math.max(0,a.active-1)):a.active=this.headers.index(this.active);this._destroyIcons();this._refresh()},_processPanels:function(){var a=this.headers,b=this.panels;this.headers=this.element.find(this.options.header);this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default");this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide();this._addClass(this.panels,
"ui-accordion-content","ui-helper-reset ui-widget-content");b&&(this._off(a.not(this.headers)),this._off(b.not(this.panels)))},_refresh:function(){var a,d=this.options,c=d.heightStyle,e=this.element.parent();this.active=this._findActive(d.active);this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed");this._addClass(this.active.next(),"ui-accordion-content-active");this.active.next().show();this.headers.attr("role","tab").each(function(){var a=
b(this),c=a.uniqueId().attr("id"),d=a.next(),e=d.uniqueId().attr("id");a.attr("aria-controls",e);d.attr("aria-labelledby",c)}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide();this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0);this._createIcons();this._setupEvents(d.event);
"fill"===c?(a=e.height(),this.element.siblings(":visible").each(function(){var c=b(this),d=c.css("position");"absolute"!==d&&"fixed"!==d&&(a-=c.outerHeight(!0))}),this.headers.each(function(){a-=b(this).outerHeight(!0)}),this.headers.next().each(function(){b(this).height(Math.max(0,a-b(this).innerHeight()+b(this).height()))}).css("overflow","auto")):"auto"===c&&(a=0,this.headers.next().each(function(){var c=b(this).is(":visible");c||b(this).show();a=Math.max(a,b(this).css("height","").height());c||
b(this).hide()}).height(a))},_activate:function(a){a=this._findActive(a)[0];a!==this.active[0]&&(a=a||this.active[0],this._eventHandler({target:a,currentTarget:a,preventDefault:b.noop}))},_findActive:function(a){return"number"===typeof a?this.headers.eq(a):b()},_setupEvents:function(a){var d={keydown:"_keydown"};a&&b.each(a.split(" "),function(a,b){d[b]="_eventHandler"});this._off(this.headers.add(this.headers.next()));this._on(this.headers,d);this._on(this.headers.next(),{keydown:"_panelKeyDown"});
this._hoverable(this.headers);this._focusable(this.headers)},_eventHandler:function(a){var d,c=this.options,e=this.active,f=b(a.currentTarget),h=(d=f[0]===e[0])&&c.collapsible,l=h?b():f.next(),k=e.next(),l={oldHeader:e,oldPanel:k,newHeader:h?b():f,newPanel:l};a.preventDefault();d&&!c.collapsible||!1===this._trigger("beforeActivate",a,l)||(c.active=h?!1:this.headers.index(f),this.active=d?b():f,this._toggle(l),this._removeClass(e,"ui-accordion-header-active","ui-state-active"),c.icons&&(a=e.children(".ui-accordion-header-icon"),
this._removeClass(a,null,c.icons.activeHeader)._addClass(a,null,c.icons.header)),d||(this._removeClass(f,"ui-accordion-header-collapsed")._addClass(f,"ui-accordion-header-active","ui-state-active"),c.icons&&(d=f.children(".ui-accordion-header-icon"),this._removeClass(d,null,c.icons.header)._addClass(d,null,c.icons.activeHeader)),this._addClass(f.next(),"ui-accordion-content-active")))},_toggle:function(a){var d=a.newPanel,c=this.prevShow.length?this.prevShow:a.oldPanel;this.prevShow.add(this.prevHide).stop(!0,
!0);this.prevShow=d;this.prevHide=c;this.options.animate?this._animate(d,c,a):(c.hide(),d.show(),this._toggleComplete(a));c.attr({"aria-hidden":"true"});c.prev().attr({"aria-selected":"false","aria-expanded":"false"});d.length&&c.length?c.prev().attr({tabIndex:-1,"aria-expanded":"false"}):d.length&&this.headers.filter(function(){return 0===parseInt(b(this).attr("tabIndex"),10)}).attr("tabIndex",-1);d.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},
_animate:function(a,b,c){var d,e,f,h=this,k=0,q=a.css("box-sizing"),t=a.length&&(!b.length||a.index()<b.index()),n=this.options.animate||{},t=t&&n.down||n,r=function(){h._toggleComplete(c)};"number"===typeof t&&(f=t);"string"===typeof t&&(e=t);e=e||t.easing||n.easing;f=f||t.duration||n.duration;if(!b.length)return a.animate(this.showProps,f,e,r);if(!a.length)return b.animate(this.hideProps,f,e,r);d=a.show().outerHeight();b.animate(this.hideProps,{duration:f,easing:e,step:function(a,b){b.now=Math.round(a)}});
a.hide().animate(this.showProps,{duration:f,easing:e,complete:r,step:function(a,c){c.now=Math.round(a);"height"!==c.prop?"content-box"===q&&(k+=c.now):"content"!==h.options.heightStyle&&(c.now=Math.round(d-b.outerHeight()-k),k=0)}})},_toggleComplete:function(a){var b=a.oldPanel,c=b.prev();this._removeClass(b,"ui-accordion-content-active");this._removeClass(c,"ui-accordion-header-active")._addClass(c,"ui-accordion-header-collapsed");b.length&&(b.parent()[0].className=b.parent()[0].className);this._trigger("activate",
null,a)}});var e=/ui-corner-([a-z]){2,6}/g;b.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar");
this.refresh()},_destroy:function(){this._callChildMethod("destroy");this.childWidgets.removeData("ui-controlgroup-data");this.element.removeAttr("role");this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var a=this,d=[];b.each(this.options.items,function(c,e){var g,f={};e&&("controlgroupLabel"===c?(g=a.element.find(e),g.each(function(){var a=b(this);a.children(".ui-controlgroup-label-contents").length||
a.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),a._addClass(g,null,"ui-widget ui-widget-content ui-state-default"),d=d.concat(g.get())):b.fn[c]&&(f=a["_"+c+"Options"]?a["_"+c+"Options"]("middle"):{classes:{}},a.element.find(e).each(function(){var e=b(this),g=e[c]("instance"),h=b.widget.extend({},f);"button"===c&&e.parent(".ui-spinner").length||(g||(g=e[c]()[c]("instance")),g&&(h.classes=a._resolveClassesValues(h.classes,g)),e[c](h),h=e[c]("widget"),b.data(h[0],"ui-controlgroup-data",
g?g:e[c]("instance")),d.push(h[0]))})))});this.childWidgets=b(b.unique(d));this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(a){this.childWidgets.each(function(){var d=b(this).data("ui-controlgroup-data");if(d&&d[a])d[a]()})},_updateCornerClass:function(a,b){var c=this._buildSimpleOptions(b,"label").classes.label;this._removeClass(a,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all");this._addClass(a,null,c)},_buildSimpleOptions:function(a,
b){var c="vertical"===this.options.direction,d={classes:{}};d.classes[b]={middle:"",first:"ui-corner-"+(c?"top":"left"),last:"ui-corner-"+(c?"bottom":"right"),only:"ui-corner-all"}[a];return d},_spinnerOptions:function(a){a=this._buildSimpleOptions(a,"ui-spinner");a.classes["ui-spinner-up"]="";a.classes["ui-spinner-down"]="";return a},_buttonOptions:function(a){return this._buildSimpleOptions(a,"ui-button")},_checkboxradioOptions:function(a){return this._buildSimpleOptions(a,"ui-checkboxradio-label")},
_selectmenuOptions:function(a){var b="vertical"===this.options.direction;return{width:b?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(b?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(b?"top":"left")},last:{"ui-selectmenu-button-open":b?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(b?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[a]}},
_resolveClassesValues:function(a,d){var c={};b.each(a,function(g){var f=d.options.classes[g]||"",f=b.trim(f.replace(e,""));c[g]=(f+" "+a[g]).replace(/\s+/g," ")});return c},_setOption:function(a,b){"direction"===a&&this._removeClass("ui-controlgroup-"+this.options.direction);this._super(a,b);"disabled"===a?this._callChildMethod(b?"disable":"enable"):this.refresh()},refresh:function(){var a,d=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction);"horizontal"===this.options.direction&&
this._addClass(null,"ui-helper-clearfix");this._initWidgets();a=this.childWidgets;this.options.onlyVisible&&(a=a.filter(":visible"));a.length&&(b.each(["first","last"],function(b,e){var c=a[e]().data("ui-controlgroup-data");if(c&&d["_"+c.widgetName+"Options"]){var g=d["_"+c.widgetName+"Options"](1===a.length?"only":e);g.classes=d._resolveClassesValues(g.classes,c);c.element[c.widgetName](g)}else d._updateCornerClass(a[e](),e)}),this._callChildMethod("refresh"))}});b.widget("ui.checkboxradio",[b.ui.formResetMixin,
{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var a,d=this,c=this._super()||{};this._readType();a=this.element.labels();this.label=b(a[a.length-1]);this.label.length||b.error("No label found for checkboxradio widget");this.originalLabel="";this.label.contents().not(this.element[0]).each(function(){d.originalLabel+=3===this.nodeType?b(this).text():this.outerHTML});
this.originalLabel&&(c.label=this.originalLabel);a=this.element[0].disabled;null!=a&&(c.disabled=a);return c},_create:function(){var a=this.element[0].checked;this._bindFormResetHandler();null==this.options.disabled&&(this.options.disabled=this.element[0].disabled);this._setOption("disabled",this.options.disabled);this._addClass("ui-checkboxradio","ui-helper-hidden-accessible");this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget");"radio"===this.type&&this._addClass(this.label,
"ui-checkboxradio-radio-label");this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel);this._enhance();a&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover"));this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},
_readType:function(){var a=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type;"input"===a&&/radio|checkbox/.test(this.type)||b.error("Can't create checkboxradio on element.nodeName="+a+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var a=this.element[0].name,d="input[name='"+b.ui.escapeSelector(a)+"']";return a?(this.form.length?b(this.form[0].elements).filter(d):b(d).filter(function(){return 0===
b(this).form().length})).not(this.element):b([])},_toggleClasses:function(){var a=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",a);this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",a)._toggleClass(this.icon,null,"ui-icon-blank",!a);"radio"===this.type&&this._getRadioGroup().each(function(){var a=b(this).checkboxradio("instance");a&&a._removeClass(a.label,"ui-checkboxradio-checked","ui-state-active")})},
_destroy:function(){this._unbindFormResetHandler();this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(a,b){if("label"!==a||b)this._super(a,b),"disabled"===a?(this._toggleClass(this.label,null,"ui-state-disabled",b),this.element[0].disabled=b):this.refresh()},_updateIcon:function(a){var d="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=b("<span>"),this.iconSpace=b("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===
this.type?(d+=a?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,a?"ui-icon-blank":"ui-icon-check")):d+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",d),a||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var a=this.label.contents().not(this.element[0]);this.icon&&(a=a.not(this.icon[0]));
this.iconSpace&&(a=a.not(this.iconSpace[0]));a.remove();this.label.append(this.options.label)},refresh:function(){var a=this.element[0].checked,b=this.element[0].disabled;this._updateIcon(a);this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",a);null!==this.options.label&&this._updateLabel();b!==this.options.disabled&&this._setOptions({disabled:b})}}]);b.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,
icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var a,b=this._super()||{};this.isInput=this.element.is("input");a=this.element[0].disabled;null!=a&&(b.disabled=a);if(this.originalLabel=this.isInput?this.element.val():this.element.html())b.label=this.originalLabel;return b},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0);null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1);this.hasTitle=
!!this.element.attr("title");this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label));this._addClass("ui-button","ui-widget");this._setOption("disabled",this.options.disabled);this._enhance();this.element.is("a")&&this._on({keyup:function(a){a.keyCode===b.ui.keyCode.SPACE&&(a.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||
this.element.attr("role","button");this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title");this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(a,d){var c="iconPosition"!==a,e=c?this.options.iconPosition:d,f="top"===e||"bottom"===e;this.icon?c&&this._removeClass(this.icon,null,this.options.icon):(this.icon=b("<span>"),this._addClass(this.icon,"ui-button-icon",
"ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only"));c&&this._addClass(this.icon,null,d);this._attachIcon(e);f?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=b("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(e))},_destroy:function(){this.element.removeAttr("role");this.icon&&this.icon.remove();
this.iconSpace&&this.iconSpace.remove();this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(a){this.icon[/^(?:end|bottom)/.test(a)?"before":"after"](this.iconSpace)},_attachIcon:function(a){this.element[/^(?:end|bottom)/.test(a)?"append":"prepend"](this.icon)},_setOptions:function(a){var b=void 0===a.icon?this.options.icon:a.icon;(void 0===a.showLabel?this.options.showLabel:a.showLabel)||b||(a.showLabel=!0);this._super(a)},_setOption:function(a,b){"icon"===a&&(b?this._updateIcon(a,
b):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove()));"iconPosition"===a&&this._updateIcon(a,b);"showLabel"===a&&(this._toggleClass("ui-button-icon-only",null,!b),this._updateTooltip());"label"===a&&(this.isInput?this.element.val(b):(this.element.html(b),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition))));this._super(a,b);"disabled"===a&&(this._toggleClass(null,"ui-state-disabled",b),(this.element[0].disabled=b)&&this.element.blur())},
refresh:function(){var a=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");a!==this.options.disabled&&this._setOptions({disabled:a});this._updateTooltip()}});!1!==b.uiBackCompat&&(b.widget("ui.button",b.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text);!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel);
this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end");this._super()},_setOption:function(a,b){"text"===a?this._super("showLabel",b):("showLabel"===a&&(this.options.text=b),"icon"===a&&(this.options.icons.primary=b),"icons"===a&&(b.primary?(this._super("icon",
b.primary),this._super("iconPosition","beginning")):b.secondary&&(this._super("icon",b.secondary),this._super("iconPosition","end"))),this._superApply(arguments))}}),b.fn.button=function(a){return function(){if(!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type"))return a.apply(this,arguments);b.ui.checkboxradio||b.error("Checkboxradio widget missing");return 0===arguments.length?this.checkboxradio({icon:!1}):
this.checkboxradio.apply(this,arguments)}}(b.fn.button),b.fn.buttonset=function(){b.ui.controlgroup||b.error("Controlgroup widget missing");if("option"===arguments[0]&&"items"===arguments[1]&&arguments[2])return this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]);if("option"===arguments[0]&&"items"===arguments[1])return this.controlgroup.apply(this,[arguments[0],"items.button"]);"object"===typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items});
return this.controlgroup.apply(this,arguments)});b.ui.safeActiveElement=function(a){var b;try{b=a.activeElement}catch(c){b=a.body}b||(b=a.body);b.nodeName||(b=a.body);return b};b.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=!1;this.element.uniqueId().attr({role:this.options.role,
tabIndex:0});this._addClass("ui-menu","ui-widget ui-widget-content");this._on({"mousedown .ui-menu-item":function(a){a.preventDefault()},"click .ui-menu-item":function(a){var d=b(a.target),c=b(b.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&d.not(".ui-state-disabled").length&&(this.select(a),a.isPropagationStopped()||(this.mouseHandled=!0),d.has(".ui-menu").length?this.expand(a):!this.element.is(":focus")&&c.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&
1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(a){if(!this.previousFilter){var d=b(a.target).closest(".ui-menu-item"),c=b(a.currentTarget);d[0]===c[0]&&(this._removeClass(c.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(a,c))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(a,b){var c=this.active||this.element.find(this.options.items).eq(0);b||this.focus(a,c)},blur:function(a){this._delay(function(){b.contains(this.element[0],
b.ui.safeActiveElement(this.document[0]))||this.collapseAll(a)})},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(a){this._closeOnDocumentClick(a)&&this.collapseAll(a);this.mouseHandled=!1}})},_destroy:function(){var a=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show();
a.children().each(function(){var a=b(this);a.data("ui-menu-submenu-caret")&&a.remove()})},_keydown:function(a){var d,c,e,f=!0;switch(a.keyCode){case b.ui.keyCode.PAGE_UP:this.previousPage(a);break;case b.ui.keyCode.PAGE_DOWN:this.nextPage(a);break;case b.ui.keyCode.HOME:this._move("first","first",a);break;case b.ui.keyCode.END:this._move("last","last",a);break;case b.ui.keyCode.UP:this.previous(a);break;case b.ui.keyCode.DOWN:this.next(a);break;case b.ui.keyCode.LEFT:this.collapse(a);break;case b.ui.keyCode.RIGHT:this.active&&
!this.active.is(".ui-state-disabled")&&this.expand(a);break;case b.ui.keyCode.ENTER:case b.ui.keyCode.SPACE:this._activate(a);break;case b.ui.keyCode.ESCAPE:this.collapse(a);break;default:f=!1,d=this.previousFilter||"",e=!1,c=96<=a.keyCode&&105>=a.keyCode?(a.keyCode-96).toString():String.fromCharCode(a.keyCode),clearTimeout(this.filterTimer),c===d?e=!0:c=d+c,d=this._filterMenuItems(c),d=e&&-1!==d.index(this.active.next())?this.active.nextAll(".ui-menu-item"):d,d.length||(c=String.fromCharCode(a.keyCode),
d=this._filterMenuItems(c)),d.length?(this.focus(a,d),this.previousFilter=c,this.filterTimer=this._delay(function(){delete this.previousFilter},1E3)):delete this.previousFilter}f&&a.preventDefault()},_activate:function(a){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(a):this.select(a))},refresh:function(){var a,d,c,e=this,f=this.options.icons.submenu;d=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,
!!this.element.find(".ui-icon").length);a=d.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var a=b(this),c=a.prev(),d=b("<span>").data("ui-menu-submenu-caret",!0);e._addClass(d,"ui-menu-icon","ui-icon "+f);c.attr("aria-haspopup","true").prepend(d);a.attr("aria-labelledby",c.attr("id"))});this._addClass(a,"ui-menu","ui-widget ui-widget-content ui-front");a=d.add(this.element).find(this.options.items);a.not(".ui-menu-item").each(function(){var a=
b(this);e._isDivider(a)&&e._addClass(a,"ui-menu-divider","ui-widget-content")});d=a.not(".ui-menu-item, .ui-menu-divider");c=d.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()});this._addClass(d,"ui-menu-item")._addClass(c,"ui-menu-item-wrapper");a.filter(".ui-state-disabled").attr("aria-disabled","true");this.active&&!b.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(a,
b){if("icons"===a){var c=this.element.find(".ui-menu-icon");this._removeClass(c,null,this.options.icons.submenu)._addClass(c,null,b.submenu)}this._super(a,b)},_setOptionDisabled:function(a){this._super(a);this.element.attr("aria-disabled",String(a));this._toggleClass(null,"ui-state-disabled",!!a)},focus:function(a,b){var c;this.blur(a,a&&"focus"===a.type);this._scrollIntoView(b);this.active=b.first();c=this.active.children(".ui-menu-item-wrapper");this._addClass(c,null,"ui-state-active");this.options.role&&
this.element.attr("aria-activedescendant",c.attr("id"));c=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper");this._addClass(c,null,"ui-state-active");a&&"keydown"===a.type?this._close():this.timer=this._delay(function(){this._close()},this.delay);c=b.children(".ui-menu");c.length&&a&&/^mouse/.test(a.type)&&this._startOpening(c);this.activeMenu=b.parent();this._trigger("focus",a,{item:b})},_scrollIntoView:function(a){var d,c,e;this._hasScroll()&&(d=parseFloat(b.css(this.activeMenu[0],
"borderTopWidth"))||0,c=parseFloat(b.css(this.activeMenu[0],"paddingTop"))||0,d=a.offset().top-this.activeMenu.offset().top-d-c,c=this.activeMenu.scrollTop(),e=this.activeMenu.height(),a=a.outerHeight(),0>d?this.activeMenu.scrollTop(c+d):d+a>e&&this.activeMenu.scrollTop(c+d-e+a))},blur:function(a,b){b||clearTimeout(this.timer);this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",a,{item:this.active}),this.active=null)},_startOpening:function(a){clearTimeout(this.timer);
"true"===a.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close();this._open(a)},this.delay))},_open:function(a){var d=b.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(a.parents(".ui-menu")).hide().attr("aria-hidden","true");a.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(d)},collapseAll:function(a,d){clearTimeout(this.timer);this.timer=this._delay(function(){var c=d?this.element:b(a&&a.target).closest(this.element.find(".ui-menu"));
c.length||(c=this.element);this._close(c);this.blur(a);this._removeClass(c.find(".ui-state-active"),null,"ui-state-active");this.activeMenu=c},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element);a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(a){return!b(a.target).closest(".ui-menu").length},_isDivider:function(a){return!/[^\-\u2014\u2013\s]/.test(a.text())},collapse:function(a){var b=this.active&&
this.active.parent().closest(".ui-menu-item",this.element);b&&b.length&&(this._close(),this.focus(a,b))},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();b&&b.length&&(this._open(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&
!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,c){var d;this.active&&(d="first"===a||"last"===a?this.active["first"===a?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[a+"All"](".ui-menu-item").eq(0));d&&d.length&&this.active||(d=this.activeMenu.find(this.options.items)[b]());this.focus(c,d)},nextPage:function(a){var d,c,e;this.active?this.isLastItem()||(this._hasScroll()?(c=this.active.offset().top,e=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){d=
b(this);return 0>d.offset().top-c-e}),this.focus(a,d)):this.focus(a,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())):this.next(a)},previousPage:function(a){var d,c,e;this.active?this.isFirstItem()||(this._hasScroll()?(c=this.active.offset().top,e=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){d=b(this);return 0<d.offset().top-c+e}),this.focus(a,d)):this.focus(a,this.activeMenu.find(this.options.items).first())):this.next(a)},_hasScroll:function(){return this.element.outerHeight()<
this.element.prop("scrollHeight")},select:function(a){this.active=this.active||b(a.target).closest(".ui-menu-item");var d={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(a,!0);this._trigger("select",a,d)},_filterMenuItems:function(a){a=a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");var d=new RegExp("^"+a,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return d.test(b.trim(b(this).children(".ui-menu-item-wrapper").text()))})}});
b.widget("ui.selectmenu",[b.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var a=this.element.uniqueId().attr("id");this.ids={element:a,button:a+"-button",menu:a+"-menu"};
this._drawButton();this._drawMenu();this._bindFormResetHandler();this._rendered=!1;this.menuItems=b()},_drawButton:function(){var a,d=this,c=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button);this._on(this.labels,{click:function(a){this.button.focus();a.preventDefault()}});this.element.hide();this.button=b("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false",
"aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element);this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget");a=b("<span>").appendTo(this.button);this._addClass(a,"ui-selectmenu-icon","ui-icon "+this.options.icons.button);this.buttonItem=this._renderButtonItem(c).appendTo(this.button);!1!==this.options.width&&this._resizeButton();this._on(this.button,this._buttonEvents);
this.button.one("focusin",function(){d._rendered||d._refreshMenu()})},_drawMenu:function(){var a=this;this.menu=b("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu});this.menuWrap=b("<div>").append(this.menu);this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front");this.menuWrap.appendTo(this._appendTo());this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(b,c){b.preventDefault();a._setSelection();a._select(c.item.data("ui-selectmenu-item"),
b)},focus:function(b,c){var d=c.item.data("ui-selectmenu-item");null!=a.focusIndex&&d.index!==a.focusIndex&&(a._trigger("focus",b,{item:d}),a.isOpen||a._select(d,b));a.focusIndex=d.index;a.button.attr("aria-activedescendant",a.menuItems.eq(d.index).attr("id"))}}).menu("instance");this.menuInstance._off(this.menu,"mouseleave");this.menuInstance._closeOnDocumentClick=function(){return!1};this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu();this.buttonItem.replaceWith(this.buttonItem=
this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{}));null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var a;a=this.element.find("option");this.menu.empty();this._parseOptions(a);this._renderMenu(this.menu,this.items);this.menuInstance.refresh();this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper");this._rendered=!0;a.length&&(a=this._getSelectedItem(),this.menuInstance.focus(null,a),this._setAria(a.data("ui-selectmenu-item")),
this._setOption("disabled",this.element.prop("disabled")))},open:function(a){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",a)))},_position:function(){this.menuWrap.position(b.extend({of:this.button},
this.options.position))},close:function(a){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",a))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(a){var d=b("<span>");this._setText(d,a.label);this._addClass(d,"ui-selectmenu-text");return d},_renderMenu:function(a,d){var c=this,e="";b.each(d,function(d,g){var f;g.optgroup!==e&&(f=b("<li>",{text:g.optgroup}),c._addClass(f,"ui-selectmenu-optgroup",
"ui-menu-divider"+(g.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),f.appendTo(a),e=g.optgroup);c._renderItemData(a,g)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-selectmenu-item",b)},_renderItem:function(a,d){var c=b("<li>"),e=b("<div>",{title:d.element.attr("title")});d.disabled&&this._addClass(c,null,"ui-state-disabled");this._setText(e,d.label);return c.append(e).appendTo(a)},_setText:function(a,b){b?a.text(b):a.html("&#160;")},_move:function(a,
b){var c,d=".ui-menu-item";this.isOpen?c=this.menuItems.eq(this.focusIndex).parent("li"):(c=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),d+=":not(.ui-state-disabled)");c="first"===a||"last"===a?c["first"===a?"prevAll":"nextAll"](d).eq(-1):c[a+"All"](d).eq(0);c.length&&this.menuInstance.focus(b,c)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(a){this[this.isOpen?"close":"open"](a)},_setSelection:function(){var a;
this.range&&(window.getSelection?(a=window.getSelection(),a.removeAllRanges(),a.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(a){this.isOpen&&(b(a.target).closest(".ui-selectmenu-menu, #"+b.ui.escapeSelector(this.ids.button)).length||this.close(a))}},_buttonEvents:{mousedown:function(){var a;window.getSelection?(a=window.getSelection(),a.rangeCount&&(this.range=a.getRangeAt(0))):this.range=document.selection.createRange()},click:function(a){this._setSelection();
this._toggle(a)},keydown:function(a){var d=!0;switch(a.keyCode){case b.ui.keyCode.TAB:case b.ui.keyCode.ESCAPE:this.close(a);d=!1;break;case b.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(a);break;case b.ui.keyCode.UP:a.altKey?this._toggle(a):this._move("prev",a);break;case b.ui.keyCode.DOWN:a.altKey?this._toggle(a):this._move("next",a);break;case b.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(a):this._toggle(a);break;case b.ui.keyCode.LEFT:this._move("prev",a);break;case b.ui.keyCode.RIGHT:this._move("next",
a);break;case b.ui.keyCode.HOME:case b.ui.keyCode.PAGE_UP:this._move("first",a);break;case b.ui.keyCode.END:case b.ui.keyCode.PAGE_DOWN:this._move("last",a);break;default:this.menu.trigger(a),d=!1}d&&a.preventDefault()}},_selectFocusedItem:function(a){var b=this.menuItems.eq(this.focusIndex).parent("li");b.hasClass("ui-state-disabled")||this._select(b.data("ui-selectmenu-item"),a)},_select:function(a,b){var c=this.element[0].selectedIndex;this.element[0].selectedIndex=a.index;this.buttonItem.replaceWith(this.buttonItem=
this._renderButtonItem(a));this._setAria(a);this._trigger("select",b,{item:a});a.index!==c&&this._trigger("change",b,{item:a});this.close(b)},_setAria:function(a){a=this.menuItems.eq(a.index).attr("id");this.button.attr({"aria-labelledby":a,"aria-activedescendant":a});this.menu.attr("aria-activedescendant",a)},_setOption:function(a,b){if("icons"===a){var c=this.button.find("span.ui-icon");this._removeClass(c,null,this.options.icons.button)._addClass(c,null,b.button)}this._super(a,b);"appendTo"===
a&&this.menuWrap.appendTo(this._appendTo());"width"===a&&this._resizeButton()},_setOptionDisabled:function(a){this._super(a);this.menuInstance.option("disabled",a);this.button.attr("aria-disabled",a);this._toggleClass(this.button,null,"ui-state-disabled",a);this.element.prop("disabled",a);a?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var a=this.options.appendTo;a&&(a=a.jquery||a.nodeType?b(a):this.document.find(a).eq(0));a&&a[0]||(a=this.element.closest(".ui-front, dialog"));
a.length||(a=this.document[0].body);return a},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen);this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen);this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var a=this.options.width;!1===a?this.button.css("width",""):(null===a&&(a=this.element.show().outerWidth(),
this.element.hide()),this.button.outerWidth(a))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var a=this._super();a.disabled=this.element.prop("disabled");return a},_parseOptions:function(a){var d=this,c=[];a.each(function(a,e){c.push(d._parseOption(b(e),a))});this.items=c},_parseOption:function(a,b){var c=a.parent("optgroup");return{element:a,index:b,value:a.val(),label:a.text(),optgroup:c.attr("label")||
"",disabled:c.prop("disabled")||a.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler();this.menuWrap.remove();this.button.remove();this.element.show();this.element.removeUniqueId();this.labels.attr("for",this.ids.element)}}]);b.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,
show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var a=/#.*$/;return function(b){var c,d;c=b.href.replace(a,"");d=location.href.replace(a,"");try{c=decodeURIComponent(c)}catch(m){}try{d=decodeURIComponent(d)}catch(m){}return 1<b.hash.length&&c===d}}(),_create:function(){var a=this,d=this.options;this.running=!1;this._addClass("ui-tabs","ui-widget ui-widget-content");this._toggleClass("ui-tabs-collapsible",null,d.collapsible);this._processTabs();d.active=this._initialActive();
b.isArray(d.disabled)&&(d.disabled=b.unique(d.disabled.concat(b.map(this.tabs.filter(".ui-state-disabled"),function(b){return a.tabs.index(b)}))).sort());this.active=!1!==this.options.active&&this.anchors.length?this._findActive(d.active):b();this._refresh();this.active.length&&this.load(d.active)},_initialActive:function(){var a=this.options.active,d=this.options.collapsible,c=location.hash.substring(1);null===a&&(c&&this.tabs.each(function(d,e){if(b(e).attr("aria-controls")===c)return a=d,!1}),
null===a&&(a=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null===a||-1===a)&&(a=this.tabs.length?0:!1);!1!==a&&(a=this.tabs.index(this.tabs.eq(a)),-1===a&&(a=d?!1:0));!d&&!1===a&&this.anchors.length&&(a=0);return a},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):b()}},_tabKeydown:function(a){var d=b(b.ui.safeActiveElement(this.document[0])).closest("li"),c=this.tabs.index(d),e=!0;if(!this._handlePageNav(a)){switch(a.keyCode){case b.ui.keyCode.RIGHT:case b.ui.keyCode.DOWN:c++;
break;case b.ui.keyCode.UP:case b.ui.keyCode.LEFT:e=!1;c--;break;case b.ui.keyCode.END:c=this.anchors.length-1;break;case b.ui.keyCode.HOME:c=0;break;case b.ui.keyCode.SPACE:a.preventDefault();clearTimeout(this.activating);this._activate(c);return;case b.ui.keyCode.ENTER:a.preventDefault();clearTimeout(this.activating);this._activate(c===this.options.active?!1:c);return;default:return}a.preventDefault();clearTimeout(this.activating);c=this._focusNextTab(c,e);a.ctrlKey||a.metaKey||(d.attr("aria-selected",
"false"),this.tabs.eq(c).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",c)},this.delay))}},_panelKeydown:function(a){!this._handlePageNav(a)&&a.ctrlKey&&a.keyCode===b.ui.keyCode.UP&&(a.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(a){if(a.altKey&&a.keyCode===b.ui.keyCode.PAGE_UP)return this._activate(this._focusNextTab(this.options.active-1,!1)),!0;if(a.altKey&&a.keyCode===b.ui.keyCode.PAGE_DOWN)return this._activate(this._focusNextTab(this.options.active+
1,!0)),!0},_findNextTab:function(a,d){function c(){a>e&&(a=0);0>a&&(a=e);return a}for(var e=this.tabs.length-1;-1!==b.inArray(c(),this.options.disabled);)a=d?a+1:a-1;return a},_focusNextTab:function(a,b){a=this._findNextTab(a,b);this.tabs.eq(a).trigger("focus");return a},_setOption:function(a,b){"active"===a?this._activate(b):(this._super(a,b),"collapsible"===a&&(this._toggleClass("ui-tabs-collapsible",null,b),b||!1!==this.options.active||this._activate(0)),"event"===a&&this._setupEvents(b),"heightStyle"===
a&&this._setupHeightStyle(b))},_sanitizeSelector:function(a){return a?a.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var a=this.options,d=this.tablist.children(":has(a[href])");a.disabled=b.map(d.filter(".ui-state-disabled"),function(a){return d.index(a)});this._processTabs();!1!==a.active&&this.anchors.length?this.active.length&&!b.contains(this.tablist[0],this.active[0])?this.tabs.length===a.disabled.length?(a.active=!1,this.active=b()):this._activate(this._findNextTab(Math.max(0,
a.active-1),!1)):a.active=this.tabs.index(this.active):(a.active=!1,this.active=b());this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"});this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",
tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var a=this,d=this.tabs,c=this.anchors,e=this.panels;this.tablist=this._getList().attr("role","tablist");this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header");this.tablist.on("mousedown"+this.eventNamespace,"> li",function(a){b(this).is(".ui-state-disabled")&&
a.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){b(this).closest("li").is(".ui-state-disabled")&&this.blur()});this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1});this._addClass(this.tabs,"ui-tabs-tab","ui-state-default");this.anchors=this.tabs.map(function(){return b("a",this)[0]}).attr({role:"presentation",tabIndex:-1});this._addClass(this.anchors,"ui-tabs-anchor");this.panels=b();this.anchors.each(function(c,d){var e,g,f=b(d).uniqueId().attr("id"),
h=b(d).closest("li"),m=h.attr("aria-controls");a._isLocal(d)?(e=d.hash,g=e.substring(1),e=a.element.find(a._sanitizeSelector(e))):(g=h.attr("aria-controls")||b({}).uniqueId()[0].id,e=a.element.find("#"+g),e.length||(e=a._createPanel(g),e.insertAfter(a.panels[c-1]||a.tablist)),e.attr("aria-live","polite"));e.length&&(a.panels=a.panels.add(e));m&&h.data("ui-tabs-aria-controls",m);h.attr({"aria-controls":g,"aria-labelledby":f});e.attr("aria-labelledby",f)});this.panels.attr("role","tabpanel");this._addClass(this.panels,
"ui-tabs-panel","ui-widget-content");d&&(this._off(d.not(this.tabs)),this._off(c.not(this.anchors)),this._off(e.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(a){return b("<div>").attr("id",a).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(a){var d,c;b.isArray(a)&&(a.length?a.length===this.anchors.length&&(a=!0):a=!1);for(c=0;d=this.tabs[c];c++)d=b(d),!0===a||-1!==b.inArray(c,a)?(d.attr("aria-disabled","true"),this._addClass(d,
null,"ui-state-disabled")):(d.removeAttr("aria-disabled"),this._removeClass(d,null,"ui-state-disabled"));this.options.disabled=a;this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===a)},_setupEvents:function(a){var d={};a&&b.each(a.split(" "),function(a,b){d[b]="_eventHandler"});this._off(this.anchors.add(this.tabs).add(this.panels));this._on(!0,this.anchors,{click:function(a){a.preventDefault()}});this._on(this.anchors,d);this._on(this.tabs,{keydown:"_tabKeydown"});this._on(this.panels,
{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs)},_setupHeightStyle:function(a){var d,c=this.element.parent();"fill"===a?(d=c.height(),d-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var a=b(this),c=a.css("position");"absolute"!==c&&"fixed"!==c&&(d-=a.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){d-=b(this).outerHeight(!0)}),this.panels.each(function(){b(this).height(Math.max(0,d-b(this).innerHeight()+
b(this).height()))}).css("overflow","auto")):"auto"===a&&(d=0,this.panels.each(function(){d=Math.max(d,b(this).height("").height())}).height(d))},_eventHandler:function(a){var d=this.options,c=this.active,e=b(a.currentTarget).closest("li"),f=e[0]===c[0],h=f&&d.collapsible,l=h?b():this._getPanelForTab(e),k=c.length?this._getPanelForTab(c):b(),c={oldTab:c,oldPanel:k,newTab:h?b():e,newPanel:l};a.preventDefault();e.hasClass("ui-state-disabled")||e.hasClass("ui-tabs-loading")||this.running||f&&!d.collapsible||
!1===this._trigger("beforeActivate",a,c)||(d.active=h?!1:this.tabs.index(e),this.active=f?b():e,this.xhr&&this.xhr.abort(),k.length||l.length||b.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(e),a),this._toggle(a,c))},_toggle:function(a,d){function c(){f.running=!1;f._trigger("activate",a,d)}function e(){f._addClass(d.newTab.closest("li"),"ui-tabs-active","ui-state-active");h.length&&f.options.show?f._show(h,f.options.show,c):(h.show(),c())}var f=this,
h=d.newPanel,l=d.oldPanel;this.running=!0;l.length&&this.options.hide?this._hide(l,this.options.hide,function(){f._removeClass(d.oldTab.closest("li"),"ui-tabs-active","ui-state-active");e()}):(this._removeClass(d.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),l.hide(),e());l.attr("aria-hidden","true");d.oldTab.attr({"aria-selected":"false","aria-expanded":"false"});h.length&&l.length?d.oldTab.attr("tabIndex",-1):h.length&&this.tabs.filter(function(){return 0===b(this).attr("tabIndex")}).attr("tabIndex",
-1);h.attr("aria-hidden","false");d.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(a){a=this._findActive(a);a[0]!==this.active[0]&&(a.length||(a=this.active),a=a.find(".ui-tabs-anchor")[0],this._eventHandler({target:a,currentTarget:a,preventDefault:b.noop}))},_findActive:function(a){return!1===a?b():this.tabs.eq(a)},_getIndex:function(a){"string"===typeof a&&(a=this.anchors.index(this.anchors.filter("[href$='"+b.ui.escapeSelector(a)+"']")));return a},_destroy:function(){this.xhr&&
this.xhr.abort();this.tablist.removeAttr("role").off(this.eventNamespace);this.anchors.removeAttr("role tabIndex").removeUniqueId();this.tabs.add(this.panels).each(function(){b.data(this,"ui-tabs-destroy")?b(this).remove():b(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")});this.tabs.each(function(){var a=b(this),d=a.data("ui-tabs-aria-controls");d?a.attr("aria-controls",d).removeData("ui-tabs-aria-controls"):a.removeAttr("aria-controls")});
this.panels.show();"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(a){var d=this.options.disabled;!1!==d&&(void 0===a?d=!1:(a=this._getIndex(a),d=b.isArray(d)?b.map(d,function(b){return b!==a?b:null}):b.map(this.tabs,function(b,d){return d!==a?d:null})),this._setOptionDisabled(d))},disable:function(a){var d=this.options.disabled;if(!0!==d){if(void 0===a)d=!0;else{a=this._getIndex(a);if(-1!==b.inArray(a,d))return;d=b.isArray(d)?b.merge([a],d).sort():[a]}this._setOptionDisabled(d)}},
load:function(a,d){a=this._getIndex(a);var c=this,e=this.tabs.eq(a),f=e.find(".ui-tabs-anchor"),h=this._getPanelForTab(e),l={tab:e,panel:h},k=function(a,b){"abort"===b&&c.panels.stop(!1,!0);c._removeClass(e,"ui-tabs-loading");h.removeAttr("aria-busy");a===c.xhr&&delete c.xhr};this._isLocal(f[0])||(this.xhr=b.ajax(this._ajaxSettings(f,d,l)))&&"canceled"!==this.xhr.statusText&&(this._addClass(e,"ui-tabs-loading"),h.attr("aria-busy","true"),this.xhr.done(function(a,b,e){setTimeout(function(){h.html(a);
c._trigger("load",d,l);k(e,b)},1)}).fail(function(a,b){setTimeout(function(){k(a,b)},1)}))},_ajaxSettings:function(a,d,c){var e=this;return{url:a.attr("href").replace(/#.*$/,""),beforeSend:function(a,g){return e._trigger("beforeLoad",d,b.extend({jqXHR:a,ajaxSettings:g},c))}}},_getPanelForTab:function(a){a=b(a).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+a))}});!1!==b.uiBackCompat&&b.widget("ui.tabs",b.ui.tabs,{_processTabs:function(){this._superApply(arguments);this._addClass(this.tabs,
"ui-tab")}});b.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var a=b(this).attr("title")||"";return b("<a>").text(a).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(a,d){var c=(a.attr("aria-describedby")||"").split(/\s+/);c.push(d);a.data("ui-tooltip-id",d).attr("aria-describedby",b.trim(c.join(" ")))},
_removeDescribedBy:function(a){var d=a.data("ui-tooltip-id"),c=(a.attr("aria-describedby")||"").split(/\s+/),d=b.inArray(d,c);-1!==d&&c.splice(d,1);a.removeData("ui-tooltip-id");(c=b.trim(c.join(" ")))?a.attr("aria-describedby",c):a.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};this.liveRegion=b("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body);this._addClass(this.liveRegion,
null,"ui-helper-hidden-accessible");this.disabledTitles=b([])},_setOption:function(a,d){var c=this;this._super(a,d);"content"===a&&b.each(this.tooltips,function(a,b){c._updateContent(b.element)})},_setOptionDisabled:function(a){this[a?"_disable":"_enable"]()},_disable:function(){var a=this;b.each(this.tooltips,function(d,c){var e=b.Event("blur");e.target=e.currentTarget=c.element[0];a.close(e,!0)});this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var a=
b(this);if(a.is("[title]"))return a.data("ui-tooltip-title",a.attr("title")).removeAttr("title")}))},_enable:function(){this.disabledTitles.each(function(){var a=b(this);a.data("ui-tooltip-title")&&a.attr("title",a.data("ui-tooltip-title"))});this.disabledTitles=b([])},open:function(a){var d=this,c=b(a?a.target:this.element).closest(this.options.items);c.length&&!c.data("ui-tooltip-id")&&(c.attr("title")&&c.data("ui-tooltip-title",c.attr("title")),c.data("ui-tooltip-open",!0),a&&"mouseover"===a.type&&
c.parents().each(function(){var a=b(this),c;a.data("ui-tooltip-open")&&(c=b.Event("blur"),c.target=c.currentTarget=this,d.close(c,!0));a.attr("title")&&(a.uniqueId(),d.parents[this.id]={element:this,title:a.attr("title")},a.attr("title",""))}),this._registerCloseHandlers(a,c),this._updateContent(c,a))},_updateContent:function(a,b){var c;c=this.options.content;var d=this,e=b?b.type:null;if("string"===typeof c||c.nodeType||c.jquery)return this._open(b,a,c);(c=c.call(a[0],function(c){d._delay(function(){a.data("ui-tooltip-open")&&
(b&&(b.type=e),this._open(b,a,c))})}))&&this._open(b,a,c)},_open:function(a,d,c){function e(a){k.of=a;h.is(":hidden")||h.position(k)}var f,h,l,k=b.extend({},this.options.position);c&&((f=this._find(d))?f.tooltip.find(".ui-tooltip-content").html(c):(d.is("[title]")&&(a&&"mouseover"===a.type?d.attr("title",""):d.removeAttr("title")),f=this._tooltip(d),h=f.tooltip,this._addDescribedBy(d,h.attr("id")),h.find(".ui-tooltip-content").html(c),this.liveRegion.children().hide(),c=b("<div>").html(h.find(".ui-tooltip-content").html()),
c.removeAttr("name").find("[name]").removeAttr("name"),c.removeAttr("id").find("[id]").removeAttr("id"),c.appendTo(this.liveRegion),this.options.track&&a&&/^mouse/.test(a.type)?(this._on(this.document,{mousemove:e}),e(a)):h.position(b.extend({of:d},this.options.position)),h.hide(),this._show(h,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(l=this.delayedShow=setInterval(function(){h.is(":visible")&&(e(k.of),clearInterval(l))},b.fx.interval)),this._trigger("open",
a,{tooltip:h})))},_registerCloseHandlers:function(a,d){var c={keyup:function(a){a.keyCode===b.ui.keyCode.ESCAPE&&(a=b.Event(a),a.currentTarget=d[0],this.close(a,!0))}};d[0]!==this.element[0]&&(c.remove=function(){this._removeTooltip(this._find(d).tooltip)});a&&"mouseover"!==a.type||(c.mouseleave="close");a&&"focusin"!==a.type||(c.focusout="close");this._on(!0,d,c)},close:function(a){var d,c=this,e=b(a?a.currentTarget:this.element),f=this._find(e);f?(d=f.tooltip,f.closing||(clearInterval(this.delayedShow),
e.data("ui-tooltip-title")&&!e.attr("title")&&e.attr("title",e.data("ui-tooltip-title")),this._removeDescribedBy(e),f.hiding=!0,d.stop(!0),this._hide(d,this.options.hide,function(){c._removeTooltip(b(this))}),e.removeData("ui-tooltip-open"),this._off(e,"mouseleave focusout keyup"),e[0]!==this.element[0]&&this._off(e,"remove"),this._off(this.document,"mousemove"),a&&"mouseleave"===a.type&&b.each(this.parents,function(a,d){b(d.element).attr("title",d.title);delete c.parents[a]}),f.closing=!0,this._trigger("close",
a,{tooltip:d}),f.hiding||(f.closing=!1))):e.removeData("ui-tooltip-open")},_tooltip:function(a){var d=b("<div>").attr("role","tooltip"),c=b("<div>").appendTo(d),e=d.uniqueId().attr("id");this._addClass(c,"ui-tooltip-content");this._addClass(d,"ui-tooltip","ui-widget ui-widget-content");d.appendTo(this._appendTo(a));return this.tooltips[e]={element:a,tooltip:d}},_find:function(a){return(a=a.data("ui-tooltip-id"))?this.tooltips[a]:null},_removeTooltip:function(a){a.remove();delete this.tooltips[a.attr("id")]},
_appendTo:function(a){a=a.closest(".ui-front, dialog");a.length||(a=this.document[0].body);return a},_destroy:function(){var a=this;b.each(this.tooltips,function(d,c){var e=b.Event("blur"),f=c.element;e.target=e.currentTarget=f[0];a.close(e,!0);b("#"+d).remove();f.data("ui-tooltip-title")&&(f.attr("title")||f.attr("title",f.data("ui-tooltip-title")),f.removeData("ui-tooltip-title"))});this.liveRegion.remove()}});!1!==b.uiBackCompat&&b.widget("ui.tooltip",b.ui.tooltip,{options:{tooltipClass:null},
_tooltip:function(){var a=this._superApply(arguments);this.options.tooltipClass&&a.tooltip.addClass(this.options.tooltipClass);return a}})});/*
 jQuery UI Touch Punch 0.2.3

 Copyright 2011?2014, Dave Furfero
 Dual licensed under the MIT or GPL Version 2 licenses.

 Depends:
  jquery.ui.widget.js
  jquery.ui.mouse.js
*/
!function(b){function k(a,b){if(!(1<a.originalEvent.touches.length)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(d)}}if(b.support.touch="ontouchend"in document,b.support.touch){var f,h=b.ui.mouse.prototype,e=h._mouseInit,a=h._mouseDestroy;h._touchStart=function(a){!f&&this._mouseCapture(a.originalEvent.changedTouches[0])&&(f=!0,this._touchMoved=
!1,k(a,"mouseover"),k(a,"mousemove"),k(a,"mousedown"))};h._touchMove=function(a){f&&(this._touchMoved=!0,k(a,"mousemove"))};h._touchEnd=function(a){f&&(k(a,"mouseup"),k(a,"mouseout"),this._touchMoved||k(a,"click"),f=!1)};h._mouseInit=function(){this.element.bind({touchstart:b.proxy(this,"_touchStart"),touchmove:b.proxy(this,"_touchMove"),touchend:b.proxy(this,"_touchEnd")});e.call(this)};h._mouseDestroy=function(){this.element.unbind({touchstart:b.proxy(this,"_touchStart"),touchmove:b.proxy(this,
"_touchMove"),touchend:b.proxy(this,"_touchEnd")});a.call(this)}}}(jQuery);window.TOONTALK||(window.TOONTALK={});window.TOONTALK.creators_from_json={};window.TOONTALK.create_function_table=function(b){return function(){var k={};return{check_message:function(f){var h={},e;if(!f.is_box())return this.report_error("Function birds can only respond to boxes. One was given "+b.UTILITIES.add_a_or_an(f.get_type_name()));h.box_size=f.get_size();if(1>h.box_size)return this.report_error("Function birds can only respond to boxes with holes.");e=f.get_hole_contents(0);if(!e)return this.report_error("Function birds can only respond to boxes with something in the first hole.");
if(e.is_box()){h.bird=e.get_hole_contents(0);if(2<e.get_size()&&(h.error_bird=e.get_hole_contents(2),h.error_bird&&!h.error_bird.is_bird()))return this.report_error("A function bird received a box with a box in its first hole that should only contain birds. It contains "+b.UTILITIES.add_a_or_an(h.message_return_bird.get_type_name())+".",h.bird.is_bird()&&h);if(!h.bird)return this.report_error("Function birds can only respond to boxes with a box in the first hole if the box's first hole contains a bird. It is empty.",
h);if(!h.bird.is_bird())return this.report_error("Function birds can only respond to boxes with a box in the first hole if the box's first hole contains a bird. The first hole contains "+b.UTILITIES.add_a_or_an(h.bird.get_type_name())+".",h);if(1<e.get_size()&&(h.message_return_bird=e.get_hole_contents(1),h.message_return_bird&&!h.message_return_bird.is_bird()))return this.report_error("A function bird received a box with a box in its first hole that should only contain birds. It contains "+b.UTILITIES.add_a_or_an(h.message_return_bird.get_type_name())+
".",h)}else if(e.is_bird())h.bird=e;else return this.report_error("Function birds can only respond to boxes with a bird in the first hole. The first hole contains "+b.UTILITIES.add_a_or_an(e.get_type_name())+".",h);h.message=f;return h},report_error:function(f,h){b.UTILITIES.display_message(f);h&&(h.error_bird||h.bird)&&(h.error_bird||h.bird).widget_side_dropped_on_me(b.element.create(f),{});h&&h.message_return_bird&&h.message_return_bird.widget_side_dropped_on_me(h.message,void 0);return f},process_response:function(b,
h,e,a){b&&(a.do_not_run_next_step=!0,a.by_function_bird=!0,h.message_return_bird||(a.temporary_bird=!0),h.bird.widget_side_dropped_on_me(b,a),h&&h.message_return_bird&&h.message_return_bird.widget_side_dropped_on_me(h.message,a));h.message_return_bird||e.remove({do_not_remove_children:!0,remove_backside:!0})},process_message:function(b,h,e){var a=this.check_message(b);if("string"!==typeof a)return h=h(a,e),!a.message_return_bird&&1<b.get_size()&&b.get_hole_contents(1)&&b.get_hole_contents(1).is_nest()&&
b.get_hole_contents(1).has_contents()&&(e.do_not_remove_children=!0,e.do_not_remove_frontside=!0,b.get_hole_contents(1).dereference().remove(e)),this.process_response(h,a,b,e),h},type_check:function(f,h,e,a,d,c){if(h.is_nest()&&!h.has_contents())throw b.sounds&&b.sounds.bird_fly.pause(),c&&c.make_message_nests_delivery_targets&&(h.set_visible(!0),b.UTILITIES.set_css(h.get_element(),$(d.message.get_element()).offset())),{wait_for_nest_to_receive_something:h};return f?h?h.dereference().is_of_type(f)?
!0:this.report_error("The '"+e+"' bird can only respond to boxes with "+b.UTILITIES.add_a_or_an(f)+" in the "+b.UTILITIES.ordinal(a)+" hole. The "+b.UTILITIES.ordinal(a)+" hole contains "+b.UTILITIES.add_a_or_an(h.get_type_name()+"."),d):this.report_error("The '"+e+"' bird can only respond to boxes with "+b.UTILITIES.add_a_or_an(f)+" in the "+b.UTILITIES.ordinal(a)+" hole. The "+b.UTILITIES.ordinal(a)+" hole is empty.",d):!0},number_check:function(b,h,e,a,d){return this.type_check("number",b,h,e,
a,d)},n_ary_widget_function:function(f,h,e,a,d){var c=function(c,d){var g,l,m;if(1===c.box_size)return h();l=1;if(m=f.get_hole_contents(l)){if(m=m.dereference(),!0===this.number_check(m,a,l,c,d)){c.message_return_bird&&(m=m.copy());for(l++;l<c.box_size;){g=f.get_hole_contents(l);if(!g){this.report_error("The '"+a+"' bird could not work because the "+b.UTILITIES.ordinal(l-1)+" number is missing.",c);return}g=g.dereference();if(!0!==this.number_check(g,a,l,c))return;e.call(m,g);l++}return m}}else this.report_error("The '"+
a+"' bird could not work because the first number is missing.",c)}.bind(this);return this.process_message(f,c,d)},n_ary_function:function(f,h,e,a,d){var c=function(c){var d,g,l,k;if(c.box_size<e+1)this.report_error("The '"+a+"' bird can only respond to boxes with at least "+(e+1)+" holes. Not "+c.box_size+" holes.",c);else{l=[];for(g=1;g<c.box_size;){d=f.get_hole_contents(g);if(!d){this.report_error("The '"+a+"' bird stopped becaused the "+b.UTILITIES.ordinal(g)+" hole is empty.",c);return}d=d.dereference();
if(!0!==this.number_check(d,a,g,c))return;d.get_approximate&&d.get_approximate()&&(k=!0);l.push(d.get_value());g++}c=h.apply(null,l);k&&(c.set_approximate(!0),c.set_format("decimal"));return c}}.bind(this);return this.process_message(f,c,d)},typed_bird_function:function(f,h,e,a,d,c,g){var m=function(m){var l,k,q,t,n;if(0<=c&&m.box_size<c+1)this.report_error("The '"+a+"' bird can only respond to boxes with "+(c+1)+" or more holes. Not "+m.box_size+" holes.",m);else{t=[];k=1;for(q=g?g:m.box_size-1;k<
q+1;){l=f.get_hole_contents(k);if(k<=c&&!l){this.report_error("The '"+a+"' bird found nothing in the "+b.UTILITIES.ordinal(k)+" hole.",m);return}if(l){l=l.dereference();k<=e.length&&(n=e[k-1]);if(!0!==this.type_check(n,l,a,k,m,d))return;t.push(l)}else t.push(void 0);k++}t.push(m);return h.apply(f,t)}}.bind(this);return this.process_message(f,m,d)},numeric_javascript_function_to_widget_function:function(f,h,e){return function(){var a=b.number.ZERO(b.number.function_bird_results_default_format);a.set_value_from_decimal(f.apply(null,
b.UTILITIES.map_arguments(arguments,e||bigrat.toDecimal)));h&&(a.set_approximate(!0),a.set_format("decimal"));return a}},bigrat_function_to_widget_function:function(f,h){return function(){var e=b.number.create_from_bigrat(f.apply(null,arguments));h&&h(arguments)&&(e.set_approximate(!0),e.set_format("decimal"));return e}},add_function_object:function(f,h,e,a,d){k[f]={name:f,short_name:a||f,respond_to_message:h,get_description:d?1===d.length?function(){return"If you give me a box with another bird and "+
b.UTILITIES.add_a_or_an(d[0])+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird, "+b.UTILITIES.conjunction(d,!0)+" then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."}:function(){return"If you give me a box with another bird and some numbers then "+b.UTILITIES.lower_case_first_letter(this.title)+"\nOn my backside you can change me to compute other functions."},
toString:function(){return b.UTILITIES.add_a_or_an("'"+this.name+"' function bird")},title:e}},get_function_table:function(){return k}}}}(window.TOONTALK);window.TOONTALK.widget=function(b){var k=function(b){if(b=this.get_frontside(b))return b.get_element()};b.creators_from_json.top_level=function(f){f=b.widget.create_top_level_widget(f.settings);f.get_backside(!0);return f};return{add_standard_widget_functionality:function(f){var h=function(){return!1},e;this.add_sides_functionality(f);this.runnable(f);this.stackable(f);this.animatable(f);this.has_title(f);this.has_parent(f);this.has_backside_widgets(f);this.has_description(f);this.has_listeners(f);
this.droppable(f);this.erasable(f);f.this_and_walk_children=function(a){a(f)&&f.walk_children&&f.walk_children(a)};f.top_level_widget=function(){var a;if(e)return e;if(this.is_top_level())return this;if(e=b.UTILITIES.widget_side_of_jquery($(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")))return e=e.get_widget();if(a=this.get_parent_of_frontside()||this.get_parent_of_backside())return e=a.get_widget().top_level_widget();a=$(".toontalk-backside-of-top-level");if(0<a.length)return e=
b.UTILITIES.widget_side_of_element(b.UTILITIES.closest_element(a,$(this.get_frontside_element()).offset())).get_widget();console.log("Could not find top_level_widget of "+this+". Created one instead");return e=this.create_top_level_widget()};f.is_of_type||(f.is_of_type=function(a){return this.get_type_name()===a});f.dereference||(f.dereference=function(){return this});f.get_default_description||(f.get_default_description=function(){return b.UTILITIES.add_a_or_an(this.get_type_name())+"."});f.is_number||
(f.is_number=h);f.is_box||(f.is_box=h);f.is_empty_hole||(f.is_empty_hole=h);f.is_hole||(f.is_hole=h);f.is_scale||(f.is_scale=h);f.is_bird||(f.is_bird=h);f.is_nest||(f.is_nest=h);f.is_robot||(f.is_robot=h);f.is_element||(f.is_element=h);f.is_sensor||(f.is_sensor=h);f.is_function_nest||(f.is_function_nest=h);f.is_plain_text_element||(f.is_plain_text_element=h);f.is_attribute_widget||(f.is_attribute_widget=h);f.maintain_proportional_dimensions||(f.maintain_proportional_dimensions=h);f.ok_to_set_dimensions=
function(){return!this.is_plain_text_element()};f.set_name&&(f.receive_name_from_dropped=function(a){if(a.get_text&&(a=a.get_text(),this.set_name(a,!0)))return this.get_name()});!b.debugging&&!b.logging||f.to_debug_string||(f.to_debug_string=function(a){var b=this.get_parent_widget_of_frontside(),c=this._debug_id,e=this.get_description(),e=e?e+" ":"";c||(c=b&&b.id?"id of parent is "+b.id:"");e&&(e+=" ");return(this.toString({plain_text:!0})+" ("+e+(this.get_name&&this.get_name()+" "||"")+c+")").substring(0,
a)});f.is_top_level=h;f.is_widget=!0},erasable:function(b){var f;b.get_erased||(b.get_erased=function(){return f});b.set_erased||(b.set_erased=function(b,a){f=b;a&&this.rerender()})},add_sides_functionality:function(f){var h,e,a;f.get_frontside||(f.get_frontside=function(a){a&&!h&&(h=b.frontside.create(f));return h},f.is_resizable||(f.is_resizable=function(){return!1}),f.save_dimensions=function(){return this.save_dimensions_of(this)},f.save_dimensions_of=function(a){var b;if(a.is_resizable()){if(a.is_element()){if(!this.get_original_width())return;
b=a.get_attribute("width");a=a.get_attribute("height")}else a=a.get_frontside_element(),b=$(a).width(),a=$(a).height();0<b&&(this.saved_width=b);0<a&&(this.saved_height=a);return!0}},f.restore_dimensions=function(){var a=this.get_frontside_element(!0),c;0<this.saved_width?(this.ok_to_set_dimensions()?this.use_scaling_transform?this.use_scaling_transform({width:this.saved_width,height:this.saved_height}):this.set_size_attributes?this.set_size_attributes(this.saved_width,this.saved_height):b.UTILITIES.set_css(a,
{width:this.saved_width,height:this.saved_height}):(c={width:"",height:""},b.UTILITIES.set_css_transform(c,""),b.UTILITIES.set_css(a,c)),this.saved_height=this.saved_width=void 0):a&&(this.is_bird()||this.is_nest()||this.is_robot())&&b.UTILITIES.set_css(a,{width:"",height:""})},f.get_width=function(){return b.UTILITIES.get_element_width(f.get_frontside_element())},f.get_height=function(){return b.UTILITIES.get_element_height(f.get_frontside_element())});f.get_backside||(f.get_backside=function(a){a&&
!e&&(e=this.create_backside(),this.backside_widgets_json_views&&e.add_backside_widgets(this.get_backside_widgets(),this.backside_widgets_json_views));return e});f.set_backside||(f.set_backside=function(a){e=a});f.forget_backside||(f.forget_backside=function(){var a;if(e){if(a=e.get_element())$(a).remove(),a.toontalk_widget_side=void 0;e=void 0}});f.create_backside||(f.create_backside=function(){return b.backside.create(f)});f.get_open_backside_only_if_stopped||(f.get_open_backside_only_if_stopped=
function(){return a});f.set_open_backside_only_if_stopped||(f.set_open_backside_only_if_stopped=function(b){a=b})},runnable:function(f){var h=!1,e=!1;f.get_running||(f.get_running=function(a){var b=!1;if(a)return h;if(h)if(a=this.get_backside_widgets(),0===a.length)h=!1;else for(a.some(function(a){if(a&&a.get_widget().get_running())return b=!0}),a=this.get_parent_of_frontside();a;){if(a.is_backside())return a.get_widget().get_running(!0);if(a.get_running&&a.get_running(!0))return!0;a=a.get_parent_of_frontside()}return b});
f.is_ok_to_run||(f.is_ok_to_run=function(){return e},f.set_ok_to_run=function(a){e=a});f.set_running||(f.set_running=function(a,d,c){var g=h===a,m,k;e=a;m=this.get_backside_widgets();(h=a)&&b.logging&&0<=b.logging.indexOf("running")&&console.log(this._debug_string.substring(0,100)+" running.");this.get_backside()&&!g&&this.get_backside().run_status_changed(h);b.UTILITIES.for_each_batch(m,function(e){e&&(k=e.get_widget(),e.is_backside()&&(0<=this.get_backside_widgets().indexOf(k)||!e.is_primary_backside())||
(!k.is_robot()||k.being_trained||k.get_body().is_empty()?k.set_running&&(!d&&e.is_backside()&&"top-level"!==f.get_type_name()?k.set_running(a,f,!0):k.set_running(a)):h?(h&&b.logging&&0<=b.logging.indexOf("running")&&console.log(k._debug_string.substring(0,100)+" running."),k.set_stopped(!1),k.run(f,c,d),k.set_ok_to_run(!0)):(k.set_stopped(!0),k.set_running(!1)),k.rerender()))}.bind(this));this.walk_children&&this.walk_children(function(a){a.set_running&&a.set_running(h);return!0});this.is_robot()&&
(h?f.get_parent_of_backside()&&(this.set_stopped(!1),this.run(f.get_parent_of_backside().get_widget())):this.set_stopped(!0));g||this.rerender()})},droppable:function(b){b.drop_on||(b.drop_on=function(b,e){if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,e);console.log("No handler for drop of '"+this+"' on '"+b+"'")})},stackable:function(b){var f=!1;b.get_infinite_stack||(b.get_infinite_stack=function(){return f});b.set_infinite_stack||(b.set_infinite_stack=function(e){var a=
b.get_backside_element(),d=b.get_frontside_element();f=e;a&&$(a).find(".toontalk-infinite-stack-check-box").prop("checked",e);d&&(e?$(d).addClass("toontalk-infinite-stack"):$(d).removeClass("toontalk-infinite-stack"))})},animatable:function(f){var h;f.animate_to_widget||(h=function(e,a){var d=e.get_element();d&&(e.is_backside()||b.UTILITIES.visible_element(d))||(d=b.UTILITIES.find_resource_equal_to_widget(e,a));return d},f.animate_to_widget=function(b,a,d,c,g,f,k,l){var e=function(){this.animate_to_element(h(b,
l),a,d,c,g,f,k&&Math.max(0,k-100));this.rerender()}.bind(this);k?setTimeout(e,100):e()});f.animate_to_element||(f.animate_to_element=function(e,a,d,c,g,f,h){var m=$(e).offset(),k=this.get_frontside_element(),q=$(e).is(".toontalk-backside");if(e&&b.UTILITIES.visible_element(e)&&0!==d){if("number"===typeof e.animation_left_offset)c=e.animation_left_offset;else if("undefined"===typeof c||q)c=(b.UTILITIES.get_element_width(e)-b.UTILITIES.get_element_width(k))*Math.random();if("number"===typeof e.animation_top_offset)g=
e.animation_top_offset;else if("undefined"===typeof g||q)g=(b.UTILITIES.get_element_height(e)-b.UTILITIES.get_element_height(k))*Math.random();m=m?{left:m.left+c,top:m.top+g}:{left:0,top:0};this.animate_to_absolute_position(m,a,d,f,h)}else a&&a()});f.animate_to_absolute_position||(f.animate_to_absolute_position=function(e,a,d,c,g){b.UTILITIES.animate_to_absolute_position(this.get_frontside_element(),e,a,d,c,g)})},has_title:function(f){f.get_title||(f.get_title=function(){var f=this.get_type_name(),
e=this.get_backside(),a=this.get_frontside_element(),d=this.get_description(),c="";$(a).is(".toontalk-top-level-resource")?c=this.can_run&&this.can_run()?this.get_running()?"Click elsewhere to stop me from running. Click on it to start me up again.":"Click to start me running. Click elsewhere to stop me.":"Drag me to a work area.":e&&e.get_element()&&b.UTILITIES.visible_element(e.get_element())||b.open_backside_only_if_alt_key||(c=this.can_run&&this.can_run([],!0)?this.get_running()?"Robots on my back are running (or waiting to run).\nTo see them click the stop sign "+
b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" and then click on me.":"There are robots on my back.\nTo see them in action click me to open my backside and then click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+".":"Click to see my backside.");d&&(d="I'm "+d,c=c?d+"\n"+c:d);if(this.get_erased())return this.get_title_of_erased_widget();c=this.get_custom_title_prefix&&!$(a).is(".toontalk-top-level-resource")?
this.get_custom_title_prefix()+"\n"+c:"I'm "+b.UTILITIES.add_a_or_an(f)+". "+c;c=c.trim();0>".?!".indexOf(c[c.length-1])&&(c+=".");return c});f.update_title=function(){var f=this.get_frontside_element();f&&b.UTILITIES.give_tooltip(f,this.get_title())}},inside_conditions_container:function(){return $(this.get_frontside_element()).closest(".toontalk-conditions-container").is("*")},directly_inside_conditions_container:function(){return $(this.get_frontside_element()).parent(".toontalk-conditions-container").is("*")},
get_title_of_erased_widget:function(){var b=this.get_type_name();return this.inside_conditions_container()?"I'm an erased "+b+".\nI'll match with any other "+b+".":"I'm an erased "+b+".\nDusty the Vacuum can restore me to normal."},has_parent:function(f){var h=[],e,a,d,c;f.get_parent_of_frontside=function(){return d&&e?e.get_backside(!0):e};f.get_parent_widget_of_frontside=function(){return e};f.get_containing_widget=function(){return e&&e.is_hole()?e.get_parent_widget_of_frontside():this.get_parent_of_frontside()||
this};f.parent_of_frontside_is_backside=function(){return d};f.set_parent_of_frontside=function(a,b,c){var g=e;d=b;e!==a&&(e=a,g&&!c&&!b&&g.is_backside()&&g.get_widget().remove_backside_widget(this,!0),h.forEach(function(a){a(g,e)}))};f.add_parent_of_frontside_change_listener=function(a){h.push(a)};f.remove_parent_of_frontside_change_listener=function(a){a=h.indexOf(a);0<=a&&h.splice(a,1)};f.get_parent_of_backside=function(){return c&&a?a.get_backside(!0):a};f.set_parent_of_backside=function(b,e,
d){void 0===b&&!d&&c&&a&&a.get_widget().remove_backside_widget(this.get_backside(),!0);a=b;c=e};f.parent_of_backside_is_backside=function(){return c};f.closest_visible_ancestor=function(){for(var a=this;a&&!a.visible();)a=a.is_backside()?a.get_parent_of_backside():a.get_parent_of_frontside();return a||this};f.closest_visible_ancestor_or_frontside=function(){for(var a=this,c;a&&!b.UTILITIES.visible_element(a.get_frontside_element());)c=a,a.is_backside()?(a=a.get_parent_of_backside())||(a=c.get_widget()):
a=a.get_parent_of_frontside();return a||this};f.ancestor_of_type=function(a){for(var b=this;b&&!b.is_of_type(a);)b=b.is_backside()?b.get_widget().get_parent_of_backside():b.get_parent_of_frontside();return b};f.has_ancestor=function(a){var b;return this===a?!0:(b=this.get_parent_of_frontside())?b.has_ancestor(a):!1};f.has_ancestor_either_side=function(a){var b;if(this===a||this===a.get_backside())return!0;if(b=this.get_parent_of_frontside())return b.has_ancestor_either_side(a);if(b=this.get_parent_of_backside())try{return b.has_ancestor_either_side(a)}catch(v){console.error("widget.has_ancestor_either_side encountered this error: "+
v.message)}return!1};f.remove_from_parent_of_frontside=function(a){e&&(e.is_backside()?e.remove_backside_widget(this,!a):e.removed_from_container?d?e.remove_backside_widget(this,!0):e.removed_from_container(this,a):e.get_backside()&&e.remove_backside_widget(this,!a))}},has_description:function(b){var f;b.get_description||(b.get_description=function(){return f});b.set_description||(b.set_description=function(b,a,d){if(f===b||!f&&""===b)return!1;f=b;a&&this.rerender();d&&this.robot_in_training()&&this.robot_in_training().edited(this,
{setter_name:"set_description",argument_1:b,toString:"change the description to '"+b+"'' of the "+this.get_type_name(),button_selector:".toontalk-description-input"});return!0});b.receive_description_from_dropped=function(b){if(b.get_text&&(b=b.get_text(),this.set_description(b,!0)))return this.get_description()}},has_name:function(f){var h;f.get_name||(f.get_name=function(){"string"!==typeof h&&f.generate_name&&(h=f.generate_name());return h});f.set_name||(f.set_name=function(e,a,d){if(h===e||"string"!==
typeof e)return!1;h=e;b.UTILITIES.set_css(this.get_element(),{"font-size":this.name_font_size()});a&&this.rerender();d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_name",argument_1:e,toString:"change the name of the "+this.get_type_name()+' to "'+h+'"',button_selector:".toontalk-name-input"});return!0});this.has_name_font_size(f)},has_name_font_size:function(f){f.get_name_width||(f.get_name_width=function(b){return.5*(b||this.get_width())});f.get_name_height||
(f.get_name_height=function(b){return.5*(b||this.get_height())});f.name_font_size||(f.name_font_size=function(f,e){return b.UTILITIES.font_size(this.get_name(),this.get_name_width(f),{height:this.get_name_height(e)})})},has_listeners:function(f){var h={};f.add_listener||(f.add_listener=function(b,a){var d=h[b];d?0>d.indexOf(a)&&d.push(a):h[b]=[a]});f.remove_listener||(f.remove_listener=function(e,a,d){if(e=h[e])if(a=e.indexOf(a),0<=a){e.splice(a,1);return}!d&&b.debugging&&console.log("Listener of type "+
type_name+" could not be removed.")});f.get_listeners||(f.get_listeners=function(b){return h[b]})},add_speech_listeners:function(f){b.listen&&(f.widget=this,this.add_listener("picked up",function(){b.UTILITIES.listen_for_speech(f)}),this.add_listener("dropped",function(){b.UTILITIES.stop_listening_for_speech()}))},get_full_description:function(b){var f;if(this.get_erased&&this.get_erased())return b&&"conditions"===b.role?"any "+this.get_type_name():"erased "+this.get_type_name();f=this.get_description(b);
b=this.toString(b);return f?b+" ("+f+")":b},remove:function(b){var f=this.get_backside(),e=this.get_frontside(),a=this.get_parent_of_frontside(),d=function(a){b.do_not_remove_children?(a.hide_backside&&a.hide_backside(),a.walk_children&&a.walk_children(d)):a.remove&&a.remove(b);return!0};b||(b={});f&&(b.remove_backside||this.get_parent_of_backside()&&this.get_parent_of_backside().is_top_level())&&f.hide_backside();e&&!b.do_not_remove_frontside&&e.remove();a&&this.remove_from_parent_of_frontside(b.event);
this.get_running()&&this.set_running(!1);this.set_visible(!1);this.walk_children&&this.walk_children(d)},get_frontside_element:k,get_element:k,get_backside_element:function(b){if(b=this.get_backside&&this.get_backside(b))return b.get_element()},add_to_json:function(f,h){var e,a,d,c,g,m;if(f){f.view?(a=f,e=f.view,f=f.semantic):(e={},a={semantic:f,view:e});a.version=1;this.get_erased&&this.get_erased()&&(f.erased=!0);this.get_infinite_stack&&this.get_infinite_stack()&&(f.infinite_stack=!0);this.get_open_backside_only_if_stopped&&
this.get_open_backside_only_if_stopped()&&(f.open_backside_only_if_stopped=!0);this.get_running&&this.get_running()&&(f.running=!0);g=this.get_parent_widget_of_frontside();if(!g||this.parent_of_frontside_is_backside()||g.is_element())if(c=this.get_frontside_element&&this.get_frontside_element())if(m=$(c).width(),0!==m&&this.is_resizable()&&!$(c).is(".toontalk-plain-text-element")&&(e.frontside_width=$(c).width(),e.frontside_height=$(c).height()),0!==m&&(e.frontside_left=b.UTILITIES.get_style_numeric_property(c,
"left"),e.frontside_top=b.UTILITIES.get_style_numeric_property(c,"top")||d&&d.frontside_top,void 0===e.frontside_left&&(d=g&&g.get_widget().get_backside_widgets_json_views())))c=this.get_parent_of_frontside().get_backside_widgets().indexOf(this),0<=c&&d[c]&&(e.frontside_left=d[c].frontside_left,e.frontside_top=d[c].frontside_top);if(c=this.get_backside()){if(g=c.get_element()){if(c.get_backside_dimensions()||c.is_top_level())e.backside_width=$(g).width(),e.backside_height=$(g).height();e.backside_left||
(c.json_view&&"undefined"!==typeof c.json_view.backside_left?(e.backside_left=c.json_view.backside_left,e.backside_top=c.json_view.backside_top):(d=$(g).position(),e.backside_left=d.left,e.backside_top=d.top),"&lt;"===$(g).find(".toontalk-settings-backside-button").html()&&(e.advanced_settings_open=!0))}c.get_backside_dimensions()&&(e.backside_geometry=c.get_backside_dimensions())}!e.backside_geometry&&this.backside_geometry&&(e.backside_geometry=this.backside_geometry);void 0===e.frontside_left&&
this.json_view&&(e.frontside_left=this.json_view.frontside_left,e.frontside_top=this.json_view.frontside_top);f.description=this.get_description&&this.get_description();e.saved_width=this.saved_width;e.saved_height=this.saved_height;return a}console.log("get_json not defined");return{}},add_backside_widgets_to_json:function(f,h,e,a){var d=this.get_backside_widgets(),c,g;0<d.length?(f.semantic.backside_widgets=[],(c=this.get_backside_widgets_json_views())&&c.forEach(function(a,b){var e;if(g=f.semantic.backside_widgets[b]){if(0<=
g.widget.shared_widget_index){e=h.widgets_encountered.indexOf(h.shared_widgets[g.widget.shared_widget_index]);if(!h.json_of_widgets_encountered[e])return;e=h.json_of_widgets_encountered[e].view}else e=g.widget.view;g.is_backside?a.backside_left&&(e.backside_left=a.backside_left,e.backside_top=a.backside_top):a.frontside_left&&(e.frontside_left=a.frontside_left,e.frontside_top=a.frontside_top)}else d[b].json_view=c[b]}),b.UTILITIES.get_json_of_array(d,f.semantic.backside_widgets,0,h,e,a)):e()},has_backside_widgets:function(f){var h=
[];f.get_backside_widgets=function(){return h};f.add_backside_widget=function(e,a){var d;if(e){d=this.get_backside(!0);if(b.debugging){if(e===this){b.UTILITIES.report_internal_error("Adding a widget to the list of its backside widgets!");return}if(e.get_widget()===this){b.UTILITIES.report_internal_error("Adding the backside of a widget to the list of its backside widgets!");return}}h?0>h.indexOf(e)&&h.push(e):h=[e];b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Added "+e+" to backside widgets of "+
this+". Number of backside widgets is "+h.length);e.is_backside()?e.set_parent_of_backside(d,!0):e.set_parent_of_frontside(this,!0);!d.visible()||a&&a.robot&&!a.robot.visible()||e.set_visible(!0)}else b.debugging&&b.UTILITIES.report_internal_error("adding undefined to backside widgets.")};f.remove_all_backside_widgets=function(){h&&b.UTILITIES.for_each_batch(h.slice(),function(b){b.remove()})};f.remove_backside_widget=function(e,a){var d=h.indexOf(e);0>d?a||b.UTILITIES.report_internal_error("Couldn't find a widget to remove it from backside widgets. "+
e.get_widget()+" ("+e.get_widget()._debug_id+")"):(h.splice(d,1),b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Removed "+e+" from backside widgets of "+this+". Number of backside widgets is "+h.length),this.backside_widgets_json_views&&this.backside_widgets_json_views.splice(d,1),e.is_backside()?(d=e.get_parent())&&d.get_widget()===this&&e.set_parent_of_backside(void 0,!0,!0):(d=e.get_parent_of_frontside())&&d.get_widget()===this&&e.set_parent_of_frontside(void 0,void 0,!0),e.set_visible(!1))};
f.set_backside_widgets=function(e,a){var d=this.get_backside(),c=d&&d.visible();h=e;b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Set backside widgets "+h.length+" widgets of "+(c?"visible ":"invisible ")+this);0<h.length&&(d?d.add_backside_widgets(h,a):this.backside_widgets_json_views=a,b.UTILITIES.for_each_batch(h,function(a){a&&(a.is_backside()?a.set_parent_of_backside(this,!0):a.set_parent_of_frontside(this,!0),c&&a.set_visible(c))}.bind(this)))}},get_backside_widgets_json_views:function(b){!this.backside_widgets_json_views&&
b&&(this.backside_widgets_json_views=[]);return this.backside_widgets_json_views},can_run:function(){var b=!1,h;this.get_backside_widgets().some(function(e){if(!e)return!1;h=e.get_widget();if(h.get_body&&!h.get_body().is_empty()||h.can_run())return b=!0});this.walk_children&&this.walk_children(function(e){if(e.can_run())b=!0;else return!0});return b},add_to_copy:function(f,h){var e;this.get_erased&&this.get_erased()&&(f.set_erased||b.widget.erasable(f),f.set_erased(this.get_erased()));h&&h.just_value||
(e=this.get_backside_widgets(),0<e.length&&f.set_backside_widgets(b.UTILITIES.copy_widget_sides(e,h),this.get_backside_widgets_json_views()));f.set_running(this.get_running());return f},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},add_copy_to_container:function(f,h,e){var a=this.visible(),d,c,g,k,v;f||(f=this.copy({}));d=this.get_frontside_element(a);c=f.get_element(a);g=$(d).closest(".toontalk-backside");k=f.ok_to_set_dimensions();0===g.length&&(g=
$(this.top_level_widget().get_backside_element()));v=b.UTILITIES.widget_side_of_jquery(g);a&&("undefined"===typeof h&&(h=30),"undefined"===typeof e&&(e=30),a=b.UTILITIES.relative_position(d,g.get(0)),0<g.length&&g.get(0).appendChild(c),d={width:k?$(d).width():"",height:k?$(d).height():"","z-index":b.UTILITIES.next_z_index()},h=a.left+h,e=a.top+e,f.is_plain_text_element()?f.set_location_attributes(h,e):(d.left=h,d.top=e),b.UTILITIES.set_css(c,d));v&&v.add_backside_widget(f);return f},visible:function(){var b;
return document.hidden?!1:(b=this.get_frontside())?b.visible():!1},set_visible:function(b,h){var e=this.get_frontside(b);e&&e.set_visible(b,h)},is_backside:function(){return!1},get_parent:function(){return this.get_parent_of_frontside()},set_parent:function(b){this.set_parent_of_frontside(b)},drag_started:function(b,h){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,h)},match:function(b){console.assert(!1,"match not implemented for "+b.toString())},removed:function(f){b.UTILITIES.report_internal_error("removed not implemented")},
equals_box:function(){return!1},equals_number:function(){return!1},open_backside:function(f,h){var e=this.get_backside(),a,d,c,g,k,v,l,u,q,t,n;if(e&&b.UTILITIES.visible_element(e.get_element()))$(e.get_element()).css({opacity:1}),f&&f();else{a=f&&function(){setTimeout(f)};d=function(c,d){b.UTILITIES.set_timeout(function(){$(c).addClass("toontalk-side-appearing");b.UTILITIES.add_one_shot_event_handler(c,"transitionend",h||2500,function(){$(c).removeClass("toontalk-side-appearing");a&&a()});$(c).css({left:l,
top:u,opacity:d});this.apply_backside_geometry()}.bind(this))}.bind(this);g=this.get_frontside_element(!0);k=$(g).parent();for(e=$(g);0<k.length&&!k.is(".toontalk-backside");)e=k,k=k.parent();e.get(0);e=this.get_backside(!0);c=e.get_element();c.toontalk_widget_side=e;q=$(g).offset();t=k.offset();n=k.width();t||(t={left:0,top:0});$(c).css({left:q.left-t.left,top:q.top-t.top,opacity:.01});0<k.length?k.get(0).appendChild(c):($(c).css({textAlign:"left"}),g.appendChild(c));(k=b.UTILITIES.widget_side_of_jquery(k))&&
k.add_backside_widget(e);k=this.is_element()?this.get_attribute("height"):$(g).height();g=$(c).width();l=q.left-t.left;l+g>n&&(l=Math.max(0,n-g));u=q.top-t.top+k+34;this.is_box()&&(u+=28);d(c,"inherit");e.set_visible(!0);v=this.get_backside_widgets();0<v.length&&v.forEach(function(a){a.is_backside()&&0<=v.indexOf(a.get_widget())?a.hide_backside():(a.set_visible(!0),c.appendChild(a.get_element(!0)))}.bind(this));return e}},hide_backside:function(){var b=this.get_backside();b&&b.hide_backside()},apply_backside_geometry:function(){var b=
this.get_backside(!0),h=b.get_element();this.backside_geometry&&h&&(b.scale_backside(h,this.backside_geometry.x_scale,this.backside_geometry.y_scale,this.backside_geometry.original_width,this.backside_geometry.original_height),b.set_dimensions(this.backside_geometry))},robot_in_training:function(){return this.top_level_widget().robot_in_training()},robot_training_this_robot:function(){return this.top_level_widget().robot_training_this_robot()},robot_started_training:function(b){this.top_level_widget().robot_started_training(b)},
robot_finished_training:function(){this.top_level_widget().robot_finished_training()},backup_all:function(b){var f=this.top_level_widget();f&&f.save(b)},render:function(){b.DISPLAY_UPDATES.pending_update(this)},rerender:function(){this.visible()&&this.render()},hide:function(){$(this.get_frontside_element()).hide()},constrained_by_container:function(){var b;return this.is_nest()||this.being_dragged?!1:(b=this.get_parent_of_frontside())&&(b.is_hole()||b.is_nest()||b.is_robot())?!0:!1},close_button_ok:function(b){return"top-level"!==
this.get_type_name()&&!$(b).is(".toontalk-top-level-resource")&&!$(b).closest(".toontalk-conditions-panel").is("*")},get_widget:function(){return this},add_to_top_level_backside:function(b,h){var e=this.top_level_widget(),a;b||(b=this);a=b.get_element(!0);e.add_backside_widget(b);e.get_backside_element().appendChild(a);b.render();h&&this.robot_in_training()&&this.robot_in_training().dropped_on(b,e);return a},get_selection:function(){return this},display_message:function(f,h){h||(h={});h.display_on_backside_if_possible?
(h.element=this.get_backside_element(),h.second_choice_element=this.get_frontside_element()):h.element=this.get_frontside_element();b.UTILITIES.display_message(f,h);return f},get_speak_function:function(f){return function(h,e){var a,d,c,g,k;if(window.speechSynthesis){if(a=f.check_message(h),"string"!==typeof a)if(2>a.box_size)f.report_error("Speaking birds need a box with two or more holes.",a);else return(d=h.get_hole_contents(2))&&(d=d&&d.to_float&&d.to_float()),(c=h.get_hole_contents(3))&&(c=c&&
c.to_float&&c.to_float()),(g=h.get_hole_contents(4))&&(g=g&&g.to_float&&g.to_float()),(k=h.get_hole_contents(5))&&(k=k&&k.to_float&&k.to_float()),function(m){var l,v;m?(m=m.get_widget(),l=m.get_text?m.get_text(!0):m.toString(),b.TRANSLATION_ENABLED?b.UTILITIES.translate(l,function(m){v=function(c){var d=b.element.create(m,[],"a response to speaking '"+l+"'");e.event=c;f.process_response(d,a,h,e)};b.UTILITIES.speak(m,{when_finished:v,volume:d,pitch:c,rate:g,voice_number:k})}):(v=function(c){var d=
b.element.create(l,[],"a response to speaking '"+l+"'");e.event=c;f.process_response(d,a,h,e)},b.UTILITIES.speak(l,{when_finished:v,volume:d,pitch:c,rate:g,voice_number:k}))):f.report_error("Speaking birds need something in the second box hole that they can speak.",a)}(h.get_hole_contents(1)),!0}else f.report_error("This browser doesn't support speech output. Try another browser such as Chrome.",a)}},get_listen_function:function(f,h){return function(e,a){var d,c,g,k;if(window.webkitSpeechRecognition||
window.SpeechRecognition){if(d=f.check_message(e),"string"!==typeof d)if(1>d.box_size)f.report_error("Listening birds need a box with one or two holes.",d);else{if(g=e.get_hole_contents(1))g=g&&g.to_float&&g.to_float(),0>g?g=0:1<g&&(g=1);h||(k=e.get_hole_contents(2))&&(k=k.get_text());c=h?function(c){c=parseFloat(c);isNaN(c)||(c=b.number.create_from_bigrat(bigrat.fromDecimal(c)),c.set_description("a number that was heard"),f.process_response(c,d,e,a),b.UTILITIES.stop_listening_for_speech())}:function(c){c=
b.element.create(c,[],"what was spoken");f.process_response(c,d,e,a);b.UTILITIES.stop_listening_for_speech()};b.UTILITIES.listen_for_speech({commands:k,minimum_confidence:g,numbers_acceptable:h,success_callback:c,fail_callback:function(a){f.report_error(a.error,d);b.UTILITIES.stop_listening_for_speech()}});return!0}}else f.report_error("A listening bird can't listen because this browser doesn't support speech input. Try another browser such as Chrome.",d)}},get_description_function:function(f){return function(h,
e){var a=f.check_message(h);if("string"!==typeof a)if(1>a.box_size)f.report_error("Listening birds need a box with two holes.",a);else return function(d){var c,g;g=function(c){c=b.element.create(c,[],d.toString());f.process_response(c,a,h,e)};d=d.get_widget();c=d.get_text?d.get_text(!0):d.toString();b.TRANSLATION_ENABLED?b.UTILITIES.translate(c,function(a){g(a)}):g(c)}(h.get_hole_contents(1)),!0}},create_top_level_widget:function(f){var h=Object.create(b.widget),e=[],a=function(){return!1},d=!1;f||
(f={});h.is_top_level=function(){return!0};h.is_number=a;h.is_box=a;h.is_empty_hole=a;h.is_scale=a;h.is_bird=a;h.is_nest=a;h.is_robot=a;h.is_element=a;h.is_sensor=a;h.is_function_nest=a;h.is_hole=a;h.is_plain_text_element=a;h.is_attribute_widget=a;h.ok_to_set_dimensions=a;h.get_json=function(a,b,d){a=this.get_backside(!0).get_element();a=document.defaultView.getComputedStyle(a,null).getPropertyValue("background-color");b({semantic:{type:"top_level",settings:f},view:{background_color:a}},d)};h.get_type_name=
function(){return"top-level"};h.is_of_type=function(a){return"top-level"===a};h.toString=function(){return"top level widget"};h.get_description=function(){};h.match=function(){return"matched"};h.update_display=function(){this.get_backside_widgets()&&b.UTILITIES.for_each_batch(this.get_backside_widgets().filter(function(a){return a&&a.visible()}),function(a){a.render()})};h.copy=function(){return this};h.visible=function(){return!document.hidden};h.get_parent_of_frontside=function(){};h.get_parent_of_backside=
function(){};h.closest_visible_ancestor=function(){return this};h.get_infinite_stack=function(){return!1};h.get_listeners=function(){return[]};h.top_level_widget=function(){return this};if(b.debugging||b.logging)h.to_debug_string=function(a){var b=$(this.get_backside_element()).offset();return("top-level widget at "+Math.round(b.left)+", "+Math.round(b.top)).substring(0,a)};h.add_sides_functionality(h);h.runnable(h);h.has_parent(h);h.has_backside_widgets(h);h.removed_from_container=function(a,b){this.robot_in_training()||
this.remove_backside_widget(a,!0)};h.widget_side_dropped_on_me=function(a,b){return this.get_backside().widget_side_dropped_on_me(a,b)};h.get_element=function(){return this.get_backside().get_element()};h.get_setting=function(a,d){"undefined"!==typeof f[a]||d||(f[a]=b.DEFAULT_SETTINGS&&b.DEFAULT_SETTINGS[a]);return f[a]};h.set_setting=function(a,b){f[a]=b};h.open_settings=function(){b.SETTINGS.open(h)};h.robot_in_training=function(){if(0<e.length)return e[e.length-1]};h.robot_training_this_robot=
function(){if(1<e.length)return e[e.length-2]};h.robot_started_training=function(a){e.push(a)};h.robot_finished_training=function(){e.pop()};h.save=function(a,e,f){var c=this.get_setting("program_name",b.reset),g=function(a){var g;d=!1;if(h)if(k=b.google_drive.get_status(),"Ready"===k){try{g=JSON.stringify(a,b.UTILITIES.clean_JSON)}catch(r){b.UTILITIES.is_stack_overflow(r)?b.UTILITIES.display_message("Unable to store your project because the depth of widget nesting exceeds the size of the stack.  Perhaps you can launch this browser or another with a larger stack size.",
{only_if_new:!0}):b.UTILITIES.display_message("Unable to store your project because of the error: "+r.message,{only_if_new:!0})}b.google_drive.upload_file(c,"json",g,f);f=void 0}else b.google_drive.connection_to_google_drive_possible()&&("Need to authorize"===k?(b.UTILITIES.display_message("Unable to save to your Google Drive because you need to log in. Click on the settings icon <span class='toontalk-settings-icon'></span> to log in.",{only_if_new:!0}),b.UTILITIES.display_tooltip($(".toontalk-settings-button"))):
console.log("Unable to save to Google Drive because: "+k));e.local_storage&&this.save_to_local_storage(a);f&&f()}.bind(this),h,k;!d&&c&&(e||(e={}),"undefined"===typeof e.google_drive&&(e.google_drive=b.google_drive&&this.get_setting("save_to_google_drive")&&this.get_setting("auto_save_to_cloud")),"undefined"===typeof e.local_storage&&(e.local_storage=this.get_setting("auto_save_to_local_storage")),a?(h=e.google_drive&&!this.get_setting("google_drive_unavailable"))||e.local_storage?(d=!0,b.UTILITIES.get_json_top_level(this,
g)):f&&f():setTimeout(function(){this.save(!0,e,f)}.bind(this),100))};h.publish=function(a,d){b.publish.publish_widget(this.get_setting("program_name"),this,d,a)};h.save_to_local_storage=function(a,d){var c=this.get_setting("program_name"),e=b.UTILITIES.local_storage_program_key(c),g=b.UTILITIES.local_storage_program_meta_data_key(c),f=function(f){h=JSON.stringify(a,b.UTILITIES.clean_json);f||(f={created:d});f.last_modified=d;f.file_size=h.length;b.UTILITIES.store_object(g,f);b.UTILITIES.store_string(e,
h);b.UTILITIES.store_string("toontalk-last-key",e);b.UTILITIES.get_all_locally_stored_program_names(function(a){0>a.indexOf(c)&&(a.push(c),b.UTILITIES.set_all_locally_stored_program_names(a))})},h;d||(d=Date.now());try{b.UTILITIES.retrieve_object(g,f)}catch(t){f=h?"Failed to save state to local storage since it requires "+h.length+" bytes. Error message is "+t:"Error while saving to local storage. Error message is "+t,b.UTILITIES.is_internet_explorer()?console.error("Unresolved difficulties using window.localStorage in IE11: "+
f):b.UTILITIES.display_message(f),this.last_local_storage_error=f}};h.load=function(a,d,e){var c=this.get_setting("program_name"),g=c+".json",f=b.UTILITIES.local_storage_program_key(c),h=this.download_callback(d,e);d=function(a){a?b.google_drive.download_file(a,h):b.UTILITIES.retrieve_string(f,h)};a&&b.google_drive&&"Ready"===b.google_drive.get_status()?b.google_drive.get_toontalk_program_file(g,d):b.UTILITIES.retrieve_string(f,h)};h.download_callback=function(a,d){return function(c){var e;if(c)try{e=
b.UTILITIES.parse_json(c),this.remove_all_backside_widgets(),b.UTILITIES.add_backside_widgets_from_json(this,e.semantic.backside_widgets,{json_of_shared_widgets:e.shared_widgets,shared_widgets:[],shared_html:e.shared_html}),a&&a()}catch(l){b.UTILITIES.display_message("Error encountered loading "+c+": "+l)}else d&&d()}.bind(this)};h.walk_children=function(){};h.render=function(){};h.constrained_by_container=function(){return!1};h.dereference=function(){return this};h.is_widget=!0;b.debugging&&(h._debug_id=
b.UTILITIES.generate_unique_id(),h._debug_string="Top-level widget");h.get_backside(!0).set_visible(!0);return h}}}(window.TOONTALK);window.TOONTALK.backside=function(b){var k=function(f){var h=f.get_widget(),e=h.get_backside_widgets(),a=h.get_backside_widgets_json_views(!0);f.get_backside_dimensions();var d=f.get_element();b.UTILITIES.for_each_batch(e,function(c,e){var g=c.get_element(),f;g&&(a[e]||(a[e]={}),c.start_offset&&g.parentElement?(f=b.UTILITIES.relative_position_from_absolute_position(g.parentElement,c.start_offset),c.start_offset=void 0):f=$(g).position(),c.is_backside()?(a[e].backside_left=b.UTILITIES.left_as_percent(f.left,
g),a[e].backside_top=b.UTILITIES.top_as_percent(f.top,g),k(c)):(a[e].frontside_left=b.UTILITIES.left_as_percent(f.left,g,d),a[e].frontside_top=b.UTILITIES.top_as_percent(f.top,g,d)))})};return{create:function(f){var h=Object.create(this),e=document.createElement("div"),a=$(e),d=1,c=1,g=document.createElement("div"),k=document.createElement("div"),v=f.get_help_URL&&f.get_help_URL(),l=function(a){a?($(g).addClass("toontalk-green-flag-active toontalk-button").removeClass("toontalk-green-flag-inactive toontalk-button"),
$(k).addClass("toontalk-stop-sign-inactive toontalk-button").removeClass("toontalk-stop-sign-active toontalk-button")):($(g).addClass("toontalk-green-flag-inactive toontalk-button").removeClass("toontalk-green-flag-active toontalk-button"),$(k).addClass("toontalk-stop-sign-active toontalk-button").removeClass("toontalk-stop-sign-inactive toontalk-button"))},u=this.create_description_label(h,f),q=function(){var a;a=f.get_running()?"To stop this click on the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>"):
f.can_run()?"Click this to start this running.":"There is nothing to run on this.";b.UTILITIES.give_tooltip(g,a)},t=function(){var a;a=f.get_running()?"Click to stop this from running.":f.can_run()?"This has stopped. Click on the flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" to start running it.":"There is nothing to run here.";b.UTILITIES.give_tooltip(k,a)},n=function(a){U?(b.UTILITIES.add_iframe_popup(v),a.stopPropagation()):(D.href=v,D.target="_blank")},
r=!1,z,C,A,y,J,O,G,R,Q,H,D,L,S,I,P,U,W;b.TRANSLATION_ENABLED&&v&&(v=b.UTILITIES.add_URL_parameter(v,"translate","1"));f.close_button_ok(e)&&(S=function(c){var d=function(){f.robot_in_training()&&f.robot_in_training()!==f&&f.robot_in_training().backside_closed(h);h.is_primary_backside()?h.hide_backside(c):h.remove()},g,k;f.get_running()?(g=f.get_backside_widgets(),g.some(function(a){a=a.get_widget();if(a.is_robot())return a.finish_cycle_immediately(d),k=a,!0}),k?(k.add_body_finished_listener(function(){k.visible()?
a.css({opacity:1}):(f.forget_backside(),b.DEFAULT_QUEUE.start());d()}),h.set_visible(!1)):d(),a.css({opacity:1}),a.addClass("toontalk-animating-element"),a.css({opacity:0}),b.UTILITIES.add_one_shot_event_handler(e,"transitionend",2E3,function(){f.forget_backside()})):d();c.stopPropagation()},L=(L=f.get_description())?"the "+f.get_type_name()+" who "+L:"the "+f.get_type_name(),H=b.UTILITIES.create_close_button(S,"Click to remove this backside of "+L+"."),e.appendChild(H));$(g).addClass("toontalk-green-flag toontalk-green-flag-inactive");
g.addEventListener("click",function(a){f.can_run()?(l(!0),f.set_running(!0),t(),b.DEFAULT_QUEUE.start()):f.is_top_level()?b.UTILITIES.display_message("There is nothing to run.",{element:a.target}):b.UTILITIES.display_message("This "+f.get_type_name()+" has nothing to run. Add some robots on the back.",{element:a.target});f.robot_in_training()&&f.robot_in_training().button_clicked(".toontalk-green-flag",f);a.stopPropagation()});g.addEventListener("mouseenter",t);$(k).addClass("toontalk-stop-sign toontalk-stop-sign-active");
k.addEventListener("click",function(a){l(!1);f.set_running(!1);q();f.robot_in_training()&&f.robot_in_training().button_clicked(".toontalk-stop-sign",f);a.stopPropagation();f.is_top_level()&&b.UTILITIES.stop_audio_objects();f.backup_all()});k.addEventListener("mouseenter",q);e.appendChild(g);e.appendChild(k);b.UTILITIES.use_custom_tooltip(g);b.UTILITIES.use_custom_tooltip(k);v&&(U=0>v.indexOf("://"),D=document.createElement(U?"div":"a"),$(D).addClass("toontalk-help-button notranslate toontalk-widget-help-button"),
D.addEventListener("click",n),D.innerHTML="i",D.translate=!1,b.UTILITIES.give_tooltip(D,"Click to learn more about "+f.get_type_name(!0,!0)+"."),e.appendChild(D));u&&e.appendChild(u);f.is_top_level()&&(y=document.createElement("div"),$(y).addClass("toontalk-settings-button"),y.addEventListener("click",function(a){f.open_settings();a.stopPropagation()}),e.appendChild(y),b.UTILITIES.give_tooltip(y,"Click to change settings or open a different program."));a.addClass("toontalk-backside toontalk-side toontalk-backside-of-"+
f.get_type_name());a.css({"z-index":b.UTILITIES.next_z_index()});b.UTILITIES.when_attached(e,function(){var a;h.inside_conditions_container()?($(g).hide(),$(k).hide(),$(D).hide(),$(H).hide(),a="This will match "+h.toString()+".",h.rerender()):f.is_robot()?a="On the back of the robot you can change the conditions and setting of the robot.":f.is_top_level()?a="This is a work area where you can drag things.":(W=f.toString({inside_tool_tip:!0}),a="You are pointing to the back of "+b.UTILITIES.add_a_or_an(W)+
" You can put robots on the back to make it come 'alive'.");b.UTILITIES.give_tooltip(e,a)});h.get_element=function(){return e};h.get_backside_element=function(){return e};h.get_widget=function(){return f};h.is_resizable=function(){return!0};h.visible=function(){return document.hidden?!1:J};h.set_visible=function(a,b){J=a;!f.is_top_level()&&this.is_primary_backside()&&(this.get_backside_widgets().forEach(function(c){c&&c!==this&&c.set_visible(a,b?b+1:1)}.bind(this)),J&&this.render())};h.get_erased=
function(){return z};h.set_erased=function(a,b,c){if(!a||c||this.inside_conditions_container())z=a,b&&this.rerender()};f.get_backside||(f.get_backside=function(){return h});h.is_primary_backside=function(){return this===this.get_widget().get_backside()};h.inside_conditions_container=function(){return $(this.get_element()).closest(".toontalk-conditions-panel, .toontalk-conditions-container").is("*")};h.get_width=function(){return b.UTILITIES.get_element_width(this.get_element())};h.get_height=function(){return b.UTILITIES.get_element_height(this.get_element())};
h.is_widget=!0;h.get_backside_widgets=function(){return f.get_backside_widgets()};h.get_parent_of_backside=function(){return this.is_primary_backside()?f.get_parent_of_backside():A&&C?C.get_backside(!0):C};h.set_parent_of_backside=function(a,b){!a&&C&&A&&C.remove_backside_widget(this,!0);this.is_primary_backside()&&f.set_parent_of_backside(a,b);C=a;A=b};h.get_parent_of_frontside=function(){return f.get_parent_of_frontside()};h.is_parent_backside=function(){return f.is_parent_backside()};h.get_frontside=
function(a){return f.get_frontside(a)};h.get_frontside_element=function(a){return f.get_frontside_element(a)};h.get_description_text_area=function(){return I};h.set_description_text_area=function(a){I=a};h.get_name_text_input=function(){return P};h.set_name_text_input=function(a){P=a};h.removed_from_container=function(a,b,c,d){h.get_widget().robot_in_training()||this.remove_backside_widget(a,d)};h.drop_on=function(a,b){return a.widget_side_dropped_on_me&&a.widget_side_dropped_on_me(this,b)};h.widget_side_dropped_on_me=
function(a,c){var d,g,h;if(a===this)return(this.get_parent()||this.top_level_widget().get_backside()).widget_side_dropped_on_me(a,c);if(c.robot&&c.robot.visible()&&!this.visible())this.add_backside_widget(a,c),a.dropped_on_other&&a.dropped_on_other(this,c);else return!this.visible()||c.robot&&!c.robot.visible()||(b.sounds&&c.event&&b.sounds.drop.play(),g=a.get_element(this.visible()),a.rerender(),c.event?(e.appendChild(g),b.UTILITIES.set_position_is_absolute(g,!0,c.event)):(c.robot&&(d=$(c.robot.get_frontside_element()).offset()),
d||(d=$(g).offset()),e.appendChild(g),!d||0===d.left&&0===d.top||b.UTILITIES.set_absolute_position(g,d))),f.robot_in_training()&&!c.ignore_training&&c.event&&setTimeout(function(){f.robot_in_training().dropped_on(a,this,c.event)}.bind(this)),a.is_backside()&&a.get_widget().is_element()&&f.is_element()&&(d=a.get_widget(),d.set_backside(void 0),d.remove(c.event),d.set_backside(a)),this.add_backside_widget(a,c),a.dropped_on_other&&a.dropped_on_other(this,c),c.event&&a.get_body&&a.get_body().is_empty()&&
!a.being_trained?setTimeout(function(){(h=a.open_backside())&&$(h.get_element()).find(".toontalk-train-backside-button").click()}):c.event&&!a.is_backside()&&this.get_frontside_element()&&!a.is_sensor()&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:g,where:"back"})),c.event&&a.get_widget().backup_all(),c.event&&this.get_widget().is_top_level()&&!a.is_backside()&&!a.is_sensor()&&window.dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:g,
here:"back"})),c.robot&&!c.robot.visible()&&this.visible()&&c.robot.add_body_finished_listener(function(){var b=function(){c=a.get_element(!0);e.appendChild(c);a.set_visible(!0);a.update_display();$(c).css(this.get_free_location(a))}.bind(this),c;a.get_parent()===this&&(a.get_running()?setTimeout(function(){a.get_parent()&&b()},500):b())}.bind(this)),!a.is_backside()&&a.is_robot()&&this.get_widget().get_running()&&!this.is_top_level()&&this.get_widget().set_running(!0),!0};h.add_backside_widget=function(a,
b){return this.get_widget().add_backside_widget(a,b)};h.add_backside_widgets=function(a,c){var d;0!==a.length&&(b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Adding "+a.length+" backside widgets to "+this),d=a.slice(),b.UTILITIES.set_timeout(function(){var e=this.visible(),g=this.get_element(),h,p,k,n;b.UTILITIES.for_each_batch(d,function(d,l){d&&(b.debugging&&d.get_widget()===f?(b.UTILITIES.report_internal_error("Adding to backside itself or its backside!"),a.splice(l,1)):(c&&
(k=c[l]),h=d.get_element(!0),h.parentElement||(g.appendChild(h),b.logging&&0<=b.logging.indexOf("backside-widgets")&&console.log("Widget element added to backside element.")),h.toontalk_widget_side=d,k&&(d.is_backside()?(p=d.get_widget().get_backside(!0),n={left:k.backside_left,top:k.backside_top},d.get_widget().apply_backside_geometry(),k.advanced_settings_open&&p.set_advanced_settings_showing(!0,p.get_element())):(0===k.frontside_width&&(k.frontside_width=""),0===k.frontside_height&&(k.frontside_height=
""),n={left:k.frontside_left,top:k.frontside_top},!h.style.transform&&d.is_resizable()&&(n.width=k.frontside_width||k.saved_width,n.height=k.frontside_height||k.saved_height)),b.UTILITIES.constrain_css_to_fit_inside(g,n),$(h).css(n)),d.set_visible(e),d.get_widget().rerender()))})}.bind(this),100))};h.get_backside_dimensions=function(){if(1!==d||1!==c)return{x_scale:d,y_scale:c,original_width:O,original_height:G}};h.set_dimensions=function(a){d=a.x_scale;c=a.y_scale;a.original_width&&(O=a.original_width);
a.original_height&&(G=a.original_height)};h.scale_to_fit=function(a,e){var g=b.UTILITIES.scale_to_fit(a,e,450,150);d=g.x_scale;c=g.y_scale};h.scale_to=function(a,e){var g=b.UTILITIES.scale_element(this.get_element(!0),a,e,450,150);d=g.x_scale;c=g.y_scale};h.get_original_width=function(){return O};h.get_original_height=function(){return G};h.get_advanced_settings_showing=function(){return r};h.set_advanced_settings_showing=function(a){var c=this.get_element(),d=$(c).children(".toontalk-settings-backside-button"),
e=$(c).children(".toontalk-advanced-settings-table");0===e.length&&this.add_advanced_settings&&(this.add_advanced_settings(),e=$(c).children(".toontalk-advanced-settings-table"));(r=a)?(e.show(),$(c).addClass("toontalk-backside-showing-advanced-settings"),d.html("<"),b.UTILITIES.give_tooltip(d.get(0),"Click to hide the advanced settings."),this.get_backside_widgets().forEach(function(a){$(a.get_element()).hide()}),c.saved_width=c.style.width,c.saved_height=c.style.height,$(c).css({width:"",height:""})):
(e.hide(),$(c).removeClass("toontalk-backside-showing-advanced-settings"),d.html(">"),b.UTILITIES.give_tooltip(d.get(0),"Click to show the advanced settings."),this.get_backside_widgets().forEach(function(a){$(a.get_element()).show()}),$(c).css({width:c.saved_width,height:c.saved_height}))};h.run_status_changed=function(a){l(a)};b.UTILITIES.when_attached(H||e,function(){var a,c,d,f;b.UTILITIES.get_element_width(e);b.UTILITIES.get_element_height(e);a=$(k).width();c=(c=$(H).width())?c+14:0;$(k).css({right:c});
$(g).css({right:c+a+6});d=$(g).width();D&&($(D).css({right:c+a+d+12}),b.UTILITIES.use_custom_tooltip(D));y&&(f=$(D).width()||0,$(y).css({right:c+a+d+f+12}));H&&b.UTILITIES.use_custom_tooltip(H)});h.save_dimensions=function(){R=d;Q=c;return!0};h.restore_dimensions=function(){this.get_element();R&&(d=R);Q&&(c=Q);this.render_current_scale()};h.render_current_scale=function(){this.scale_backside(e,d,c,O,G);$(".toontalk-text-area, .toontalk-radio-button, .toontalk-text-input").button();$(e).find("[title]").each(function(a,
c){b.UTILITIES.use_custom_tooltip(c)})};h.compare_with=function(a){return this.get_widget().compare_with&&this.get_widget().compare_with(a)};if(b.debugging||b.logging)h.to_debug_string=function(a){return("backside of "+this.get_widget().to_debug_string()).substring(0,a)};e.toontalk_widget_side=h;b.UTILITIES.drag_and_drop(e);b.UTILITIES.resizable_and_scalable(e,function(a,b){h.get_advanced_settings_showing()||(h.set_dimensions({x_scale:a,y_scale:b}),h.render_current_scale())},O,G);e.addEventListener("mouseenter",
function(a){a=f.get_frontside();var c=f.get_parent_of_backside();!a||c&&!c.get_widget().is_top_level()?b.frontside.clear_selection_feedback_stack():b.UTILITIES.highlight_element(a.get_element())});e.addEventListener("mouseleave",function(a){f.is_top_level()||b.UTILITIES.remove_highlight()});h.update_display=function(a){var c=this.get_description_text_area(),d=this.get_name_text_input(),g=e.getBoundingClientRect(),f;c&&(f=this.get_widget().get_description())&&(c.button.value=f);d&&(d.button.value=
this.get_widget().get_name());this.get_erased()?$(e).find(":not(.ui-resizable-handle, .toontalk-green-flag, .toontalk-stop-sign, .toontalk-close-button, .toontalk-help-button)").hide():$(e).find().show();a&&b.UTILITIES.for_each_batch(this.get_backside_widgets().filter(function(a){return!a.get_frontside()}),function(a){var c=a.get_element(!0);a.set_visible(!0);b.UTILITIES.set_css(c,{left:(g.width-50)*Math.random(),top:(g.height-50)*Math.random()});e.appendChild(c);a.update_display()});h.display_updated()};
h.display_updated=function(){$(this.get_element());O||(O=b.UTILITIES.get_element_width(e));G||(G=b.UTILITIES.get_element_height(e))};h.add_to_top_level_backside=function(a,b){return this.get_widget().add_to_top_level_backside(a,b)};f.get_backside_widgets&&(u=f.get_backside_widgets(),h.add_backside_widgets(u,f.get_backside_widgets_json_views()));b.debugging&&(e.id=f._debug_id,h._debug_id=f._debug_id,h._debug_string="backside of "+f._debug_string);return h},toString:function(){return this.get_erased()?
"any backside":"backside of "+this.get_widget()},get_full_description:function(b){return this.get_erased()?"any backside":"backside of "+this.get_widget().get_full_description(b)},remove_element:function(){$(this.get_element()).remove()},get_free_location:function(b,h){var e=this.get_element(),a=e.getBoundingClientRect(),d=$(e).position(),c=function(a,b){return e===document.elementFromPoint(a,b)&&e===document.elementFromPoint(a+f.width,b)&&e===document.elementFromPoint(a,b+f.height)&&e===document.elementFromPoint(a+
f.width,b+f.height)},g,f,k,l,u,q,t,n;b?(f=b.get_element(!0).getBoundingClientRect(),0===f.width&&(f=b.get_default_width?{width:b.get_default_width(),height:b.get_default_height()}:{width:h&&h.default_width||100,height:h&&h.default_height||100})):f={width:h&&h.default_width||100,height:h&&h.default_height||100};if(h&&h.try_first&&c(h.try_first.left+d.left-window.pageXOffset,h.try_first.top+d.top-window.pageYOffset))return h.try_first;g=h&&void 0!==h.margin_fraction?h.margin_fraction:.05;n=1-2*g;k=
d.left+a.width*g-window.pageXOffset;l=d.top+a.height*g-window.pageYOffset;u=k;q=k+a.width*(1-g)-f.width;for(t=l+a.height*(1-g)-f.height;l<t;){if(c(k,l))return{left:k+window.pageXOffset-d.left,top:l+window.pageYOffset-d.top};k+=1.2*f.width;k>q&&(k=u,l+=1.2*f.height)}return{left:a.width*g+Math.random()*(a.width-f.width)*n,top:a.height*g+Math.random()*(a.height-f.height)*n}},create_infinite_stack_check_box:function(f,h){var e=b.UTILITIES.create_check_box(h.get_infinite_stack(),"toontalk-infinite-stack-check-box",
"Copy when dragged.","Check this if you want the "+h.get_type_name()+" to be copied instead of moved."),a=function(a){var b=!h.get_infinite_stack(),d;h.set_infinite_stack(b);h.robot_in_training()&&(d=b?"change dragging to make a copy of ":"change dragging back to moving for ",h.robot_in_training().edited(h,{setter_name:"set_infinite_stack",argument_1:b,toString:d,button_selector:".toontalk-infinite-stack-check-box"}));a.stopPropagation()};e.button.addEventListener("click",a);e.button.addEventListener("touchstart",
a);return e},create_parent_selection_check_box:function(f,h){var e=function(){var a=h.get_parent();if(a&&(a.is_nest()||a.is_hole()||a.is_element()))return a.is_hole()?a.get_parent_of_frontside():a},a=e(),d=function(a){return"Drag the "+a.get_type_name()+" I'm on when dragging"},c=function(a){return"Check this if you want to drag the "+a.get_type_name()+" when you move this widget."},g;if(a){g=b.UTILITIES.create_check_box(h.get_infinite_stack(),"toontalk-parent-selection-check-box",d(a),c(a));var k=
function(a){var b=e();b?(b!==a&&v(b),g.button.disabled=!1,$(g.label).removeClass("ui-state-disabled"),g.container.title=c(b)):u()},v=function(a){g.label.innerHTML=d(a);g.button.innerHTML=c(a)},l=function(){k();return h},u=function(){g.button.checked=!1;g.button.disabled=!0;$(g.label).addClass("ui-state-disabled");g.container.title="Widget moved so this has been disabled. Close and re-open the backside to refresh."};g.button.checked=h!==h.get_selection();g.button.checked||(h.get_selection=l);g.button.addEventListener("click",
function(b){var c=e();e()?(c!==a&&v(c),h.get_selection=g.button.checked?function(){var a=e();k();return a?a.get_selection():h}:l,b.stopPropagation()):u()});return g}},create_click_opens_backside_check_box:function(f,h){var e=b.UTILITIES.create_check_box(h.get_open_backside_only_if_stopped(),"toontalk-click-opens-backside-check-box","Mouse click opens this backside only if I'm stopped.","Check this if you want my backside to open only when I'm stopped. Really useful if there are robots using click sensors."),
a=function(a){var b=!h.get_open_backside_only_if_stopped(),d;h.set_open_backside_only_if_stopped(b);e.button.checked=b;h.robot_in_training()&&(d=b?"change the response to a mouse click to open only if stopped the backside of ":"change the response to a mouse click to always open the backside of ",h.robot_in_training().edited(h,{setter_name:"set_open_backside_only_if_stopped",argument_1:b,toString:d,button_selector:".toontalk-click-opens-backside-check-box"}));a.stopPropagation()};e.button.addEventListener("click",
a);e.button.addEventListener("touchstart",a);return e},create_description_label:function(f,h){var e=h.get_description();if(e)return b.UTILITIES.create_text_element("I'm the backside of a "+h.get_type_name()+" that is "+e)},add_description_setting:function(f){var h=this.get_widget(),e=h.get_type_name(),a=b.UTILITIES.create_text_area(h.get_description(),"toontalk-description-input","I'm ","Type here to provide additional information about this "+e+".",function(a){(a=b.UTILITIES.input_area_drop_handler(a,
h.receive_description_from_dropped.bind(h),h))&&h.robot_in_training()&&h.robot_in_training().dropped_on_text_area(a,h,{area_selector:".toontalk-description-input",setter:"receive_description_from_dropped",toString:"for a widget's description"})}),e=function(){var b=a.button.value.trim();h.set_description(b,!0,!0)};$(a.button).val(h.get_description());a.button.addEventListener("change",e);a.button.addEventListener("mouseout",e);this.set_description_text_area(a);(f||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(a.container));
h.get_description()||a.button.setAttribute("placeholder",h.get_default_description())},add_name_setting:function(f){var h=this.get_widget(),e=h.get_type_name(),a=b.UTILITIES.create_text_input(h.get_name(),"toontalk-name-input",h.get_name_input_label?h.get_name_input_label():"My name is ",h.get_name_input_title?h.get_name_input_title():"Edit the name of this "+e+". There is not much room so keep it short.",void 0,"text",function(a){(a=h.receive_name_from_dropped&&b.UTILITIES.input_area_drop_handler(a,
h.receive_name_from_dropped.bind(h),h))&&h.robot_in_training()&&h.robot_in_training().dropped_on_text_area(a,h,{area_selector:".toontalk-name-input",setter:"receive_name_from_dropped",toString:"for a widget's name"})}),e=function(){h.set_name&&h.set_name(a.button.value.trim(),!0,!0)};a.button.addEventListener("change",e);a.button.addEventListener("mouseout",e);this.set_name_text_input(a);(f||this.get_backside_element(!0)).appendChild(b.UTILITIES.create_row(a.container))},add_advanced_settings:function(){var f=
this.get_widget(),h=this.create_infinite_stack_check_box(this,f),e=this.create_parent_selection_check_box(this,f),a=this.create_click_opens_backside_check_box(this,f),d=f.get_type_name(),c=$("<button>Make a sensor nest</button>").button(),g=$("<button>Make a function bird</button>").button(),k=document.createElement("table"),v=this.get_element(),l=function(a,c){var d=a.get_frontside_element(!0),e;f.add_to_top_level_backside(a,!1);e=c.offset();e.left-=120;0>e.left&&(e.left=0);b.UTILITIES.set_absolute_position(d,
e)};$(v).find(".toontalk-settings-backside-button").get(0);var u;$(k).addClass("toontalk-advanced-settings-table");c.addClass("toontalk-make-sensor_nest_button toontalk-button");c.get(0).addEventListener("click",function(a){var d=b.sensor.create("click","which",void 0,void 0,!0,f);l(d,c);f.robot_in_training()&&f.robot_in_training().created_widget(d,f,".toontalk-make-sensor_nest_button");a.stopPropagation()});c.attr("title","Click to create a nest which receives messages when events happen to this "+
f.get_type_name()+".");g.addClass("toontalk-make-function_bird_button toontalk-button");g.get(0).addEventListener("click",function(a){var c=f.get_function_type&&f.get_function_type(),c=b.bird.create_function(c||d);l(c,g);f.robot_in_training()&&f.robot_in_training().created_widget(c,f,".toontalk-make-function_bird_button");a.stopPropagation()});f.is_number()||f.is_box()&&!f.is_scale()||f.is_element()?g.attr("title","Click to get a bird that flies to functions of "+f.get_type_name(!0)+"."):(g.attr("title",
"There are no functions that operate on "+f.get_type_name(!0)+" (yet)."),g.button("option","disabled",!0));if(0<arguments.length)for(u=0;u<arguments.length;u++)k.appendChild(arguments[u]);this.get_description_text_area()||this.add_description_setting(k);f.set_name&&!this.get_name_text_input()&&this.add_name_setting(k);k.appendChild(b.UTILITIES.create_row(c.get(0),g.get(0),h.container,e&&e.container,a.container));this.is_primary_backside()||(h=$("<button>Remove me and my widget</button>").button(),
h.get(0).addEventListener("click",function(){f.robot_in_training()&&(f.robot_in_training().removed(f),f.robot_in_training().removed(this));this.remove();f.remove()}.bind(this)),h.attr("title","Click to remove this "+f.get_type_name()+" and its backside."),h.addClass("toontalk-remove-backside-and-widget-button"),b.UTILITIES.use_custom_tooltip(h.get(0)),k.appendChild(h.get(0)));b.UTILITIES.use_custom_tooltip(c.get(0));b.UTILITIES.use_custom_tooltip(g.get(0));v.appendChild(k)},get_type_name:function(){return"backside of "+
b.UTILITIES.add_a_or_an(this.get_widget().get_type_name())},hide_backside:function(f){var h,e,a,d,c,g,m;d=$(this.get_element());if(0!==d.length&&(h=this.get_widget(),(e=h.robot_in_training())&&e.get_training_context()===h&&(e.hide_backside(),$(e.get_backside_element()).find(".toontalk-train-backside-button").click(),h.add_to_top_level_backside(e.get_first_in_team())),a=h.get_frontside_element(f&&h.get_parent_of_frontside()&&h.get_parent_of_frontside().is_top_level()),e=d.position(),c=d.parent().closest(".toontalk-backside"),
g=function(c){var d=$(a).position(),e=function(){m&&(this.set_parent_of_backside(void 0,!0),m.is_backside()||m.removed_from_container(this,f,void 0,!0),h.forget_backside&&h.forget_backside());c.remove();f&&h.backup_all()}.bind(this);b.UTILITIES.visible_element(c)?"0"===c.css("opacity")?(c.removeClass("toontalk-animating-element"),c.remove()):(c.addClass("toontalk-side-appearing"),b.UTILITIES.add_one_shot_event_handler(c.get(0),"transitionend",2500,e),b.UTILITIES.set_css(c,{left:d&&d.left,top:d&&d.top,
opacity:.1})):e()}.bind(this),m=h.get_parent_of_backside(),b.UTILITIES.remove_highlight(),k(this),h.backside_geometry=this.get_backside_dimensions(),g(d),this.set_visible(!1),f&&a&&!b.UTILITIES.visible_element(a)&&(e&&b.UTILITIES.set_css(a,{left:e.left,top:e.top}),!(d=b.UTILITIES.widget_side_of_jquery(c))||h.is_robot()&&d.get_widget().is_robot()&&h.get_first_in_team()===d.get_widget().get_first_in_team()||(d.widget_side_dropped_on_me(h,{event:f,ignore_training:!0}),h.render())),b.UTILITIES.for_each_batch(h.get_backside_widgets(),
function(a){a.set_visible(!1)}),h.on_backside_hidden))h.on_backside_hidden()},create_advanced_settings_button:function(f,h){var e=document.createElement("div"),a=$(e);e.innerHTML="&gt;";a.addClass("toontalk-settings-backside-button toontalk-button toontalk-button-style");a.css({"z-index":b.UTILITIES.next_z_index()});a.get(0).addEventListener("click",function(b){f.set_advanced_settings_showing(!f.get_advanced_settings_showing(),f.get_element(),a);b.stopPropagation();h.robot_in_training()&&h.robot_in_training().button_clicked(".toontalk-settings-backside-button",
h)});b.UTILITIES.give_tooltip(a.get(0),"Click to see the advanced settings of this "+h.get_type_name()+".");return a.get(0)},scale_backside:function(f,h,e,a,d){var c=Math.min(1,h,e);1===h&&1===e?!this.get_parent()||this.get_parent().is_backside()?b.UTILITIES.set_css(f,{width:a,height:d,transform:"","transform-origin":""}):b.UTILITIES.set_css(f,{width:"",height:""}):b.UTILITIES.set_css(f,{transform:"scale("+c+", "+c+")","transform-origin":"left top",width:a*h/c,height:d*e/c})},render:function(){b.DISPLAY_UPDATES.pending_update(this)},
rerender:function(){this.visible()&&b.DISPLAY_UPDATES.pending_update(this)},remove_backside_widget:function(b,h){return this.get_widget().remove_backside_widget(b,h)},top_level_widget:function(){return this.get_widget().top_level_widget()},robot_in_training:function(){return this.get_widget().robot_in_training()},remove:function(b){var f;this.is_primary_backside()?this.get_widget().remove():((f=this.get_parent_of_backside())&&(f.is_backside()?f.remove_backside_widget(this,!b):f.removed_from_container&&
(f.is_backside()?f.remove_backside_widget(this,!0):f.removed_from_container(this,b))),this.set_parent_of_backside(void 0),(b=this.get_element())&&$(b).remove())},match:function(b){var f;if(b.is_backside()){if(this.get_erased())return"matched";f=this.get_widget();b=f.match(b.get_widget());return b===f?this:b}b.last_match=this;return b},add_copy_to_container:function(b,h,e){return this.get_widget().add_copy_to_container(b||this.copy(),h,e)},has_ancestor:function(b){var f;return this===b?!0:(f=this.get_parent_of_backside())?
f.has_ancestor(b):!1},has_ancestor_either_side:function(b){var f;if(this===b||this===b.get_backside())return!0;f=this.get_parent_of_frontside();try{if(f||(f=this.get_parent_of_backside()))return f.has_ancestor_either_side(b)}catch(e){console.error("widget.has_ancestor_either_side encountered this error: "+e.message)}return!1},get_backside:function(){return this},copy:function(){return this.get_widget().create_backside()},is_backside:function(){return!0},get_parent:function(){return this.get_parent_of_backside()},
set_parent:function(b){this.set_parent_of_backside(b)},maintain_proportional_dimensions:function(){return!1},constrained_by_container:function(){return!1},set_running:function(){},can_run:function(){return this.get_widget().can_run()},dereference:function(){return this},is_of_type:function(b){return this.get_widget().is_of_type(b)},is_top_level:function(){return this.get_widget().is_top_level()},ok_to_set_dimensions:function(){return!1},add_listener:function(b,h){this.get_widget().add_listener(b,
h)},remove_listener:function(b,h,e){this.get_widget().remove_listener(b,h,e)},get_listeners:function(b){return this.get_widget().get_listeners(b)},is_hole:function(){return!1},is_box:function(){return!1},is_element:function(){return!1},is_sensor:function(){return!1},is_plain_text_element:function(){return!1},is_nest:function(){return!1},is_robot:function(){return!1},save_dimensions:function(){return!1},show:function(){$(this.get_element()).show()},hide:function(){$(this.get_element()).hide()},get_infinite_stack:function(){return!1},
drag_started:function(b,h){this.robot_in_training()&&this.robot_in_training().picked_up(this,b,h)},get_json:function(f,h,e){var a=this.get_backside_dimensions(),d=$(this.get_element()).position(),c;k(this);c=a?{width:a.original_width,height:a.original_height,transform:"scale("+a.x_scale+", "+a.y_scale+")","transform-origin":"left top 0px",left:d.left,top:d.top}:d;a=function(a,b){h({type:"backside",my_widget:a,css:c,erased:this.get_erased(),view:{}},b)}.bind(this);b.UTILITIES.get_json(this.get_widget(),
f,a,e)},get_selection:function(){return this}}}(window.TOONTALK);TOONTALK.creators_from_json.backside=function(b,k){var f=TOONTALK.UTILITIES.create_from_json(b.my_widget,k).create_backside(),h=f.get_element();TOONTALK.UTILITIES.set_css(h,b.css);b.erased&&f.set_erased(b.erased,!1,!0);return f};window.TOONTALK.frontside=function(b){var k=[];return{create:function(f){var h=Object.create(this),e=document.createElement("div"),a=$(e),d=function(c){if(!($(c.target).is(".ui-resizable-handle")||"click"===c.type&&1!==c.which||f.get_open_backside_only_if_stopped()&&f.get_running())){if(a.is(".toontalk-top-level-resource")&&!c.altKey)f.set_running(!f.get_running());else{if(b.open_backside_only_if_alt_key&&!c.altKey)return;f.open_backside();f.robot_in_training()&&f.robot_in_training().backside_opened(f);
f.backup_all()}c.stopPropagation()}},c=function(a,c){var d=a.get_backside(),e=(a.is_empty_hole()?wiget.get_parent_of_frontside():a).get_selection().get_frontside_element(),e=$(e);d&&b.UTILITIES.highlight_element(d.get_element());$(".toontalk-wiggle").removeClass("toontalk-wiggle");e.is(".toontalk-top-level-resource")||e.addClass("toontalk-wiggle");c.stopPropagation()},g;$(e).addClass("toontalk-frontside toontalk-side");f.get_infinite_stack()&&$(e).addClass("toontalk-infinite-stack");e.toontalk_widget_side=
f;b.UTILITIES.drag_and_drop(e);h.get_element=function(){return e};h.get_widget=function(){return f};h.visible=function(){return g};h.set_visible=function(a,c){var d=this.get_widget();(g=a)&&b.UTILITIES.when_attached(this.get_element(!0),d.render.bind(d));d.walk_children&&(c&&0===c%b.maximum_recursion_depth?setTimeout(function(){d.walk_children(function(b){b.set_visible(a,c+1);return!0})}):d.walk_children(function(b){b.set_visible(a,c?c+1:1);return!0}))};e.addEventListener("click",d);e.addEventListener("touchstart",
d);e.addEventListener("mouseenter",function(a){c(f,a);0<=k.indexOf(f)?k=[]:k.push(f)});e.addEventListener("mouseleave",function(a){var d=f.get_backside(),e=f.is_empty_hole()?wiget.get_parent_of_frontside():f;d&&b.UTILITIES.remove_highlight();$(e.get_frontside_element()).removeClass("toontalk-wiggle");k.pop();0<k.length&&c(k[k.length-1],a)});b.debugging&&(e.id=f._debug_id);return h},update_display:function(){return this.get_widget().update_display()},remove:function(){var b=this.get_element();$(b).remove();
b.toontalk_widget_side=null},clear_selection_feedback_stack:function(){k=[]}}}(window.TOONTALK);(function(b){var k=180/Math.PI,f=Math.log(10),h=bigrat.fromInteger(10),e=bigrat.fromValues(1,2),a=bigrat.fromValues(-1,2),d=bigrat.fromInteger(360),c=bigrat.fromDecimal(2*Math.PI),g=Math.log10?Math.log10:function(a){return Math.log(a)/f},m=function(a){var b=bigrat.fromValues(bigrat.toBigInteger(a),1);a=bigrat.subtract(bigrat.create(),a,b);return{integer_part:b,fractional_part:a}},v=function(a){var c=m(a),d=b.number.ZERO(b.number.function_bird_results_default_format),e=b.number.ZERO(b.number.function_bird_results_default_format);
d.set_value(c.integer_part);e.set_value(c.fractional_part);return b.box.create(2,!0,[d,e],"The integer and fraction parts of "+a.toString().replace(",","/"))},l=function(a,b){var c=bigrat.divide(bigrat.create(),a,b),d=m(c);return bigrat.multiply(c,d.fractional_part,b)},u=function(b){b=m(b);return bigrat.isLessThan(b.fractional_part,a)?bigrat.subtract(b.integer_part,b.integer_part,bigrat.ONE):bigrat.isLessThan(b.fractional_part,bigrat.ZERO)||bigrat.isLessThan(b.fractional_part,e)?b.integer_part:bigrat.add(b.integer_part,
b.integer_part,bigrat.ONE)},q=function(a){a=m(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)?bigrat.subtract(a.integer_part,a.integer_part,bigrat.ONE):a.integer_part},t=function(a){a=m(a);return bigrat.isLessThan(a.fractional_part,bigrat.ZERO)||bigrat.equals(a.fractional_part,bigrat.ZERO)?a.integer_part:bigrat.add(a.integer_part,a.integer_part,bigrat.ONE)};window.TOONTALK.number=function(){var a=Object.create(b.widget),c=function(a,b,c,d){var e="",g=100;c=50/c;b/=1+b;if(d)for(d=0;g>=c&&
d<a.length;)e=e+"<span class='toontalk-digit' style='font-size:"+g+"%'>"+a[d]+"</span>",d+=1,"-"!==a[d]&&(g*=b);else for(d=a.length-1;g>=c&&0<d;)e="<span class='toontalk-digit' style='font-size:"+g+"%'>"+a[d]+"</span>"+e,--d,"-"!==a[d]&&(g*=b);return e},d=function(a,b){return 0>a?0:Math.ceil(Math.log(.5/b)/Math.log(a/(1+a)))},e=function(a,b,d){if(a.length<=Math.round(b))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>b)return"";if(5>b)return"<span style='font-size: 80%'>"+
e(a,1.25*b,.8*d)+"</span>";b=b/2-1;return c(a,b,d,!0)+c(a,b,d,!1)},f=function(a){return 0<a.length&&"0"===a.charAt(a.length-1)?f(a.substring(0,a.length-1)):a},k=function(a,b){b||(b=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof b&&"string"!==typeof b))return bigrat.fromValues(a,b);var c=bigrat.create();1===b?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&b.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(b.get_value())):
bigrat.set(c,a,b);return c},l=function(a){switch(a){case "+":return"";case "-":return"&minus;&thinsp;";case "*":return"&times;&thinsp;";case "/":return"&divide;&thinsp;";case "=":return"&equals;&thinsp;";case "^":return"^";default:return b.UTILITIES.report_internal_error("Number has an unsupported operator: "+a),""}},m=function(a){switch(a){case "+":return"toontalk-plus-radio-button";case "-":return"toontalk-minus-radio-button";case "*":return"toontalk-times-radio-button";case "/":return"toontalk-divide-radio-button";
case "=":return"toontalk-set-equal-radio-button";default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}},q=function(a){switch(a){case "decimal":return"toontalk-decimal-radio-button";case "proper_fraction":return"toontalk-proper-fraction-radio-button";case "improper_fraction":return"toontalk-improper-fraction-radio-button";case "scientific_notation":return"toontalk-scientific-notation-radio-button";default:return b.UTILITIES.report_internal_error("Unsupported number format: "+
a),""}},t=function(a,b){switch(a){case "+":return"add "+b+" to";case "-":return"subtract "+b+" from";case "*":return"multiply "+b+" with";case "/":return"divide "+b+" into"}},v=function(a){switch(a){case "+":return"addition";case "-":return"subtraction";case "*":return"multiplication";case "/":return"division";case "=":return"equality";default:return b.UTILITIES.report_internal_error("Unsupported number operator: "+a),""}};a.default_format="mixed_number";a.function_bird_results_default_format="decimal";
a.create=function(c,d,e,g,f,h){var l=Object.create(a),n=k(c,d);e||(e="+");l.is_number=function(){return!0};l.set_value=function(a,c){var d;if(c||!bigrat.equals(n,a))return this.fire_value_change_listeners(n,a),(d=this.get_frontside_element())&&d.dispatchEvent(b.UTILITIES.create_event("value changed",{old_value:n,new_value:a})),n=a,this.rerender(),b.debugging&&(this._debug_string=this.to_debug_string(),"0,0"===a.toString()&&b.UTILITIES.report_internal_error("Impossible numeric value -- can be caused by decimal string not being parsable as a number.")),
this};l.set_value_from_sub_classes=l.set_value;l.fire_value_change_listeners=function(a,b){var c=this.get_listeners("value_changed"),d;c&&(d={type:"value_changed",old_value:a,new_value:b},c.forEach(function(a){a(d)}))};l.get_value=function(){return n};l.set_value_from_decimal=function(a){this.set_value(bigrat.fromDecimal(a));b.debugging&&"0,0"===this.get_value().toString()&&b.UTILITIES.report_internal_error("Number being set to 0/0 from "+a)};l.copy=function(b){return this.add_to_copy(a.create(n[0],
n[1],e,g,f,h),b)};l.get_format=function(){return g||a.default_format};l.set_format=function(a,b,c){g=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_format",argument_1:a,toString:"by changing the format to "+a,button_selector:"."+q(a)});return this};l.get_operator=function(){return e};l.set_operator=function(a,b,c){e=a;b&&this.rerender();c&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_operator",argument_1:a,
toString:"by changing the operator to "+v(a),button_selector:"."+m(a)});return this};l.get_approximate=function(){return h};l.set_approximate=function(a,b){h=a;b&&this.rerender();return this};a.add_standard_widget_functionality(l);l.set_description(f);if(b.listen){var t,r,u;l.add_speech_listeners({commands:"add | plus | sum | addition | subtract | subtraction | take away | times | multiply | multiplication | divide | division | equal | equals | decimal number | decimal | mixed number | mixed | improper fraction | improper | fraction | scientific notation | scientific",
numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var c=b.UTILITIES.get_dragee_copy()||l;switch(a){case "add":case "plus":case "sum":case "addition":c.set_operator("+",!0,!0);break;case "subtract":case "take away":case "subtraction":c.set_operator("-",!0,!0);break;case "times":case "multiply":case "multiplication":c.set_operator("*",!0,!0);break;case "divide":case "divides":case "divide by":case "division":c.set_operator("/",!0,!0);break;case "equal":case "equals":c.set_operator("=",
!0,!0);break;case "decimal number":case "decimal":c.set_format("decimal",!0,!0);break;case "mixed number":case "mixed":c.set_format("mixed_number",!0,!0);break;case "improper fraction":case "improper":case "fraction":c.set_format("improper_fraction",!0,!0);break;case "scientific notation":case "scientific":c.set_format("scientific_notation",!0,!0);break;default:t=parseFloat(a),isNaN(t)?console.log("did not understand spoken command: '"+a+"'"):(c.set_value_from_decimal(t),c.robot_in_training()&&c.robot_in_training().edited(c,
{setter_name:"set_value_from_decimal",argument_1:t,toString:"by changing its value to "+t,button_selector:".toontalk-numerator-input"}))}c.update_display();r="You are now holding "+c.get_text(!0);r!==u&&(l.display_message("You are now holding "+c.get_frontside_element(!0).innerHTML,{display_on_backside_if_possible:!0,duration:4E3,plain_text:r}),u=r)}})}b.debugging&&(l._debug_string=l.toString(),l._debug_id=b.UTILITIES.generate_unique_id(),n._debug_id_new=l._debug_id);return l};a.create_from_bigrat=
function(a){var c=b.number.ZERO();c.set_value(a);return c};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,b){return this.set_value(k(a,b))};a.set_numerator=function(a){return this.set_value(k(a,this.get_value()[1].toString()))};a.set_numerator_to_float=function(a){return this.set_value(bigrat.divide(this.get_value(),bigrat.fromDecimal(a),this.denominator()),!0)};a.set_denominator=function(a){return this.set_value(k(this.get_value()[0].toString(),a))};
a.set_denominator_to_float=function(a){return this.set_value(bigrat.divide(this.get_value(),this.numerator(),bigrat.fromDecimal(a)),!0)};a.ONE=function(){return b.number.create(1)};a.ZERO=function(a){return b.number.create(0,void 0,void 0,a)};a.equals=function(a){return a.equals_number&&a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.compare_with=function(a){if(a.compare_with_number)return-1*a.compare_with_number(this)};a.compare_with_number=
function(a){return bigrat.equals(this.get_value(),a.get_value())?0:bigrat.isGreaterThan(this.get_value(),a.get_value())?1:-1};a.update_display=function(){var a=this.get_frontside(!0),c=function(a,b){var c=a.indexOf('style="');return 0<=c?a.substring(0,c+7)+b+a.substring(c+7):a},d=28,e,g,f,h,k,l;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string(50));a=a.get_element();$(a).is(".toontalk-conditions-contents")?e=$(a):$(a).parent().is(".toontalk-backside, .toontalk-json, .toontalk-robot")?
(e=$(a),k=!0):$(a).parent().is(".toontalk-element-frontside")?(e=$(a),h=k=!0):e=$(a).parent().is(".toontalk-scale-half")?$(a):$(a).parent();0===e.length&&(d=this.get_parent_of_frontside())&&(d.get_widget().is_hole()&&(d=d.get_parent_of_frontside()),e=$(d.get_frontside_element()));1===b.nest.CONTENTS_WIDTH_FACTOR&&1===b.nest.CONTENTS_HEIGHT_FACTOR&&e.is(".toontalk-nest")&&e.parent().is(".toontalk-box-hole")&&!e.parent().is(".toontalk-scale-half")&&(e=e.parent());if($(a).is(".toontalk-carried-by-bird"))f=
g=100;else if($(a).is(".toontalk-element-attribute"))g=200,f=32;else if(k&&(a===e.get(0)||e.is(".toontalk-top-level-resource")))g=$(a).width(),f=$(a).height(),g&&f||(g=this.saved_width||this.get_default_width(),f=this.saved_heieght||this.get_default_height(),$(a).css({width:g,height:f}));else{0<e.length&&(g=e.width(),f=e.height());if(0===g||0===f||0===e.length){b.logging&&0<=b.logging.indexOf("display")&&0<e.length&&console.log("Container has zero dimensions so no display of "+this.to_debug_string());
b.UTILITIES.is_attached(a)||b.UTILITIES.when_attached(a,this.update_display.bind(this));return}e.is(".toontalk-nest")&&(g*=b.nest.CONTENTS_WIDTH_FACTOR,f*=b.nest.CONTENTS_HEIGHT_FACTOR)}l=$(a).children(".toontalk-widget");l.is("*")?l=l.get(0):(l=document.createElement("div"),a.appendChild(l));$(a).removeClass("toontalk-number-eighth-size-border toontalk-number-quarter-size-border toontalk-number-half-size-border toontalk-number-full-size-border");d=this.get_border_size(g,f);h||(4===d?$(a).addClass("toontalk-number-eighth-size-border toontalk-number"):
8===d?$(a).addClass("toontalk-number-quarter-size-border toontalk-number"):16===d?$(a).addClass("toontalk-number-half-size-border toontalk-number"):$(a).addClass("toontalk-number-full-size-border toontalk-number"));h=f-2*d;k=this.to_HTML(g/(h*b.FONT_ASPECT_RATIO),g,f,h,this.get_format(),!0,this.get_operator(),k);b.UTILITIES.on_a_nest_in_a_box(a)&&(k=c(k,"width:"+(g-2*d)+"px;"),k=c(k,"height:"+(f-2*d)+"px;"));l.innerHTML=k;l.translate=!1;$(l).addClass("toontalk-widget notranslate");e.is(".toontalk-box-hole")&&
$(a).css({width:"",height:""});$(a).is(".toontalk-conditions-contents")&&$(a).css({width:b.UTILITIES.get_toontalk_css_numeric_attribute("width",".toontalk-conditions-container")-2*d,height:b.UTILITIES.get_toontalk_css_numeric_attribute("height",".toontalk-conditions-container")-2*d});b.UTILITIES.give_tooltip(a,this.get_title())};a.get_default_width=function(){return 76};a.get_default_height=function(){return 55};a.get_border_size=function(a,b){return 64>=a||64>=b?4:128>=a||128>=b?8:256>=a||256>=b?
16:32};a.to_HTML=function(a,k,n,m,q,t,v,r){var u=!1!==t?" toontalk-top-level-number":"",z=4,y=a,G,A,L,p,w,E;this.is_attribute_widget&&this.is_attribute_widget()?u+=" toontalk-attribute-number":this.get_approximate()&&!this.get_erased()&&(u+=" toontalk-approximate-number");r&&(u+=" toontalk-number-size-unconstrained-by-container");L=v?l(v):"";y||(y=4);m||(m=16);if(this.get_erased&&this.get_erased())return'<div class="toontalk-number toontalk-integer'+u+'" style="font-size: '+m+'px;"></div>';if(0<L.length){--y;
if(E="-"===v&&(this.is_negative()||this.is_zero())&&(this.is_integer()||"improper_fraction"!==q&&"proper_fraction"!==q&&"mixed_number"!==q))--y,L+="&nbsp;";2>y&&(m*=Math.max(1,y)/2,y=2)}if(this.is_integer()&&"scientific_notation"!==q){try{G=bigrat.toBigInteger(this.get_value()).toString()}catch(K){b.UTILITIES.report_internal_error("Error converting number to a string: "+K),G="0"}t=G.length;0<L.length&&t++;4>y&&t>y&&(q=Math.min(4,t),m*=y/q,y=q);return'<div class="toontalk-number toontalk-integer'+
u+'" style="font-size: '+m+'px;">'+L+e(G,y,m)+"</div>"}if(this.get_approximate()||this.is_attribute_widget())if("decimal"===q?A=bigrat.toDecimal(this.get_value()).toString():"scientific_notation"===q&&(A=bigrat.toDecimal(this.get_value()).toExponential(),G=A.indexOf("e"),0<=G&&(p=A.substring(G+1),A=A.substring(0,G))),A)return t=A.length,y>t&&(y=t),0<L.length&&t++,p&&(y-=3+p.length/2),"scientific_notation"===q&&(z+=2),y<z&&t>y&&(q=Math.min(z,t),m=0>=y?Math.max(1,y)/q*m:Math.max(2,y)/q*m),y=p?'&times;10<sup style="font-size: '+
m/2+'px;">'+p+"</sup>":"",m=Math.min(m,k/(b.FONT_ASPECT_RATIO*t)),'<div class="toontalk-number toontalk-approximate-number'+u+'" style="font-size: '+m+'px;">'+L+'<div style="margin-top: '+(n-m)/2+'px">'+A+"</div>"+y+"</div>";A=' style="font-size:'+.45*m+'px;"';if("improper_fraction"===q||!q)return m='<table class="toontalk-number toontalk-improper-fraction'+u+'"'+A+'><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+e(this.numerator_string(),2*y,m)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td class="toontalk-fraction-line-as-table-entry"><div class="toontalk-fraction-line"></div></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+
e(this.denominator_string(),2*y,m)+"</td></tr></table>",""===L?m:"<table class='toontalk-operator-and-fraction'"+A+"><tr><td style='width: 20%;'>"+L+"</td><td>"+m+"</td></tr></table>";if("mixed_number"===q||"proper_fraction"===q){L=this.integer_part();if(L.is_zero())return this.to_HTML(y,k,n,m,"improper_fraction",t,v);p=this.copy({just_value:!0}).subtract(L).absolute_value();return'<table class="toontalk-number toontalk-mixed-number'+u+'"'+A+'><tr><td class="toontalk-number toontalk-integer-part-of-mixed-number">'+
L.to_HTML(y/2,k,n,m,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-mixed-number">'+p.to_HTML(y/2,k,n,m,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===q)return 4>y&&(m*=Math.max(1,y)/4,y=4),'<div class="toontalk-number toontalk-decimal toontalk-top-level-decimal'+u+'" style="font-size: '+m+'px;">'+L+this.decimal_string(y,m)+"</div>";if("scientific_notation"===q){z=bigrat.isNegative(this.get_value());G=this.get_value();E=bigrat.abs(bigrat.create(),
G);p=bigrat.isLessThan(E,bigrat.ONE);bigrat.equals(G,bigrat.ZERO)?p=0:(p?(w=bigrat.divide(bigrat.create(),bigrat.ONE,E),G=bigrat.toBigInteger(w)):G=bigrat.toBigInteger(E),G=G.toString(),p=p?0===w[1].compare(BigInteger.ONE)?-G.length+1:-G.length:G.length-1);w=6+(0===p?1:Math.ceil(g(Math.abs(p)))/2);z&&w++;if(a<w+1)return this.to_HTML(w+1,k,n,m*a/(w+1),q,t,v,r);k=d(y-(Math.min(w,y/2)+1),m);p<k?(n=bigrat.power(bigrat.create(),h,k-p),n=bigrat.multiply(bigrat.create(),this.get_value(),n),k=bigrat.toBigInteger(n).toString().substring(0,
k+1)):k=bigrat.toBigInteger(this.get_value()).toString().substring(0,k+1);if(this.is_integer()||this.is_reciprocal_of_integer())k=f(k);z?(n=k.substring(0,2),k=k.substring(2)):(n=k.substring(0,1),k=k.substring(1));y=c(k,y*(1-w/y),m,!0);0<y.length&&(y="<span class='toontalk-decimal-point'>.</span>"+y);return'<table class="toontalk-number toontalk-scientific_notation'+u+'"'+A+'><tr><td class="toontalk-number toontalk-significand-of-scientific-notation"><div class="toontalk-number toontalk-decimal'+u+
'" style="font-size: '+.9*m+'px;">'+L+n+y+'</td><td class="toontalk-number toontalk-exponent-of-scientific-notation"><div style="font-size: '+m+'px;"> &times;10<sup style="font-size: '+m/2+'px;">'+p+"</sup></div></td></tr></table>"}};a.get_default_description=function(){return this.get_approximate()?"a number from an approximate calculation.":"a number."};a.is_resizable=function(){return!0};a.drop_on=function(a,b){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,b),!0;if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,
b);console.log("No handler for drop of '"+this+"' on '"+a+"'")};a.number_dropped_on_me=function(a,c){var d,e,g,f,h;if(!a.is_backside()){if(a.visible()&&this.visible()&&(c.event||c.robot)){if(c.robot){if(!c.robot.animate_consequences_of_actions())return this.number_dropped_on_me_semantics(a,c);a.robot_waiting_before_next_step=c.robot}d=document.createElement("div");$(d).addClass("toontalk-bammer-down");e=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level");d.style.left="-10px";
d.style.top=e.height()+"px";0<e.length&&e.get(0).appendChild(d);f=this.get_frontside_element();g=$(f).offset();g.left-=.75*$(d).width();g.left+=.5*$(f).width()+.1*$(d).width();g.top-=.5*$(f).height()+.4*$(d).height();f=function(){b.sounds&&b.sounds.bammer_hammer.play();this.number_dropped_on_me_semantics(a,c)&&c.robot&&(this.rerender(),c.robot.run_next_step());c.event&&this.backup_all();$(d).removeClass("toontalk-bammer-down");b.UTILITIES.set_timeout(function(){var a=e.offset();a||(a={left:0,top:0});
$(d).addClass("toontalk-bammer-away");g.left=a.left+e.width()-100;g.top=a.top+e.height()+100;h=function(){$(d).remove()};b.UTILITIES.animate_to_absolute_position(d,g,h,c.robot&&c.robot.transform_animation_speed(b.animation_settings.BAMMER_ANIMATION_SPEED));$(d).css({opacity:.01})})}.bind(this);b.UTILITIES.animate_to_absolute_position(d,g,f,c.robot&&c.robot.transform_animation_speed(b.animation_settings.BAMMER_ANIMATION_SPEED));$(a.get_frontside_element(!0)).css({"z-index":b.UTILITIES.next_z_index()});
$(d).css({opacity:1,"z-index":b.UTILITIES.next_z_index()+100});return this}return this.number_dropped_on_me_semantics(a,c)}};a.number_dropped_on_me_semantics=function(a,c){c&&c.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);a.get_approximate()&&this.set_approximate(!0);a.remove({remove_backside:!0});switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a,c);case "=":return this.set_value(a.get_value());
case "^":return this.power(a);default:b.UTILITIES.report_internal_error("Number received a number with unsupported operator: "+a.get_operator())}};a.widget_side_dropped_on_me=function(a,c){var d;if(a.number_dropped_on_me)return this.number_dropped_on_me(a,c);(d=a.get_frontside_element())&&this.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:d,where:"front"}));return!1};a.add=function(a){this.set_value(bigrat.add(this.get_value(),this.get_value(),a.get_value()),
!0);return this};a.subtract=function(a){this.set_value(bigrat.subtract(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.multiply=function(a){this.set_value(bigrat.multiply(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.divide=function(a,c){var d;if(a.is_zero())return d="Can't divide by zero. Operation ignored.",c&&c.robot&&(d+=" Caused by the robot who "+c.robot),b.UTILITIES.display_message(d),this;this.set_value(bigrat.divide(this.get_value(),this.get_value(),
a.get_value()),!0);return this};a.minimum=function(a){this.set_value(bigrat.min(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.maximum=function(a){this.set_value(bigrat.max(this.get_value(),this.get_value(),a.get_value()),!0);return this};a.power=function(a){this.set_value(bigrat.power(this.get_value(),this.get_value(),bigrat.toInteger(a.get_value())),!0);return this};a.absolute_value=function(){this.set_value(bigrat.abs(this.get_value(),this.get_value()),!0);return this};a.is_zero=
function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(a){var b="";if(this.get_erased())return"erased number";"+"===this.get_operator()||a&&a.without_operator||(b=this.get_operator());return b+bigrat.str(this.get_value())};a.get_text=function(a){var c=this.get_format(),d="";switch(this.get_operator()){case "-":d="subtract ";break;case "*":d="multiply by ";break;case "/":d="divide by ";break;case "=":d=
"make what I'm dropped on equal to "}var e;if(this.get_approximate()||this.is_attribute_widget&&this.is_attribute_widget())return"approximately "+bigrat.toDecimal(this.get_value()).toString();if(this.is_integer()||"improper_fraction"===c)return a?d+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):d+this.toString({without_operator:!0});c=this.integer_part();if(c.is_zero())return a?d+b.UTILITIES.number_to_words(this.toString({without_operator:!0})):d+this.toString({without_operator:!0});
e=this.copy({just_value:!0}).subtract(c).absolute_value();return a?d+b.UTILITIES.number_to_words(c.toString({without_operator:!0}))+(a?" and ":" ")+b.UTILITIES.number_to_words(e.toString({without_operator:!0})):d+c+" "+e};a.to_float=function(){return bigrat.toDecimal(this.get_value())};a.get_type_name=function(a){return a?"numbers":"number"};a.get_help_URL=function(){return"docs/manual/numbers.html"};a.get_json=function(a,c,d){c({type:"number",operator:this.get_operator(),numerator:b.UTILITIES.string_to_array(this.numerator_string(),
100),denominator:b.UTILITIES.string_to_array(this.denominator_string(),100),format:this.get_format(),approximate:this.get_approximate()},d)};b.creators_from_json.number=function(b){if(b)return Array.isArray(b.numerator)&&(b.numerator=b.numerator.join("")),Array.isArray(b.denominator)&&(b.denominator=b.denominator.join("")),a.create(b.numerator,b.denominator,b.operator,b.format,b.description,b.approximate)};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)||0===this.get_value()[0].compare(BigInteger.ZERO)};
a.is_reciprocal_of_integer=function(){return 0===this.get_value()[0].compare(BigInteger.ONE)&&0!==this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=
function(){return this.create(this)};a.decimal_string=function(b,g){var k,l,n,m,q;if(this.is_integer())return this.numerator_string();k=this.get_value();l=a.create(k[0],k[1]);n=l.integer_part();k=n.toString();"0"===k&&this.is_negative()&&(k="-"+k);m=l.get_value();bigrat.subtract(m,m,n.get_value());l=b-(Math.min(k.length,b/2)+1);q=d(l,g);n=Math.min(k.length,b/2);bigrat.isNegative(m)&&bigrat.abs(m,m);var t=bigrat.fromValues(m[0],1);m=bigrat.fromValues(m[1],1);if(bigrat.equals(t,bigrat.ZERO))q="0";else{var v=
"",r=bigrat.create(),u;bigrat.create();var y=bigrat.create();for(bigrat.multiply(t,t,h);q>v.length;){if(bigrat.isLessThan(t,m))v+="0";else if(bigrat.divide(r,t,m),u=bigrat.toBigInteger(r),v+=u.toString(),bigrat.subtract(y,r,bigrat.fromValues(u,1)),bigrat.multiply(t,y,m),bigrat.equals(t,bigrat.ZERO)){v=f(v);break}bigrat.multiply(t,t,h)}q=v}l=q.length<l?q:c(q,l,g,!0);return e(k,n,g)+"<span class='toontalk-decimal-point'>.</span>"+l};a.match=function(a){if(this.get_erased&&this.get_erased()){if(a.get_widget().match_with_any_number)return a.get_widget().match_with_any_number();
this.last_match=a;return this}return a.match_with_this_number?a.match_with_this_number(this):(this.last_match=a,this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){if(a.equals(this)&&a.get_operator()===this.get_operator())return"matched";a.last_match=this;return a};a.get_custom_title_prefix=function(){var a;a="="===this.get_operator()?"Drop me on another number I'll give him my value.":"/"===this.get_operator()?"Drop me on another number I'll divide him by my value.":
"Drop me on another number and I'll "+t(this.get_operator(),"myself")+" him.";this.get_approximate()&&(a+="\nI look a bit yellow because I'm the result of an "+b.UTILITIES.encode_HTML_for_title("<i>approximate</i>")+" calculation.");return a};return a}();window.TOONTALK.number_backside=function(){return{create:function(a){var c=b.backside.create(a),d=c.get_element(),e=document.createElement("div"),g=a.numerator_string(),f=a.denominator_string(),h=b.UTILITIES.create_text_area(g,"toontalk-numerator-input",
"","Type here to edit the numerator",void 0,"number"),k=b.UTILITIES.create_text_area(f,"toontalk-denominator-input","","Type here to edit the denominator",void 0,"number"),l=b.UTILITIES.create_radio_button("number_format","decimal","toontalk-decimal-radio-button","Decimal number","Display number as a decimal.",!0),n=b.UTILITIES.create_radio_button("number_format","proper_fraction","toontalk-proper-fraction-radio-button","Mixed number","Display number as an integer part and a proper fraction.",!0),
m=b.UTILITIES.create_radio_button("number_format","improper_fraction","toontalk-improper-fraction-radio-button","Improper fraction","Display number as a simple fraction.",!0),q=b.UTILITIES.create_radio_button("number_format","scientific_notation","toontalk-scientific-notation-radio-button","Scientific notation","Display number as a decimal between 1 and 10 multiplied by ten to some power.",!0),t=b.UTILITIES.create_radio_button("operator","+","toontalk-plus-radio-button","+","Add me to what I'm dropped on.",
!0),v=b.UTILITIES.create_radio_button("operator","-","toontalk-minus-radio-button","&minus;","Subtract me from what I'm dropped on.",!0),u=b.UTILITIES.create_radio_button("operator","*","toontalk-times-radio-button","&times;","Multiply me with what I'm dropped on.",!0),I=b.UTILITIES.create_radio_button("operator","/","toontalk-divide-radio-button","&divide;","I will divide what I'm dropped on.",!0),P=b.UTILITIES.create_radio_button("operator","=","toontalk-set-equal-radio-button","&equals;","Set what I'm dropped on to my value.",
!0),U=function(b){var c=h.button.value.trim(),d=k.button.value.trim(),e,p,l,n,m=function(a,b,c){if(1>a.length)return{message:"Empty "+b+" treated as 1.",replacement:"1"};if("-"===a.charAt(0)){if(c)return{message:"'-' only allowed as the first character of the "+b+". Ignoring extra '-'s.",replacement:m(a,b).replacement};a=m(a.substring(1,a.length),b,!0);a.message||(a.replacement="-"+a.replacement);return a}return/^\d+$/.test(a)?{replacement:a}:{message:"The "+b+" can only contain digits. '"+a+"' doesn't make sense.",
replacement:a.replace(/[^\d]*/g,"")}},w;if(c!==g||d!==f){w=m(c,"numerator");w.message&&(e=parseFloat(c),isNaN(e)?(a.display_message(w.message,{display_on_backside_if_possible:!0}),c=w.replacement):p=bigrat.fromDecimal(e));"0"===d?(a.display_message("It doesn't make sense for a fraction to have a denominator of 0. Resetting it to 1.",{display_on_backside_if_possible:!0}),d="1"):(w=m(d,"denominator"),w.message&&(l=parseFloat(d),isNaN(l)?(a.display_message(w.message,{display_on_backside_if_possible:!0}),
d=w.replacement||"1"):n=bigrat.fromDecimal(l)));if(p&&n)a.set_value(bigrat.divide(a.get_value(),p,n),!0);else if(p)a.set_value(bigrat.divide(a.get_value(),p,bigrat.fromValues(d,1)),!0);else if(n)a.set_value(bigrat.divide(a.get_value(),bigrat.fromValues(c,1),n),!0);else if(!a.set_from_values(c,d)&&!isNaN(l))return;g=a.numerator_string();f=a.denominator_string();a.robot_in_training()&&(b=b.target.className.split(" ",1)[0],"toontalk-denominator-input"===b?a.robot_in_training().edited(a,{setter_name:n?
"set_denominator_to_float":"set_denominator",argument_1:d,toString:"by changing the value of the denominator to "+d,button_selector:"."+b}):a.robot_in_training().edited(a,{setter_name:p?"set_numerator_to_float":"set_numerator",argument_1:c,toString:"by changing the value of the numerator to "+c,button_selector:"."+b}));a.rerender()}},W=function(){var c=b.UTILITIES.selected_radio_button(l,n,m,q);c&&(c=c.button.value,a.set_format(c,!0,!0))},V=function(){var c=b.UTILITIES.selected_radio_button(t,v,u,
I,P);c&&(c=c.button.value,a.set_operator(c,!0,!0))},M=b.UTILITIES.create_horizontal_table(h.container,e,k.container),ca=b.UTILITIES.create_div(l,n,m,q),ea=b.UTILITIES.create_div(t,v,u,I,P),aa=b.backside.create_advanced_settings_button(c,a),ha=c.update_display.bind(c),p=c.add_advanced_settings,w=function(){switch(a.get_format()){case "decimal":return l;case "improper_fraction":return m;case "mixed_number":case "proper_fraction":return n;case "scientific_notation":return q}},E=function(){switch(a.get_operator()){case "+":return t;
case "-":return v;case "*":return u;case "/":return I;case "=":return P}};e.innerHTML="/";$(e).addClass("ui-widget");h.button.addEventListener("change",U);h.button.addEventListener("mouseout",U);h.button.addEventListener("mouseenter",function(){g=h.button.value.trim()});k.button.addEventListener("change",U);k.button.addEventListener("mouseout",U);k.button.addEventListener("mouseenter",function(){f=k.button.value.trim()});d.appendChild(M);d.appendChild(aa);l.button.addEventListener("change",W);n.button.addEventListener("change",
W);m.button.addEventListener("change",W);q.button.addEventListener("change",W);b.UTILITIES.check_radio_button(w());b.UTILITIES.check_radio_button(E());t.button.addEventListener("change",V);v.button.addEventListener("change",V);u.button.addEventListener("change",V);I.button.addEventListener("change",V);P.button.addEventListener("change",V);c.update_display=function(){$(h.button).val(a.numerator_string());$(k.button).val(a.denominator_string());b.UTILITIES.check_radio_button(w());b.UTILITIES.check_radio_button(E());
ha()};c.add_advanced_settings=function(){p.call(c,ca,ea);$(ca).controlgroup().removeClass("ui-controlgroup");$(ea).controlgroup().removeClass("ui-controlgroup")};b.UTILITIES.when_attached(d,function(){c.is_primary_backside()||a.add_listener("value_changed",function(){c.rerender()})});return c}}}();window.TOONTALK.number["function"]=function(){var a=b.create_function_table(),e=function(a){return bigrat.toDecimal(l(a,d))},g=function(a){return bigrat.toDecimal(l(a,c))},f=function(){return!0};a.add_function_object("sum",
function(c,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.add,"sum",d)},"The bird will return with the sum of the numbers in the box.","+");a.add_function_object("difference",function(c,d){return a.n_ary_widget_function(c,b.number.ZERO,b.number.subtract,"difference",d)},"The bird will return with the result of subtracting the numbers in the box from the first number.","-");a.add_function_object("product",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.multiply,"product",
d)},"The bird will return with the product of the numbers in the box.","\u00c3\u0192\u00c6\u2019\u00c3\u00a2\u00e2\u201a\u00ac\u00e2\u20ac\u009d");a.add_function_object("division",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.divide,"division",d)},"The bird will return with the result of dividing the numbers into the first number in the box.","\u00c3\u0192\u00c6\u2019\u00c3\u201a\u00c2\u00b7");a.add_function_object("modulo",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(l),
2,"modulo",c)},"The bird will return with the first number modulo the second number. For positive numbers this is like the remainder after division.","mod");a.add_function_object("minimum",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.minimum,"minimum",d)},"The bird will return with the smallest of the numbers in the box.","min");a.add_function_object("maximum",function(c,d){return a.n_ary_widget_function(c,b.number.ONE,b.number.maximum,"maximum",d)},"The bird will return with the largest of the numbers in the box.",
"max");a.add_function_object("absolute value",function(c,d){return a.n_ary_function(c,function(a){var d=b.number.ZERO(c.get_hole_contents(1).get_format());bigrat.abs(d.get_value(),a);return d},1,"absolute value",d)},"The bird will return with the positive version of the number.","abs");a.add_function_object("power",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(function(a,b){var c=bigrat.power(bigrat.create(),a,b[0].valueOf()),d=b[1].valueOf();return 1===d?c:bigrat.nthRoot(bigrat.create(),
c,d)},function(a){return 0!==a[1][1].compare(BigInteger.ONE)}),2,"power",c)},"The bird will return with the first number to the power of the second number.");a.add_function_object("logarithm",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 1===arguments.length?Math.log(arguments[0]):Math.log(arguments[0])/Math.log(arguments[1])},f),1,"logarithm",c)},"The bird will return an approximation of the logarithm number of the first number.\nIf a second number is provided then it is used as the base of the logarithm.\nIf there is no second number the logarithm is natural (the base is e).",
"log");a.add_function_object("random",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(){return 0===arguments.length?Math.random():1===arguments.length?Math.random()*arguments[0]:arguments[0]<arguments[1]?Math.random()*(arguments[1]-arguments[0])+arguments[0]:Math.random()*(arguments[0]-arguments[1])+arguments[1]}),0,"random",c)},"The bird will return a random number between the first and second numbers.\nIf the second number isn't provided a number less than the first number is returned.\nIf no numbers are given then the bird returns with a number between 0 and 1.",
"rand");a.add_function_object("round",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(u),1,"round",c)},"The bird will return the number rounded to the nearest integer.");a.add_function_object("floor",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(q),1,"floor",c)},"The bird will return the largest integer less than or equal to the number.");a.add_function_object("ceiling",function(b,c){return a.n_ary_function(b,a.bigrat_function_to_widget_function(t),
1,"ceiling",c)},"The bird will return the smallest integer greater than or equal to the number.","ceil");a.add_function_object("delay",function(c,d){var e=Date.now(),g=a.check_message(c),f;if("string"!==typeof g)if(2>g.box_size)a.report_error("Delay function birds need a number in the second hole saying how long to wait.",g);else return f=c.get_hole_contents(1).to_float(),setTimeout(function(){var f=b.number.ZERO(b.number.function_bird_results_default_format);f.set_value_from_decimal((Date.now()-
e)/1E3);f.set_approximate(!0);a.process_response(f,g,c,d)},1E3*f),!0},"The bird will return after waiting the number of seconds in the second hole. She will return with the exact amount of time since she received the box.");a.add_function_object("integer and fraction parts",function(b,c){return a.n_ary_function(b,v,1,"integer and fraction parts",c)},"The bird will return with a box containing the integer part and the fraction.","parts");a.add_function_object("sine",function(b,c){return a.n_ary_function(b,
a.numeric_javascript_function_to_widget_function(function(a){return Math.sin(a/k)},!0,e),1,"sine",c)},"The bird will return with an approximation of the sine of the number (in degrees).","sin");a.add_function_object("cosine",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return Math.cos(a/k)},!0,e),1,"cosine",c)},"The bird will return with an approximation of the cosine of the number (in degrees).","cos");a.add_function_object("arc tangent",function(b,
c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a){return k*Math.atan(a)},!0),1,"arc tangent",c)},"The bird will return with an approximation of the arc tangent (in degrees) of the number.","atan");a.add_function_object("arc tangent of y and x",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(function(a,b){return k*Math.atan2(a,b)},!0),2,"arc tangent of y and x",c)},"The bird will return with an approximation of the arc tangent (in degrees) of the point where the first number is the y coordinate and the second one is the x.",
"atan2");a.add_function_object("sine (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.sin,!0,g),1,"sine (in radians)",c)},"The bird will return with an approximation of the sine of the number (in radians).","sin rad");a.add_function_object("cosine (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.cos,!0,g),1,"cosine (in radians)",c)},"The bird will return with an approximation of the cosine of the number (in radians).",
"cos rad");a.add_function_object("arc tangent (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan,!0),1,"arc tangent (in radians)",c)},"The bird will return with an approximation of the arc tangent (in radians) of the number.","atan rad");a.add_function_object("arc tangent of y and x (in radians)",function(b,c){return a.n_ary_function(b,a.numeric_javascript_function_to_widget_function(Math.atan2,!0),2,"arc tangent of y and x (in radians)",
c)},"The bird will return with an approximation of the arc tangent (in radians) of the point where the first number is the y coordinate and the second one is the x.","atan2 rad");a.add_function_object("turn into words",b.widget.get_description_function(a),"The bird will return with words describing what is in the second hole.","describe",["a widget"]);a.add_function_object("speak",b.widget.get_speak_function(a),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.",
"speak",["a widget"]);a.add_function_object("listen for a number",b.widget.get_listen_function(a,!0),"The bird will cause the browser to listen to the next number said and give the number to the bird in the first hole. If you put a number between 0 and 1 in the second hole then only recognitions with at least that confidence will be considered. ","listen",[]);return a.get_function_table()}()})(window.TOONTALK);(function(b){var k=function(f,h,e,a){var d;f&&0<=e&&f.maintain_proportional_dimensions()&&f.get_default_width?(d=f.get_default_width(),f=f.get_default_height(),e/d>=a/f?(d=d*a/f,e={left:(e-d)/2,top:0,width:d,height:a}):(d=f*e/d,e={left:0,top:(a-d)/2,width:e,height:d})):(f.is_backside()&&(f.update_display(),f.scale_to(e,.92*a)),e={left:0,top:0});b.UTILITIES.set_css(h,e)};window.TOONTALK.box=function(b){var f=Object.create(b.widget);f.create=function(e,a,d,c,g){var h=Object.create(f),v=[];"undefined"===
typeof a&&(a=!0);h.is_box=function(){return!0};h.get_horizontal=function(){return a};h.set_horizontal=function(b,c,d){a=b;c&&($(this.get_frontside_element()).children(".toontalk-side").remove(),this.rerender());d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_horizontal",argument_1:b,toString:"by changing the orientation to "+(b?"horizontal":"vertical"),button_selector:b?".toontalk-horiztonal-radio-button":"toontalk-vertical-radio-button"});return this};h.get_hole=
function(a){return v[a]};h.get_hole_contents=function(a){return v[a]&&v[a].get_contents()};h.set_hole=function(a,c,d){var e;v[a].set_contents(c);if(d){c&&c.save_dimensions();d=this.get_frontside_element();a=$(d).children(".toontalk-hole-number-"+a);a.empty();if(!c)return;e=this.get_hole_dimensions();d=c.get_element(!0);0<a.length&&a.get(0).appendChild(d);k(c,d,e.width,e.height);$(d).find("iframe").attr("width",e.width).attr("height",e.height-20);c.rerender()}this.rerender();b.debugging&&(this._debug_string=
this.to_debug_string())};h.get_holes=function(){return v};h.temporarily_remove_contents=function(a,b){var c=this.get_index_of(a);this.temporarily_removed_contents||(this.temporarily_removed_contents=[]);this.temporarily_removed_contents[c]=a;this.set_hole(c,void 0,b);return function(){this.set_hole(c,a,b);this.temporarily_removed_contents[c]=void 0}.bind(this)};h.get_contents_temporarily_removed=function(a){if(this.temporarily_removed_contents)return this.temporarily_removed_contents[a]};h.set_contents=
function(a){b.UTILITIES.for_each_batch(a,function(a,b){v[b].set_contents(a)})};h.get_size=function(){return e};h.set_size=function(a,c,d){var g,f;if(e===a||0>a||isNaN(a)||a>Number.MAX_SAFE_INTEGER)return!1;f=this.visible();v.length=a;if(a>e)for(g=e;g<a;g++)v[g]=b.box_hole.create(g),v[g].set_parent_of_frontside(h),v[g].set_visible(f);e=a;c&&(this.constrained_by_container()?(c=this.get_parent_of_frontside(),c.is_hole()&&(c=c.get_parent_of_frontside()),c.rerender()):this.rerender());(c=this.get_listeners("contents_or_properties_changed"))&&
c.forEach(function(b){b({type:"contents_or_properties_changed",new_size:a})});d&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_size",argument_1:a,oString:"by changing the number of holes to "+a+" of the box",button_selector:".toontalk-box-size-input"});b.debugging&&(this._debug_string=this.to_debug_string());return!0};h.get_hole_dimensions=function(){var c=this.get_frontside_element(),d=$(c).width()||b.box.get_default_width(),c=$(c).height()||b.box.get_default_height();
return a?{width:d/e,height:c}:{width:d,height:c/e}};h.receive_size_from_dropped=function(a,c){var d;if(a.is_number())return d=b.number.create(this.get_size()),d.number_dropped_on_me_semantics(a),d=Math.max(0,Math.round(d.to_float())),this.set_size(d),d.toString()};h.copy=function(b){var c;b||(b={});c=v.map(function(a){if(a=a.get_contents())return a.copy(b)});c=f.create(e,a,c,this.get_description(),this.get_name());return this.add_to_copy(c,b)};h.generate_name=function(){for(var a="",b=this.get_size();0<
b;)a+=";",b--;return a};h.add_standard_widget_functionality(h);h.has_name(h);h.set_name(g);for(g=0;g<e;g++)v[g]=b.box_hole.create(g),v[g].set_parent_of_frontside(h);h.set_description(c);if(b.listen){var l,u,q;h.add_speech_listeners({commands:"left to right | horizontal | top to bottom | vertical",numbers_acceptable:!0,descriptions_acceptable:!0,success_callback:function(a){var c=b.UTILITIES.get_dragee_copy()||h;switch(a){case "left to right":case "horizontal":c.set_horizontal(!0,!0,!0);break;case "top to bottom":case "vertical":c.set_horizontal(!1,
!0,!0);break;default:l=parseInt(a),isNaN(l)?console.log("did not understand '"+a+"'"):c.set_size(l,!0,!0)}c.update_display(!0);a=c.get_size();u="You are now holding a "+(c.get_horizontal()?"horizontal":"vertical")+" box with "+(1<a?a+" holes":0===a?"no holes":"one hole")+".";u!==q&&(h.display_message(u,{display_on_backside_if_possible:!0,duration:4E3}),q=u)}})}d&&h.set_contents(d);b.debugging&&(h._debug_id=b.UTILITIES.generate_unique_id(),h._debug_string=h.to_debug_string());return h};f.create_backside=
function(){return b.box_backside.create(this)};f.equals=function(b){return b.equals_box&&this.get_type_name()===b.get_type_name()&&b.equals_box(this)};f.equals_box=function(b){var a=this.get_size(),d,c,e;if(a!==b.get_size())return!1;for(d=0;d<a;d++)if(c=this.get_hole_contents(d),e=b.get_hole_contents(d),!c&&e||c&&!e||c&&e&&(!c.equals||!c.equals(e)))return!1;return!0};f.compare_with=function(b){if(b.compare_with_box)return-1*b.compare_with_box(this)};f.compare_with_box=function(b){var a=this.get_size(),
d=b.get_size(),c,e;if(a>d)return 1;if(a<d)return-1;for(d=0;d<a;d++){c=this.get_hole_contents(d);e=b.get_hole_contents(d);if(c&&!e)return 1;if(!c&&e)return-1;if(c&&e)if(c.compare_with){if(c=c.compare_with(e),1===c||-1===c)return c}else return}return 0};f.match=function(b){if(this.get_erased&&this.get_erased()){if(b.get_widget().match_with_any_box)return b.get_widget().match_with_any_box();this.last_match=b;return this}return b.match_with_this_box?b.match_with_this_box(this):(this.last_match=b,this)};
f.match_with_any_box=function(){return"matched"};f.match_with_this_box=function(e){var a=this.get_size(),d=[],c,g,f;if(a!==e.get_size())return e.last_match=this,e;for(c=0;c<a;c++)if(f=e.get_hole_contents(c))if(g=this.get_hole_contents(c)){g=b.UTILITIES.match(f,g);if(g.is_widget)return g;"matched"!==g&&(d=0===d.length?g:d.concat(g))}else if(g=this.get_contents_temporarily_removed(c))d.push(g);else return e.last_match=this,e;return 0<d.length?d:"matched"};f.toString=function(b){var a="",d=this.get_size(),
c,e,f=this.get_type_name()+" that looks like ";for(c=0;c<d;c++)e=this.get_hole(c),a+=e.get_full_description(b),c<d-1&&(a+=" | ");return f+"["+a.replace(f,"")+"]"};f.get_type_name=function(b){return b?"boxes":"box"};f.get_default_description=function(){return"a box for holding things."};f.get_help_URL=function(){return"docs/manual/boxes.html"};f.get_json=function(e,a,d){var c=[],g=function(d,f){var h,k;d>=this.get_size()?a({type:"box",size:this.get_size(),contents:c,horizontal:this.get_horizontal(),
name:this.get_name()},f):(h=this.get_hole_contents(d))?h.is_primary_backside&&h.is_primary_backside()?(k=function(a,b){c.push({widget:a,is_backside:!0});g(d+1,b)}.bind(this),b.UTILITIES.get_json(h.get_widget(),e,k,f)):h.is_widget?(k=function(a,b){c.push({widget:a});g(d+1,b)}.bind(this),b.UTILITIES.get_json(h,e,k,f)):(k=function(a,b){c.push(a);g(d+1,b)}.bind(this),h.get_json(e,k,f)):(c.push(null),g(d+1,f))}.bind(this);g(0,d)};f.walk_children=function(b){var a=this.get_size(),d,c;for(d=0;d<a;d++)if(c=
this.get_hole_contents(d)){if(!b(c))break}else if(!b(this.get_hole(d)))break};b.creators_from_json.box=function(e,a){if(e)return f.create(e.size,e.horizontal,b.UTILITIES.create_array_from_json(e.contents,a),e.description,e.name)};f.update_display=function(){var e=this.get_frontside(!0).get_element(),a=this.get_size(),d=b.UTILITIES.get_style_numeric_property(e,"z-index"),c=function(c,f,h){var l=f.get_contents(),m=(l||f).get_element(!0),q=$(c).parents(".toontalk-box-hole"),t=function(){$(c).parents(".toontalk-box-hole").children(".toontalk-nest").is("*")&&
(y/=b.nest.CONTENTS_WIDTH_FACTOR,J/=b.nest.CONTENTS_HEIGHT_FACTOR)},v,r,y,J;g?(r=0,0<q.length||$(e).is(".toontalk-conditions-contents")?(y=n-2*A/a,J=z-2*A):(y=n,J=z),t(),v=y*h,1<h&&(v+=A*(h-1))):(v=0,0<q.length||$(e).is(".toontalk-conditions-contents")?(y=n-2*A,J=z-2*A/a):(y=n,J=z),t(),r=J*h,1<h&&(r+=A*(h-1)));setTimeout(function(){b.UTILITIES.set_css(c,{left:v,top:r,width:y,height:J,"z-index":"number"===typeof d&&d+a-h});l&&l.render()});u[h]&&c.setAttribute("toontalk_name",u[h]);!b.UTILITIES.has_animating_image(m)&&
0<h&&($(c).removeClass("toontalk-box-eighth-size-border-left toontalk-box-quarter-size-border-left toontalk-box-half-size-border-left toontalk-box-full-size-border-left"),$(c).removeClass("toontalk-box-eighth-size-border-top toontalk-box-quarter-size-border-top toontalk-box-half-size-border-top toontalk-box-full-size-border-top"),g?$(c).addClass(C+"-left"):$(c).addClass(C+"-top"));c!==m&&l.get_parent()===f&&(k(l,m,y,J),$(f.element).find("iframe").attr("width",y).attr("height",J-20),c.appendChild(m),
f.get_contents().rerender());f.is_element()&&(m={width:y,height:J},f=f.get_contents(),f.is_plain_text_element()?$(f.get_frontside_element()).css({"font-size":b.UTILITIES.font_size(f.get_text(),y,{height:J}),width:"",height:""}):$(f.get_frontside_element()).css(m),f=f.dereference(),f.set_size_attributes(y,J,!0),$(c).css(m))},g=this.get_horizontal();$(e).is(".toontalk-box");var f=this.constrained_by_container(),h=function(){var d=$(e).children(".toontalk-box-hole");$(e).is(".toontalk-conditions-contents")?
b.UTILITIES.set_css(e,{width:t-2*A,height:r-2*A}):this.directly_inside_conditions_container()||$(e).parent().is(".toontalk-scale-half")||(10>t||10>r||!$(e).parent(".toontalk-box-hole").is("*")?b.UTILITIES.set_css(e,{width:t,height:r}):b.UTILITIES.set_css(e,{width:"",height:""}));10>t||10>r||(d.length===a?d.each(function(a,b){var d=this.get_hole(a);d&&c(b,d,a)}.bind(this)):(d.remove(),this.get_holes().forEach(function(a,b){q=a.get_element();$(q).addClass("toontalk-hole-number-"+b);a.get_contents()&&
a.get_contents().rerender();c(q,a,b);e.appendChild(q)})));f||$(e).children(".ui-resizable-handle").css({right:-A,bottom:-A})}.bind(this),l=function(){var c=function(a){if(a.parentElement)return $(a.parentElement).is(".toontalk-box-hole")?a.parentElement:c(a.parentElement)},d=c(e)||e,d=$(e).parent().is(".toontalk-scale-half")?e:d;0===a?r=t=0:f?(t=$(d).width(),r=$(d).height()):t=this.directly_inside_conditions_container()&&b.UTILITIES.get_toontalk_css_numeric_attribute("width",".toontalk-conditions-container")||
!$(d).is(".toontalk-carried-by-bird")&&b.UTILITIES.get_style_numeric_property(d,"width")||this.saved_width||b.box.get_default_width();void 0===r&&(r=this.directly_inside_conditions_container()&&b.UTILITIES.get_toontalk_css_numeric_attribute("height",".toontalk-conditions-container")||!$(d).is(".toontalk-carried-by-bird")&&b.UTILITIES.get_style_numeric_property(d,"height")||this.saved_height||b.box.get_default_height());g?(n=0===a?0:t/a,z=r):(n=t,z=r/a)}.bind(this),u=this.get_name().split(";"),q,t,
n,r,z,C,A;b.logging&&0<=b.logging.indexOf("display")&&console.log("Updating display of "+this.to_debug_string());$(e).addClass("toontalk-box");$(e).removeClass("toontalk-box-eighth-size-border toontalk-box-quarter-size-border toontalk-box-half-size-border toontalk-box-full-size-border");b.UTILITIES.give_tooltip(e,this.get_title());b.debugging&&(this._debug_string=this.to_debug_string());this.get_erased()?($(e).addClass("toontalk-box-erased"),$(e).children(".toontalk-side").remove()):($(e).removeClass("toontalk-box-erased"),
l(),10>t||10>r?h():(A=this.get_border_size(n,z),C=4===A?"toontalk-box-eighth-size-border":8===A?"toontalk-box-quarter-size-border":16===A?"toontalk-box-half-size-border":"toontalk-box-full-size-border",g?n-=(a-1)*A/a:z-=(a-1)*A/a,$(e).addClass(C),b.UTILITIES.set_timeout(h)))};f.get_default_width=function(){return 164};f.get_default_height=function(){return 68};f.get_border_size=function(b,a){var d;if(0===b)return d=$(this.get_frontside_element()).width(),16>=d?8:32>=d?16:32;b||a||(d=this.get_size(),
b=$(this.get_frontside_element()).width(),a=$(this.get_frontside_element()).height(),this.get_horizontal()?b=0===d?0:b/d:a=0===d?0:a/this.get_size());return 32>=b||32>=a?4:64>=b||64>=a?8:128>=b||128>=a?16:32};f.is_resizable=function(){return!0};f.get_name_input_label=function(){return"The labels of my holes are"};f.get_name_input_title=function(){return"Each hole label is followed by a ';'. Yoou may enter as many hole labels as there are holes."};f.drop_on=function(b,a){var d;if(b.box_dropped_on_me)return d=
b.box_dropped_on_me&&b.box_dropped_on_me(this,a),a.event&&b.rerender(),d&&this.remove(),d;if(b.widget_side_dropped_on_me)return b.widget_side_dropped_on_me(this,a);console.log("No handler for drop of "+this+" on "+b)};f.box_dropped_on_me=function(b,a){console.log("box on box not yet implemented");return!1};f.widget_side_dropped_on_me=function(e,a){var d=this.which_hole(a.event),c;if(0<=d)return c=this.get_hole(d),(d=c.get_contents())?e.drop_on(d,a):c.widget_side_dropped_on_me(e,a);b.UTILITIES.report_internal_error(e+
" dropped on "+this+" but no event was provided.")};f.get_index_of=function(b){return b.get_parent_of_frontside()&&b.get_parent_of_frontside().get_index&&b.get_parent_of_frontside().get_index()};f.name_font_size=function(b,a){var d,c;if(0===this.get_size())return 0;this.get_horizontal()?(c=(a||this.get_height())/6,d=(b||this.get_width())/(8*this.get_size())):(c=(a||this.get_height())/(6*this.get_size()),d=(b||this.get_width())/8);return Math.min(d,c)};f.removed_from_container=function(b,a){var d=
!!a,c=this.get_index_of(b);0<=c&&(this.set_hole(c,void 0,d),d&&(this.rerender(),b.restore_dimensions()))};f.get_path_to=function(e,a){var d=this.get_size(),c,g;if("empty hole"===e.get_type_name()){d=e.get_parent_of_frontside();g=b.box.path.create(e.get_index());if(d===this)return g;d=this.get_path_to(d);if(!d)return;d.next=g;return d}for(c=0;c<d;c++)if(g=this.get_hole_contents(c)||this.get_contents_temporarily_removed(c)){if(e===g||g.top_contents_is&&g.top_contents_is(e))return b.box.path.create(c);
if(g.get_path_to&&(g=g.get_path_to(e,a)))return d=b.box.path.create(c),d.next=g,d}};f.element_to_highlight=function(b){b=this.which_hole(b,!0);var a;if(0>b||0===this.get_size())return this.get_frontside_element();b=this.get_hole(b);return(a=b.get_contents())?a.get_frontside_element():b.get_frontside_element()};f.which_hole=function(b){var a=this.get_horizontal(),d=this.get_frontside_element(),c=this.get_size(),e,f;if(0!==c&&(e=$(d).offset(),d=a?$(d).width()/c:$(d).height()/c,f=a?e.left:e.top,b))for(e=
0;e<c;e++)if(f+=d,(a?b.pageX<=f:b.pageY<=f)||e+1===c)return e};f.dereference_path=function(e,a,d){var c;if(e){if(!e.get_index&&e.next&&(e=e.next),c=e.get_index&&e.get_index(),d||"undefined"!==typeof c){if(!b.debugging||"number"===typeof c){if(d=this.get_hole_contents(c)){if(d.dereference_contents&&!e.not_to_be_dereferenced)return d.dereference_contents(e.next||e,a);if(e.next){if(d.dereference_path)return d.dereference_path(e.next,a);b.UTILITIES.report_internal_error("Expected to refer to a part of "+
d+" but it lacks a method to obtain "+b.path.toString(e.next))}if(e.removing_widget){if("empty hole"===d.get_type_name()){b.UTILITIES.display_message("Robot is trying to remove something from an empty hole. ",{only_if_new:!0});return}d.get_infinite_stack()||a.remove_from_container(d,this)}return d}if(e.removing_widget){b.UTILITIES.display_message("Robot is trying to remove something from an empty hole. ",{only_if_new:!0});return}return this.get_hole(c)}b.UTILITIES.display_message(this+" unable to dereference the path: "+
b.path.toString(e),{only_if_new:!0})}}else return this};f.path={create:function(e){return{get_index:function(){return e},toString:function(){return"scale"===this.true_type?0===e?"the left pan ":"the right pan ":"the "+b.UTILITIES.ordinal(e)+" hole "},get_json:function(a,b,c){var d=function(a,c){b({type:"box_path",index:e,true_type:this.true_type,next:a},c)}.bind(this);this.next?this.next.get_json(a,d,c):d(void 0,c)}}}};f.get_custom_title_prefix=function(){return"Drop things in my holes to store them."};
b.creators_from_json.box_path=function(e,a){var d=f.path.create(e.index);e.next&&(d.next=b.UTILITIES.create_from_json(e.next,a));e.true_type&&(d.true_type=e.true_type);return d};return f}(window.TOONTALK);window.TOONTALK.box_backside=function(b){return{create:function(f){var e=b.backside.create(f),a=b.UTILITIES.create_text_input(f.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes.",void 0,"number",function(a){if(a=b.UTILITIES.input_area_drop_handler(a,
f.receive_size_from_dropped.bind(f),f))f.rerender(),f.robot_in_training()&&f.robot_in_training().dropped_on_text_area(a,f,{area_selector:".toontalk-box-size-input",setter:"receive_size_from_dropped",toString:"for the box's size"})}),d=b.UTILITIES.create_radio_button("box_orientation","horizontal","toontalk-horiztonal-radio-button","Left to right","Show box horizontally.",!0),c=b.UTILITIES.create_radio_button("box_orientation","vertical","toontalk-vertical-radio-button","Top to bottom","Show box vertically.",
!0),g=function(){var b=parseInt(a.button.value.trim(),10);f.set_size(b,!0,!0)},h=function(){var a=b.UTILITIES.selected_radio_button(d,c);a&&f.set_horizontal("horizontal"===a.button.value,!0,!0)},k=e.get_element(),l=b.backside.create_advanced_settings_button(e,f),u=e.update_display.bind(e),q=b.UTILITIES.create_div(d,c);a.button.addEventListener("change",g);a.button.addEventListener("mouseout",g);d.button.addEventListener("change",h);c.button.addEventListener("change",h);e.update_display=function(){a.button.value=
f.get_size().toString();f.get_horizontal()?b.UTILITIES.check_radio_button(d):b.UTILITIES.check_radio_button(c);u()};b.UTILITIES.when_attached(k,function(){e.is_primary_backside()||f.add_listener("contents_or_properties_changed",function(){e.rerender()})});k.appendChild(a.container);k.appendChild(q);$(q).controlgroup().removeClass("ui-controlgroup");k.appendChild(l);e.rerender();return e}}}(window.TOONTALK);window.TOONTALK.box_hole=function(b){return{create:function(f){var e=Object.create(this),a,
d;e.is_hole=function(){return!0};e.is_empty_hole=function(){return!a};e.constrained_by_container=function(){return!1};e.get_element=function(){d||(d=document.createElement("div"),d.className="toontalk-box-hole toontalk-frontside toontalk-side",d.toontalk_widget_side=e);return d};e.get_frontside=function(b){return a?a.get_frontside(b):this.get_element()};e.get_backside_widgets=function(){return a?a.get_backside_widgets():[]};e.get_frontside_element=function(a){return this.get_element()};e.get_frontside=
function(){return this};e.get_width=function(){return $(this.get_element()).width()};e.get_height=function(){return $(this.get_element()).height()};e.widget_side_dropped_on_me=function(a,d){var c=this.get_parent_of_frontside(),e=this.get_contents(),g,f,h,k;if(e)return e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(a,d);a.dropped_on_other&&a.dropped_on_other(this,d);d.event?(b.sounds&&b.sounds.fall_inside.play(),e=this.get_element(),k=a.is_plain_text_element(),h=a.get_element(),$(h).css({"z-index":b.UTILITIES.next_z_index()}),
f=$(h.parentElement).offset(),g=$(e).offset(),k||(h.style.left=d.event.pageX-f.left+"px",h.style.top=d.event.pageY-f.top+"px",$(h).addClass("toontalk-animating-element")),h.style.width=e.style.width,h.style.height=e.style.height,h.style.left=g.left-f.left+"px",h.style.top=g.top-f.top+"px",g=function(){$(h).removeClass("toontalk-animating-element");this.set_contents(a);c.render();a.render();d.event&&c.backup_all()}.bind(this),setTimeout(g,k||b.UTILITIES.has_animating_image(h)?0:1200),c.robot_in_training()&&
c.robot_in_training().dropped_on(a,this),a.save_dimensions&&a.set_size_attributes&&a.set_size_attributes($(e).width(),$(e).height()),a.is_backside()||c.get_frontside_element().dispatchEvent(b.UTILITIES.create_event("widget added",{element_widget:h,where:"front",index:this.get_index()}))):(c.rerender(),this.set_contents(a,d));return!0};e.get_json=function(){return null};e.add_to_json=function(a){return a};e.copy=function(a){return b.box_hole.create(f)};e.match=function(){return"matched"};e.get_type_name=
function(b){return a?a.get_type_name(b):b?"empty holes":"empty hole"};e.name_font_size=function(){return this.get_box().name_font_size()};e.is_of_type=function(b){return a?a.is_of_type(b):"empty hole"===b};e.get_box=function(){return this.get_parent_of_frontside()};e.update_display=function(){var b;a&&(b=this.get_frontside_element(),k(a,a.get_element(!0),$(b).width(),$(b).height()))};e.dereference=function(){return a?a.dereference():this};e.can_run=function(b,d){return a&&a.can_run(b,d)};e.get_index=
function(){return f};e.get_contents=function(){return a};e.set_contents=function(c,d){var e=this.get_listeners("contents_or_properties_changed");e&&(a!==c&&e.forEach(function(b){b({type:"contents_or_properties_changed",old_value:a,new_value:c})}),a&&e.forEach(function(b){a.remove_listener("contents_or_properties_changed",b,!0)}),c&&e.forEach(function(a){c.add_listener("contents_or_properties_changed",a)}));a&&a.set_parent(void 0);(a=c)?(a.set_parent(this),b.debugging&&(this._debug_string="A hole containing "+
a.to_debug_string()),d&&d.robot&&!d.robot.visible()||a.set_visible(this.visible())):b.debugging&&(this._debug_string=this.to_debug_string())};e.get_contents_dimensions=function(){return{width:$(this.get_frontside_element()).width(),height:$(this.get_frontside_element()).height()}};e.visible=function(){return this.get_parent_of_frontside().visible()};e.set_visible=function(b,d){a&&a.set_visible(b,d?d+1:1)};e.remove=function(){a&&a.remove()};e.render=function(){a&&b.DISPLAY_UPDATES.pending_update(this)};
e.rerender=function(){if(a&&this.visible())return this.render()};e.set_running=function(b){a&&a.set_running(b)};e.set_parent=function(b){a&&a.set_parent(b)};e.maintain_proportional_dimensions=function(){if(a)return a.maintain_proportional_dimensions()};e.removed_from_container=function(c,d,e,f){a?(d&&a.restore_dimensions(),this.set_contents(void 0),d&&this.get_parent_of_frontside().render()):f&&b.UTILITIES.report_internal_error("Holes can't be removed from containers.")};e.temporarily_remove_contents=
function(b,d){if(a)return this.get_parent_of_frontside().temporarily_remove_contents(b,d)};e.toString=function(){return a?a.toString():"_"};e.get_description=function(){return a?a.get_description():"_"};e.get_full_description=function(b){return a?a.get_full_description(b):"_"};e.is_backside=function(){return!1};e.get_widget=function(){return this.get_parent_of_frontside()};e.is_number=function(){return a?a.is_number():!1};e.is_box=function(){return a?a.is_box():!1};e.is_scale=function(){return a?
a.is_scale():!1};e.is_bird=function(){return a?a.is_bird():!1};e.is_nest=function(){return a?a.is_nest():!1};e.is_robot=function(){return a?a.is_robot():!1};e.is_element=function(){return a?a.dereference().is_element():!1};e.get_original_width=function(){if(a&&a.get_original_width)return a.get_original_width()};e.get_original_height=function(){if(a&&a.get_original_height)return a.get_original_height()};e.is_sensor=function(){return a?a.is_sensor():!1};e.is_top_level=function(){return!1};e.is_plain_text_element=
function(){return!1};e.get_active=function(){return a?a.get_active():!1};e.set_active=function(b,d){a&&a.set_active(b,d)};b.widget.has_parent(e);b.widget.has_listeners(e);if(b.debugging||b.logging)e.to_debug_string=function(c){var d=("the "+b.UTILITIES.ordinal(f)+" hole of the "+(this.get_parent_of_frontside()?this.get_parent_of_frontside().to_debug_string():"not-yet-defined box")).substring(0,c);return a?d+" which contains "+a.to_debug_string(c):d+" which is empty"},e._debug_string=e.to_debug_string();
return e}}}(window.TOONTALK);window.TOONTALK.box["function"]=function(){var f=b.create_function_table();f.add_function_object("box hole",function(h,e){return f.typed_bird_function(h,function(a,d,c){var e=Math.round(a.to_float());if(1>e)f.report_error("The 'box hole' function bird cannot find the "+b.UTILITIES.ordinal(e-1)+" hole. She only accepts positive numbers.",c);else if(e>d.get_size())f.report_error("The 'box hole' function bird cannot cannot find the "+b.UTILITIES.ordinal(a-1)+" hole. The box only has "+
d.get_size()+" holes.",c);else{if(d=d.get_hole_contents(e-1))return c.message_return_bird?d.copy():d;f.report_error("The 'box hole' function bird cannot cannot find anything in the "+b.UTILITIES.ordinal(a-1)+" hole. It is empty.",c)}},["number","box"],"box hole",e,2,2)},"The bird will return with what is in a hole of the box. The number determines which hole's contents are returned. Use 1 for the first hole.","hole",["number","box"]);f.add_function_object("count holes",function(h,e){return f.typed_bird_function(h,
function(a){return b.number.create(a.get_size())},["box"],"count holes",e,1,1)},"The bird will return with the number of holes the box has.","count holes",["box"]);f.add_function_object("fill hole",function(h,e){return f.typed_bird_function(h,function(a,d,c,e){var g=Math.round(a.to_float());if(1>g)f.report_error("The fill hole function bird cannot fill the "+b.UTILITIES.ordinal(a)+" hole. She only accepts positive numbers.",e);else return e.message_return_bird&&(d=d.copy(),c=c.copy()),g>d.get_size()&&
d.set_size(g),d.set_hole(g-1,c),d},["number","box",void 0],"fill hole",e,3,3)},"The bird will return with the box where one of its holes has been filled by whatever is in the fourth hole. The number determines which hole's contents are changed. 1 for the first hole.","fill hole",["number","box",void 0]);f.add_function_object("split box",function(h,e){return f.typed_bird_function(h,function(a,d,c){var e=Math.round(a.to_float()),h=d.get_size();if(0>e)f.report_error("The box split function bird cannot split the box after "+
a+" holes. She only accepts zero or positive numbers.",c);else if(e>h)f.report_error("The box split function bird cannot split the box after "+a+" holes. The box only has "+h+" holes.",c);else{d.get_holes();a=h-e;var h=b.box.create(a),k;for(k=0;k<a;k++)h.set_hole(k,d.get_hole_contents(k+e));c.message_return_bird&&(d=d.copy());d.set_size(e);return b.box.create(2,!1,[d,h])}},["number","box"],"split box",e,2,2)},"The bird will return with a box with the original box split in two. The number determines where the split is. 1 for after the first hole.",
"split",["number","box"]);f.add_function_object("merge boxes",function(h,e){return f.typed_bird_function(h,function(){var a=0,d,c,e,f,h,k;if(1===arguments.length)return b.box.create(0);k=arguments[arguments.length-1];c=arguments[0];k.message_return_bird&&(c=c.copy());for(d=0;d<arguments.length-1;d++)a+=arguments[d].get_size();e=c.get_size();c.set_size(a);for(d=1;d<arguments.length-1;d++)for(f=arguments[d].get_size(),a=0;a<f;a++){if(h=arguments[d].get_hole_contents(a))k.message_return_bird&&(h=h.copy()),
c.set_hole(e,h);e++}return c},["box"],"merge boxes",e)},"The bird will return with a box that joins together all the boxes.","merge",["any number of boxes"]);f.add_function_object("get window property",function(h,e){return f.typed_bird_function(h,function(a,d){var c=window,e=a.get_size(),h=function(){var c="window",g;for(g=0;g<e;g++){l=a.get_hole_contents(g);if(!l||!l.get_text){f.report_error("The 'get window property' bird could not get the text of the "+b.UTILITIES.ordinal(g)+" hole.",d);return}c+=
"."+l.get_text().trim()}return c},k,l;for(k=0;k<e;k++){l=a.get_hole_contents(k);if(!l||!l.get_text){f.report_error("The 'get window property' bird could not get the text of the "+b.UTILITIES.ordinal(k)+" hole.",d);return}try{c=c[l.get_text().trim()]}catch(u){f.report_error("Error trying to find the value of "+h()+". "+u,d);return}}if(void 0===c)f.report_error("Error no value for "+h()+exception,d);else return"number"===typeof c?b.number.create(c):b.element.create(c.toString())},["box"],"window property",
e,1,1)},"The bird will return with the value of the property accessed by each of the property names in the box.","win prop",["box"]);f.add_function_object("set window property",function(h,e){return f.typed_bird_function(h,function(a,d,c){var e=window,h=a.get_size(),k=function(d){var e="window",g;for(g=0;g<d;g++){t=a.get_hole_contents(g);if(!t||!t.get_text){f.report_error("The 'set window property' bird could not get the text of the "+b.UTILITIES.ordinal(g)+" hole.",c);return}e+="."+t.get_text().trim()}return e},
l,u,q,t;for(l=0;l<h-1;l++){t=a.get_hole_contents(l);if(!t||!t.get_text){f.report_error("The 'set window property' bird could not get the text of the "+b.UTILITIES.ordinal(l)+" hole.",c);return}try{e=e[t.get_text().trim()]}catch(n){f.report_error("Error trying to find the property of "+k(h-1)+". "+n,c);return}}e||(q="Property missing of "+k(h-1));if(!q)try{u=d.to_float?d.to_float():d.get_text?d.get_text():d.toString();t=a.get_hole_contents(h-1);if(!t||!t.get_text){f.report_error("The 'set window property' bird could not get the text of the "+
b.UTILITIES.ordinal(l)+" hole.",c);return}e[t.get_text().trim()]=u}catch(n){q="Unable to set the value of "+k(h)+" to value of "+d}if(q)f.report_error(q,c);else return d},["box",void 0],"set window property",e,2,2)},"The bird will set the value of the property accessed by each of the property names in the box in the second hole to the value of the widget in the third hole.","set win prop",["box"]);return f.get_function_table()}()})(window.TOONTALK);(function(){var b,k,f,h;window.TOONTALK.bird=function(e){var a=Object.create(e.widget),d=function(a,b,d){var c=a.get_function_type();a=a.get_function_object();var g=Object.keys(TOONTALK[c]["function"]),f=g.map(function(a){return TOONTALK[c]["function"][a].title}),g=e.UTILITIES.create_select_menu("functions",g,"toontalk-select-function","Which function should I fly to? ","Click to select the function that this bird will use when given a box.",f);b=b.get_element();var h;a&&$(g.menu).val(a.name).selectmenu("refresh");
$(g.menu).on("selectmenuselect",function(a){d.set_function_name(a.target.value);d.get_description()||(h=$(d.get_backside_element()).find(".toontalk-description-input"),0<h.length&&h.get(0).setAttribute("placeholder",d.get_default_description()))});$(g.menu).selectmenu("menuWidget").addClass("toontalk-select-menu");b.insertBefore(g.container,b.firstChild)};a.create=function(c,g,f){var k=[],l=[];f||(f=Object.create(a));f.set_nest=function(a,b){if(c===b||void 0===c)c=a};f.is_bird=function(){return!0};
f.widget_side_dropped_on_me=function(a,b){var d,g,f;if(this.get_infinite_stack())return g=this.add_copy_to_container(),g.widget_side_dropped_on_me(a,b);if(c){if(c.has_ancestor(a))return a.display_message("Bird can't take its nest to its nest!"),!1;!(c.visible()||this.visible()||c.any_nest_copies_visible())||b.robot&&b.robot.visible()&&!b.robot.animate_consequences_of_actions()?(f=function(){try{c.add_to_contents(a,b)}catch(z){if(z.wait_for_nest_to_receive_something)z.wait_for_nest_to_receive_something.run_when_non_empty(f,
this);else throw console.error(z.stack),z;}},f(),b.robot&&b.robot===a.robot_waiting_before_next_step&&(a.robot_waiting_before_next_step=void 0,b.robot.run_next_step())):(b.by_function_bird||a.save_dimensions(),d=this.get_frontside_element(),setTimeout(function(){$(d).removeClass("toontalk-bird-gimme").addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));this.get_parent_of_frontside()&&this.get_parent_of_frontside().rerender()}.bind(this)),a.set_visible(c.visible()),
b.robot&&!b.do_not_run_next_step&&(a.robot_waiting_before_next_step=b.robot,b.robot.run_next_step&&(g=function(c){c&&c();a.robot_waiting_before_next_step=void 0;b.robot.run_next_step()})),b.after_delivery_continuation=e.UTILITIES.join_continuations(b.after_delivery_continuation,g),c.animate_bird_delivery(a,this,b))}else b.robot&&!b.robot.visible()?a.remove():this.animate_delivery_to(a);b.event&&!b.by_function_bird&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this);return!0};f.animate_delivery_to=
function(a,b,d){d||(d={});var g=d.nest_recieving_message,f=d.after_delivery_continuation,h=this.get_parent_of_frontside(),m=this.get_frontside_element(!0),q=$(m).position();$(m).width();var t=this.closest_visible_ancestor_or_frontside(),v=$(t.get_frontside_element()).offset(),u=function(){var b,c;e.sounds&&e.sounds.bird_fly.pause();g||a.remove();d.temporary_bird?this.remove():(b=function(){$(m).removeClass("toontalk-bird-morph-to-static");$(m).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
h&&h.get_widget().rerender()}.bind(this),m.style.position=S,e.UTILITIES.set_css(m,q),L&&L.appendChild(m),h&&(h.get_widget().is_top_level()?this.rerender():h.get_widget().rerender()),U&&(ca.remove_backside_widget(this,!0),U(),k&&(c=k,k=[],l=[],c.forEach(function(a){a()}))),e.UTILITIES.add_animation_class(m,"toontalk-bird-morph-to-static"),e.UTILITIES.add_one_shot_event_handler(m,"animationend",1E3,b));f&&f();d.event&&this.backup_all()}.bind(this),G=function(){var b=function(a){e.UTILITIES.set_timeout(function(){this.fly_to(v,
function(){a&&a();u&&u()},d)}.bind(this))}.bind(this),c;if(g)try{d.delivery_bird=this,g.add_to_contents(a,{ignore_copies:!0,make_message_nests_delivery_targets:g.is_function_nest()}),b()}catch(ma){if(ma.wait_for_nest_to_receive_something){ma.wait_for_nest_to_receive_something.run_when_non_empty(G,this);c=u;u=function(){c&&c();ma.wait_for_nest_to_receive_something.remove()};f&&(f(),f=void 0);return}e.sounds&&e.sounds.bird_fly.pause();console.error(ma.stack);throw ma;}else this.is_function_bird()||
f&&f();Q($(m).offset())}.bind(this),R=function(a,b){b||(b=e.UTILITIES.widget_side_of_element(a));this.element_to_display_when_flying=a;b&&(this.update_display(),setTimeout(function(){b.update_display()}));$(a).addClass("toontalk-carried-by-bird");$(a).removeClass("toontalk-temporarily-set-down");e.UTILITIES.set_timeout(function(){var c={left:"",top:"",position:""};b&&!b.use_scaling_transform&&(c.width="",c.height="");1<a.toontalk_x_scale&&(c["font-size"]="inherit");e.UTILITIES.set_css(a,c);this.update_display()}.bind(this))}.bind(this),
Q=function(b){var c;this.element_to_display_when_flying&&($(this.element_to_display_when_flying).removeClass("toontalk-carried-by-bird"),b?(c={"z-index":e.UTILITIES.next_z_index()},0<this.element_to_display_when_flying.width_before_carry&&(c.width=this.element_to_display_when_flying.width_before_carry),0<this.element_to_display_when_flying.height_before_carry&&(c.height=this.element_to_display_when_flying.height_before_carry),1<this.element_to_display_when_flying.toontalk_x_scale&&(c["font-size"]=
"inherit"),e.UTILITIES.set_css(this.element_to_display_when_flying,c),this.top_level_widget().get_backside_element().appendChild(this.element_to_display_when_flying),e.UTILITIES.set_absolute_position(this.element_to_display_when_flying,b),(b=a.get_parent_of_frontside())&&!b.is_backside()&&b.rerender()):$(this.element_to_display_when_flying).remove(),this.element_to_display_when_flying=void 0,this.update_display())}.bind(this),H,D,L,S,I,P,U,W,V,M,ca;g||(g=c);if(g||this.visible())if(d.delay=e.animation_settings.PAUSE_BETWEEN_BIRD_STEPS,
$(m).removeClass("toontalk-bird-gimme"),M=a.get_element(!0),R(M,a),b&&!b.is_function_nest()&&(D=b.get_widget().closest_visible_ancestor_or_frontside().get_widget().get_frontside_element()),!b||this.visible()||b.visible()&&(b.is_function_nest()||e.UTILITIES.visible_element(D)))if(e.sounds&&e.sounds.bird_fly.play(),$(m).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),b&&!b.is_function_nest()&&(H=$(D).offset(),g.get_frontside_element&&(P=$(g.get_frontside_element()).closest(".toontalk-backside-of-top-level"))),
P&&P.is("*")||(P=$(this.get_frontside_element()).closest(".toontalk-backside-of-top-level")),(b=P.offset())||(b={left:0,top:0}),d.starting_left?v={left:d.starting_left+b.left,top:d.starting_top+b.top}:0===v.left&&0===v.top&&(v={left:-M.clientWidth,top:b.top+P.height()/2}),H||(H={left:-2*M.clientWidth,top:b.top+P.height()/2}),L=m.parentElement,t=$(m).width(),I=$(m).height(),S=m.style.position,m.style.position="absolute",ca=this.top_level_widget(),h&&h.temporarily_remove_contents&&(U=h.temporarily_remove_contents(this,
!0))&&this.get_widget().add_to_top_level_backside(this),0<P.length&&P.get(0).appendChild(m),e.UTILITIES.set_css(m,{left:d.starting_left||v.left-b.left,top:d.starting_top||v.top-b.top,width:t,height:I}),e.logging&&0<=e.logging.indexOf("bird")&&console.log(this.to_debug_string(50)+" from "+(d.starting_left||v.left-b.left)+", "+(d.starting_top||v.top-b.top)+" to "+H.left+", "+H.top),g&&(W=g.get_contents_element&&g.get_contents_element()),W&&g.visible()&&(!d.robot||d.robot.animate_consequences_of_actions())){t=
$(D).width();I=$(D).height();V=$(D).offset();b.max_left=b.left+P.width();b.max_top=b.top+P.height();H={left:H.left+t,top:H.top+I};var ea={left:Math.min(V.left+t,b.max_left-t),top:Math.min(V.top+I,b.max_top-I)},aa={left:Math.max(V.left-t,b.left),top:Math.max(V.top-I,b.top)};H=function(){var b=function(){g.visible()?(g.set_locked(!0),this.fly_to(V,ha,d)):(d.delivery_bird=this,d.ignore_copies=!0,g.add_to_contents(a,d),f&&(f(),f=void 0))}.bind(this);$(M).addClass("toontalk-temporarily-set-down");Q(ea);
g.get_locked()?g.run_when_unlocked(b):b()}.bind(this);var ha=function(){R(W);this.fly_to(aa,p,d)}.bind(this),p=function(){$(W).addClass("toontalk-temporarily-set-down");Q(aa);this.fly_to(ea,w,d)}.bind(this),w=function(){R(M,a);this.fly_to(V,E,d)}.bind(this),E=function(){var b=g.get_contents_dimensions();a.is_plain_text_element()&&$(M).addClass("toontalk-temporarily-set-down");Q(V);a.is_plain_text_element()||e.UTILITIES.set_css(a.get_element(),b);this.fly_to(aa,K,d)}.bind(this),K=function(){R(W);this.fly_to(V,
ba,d)}.bind(this),ba=function(){$(M).removeClass("toontalk-temporarily-set-down");g.set_locked(!1);Q();g.update_display();G()}.bind(this);this.fly_to(ea,H,d)}else this.fly_to(H,G,d);else d.delivery_bird=this,d.ignore_copies=!0,g.add_to_contents(a,d),d.temporary_bird&&this.remove();else a.remove(),this.remove()};f.get_json=function(a,b,d){var g;c?(g=function(a,c){b({type:"bird",nest:a},c)},e.UTILITIES.get_json(c,a,g,d)):b({type:"bird"},d)};f.copy=function(a){var d,e,g;if(a)if(a.just_value)d=this.create(void 0,
this.get_description());else{if((g=c&&c.get_guid())&&a.nests_copied&&a.nests_copied[g]){d=a.nests_copied[g][0];h.call(d);for(e=1;e<a.nests_copied[g].length;e++)b.call(a.nests_copied[g][e],d);d=this.create(d,this.get_description())}else d=this.create(c,this.get_description());a.birds_copied||(a.birds_copied={});g&&(a.birds_copied[g]||(a.birds_copied[g]=[]),a.birds_copied[g].push(d))}else d=c&&c.is_function_nest()?this.create(c.copy(),this.get_description()):this.create(c,this.get_description());return this.add_to_copy(d,
a)};f.run_when_non_empty=function(a,b){0>l.indexOf(b)&&(k.push(a),l.push(b))};f.create_backside=function(){var a=e.bird_backside.create(this);c&&c.is_function_nest()&&d(c,a,this);return a};f.get_help_URL=function(){return c&&c.is_function_nest()?"docs/manual/function-birds.html":"docs/manual/birds-nests.html"};f.is_function_bird=function(){return c&&c.is_function_nest()};f.get_custom_title_prefix=function(){var a;return c?c.is_function_nest()&&(a=c.get_function_object())?a.get_description():"Drop something on me and I'll take it to my nest.":
"This bird no longer knows where her nest is. She'll get rid of anything you give her."};f.toString=function(a){return c?c.is_function_nest&&c.is_function_nest()?c.get_function_object().toString():c.get_name()?"bird named '"+c.get_name()+"'":"bird":a&&"conditions"===a.role?"any bird":"bird without a nest"};f.get_default_description=function(){return this.is_function_bird()?"a bird who gives another bird a box to compute the '"+c.get_function_object().name+"' of "+this.get_function_type(!0)+".":"a bird who takes things to her nest."};
f.update_display=function(){var a=this.get_frontside(!0);this.get_backside();var b;b=a.get_element();b.setAttribute("toontalk_name",this.get_name());e.UTILITIES.give_tooltip(b,this.get_title());$(b).is(".toontalk-bird, .toontalk-side-animating")||($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird toontalk-bird-static")),b.addEventListener("dragenter",function(a){0<=b.className.indexOf("toontalk-bird-static")&&($(b).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")),
e.UTILITIES.add_animation_class(b,"toontalk-bird-gimme"))}.bind(this)),b.addEventListener("dragleave",function(a){$(b).is(".toontalk-bird-gimme")&&($(b).addClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static")).removeClass("toontalk-bird-gimme"),this.get_parent_of_frontside()&&this.get_parent_of_frontside().render())}.bind(this)));if(this.element_to_display_when_flying){this.has_ancestor(e.UTILITIES.widget_side_of_element(this.element_to_display_when_flying))&&this.top_level_widget().get_backside_element().appendChild(b);
try{b.appendChild(this.element_to_display_when_flying)}catch(t){e.UTILITIES.report_internal_error("Error attaching 'message' to bird. Message className is "+this.element_to_display_when_flying.className)}}else $(b).children(".toontalk-side").remove();e.UTILITIES.set_css(b,{"font-size":this.name_font_size()})};f.set_function_name=function(a){c&&c.is_function_nest()&&c.set_function_name(a)&&(this.rerender(),this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_function_name",
argument_1:a,toString:"change the function bird to '"+a+"'",button_selector:".toontalk-select-function"}))};f.get_function_type=function(a){return c.get_function_type(a)};f.get_class_name_with_color=function(a){return c&&c.get_class_name_with_color?c.get_class_name_with_color(a):a};f.get_name=function(){return c?c.get_name():""};c&&c.set_name&&(f.set_name=function(a,b,d){return c.set_name(a,b,d)});f.has_name_font_size(f);f.get_name_height=function(a){return.3*(a||this.get_height())};f.is_nest_visible=
function(){return c&&c.visible()};f.add_standard_widget_functionality(f);f.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});f.set_description(g);e.debugging&&(f._debug_id=e.UTILITIES.generate_unique_id(),f._debug_string=f.to_debug_string());return f};a.create_function=function(b,d,f){if("undefined"===typeof e[b]["function"])throw b="Unable to create function bird for type: "+b,e.UTILITIES.report_internal_error(b),b;return a.create(e.nest.create_function(d,b,f||e.UTILITIES.get_first_property(e[b]["function"])))};
a.match=function(a){if(a.get_widget().match_with_any_bird)return a.get_widget().match_with_any_bird(this);this.last_match=a;return this};a.match_with_any_bird=function(){return"matched"};a.fly_to=function(a,b,d){var c=this.get_frontside_element(),g=$(c).offset(),f="toontalk-fly-west toontalk-fly-northwest toontalk-fly-north toontalk-fly-northeast toontalk-fly-east toontalk-fly-southeast toontalk-fly-south toontalk-fly-southwest".split(" ")[Math.round(4*(Math.atan2(a.top-g.top,a.left-g.left)/Math.PI+
1))%8];$(c).position();var h=function(){$(c).removeClass(f);d.delay&&this.visible()?setTimeout(b,d.robot?d.robot.transform_step_duration(d.delay):d.delay):b()}.bind(this),g=function(){$(c).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));e.UTILITIES.add_animation_class(c,f);this.animate_to_absolute_position(a,h,d.robot&&d.robot.transform_animation_speed(e.animation_settings.BIRD_ANIMATION_SPEED))}.bind(this);this.visible()?setTimeout(g,1):g()};a.get_type_name=
function(a,b){return a?b&&this.is_function_bird()?"function birds":"birds":"bird"};a.maintain_proportional_dimensions=function(){return!0};a.matching_resource=function(a){return a.get_type_name&&a.get_type_name()===this.get_type_name()};a.drop_on=function(a,b){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b)};e.creators_from_json.bird=function(b,d,f){return b?e.bird.create(e.UTILITIES.create_from_json(b.nest,d,f),b.description):Object.create(a)};return a}(window.TOONTALK);
window.TOONTALK.bird_backside=function(b){return{create:function(a){var d=b.backside.create(a);d.add_description_setting();d.add_name_setting();d.get_element().appendChild(b.backside.create_advanced_settings_button(d,a));return d}}}(window.TOONTALK);window.TOONTALK.nest=function(e){var a=Object.create(e.widget),d,c,g=0,m=0;a.default_maximum_capacity=10;a.maximum_capacity=a.default_maximum_capacity;a.create=function(v,l,u,q,t,n,r){var z=[],C=[],A=[],y,J,O;r||(r=Object.create(a));l||(l=[]);t||(g++,
t=g);b=function(a){q&&f.call(q,this);q=a;u=a.get_guid();k.call(a,this)};h=function(){q&&f.call(q,this);q=void 0;u=e.UTILITIES.generate_unique_id();this.set_name(this.generate_name())};k=function(a){d||(d=e.UTILITIES.generate_unique_id());this[d](a)};f=function(a){d||(d=e.UTILITIES.generate_unique_id());this[d](a,!0)};r.is_nest=function(){return!0};r.get_guid=function(){return u};r.matched_by=function(a){return 0<l.length?e.UTILITIES.match(a,l[0]):[[this,a]]};r.run_when_non_empty=function(a,b){0<l.length?
a(l[0]):0>A.indexOf(b)&&(z.push(a),A.push(b))};r.dereference=function(){return 0<l.length?l[0]:this};r.match=function(a){if(0<l.length)return l[0].match(a);if(a.match_nest_with_nest)return a.match_nest_with_nest(this);this.last_match=a;return this};r.add_to_contents=function(b,c){var d;d=l.push(b);var g=this.visible();c||(c={});d>a.maximum_capacity&&c.robot&&c.robot_removed_contents_since_empty&&!c.robot.visible()&&!g&&(e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+
" postponing addition of "+b.to_debug_string(50)+" by "+c.robot.to_debug_string(50)+". Stack is "+l.length+" long. "+C.length+" previously postponed."),c.robot.add_body_finished_listener(function(){c.robot.set_stopped(!0);C.push(function(){c.robot.set_stopped(!1);c.robot.run_actions()})}));e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string()+" added "+b.to_debug_string()+" nest now contains "+l.length+" widgets.");b.is_backside()?b.set_parent_of_backside(this):b.set_parent_of_frontside(this);
y&&!c.ignore_copies&&(c.delivery_bird?y.forEach(function(a){a.has_ancestor(b.get_widget())||a.animate_bird_delivery(e.UTILITIES.copy_side(b),c.delivery_bird,c)}):y.forEach(function(a){a.has_ancestor(b.get_widget())||a.add_to_contents(e.UTILITIES.copy_side(b,!1,!0),c)}));1===d?(0<z.length&&(d=z,z=[],A=[],d.forEach(function(a){a(b)})),b.set_visible(g),g?this.get_containing_widget().rerender():b.hide()):(b.hide(),b.set_visible(!1));c.event&&this.backup_all();this.rerender()};r.animate_bird_delivery=
function(a,b,c){var d,g,f;void 0!==this.get_parent_of_frontside()||b.visible()?(b.animate_delivery_to(a,this,c),y&&(d=$(b.closest_visible_ancestor().get_widget().get_frontside_element()).closest(":visible").position(),g=b.get_parent_of_frontside()&&b.get_parent_of_frontside().get_element(),f=this.visible(),y.forEach(function(h){var k=e.UTILITIES.copy_side(a,!1,f),l,m;h.has_ancestor(a.get_widget())||(d&&(h.visible()||f)?(l=b.copy({just_value:!0}),m=l.get_frontside_element(!0),g&&g.appendChild(m),l.animate_delivery_to(k,
h,{starting_left:d.left,starting_top:d.top,nest_recieving_message:h,temporary_bird:!0,robot:c.robot})):h.add_to_contents(k,c))}))):(a.remove(),c.after_delivery_continuation&&c.after_delivery_continuation())};r.get_contents_element=function(){if(0<l.length)return l[0].get_element()};r.get_locked=function(){return this.locked_for_animating_deliveries};r.set_locked=function(a){this.locked_for_animating_deliveries=a;!a&&this.to_run_when_unlocked&&0<this.to_run_when_unlocked.length&&this.to_run_when_unlocked.shift()()};
r.run_when_unlocked=function(a){this.to_run_when_unlocked?this.to_run_when_unlocked.push(a):this.to_run_when_unlocked=[a]};r.removed_from_container=function(b,c,d){b=l.shift();e.logging&&0<=e.logging.indexOf("nest")&&(b?console.log(this.to_debug_string(50)+" removed "+b.to_debug_string()+" remaining widgets is "+l.length):console.log(this.to_debug_string(50)+" nothing left to remove."));if(b)return b.is_backside()?b.set_parent_of_backside(void 0):b.get_widget().set_parent_of_frontside(void 0),this.visible()&&
(b.restore_dimensions&&b.restore_dimensions(),0<l.length&&(l[0].set_visible(!0),$(l[0].get_element()).show()),this.get_containing_widget().is_top_level()?this.render():this.get_containing_widget().render()),l.length<=a.maximum_capacity&&0<C.length&&(e.logging&&0<=e.logging.indexOf("nest")&&console.log(this.to_debug_string(50)+" running "+C.length+" postponed additions. Stack is "+l.length+" long."),a.maximum_capacity=Number.MAX_VALUE,C.forEach(function(a){a()}),a.maximum_capacity=a.default_maximum_capacity,
C=[]),b;d&&e.UTILITIES.report_internal_error("Nothing removed from nest!")};r.dereference_path=function(a,b){if(0===l.length)return this.get_guid()?{wait_until_this_nest_receives_something:this}:this;if(l&&"function"===typeof l[0].dereference_path)return l[0].dereference_path(a,b);b.display_message("Robot expected to find something on a nest that it could get "+e.path.toString(a)+". But the nest is empty or contains something else.");return this};r.dereference_contents=function(a,b){var c,d,g,f,h,
k,m,n,q;return 0===l.length?{wait_until_this_nest_receives_something:this}:a.removing_widget?(c=l[0],b.remove_from_container(c,this),this.visible()&&(k=this.get_frontside_element(),d=$(k).offset(),g=$(k).closest(".toontalk-backside-of-top-level"),(f=g.offset())||(f={left:0,top:0}),h=c.get_element(!0),m=$(k).width(),k=$(k).height(),n=.1*m+d.left-f.left,q=.1*k+d.top-f.top,e.UTILITIES.set_css(h,{width:m*e.nest.CONTENTS_WIDTH_FACTOR,height:k*e.nest.CONTENTS_HEIGHT_FACTOR}),c.render(),0<g.length&&b.add_watched_step_end_listeners(function(){c.get_parent()&&
(g.get(0).appendChild(h),e.UTILITIES.set_css(h,{left:n,top:q}))})),c):a.next?l[0].get_widget().dereference_path&&(c=l[0].get_widget().dereference_path(a.next,b))?c:e.path.continue_dereferencing_path(a.next,l[0].get_widget(),b):l[0].get_widget()};r.get_json=function(a,b,c){var d=[],g=function(){var g=function(a,c){b({type:"nest",contents:d,guid:u,original_nest:a,serial_number:t,name:this.get_name()},c)}.bind(this);q?e.UTILITIES.get_json(q,a,g,c):g(void 0,c)}.bind(this);e.UTILITIES.get_json_of_array(l,
d,0,a,g,c)};r.copy=function(a){var c,d,g,f;if(a&&a.just_value){if(0<l.length&&(c=l[0].copy(a),!a.copy_covered_nests))return c;d=e.nest.create(this.get_description(),[],"in a robot's condition",void 0,t,this.get_name());c&&d.add_to_contents(c);return d}c=e.UTILITIES.copy_widget_sides(l,a);a?a.fresh_copy?d=e.nest.create(this.get_description(),c,u&&e.UTILITIES.generate_unique_id()):(g=q||this,a.birds_copied&&a.birds_copied[u]?(f=g.get_guid(),a.nests_copied&&a.nests_copied[f]?(d=a.nests_copied[f][0].copy(),
a.nests_copied[f].forEach(function(a){b.call(a,d)})):d=e.nest.create(this.get_description(),c,e.UTILITIES.generate_unique_id(),void 0,void 0,this.generate_name()),a.birds_copied[u].forEach(function(a){a.set_nest(d,this);e.debugging&&(a._debug_string=a.to_debug_string())}.bind(this))):(d=e.nest.create(this.get_description(),c,u,g,t,this.get_name()),f=u),a.nests_copied||(a.nests_copied={}),a.nests_copied[g]?a.nests_copied[f].push(d):a.nests_copied[f]=[d]):d=e.nest.create(this.get_description(),c,u,
q||this,t,this.get_name());return this.add_to_copy(d,a)};r.has_contents=function(){return 0<l.length};r.set_contents=function(a){l=a};r.dropped_on_other=function(a,b){var c,d,g,f,h,k,l;if(!u){u=e.UTILITIES.generate_unique_id();e.debugging&&(this._debug_string=this.to_debug_string());c=e.bird.create(this);if(b.robot){b.robot.add_newly_created_widget(c);if(!this.visible())return;this.robot_waiting_before_next_step=b.robot}b.event&&this.robot_in_training()&&this.robot_in_training().add_newly_created_widget(c);
e.sounds&&setTimeout(function(){e.sounds.hatching.play()},1E3);this.rerender();d=this.get_frontside_element(!0);e.UTILITIES.add_animation_class(d,"toontalk-hatch-egg");h=function(){var h,m,n;if(a.is_backside())h=a;else if((h=e.UTILITIES.widget_side_of_jquery($(d).closest(".toontalk-backside-of-top-level")))||(h=e.UTILITIES.widget_side_of_jquery($(a.get_widget().get_frontside_element(!0)).closest(".toontalk-backside-of-top-level"))),h)h=h.is_backside()?h:h.get_backside();else{e.UTILITIES.report_internal_error("Unable to find the top-level backside for bird to go to.");
return}m=h.get_element();n=$(m).offset();g=c.get_frontside_element(!0);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));e.UTILITIES.add_animation_class(g,"toontalk-fly-southwest");f=e.UTILITIES.relative_position(d,m);e.UTILITIES.set_css(g,{left:f.left,top:f.top});b.event&&this.robot_in_training()&&(b.ignore_training=!0);h.widget_side_dropped_on_me(c,b);$(d).removeClass("toontalk-hatch-egg").addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest")).css({width:"",
height:""});this.get_parent_of_frontside()&&this.get_parent_of_frontside().is_top_level()&&(e.UTILITIES.set_css(d,{left:f.left-5,top:f.top+45}),this.get_parent_of_frontside().render());l=function(){$(g).removeClass("toontalk-fly-southwest");e.UTILITIES.set_timeout(function(){e.UTILITIES.add_animation_class(g,"toontalk-fly-down");$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));k=function(){var a=function(){$(g).removeClass("toontalk-bird-morph-to-static toontalk-side-animating").addClass("toontalk-bird-static "+
this.get_class_name_with_color("toontalk-bird-static"))}.bind(this);$(g).removeClass("toontalk-fly-down");e.UTILITIES.add_animation_class(g,"toontalk-bird-morph-to-static");e.UTILITIES.add_one_shot_event_handler(g,"animationend",1E3,a);b.robot&&(this.robot_waiting_before_next_step=void 0,b.robot.run_next_step());c.update_display()}.bind(this);e.UTILITIES.add_one_shot_event_handler(d,"animationend",1E3,k)}.bind(this))}.bind(this);$(g).removeClass("toontalk-bird-static "+this.get_class_name_with_color("toontalk-bird-static"));
c.animate_to_absolute_position({left:Math.max(10,f.left-70)+n.left,top:Math.max(10,f.top+70)+n.top},l,b.robot&&b.robot.transform_animation_speed(e.animation_settings.BIRD_ANIMATION_SPEED));this.rerender()}.bind(this);e.UTILITIES.add_one_shot_event_handler(d,"animationend",2E3,h)}return!0};r.widget_side_dropped_on_me=function(a,b){b.event&&a.save_dimensions&&a.save_dimensions();0===l.length?(this.add_to_contents(a,b),a.dropped_on_other?a.dropped_on_other(this,b):b.event&&this.robot_in_training()&&
this.robot_in_training().dropped_on(a,this)):a.drop_on(l[0],b);return!0};r.drop_on=function(a,b){return a.widget_side_dropped_on_me?(a.widget_side_dropped_on_me(this,b),!0):!1};r.element_to_highlight=function(){return 0===l.length?this.get_frontside_element():l[0].get_frontside_element()};r.update_display=function(){var a=this.get_frontside(!0),b=this.get_backside(),c,d,g;c=a.get_element();0<l.length?(c.setAttribute("toontalk_name",""),d=l[0],d.is_backside()?(g=d.get_element(!0),d.update_display(),
d.scale_to_fit(g,c)):(d.set_visible(!0),d.render(),g=l[0].get_element(!0),$(g).show()),e.UTILITIES.when_attached(g,function(){var a=this.get_contents_dimensions(),b,f;a&&(b=$(c).width(),f=$(c).height(),e.UTILITIES.set_css(g,{width:a.width,height:a.height,left:b*(1-e.nest.CONTENTS_WIDTH_FACTOR)/2,top:f*(1-e.nest.CONTENTS_HEIGHT_FACTOR)/2}),d.set_size_attributes&&d.set_size_attributes(a.width,a.height),d.render())}.bind(this)),$(c).parent().is(".toontalk-box-hole")&&!$(c).parent().is(".toontalk-scale-half")?
(c.parentElement.appendChild(g),$(g).css({"z-index":e.UTILITIES.next_z_index()})):c.appendChild(g),$(c).addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest")),l[0].is_backside()?d.set_parent_of_backside(this):d.set_parent_of_frontside(this)):(c.setAttribute("toontalk_name",this.get_name()),u?($(c).removeClass(this.get_class_name_with_color("toontalk-nest-with-egg")),$(c).addClass("toontalk-empty-nest "+this.get_class_name_with_color("toontalk-empty-nest"))):e.UTILITIES.add_animation_class(c,
this.get_class_name_with_color("toontalk-nest-with-egg")),e.UTILITIES.set_css(c,{"font-size":this.name_font_size()}));e.UTILITIES.give_tooltip(c,this.get_title());$(c).addClass("toontalk-nest");b&&b.rerender()};d||(d=e.UTILITIES.generate_unique_id());r[d]=function(a,b){if(!y){if(b)return;y=[]}b?y.splice(y.indexOf(a),1):y.push(a)};r.get_contents_dimensions=function(){var a,b=this.get_frontside_element();a=$(b).parent().is(".toontalk-box-hole")&&!$(b).parent().is(".toontalk-scale-half")?b.parentElement:
b;b=$(a).width();a=$(a).height();b*=e.nest.CONTENTS_WIDTH_FACTOR;a*=e.nest.CONTENTS_HEIGHT_FACTOR;var c=l[0],d;if(c)return d=c.is_box()?1:2,c=c.get_border_size?d*c.get_border_size(b,a):0,{width:b-c,height:a-c}};r.get_path_to=function(a,b){var c,d;if(0<l.length){c=l[0].get_widget();if(c===a)return e.path.to_widget_on_nest();if(c.get_path_to&&(d=e.path.to_widget_on_nest(),c=c.get_path_to(a,b)))return d.next=c,d}};r.walk_children=function(a){if(0<l.length)return a(l[0])};r.top_contents_is=function(a){return 0<
l.length&&l[0]===a};r.any_nest_copies_visible=function(){var a=!1;if(!y)return!1;y.some(function(b){b.visible()&&(a=!0)});return a};r.compare_with=function(a){if(0<l.length)return l[0].compare_with(a);if(a.compare_with_nest)return-1*a.compare_with_nest(this)};r.compare_with_nest=function(a){return 0===l.length?0:1};r.compare_with_number=function(a){return 0<l.length?l[0].compare_with(a):-1};r.get_class_name_with_color=function(a){return t?a+["","-magenta","-yellow"][t%3]:a};r.generate_name=function(){m++;
return n&&"#"!==n[0]?e.UTILITIES.strip_trailling_digits(n).trim()+" "+m:"#"+m};r.has_name(r);r.get_name_width=function(a){return.8*(a||this.get_width())};r.get_name_height=function(a){return.5*(a||this.get_height())};J=r.set_name;r.set_name=function(a,b,c){var d=this.get_name();if(!J.call(this,a,b,c))return!1;b&&$(".toontalk-bird").each(function(){var b;this.getAttribute("toontalk_name")===d&&(b=e.UTILITIES.widget_side_of_element(this),e.UTILITIES.set_css(b.get_element(),{"font-size":e.UTILITIES.font_size(a,
.4*b.get_width(),{height:.6*b.get_height()})}),b.rerender())})};r.compare_with_box=r.compare_with_number;r.compare_with_scale=r.compare_with_number;r.add_standard_widget_functionality(r);c||(c=r.remove);r.remove=function(){c.call(this);q&&f.call(q,this)};r.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});O=r.set_visible;r.set_visible=function(a,b){O.call(this,a,b);a||this.set_locked(!1)};r.set_name(n);r.set_description(v);e.debugging&&(r._debug_id=e.UTILITIES.generate_unique_id(),
r._debug_string=r.to_debug_string());q&&u&&(d||(d=e.UTILITIES.generate_unique_id()),q[d](r));return r};a.create_function=function(a,b,c){var d=function(){return!1},g=e[b]&&e[b]["function"]&&e[b]["function"][c],d={is_nest:function(){return!0},get_function_type:function(a){return e[b].get_type_name(a)},get_function_object:function(){return g},set_function_name:function(a){if(c===a)return!1;c=a;g=e[b]&&e[b]["function"]&&e[b]["function"][c];this.add_to_contents=g.respond_to_message;return!0},is_function_nest:function(){return!0},
copy:function(){return e.nest.create_function(a,b,c)},animate_bird_delivery:function(a,b,c){b.animate_delivery_to(a,this,c)},get_json:function(a,c,d){c({type:"function_nest",function_type:b,function_name:g?g.name:e.UTILITIES.get_first_property(e[b]["function"])},d)},add_to_json:e.widget.add_to_json,get_widget:function(){return this},get_guid:function(){},get_name:function(){return g.short_name},get_backside_widgets:function(){return[]},has_ancestor:d,visible:d,any_nest_copies_visible:d,is_backside:d};
e.widget.has_parent(d);e.widget.has_description(d);e.widget.add_sides_functionality(d);d.set_description(a);g?(d.add_to_contents=g.respond_to_message,e.debugging&&(d._debug_id=e.UTILITIES.generate_unique_id(),d._debug_string="a function nest that "+g.toString())):e.UTILITIES.report_internal_error("Cannot create a function nest because TOONTALK."+b+"."+c+" is not defined.");return d};e.creators_from_json.function_nest=function(a,b){if(a)return e.nest.create_function(a.description,a.function_type,a.function_name)};
a.create_backside=function(){return e.nest_backside.create(this)};a.match_nest_with_nest=function(a){return"matched"};a.toString=function(){return this.get_name()?"nest named '"+this.get_name()+"'":"nest"};a.get_default_description=function(){return"a nest that receives things from its birds."};a.get_help_URL=function(){return"docs/manual/birds-nests.html"};a.get_type_name=function(a){return a?"nests":"nest"};a.maintain_proportional_dimensions=function(){return!0};a.matching_resource=function(a){return a.get_type_name&&
a.get_type_name()===this.get_type_name()};a.get_custom_title_prefix=function(){return"Drop something on my bird and she'll take it here."};e.creators_from_json.nest=function(b,c,d){if(!b)return Object.create(a);d||(d=!b.original_nest&&b.guid&&c&&c.guid_to_nest_table&&c.guid_to_nest_table[b.guid]);d=e.nest.create(b.description,[],b.guid,b.original_nest&&e.UTILITIES.create_from_json(b.original_nest,c),b.serial_number,b.name,d);d.set_contents(e.UTILITIES.create_array_from_json(b.contents,c));return c.guid_to_nest_table[b.guid]=
d};a.CONTENTS_WIDTH_FACTOR=1;a.CONTENTS_HEIGHT_FACTOR=1;return a}(window.TOONTALK);window.TOONTALK.nest_backside=function(b){return{create:function(a){a=b.backside.create(a);a.add_description_setting();a.add_name_setting();return a}}}(window.TOONTALK)})();window.TOONTALK.scale=function(b){var k=Object.create(b.widget);k.create=function(f,h,e,a,d){var c=function(){e.rerender()},g=function(){return e.get_contents_dimensions()},k,v,l,u;e||(e=b.box.create(2,void 0,f,h,d||""));k=e.get_json;v=e.copy;l=e.get_path_to;e.is_scale=function(){return!0};e.copy=function(a){var c;this.get_name();a||(a={});c=v.call(this,a);c=b.scale.create(void 0,void 0,c,a.just_value&&this.get_state());return e.add_to_copy(c,a)};e.get_json=function(a,b,c){var d=function(a,c){a.type=
"scale";a.inactive_state=this.get_inactive_state();b(a,c)}.bind(this);k.call(this,a,d,c)};e.get_path_to=function(a,b){var c=l.call(this,a,b);c&&(c.true_type="scale");return c};e.drop_on=function(a,b){if(a.widget_side_dropped_on_me)return a.widget_side_dropped_on_me(this,b)};e.widget_side_dropped_on_me=function(a,b){var c=this.get_hole_contents(0),d=this.get_hole_contents(1),e;a.dropped_on_other&&a.dropped_on_other(this,b);if(c&&!d)return this.get_hole(1).widget_side_dropped_on_me(a,b),!0;if(!c&&(d||
!b.event))return this.get_hole(0).widget_side_dropped_on_me(a,b),!0;e=this.which_hole(b.event,!1);if(0===e){if(c){if(c.drop_on)return a.drop_on(c,b);return}}else if(d){if(d.drop_on)return a.drop_on(d,b);return}this.get_hole(e).widget_side_dropped_on_me(a,b);return!0};e.which_hole=function(a,c){var d=e.get_frontside_element(),g=$(d).offset(),d=b.UTILITIES.get_element_width(d),g=a.clientX-(g.left+d/2),d=c?d/10:0;return-g>d?0:g>d?1:-1};e.get_inactive_state=function(){return a};e.update_display=function(){var a=
this.get_frontside_element(!0),c=$(a),d=$(a).children(".toontalk-scale-half"),e=$(a).parent(),e=e.is(".toontalk-backside")||c.is(".toontalk-conditions-contents")?a:e.get(0),f=$(e).width()||c.width(),h=$(e).height()||c.height(),k=function(a,c,d){var e=c.get_contents(),k=(e||c).get_element(!0),l,n,q;b.UTILITIES.set_css(a,{left:d*f*.5,top:0,width:.5*f,height:h});a!==k&&(l=0===d?-.05*f:.15*f,d="toontalk-scale-balanced"===m?.1*h:0===d&&"toontalk-scale-left_heavier"===m||1===d&&"toontalk-scale-right_heavier"===
m?.25*h:1===d&&"toontalk-scale-left_heavier"===m||0===d&&"toontalk-scale-right_heavier"===m?-.1*h:.2*h,n=.4*f,q=.4*h,$(k).css({left:l,top:d,width:n,height:q}),$(a).css({width:n,height:q}),e&&(e.set_location_attributes&&e.set_location_attributes(l,d),e.set_size_attributes&&e.set_size_attributes(n,q),e.is_backside()&&(e.update_display(),e.scale_to(n,q)),e.set_visible(!0),e.render()),a.appendChild(k),c.get_contents_dimensions=g,c.is_scale_pan=function(){return!0})},l,m;c.is(".toontalk-top-level-resource")?
m="toontalk-scale-balanced":(l=this.get_state(),m="undefined"===typeof l?"toontalk-scale-unbalanced":["toontalk-scale-right_heavier","toontalk-scale-balanced","toontalk-scale-left_heavier"][l+1]);c.removeClass("toontalk-scale-balanced toontalk-scale-left_heavier toontalk-scale-right_heavier toontalk-scale-unbalanced");c.addClass(m);c.addClass("toontalk-scale");0===f&&(f=1);0===h&&(h=1);$(e).is(".toontalk-top-level-resource")||$(a).is(".toontalk-top-level-resource")||(c=b.UTILITIES.scale_to_fit(a,
e,123,91),f/=c.x_scale,h/=c.y_scale);2===d.length?d.each(function(a,c){b.UTILITIES.set_timeout(function(){k(c,this.get_hole(a),a)}.bind(this))}.bind(this)):(this.get_holes().forEach(function(b,c){var d=b.get_element();b.get_contents();0===c?$(d).addClass("toontalk-left_scale  toontalk-scale-half"):$(d).addClass("toontalk-right_scale toontalk-scale-half");a.appendChild(d);b.update_display()}),setTimeout(function(){this.render()}.bind(this),100));b.UTILITIES.give_tooltip(a,this.get_title());b.debugging&&
(this._debug_string=this.to_debug_string())};e.get_contents_dimensions=function(){var a=this.get_frontside_element(!0),b=$(a).parent(),c=b.is(".toontalk-backside")||$(a).is(".toontalk-conditions-contents")?a:b.get(0),b=$(c).width()||$(a).width(),a=$(c).height()||$(a).height();return{width:.4*b,height:.4*a}};e.render=function(){b.DISPLAY_UPDATES.pending_update(this)};e.get_type_name=function(a){return a?"scales":"scale"};e.get_help_URL=function(){return"docs/manual/scales.html"};e.is_resizable=function(){return!1};
e.toString=function(){var a=this.get_hole_contents(0),c=this.get_hole_contents(1),d,e,g;switch(this.get_state()){case -1:d="scale leaning to the right";break;case 1:d="scale leaning to the left";break;case 0:d="balanced scale";break;default:if(d="unbalanced scale",!e&&!g)return d}e=a?"contains "+b.UTILITIES.add_a_or_an(a.get_full_description()):"is empty";g=c?"contains "+b.UTILITIES.add_a_or_an(c.get_full_description()):"is empty";return d+" and the left pan "+e+" and the right pan "+g};e.create_backside=
function(){return b.scale_backside.create(this)};e.get_state=function(){var a=this.get_inactive_state(),b;if(a)return a;a=this.get_hole_contents(0);b=this.get_hole_contents(1);if(a||b)if(a)if(b){if(a=a.dereference(),b=b.dereference(),a.get_widget().compare_with)return a.get_widget().compare_with(b.get_widget())}else return 1;else return-1};e.match=function(a){if(a.get_widget().match_with_scale)return a.get_widget().match_with_scale(this);this.last_match=a;return this};e.match_with_scale=function(a){var b;
return(b=this.get_hole_contents(0))&&b.is_nest()&&!b.has_contents()||(b=this.get_hole_contents(1))&&b.is_nest()&&!b.has_contents()?[[b,this]]:this.get_state()!==a.get_state()?(a.last_match=this,a):this.match_with_this_scale(a)};e.match_with_this_scale=function(a){var c=[],d,e,g;for(d=0;2>d;d++)if(g=a.get_hole_contents(d))if(e=this.get_hole_contents(d)){e=b.UTILITIES.match(g,e.dereference());if(e.is_widget)return e;"matched"!==e&&(c=0===c.length?e:c.concat(e))}else if(e=this.get_contents_temporarily_removed(d))c.push(e);
else return a.last_match=this,a;return 0<c.length?c:"matched"};e.match_with_this_box=function(a){a.last_match=this;return a};e.compare_with=function(a){if(a.compare_with_scale)return-1*a.compare_with_scale(this)};e.compare_with_scale=function(a){var b=this.get_state();a=a.get_state();return b&&!a?1:!b&&a?-1:b>a?1:b<a?-1:0};e.get_name_input_label=void 0;e.generate_name=function(){return""};e.get_custom_title_prefix=function(){var a=this.get_state(),b=this.get_hole_contents(0),c=this.get_hole_contents(1);
if("undefined"===typeof a)return b&&c?"I can't compare "+b+" and "+c+".":"Use me to compare two things. Drop them in my pans.";b||(b="empty pan");c||(c="empty pan");return["The "+c+" is greater than the "+b+".","The "+c+" is equal to the "+b+".","The "+c+" is less than the "+b+"."][a+1]};e.get_default_description=function(){return"a scale for comparing things."};u=e.set_visible;e.set_visible=function(a,b){var d=function(a){a.new_value&&a.new_value.add_listener("value_changed",c);a.old_value&&a.old_value.remove_listener("value_changed",
c,!0)};u.call(this,a,b?b+1:1);a?(e.get_hole(0).add_listener("contents_or_properties_changed",d),e.get_hole(1).add_listener("contents_or_properties_changed",d)):(e.get_hole(0).remove_listener("contents_or_properties_changed",d,!0),e.get_hole(1).remove_listener("contents_or_properties_changed",d,!0));e.get_hole_contents(0)&&e.get_hole_contents(0).add_listener("value_changed",c);e.get_hole_contents(1)&&e.get_hole_contents(1).add_listener("value_changed",c)};e.set_name=void 0;b.debugging&&(e._debug_id=
b.UTILITIES.generate_unique_id(),e._debug_string=e.to_debug_string());return e};b.creators_from_json.scale=function(f,h){if(f)return k.create(b.UTILITIES.create_array_from_json(f.contents,h),f.description,void 0,f.inactive_state,f.name)};return k}(window.TOONTALK);window.TOONTALK.scale_backside=function(b){return{create:function(k){var f=b.backside.create(k);f.add_description_setting();f.get_element().appendChild(b.backside.create_advanced_settings_button(f,k));return f}}}(window.TOONTALK);(function(){window.TOONTALK.robot=function(b){var k=function(e,a,d,c,g){var f;d.current_action_name=a;(e=b.path.get_path_to(e,d,!0))?(c||(c={}),f=Date.now(),c.time=f-d.time_of_last_step,d.time_of_last_step=f,d.add_step(b.robot_action.create(e,a,c),g)):console.log("No path found for "+a);d.current_action_name=void 0},f=Object.create(b.widget),h=0;f.create=function(e,a,d,c,g,h,k,l,u){var m=Object.create(f),t,n,v,z=[],C=[],A,y,J,O,G,R,Q,H,D;d||(d=b.actions.create());n||(n=m);e&&e.set_parent_of_frontside(m);
m.is_robot=function(){return!0};m.get_frontside_conditions=function(){return e};m.set_frontside_conditions=function(a){(e=a)&&e.set_parent_of_frontside(this)};m.get_backside_matched_widgets=function(){return D};m.set_backside_matched_widgets=function(a){D=a};m.get_matched_backside_widget=function(a){if(D)return D[Q.indexOf(a)]};m.get_backside_widget_of_type=function(a,b){var c,d;if(D)return D[a];if(c=b&&b.get_backside_widgets())return c.some(function(b){if(b.is_of_type(a)&&0>this.get_newly_created_widgets().indexOf(b))return d=
b,!0}.bind(this)),d};m.get_backside_conditions=function(){return a};m.set_backside_conditions=function(c){$.isArray(c)?a=c.map(function(a){return a.is_nest&&a.is_nest()?a.dereference().copy():a}):(a=[],b.UTILITIES.available_types.forEach(function(b){c[b]&&a.push(c[b])}));a&&a.forEach(function(a){a.is_backside()?a.set_parent_of_backside(this):(b.widget.erasable(a),a.set_parent_of_frontside(this))}.bind(this))};a&&m.set_backside_conditions(a);m.initialize_backside_conditions=function(){var a=this.get_training_context();
Q=a?a.get_backside_widgets().slice():[];H=b.UTILITIES.copy_widget_sides(Q,{just_value:!0});this.set_backside_conditions([])};m.add_to_backside_conditions=function(c){var d;0<=this.get_newly_created_widgets().indexOf(c)||(a||(a=[]),c=Q.indexOf(c),0<=c&&(d=H[c]),d&&0>a.indexOf(d)&&(a.push(d),b.widget.erasable(d)))};m.get_backside_condition_index=function(a){var b;D?(b=D.indexOf(a),0>b&&(b=D.length,D.push(a))):(b=0,D=[a]);return b};m.get_body=function(){return d};m.set_body=function(a){d=a};m.get_running=
function(){return G||this.is_ok_to_run()};m.running_or_in_run_queue=function(){return G};m.set_running_or_in_run_queue=function(a){G=a};m.stopped=function(){return R};m.set_stopped=function(a){R&&(G=!1);if(R!==a){if(R=a)this.run_body_finished_listeners(),this.visible()&&($(this.get_frontside_element()).removeClass("toontalk-robot-waiting"),this.set_animating(!1),this.rerender());this.get_next_robot()&&this.get_next_robot().set_stopped(a)}};m.drop_thing_in_hand=function(){g&&(g.drop_on(this.top_level_widget(),
{robot:this}),this.set_thing_in_hand(void 0))};m.finish_cycle_immediately=function(a){var b=function(){this.set_visible(!1);a&&a()}.bind(this);this.add_body_finished_listener(b)};m.get_context=function(){return A};m.set_context=function(a){A=a;this.get_next_robot()&&this.get_next_robot().set_context(a)};m.context_is_backside=function(){return y};m.set_context_is_backside=function(a){y=a;this.get_next_robot()&&this.get_next_robot().set_context_is_backside(a)};m.get_top_level_context=function(){return J};
m.set_top_level_context=function(a){J=a;this.get_next_robot()&&this.get_next_robot().set_top_level_context(a)};m.get_queue=function(){return O};m.set_queue=function(a){O=a;this.get_next_robot()&&this.get_next_robot().set_queue(a)};m.animate_consequences_of_actions=function(){return this.visible()&&!this.stopped()};m.transform_step_duration=function(a){return!this.visible()||this.stopped()||A&&!A.get_backside()?0:a&&u?a/u:a};m.transform_original_step_duration=function(a){if(!this.visible()||this.stopped()||
A&&!A.get_backside())return 0;if(0===u)return a};m.transform_animation_speed=function(a){return A&&!A.get_backside()||!this.visible()||this.stopped()?0:u?a*u:a};m.set_animating=function(a,c){var d=this.get_frontside_element(),e;a&&b.UTILITIES.visible_element(d)?(c||(c=$(d).offset()),$(d).css({width:"",height:"","z-index":b.UTILITIES.next_z_index()}),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c),e=$(d).closest(".toontalk-backside-of-top-level"),0<e.length&&e.get(0).appendChild(d),
$(d).addClass("toontalk-robot-animating"),setTimeout(function(){$(d).addClass("toontalk-side-animating")},2E3)):$(d).removeClass("toontalk-robot-animating toontalk-side-animating")};m.add_body_finished_listener=function(a){z.push(a)};m.run_body_finished_listeners=function(){z.forEach(function(a){a()});z=[]};m.add_watched_step_end_listeners=function(a){C.push(a)};m.run_watched_step_end_listeners=function(){C.forEach(function(a){a()});C=[]};m.get_thing_in_hand=function(){return g};m.set_thing_in_hand=
function(a){if(b.debugging){if(a&&"empty hole"===a.get_type_name()){b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole.");return}b.logging&&0<=b.logging.indexOf("thing_in_hand")&&console.log(this.to_debug_string(50)+" now has in his hand "+(a?a.to_debug_string(50):"nothing"))}a&&!a.constrained_by_container()&&a.save_dimensions();g=a};m.get_next_robot=function(){return k};m.set_next_robot=function(a){var b=this.get_backside_element();a&&a.set_first_in_team(this.get_first_in_team());
!a&&k&&(k.set_first_in_team(k),k.set_previous_robot(void 0));(k=a)&&k.set_previous_robot(this);b&&($(b).find(".toontalk-drop-area-instructions").get(0).innerHTML=this.drop_area_instructions())};m.get_previous_robot=function(){return v};m.set_previous_robot=function(a){v=a};m.get_first_in_team=function(){return n};m.set_first_in_team=function(a){n=a;k&&k.set_first_in_team(a)};m.walk_children=function(a){var b;k&&!a(k)||!(b=this.get_frontside_conditions())||b.is_top_level()||a(b)};m.get_run_once=function(){return h};
m.set_run_once=function(a){h=a;this.update_title();return!0};m.get_watched_speed=function(){return u};m.set_watched_speed=function(a){u=a;return!0};m.can_run=function(){return this.get_frontside_conditions()&&this.get_frontside_conditions().is_top_level()||b.widget.can_run.call(this)};m.training_started=function(a){var c=this.get_training_context();c?this.being_trained||(this.time_of_last_step=Date.now(),this.being_trained=!0,this.set_frontside_conditions(c.copy({just_value:!0})),this.initialize_backside_conditions(),
a||($("*").css({cursor:"url("+b.UTILITIES.absolute_file_path("images/RB19.32x32.PNG")+"), default"}),$(this.get_frontside_element()).addClass("toontalk-ghost_robot")),this.update_title(),a=this.get_backside_element(),$(a).find(".toontalk-conditions-panel").remove(),this.robot_training_this_robot()&&this.robot_training_this_robot().started_training_another(this)):b.UTILITIES.report_internal_error("Robot started training but can't find its 'context'.")};m.training_finished=function(){if(this.being_trained){var a,
c,d;a=this.get_body().get_newly_created_widgets();for(c=0;c<a.length;c++)d=a[c],"copy"===d.last_action&&this.add_step(b.robot_action.create(b.newly_created_widgets_path.create(c),"add to the top-level backside"));$(this.get_frontside_element()).removeClass("toontalk-ghost_robot");this.rerender();this.being_trained=!1;this.update_title();this.backup_all();this.robot_finished_training();this.robot_in_training()?this.robot_in_training().finished_training_another(this):$("*").css({cursor:""})}};if(b.debugging||
b.logging)m.to_debug_string=function(a){var c=this.get_frontside_conditions();return("Robot ("+(this.get_description()||"")+" "+this.get_name()+") runs if working on "+(c?b.UTILITIES.add_a_or_an(c.toString()):"anything")).substring(0,a)};k&&m.set_next_robot(k);m.add_standard_widget_functionality(m);t=m.remove_backside_widget.bind(m);m.has_name(m);m.set_name(l);m.set_description(c);b.listen&&m.add_speech_listeners({descriptions_acceptable:!0,names_acceptable:!0});m.remove_backside_widget=function(a,
b){var c=this.get_frontside_conditions(),d;a===c?this.set_frontside_conditions(void 0):(d=this.get_backside_conditions())&&d.some(function(b,c){if(a===b)return d.splice(c,1),!0})||t(a,b)};b.debugging&&(m._debug_id=b.UTILITIES.generate_unique_id(),m._debug_string=m.to_debug_string());return m};f.create_backside=function(){return b.robot_backside.create(this)};f.copy=function(e){var a=this.get_frontside_conditions(),d=this.get_backside_conditions(),a=a?a.copy({just_value:!0}):void 0,c=this.get_next_robot(),
c=c?c.copy(e):void 0,g;d&&(g=b.UTILITIES.copy_widgets(d,{just_value:!0}));d=this.create(a,g,this.get_body().copy(),this.get_description(),this.get_thing_in_hand(),this.get_run_once(),c,(!e||!e.fresh_copy)&&this.get_name(),this.get_watched_speed());return this.add_to_copy(d,e)};f.match=function(b){var a,d;if(b.get_widget().is_robot()&&(a=this.get_body().is_empty(),d=b.get_widget().get_body().is_empty(),a===d))return"matched";this.last_match=b;return this};f.generate_name=function(){h++;return"#"+h.toString()};
f.run=function(e,a,d,c){var g=this.get_frontside_conditions(),f,h,k,u,q;if(this.being_trained||this.running_or_in_run_queue())return this;(q=this.get_backside())&&q.visible()&&g&&(k=function(a){$(a.get_element()).removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting").find(".toontalk-conditions-not-matched, .toontalk-conditions-waiting").removeClass("toontalk-conditions-not-matched toontalk-conditions-waiting")},k(g),this.rerender());e?(this.set_context(e),this.set_context_is_backside(a),
this.set_top_level_context(d),this.set_queue(c)):e=this.get_context();this.match_status=b.UTILITIES.match(g,this.get_context());"matched"===this.match_status&&(u=[],(g=this.get_backside_conditions())&&0<g.length&&((f=e.get_backside_widgets())&&g.some(function(a){var c,d;a.matching_widget&&a.matching_widget.get_parent===e&&(c=b.UTILITIES.match(a,a.matching_widget),"matched"===c&&(u.push(a.matching_widget),d=c));d||f.some(function(e){c=void 0;if(!(0<=u.indexOf(e))){if(e!==this&&!e.is_backside()){k&&
k(e);c=b.UTILITIES.match(a,e);if("matched"===c)return u.push(e),d=c,a.matching_widget=e,!0;if(!c.is_widget)d=c;else if(!d||d.is_widget)d=c}void 0===d&&(d=a)}}.bind(this));if("matched"!==d)return this.match_status=d,!0}.bind(this)),"matched"!==this.match_status&&(u=void 0),this.set_backside_matched_widgets(u)));if("matched"===this.match_status)return c||(c=this.get_queue()||b.DEFAULT_QUEUE),this.get_body().reset_newly_created_widgets(),c.enqueue(this),this.match_status;if(this.match_status.is_widget)return $(this.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"),
this.rerender(),this.get_next_robot()?this.get_next_robot().run(e,a,d,c):this.match_status;this.match_status.forEach(function(a){a[1]&&$(a[1].get_element()).addClass("toontalk-conditions-waiting")});if(this.get_next_robot()){a=this.get_next_robot().run(e,a,d,c);if("matched"===a)return a;a.is_widget||a.forEach(function(a){0>this.match_status.indexOf(a)&&this.match_status.push(a)}.bind(this))}this.get_first_in_team()===this&&(h=function(){this.set_waiting(!1);this.run()}.bind(this),this.match_status.forEach(function(a){a[0]?
a[0].run_when_non_empty(h,this):a.run_when_non_empty(h,this)}.bind(this)),this.set_waiting(!0));return this.match_status};f.set_waiting=function(e){var a=this.get_frontside_element();a&&(e?this.visible()&&!this.stopped()&&(b.UTILITIES.add_animation_class(a,"toontalk-robot-waiting"),b.UTILITIES.give_tooltip(a,"This robot is waiting for a bird to deliver something.")):($(a).removeClass("toontalk-robot-waiting"),b.UTILITIES.give_tooltip(a,this.get_title())))};f.run_actions=function(){if(this.stopped())return this.get_first_in_team().set_running(!1),
!1;if(this.get_first_in_team().visible())return this.get_body().run_watched(this);this.set_parent_of_frontside(this.get_context());return this.get_body().run_unwatched(this)};f.drop_from_data_transfer=function(b,a){var d;b.is_top_level&&b.is_top_level()?(d=b.get_backside_widgets().slice(),setTimeout(function(){d.forEach(function(b){this.picked_up(b,void 0,!0);this.time_of_last_step-=1E3;this.dropped_on(b,a.get_backside());this.time_of_last_step-=1E3}.bind(this))}.bind(this))):this.data_transfer=b};
f.ignore_pick_up_or_drop=function(b){return this===b.get_widget()||b.is_top_level()||this.get_parent_of_frontside()===b};f.picked_up=function(e,a,d){var c,g,f;if(!this.ignore_pick_up_or_drop(e))return e.get_infinite_stack&&e.get_infinite_stack()?(this.current_action_name="pick up a copy of",g=b.UTILITIES.get_dragee_copy()):this.current_action_name="pick up",d?(f=e,g=e.copy({fresh_copy:!0}),a=b.path.get_path_to_resource(g)):a=b.path.get_path_to(e,this,!0),a&&(d=Date.now(),c={time:d-this.time_of_last_step},
this.time_of_last_step=d,c=b.robot_action.create(a,this.current_action_name,c),this.add_step(c,f)),e.last_action=this.current_action_name,this.current_action_name=void 0,this.set_thing_in_hand(g||e),c};f.dropped_on=function(e,a){var d,c,g,f,h;if(!(this.ignore_pick_up_or_drop(e)||e.is_backside()&&this.get_parent_of_frontside()&&this.get_parent_of_frontside().get_widget()===e)){this.data_transfer&&(this.picked_up(this.data_transfer,void 0,!0),this.data_transfer=void 0,this.time_of_last_step-=1E3);this.current_action_name=
"drop it on";if(d=b.path.get_path_to(a,this)){if(a.is_backside()){if(g=$(a.get_element()),f=g.offset())h=g.width(),g=g.height(),c=$(e.get_frontside_element()).offset(),h=(c.left-f.left)/h,f=(c.top-f.top)/g,h=Math.max(0,Math.min(1,h)),f=Math.max(0,Math.min(1,f)),c={left_offset_fraction:h,top_offset_fraction:f}}else c={};f=Date.now();c.time=f-this.time_of_last_step;this.time_of_last_step=f;d=b.robot_action.create(d,this.current_action_name,c);this.add_step(d)}e.last_action=this.current_action_name+
" "+a.get_type_name();this.current_action_name=void 0;this.set_thing_in_hand(void 0)}};f.dropped_on_text_area=function(b,a,d){k(b,"drop it on the text area of",this,d);b.last_action="drop it on the text area of "+a.get_type_name();this.set_thing_in_hand(void 0)};f.copied=function(b,a,d){d=d?"pick up a copy of":"copy";k(b,d,this,void 0,a);a.last_action=d};f.removed=function(b){var a;this.get_parent()&&(a=this.get_parent().get_widget());k(b,"remove",this);b.last_action="remove";a===b||b===this?(this.add_to_top_level_backside(this.copy()),
this.training_finished()):this.add_newly_created_widget_if_new(b)};f.restored=function(b){k(b,"restore",this)};f.edited=function(b,a){k(b,"edit",this,a)};f.erased_widget=function(b){k(b,"change whether erased",this)};f.resized_widget=function(b,a,d,c,g){a===c&&d===g||k(b,"change size of",this,{x_factor:c/a,y_factor:g/d})};f.started_training_another=function(b){k(b,"start training",this)};f.finished_training_another=function(b){k(b,"stop training",this)};f.trained=function(b,a){k(b,"train",this,{step:a})};
f.backside_opened=function(b){k(b,"open the backside",this)};f.backside_closed=function(b){b.is_primary_backside()?k(b.get_widget(),"close the backside",this):this.removed(b)};f.button_clicked=function(b,a){k(a.get_widget(),"click the button of",this,{button_selector:b})};f.created_widget=function(e,a,d){this.add_newly_created_widget(e);e.get_parent()||this.add_to_top_level_backside(e,!1);this.add_step(b.robot_action.create(b.path.get_path_to_resource(e.copy()),"add a new widget to the work space",
{button_selector:d,path_to_source:b.path.get_path_to(a,this)}))};f.get_newly_created_widgets=function(){return this.get_body().get_newly_created_widgets()};f.remove_from_container=function(b,a){var d=a.get_index_of&&b.get_parent_of_frontside()&&a.get_index_of(b),c=function(){a.removed_from_container(b,void 0,d,!0)};b=b.dereference();this.animate_consequences_of_actions()?this.add_watched_step_end_listeners(c):c();this.add_newly_created_widget_if_new(b)};f.get_training_context=function(){return this.get_first_in_team().get_parent_of_frontside()&&
this.get_first_in_team().get_parent_of_frontside().get_widget()};f.add_step=function(b,a){this.get_body().add_step(b,a);this.update_title();"train"!==b.get_action_name()&&"start training"!==b.get_action_name()&&this.robot_training_this_robot()&&this.robot_training_this_robot().trained(this,b)};f.update_display=function(){var e=this.get_frontside(!0);this.get_backside();var a=this.get_thing_in_hand(),d,c;b.debugging&&(this._debug_string=this.to_debug_string());d=e.get_element();a&&(c=a.get_element());
!c&&this.carrying_tool&&(c=document.createElement("div"),$(c).addClass(this.carrying_tool));b.UTILITIES.give_tooltip(d,this.get_title());$(d).addClass("toontalk-robot");$(d).children(".toontalk-held-by-robot").remove();c&&d.appendChild(c);this.match_status&&(this.match_status.is_widget?$(d).addClass("toontalk-side-animating toontalk-robot-not-matched"):$(d).removeClass("toontalk-robot-not-matched"));d.setAttribute("toontalk_name",this.get_name());b.UTILITIES.set_timeout(function(){var e,f,h,k,u;c&&
(u={position:"absolute"},$(c).addClass("toontalk-held-by-robot"),e=b.UTILITIES.get_element_width(c),b.UTILITIES.get_element_height(c),h=b.UTILITIES.get_element_width(d),k=b.UTILITIES.get_element_height(d),a&&0===e&&(e=a.get_default_width?a.get_default_width():2*h,f=a.get_default_height?a.get_default_height():k/2,u.width=e,u.height=f),u.left=(h-e)/2,u.top=k/4,$(c).css(u),a&&a.rerender())});b.UTILITIES.set_css(d,{"font-size":this.name_font_size()})};f.add_newly_created_widget=function(b){return this.get_body().add_newly_created_widget(b)};
f.add_newly_created_widget_if_new=function(b){if(b!==this.get_training_context()&&this!==b)return this.get_body().add_newly_created_widget_if_new(b)};f.is_newly_created=function(b){return this.get_body().is_newly_created(b)};f.get_recently_created_widget=function(){var b=this.get_body().get_newly_created_widgets();return b[b.length-1]};f.get_title=function(){var b=this.get_description();if(b)return b="I'm "+b,0>b.lastIndexOf(".")&&(b+="."),b+"\n"+this.toString();b=this.get_frontside_element();return $(b).is(".toontalk-top-level-resource")?
"Drag this robot to a work area.":this.toString()};f.toString=function(e){var a,d,c,g,f,h,k,u,q,t,n,r,z,C;if(e&&"conditions"===e.role)return"any robot";if(e&&"match_status"===e.role)return"robot "+this.get_name();a=this.get_frontside_conditions();if(!a)return"an untrained robot";k=a.is_top_level();e||(e={});n=e.person;if(e&&e.resource){if(this.get_description())return'"'+this.get_description()+'"';e.person="third"}d=this.get_backside_conditions();g=this.get_body();h=f="";q=this.get_next_robot();k?
t="When the workspace's green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+" is pressed":(u=b.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),t="When working on something that matches "+u);d&&(d.forEach(function(a){a&&(t+=" and\nif on the"+(k?" work area ":" back ")+" is "+b.UTILITIES.add_a_or_an(a.get_full_description({role:"conditions"})),c=!0)}),c&&(t+="\n"));if(this.being_trained){if(g.is_empty())return"I'm ready to be trained. Show me what to do and then click on my 'Stop training' button.";
f="is being trained.\n";h="\n..."}try{C=g.toString({robot:this})}catch(A){C=b.UTILITIES.is_stack_overflow(A)?"...":"Describing the actions caused this error: "+A.message}g=f+t+(e&&"third"===e.person?" he will ":" I will ")+(this.get_run_once()?"":"repeatedly ")+"\n"+(C||"do nothing")+h;if(e&&e.resource)return e.person=n,g.replace(/\n/g," ");this.match_status&&(this.match_status.is_widget?(z=a.is_top_level()?"the work area I'm running on":"the "+a.get_type_name()+" I'm on the back of",this.match_status===
a?r=z:this.match_status.has_ancestor(a)?r="the "+(this.match_status.last_match?this.match_status.last_match.toString():"thing")+" inside the "+z:(a.is_top_level()||(z="the "+this.match_status.get_type_name()+" on "+z),d.some(function(b){if(this.match_status===b)return r="any "+b.get_type_name(!0)+" on ",a.is_top_level()||(r+="the back of "),r+=z,!0;if(this.match_status.has_ancestor(b))return r="any "+this.match_status.toString()+" inside the "+b.get_type_name(!0)+" on the back of "+z,!0}.bind(this))),
g="I'm not running because the "+this.match_status.toString({role:"match_status"})+" (highlighted in red on my backside) that I'm expecting doesn't match "+r+". Perhaps editing my conditions will help.\n"+g):"matched"!==this.match_status&&(g="I'm waiting for something to be delivered to the nest that matches "+(this.match_status[0][1]?b.UTILITIES.add_a_or_an(this.match_status[0][1].toString()):b.UTILITIES.add_a_or_an(this.match_status[0].toString()))+" in my conditions (highlighted in yellow on my backside).\n"+
g));q&&(g+="<p>If it doesn't match then the next robot will try to run.<p><p>"+q.toString()+"</p>");return g};f.get_type_name=function(b){return b?"robots":"robot"};f.maintain_proportional_dimensions=function(){return!0};f.matching_resource=function(b){return b.is_robot()&&!this.get_frontside_conditions()&&!b.get_frontside_conditions()&&this.get_body().is_empty()&&b.get_body().is_empty()};f.get_top_level_context_description=function(b){var a=this.get_frontside_conditions().get_type_name();return"top-level"===
a?b&&"third"===b.person?"his workspace":"my workspace":b&&"third"===b.person?"the "+a+" he's working on":"the "+a+" I'm working on"};f.get_help_URL=function(){return"docs/manual/robots.html"};f.drop_area_instructions=function(){return this.get_next_robot()?"This robot here will try to run when I can't:&nbsp;&nbsp;":"Drop a robot here who will try to run when I can't."};f.get_name_height=function(b){return.4*(b||this.get_height())};f.get_contents_dimensions=function(){return{width:240,height:60}};
f.get_json=function(e,a,d){var c=this.get_frontside_conditions(),g=this.get_backside_conditions(),f,h=function(){var g=function(d,g){var h=function(b,c){a({type:"robot",frontside_conditions:b,backside_conditions:f,body:k,run_once:this.get_run_once(),next_robot:d,name:this.get_name(),speed:this.get_watched_speed()},c)}.bind(this);this.get_body().get_json(e,function(a,d){k=a;c?c.is_top_level()?h({type:"top_level"},d):b.UTILITIES.get_json(c,e,h,d):h(void 0,d)},g)}.bind(this);this.get_next_robot()?b.UTILITIES.get_json(this.get_next_robot(),
e,g,d):g(void 0,d)}.bind(this),k;g?(f=[],b.UTILITIES.get_json_of_array(g,f,0,e,h,d)):h()};b.creators_from_json.robot=function(e,a){if(e){var d,c,g,f;e.thing_in_hand&&(c=b.UTILITIES.create_from_json(e.thing_in_hand,a));e.next_robot&&(d=b.UTILITIES.create_from_json(e.next_robot,a));e.backside_conditions&&($.isArray(e.backside_conditions)?f=b.UTILITIES.create_array_from_json(e.backside_conditions,a):e.semantic&&b.UTILITIES.available_types.forEach(function(a){e.semantic.backside_conditions[a]&&f.push(b.UTILITIES.get_json(e.semantic.backside_conditions[a],
json_history))}));g=b.UTILITIES.create_from_json(e.frontside_conditions||e.bubble,a);d=b.robot.create(g,f,void 0,e.description,c,e.run_once,d,e.name,e.speed);a||(a={});a.robot=d;d.set_body(b.UTILITIES.create_from_json(e.body,a));return d}};f.find_conditions_path=function(e,a,d){var c=a.get_frontside_conditions(),g=c===e?"entire_condition":c&&c.get_path_to&&c.get_path_to(e,d),c=b.path.get_path_to(a,d),f,h;g||(f=a.get_backside_conditions(),f.some(function(b){if(b&&b!==d&&b!==a&&(g=b.get_path_to(e,d)))return h=
b,!0}));if(g)return b.robot.create_conditions_path(g,c,h);b.UTILITIES.report_internal_error("Robot has widget in its conditions but unable to construct the path.")};f.create_conditions_path=function(e,a,d){"string"===typeof d&&this.get_backside_conditions().some(function(a){if(a&&a.get_type_name()===d)return d=a,!0});return{dereference_path:function(c){var g=b.path.dereference_path(a,c),g=d?d:g.get_frontside_conditions();return"entire_condition"===e?g:b.path.dereference_path(e,c,g)},toString:function(){var c=
"entire_condition"===e?"the ":b.path.toString(e)+" of the ";return d?c+d.toString()+" backside condition of "+b.path.toString(a):c+" front side condition of "+b.path.toString(a)},get_json:function(c,g,f){var h=function(b,f){a.get_json(c,function(a,b){var f=function(b,c){g({type:"path_to_robot_conditions",backside_condition:d&&b,path_to_robot:a,path_within_conditions:b},c)};"entire_condition"===e?f("entire_condition",b):e.get_json(c,f,b)},f)};d?b.UTILITIES.get_json(d,c,h,f):h(void 0,f)}}};b.creators_from_json.path_to_robot_conditions=
function(e){var a=b.UTILITIES.create_from_json(e.path_to_robot),d="entire_condition"===e.path_within_conditions?e.path_within_conditions:b.UTILITIES.create_from_json(e.path_within_conditions);e=e.backside_condition&&b.UTILITIES.create_from_json(e.backside_condition);return b.robot.create_conditions_path(d,a,e)};return f}(window.TOONTALK);window.TOONTALK.robot_backside=function(b){var k=function(f,e,a,d){f=b.UTILITIES.create_text_element(f);var c=e.get_element(!0),g=document.createElement("div"),h=
function(){var a;$(c).parent().addClass("toontalk-conditions-container");e.visible()&&(e.update_display(),a={width:$(g).width(),height:$(g).height(),left:"",top:""},e.use_scaling_transform?e.use_scaling_transform(a):e.is_backside()&&b.UTILITIES.scale_element(c,a.width,a.height,e.get_original_width()||$(c).width(),e.get_original_height()||$(c).height(),void 0,a),$(c).is(".toontalk-box")||$(c).is(".toontalk-image-element")||$(c).is(".toontalk-number")||$(c).css(a),e.rerender())};$(c).addClass("toontalk-conditions-contents "+
d);a.match_status&&(a.match_status.is_widget?$(a.match_status.get_frontside_element()).addClass("toontalk-conditions-not-matched"):"matched"!==a.match_status&&a.match_status.forEach(function(a){$(a[1].get_element()).addClass("toontalk-conditions-waiting")}));g.appendChild(c);a=b.UTILITIES.create_horizontal_table(f,g);$(a).addClass("toontalk-conditions-panel");b.UTILITIES.run_when_dimensions_known(c,function(){setTimeout(h,100)});return a},f=function(f,e){var a=e.get_frontside_conditions(),d=e.get_backside_conditions(),
c=e.visible(),g;a&&(a.is_top_level()?0>f.firstChild.textContent.indexOf("I always run when the green flag")&&f.insertBefore(b.UTILITIES.create_text_element("I always run when the green flag <span class='toontalk-green-flag-icon'></span> is clicked."),f.firstChild):0>f.firstChild.textContent.indexOf("I run only if the thing I'm on the back of matches: ")&&f.insertBefore(k("I run only if the thing I'm on the back of matches: ",a,e,"toontalk-frontside-conditions-area"),f.firstChild),a.set_visible(c),
a.rerender());d&&0===$(f).find(".toontalk-backside-condition").length&&d.forEach(function(a){var d,h;a&&(h=a.is_backside()?"on-backside":a.get_type_name(),g="toontalk-backside-"+h+"-conditions-area toontalk-backside-condition","bird"===h?0===$(f).find(".toontalk-bird-on-back-condition").length&&(d=b.UTILITIES.create_text_element("And there is a bird on the back."),$(d).addClass("toontalk-bird-on-back-condition toontalk-backside-condition")):d=k("And if "+b.UTILITIES.add_a_or_an(h)+" matches: ",a,
e,g),d&&f.insertBefore(d,f.firstChild.nextSibling),a.set_visible(c),a.rerender())})};return{create:function(h){var e=b.backside.create(h),a=e.get_element(),d=function(a){return a?"Check this if you want the robot to start over again after finishing what he was trained to do.":"Uncheck this if you want the robot to stop after finishing what he was trained to do."},c=b.UTILITIES.create_check_box(!h.get_run_once(),"toontalk-run-once-check-box","When finished start again",d(h.get_run_once())),g="normal;original;double;half;very fast;very slow".split(";"),
k=[1,0,2,.5,10,.25],v=function(a){a=g.indexOf(a);return k[a]},l=b.UTILITIES.create_select_menu("robot_speed",g,"toontalk-select-function","  What speed should I run at? ","Click to select the speed I'll run when watched.","The normal speed for each step;The original delay between steps when I was trained;Double the normal speed;Half the normal speed;Ten times normal speed;One-fourth of normal speed".split(";")),u=b.UTILITIES.create_drop_area(h.drop_area_instructions()),q=h.get_next_robot(),t=b.backside.create_advanced_settings_button(e,
h),n=e.update_display.bind(e),r=function(a,b){var c=a.get_frontside_element(!0),d,e;a.get_default_width&&(d=a.get_default_width(),e=a.get_default_height(),$(c).css({left:"",top:"",width:d,height:e}));b.appendChild(c)},z=e.hide_backside,C=e.add_advanced_settings;e.hide_backside=function(a){z.call(this,a);h.being_trained&&h.training_finished()};$(u).data("drop_area_owner",h);c.button.addEventListener("click",function(a){var e=c.button.checked;h.set_run_once(!e);b.UTILITIES.give_tooltip(c.container,
d(!e));h.robot_in_training()&&h.robot_in_training().edited(h,{setter_name:"set_run_once",argument_1:!e,toString:"change to "+(e?"run again":"run once")+" of the robot",button_selector:".toontalk-run-once-check-box"});a.stopPropagation()});$(l.menu).val(function(a){a=void 0!==a?k.indexOf(a):0;return g[a]}(h.get_watched_speed())).selectmenu("refresh");$(l.menu).on("selectmenuselect",function(a){h.set_watched_speed(v(a.target.value))});q&&r(q,u);u.addEventListener("drop",function(a){(a=b.UTILITIES.get_dragee())&&
a.is_robot()&&(a.get_body().is_empty()?(a=a.open_backside())&&$(a.get_element()).find(".toontalk-train-backside-button").click():(r(a,u),h.set_next_robot(a)))});e.get_next_robot_area=function(){return u};e.update_display=function(){var a=h.get_frontside_element();a&&b.UTILITIES.give_tooltip(a,h.get_title());this.change_label_and_title_of_train_button(this.get_widget().being_trained);n()};b.UTILITIES.when_attached(a,function(){var a=h.get_backside_conditions(),b=h.get_frontside_conditions();a&&a.forEach(function(a){a.set_visible(!0)});
b&&b.set_visible(!0)});a.appendChild(this.create_train_button(e,h));f(a,h);a.appendChild(t);e.add_advanced_settings=function(){C.call(e,c.container,l.container,u)};return e},create_train_button:function(h,e){var a=h.get_element();$(a);var d=$("<button>Train</button>").button(),c=!1;d.addClass("toontalk-train-backside-button");h.change_label_and_title_of_train_button=function(c){jQuery.contains(window.document,d.get(0))&&(d.is(".ui-button")||d.button(),c?(d.button("option","label","Stop training "+
e.get_name()),b.UTILITIES.give_tooltip(d.get(0),"Click to stop training this robot.")):e.get_body().is_empty()?(d.button("option","label","Train"),b.UTILITIES.give_tooltip(d.get(0),"Click to start training this robot.")):(d.button("option","label","Re-train "+e.get_name()),b.UTILITIES.give_tooltip(d.get(0),"Click to start training this robot all over again.")),b.UTILITIES.visible_element(a)&&f(a,e))};h.change_label_and_title_of_train_button(c);d.get(0).addEventListener("click",function(a){c=!c;h.change_label_and_title_of_train_button(c);
c?(e.initialize_backside_conditions(),e.get_body().reset_steps(),e.robot_started_training(e),e.training_started()):e.training_finished();a.stopPropagation()});d.css({display:"block"});return d.get(0)}}}(window.TOONTALK)})();(function(){var b=function(b){return"rotate"===b||"skewX"===b||"skewY"===b||"transform-origin-x"===b||"transform-origin-y"===b},k=function(f){return"transform-origin-x"===f||"transform-origin-y"===f?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin#"+f:b(f)?"https://developer.mozilla.org/en-US/docs/Web/CSS/transform#"+f:"http://www.w3.org/community/webed/wiki/CSS/Properties/"+f};window.TOONTALK.element=function(f){var h=["left","top","width","height"],e=Object.create(f.widget),a=
function(a,b){var c,d;if(!a)return 0;"number"===typeof a&&(d=a);0===a.length&&(d=0);if("undefined"===typeof d&&(c=a.substring(a.length-1),0<="0123456789x".indexOf(c)&&(d=parseFloat(a),isNaN(d))))return;c=d;0<=["rotate","skewX","skewY"].indexOf(b)&&(c%=360,0>c&&(c+=360));return c},d=function(a,b){var c,d,e,f,g;if((b.left||b.top)&&!a.being_dragged&&(c=a.get_parent_of_frontside(),g=$(a.get_element()).width(),e=$(a.get_element()).height(),c))return b.left&&(d=c.is_element()?c.get_original_width():c.get_width(),
b.left<g/-2||b.left>d+g/2)&&(d=0<d?(b.left%d+d)%d:b.left,b.left!==d&&(b.left=d,f=!0)),b.top&&(c=c.is_element()?c.get_original_height():c.get_height(),b.top<e/-2||b.top>c+e/2)&&(e=0<c?(b.top%c+c)%c:b.top,b.top!==e&&(b.top=e,f=!0)),f};e.create=function(a,g,h,k,l,u,q,t){var c=Object.create(e),m=f.UTILITIES.generate_unique_id(),v=c.drag_started,C={},A={},y,J,O,G,R,Q,H,D,L,S,I,P,U,W,V;g||(g=["left","top","width","height"]);c.is_element=function(){return!0};c.is_resizable=function(){return!0};c.get_HTML=
function(){return G};c.get_guid=function(){return m};c.get_text=function(){var a,b;return void 0===R&&((a=this.get_frontside_element())?R=a.textContent:(a=(b=this.get_HTML())&&"<"==b[0]&&$(b).get(0))?(document.body.appendChild(a),R=a.textContent,$(a).remove()):R=b,""===R&&a&&"IMG"!==a.nodeName&&(this.update_display(),R=a.textContent),""===R)?this.get_HTML():R};c.set_HTML=function(a){var b=this.get_frontside_element(),c=function(a){for(var b=0,c,d;;){b=a.indexOf("<a ",b);if(0>b)break;c=a.indexOf(">",
b);if(0>c)break;b+=3;d=a.indexOf("target='_blank'",b);if(0>d||d>c)a=a.substring(0,b)+"target='_blank'"+a.substring(b)}0===a.indexOf("data:image")?a="<image src='"+a+"'>":0===a.indexOf("data:audio")?a="<audio src='"+a+"'>":0===a.indexOf("data:video")&&(a="<video src='"+a+"'>");""===a&&(a="&thinsp;");return a}.bind(this);if(G===a)return!1;this.initialize_element();G=c(a);R=void 0;if(!b)return!1;$(b).children(":not(.ui-resizable-handle)").remove();this.is_plain_text_element();b.innerHTML=G;Q&&this.compute_original_dimensions(!0);
return!0};c.set_HTML_from_sub_classes=c.set_HTML;c.set_text=function(a){var b=this.get_frontside_element(),c=function(d){d=$(d).contents();0===d.length?b.textContent=a:d.each(function(){this.nodeType==Node.TEXT_NODE?(this.textContent=a,a=""):c(this,a)})};if(!b||a===b.textContent)return!1;if($(b).is(".toontalk-plain-text-element"))return this.set_HTML(a);c(b);return this.set_HTML(b.innerHTML)};c.get_style_attributes=function(){return g};c.set_style_attributes=function(a){g=a};c.get_attribute_widgets_in_backside_table=
function(){return C};c.set_attribute_widgets_in_backside_table=function(a){C=a};c.get_original_copies=function(){return A};c.get_pending_css=function(){return I};c.get_transform_css=function(){return P};c.add_to_css=function(a,c){b(a)?(P||(P={}),P[a]=c):(I||(I={}),I[a]=c)};c.apply_css=function(){var a="",b,c,e,g;if((c=this.get_frontside_element())&&!$(c).is(".toontalk-not-observable"))if(jQuery.contains(window.document,c)){if(this.is_plain_text_element()){I||(I={});(g=(b=this.get_parent())&&(b.is_nest()||
b.is_hole()||b.is_robot()))?(b=this.get_parent().get_contents_dimensions(),L=b.width,S=b.height,this.plain_text_dimensions(L,S)):b=L?{width:L,height:S}:{width:f.UTILITIES.get_element_width(c),height:f.UTILITIES.get_element_height(c)};if(b.width&&g){I["font-size"]=f.UTILITIES.font_size(this.get_text(),b.width,{height:b.height});I.width=b.width;I.height=b.height;I.transform="";$(c).css(I);I=void 0;return}I.width||I.height?I["font-size"]=f.UTILITIES.font_size(this.get_text(),I.width||b.width,{height:I.height||
b.height}):(I["font-size"]="",I.width="",I.height="");if(!P){$(c).css(I);return}}if(I||P)I?(I.width&&(L=I.width),I.height&&(S=I.height)):I={},I.position="absolute",P&&("number"===typeof P.rotate&&(a+="rotate("+P.rotate+"deg)"),"number"===typeof P.skewX&&(a+="skewX("+P.skewX+"deg)"),"number"===typeof P.skewY&&(a+="skewY("+P.skewY+"deg)"),"number"===typeof P["transform-origin-x"]||"number"===typeof P["transform-origin-y"])&&(I["transform-origin"]=(P["transform-origin-x"]||0)+" "+(P["transform-origin-y"]||
0)),$(c).is(".toontalk-conditions-contents")&&this.is_image_element()?($(c).children("img").css({"max-width":"100%",height:"100%"}),$(c).css({transform:""}),I=void 0):L||S?(d(this,I),a&&f.UTILITIES.add_transform_to_css(a,"",I,0>c.parentElement.className.indexOf("toontalk-box-hole")),!this.constrained_by_container()&&this.is_plain_text_element()?$(c).css(I):($(c).css({width:"",height:""}),e=I,f.UTILITIES.run_when_dimensions_known(c,function(b){var g=this.get_parent_of_frontside();d(this,e);$(c).is(".toontalk-conditions-contents")&&
this.directly_inside_conditions_container()&&(L=f.UTILITIES.get_toontalk_css_numeric_attribute("width",".toontalk-conditions-container"),S=f.UTILITIES.get_toontalk_css_numeric_attribute("height",".toontalk-conditions-container"));(this.ok_to_set_dimensions()||this.constrained_by_container())&&f.UTILITIES.scale_element(c,L,S,H,D,a,e,b,!g);I=void 0}.bind(this)))):(d(this,I),f.UTILITIES.add_transform_to_css(a,"",I,0>c.parentElement.className.indexOf("toontalk-box-hole")),$(c).css(I),I=void 0)}else f.UTILITIES.when_attached(c,
this.apply_css.bind(this))};c.on_update_display=function(a){U?U.push(a):U=[a]};c.fire_on_update_display_handlers=function(){U&&f.UTILITIES.set_timeout(function(){U.forEach(function(a,b){a()||U.splice(b,1)})})};c.is_image_element=function(){return 0<$(this.get_frontside_element()).children("img").length};c.get_additional_classes=function(){return t};c.set_additional_classes=function(a){t=a};c.get_children=function(){return k};c.get_child=function(a){if(k)return k[a]};c.set_sound_effect=function(a){y=
a;y.volume=f.UTILITIES.get_audio_volume(y)};c.get_sound_effect=function(){return y};c.get_video_object=function(){var a;J||(a=this.get_frontside_element())&&(J=a.getElementsByTagName("video")[0]);return J};c.set_video_object=function(a){J=a};c.get_ignore_pointer_events=function(){return q};c.set_ignore_pointer_events=function(a){q=a;$(this.get_frontside_element()).find(":not(ui-resizable-handle)").css({"pointer-events":a?"none":"auto"})};c.get_source_URL=function(){return O};c.set_source_URL=function(a,
b){if(O!==a)return O=a,b||this.refresh(),!0};c.use_scaling_transform=function(a){""===a.width&&(a.width=void 0);""===a.height&&(a.height=void 0);void 0===H?f.UTILITIES.run_when_dimensions_known(this.get_frontside_element(),function(){f.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,H,D,void 0,a)}.bind(this)):f.UTILITIES.scale_element(this.get_frontside_element(),a.width,a.height,H,D,void 0,a)};c.add_standard_widget_functionality(c);W=c.set_running.bind(c);c.set_running=function(a,
b){W(a,b);Object.keys(C).forEach(function(c){C[c].set_running(a,b)});!a&&this.visible()&&(g.forEach(function(a){this.add_to_css(a,this.get_attribute(a))}.bind(this)),this.rerender());k.forEach(function(c){c.set_running(a,b)})};V=c.can_run.bind(c);c.can_run=function(a,b){var c;"undefined"===typeof a&&(a=[]);if(0<=a.indexOf(this))return!1;a.push(this);if(V(a,b))return!0;Object.keys(C).some(function(d){if(C[d].can_run(a,b))return c=!0}.bind(this));if(c)return c;k.some(function(d){if(d.can_run(a,b))return c=
!0});return c};c.drag_started=function(a,b){this.drag_x_offset=a.view.drag_x_offset;this.drag_y_offset=a.view.drag_y_offset;v.call(this,a,b)};c.update_display=function(){var a=this.get_frontside_element(!0);this.get_backside();var b=function(a){return this.is_image_element()?"image":$(a).is(".toontalk-plain-text-element")?"text":"element"}.bind(this);if(!this.being_dragged&&!$(e).is(".toontalk-has-attached-callback"))if(this.get_erased()){var c;c=$(a).parent(".toontalk-backside").is("*")?b="":b="100%";
this.save_dimensions();$(a).removeClass().empty().addClass("toontalk-erased-element toontalk-side").css({width:b,height:c,position:"",transform:""});this.inside_conditions_container()?f.UTILITIES.give_tooltip(a,"This is an element that has been erased. It will match any element."):f.UTILITIES.give_tooltip(a,"This is an erased element. It will replace its HTML with the HTML of the element you drop on it.")}else $(a).is(".toontalk-erased-element")&&($(a).removeClass("toontalk-erased-element"),this.restore_dimensions()),
Q||this.initialize_element(),this.is_plain_text_element()&&(this.constrained_by_container()?$(a).css({width:"",height:""}):this.plain_text_dimensions()),"undefined"===typeof H&&a.parentElement&&(this.is_plain_text_element()?this.plain_text_dimensions():this.compute_original_dimensions()),this.apply_css(),k?k.forEach(function(b){a.appendChild(b.get_frontside_element(!0));b.set_visible(!0);b.update_display()}):k=[],this.fire_on_update_display_handlers(),f.open_backside_only_if_alt_key||f.UTILITIES.give_tooltip(a,
"Click to see the backside where you can place robots or change the style of this "+b(a)+"."),this.set_ignore_pointer_events(this.get_ignore_pointer_events())};c.initialize_element=function(){var a=this.get_frontside_element(),b;a&&(G=this.get_HTML(),a.innerHTML=G,$(a).addClass("toontalk-element-frontside"),this.is_plain_text_element()?((b=this.get_additional_classes())&&$(a).addClass(b),$(a).addClass("ui-widget toontalk-plain-text-element")):this.is_image_element()?$(a).addClass("toontalk-image-element"):
$(a).addClass("toontalk-non-plain-text-element"),Q=!0)};c.is_plain_text_element=function(){var a=this.get_HTML();if(a)return!a.match(/<\w/)};c.plain_text_dimensions=function(a,b){this.constrained_by_container()||(this.get_frontside_element(),H=a||12*this.get_text().length,D=b||32,this.saved_width=H,this.saved_height=D)};c.compute_original_dimensions=function(a){f.UTILITIES.original_dimensions(this,function(a,b){var c=this.get_parent_of_frontside();H=a;D=b;c&&c.get_box?c.get_box().rerender():(g.forEach(function(a){this.add_to_css(a,
this.get_attribute(a))}.bind(this)),this.rerender())}.bind(this),a)};c.get_attribute_from_current_css=function(a){var b,c;if("width"===a&&(L||H))return L||H;if("height"===a&&(S||D))return S||D;b=this.get_frontside_element(!0);c=f.UTILITIES.get_style_numeric_property(b,a);""===c&&(c=$(b).css(a));if(!c)return 0;if("number"===typeof c){if(H&&S){if("left"===a)return c+(H-L)/2;if("top"===a)return c+(D-S)/2}return c}return"%"!==c.charAt(c.length-1)||"left"!==a&&"top"!==a?c:$(b).offset()[a]};c.get_original_width=
function(){return H};c.get_original_height=function(){return D};c.increment_width=function(a){this.set_attribute("width",(L||H)+a)};c.increment_height=function(a){this.set_attribute("height",(S||D)+a)};c.get_width=function(){return L};c.get_height=function(){return S};c.add_child=function(a){var b=$(a.get_frontside_element(!0)),c=$(this.get_frontside_element(!0)),d;k.push(a);a.set_parent_of_frontside(this);d=f.UTILITIES.set_position_relative_to_element(b,c,b.offset(),!0);a.is_element()&&a.set_location_attributes(d.left,
d.top);c.get(0).dispatchEvent(f.UTILITIES.create_event("widget added",{element_widget:b.get(0),where:"front"}));this.robot_in_training()&&this.robot_in_training().dropped_on(a,this)};c.removed_from_container=function(a,b){var c=k.indexOf(a);0<=c&&k.splice(c,1)};c.set_HTML(a.toString());c.set_description(h);l&&("string"===typeof l?(0>l.indexOf("http")&&0>l.indexOf("data:")&&(l=f.TOONTALK_URL+l),c.set_sound_effect(new Audio(l))):c.set_sound_effect(l));u&&("string"===typeof u?c.set_HTML("<video src='"+
u+"'/>"):c.set_video_object(u));f.debugging&&(c._debug_id=f.UTILITIES.generate_unique_id(),c._debug_string=c.to_debug_string());k?k.forEach(function(a){a.set_parent_of_frontside(c)}):k=[];return c};e.copy=function(a){var b=this.get_style_attributes(),c=e.create(this.get_HTML(),b.slice(),this.get_description(),f.UTILITIES.copy_widgets(this.get_children()),this.get_sound_effect(),this.get_video_object(),this.get_ignore_pointer_events()),d=this.get_attribute_widgets_in_backside_table(),h={},k=c.get_backside(this.visible());
c.set_source_URL(this.get_source_URL());a&&(a.elements_copied||(a.elements_copied={}),a.elements_copied[this.get_guid()]=c);Object.keys(d).forEach(function(b){h[b]=d[b].copy(a);h[b].set_parent_of_frontside(k,!1,!0);c.set_attribute(b,this.get_attribute(b))}.bind(this));c.set_attribute_widgets_in_backside_table(h);return this.add_to_copy(c,a)};e.match=function(a){if(this.get_erased&&this.get_erased()){if(a.match_with_any_element)return a.match_with_any_element();this.last_match=a;return this}return a.match_with_another_element_widget?
a.match_with_another_element_widget(this):(this.last_match=a,this)};e.match_with_any_element=function(){return"matched"};e.match_with_another_element_widget=function(a){var b;if(this.get_HTML()===a.get_HTML())return"matched";b=a.get_text();if(""!==b&&b===this.get_text())return"matched";a.last_match=this;return a};e.compare_with=function(a){if(a.compare_with_other_element)return a.compare_with_other_element(this)};e.compare_with_other_element=function(a){a=a.get_HTML().localeCompare(this.get_HTML());
return 0>a?-1:0<a?1:a};e.get_path_to=function(a,b){var c=this.get_children(),d=c.indexOf(a),f,g;if(0<=d)return e.path.create(d);c.forEach(function(c,d){c.get_path_to&&(g=c.get_path_to(a,b))&&(f=e.path.create(d),f.next=g)});return f};f.creators_from_json.element_path=function(a,b){var c=e.path.create(a.index);a.next&&(c.next=f.UTILITIES.create_from_json(a.next,b));return c};e.dereference_path=function(a,b){var c,d;if(a){c=a.get_index&&a.get_index();if(!f.debugging||"number"===typeof c)if(d=this.get_children(),
c=d[c]){if(c.dereference_contents&&!a.not_to_be_dereferenced)return c.dereference_contents(a.next||a,b);if(a.next){if(c.dereference_path)return c.dereference_path(a.next,b);f.UTILITIES.report_internal_error("Expected to refer to a child of "+c+" but it lacks a method to obtain "+f.path.toString(a.next))}a.removing_widget&&(c.get_infinite_stack()||b.remove_from_container(c,this));return c}f.UTILITIES.display_message(this+" unable to dereference the path: "+f.path.toString(a),{only_if_new:!0})}else return this};
e.path={create:function(a){return{get_index:function(){return a},toString:function(){return"the "+f.UTILITIES.ordinal(a)+" widget "},get_json:function(b,c,d){c({type:"element_path",index:a,next:this.next&&this.next.get_json(b)},d)}}}};e.widget_side_dropped_on_me=function(a,b){if(a.is_backside())return!1;this.get_erased()&&a.get_HTML?(this.set_HTML(a.get_HTML()),this.set_erased(!1),a.remove()):(this.add_child(a),this.rerender());return!0};e.create_backside=function(){return f.element_backside.create(this)};
e.get_attribute_from_pending_css=function(a){var b=this.get_pending_css();if(b&&b[a]||(b=this.get_transform_css())&&b[a])return b[a]};e.get_attribute=function(a){var b=this.get_attribute_from_pending_css(a),c;"left"===a?(c=this.get_frontside_element(),c=f.UTILITIES.translate_x(c)):"top"===a?(c=this.get_frontside_element(),c=f.UTILITIES.translate_y(c)):c=0;return"undefined"!==typeof b&&"auto"!=b?b+c:this.get_attribute_from_current_css(a)+c};e.set_attribute=function(b,d,e,h){var c=this.get_frontside(!0).get_element(),
g=function(a){var c=this.get_original_copies()[b];c&&c.forEach(function(b){b.set_value_from_sub_classes(bigrat.fromDecimal(a))})}.bind(this),k;if(!c)return!1;k="left"===b?f.UTILITIES.translate_x(c):"top"===b?f.UTILITIES.translate_y(c):0;c=this.get_attribute_from_pending_css(b);d-=k;if(c===d||"undefined"===typeof c&&(c=this.get_attribute_from_current_css(b),c===d))return!1;k=a(d,b);if("number"===typeof k){if(c==k)return!1;f.logging&&0<=f.logging.indexOf("attribute:")&&0<=f.logging.indexOf(b)&&console.log("Attribute "+
b+" set to "+k+" was "+c+" at "+Date.now()+" for "+this);d=k;"left"!==b&&"top"!==b||g(d)}e&&this.robot_in_training()&&this.robot_in_training().edited(this,{setter_name:"set_attribute",argument_1:b,argument_2:d,toString:"change the '"+b+"' style to "+d+" of",button_selector:".toontalk-element-"+b+"-attribute-input"});this.constrained_by_container()||(this.add_to_css(b,d),h&&(d=this.get_style_attributes(),0>d.indexOf(b)&&d.push(b)),this.rerender());return!0};e.dropped_on_style_attribute=function(a,
b,d){var c,e,f;if(a){c=a.toString();if(a.is_number()){e=this.get_attribute(b);if("number"===typeof e)f=e;else if("auto"===e)switch(b){case "left":f=$(this.get_frontside_element()).offset().left;break;case "top":f=$(this.get_frontside_element()).offset().top;break;default:f=0}else f=parseFloat(e);e=a.to_float();switch(c.substring(0,1)){case "-":c=f-e;break;case "*":c=f*e;break;case "/":c=f/e;break;case "^":c=Math.pow(f,e);break;default:c=f+e}this.set_attribute(b,c,!1);(d.event||d.robot&&d.robot.visible())&&
this.get_backside().render()}a.get_infinite_stack()||a.remove();d.event&&this.robot_in_training()&&this.robot_in_training().dropped_on(a,this.create_attribute_widget(b))}};e.get_attribute_widget_in_backside_table=function(a,b,d){var c=this.get_attribute_widgets_in_backside_table()[a];c||b||(c=this.create_attribute_widget(a,d),this.get_attribute_widgets_in_backside_table()[a]=c);return c};e.create_attribute_widget=function(a,b){var c=".toontalk-element-"+a+"-attribute-input",e=this.get_backside_element(),
g=this.get_attribute(a),u=this,q=function(a,b){var c=b.toString,e=b.equals,g=b.remove;A=b.update_display;b.element_widget=this;b.attribute=a;b.get_type_name=function(a){return a?"element attributes":"element attribute"};b.toString=function(){return c.call(this)+" ("+this.attribute+" of "+this.get_attribute_owner()+")"};b.get_default_description=function(){return"a number that is the "+this.attribute+" of "+this.get_attribute_owner().toString({plain_text:!0})+"."};b.get_custom_title_prefix=function(){return"I'm the '"+
this.attribute+"' attribute of "+this.get_attribute_owner().toString({inside_tool_tip:!0})+" \nDrop a number on me or edit my backside to change my value. My backside has an info button to learn more."};b.equals=function(b){return a===b.attribute?this.equals(b.element_widget):e.call(this,b)};b.update_display=function(){var a,b,c;this.get_erased()||(a=this.get_attribute_owner(),a.get_parent_of_frontside()&&a.get_parent_of_frontside().is_element()&&!a.being_dragged&&!a.constrained_by_container()?(c=
{},b=bigrat.toDecimal(this.get_value()),c[this.attribute]=b,d(a,c)&&this.set_value(c[this.attribute]),$(a.get_frontside_element()).css(c)):(a=a.get_attribute(this.attribute),isNaN(a)||C(a)));A.call(this)};z=b.copy.bind(b);b.copy=function(b){var c;if(b){if(b.just_value)return z(b);b.elements_copied&&(c=b.elements_copied[u.get_guid()])}return this.add_to_copy((c||u).create_attribute_widget(a),b)};b.get_json=function(b,c,d){f.UTILITIES.get_json(u,b,function(b,d){c({type:"attribute_widget",attribute_name:a,
element:b},d)},d)};b.get_original_attribute_widget=function(){var b=u.get_original_copies()[a];return b&&b[0]};b.is_attribute_widget_copy=function(b){var c=u.get_original_copies()[a];return c&&0<=c.indexOf(b)};b.get_attribute_owner=function(){var a=function(b){if(b=b.get_parent_of_frontside())return b.is_backside()?b:b.is_nest()?void 0:a(b.get_widget())},b,c;b=a(this);if(!b)return(b=this.get_original_attribute_widget())&&b!==this?b.get_attribute_owner():u;if(!b.get_widget().is_element())return u;
b=b.get_widget();for(c=b.get_parent_of_backside();c&&c.get_widget().is_element();)b=c.get_widget(),c=b.get_parent_of_backside();return b};b.remove=function(b,c){var d=u.get_original_copies()[a],e=d&&d.indexOf(this);0<=e&&d.splice(e,1);g.call(this,b,c)};b.get_help_URL=function(){return k(a)}}.bind(this),t=function(a,b){var c=f.number.create(0,1);q(a,c);c.set_value_from_decimal(b);c.set_format("decimal");c.set_value=function(b){try{var c=u.get_original_copies()[a],d="number"===typeof b?b:bigrat.toDecimal(b),
e=bigrat.fromDecimal(d);this.get_attribute_owner().set_attribute(this.attribute,d)&&c.forEach(function(a,b){a.set_value_from_sub_classes(e,!0)});return this.set_value_from_sub_classes(e,!1)}catch(S){return f.UTILITIES.report_internal_error("Error while setting the value of an attribute widget: "+S),!1}};c.is_attribute_widget=function(){return!0};c.get_function_type=function(a){return a?"numbers":"number"};return c}.bind(this),n=function(a,b){var c=f.element.create(b);q(a,c);c.set_HTML=function(b){var c=
u.get_original_copies()[a],d;this.get_attribute_owner().set_attribute(this.attribute,b)&&c.forEach(function(a,c){d=a.set_HTML_from_sub_classes(b)});return d};c.get_function_type=function(a){return a?"elements":"element"};c.set_additional_classes("toontalk-string-attribute-widget");return c}.bind(this),r;r=0<=["background-color","color"].indexOf(a)?"string":"number";var z,C,A,y,J;e&&(c=$(e).find(c),0<c.length&&(c.get(0).toontalk_widget_side=this));if("number"===r){if(y=t(a,g),C=y.set_value_from_decimal.bind(y),
0<=h.indexOf(a)&&(this.on_update_display(function(){y.rerender();return!0}),"left"===a||"top"===a))J=function(b){var c,d,e;b.currentTarget.toontalk_widget_side===y.get_attribute_owner()&&(c=y.get_attribute_owner(),b.stopPropagation(),d=$(c.get_frontside_element()).closest(".toontalk-backside-of-top-level").offset(),d||(console.log("Unable to find top-level backside of an element for its position. Perhaps is 'visible' but not attached."),d={left:0,top:0}),e=b.pageX-d.left-(c.drag_x_offset||0),d=b.pageY-
d.top-(c.drag_y_offset||0),"left"===a?(b=e,c.set_attribute("top",d)):(b=d,c.set_attribute("left",e)),y.set_value_from_decimal(b),A.call(y))},y.add_parent_of_frontside_change_listener(function(a,b){a&&a.get_widget().is_element()&&a.get_frontside_element().removeEventListener("drag",J);b&&b.get_widget().is_element()&&b.get_frontside_element()&&b.get_frontside_element().addEventListener("drag",J)})}else if("string"===r)y=n(a,g),C=y.set_HTML.bind(y);else{f.UTILITIES.report_internal_error("Unrecognized attribute type: "+
r+" for "+a);return}(g=this.get_original_copies()[a])?g.push(y):this.get_original_copies()[a]=[y];return y};f.creators_from_json.attribute_widget=function(a,b){if(a)return f.UTILITIES.create_from_json(a.element,b).create_attribute_widget(a.attribute_name,b)};f.creators_from_json.attribute_number=f.creators_from_json.attribute_widget;e.on_backside_hidden=function(){this.get_style_attributes().forEach(function(a){(a=this.get_attribute_widget_in_backside_table(a,!0))&&a.set_visible(!1)}.bind(this))};
e.toString=function(a){var b,c,d;if(this.get_erased())return"any element";b=function(b){var c="",d=function(a,b,c){var d=b.indexOf(a+"="),e,f;if(0<=d&&(e=b.indexOf("'",d),0<=e&&(f=b.indexOf("'",e+1)),0<=f))return b.substring(0,d)+a+"="+c+b.substring(f+1);d=b.indexOf(" ");return b.substring(0,d+1)+a+"="+c+" "+b.substring(d+1)};if(1<b.length&&"<"===b.charAt(0)){if(0===b.indexOf("<img "))return"<img width='60' height='40' "+b.substring(4);if(this.is_image_element())c="style='width: 60px; height: 40px;'";
else if(0<=b.indexOf("<iframe "))return b.indexOf("<iframe "),d("width",d("height",b,"'60'"),"'80'");a&&a.inside_tool_tip&&(c+=" class='toontalk-widget-in-tool-tip'");return"<div "+c+">"+b+"</div>"}return'"'+b+'"'}.bind(this);c=function(){var a=this.get_HTML(),b=a.indexOf("alt="),c;return 0<=b&&(c=a.indexOf("'",b+5),0<=c)?"("+a.substring(b+5,c)+")":""}.bind(this);d=this.get_children();if(a&&!a.inside_tool_tip&&"conditions"!==a.role){if(a.for_json_div)return"";b=c();b||(b=(b=this.get_source_URL())?
"whose text is the contents of "+b:(b=this.get_text())?'"'+b+'"':"")}else b=b(this.get_HTML());d&&0<d.length&&(b+=" with "+f.UTILITIES.describe_widgets(d)+" on top");return"the element "+b};e.get_type_name=function(a){return a?"elements":"element"};e.get_help_URL=function(){return"docs/manual/elements.html"};e.get_json=function(a,b,d){var c=this.get_style_attributes(),e=f.UTILITIES.remove_z_index(this.get_HTML()),g=encodeURIComponent(e),h=[],k;100<=e.length?(a.shared_html||(a.shared_html=[]),e=a.shared_html.indexOf(g),
0>e&&(e=a.shared_html.push(f.UTILITIES.string_to_array(g,100))-1),k={shared_html_index:e}):k=f.UTILITIES.string_to_array(g,100);g=function(){var e=[],g=function(l){var m=function(){g(l+1)},n,q;l>=c.length?b({type:"element",html:k,attributes:c,attribute_values:c.map(this.get_attribute.bind(this)),attributes_backsides:e,additional_classes:this.get_additional_classes(),children:0<this.get_children().length&&h,sound_effect:this.get_sound_effect()&&f.UTILITIES.string_to_array(this.get_sound_effect().src,
100),video:this.get_video_object()&&f.UTILITIES.string_to_array(this.get_video_object().src,100),ignore_pointer_events:this.get_ignore_pointer_events()?!0:void 0,source_URL:this.get_source_URL()},d,a):(n=this.get_attribute_widget_in_backside_table(c[l],!0))?(q=[],e.push(q),f.UTILITIES.get_json_of_array(n.get_backside_widgets(),q,0,a,m,d)):(e.push(null),m())}.bind(this);g(0)}.bind(this);0<this.get_children().length?f.UTILITIES.get_json_of_array(this.get_children(),h,0,a,g,d):g()};f.creators_from_json.element=
function(b,d){var c,g,h,k,q;if(b){Array.isArray(b.html)&&(b.html=b.html.join(""));c=decodeURIComponent("string"===typeof b.html?b.html:d.shared_html&&d.shared_html[b.html.shared_html_index]);b.children&&(h=d.is_child,d.is_child=!0,g=f.UTILITIES.create_array_from_json(b.children,d),d.is_child=h);if(void 0===c&&(c="string"===typeof b.html?"No json.html recreating an element widget.":"additional_info.shared_html missing while recreating an element widget.",!f.debugging))throw Error(c);b.sound_effect&&
Array.isArray(b.sound_effect)&&(b.sound_effect=b.sound_effect.join(""));b.video&&Array.isArray(b.video)&&(b.video=b.video.join(""));q=e.create(c,b.attributes,b.description,g,b.sound_effect,b.video,b.ignore_pointer_events);k=d&&d.event?["left","top"]:[];b.attribute_values.forEach(function(c,e){var g=b.attributes[e],h=b.attributes_backsides&&b.attributes_backsides[e];(d.is_child||0>k.indexOf(g))&&(0!==c||"width"!==g&&"height"!==g)&&q.add_to_css(g,a(c)||c);h&&(g=q.get_attribute_widget_in_backside_table(g,
!1,d),f.UTILITIES.add_backside_widgets_from_json(g,h,d))}.bind(this));b.additional_classes&&q.set_additional_classes(b.additional_classes);b.source_URL&&(q.set_source_URL(b.source_URL),q.refresh());g&&f.UTILITIES.when_attached(function(){g.forEach(function(a,c){var d=b.children[c]&&b.children[c].widget&&b.children[c].widget.view;d&&f.UTILITIES.set_css(a.get_frontside_element(!0),{left:d.frontside_left,top:d.frontside_top})})});return q}};e.create_attribute_path=function(a,b){var c=f.path.get_path_to(a.element_widget,
b,!0);return this.extend_attribute_path(c,a.attribute)};e.refresh=function(){this.get_source_URL()&&f.UTILITIES.create_widget_from_URL(this.get_source_URL(),function(a){a&&this.set_HTML(a.get_HTML())}.bind(this))};e.extend_attribute_path=function(a,b){return{dereference_path:function(c){return(c=a.dereference_path(c,c.get_top_level_context()||c.get_context()))&&c.get_widget().get_attribute_widget_in_backside_table(b)},toString:function(){return"the '"+b+"' property of "+f.path.toString(a)},get_json:function(c,
d,e){f.path.get_json(a,c,function(a,c){d({type:"path_to_style_attribute",attribute:b,element_widget_path:a},c)},e)}}};f.creators_from_json.path_to_style_attribute=function(a,b){var c=f.UTILITIES.create_from_json(a.element_widget_path,b);return e.extend_attribute_path(c,a.attribute)};e.set_size_attributes=function(a,b,d){d?(this.add_to_css("width",a),this.add_to_css("height",b)):(this.set_attribute("width",a),this.set_attribute("height",b));f.UTILITIES.set_timeout(function(){this.rerender();$(this.get_frontside_element()).find("iframe").attr("width",
a).attr("height",b-20)}.bind(this))};e.set_location_attributes=function(a,b){this.set_attribute("left",a);this.set_attribute("top",b)};e.receive_HTML_from_dropped=function(a){var b=a.get_text&&a.get_text();a.remove();if(this.set_HTML(b))return this.get_text()};e.receive_URL_from_dropped=function(a){a=a.get_text();if(this.set_source_URL(a))return this.get_source_URL()};e.add_style_attribute=function(a){var b=this.get_style_attributes();0>b.indexOf(a)&&(b.push(a),"left"===a?(a=this.get_frontside_element(),
a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-left-attribute-input").val(a.originalEvent.clientX)}.bind(this))):"top"===a&&(a=this.get_frontside_element(),a.addEventListener("drag",function(a){var b=this.get_backside_element(!0),c=this.get_frontside_element();b&&c&&$(b).find(".toontalk-element-top-attribute-input").val(a.originalEvent.clientY)}.bind(this))));return!0};e.remove_style_attribute=function(a){var b=
this.get_style_attributes();a=b.indexOf(a);0<=a&&(b.splice(a,1),this.get_backside().update_style_attribute_chooser());return!0};return e}(window.TOONTALK);window.TOONTALK.element_backside=function(b){var f=function(a,d,c){var e;c.visible()&&(e=d.get_style_attributes(),d.get_frontside_element(),$(a).empty(),e.forEach(function(e){d.get_attribute(e);var f=document.createElement("tr"),g=document.createElement("td"),h=c.is_primary_backside()?d.get_attribute_widget_in_backside_table(e):c.get_widget().create_attribute_widget(e),
k=h.get_frontside_element(!0);h.set_parent_of_frontside(c,!1,!0);h.set_infinite_stack(!0);a.appendChild(f);f.appendChild(g);g.appendChild(b.UTILITIES.create_text_element(e));g=document.createElement("td");f.appendChild(g);h.set_visible(!0);$(k).addClass("toontalk-element-attribute");g.appendChild(k)}))},e=function(a,d){var c=$("<button>Add or remove my style attributes</button>").button();c.addClass("toontalk-show-attributes-chooser-button");c.get(0).addEventListener("click",function(e){b.UTILITIES.visible_element(a)?
($(a).hide(),c.button("option","label","Add or remove my style attributes"),b.UTILITIES.give_tooltip(c.get(0),"Click to add widgets for my style attributes.")):($(a).show(),c.button("option","label","Hide my style attributes list"),b.UTILITIES.give_tooltip(c.get(0),"Click to hide my list of attributes that can be added or removed."));d.robot_in_training()&&d.robot_in_training().button_clicked(".toontalk-show-attributes-chooser-button",d)});b.UTILITIES.give_tooltip(c.get(0),"Click to add widgets for my style attributes.");
return c.get(0)};return{create:function(a){var d=b.backside.create(a),c=d.get_element();a.get_HTML();var g=document.createElement("table"),h=document.createElement("div"),v=e(h,a),l=b.backside.create_advanced_settings_button(d,a),u=b.UTILITIES.create_check_box(!0,"toontalk-react-to-pointer-check-box","Normal response to mouse","Uncheck this if you don't want the usual browser action to occur when clicked. Useful if this element normally responds to mouse clicks."),q=b.UTILITIES.get_current_url_boolean_parameter("elementHTML",
!0),t=q?"get_HTML":"get_text",n=d.update_display.bind(d),r=d.add_advanced_settings,z,C,A,y,J,O,G,R,Q,H;a.initialize_element();z=a[t]().trim();0<z.length&&!a.is_image_element()&&(A=function(c){(c=b.UTILITIES.input_area_drop_handler(c,a.receive_HTML_from_dropped.bind(a),a))&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(c,a,{area_selector:".toontalk-html-input",setter:"receive_HTML_from_dropped",toString:"for the element's text"})},C=b.UTILITIES.create_text_area(z,"toontalk-html-input",
"My HTML is","Type here to edit the text.",A,void 0,!0),z=function(b){b=C.button.value.trim().replace(/\xA0/g," ");a.get_frontside_element();var c=q?"set_HTML":"set_text";a[c](b)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:c,argument_1:b,toString:'change the text to "'+b+'"',button_selector:".toontalk-html-input"})},$(C.container).css({width:"100%"}),A=60>=C.button.value.length?2:600>C.button.value.length?Math.ceil(C.button.value.length/60):10,$(C.button).css({width:"95%",
height:A+"em"}),C.button.addEventListener("change",z),C.button.addEventListener("mouseout",z),a.is_plain_text_element()&&c.appendChild(C.container),a.get_source_URL()&&(A=function(c){var d=b.UTILITIES.input_area_drop_handler(c,a.receive_URL_from_dropped.bind(a),a);d&&a.robot_in_training()&&a.robot_in_training().dropped_on_text_area(d,a,{area_selector:".toontalk-URL-input",setter:"receive_URL_from_dropped",toString:"for the URL source of the text"});c.stopPropagation()},z=function(b){b=y.button.value.trim().replace(/\xA0/g,
" ");a.get_frontside_element();a.set_source_URL(b)&&a.robot_in_training()&&a.robot_in_training().edited(a,{setter_name:"set_source_URL",argument_1:b,toString:'change the source URL to "'+b+'"',button_selector:".toontalk-URL-input"})},y=b.UTILITIES.create_text_input(a.get_source_URL(),"toontalk-URL-input","","Edit the URL where this text comes from.",void 0,void 0,A),y.button.addEventListener("change",z),y.button.addEventListener("mouseout",z),c.appendChild(y.container)));d.update_style_attribute_chooser=
function(){var c=function(a,c,d){var e=0<=d.get_style_attributes().indexOf(a),h=b.UTILITIES.create_check_box(e,"toontalk-style-attribute-check-box",a+"&nbsp;","Click to add or remove the '"+a+"' style attribute from my backside."),l="toontalk-style-attribute-check-box-for-"+a,e=b.UTILITIES.create_anchor_element("i",k(a)),m=document.createElement("li"),n=function(b){h.button.checked?d.add_style_attribute(a):d.remove_style_attribute(a);f(g,d,d.get_backside());d.robot_in_training()&&d.robot_in_training().edited(d,
{setter_name:h.button.checked?"add_style_attribute":"remove_style_attribute",argument_1:a,toString:(h.button.checked?"add":"remove")+" a widget for the "+a+" attribute of",button_selector:"."+l})};$(e).addClass("toontalk-help-button notranslate toontalk-attribute-help-button");$(e).css({color:"white"});e.translate=!1;e.lang="en";h.container.appendChild(e);$(h.button).addClass(l);h.button.addEventListener("click",n);h.button.addEventListener("touchstart",function(a){h.button.checked=!h.button.checked;
n(a)});m.appendChild(h.container);c.appendChild(m)},d=function(a,b,e){var f,g;"string"===typeof a?c(a,b,e):a.label?(f=document.createElement("h3"),f.textContent=a.label,g=document.createElement("ul"),b.appendChild(f),b.appendChild(g),d(a.sub_menus,g,e)):a.forEach(function(a){d(a,b,e)})};$(h).is(".ui-accordion")&&$(h).accordion("destroy");$(h).empty();d([{label:"Geometry attributes",sub_menus:"left top width height z-index background-position".split(" ")},{label:"Color attributes",sub_menus:["background-color",
"color","opacity"]},{label:"Font attributes",sub_menus:["font-size","font-weight"]},{label:"Visibility",sub_menus:["display","visibility"]},{label:"Transformations",sub_menus:["rotate","skewX","skewY","transform-origin-x","transform-origin-y"]}],h,a);$(h).accordion({active:0,heightStyle:"content"});return h};d.get_attributes_chooser=function(){return h};d.add_advanced_settings=function(){var b;r.call(d);b=$(c).children(".toontalk-advanced-settings-table");0<b.length&&(b.get(0).appendChild(u.container),
b.get(0).appendChild(h),b.get(0).appendChild(v),C&&!a.is_plain_text_element()&&b.get(0).appendChild(C.container))};(G=a.get_sound_effect())?(R=function(){d.visible()&&(G.paused?(b.UTILITIES.give_tooltip(J.get(0),"Click to begin playing this sound."),J.button("option","label","Play sound")):(b.UTILITIES.give_tooltip(J.get(0),"Click to pause this sound."),J.button("option","label","Pause sound")))},J=$("<button>Play sound</button>").button(),J.addClass("toontalk-play-sound-effect-button"),z=function(c){G.paused?
(b.UTILITIES.play_audio(G),G.addEventListener("ended",R)):G.pause();R();a.robot_in_training()&&a.robot_in_training().button_clicked(".toontalk-play-sound-effect-button",a)},J.get(0).addEventListener("click",z),R(),c.appendChild(J.get(0))):a.get_video_object()&&(Q=a.get_video_object(),H=function(a){d.visible()&&(Q.paused?(b.UTILITIES.give_tooltip(O.get(0),"Click to begin playing this video."),O.button("option","label","Play video")):(b.UTILITIES.give_tooltip(O.get(0),"Click to pause this video."),
O.button("option","label","Pause video")))},O=$("<button>Play video</button>").button(),O.addClass("toontalk-play-video-button"),z=function(b){Q.paused?(Q.play(),Q.addEventListener("ended",H)):Q.pause();H();a.robot_in_training()&&a.robot_in_training().button_clicked(".toontalk-play-video-button",a)},O.get(0).addEventListener("click",z),H(),c.appendChild(O.get(0)));d.update_style_attribute_chooser();f(g,a,d);0<a.get_style_attributes().length?c.appendChild(g):a.is_plain_text_element()||c.appendChild(b.UTILITIES.create_text_element("No attributes enabled. Click the <span class='toontalk-button-style'>></span> button to see the advanced options."));
c.appendChild(l);$(h).hide();$(h).addClass("toontalk-attributes-chooser");d.update_display=function(){C&&$(C.button).val(a[t]());f(g,a,d);b.UTILITIES.visible_element(h)&&d.update_style_attribute_chooser();a.get_backside_widgets().forEach(function(a){a&&a.get_widget().is_attribute_widget()&&a.rerender()});n()};$(c).find(".toontalk-hide-backside-button").each(function(a,b){b.addEventListener("click",function(){$(h).hide()})});u.button.checked=!a.get_ignore_pointer_events();u.button.addEventListener("click",
function(){a.set_ignore_pointer_events(!u.button.checked)});u.button.addEventListener("touchstart",function(){u.button.checked=!u.button.checked;a.set_ignore_pointer_events(!u.button.checked)});return d}}}(window.TOONTALK);window.TOONTALK.element["function"]=function(b){var f=b.create_function_table(),e=function(a){return a?b.UTILITIES.add_a_or_an(a.get_type_name()):"an empty hole"};f.add_function_object("join text",function(a,d){var c="";return f.typed_bird_function(a,function(){var a=arguments[arguments.length-
1];for(i=0;i<arguments.length-1;i++){if(!arguments[i]||!arguments[i].get_text){f.report_error("The 'join text' bird is unable to turn "+e(arguments[i])+" into text to join.",a);return}c+=arguments[i].get_text()}return b.element.create(c)},[void 0],"join",d)},"The bird will return with a new element that is made by joining all the elements and numbers.","join",["any number of numbers or elements"]);f.add_function_object("part of text",function(a,d){return f.typed_bird_function(a,function(a,d,e,h){if(d&&
d.to_float)return d=Math.round(d.to_float()-1),e=e&&e.to_float&&Math.round(e.to_float()-1),b.element.create(a.get_text().substring(d,e));f.report_error("The 'part of text' bird is unable to find the text in the second hole. ",h||e)},["element","number","number"],"part of text",d,2,3)},"The bird will return with a new element whose text is the part of the text of the first element (or number) beginning with the first number ending with the second number. 1 is for the first letter.","part",["an element followed by two postive numbers"]);
f.add_function_object("length of text",function(a,d){return f.typed_bird_function(a,function(a,d){if(a.get_text)return b.number.create(a.get_text().length);f.report_error("The 'length of text' bird could not turn "+e(a)+" into a text to find its length.",d)},[void 0],"length of text",d,1)},"The bird will return with a number that is length of the text of the first element (or number).","length",["an element or number"]);f.add_function_object("text as number",function(a,d){return f.typed_bird_function(a,
function(a,d){var c,g;if(a&&a.get_text)return c=a.get_text(),g=c.indexOf("/"),0<=g?g=b.number.create(c.substring(0,g),c.substring(g+1,c.length)):(g=b.number.create(0),g.set_value_from_decimal(c)),g;f.report_error("The 'text as number' bird could not turn "+e(a)+" into a text to turn it into a number.",d)},[void 0],"text as number",d,1,1)},"The bird will return with a number that has the same text as the element. Arithmetic can be done on the result unlike the original text.","text as number",["an element"]);
f.add_function_object("read page",function(a,d){return f.typed_bird_function(a,function(c,g){var h;c.get_text?(h=c.get_text(),b.UTILITIES.download_file(h,function(c){null===c&&(c="Unable to read "+h);c=b.element.create(c,[],"what was in "+h);f.process_response(c,g,a,d)})):f.report_error("The 'read page' bird could not turn "+e(c)+" into a text to use it as a URL.",g)},["element"],"read page",d,1,1)},"The bird will return with the contents of the URL.","read URL",["an element containing a URL"]);f.add_function_object("go to page",
function(a,b){return f.typed_bird_function(a,function(a,b){this.robot_in_training()?this.robot_in_training().display_message("Robot trained to replace current URL."):a.get_text?window.location.assign(a.get_text()):f.report_error("The 'go to page' bird could not turn "+e(a)+" into a text to use it as a URL.",b)},["element"],"replace page",b,1,1)},"The bird will cause the current page to be replaced by the new URL. The back button should return to the current page.","page",["an element containing a URL"]);
f.add_function_object("speak",b.widget.get_speak_function(f),"The bird will cause the browser to speak what is in the second box hole. Other holes can have numbers describing the <a href='https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance'>volume, pitch, rate, voice_number</a>. Might do nothing in <a href='http://caniuse.com/#search=speech%20syn'>some browsers</a>.","speak",["a widget"]);f.add_function_object("listen",b.widget.get_listen_function(f),"The bird will cause the browser to listen to the next thing said and give the words to the bird in the first hole. If you put a number between 0 and 1 in the second hole then only recognitions with at least that confidence will be considered. if you put in the third hole words or phrases separted by | then the recogniser will expect one of those words or phrases.",
"listen",[]);f.add_function_object("show message",function(a,d){return f.typed_bird_function(a,function(a,d,e,f,h){var c,g;c=d&&d.to_float?{duration:1E3*d.to_float()}:{duration:1E4};c.user_initiated=!0;this.robot_in_training()?this.robot_in_training().display_message("Robot trained to display: "+a.get_text(),c):a.is_plain_text_element()?b.UTILITIES.display_message(a.get_text(),c):(g=a.get_frontside_element(),a.is_resizable()&&(a.remove({do_not_remove_children:!0}),d=e?e.to_float():240,f=f?f.to_float():
80,b.UTILITIES.set_css(g,{width:d,height:f,left:-1E3,top:-1E3}),a.set_size_attributes&&a.set_size_attributes(d,f),document.body.appendChild(g)),a.update_display(),setTimeout(function(){$(g).css({left:"",top:""});b.UTILITIES.display_message(g.outerHTML,c);$(g).remove()},1E3))},[void 0,"number","number","number"],"show message",d,1,4)},"The bird will cause what is in the second box hole to be displayed. The third hole can be a number indicating how many seconds the message should be displayed. The 4th and 5th hole can contain the width and height.",
"display",["a widget","number"]);return f.get_function_table()}(window.TOONTALK)})();window.TOONTALK.sensor=function(b){var k=Object.create(b.widget),f=function(b,e){"element"===b.get_type_name()&&(b.set_additional_classes("toontalk-string-value-from-sensor"),e.visible()&&b.rerender())};k.create=function(h,e,a,d,c,g,k){var m=b.nest.create(a,d,"sensor",void 0,void 0,k||"sensor"),l=m.get_json,u=m.update_display,q=m.set_running,t=m.copy,n=e.split(" "),r,z=function(a){switch(typeof a){case "number":a=b.number.create(Math.round(a),1);break;case "string":a=b.element.create(a,void 0,void 0,
void 0,void 0,void 0,"toontalk-string-value-from-sensor");f(a,m);break;case "boolean":a=b.element.create(a.toString(),void 0,void 0,void 0,void 0,void 0,"toontalk-string-value-from-sensor"),f(a,m)}return a},C=function(a){var c,d,e;if(m.get_active()){c=r(a);d=m.get_attributes();e=m.visible();a=$(m.get_frontside_element()).closest(".toontalk-backside-of-top-level");if(1===c.length){if(c=z(c[0]),"undefined"===typeof c)return}else c=b.box.create(c.length,!0,c.map(z),"the values of the "+b.UTILITIES.conjunction(d)+
" attributes of "+b.UTILITIES.add_a_or_an(h)+" event.",d.join(";"));e?(e=b.bird.create(m),m.add_to_top_level_backside(e),c.render(),e.animate_delivery_to(c,m,{nest_recieving_message:m,temporary_bird:!0,starting_left:a.width()/2,starting_top:a.height()})):m.add_to_contents(c)}}.bind(this),A;m.is_sensor=function(){return!0};m.copy=function(d){var e;if(d&&d.just_value&&this.has_contents())return t.call(this,d);e=d?b.sensor.create(h,this.get_attributes_string(),a,void 0,d.copying_resource||c,g,this.get_name()):
b.sensor.create(h,this.get_attributes_string(),a,void 0,c,g,this.get_name());e=m.add_to_copy(e,d);e.set_active(this.get_active());return e};m.get_json=function(a,d,e){var f=function(e,f){var k;e.type="sensor";e.event_name=h;e.attribute=this.get_attributes_string();e.active=c;g?(k=function(a){e.sensor_of=a;d(e,f)},b.UTILITIES.get_json(g,a,k,f)):d(e,f)}.bind(this);l.call(this,a,f,e)};m.update_display=function(){var a=$(this.get_frontside_element());u.call(this);c||a.is(".toontalk-top-level-resource")?
(a.addClass("toontalk-sensor-nest"),a.removeClass("toontalk-sensor-inactive-nest")):(a.addClass("toontalk-sensor-inactive-nest"),a.removeClass("toontalk-sensor-nest"));a.removeClass("toontalk-empty-nest")};m.get_type_name=function(a){return a?"sensors":"sensor"};m.get_help_URL=function(){return"docs/manual/sensors.html"};m.toString=function(){return"a sensor that receives the '"+this.get_attributes_string()+"' attribute of "+h+" events"};m.get_class_name_with_color=function(a){return a};m.get_active=
function(){return!0===c};m.restore_active=function(){"temporarily false"===c&&this.set_active(!0)};m.set_active=function(a,b){if(c!==a||b)!0===a?g?g.get_frontside_element(!0).addEventListener(h,C):window.addEventListener(h,C):g?g.get_frontside_element(!0).removeEventListener(h,C):window.removeEventListener(h,C),c=a};m.set_running=function(a){this.set_active(a);q.call(this,a)};m.set_active(c,!0);m.create_backside=function(){return b.sensor_backside.create(this)};m.get_event_name=function(){return h};
m.set_event_name=function(a){var b=c;h&&c&&this.set_active(!1);h=a;b&&this.set_active(!0)};m.get_attributes=function(){return n};m.set_attributes=function(a){n=a.split(" ")};m.get_attributes_string=function(){return n.join(" ")};m.match=function(a){this.last_match=a;return this};m.set_sensor_of=function(a){g=a};m.get_custom_title_prefix=function(){var a="When a '"+h+"' event"+(g?" to "+g:"")+" occurs my bird will bring me the '"+this.get_attributes_string()+"' attribute of the event.";c?this.get_backside()||
(a+=" On my back you can change which kind of events and attributes I receive."):a+=" But I'm deactivated and can't receive anything until the green flag <span class='toontalk-green-flag-icon'></span> is clicked or the 'Listening to events' check box on my back is ticked.";return a};m.get_default_description=function(){return g?"a sensor for "+g.get_default_description():"a sensor for this document."};A=m.can_run;m.can_run=function(a,b){return!b||A.call(this,a,b)};r=function(a){return m.get_attributes().map(function(c){var d=
a[c];if("key"===c&&void 0===d){if((d=a.keyIdentifier)&&0===d.indexOf("U+"))return String.fromCharCode(a.keyCode)}else if("undefined"===typeof d){if(a.detail&&a.detail.element_widget&&("widget"===c||"back"===c))return c=b.UTILITIES.widget_side_of_element(a.detail.element_widget).create_backside(),c.save_dimensions(),c;if(a.detail&&a.detail.element_widget&&"front"===c)return b.UTILITIES.widget_side_of_element(a.detail.element_widget);if(a.detail&&void 0!==a.detail[c])return"value changed"===a.type?
b.number.create_from_bigrat(a.detail[c]):a.detail[c];d="No such attribute for "+m;m.display_message(d,{display_on_backside_if_possible:!0})}return d})};return m};b.creators_from_json.sensor=function(h,e){if(h){var a=b.sensor.create(h.event_name,h.attribute,h.description,[],!1,void 0,h.name),d;h.sensor_of?b.UTILITIES.set_timeout(function(){a.set_sensor_of(b.UTILITIES.create_from_json(h.sensor_of,e));a.set_active(h.active)}):a.set_active(h.active);0<h.contents.length&&setTimeout(function(){d=b.UTILITIES.create_array_from_json(h.contents,
e);a.set_contents(d);d.forEach(function(b){f(b.get_widget(),a)});a.rerender()},500);return a}};return k}(window.TOONTALK);
window.TOONTALK.sensor_backside=function(b){return{create:function(k){var f=b.UTILITIES.create_text_input(k.get_event_name(),"toontalk-sensor-event-name-input","Event name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;","Type here the event name.","https://developer.mozilla.org/en-US/docs/Web/Events/"+k.get_event_name()),h=b.UTILITIES.create_text_input(k.get_attributes_string(),"toontalk-sensor-event-attribute-input","Event attribute","Type here the event attribute name or names separated by spaces.","https://developer.mozilla.org/en/docs/Web/API/Event"),
e=b.UTILITIES.create_check_box(k.get_active(),"toontalk-sensor-active-check-box","Listening to events","Check the box if you want to make this sensor active."),a=b.nest_backside.create(k),d=a.get_element(),c=function(){k.set_event_name(f.button.value.trim())},g=function(){k.set_attributes(h.button.value.trim())},m=b.backside.create_advanced_settings_button(a,k),v=function(a){var b=e.button.checked;k.set_active(b);k.robot_in_training()&&k.robot_in_training().edited(robot,{setter_name:"set_active",
argument_1:b,toString:"change to "+(b?"active":"inactive")+" of the "+k,button_selector:".toontalk-sensor-active-check-box"});k.render();a.stopPropagation()},l=a.add_advanced_settings;d.appendChild(m);a.add_advanced_settings=function(){var b;f.button.addEventListener("change",c);h.button.addEventListener("change",g);e.button.addEventListener("click",v);l.call(a,f.container,h.container);b=$(d).children(".toontalk-advanced-settings-table");0<b.length&&b.get(0).appendChild(e.container)};return a}}}(window.TOONTALK);window.TOONTALK.tool=function(b){document.addEventListener("mousemove",function(f){b.tool.pageX=f.pageX;b.tool.pageY=f.pageY});var k,f;return{get_widget_side_under_tool:function(){return k},set_last_event_type:function(b){f=b},add_listeners:function(h,e){var a,d,c,g,m,v=function(k){var l=h.getBoundingClientRect();f=void 0;e.set_held&&e.set_held(!0);g=l.height;k&&k.preventDefault();setTimeout(function(){e.held&&!e.held()||$(h).addClass("toontalk-tool-held")},200);a=$(h).offset();document.addEventListener("mousemove",
u);document.addEventListener("touchmove",u);document.addEventListener("mouseup",q);document.addEventListener("touchend",q);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_down at "+Date.now());c=d=0;$(".ui-tooltip").each(function(){$(this).hide()})},l=function(a){var f=h.getBoundingClientRect();e.held&&e.held()||v(a);d=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientX",a)-f.left;c=b.UTILITIES.get_mouse_or_first_touch_event_attribute("clientY",a)-f.top},u=function(a){k=
b.UTILITIES.find_widget_side_on_page(a,h,d,c-g/2);var e,f,l;a.preventDefault();k&&k.is_of_type("empty hole")&&(k=k.get_parent_of_frontside());$(".ui-tooltip").each(function(){$(this).hide()});f=t(a);l=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageX",a)-f.deltaX-d;a=b.UTILITIES.get_mouse_or_first_touch_event_attribute("pageY",a)-f.deltaY-c;h.style.left=l+"px";h.style.top=a+"px";b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_move at "+Date.now()+" now at "+h.style.left+
", "+h.style.top);if(k&&k.get_widget().is_top_level())m&&(b.UTILITIES.remove_highlight(),m=void 0);else{if(k&&(e=k.get_element(),e===m))return;m=e;b.UTILITIES.highlight_element(m)}},q=function(a){var e=b.UTILITIES.find_widget_side_on_page(a,h,d,c-g/2);a.preventDefault();n(h.toontalk_tool,e,a)}.bind(this),t=function(a){var b=0,c=0;20>a.clientX?b=-20:a.clientX+20>window.innerWidth&&(b=20);20>a.clientY?c=-20:a.clientY+20>window.innerHeight&&(c=20);window.scrollBy(b,c);return{deltaX:b,deltaY:c}},n=function(c,
d,e){var g;d&&d.is_of_type("empty hole")&&(d=d.get_parent_of_frontside());m&&b.UTILITIES.remove_highlight();d&&d.top_level_widget&&(void 0===f||f===e.type)&&(g=d.top_level_widget(),c.apply_tool(d,e),f=e.type,g.backup_all());!d&&c.nothing_under_tool&&c.nothing_under_tool();c.set_held&&c.set_held(!1);$(h).removeClass("toontalk-tool-held");$(h).addClass("toontalk-tool-returning");b.UTILITIES.add_one_shot_event_handler(h,"transitionend",1E3,function(){$(h).removeClass("toontalk-tool-returning")});a&&
b.UTILITIES.set_timeout(function(){h.style.left=a.left+"px";h.style.top=a.top+"px"});document.removeEventListener("mousemove",u);document.removeEventListener("touchmove",u);document.removeEventListener("mouseup",q);document.removeEventListener("touchend",q);b.logging&&0===b.logging.indexOf("touch")&&(b.debugging+="\nmouse_up at "+Date.now(),alert(b.debugging),b.debugging="touch")};h.addEventListener("mousedown",l);h.addEventListener("touchstart",l);return v}}}(window.TOONTALK);window.TOONTALK.vacuum=function(b){var k=Object.create(null),f={suck:"I'm a vacuum. Drag me over the thing you want to remove.\nType 'e' to switch to erasing, type 'r' to swich to restoring, or 'a' for removing all.\nOr click to switch modes.",erase:"I'm a vacuum. Drag me over the thing you want to erase (or un-erase).\nType 's' to switch to sucking, type 'r' to switch to restoring, or 'a' for removing all.\nOr click to switch modes.",restore:"Drag me over the work area. Each time you release me I'll restore a widget.\nType 's' to switch to sucking, type 'e' to swich to erasing, or 'a' for removing all.\nOr click to switch modes.",
suck_all:"Drag me over the work area and click. Everything will be removed.\nType 'r' to switch to restoring, type 'e' to switch to erasing, or type 's' to switch to sucking.\nOr click to switch modes."},h={suck:"toontalk-vacuum-s",erase:"toontalk-vacuum-e",restore:"toontalk-vacuum-r",suck_all:"toontalk-vacuum-a"},e={suck:"erase",erase:"restore",restore:"suck_all",suck_all:"suck"},a=!1,d;k.create=function(){var c,g,m,v=[],l=function(a){m!==a&&(m=a,b.sounds&&b.sounds.click.play(),$(c).removeClass(g),
g=h[m],$(c).addClass(g),u())},u=function(){"restore"===m&&0===v.length?b.UTILITIES.give_tooltip(c,"I'm empty.\nType 's' to switch to sucking, or type 'e' to switch to erasing, or 'a' to remove all."):b.UTILITIES.give_tooltip(c,f[m])};document.addEventListener("keyup",function(a){var e=String.fromCharCode(a.keyCode);if(a.altKey){if(0>"SsEeRrAa".split("").indexOf(e))return;c||(k.the_vacuum.get_element(),$(c).css({left:b.tool.pageX,top:b.tool.pageY}),document.body.appendChild(c));d()}k.the_vacuum.held()&&
("s"===e||"S"===e?l("suck"):"e"===e||"E"===e?l("erase"):"r"===e||"R"===e?l("restore"):"a"===e||"A"===e?l("suck_all"):b.sounds&&b.sounds.event_ignored.play(),a.preventDefault(),a.stopPropagation())});document.addEventListener("keydown",function(a){k.the_vacuum.held()&&(a.preventDefault(),a.stopPropagation())});b.vacuum.the_vacuum={apply_tool:function(a,d){var e=a.get_widget(),f=function(a){d&&e.robot_in_training()&&e.robot_in_training().removed(a);a.is_primary_backside&&a.is_primary_backside()?a.hide_backside():
a===e.robot_in_training()?(a.training_finished(),a.set_run_once(!0)):(e.is_bird()&&b.sounds&&b.sounds.bird_fly.pause(),a.is_backside()||(a.save_dimensions_of(a),a.this_and_walk_children(function(a){a.is_sensor()&&a.get_active()&&a.set_active("temporarily false");return!0})),v.push(a),a.set_running&&a.set_running(!1),a.is_backside()||a.this_and_walk_children(function(a){!a.is_backside()&&a.is_sensor()&&a.get_active()&&a.set_active(!1);return!0}),a.remove({event:d,do_not_remove_children:!0}))},g,h,
k;b.tool.set_last_event_type(d.type);"suck"===m?a.remove&&!a.get_widget().is_top_level()&&(f(a),b.sounds&&b.sounds.vacuum_suck.play()):"erase"===m||"restore"===m&&a.get_erased&&a.get_erased()?a.is_top_level()||(g=!a.get_erased(),b.sounds&&(g?b.sounds.vacuum_suck.play():b.sounds.vacuum_spit.play()),a.set_erased(g,!0),d&&e.robot_in_training()&&e.robot_in_training().erased_widget(a,g)):"restore"===m?0<v.length&&(g=v.pop(),g.restore_dimensions(),k=a.add_to_top_level_backside(g),d&&e.robot_in_training()&&
e.robot_in_training().restored(g),k.toontalk_widget_side=g,h=$(c).offset(),h.left-=$(k).width(),b.UTILITIES.set_absolute_position(k,h),g.this_and_walk_children&&(g.this_and_walk_children(function(a){a.is_sensor()&&a.restore_active();return!0}),b.sounds&&b.sounds.vacuum_spit.play())):"suck_all"===m&&(g=a.top_level_widget(),h=g.get_backside_widgets().slice(),0<h.length&&b.sounds&&(b.sounds.vacuum_suck.play(),b.sounds.bird_fly.pause()),b.UTILITIES.for_each_batch(h,function(a){a&&e!==e.robot_in_training()&&
f(a)}),g.set_backside_widgets([]))},nothing_under_tool:function(){l(e[m])},get_element:function(){c||(c=document.createElement("div"),$(c).addClass("toontalk-vacuum"),d=b.tool.add_listeners(c,this),l("suck"),u(),c.toontalk_tool=b.vacuum.the_vacuum);return c},held:function(){return a},set_held:function(c){var d=function(){b.UTILITIES.listen_for_speech({commands:"suck | erase | restore | remove all",success_callback:function(a,c){var e,f;if("remove all"===a)l("suck_all");else if("suck"===a||"erase"===
a||"restore"===a)l(a);else return console.log("ignoring "+a),!1;e=$(".toontalk-highlight");if(0<e.length)(e=b.UTILITIES.widget_side_of_jquery(e))&&e.top_level_widget&&(f=e.top_level_widget(),this.apply_tool(e,c),f.backup_all(),d());else if("restore"===a||"remove all"===a)f=b.tool.get_widget_side_under_tool(),this.apply_tool(f,c);return!0}.bind(this)})}.bind(this);(a=c)?d():b.UTILITIES.stop_listening_for_speech()},set_mode:function(a){l(a)}};return b.vacuum.the_vacuum};b.creators_from_json.vacuum=
function(a,d){var c=b.vacuum.create();a.mode&&b.UTILITIES.set_timeout(function(){c.set_mode(a.mode)});return c};return k}(window.TOONTALK);window.TOONTALK.wand=function(b){var k=Object.create(null);k.create=function(){var f=!1,h,e={apply_tool:function(a,d){var c;a.is_top_level()||(b.sounds&&b.sounds.magic.play(),c=a.add_copy_to_container(),c.update_display(),a.robot_in_training()&&a.robot_in_training().copied(a,c,!1))},get_element:function(){h||(h=document.createElement("div"),$(h).addClass("toontalk-wand"),b.UTILITIES.give_tooltip(h,"I'm a magic wand. Drag me over the thing you want me to copy."),b.tool.add_listeners(h,this),h.toontalk_tool=
e);return h},held:function(){return f},set_held:function(a){var d=function(){b.UTILITIES.listen_for_speech({commands:"copy | abracadabra",success_callback:function(a,e){var c,f;c=$(".toontalk-highlight");0<c.length&&(c=b.UTILITIES.widget_side_of_jquery(c))&&c.top_level_widget&&(f=c.top_level_widget(),this.apply_tool(c,e),b.tool.set_last_event_type(e.type),f.backup_all(),d());return!0}.bind(this)})}.bind(this);(f=a)?d():b.UTILITIES.stop_listening_for_speech()}};return e};b.creators_from_json.wand=
function(){return b.wand.create()};return k}(window.TOONTALK);window.TOONTALK.SETTINGS=function(b){var k=[],f=function(a,b){Dropbox.choose({success:b,linkType:"direct",extensions:a})},h=function(d,c,g){var h=[];b.UTILITIES.create_local_files_table(function(m){var l=function(a,c){var h=function(a){a||c.newPanel.append(b.UTILITIES.create_text_element("Error connecting to cloud. Have you logged in?"))},k=c.newPanel.is(".dataTable");$(".dataTables_info").hide();$(".dataTables_wrapper").hide();0<c.newTab.find(".toontalk-programs-in-cloud-tab-label").length?d.get_setting("save_to_dropbox")?
f([".tt.json"],function(a){b.UTILITIES.download_file(a[0].link,d.download_callback(function(){$(g).remove()}))}):k?($("#tab-1_info").show(),$("#tab-1_wrapper").show()):e(c.newPanel,"program",d,g,h):0<c.newTab.find(".toontalk-pages-in-cloud-tab-label").length?d.get_setting("save_to_dropbox")?f([".tt.html"],function(a){c.newPanel.before($("<p><a href='"+a[0].link+"' target='_blank'>Click to open "+a[0].name+"</a></p>"))}):k?($("#tab-2_info").show(),$("#tab-2_wrapper").show()):e(c.newPanel,"page",d,
g,h):($("#tab-0_info").show(),$("#tab-0_wrapper").show())},v;h[0]="Programs stored in browser";k[0]=m;c?(h[1]=b.UTILITIES.create_text_element("Programs in cloud","toontalk-programs-in-cloud-tab-label"),h[2]=b.UTILITIES.create_text_element("Published pages","toontalk-pages-in-cloud-tab-label"),d.get_setting("save_to_google_drive")?(k[1]=b.UTILITIES.create_file_data_table("toontalk-programs-in-cloud-table"),k[2]=b.UTILITIES.create_file_data_table("toontalk-pages-in-cloud-table")):(k[1]=b.UTILITIES.create_text_element("Choose a file to load."),
k[2]=b.UTILITIES.create_text_element("Choose a page to display.")),v=b.UTILITIES.create_tabs(h,k),g.appendChild(v),$(v).on("tabsactivate",l)):g.appendChild(b.UTILITIES.create_tabs(h,k));a(d,m,!0,g);$(m).on("draw.dt",function(){a(d,m,!1,g)})})},e=function(d,c,e,f,h){b.google_drive.get_toontalk_files(!1,c,function(g){var k;"string"===typeof g?k=g:g.error&&(k=g.error.message);k?"Need to authorize"===k||"Login Required"===k?b.google_drive.authorize(h):(console.log(k),console.log("Google drive status: "+
b.google_drive.get_status()),h(null)):(b.UTILITIES.become_file_data_table(d,g.items,!0,"program"===c&&"toontalk-file-load-button toontalk-file-load-button-without-click-handler"),a(e,d.get(0),!0,f),d.on("draw.dt",function(){a(e,d.get(0),!0,f)}),h(d.get(0)))})},a=function(a,b,e,f){var c=function(b){var c=function(){$(f).remove()},d=function(){a.set_setting("program_name",b.target.textContent);a.load(e,c)}.bind(this);a.save(!0,void 0,d)};b=$(b).find(".toontalk-file-load-button-without-click-handler");
b.each(function(a,b){b.addEventListener("click",c)});b.removeClass("toontalk-file-load-button-without-click-handler")};return{open:function(a){var c=document.createElement("div"),d=a.get_backside_element(),e=a.get_setting("program_name"),f=b.UTILITIES.create_text_input(e,"toontalk-program-name-input","Current program name:","Edit this to change the name of your program","docs/manual/settings.html"),k=b.UTILITIES.create_close_button(function(){$(c).remove()},"Click to close the settings panel."),u=
b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.speak?b.CHROME_APP?"Turn off spoken help":"Reload with speaking turned off":b.CHROME_APP?"Turn on spoken help":"Reload with spoken help",b.speak?"Check this if you no longer want spoken help.":"Check this if you would like ToonTalk to speak to you."),q=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.balloons?b.CHROME_APP?"Turn off help balloons":"Reload with no balloon help":b.CHROME_APP?"Turn on help balloons":
"Reload with balloon help",b.balloons?"Check this if you no longer want ToonTalk to display balloons giving tips and help.":"Check this if you would like ToonTalk to display balloons giving tips and help."),t=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.listen?b.CHROME_APP?"Turn off voice commands":"Reload with voice commands turned off":b.CHROME_APP?"Turn on voice commands":"Reload with <a href='docs/manual/voice-commands.html' target = '_blank'>voice commands</a> turned on",
b.listen?"Check this if you no longer want ToonTalk to listen to voice commands.":"Check this if you would like ToonTalk to listen for voice commadns."),n=b.UTILITIES.create_check_box(!1,"toontalk-url-parameter-setting",b.TRANSLATION_ENABLED?b.CHROME_APP?"Turn off translation from English":"Reload with no translation from English":b.CHROME_APP?"Turn on translation":"Reload with over one hundred languages that ToonTalk can be translated to",b.TRANSLATION_ENABLED?"Check this if you no longer want ToonTalk to display a choice of languages.":
"Check this if you would like ToonTalk to display a menu of languages for the interface to be translated to."),r=b.UTILITIES.create_text_element("Saving and loading options"),z=b.UTILITIES.create_check_box(a.get_setting("save_to_dropbox"),"toontalk-save-setting","When saving to the cloud use my Dropbox account",'Check this if you want your programs saved to a "ToonTalk Reborn" folder in the "Apps" folder in your Dropbox.'),C=b.UTILITIES.create_check_box(a.get_setting("save_to_google_drive"),"toontalk-save-setting",
"When saving to the cloud use my Google Drive account",'Check this if you want your programs saved to a "ToonTalk Programs" folder in your Google Drive.'),A=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_cloud"),"toontalk-save-setting","Save automatically to cloud storage","Check this if you want your programs to Dropbox or Google Drive when your program changes."),y=b.UTILITIES.create_check_box(a.get_setting("auto_save_to_local_storage"),"toontalk-save-setting","Save automatically to this browser's local storage",
"Check this if you want your programs automatically saved in this browser's local storage."),J=b.UTILITIES.create_button("Save to cloud storage now","toontalk-save-button","Click to save your program now to your Dropbox or your Google Drive account.",function(){a.save(!0,{google_drive:a.get_setting("save_to_google_drive"),dropbox:a.get_setting("save_to_dropbox")})}),O=b.UTILITIES.create_button("Save to browser's storage now","toontalk-save-button","Click to save your program now to this browser's local storage.",
function(){a.save(!0,{local_storage:!0})}),G=b.UTILITIES.create_button("Login to Google","toontalk-google-login-button","Click to log in to Google to authorize use of your Google Drive.",function(){b.google_drive.authorize(function(){$(G).remove()})}),R=b.UTILITIES.create_button("Publish","toontalk-publish-button","Click to publish your program by generating a Google Drive URL.",function(){a.display_message("Creating your web page...",{dont_log:!0});a.publish(H,Q.button.checked)}),Q=b.UTILITIES.create_check_box(a.get_setting("publish_as_workspace"),
"toontalk-publish-setting","As a workspace","Check this if you want to publish the workspace and its widgets. Uncheck it you wish to publish just the widgets."),H=function(c,d){var e;if(c){e=a.get_setting("program_name");var g=document.createElement("span"),h=b.google_drive.google_drive_url(c.id,!0);g.innerHTML="Published <a href='"+h+"' target='_blank' title='Click to visit or edit.'>"+e+"</a>";e=$(f.container).children("tr");a.display_message("Your web page is ready for you to edit. Just click on the link.",
{dont_log:!0});0<e.length&&e.get(0).appendChild(b.UTILITIES.create_table_entry(g))}},D=document.createElement("div"),L=b.google_drive&&"undefined"!==typeof gapi?b.google_drive.get_status():"Google Drive API not loaded",S=!0,I=function(){$(c).remove();setTimeout(function(){window.TOONTALK.SETTINGS.open(a)})},P=b.UTILITIES.create_vertical_table(R,Q.container),U=function(a,c){return function(){window.location.assign(b.UTILITIES.add_URL_parameter(window.location.href,a,c?"0":"1"))}},W=function(a){return function(){b.UTILITIES.set_parameter(a,
!b[a])}},V=function(a,c){return b.CHROME_APP?W(c):U(a,b[c])},M=$(f.container).children("tr");$(c).addClass("toontalk-settings-panel").css({width:$(d).width()+29,height:$(d).height()+50,left:-2,top:-25,"z-index":9999999});c.appendChild(k);f.button.addEventListener("change",function(){var d=f.button.value.trim();e!==d&&a.save(!0,void 0,function(){e=d;a.set_setting("program_name",d);a.load(!0,function(){setTimeout(function(){$(c).css({"z-index":b.UTILITIES.next_z_index()})},500)},function(){a.save(!0,
void 0,function(){$(".toontalk-settings-panel").remove();a.display_message("Your program was copied and the new copy's name is '"+a.get_setting("program_name")+"'.",{dont_log:!0})})})})});u.button.addEventListener("click",V("speak","speak"));t.button.addEventListener("click",V("listen","listen"));q.button.addEventListener("click",V("balloons","balloons"));n.button.addEventListener("click",V("translate","TRANSLATION_ENABLED"));C.button.addEventListener("click",function(b){a.save(!0,{save_to_google_drive:C.button.checked,
gooogle_drive:!0});a.set_setting("save_to_google_drive",C.button.checked);C.button.checked?($(J).hide(),z.button.checked=!1,a.set_setting("save_to_dropbox",!1),I()):z.button.checked?$(J).show():($(J).hide(),A.button.checked=!1)});z.button.addEventListener("click",function(b){a.save(!0,{save_to_dropbox:z.button.checked,dropbox:!0});a.set_setting("save_to_dropbox",z.button.checked);z.button.checked?($(J).hide(),C.button.checked=!1,a.set_setting("save_to_google_drive",!1),I()):C.button.checked?$(J).show():
($(J).hide(),A.button.checked=!1)});A.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_cloud:A.button.checked,google_drive:a.set_setting("save_to_google_drive"),dropbox:a.set_setting("save_to_dropbox")});a.set_setting("auto_save_to_cloud",A.button.checked);A.button.checked?$(J).hide():z.button.checked||C.button.checked?$(J).show():$(J).hide()});y.button.addEventListener("click",function(b){a.save(!0,{auto_save_to_local_storage:y.button.checked,local_storage:!0});a.set_setting("auto_save_to_local_storage",
y.button.checked);y.button.checked?$(O).hide():$(O).show()});Q.button.addEventListener("click",function(b){a.set_setting("publish_as_workspace",Q.button.checked)});c.appendChild(D);$(r).css({"font-weight":"bold","font-size":24,color:"navy"});D.appendChild(u.container);D.appendChild(q.container);b.CHROME_APP||(D.appendChild(t.container),D.appendChild(n.container));D.appendChild(r);D.appendChild(f.container);b.CHROME_APP||(D.appendChild(C.container),D.appendChild(A.container),D.appendChild(y.container));
C.container.appendChild(b.UTILITIES.create_space());C.container.appendChild(J);z.container.appendChild(b.UTILITIES.create_space());z.container.appendChild(J);a.get_setting("auto_save_to_cloud")&&$(J).hide();y.container.appendChild(b.UTILITIES.create_space());y.container.appendChild(O);a.get_setting("auto_save_to_local_storage")&&$(O).hide();a.get_setting("save_to_google_drive")?"Need to authorize"===L?(C.container.appendChild(b.UTILITIES.create_space()),C.container.appendChild(G)):"Authorized"!==
L&&"Ready"!==L&&"Authorized but not yet ready"!==L?(S=!1,a.set_setting("google_drive_unavailable",!0),setTimeout(function(){C.button.disabled=!0;$(R).button("option","disabled",!0);$(J).button("option","disabled",!0);b.UTILITIES.give_tooltip(C.container,"Inactivated because attempt to connect to Google Drive returned: "+L);R.title=C.container.title;J.title=C.container.title},1)):a.set_setting("google_drive_unavailable",!1):a.get_setting("save_to_dropbox")&&(S=!0);0<M.length&&M.get(0).appendChild(b.UTILITIES.create_table_entry(P));
h(a,S,c);d.appendChild(c)}}}(window.TOONTALK);window.TOONTALK.DEFAULT_SETTINGS={program_name:"My first program",save_to_google_drive:!0,auto_save_to_cloud:!0,auto_save_to_local_storage:!0};window.TOONTALK.DISPLAY_UPDATES=function(b){var k=[],f=0,h=!1,e=!1;return{pending_update:function(a){0<=k.indexOf(a)||(k.push(a),this.update_display())},update_display:function(){var a;e||document.hidden||0===k.length||(a=Date.now(),a<f?(e=!0,setTimeout(this.update_display_workhorse.bind(this),f-a)):h||(e=!0,b.UTILITIES.set_timeout(function(){this.update_display_workhorse(a)}.bind(this))))},update_display_workhorse:function(a){var d=k;k=[];h=!0;e=!1;f=(a|Date.now())+50;b.UTILITIES.for_each_batch(d,
function(a){var c=a.get_element&&a.get_element(),d,e;c&&(a.visible()||$(c).is(".toontalk-top-level-resource"))&&($(c).is(".toontalk-not-observable")?b.DISPLAY_UPDATES.pending_update(a):$(c).is(".toontalk-has-attached-callback")?c.parentElement&&c.toontalk_attached_callback&&(c.toontalk_attached_callback(),c.toontalk_attached_callback=void 0):($(c).show(),a.update_display(),a.get_backside&&(e=a.get_backside())&&e.visible()&&e.update_display(),setTimeout(function(){b.UTILITIES.use_custom_tooltip(c)}),
d=$(c).parent().closest(".toontalk-side"),c&&!$(c).is(".toontalk-top-level-resource, .toontalk-bird, .toontalk-nest, .toontalk-box-hole, .toontalk-plain-text-element, .toontalk-conditions-contents, .toontalk-robot, .toontalk-widget, .toontalk-held-by-robot")&&b.UTILITIES.set_timeout(function(){var e;d.is(".toontalk-box-hole")||d.is(".toontalk-nest")?$(c).children(".ui-resizable-handle").hide():$(c).is(".ui-resizable")?$(c).children(".ui-resizable-handle").show():(b.UTILITIES.make_resizable($(c),a),
a.is_box()&&(e=a.get_border_size(),$(c).children(".ui-resizable-handle").css({right:-e,bottom:-e})))})))});h=!1;0<k.length&&(e=!0,setTimeout(function(){this.update_display_workhorse()}.bind(this),50))}}}(window.TOONTALK);window.TOONTALK.actions=function(b){b.creators_from_json.body=function(k,f){var h=b.actions.create();f.body=h;h.initialise_steps(b.UTILITIES.create_array_from_json(k.steps,f));return h};return{create:function(k){var f=Object.create(this),h=[];k||(k=[]);f.copy=function(){return b.actions.create(b.UTILITIES.copy_array(k))};f.get_steps=function(){return k};f.initialise_steps=function(b){k=b};f.is_empty=function(){return 0===k.length};f.reset_steps=function(){k=[];this.reset_newly_created_widgets()};
f.reset_newly_created_widgets=function(){b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Reset newly_created_widgets. Length was "+h.length);h=[]};f.add_step=function(e,a){e?(k.push(e),a&&this.add_newly_created_widget_if_new(a)):b.UTILITIES.report_internal_error("Attempt to add an undefined step.")};f.add_newly_created_widget_if_new=function(b){0<=h.indexOf(b)||this.add_newly_created_widget(b)};f.add_newly_created_widget=function(e){b.debugging&&0<=h.indexOf(e)?console.log("add_newly_created_widget called with not new widget."):
(h.push(e),b.logging&&0<=b.logging.indexOf("newly-created")&&console.log("Added "+e.to_debug_string(50)+" to list of newly_created_widgets. Length is "+h.length))};f.is_newly_created=function(b){return 0<=h.indexOf(b)};f.get_newly_created_widgets=function(){return h};f.get_path_to=function(e,a,d){var c,f;h.some(function(g,h){if(g===e||d&&g===e)return c=b.newly_created_widgets_path.create(h),!0;if(g.get_path_to&&(f=g.get_path_to(e,a)))return c=b.newly_created_widgets_path.create(h),c.next=f,!0});return c};
f.dereference_path=function(e){b.debugging&&!h[e]&&b.UTILITIES.report_internal_error("Expected to find the "+b.UTILITIES.ordinal(e)+" newly created widget.");return h[e]};return f},run_unwatched:function(k,f){var h=this.get_steps();b.logging&&0<=b.logging.indexOf("run")&&console.log(k.to_debug_string(50)+" running unwatched");f||(f=0);k.run_next_step=function(e){if(f<h.length){var a=h[f];f++;b.logging&&0<=b.logging.indexOf("event")&&console.log(a+" (unwatched) at "+Date.now()+" by robot "+k.get_name()+
" "+k._debug_id);e?(k.run_watched_step_end_listeners(),a.run_watched(k)):a.run_unwatched(k)}else this.stopped()||(k.set_running_or_in_run_queue(!1),k.run_body_finished_listeners(),k.get_run_once()?k.get_first_in_team().set_running(!1):k.get_first_in_team().run())};k.run_next_step()},run_watched:function(k){var f=this.get_steps(),h=k.get_frontside_element(),e=h.parentElement,a=k.get_first_in_team(),d=0,c=$(h).offset(),g=$(h).offset(),m=$(h).width(),v=$(h).height();k.get_first_in_team().top_level_widget();
var l=$(h).closest(".toontalk-backside-of-top-level").offset(),u=k.get_context().get_backside(),q=k.get_parent(),t,n,r,z;b.logging&&0<=b.logging.indexOf("run")&&console.log(k.to_debug_string(50)+" running watched");r=(n=k.get_previous_robot())?$(n.get_backside(!0).get_next_robot_area()):u&&$(u.get_backside_element(!0));if(!b.UTILITIES.is_attached(h)&&n){t=h.parentElement;!t&&r&&(t=r.get(0));for(z=n.get_first_in_team();z!==k;)z.open_backside(),z.get_backside().set_advanced_settings_showing(!0),function(){var a=
z;setTimeout(function(){a.get_backside()&&(a.get_backside().set_advanced_settings_showing(!1),a.hide_backside())},2E3)}(),n=z.get_frontside_element(),c=$(n).offset(),0!==c.left&&0!==c.top&&void 0===l&&(g={left:c.left,top:c.top},l=c),z=z.get_next_robot();k.set_visible(!0);k.update_display();k.add_body_finished_listener(function(){t&&TOONTALK.UTILITIES.is_attached(t)?t.appendChild(h):q||k.remove({do_not_remove_frontside:!0});$(h).css({left:"",top:"",position:"","z-index":""})})}k.add_body_finished_listener(function(){var d=
a.visible(),f=function(){d&&(e&&(e.appendChild(h),k.set_parent_of_frontside(b.UTILITIES.widget_side_of_element(e))),k.set_animating(!1));a===k?b.UTILITIES.set_absolute_position(h,c):(b.UTILITIES.set_css(h,{position:"static"}),r&&0<r.length&&r.append(h));k.get_run_once()?a.set_running(!1):k.stopped()?$(h).removeClass(".toontalk-side-animating"):a.run();k.rerender()};d?(!h.parentElement&&k.get_parent_of_frontside()&&k.get_parent_of_frontside().get_frontside_element(!0).appendChild(h),b.UTILITIES.animate_to_absolute_position(h,
c,f,k&&k.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED))):(k.set_animating(!1),f(),k===a&&k.get_context().add_backside_widget(k),$(k.get_frontside_element()).remove())});0===m&&($(h).css({width:"",height:""}),m=k.saved_width||$(h).width(),v=k.saved_height||$(h).height());l||(l={left:0,top:0});r&&0<r.length&&b.UTILITIES.is_attached(r.get(0))&&(n=r.get(0).getBoundingClientRect(),c.left<n.left-l.left||c.top<n.top-l.top||c.left+m>n.right+l.left||c.top+v>n.bottom+l.top)&&(c=r.offset(),
c.left+=r.width()/2,c.top+=r.height()-v,g=c);k.start_offset=g;k.add_to_top_level_backside();b.UTILITIES.set_absolute_position(h,c);k.run_next_step=function(){!u||document.hidden||!u.visible()&&!b.UTILITIES.visible_element(u.get_element())||k.stopped()?(k.set_running_or_in_run_queue(!1),k.set_animating(!1),$(h).css({width:"",height:""}),h.style.transitionDuration="",e&&e.appendChild(h),this.run_unwatched(k,d)):setTimeout(function(){var a;k.run_watched_step_end_listeners();d<f.length?(a=f[d],d++,b.logging&&
0<=b.logging.indexOf("event")&&console.log(a+" (watched)"),a.run_watched(k)):(k.set_running_or_in_run_queue(!1),k.run_body_finished_listeners())},k.transform_step_duration(b.animation_settings.PAUSE_BETWEEN_STEPS))}.bind(this);k.set_animating(!0,c);k.run_next_step();return!0},toString:function(b){for(var f="",h=this.get_steps().map(function(e){return e&&e.toString(b)});""===h[h.length-1];)h.pop();h.forEach(function(b,a){b&&(f+=b,f=a===h.length-2?f+" and \n":a<h.length-2?f+", \n":f+".")});return f},
get_json:function(k,f,h){var e=[];b.UTILITIES.get_json_of_array(this.get_steps(),e,0,k,function(){f({type:"body",steps:e},h)},h)}}}(window.TOONTALK);
window.TOONTALK.newly_created_widgets_path=function(b){b.creators_from_json.newly_created_widgets_path=function(k){return b.newly_created_widgets_path.create(k.index)};return{create:function(k){return{dereference_path:function(f){var h=f.get_body().dereference_path(k),e;if(this.next)return b.path.dereference_path(this.next,f,h);this.removing_widget&&h&&((e=h.get_parent_of_frontside())&&e.is_hole()&&(e=e.get_parent_of_frontside()),e&&e.removed_from_container&&f.remove_from_container(h,e));return h},
toString:function(){return"the "+b.UTILITIES.ordinal(k)+" new widget"},get_json:function(b,h,e){h({type:"newly_created_widgets_path",index:k},e)}}}}}(window.TOONTALK);window.TOONTALK.robot_action=function(b){var k=function(a,b,c){if(!c||!c.running_watched||!a.get_backside())return!0;a.get_backside().hide_backside()},f={copy:function(a,b){b.add_newly_created_widget(a.copy());return!0},"pick up":function(a,c,d){if(a.is_empty_hole&&a.is_empty_hole())b.UTILITIES.report_internal_error(c+" trying to pick up an empty hole.");else{if(a.get_infinite_stack())return f["pick up a copy of"](a,c);d&&d.running_watched||a.set_parent(void 0);c.set_thing_in_hand(a);return!0}},"pick up a copy of":function(a,
b){var c=a.copy();b.add_newly_created_widget(c);b.set_thing_in_hand(c);return!0},"drop it on":function(a,c,d){var e;if(a)if(e=c.get_thing_in_hand()){if(e.drop_on)return b.debugging&&e===a&&b.UTILITIES.report_internal_error("Dropping something on itself! "+a),a.visible()||$(e.get_frontside_element()).remove(),e.drop_on(a,{robot:c}),c.set_thing_in_hand(void 0),a.rerender(),c.add_newly_created_widget_if_new(e),e.robot_waiting_before_next_step===c?(d&&d.running_watched||(e.robot_waiting_before_next_step=
void 0),!1):!0;b.debugging&&b.UTILITIES.report_internal_error("Thing in robot's hand ("+e+") doesn't handle 'drop_on'. Robot that "+c)}else!c.being_trained&&b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but has nothing in its hand.");else b.debugging&&b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing drop_on but doesn't know where to drop what its holding")},"drop it on the text area of":function(a,c,d){var e;
if(a){if(e=c.get_thing_in_hand())return c.set_thing_in_hand(void 0),a[d.setter](e),!0;b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but has nothing in its hand.")}else b.UTILITIES.report_internal_error("The robot that '"+c.toString()+"' is executing dropped_on_text_area but doesn't know where to drop what its holding")},remove:function(a,b){a.remove();a===b?b.set_stopped(!0):b.add_newly_created_widget_if_new(a);return!0},restore:function(a,
b){b.add_to_top_level_backside(a);a.get_element().toontalk_widget_side=a;return!0},"change whether erased":function(a,b,c){if(a.set_erased)return a.set_erased(!a.get_erased()),!0;a.display_message("Robot is unable to erase "+a)},edit:function(a,c,d){if(a[d.setter_name])return d.argument_2?a[d.setter_name].call(a,d.argument_1,d.argument_2,a.visible()):a[d.setter_name].call(a,d.argument_1,a.visible()),!0;b.UTILITIES.report_internal_error(a+" cannot be edited.")},"change size of":function(a,b,c){return!0},
"add to the top-level backside":function(a,c,d){var e,f;if(!d||!d.running_watched){d=c.top_level_widget();d.add_backside_widget(a);e=c.get_context();if(!e.visible())return;f=d.get_backside_element();e=a.get_frontside_element(!0);a.update_display();f.appendChild(e);a.animate_to_element(f,void 0,c.transform_animation_speed(b.animation_settings.ANIMATION_SPEED));$(e).css(d.get_backside().get_free_location(a))}return!0},"add a new widget to the work space":function(a,c,d){c.get_context().is_top_level()?
(d=c.add_to_top_level_backside(a),c=$(c.get_frontside_element()).offset(),a.update_display(),b.UTILITIES.set_position_relative_to_top_level_backside($(d),c,!0)):a.drop_on(c.get_context().get_backside(!0),{robot:c});return!0},"start training":function(a,b,c){c&&c.running_watched||(a.initialize_backside_conditions(),a.get_body().reset_steps(),b.robot_started_training(a));a.training_started(b);return!0},"stop training":function(a,b,c){a.training_finished();return!0},train:function(a,b,c){a.add_step(c.step);
return!0},"open the backside":function(){return!0},"open the backside of":function(){return!0},"close the backside of":k,"close the backside":k,"click the button of":function(a,b,c){".toontalk-green-flag"===c.button_selector?a.set_running(!0):".toontalk-stop-sign"===c.button_selector&&a.set_running(!1);return!0}},h=function(a,c,d,e){var f=c.get_thing_in_hand(),g=c.get_frontside_element(),h=a.get_element(),k,l,m,n;h||(h=b.UTILITIES.find_resource_equal_to_widget(a,c));b.UTILITIES.is_attached(h)&&c.visible()&&
!c.stopped()?(k=h.getBoundingClientRect(),e&&e.left_offset_fraction?(c.original_animation_left_offset||(c.original_animation_left_offset=[]),c.original_animation_top_offset||(c.original_animation_top_offset=[]),k={left:e.left_offset_fraction*k.width,top:e.top_offset_fraction*k.height},f&&(n=f.get_element(),b.UTILITIES.visible_element(n)&&(n=$(n).offset(),g=$(g).offset(),k.left-=n.left-g.left,k.top-=n.top-g.top)),f=a.get_backside().get_free_location(f,{try_first:k}),h.animation_left_offset=f.left,
h.animation_top_offset=f.top,c.animation_left_offset=f.left,c.animation_top_offset=f.top):(l=k.width/2,m=k.height/2),c.animate_to_widget(a,d,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),l,m,!0,c.transform_original_step_duration(e&&e.time),c)):d()},e=function(a,b,c,d){h(a,b,function(){a.open_backside(c);v(a,b)},d)},a=function(a,b){var c=a.get_backside_element(!0),d=$(c).find(b).get(0);if(d)return d;a.get_backside().set_advanced_settings_showing(!0);return $(c).find(b).get(0)},
d=function(c,d,e,f,g,h){var k=a(c,f);d.get_frontside_element();var l=k&&b.UTILITIES.visible_element(k),m=function(){e(k);$(k).addClass("ui-state-active");if(".toontalk-select-function"===f||".toontalk-box-size-input"===f)k.value=g.argument_1;setTimeout(function(){$(k).removeClass("ui-state-active");b.UTILITIES.remove_highlight();d.run_next_step(!0)},h)},n=function(){var a;b.UTILITIES.visible_element(k)||(a=c.get_backside(!0),a.set_advanced_settings_showing(!0,a.get_element()));d.animate_to_element(k,
m,d.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0,d.transform_original_step_duration(g&&g.time))};b.UTILITIES.highlight_element(c.get_frontside_element());!l&&c.open_backside&&d.animate_consequences_of_actions()?c.open_backside(n,d.transform_step_duration(b.animation_settings.OPEN_BACKSIDE_DURATION))&&v(c,d):n()},c=function(a,c,d,e,f){var h=b.UTILITIES.closest_element($("."+f),$(c.get_frontside_element()).offset()),k=function(){g(a,c,d,e)};h&&c.animate_consequences_of_actions()&&
0<$("."+f).length?c.animate_to_element(h,k,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0):k()},g=function(a,c,d,e){c.get_frontside_element();var f=function(){c.carrying_tool=void 0;c.update_display();d();c.run_next_step(!0)},g;c.animate_consequences_of_actions()?(c.carrying_tool=e,c.update_display(),e=c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),a?c.animate_to_element(a.get_element(),f,e,0,0,!0):(g=c.top_level_widget().get_element(),a=$(g).offset(),
a.left+=$(g).width()*(.1+.8*Math.random()),a.top+=$(g).height()*(.1+.8*Math.random()),c.animate_to_absolute_position(a,f,e,!0))):(d(),c.run_next_step(!0))},k=function(a,b,d){var e=a.get_parent_of_frontside();c(a,b,function(){d();e&&"top-level"!==e.get_widget().get_type_name()&&e.update_display&&e.update_display();a.rerender()},"toontalk-vacuum-ready-small","toontalk-vacuum")},m=function(a,c,d){a.open_backside(function(){d();c.run_next_step(!0)},b.animation_settings.OPEN_BACKSIDE_DURATION);v(a,c)},
v=function(a,b){b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().hide_backside()})},l=function(a,c,d,e){e=e&&e.time?c.transform_original_step_duration(e.time):c.transform_step_duration(b.animation_settings.CLOSE_BACKSIDE_DURATION);setTimeout(function(){$(a.get_backside_element()).children(".toontalk-close-button").click();d();c.run_next_step(!0)},e)},u={copy:function(a,d,e){c(a,d,function(){a.add_copy_to_container?(e(),a.add_copy_to_container(d.get_recently_created_widget())):
b.UTILITIES.display_message("Unable to copy "+b.UTILITIES.add_a_or_an(a.get_type_name())+" by robot named "+d.get_name())},"toontalk-wand-small","toontalk-wand")},"pick up":function(a,c,d,e){var f=function(){d();c.animate_consequences_of_actions()&&c.update_display();c.run_next_step(!0)};b.debugging&&"empty hole"===a.get_type_name()?b.UTILITIES.report_internal_error("Robot trying to pick up an empty hole."):a.save_dimensions()&&c.animate_consequences_of_actions()?h(a,c,f,e):f()},"pick up a copy of":function(a,
c,d,e){h(a,c,function(){var e;d();c.animate_consequences_of_actions()&&(e=c.get_recently_created_widget())&&(e.set_visible(!0),b.UTILITIES.copy_frontside_dimensions(a,e),c.update_display());c.run_next_step(!0)},e)},"drop it on":function(a,c,d,f){var g=c.get_thing_in_hand(),k,l;g?(b.debugging&&g===a&&b.UTILITIES.report_internal_error("Dropping something on itself!"),k=g.get_element(!0),g.set_visible(c.visible()),l=function(){var a;$(k).removeClass("toontalk-held-by-robot");g.drop_on&&(c.animate_consequences_of_actions()&&
!b.UTILITIES.visible_element(k)&&(a=$(c.get_frontside_element()).closest(".toontalk-backside-of-top-level"),0<a.length&&a.get(0).appendChild(k)),c.rerender());d();g.drop_on&&g.visible()&&(b.UTILITIES.set_absolute_position(k,$(k).offset()),g.restore_dimensions());g.robot_waiting_before_next_step!==c&&c.run_next_step(!0)},a.is_backside()&&!b.UTILITIES.visible_element(a.get_element())?e(a.get_widget(),c,l,f):h(a,c,l,f)):(b.debugging&&(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),
console.log("The robot is "+c)),h(a,c,d,f))},"drop it on the text area of":function(a,c,d,f){var g=c.get_thing_in_hand(),k,l,m,n;g?(k=g.get_element(!0),g.set_visible(c.visible()),l=function(){var b;$(k).removeClass("toontalk-held-by-robot");d();g.remove();b=a.get_parent_of_frontside().get_widget();b.is_hole()&&(b=b.get_parent_of_frontside());b.is_top_level()?a.render():b.render();c.set_thing_in_hand(void 0);c.run_next_step(!0)},m=function(){return $(a.get_backside_element()).find(f.area_selector).get(0)},
c.rerender(),b.UTILITIES.visible_element(a.get_backside_element())?(n=m(),c.animate_to_element(n,l,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED/2),0,0,!0)):e(a,c,function(){n=m();c.animate_to_element(n,l,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED/2),0,0,!0)},f)):(b.UTILITIES.report_internal_error("Expected the robot to be holding something."),console.log("The robot is "+c),h(a,c,d,f))},remove:k,"change whether erased":k,restore:function(a,d,e){c(void 0,
d,function(){b.UTILITIES.set_css(a.get_element(!0),$(d.get_frontside_element()).position());e()},"toontalk-vacuum-ready-small","toontalk-vacuum")},edit:function(a,c,e,f){d(a,c,function(){a.get_backside()&&a.get_backside().update_display();e()},f.button_selector,f,c.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))},"change size of":function(a,c,d,e){var f=a.get_frontside_element();f?c.animate_to_element(f,function(){var g=f.getBoundingClientRect(),h=g.width*e.x_factor,g=g.height*e.y_factor,
k=c.transform_step_duration(b.animation_settings.CHANGE_SIZE_DURATION);$(f).addClass("toontalk-animating-element");f.style.transitionDuration=k+"ms";f.style.width=h+"px";f.style.height=g+"px";setTimeout(function(){$(f).removeClass("toontalk-animating-element");f.style.transitionDuration="";d();a.render();c.run_next_step(!0)},k)},c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED),0,0,!0):(d(),c.run_next_step(!0))},"add to the top-level backside":function(a,b,c){c();b.run_next_step(!0)},
"add a new widget to the work space":function(a,c,e,f){f&&f.button_selector?(a=b.path.dereference_path(f.path_to_source,c),d(a,c,e,f.button_selector,f,c.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))):(e(),c.run_next_step(!0))},"start training":function(a,b,c){var d=a.open_backside();a=a.get_frontside_element();c();d&&$(d.get_element()).find(".toontalk-train-backside-button").click();$(a).addClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");a.toontalk_followed_by=
{element:b.get_frontside_element(),left_offset:30,top_offset:-20};a.toontalk_return_to=$(a).offset();b.run_next_step(!0)},"stop training":function(a,c,e,f){var g=a.get_frontside_element();d(a,c,function(){var d=function(){g.toontalk_return_to=void 0;a.get_backside()&&a.get_backside().change_label_and_title_of_train_button(!1);$(g).removeClass("toontalk-robot-animating toontalk-robot-being-trained-by-robot");g.toontalk_followed_by=void 0;setTimeout(e,c.transform_step_duration(b.animation_settings.STOP_TRAINING_DELAY))};
g.toontalk_return_to?b.UTILITIES.animate_to_absolute_position(g,g.toontalk_return_to,d,c.transform_animation_speed(b.animation_settings.ROBOT_ANIMATION_SPEED)):d()},".toontalk-train-backside-button",f,c.transform_step_duration(b.animation_settings.BUTTON_USE_DELAY))},train:function(a,c,d,e){var f=function(){d();c.run_next_step(!0)};(e=e.step.run_watched)?(a.run_next_step=f,a.get_parent_of_frontside()?a.set_context(a.get_parent_of_frontside().get_widget()):b.UTILITIES.report_internal_error("Robot being trained by a robot doesn't know its parent widget."),
e(a)):f()},"open the backside":m,"open the backside of":m,"close the backside of":l,"close the backside":l,"click the button of":function(a,b,c,e){d(a,b,function(d){$(d).is(".toontalk-settings-backside-button")&&">"===d.innerText&&b.add_body_finished_listener(function(){a.get_backside()&&a.get_backside().set_advanced_settings_showing(!1,a.get_backside_element())});".toontalk-green-flag"!==e.button_selector&&".toontalk-stop-sign"!==e.button_selector&&$(d).click();c()},e.button_selector,e)}};b.creators_from_json.robot_action=
function(a,c){return a.additional_info?b.robot_action.create(b.UTILITIES.create_from_json(a.path,c),a.action_name,b.UTILITIES.create_keys_from_json(a.additional_info,c)):b.robot_action.create(b.UTILITIES.create_from_json(a.path,c),a.action_name)};return{create:function(a,c,d){var e=Object.create(this),g=f[c],h=u[c];if(h)return a||b.UTILITIES.report_internal_error("path undefined in "+c+" action"),g||b.UTILITIES.report_internal_error("no run_function for "+c),e.get_action_name=function(){return c},
e.get_additional_info=function(){return d},e.run_unwatched=function(c){var e=b.path.dereference_path(a,c);if(!e)return b.UTILITIES.report_internal_error("Unable to dereference path: "+b.path.toString(a)+", the back of "+c.get_context()+". This could be because this robot ("+c+") was trained in a very different situation.",{dont_log_exception:!0}),!1;b.logging&&0<=b.logging.indexOf("event")&&(e.wait_until_this_nest_receives_something?console.log("   wait_until_this_nest_receives_something "+e.wait_until_this_nest_receives_something.to_debug_string(50)+
"("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)+" "+c._debug_id):console.log("   "+e.to_debug_string(50)+" ("+b.path.toString(a)+") by unwatched "+c.to_debug_string(50)+" "+c._debug_id));e.wait_until_this_nest_receives_something?e.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.visible()?this.run_watched(c):this.run_unwatched(c)}.bind(this),c):(d&&(d.running_watched=!1),g(e,c,d)&&c.run_next_step())},e.run_watched=function(c){var e;c.stopped()&&!c.being_trained?
this.run_unwatched(c):(e=b.path.dereference_path(a,c))?(b.logging&&0<=b.logging.indexOf("event")&&console.log("   "+e+" ("+b.path.toString(a)+" "+(e.to_debug_string?e.to_debug_string(50):e)+" by watched "+c.to_debug_string(50)+" "+c._debug_id+(c.animate_consequences_of_actions()?"":" finishing instantly")),e.wait_until_this_nest_receives_something?(e.wait_until_this_nest_receives_something.run_when_non_empty(function(){c.set_waiting(!1);this.run_watched(c)}.bind(this),c),c.set_waiting(!0),TOONTALK.UTILITIES.visible_element(c.get_context().get_backside_element())||
c.get_frontside().remove()):(d&&(d.running_watched=!0),h(e,c,function(){d||(d={});d.running_watched=!0;g(e,c,d)},d))):b.UTILITIES.display_message("Unable to dereference the path: "+b.path.toString(a)+" in context: "+c.get_context(),{only_if_new:!0})},e.toString=function(e){var f="",g="",h=c,k;if("open the backside"===c||"close the backside"===c)c+=" of";if("click the button of"===c)switch(d.button_selector){case ".toontalk-green-flag":h="click the green flag "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-green-flag-icon'></span>")+
" of";break;case ".toontalk-stop-sign":h="click the stop sign "+b.UTILITIES.encode_HTML_for_title("<span class='toontalk-stop-sign-icon'></span>")+" of";break;case ".toontalk-play-sound-effect-button":h="click the 'Play Sound' button of";break;case ".toontalk-settings-backside-button":h="open the advanced settings of";break;case ".toontalk-show-attributes-chooser-button":h="click the button to add or remove attributes of ";break;case ".toontalk-remove-backside-and-widget-button":h="click the button to remove the back and front of ";
break;default:h="click a button of"}if("add a new widget to the work space"===c)return c.replace("a new widget",b.path.toString(a));if("add to the top-level backside"===c)return"";e||(e={});k=b.path.toString(a,e);if("edit"===c||"drop it on the text area of"===c)f=" ("+d.toString+")";else if("train"===c){f=d.step.toString({person:"third"});if(""===f)return f;f=" to "+f;g="- ";e&&e.robot_being_trained_description&&(k=e.robot_being_trained_description)}else"start training"===c?e&&(e.robot_being_trained_description=
"it"):"stop training"===c&&(k=e.robot_being_trained_description,e.robot_being_trained_description=void 0);if(0<="pick up;edit;remove;copy;change whether erased;pick up a copy of;drop it on the text area of".split(";").indexOf(c)){if(0<=k.indexOf("hole of"))return g+h+" what is in "+k+f;if(0===k.indexOf("a When"))return k=k.substring(3),k=b.UTILITIES.remove_encoded_HTML(k),k=b.UTILITIES.elide(k,80,1),"."===k[k.length-1]&&(k=k.substring(0,k.length-1)),g+h+" a robot who "+k+f+"\n"}return g+h+" "+k+f},
e.get_json=function(e,f,g){var h=function(d,g){b.path.get_json(a,e,function(a,b){f({type:"robot_action",action_name:c,path:a,additional_info:d},b)},g)};d?b.UTILITIES.get_json_of_keys(d,["running_watched"],h,g):h(void 0,g)},e;b.UTILITIES.report_internal_error("No watched function for "+c)}}}(window.TOONTALK);window.TOONTALK.queue=function(b){var k={create:function(){var f=Object.create(this);f.to_run=b.UTILITIES.create_queue();f.run_function=f.run.bind(f);return f},enqueue:function(b){b.running_or_in_run_queue()||(b.set_running_or_in_run_queue(!0),this.to_run.enqueue(b)&&!this.running&&this.run())},maximum_run:50,paused:!1,running:!1,start:function(){this.running||this.to_run.isEmpty()||this.run()},run:function(){var f=Date.now()+k.maximum_run,h;for(this.running=!0;!this.to_run.isEmpty()&&!this.paused&&
Date.now()<f;)h=this.to_run.dequeue(),h.run_actions();this.to_run.isEmpty()?this.running=!1:b.UTILITIES.set_timeout(this.run_function)}};return k}(window.TOONTALK);window.TOONTALK.path=function(b){var k;b.creators_from_json["path.to_entire_context"]=function(f,h){return b.path.to_entire_context()};b.creators_from_json["path.to_self"]=function(f,h){return b.path.to_self()};b.creators_from_json["path.to_thing_in_hand"]=function(){return b.path.to_thing_in_hand()};b.creators_from_json["path.to_widget_on_nest"]=function(){return b.path.to_widget_on_nest()};b.creators_from_json["path.top_level_backside"]=function(){return b.path.top_level_backside};b.creators_from_json["path.to_backside_widget_of_context"]=
function(f,h){return"undefined"===typeof f.backside_index?b.path.get_path_to_backside_widget_of_context(f.type_name,h&&h.robot):b.path.get_path_to_backside_index_of_context(f.backside_index,f.type_name,h&&h.robot)};b.creators_from_json["path.to_resource"]=function(f,h){return b.path.get_path_to_resource(b.UTILITIES.create_from_json(f.resource,h))};return{get_path_to:function(f,h,e){var a=function(a,c){var d=c.get_training_context(),f=c.get_body(),h,k,u;a.is_primary_backside&&a.is_primary_backside()&&
(u=!0,a=a.get_widget());if(d===a)return h=b.path.to_entire_context(),h.is_backside=u,h;if(c===a||c.get_first_in_team()===a)return b.path.to_self();if(c.get_thing_in_hand()===a)return b.path.to_thing_in_hand();k=a.get_type_name();if("top-level"===k)return b.path.top_level_backside;if(h=f.get_path_to(a,c,e))return h.is_backside=u,h;if("element attribute"===k&&a.is_attribute_widget_copy(a))return h=b.element.create_attribute_path(a,c),h.is_backside=u,h;if(b.debugging&&!d)b.UTILITIES.report_internal_error("No context to compute the path");
else{if(d.get_path_to&&(f=d.get_path_to(a,c)))return f.is_backside=u,h=b.path.to_entire_context(),h.next=f,h;d.get_backside_widgets().some(function(d){d=d.get_widget();var e;if(d===a||d.top_contents_is&&d.top_contents_is(a))return c.add_to_backside_conditions(d),h=b.path.get_path_to_backside_widget_of_context(d,c),h.is_backside=u,!0;if(d.get_path_to&&(e=d.get_path_to(a,c)))return e.is_backside=u,c.add_to_backside_conditions(d),h=b.path.get_path_to_backside_widget_of_context(d,c),h.next=e,!0});if(h)return h.is_backside=
u,h;if(d=!a.is_robot()&&a.ancestor_of_type&&a.ancestor_of_type("robot"))return b.robot.find_conditions_path(a,d,c);if(h=b.path.get_path_to_resource(a.dereference().copy()))h.is_backside=u;return h}}(f,h,e);a&&f.dereference_contents&&(b.path.path_end(a).not_to_be_dereferenced=!0);!a||"pick up"!==h.current_action_name&&"remove"!==h.current_action_name||(b.path.path_end(a).removing_widget=!0);return a},path_end:function(b){for(;b.next;)b=b.next;return b},dereference_path:function(b,h,e){var a;b?b.dereference_path?
a=b.dereference_path(h,e):e&&e.dereference_path&&(a=e.dereference_path(b,h)):a=e||h.get_context();return a&&b&&b.is_backside?a.get_backside(!0):a},continue_dereferencing_path:function(b,h,e){void 0===h&&e.context_is_backside()&&(h=e.get_top_level_context());void 0===h&&(h=e.get_context());return b.next?h.dereference_contents&&!b.next.not_to_be_dereferenced?(h=h.dereference_contents(b,e))&&b.is_backside?h.get_backside(!0):h:(h=h.dereference_path(b.next,e))&&b.next.is_backside?h.get_backside(!0):h:
h.dereference_contents&&!b.not_to_be_dereferenced?(h=h.dereference_contents(b,e))&&b.is_backside?h.get_backside(!0):h:h},toString:function(f,h){var e="",a;if(!f)return"undefined path";f.is_backside&&(e="the backside of ");h||(h={});a=h.resource;h.resource=!0;f.next?(b.path.toString(f.next,h),e=e+b.path.toString(f.next,h).trim()+" of "+f.toString(h)):e+=f.toString(h);h.resource=a;return e},get_json:function(f,h,e,a){var d;f.get_json?f.get_json(h,function(a,g){f.is_widget&&(a=f.add_to_json(a,h));f.next&&
(d=function(b){a.next_path=b},b.path.get_json(f.next,h,d,g));f.removing_widget&&(a.removing_widget=!0);f.not_to_be_dereferenced&&(a.not_to_be_dereferenced=!0);if(!0===f.is_backside||f.is_backside&&f.is_backside())a.is_backside=!0;e(a,g)},a):e(f,a)},to_entire_context:function(f){return{dereference_path:function(f,e){return b.path.continue_dereferencing_path(this,e,f)},toString:function(b){return b&&b.robot?b.robot.get_top_level_context_description(b):b&&"third"===b.person?"what he's working on":"what I'm working on"},
get_json:function(b,e,a){e({type:"path.to_entire_context"},a)}}},to_self:function(){return{dereference_path:function(b,h){return b.get_first_in_team()},toString:function(b){return"myself"},get_json:function(b,h,e){h({type:"path.to_self"},e)}}},to_widget_on_nest:function(){return{dereference_path:function(f,h){return b.path.continue_dereferencing_path(this,h,f)},toString:function(){return"what is on the nest"},get_json:function(b,h,e){h({type:"path.to_widget_on_nest"},e)}}},to_thing_in_hand:function(){return{dereference_path:function(f,
h){return b.path.continue_dereferencing_path(this,f.get_thing_in_hand(),f)},toString:function(){return"what I'm holding"},get_json:function(b,h,e){h({type:"path.to_thing_in_hand"},e)}}},get_path_to_resource:function(f){var h;if(f){if(h=f.get_widget())return{dereference_path:function(e){var a=h.copy({copying_resource:!0}),d,c,f;e.add_newly_created_widget(a);e.visible()&&(d=b.UTILITIES.find_resource_equal_to_widget(h,e))&&(a.save_dimensions_of(b.UTILITIES.widget_side_of_element(d)),f=a.get_frontside_element(),
c=$(d).position(),b.UTILITIES.set_timeout(function(){$(f).css({left:c.left,top:c.top,width:$(d).width(),height:$(d).height()})}));return a},toString:function(e){return b.UTILITIES.add_a_or_an(h.toString(e))},get_json:function(e,a,d){h.get_json(b.UTILITIES.fresh_json_history(e),function(b,d){a({type:"path.to_resource",resource:b},d)},d)}}}else console.error("Widget missing in get_path_to_resource.")},get_path_to_backside_widget_of_context:function(f,h){return"string"===typeof f?{dereference_path:function(e){var a=
e.get_context(),d=e.get_backside_widget_of_type(f,a);d||a.get_backside_widgets().some(function(a){if(a.get_widget().is_of_type(f)&&!e.is_newly_created(a.get_widget()))return d=a.get_widget(),!0});if(d)return b.path.continue_dereferencing_path(this,d,e)},toString:function(e){e=(e&&e.robot&&e.robot.get_backside_conditions()?e.robot.get_backside_conditions()[f]:b.UTILITIES.add_a_or_an(f))+" on the back of what I'm working on";return this.removing_widget?"what is on "+e:e},get_json:function(b,a,d){a({type:"path.to_backside_widget_of_context",
type_name:f},d)}}:this.get_path_to_backside_index_of_context(h.get_backside_condition_index(f),f.get_type_name(),h)},get_path_to_backside_index_of_context:function(f,h,e){return{dereference_path:function(a){var d=a.get_backside_matched_widgets()[f],c=function(a,b){var c;b.some(function(b){if(b.get_type_name()===a){if(c)return c=void 0,!0;c=b.dereference()}});return c};d&&d.get_type_name()!==h&&(d=c(h,a.get_backside_matched_widgets()));if(this.next)return b.path.dereference_path(this.next,a,d);if(d)return this.removing_widget&&
((c=d.get_parent_of_frontside())&&c.is_hole()&&(c=c.get_parent_of_frontside()),c&&c.removed_from_container&&"nest"!==h&&a.remove_from_container(d,c)),b.path.continue_dereferencing_path(this,d,a);b.debugging&&console.log("can this happen?")},toString:function(a){var d=(a=(a=e.get_frontside_conditions())&&a.is_top_level())?"work area":"back of what",d=b.UTILITIES.add_a_or_an(h||"thing")+" on the "+d+" I'm working on";return!this.removing_widget||a&&"nest"!==h?d:"what is on "+d},get_json:function(a,
b,c){b({type:"path.to_backside_widget_of_context",type_name:h,backside_index:f},c)}}},process_path_json:function(f,h,e){h.next_path&&(f.next=b.UTILITIES.create_from_json(h.next_path,e));h.removing_widget&&(f.removing_widget=!0);h.not_to_be_dereferenced&&(f.not_to_be_dereferenced=!0);h.is_backside&&(f.is_backside=!0)},top_level_backside:{dereference_path:function(f){if(f=f.get_context().ancestor_of_type&&f.get_context().ancestor_of_type("top-level"))return f;k||(k=b.widget.create_top_level_widget());
return k},toString:function(){return"the top-level backside"},get_json:function(b,h,e){h({type:"path.top_level_backside"},e)}}}}(window.TOONTALK);window.TOONTALK.publish=function(b){var k=function(b,h,e){var a='<!DOCTYPE html>\n<html>\n<head>\n<script src="https://toontalk.github.io/ToonTalk/toontalk.js?published=1">\x3c/script>\n<title>\n'+b+"</title>\n</head>\n<body>\n";h.forEach(function(b,c){a+='<div class="toontalk-edit" contenteditable="true">\n'+b+"\n</div>\n";e[c]&&(a+=e[c])});return a+="</body>\n</html>\n"};return{publish_widget:function(f,h,e,a){var d=b.google_drive.get_status(),c=["Edit this. Select text for formatting."],g=function(d){(d=
d&&d.items&&0<d.items.length&&d.items[0])?a(d,v):(d=k(f,c,v),b.google_drive.upload_file(m,"html",d,a))},m,v;"Ready"===d?(m=h.get_setting("program_name"),e?b.UTILITIES.get_json_top_level(h,function(a){h.set_setting("program_name",m+" (published version)");v=[b.UTILITIES.toontalk_json_div(a,h)];h.set_setting("program_name",m)}):(e=h.get_backside_widgets(),v=[],e.forEach(function(a,d){a.visible()&&b.UTILITIES.get_json_top_level(a,function(d){d.view&&(d.view.saved_width=void 0,d.view.saved_height=void 0);
v.push(b.UTILITIES.toontalk_json_div(d,a.get_widget()));c.push("")})})),b.google_drive.get_toontalk_files(b.google_drive.full_file_name(m,"page"),"page",g)):(console.log("Unable to publish to Google Drive because: "+d),a(null))},republish:function(f){b.google_drive.insert_or_update_file(void 0,f.file_id,"page",k(f.title,f.editable_contents,f.widgets_json),function(){console.log("Published page '"+f.title+"' updated.")})}}}(window.TOONTALK);function handle_client_load(){window.TOONTALK?window.TOONTALK.google_drive.handle_client_load():setTimeout(handle_client_load,1E3)}
window.TOONTALK.google_drive=function(b){var k=b.GOOGLE_DRIVE_CLIENT_ID||"148386604750-704q35l4gcffpj2nn3p4ivcopl81nm27.apps.googleusercontent.com",f=b.ORIGIN_FOR_GOOGLE_DRIVE||"toontalk.github.io",h="Need to authorize",e,a;return{handle_client_load:function(a){0>window.location.href.indexOf(f)?(h="Connections to Google Drive are configured for the following domain only: "+f+".\nIf you are hosting ToonTalk elsewhere you need to set TOONTALK.GOOGLE_DRIVE_CLIENT_ID and TOONTALK.ORIGIN_FOR_GOOGLE_DRIVE",
a?a(h):console.log(h)):setTimeout(function(){b.google_drive.check_authorization(a)})},check_authorization:function(a){h="Awaiting authorization";gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!0},function(c){b.google_drive.handle_authorization_result(c,a)})},handle_authorization_result:function(a,c){a&&!a.error?(h="Authorized but not yet ready",gapi.client.load("drive","v2",function(){b.google_drive.get_folder_ids(function(){h="Ready";"undefined"!==typeof CKEDITOR&&
$(".toontalk-edit").each(function(a,c){CKEDITOR.inline(c);b.UTILITIES.can_receive_drops(c)})})}),c&&c()):(h="Need to authorize",c&&c(h))},authorize:function(a){gapi.auth.authorize({client_id:k,scope:"https://www.googleapis.com/auth/drive",immediate:!1},function(c){b.google_drive.handle_authorization_result(c,a)})},get_folder_ids:function(d){b.google_drive.get_folder_id(!0,function(c){e=c;b.google_drive.get_folder_id(!1,function(b){a=b;d()})})},get_folder_id:function(d,c){var f=d?"ToonTalk Programs":
"ToonTalk Pages",h=function(a){var e=function(a){a&&a.id?c(a.id):(console.error("Failure to create folder '"+f+"'. Response follows."),console.error(a))};(a=a&&a.items&&0<a.items.length&&a.items[0].id)?c(a):d?b.google_drive.create_folder("ToonTalk Programs",!1,e):b.google_drive.create_folder("ToonTalk Pages",!0,e)};d&&e?c(e):!d&&a?c(a):b.google_drive.fetch_folder_id(f,h)},get_status:function(){return h},connection_to_google_drive_possible:function(){return 0!==h.indexOf("Connections to Google Drive are configured for the following domain only: ")&&
!b.CHROME_APP},list_files:function(a,b){gapi.client.request({path:"/drive/v2/files",method:"GET",params:a}).execute(b)},fetch_folder_id:function(a,c){b.google_drive.list_files({q:"mimeType = 'application/vnd.google-apps.folder' and title ='"+a+"' and trashed = false"},c)},get_toontalk_files:function(a,c,e){"undefined"===typeof gapi?e("Google Drive API not available."):(c="properties has {key='ToonTalkType' and value='"+c+"' and visibility='PUBLIC'} and trashed = false",a&&(c+=" and title='"+a+"'"),
b.google_drive.list_files({q:c},e))},get_toontalk_program_file:function(a,c){b.google_drive.list_files({q:"'"+e+"' in parents and trashed = false and title='"+a+"'"},function(a){a&&a.items&&0<a.items.length?c(a.items[0]):c(null)})},upload_file:function(a,c,e,f){var d="json"===c?"program":"page",g=a+"."+c;b.google_drive.get_toontalk_files(g,d,function(a){gapi.client.load("drive","v2",function(){var c=a&&a.items&&0<a.items.length&&a.items[0].id;f||(f=function(a){a.error?(console.log("Google drive status: "+
b.google_drive.get_status()),"Login Required"!==a.error.message&&console.log(a.error.message)):b.debugging&&console.log("File "+a.title+" ("+a.id+") "+(c?"updated":"created"))});c?b.google_drive.insert_or_update_file(void 0,c,d,e,f):b.google_drive.insert_or_update_file(g,void 0,d,e,f)})})},full_file_name:function(a,b){return a+"."+("program"===b?"json":"html")},insert_or_update_file:function(d,c,f,h,k){var g={title:d,mimeType:"text/html"},m;g.parents=[{kind:"drive#fileLink",id:"program"===f?e:a}];
h="\r\n---------314159265358979323846\r\nContent-Type: application/json\r\n\r\n"+JSON.stringify(g)+"\r\n---------314159265358979323846\r\nContent-Type: text/html\r\n\r\n"+h+"\r\n---------314159265358979323846--";d?(g="/upload/drive/v2/files",m="POST"):(g="/upload/drive/v2/files/"+c,m="PUT");gapi.client.request({path:g,method:m,params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="-------314159265358979323846"'},body:h}).execute(function(a){c||b.google_drive.insert_property(a.id,
"ToonTalkType",f,"PUBLIC");a.error?console.log("Unable to access file "+(d||c)+" due to error: "+a.error.message):k&&k(a)})},create_folder:function(a,b,e){gapi.client.drive.files.insert({resource:{title:a,mimeType:"application/vnd.google-apps.folder"}}).execute(b?function(a){gapi.client.drive.permissions.insert({fileId:a.id,resource:{value:"",type:"anyone",role:"reader"}}).execute(function(b){e(a)})}:e)},download_file:function(a,c){if(a.downloadUrl){var d=gapi.auth.getToken().access_token;b.UTILITIES.download_file(a.downloadUrl,
c,d)}else c(null)},google_drive_url:function(a,c){var d;return"function"===typeof b.cross_origin_url_function?(d=b.cross_origin_url_function("https://drive.google.com/uc?id="+a),b.TOONTALK_URL+"published.html"+window.location.search+(window.location.search?"&":"?")+"replace-with-url="+encodeURIComponent(d)):"https://drive.google.com/uc?export=download&id="+a},insert_property:function(a,b,e,f){gapi.client.drive.properties.insert({fileId:a,resource:{key:b,value:e,visibility:f}}).execute(function(a){})}}}(window.TOONTALK);function googleTranslateElementInit(){window.TOONTALK.translate_element=new google.translate.TranslateElement({pageLanguage:"en",layout:google.translate.TranslateElement.InlineLayout.SIMPLE},"google_translate_element")}
window.TOONTALK.UTILITIES=function(b){var k={},f=!1,h=100,e=(new Date).getTime(),a=[],d=[],c,g=[],m=new MutationObserver(function(a){a.forEach(function(a){var b,c;for(b=0;b<a.addedNodes.length;b++){c=a.addedNodes.item(b);if(1===c.nodeType){if(!c.toontalk_widget_side&&$(c).is(".toontalk-side")){$(c).remove();break}setTimeout(function(){!c.toontalk_attached_callback||$(c).is(".toontalk-not-observable")&&!c.toontalk_run_even_if_not_observable||($(c).removeClass("toontalk-has-attached-callback"),c.toontalk_attached_callback(),
c.toontalk_attached_callback=void 0,c.toontalk_run_even_if_not_observable=void 0);$(c).find(".toontalk-has-attached-callback").each(function(a,b){$(b).removeClass("toontalk-has-attached-callback");b.toontalk_attached_callback&&(b.toontalk_attached_callback(),b.toontalk_attached_callback=void 0)})})}$(c.parentElement).is(".toontalk-frontside")?$(c).css({"z-index":""}):$(c.parentElement).is(".toontalk-backside")&&$(c).css({"z-index":k.next_z_index()})}})}),v=function(){var a=new MutationObserver(function(a){a.forEach(function(a){(a=
$(a.target).closest(".toontalk-translation-element").get(0))&&a.toontalk_callback&&(a.toontalk_callback(a.innerText),a.innerText="",a.toontalk_callback=void 0)})}),c,d;$("a").each(function(a,b){b.href=k.add_URL_parameter(b.href,"translate","1")});$("#google_translate_element").is("*")||(c=document.createElement("div"),c.id="google_translate_element",document.body.insertBefore(c,document.body.firstChild));document.head.appendChild($('<meta name="google-translate-customization" content="7e20c0dc38d147d6-a2c819007bfac9d1-gc84ee27cc12fd5d1-1b"></meta>')[0]);
b.CHROME_APP||Q("https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit");d=document.createElement("div");d.className="toontalk-translation-element";document.body.appendChild(d);a.observe(d,{characterData:!0,subtree:!0});k.translate=function(a,b){d.innerHTML=a;d.toontalk_callback=b}},l=function(a,b,c){var d;if(a){d=a[b]||0;a[c]&&(d/=a[c]);for(a=a.parentElement;a;)d+=a[b]||0,a[c]&&(d/=a[c]),a=a.parentElement;return d}},u=function(a,c){b.debugging+="\n"+a;console.log(a);c&&
(alert(b.debugging),b.debugging="touch")},q=function(a){var b=a.indexOf("<div style='display:none;'>{"),b=0>b?a.indexOf("{"):b+27,c=a.lastIndexOf("}");if(!(0>b||0>c))return a.substring(b,c+1)},t=function(a,c){if(!$(c).is(".toontalk-conditions-contents")){var d=$(c).closest(".toontalk-side"),e=k.get_mouse_or_first_touch_event_attribute("clientX",a),f=k.get_mouse_or_first_touch_event_attribute("clientY",a),g,h,p,w;$(".ui-tooltip").remove();$(".ui-tooltip").removeClass("toontalk-side-animating");if(!(a.dataTransfer&&
a.dataTransfer.getData("text")&&0<a.dataTransfer.getData("text").length&&0!=a.dataTransfer.getData("text").indexOf("data:"))){M=d||$(c);p=k.widget_side_of_jquery(M);if(!p){p=k.widget_side_of_element(c);k.report_internal_error("Possible bug that "+M+" doesn't have a known owner.");if(!p){k.report_internal_error("The element doesn't have an owner either.");return}M=$(c)}p=p.get_selection();M=$(p.get_element());k.get_dragee_copy()&&k.get_dragee_copy().render();p.set_stopped&&p.set_stopped(!0);!p.save_dimensions||
p.get_parent_of_frontside()&&!p.get_parent_of_frontside().get_widget().is_top_level()||p.save_dimensions();p.being_dragged=!0;g=M.get(0).getBoundingClientRect();w=M.is(".toontalk-top-level-resource");$(c).removeClass("toontalk-wiggle");p.get_json&&(d=function(b){b.view.drag_x_offset=e-g.left;b.view.drag_y_offset=f-g.top;!b.view.frontside_width&&M.parent().is(".toontalk-backside")&&(b.view.frontside_width=M.width(),b.view.frontside_height=M.height());M.data("json",b);a.dataTransfer&&(h=k.toontalk_json_div(b,
p),a.dataTransfer.effectAllowed=w?"copy":"move",a.dataTransfer.setData("text",h),k.is_internet_explorer()||a.dataTransfer.setData("text/html",h));p.drag_started&&p.drag_started(b,w)},a.dataTransfer&&a.dataTransfer.setData("text","Sorry, it took too long to generate the data structure needed to reconstruct "+p+"."),b.UTILITIES.get_json_top_level(p,d,6E5));M.addClass("toontalk-being-dragged");(d=p.get_listeners("picked up"))&&d.map(function(a){a()});a.stopPropagation()}}},n=function(a,b){var c;if(!$(b).is(".toontalk-conditions-contents")){M||
(M=$(a.target).closest(".toontalk-side"));if(c=k.widget_side_of_jquery(M))c.being_dragged=void 0,(c=c.get_listeners("dropped"))&&c.map(function(a){a()});M.is(".toontalk-frontside")&&(M.parent().is(".toontalk-backside")?(c=M.data("json"))&&k.set_css(M,{width:c.view.frontside_width,height:c.view.frontside_height}):M.parent().is(".toontalk-top-level-resource, .toontalk-drop-area, .toontalk-json")||M.is(".toontalk-carried-by-bird, .toontalk-element-attribute, .toontalk-function-bird-documentation-bird")||
k.has_animating_image(M.get(0))||k.set_css(M,{width:"100%",height:"100%"}));H();a.stopPropagation()}},r=function(a){if(M)return k.widget_side_of_jquery(M);if(a)return a=k.data_transfer_json_object(a),k.create_from_json(a)},z=function(a,c){var d=k.data_transfer_json_object(a),e=function(a,d){var e=k.create_from_json(a),f=document.createElement("div"),g=e.get_element(!0),h=$(c).closest(".toontalk-edit"),p=b.published_support.create_editable_text();$(f).addClass("toontalk-json toontalk-top-level-resource toontalk-top-level-resource-container");
$(g).addClass("toontalk-top-level-resource").css({position:"relative",width:e.saved_width,height:e.saved_height});g.toontalk_widget_side=e;f.toontalk_widget_side=e;f.appendChild(g);$(f).insertAfter(h);$(p).insertAfter(f);CKEDITOR.inline(p);k.can_receive_drops(p);e.set_visible(!0);e.render()},f=function(){var a;g.hide();a=document.elementFromPoint(q-window.pageXOffset-b.USABILITY_DRAG_OFFSET.x,r-window.pageYOffset-b.USABILITY_DRAG_OFFSET.y);g.show();if(a)return $(a).closest(".toontalk-side")},g,h,
p,w,l,m,n,q,r;void 0===d&&M&&(d=M.data("json"));M&&M.data("json","");g=M;H();if(g||void 0!==d||a.dataTransfer.files||S(a)){if($(a.target).is(".toontalk-drop-area-instructions"))e=$(a.target).parent();else if($(a.target).is(".toontalk-element-attribute-input")){if(e=$(a.target).closest(".toontalk-side"),p=k.widget_side_of_jquery(e)){h=g?k.widget_side_of_jquery(g):k.create_from_json(d);k.restore_resource(g,h);p.dropped_on_style_attribute(h,a.target.name,a);a.stopPropagation();return}}else if($(a.target).is(".toontalk-drop-area"))e=
$(a.target);else{if(d&&$(a.currentTarget).is(".toontalk-edit")){e(d,a);return}g&&g.is(".toontalk-backside")?e=$(a.target).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):(e=$(a.target).closest(".toontalk-side"),0<e.length&&g&&D(e.get(0),g.get(0))&&(e=g.parent().closest(".toontalk-side")))}if(0!==e.length){q=k.get_mouse_or_first_touch_event_attribute("pageX",a);r=k.get_mouse_or_first_touch_event_attribute("pageY",a);if(e.is(".toontalk-top-level-resource"))if("touchend"===
a.type){e=$(".toontalk-highlight");if(0===e.length||e.get(0)===g.get(0))e=f();if(!e||0===e.length)return}else return;l=e.offset();p=k.widget_side_of_jquery(e);if(g&&0<g.length&&!(p&&p.get_widget().get_infinite_stack&&p.get_widget().get_infinite_stack())&&(g.get(0)===e.get(0)||jQuery.contains(g.get(0),e.get(0)))){if(g.is(".toontalk-backside-of-top-level"))return;e=$(".toontalk-highlight");if(0===e.length||e.get(0)===g.get(0))e=f();if(!e||0===e.length)return;l=e.offset();f=k.widget_side_of_jquery(e);
if(!p||p.is_backside()&&f.is_backside()||!p.is_backside()&&!f.is_backside())p=f}k.remove_highlight();d&&d.view&&d.view.drag_x_offset?(f=d.view.drag_x_offset,w=d.view.drag_y_offset):w=f=0;if(g&&0<g.length){if(!(p&&p.get_widget().get_infinite_stack&&p.get_widget().get_infinite_stack()||g.get(0)!==e.get(0)&&!jQuery.contains(g.get(0),e.get(0)))){k.set_css(g,{left:g.get(0).offsetLeft+(a.layerX-f),top:g.get(0).offsetTop+(a.layerY-w)});a.stopPropagation();return}h=k.widget_side_of_jquery(g);g.parent().is(".toontalk-drop-area")?
(g.removeClass("toontalk-widget-in-drop_area"),g.parent().data("drop_area_owner").set_next_robot(void 0)):((n=h&&h.get_parent())?(m=$(n.get_element()),!h.is_backside()&&h.get_widget().get_infinite_stack&&h.get_widget().get_infinite_stack()?(m=h.get_widget().saved_width,n=h.get_widget().saved_height,h=k.get_dragee_copy(),h.get_widget().saved_width=m,h.get_widget().saved_height=n,m=g.width(),n=g.height(),g=$(h.get_element(!0)),e.is(".toontalk-backside")&&k.set_css(g,{width:d.view.frontside_width||m,
height:d.view.frontside_height||n}),h.update_display()):n.removed_from_container&&(m.is(".toontalk-backside")?n.remove_backside_widget(h,!0):(n.removed_from_container(h,a),h.restore_dimensions&&!n.is_empty_hole()&&h.restore_dimensions()))):k.restore_resource(g,h),h&&h.robot_in_training()&&h.robot_in_training().add_newly_created_widget_if_new(h))}else{if(d)h=k.create_from_json(d,{event:a});else{if(0<a.dataTransfer.files.length){for(d=0;d<a.dataTransfer.files.length;d++)J(a.dataTransfer.files[d],e,
p,l,a);a.stopPropagation();return}if(S(a)){O(a.dataTransfer.getData("URL"),e,p,l,a);a.stopPropagation();return}}if(!h){d?k.report_internal_error("Unable to construct a ToonTalk widget from the JSON."):b.debugging&&console.log("No data transfer in drop.");a.stopPropagation();return}h.robot_in_training()&&h.robot_in_training().drop_from_data_transfer(h);g=$(h.get_element(!0));h.is_primary_backside&&h.is_primary_backside()&&(k.set_css(g,{width:d.view.backside_width,height:d.view.backside_height,"background-color":d.view.background_color,
"border-width":d.view.border_width}),h.apply_backside_geometry())}p&&h&&!h.is_backside()&&h.get_widget()===p.get_widget()||h&&y(e,g,h,p,l,a,d,f,w)}}else a.dataTransfer?k.report_internal_error("Drop failed since unable to parse as JSON."):k.report_internal_error("Drop failed since there is no event.dataTransfer"),a.stopPropagation()},C=function(a,b){a.addEventListener("drop",function(a){var c=r(a);k.restore_resource(k.get_$dragee(),c);b(a)});k.can_receive_drops(a)},A=function(a,b){var c;c=k.get_$dragee();
var d;d=c&&c.is(".toontalk-backside")?$(b).closest(".toontalk-backside, .toontalk-bird, .toontalk-nest, .toontalk-box"):$(b).closest(".toontalk-side");$(b).is(".toontalk-drop-area")&&c.is(".toontalk-robot")?($(b).addClass("toontalk-highlight"),c=void 0):($(b).is(".toontalk-box-size-input")||$(b).is(".toontalk-numerator-input")||$(b).is(".toontalk-denominator-input"))&&c.is(".toontalk-number")?($(b).addClass("toontalk-highlight"),c=void 0):c=!d.is("*")||d.is(".toontalk-backside-of-top-level")||d.closest(".toontalk-top-level-resource").is("*")||
d.is(".toontalk-being-dragged")||c&&D(d.get(0),c.get(0))?void 0:d;if(c)return k.highlight_element(c.get(0),a),c.get(0)},y=function(a,c,d,e,f,g,h,l,m){var p=k.get_mouse_or_first_touch_event_attribute("pageX",g),w=k.get_mouse_or_first_touch_event_attribute("pageY",g),E,n,K,B;l||(l=0);m||(m=0);d.set_visible(!0);h&&h.semantic&&h.semantic.running&&k.set_timeout(function(){d.set_running(!0)},100);if(a.is(".toontalk-backside")){if(d.get_widget().is_top_level()){E=h.semantic.backside_widgets;n=h.shared_widgets;
K=a.get(0);(l=e.robot_in_training())&&l.drop_from_data_transfer(d,e);l=d.get_backside_widgets().slice();b.UTILITIES.for_each_batch(l,function(a,b){var c=a.get_widget(),f,g,h,p,w,l,m;d.remove_backside_widget(a);f=0<=E[b].widget.shared_widget_index?n[E[b].widget.shared_widget_index].view:E[b].widget.view;g=a.get_element(!0);a.is_backside()?(h=f.backside_left,p=f.backside_top,w=f.backside_width,l=f.backside_height):(h=f.frontside_left,p=f.frontside_top,w=f.frontside_width,l=f.frontside_height);e.add_backside_widget(a);
K.appendChild(g);m=$(g).position();B={left:m.left+h,top:m.top+p};a.is_resizable()&&(B.width=w,B.height=l);k.constrain_css_to_fit_inside(K,B);k.set_css(g,B);d.set_location_attributes&&c.set_location_attributes(B.left,B.top);a.is_backside()&&(c.backside_geometry=f.backside_geometry,c.apply_backside_geometry())}.bind(this));e.top_level_widget().backup_all();return}if(!e){k.report_internal_error("No target_widget");return}d?e.widget_side_dropped_on_me(d,{event:g}):k.report_internal_error("No source_widget");
g=p-(f.left+(l||0));a=w-(f.top+(m||0));B={left:k.left_as_percent(g,c.get(0)),top:k.top_as_percent(a,c.get(0))};k.set_css(c,B);!d.is_backside()&&d.set_location_attributes&&d.set_location_attributes(g,a);h&&h.semantic&&h.semantic.running&&!k.get_$dragee()&&d.set_running(!0)}else if(a.is(".toontalk-drop-area"))c.addClass("toontalk-widget-in-drop_area"),0<a.length&&a.get(0).appendChild(c.get(0)),c.is(".toontalk-robot")&&a.data("drop_area_owner").set_next_robot(k.widget_side_of_jquery(c));else{if(c.is(".toontalk-backside-of-top-level"))return;
if(e||g.changedTouches){K=a.closest(".toontalk-backside-of-top-level").get(0);!K&&g.changedTouches&&(h=document.elementFromPoint(p-window.pageXOffset,w-window.pageYOffset),(K=$(h).is(".toontalk-backside-of-top-level")?h:$(h).closest(".toontalk-backside-of-top-level").get(0))||(K=$(".toontalk-backside-of-top-level").get(0)),e=k.widget_side_of_element(K).get_backside());if(!K)return;K.appendChild(c.get(0));h=$(K).offset();B={left:p-(h.left+l+b.USABILITY_DRAG_OFFSET.x),top:w-(h.top+m+b.USABILITY_DRAG_OFFSET.y)};
k.set_css(c,B);d.remove_from_parent_of_frontside&&d.remove_from_parent_of_frontside(g);d.set_visible(!0);d.drop_on&&d.drop_on(e,{event:g})||e.widget_side_dropped_on_me&&e.widget_side_dropped_on_me(d,{event:g})||(c=a.closest(".toontalk-backside-of-top-level"),0<c.length&&(e=k.widget_side_of_jquery(c))&&e.widget_side_dropped_on_me(d,{event:g}))}else{console.log("Warning: when handling a drop event the target widget was missing.");return}}b.logging&&0<=b.logging.indexOf("drop")&&(console.log("Drop of "+
d._debug_id+" on "+e._debug_id),console.log("Left: "+B.left+"; top: "+B.top+"; page_x: "+p+"; page_y: "+w+"; drag_x_offset: "+l+"; drag_y_offset: "+m));k.remove_highlight()},J=function(a,c,d,e,f){var g=new FileReader,h=0===a.type.indexOf("image"),p=0===a.type.indexOf("audio"),w=0===a.type.indexOf("video"),l,m,E;g.onloadend=function(){var n;if(h)l=b.element.create("<img src='"+g.result+"' class = 'toontalk-image' alt='"+a.name+"'/>");else if(p)l=b.element.create(a.name+" sound"),n=new Audio(g.result),
n.addEventListener("event",function(a){k.display_message("Error trying to play a sound: "+a.message)}),l.set_sound_effect(n);else if(w)l=b.element.create("<video src='"+g.result+"' alt='"+a.name+"'/>");else{if(m=q(g.result))try{(E=k.parse_json(m))&&(l=k.create_from_json(E))}catch(Va){}l||(l=b.element.create(g.result))}l&&l.robot_in_training()&&l.robot_in_training().drop_from_data_transfer(l,d);y(c,$(l.get_frontside_element(!0)),l,d,e,f,E)};h||p||w?g.readAsDataURL(a):g.readAsText(a)},O=function(a,
c,d,e,f){var g,h=function(a,c,e,f){var h=function(a){a&&(a&&a.robot_in_training()&&a.robot_in_training().drop_from_data_transfer(a,d),y(c,$(a.get_frontside_element(!0)),a,d,e,f))};k.create_widget_from_URL(a,h,function(c){var d=f.dataTransfer.getData("text/html")||f.dataTransfer.getData("text");d?(g=d,h(b.element.create(d))):(d=g?b.element.create("<div class='toontalk-iframe-container'><iframe srcdoc='"+g+"' width='480' height='320'></iframe></div>"):b.element.create("<div class='toontalk-iframe-container'><iframe src='"+
a+"' width='480' height='480'></iframe></div>"),h(d),console.log("Error loading URL. Loading it in an iframe instead. URL is "+a),console.log(c))})};a.split(/\r?\n/).forEach(function(a){"#"!==a[0]&&h(a,c,e,f)})},G=function(a,b){var c=$("<div class='"+a+"'>");k.run_when_dimensions_known(c.get(0),function(){var a=c.width(),d=c.height();b.get_default_width=function(){return a};b.get_default_height=function(){return d}})},R=function(){var a=k.get_path_to_toontalk_folder()+"sounds/",c=function(b){b=new Audio(a+
b);b.volume=k.get_audio_volume(b);return b};try{b.sounds={hatching:c("SPARROW.mp3"),bird_fly:c("PIGEON.mp3"),bammer_hammer:c("POP.mp3"),vacuum_spit:c("SPIT.mp3"),vacuum_suck:c("DUSTBUST.mp3"),drop:c("BOOK_DROP.mp3"),magic:c("MAGIC.mp3"),fall_inside:c("FALL_INSIDE.mp3"),click:c("TYPE.mp3"),event_ignored:c("PLOP.mp3")},b.sounds.bird_fly.loop=!0}catch(E){}},Q=function(a){var b=document.createElement("script");b.src=a;document.body.appendChild(b)},H=function(){M&&(M.removeClass("toontalk-being-dragged"),
k.set_timeout(function(){ea=ca=M=void 0}))},D=function(a,b){if(a===b)return!0;if(a.parentNode)return D(a.parentNode,b)},L=function(a,b){var c=0,d=encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"),e=encodeURIComponent("decodeURIComponent</span>"),f=a.indexOf(d),g="",h,p;if(0>f)return a;for(;0<=f;){h=f+d.length;p=a.indexOf(e,h);if(0>p)return k.report_internal_error("Expected title to have matching pairs of "+d+" and "+e),a;g+=a.substring(c,f)+b(a.substring(h,p));c=p+
e.length;f=a.indexOf(d,c)}return g+=a.substring(c)},S=function(a){return(a=a.dataTransfer&&a.dataTransfer.getData("URL"))&&0<a.length&&0>a.indexOf("data:")},I=function(a){var c=k.get_current_url_parameter("replace-with-url");if(c){var d=decodeURIComponent(c);k.download_file(d,function(c){var e;if(c)if(e=P(c,"body")){if(c=P(c,"title",!0))document.title=c;c=document.createElement("div");c.innerHTML=e;document.body.appendChild(c);a();0<=d.indexOf("drive.google.com")&&b.google_drive.connection_to_google_drive_possible()&&
(e=decodeURIComponent(d),e=e.substring(e.lastIndexOf("id=")+3),$(".toontalk-edit").attr("contenteditable",!0),b.published_support&&b.published_support.send_edit_updates(e))}else k.display_message("Expected contents of "+d+" to contain a body element.");else k.display_message("Unable to read contents of "+d)},"object"==typeof gapi&&gapi.auth&&gapi.auth.getToken()&&gapi.auth.getToken().access_token)}else k.display_message("Expected a url=... parameter in the URL.")},P=function(a,b,c){var d=a.indexOf("<"+
b),e;if(!(0>d||(e=a.indexOf("</"+b+">"),0>e)))return c?a.substring(d+2+b.length,e):a.substring(d,e+3+b.length)},U=!1,W=[],V=[],M,ca,ea,aa,ha;window.addEventListener("message",function(a){"zero-timeout-message"===a.data&&a.source===window&&(a.stopPropagation(),0<W.length&&W.shift()())},!1);m.observe(window.document,{childList:!0,subtree:!0});k.available_types="number box element robot nest sensor top-level".split(" ");k.create_from_json=function(a,c,d,e){var f=function(a,b,c){(b.shared_widgets[c]=
a)&&a.finish_create_from_json_continuation&&(a.finish_create_from_json_continuation(),a.finish_create_from_json_continuation=void 0);return a},g,h,p,l,w;if(a){c||(c={});c.guid_to_nest_table||(c.guid_to_nest_table={});a.shared_widgets&&(c.json_of_shared_widgets=a.shared_widgets,c.shared_widgets=[]);a.shared_html&&(a.shared_html=a.shared_html.map(function(a){return Array.isArray(a)?a.join(""):a}),c.shared_html=a.shared_html);if(a.widget)return(g=k.create_from_json(a.widget,c))&&a.is_backside?g.get_backside(!0):
g;if(c&&c.shared_widgets&&0<=a.shared_widget_index){if(d=c.shared_widgets[a.shared_widget_index])return d;d=c.json_of_shared_widgets[a.shared_widget_index];g=b.creators_from_json[d.semantic.type]();c.shared_widgets[a.shared_widget_index]=g;g=k.create_from_json(d,c,g,!0);return f(g,c,a.shared_widget_index)}(p=a.semantic)||(p=a);l=a.view;if(0<=p.shared_widget_index){if(!c.json_of_shared_widgets){k.report_internal_error("JSON refers to shared widgets but they can't be found. Sorry.");return}g=k.create_from_json(c.json_of_shared_widgets[p.shared_widget_index],
c,d,!0);return f(g,c,p.shared_widget_index)}if(p.type){if(b.creators_from_json[p.type]){c||(c={});l?c.json_view=l:l=c.json_view;if(b.debugging)g=b.creators_from_json[p.type](p,c,d);else try{g=b.creators_from_json[p.type](p,c,d)}catch(xa){console.error(xa.stack),k.report_internal_error("Unable to recreate a "+p.type+". Error is "+xa+". JSON is "+JSON.stringify(a,k.clean_json,"  "))}g&&!g.is_widget&&b.path.process_path_json(g,a,c);if(g&&g.get_backside){p.erased&&(b.widget.erasable(g),g.set_erased(p.erased));
p.infinite_stack&&g.set_infinite_stack(p.infinite_stack);p.open_backside_only_if_stopped&&g.set_open_backside_only_if_stopped(!0);if(l){if(l.frontside_width)if(h=g.get_element()){if(g.ok_to_set_dimensions())if(w={width:l.frontside_width,height:l.frontside_height},"element"===p.type)g.on_update_display(function(){k.set_css(h,w)});else k.set_css(h,w)}else!l.saved_width&&g.is_resizable()&&(g.saved_width=l.frontside_width,g.saved_height=l.frontside_height);l.saved_width&&g.is_resizable()&&(g.saved_width=
l.saved_width,g.saved_height=l.saved_height);l.backside_geometry&&(g.backside_geometry=l.backside_geometry);g.json_view=l}p.backside_widgets&&(e?g.finish_create_from_json_continuation=function(){this.add_backside_widgets_from_json(g,p.backside_widgets,c)}.bind(this):this.add_backside_widgets_from_json(g,p.backside_widgets,c))}return g}k.report_internal_error("JSON type '"+p.type+"' not supported. Perhaps a JavaScript file implementing it is missing.")}else b.UTILITIES.report_internal_error("No type attribute given in "+
JSON.stringify(p,k.clean_json,"  "))}};k.add_backside_widgets_from_json=function(a,b,c){var d;b&&(d=this.create_array_from_json(b,c),a.set_backside_widgets(d,b.map(function(a){return a&&a.widget?0<=a.widget.shared_widget_index&&c.json_of_shared_widgets[a.widget.shared_widget_index]?c.json_of_shared_widgets[a.widget.shared_widget_index].view:a.widget.view:a})))};k.create_array_from_json=function(a,b){var c=[];a.forEach(function(a,d){c[d]=a?k.create_from_json(a,b):a});return c};k.get_json_of_array=
function(a,b,c,d,e,f){var g,h;c>=a.length?e():(g=a[c])?g.is_primary_backside&&g.is_primary_backside()?(h=function(f,g){b.push({widget:f,is_backside:!0});this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),k.get_json(g.get_widget(),d,h,f)):g.is_widget?(h=function(g,h){b.push({widget:g});0===c%100&&(!k.maximum_json_generation_duration||Date.now()-f>k.maximum_json_generation_duration)?k.set_timeout(function(){this.get_json_of_array(a,b,c+1,d,e,h)}.bind(this)):this.get_json_of_array(a,b,c+1,d,e,h)}.bind(this),
k.get_json(g,d,h,f)):(h=function(f,g){b.push(f);this.get_json_of_array(a,b,c+1,d,e,g)}.bind(this),g.get_json(d,h,f)):k.get_json_of_array(a,b,c+1,d,e,f)};k.fresh_json_history=function(a){var b={widgets_encountered:[],shared_widgets:[],json_of_widgets_encountered:[]};a&&a.shared_html&&(b.shared_html=a.shared_html);return b};k.get_json_top_level=function(a,b,c){var d=this.fresh_json_history();k.maximum_json_generation_duration=c;k.get_json(a,d,function(c){var e=function(a){a=d.widgets_encountered.indexOf(a);
return d.json_of_widgets_encountered[a]},f=function(a){return e(d.shared_widgets[a])},g=d.shared_widgets.map(e),h;0<d.shared_widgets.length&&c.semantic&&(g=d.shared_widgets.map(e),c.shared_widgets=d.shared_widgets.map(function(b,c){var d=e(b);return a===b?{semantic:d.semantic,view:d.view,version:d.version}:d}),h=d.shared_widgets.slice().sort(function(a,b){return a.is_nest()?-1:b.is_nest()?1:a.has_ancestor_either_side(b)?-1:b.has_ancestor_either_side(a)?1:0}),h.map(function(a){a=d.shared_widgets.indexOf(a);
k.tree_replace_once(c.semantic,g[a],{shared_widget_index:a},f,k.generate_unique_number())}),a===h[h.length-1]&&(c.semantic={shared_widget_index:d.shared_widgets.indexOf(a)}));c.shared_html=d.shared_html;b(c)},Date.now())};k.get_json=function(a,c,d,e){var f,g;if(b.debugging&&!c)k.report_internal_error("no json_history");else if(f=c.shared_widgets.indexOf(a),0<=f)d({shared_widget_index:f},e);else if(f=c.widgets_encountered.indexOf(a),0<=f)f=c.shared_widgets.push(a)-1,d({shared_widget_index:f},e);else if(f=
c.widgets_encountered.push(a)-1,a.is_primary_backside&&a.is_primary_backside()&&(a=a.get_widget()),g=function(b,e){a.add_to_json&&(b=a.add_to_json(b,c));c.json_of_widgets_encountered[f]=b;a.add_backside_widgets_to_json?a.add_backside_widgets_to_json(b,c,function(){d(b,e)},e):d(b,e)},Date.now()-e<=k.maximum_json_generation_duration)try{a.get_json(c,g,e)}catch(ja){k.is_stack_overflow(ja)?setTimeout(function(){a.get_json(c,g,Date.now())}):k.display_message("Failed to save your project due to error: "+
ja.message,{only_if_new:!0})}else setTimeout(function(){a.get_json(c,g,Date.now())})};k.get_json_of_keys=function(a,c,d,e){var f;c||(c=[]);Object.keys(a).forEach(function(d){0>c.indexOf(d)&&(f||(f={}),a[d].get_json?b.path.get_json(a[d],void 0,function(a,b){f[d]={json:a}},e):f[d]=a[d])});d(f,e)};k.create_keys_from_json=function(a,b){var c={};Object.keys(a).forEach(function(d){c[d]=a[d].json?k.create_from_json(a[d].json,b):a[d]});return c};k.tree_replace_once=function(a,b,c,d,e){if(a.id_of_tree_replace_once_task!==
e){a.id_of_tree_replace_once_task=e;var f;Object.keys(a).some(function(g){f=a[g];if(null!==f){if(f===b)return a[g]=c,!0;if("shared_widget_index"!==g&&!(0<=["string","number","function","undefined","boolean"].indexOf(typeof f))&&this.tree_replace_once(f,b,c,d,e))return!0}}.bind(this));return!1}};k.toontalk_json_div=function(a,b){var c=b.get_widget(),d=c.get_backside_widgets(),e=c.get_type_name(),c=c.toString({for_json_div:!0}),f;"top-level"===e?b.is_backside()?(a.semantic.settings=void 0,e="a work area containing ",
0===d.length?e="an empty work area":(e=1===d.length?e+"one thing: ":e+(d.length+" things: "),e+=k.describe_widgets(d))):e="a top-level widget":(e=k.add_a_or_an(e),b.is_backside()&&(e="the back of "+e));c&&(d=c.indexOf("data:image/"),0<d&&(f=c.indexOf("alt=",d),0>f&&(f=c.indexOf(">",d)),c=c.substring(0,d+20)+" ... "+c.substring(f)));try{return"<div class='toontalk-json' translate='no' style='display:none'>\nThis will be replaced by "+e+".\n"+(c?c+"\n":"")+"<div style='display:none;'>"+JSON.stringify(a,
k.clean_json,"  ")+"</div></div>"}catch(ja){return k.is_stack_overflow(ja)?"<div>\n"+e+" is nested too deep to create a JSON string to save it.\nYou may be able to launch your browser with a larger stack.\n"+(c?c+"\n":"")+"</div>":"<div>\n"+e+" triggered the following error during save: "+ja.message+(c?c+"\n":"")+"</div>"}};k.describe_widgets=function(a){var b="",c=a.length;a.forEach(function(a){c--;b+=k.add_a_or_an(a.get_type_name());1===c?b+=", and ":1<c&&(b+=", ")});return b};k.elide=function(a,
b,c){c=Math.round(b*c);if(a.length<=b)return a;c=Math.max(c,a.indexOf(" ",c));b=a.length-(b-c);b=Math.max(b,a.indexOf(" ",b)+1);return a.substring(0,c)+" ... "+a.substring(b,a.length)};k.strip_trailling_digits=function(a){var b;if(0===a.length)return a;b=a[a.length-1];return"0"<=b&&"9">=b?k.strip_trailling_digits(a.substring(0,a.length-2)):a};k.clean_json=function(a,b){if("id_of_tree_replace_once_task"!==a)return"number"!==typeof b||"left_offset_fraction"!==a&&"top_offset_fraction"!==a&&"drag_x_offset"!==
a&&"drag_y_offset"!==a?b:parseFloat(b.toPrecision(3))};k.create_widget_from_URL=function(a,c,d,e){var f=function(p){try{var l=this.getResponseHeader("content-type"),w,m,E;if(!l)if(m=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),0===a.indexOf(m))l="";else{d&&(d("Could not determine the contents type of the url"),d=function(){});h.removeEventListener("load",f);return}0===l.indexOf("audio")||g(e,"audio")?(w=b.element.create(e||a),E=new Audio(e||
a),E.addEventListener("event",function(b){k.display_message("Error trying to play a sound from "+(e||a)+". Errror is "+b.message)}),w.set_sound_effect(E)):0===l.indexOf("image")||g(e,"image")?w=b.element.create("<img src='"+(e||a)+"' class = 'toontalk-image' alt='"+a+"'/>"):0===l.indexOf("video")||g(e,"video")?w=b.element.create("<video src='"+(e||a)+" ' width='320' height='240'>"):0===l.indexOf("text")&&(0>l.indexOf("text/html")||a.indexOf(".txt")===a.length-4)?this.responseText&&(w=b.element.create(this.responseText),
w.set_source_URL(a,!0)):w=b.element.create("<div class='toontalk-iframe-container'><iframe src='"+a+"' width='480' height='320'></iframe></div>");w&&c(w)}catch(Ga){d&&(d(Ga),d=function(){}),c()}h.removeEventListener("load",f)},g=function(a,b){var c=a.lastIndexOf("."),d;if(0<=c)switch(c=a.substring(c+1),d=c.indexOf("?"),0<d&&(c=c.substring(0,d)),b){case "image":return"png jpg jpeg gif PNG JPG JPEG GIF".split(" ").includes(c);case "audio":return["wav","mp3","WAV","MP3"].includes(c);case "video":return["mp4",
"MP4"].includes(c)}},h=new XMLHttpRequest;h.addEventListener("load",f);h.open("GET",a,!0);h.onerror=function(e){b.is_already_cross_origin_url&&!b.is_already_cross_origin_url(a)?k.create_widget_from_URL(b.cross_origin_url_function(a),c,d,a):d?(d(e),d=function(){}):(k.display_message("Error trying to GET "+a+" "+e),e.stack&&console.error(e.stack))};h.send()};k.copy_widgets=function(a,b){var c=[],d;for(d=0;d<a.length;d++)c[d]=a[d]&&a[d].copy(b);return c};k.copy_widget_sides=function(a,b){var c=[];a.forEach(function(a){var d;
a&&(d=a.get_widget().copy(b),a.is_backside()?c.push(d.get_backside(!0)):c.push(d))});return c};k.copy_array=function(a){return a.slice()};k.generate_unique_id=function(){e+=1;return"toontalk_id_"+e};k.generate_unique_number=function(){return e+=1};k.get_style_property=function(a,b){var c;if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle){if(a.parentElement)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b);document.body.appendChild(a);c=document.defaultView.getComputedStyle(a,
null).getPropertyValue(b);document.body.removeChild(a);return c}};k.get_style_numeric_property=function(a,b){var c=this.get_style_property(a,b),d;if("string"===typeof c){d=c.indexOf("px");0<=d&&(c=c.substring(0,d));if("auto"===c)return"left"===b?$(a).position().left:"top"===b?$(a).position().top:c;c=parseFloat(c,10);return isNaN(c)?void 0:c}return c};k.get_element_width=function(a){return a?a.getBoundingClientRect().width:0};k.get_element_height=function(a){return a?a.getBoundingClientRect().height:
0};k.cached_selectors={};k.get_toontalk_css=function(a){var b,c;if(k.cached_selectors[a])return k.cached_selectors[a];for(b=0;b<document.styleSheets.length;b++)if(c=document.styleSheets[b],c.href&&0<=c.href.indexOf("toontalk.css")){a:{if(c=c.cssRules)for(b=0;b<c.length;b++)if(c[b].selectorText===a){k.cached_selectors[a]=c[b].cssText;a=c[b].cssText;break a}a=void 0}return a}};k.get_toontalk_css_attribute=function(a,b){var c=k.get_toontalk_css(b),d,e;if(c&&(d=c.indexOf(a+": "),!(0>d)))return d+=(a+
": ").length,e=c.indexOf(";",d),c.substring(d,e)};k.get_toontalk_css_numeric_attribute=function(a,b){var c=k.get_toontalk_css_attribute(a,b),d;if(c&&(d=c.indexOf("px"),0<=d))return+c.substring(0,d)};k.data_transfer_json_object=function(a){var c,d,e;if(a.dataTransfer){try{c=a.dataTransfer.getData("text/html")}catch(ba){c=a.dataTransfer.getData("text")}if(!c||c.match(/[\u3400-\u9FBF]/))c=a.dataTransfer.getData("text");if(c){if(d=q(c)){if(e=k.parse_json(d))return e}else if(0<a.dataTransfer.files.length||
S(a))return;a=b.element.create("");a.get_frontside_element(!0);c&&"<"===c[0]?a.set_HTML(c):a.set_text(c);a.get_json(k.fresh_json_history(),function(a,b,c){0<=a.html.shared_html_index&&(a.html=c.shared_html[a.html.shared_html_index]);e=a});return e}}};k.parse_json=function(a){try{return JSON.parse(a)}catch(w){k.is_stack_overflow(w)?k.report_internal_error("Exception parsing JSON because the widgets are too deeply nested. Perhaps you can launch the browser with a larger stack size."):k.report_internal_error("Exception parsing JSON "+
w.toString()+" error: "+a)}};k.is_stack_overflow=function(a){return 0===a.message.indexOf("Maximum call stack size exceeded")||0===a.message.indexOf("Stack overflow at line")||0===a.message.indexOf("Too much recursion")||0===a.message.indexOf("Abort (control stack overflow)")};k.drag_and_drop=function(a){var b;k.draggable(a);k.can_receive_drops(a);$(a).is(".toontalk-backside-of-top-level")||(b=$(a).is(".toontalk-top-level-resource")?0:500,k.enable_touch_events(a,b))};k.draggable=function(a){$(a).attr("draggable",
!0);a.addEventListener("dragstart",function(b){t(b,a)});a.addEventListener("dragend",function(b){n(b,a)})};k.can_receive_drops=function(a){a.addEventListener("dragover",function(a){a.preventDefault();return!1});a.addEventListener("drop",function(b){b.preventDefault();z(b,a);b.stopPropagation()});k.can_give_mouse_enter_feedback(a)};k.can_give_mouse_enter_feedback=function(a){var b;a.addEventListener("dragenter",function(c){var d=A(c,a);d&&b!==d&&k.remove_highlight(b);b=d;c.stopPropagation()});a.addEventListener("dragleave",
function(a){b&&!k.inside_rectangle(a.clientX,a.clientY,b.getBoundingClientRect())&&(k.remove_highlight(b),b=void 0);a.stopPropagation()})};k.create_drop_area=function(a){var b=document.createElement("div"),c=$(b),d=document.createElement("div");d.innerHTML=a;$(d).addClass("toontalk-drop-area-instructions ui-widget");c.addClass("toontalk-drop-area");b.appendChild(d);k.can_receive_drops(b);return b};k.process_json_elements=function(a,c,d){var e,f,g,h,p,l,m,w,E;a||(a=$(".toontalk-json"),c=0);0!==a.length&&
(w=function(b){if(h){e.textContent="";$(e).css({display:""});if(h.get_type_name)if(h.is_top_level())m=h.get_backside(!0),l=m.get_element(),$(e).replaceWith(l),$(l).css({width:h.json_view?h.json_view.backside_width:g.view.backside_width,height:h.json_view?h.json_view.backside_height:g.view.backside_height,"background-color":g.view.background_color,"border-width":g.view.border_width}),h.json_view=void 0;else{if($(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container"),p=h.get_frontside_element(!0))$(p).addClass("toontalk-top-level-resource").css({position:"relative",
width:h.saved_width,height:h.saved_height}),e.toontalk_widget_side=h,e.appendChild(p)}else e.appendChild(h.get_element());h.set_active&&h.set_active(!1);setTimeout(function(){h.update_display&&h.update_display();g.semantic.running&&h.set_running(!0)},100)}else k.report_internal_error("Could not recreate a widget from this JSON: "+f);c<a.length-1&&k.process_json_elements(a,c+1,b+1)},e=a.get(c),f=e.textContent)&&(f=f.substring(f.indexOf("{"),f.lastIndexOf("}")+1),g=k.parse_json(f))&&(g.semantic&&"top_level"===
g.semantic.type&&!b.no_local_storage&&!b.reset&&g.load_most_recent_program?(E=function(a){var c=function(){try{h=k.create_from_json(g)}catch(ya){console.error(ya.stack),console.trace(),k.report_internal_error("An error occurred loading the saved state. Sorry. Please report this. Error is "+ya),h=b.widget.create_top_level_widget()}d>=b.maximum_recursion_depth&&0===d%b.maximum_recursion_depth?setTimeout(function(){w(d+1)}):w(d?d+1:1)};a?k.retrieve_object(a,function(a){a&&(g=a,c())}):c()},k.retrieve_string("toontalk-last-key",
E)):((h=k.create_from_json(g))&&h.set_visible&&D(e,document.body)&&h.set_visible(!0),d>=b.maximum_recursion_depth&&0===d%b.maximum_recursion_depth?setTimeout(function(){w(d+1)}):w(d?d+1:1)))};k.relative_position_from_absolute_position=function(a,b){for(var c=a.parentElement,d=b.left,e=b.top,f;c&&"html"!==c.nodeType;)f=$(c).position(),d-=f.left,e-=f.top,c=c.parentElement;return{left:d,top:e}};k.set_absolute_position=function(a,b){var c=k.relative_position_from_absolute_position(a,b);k.set_css(a,{left:c.left,
top:c.top,position:"absolute"});$(a).is(".toontalk-side-animating")&&(a.style.left=c.left+"px",a.style.top=c.top+"px")};k.set_position_relative_to_top_level_backside=function(a,b,c){return this.set_position_relative_to_element(a,a.closest(".toontalk-backside-of-top-level"),b,c)};k.set_position_relative_to_element=function(a,c,d,e){var f=c.offset(),g,h,p;c.get(0).appendChild(a.get(0));f||(f={left:0,top:0});g=d.left-f.left;d=d.top-f.top;e&&(e=b.UTILITIES.get_element_width(a.get(0)),f=b.UTILITIES.get_element_height(a.get(0)),
h=b.UTILITIES.get_element_width(c.get(0)),p=b.UTILITIES.get_element_height(c.get(0)),g>h-e&&(g=h-e),0>g&&(g=0),d>p-f&&(d=p-f),0>d&&(d=0));g=k.scale_left(g,c.get(0));d=k.scale_top(d,c.get(0));c={left:g,top:d,position:"absolute"};a.is(".toontalk-side-animating")?(a.get(0).style.left=g+"px",a.get(0).style.top=d+"px",k.add_one_shot_event_handler(a.get(0),"transitionend",2E3,function(){a.removeClass("toontalk-side-animating");a.get(0).style.transitionDuration=""})):k.set_css(a,c);return c};k.restore_resource=
function(a,c){var d,e;a&&a.is(".toontalk-top-level-resource")&&(d=k.get_resource_copy()||c.copy({fresh_copy:!0}),e=d.get_frontside_element(!0),a.parent().removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),a.removeClass("toontalk-top-level-resource toontalk-top-level-resource-container"),$(e).addClass("toontalk-top-level-resource toontalk-top-level-resource-container").css({position:"relative"}),a.css({position:"absolute"}),k.set_css(e,{width:a.width(),height:a.height()}),
a.get(0).parentElement.appendChild(e),b.DISPLAY_UPDATES.pending_update(d),c.set_active&&(c.set_active(!0),d.set_active(!1)))};k.closest_element=function(a,c){var d,e;if(!c)return a.get(0);d=Number.MAX_VALUE;a.each(function(a,f){var g=$(f).offset(),g=b.UTILITIES.distance(g,c);d>g&&(e=f,d=g)});return e};k.find_resource_equal_to_widget=function(a,b){var c=Number.MAX_VALUE,d=$(b.get_frontside_element()).offset(),e;$(".toontalk-top-level-resource.toontalk-side").each(function(b,f){var g=k.widget_side_of_jquery($(f));
g&&(a.equals&&a.equals(g)||a.matching_resource&&a.matching_resource(g)||a.get_type_name()===g.get_type_name()&&"matched"===a.match(g))&&(a.is_hole()||g.get_backside_widgets().length===a.get_backside_widgets().length)&&(g=k.distance($(f).offset(),d),c>g&&(e=f,c=g))});return e};k.set_position_is_absolute=function(a,b,c){var d,e;b?(b=k.get_style_numeric_property(a,"left"),d=k.get_style_numeric_property(a,"top"),c&&(e=$(a.parentElement).offset(),"auto"===b&&(b=c.pageX-e.left,b-=$(a).width()/2),"auto"===
d&&(d=c.pageY-e.top,d-=90)),k.set_css(a,{left:k.left_as_percent(b,a),top:k.top_as_percent(d,a),position:"absolute"})):a.style.position="static"};k.left_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().left:k.adjust_left_if_scaled(a,b);return 100*Math.min(($(c).offset().left-window.pageXOffset+a-d.left)/d.width,1-$(b).width()/d.width)+"%"};k.top_as_percent=function(a,b,c){var d;!c&&b&&(c=b.parentElement);
if(!b||!c)return a;d=c.getBoundingClientRect();a="auto"===a||isNaN(a)?$(b).offset().top:k.adjust_top_if_scaled(a,b);return 100*Math.min(($(c).offset().top+-window.pageYOffset+a-d.top)/d.height,1-$(b).height()/d.height)+"%"};k.adjust_left_if_scaled=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a-(d-c.get_attribute("width"))/2:a};k.adjust_top_if_scaled=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_height&&
(d=c.get_original_height())&&c.get_attribute?a-(d-c.get_attribute("height"))/2:a};k.scale_left=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_width&&(d=c.get_original_width())&&c.get_attribute?a*d/c.get_attribute("width"):a};k.scale_top=function(a,b){var c=k.widget_side_of_element(b),d;return c&&c.get_original_height&&(d=c.get_original_height())&&c.get_attribute?a*d/c.get_attribute("height"):a};k.ordinal=function(a){a++;switch(a){case 1:return"first";case 2:return"second";
case 3:return"third";case 4:return"fourth";case 5:return"fifth";case 6:return"sixth";case 7:return"seventh";case 8:return"eighth";case 9:return"ninth";case 10:return"tenth";case 11:return"eleventh";case 12:return"twelfth";case 13:return"thirteenth";default:return 1===a%10?a+"st":2===a%10?a+"nd":3===a%10?a+"rd":a+"th"}};k.on_a_nest_in_a_box=function(a){return $(a).closest(".toontalk-nest").is("*")&&$(a).closest(".toontalk-box").is("*")};k.give_tooltip=function(a,b){a&&(a.title=b,k.use_custom_tooltip(a))};
k.use_custom_tooltip=function(a){var c=$(a),d;"function"==typeof c.tooltip&&(k.widget_side_of_element(a)&&k.widget_side_of_element(a).get_title&&(a.title=k.widget_side_of_element(a).get_title()),c.tooltip({position:{my:"center bottom-20",at:"center top",using:function(a,b){var e=c.offset();0>a.top&&(a.top=0);e.left<$(window).width()/2?a.left=e.left+c.width()+10:(a.left=0,d=e.left-40);"bottom"===b.vertical?(c.is(".toontalk-robot")?a.top-=30:c.is(".toontalk-number")?a.top-=30:c.is(".toontalk-box")?
a.top-=30:a.top-=20,10>a.left&&(a.left=10),10>a.top&&(a.top=10)):a.top+=20;a.left=Math.min(a.left,$(window).width()-100);a.left=Math.max(a.left,window.pageXOffset);a.top=Math.max(a.top,window.pageYOffset);k.set_css(this,a)}},open:function(c,e){var f=e.tooltip.get(0),g=f.textContent,h=$(a).is(".toontalk-robot"),p;f.innerHTML=L(g,decodeURIComponent);b.speak&&(window.speechSynthesis.cancel(),h||(p=function(a){}),k.speak(f.innerText,{when_finished:p}));ha&&$(ha).remove();ha=f;b.balloons?(100<g.length&&
(h=Math.min(800,d||$(window).width()-100),$(f).position(),e.tooltip.css({maxWidth:h})),e.tooltip.css({"z-index":99999999}),e.tooltip.find(".toontalk-iframe-container").removeClass("toontalk-iframe-container"),setTimeout(function(){e.tooltip.remove();$(f).data("ui-tooltip")&&($(f).tooltip("destroy"),$(".ui-helper-hidden-accessible").remove(),k.use_custom_tooltip(a));ha=void 0},g.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100))):e.tooltip.remove()},close:function(){$(this).data("ui-tooltip")&&
($(this).tooltip("destroy"),$("[role='log']").remove(),k.use_custom_tooltip(a));ha=void 0}}))};k.speak=function(a,c){var d=new SpeechSynthesisUtterance(a),e=window.speechSynthesis.getVoices(),h=function(a){for(var b=[],c=function(a){var b,c;if(200>a.length)return a.length+1;b=a.substring(0,200);c=b.lastIndexOf(". ")||b.lastIndexOf(".\n");if(0<c)return c+2;c=b.lastIndexOf(".");if(c===b.length-1)return c+1;c=b.lastIndexOf(", ");if(0<c)return c+2;c=b.lastIndexOf(" ");return 0<c?c+1:Math.min(a.length+
1,200)},d;0<a.length;)d=c(a),1<d&&b.push(a.substring(0,d-1)),a=a.substring(d);return b},p,l;f&&(c||(c={}),0===e.length?window.speechSynthesis.onvoiceschanged=function(){k.speak(a,c);window.speechSynthesis.onvoiceschanged=void 0}:k.translate&&!c.no_translation?k.translate(a,function(a){c.no_translation=!0;k.speak(a,c)}):200<a.length?(e=h(a),e.forEach(function(a,b){0===b&&(c.when_finished=function(){});k.speak(a,c)})):(l=g.push(d)-1,d.volume=void 0===c.volume?Math.min(1,3*b.volume):c.volume,d.pitch=
void 0===c.pitch?1.2:c.pitch,d.rate=void 0===c.rate?.75:c.rate,p=k.translation_language_code(),e.some(function(a){if(0===a.lang.indexOf(p)||""===a.lang){d.lang=a.lang;d.voice=a;if(0===c.voice_number||void 0===c.voice_number)return!0;c.voice_number--}}),c.when_finished&&(d.onend=function(){g.splice(l,1);c.when_finished();d.onend=void 0},setTimeout(function(){d.onend&&!window.speechSynthesis.speaking&&(k.display_message("Browser did not begin speaking after waiting 20 seconds. Continuing as if speech occurred."),
d.onend())},2E4)),window.speechSynthesis.speak(d)))};k.translation_language_code=function(){return b.TRANSLATION_ENABLED&&google&&google.translate&&google.translate.TranslateElement?google.translate.TranslateElement().c:navigator.language};k.encode_HTML_for_title=function(a){return encodeURIComponent("<span class='notranslate' translate='no'>decodeURIComponent"+a+"decodeURIComponent</span>")};k.remove_encoded_HTML=function(a){return L(a,function(){return""})};k.join_continuations=function(a,b){return a?
b?function(){b(a)}:a:b};k.add_one_shot_event_handler=function(a,b,c,d){var e=!1,f=function(c){e=!0;d&&d();a.removeEventListener(b,f)};a.addEventListener(b,f);setTimeout(function(){e||f()},c)};k.animate_to_absolute_position=function(a,c,d,e,f,g){var h=$(a).offset(),p=$(a).position(),l=k.distance(c,h);0===g||0===e?(k.set_absolute_position(a,c),d&&d()):($(a).css({"z-index":k.next_z_index()}),g||(g=Math.round(l/(e||b.animation_settings.ANIMATION_SPEED))),$(a).addClass("toontalk-side-animating"),a.style.transitionDuration=
g+"ms",l=p.left+(c.left-h.left),h=p.top+(c.top-h.top),a.style.left=l+"px",a.style.top=h+"px",a.toontalk_followed_by&&(c.left+=a.toontalk_followed_by.left_offset,c.top+=a.toontalk_followed_by.top_offset,k.animate_to_absolute_position(a.toontalk_followed_by.element,c,void 0,e,f)),document.hidden&&(g=0),f?setTimeout(d,g):setTimeout(function(){$(a).removeClass("toontalk-side-animating");a.style.transitionDuration="";d&&d()},g))};k.distance=function(a,b){var c=a.left-b.left,d=a.top-b.top;return Math.sqrt(c*
c+d*d)};k.highlight_element=function(a,b,c){var d;if(a){k.remove_highlight();if(!$(a).is(".toontalk-backside")&&(d=k.widget_side_of_element(a),!d||d.element_to_highlight&&b&&(a=d.element_to_highlight(b),!a)))return;$(a).is(".toontalk-highlight")||($(a).addClass("toontalk-highlight"),c&&setTimeout(function(){k.remove_highlight(a)},c))}};k.remove_highlight=function(a){a?$(a).removeClass("toontalk-highlight"):$(".toontalk-highlight").removeClass("toontalk-highlight")};k.cursor_of_image=function(a){var b=
a.lastIndexOf(".");return 0<=b?a.substring(0,b)+".32x32"+a.substring(b):a};k.inside_rectangle=function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom};k.constrain_css_to_fit_inside=function(a,b){var c=$(a).width(),d;0!==c&&(d=$(a).height(),"number"===typeof b.left?b.left=Math.min(Math.max(b.left,0),c):(c=k.extract_percentage_from_string(b.left),"number"===typeof c&&(b.left=Math.min(100,Math.max(c,0))+"%")),"number"===typeof b.top?b.top=Math.min(Math.max(b.top,0),d):(c=k.extract_percentage_from_string(b.top),
"number"===typeof c&&(b.top=Math.min(100,Math.max(c,0))+"%")))};k.extract_percentage_from_string=function(a){try{if("string"===typeof a&&"%"===a[a.length-1])return parseFloat(a.substring(0,a.length-1))}catch(w){}};k.next_z_index=function(){h++;return h};k.create_button=function(a,b,c,d){a=$("<button>"+a+"</button>").button();a.addClass(b+" toontalk-button");a.get(0).addEventListener("click",d);k.give_tooltip(a.get(0),c);return a.get(0)};k.create_close_button=function(a,b){var c=document.createElement("div"),
d=document.createElement("div");$(c).addClass("toontalk-close-button toontalk-button");c.addEventListener("click",a);k.give_tooltip(c,b);d.innerHTML="&times;";c.appendChild(d);return c};k.check_radio_button=function(a){var b=$(a.button).closest(".ui-controlgroup");0<b.length&&b.find(".ui-state-active").removeClass("ui-state-active").prop("checked",!1);$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")};k.create_alert_element=function(a){a=L(a,decodeURIComponent);var b=k.create_text_element(a);
0===$(b).children().length||0<=a.indexOf("<")?$(b).addClass("toontalk-alert-element"):$(b).children().addClass("toontalk-alert-element");return b};k.create_text_element=function(a,b){var c=document.createElement("div");c.innerHTML=a;$(c).addClass("ui-widget");b&&$(c).addClass(b);return c};k.create_space=function(){var a=document.createElement("span");a.innerHTML="&nbsp;";$(a).addClass("ui-widget");return a};k.create_anchor_element=function(a,c){var d=document.createElement("a");d.innerHTML=a;b.TRANSLATION_ENABLED&&
(c=k.add_URL_parameter(c,"translate","1"));d.href=c;d.target="_blank";return d};k.create_text_input=function(a,b,c,d,e,f,g){var h=document.createElement("input"),p;h.type="text";h.className=b;h.value=a;k.give_tooltip(h,d);f&&(h.type=f);c?(a=document.createElement("label"),a.innerHTML=c,h.id=k.generate_unique_id(),a.htmlFor=h.id,e&&(p=k.create_anchor_element("i",e),$(p).addClass("toontalk-help-button toontalk-button notranslate"),p.translate=!1),c=k.create_horizontal_table(a,h,p),$(a).addClass("ui-widget")):
c=h;h.classList.add("toontalk-text-with-button-style","ui-corner-all","ui-widget","toontalk-text-area");h.addEventListener("touchstart",function(){$(h).select()});g&&C(h,g);k.use_custom_tooltip(h);return{container:c,button:h}};k.create_text_area=function(a,b,c,d,e,f,g){var h=document.createElement("textarea");h.className=b;h.value=a;k.give_tooltip(h,d);a=document.createElement("label");a.innerHTML=c;h.id=k.generate_unique_id();a.htmlFor=h.id;c=g?k.create_vertical_table(a,h):k.create_horizontal_table(a,
h);h.classList.add("toontalk-text-with-button-style","ui-corner-all","ui-widget","toontalk-text-area");h.addEventListener("touchstart",function(){$(h).select()});e&&C(h,e);$(a).addClass("ui-widget");k.use_custom_tooltip(h);return{container:c,button:h}};k.input_area_drop_handler=function(a,b,c){var d;a.preventDefault();if(c=r(a)){if(c.is_backside())return;if(d=b(c,a))$(a.currentTarget).trigger("change"),a.currentTarget.value=d,c.remove(),a.stopPropagation()}return"string"===typeof d&&c};k.create_radio_button=
function(a,b,c,d,e,f){f=document.createElement("div");var g=document.createElement("input"),h=document.createElement("label");g.type="radio";g.className=c+" toontalk-button";g.name=a;g.value=b;h.innerHTML=d;g.id=k.generate_unique_id();h.htmlFor=g.id;f.appendChild(g);f.appendChild(h);k.give_tooltip(f,e);$(g).checkboxradio({icon:!1}).addClass("toontalk-button");k.use_custom_tooltip(g);return{container:f,button:g,label:h}};k.create_select_menu=function(a,b,c,d,e,f){var g=document.createElement("div"),
h=document.createElement("select"),p=document.createElement("label");h.className=c;h.name=a;h.id=k.generate_unique_id();p.innerHTML=d;p.htmlFor=h.id;g.appendChild(p);g.appendChild(h);k.give_tooltip(g,e);b.forEach(function(a,b){var c=document.createElement("option");c.value=a;c.innerHTML=a;f&&f[b]&&k.give_tooltip(c,f[b]);h.appendChild(c)});$(h).selectmenu({width:"50%",open:function(){$(".ui-selectmenu-open").css({"z-index":9999999});setTimeout(function(){$(".ui-selectmenu-open").find(".ui-menu-item").each(function(a,
c){var d;f&&(d=b.indexOf(c.textContent),0<=d&&f[d]&&k.give_tooltip(c,f[d]))})})}});$(p).addClass("ui-widget");k.use_custom_tooltip(h);return{container:g,menu:h,label:p}};k.create_check_box=function(a,b,c,d){var e=document.createElement("div"),f=document.createElement("input"),g=document.createElement("label");f.type="checkbox";f.className=b+" toontalk-button";f.checked=a;g.innerHTML=c;f.id=k.generate_unique_id();g.htmlFor=f.id;$(g).addClass("ui-widget");e.appendChild(f);e.appendChild(g);k.give_tooltip(e,
d);k.use_custom_tooltip(f);return{container:e,button:f,label:g}};k.create_div=function(){var a=document.createElement("div"),b;for(b=0;b<arguments.length;b++)arguments[b]&&(arguments[b].container?(a.appendChild(arguments[b].button),a.appendChild(arguments[b].label)):a.appendChild(arguments[b]));return a};k.create_horizontal_table=function(){var a=document.createElement("table"),b,c,d;c=document.createElement("tr");a.appendChild(c);for(b=0;b<arguments.length;b++)arguments[b]&&(d=document.createElement("td"),
c.appendChild(d),d.appendChild(arguments[b]));return a};k.create_vertical_table=function(){var a=document.createElement("table"),b,c;for(b=0;b<arguments.length;b++)arguments[b]&&(c=k.create_row(arguments[b]),a.appendChild(c));return a};k.create_row=function(){var a=document.createElement("tr"),b=document.createElement("td"),c;for(c=0;c<arguments.length;c++)arguments[c]&&a.appendChild(arguments[c]);b.appendChild(a);return a};k.create_table_entry=function(a){var b=document.createElement("td");b.appendChild(a);
return b};k.selected_radio_button=function(){var a;for(a=0;a<arguments.length;a++)if($(arguments[a].label).is(".ui-state-focus"))return arguments[a]};k.create_image=function(a,b){var c=document.createElement("img"),d;c.src=a;b&&$(c).addClass(b);0===a.indexOf("images/")&&(d=function(b){c.removeEventListener("error",d);c.src="http://toontalk.github.io/ToonTalk/"+a},c.addEventListener("error",d));return c};k.create_tabs=function(a,b){var c=document.createElement("div"),d=document.createElement("ul"),
e;if(a.length!==b.length)return console.error("UTILITIES.create_tabs called with different length lists."),c;a.forEach(function(a,c){var f=document.createElement("li"),g=document.createElement("a"),h;"string"===typeof a?(h=document.createElement("span"),h.innerHTML=a):h=a;e="tab-"+c;g.href="#"+e;g.appendChild(h);f.appendChild(g);d.appendChild(f);b[c].id=e});c.appendChild(d);b.forEach(function(a){c.appendChild(a)});$(c).tabs();return c};k.add_iframe_popup=function(a){var b=document.createElement("iframe"),
c=document.createElement("div");$(c).addClass("toontalk-close-popup-frame-button").button();c.addEventListener("click",function(a){$(b).remove();$(c).remove();a.stopPropagation()});c.innerHTML="Return to ToonTalk";$(b).addClass("toontalk-popup-frame");b.src=a;document.body.appendChild(c);document.body.appendChild(b)};k.create_file_data_table=function(a){var b=$('<table cellpadding="0" cellspacing="0" border="0"></table>');a&&b.addClass(a);return b.get(0)};k.become_file_data_table=function(a,c,d,e){$(a).DataTable({data:c,
autoWidth:!1,order:[[1,"desc"]],columns:[{data:"title",title:"Name",render:function(a,c,f,g){a=d?a.substring(0,a.length-5):a;c=d?b.google_drive.google_drive_url(f.id):"Click to load this program.";if(e)return"<div class='"+e+"' title='"+c+"'id='"+f.id+"'>"+a+"</div>";b.TRANSLATION_ENABLED&&(c=k.add_URL_parameter(c,"translate","1"));return"<a href='"+c+"'target='_blank' title='Click to open published page.'>"+a+"</a>"}},{data:"modifiedDate",title:"Modified",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},
{data:"createdDate",title:"Created",render:function(a,b,c,d){return(new Date(a)).toUTCString()}},{data:"fileSize",title:"Size"}]});$(a).addClass("toontalk-file-table")};k.get_local_files_data=function(a){k.get_all_locally_stored_program_names(function(b){var c=[],d=function(e){var f=b[e];k.get_local_storage_meta_data(f,function(g){g&&c.push({title:f,modifiedDate:g.last_modified,createdDate:g.created,fileSize:g.file_size});e<b.length?d(e+1):a(c)})};d(0)})};k.create_local_files_table=function(a){k.get_local_files_data(function(b){var c=
k.create_file_data_table();k.when_attached(c,function(){k.become_file_data_table(c,b,!1,"toontalk-file-load-button toontalk-file-load-button-without-click-handler")});a(c)})};k.get_$dragee=function(){return M};k.get_dragee=function(){return M&&b.UTILITIES.widget_side_of_jquery(M)};k.get_resource_copy=function(){return ea};k.get_dragee_copy=function(){if(ca)return ca;var a=k.get_dragee();if(a&&!a.is_backside()&&(a.get_infinite_stack()||M.is(".toontalk-top-level-resource")))return ca||(M.is(".toontalk-top-level-resource")?
(ca=a,ea=a.copy({fresh_copy:!0})):ca=a.add_copy_to_container(void 0,-1E3,-1E3)),ca};k.add_URL_parameter=function(a,b,c){a=k.remove_URL_parameter(a,b);var d;d=a.indexOf("?");return a+(0<=d?"&":"?")+b+"="+c};k.remove_URL_parameter=function(a,b){var c=a.indexOf("&"+b+"="),d;0>c&&(c=a.indexOf("?"+b+"="));if(0>c)return a;d=a.indexOf("&",c+1);0>d&&(d=a.length);a=a.substring(0,c)+a.substring(d);"?"===a[a.length-1]&&(a=substring(0,a.length-1));return a};k.add_a_or_an=function(a,b){var c=a.charAt(0);if("'"===
c||'"'===c)c=a.charAt(1);return 0===a.indexOf("the ")||0===a.indexOf("a ")||0===a.indexOf("an ")||0===a.indexOf("any ")||0===a.indexOf('"the ')||0===a.indexOf('"a ')||0===a.indexOf('"an ')||0===a.indexOf('"any ')?a:0>"aeiou".indexOf(c)?b?"A "+a:"a "+a:b?"An "+a:"an "+a};k.lower_case_first_letter=function(a){return a.charAt(0).toLowerCase()+a.slice(1)};k.maximum_string_length=function(a,b){var c;if(a.length<=b)return a;c=a.substring(0,Math.round(.75*b));return c+" ... "+a.substring(a.length-(b-c.length))};
k.each_top_level_widget=function(a){$(".toontalk-backside-of-top-level").each(function(b,c){a(k.widget_side_of_element(c).get_widget())})};k.backup_all_top_level_widgets=function(a){k.each_top_level_widget(function(b){b.save(a)})};k.make_resizable=function(a,b){var c,d,e;a.resizable({start:function(b,f){d=f.originalSize.width;e=f.originalSize.height;c=a.get(0).onclick},resize:function(c,f){a.is(".toontalk-element-frontside")&&(f.size.width!=d&&(b.increment_width(f.size.width-d),d=f.size.width),f.size.height!=
e&&(b.increment_height(f.size.height-e),e=f.size.height));b.rerender()},stop:function(f,g){b.robot_in_training&&b.robot_in_training()&&b.robot_in_training().resized_widget(b,d,e,g.size.width,g.size.height);f.originalEvent.stopPropagation();setTimeout(function(){a.get(0).onclick=c},100)},handles:b.is_box()?"se":"n,e,s,w"});a.children(".ui-resizable-handle").css("z-index",9999)};k.match=function(a,b){var c,d;if(void 0===a)return"matched";if(a.is_nest())d=a.match(b);else if(c=b.dereference(),d=a.match(c),
d.is_widget&&c.matched_by)return c.matched_by(a);return d};k.current_URL=function(){return window.location.pathname};k.absolute_file_path=function(a){var b=window.location.pathname,c=b.lastIndexOf("ToonTalk/");return 0>c?a:b.substring(0,c+9)+a};k.copy_side=function(a,b,c){b=a.get_widget().copy(b);c&&k.copy_frontside_dimensions(a.get_widget(),b);return a.is_backside()?b.get_backside():b};k.copy_frontside_dimensions=function(a,b){var c=a.get_widget().get_frontside_element(),d;c&&(d=b.get_frontside_element(!0))&&
k.set_css(d,{width:$(c).width(),height:$(c).height()})};k.scale_to_fit=function(a,b,c,d){return $(b).is(".toontalk-backside")?k.scale_element(a,c,d,c,d):k.scale_element(a,$(b).width(),$(b).height(),c,d)};k.scale_element=function(a,c,d,e,f,g,h,l,m){var p=$(a).find("iframe"),n;if(0<p.length)p.attr("width",c).attr("height",d-20);else{$(a).is(".toontalk-not-observable")&&(p=b.UTILITIES.widget_side_of_element(a))&&p.render();e||(n=$(a).children("img"),e=n.is("*")?n.width():$(a).width());f||(n||(n=$(a).children("img")),
f=n.is("*")?n.height():$(a).height());n=c&&0!==e?c/e:a.toontalk_x_scale||1;p=d&&0!==f?d/f:a.toontalk_y_scale||1;0===n&&(n=1);0===p&&(p=1);a.toontalk_x_scale=n;a.toontalk_y_scale=p;l=(l=l&&l!==document.body?l:a.parentElement)&&0>l.className.indexOf("toontalk-box-hole")&&0>a.className.indexOf("toontalk-scale");var w="";h||(h={});"number"===typeof h.left&&(h.left-=(e-c)/2,m=!0);"number"===typeof h.top&&(h.top-=(f-d)/2,m=!0);!m&&l?(c&&(a.toontalk_translate_x=(c-e)/2,w+="translateX("+a.toontalk_translate_x+
"px) "),d&&(a.toontalk_translate_y=(d-f)/2,w+="translateY("+a.toontalk_translate_y+"px) ")):(a.toontalk_translate_x=void 0,a.toontalk_translate_y=void 0);k.add_transform_to_css((g||"")+" scale("+n+", "+p+")",w,h,l);h.width=e;h.height=f;k.set_css(a,h);return{x_scale:n,y_scale:p}}};k.translate_x=function(a){return l("toontalk_translate_x","toontalk_x_scale")};k.translate_y=function(a){return l("toontalk_translate_y","toontalk_y_scale")};k.add_transform_to_css=function(a,b,c,d){a&&(c||(c={}),c["transform-origin"]||
(c["transform-origin"]=d?"center center":"left top"),k.set_css_transform(c,b+a))};k.set_css_transform=function(a,b){a["-webkit-transform"]=b;a["-moz-transform"]=b;a["-ms-transform"]=b;a["o-transform"]=b;a.transform=b};k.run_when_dimensions_known=function(a,c,d){var e=a.parentElement,f=function(a){return a&&0>a.className.indexOf("toontalk-box-hole")&&!$(a).is(".toontalk-nest")},g;!d&&$(a).width()&&(f(e)||$(a).is(".toontalk-element-frontside"))?setTimeout(function(){c(e)}):(g=function(d){setTimeout(function(){var h=
$(a).width(),l=$(a).height();h&&l?f(a.parentElement)?($(a).removeClass("toontalk-not-observable"),c(e),e?(e.appendChild(a),b.UTILITIES.widget_side_of_element(a).rerender()):a.parentElement===document.body&&$(a).remove()):k.run_when_dimensions_known(a,c,!0):setTimeout(function(){k.widget_side_of_element(a);1E4>d&&g(2*d)},d)})},$(a).addClass("toontalk-not-observable"),document.body.appendChild(a),d&&k.set_css(a,{width:"",height:"",transform:""}),g(1))};k.original_dimensions=function(a,b,c){var d=a.get_frontside_element();
d.parentElement!==document.body&&k.run_when_dimensions_known(d,function(){var a=$(d).children("img");a.is("*")?b(a.width(),a.height()):b($(d).width(),$(d).height())},c)};k.relative_position=function(a,b){var c,d;if(!k.is_attached(a))return{left:0,top:0};c=$(a).offset();b&&(d=$(b).offset(),c.left-=d.left,c.top-=d.top);return c};k.add_animation_class=function(a,b){k.set_css(a,{width:"",height:""});$(a).addClass(b)};k.widget_side_of_jquery=function(a){if(0<a.length)return a.get(0).toontalk_widget_side};
k.widget_side_of_element=function(a){return a.toontalk_widget_side};k.has_animating_image=function(a){a=$(a);return(a=a.css("animation")||a.css("webkit-animation")||a.css("moz-animation")||a.css("ms-animation")||a.css("o-animation"))&&0!==a.indexOf("none")};k.display_message=function(a,c){var d=k.create_alert_element(a),e=function(){$(d).remove();$(".toontalk-help-link").css({opacity:""})},f;c||(c={});if(c.only_if_new)if(0>V.indexOf(a))V.push(a);else return a;$(".toontalk-alert-element").text($(".toontalk-alert-element").text()+
"..."+a);!b.debugging||c.user_initiated||c.dont_log||(console.log(c.plain_text||a),console.trace());if(c.element||c.second_choice_element)f=$(c.element).closest(".toontalk-backside"),0===f.length&&(f=$(c.second_choice_element).closest(".toontalk-backside")),0<f.length&&($(d).addClass("toontalk-local-alert"),f.append(d));c.element&&0!==f.length||($(".toontalk-help-link").css({opacity:0}),document.body.insertBefore(d,document.body.firstChild));b.speak&&(window.speechSynthesis.cancel(),k.speak(c.plain_text||
d.textContent));d.addEventListener("click",e);c.duration||(0<=a.indexOf("<")?c.duration=5E3:c.duration=Math.max(2E3,a.length*(b.MAXIMUM_TOOLTIP_DURATION_PER_CHARACTER||100)));setTimeout(e,c.duration);return a};k.display_tooltip=function(a){a.each(function(){k.use_custom_tooltip(this)});a.tooltip("open")};k.report_internal_error=function(a,c){console.error(a);console.trace();b.debugging&&k.display_message("Error: "+a);"object"!==typeof Raven||c&&c.dont_log_exception||Raven.captureException(a)};k.get_current_url_boolean_parameter=
function(a,b){return 0>window.location.href.indexOf(a+"=")?b:0<=window.location.href.indexOf(a+"=1")?!0:!1};k.get_current_url_numeric_parameter=function(a,b){var c=k.get_current_url_parameter(a);if("undefined"===typeof c)return b;try{return parseInt(c,10)}catch(K){return 0}};k.get_current_url_parameter=function(a,b){var c=window.location.href.indexOf(a+"="),d;if(0>c)return b;c=c+a.length+1;d=window.location.href.indexOf("&",c);0>d&&(d=window.location.href.length);return window.location.href.substring(c,
d)};k.get_path_to_toontalk_folder=function(){return b.TOONTALK_URL};k.is_browser_of_type=function(a){return 0<=window.navigator.userAgent.indexOf(a)};c=k.is_browser_of_type("MSIE")||k.is_browser_of_type("Trident");k.is_internet_explorer=function(){return c};k.add_position=function(a,b){return{left:a.left+b.left,top:a.top+b.top}};k.subtract_position=function(a,b){return{left:a.left-b.left,top:a.top-b.top}};k.remove_z_index=function(a){if(0===a.length||"<"!==a.charAt(0)||0>a.indexOf("z-index"))return a;
a=$("<div>"+a+"</div>");a.attr("z-index","");return a.html()};k.add_test_all_button=function(){var a=$("#toontalk-test-all-button"),b=!1,c;0!==a.length&&(a.button(),c=a.get(0),c.innerHTML="Run all tests",a.get(0).addEventListener("click",function(a){b?($(".toontalk-stop-sign").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&$(this).click()}),c.innerHTML="Run all tests",k.rerender_all()):($(".toontalk-green-flag").each(function(){$(this).parent().is(".toontalk-backside-of-top-level")&&
$(this).click()}),c.innerHTML="Stop all tests");b=!b}))};k.set_timeout=function(a,b){b||k.is_internet_explorer()?setTimeout(a,b):(W.push(a),window.postMessage("zero-timeout-message","*"))};k.get_first_property=function(a){return Object.keys(a)[0]};k.get_all_locally_stored_program_names=function(a){k.retrieve_object("toontalk-all-program-names",function(b){if(b)a(b);else return a([])})};k.set_all_locally_stored_program_names=function(a){k.store_object("toontalk-all-program-names",a,function(){})};
k.get_local_storage_meta_data=function(a,b){var c=k.local_storage_program_meta_data_key(a);try{k.retrieve_object(c,b)}catch(K){b()}};k.local_storage_program_key=function(a){return"toontalk-json: "+a};k.local_storage_program_meta_data_key=function(a){return"toontalk-meta-data: "+a};b.CHROME_APP?(k.store_object=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);e[a]=JSON.stringify(c,k.clean_json);chrome.storage.local.set(e,d);chrome.runtime.lastError&&
console.error(chrome.runtime.lastError+" caused by set "+a)},k.store_string=function(a,c,d){var e={};b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a);e[a]=c;chrome.storage.local.set(e,d);b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing string "+c.substring(0,100)+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by store_string "+a)},k.retrieve_object=function(a,c){chrome.storage.local.get(a,
function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+" caused by get "+a);c(d[a]&&k.parse_json(d[a]))})},k.retrieve_string=function(a,c){chrome.storage.local.get(a,function(d){b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved string "+(d[a]&&d[a].substring(0,100))+"... with key "+a);chrome.runtime.lastError&&console.error(chrome.runtime.lastError+
" caused by get "+a);c(d&&d[a])})}):window.localStorage?(k.store_object=function(a,c,d){var e;b.logging&&0<=b.logging.indexOf("store")&&console.log("Storing "+c+" with key "+a);try{e=JSON.stringify(c,k.clean_json)}catch(ba){k.is_stack_overflow(ba)?b.UTILITIES.display_message("Unable to store your project because the depth of widget nesting exceeds the size of the stack.  Perhaps you can launch this browser or another with a larger stack size.",{only_if_new:!0}):b.UTILITIES.display_message("Unable to store your project because of the error: "+
ba.message,{only_if_new:!0})}try{window.localStorage.setItem(a,e)}catch(ba){b.UTILITIES.display_message("Unable to store your project to the browser's local storage. You can save to Google Drive if you have an account. Otherwise drag your project to Wordpad or the like. The error message is: "+ba,{only_if_new:!0})}d&&d()},k.store_string=function(a,c,d){try{window.localStorage.setItem(a,c)}catch(K){b.UTILITIES.display_message("Unable to store your project to the browser's local storage. You can save to Google Drive if you have an account. Otherwise drag your project to Wordpad or the like. The error message is: "+
K,{only_if_new:!0})}d&&d()},k.retrieve_object=function(a,c){try{var d=window.localStorage.getItem(a);b.logging&&0<=b.logging.indexOf("retrieve")&&console.log("Retrieved "+(d&&d.substring(0,100))+"... with key "+a);c(d&&k.parse_json(d))}catch(K){b.UTILITIES.display_message("Unable to read from the browser's local storage. You can read and save to Google Drive if you have an account. The error message is: "+K,{only_if_new:!0})}},k.retrieve_string=function(a,c){b.logging&&0<=b.logging.indexOf("retrieve")&&
console.log("Retrieved string "+(window.localStorage.getItem(a)&&window.localStorage.getItem(a).substring(0,100))+"... with key "+a);try{c(window.localStorage.getItem(a))}catch(E){b.UTILITIES.display_message("Unable to read from the browser's local storage. You can read and save to Google Drive if you have an account. The error message is: "+E,{only_if_new:!0})}}):(k.store_object=function(){console.log("Browser local storage not available in this browser. Nothing stored")},k.store_string=k.store_object,
k.retrieve_object=function(a,b){b()},k.retrieve_string=k.retrieve_object);k.touch_available=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};k.enable_touch_events=function(a,c){var d=a,e=function(e){var p;e.preventDefault();l&&(e.stopPropagation(),p=e.changedTouches[0],m&&(m.being_dragged=!1),$(a).removeClass("toontalk-being-dragged"),l+c>=Date.now()?(e=document.createEvent("MouseEvent"),e.initMouseEvent("click",!0,!0,window,1,p.screenX,p.screenY,p.clientX,p.clientY,!1,!1,!1,
!1,0,null),p.target.dispatchEvent(e),m&&m.constrained_by_container()?$(a).css({left:"",top:""}):k.set_absolute_position(a,{left:h.left,top:h.top}),b.logging&&0===b.logging.indexOf("touch")&&u("touch end treated as click "+a.id,!0)):(n(e,a),b.logging&&0===b.logging.indexOf("touch")&&u("drag ended "+a.id),z(e,a),b.logging&&0===b.logging.indexOf("touch")&&u("drop happened "+a.id),b.logging&&0===b.logging.indexOf("touch")&&u("",!0),k.set_absolute_position(a,{left:p.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:p.pageY-
g-b.USABILITY_DRAG_OFFSET.y})),l=void 0,a=d)},f=0,g=0,h,l,m,p;a.addEventListener("touchstart",function(c){var d=c.changedTouches[0],e,p,n;h=$(a).offset();0===b.USABILITY_DRAG_OFFSET.y&&(b.USABILITY_DRAG_OFFSET.y=25);b.logging&&0===b.logging.indexOf("touch")&&u("touch start "+a.id);c.preventDefault();if("TEXTAREA"===c.target.tagName||"INPUT"===c.target.tagName||$(c.target).is(".ui-resizable-handle"))b.logging&&0===b.logging.indexOf("touch")&&u("touch start ignored due to tag name or class "+a.id);
else if((e=k.find_widget_side_on_page(c.changedTouches[0],void 0,0,0))&&e.is_of_type("empty hole")&&(e=e.get_parent_of_frontside()),e&&e.get_frontside_element()!==a)b.logging&&0===b.logging.indexOf("touch")&&u("touch start ignored since has child who is really touched: "+k.widget_side_of_element(a));else{l=Date.now();b.logging&&0===b.logging.indexOf("touch")&&u("touch start of "+a.id+" at "+l);c.stopPropagation();if(m=k.widget_side_of_element(a))m.being_dragged=!0;m&&m.get_infinite_stack()?(p=m.copy(),
m.set_infinite_stack(!1),p.set_infinite_stack(!0)):$(a).is(".toontalk-top-level-resource")&&(p=m.copy(),m.add_copy_to_container(p,0,0),n=$(a).offset(),a=p.get_frontside_element(!0));p&&(m.add_copy_to_container(p,0,0),m.robot_in_training()&&m.robot_in_training().copied(m,p,!1));$(a).css({"z-index":99999999});n||(n=$(a).offset());t(c,a);f=d.pageX-n.left;g=d.pageY-n.top;b.logging&&0===b.logging.indexOf("touch")&&u("drag started "+a.id)}},!0);a.addEventListener("touchmove",function(c){var d=c.changedTouches[0];
if(l){c.preventDefault();k.set_absolute_position(a,{left:d.pageX-f-b.USABILITY_DRAG_OFFSET.x,top:d.pageY-g-b.USABILITY_DRAG_OFFSET.y});c=k.find_widget_side_on_page(d,a,b.USABILITY_DRAG_OFFSET.x,b.USABILITY_DRAG_OFFSET.y);if(p&&p!==c){var e=p.get_frontside_element();k.remove_highlight(e);p=void 0}c&&(A(d,c.get_element()),p=c);b.logging&&0===b.logging.indexOf("touch")&&u("dragged to "+(d.pageX-f)+", "+(d.pageY-g)+" "+a.id)}},!0);a.addEventListener("touchend",e,!0);a.addEventListener("touchcancel",e,
!0)};k.get_mouse_or_first_touch_event_attribute=function(a,b){return b.changedTouches?b.changedTouches[0][a]:b[a]};k.find_widget_side_on_page=function(a,b,c,d){var e=k.get_mouse_or_first_touch_event_attribute("pageX",a);a=k.get_mouse_or_first_touch_event_attribute("pageY",a);var f;b&&$(b).hide();c=document.elementFromPoint(e-(window.pageXOffset+c),a-(window.pageYOffset+d));for(b&&$(b).show();c&&!c.toontalk_widget_side&&!$(c).is(".toontalk-backside")&&!$(c).is(".toontalk-button")&&!$(c).is(".ui-button");)c=
c.parentNode;c&&(f=c.toontalk_widget_side);if(f)return f&&f.get_contents&&f.get_contents()&&(f=f.get_contents()),f};k.closest_top_level_backside=function(a,b){var c,d;$(".toontalk-backside-of-top-level").each(function(){var b=$(this).offset(),b=b.left+$(this).width()/2-a^2+(b.top+$(this).height()/2-a)^2;c?b<d&&(c=this,d=b):(c=this,d=b)});return k.widget_side_of_element(c)};k.set_css=function(a,b){var c,d;if(b&&a){if(c=k.widget_side_of_element(a))if(d=c.dereference(),b.width&&!b["font-size"]&&(c.is_hole()?
b["font-size"]=c.name_font_size(b.width,b.height):d.name_font_size&&(b["font-size"]=d.name_font_size(b.width,b.height))),!$(a).is(".toontalk-temporarily-set-down"))if(c.constrained_by_container())b.left="",b.top="";else if(c.is_plain_text_element()||c.is_nest()&&d.is_plain_text_element())b.width="",b.height="";0===b.width&&(b.width="");0===b.height&&(b.height="");b.transform||"number"!==typeof b.width||"number"!==typeof b.height||!d||d.is_plain_text_element()&&d.constrained_by_container()||!d.use_scaling_transform?
$(a).css(b):(c!==d&&$(a).css(b),d.use_scaling_transform(b))}};k.font_size=function(a,c,d){var e,f;if(!a||!c)return 0;d||(d={});e=a.split(/[\s\-]/);f=e.map(function(a){return a.length}).reduce(function(a,b){return Math.max(a,b)},-Infinity);c/=b.FONT_ASPECT_RATIO*(f+(d.margin||0));if(1===e.length)return d.height?Math.min(c,d.height):c;a=Math.ceil(a.length/f);c*a>.9*d.height&&(c*=Math.sqrt(d.height/(c*a*1.2)),c*=.9);return c};k.map_arguments=function(a,b){for(var c=a.length,d=0,e=[];d<c;)e.push(b(a[d])),
d++;return e};k.conjunction=function(a,b){return a.map(function(c,d){var e;if("undefined"===typeof c)return"anything";e=b?k.add_a_or_an(c):c;return d===a.length-2?e+" and ":d===a.length-1?e:e+", "}).join("")};k.insert_function_bird_documentation=function(a,b){var c=TOONTALK[a]["function"],d=Object.keys(c),e="<table class='toontalk-function-bird-documentation-table'>";d.forEach(function(a,b){e+="<tr><td><div id='bird_id_"+b+"'></div></td><td class='toontalk-function-bird-name'>"+a+"</td><td class='toontalk-function-bird-title-documentation'>"+
c[a].title+"</td></tr>"});e+="</table>";$(b).html(e);d.forEach(function(b,c){var d=window.TOONTALK.bird.create_function(a,void 0,b),e=d.get_frontside_element();d.update_display();$("#bird_id_"+c).replaceWith($(e).addClass("toontalk-function-bird-documentation-bird"));e&&(e.id=encodeURIComponent(b))})};k.rerender_all=function(){$(".toontalk-side").each(function(a,b){var c=k.widget_side_of_element(b);c&&c.update_display(!0)})};k.visible_element=function(a){return a&&null!==a.offsetParent};k.get_audio_volume=
function(c){var d=document.hidden?0:b.volume;0===d&&a.push({audio_object:c,volume:c.volume});return d};k.play_audio=function(a){a.play();d.push(a);a.addEventListener("ended",function(){var b=d.indexOf(a);0<=b&&d.splice(b,1)})};k.mute_audio_objects_playing=function(){d.forEach(function(b){a.push({audio_object:b,volume:b.volume});b.volume=0});d=[]};k.stop_audio_objects=function(){d.forEach(function(a){a.pause();try{a.currentTime=0}catch(w){}})};k.restore_audio_volumes=function(){a.forEach(function(a){a.audio_object.volume=
a.volume;d.push(a.audio_object)});a=[]};k.is_attached=function(a){return jQuery.contains(window.document,a)};k.when_attached=function(a,b,c){var d=a.toontalk_attached_callback;jQuery.contains(window.document,a)&&!c?b():(a.toontalk_attached_callback=function(){d&&d();b();$(a).removeClass("toontalk-has-attached-callback");a.toontalk_attached_callback=void 0;a.toontalk_widget_side&&a.toontalk_widget_side.rerender()},c&&(a.toontalk_run_even_if_not_observable=!0),$(a).addClass("toontalk-has-attached-callback"))};
k.create_event=function(a,b){var c;try{c=new CustomEvent(a,{detail:b})}catch(K){c=document.createEvent("CustomEvent"),c.initCustomEvent(a,!1,!1,b)}return c};k.create_queue=function(){var a=[],c=0;return{getLength:function(){return a.length-c},isEmpty:function(){return 0==a.length},enqueue:function(c){var d=0==a.length;a.push(c);b.logging&&0<=b.logging.indexOf("queue")&&console.log(c._debug_string+" enqueued");return d},dequeue:function(){var d;if(0!=a.length)return d=a[c],b.logging&&0<=b.logging.indexOf("queue")&&
console.log(d._debug_string+" dequeued"),2*++c>=a.length&&(a=a.slice(c),c=0),d},peek:function(){return 0<a.length?a[c]:void 0},does_any_item_satisfy:function(b){var d;for(d=c;d<a.length;d++)if(b(a[d]))return!0;return!1}}};k.number_to_words=function(a){var b=a.indexOf("/"),c=function(a){var b="  half third fourth fifth sixth seventh eighth ninth tenth eleventh twelfth thirteenth fourteenth fifteenth sixteenth seventeenth eighteenth nineteenth twentieth".split(" ");if(20>=a)return b[a];if(0===a%10&&
100>a)return"thirtieth fortieth fiftieth sixtieth seventieth eightieth ninetieth".split(" ")[a/10-3];if(100===a)return"hundredth";if(1E3===a)return"thousandth";if(1E4===a)return"ten thousandth";if(1E5===a)return"hundred thousandth";if(1E6===a)return"millionth";if(1E7===a)return"ten millionth";if(1E8===a)return"hundred millionth";if(1E9===a)return"billionth"},d,e;if(0>b)return k.integer_to_words(a);d=a.substring(0,b);e="1"!==d&&"-1"!==d;return b+3>=a.length||!e&&b+11>=a.length?(c=c(parseInt(a.substring(b+
1))))?k.integer_to_words(d)+" "+c+(e?"s":""):k.integer_to_words(d)+" over "+k.integer_to_words(a.substring(b+1)):k.integer_to_words(a.substring(0,b))+" over "+k.integer_to_words(a.substring(b+1))};k.integer_to_words=function(a){var b="",c=" un duo tre quattuor quin se septe octo nove".split(" "),d="   *   sx mn  mx".split(" "),e=" deci viginti triginta quadraginta quinquaginta sexaginta septuaginta octoginta nonaginta".split(" "),f=" n ms ns ns ns n n mx m".split(" "),g=" centi ducenti trecenti quadringenti quingenti sescenti septingenti octingenti nongenti".split(" "),
h=" nx n ns ns ns n n mx m".split(" "),k=" milli dumilli tremilli quadrinmilli quinmilli sesmilli septinmilli octinmilli nonmilli".split(" "),l=" decimilli vigintimilli trigintamilli quadragintanmilli quinquagintamilli sexagintamilli septuagintamilli octogintamilli nonagintamilli".split(" "),m=" centimilli ducentimilli trecentimilli quadringentimilli quingentimilli sescentimilli septingentimilli octingentimilli nongentimilli".split(" "),p=" milli-milli milli-dumilli milli-tremilli milli-quadrinmilli milli-quinmilli milli-sesmilli milli-septinmilli milli-octinmilli milli-nonmilli".split(" "),
n="thousand million billion trillion quadrillion quintillion sextillion septillion octillion nonillion".split(" "),q,r,t,u,v,y,z,A,C,D,G,H,I=function(c){var d=0,e="",f;for(f=0;f<c;f++)if("0"!==a[f]||0<d)e+=a[f],d++;if(e){c=b;e=parseInt(e);f=" one two three four five six seven eight nine ten eleven twelve thirteen fourteen fifteen sixteen seventeen eighteen nineteen twenty".split(" ");var g=" ten twenty thirty forty fifty sixty seventy eighty ninety".split(" "),h="";100<=e&&(h+=f[Math.floor(e/100)]+
" hundred",e%=100,0<e&&10>e&&(h+=" and"));20<e?(""!=h&&(h+=" "),h+=g[Math.floor(e/10)],e%=10,0<e&&(h+="-")):""!=h&&0<e&&(h+=" ");0<e&&(h+=f[e]);b=c+h.toString()}return d},J=function(a,b){var c,d;if(void 0!==a&&void 0!==b)for(c=0;c<a.length;c++)for(d=0;d<b.length;d++)if(a[c]==b[d]||"*"===a[c]&&("s"===b[d]||"x"===b[d]))return b[d]};"-"===a[0]&&(b+="negative ",a=a.substring(1));for(;0<a.length&&"0"===a[0];)a=a.substring(1);if(0===a.length)return"zero";for(q=a.length;;){" "!==b[b.length-1]&&(b+=" ");
if(4>q){0===I(q)&&","===b.substring(b.length-1)&&(b=b.substring(0,b.length-1));break}r=q-4;t=1+r%3;u=I(t);a=a.substring(t);q-=t;0<u&&(" "!==b[b.length-1]&&(b+=" "),v=Math.floor(r/3),t=v%10,10>v?b+=n[v]:(u=Math.floor(v/10%10),r=Math.floor(v/100%10),z=Math.floor(v/1E3%10),A=Math.floor(v/1E4%10),C=Math.floor(v/1E5%10),D=Math.floor(v/1E6%10),G=c[t],v=e[u],H=g[r],z=k[z],A=l[A],C=m[C],D=p[D],y=void 0,G&&(b+=G,y=d[t]),v&&((t=J(y,f[u]))&&(b+=t),y=void 0,b+=v),H&&((t=J(y,h[r]))&&(b+=t),y=void 0,b+=H),b+=z,
b+=A,b+=C,b+=D,"a"===b[b.length-1]&&(b=b.substring(0,b.length-2)+"i"),b+="llion"),b+=",")}b=b.trim();c=b.lastIndexOf(", ");if(0<=c)return b.substring(0,c)+" and"+b.substring(c+1);","===b[b.length-1]&&(b=b.substring(0,b.length-1));return b};k.test_number_to_words=function(a){var b,c;for(b=0;b<a;b++)c=Math.round(1E9*Math.random()),console.log(c+" = "+k.number_to_words(c.toString()))};k.for_each_batch=function(a,b,c,d){var e,f;if(0!==a.length){void 0===d&&(d=0);c||(c=100);f=Math.min(a.length,d+c);for(e=
d;e<f;e++)try{b(a[e],e)}catch(ja){if(k.is_stack_overflow(ja)){k.set_timeout(function(){k.for_each_batch(a,b,c,e)});return}throw ja;}f<a.length&&k.set_timeout(function(){k.for_each_batch(a,b,c,f)})}};k.element_width=function(a){var c=$(a);if(c.is(".toontalk-conditions-contents"))return b.UTILITIES.get_toontalk_css_numeric_attribute("width",".toontalk-conditions-container");if(!c.is(".toontalk-not-observable"))return $(a).width()};k.element_height=function(a){var c=$(a);if(c.is(".toontalk-conditions-contents"))return b.UTILITIES.get_toontalk_css_numeric_attribute("height",
".toontalk-conditions-container");if(!c.is(".toontalk-not-observable"))return $(a).height()};k.resizable_and_scalable=function(a,b){var c=1,d=1,e;$(a).resizable({start:function(a,b){e={width:b.size.width,height:b.size.height}},resize:function(f,g){var h={width:g.size.width,height:g.size.height};$(a).is(".toontalk-backside-of-top-level")||(c*=h.width/e.width,d*=h.height/e.height,b(c,d),e=h)},handles:"n,e,s,w,se,ne,sw,nw"})};k.string_to_array=function(a,b){for(var c=[];a.length>b;)c.push(a.substr(0,
b)),a=a.substr(b);c.push(a);return c};k.listen_for_speech=function(a){var c,d,e,f,g,h,l,m;b.listen&&(c=a.commands||"",d=a.minimum_confidence||0,e=e||webkitSpeechGrammarList,window.speechSynthesis.speaking?setTimeout(function(){k.listen_for_speech(a)},1E3):(a.descriptions_acceptable&&(c+=" | I am | I'm "),a.names_acceptable&&(c+=" | My name is | call me "),f="#JSGF V1.0; grammar commands; public <commands> = "+c+";",e=new e,g=function(){try{aa.start()}catch(Sa){}},U=!0,aa="undefined"===typeof SpeechRecognition?
new webkitSpeechRecognition:new SpeechRecognition,e.addFromString(f,1),aa.grammars=e,aa.continuous=!1,aa.lang=k.translation_language_code(),aa.interimResults=!1,aa.maxAlternatives=5,aa.onresult=function(b){var e;for(m=0;m<b.results[0].length;m++)if(b.results[0][m].confidence>=d&&(e=b.results[0][m].transcript.toLowerCase(),!c||0<=c.indexOf(e+" |")||0<=c.indexOf("| "+e)||a.numbers_acceptable&&!isNaN(parseFloat(e))||a.descriptions_acceptable&&(0===e.indexOf("i am")||0===e.indexOf("i'm"))||a.names_acceptable&&
(0===e.indexOf("my name is")||0===e.indexOf("call me")))){h=b.results[0][m].transcript.toLowerCase();l=b.results[0][m].confidence;break}window.speechSynthesis.speaking?console.log("Ignoring speech since synthesising speech. "+(h||"")):h?(console.log(h+" confidence : "+l),a.descriptions_acceptable&&a.widget&&k.spoken_command_is_a_description(h,a.widget)?a.widget.rerender():a.names_acceptable&&a.widget&&k.spoken_command_is_a_naming(h,a.widget)?a.widget.rerender():a.success_callback&&a.success_callback(h,
b)):console.log("confidence too low");aa.stop()},aa.onend=function(){U&&g()},aa.onnomatch=function(b){a.fail_callback&&a.fail_callback(b)},aa.onerror=function(b){"no-speech"===b.error&&a.fail_callback&&a.fail_callback(b)},U&&g()))};k.stop_listening_for_speech=function(){aa&&(aa.stop(),U=!1)};k.spoken_command_is_a_description=function(a,b){var c;0===a.indexOf("i am")?c=a.substring(5):0===a.indexOf("i'm")&&(c=a.substring(4));if(c)return(k.get_dragee_copy()||b).set_description(c,!0,!0),k.display_message("The description of the "+
b.get_type_name()+' is now "'+c+'"'),!0};k.spoken_command_is_a_naming=function(a,b){var c;if(b.get_name&&(0===a.indexOf("my name is ")?c=a.substring(11):0===a.indexOf("call me ")&&(c=a.substring(8)),c))return(k.get_dragee_copy()||b).set_name(c,!0,!0),k.display_message("The name of the "+b.get_type_name()+' is now "'+c+'"'),!0};k.download_file=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a);c&&d.setRequestHeader("Authorization","Bearer "+c);d.onload=function(){b(d.responseText)};d.onerror=
function(){b(null)};d.send()};k.set_parameter=function(a,c){b[a]=c;"TRANSLATION_ENABLED"===a&&c&&v()};k.initialize=function(a){var c=function(){var a=function(a,c,d,e,f){a=document.getElementById(a);var g;a&&(b.CHROME_APP?(g=function(a){k.add_iframe_popup(c)},g=k.create_button(d,"toontalk-manual-button",e,g)):(g=document.createElement("a"),g.innerHTML=d,g.href=c,g.title=e,g.target="_blank",$(g).addClass("ui-widget toontalk-help-link"),k.use_custom_tooltip(g)),a.appendChild(g),$(g).css(f))};a("toontalk-manual-button",
"docs/manual/index.html?reset=1","Learn about ToonTalk","Click to visit the page that introduces everything.",{background:"yellow"});a("toontalk-manual-tour","docs/tours/tour1.html?reset=1","Watch a tour of ToonTalk","Click to visit a page that replays a tour.",{background:"pink"});a("toontalk-manual-whats-new","docs/manual/whats-new.html?reset=1","What's new?","Click to visit see what has changed recently.",{background:"cyan"})},d=function(a){try{window.speechSynthesis.cancel()}catch(B){}try{k.backup_all_top_level_widgets(!0)}catch(B){b.UTILITIES.report_internal_error(B)}};
a=function(){e=function(a){$(".toontalk-top-level-resource-container").each(function(a,b){var c=b.toontalk_widget_side;c&&c.set_running&&c.set_running(!1)})};b.debugging=k.get_current_url_parameter("debugging");b.logging=k.get_current_url_parameter("log");b.maximum_recursion_depth=100;b.volume=k.get_current_url_numeric_parameter("volume",10)/100;b.puzzle=k.get_current_url_boolean_parameter("puzzle",!1);b.open_backside_only_if_alt_key=k.get_current_url_boolean_parameter("alt_key_to_open_backside",
b.puzzle);b.reset=k.get_current_url_boolean_parameter("reset",b.puzzle);b.speak=k.get_current_url_boolean_parameter("speak",!1);b.listen=k.get_current_url_boolean_parameter("listen",!1);b.speak&&!window.speechSynthesis&&(b.speak=!1,k.display_message("This browser doesn't support speech output. speak=1 in URL ignored."));b.listen&&"undefined"===typeof SpeechRecognition&&"undefined"===typeof webkitSpeechRecognition&&(b.listen=!1,k.display_message("This browser doesn't support speech input. listen=1 in URL ignored."));
b.balloons=k.get_current_url_boolean_parameter("balloons",!0);b.TRANSLATION_ENABLED=k.get_current_url_boolean_parameter("translate",!1);b.FONT_ASPECT_RATIO=.64;b.animation_settings||(b.animation_settings={BIRD_ANIMATION_SPEED:.5,ROBOT_ANIMATION_SPEED:.25,BAMMER_ANIMATION_SPEED:.75,ANIMATION_SPEED:.5,OPEN_BACKSIDE_DURATION:500,CHANGE_SIZE_DURATION:1E3,BUTTON_USE_DELAY:200,STOP_TRAINING_DELAY:1500,PAUSE_BETWEEN_STEPS:50,PAUSE_BETWEEN_BIRD_STEPS:50});window.document.addEventListener("click",e);b.DEFAULT_QUEUE=
window.TOONTALK.queue.create();b.DEFAULT_QUEUE.start();b.CHROME_APP?chrome.runtime.onSuspend.addListener(d):window.addEventListener("beforeunload",d);b.TRANSLATION_ENABLED?v():$("#google_translate_element").remove();b.vacuum.the_vacuum||b.vacuum.create();k.add_test_all_button();c();G("toontalk-robot",b.robot);G("toontalk-empty-nest",b.nest);G("toontalk-bird-static",b.bird);$("[title]").each(function(a,b){k.use_custom_tooltip(b)});TOONTALK.RUNNING_LOCALLY||(function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=
e;a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)};a[e].l=1*new Date;f=b.createElement(c);g=b.getElementsByTagName(c)[0];f.async=1;f.src=d;g.parentNode.insertBefore(f,g)}(window,document,"script",b.CHROME_APP?TOONTALK.TOONTALK_URL+"libraries/analytics.js":"https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-57964541-1","auto"),b.CHROME_APP?(ga("set","checkProtocolTask",function(){}),ga("require","displayfeatures"),ga("send","pageview","/options.html")):ga("send","pageview"));
document.addEventListener("visibilitychange",function(){document.hidden?k.mute_audio_objects_playing():(k.rerender_all(),k.restore_audio_volumes())});setTimeout(function(){b.DISPLAY_UPDATES.update_display()},100);"undefined"===typeof b.cross_origin_url_function?k.download_file("https://toontalk.appspot.com/p/https%3A%2F%2Fdrive.google.com%2Fuc%3Fid%3D0B0taMM6vlEqQaWprd2d1ZnlmQWs",function(a){a&&"working"===a.trim()&&(b.cross_origin_url_function=function(a){return"https://toontalk.appspot.com/p/"+
encodeURIComponent(a)},b.is_already_cross_origin_url=function(a){return 0===a.indexOf("https://toontalk.appspot.com/p/")});k.process_json_elements()}):k.process_json_elements();f=!0;document.dispatchEvent(b.UTILITIES.create_event("toontalk_initialized",{}));0<b.volume&&setTimeout(R)};var e;f||(k.get_current_url_parameter("replace-with-url")?I(a):a())};k.do_after_initialization=function(a){f?a():document.addEventListener("toontalk_initialized",a)};return k}(window.TOONTALK);
window.initialize_toontalk=window.TOONTALK.UTILITIES.initialize;
