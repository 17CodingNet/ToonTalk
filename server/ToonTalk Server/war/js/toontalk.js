'use strict';window.TOONTALK.copy=function(b){return{create:function(a){var e=Object.create(this);a||console.log("path undefined in copy action");e.path=a;return e},run:function(a){a=b.UTILITIES.dereference_path(this.path,a);if(!a)return!1;this.robot.thing_in_hand=a.copy(!0);return!0},toString:function(){return"copy "+this.path.toString()},get_json:function(){return{type:"copy_action",path:this.path.get_json()}},create_from_json:function(a){return b.copy.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.copy_constant=function(b){return{create:function(a,e){var f=Object.create(this);f.robot=a;f.constant_object=e;return f},run:function(a){this.robot.thing_in_hand=this.constant_object.copy(!0);return!0},toString:function(){return"copy "+this.constant_object.toString()},get_json:function(){return{type:"copy_constant_action",constant_object:this.constant_object.get_json()}},create_from_json:function(a){return b.copy_constant.create(b.UTILITIES.create_from_json(a.constant_object))}}}(window.TOONTALK);window.TOONTALK.drop_on=function(b){return{create:function(a){var e=Object.create(this);e.path=a;return e},run:function(a){if(a=b.UTILITIES.dereference_path(this.path,a)){if(this.robot.thing_in_hand)return this.robot.thing_in_hand.drop_on(a),!0;console.log(this.robot.toString()+" is executing drop_on but has nothing in its hand.")}return!1},toString:function(){return"drop it on "+this.path.toString()},get_json:function(){return{type:"drop_on_action",path:this.path.get_json()}},create_from_json:function(a){return b.drop_on.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.pick_up=function(b){return{create:function(a){var e=Object.create(this);e.path=a;return e},run:function(a){a=b.UTILITIES.dereference_path(this.path,a);if(!a)return!1;this.robot.thing_in_hand=a;return!0},toString:function(){return"pick up "+this.path.toString()},get_json:function(){return{type:"pick_up_action",path:this.path.get_json()}},create_from_json:function(a){return b.pick_up.create(b.UTILITIES.create_from_json(a.path))}}}(window.TOONTALK);window.TOONTALK.pick_up_constant=function(b){return{create:function(a){var e=Object.create(this);e.constant_object=a;return e},run:function(a){this.robot.thing_in_hand=this.constant_object;return!0},toString:function(){return"pick up "+this.constant_object.toString()},get_json:function(){return{type:"pick_up_constant_action",object:this.constant_object.get_json()}},create_from_json:function(a){return b.pick_up_constant.create(b.UTILITIES.create_from_json(a.object))}}}(window.TOONTALK);window.TOONTALK.widget=function(b){return{erasable:function(a){var e;a.get_erased=function(){return e};a.set_erased=function(a){e=a};return a},add_sides_functionality:function(a){var e,f;a.get_frontside=function(f){f&&!e&&(e=b.frontside.create(a));return e};a.get_backside=function(e){e&&!f&&(f=a.create_backside());return f};a.forget_backside=function(){var a=this.get_backside_widgets();a&&(this.backside_widgets=a);f=void 0};return a},remove:function(){var a=this.get_backside(),e=this.get_frontside();
a&&a.remove();e&&e.remove()},get_frontside_element:function(a){var e=this.get_frontside&&this.get_frontside(!0);if(e)return a&&this.update_display(),e.get_element()},dereference:function(){return this},add_to_json:function(a){var e;if(a){this.get_erased()&&(a.erased=!0);if(e=this.get_frontside_element&&this.get_frontside_element())a.width=$(e).width(),a.height=$(e).height();e=this.get_backside_widgets();0<e.length&&(a.backside_widgets=b.UTILITIES.get_json_of_array(e));return a}console.log("get_json not defined");
return{}},get_backside_widgets:function(){var a=this.get_backside();return a?a.get_widgets():this.backside_widgets?this.backside_widgets:[]},set_backside_widgets:function(a){this.backside_widgets=a},add_to_copy:function(a){var e=this.get_backside_widgets();this.get_erased()&&a.set_erased(this.get_erased());0<e.length&&a.set_backside_widgets(b.UTILITIES.copy_widgets(e));return a},get_type_name:function(){return""},copy:function(){console.assert(!1,"copy not implemented")},visible:function(){var a=
this.get_frontside();return a?$(a.get_element()).is(":visible"):!1},equals:function(a){console.assert(!1,"equals not implemented")},match:function(a){console.assert(!1,"copy not implemented")},drop_on:function(a,e,f){console.log("drop_on not implemented; this is "+this.toString()+" and other is "+a.toString());return!1},removed:function(a){console.log("removed not implemented")},update_display:function(){console.assert(!1,"update_display not implemented")},equals_box:function(){return!1},equals_number:function(){return!1},
match_box:function(){return"not matched"},match_number:function(){return"not matched"}}}(window.TOONTALK);window.TOONTALK.backside=function(b){return{create:function(a){var e=Object.create(this),f=document.createElement("div"),h=$(f),k,l,n;h.addClass("toontalk-backside toontalk-side");e.get_element=function(){return f};e.get_widget=function(){return a};a.get_backside||(a.get_backside=function(){return e});a.drop_on||(a.drop_on=function(c,a,f){h.append(a);b.UTILITIES.set_position_absolute(a.get(0),!0,f);a.is(".toontalk-frontside")&&(a.addClass("toontalk-frontside-on-backside"),c.update_display());return!0});
a.removed||(a.removed=function(c,a,f){a.removeClass("toontalk-frontside-on-backside")});e.widget_dropped_on_me=function(c,a){var f=c.get_frontside(!0).get_element(),e=$(f);h.append(e);b.UTILITIES.set_position_absolute(f,!0,a);return!0};b.backside.associate_widget_with_backside_element(a,e,f);b.UTILITIES.drag_and_drop(h,a);h.resizable({start:function(){k||(k=h.width());l||(l=h.height())},resize:function(c,a){var f=100*Math.min(1,h.width()/k,h.height()/l);h.css({"font-size":f+"%"})},handles:"n,e,s,w,se,ne,sw,nw"});
$(f).on("DOMNodeInserted",function(c){var a=$(c.originalEvent.srcElement);a.is(".toontalk-frontside")&&a.parent().is(".toontalk-backside")&&(a.addClass("toontalk-frontside-on-backside"),a.is(".ui-resizable")&&a.resizable("enable"),(a=a.data("owner"))&&a.update_display());c.stopPropagation()});$(f).on("DOMNodeRemoved",function(c){var a=$(c.originalEvent.srcElement);a.is(".toontalk-frontside")&&a.removeClass("toontalk-frontside-on-backside");c.stopPropagation()});a.get_backside_widgets&&(n=a.get_backside_widgets(),
setTimeout(function(){var c,a;for(c=0;c<n.length;c++)a=n[c].get_frontside_element(!0),$(a).data("owner",n[c]),$(f).append(a)},1));return e},associate_widget_with_backside_element:function(a,e,f){$(f).data("owner",a);return a},remove:function(){$(this.get_element()).remove()},create_standard_buttons:function(a,e){var f=b.backside.create_run_button(a,e),h=b.backside.create_copy_button(a,e),k=b.backside.create_hide_button(a,e),l=b.backside.create_remove_button(a,e);return b.UTILITIES.create_button_set(f,
h,l,k)},create_hide_button:function(a,e){var f=a.get_element(),h=$(f),f=$("<button>Hide</button>").button();f.addClass("toontalk-hide-backside-button");f.click(function(){e&&e.forget_backside&&e.forget_backside();h.remove()});f.attr("title","Click to hide this.");return f.get(0)},create_copy_button:function(a,e){var f=a.get_element();$(f);f=$("<button>Copy</button>").button();f.addClass("toontalk-copy-backside-button");f.click(function(){var a=e.copy(),f=e.get_frontside_element(),a=a.get_frontside_element(),
l=$(f).position();$(a).css({width:$(f).width(),height:$(f).height(),left:l.left+10,top:l.top+10});$(f).parent().append(a)});f.attr("title","Click to make a copy of this "+e.get_type_name());return f.get(0)},create_run_button:function(a,e){var f=a.get_element(),h=$(f),k=$("<button>Run</button>").button(),l=!0,b;k.addClass("toontalk-run-backside-button");k.click(function(){h.children(".toontalk-robot").each(function(c,a){if(b=$(a).data("owner"))l?(b.set_stopped(!1),b.run(e)):b.set_stopped(!0)});l?(k.button("option",
"label","Stop"),k.attr("title","Click to stop running the robots on this "+e.get_type_name())):(k.button("option","label","Run"),k.attr("title","Click to run the robots on this "+e.get_type_name()));l=!l});k.attr("title","Click to run the robots on this "+e.get_type_name());return k.get(0)},create_remove_button:function(a,e){var f=$("<button>Remove</button>").button();f.addClass("toontalk-remove-backside-button");f.click(function(){e&&e.remove&&e.remove()});f.attr("title","Click to remove this "+
e.get_type_name());return f.get(0)},get_widgets:function(){var a=[];$(this.get_element()).children().each(function(e,f){var h=$(f).data("owner");h&&(a[a.length]=h)});return a}}}(window.TOONTALK);window.TOONTALK.condition=function(b){return{create:function(a){var e=Object.create(this);e.items=a;return e},copy:function(){return this.create(this.items)},match:function(a){return this.items.match(a)}}}(window.TOONTALK);window.TOONTALK.frontside=function(b){return{create:function(a){var e=Object.create(this),f=document.createElement("div"),h=$(f);$(f).addClass("toontalk-frontside toontalk-side");h.data("owner",a);b.UTILITIES.drag_and_drop(h,a);e.get_element=function(){return f};e.get_widget=function(){return a};h.click(function(e){var h=a.get_backside(),b,c;if(!$(e.target).is(".ui-resizable-handle")&&!h){b=$(f).parent();for(c=$(f);!b.is(".toontalk-backside");)c=b,b=b.parent();c=c.get(0);h=a.get_backside(!0);h=h.get_element();
$(h).data("owner",a);$(h).css({left:c.offsetLeft+c.offsetWidth,top:c.offsetTop});b.append(h);e.stopPropagation()}});return e},update_display:function(){return this.get_widget().update_display()},remove:function(){$(this.get_element()).remove()}}}(window.TOONTALK);window.TOONTALK.number=function(b){var a=Object.create(b.widget),e=function(a,f,c){var e="",h=100;f=(f-1)/f;if(c)for(c=0;1<=h&&c<a.length;)e=e+"<span class='toontalk-digit' style='font-size:"+h+"%'>"+a[c]+"</span>",c+=1,"-"!==a[c]&&(h*=f);else for(c=a.length-1;1<=h&&0<c;)e="<span class='toontalk-digit' style='font-size:"+h+"%'>"+a[c]+"</span>"+e,c-=1,"-"!==a[c]&&(h*=f);return e},f=function(a,h){if(a.length<=Math.round(h))return'<span class="toontalk-digit" style="font-size:100%">'+a+"</span>";if(1>
h)return"";if(5>h)return"<span style='font-size: 80%'>"+f(a,1.25*h)+"</span>";var c=h/2;return e(a,c,!0)+e(a,c,!1)},h=function(a,f){f||(f=1);if(!("number"!==typeof a&&"string"!==typeof a||"number"!==typeof f&&"string"!==typeof f))return bigrat.fromValues(a,f);var c=bigrat.create();1===f?bigrat.set(c,bigrat.toBigInteger(a.get_value()),BigInteger.ONE):a.get_value&&f.get_value?bigrat.set(c,bigrat.toBigInteger(a.get_value()),bigrat.toBigInteger(f.get_value())):bigrat.set(c,a,f);return c},k=function(a){switch(a){case "+":return"";
case "-":return"&minus;";case "*":return"&times;";case "/":return"&divide;";case "^":return"^";default:return console.log("Number has an unsupported operator: "+a),""}};a.create=function(f,e,c,k){var q=Object.create(a),g=h(f,e);k||(k="improper_fraction");c||(c="+");q.set_value=function(a,m){var d,c;g=a;m?this.update_display():(d=this.get_frontside(),c=this.get_backside(),d&&b.DISPLAY_UPDATES.add_dirty_side(d),c&&b.DISPLAY_UPDATES.add_dirty_side(c));b.debugging&&(this.debug_string=this.toString());
return this};q.get_value=function(){return g};q.set_format=function(a,m){k=a;m&&this.update_display();return this};q.get_operator=function(){return c};q.set_operator=function(a,m){c=a;m&&this.update_display();return this};q.get_format=function(){return k};q=a.add_sides_functionality(q);return q=a.erasable(q)};a.create_backside=function(){return b.number_backside.create(this)};a.set_from_values=function(a,f,c){return this.set_value(h(a,f),c)};a.ONE=function(){return this.create(1)};a.ZERO=function(){return this.create(0)};
a.copy=function(f){var e=a.create(this.get_value()[0],this.get_value()[1],this.get_operator(),this.get_format());return f?e:this.add_to_copy(e)};a.is_number=function(){return!0};a.equals=function(a){return a.equals_number(this)};a.equals_number=function(a){return bigrat.equals(this.get_value(),a.get_value())};a.update_display=function(){var a=this.get_frontside();if(a){var a=a.get_element(),f=$(a).parent().is(".toontalk-backside")?$(a):$(a).parent(),c=f.width(),f=0.8*f.height(),c=c/(0.64*f);4>c&&
"decimal"===this.get_format()&&(f=f*c/4,c=4);c=this.to_HTML(c,f,this.get_format(),!0,this.get_operator());a.firstChild||a.appendChild(document.createElement("div"));a.firstChild.innerHTML=c;$(a.firstChild).addClass("toontalk-widget")}};a.drop_on=function(a,f,c){if(a.number_dropped_on_me)return a.number_dropped_on_me(this,c),c&&a.update_display(),this.remove(),!0;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,c);console.log("No handler for drop of "+this.toString()+" on "+a.toString())};
a.number_dropped_on_me=function(a,f,c,e){switch(a.get_operator()){case "+":return this.add(a);case "-":return this.subtract(a);case "*":return this.multiply(a);case "/":return this.divide(a);case "^":return this.power(a);default:return console.log("Number received a number with unsupported operator: "+a.get_operator()),this}};a.add=function(a){this.set_value(bigrat.add(bigrat.create(),this.get_value(),a.get_value()));return this};a.subtract=function(a){this.set_value(bigrat.subtract(bigrat.create(),
this.get_value(),a.get_value()));return this};a.multiply=function(a){this.set_value(bigrat.multiply(bigrat.create(),this.get_value(),a.get_value()));return this};a.divide=function(a){this.set_value(bigrat.divide(bigrat.create(),this.get_value(),a.get_value()));return this};a.power=function(a){this.set_value(bigrat.power(bigrat.create(),this.get_value(),bigrat.toInteger(a.get_value())));return this};a.absolute_value=function(){this.set_value(bigrat.abs(bigrat.create(),this.get_value()));return this};
a.is_zero=function(){return bigrat.equals(this.get_value(),bigrat.ZERO)};a.is_negative=function(){return bigrat.isNegative(this.get_value())};a.toString=function(){return("+"===this.get_operator()?"":this.get_operator())+bigrat.str(this.get_value())};a.get_type_name=function(){return"number"};a.get_json=function(){return this.add_to_json({type:"number",operator:this.get_operator(),numerator:this.numerator_string(),denominator:this.denominator_string()})};a.create_from_json=function(f){return a.create(f.numerator,
f.denominator,f.operator)};a.to_HTML=function(a,e,c,h,b){var g=!1!==h?" toontalk-top-level-number":"";b=b?k(b):"";a||(a=4);e||(e=16);0<b.length&&(a-=1);if(this.is_integer())return h=bigrat.toBigInteger(this.get_value()).toString(),'<div class="toontalk-number toontalk-integer'+g+'" style="font-size: '+e+'px;">'+b+f(h,a)+"</div>";if("improper_fraction"===c||!c)return a='<table class="toontalk-number toontalk-improper-fraction'+g+'" style="font-size: '+0.5*e+'px;"><tr class="toontalk-numerator"><td align="center" class="toontalk-number">'+
f(this.numerator_string(),2*a)+'</td></tr><tr class="toontalk-fraction-line-as-row"><td  class="toontalk-fraction-line-as-table-entry"><hr class="toontalk-fraction-line"></td></tr><tr class="toontalk-denominator"><td align="center" class="toontalk-number">'+f(this.denominator_string(),2*a)+"</td></tr></table>",""===b?a:"<table class='toontalk-operator-and-fraction'><tr><td>"+b+"</td><td>"+a+"</td></tr></table>";if("proper_fraction"===c){b=this.integer_part();if(b.is_zero())return this.to_HTML(a,e,
"improper_fraction",h);h=this.copy().subtract(b).absolute_value();return'<table class="toontalk-number toontalk-proper_fraction'+g+'" style="font-size: '+0.5*e+'px;"><tr><td class="toontalk-number toontalk-integer-part-of-proper-fraction">'+b.to_HTML(a,e,"",!1,this.get_operator())+'</td><td class="toontalk-number toontalk-fraction-part-of-proper_fraction">'+h.to_HTML(a,e,"improper_fraction",!1)+"</td></tr></table>"}if("decimal"===c)return'<div class="toontalk-number toontalk-decimal'+g+'" style="font-size: '+
e+'px;">'+b+this.decimal_string(a,e)+"</div>"};a.is_integer=function(){return 0===this.get_value()[1].compare(BigInteger.ONE)};a.numerator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[0],BigInteger.ONE)};a.denominator=function(){var a=bigrat.create();return bigrat.set(a,this.get_value()[1],BigInteger.ONE)};a.numerator_string=function(){return this.get_value()[0].toString()};a.denominator_string=function(){return this.get_value()[1].toString()};a.integer_part=function(){return this.create(this)};
a.decimal_string=function(a,h){if(this.is_integer())return this.numerator_string();var c=this.copy(),k=c.integer_part(),b=k.toString();"0"===b&&this.is_negative()&&(b="-"+b);var g=c.subtract(k),c=Math.min(b.length,a/2),k=a-(c+0.5),p;a:{var m;p=k*h/20;var d="";m=g.absolute_value();g=m.get_value()[0];m=m.get_value()[1];for(var u=new BigInteger(10);p>d.length;)if(g=g.multiply(u),0>g.compare(m))d+="0";else if(d+=g.divide(m).toString(),g=g.remainder(m).multiply(u),g.isZero()){p=d;break a}p=d}p.length<
k&&(c=a-p.length,k=p.length);return f(b,c,h)+"<span class='toontalk-decimal-point' style='font-family: serif'>.</span>"+e(p,k,!0)};a.match=function(a){return this.get_erased()?a.match_with_any_number():a.match_with_this_number(this)};a.match_with_any_number=function(){return"matched"};a.match_with_this_number=function(a){return a.equals(this)?"matched":"not matched"};return a}(window.TOONTALK);
window.TOONTALK.number_backside=function(b){return{create:function(a){var e=b.backside.create(a),f=e.get_element(),h=b.UTILITIES.create_text_input(a.numerator_string(),"toontalk-numerator-input","","Type here to edit the numerator"),k=document.createElement("div");k.innerHTML="/";$(k).addClass("ui-widget");var l=b.UTILITIES.create_text_input(a.denominator_string(),"toontalk-denominator-input","","Type here to edit the denominator"),n=b.UTILITIES.create_radio_button("number_format","decimal","Decimal",
"Display number as a decimal."),c=b.UTILITIES.create_radio_button("number_format","proper_fraction","Proper fraction","Display number as a proper fraction with an integer part and a fraction."),t=b.UTILITIES.create_radio_button("number_format","improper_fraction","Improper fraction","Display number as a simple fraction."),q=b.UTILITIES.create_radio_button("operator","+","&plus;","Add me to what I'm dropped on."),g=b.UTILITIES.create_radio_button("operator","-","&minus;","Subtract me from what I'm dropped on."),
p=b.UTILITIES.create_radio_button("operator","*","&times;","Multiply me with what I'm dropped on."),m=b.UTILITIES.create_radio_button("operator","/","&divide;","Divide me into what I'm dropped on."),d=b.UTILITIES.create_radio_button("operator","^","Integer power","Use me as the number of times to multiply together what I'm dropped on."),u=function(){a.set_from_values(h.button.value.trim(),l.button.value.trim(),!0)},w=function(){a.set_format(b.UTILITIES.selected_radio_button(n.button,c.button,t.button).value,
!0)},v=function(){a.set_operator(b.UTILITIES.selected_radio_button(q.button,g.button,p.button,m.button,d.button).value,!0)},k=b.UTILITIES.create_horizontal_table(h.container,k,l.container),r=$(b.UTILITIES.create_horizontal_table(n.container,c.container,t.container)).buttonset().get(0),x=$(b.UTILITIES.create_horizontal_table(q.container,g.container,p.container,m.container,d.container)).buttonset().get(0),s=b.backside.create_standard_buttons(e,a);f.appendChild(k);f.appendChild(r);f.appendChild(x);f.appendChild(s);
h.button.onchange=u;l.button.onchange=u;n.button.onchange=w;c.button.onchange=w;t.button.onchange=w;switch(a.get_format()){case "decimal":b.UTILITIES.check_radio_button(n);break;case "improper_fraction":b.UTILITIES.check_radio_button(t);break;case "proper_fraction":b.UTILITIES.check_radio_button(c)}switch(a.get_operator()){case "+":b.UTILITIES.check_radio_button(q);break;case "-":b.UTILITIES.check_radio_button(g);break;case "*":b.UTILITIES.check_radio_button(p);break;case "/":b.UTILITIES.check_radio_button(m);
break;case "^":b.UTILITIES.check_radio_button(d)}q.button.onchange=v;g.button.onchange=v;p.button.onchange=v;m.button.onchange=v;d.button.onchange=v;e.update_display=function(){var m=this.get_widget();$(h.button).val(m.numerator_string());$(l.button).val(m.denominator_string())};return e}}}(window.TOONTALK);window.TOONTALK.box=function(b){var a=Object.create(b.widget);a.create=function(e,f,h){var k=Object.create(a);h||(h=[]);f||(f=!0);k.get_size=function(){return e};k.set_size=function(a,f){e=a;h.length=e;f&&this.update_display();b.debugging&&(this.debug_string=this.toString());return this};k.get_horizontal=function(){return f};k.set_horizontal=function(a,e){f=a;e&&this.update_display();return this};k.get_hole=function(a){return h[a]};k.set_hole=function(a,f,c){h[a]=f;c&&this.update_hole_display(a);
b.debugging&&(this.debug_string=this.toString())};k=k.add_sides_functionality(k);return k=k.erasable(k)};a.copy=function(e){var f=a.create(this.get_size(),this.get_horizontal()),h=this.get_size(),k,b;for(k=0;k<h;k+=1)(b=this.get_hole(k))&&f.set_hole(k,b.copy());return e?f:this.add_to_copy(f)};a.create_backside=function(){return b.box_backside.create(this)};a.equals=function(a){return a.equals_box(this)};a.equals_box=function(a){var f=this.get_size(),h,k,b;if(f!==a.get_size())return!1;for(h=0;h<f;h+=
1)if(k=this.get_hole(h),b=a.get_hole(h),!k&&b||k&&!b||k&&b&&!k.equals(b))return!1;return!0};a.match=function(a){return this.get_erased()?a.match_with_any_box?a.match_with_any_box():"not matched":a.match_with_this_box(this)};a.match_with_any_box=function(){return"matched"};a.match_with_this_box=function(a){var f=this.get_size(),h=[],k,b,n;if(f!==a.get_size())return"not matched";for(k=0;k<f;k+=1)if(n=a.get_hole(k)){b=this.get_hole(k);if(!b)return"not matched";b=n.match(b);if("not matched"===b)return"not matched";
"matched"!==b&&(h=0===h.length?b:h.concat(b))}return 0<h.length?h:"matched"};a.toString=function(){var a="",f=this.get_size(),h,k;for(h=0;h<f;h+=1)a=(k=this.get_hole(h))?a+k.toString():a+"_",h<f-1&&(a+=" | ");return"["+a+"]"};a.get_type_name=function(){return"box"};a.get_json=function(){var a=[],f=this.get_size(),h;for(h=0;h<f;h+=1)this.get_hole(h)&&(a[h]=this.get_hole(h).get_json());return this.add_to_json({type:"box",contents:a,horizontal:this.get_horizontal()})};a.create_from_json=function(e){return a.create(e.contents.length,
e.horizontal,b.UTILITIES.create_array_from_json(e.contents))};a.to_HTML=function(){var a=this.get_horizontal(),f=a?"horizontal":"vertical",h="<table class='toontalk-box toontalk-box-"+f+"'>",k=this.get_size(),b;b=0===k?1:100/k;var n=a?" style='width:"+b+"%;'":"",c=a?"":" style='height:"+b+"%;'",h=h+("<tr"+c+">");for(b=0;b<k;b+=1)h+="<td class='toontalk-box-hole toontalk-box-hole-"+f+"'"+n+">",h+="<div class='toontalk-hole-about-to-be-replaced' />",h+="</td>",a||(h+="</tr>",b+1<k&&(h+="<tr"+c+">"));
a&&(h+="</tr>");return h+"</table>"};a.update_display=function(){if(this.visible()){var a=this.get_frontside().get_element(),f=this.to_HTML(),h=this;a.firstChild||a.appendChild(document.createElement("div"));a.firstChild.innerHTML=f;$(a.firstChild).addClass("toontalk-widget");$(".toontalk-hole-about-to-be-replaced").each(function(a,f){h.update_hole_display(a,f)})}};a.update_hole_display=function(a,f){if(this.visible()){var h=this.get_hole(a),k;h||(h=b.box_empty_hole.create(a,this),this.set_hole(a,
h));k=h.get_frontside(!0);f&&f.parentNode?(h=k.get_element(),f.parentNode.replaceChild(h,f),b.UTILITIES.set_position_absolute(h,!1),$(h).addClass("toontalk-frontside-in-box")):(f=h.get_frontside(!0).get_element(),h=this.get_frontside(),h=$(h.get_element()).find(".toontalk-box-hole").eq(a),h.append(f),b.UTILITIES.set_position_absolute(f,!1),$(f).addClass("toontalk-frontside-in-box"));k.update_display()}};a.empty_hole=function(a,f){this.set_hole(a,b.box_empty_hole.create(a,this),f)};a.dereference=function(a){var f;
if(a){f=a.get_index&&a.get_index();if("number"===typeof f&&(f=this.get_hole(f)))return a.next?f.dereference(a.next):f;console.log("box "+this.toString()+" unable to dereference path "+a.toString())}else return this};a.drop_on=function(a,f,h){if(a.box_dropped_on_me)return f=a.box_dropped_on_me(this,h),h&&a.update_display(),this.remove(),f;if(a.widget_dropped_on_me)return a.widget_dropped_on_me(this,h);console.log("No handler for drop of "+this.toString()+" on "+a.toString())};a.box_dropped_on_me=function(a,
f){console.log("box on box not yet implemented");return!1};a.removed=function(a,f,h){f=this.get_size();var b;b=a.get_frontside();h=!!h;b&&$(b.get_element()).removeClass("toontalk-frontside-in-box");for(b=0;b<f;b+=1)if(a===this.get_hole(b))return this.empty_hole(b,h),this};a.path={create:function(a){return{get_index:function(){return a},toString:function(){return"box hole "+a+(this.next?"; "+this.next.toString():"")},get_json:function(){return{type:"box_path",index:a,next:this.next&&this.next.get_json()}}}},
create_from_json:function(e){var f=a.path.create(e.index);e.next&&(f.next=b.UTILITIES.create_from_json(e.next));return f}};b.debugging&&(a.debug_string=this.toString());return a}(window.TOONTALK);
window.TOONTALK.box_backside=function(b){return{create:function(a){var e=b.backside.create(this),f=b.UTILITIES.create_text_input(a.get_size().toString(),"toontalk-box-size-input","Number of holes","Type here to edit the number of holes."),h=b.UTILITIES.create_radio_button("box_orientation","horizontal","Left to right","Show box horizontally."),k=b.UTILITIES.create_radio_button("box_orientation","vertical","Top to bottom","Show box vertically."),l=function(){a.set_horizontal("horizontal"===b.UTILITIES.selected_radio_button(h.button,
k.button).value,!0)},n=e.get_element(),c=b.backside.create_standard_buttons(e,a);f.button.onchange=function(){a.set_size(parseInt(f.button.value.trim(),10),!0)};h.button.onchange=l;k.button.onchange=l;n.appendChild(f.container);n.appendChild($(b.UTILITIES.create_horizontal_table(h.container,k.container)).buttonset().get(0));a.get_horizontal()?b.UTILITIES.check_radio_button(h):b.UTILITIES.check_radio_button(k.button);n.appendChild(c);return e},update_display:function(){var a=b.UTILITIES.get_first_child_with_class(this.get_element(),
"toontalk-box-size-input"),e=this.get_widget();a.value=e.get_size().toString()}}}(window.TOONTALK);
window.TOONTALK.box_empty_hole=function(b){return{create:function(a,e){var f=Object.create(this),h=document.createElement("div");h.className="toontalk-empty-hole toontalk-frontside toontalk-side";f.get_frontside=function(){return h};f.update_display=function(){};f.get_frontside=function(){return this};f.get_element=function(){return h};f.widget_dropped_on_me=function(f){e.set_hole(a,f,!0);e.update_display()};f.get_json=function(){return null};f.copy=function(){return b.box_empty_hole.create(a,e)};
$(h).on("drop",function(f){var l=b.UTILITIES.data_transfer_json_object(f),n=$("#"+l.id_of_original_dragree);1<=n.length&&(f.stopPropagation(),0<$(h).parents("#"+l.id_of_original_dragree).length||(f=n.data("owner"),b.UTILITIES.restore_resource(n,f),n.is(".ui-resizable")&&(n.resizable("disable"),n.removeClass("ui-state-disabled")),e.set_hole(a,f),e.update_display()))});$(h).data("owner",f);return f},toString:function(){return"_"}}}(window.TOONTALK);window.TOONTALK.robot=function(b){var a=Object.create(b.widget);a.create=function(e,f,h,k,l,n){var c=Object.create(this);h||(h="images/robot.png");l||(l=100);n||(n=100);c.get_bubble=function(){return e};c.get_body=function(){return f};c.get_image_url=function(){return h};c.set_image_url=function(a,c){h=a;c&&this.update_display()};c.get_width=function(){return l};c.set_width=function(a){l=a};c.get_height=function(){return n};c.set_height=function(a){n=a};c.get_description=function(){return k?k:c.toString()};
c.set_description=function(a,c){k=a;c&&this.update_display()};f.set_robot(c);b.debugging&&(c.debug_string=c.toString());c=a.add_sides_functionality(c);return c=a.erasable(c)};a.create_backside=function(){return b.robot_backside.create(this)};a.copy=function(a){var f=this.create(this.get_bubble().copy(),this.get_body(),this.get_image_url(),this.get_description(),this.get_width(),this.get_height());return a?f:this.add_to_copy(f)};a.run=function(a,f){var h,k;if(this.stopped)return"not matched";h=this.get_bubble().match(a);
switch(h){case "matched":return f||(f=b.QUEUE),f.enqueue({robot:this,context:a,queue:f}),h;case "not matched":return this.next_robot?this.next_robot.run(a,f):h;default:for(k=0;k<h.length;k+=1)h[k].run_when_non_empty(this);return h}};a.set_stopped=function(a){this.stopped=a};a.run_actions=function(a,f){return this.get_body().run(a,f)};a.update_display=function(){var a=this.get_frontside(),f;a&&(f=a.get_element(),a=this.to_HTML(),f.firstChild||f.appendChild(document.createElement("div")),f.firstChild.innerHTML=
a,$(f).addClass("toontalk-robot"),f.style.width=this.get_width(),f.style.height=this.get_height(),$(f.firstChild).addClass("toontalk-widget"))};a.to_HTML=function(){var a=this.get_description(),a=a?"This robot "+a:"This is a "+this.toString();return"<img src='"+this.get_image_url()+"' title='"+a+"' width='100%' height='100%'></img>"};a.toString=function(){return"when given something that matches"+(this.get_bubble().get_erased()?" an erased ":" a ")+this.get_bubble().toString()+" will "+this.get_body().toString()};
a.get_type_name=function(){return"robot ("+this.get_description()+")"};a.get_json=function(){return this.add_to_json({type:"robot",bubble:this.get_bubble().get_json(),body:this.get_body().get_json(),image_url:this.get_image_url(),description:this.get_description()})};a.create_from_json=function(a){return b.robot.create(b.UTILITIES.create_from_json(a.bubble),b.UTILITIES.create_from_json(a.body),a.image_url,a.width,a.height,a.description)};return a}(window.TOONTALK);
window.TOONTALK.robot_backside=function(b){return{create:function(a){var e=b.backside.create(a),f=e.get_element(),h=b.UTILITIES.create_text_input(a.get_image_url(),"toontalk-image-url-input","Image URL","Type here to provide a URL for the appearance of this robot."),k=b.UTILITIES.create_text_input(a.get_description(),"toontalk-robot-description-input","Description","Type here to provide a better descprion of this robot."),l,n=b.backside.create_standard_buttons(e,a);h.button.onchange=function(){a.set_image_url(h.button.value.trim(),
!0)};k.button.onchange=function(){a.set_description(k.button.value.trim(),!0)};l=b.UTILITIES.create_vertical_table(k.container,h.container);$(l).css({width:"90%"});f.appendChild(l);f.appendChild(n);return e},update_display:function(){var a=b.UTILITIES.get_first_child_with_class(this.get_element(),"toontalk-image-url-input"),e=this.get_widget();a.value=e.get_image_url()}}}(window.TOONTALK);window.TOONTALK.DISPLAY_UPDATES=function(b){var a=[];return{add_dirty_side:function(b){var f;if(b.update_display){for(f=0;f<a.length;f+=1)if(a[f]===b)return;a.push(b)}},update_display:function(){var b;for(b=0;b<a.length;b+=1)a[b].update_display();a=[]}}}(window.TOONTALK);window.TOONTALK.actions=function(b){return{create:function(a){var b,f=Object.create(this);a||(a=[]);f.get_steps=function(){return a};f.get_robot=function(){return b};f.set_robot=function(f){b=f;for(f=0;f<a.length;f+=1)a[f].robot=b};return f},add:function(a){a.robot=this.get_robot();this.get_steps()[this.get_steps().length]=a},run:function(a,b){var f,h=this.get_steps();for(f=0;f<h.length;f++)h[f].run(a);this.get_robot().run(a,b)},toString:function(){var a="",b,f=this.get_steps();for(b=0;b<f.length;b++)a+=
f[b].toString(),b===f.length-2?a+=" and ":b<f.length-2&&(a+=", ");return a},get_json:function(){return{type:"body",steps:b.UTILITIES.get_json_of_array(this.get_steps())}},create_from_json:function(a){return b.actions.create(b.UTILITIES.create_array_from_json(a.steps))}}}(window.TOONTALK);window.TOONTALK.queue=function(b){return{create:function(){var a=Object.create(this);a.to_run=[];return a},enqueue:function(a){return this.to_run.push(a)},dequeue:function(){return this.to_run.shift()},maximum_run:1,paused:!1,run:function(a,e){for(var f,h=(new Date).getTime()+this.maximum_run,k=this;0<this.to_run.length;){if(this.paused)return;f=(new Date).getTime();if(f>=h)break;f=this.dequeue();f.robot.run_actions(f.context,f.queue);if(a&&(a-=1,0===a)){this.to_run=[];b.DISPLAY_UPDATES.update_display();
e&&e();return}}b.DISPLAY_UPDATES.update_display();setTimeout(function(){k.run(a,e)},0)}}}(window.TOONTALK);window.TOONTALK.QUEUE=window.TOONTALK.queue.create();window.TOONTALK.path_to_entire_context=function(b){return{toString:function(){return"the entire context"},get_json:function(){return{type:"path_to_entire_context"}},create_from_json:function(){return b.path_to_entire_context}}}(window.TOONTALK);window.TOONTALK.UTILITIES=function(b){var a={box:b.box.create_from_json,number:b.number.create_from_json,robot:b.robot.create_from_json,body:b.actions.create_from_json,pick_up_constant_action:b.pick_up_constant.create_from_json,pick_up_action:b.pick_up.create_from_json,drop_on_action:b.drop_on.create_from_json,copy_constant_action:b.copy_constant.create_from_json,copy_action:b.copy.create_from_json,box_path:b.box.path.create_from_json,path_to_entire_context:b.path_to_entire_context.create_from_json},
e=(new Date).getTime();return{create_from_json:function(f){var h,b;if(a[f.type]){if(h=a[f.type](f))f.erased&&h.set_erased(f.erased),f.width&&(b=h.get_frontside_element(),$(b).css({width:f.width,height:f.height})),f.backside_widgets&&h.set_backside_widgets(this.create_array_from_json(f.backside_widgets));return h}console.log("json type "+f.type+" not yet supported.")},create_array_from_json:function(a){var h=[],k;for(k=0;k<a.length;k+=1)a[k]&&(h[k]=b.UTILITIES.create_from_json(a[k]));return h},get_json_of_array:function(a){var h=
[],b;for(b=0;b<a.length;b+=1)a[b]&&(a[b].get_json?h[b]=a[b].get_json():console.log("No get_json for "+a[b].toString()));return h},copy_widgets:function(a){var b=[],e;for(e=0;e<a.length;e++)b[e]=a[e].copy();return b},generate_unique_id:function(){e+=1;return"toontalk_id_"+e},get_style_property:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)},get_style_numeric_property:function(a,b){var e=this.get_style_property(a,
b),l;return"string"===typeof e?(l=e.indexOf("px"),0<=l&&(e=e.substring(0,l)),parseInt(e,10)):e},get_first_child_with_class:function(a,b){var e;for(e=a.firstChild;e;e=e.nextSibling)if(e.className===b)return e},dereference_path:function(a,b){var e;return a?((e=b.dereference(a))||console.log("Unable to dereference path: "+a.toString()+" in context: "+b.toString()),e):b},data_transfer_json_object:function(a){if(a.originalEvent.dataTransfer)if(a=a.originalEvent.dataTransfer.getData("application/json"))try{return JSON.parse(a)}catch(b){console.log("Exception parsing "+
a+"\n"+b.toString())}else console.log("No data in dataTransfer in drop.");else console.log("no dataTransfer in drop event")},drag_and_drop:function(a){var h;a.attr("draggable",!0);a.on("dragstart",function(e){var l=a.parents(".toontalk-side:first").data("owner"),n=a.get(0).getBoundingClientRect(),c=b.UTILITIES.generate_unique_id(),t=a.data("owner");h=a;a.css({position:"absolute"});a.is(".toontalk-frontside")&&a.css({width:this.offsetWidth+"px",height:this.offsetHeight+"px"});a.attr("id",c);l&&l.removed(a.data("owner"),
a,e);e.originalEvent.dataTransfer&&(e.originalEvent.dataTransfer.effectAllowed="move",l=t.get_json(),l.id_of_original_dragree=c,l.drag_x_offset=e.originalEvent.clientX-n.left,l.drag_y_offset=e.originalEvent.clientY-n.top,l.width||(a.parent().is(".toontalk-backside")?(l.original_width_fraction=a.outerWidth()/a.parent().outerWidth(),l.original_height_fraction=a.outerHeight()/a.parent().outerHeight()):(l.original_width_fraction=0.2,l.original_height_fraction=0.1)),a.data("json",l),e.originalEvent.dataTransfer.setData("application/json",
JSON.stringify(l)));e.stopPropagation()});a.on("dragend",function(b){if(a.is(".toontalk-frontside"))if(a.parent().is(".toontalk-backside")){var h=a.data("json");h&&(a.data("json",""),a.css({width:h.width||100*h.original_width_fraction+"%",height:h.height||100*h.original_height_fraction+"%"}))}else a.css({width:"100%",height:"100%"});b.stopPropagation()});a.on("dragover",function(a){a.preventDefault();return!1});a.on("drop",function(a){var f,e,c,t,q,g;g=b.UTILITIES.data_transfer_json_object(a);f=h||
$("#"+g.id_of_original_dragree);h=void 0;c=$(a.target).closest(".toontalk-side");t=c.data("owner");if(f&&0<f.length){if(f.get(0)===c.get(0))return;e=f.data("owner");b.UTILITIES.restore_resource(f,e)}else e=b.UTILITIES.create_from_json(g),f=$(e.get_frontside_element());c.is(".toontalk-backside")?(c=c.position(),g?(q=g.drag_x_offset,g=g.drag_y_offset):g=q=0,f.css({left:a.originalEvent.clientX-c.left-q,top:a.originalEvent.clientY-c.top-g}),t.get_backside().widget_dropped_on_me(e,a),f.is(".toontalk-frontside")&&
!f.is(".ui-resizable")&&f.resizable({resize:function(a,m){e.update_display()},handles:"n,e,s,w"}),a.stopPropagation()):t?e.drop_on(t,c,a)&&a.stopPropagation():console.log("target element has no 'owner'");a.preventDefault()})},restore_resource:function(a,b){var e,l;a.is(".toontalk-top-level-resource")&&(e=b.copy(),l=e.get_frontside_element(!0),a.removeClass("toontalk-top-level-resource"),$(l).addClass("toontalk-top-level-resource"),a.parent().append(l),e.update_display())},set_position_absolute:function(a,
b,e){var l;e&&e.originalEvent&&(e=e.originalEvent);if(b){if("absolute"!==a.style.position||e&&(e.pageX!==e.clientX||e.pageY!==e.clientY)){if(e)for(b=e.pageX,e=e.pageY,l=a.parentElement;l;)b-=l.offsetLeft,e-=l.offsetTop,l=l.parentElement;else e=$(a).position(),b=e.left,e=e.top;$(a).css({left:b,top:e})}}else"relative"!==a.style.position&&(a.style.position="relative",a.style.left="0",a.style.top="0")},check_radio_button:function(a){$(a.button).prop("checked",!0);$(a.label).addClass("ui-state-active")},
create_button_set:function(){var a=document.createElement("div"),b;for(b=0;b<arguments.length;b+=1)a.appendChild(arguments[b]);$(a).buttonset();return a},create_text_input:function(a,e,k,l){var n=document.createElement("input");n.type="text";e&&(n.className=e);n.value=a;l&&(n.title=l);n.id=b.UTILITIES.generate_unique_id();a=document.createElement("label");a.innerHTML=k;a.htmlFor=n.id;k=document.createElement("div");k.appendChild(a);k.appendChild(n);$(n).button();$(a).addClass("ui-widget");return{container:k,
button:n}},create_radio_button:function(a,e,k,l){var n=document.createElement("div"),c=document.createElement("input");c.type="radio";c.className="toontalk-radio-button";c.name=a;c.value=e;c.id=b.UTILITIES.generate_unique_id();a=document.createElement("label");a.innerHTML=k;a.htmlFor=c.id;n.appendChild(c);n.appendChild(a);l&&(n.title=l);$(c).button();return{container:n,button:c,label:a}},create_horizontal_table:function(){var a=document.createElement("table"),b,e,l;e=document.createElement("tr");
a.appendChild(e);for(b=0;b<arguments.length;b+=1)l=document.createElement("td"),e.appendChild(l),l.appendChild(arguments[b]);return a},create_vertical_table:function(){var a=document.createElement("table"),b,e,l;for(b=0;b<arguments.length;b+=1)e=document.createElement("tr"),a.appendChild(e),l=document.createElement("td"),e.appendChild(l),l.appendChild(arguments[b]);return a},selected_radio_button:function(){var a;for(a=0;a<arguments.length;a+=1)if(arguments[a].checked)return arguments[a]}}}(window.TOONTALK);window.TOONTALK.tests=function(b){return{assert_equals:function(a,b,f){console.assert(a.equals(b),f+" Expected to be equal "+a.toString()+"="+b.toString())},random_integer_between:function(a,b){return Math.round(Math.random()*(b-a))+a},drop_numbers:function(a,e,f,h,k,l,n){a=b.number.create(e,f).set_operator(a);h=b.number.create(h,k);l=b.number.create(l,n);n=a.drop_on(h);this.assert_equals(n,l,"Dropping "+a+" on "+h+" should result in "+l);this.assert_equals(h,l,"Dropping "+a+" on "+h+" should update "+
h+" to "+l);this.assert_equals(a,b.number.create(e,f),"Dropping "+a+" on "+h+" should not update "+a)},create_sides:function(a,b,f){var h=a.get_backside(!0),k=a.get_frontside(!0).get_element(),h=h.get_element();k.style.top=f+"px";h.style.top=f+"px";k.className+=" toontalk-top-level-frontside";b.appendChild(h);b.appendChild(k);a.update_display()},add_or_duplicate_robot:function(a,e,f,h){var k=b.number.create(2);f&&this.create_sides(k,f);h||(h=100);f=e?this.double_robot():this.add_one_robot();a?a=e?
b.number.create(2).power(b.number.create(h+1)).toString():h+2:(f.get_bubble().set_erased(!1),a=3);this.test_robot(f,k,h,b.number.create(a));return this},test_robot:function(a,e,f,h,k){b.QUEUE.paused=!0;var l=b.queue.create(),n=e.copy();a.run(e,l);var c=this;l.run(f,function(){c.assert_equals(e,h,a.toString()+" when given "+n.toString()+" expected "+h.toString()+" not "+e.toString()+" when run "+f+" times. ");k&&k()})},accept_number_robot:function(){var a=b.actions.create(),e=b.number.create(1);e.set_erased(!0);
return b.robot.create(e,a)},accept_box_robot:function(a){var e=b.actions.create();a=b.box.create(a);a.set_erased(!0);return b.robot.create(a,e)},add_one_robot:function(){var a=this.accept_number_robot(),e=a.get_body();e.add(b.pick_up_constant.create(b.number.ONE()));e.add(b.drop_on.create(b.path_to_entire_context));a.set_description("adds one to what it is given");return a},double_robot:function(){var a=this.accept_number_robot(),e=a.get_body();e.add(b.copy.create(b.path_to_entire_context));e.add(b.drop_on.create(b.path_to_entire_context));
a.set_image_url("images/RB19.PNG");return a},copy_first_hole_to_second_hole_robot:function(){var a=this.accept_box_robot(2),e=a.get_body();e.add(b.copy.create(b.box.path.create(0)));e.add(b.drop_on.create(b.box.path.create(1)));a.set_image_url("images/RB45.PNG");return a},create_test_box:function(){var a=b.box.create(2);a.set_horizontal(!0);var e=b.number.create(1,49);e.set_operator("*");var f=b.number.create(19);a.set_hole(0,e);a.set_hole(1,f);a.update_display();return a},test_copy_first_hole_to_second_hole_robot:function(){var a=
this.copy_first_hole_to_second_hole_robot(),e=this.create_test_box(),f=document.createElement("div");f.className="toontalk-frontside";f.style.top="10px";var h=document.createElement("div");h.className="toontalk-frontside";f.style.top="200px";var k=document.createElement("div");f.appendChild(k);var l=document.createElement("div");h.appendChild(l);k.innerHTML=e.to_HTML();document.body.appendChild(f);f=e.copy();k=b.number.create(19,"79792266297612001");f.set_hole(1,k);this.test_robot(a,e,10,f,function(){l.innerHTML=
e.to_HTML();document.body.appendChild(h)})},robot_tests:function(){this.add_or_duplicate_robot();this.add_or_duplicate_robot(!0);this.add_or_duplicate_robot(!0,!0);b.tests.add_or_duplicate_robot(!0,!0,document.getElementById("test1_top_level_backside"),1E4);b.tests.add_or_duplicate_robot(!0,!1,document.getElementById("test1_top_level_backside"),1E4);b.tests.test_copy_first_hole_to_second_hole_robot()},number_tests:function(){this.drop_numbers("+",1,1,2,1,3,1);this.drop_numbers("-",1,1,3,1,2,1);this.drop_numbers("*",
2,1,3,1,6,1);this.drop_numbers("/",6,1,10,1,5,3);this.drop_numbers("^",2,1,3,1,9,1)},box_tests:function(){var a=b.box.create(2),e=b.box.create(1),f=b.box.create(1);f.set_erased(!0);var h=b.box.create(2);console.assert("matched"===h.match(a),"Empty box of size 2 should match empty box of size 2");console.assert(h.equals(a),"Empty box of size 2 should equal an empty box of size 2");console.assert("not matched"===e.match(a),"Empty box of size 1 should not match empty box of size 2");console.assert(!e.equals(a),
"Empty box of size 1 should not equal an empty box of size 2");console.assert("matched"===f.match(a),"Empty ERASED box of size 1 should match empty box of size 2");console.assert(!f.equals(a),"Empty ERASED box of size 1 should not equal an empty box of size 2");e=b.number.create(3);a.set_hole(0,e);console.assert("matched"===h.match(a),"Empty box of size 2 should match box of size 2 with number in first hole");e=b.number.create(3);h.set_hole(0,e);console.assert("matched"===h.match(a),"box of size 2 with 3 in first hole should match box of size 2 with 3 in first hole");
console.assert(h.equals(a),"box of size 2 with 3 in first hole should equal a box of size 2 with 3 in first hole");e=b.number.create(4);h.set_hole(1,e);console.assert("not matched"===h.match(a),"box of size 2 with 3 and 4 should not match box of size 2 with just 3 in first hole");e.set_erased(!0);console.assert("not matched"===h.match(a),"box of size 2 with 3 and erased 4 should not match box of size 2 with 3 in first hole");console.assert(!h.equals(a),"box of size 2 with 3 and erased 4 should not equal a box of size 2 with 3 in first hole");
f=b.number.create(5);a.set_hole(1,f);console.assert("matched"===h.match(a),"box of size 2 with 3 and erased 4 should match box of size 2 with 3 and 5");e.set_erased(!1);h.set_hole(1,e.copy());console.assert("not matched"===h.match(a),"box of size 2 with 3 and 4 should not match box of size 2 with 3 and 5");console.assert(!h.equals(a),"box of size 2 with 3 and 4 should not equal a box of size 2 with 3 and 5");a.set_hole(1,b.number.create(5));h.set_hole(1,b.number.create(5));console.assert("matched"===
h.match(a),"box of size 2 with 3 and 5 should match box of size 2 with 3 and 5");console.assert(h.equals(a),"box of size 2 with 3 and 5 should equal a box of size 2 with 3 and 5")},run:function(){this.number_tests();this.box_tests();this.robot_tests();return"All tests run."}}}(window.TOONTALK);window.TOONTALK.initialise=function(){$(document).ready(function(){var b=window.TOONTALK,a=b.backside.create({}).get_element(),e=$(a),f=b.number.create(1),h=f.get_frontside_element(),k=b.box.create(1),l=k.get_frontside_element(),n=b.tests.add_one_robot(),c=n.get_frontside_element(),t=b.tests.double_robot(),q=t.get_frontside_element(),g=b.tests.copy_first_hole_to_second_hole_robot(),p=g.get_frontside_element(),c=[h,l,c,q,p];$("#top-level-backside").append(a);e.css({width:"600px",height:"300px","background-color":"yellow",
position:"relative"});a.draggable=!1;b.debugging=!0;$("#a-number").append(h);f.update_display();$("#a-box").append(l);k.update_display();$("#add_one_robot").append(n.get_frontside(!0).get_element());n.update_display();$("#double_robot").append(t.get_frontside(!0).get_element());t.update_display();$("#copy_first_hole_to_second_hole_robot").append(g.get_frontside(!0).get_element());g.update_display();for(a=0;a<c.length;a+=1)$(c[a]).addClass("toontalk-top-level-resource"),$(c[a]).css({position:"relative"});
b.QUEUE.run()})};(function(b){var a;"undefined"===typeof exports?"function"===typeof define&&"object"===typeof define.amd&&define.amd?(a={},define(function(){return a})):a="undefined"!==typeof window?window:b:a=exports;(function(a){var b={greatest_common_divisor:function(a,d){if(1===d||1===a)return 1;for(var c;0!==d;){c=d;d=a%d;if(!isFinite(d))return 0;a=c}return a}};b.gcd=b.greatest_common_divisor;b.fromRandom=function(a){return Math.random()*(1<<a)>>>0};b.fromMillitime=function(){return+new Date};b.fromUnixtime=
function(){return 0.001*b.fromMillitime()|0};"undefined"!==typeof a&&(a.integer=b);(function(a){function d(a,m,b){if(b!==c)return a instanceof d?a:"undefined"===typeof a?f:d.parse(a);for(a=a||[];a.length&&!a[a.length-1];)--a.length;this._d=a;this._s=a.length?m||1:0}var c={};d._construct=function(a,m){return new d(a,m,c)};var b=1E7;d.base=b;d.base_log10=7;var f=new d([],0,c);d.ZERO=f;var e=new d([1],1,c);d.ONE=e;var g=new d(e._d,-1,c);d.M_ONE=g;d._0=f;d._1=e;d.small=[f,e,new d([2],1,c),new d([3],1,
c),new d([4],1,c),new d([5],1,c),new d([6],1,c),new d([7],1,c),new d([8],1,c),new d([9],1,c),new d([10],1,c),new d([11],1,c),new d([12],1,c),new d([13],1,c),new d([14],1,c),new d([15],1,c),new d([16],1,c),new d([17],1,c),new d([18],1,c),new d([19],1,c),new d([20],1,c),new d([21],1,c),new d([22],1,c),new d([23],1,c),new d([24],1,c),new d([25],1,c),new d([26],1,c),new d([27],1,c),new d([28],1,c),new d([29],1,c),new d([30],1,c),new d([31],1,c),new d([32],1,c),new d([33],1,c),new d([34],1,c),new d([35],
1,c),new d([36],1,c)];d.digits="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");d.prototype.toString=function(a){a=+a||10;if(2>a||36<a)throw Error("illegal radix "+a+".");if(0===this._s)return"0";if(10===a){a=0>this._s?"-":"";a+=this._d[this._d.length-1].toString();for(var m=this._d.length-2;0<=m;m--){for(var c=this._d[m].toString();7>c.length;)c="0"+c;a+=c}return a}m=d.digits;a=d.small[a];for(var c=this._s,b=this.abs(),f=[],e;0!==b._s;)e=b.divRem(a),b=e[0],e=e[1],f.push(m[e.valueOf()]);return(0>
c?"-":"")+f.reverse().join("")};d.radixRegex=[/^$/,/^$/,/^[01]*$/,/^[012]*$/,/^[0-3]*$/,/^[0-4]*$/,/^[0-5]*$/,/^[0-6]*$/,/^[0-7]*$/,/^[0-8]*$/,/^[0-9]*$/,/^[0-9aA]*$/,/^[0-9abAB]*$/,/^[0-9abcABC]*$/,/^[0-9a-dA-D]*$/,/^[0-9a-eA-E]*$/,/^[0-9a-fA-F]*$/,/^[0-9a-gA-G]*$/,/^[0-9a-hA-H]*$/,/^[0-9a-iA-I]*$/,/^[0-9a-jA-J]*$/,/^[0-9a-kA-K]*$/,/^[0-9a-lA-L]*$/,/^[0-9a-mA-M]*$/,/^[0-9a-nA-N]*$/,/^[0-9a-oA-O]*$/,/^[0-9a-pA-P]*$/,/^[0-9a-qA-Q]*$/,/^[0-9a-rA-R]*$/,/^[0-9a-sA-S]*$/,/^[0-9a-tA-T]*$/,/^[0-9a-uA-U]*$/,
/^[0-9a-vA-V]*$/,/^[0-9a-wA-W]*$/,/^[0-9a-xA-X]*$/,/^[0-9a-yA-Y]*$/,/^[0-9a-zA-Z]*$/];d.parse=function(a,m){function b(a){a=a.replace(/\s*[*xX]\s*10\s*(\^|\*\*)\s*/,"e");return a.replace(/^([+\-])?(\d+)\.?(\d*)[eE]([+\-]?\d+)$/,function(a,m,d,c,b){b=+b;var f=0>b,e=d.length+b;a=(f?d:c).length;b=(b=Math.abs(b))>=a?b-a+f:0;a=Array(b+1).join("0");d+=c;return(m||"")+(f?d=a+d:d+=a).substr(0,e+=f?a.length:0)+(e<d.length?"."+d.substr(e):"")})}a=a.toString();if("undefined"===typeof m||10===+m)a=b(a);var e=
RegExp("^([+\\-]?)("+("undefined"===typeof m?"0[xcb]":16==m?"0x":8==m?"0c":2==m?"0b":"")+")?([0-9a-z]*)(?:\\.\\d*)?$","i").exec(a);if(e){var g=e[1]||"+",h=e[2]||"",e=e[3]||"";if("undefined"===typeof m)m="0x"===h||"0X"===h?16:"0c"===h||"0C"===h?8:"0b"===h||"0B"===h?2:10;else if(2>m||36<m)throw Error("Illegal radix "+m+".");m=+m;if(!d.radixRegex[m].test(e))throw Error("Bad digit for radix "+m);e=e.replace(/^0+/,"").split("");if(0===e.length)return f;g="-"===g?-1:1;if(10==m){for(h=[];7<=e.length;)h.push(parseInt(e.splice(e.length-
d.base_log10,d.base_log10).join(""),10));h.push(parseInt(e.join(""),10));return new d(h,g,c)}h=f;m=d.small[m];for(var k=d.small,l=0;l<e.length;l++)h=h.multiply(m).add(k[parseInt(e[l],36)]);return new d(h._d,g,c)}throw Error("Invalid BigInteger format: "+a);};d.prototype.add=function(a){if(0===this._s)return d(a);a=d(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.subtract(a);var m=this._d;a=a._d;for(var f=m.length,e=a.length,g=Array(Math.max(f,e)+1),h=Math.min(f,e),k=0,l=0;l<
h;l++)k=m[l]+a[l]+k,g[l]=k%b,k=k/b|0;e>f&&(m=a,f=e);for(l=h;k&&l<f;l++)k=m[l]+k,g[l]=k%b,k=k/b|0;for(k&&(g[l]=k);l<f;l++)g[l]=m[l];return new d(g,this._s,c)};d.prototype.negate=function(){return new d(this._d,-this._s|0,c)};d.prototype.abs=function(){return 0>this._s?this.negate():this};d.prototype.subtract=function(a){if(0===this._s)return d(a).negate();a=d(a);if(0===a._s)return this;if(this._s!==a._s)return a=a.negate(),this.add(a);var m=this;0>this._s&&(m=new d(a._d,1,c),a=new d(this._d,1,c));
var e=m.compareAbs(a);if(0===e)return f;if(0>e){var g=a;a=m;m=g}m=m._d;a=a._d;var g=m.length,h=a.length,k=Array(g),l=0,r,n;for(r=0;r<h;r++)n=m[r]-l-a[r],0>n?(n+=b,l=1):l=0,k[r]=n;for(r=h;r<g;r++){n=m[r]-l;if(0>n)n+=b;else{k[r++]=n;break}k[r]=n}for(;r<g;r++)k[r]=m[r];return new d(k,e,c)};(function(){function a(m,f){for(var e=m._d,g=e.slice(),h=0;;){var k=(e[h]||0)+1;g[h]=k%b;if(k<=b-1)break;++h}return new d(g,f,c)}function m(a,f){for(var e=a._d,g=e.slice(),h=0;;){var k=(e[h]||0)-1;if(0>k)g[h]=k+b;
else{g[h]=k;break}++h}return new d(g,f,c)}d.prototype.next=function(){switch(this._s){case 0:return e;case -1:return m(this,-1);default:return a(this,1)}};d.prototype.prev=function(){switch(this._s){case 0:return g;case -1:return a(this,-1);default:return m(this,1)}}})();d.prototype.compareAbs=function(a){if(this===a)return 0;if(!(a instanceof d)){if(!isFinite(a))return isNaN(a)?a:-1;a=d(a)}if(0===this._s)return 0!==a._s?-1:0;if(0===a._s)return 1;var m=this._d.length,c=a._d.length;if(m<c)return-1;
if(m>c)return 1;c=this._d;a=a._d;for(m-=1;0<=m;m--)if(c[m]!==a[m])return c[m]<a[m]?-1:1;return 0};d.prototype.compare=function(a){if(this===a)return 0;a=d(a);return 0===this._s?-a._s:this._s===a._s?this.compareAbs(a)*this._s:this._s};d.prototype.isUnit=function(){return this===e||this===g||1===this._d.length&&1===this._d[0]};d.prototype.multiply=function(a){if(0===this._s)return f;a=d(a);if(0===a._s)return f;if(this.isUnit())return 0>this._s?a.negate():a;if(a.isUnit())return 0>a._s?this.negate():
this;if(this===a)return this.square();var m=this._d.length>=a._d.length,e=(m?this:a)._d,m=(m?a:this)._d,g=e.length,h=m.length,k=g+h,l=Array(k),r;for(r=0;r<k;r++)l[r]=0;for(r=0;r<h;r++){for(var k=0,n=m[r],p=g+r,q,s=r;s<p;s++)q=l[s]+n*e[s-r]+k,k=q/b|0,l[s]=q%b|0;k&&(q=l[s]+k,l[s]=q%b)}return new d(l,this._s*a._s,c)};d.prototype.multiplySingleDigit=function(a){if(0===a||0===this._s)return f;if(1===a)return this;var m;if(1===this._d.length)return m=this._d[0]*a,m>=b?new d([m%b|0,m/b|0],1,c):new d([m],
1,c);if(2===a)return this.add(this);if(this.isUnit())return new d([a],1,c);var e=this._d,g=e.length;m=g+1;for(var h=Array(m),k=0;k<m;k++)h[k]=0;for(var l=k=0;l<g;l++)m=a*e[l]+k,k=m/b|0,h[l]=m%b|0;k&&(h[l]=k);return new d(h,1,c)};d.prototype.square=function(){if(0===this._s)return f;if(this.isUnit())return e;var a=this._d,m=a.length,g=Array(m+m+1),h,k,l,n;for(n=0;n<m;n++)l=2*n,h=a[n]*a[n],k=h/b|0,g[l]=h%b,g[l+1]=k;for(n=0;n<m;n++){k=0;l=2*n+1;for(var p=n+1;p<m;p++,l++)h=a[p]*a[n]*2+g[l]+k,k=h/b|0,
g[l]=h%b;l=m+n;h=k+g[l];k=h/b|0;g[l]=h%b;g[l+1]+=k}return new d(g,1,c)};d.prototype.quotient=function(a){return this.divRem(a)[0]};d.prototype.divide=d.prototype.quotient;d.prototype.remainder=function(a){return this.divRem(a)[1]};d.prototype.divRem=function(a){a=d(a);if(0===a._s)throw Error("Divide by zero");if(0===this._s)return[f,f];if(1===a._d.length)return this.divRemSmall(a._s*a._d[0]);switch(this.compareAbs(a)){case 0:return[this._s===a._s?e:g,f];case -1:return[f,this]}var m=this._s*a._s,h=
a.abs(),k=this._d,l=k.length,n=[],p,s=new d([],0,c);for(s._s=1;l;)if(s._d.unshift(k[--l]),0>s.compareAbs(a))n.push(0);else{if(0===s._s)p=0;else{var q=s._d.length;p=h._d.length;q=s._d[q-1]*b+s._d[q-2];p=h._d[p-1]*b+h._d[p-2];s._d.length>h._d.length&&(q=(q+1)*b);p=Math.ceil(q/p)}do{q=h.multiplySingleDigit(p);if(0>=q.compareAbs(s))break;p--}while(p);n.push(p);p&&(p=s.subtract(q),s._d=p._d.slice(),0===s._d.length&&(s._s=0))}return[new d(n.reverse(),m,c),new d(s._d,this._s,c)]};d.prototype.divRemSmall=
function(a){a=+a;if(0===a)throw Error("Divide by zero");var m=this._s*(0>a?-1:1);a=Math.abs(a);if(1>a||a>=b)throw Error("Argument out of range");if(0===this._s)return[f,f];if(1===a||-1===a)return[1===m?this.abs():new d(this._d,m,c),f];if(1===this._d.length){var e=new d([this._d[0]/a|0],1,c);a=new d([this._d[0]%a|0],1,c);0>m&&(e=e.negate());0>this._s&&(a=a.negate());return[e,a]}for(var g=this._d.slice(),e=Array(g.length),h=0,k=0,l=0,n;g.length;)h=h*b+g[g.length-1],h<a?(e[l++]=0,g.pop(),k=b*k+h):(n=
0===h?0:h/a|0,k=h-a*n,(e[l++]=n)?(g.pop(),h=k):g.pop());a=new d([k],1,c);0>this._s&&(a=a.negate());return[new d(e.reverse(),m,c),a]};d.prototype.isEven=function(){var a=this._d;return 0===this._s||0===a.length||0===a[0]%2};d.prototype.isOdd=function(){return!this.isEven()};d.prototype.sign=function(){return this._s};d.prototype.isPositive=function(){return 0<this._s};d.prototype.isNegative=function(){return 0>this._s};d.prototype.isZero=function(){return 0===this._s};d.prototype.exp10=function(a){a=
+a;if(0===a)return this;if(Math.abs(a)>Number(h))throw Error("exponent too large in BigInteger.exp10");if(0<a){for(var m=new d(this._d.slice(),this._s,c);7<=a;a-=7)m._d.unshift(0);if(0==a)return m;m._s=1;m=m.multiplySingleDigit(Math.pow(10,a));return 0>this._s?m.negate():m}if(-a>=7*this._d.length)return f;m=new d(this._d.slice(),this._s,c);for(a=-a;7<=a;a-=7)m._d.shift();return 0==a?m:m.divRemSmall(Math.pow(10,a))[0]};d.prototype.pow=function(a){if(this.isUnit())return 0<this._s?this:d(a).isOdd()?
this:this.negate();a=d(a);if(0===a._s)return e;if(0>a._s){if(0===this._s)throw Error("Divide by zero");return f}if(0===this._s)return f;if(a.isUnit())return this;if(0<a.compareAbs(h))throw Error("exponent too large in BigInteger.pow");for(var m=this,c=e,b=d.small[2];a.isPositive()&&(!a.isOdd()||(c=c.multiply(m),!a.isUnit()));)m=m.square(),a=a.quotient(b);return c};d.prototype.modPow=function(a,m){for(var c=e,b=this;a.isPositive();)a.isOdd()&&(c=c.multiply(b).remainder(m)),a=a.quotient(d.small[2]),
a.isPositive()&&(b=b.square().remainder(m));return c};d.prototype.log=function(){switch(this._s){case 0:return-Infinity;case -1:return NaN}var a=this._d.length;if(30>7*a)return Math.log(this.valueOf());var m=Math.ceil(30/7),f=this._d.slice(a-m);return Math.log((new d(f,1,c)).valueOf())+(a-m)*Math.log(b)};d.prototype.valueOf=function(){return parseInt(this.toString(),10)};d.prototype.toJSValue=function(){return parseInt(this.toString(),10)};var h=d(2147483647);d.MAX_EXP=h;(function(){function a(m){return function(a){return m.call(d(a))}}
function m(a){return function(m,c){return a.call(d(m),d(c))}}function c(a){return function(m,c,b){return a.call(d(m),d(c),d(b))}}(function(){var b,f,e="toJSValue isEven isOdd sign isZero isNegative abs isUnit square negate isPositive toString next prev log".split(" "),g="compare remainder divRem subtract add quotient divide multiply pow compareAbs".split(" "),h=["modPow"];for(b=0;b<e.length;b++)f=e[b],d[f]=a(d.prototype[f]);for(b=0;b<g.length;b++)f=g[b],d[f]=m(d.prototype[f]);for(b=0;b<h.length;b++)f=
h[b],d[f]=c(d.prototype[f]);d.exp10=function(a,m){return d(a).exp10(m)}})()})();a.BigInteger=d})("undefined"!==typeof a?a:this);var h={greatest_common_divisor:function(a,d){if(d.isUnit()||a.isUnit())return BigInteger.ONE;for(var c;!d.isZero();)c=d,d=a.remainder(d),a=c;return a},create:function(){return[0]},clone:function(a){for(var d=[],c=0,b=a.length;c<b;c++)d[c]=a[c];return d},copy:function(a,d){a=[];for(var c=0,b=d.length;c<b;c++)a[c]=d[c];return a},abs:function(a,d){a[0]=Math.abs(d[0]);return a},
str:function(a){return a[0].toString()},toInteger:function(a){return out[0]},fromInteger:function(a){return[parseInt(a)]}};h.ZERO=h.fromInteger(0);h.ONE=h.fromInteger(1);"undefined"!==typeof a&&(a.bigint=h);if(!k)var k=Array;if(!l)var l=Math.pow(2,56);if(!n)var n=16777216;var c={EPSILON:2E-16};c.MAX_LOOPS=n;c.create=function(){var a=new k(2);a[0]=0;a[1]=1;return a};c.clone=function(a){var d=new k(2);d[0]=a[0];d[1]=a[1];return d};c.fromValues=function(a,d){var b=new k(2);b[0]=a;b[1]=d;return c.normalize(b,
b)};c.copy=function(a,d){a[0]=d[0];a[1]=d[1];return a};c.set=function(a,d,b){a[0]=d;a[1]=b;return c.normalize(a,a)};c.abs=function(a,d){a[0]=Math.abs(d[0]);a[1]=d[1];return a};c.invert=function(a,d){var c=d[0];a[0]=d[1];a[1]=c;return a};c.reciprocal=c.invert;c.add=function(a,d,b){d[1]===b[1]?(a[0]=d[0]+b[0],a[1]=d[1]):(a[0]=d[0]*b[1]+b[0]*d[1],a[1]=d[1]*b[1]);return c.normalize(a,a)};c.subtract=function(a,d,b){d[1]===b[1]?(a[0]=d[0]-b[0],a[1]=d[1]):(a[0]=d[0]*b[1]-b[0]*d[1],a[1]=d[1]*b[1]);return c.normalize(a,
a)};c.sub=c.subtract;c.multiply=function(a,d,b){a[0]=d[0]*b[0];a[1]=d[1]*b[1];return c.normalize(a,a)};c.mul=c.multiply;c.mediant=function(a,d,b){a[0]=d[0]+b[0];a[1]=d[1]+b[1];return c.normalize(a,a)};c.divide=function(a,d,b){a[0]=d[0]*b[1];a[1]=d[1]*b[0];return c.normalize(a,a)};c.div=c.divide;c.equals=function(a,d){return 0===a[0]&&0===d[0]||0===a[1]&&0===d[1]?!0:a[0]===d[0]&&a[1]===d[1]};c.approximates=function(a,d){if(c.equals(a,d))return!0;var b=c.create();c.sub(b,a,d);c.abs(b,b);return c.isLessThan(b,
c.INFINITESIMAL)};c.isGreaterThan=function(a,d){return c.equals(a,d)?!1:a[0]*d[1]>d[0]*a[1]};c.isLessThan=function(a,d){return c.equals(a,d)?!1:a[0]*d[1]<d[0]*a[1]};c.isNegative=function(a){return 0>a[0]};c.min=function(a,d,b){c.isLessThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};c.max=function(a,d,b){c.isGreaterThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};c.scalar_multiply=function(a,d,b){a[0]=d[0]*b;a[1]=d[1];return c.normalize(a,a)};c.scalar_divide=function(a,
d,b){a[0]=d[0];a[1]=d[1]*b;return c.normalize(a,a)};c.normalize=function(a,d){if(isNaN(d[0])||isNaN(d[1])||0===d[0]&&0===d[1])return a[0]=0,a[1]=0,a;if(0===d[0])return a[0]=0,a[1]=1,a;if(0===d[1])return a[0]=1,a[1]=0,a;if(d[0]===d[1])return a[0]=1,a[1]=1,a;0<d[1]?(a[0]=d[0],a[1]=d[1]):(a[0]=-d[0],a[1]=-d[1]);var c=b.greatest_common_divisor(Math.abs(a[0]),a[1]);1<c&&(a[0]/=c,a[1]/=c);return a};c.opposite=function(a,d){a[0]=-d[0];a[1]=d[1];return a};c.negative=c.opposite;c.neg=c.opposite;c.power=function(a,
d,b){2===b?(a[0]=d[0]*d[0],a[1]=d[1]*d[1]):0<b?(a[0]=Math.pow(d[0],b),a[1]=Math.pow(d[1],b)):0>b?(b=Math.abs(b),a[0]=Math.pow(d[1],b),a[1]=Math.pow(d[0],b)):c.copy(a,c.ONE);return c.normalize(a,a)};c.pow=c.power;c.sqrt=function(a,d){return c.nthRoot(a,d,2)};c.nthRoot=function(a,d,b){if(c.equals(d,c.ZERO))return c.copy(a,c.ZERO);if(c.equals(d,c.ONE))return c.copy(a,c.ONE);if(c.equals(d,c.INFINITY))return c.copy(a,c.INFINITY);if(c.equals(d,c.INFINULL))return c.copy(a,c.INFINULL);var f=c.isNegative(d);
f&&(d[0]=-d[0]);a=c.copy(a,c.ONE);for(var e=[1,0,0,1],g=c.clone(c.ONE),h=c.MAX_LOOPS;!c.approximates(d,g)&&h--;)c.isLessThan(d,g)?(e[0]+=e[1],e[2]+=e[3]):(e[1]+=e[0],e[3]+=e[2]),a[0]=e[0]+e[1],a[1]=e[2]+e[3],c.pow(g,a,b);f&&(d[0]=-d[0],1===b%2&&c.neg(a,a));return a};c.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]};c.str=function(a){return 1===a[1]?a[0].toString():a[0]+"/"+a[1]};c.toDecimal=function(a){return a[0]/a[1]};c.dec=c.toDecimal;c.toInteger=function(a){return Math.round(c.toDecimal(a))};c.round=
c.toInteger;c.floor=function(a){return Math.floor(c.toDecimal(a))};c.ceil=function(a){return Math.ceil(c.toDecimal(a))};c.fromInteger_copy=function(a,d){a[0]=parseInt(d);a[1]=1;return a};c.fromInteger=function(a){return c.fromInteger_copy(c.create(),a)};c.fromIntegerInverse_copy=function(a,d){a[0]=1;a[1]=parseInt(d);0>a[1]&&(a[0]=-a[0],a[1]=-a[1]);return a};c.fromIntegerInverse=function(a){return c.fromIntegerInverse_copy(c.create(),a)};c.fromDecimal=function(a){return c.fromDecimal_copy(c.create(),
a)};c.fromDecimal_copy=function(a,d){d=parseFloat(d);if(isNaN(d))return c.copy(a,c.INFINULL);if(Infinity===d)return c.copy(a,c.INFINITY);if(Math.abs(d)<c.EPSILON)return c.copy(a,c.ZERO);if(Math.abs(d-1)<c.EPSILON)return c.copy(a,c.ONE);if(Math.abs(d%1)<c.EPSILON)return c.fromInteger_copy(a,d);if(Math.abs(1/d%1)<c.EPSILON)return c.fromIntegerInverse_copy(a,Math.round(1/d));c.copy(a,c.ONE);for(var b=[1,0,0,1],e=d,f=1,g=c.MAX_LOOPS;g--&&Math.abs(d-c.toDecimal(a))>c.EPSILON;)f=Math.floor(e),a[0]=f*b[0]+
b[2],a[1]=f*b[1]+b[3],e=1/(e-f),b[2]=b[0],b[3]=b[1],b[0]=a[0],b[1]=a[1];return a};c.fromRandom=function(a){a[0]=0xfffffffffffff*Math.random()<<0;a[1]=Math.abs(0xfffffffffffff*Math.random()<<0);return c.normalize(a,a)};c.sin=function(a,d){if(0===d[1])return c.copy(a,c.ZERO);c.scalar_multiply(a,d,2);var b=c.create();c.pow(b,d,2);c.add(b,b,c.ONE);c.divide(a,a,b);return a};c.cos=function(a,d){if(0===d[1])return c.neg(a,c.ONE);var b=c.create();c.pow(b,d,2);c.sub(a,c.ONE,b);var e=c.create();c.add(e,c.ONE,
b);c.divide(a,a,e);return a};c.tan=function(a,d){c.scalar_multiply(a,d,2);var b=c.create();c.pow(b,d,2);c.scalar_multiply(b,b,2);c.add(a,a,b);c.pow(b,d,4);c.sub(b,c.ONE,b);c.divide(a,a,b);return a};c.toEgyptian=function(a){a=c.clone(a);c.abs(a,a);var d=c.floor(a);d&&c.sub(a,a,c.fromInteger(d));if(!a[0])return d.toString();d||(d="");for(var b=1,e=c.create();1!==a[0];)b++,e=c.fromValues(1,b),c.isGreaterThan(a,e)&&(d&&(d+=" + "),d+=c.str(e),c.sub(a,a,e));return a?d?d+" + "+c.str(a):c.str(a):d?d:"0"};
c.toBabylonian=function(a){var d="",b=c.toDecimal(a);a=parseInt(b);for(var b=b-a,e=0,f=0;0<a;)(e=a%60)&&(d=e+" * 60^"+f+(d?" + ":"")+d),a=(a-e)/60,f++;for(f=-1;0<b;)b*=60,e=parseInt(b+1E-13),b-=e,-1E-13>b||(e&&(d+=(d?" + ":"")+e+" * 60^"+f),f--);return d?d:"0"};c.traceSternBrocot=function(a){var d="";if(c.equals(a,c.ZERO)||c.equals(a,c.ONE)||c.equals(a,c.INFINITY)||c.equals(a,c.INFINULL))return d;if(c.equals(a,c.ZERO))return c.copy(out,c.ZERO);if(c.equals(a,c.ONE))return c.copy(out,c.ONE);if(c.equals(a,
c.INFINITY))return c.copy(out,c.INFINITY);if(c.equals(a,c.INFINULL))return c.copy(out,c.INFINULL);a=c.clone(a);c.isNegative(a)&&(a[0]=-a[0]);for(var b=c.clone(c.ONE),e=[1,0,0,1],f=0,g=0,h=c.MAX_LOOPS;!c.approximates(a,b)&&h--;)c.isLessThan(a,b)?(e[0]+=e[1],e[2]+=e[3],g++,f&&(d+="R",1!==f&&(d+=f),f=0,d+=" ")):(e[1]+=e[0],e[3]+=e[2],f++,g&&(d+="L",1!==g&&(d+=g),g=0,d+=" ")),b[0]=e[0]+e[1],b[1]=e[2]+e[3];g?(d+="L",1!==g&&(d+=g)):f&&(d+="R",1!==f&&(d+=f));0>h&&(d+="...");return d};c.toContinuedFraction=
function(a,d){d="undefined"===typeof d?65536:parseInt(d);if(c.equals(a,c.ZERO))return[0];if(c.equals(a,c.ONE))return[1];if(c.equals(a,c.NEGONE))return[-1];if(c.equals(a,c.INFINITY))return[1,0];if(c.equals(a,c.INFINULL))return[0,0];var b=c.clone(a),e=c.isNegative(b);e&&(b[0]=-b[0]);for(var f=c.clone(c.ONE),g=[1,0,0,1],h=1,k=[0],l=k.length-1;!c.equals(b,f)&&d--;)c.isLessThan(b,f)?(-1===h?k[l]++:(h=-1,k.push(1),l++),g[0]+=g[1],g[2]+=g[3]):(1===h?k[l]++:(h=1,k.push(1),l++),g[1]+=g[0],g[3]+=g[2]),f[0]=
g[0]+g[1],f[1]=g[2]+g[3];0>d?k.push(0):k[l]++;if(e)for(var n in k)k[n]=-k[n];return k};c.fromContinuedFraction=function(a,d){c.fromInteger_copy(a,d[d.length-1]);for(var b=d.length-2;-1<b;b--)c.invert(a,a),c.add(a,c.fromInteger(d[b]),a);return a};c.dump=function(a){c.create();return"rat\t"+c.str(a)+"\n~\t"+c.toDecimal(a)+"\nCF:\t["+c.toContinuedFraction(a)+"]\n"};c.ZERO=c.fromInteger(0);c.ONE=c.fromInteger(1);c.NEGONE=c.fromInteger(-1);c.INFINITY=c.fromValues(1,0);c.INFINULL=c.fromValues(0,0);c.INFINITESIMAL=
c.clone([1,l]);c.PI=c.fromValues(1320192667429,420230377710);"undefined"!==typeof a&&(a.rat=c);if(!t)var t=new BigInteger("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");if(!q)var q=1073741824;var g={EPSILON:2E-16};g.MAX_LOOPS=q;g.create=function(){var a=[];a[0]=BigInteger.ZERO;a[1]=BigInteger.ONE;return a};g.clone=function(a){var d=[];d[0]=a[0];d[1]=a[1];return d};g.fromValues=function(a,d){var b=[];b[0]=new BigInteger(a);b[1]=new BigInteger(d);return g.normalize(b,b)};g.copy=function(a,d){a[0]=d[0];a[1]=
d[1];return a};g.set=function(a,d,b){a[0]=d;a[1]=b;return g.normalize(a,a)};g.toRat=function(a,d){return c.set(a,d[0].toJSValue(),d[1].toJSValue())};g.fromRat=function(a,d){return g.set(a,BigInteger(d[0]),BigInteger(d[1]))};g.abs=function(a,d){a[0]=d[0].abs();a[1]=d[1];return a};g.invert=function(a,d){var b=d[0];a[0]=d[1];a[1]=b;return a};g.reciprocal=g.invert;g.add=function(a,d,b){0===d[1].compare(b[1])?(a[0]=d[0].add(b[0]),a[1]=d[1]):(a[0]=d[0].multiply(b[1]).add(b[0].multiply(d[1])),a[1]=d[1].multiply(b[1]));
return g.normalize(a,a)};g.subtract=function(a,d,b){0===d[1].compare(b[1])?(a[0]=d[0].subtract(b[0]),a[1]=d[1]):(a[0]=d[0].multiply(b[1]).subtract(b[0].multiply(d[1])),a[1]=d[1].multiply(b[1]));return g.normalize(a,a)};g.sub=g.subtract;g.multiply=function(a,d,b){a[0]=d[0].multiply(b[0]);a[1]=d[1].multiply(b[1]);return g.normalize(a,a)};g.mul=g.multiply;g.mediant=function(a,d,b){a[0]=d[0].add(b[0]);a[1]=d[1].add(b[1]);return g.normalize(a,a)};g.divide=function(a,d,b){a[0]=d[0].multiply(b[1]);a[1]=
d[1].multiply(b[0]);return g.normalize(a,a)};g.div=g.divide;g.equals=function(a,d){return a[0].isZero()&&d[0].isZero()||a[1].isZero()&&d[1].isZero()?!0:0===a[0].compare(d[0])&&0===a[1].compare(d[1])};g.approximates=function(a,d){if(g.equals(a,d))return!0;var b=g.create();g.sub(b,a,d);g.abs(b,b);return g.isLessThan(b,g.INFINITESIMAL)};g.isGreaterThan=function(a,d){return g.equals(a,d)?!1:0<a[0].multiply(d[1]).compare(d[0].multiply(a[1]))};g.isLessThan=function(a,d){return g.equals(a,d)?!1:0>a[0].multiply(d[1]).compare(d[0].multiply(a[1]))};
g.isNegative=function(a){return a[0].isNegative()};g.min=function(a,d,b){g.isLessThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};g.max=function(a,d,b){g.isGreaterThan(d,b)?(a[0]=d[0],a[1]=d[1]):(a[0]=b[0],a[1]=b[1]);return a};g.scalar_multiply=function(a,d,b){a[0]=d[0].multiply(b);a[1]=d[1];return g.normalize(a,a)};g.scalar_divide=function(a,d,b){a[0]=d[0];a[1]=d[1].multiply(b);return g.normalize(a,a)};g.normalize=function(a,d){if(d[0].isZero()||d[1].isZero())return d;if(0===d[0].compare(d[1]))return g.clone(g.ONE);
if(d[1].isNegative())a[0]=d[0].negate(),a[1]=d[1].negate();else if(a[0]=d[0],a[1]=d[1],a[1].isZero())return a;var b=h.greatest_common_divisor(a[0].abs(),a[1]);0<b.compare(BigInteger.ONE)&&(a[0]=a[0].quotient(b),a[1]=a[1].quotient(b));return a};g.opposite=function(a,d){a[0]=d[0].negate();a[1]=d[1];return a};g.negative=g.opposite;g.neg=g.opposite;g.power=function(a,d,b){2===b?(a[0]=d[0].square(),a[1]=d[1].square()):0<b?(a[0]=d[0].pow(b),a[1]=d[1].pow(b)):0>b?(b=Math.abs(b),a[0]=d[1].pow(b),a[1]=d[0].pow(b)):
g.copy(a,g.ONE);return a};g.pow=g.power;g.sqrt=function(a,d){return g.nthRoot(a,d,2)};g.nthRoot=function(a,d,b){if(g.equals(d,g.ZERO))return g.copy(a,g.ZERO);if(g.equals(d,g.ONE))return g.copy(a,g.ONE);if(g.equals(d,g.INFINITY))return g.copy(a,g.INFINITY);if(g.equals(d,g.INFINULL))return g.copy(a,g.INFINULL);var c=g.isNegative(d);c&&(d[0]=d[0].negate());g.copy(a,g.ONE);for(var e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=g.clone(g.ONE),h=q;!g.approximates(d,f)&&h--;)g.isLessThan(d,
f)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3])):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2])),a[0]=e[0].add(e[1]),a[1]=e[2].add(e[3]),g.pow(f,a,b);c&&(d[0]=d[0].negate(),1===b%2&&g.neg(a,a));return a};g.dot=function(a,d){return a[0].multiply(d[0]).add(a[1].multiply(d[1]))};g.str=function(a){return 0===a[1].compare(BigInteger.ONE)?a[0].toString():a[0].toString()+"/"+a[1].toString()};g.toDecimal=function(a){return a[0].toJSValue()/a[1].toJSValue()};g.dec=g.toDecimal;g.toInteger=function(a){return a[0].quotient(a[1]).toJSValue()};
g.round=g.toInteger;g.toBigInteger=function(a){return a[0].quotient(a[1])};g.floor=function(a){return Math.floor(g.toDecimal(a))};g.ceil=function(a){return Math.ceil(g.toDecimal(a))};g.fromInteger_copy=function(a,d){a[0]=BigInteger(d);a[1]=BigInteger.ONE;return a};g.fromInteger=function(a){return g.fromInteger_copy(g.create(),a)};g.fromIntegerInverse_copy=function(a,d){a[0]=BigInteger.ONE;a[1]=BigInteger(d);a[1].isNegative()&&(a[0]=a[0].negate(),a[1]=a[1].negate());return a};g.fromIntegerInverse=
function(a){return g.fromIntegerInverse_copy(g.create(),a)};g.fromDecimal=function(a){return g.fromDecimal_copy(g.create(),a)};g.fromDecimal_copy=function(a,d){d=parseFloat(d);if(isNaN(d))return g.copy(a,g.INFINULL);if(Infinity===d)return g.copy(a,g.INFINITY);if(Math.abs(d)<g.EPSILON)return g.copy(a,g.ZERO);if(Math.abs(d-1)<g.EPSILON)return g.copy(a,g.ONE);if(Math.abs(d%1)<g.EPSILON)return g.fromInteger_copy(a,d);if(Math.abs(1/d%1)<g.EPSILON)return g.fromIntegerInverse_copy(a,Math.round(1/d));g.copy(a,
g.ONE);for(var b=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],c=d,e=1,f=g.MAX_LOOPS;f--&&Math.abs(d-g.toDecimal(a))>g.EPSILON;)e=Math.floor(c),a[0]=BigInteger(e*b[0]+b[2]),a[1]=BigInteger(e*b[1]+b[3]),c=1/(c-e),b[2]=b[0],b[3]=b[1],b[0]=a[0],b[1]=a[1];return a};g.fromRandom=function(a){a[0]=BigInteger(0xfffffffffffff*Math.random()<<0);a[1]=BigInteger(Math.abs(0xfffffffffffff*Math.random()<<0));return g.normalize(a,a)};g.sin=function(a,d){if(d[1].isZero())return g.copy(a,g.ZERO);g.scalar_multiply(a,
d,2);var b=g.create();g.pow(b,d,2);g.add(b,b,g.ONE);g.divide(a,a,b);return a};g.cos=function(a,d){if(d[1].isZero())return g.neg(a,g.ONE);var b=g.create();g.pow(b,d,2);g.sub(a,g.ONE,b);var c=g.create();g.add(c,g.ONE,b);g.divide(a,a,c);return a};g.tan=function(a,b){g.scalar_multiply(a,b,2);var c=g.create();g.pow(c,b,2);g.scalar_multiply(c,c,2);g.add(a,a,c);g.pow(c,b,4);g.sub(c,g.ONE,c);g.divide(a,a,c);return a};g.toEgyptian=function(a){a=g.clone(a);g.abs(a,a);var b=g.floor(a);b&&g.sub(a,a,g.fromInteger(b));
if(!a[0])return b.toString();b||(b="");for(var c=1,e=g.create();1!==a[0];)c++,e=g.fromValues(1,c),g.isGreaterThan(a,e)&&(b&&(b+=" + "),b+=g.str(e),g.sub(a,a,e));return a?b?b+" + "+g.str(a):g.str(a):b?b:"0"};g.toBabylonian=function(a){var b="",c=g.toDecimal(a);a=parseInt(c);for(var c=c-a,e=0,f=0;0<a;)(e=a%60)&&(b=e+" * 60^"+f+(b?" + ":"")+b),a=(a-e)/60,f++;for(f=-1;0<c;)c*=60,e=parseInt(c+1E-13),c-=e,-1E-13>c||(e&&(b+=(b?" + ":"")+e+" * 60^"+f),f--);return b?b:"0"};g.traceSternBrocot=function(a){var b=
"";if(g.equals(a,g.ZERO)||g.equals(a,g.ONE)||g.equals(a,g.INFINITY)||g.equals(a,g.INFINULL))return b;a=g.clone(a);g.isNegative(a)&&(a[0]=a[0].negate());for(var c=g.clone(g.ONE),e=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],f=0,h=0,k=65536;!g.equals(a,c)&&k--;)g.isLessThan(a,c)?(e[0]=e[0].add(e[1]),e[2]=e[2].add(e[3]),h++,f&&(b+="R",1!==f&&(b+=f),f=0,b+=" ")):(e[1]=e[1].add(e[0]),e[3]=e[3].add(e[2]),f++,h&&(b+="L",1!==h&&(b+=h),h=0,b+=" ")),c[0]=e[0].add(e[1]),c[1]=e[2].add(e[3]);h?(b+=
"L",1!==h&&(b+=h)):f&&(b+="R",1!==f&&(b+=f));0>k&&(b+="...");return b};g.toContinuedFraction=function(a,b){b="undefined"===typeof b?65536:parseInt(b);if(g.equals(a,g.ZERO))return[0];if(g.equals(a,g.ONE))return[1];if(g.equals(a,g.NEGONE))return[-1];if(g.equals(a,g.INFINITY))return[1,0];if(g.equals(a,g.INFINULL))return[0,0];var c=g.clone(a),e=g.isNegative(c);e&&(c[0]=c[0].negate());for(var f=g.clone(g.ONE),h=[BigInteger(1),BigInteger(0),BigInteger(0),BigInteger(1)],k=1,l=[0],n=l.length-1;!g.equals(c,
f)&&b--;)g.isLessThan(c,f)?(-1===k?l[n]++:(k=-1,l.push(1),n++),h[0]=h[0].add(h[1]),h[2]=h[2].add(h[3])):(1===k?l[n]++:(k=1,l.push(1),n++),h[1]=h[1].add(h[0]),h[3]=h[3].add(h[2])),f[0]=h[0].add(h[1]),f[1]=h[2].add(h[3]);0>b?l.push(0):l[n]++;if(e)for(var p in l)l[p]=-l[p];return l};g.fromContinuedFraction=function(a,b){g.fromInteger_copy(a,b[b.length-1]);for(var c=b.length-2;-1<c;c--)g.invert(a,a),g.add(a,g.fromInteger(b[c]),a);return a};g.fromFactorial=function(a,b){if("undefined"!==typeof factorial.PREPARED[b])return g.fromInteger_copy(a,
factorial.PREPARED[b]);var c=factorial.PREPARED.length-1;for(g.fromInteger_copy(a,factorial.PREPARED[c]);c<b;)g.scalar_multiply(a,a,++c);return a};g.dump=function(a){return"bigrat\t"+g.str(a)+"\n~\t"+g.toDecimal(a)+"\nCF:\t["+g.toContinuedFraction(a)+"]\n"};g.ZERO=g.fromInteger(0);g.ONE=g.fromInteger(1);g.NEGONE=g.fromInteger(-1);g.INFINITY=g.fromValues(1,0);g.INFINULL=g.fromValues(0,0);g.INFINITESIMAL=g.clone([new BigInteger(1),t]);g.PI=g.fromValues("3141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086513282306647093844609550582231725359408128481117450284102701938521105559644622948954930381964428810975665933446128475648233786783165271201909145648566923460348610454326648213393607260249141273724587",
"1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000");"undefined"!==typeof a&&(a.bigrat=g);var p=function(a,b){this.a=c.fromValues(parseInt(a),parseInt(b))};p.prototype.toString=function(){return c.str(this.a)};p.prototype.toContinuedFraction=function(a){return c.toContinuedFraction(this.a,
a)};p.prototype.invert=function(){return c.invert(this.a)};p.prototype.reciprocal=p.prototype.invert;p.prototype.add=function(a){var b=c.create();c.add(b,this.a,a.a);return new p(b[0],b[1])};p.prototype.plus=p.prototype.add;p.prototype.subtract=function(a){var b=c.create();c.sub(b,this.a,a.a);return new p(b[0],b[1])};p.prototype.sub=p.prototype.subtract;p.prototype.minus=p.prototype.subtract;p.prototype.multiply=function(a){var b=c.create();c.mul(b,this.a,a.a);return new p(b[0],b[1])};p.prototype.mul=
p.prototype.multiply;p.prototype.times=p.prototype.multiply;p.prototype.mediant=function(a){var b=c.create();c.mediant(b,this.a,a.a);return new p(b[0],b[1])};p.prototype.divide=function(a){var b=c.create();c.div(b,this.a,a.a);return new p(b[0],b[1])};p.prototype.div=p.prototype.divide;p.prototype.divided_by=p.prototype.divide;p.prototype.power=function(a){var b=c.create();c.pow(b,this.a,a);return new p(b[0],b[1])};p.prototype.pow=p.prototype.power;p.prototype.dump=function(){return c.dump(this.a)};
p.prototype.toRat=function(){return c.clone(this.a)};p.prototype.toDecimal=function(){return c.toDecimal(this.a)};p.fromRat=function(a){var b=new p;b.a[0]=a[0];b.a[1]=a[1];return b};p.fromInteger=function(a){return p.fromRat(c.fromInteger(a))};p.fromIntegerInverse=function(a){return p.fromRat(c.fromIntegerInverse(a))};p.fromDecimal=function(a){return p.fromRat(c.fromDecimal(a))};p.fromContinuedFraction=function(a){return p.fromRat(c.fromContinuedFraction(c.create(),a))};"undefined"!==typeof a&&(a.rational=
p)})(a)})(this);
