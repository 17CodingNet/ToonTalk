<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<head>
<script>
window.TOONTALK = {GOOGLE_DRIVE_CLIENT_ID:  '1014278465319-fcagdv7f8232nvqevdkh87r4pmu6mvh8.apps.googleusercontent.com',
                   ORIGIN_FOR_GOOGLE_DRIVE: 'https://dl.dropboxusercontent.com'};
</script>
<script src="../libraries/jquery-2.1.1.min.js"></script>
<script src="../libraries/jquery-ui-1.11.2.custom/jquery-ui.min.js"></script>
<script type="text/javascript" charset="utf8" src="../libraries/DataTables-1.10.4/media/js/jquery.dataTables.js"></script>
<script src="../libraries/rationaljs.js"></script>
<script src="../support/initial.js"></script>
<script src="../primitives/widget.js"></script>
<script src="../primitives/number.js"></script>
<script src="../primitives/robot.js"></script>
<script src="../primitives/box.js"></script>
<script src="../primitives/element.js"></script>
<script src="../primitives/bird.js"></script>
<script src="../primitives/scale.js"></script>
<script src="../primitives/sensor.js"></script>
<script src="../primitives/backside.js"></script>
<script src="../primitives/frontside.js"></script>
<script src="../tools/tool.js"></script>
<script src="../tools/wand.js"></script>
<script src="../tools/vacuum.js"></script>
<script src="../support/robot_actions.js"></script>
<script src="../support/robot_action.js"></script>
<script src="../support/path.js"></script>
<script src="../support/run_queue.js"></script>
<script src="../support/display_updates.js"></script>
<script src="../support/settings.js"></script>
<script src="../support/publish.js"></script>
<script src="../support/google_drive.js"></script>
<script src="../support/utilities.js"></script>
<script src="https://apis.google.com/js/client.js?onload=handle_client_load"></script>
<script>
function authorize_then_inform_parent_to_save_edits() {
    "use strict";
    var callback_when_authorized = function (error) {
        var file_id_index, file_id;
        if (typeof error === 'string') {
            window.parent.postMessage({authorization_problem: error,
                                       respond_to: window.location.href},
                                      "*");
            return;
        }
        file_id_index = window.location.href.indexOf("id=");
        if (file_id_index < 0) {
            console.error(window.location.href + " expected to end with id=...");
            return;
        }
        file_id = window.location.href.substring(file_id_index+3);
        window.parent.postMessage({save_edits_to: window.location.href,
                                   file_id: file_id},
                                  "*");
    };
    window.TOONTALK.google_drive.handle_client_load(callback_when_authorized);
};
var message_handler =
    function (event) {
        if (event.data === "user wants to authorize") {
            window.TOONTALK.google_drive.authorize(authorize_then_inform_parent_to_save_edits);
        }
    };
window.addEventListener("message", message_handler, false);
                                                   
</script>
<script src="https://apis.google.com/js/client.js?onload=authorize_then_inform_parent_to_save_edits"></script>
<title>ToonTalk hidden iframe for saving edits</title>
</head>
<body>
</body>
</html>
